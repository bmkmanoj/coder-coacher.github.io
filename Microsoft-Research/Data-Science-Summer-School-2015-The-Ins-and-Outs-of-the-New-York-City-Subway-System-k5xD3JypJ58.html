<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Data Science Summer School 2015 - The Ins and Outs of the New York City Subway System | Coder Coacher - Coaching Coders</title><meta content="Data Science Summer School 2015 - The Ins and Outs of the New York City Subway System - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Data Science Summer School 2015 - The Ins and Outs of the New York City Subway System</b></h2><h5 class="post__date">2016-06-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/k5xD3JypJ58" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">each year microsoft research helps
hundreds of influential speakers from
around the world including leading
scientists renowned experts in
technology book authors and leading
academics and makes videos of these
lectures freely available
you
so so without further ado we're going to
start the first talk and this is a team
mentored by Sebastian and myself
consists of Iman ahmed shannon evans
reboot rope and see you in Vasquez from
paste and whites you called technology
achieve University in Manhattan College
respectively and i'm just going to lead
it off shannon evans is is going to
start us off so Shannon take it away
good evening everyone tonight at mix
tonight I'm excited to tell you about
the ins and out of the New York City
subway system so first of a few
questions that we looked at when
conducting this particular how do people
travel in a complex transit network can
we classify these train stations based
off their turnstile data can we use this
data to get better estimates upload the
local population by time of day and also
can we use a simple network flow
algorithm to make sense of these data so
a few general sticks before we move on
the New York City subway system is one
of the largest systems in it in the
world with about four hundred sixty
eight stations for approximately six
million trips per weekday compared to
German and chips trips per week /
weekend day and also its busiest station
Times Square has over two hundred
seventy seven thousand trips and tree
entries and exits per day so in this
project we use to data sources one was a
general trance transit feed
specification data which provided us
with the transfers between each station
the transfer times and also the
geographical location also use the MTA
terror cell data which gave cumulative
counts of entries and exits in periods
of four hour for ten blocks our time our
time frame for this project was from
last October to this July and also do
two incompatible incomplete data we
excluded the path Staten I already wrote
lir are and
New Jersey Transit so in all in all so
we we look at third for 434 subway
station so a general overview of the
empty a system if you look at this graph
you can see that entries are roughly
thirty percent more than exits and it's
not because people are not even to sit
the subway it's because of times like
rush hour people that were generally
using the emergency exit to leave so
these X's go unaccounted for and also if
you look at Mondays and Fridays you can
see that they're slightly lower than
together days and this is because some
holidays usually occurred Mondays and
people usually take Friday's off I all
work from home so we're going to run
over to this graph this is kind of
reinforces the previous graph you can
see entries are fluctuating around six
min so and it's generally stable except
for up to a few holidays where if you
look at the few dips this this dip right
here accounts for Thanksgiving Christmas
New Year's memorial day I'm also
interested in fact that we found out was
that on January 27 there is this
snowstorm in New York which limited
ridership on that a day so before we
could get the data into a pretty clean
format there are a few challenges that
we had to overcome for example there are
few quid stopped going to connote the
transit data were turns out counsel
going down I also some machines from
reporting for a few days and we had
other little problems with matching our
two data sets together where there are
multiple stations with the same names
but we're in different geographical
location there are a few blocks away so
we had to differentiate between those
and also in the two data sets there are
stations with slightly different name so
we have to do a few tweaks to get into
matchup so as I mentioned before entries
and exits did not match up so we needed
to balance them up to be able to put
into also algorithm
so we used an adjustment factor to scale
up the exits to match so it does all our
mineral analysis uses the balance data
so now I'll kind of like to help you
with the steven is going to talk to you
about the usage across the network
um all right hi everyone I'm Steve so
after looking after at the data one
thing that really came up was how do
different stations sir different transit
purposes so what we decided to do was
classify each station into one of three
categories a commercial station ideally
those stations surrounded by businesses
a residential station ideally those
stations surrounded by homes and then
linked stations which is everything else
we defined a commercial station to have
the following properties during daytimes
they had to have 1.3 times greater exits
than entries so people are leaving a
station going work and at night they had
to have 1.3 times greater entries and
exits so people get in on the train
heading home conversely residential
stations had to have 1.3 times greater
daily entries in the morning getting on
going about their business and at night
they had to have 1.3 times greater exits
so coming home so now we're looking at a
map of each station colored by its
station type each station is weighted by
its daily entries to see here that our
average hourly entries and exits are
around 1,500 for commercial and this
significantly drops when looking at
residential stations so around 400 which
I think intuitions shows I mean people
coming not only as residential they are
limited to New York City trains but
commercial stations people coming
elsewhere from New Jersey longisland
surrounding neighborhoods and league
stations around 500 on one notable
station is grand central 42nd Street
which has about one hundred and eighty
eight thousand daily exits it's about
2.8 exits per second so how I thought
about this was I mean if you assume
people are leaving the station there's
always a door somewhere that's being
open and there's a lot of AC be wasted
looking further into this map you can
see that there are virtually no
residential stations in Manhattan they
live within the bronx brooklyn and
queens but the majority of commercial
stations are with in midtown Manhattan
the financial district downtown and
hadn't with the exception of a few like
up here I noticed I looked at this and
it's a Columbia University that's that
stopped so they follow commercial
patterns over here is Long Island City
and I know personally I go over there
for car dealerships and down here by Bay
Ridge there's a few places as a military
base a cemetery and right around the
park I mean right around the corner
sunset park so now we're looking at maps
of a commercial station and residential
station the commercial being Fulton
Street which follows the patterns of
high exits in the morning there's a big
spike and at night they're a bunch of
entries going so people leaving going
home and here for residential stations
there's a big spike in the morning
people getting on the chain to go to
work and then exiting coming home from
work and also notice that there are the
scales but differ dramatically being a
commercial stations receive more traffic
than residential stations so we looked
at these types and we really wanted to
see was how do these compare to one
another so what we did was look at the
net exits which we defined as the hourly
exits minus the hourly entries but later
known as the demand which I a Mon is
going to speak about you can see again
commercial stations are considerably
larger than residential stations in the
in the morning and then it drops in the
evening and Link stations they don't
really show anything too significant
they sort of float around zero meaning
that and she's an exit so fairly similar
and now I want to pass it on to Amman
float Lou okay um hi so I'm gonna be
talking about the flow on the subway
transit network so before we went ahead
and computed the flow we actually had to
construct a graph and we did was we made
a directed graph using an adjacency
matrix from our merge data set that
looked something like this so for each
train station we had all stops at the
station that the train went to all the
actual station names that train stop was
linked to the travel time it takes to
get from one station to another in
seconds and the geo positions as well as
the entries and exits that we got from
the turnstile data so once we had this
large data set we went ahead and made an
adjacency matrix and then defined our
graph as with nodes and edges and what
we did was we define nodes we define our
loads as train stations where all lines
accessible with a free transfer and we
made our edges the rail links between
each adjacent stations so for example
this would be an old van cortlandt park
would be a node and there be an edge
from Van Cortlandt Park to 238 street
and then for every single edge we had a
cost which we define as a time it takes
to travel from one station to another
and as we can see like the one train is
pretty local so this is like a million
30 seconds to get from one station to
another in this and then once we had our
GCC matrix to find and our graph to find
went ahead and created this which is
very hard to interpret and which is it's
very hard to interpret without the
geographical locations which we add
later on but one thing that we can tell
from this network is that stations that
are like very condensed like very pop
eluted like Times Square probably most
likely within here whereas stations
where lines star and most likely out
here and then so we get a better view of
this once we add the geo positions and
we can see you know there are a lot of
stations in Manhattan a little less in
Brooklyn sort of same thing in queens
and Bronx and once we had this graph we
went ahead and computed the degree for
every single node and what we got was
that the average station has two
neighbors so that means like from one
station you can get to like
at average to other stations and so cool
fact we found was at fourteenth Street
Union Square there were ten neighboring
adjacent stations where as time square
which is you know the most traffic has
only seven but not only put you know and
then we get an even better view kinda
like the MTA once we add in the train
lines and we're not counting Stan line
that's why it's like I kind of covered
it yeah um and then afterwards once we
had our graphs are directed graph to
find we went ahead and added a demand to
every single node so for every station
we added man which we defined as net
exits meaning the amount of people that
are leaving a station than people
they're leaving one station and then
entering in the station per hour and
then from this we were able to take
using network X which is a module on
Python we were able to compute the
minimum cost flow to satisfy the demand
at every station by minimizing the cost
which we defined as the time traveled on
the network so we're able to take like
data that we observe such as the exits
and entries that every single station
and we built in fur observable
quantities such as the inflow and
outflow every station using that and we
did minimum cost flow although there
were other flows because usually when
people are using the MTA they're trying
to get to their destination as fast as
possible okay and then once we had this
we had sort of the inflow and outflow of
every single station which tells us you
know how people are coming into every
single station from other stations and
how people are going to other stations
from that one station and then so from
that we were able to define flow
direction and we were thinking about
what to make our central point and we
decided on grand central since it's in
Midtown and most people work in midtown
so we said that for example if a person
is if the person if a person is
traveling and they're going to a station
that's closer to Grand Central then
they're going inbound towards midtown
and if a person is going towards a
station that is further from Grand
Central they're going outbound away from
the town and once we have these
definitions cleared up we went ahead and
constructed this graph which um this is
for like the morning time so in this
graph you can see that you know as
people are traveling from like Brooklyn
towards midtown
hat in the these tadpoles are getting
larger and that sort of means that the
flow at every single station is getting
larger and more people are like getting
on the trains and all the flow as you
can see is like blue so that means
almost everybody is going inbound except
for like some people in Manhattan that
are going in a downtown to midtown and
Midtown to downtown so this is for the
morning time and then once we do evening
we get pretty pretty predictable results
you know everybody wants to work is
going back now and the note sides that
are larger here and then going smaller
here and everyone's traveling this way
as well as you know going outbound rest
before they were going down and now I'm
going to pass on to Reba who's going to
discuss the local populations and future
directions okay um so where can we go
with this well one thing that we've
started to do was to add this
information that we have about the flow
of stations threat of people throughout
New York to the census data that we
already have because the way we
currently define a population is the
amount of people living in a city but
New York as we most of us know it's not
really filled with the people living
there most of the people there actually
don't live there so using this is the
original census data which is just
residential populations and as you can
see the region's look pretty uniform
throughout mid time midtown is actually
lower than the rest of the regions and I
don't think that is true to our
observations but the city we usually see
like high fluctuations based on where we
are but if you add our net exits to the
census data we see that first Midtown
goes from being ten to thirty thousand
people to over a million which is a
tenfold increase and I think is true or
to what we see also other southern
regions of Manhattan go get very high
while residential districts kind of
clear out this is at noon we can also
look at the data at afternoon versus
late night 4pm there are far more people
in Manhattan as a whole and especially
you also see in the parks like Rikers
Island ends
Park then in for that for I am and
during the written in the residential
stations people have cleared out in the
afternoon and come back home at night
this is a an animation of how the subway
changes the population changes if you
account for subway data and you can see
the region's growing lighter and darker
this is the late night no one's in the
parks early morning now Midtown starting
to clear it like fill in around noon and
it's getting ever more populated until
people get home in the evening and night
again so one potential application of
this is for a lot of studies that use a
population rate they the bottom number
is the number of people but for a study
like this which calculates the number of
innocent people stopped a year over the
number of people in the area there are
some regions like over here that it's
like drastic but over here in midtown it
looks drastic but probably isn't they
are not getting a lot of complaints so
if you account for the subway data the
denominator is going to be almost 10
times larger and the number is probably
going to look very similar to the ones
around it so something like this could
be incorporated into a lot of different
studies and things like epidemiology
where you could study rabbit disease
flows throughout the stations also just
knowing where you could expend money on
public resources you can know where to
put things just knowing where people are
is a big deal in your studies alright
thanks
all right excellent okay so and one
thing I mentioned is that all their work
is up on get as well and so you can
download the graph in network ex format
that was took them like week and a half
just to get any the merge going so is a
huge effort so now you can go have fun
without any that startup costs so you
know have fun apply your algorithms so
now we're going to do QA so just you
know raise your hand I'll give the
question then i'll pass the mic to ever
once answer okay Duncan anyway test
whether your time of day predictions
correct or not so the question is do we
have any ground truth on daily local
population estimates by time of day I
don't know of any metric for that that
exists but I think observational II
definitely seems like something that's
accurate there certainly can be like
smaller flaws but for the larger study I
think that generally it seems like it
was the correct metric plus you know
subway as most of the people it's over
five and a half million trips a day so
that's a lot of information that is sort
of being rescued from you know anonymity
just also keep in mind that we are
excluding Long Island people and new
jersey and so there's a bunch of
populations that are not being thanks
Andrew so with the adjustment factor you
described the same as all for all
stations or did you kind of account for
the fact that maybe some stations had
more use of the emergency exit doors and
what's in chula you all know that so the
question is are we good for the camera
with the adjustment factor constant
across the network anyway by time of day
or was it station Civic yes sure it was
accounted for for each time period ever
yet so forth for each so a time periods
with an increment so for our periods so
for each for our block was accounted for
but it was a uniform across network yeah
Jack see I know Citibank and how this
exhibit similar patterns where you have
the residential right and then flow in
the morning to the commercial and non
flow later so I wanted and that shows
some problems with like you know the
availability of bikes and stuff like
that so I want to know like what
problems come up up there you know that
relate to this flow problem like are
there like maybe more more of issues
with the turnstile and stuff like that
more errors in more traffic stations and
stuff like that are you familiar with
and you gonna finish that that's not
that's not something we really looked
into but a son or something we should
definitely look into if you want to do a
part to New York just release taxi data
which i think would complement this
pretty well yep said anything you learn
during the product change the way you
use
yes your first well I definitely don't
use the exit doors anymore thanks it I
think we have time for one more question
going once going twice all right let's
get one more round of Christian guys got
it what do you got capacity quotation
area so you could see where you would at
least so we can look into if they pretty
said it fired like I don't know if
midtown aspires safe like you know
perfect all right let's let's thinking
with that</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>