<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How I Learned to Stop Worrying and Love the “DOM” | Coder Coacher - Coaching Coders</title><meta content="How I Learned to Stop Worrying and Love the “DOM” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>How I Learned to Stop Worrying and Love the “DOM”</b></h2><h5 class="post__date">2016-08-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4Ve5qUtXHvA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">materials supplied by microsoft
corporation may be used for internal
review analysis or research only any
editing reproduction publication
reblogged public showing internet or
public display is forbidden and may
violate copyright law
I give me great pleasure to be here
today is my first visit to Microsoft
Research India but not too long ago I
was a a postdoctoral researcher at MSR
in redmond and that I have very fond
memories of my time there so especially
thrilled to be here today so my talk
today is titled how I learned to stop
worrying and love the DOM and you'll see
why that title make sense here I must
say though I haven't really learned to
stop worry you'll see why okay so this
is joint work with my PhD student for
all and no carissa karthik badgers and
make faculty colleague ali mesbah at UBC
so before I launch into my Todd just a
brief overview of my research so in our
group we look at all aspects of building
for tolerance software starting from the
low level system software firmware all
the way up to the application so one
branch of research which I won't talk
about today is on using compiler and
runtime techniques for building error
resilient applications so here the
motivation is that you want to build
hardware that is low power but can
occasionally be 40 and we expose these
parts of the software and then we
engineer our applications in such a way
that they can tolerate the faults so
this is mostly in the realm of using
compilers and big program transformation
to add resilient applications what I
will be talking about today though is
the other direction we've been exploring
our group on the reliability of modern
web applications and here we are
interested in how to characterize as
well as improve the reliability of these
modern applications so what do we mean
by modern web applications so these are
applications many of us probably use on
a day-to-day basis things like facebook
youtube google bing amazon tumblr and so
on and the common feature of these
applications is that they provide rich
functionality to end user so how do they
do this through this technology called
JavaScript
so JavaScript it's a language that began
life as part of the Netscape 20 browser
back in 97 but it was pretty much
ignored by most people until two
thousand five or 2006 I know that
outlook web access videos JavaScript way
before the it became popular but that
was one exception by and large it
started becoming a dog around two
thousand six or so when Google and other
companies started to JavaScript heavy
applications so the the idea behind
JavaScript was that you execute in the
client browser and it sends these
asynchronous or Ajax messages to the
server and it can you don't ever have to
leave the web page you get a lot of rich
functionality from the same page now
contrary to what some people may think
javascript is asked actually responsible
for many web applications core
functionality it's not just for pretty
printing and fonts and things like that
I'll show you examples as we go forward
in the stock but as you may know or at
least those of you who written
JavaScript code may know it's not the
easiest language right codon it has a
lot of very dynamic features and has
even been dubbed as evil because of the
certain features like give us which all
of you to create code of the fly and
evaluate so there's this book the duct
Rockford wrote called JavaScript the
good parts he said it's actually a very
good language if you only stick to these
10 knots or constructs well guess what
real web sites don't and there was a
study from Purdue which showed that
almost no website in the wild actually
only sticks is a good part so it is a
challenge especially for those of us who
want to build static analysis tools it's
a very hard language to analyze know if
I take a step back and see what is the
work that's been done in this space so
the academic research community was a
little late to the game in terms of
studying characteristics of JavaScript
so there's only around 2000 a tour 2009
the first papers began up here and you
see there's been a lot of excellent work
coming out of MSR on trying to
understand the performance parallelism
of JavaScript applications likewise
security and privacy
but one part a one area that's not
received as much attention is looking at
the reliability of JavaScript
applications so what if I'm not out to
exploit the application and malicious
manner but I just want to make me
application more robust and reliable and
this is the gap that our work 60-foot so
we are trying to study as well as
improve the reliability of JavaScript
based web applications so one question I
often get asked this do you really care
about reliability in the context of
these applications does it matter and
this perception comes Thames from the
fact some people think that javascript
is only used for fancy special effects
well that's not the case so I'll give
you one example that we uncovered
through a study on actually
understanding the reliability of the top
50 top 100 web application so this is AI
Seng com you can safely at least I don't
understand all the man room there but
you see there is this error message that
gets displayed in the top left corner of
this web page so this is a chase an
error occurred when processing this
directive so this is a javascript error
and what happens is this should have
been the menu bar of this website so
what because of the exception you get an
error message like this until image the
whole side becomes unnavigable so this
is one of the good cases because at
least it gives you such a descriptive
message most of the time these things
are silently locked to the console and
you as an end user has no clue that
something went wrong and this is not the
only such example we found many of these
kinds of cases where either the
functionality was impact or it elected
data loss and so on I'll give more
examples later so before we do already
launched it to what what I'm going to
talk about today just a little bit of
background in terms of our prior work so
we started off by studying the console
messages that are printed whenever you
you go to a JavaScript heavy web page so
when your JavaScript code throws an
exception and the exception is not God
the exception gets locked to the console
as a typical user you don't see the
console but you can enable this and if
you look at it you'll find a lot of
exceptions get thrown by code which is
running
the wine we are not talking about we're
not talking about trying to break the
code militia see this is just normal
behavior you know you can go and look at
the console you see exceptions like
undefined symbol even things like
permission denied and so on and yet the
application will merrily continue to
execute unlike a C or C++ programmer if
you throw an exception the whole
application stops only that particular
event handler will stop other parts of
the application was continued to execute
thinking that this is okay which of
course is not so then we did this study
we found that the powerful of web
applications the top 100 actually
experienced a lot of errors and on
average we found four distinct error
messages per web application so this
shows you were a trend line here for the
various website so one exception was
Google because we only looked at the
home page of Google there was no
exception thrown there but almost every
other website in the top 50 1200 through
number of exceptions of the law did not
handle but while the study pointed us to
the fact that there was a reliability
problem here it didn't really tell us
much about the root cause as well as the
impact of these of these errors why
because it's very difficult starting
from an exception to go back and piece
together exactly what happened in the
code it's a lot of manual effort much of
this code is is you know purposely
obfuscator this whenever you may know
because or compressed when minified so
it's a very challenging problem to
actually go figure out what went wrong
and you know to gain some insights into
into how to fix it another one
interesting thing that came out of the
study was also many of these error
messages were non deterministic meaning
you run the same application twice the
exception may not occur yes real okay
there are i don't know the latest ones
but there are a couple of popular ones
that have been used there are also d
obfuscator so we didn't we didn't try to
like actively break the obfuscation that
was done okay so yeah those are the easy
wants to break there are more
sophisticated ones that definitely are
highly use but I haven't seen no
ordinary exception is one well they go
to the office caterer or not you just
outed we counted and we also i'm only
presenting the overall is that we
actually categorize the different kinds
of exceptions so we found majority were
permission denied followed by null
exceptions then undefined symbol and so
on so and then we also try to discover
correlations between the websites
properties as a whole so things like am
i using too many valves for example
because as and we didn't find
correlations to find a to cut a long
story short the one thing we found only
thing we found correlations for was the
number of domains from which you are
including the javascript code so so this
is sort of freedom more of an
experimental study to see whether it's a
real problem it and we yes we found is a
real problem but we didn't really we
didn't learn much about the root costs
so that's what I'm going to focus on
today for this thing at a message so the
same error message may appear multiple
times right so because you keep
executing this same code again oh no no
okay there were five categories of and
then per application there were four
distinct error messages spread out
across the categories ok so the this is
not the categories this is actually the
number of distinct error messages so
yeah I mean okay depending on your point
of view of a safe for is not a bad
number right but if this is production
code and it's throwing exceptions so to
me that is worrisome so they come up if
you just run the web application with no
test suite I mean this is when i try to
break them in any way the only thing we
did was to modify the speed of testing
so we try to do fast medium slow but the
website is supposed to be resilient to
this it's not
supposed to depend on this so one
surprising thing that yes that's a good
question so when we did the study this
was done at five fault but later we
actually went and try to so the number
of error messages maybe Rose a specific
but overall trend still hold so well in
the later part of the talk I'll talk
about how we use bug reports and there
it turns out about only twenty
twenty-five percent of the bugs a
browser specific so seventy-five percent
or not so which is interesting so one
thing I just want to mention the
interesting finding was that many errors
were non deterministic which is counter
to at least my intuition because I think
of JavaScript single-threaded right so
where is a non determinism coming from
well it turns out the asynchronous a
synchronous call timeouts as well as
advertisements introduced quite a bit of
non-determinism so it's not
straightforward to reason about these
things by using save the simple syntax
check not syntax checking but you know
code checking kind of tools you really
need semantic awareness there yes just
for the website like if CNN was
JavaScript just produced by CNN or like
are they cooking in with 3rd party
plugins so this includes everything so
this includes everything this includes
the tour some of all JavaScript that
gets loaded when you go to say cnn.com
right we also tried to isolate it but
it's not always possible because some of
these they distribute their own code
with many third-party providers right
that's true so we did yeah we don't
classify based upon the domain so I can
say more about this study if you're
interested I just want to this point say
that okay error messages are you know
errors are a problem in javascript in
production web applications so what I
what you are trying to do now is to
actually share this by the way what we
not necessary
a lawn chair action code even on one
variable can't throw a lot of exceptions
and the application will continue
running play well we spend to understand
why because if we have a Java piece of
Java code right it throws an exception
and that exceptions not caught typically
at least that thread will get dominated
is that okay requesting okay I can see
that so at least the the saving grace
there is that thread is somewhat
independent piece of computation in that
application so it probably doesn't
propagate to other parts of the code
right in JavaScript talking about email
handlers so one even handler throws an
exception only that handler gets
terminated other event handlers
downstream handlers may depend on the
computation may depend on the value
produced and they would execute assuming
this guy is finnished correctly all that
either you are mm-hmm it's actually just
we just independently right that's true
yeah yeah so yeah so we didn't go in and
actually analyze what are the sort of
the application impact but in this study
but what I'm going to be talking about
next we did do that analysis so you will
see that in fact many of these were not
handled by the application or resulted
in severe impact did you have a question
so so what I want to say you know that
is sort of the motivation to say why we
why we started doing the bug reports
that right because we won't understand
the root cause as well as the impact of
these javascript bugs so for the budget
puts 30 as I said one is we want to ask
what why why do these errors occur then
we want on what impact to this fall's
have unfortunately I can't go to cnn.com
and say share with me your bug database
you know they do their love a sort of
the Rope probably so what we try to do
instead is look at the open source
JavaScript applications and you looked
at 12 popular ones and we gather the bug
group
through these four hour which are not
very structured I'll talk about how we
did that and then we try to
systematically understand the root cause
of fear so these are some of the
applications we considered so we looked
at eight JavaScript web applications and
for javascript libraries so Matt
recognize some of these names like
WordPress jquery Wikimedia and so on so
these are yeah they are not on the top
50 but we think they're still popular
web applications and it's worthwhile
understanding what are the kinds of
errors or bugs that that were there
these applications so i should mention a
head of time we initially when we did
this we thought there will be
differences between applications or
libraries we didn't find those
differences so even though we have eight
applications and for libraries I'm just
going to present these results as one
pool so here's a little bit about the
methodology so we remember we are
looking for JavaScript buds right so we
first thing we did is research for all
bug reports that other word JavaScript
so we're you know go to that bug
repository search for it then what we do
is we filter out any report that has not
been not fixed so why do we do this
because you will find many of these bug
reports are not really bug reports there
are some user complaining that some
feature is missing or just
misunderstanding the feature so we
wanted to make sure we were studying
real buds so when something is we marked
fixed it means a program of Winton
programmer does that open source
application mental invested time and
effort in fixing it and then marked it
as fixed so to us that means it's a real
bug and my student also actually read
through the whole change logs for each
of these to make sure that the bug
really involved JavaScript okay that was
one of our a painstaking process because
of 300 plus of these reports and then
what we did is we put the first 30
reports for each application and then we
manually analyze them after putting them
in a standard format so this is how we
went about gathering the bug reports for
the for the results i'm going to present
next so here are the research questions
we asked so the first question is what
type of JavaScript files are current web
applications
so the kind of long story short we found
a variety of different types of all but
one kind of foil that really stood out
was what we call in correct method
parameter okay here you are pausing a
wrong argument to a method in the
JavaScript code soumitra was a big deal
well it turns out that most of these
methods were calls to the Dom API so for
those of you who may not know what a DOM
is this a hierarchical representation of
the web page the JavaScript code
interacts with the dorm through
well-defined API things I get element by
ID and so on and what were you finding
is that around sixty six percent of the
overall pie of buds was because one of
these api parameters were specified
incorrectly know if you think about that
for a minute what it means is that as a
programmer you seem as a programmer seem
to have an incorrect understanding of
the current state of the dorm at any
time so they're either trying to
retrieve an element that is not present
in the Dom or they are trying to
retrieve some property or assign some
property of an element which does not
have the property so okay javascript is
dynamically time so you can do things
like this right but you're going to get
a runtime exception when you try to do
this so let's look at an example of what
might be dominated form so let's say it
shows us a sample Dom of a hello world
they paid so I want to retrieve this div
element here so what I would do is I
would write something like document dot
get element by ID of LM now I've given
an example here of using the native Dom
API you could just as well be using
jQuery or any of the fancy library the
core problem does not change because you
still need to specify an element to
retrieve now when you try to return
instead of lessons of LM the ID use give
a typo and say hey lemme now this API
call the return a null and another value
will propagate in the code for example
and then finally when it's used in some
computation that's when you get the
exception so this is an example of a Dom
relate at fault with if you
remember from the pie chart was
responsible for two-thirds of all the
bugs that we studied no just to make it
clear though I've given a very simple
example where this a string constant and
it's a typo this string could come from
computations in fact as it often does
this is often produced with my loops and
so on because you know you don't you
don't want to access each element by its
name you try to come up with a general
our garden so trying to find what went
wrong this non-trivial in this case as i
will show you example of why it is okay
when you are copying music arnold a
reference yes so yeah to the back of
course you raise battle oh the root casa
de say that it wasn't on so so when we
went to the bucket so the bug report
actually tells you what was the what
does the fix apply to it right so if the
fix involved the changing of a dom
related appear we also looked at the
text message to make sure that we are
not so i want to talk a little bit more
about the impact where you see what how
we classify the impact so just some
terminology here so okay don't have read
this code this is just JavaScript code
to print hello world so basically you're
going to have an error in say line to
where you misspell hello to HL yellow
then in line for you were to try to
retrieve an element with the get element
by ID so we call this the error this is
the fault and finally the failure is an
exception okay so this is just a
terminology we adopt that it's a little
different from some of the terminologies
and some other communities but for as
the error is the place where the fault
or generated the fault is when you try
to do the dom and then failure is the
exception so okay so the high level
takeaway of the first question is lot of
these errors are dominated lot of these
false yes here
can check them ah ok that's a good
question so so I think there are two two
things going on here right ah no next
part is fine this is orthogonal to all
that I sure that so this is orthogonal
to type checking it because you need
types on the down I mean types on the
code won't give you this because the
problem seems to be that programmers
don't have a good mental model of the
Dom so i think that the dog is this this
is i said that's a toy example right so
in real were in the bug report for
example will find you try to concatenate
a string multiple times with various
inputs and then try to access it this is
that all jurisdictions can probably be
categorized I post one character the
type r is a very small category i just
gave that as an example because it's
easy to see in one slide right so there
are i look I'll show you more examples
for example in one website the
programmer forgot to pass a parameter to
a function and a javascript is allowed
it was an asynchronous car to a function
and depending lee web browser it would
either set it to a random value or set
it to an undefined value and that would
propagate to the get element by ID you
try to retrieve an element that is not
there you get an exception it yes 0 X
okay so okay honestly I've only played
with the website version of typescript
on the website now I think this is
orthogonal to type it because you still
need a way to access a Dom element right
as far as I understand typescript gives
you a way to do it in returns and stuff
on the JavaScript code but not so much
on the DOM and I correct me if I'm wrong
here is
I can okay you should chase parameter
checks but-but-but-but barometer should
not a type error in the parameter right
I'm giving I'm giving the correct type
but wrong value parameter and the wrong
values because I have a wrong
understanding of the dance take the
other exactly missing okay got that like
I agree with you I concede that can be
done by type i robot I understand there
are other techniques like if you look at
some of the auto-generated code for
Windows Phone application to choose
Sabbath mm-hmm so everything is done
with strings as well and then there is
checking your ID on this so I so I
haven't looked at Windows 8 Phone but I
will say this we looked at where the
libraries using a library makes a
difference and it does not update for
Marisa so better use jQuery or a Moodle
or what not to come up with a way to
access a Dom element you still make
either okay okay but at least that was
the de facto in fact in the other study
mentioned we found there's a reverse
correlation the more libraries you use
the more bugs you seem to have okay
because maybe the code is more complex
right so so we didn't actually you're
right i mean maybe all these problems go
away if you have an auto-generated you
know way too but but you know that
remains to be tested and right yeah we
didn't look at that thank you so the raw
so what do you mean by wrong type or
that was not know it was mostly wrong
value yeah yeah this won't get caught I
mean the example I gave miss a parameter
that might go get canto that's a that's
a very small portion so I'm going to
keep moving on here in terms of the
research question but feel free to you
know you can revisit this question at
the end if you like so the next question
we ask this what is the nature of
failures that stem from JavaScript fault
okay and
again I'm going to classify this as non
Dom buses Dom related in exactly the
same way as it did before so you find
that for a non Dom relate at fault about
ninety percent of those faults resulted
in an exception meaning that you could
actually see that when you ran the test
case with the Dhamma related fault only
about forty percent resulted an
exception so this might also explain why
it is harder for a programmer to track
these dominated forms because you don't
see it as an exception right it it shows
up on some subtle out put chains on that
and then it requires a user to go open a
bug report even more interestingly we
ask what is the impact of the javascript
for it like here you know so far all
I've said is ok they lead to an
exception or output change but so what
it eventually leads to an exception
that's right so because all we see is
okay these are an exception when you
have this fun so the even even the fact
that it does not lead to an exception
doesn't necessarily mean that it's a bad
outcome right because it may be
something that just a cosmetic effect so
then we ask what is the impact of these
down related faults here we are using
the bugzilla classification of impact
but we actually went through the reports
and made sure they were consistent so
type 1 means lowest impact type Phi is
highest impact ok this has been used in
other studies as well and the number y
axis shows the number of bug reports x
axis shows the types and the dark gray
bar is all false light gray is all
dominated faults and I hope you can see
it that for type 5 faults eighty percent
of the highest impact faults were down
relate meaning that when you have a
highest impact fault you you're more
likely than not that it's that is a
dominated part so dominated for it is
not something that is just cosmetic I
mean sure there are those as well which
you see in type 1 but many times many of
these parts have high impact and we're
talking we're going to just to give you
some intuition of what i mean by high
impact we're talking about things like
data loss so in an email client for
example there was a dominate at fault
21 MP email being sent by email was
dropped we're talking about security
violations and typo3 some security
sensitive data was displayed on the
client side we are talking about browser
hands we actually found a couple of
those where your code goes into an
infinite loop and your browser says kill
it and you know it we kill it but then
for some reason those are hangs after
that ok this was five Fox so I don't
know why but these are and this
categorization of types was done by the
programmers were fixing it so in terms
of the priority here the severity level
so this so far what we have seen is that
you have Dom related false being the
majority they don't result in exceptions
and many of them have a high impact we
then wanted to ask ourselves a question
what causes these dumb related faults
now you remember we don't have very
sophisticated tools at this point to go
in and actually trace back and so on so
we did a very simple analysis and then
we try to augment it based upon our
understanding of the code patterns so
our analysis is follows so we've looked
at the fix that the program are made to
fix the JavaScript fort and the other
cells there was the fix which parts of
the code base to the fixed touch did it
touch the HTML the richer the server
side did it touch the JavaScript okay
and the reason we asked ourselves this
is let's say all the fixtures touch the
server site there is no javascript void
it's not that JavaScript programmers
fought right it's a server-side code
that's for having a problem let's say
touch the HTML then it's something else
it's the web designers part and the
results sure enough showed that
eighty-six percent of those faults but
actually in the JavaScript code so this
was you need to think about it from a
dog perspective some other JavaScript
code in the application made an
incorrect change to the dorm or left the
dominant inconsistent State now you have
further downstream code go in and try to
interact with the doorman and get
experience that dominated for it and
take an exception so the causal chain is
not by external entities like HTML
service it you can you can sort of place
it within the JavaScript code and
perhaps even fix within the JavaScript
code
yes could this also need to do the
research with JavaScript okay that's a
great question so we are our whole study
is focused on client side JavaScript
bucks right so yes so maybe at some
level is not surprising twine side
JavaScript birds are two are due to
JavaScript code but in another level if
the result that turned out the other way
let's say it was also have a side codes
for it then there's limited stuff you
can do at the client site actually
understand and fix the phone and so this
is more to motivate the second part of
the stork I'll talk about some tools
we've built to Anna to do backward slice
analyze the root cause and he went to
such as some fixes through program
repair techniques for these forms so the
final we also I don't present the data
here so we also found that most of these
were not blows the specifics so as I
said only twenty-five percent work well
with a specific so it's not like they
occur in IE but not firefox or anything
like that okay finally the last question
we ask this how long does it take to fix
a javascript fault so is it the case
that javascript falls get you know fixed
really quickly what is the time duration
but I should mention before I show the
result that the times the absolute times
don't make much sense is only relative
times of matter because remember these
open source applications so they're not
necessarily dedicated programmers
sitting and fixing these faults as they
come by right so it could just be that
it's a hobby or something and it takes a
long time to fix some of these files
which is probably not realistic so this
is the glass so y ax is the novelist
number of days and x axis is the triage
time at the fixed time Treyarch time is
time from when the bug report is open to
when it will assigned or commented on by
developer fixed time is time from when
it was assigned or commented on to when
it was actually fixed and the number of
days of course you see is 90 days
probably I'm one hundred percent sure
the program was not sitting and breaking
the head for 90 days trying to fix the
fault but it gives you a relative sense
of the priorities so for the dorm
related fault it turns out that they get
three arts much more often
non dominated part say either because
they are considered important or cheesy
to pin blame interestingly though when
you look at the fixed time the Dom
related fault takes about 90 days to fix
compared to 60 65 days for the
non-dominated fault so again the shows
that the dominated faults probably
require more effort to fix and one
intuition one you know we looked at the
fixes it seems like the fixtures are
scattered much much more over the code
for a dom related fault than a non
dominated for so you might end up so you
need to have a good global view of the
whole code before you go and fix one of
these faults but as for the
non-dominated falls mostly confined to a
single procedure or at most a single no
group of functions so too so let's now
take a step back and say okay what are
the things we learn from this bug report
study because that is going to motivate
the kind of tools we built to address
these files so the first finding was
that the dorm related faults dominate
JavaScript form they respond for nearly
two-thirds of all the four so if there
is one thing we need to focus on it is
dominate the most elite output errors
which makes them much harder to find
they responsible for eighty percent of
the highest impact fault and also some
low impact faults they arise in the
JavaScript code and they take about 50%
longer time to fix for many developers
so all this points to one thing we need
good tools that can help programmers
reason about the Dom so that hey they
don't make those faults in the first
place and be given that a fault has
occurred to isolate the root cause and
such as fixes so that programmers can
adopt it so we went in the latter
direction so are the rest of this talk
is going to be about some of the tools
we built one is to actually do a
backward slice dynamic backward slice
from the point of men and exception or
exception occurs to finding the
incorrect Dom API method and then
another tool to suggest a fix for the
fault based upon common patterns of of
the dom or
patterns of Dom manipulation and the
high-level intuition here as to why
these tools work is that because it's a
dominated for it it makes a search space
much smaller than searching over all the
code paths that made lead to effects
meaning that if I have to suggest fixes
for code the space is much larger than
if I have to suggest fix is based on a
smaller section set of the Dom so you
will see okay mean I'm this is sort of
more high-level intuition I don't have
numbers to necessarily say that one
space is bigger than the other but this
is why we think these techniques work in
practice so i'll give you a minute if
you have any questions now about the bug
report study as i'll go into the dynamic
slicing technician yes that's a good
question so they're not very large okay
so if you look at we're talking so good
number of lines of code probably about
less than 10 lines of code but if you
look at the scattering that's that
varies widely as I said so yeah the
fixtures themselves I don't have the
data on the start but we also looked at
the different types of fixes so one
interesting thing we found is many times
programmers don't fix the root cause of
the problem they introduce a workaround
it is actually a good thing for us
because that means our automatic fixing
to lowes as a lower part right so okay
so moving on to other flocks so auto
floors is a tool to actually go and
identify the Dom related API access when
you have a Down related JavaScript for
the high-level idea is very simple what
is going to do is so it goes assume that
your dong your fault has insulted and
exceptions so I know that I said that
dominated faults don't often result in
exceptions but we just made this
assumption because we don't currently
have a technique to find these faults so
I assume somebody else has found the
fort and I want to root cause it and fix
it right so I so you could conceivably
use this if you had a way to find the
fault so here's the example I alluded to
earlier and this is the K
this is the example where I forgot to
pass a parameter to a function which may
be typescript won't catch I don't know
so this is from the tumblr website so
what tumblr does is it shows you
advertisements by cycling through four
banners every five seconds okay you
don't have to read all the code here if
you look at the last line you see the
problem so this it's calling set timeout
we change banner at 5000 is the argument
for the timeout period except the change
banner expects a banner ID as an
argument so the user as programmers
forgotten to pass this so most
javascript implementations will accept
this they won't complain the latest
version of Firefox will set banner ID to
undefined earlier versions will set it
to a random value now you use the banner
ID here in the get element by ID and
because of course it's undefined it
would say there is no such element so
this will return null and then it's
going to result in an exception here
online right sorry sir oh this one here
yeah that's a that's an asynchronous
call so saying call the one from set
timeout so it's it's saying five seconds
or no call call change Panem right so
that's a you could do that or you can
pass it as part of so you can just say
said timeout change banner come off I
thousand come out parameter right yeah I
mean that's just another JavaScript or
maybe a syntax oh right so so this is a
function call but the JavaScript runtime
doesn't say it is an error because it
allows this to happen for example that
you don't specify an argument so anyway
so the idea here would be starting from
the exception can identify which dorm
API call return null and then going
further back can I say that actually the
fix was to pass an extra parameter over
there okay so that's the that's the goal
just some high-level idea of the
implementation so we first run
our web application we use a crawler
called Ajax sorry well okay forget
corolla jacks and then you run the web
application generate traces and then we
partition the traces in two different
sequences and then we extract which
sequence is the important one and we
analyze the backward slice so at a high
level there are two challenges here one
is you might have asynchronous calls so
I need to figure out the causal sequence
of events that led me down the chain
right so if i have a sequential program
finding it backward slice is not
difficult because I know the execution
flow you know you know asynchronous
program I've got to piece together the
different sequences so that I can work
my way through the backward slice but
this is all dynamic so we can instrument
the code and do it the second portion
the second challenging part is we need
to be able to to to isolate the Dom API
call through the data dependency so we
need to log at every because JavaScript
highly dynamic it's it's often difficult
to just statically look at the data
dependencies so for every line of code
you need to log the data dependencies
and what are the values so that you can
then peace these together so due to lack
of time I'm going to skip the exact way
we do this okay because this is it sits
straight forward to figure it out once
you understand how to how to do the
instrumentation and that's that that
just has to do with adding a trace
functions at the right places I can talk
to you offline about it but to to cut a
long story short in this example then
you run out of lots what it would do is
it would say this line the document or
get element by ID is the one is the is a
bad Dom access function so that starting
rule exception is identified which Dom
access function returns the null value
and then further you can the next tool
I'm going to talk about the Javas it
would further go back and say banner ID
is the wrong value so you should have
passed the correct banner ID and even
tell you what that value should have
been for this court to not throw the
exception did you have a question so
it so okay we use some existing tools
and we evaluated or the flocks on three
applications so these are not very big
applications but they still have
substantial amounts of JavaScript so
talking about tens of thousands of lines
so this task free to do and WordPress we
introduce mutations so we actually had a
tool that would inject faults by
mutating the code in a very similar to
how we found the bug and then we checked
how often we were able to correctly
identify that Dom access method and for
to do a task freak our success rate one
hundred percent for WordPress it's only
a little over fifty percent the reason
is because our tool doesn't support
anonymous functions or did not support
anonymous functions at this point so
what press actually has a lot of
anonymous function so the slice cross an
anonymous function will give up on it
since we publish the paper we actually
support it so now our success rate for
WordPress about ninety-five percent
there are still some really complex
recursive calls of anonymous functions
we don't support so that's the other
five percent but overall this is fitting
pretty good accuracy so we are able to
isolate the the root cause of the
javascript bug with about ninety percent
of more accuracy now we also measure the
overhead so we are able to do this on
the tumblr website as well and this was
our most complex one so it has about
thirty five percent overhead it's a
dynamic technique so you know you who do
have to pay runtime overhead for the
tracing so the next so this is order
flocks where we are trying to isolate
the root cause the next tool we are
working on right now is the javis which
is to automatically fix the JavaScript
fault so just give the intuition behind
which office so the job is starts from
the Dom interaction point that is a
output of order flaws the input of each
others such as here's the Dom related
API method now what we are going to do
is we're going to find a workaround such
that so the dominated AP method is the
one that couldn't find the Dom value so
it's going to look at the set of all
candidate down values and find the one
there is a closest match to allow this
code to continue without an exception
once it finds such a match it's going to
go backward in the code and use a
constraint solver and ask how should I
have modified the code so that this is
the value that gets passed to the Dom
API method and the reason this works
well in this case is because our search
base is restricted to the Dom which is
much smaller compared to searching over
all possible code patterns because okay
programmers seem to use very definitive
ways of naming the Dom elements that we
can leave an edge on so I'm just going
to explain this with a short example
here so let's say you have a dom tree
that looks like this you have a piece of
code that looks like this and you're
trying to so basically what you're doing
is you're setting up this spring called
pre pyaari and then you're doing running
a loop i equals 0 i less than equal to
three and then you're going to go X find
a p element so this is a CSS selector
with the value given here okay and so
this will evaluate to PR e 0 1 the 0 0 1
0 1 2 when it comes to PR e 0 1 2 3
there is no such element so this is a
classic off by one error it should have
been i less than three but it's I less
than equal to three so what our tool
would do what we chose would do is it
would first of all assume that this CSS
selector is wrong because that's the one
that you know auto phlox tells you this
is the CSS selectors are also it starts
from that place then it's going to find
all the components all the P components
in the Dom that has that has closed
closed string matches so so ID name is
PR e 0 1 2 3 but what it's going to do
is so it's going to say PR e 0 1 2 3 are
the elements of this ID and it's going
to identify PR 0 PR e 01 up here is 0 1
2 as possible candidates for that last
thing that didn't match now at this
point you might ask why you didn't
identify the span which is also called
PR e 0 1 2 3 yes it does but what I so
that's also possible candidate but when
it finally goes and tries to rank the
fixes it would prioritize this fix
because it finds that from a bug report
study the off by one error was
pretty common pattern so we we also so
we look at common patterns of bugs that
programmers make and so if there are
multiple possible fixes we try to
prioritize it based on those common
patterns okay but anyway so it actually
finds these three candidates here as
possible matches then what it would do
is it would actually use a hampi string
solver to find what should have been
changed in this code so that this last
part matches PR is 0 1 2 and that could
be an empty string for example so at the
end of this whole procedure what we
would do is come back and say this is an
off by one error this is actually the
literal output on this code says modify
modified upper bound of the for loop
that contains line three which is the
one in line to hear and upper bound ok
here it doesn't tell you how to modify
it but you can figure that out by just
looking in the trace so this is what we
believe will be useful to a programmer
who has to wade through lot of down
manipulating code so it at least give
you suggestions on what to change so
that your code can pass and not throw an
exception but no means am I saying this
is the correct fix so it could be so you
as a programmer you still need to look
at it so all its selling is this is a
workaround you have to decide whether
this is the fix you intended but I will
say this that in the bug report study
many of the fixers we found will
actually work cons they didn't really
fix the problem yeah oh there ok so the
exception was thrown here in in this one
because what happens is ok sorry I
should have gone through that slower so
you see there's a PR e right it's going
to find 0 1 0 1 2 0 1 2 3 the problem is
just no p element with the class PR 0 1
2 3 and the exception is thrown in this
line line 5 because you are trying to
use it ok of course I'm for space
reasons I've compress this this could
span multiple screen fills of course
any other questions mother so yeah Alice
yes so here we are assuming that they
accept the error results in an exception
because we don't have a tool to actually
find errors the don't result in
exceptions it could be useful i agree
you'd have to you know I don't know if I
agree with it we have seen cases where
okay this is a little bit of it and
it'll be in amazon.com for example they
use this they use whether something is
null to determine whether you're not
then or not so we found that if you
actually change that value you can
pretend to Amazon that you're not then
and leave a comment when you're not
supposed to okay okay I agree I mean is
this I think this town that
distinguishes that's true yes so I've
chosen null because it's it's an easy
example to give but the tool works with
any other kinds of exceptions it would
also work if you had if you as a program
event and said this Dom portion is bad
you know tell me why you know try to
find a fix but the problem is that
requires us to stare at the screen and
say this is wrong and this is my not and
it becomes subjective so we wanted to
have an objective way to evaluate it so
I'm going to skip to the to the future
directions and also say a little bit
about some other work we're doing this
space so one of the future directions we
are trying to do is to actually build an
IDE that lets programmers reason about
Dom interactions because this is really
the Achilles heel of it seems like from
the study that Dom interactions are very
complex and programmers don't have a
good model so we're trying to provide
support for this we also are looking at
automated code synthesis techniques so
that you write annotations as to how we
want to manipulate the Dom and then the
the synthesis tool will actually
generate those
the get element by IDs and so on this is
very early work okay I don't have any
results to show here but we think this
could be promising again because the
search space is much more restricted
you're really looking at the dock going
forward we actually want to support
html5 is for those of you may not know
html5 is considered this panacea for web
as well as mobile application
development but unfortunately it has a
lot of features similar to DOM
attraction as canvas interactions local
storage all of which of state and it's
going to be a nightmare for programmers
to reason about this correctly and to
build robust cone so okay that's going
to keep us busy for a while we think so
this is something we are actively
exploring just want to spend two more
minutes saying a little bit about some
other work we're doing this area v so
the the work I spoke about was on bug
report study tools we've also been
looking at generating test cases for
JavaScript based applications so my
student built mutation based testing to
mutate to assess the quality of a test
suite by generating mutants and then to
actually figure out to dynamic analysis
which portions of the code should be
touched or likely to be touched by
equivalent mutant so you can you can
prioritize your testing by not running
these equivalent mutants so one
interesting thing here is we also
introduced JavaScript and down specific
mutations which could be used beyond the
specific use we predict for we also have
a tool on actually generating Oracle's
and unit tests from web crawling like
when you crawl at javascript heavy
weather application you get a lot of
places so we are can convert those
traces unit tests for this piece of code
and also generate Oracle's and the
high-level idea here is we extract
invariance from the code and then we try
to convert this invariance doracles the
final tool which we are so working in
this space is just understanding dong
and timeouts and things like that in
JavaScript code so the idea is we
instrument a complex piece of code and
then we visualize the links
different events in the code as well as
the how it interacts with the dorm
etcetera so this is also and you done
user studies which show that clematis
with clematis our tool we can find a bug
five times faster than with 51 now
that's not to such as that clematis is
so good eyelet even further the
corollary Firebug is not very powerful
okay so it's sort of birch and a favor
but unfortunately fire bud seems to be
at least one one one one of the
important tools in this community to
find the source of the bug so we were
able to do much better than that so to
conclude my talk I hope I convince you
that reliability is a significant
challenge in modern web applications and
we have characterized the reliability of
modern web applications by looking at
bug reports and we find that many of
them are Dom related both in terms of
impact is this in terms of numbers so
this is an area that has not been
explored by the research community a lot
of work on JavaScript has been on things
like evals and so on which does not seem
to be the main reason why these things
are failing in the wine so we really
need tools to look at this interaction
green door mat JavaScript because that's
why the bugs are and we've only
scratched the tip of the iceberg here we
have two tools to localize the Dom
related falls as well as to
automatically fixed Tom plated faults
but for sure there's a lot more that can
be done finally of course my talk title
was inspired by the cult classic dr.
Strangelove where it's how i learned to
stop worrying and love the bomb and then
he doesn't really stop worrying so i
haven't stopped worrying about the dog
either okay thank you happy to take more
questions yes fear what is
I used to use mfc it is as frameworks
back to design new eyes to see a salad
salad and so on I then could be like to
be generated by a little something at
the evening yeah they'll all be I
checked working these years must have
shown them as well I'm writing on the
time you used for java and c and life is
PI system you are appearing some
protection okay so maybe I'm don't
understand question but I so I don't
know what the color of the Dom would
have been in a mfc application source
file stinks it has a name first name and
the way you access it is you get
resource you possibly think and I can be
like all right but there is a
intermediate step make it convert the
resource file into actually a sea
vampire right then you call a function
and if you miss that learning of the
function which was the name of this
finger Italy you would get a come by
using stop diving for them so it's also
but in that specific example right the
resources file I don't think changes
during the course of the applications
education does it okay so then yeah then
is equal to the okay all right oh yeah
because Dom is a highly dynamic entity
and I think part know what I mean so
once you can find it what are you pile
it is yeah so that's the difference is
the donkey right so it's at any point
you need to have a correct mental model
of the correct state of the door
okay those back all right hi just
reflects theta what you want but so all
right stay with me and you can be
parents alright i guess the difference
is that you have to plan the choir after
you couldn't dynamically change the
state the UN you could you could add you
could make things visible for instance
then adding and removing you can either
no evidence but you can't but that's
changing this for example you can
dynamically say that oh here's i
dynamically create a game but whenever
you have been get all that no you you
know you have to provision for that
element ready you I a friend right India
you can't die no money area you cannot
control the contents of that right but
the point is even the structure can
change right oh yeah good one common
element in all these cases seems to be
that though there is a static structure
the programmer has he are you putting it
into a very generic tree like structure
the UI framework supports he would
involve all right but there's also
problem that though there's a start
typing you are not going to an untyped
tree like structure girl means you can't
use starting naming that can be checked
by started exactly exactly but it is the
year saying in the convention languages
you have to provisionally the structure
of the UI offerin learn with many of the
UI frameworks you use this tree like
structure stone as opposed to a
programmer defined applications is thick
fastenal song but but I mean how much
change does that tree like structure
undergo during the course of the
execution no no there is the dynamic
nature that is one thing okay others
switching to a general three asaka
square time I see okay i see i see you
dashing right if it's a time
structurally every name he said it's
it's like in Star having a class with
Finn CFG and edge is not reducing
objects and start
asking 150 change 10 possibility severus
increase right right actually I one
interesting thing we study heated I
didn't mention it we looked at how the
top hundred web applications wat de Dom
structure looks like and we found that
many of them actually sort of use a
hierarchical naming the great a ID and
then ID and the score are for the
children ID and the score are under
Scotty so it seems like this mapping
exists in the mind of the programmer or
they made it in the string exactly and
you don't get the type checking oh so
you're saying go let's go back to the
web for no world where javascript code
engine or didn't have to have JavaScript
code right okay okay so if you ask me
for my opinion I think that train has
left the station right I don't think now
we can haul it back in that's why we do
not go to allow this freedom what we can
do is to provide tools or are more
structured ways of expressing those
kinds of transformations I'm data agree
with you so you in some framework
you know the other you should look at it
from a library perspectives I've been
lot of libraries that people have
released and so on and none of them
really sort of attack this core problem
right so we didn't actually see the use
of library mitigating or changing this
in any way for anything as if at the
correlation went the other way because
probably the code is very complex so
using all these libraries and you ended
up having more of these kinds of bugs so
so yeah I mean maybe you know if you if
you can write a librarian and and ensure
it's an option then this problem would
be simpler but the point I make is that
most of the research communities effect
first in this space have been around the
features of the JavaScript language
itself as opposed to the to the
interface and whereas most of the
problems seem to be on the interface so
we need to put more effort making
interface just like I think oh okay and
you will give up occupation of my ass
think so on which actually typed it
pleasing what they're not positive what
you have to do is that Yeah Yeah right
right right right so in fact one of the
things we did do is we try to find
invariance of the Dom tree so we found
that many web pages for ninety percent
of the Dharma remain static there's only
ten small portion that's highly dynamic
but the problem is that dynamic
proportion is actually very difficult to
predict statically like we couldn't find
a pattern to characterize that that ten
percent was changing so yeah so for the
other ninety percent yeah you could do
all this schema maybe you know
statically even map it out but I don't
know how to capture this change sorry
well he said you mean exceptions throne
yeah we didn't go and map that back so
that was actually another thing we were
trying to find Dom invariance we didn't
actually try to do it on the toughest
yeah I mean you would be interesting if
you just remove advertisements for these
oh that we did that it does only about
four so yeah you're right advertisements
are fifty percent of their as we found
the original study so we still are okay
right but I won't get it that way but
even so you have so we also we also
looked at applications that are more
like office applications on the web like
not websites so things like writer and
so on and then most of them as it is
things like undefined symbols or null
null exceptions so we didn't so with
that advertisement mostly permission
denied so for some reason these
advertisements we're trying to read data
they should not being disallowed with
the same origin policy yeah okay now
even if you discount that that's fifty
percent errors on the production
websites and ninety percent of the
errors on the other office kind of
applications so it's still a large
problem and you know i'm not claiming
styling here reclaiming I have a
solution right um so just pointing to
the problem and I think there's a lot of
interesting tools that have been applied
in other contexts that can be brought to
back here
okay to normal questions thank you and
to follow the proper</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>