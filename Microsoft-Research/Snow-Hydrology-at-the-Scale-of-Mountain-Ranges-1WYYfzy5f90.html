<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Snow Hydrology at the Scale of Mountain Ranges | Coder Coacher - Coaching Coders</title><meta content="Snow Hydrology at the Scale of Mountain Ranges - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Snow Hydrology at the Scale of Mountain Ranges</b></h2><h5 class="post__date">2016-07-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1WYYfzy5f90" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">each year Microsoft Research hosts
hundreds of influential speakers from
around the world including leading
scientists renowned experts in
technology book authors and leading
academics and makes videos of these
lectures freely available
you
I wanted to welcome you to this talk by
Jeff Dozier from University of
California Santa Barbara
Jeff's up here visiting us for a few
months to look at some of the
interactions with how we can use some of
the technology with some of the stuff
we're doing here at Microsoft Research
and so Jeff has been involved with a lot
of the different activities we've been
doing for many years everything from
early on terror' server that we were
doing with Jim Gray and some of the
other folks and also down to some of the
other activities at the science
workshops and it's actually a nice
science fellow Microsoft do science
fellow for us so I want to welcome Jeff
and he's going to give a talk on snow
hydrology at the scale of mountain
ranges so welcome Jeff thanks so as you
can see I'm spending my summer at MSR
I'm I think of myself as the oldest
intern in the group and I want to
acknowledge two students who have helped
a little bit with this Carl Ricker is a
UCSB student who just finished his PhD
in early July and is now working at Jet
Propulsion lab and a lot of the
presentation is based on stuff that he
did and then of course my local intern
Oh Alex Wiggins who's a student at
Oregon State and he's working on some of
the visualization aspects of this and
he's he's preparing something to show
you after I'm done he he works much
closer to deadlines even than I do okay
so the the issue with snow that you
would know in any part of the western
United States and and affecting probably
a billion people worldwide who get water
from snow melt in the mountains is that
if you look at the record from a snow
pillow which is a device on the ground
that measures the weight on the of the
snow on top of it then the typical
season is that that snow starts
accumulating
early in the season sometime you know
October or November and then you know in
fits and starts it it the the snowpack
grows and then sometime in the spring it
starts to melt and there may be a few
snowfall events during that melt but you
know by and large it it melts pretty
quickly and it of course happens at the
time that the water demand is increasing
so the snowpack really is the natural
reservoir over much of the Mountain West
and the these graphs here show the same
thing what I've done is to take the snow
pillow record on the right take the
daily differences and express those as
either positive or negative and so again
what you see is that the the
accumulation period is a set of storms
that occurs over periods of six months
or so and then the melt period occurs
pretty quickly the other thing is kind
of interesting about this graphs if you
look at a relatively lean year 2007 with
with a big year in the Sierra 2011 is
that the sizes of the storms are not
that much different that the thing the
difference in a big year should get more
storms occurring okay and because of the
importance in this snow resource for
agriculture and urban youths and
hydropower and so forth there's a
forecasting effort that goes on and
typically what water agencies do is
around the 1st of April or so they issue
a forecast for the seasonal runoff that
is what they expect to get from April to
July you know based on all these
instruments that are in the mountains
and what this graph here shows is that
that relative forecast error is pretty
high that is if you look at the if you
look at the median
error the median error is about 20% or
so and if you go out to the the server
error events say if you go up to the 90
percentile on the cumulative probability
distribution that error is nearly 60
percent so so what that says is you know
in one year in ten that forecast error
is going to be substantial and the
reason in say particularly in the sierra
nevada where that's important is that
this lower graph shows the reservoir
capacity as a fraction of the mean
annual runoff and and what you see is
most of the basins you know or are
writing right around a hundred percent
or a little bit less there are a few
exceptions
while the Truckee well they got Lake
Tahoe so that there's about a three
meter dam height at the Truckee River
spillway so if you multiply three meters
times the area of Lake Tahoe it's a
pretty big number and then the milettis
dam and the Stanislaw is big but other
than that you know we're we don't store
much more than the annual runoff
throughout that mountain range and so
therefore forecasts errors in a single
season make a big difference you know
whereas if you had say five years of
storage then those errors wouldn't be so
important okay so the reason there are
several reasons for why this why
forecasting is difficult and one of them
is that by and large these snow sensors
don't cover the highest elevations
partly just that you get higher it's a
bleak windy environment it's harder to
install things but what you see on the
left for a two-week period in 2011 is
that in July that all of the snow
sensors are below the snow zone and yet
there's a fair amount of snow that's
still in the watershed so in other words
at this point you're if you look these
are the snow pillow records for all of
them and by the that first image up on
the top all of all of them but to have
gone 2-0 and by the second image they've
all gone to zero so they're still you
know snow in the watershed and yet all
of your your surface network says the
snow is gone and where this is important
is the reservoir manager for the Hetch
Hetchy Reservoir that supplies water to
San Francisco he's kind of wondering
what's going on at this point because he
can generate he can let some of that
water out and generate hydropower and
make about a hundred and twenty five
thousand dollars a day but then he runs
the risk of you know you're not being
able to take a shower when you visited
San Francisco in in late October and so
if he knew that there was more snow in
the watershed then he could in fact make
a better decision whereas thinking that
there's no snow in the watershed means
he has to kind of hang on to what he's
got okay the other reasons for
heterogeneity are you know the big
difference between snow and rain aside
from the fact that one of them is is
liquid and the other is not is that snow
moves around on the ground after it
falls and this picture on the left is at
the Reynolds Creek watershed and in
Idaho you can see the fence in the
background that snow in the foreground
is is probably up to your shins and yet
back there where those trees are the
snow is three meters deep and and that's
pretty important you know that's why
those trees have decided to grow there
right and then similarly there's a
differential melting that occurs so this
is you know a typical scene that you see
in the Mountain West with one slope
covered with snow and
the slope opposite it bear so there's a
couple of things that we do in order to
try to try to characterize this
heterogeneity and what's going on in the
snowpack at very large scales that is we
want to look at the whole mountain range
so one of the things we do is because of
that snow is heterogeneous and we want
to see it pretty much every day or we
want to get it enough opportunities that
we can really keep track of what's going
on with it we need to use a satellite
sensor that has a high revisit interval
and so we use motives because if we have
day data every day but the problem is
that pixel is 500 meters in size and so
there's a lot of heterogeneity that's
occurring within that pixel and so what
we do is we have a method to actually
map what we call the fractional snow
cover and this is this is going to be a
pretty typical problem anytime where you
want a a rapid revisit interval
therefore that drives you to a somewhat
larger pixel and therefore you're going
to have this this mixing problem and so
in this case we figured out a way to
solve that so we can actually say how
much of that pixel is in fact
snow-covered and then what we do and
this is its first of all it's okay to
ask questions during the talk you can
you can interrupt me but the consequence
of that is sometimes when people do that
you don't get to the end right you get
into discussions and so what I'm going
to do is is this is the end but then I'm
going to work backwards okay so so the
end is that we really want to know how
much snow is in the mountains we want
and and we want to know its spatial
distribution and we want to know that
for a couple of reasons one is you know
it to help with the forecasting problem
but the other is to to sort of look at
the impact that snow has on the hydro
eCollege
these sorts of mountain ranges that this
spatial variability is really important
so there is no method currently to
directly measure this from remote
sensing right and I can discuss efforts
on how to do that directly but that's
that's another lecture entirely so what
we do instead is we can track when the
snow the rate at which the snow
disappears and from that we can
reconstruct what that spatial
distribution was and and so and and
that's what it looks like in this wet
year 2011 it was wet in California
wasn't wet up here because it was wet in
California right 2007 it was dry in
California so you know or gonna
Washington got a little bit more than
that here but what you can see is this
this is what that spatial distribution
looks like and these show the three
months starting April 1st and and on the
right June 1st and what you see in the
big years there's still a fair amount of
snow left in June okay so how do we do
that and what are some of the east
science problems involved yeah how it is
late you know clearly the amount of time
it takes for that to get or what where
it needs to be managed in a row
is going to be different than where it
came from yeah is that I mean what what
sort of time range we talk about well it
hours days or weeks it's days days days
yeah typically these reservoirs don't
have a lot of groundwater storage there
they're up in the mountains there
they're mostly bedrock there's they the
answer that question varies a little bit
because part of that residence time is
in the snowpack so you're you're melting
your water at the top of the snowpack
and then it has to get through the snow
and then it gets through the soil but
but yeah it's it's typically days to a
week or two it's it's not it whereas you
know in a in a mountain range with deep
groundwater storage then it could be
longer
Oh what you see now you you know when
it's gonna show up is I'm thinking this
this particular like say the Grand
Coulee Dam where the water's showing up
in River and then the the challenge that
we have up here is that they're trying
to manage the flow through the reservoir
so they don't risk risk dry sudden surge
coming in topping the dam and also
you've got this challenge with wind
power over there trying to like figure
out yeah I'm gonna have to Cattell win
because I need to push water through the
dam because this well this is this is a
this is one of the problems in that if
you're in that your reservoir management
has multiple purposes one of them is
flood control another is provision of
water resources and if you think those
those are diametrically opposed to one
another okay but you can you can sort of
see what the timing is simply based on
the fact that when the year in the
mountains you do see a diurnal diurnal
variability in the streamflow and
typically that is on the order of a few
hours after the maximum rate of melt so
that kind of shows you that there there
isn't a lot of lag time going on into
storage right
it's about the tangential does sediment
transport play into this whole analysis
of how the management goes or is that
not so much an issue like this well that
that's an interesting problem in that
the the one thing that does occur with
sediment transport is that is that there
is this predictable sort of diurnal
variability predictable and seasonal it
not only applies to sediment transport
but it applies to you know where the
fish are trying to to hide while there
while they're hatching and stuff in
other words the during periods when flow
is too low sometimes the water gets too
hot and it it affects fishes so and and
so sustaining so there's a lots there's
lots of things going on in in the way
that this heterogeneity both spatially
and temporally not only affects the way
we manage water but it also affects the
sort of habitats that the water supports
okay so how do we do this well you know
any science you've got to have a
workflow I usually write scripts but but
what this is showing first of all you
know trying to impress you with its
complexity and I guess but the the stuff
that comes in blue are all data that we
get from somewhere else so the modus
data and then veers is a sensor that
just went up that we're expecting to use
digital elevation models land cover data
and then the the assimilated data from
the national land data assimilation
system and then everything else in red
is sort of stuff that we do and and so I
can take you through some of that so so
the first is you know how we actually go
through this processing to produce the
the fractional snow cover estimates and
here what we do here is we take
advantage of the position of the modus
bands which the modus has 36 spectral
bands some of them are at 500 meters two
of them are 250 meters and then the rest
are at at one kilometer but these seven
bands in this part of the spectrum are
usually what it's called the land bands
and if we look at how that matches the
spectral reflectance of the major
components of what's on the earth's
surface well what's on the other surface
there is vegetation there's dirt and
there's snow right water which is pretty
dark in all spectral bands and then you
know everything else so it's soil yeah
it's it's the same soil has variability
in the reflections because it does get
wet
yeah so generally when it's wet it's
darker yeah so so that's why you see
this if you look at different
reflectances of soil they all sort of
have the same shape but there is some of
them are darker and some of them are
lighter vegetation has this typical
reflectance of being pretty dark in the
visible and then rising very steeply as
you go into the near infrared part of
the spectrum that's sometimes it's
called the red edge of the spectrum and
then snow which has a lot of variability
because of the grain size so but notice
that the visible spectrum is only going
out to 0.7 micrometers and so much of
that variability in snow is out beyond
the wavelengths that you can see but in
fact if you if you think of color in
this sort of extended way including the
whole spectrum snow is one of the most
colorful substances in nature you know
it's all it's all beyond the wavelengths
you can see but if you know if our eyes
were sensitive out in the near-infrared
there would be a tourist industry in the
western United States you don't like
this kind of like the leaf peepers in
New England you know going out to watch
the colors but the main thing the point
of this is if you if you compare this if
you compare all those spectra and and of
course to do that I just selected one
from each graph that you see that that
snow is pretty distinctive from soil
that's pretty distinctive from
vegetation so those three substances
tend to have distinctive spectral
signatures and the motifs bands are
positioned well enough to to catch those
and so what that means is that if you if
you have a spectral signature from a
pixel then you can decompose it to what
fractions of stuff went into it and so
that's where we get this fractional
snowcover so this is the Sierra again in
a dry year on top and in a wet year on
the bottom and this little area that's
blowing up at the bottom these are the
Tuolumne and the merced drainage basins
right no we remember the the red diagram
the stuff that in red is us yeah no well
motus is just 8 it just makes the
measurement and then we get the data and
then we make the inference okay and then
so that was all the stuff on the left
and then what we do is it turns out
after we do that measurement there are
some things we need to do to sort of
smooth out the data because there are
gaps from cloud cover and also how does
motifs get these daily data when it's
only its orbit altitude is only 705
kilometres and in order to cover the
earth every day that means it has to
have a pretty wide swath and in order to
have a pretty wide
soif it's got to have some of what
you're seeing is pretty steep or pretty
Nader view angles so so the combination
of the clouds occasional dropouts and
these off nadir few angles mean that
your data are scrambled a little bit so
these are just two days apart
this is April 8th and this is April 9th
and this was on a day when mode has
happened to see this part of the world
at a pretty near nadir view angle and
here's the histogram of the view angles
for that scene so it was right overhead
and the next day in order to get even
get that second day it was way off to
the side and in fact notice that the
view angles the histograms are bimodal
and the reason is that this image was
actually stitched together from one pass
looking in this direction and one pass
looking at this direction and what you
notice about these pixels well what
happens when you're looking off to the
side well firstly that pixel expands in
both directions because it's just
further away right and the other is that
it expands more in the crosstrack
direction because of the effect of the
earth curvature so what you see is that
the it's the same scene but these pixels
here look a lot different than the one
on the left so we could just ignore them
right on these days but what if that's
the only scene I've got during a period
when it's cloud cover so what we try to
do is we I run a smoothing spline
through the data but I I wait the
splines by the the inverse of that view
angle so that if my only view in a
period that's otherwise cloud cover is
off to the side I'm going to use it but
in the cases where I have data every day
then then it doesn't affect our analysis
very much okay so then after the this
part of the flow diagram so so what
we've got is we've got data on the snow
cover and now we and we can tell kind of
how it's the rate at which that's that
fractional snow cover is going away
during the year and so now we want to
look at how much energy is actually
involved so one of the things that the
modus analysis also gives us is we
estimate the albedo so we know how
bright that snow is and therefore how
much solar radiation it's reflecting and
therefore from the difference how much
it's absorbing and then what we get from
the NLDS system is sort of gridded
meteorological reanalysis and the way
this works is the the spatial resolution
of NLDS is 1/8 degree so it's a lot
bigger than our pixel and that's what
you see for solar radiation in the upper
left-hand corner and this is this is
just for one hour right so then what we
do in in the second diagram is we we
smooth that solar radiation to the
resolution that we're going to run the
model app which in this case is 100
meters and but the problem now is that
that that 1/8 degree grid cell it has a
single elevation that is assigned to it
so what we then need to do in the third
part there is we we scale that radiation
within that one eighth degree pixel and
we spread it over the hundred meter
pixels we scale it accounting for the
elevation and we just do a pressure
scaling right so and then we've got
topography that is you know some slopes
are facing the Sun and some slopes are
facing away from the Sun and so then we
lay that scaled radiation now down on
the topography and then we deal with the
fact that some of that snow
under the trees so we apply a land cover
map to this and figure out how much snow
how much radiation is actually hitting
the snow and then we've got the albedo
of that snow and you can see the scale
there and then if you multiply all that
you get the amount of radiation that's
being reflected and then you DIF add and
you get the amount of radiation that's
being absorbed so so now what we have is
is a rate at which that snow is
absorbing solar radiation yeah okay so
so what we do is is when you're actually
doing the energy budget computation then
you actually want to use the true area
of that slope okay but then when you
calculate the water that's being
produced you need to normalize it by the
projected area okay so so one example of
that is suppose you have a building and
you're using solar energy against the
side of that building in order to
produce something in the building you
know probably something you listen right
okay so in that case in terms of the
energy you want to use the full side of
that building but in terms of the
product that's coming out of it you
normalize that by the footprint of the
building okay so it's same same kind of
analogy here right okay we go through
the same thing with the long-wave
radiation but so we take what's measured
we take the air temperature and we
calculate a and atmospheric emissivity
I'm gonna go through this more rapidly
just then we go through
we I think the thing that is interesting
that we have to deal with here is we
have to account for the fact that some
of the radiation on a slope is some of
the long-wave radiation is coming from
the sky but some of it is coming from
the adjacent store terrain so we find so
I used to when when we did work in the
upper part of the Kings Canyon we would
approach it by skiing up the onion
Valley Road and then skiing over
Kearsarge pass and on the onion Valley
Road there was one spot where there was
a south-facing rock wall right next to
the road that went for about a hundred
meters and that was invariably a pain in
the neck because the road would be bare
and so you'd have to take your skis off
and if you got a big pack you know you
got to take your pack off in order to
bend over to take your skis off and so
it was always kind of a hassle to just
walk that hundred meters of road that
was entirely because this south-facing
rock wall was radiating toward the road
so in fact we account for that and we go
through these steps to end up with what
is the net long wave radiation and
usually the snow is going to be emitting
more than is coming from the atmosphere
so that those numbers are usually
negative okay okay and then now that
we've down scaled it now we have to do
this computation of the of the the
reconstruction and the way that works
and this an island called is a current
student of mine is sort of working on
this part of the problem she's also a
really serious climber and she's run off
to France with her boyfriend so I'm
trying to make sure she finishes her PhD
but if you have if let's say your whole
pixel is covered with snow so that
fractional snow cover is is one and then
in you
what we can do is we can estimate based
on all of these energy considerations
how much how much snow melted in that on
that day in that pixel and if the snow
all disappeared at the same time over
some number of days we could just back
calculate and figure out how much there
was so if I start out with all snow
cover and I'm calculating we're melting
10 millimetres a day and and you know in
20 days it's all gone well I can just do
the multiplication I know how how much
there was to start with but the fact
that there's that it's not uniform means
that so that night so that as it melt as
that fractional snow cover value is
changing then I can also estimate the
spatial heterogeneity of the snow in
that pixel in other words if if on one
day I'm I can melt you know ten
millimeters of snow water equivalent and
let's say five percent of the snow
covered disappears on that day then I
know that five percent of that pixel was
at that depth on you know the day before
so therefore we end up with a
reconstruction of the snow water
equivalent that is spatially
heterogeneous genius okay so
it it melts okay
so there's it takes some energy to bring
the snow to zero and that's called we
sometimes call that the cold content of
the snow that amount of energy is
actually pretty small because the
specific heat of ice is is only nineteen
hundred joules per kilogram per degree
whereas latent heat of fusion is three
hundred and thirty five thousand joules
per kilogram so so we do account for
that but the cold content is pretty
small compared to the energy need to
melt so you know we can account for it
we do it's if you get it wrong you're
probably okay you know but the second
part of your question is kind of
interesting and that is when the the
sunlight that melts snow penetrates into
the snowpack a little bit it's a
multiple scattering problem so the melt
is actually occurring over a depth not
not right at the surface okay so what
happens when it gets shallow well you do
reach a depth so we're around there
where you've got radiation that is
penetrating where you see this is the
albedo appears to drop but what is
really happening is the radiation is
penetrating all the way through to the
underlying soil warming the soil and
that therefore is causing the melt to
occur
well it no it melts depending on the
energy input all the other variables are
equal then disappear the law so it just
sort of disappears like um yeah so what
if we go back to those diagrams of the
snow pillow you see that melt curve is
you know syrtis the one thing you notice
is that it's steeper in the bigger year
and the reason for that is that when the
is that in the in the years where you
have a lot of snow a lot of times the
the maximum accumulation occurs later
and so the melt is occurring when the
temperatures are warmer and the days are
longer and the Sun is higher in the sky
and therefore it goes more quickly so so
yeah there's a lot to learn by looking
at this at the slope of the of the
melting end of the snow pillow okay so
how does it all do that's so what we've
done is we've we've gone through several
validation steps one is just comparing
it to the surface measurements so so far
in this model there's no surface
measurement in it it's it's it's
uncalibrated that is we're not tuning it
to any results and then so then we can
really use the surface data as a true
validation there it's not we're not
there's no circular reasoning involved
here right so there's two sets of data
that we've compared one is from the snow
pillows that I showed you and the other
is there's also measurements from snow
courses that occur that is because they
started trying to do this snowmelt
runoff forecasting in 1910 and you know
before you could operate something
electronically out in the wilderness and
transmit it back to anywhere so so the
initially up to about the 1970s most of
the reliance was based on people who
skied around with these tubes
in their pack and once a month they
would plunge they'd go to a set of sites
they plunge these tubes into the snow
pull it out way the tube tear the weight
mmm you've got the amount of snow and
this still goes on because you need to
make sure that the snow pillows are
working and it's a great job there's
there's very little turnover you know if
you want to get a job as a snow surveyor
you're gonna probably wait a little
while but the nice thing is that those
lines those are those are just the
one-to-one lines those are not a
regression line so looks pretty good and
also the distribution of errors is is
unbiased that is the error that peak of
the histogram is at zero and and you
always like to do that because you you
can deal with random error pretty well
dealing with biases is a problem and
also there's errors in these
measurements so they're you know the the
snow pillow is measuring over about an 8
by 10 foot area the pixel is you know at
500 meters so the snow course is
typically a transect right so you know
they try to do the best they can to make
that measurement representative of
what's around them but it's not always
easy so we've also looked at the at the
spatial variability that is by taking
you know something about the size of the
motifs pixel and and you know making
measurements all through it in a variety
of areas but what this
what this tells us is that we think we
gonna we're trying to validate this
method in the Sierra but then we would
like to to use it in in a place where
there's no measurements at the surface
or very few where the Taliban have
destroyed what surface infrastructure
used to exist and and yet it's a place
where we're making a lot of investments
in managing water and and where water
really means something to people okay
the other kind of validation is with the
input data that is and so these are the
top row is solar radiation and that
looks pretty good there's a lot of
stations that we measured there's 40 or
so stations up and up in the mountains a
little bit of more scatter with higher
elevations the long wave radiation
doesn't look as good a couple of things
though that first of all there are
really only three stations in the Sierra
that measure this reliably and it's a
tough thing to measure because your
instrument heats up so if you think of
an analogy with a laboratory measurement
what if you're trying to measure
something and your instrument is
emitting the same thing you're trying to
measure so there's there's issues with
temperature compensation of the
instrument so I don't know that this
error is entirely in the satellite
retrieval and then similarly we see a
model of that long wave radiation based
on air temperature and humidity
hmmm looks like I've reproduced this
graph I'm sorry
based on temperature and humidity and an
estimate of cloud cover and and again
that's underneath that value that the
satellite is telling us so so there's
error there and we're not quite sure
what that is okay so so that all looks
very good I can give you a pretty good
estimate of the spatial distribution of
the snow water equivalent you know that
near the peak of its accumulation but
that's not useful in a forecast right
because I've given you the answer you
know a couple of months after you would
have liked to have had it you know the
water is already in the stream you have
an idea already of how much water came
down so so we'd like to compare this to
two different methods that that operate
in real time or close to real time so
one of them is just an interpolation
based on the snow pillows so you know
what we've done is taken those snow
pilgrim measurements and we can do this
every day but we just take your favorite
GIS package and run the interpolation
through and of course if you do that
you'll spread snow out into the ocean
right so what we do is we do use the
remote sensing measurements to tell us
where that snow has to go to zero
because you know the problem is if you
have if you have a lot of snow if you
have a lot of data points none of them
are zero well there's no interpolation
method it's gonna get you to zero
anywhere in that so so that's one way of
getting the answer and the second way is
there's a numerical weather model that
runs called snow das the snow data
assimilation system that NOAA runs out
of the boulder office and that's based
on whatever they can get they use
satellite data they use surface
measurements they use numeric numerical
weather forecasting and and this is what
we get from the reconstruction method
and these are the the median values for
the seven-year period and that's the
period in which snow tas has been
running modis goes back to 2000 but and
so what you notice about this is there's
a lot more snow in the reconstruction
and so one of the questions is well is
that is that right and so what we've
done is to look at that and so in in
each of these 18 river basins these are
the areas in the sierra or the basins in
the sierra where they they estimate what
is called the full natural flow and what
that is is the flow in the river that
would be there if there weren't dams or
diversions so they take the actual flow
and then they they try to account for
storage and evaporation from the
reservoir and in some cases for
diversions that are happening above the
gauging station and so and then the
colors represent the three methods and
so by and large and and we just did this
as a rank correlation so you know are we
hitting the big years in the low years
and in 13 of the 18 basins the
reconstruction method is the best all
right and even in the places where it's
in even where it's in second place it's
pretty close whereas the other methods
have you know some years or some error
some basins where they don't do very
well so so that's that's good that's one
thing and then if we actually do the
volumetric comparison we also get a
result that's very useful and and what
it and and this is you know for for each
of the eight major drainages the one
thing you notice here is that the
the black line which is in the
reconstruction that is actually got more
snow in it than is coming out in the
river which is what you got to have
because you've got to have something
left over for you evaporation right so
the problem with with the other two
methods is that in some of the basins
there they're actually having less
volume of water in the snowpack than
it's coming out in the stream and that
that's you know physically not possible
right so so the fact is that the fact
that the
in we account for rain but generally in
you know this is the Sierra Nevada this
is not Washington so there so there's we
don't get much rain in the wind so these
are compared with the April through July
runoff and and there's not a lot of rain
in those in that period so so yeah the
rain is accounted for but but it's not
you still got this in other words we're
still getting enough water in the
reconstruction method so the fact that
the reconstruction is giving us a bigger
estimate turns out to be good right okay
and also if we look at the cumulative
probability statistics that by and large
are our r-squared values for the
reconstruction method are all pretty
good whereas some of the r-squared
values for the other measurements are
are not so good okay so how does so what
why am i you know spending my time as a
Microsoft intern right so let's this
this nice statement that came from Jim
Gray that in in working on these
complicated problems you're always going
to want to go from something that works
to something that works better that you
know there's a lot that goes into trying
to do this and if you try to make every
step you know it's completely right as
you would really be satisfied with
you'll never get to the end right so you
got to put some together but then what
that means is there's lots of things to
improve along the way and and that's
where you know expertise from other
people would help this is you know in
terms of the end to end problem you know
I know more about it than anybody does
but in terms of the steps along the way
that there's expertise out there perhaps
some of it in this room that would help
so let me go through some of the a few
of the examples
so one of them is this pattern
recognition problem in that how can we
use the reconstruction values to help us
improve the forecast and one of the
areas one of the possibilities is
looking at snow-covered area that tends
to differ a little bit between the
basins so this is the American River in
the wet year and the dry year there's a
lot more snow in the wet year but the
snow-covered area is not that much
greater whereas in the Kern same sort of
thing that wet year had snow in play a
lot of places that the dry year didn't
so
so certainly snow-covered area is a is a
gauge to how much snow there is but it's
it's not perfect and in fact what we did
is to look at and all of the basins in
the San Joaquin drainage looking at the
snow-covered area in relation to how
much snow volume snow there was both on
April 1st and on June 1st and notice
that in June that relationships a lot
tighter and I think you would expect
that because in in April there could be
a lot of snow the accumulation season is
just finished there may be occasional
storms going on so there's a lot of snow
that may or may not be very deep
whereas in June you know what's left was
pretty deep right and and in fact we see
that if we if we take the r-squared
between these relationships between the
snow-covered area and the snow water
equivalent you can see that that
r-squared climbs as we go through the
season so by the time we get to June
it's you know that snow-covered area is
a pretty good gauge of how much snow is
there but in April it's not so good
right or it's not as good so I think
there are other things that one can do
to explore the pattern and
okay so know there's an there's an
interesting algorithmic problem that
goes on in order to account for this
long wave radiation coming from the
terrain to really do it right I would
need to know the view shed for every
point okay
now we have an approximation that we use
but to really do it right I'd like to
know the view shed so I I ran a little
so I tried to do this for this this data
set covers the whole western United
States at 3 arcsecond resolution there's
720 million pixels here and you know I
run MATLAB and MATLAB has a few shed
algorithm and I was about to you know go
to sleep so I plugged in my laptop and I
picked a point right out here and said
calculate the view shed of that area and
that's just one point and and I woke up
the next morning it was still running
okay
now I looked at the code the nice thing
about MATLAB is the toolbox source code
is available and if I've looked at the
code first I probably wouldn't have done
this you know that any anything trying
to address this problem that starts out
you know for row equals one to number of
rows you know hits it's probably the
wrong I mean at least you could bound
the search radius you know based on
earth curvature or something like that
but but you need to fix this problem
algorithmically this is not something
that Moore's law yeah if I had seven
hundred twenty million processors I
could do it in two days right but I
don't have 700 million processors and
nobody's probably going to let me use
them for two days so yeah yeah here's
here's an example here it
I need to qualify the answer to that the
answer is yes so here's the area in the
12
we Basin where the snow pillow is and
that's the view shed for that point but
but this is not it's it's much smaller
than the view shed that you would see
standing up so it's what you would see
in the view shed if you're lying on the
ground looking up okay but yeah it's
it's everything you could see so
algorithmically there's a couple of
things one is I want the view shed for
every point and so it's not just a
problem of getting a fast calculation
for doing it for one point okay so are
there good ways to bound the search
radius for example and are there good
ways of taking advantage of reciprocity
that is if I'm in your view shed well
you're in my view shed right so and I've
looked through the literature on this
and I can't really find anybody that's
doing a very good job of this so now
what we've done is we've leaf back in
1981 I actually figured out a way to get
the horizons in order in time and and
that completely bound to your search
radius so I do have a partial approach
to this problem if somebody wants to
work on it is I didn't tell you exactly
what the search area you need to
consider right okay there's a remote
sensing problem that that is also kind
of a generalized image processing
problem and that is that the snow cloud
discrimination is not completely solved
if you've got thick clouds so here's
this is the Landsat image these are the
visible bands but this includes a band
out in the shortwave infrared where
clouds are bright and snow is dark and
yeah the clouds pop right out at you but
these are cumulus clouds they're thick
here's one in the Hindu Kush that's a
little more problematic these are some
data dropouts
and what you see is
even with different combinations of
spectral bands it's hard to distinguish
what's snow and what's cloud and in but
you can kind of tell with your eye
alright so I think what a general
ization of this problem that is kind of
would be interesting for someone to work
on work on is is generally when I when I
read the image processing literature
there's papers that deal with shapes and
there's papers that deal with spectra
and not many deal with both so to me
this is kind of a combination of a shape
recognition problem and a spectral
recognition problem and so there's
there's fruit to do things there there's
data quality problems in East science so
the 2000 snow the the snow pillow of a
Dana I showed you the data for well I'm
not sure how that maybe those 2007
measurements were we're a little bit
high
Jessica Lundqvist who's a faculty member
at the University of Washington she was
working in this area and the that the
Dana Meadows pillow wasn't corresponding
very well to what was she was seeing in
the other pillows so she went to it and
there's a tiny tree growing in it okay
and when she took the tree out the snow
water equivalent dropped by 12 inches
okay okay and then in the another remote
sensing problem is finding snow in the
forests so what we do with this
fractional snow cover is we we divide it
by one minus the fractional vegetation
cover so it kind of helps us estimate
what snow is into in the trees and that
works pretty well up to about seventy
five eighty percent canopy cover
and the way we kind of know this is a
student of Jessica's and the student of
mine got together and carried out this
very interesting experiment they they
buried a lot of these little temperature
sensors all over the place and then that
you can tell from the daily temperature
record whether it's snow on it or not
and so they have a this is real ground
truth and for the these these images are
arranged in order of increasing canopy
cover and the squares on them represent
the size of a motifs pixel and so what
you see is if you look at the comparison
between what we see from satellite and
what we measure on the ground is it's
not bad until you get down to this here
this pixel here now we're missing a lot
of snow under the forest when we can't
see through the trees right okay there
are other examples the first one is I
think the more generic and that applies
to all of these science and that is that
we typically use the kinds of software
that you would expect for data
management like sequel server or some
people use Excel but by and large those
aren't the tools that we use to analyze
data and so having having these things
talk together is a real problem the the
sequel server file table is really
bailed me out just I just learned about
it but you know we we sometime just run
programs when I do a year's worth of
analysis I could open two thousand image
files and keeping track of those has
been problematic because you know
stuffing them out on the file system and
then putting an entry into the database
it's really easy to get those out of
sync you know but sequel server file
table just handles that so
a more scientific issue is this one of
error propagation when you're doing
something that's this of this complexity
there's errors all along the way and and
how do they affect the final result
improve presentation Alex if he's
finished working is gotten integration
with layer escape and then you know
you're good idea goes here so this is
what the Hindukush looks like this is
compared to anything in the western US
this it's a really broad mountain range
and even at 20,000 feet you know all you
can see in every direction are more
mountains anyway thanks very much
Jonathan's here he's been waiting for
this part oh okay
so so we're you know everything we've
done so far is in an area that's that's
not all that big the Sierra
so we're it is big enough that we have
to worry about other earth curvature in
terms of the radiation budget so I
should have a more precise answer that
question than I do
you know we have we have machines that
we have a multi-core machine and then we
have a cluster that we're running on you
know we can keep up with the data flow
we can we can do in a week we can do
about the ten-year data record okay but
it
it's let's see I think there are 64
MATLAB nodes on it I think it's a
hundred 96 nodes on the cluster but the
the MATLAB license is just 16 no I'm
actually trying to I'm actually waiting
for some software that the MSR MATLAB
license doesn't have yet but we've
ordered and so I'm I plan to do some
experiments on the the MATLAB DCs that
we've got in the building here but I
just there's there's one major software
package that the mapping tool box thing
that we're missing I you know I could
probably answer that question more
precisely just doing some timing
statistics but you know we it's an
answerable question I just don't have it
off the top of my yeah John the heat
from your computation melts the snow
yeah we the one thing I did discover and
doing some timing test is that the the
laptop runs slower when it's not when
it's on battery power and you know my my
solution to the to the horizon problem
which I thought was order in you know I
I was doing some timing statistics and
and it wasn't coming out to be order in
like God you know I'm comparing of
things that I'd run here and things that
I'd running home and fortunately I
thought about it when I came back to the
office here I I said me how to plug this
in let's see if it works faster and it
did it was about 50 percent faster
running on on the on the grid power
let's see okay so so one thing we've
done with this is Alex's has put an
interface with Bing Maps so and this I
think is pretty useful in general and
that this is a way to get geo TIFF
images into Bing Maps and so he's got
things where you can you can adjust the
scale range if you want to wipe out some
of the lower elevations or if you want
to see you know like what's under this
place that's that's getting a lot of
snow then he's got an opacity slider you
can see the truck he is getting dumped
on and and so forth so and then you can
you know switch back with another date
and and if you you know if you prepare
ahead of time you can cache these and so
this the switching back and forth runs
pretty quickly and then if you want you
can switch to one of the other methods
so this is the maximum the the maximum
water equivalent in each of those years
okay so we're taking this well not only
that but it varies with the pixel so so
the date at which the maximum occurred
will be different for each of the of the
grid cells so we're we're going through
and and picking out what that maximum is
and then carrying that through to to
have a single image now what we can do
is
this this is for a single day so and so
what what we've done is we've you know
loaded lots of dates in here and and
again because these data are not cached
they it takes a while for them to show
up but but you know this is this is
something that you know dan and I are
gonna go talk to the Bing Maps products
guys this is well I I think the snow
problem is interesting but the theythey
the fact that you can take imagery that
you yourself could supply and put into
this is is something that you know even
I I know an MSR you always worry about
what the product guys think but this
would be a I think a useful addition to
to what the tool can do yeah just used
by unity and the research community
organizing
well we're we're giving it away well and
the reason is it's it's mostly been
government funding so so we you know we
can't really sell the forecasts but but
we are in discussions with the you know
people like the California snow survey
because they you know they would like to
reduce the they would like to reduce the
tails of the error distribution you know
a I start a 10 percent error they can
they can live with but having the
occasional year when you're way off
would really be bad and then I've
actually got a project with the army
cold regions lab to try to do this in
Afghanistan and so we're you know we're
cranking up a system at JPL to produce
the modis images and then you know I
hope to run some of that here in the
next month so I know most of the interns
are are going home in a week or two and
they're panicked but I'm I'm here till
the 14th of September and and also I was
I think at least perceptive enough to
panic the first week I got here
is there any only in some of the because
this this was a pretty light year so in
certainly in the previous year there was
still snow well in the previous year we
were we were skiing through the you know
well into July so there is snow but it's
you know it's it's it's mostly in very
yeah yes part but yeah there there's in
the well there is some permanent snow in
this here
if you know you know it's not actually
that's my question
yeah it is because it's a height of
summer didn't these west of the Sierras
there are peaks isolated places that
never melt
oh right yeah so the question of
permanent chemo right exactly is
something I've never discussed well it's
it's discussed a lot but it's more
discussed in the Himalayan context
because the the fact of the shrinking
glaciers that's the the issue is to what
extent is the glacier melt an important
component of the water supply versus the
seasonal snow melt and and I think you
know I I think people who have thought
about that have a gut feel about what
the answer to that question is I don't
know that anybody's really well people
are working on that partly using say
isotope tracing to figure out where the
water is coming from would you describe
so far let's see
not distinguished into the seem to just
cover every we we would one of the
things we have to do in the Hindukush is
is have glaciers as a separate and
member that because because that in that
case the water those don't go away at
the end of the season well we get it
here we get a lot of those oh yeah yeah
we we get at our instrument site we lose
20 to 30 percent of the snow from
sublimation yeah it yeah yeah yeah
that's in the model yeah we run an
energy balance model so it if you get
into the forest where there's no wind
then you you get very little during the
winter but but out on the open you know
when when they when it's dry and windy a
lot of the snow can go away you can we
where we see it at our instrument site
is we have lysa meters underneath the
the snowpack and we see periods when the
when the amount of snow is is dropping
but we're not seeing any water at the
bottom
and also an even in the Himalaya you you
can get melt at temperatures where air
temperatures below zero you can wear air
temperatures below zero you get an
energy absorption you get it down in the
snowpack where it's there they're sort
of a solid-state greenhouse effect you
can also freeze water when they are
temperatures above zero just you know
because the the surface temperature is
not necessarily the same as the air
temperature so for example on very calm
nights the surface can get colder than
the air and and they used to make ice in
India by this mecca shallow pans of
water and and they would produce ice
even on nights that the air temperature
never got below zero
yeah well thank you all and yeah so
anybody who wants to come talk about
this or have ideas I'd certainly be
happy to to talk
we're also I think I've talked with Yann
about you know how to incorporate some
of this thinking into the open data open
science stuff and you know and one of
the issues of is there a is there an
effective way to kind of put the problem
out there and and then have a mechanism
for ways that people could could
interact you know kind of like the
Casper off against the world chess match
anyway
anyway thanks all for coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>