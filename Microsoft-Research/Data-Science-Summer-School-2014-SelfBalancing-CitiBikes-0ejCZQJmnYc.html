<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Data Science Summer School 2014 - Self-Balancing CitiBikes | Coder Coacher - Coaching Coders</title><meta content="Data Science Summer School 2014 - Self-Balancing CitiBikes - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Data Science Summer School 2014 - Self-Balancing CitiBikes</b></h2><h5 class="post__date">2016-06-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0ejCZQJmnYc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">each year microsoft research helps
hundreds of influential speakers from
around the world including leading
scientists renowned experts in
technology book authors and leading
academics and makes videos of these
lectures freely available
you
alright so without further ado we're
going to go to the second project which
is about Citi bike's called self
balancing bags i'm just going to turn it
over to Donal Hanson is going to kick it
off there you go
good evening so again my name is donaill
Hansen and the name of our project is
self balancing bikes and bike seems so
over the past couple of years bike
sharing programs have surged in
popularity all over the globe with a lot
of bikes hearing schemes popping up in
Europe and a lot in the United States
and if you see this blue dot here this
is this bike sharing scheme that we're
going to be talking about today which is
city bike now double things about Citi
bike before we start city bike open may
2013 and even though it's about a year
old it's quickly become the largest bike
sharing scheme in the United States has
over 9000 90,000 annual users six
thousand bikes and over twenty to forty
thousand trips per day so this is being
heavily used by people so back to bike
schemes so most bike seams are located
in cities and these cities have a usual
pattern and how they're laid out they
have they have populated business areas
throughout the city and then populated
residential areas so on a normal day
right people who live in the city are
going to be going traveling to the
business areas in the morning and at
night they're going to go from those
business areas back into the residential
areas and we're seeing that with that
happens with bike seems as well so these
riders are taking bikes from these
residential areas and moving all of them
to the business areas and at the end of
the day they take the bikes and they
move them all back to the residential
areas now this is good but this creates
a load imbalance problem and basically
you're going to see a lot of stations
that are empty at certain times and at
the same time maybe a couple blocks away
there's going to be stations that are
completely full so this is a problem
that all bikes bikes teams face now what
city bikes doing to try to fix this
problem is they're taking vans and
they're transporting bikes to empty
stations so basically here's an example
let's say in Midtown we have a station
that has about you know that's
completely full and a couple blocks away
we have a station that's empty what
devans do is they take bikes from these
full stations and move them over to the
empty stations to try to help ease the
demand in both stations and this varies
on how popular the station is so for
every
and the 20 writer trips or is one brand
transport and which and the transport
the transports amount to ten to fifteen
percent of their gross revenue which is
a lot of a heavy cost on the city by
program and basically this is very
costly for city bike and they're trying
to look into new ways to help solve this
problem without you know pouring out at
more money so one of the things we try
to look at is can we use writers because
there's so many writers can we use
writers to help naturally balanced the
system and with small changes in the
writers rupes routes help so again this
would be basically looking at how well
you know these fans are doing right now
and seeing could this help us
potentially so before we went into the
analysis we need to have some data so we
got our data from two main places the
first was from city bikes website and
they give a system data so you can see
here they give us trips so free trip we
have the bike ID so which bike it was
the start time start station star
station and station and some more
information and they have this data from
July 2013 to May 2014 and this basically
gives us rider movement so we're knowing
where the bikes are going where they're
coming and also we got data from ape
Stanway who's a data engineer and he
collected data from Citi bike over the
process of our process of a year a
couple months and basically at each
moment he took a snapshot of how many
bikes were at a station and how many
docs were available to park the bike at
those stations and that basically gives
us an idea of how well each station is
doing so how many bikes riding station
so all this data gives us a complete
view with the network and how well city
bike is doing in general so using that
we we made some basic plot to see how
the city city bike is working so over
here we have user usage patterns over
the day on the x-axis we have time so
over like a 24 hour interval and on the
y axis we have the number of trips so
the red line represents the weekdays and
the green line represents the weekends
as you can see the number of trips
during the weekday peaks at certain
times between the rush hour times six
six am-10 a.m. when people are going to
work
and it peaks again at the end of the day
at between 4pm and 8am when people are
leaving work and this makes sense so but
if you if you look at the weekends the
weekends are at les is going on because
they're more of joy rides and things
like that so for our analysis we're
going to be analyzing the weekdays
because that's those are the times we
actually care about like the demand in
the system and last thing we looked at
the neck mixing they analyzed with the
trip length just looking at how long
each trip is is between typical 15 in 30
city blocks are seeing like how far
they're going an average so something we
as I look at and to talk about this
system health and how well station is
doing is my colleague jahaziel
hello my name is jasmine and i'll be
talking to you about the status of the
current system where we can see problems
and possibly diagnose some solutions so
in our data we had a value called
availability for each station at certain
times and with this toll this is the
number of bikes that were parked at a
certain station and what we did was we
averaged this availability / station for
every hour in a day over all days for
each hour and what we can see here in
this first panel is during at 6am before
the morning rush hour we have the
average distribution of bikes at 6am
overall days and we can see that there
is a pretty high concentration around
here in Greenwich Village as well as I
mean sorry east village as well as
Greenwich Village and also residential
areas around Barclay center and this
tells us that ok people are about to go
to work some of them might still be
sleeping the bikes are at part around
residential areas so users can use them
to go to work and here at 3pm we have
the average availability and we see that
there is a higher concentration around
here fifth sixth seventh avenues
business areas downtown around Barclay
center and what that tells us is that ok
users are getting to their workplaces
and their parking there and they're
leaving their bikes there and then we
see here at 8pm after the evening rush
hour we see again a concentration back
to residential areas here and this is
pretty predictable throughout the day
this is averaged over periods of the day
and we can see that most of the users
are commuters in fact they are most of
the users are commuters and they have
pretty predictable uses usage patterns
now we have this animation here showing
us the changes over the course of a day
averaging per hour over all days in the
data the availability so again we see
this pattern we
err in the afternoon we have a
concentration here in the business areas
and at night we see concentration back
in residential and in the morning until
the rush hour now we wanted to kind of
have an idea of the percentage full that
a station was or its fullness so what we
did was is for each station at each time
interval that we had we obtained that
percentage by dividing the available
bikes at a station by its total capacity
and using this percentage we could
diagnose the station as either or label
a station as either congested or starved
and a station was congested if its
percentage full was more than eighty
percent so if it was more than eighty
percent full and it was starved if it
was less than twenty percent full so
using this these are valuable metrics to
then assess two possible problems in our
in the system where if a station is
congested there are too many bikes at
that station and it may be possibly hard
for multiple users to park their bikes
at those stations and if a station is
starved there are too few bikes and
users may not be able to store trips at
those stations and again we have over
the course of a day average for each
hour over all the days in our data the
average number of starved stations and
the average number of congested stations
in our data as we see starvation is much
more common it's around forty percent
almost fifty percent and congestion
peaks at about thirteen percent of
twelve percent so an interesting number
here there are 57 bikes for every 100
docks if the system was balanced so
clearly we see that that's not the case
we see that if that if this was true in
our case it all stations would be 57%
full and the system would tend more
toward congestion because a 57 is closer
to 80 then to twenty percent but we see
that that's not the case that starvation
is very huge in our system and this can
be attributed
Ryder flow obviously our system is not
balanced so to talk about vehicle
transports my colleague Frankie
Rodriguez
okay thank you so as was mentioned
before city bikers has a scheme where
they have workers and bands drive around
and they pick up bikes and they place
them where the demand is needed now
citibike publishes a monthly report
where they have totals of how many bikes
they rebalance every single month but
they do not provide information on where
they pick the bike zone how many they
picked up and where and what time they
pick them up so in order to try to find
these these numbers we had to dig into
the data and find them ourselves so we
took all of the data and we ordered it
by looking at each individual bicycle
throughout all time and finding any
inconsistencies in the data and an
example would be something like this in
this case we're looking at bike I like a
bike I da and we're following it
throughout the day and we see it starts
I West 41st Broadway it ends I was 50
first and sixth Avenue then it starts at
West 51st and sixth Avenue it ends at
was twenty first and sixth and then
suddenly it starts at West 41st and
broadway and there's no indication of
how it got there at all in the data and
then it continues as normal going
through the original cycle every time we
see something like this we know that
somebody had to move in manually because
there is no record of anybody swiping
their card and getting the bicycle off
the rack so using this data we take it
for every single bicycle for every
single trip there all time and we can
total those numbers to give us an
estimate of how many bikes they're
transporting but now we actually have
the time and where and when they are
being taken and what numbers so before
we go to the next slide we do notice
that this is imperfect as this will also
include any attempts that somebody tried
to lock their bicycle and it did not
lock correctly so it never somebody
could have pulled it out it also
includes bicycles that were taken for
reparation and theft in general so using
this data we can now make a plot where
we have the maps of where the bicycles
are being picked up and where they are
being dropped off so as you can see
bicycles are being picked up everywhere
throughout the city the bigger the
circle and the more red means more
bicycles are taken by workers and though
it's bigger same thing for drop-off
so bicycles are being taken everywhere
throughout the island of Manhattan
especially you can see that bicycles
being taken a lot in Union Square people
like to take their bicycle to Union and
i'll just drop it off there you guys to
hang around and then workers have to go
and pick them up and then they also drop
them off at the major transit hubs right
here where Port Authority is Grand
Central Station Times Square on bicycles
are also being picked up a lot of penn
station and if you notice they're
dropped off much less around the
outskirts where as they are picked up a
lot more around the outskirts of
manhattan now notice that there are two
big circles in the center and that means
that workers are dropping off bicycles
there and picking them up there that
makes no sense but if you consider that
these are at different times throughout
the day then that explains why this is
happening now this gives you an overall
picture for the entire transportation
scheme but we wanted to go a little bit
deeper because these are for the entire
island we want to define for each
individual station what happens so
looking at that we were able to find
patterns throughout each individual
station here we have four of the most
well the four types of stations that we
were able to find Broadway and 41st is
an example of a station that has a lot
of drop offs in the evening after the
rush 51st and a thousand six that when
you as an example where there's a lot of
pickups in the morning 41st then eighth
Avenue Times Square is where you see the
two giant dots on us on the map before
where they have a lot of pickups and the
evening and a lot of Dropbox in the
afternoon and then all the other most of
the other stations I mean the majority
of stations look something like this
where they have a theory now and then
nothing too big now look at if you look
at these two on the left please notice
that what's 41st and broadway and west
41st in eighth Avenue are about two
blocks away from each other yet at the
same time bicycles are being picked up a
lot and dropped off a lot at the same
time within each other we're going to
continue with West 41st in a bit no
what's 51st where bikes are being
dropped off at this time so here we have
West 41st and broadway and we try to
calculate we try to calculate the impact
that this is having in the system we
want to fix the system so we want to see
how much can we fix it compared to the
vans so what we did is we
had some sort of simulated world where
we say let's pretend none of that
happened workers didn't exist fans that
exist we just have people and nothing
else so looking at the actual data we
have West 41st and broadway and they
have 10 bicycle vailable then people
keep departing from there and suddenly
there's 22 trips now we saw in the
previous slides that workers drop off a
lot of bikes around 4 10pm from 46 but
what if they weren't there well we would
have 10 then 9 and it slowly decreases
on Tori reaches zero and nobody is going
to go and manually pick up these bikes
so using that we can count how many
times a trip would have happened if it
no how many times somebody would have
wanted to start a trip at an empty
station and how many times somebody
would have wanted to end the trip out of
full station and we can tag these
stations like this whenever we reach
zero for capacity we can tag them and we
can count how many times this happens
throughout the system and compare that
rate for the overall amount of trips
what this looks like is that when you
take that rut estimate we have that five
point six percent of all the trips that
we won that one of them well all those
failures account for five point six
percent of trips so that means that if
you wanted to take a trip and there were
no events five percent of your chairs
would have failed also it also puts into
account how much effect the vans are
having on the system the band's
rebalance about ten percent of all the
bicycles in total and half of those each
serve one station that one trip that
would have not happened otherwise what
we are not taking into account is that
people would obviously know that the
station is full so they were not try to
start a trip there it would go somewhere
else also city bike does not provide how
many trips failed anyways because right
now if you wanted to go outside and take
a trip I at the Chelsea station across
the street but most likely be empty or
four depending what you want to do and
you will not be able to take a trip or
if you want to drop off a bite there and
it's full you can actually swiping your
card and Citi bike will give you 15
extra minutes to go find another station
and I've citibike provided that data for
us we would be able to estimate how much
this is having an effect versus their
system so this is great but we can't
just ignore the fact that we can just
take out vans and that's it it solves a
problem what if we had a system where we
had no
vans and as was mentioned before
stations are everywhere throughout the
city they're very close in proximity
what if we had a system where there is
no vents and we can still have a lower
rate of congestion and in order to do
that we're going to have my colleague
here Brianna regione she's going to talk
about our rerouting scheme
alright thank you for a very thorough
introduction yeah so as Frankie said
before we did our first simulation
assuming that there were no vans in the
system and now we're going to do a
simulation that attempts to rebalance
the system using writer rerouting okay
so what was our potential for local
rebalancing well according to our
statistics the median distance to the
nearest station is 218 meters and by
that same token the median distance to
the third nearest station is 311 meters
so what does that mean that basically
means that ninety-one percent of all the
stations have another station within 300
meters now that's about the same length
as one new york city avenue so clearly
these stations are not very far apart so
if we can find the availability and the
differences between the availability at
any given time we might be able to have
some serious potential for local
rebalancing right so that's exactly what
we did right here on our x-axis is every
stations availability and on our y-axis
we called our average neighbors
availability now what this means
essentially is that for any different
station we took the three nearest
stations and averaged their availability
into one exact value and then plot it on
the chart right here this chart depicts
the system at 6pm why do we choose 6pm
well we chose it because it's a commuter
time people are getting off work they're
going home and it's going to be able to
depict the system very clearly
especially with the imbalances right so
what does this chart tell us well if the
dots were along the 45 degree line that
would indicate that there wasn't a whole
lot of potential for local rebalancing
because the x-axis for any given station
the closest stations have about the same
availability and there's not a whole lot
that we can do but we don't see that
here what we're seeing is persistent
differences that exist between does any
given station and its neighbors I'm
going to pick out a few outliers here
down here we have FDR Drive in East 35th
which is clearly a relatively full
around 6pm while its neighbors have a
much much lower availability right and
the converse situation for house and
Hudson right here so this is what we did
with our simulation model right here is
a screenshot of the city bike app and
each little blue raindrop figure
indicates a station and then the dark
blue line indicates the level of
availability of that
so the higher the blue line is the more
bikes are there and the lower the blue
line is the less bikes are there so our
simulation did two things the first
thing it did was it redirected
departures at starved stations to the
nearby station with the most available
bikes so I'm going to give an example
right here somebody wants to go from
Times Square around here down to this
station right here but we see that this
time square station is pretty empty
right there's not a whole lot of bikes
there and it would actually imbalance
the system if somebody were to take a
bike out so what we do instead is we see
that its neighbouring station right here
is relatively full by comparison so we
move the commuter over about an Avenue
again and take them to their destination
conversely we do the same with arrival
so we redirect the arrivals at congested
stations to the nearby station with the
most available talks so again we the
commuters taking their station or their
trip from right here and they're trying
to go here but we see that the station
down here it's blue so it's almost full
they're trying to take the last dock in
that station and we don't want that
because again that's going to provide
more imbalance to the system but we see
about Avenue away again this station is
relatively empty so we're just going to
rear out them about about an avenue away
so loes the data from that well we're
going to compare our two simulations so
on the right here you see the no van
simulation and it's levels of starvation
and congestion and then on the left here
you see our no vans plus rerouting
simulation that we just implemented and
you can see for both the lines decrease
but you see that local rerouting
drastically reduces congestion on
average but global patterns still drive
most of starvation because that's simply
just a writer flow that's how the system
works alright so let's compare trip
failures now well we see that vans
currently account for ten to fifteen
percent of revenue and as Frankie said
before we don't have the data saying you
know how many people wanted to take a
trip and could not do that so we can't
we can't measure that but if we
eliminate vans we did see that there are
five point six percent of trips that are
failed trips right but with our
algorithm that we've implemented we've
reduced the percentage to 0.8 percent
and we're assuming that our algorithm is
a free algorithm because we're assuming
that these people are ready and able and
willing rather to go about an Avenue out
of
way in order to do this and rebalance
the system right so what are our key
takeaways well what does this mean and
how can we change bike sharing schemes
not just for New York City but
potentially for other countries as well
well we see that the city bike system
specifically suffers from both global
and local imbalances right local we can
deal with global imbalances our global
imbalances we see that local rerouting
with our simple greedy algorithm appears
to be a promising way to improve our
bike availability we saw that before and
we're seeing that incentives for
following reroutes and possible app
development could encourage these kind
of adoption so we said before that
people might not be willing to obviously
go an Avenue out of their way so we
would have to introduce some kind of
incentive scheme so possibly giving
people a point system within city bike
saying hey if you take this trip from
point A to point B during any given time
we'll give you points or we'll give you
this free trip or we'll give you some
kind of incentive in order to promote
that kind of behavior all right well
thank you for listening to our
presentation if you have any questions
feel free to ask them at this time thank
you so much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>