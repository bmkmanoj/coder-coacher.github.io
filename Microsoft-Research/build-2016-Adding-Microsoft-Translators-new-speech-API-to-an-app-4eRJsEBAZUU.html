<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>//build/ 2016: Adding Microsoft Translator’s new speech API to an app | Coder Coacher - Coaching Coders</title><meta content="//build/ 2016: Adding Microsoft Translator’s new speech API to an app - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>//build/ 2016: Adding Microsoft Translator’s new speech API to an app</b></h2><h5 class="post__date">2016-04-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4eRJsEBAZUU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well sure I thought that would be
appropriate for this part of the the
session where we talked about translator
okay so now let's start to talk about
translator as part of this session there
are two parts of this that we're going
to be talking about the first part is
translating speech but actually that's
going to be the second part and this is
a new API which many of you may have
already used inadvertently by using
Skype translator has anyone seen or used
Skype translator for language to
language discussion okay a few people in
the room so that's great the rest of you
need to go out and use it as well so the
the first thing that I'm actually going
to talk about in the show isn't
necessarily new but it's still very
relevant for the the kind of
applications that are people are
building day to day how many of you have
used Facebook or Twitter or any of these
other Apple applications that might be
very social and discussion based okay
I'm pretty sure in most of these kind of
applications you'd have seen people that
are on your friends list or that you
subscribe to where they've posted
something in a different language and
you've seen the translate tag next to it
so that you can translate that text in
something that you can read so we have a
translator API it's been around for a
little while it is probably the best
translation model that exists because it
exists at multiple levels the first of
which is simply the ability for you
within your application to make a call
to the API and translate from and to any
of the 50 languages that are supported
there is also highly customizable
translation model here we have something
called translator hub this gives you the
ability to do one of two things the
first of which is if you're working in a
field that has fairly technical content
or content that is fixed into a into a
field like medical law or something
similar you can train a translation
model based on content that is specific
to the domain that you're working in
third part of this is the ability for
you to work with humans to enhance or
improve the translation model that's
been created so you get much better
results out of the translation there are
a number of interfaces on to this API
including Ajax rest and so what we can
see here is a list of the various api's
that are supported translates the
obvious one detect is kind of
interesting and we're going to be using
this as part of the API set that we're
going to be calling in the application
in just a second
so what you can see is that you know
there's obviously a number of different
API is that you can use inside of your
application to support translation so
what we're going to be doing is
enhancing the application that John and
Ryan have already shown you this is the
application here what I'm going to do is
just launch the application so you can
see what the application looks like with
some of the translation features built
in what you'll see across the top of the
screen is this fr inside the combo box
and if I drop this down this has been
populated by the list of supported
translation languages from the
translator API so there are two
different API is that I can call here
one of which is to get the short form
version of all of the supported
languages and the second is to make it
call to get the long form version like
English or French or German or whatever
else
so I've populated this list when the
application initializes to build in that
list of supported languages next to that
is a translate button in a second we'll
dig into the code and find out what's
behind that so what's gonna happen here
is I'm going to search for something
using the excellent work that John and
Ryan have already put into the
application thank you and then what
we're going to do is real time translate
the text of the results that we get back
into a language that we choose from the
list so I'll show you this working first
and then we'll dig into the code behind
to find out just how easy it is for you
to hook this up inside your application
there's something to note about
translation though translation isn't
straightforward right many languages
have
words that are you know the other way
around we'll switch genders or whatever
else right so when you think about
translation it's not purely word for
word for word for word
there's also understanding an intent
that forms that as well if you were to
ask two professional translators to
translate the exact same document the
chances are you'll end up with different
results from each of them right so this
it just gives you some impression of how
hard this kind of stuff is okay so let's
i'll show you this working first and
then we'll go take a look at the code so
let's search on something that i think
is fairly relevant right now and that
will be something like boaty mcboatface
is that a good term to search for yes
okay good right so I'm gonna hit search
and yes there we are we get the results
back so that's a ticking Johns box there
because we've got the results back for
John right and I should be able to also
click into News and and get a list of
trending or you know news articles as
well okay so why don't we just do the
translation I'm gonna hit the translate
button and what this is gonna do was
we'll see the code behind in just a
second but what this is going to do is
reach out to the translation service
it's going to detect the language of
each of the items in the list of
returned results for search and news and
it will translate only the subtext here
not the title right and the reason why
I'm doing that is to show that the topic
itself is remaining the same we could
obviously translate the title as well
okay just to show you that that's also
being applied on to News I'll click news
and you can see that you know that's
there as well right amazing right
but wait okay let's go take a look at
some of the code okay so in the
application we've also got this
translate button if I go and have a look
at the code that sits behind this what
we see in here is that I'm getting the
list of the count of the number of items
that are in the web results pivot and
what I'm doing is setting the snippet
which is the subtext within that article
to a call in to a class that's part of
the application called translator we'll
take a look at how that gets initialized
and how the API is used in just a second
translator doc translate and then we
pass in the initial language of the
initial text for that article followed
by the language that we want to
translate that article to right so you
can think about this as being a string
result the string input and the language
choices you want to translate to you can
actually pass in to and from but we're
actually using a different API we're
using an API inside of the translate
class to detect the source language so
we don't need to pass to and from into
the translate API does that make sense
okay good right
so that's what we're doing on the web
results but we're actually replicating
the exact same thing for the big news
trending news results as well right so
it's the exact same code what you'll
notice is that there is a difference
here between snippet for web results and
description for the trending news
results and that's the only real change
between these two things the underlying
code is exactly the same right so let's
go take a look at the translator class
because this is where the the translator
work is happening so very much like the
the work that John was showing you
earlier we do need an authentication
token we need to generate that every 10
minutes
we've got code samples on line on MSDN
that show you how to do this
I think we're also going to post this
sample online to show you how to use
both the Bing the Lewis and and actually
the translator API so you can you can
pick this up and see how that works okay
so here's the Translate call what are we
doing we're making sure that the length
of the input string is more than zero
great we're then making a call to detect
language which we'll take a look at in a
second and we're using the return from
that is the from language and taking the
to language which is passed in from that
combo box within the application so
that's pretty pretty straightforward
we URI escape the input string that we
want to translate because obviously
there will be things like spaces and
exclamation points and these kind of
things in the string that we want to
translate and then we make an HTTP rest
call out to the translator service
passing the authentication token in as
part of the call when we get the results
back we simply walk the exit XML data
that we get returned pull out the string
from that and then return that back to
the user so that's pretty
straightforward for initialization of
the class we pass in the authentication
keys that are required to build the
token and then go and generate the token
there's a fair amount of work in there
it's pretty straightforward it's
documented I missed the end so I'm not
actually going to spend any time walking
through that part of it in order to
detect the language this code should
look very similar and obviously we're
using this as part of the translate
function we're passing in the string
we're getting the the language back
we're calling this basically the same
endpoint we're passing in the API that
we're interested in which is shown here
which is detect we're passing in the
escaped string passing in the access
token and then making the call parsing
the XML and then passing the results
back this is the call to get all the
languages this returns a list of
languages that we then use to populate
the combo box back in the application
again this is fairly straightforward we
make a call to this API this water
an XML document to us and all we need to
do is basically just read through that
XML document and add each of the items
into a list that we then returned back
to the user so that's pretty much it
making making use of the translator API
is is pretty straightforward you can see
just how easy it is to add support for
translation into your application right
great okay so that's the translation
part who would like to see a technology
that we've released 200 years before it
should have been released not a single
hand window I can't believe it
well thanks everybody for coming I guess
that's the end of the session okay so
the thing that I'm going to show you now
is the real-time speech translation
api's I'm sure every single one of you
have seen Star Trek and the universal
translator right nobody nobody watch
Star Trek
you're kidding I thought I thought that
would developers in the audience okay so
the technology that we're going to show
you is the universal translator the
exact same technology that's built into
Skype translator but available to you as
an API for you to use inside of your
applications today so that's pretty neat
why might you use that okay we did the
demo so why might you use that so there
are a couple of things to think about
here when you think about speech-to-text
right you say some words that gets
translated into a set of results
speech-to-text has been around for a
little while
but when you think about speech to text
is very commonly being used mostly for
commands you know say something get a
result back do something the API that we
we are releasing now that is available
to you now is real-time conversational
speech support so what do you find when
somebody is talking somebody else may be
in a Skype call
anything else that what they're saying
is going to be much longer than the
typical kind of speech-to-text type and
there's obviously going to be a lot of
meaning and intent that is part of what
what it is that they're saying so the
way the API is built there are a number
of different pieces to it the first of
which is we have a WebSocket endpoint
for you to stream PCM audio data to so
as you're speaking that audio stream
will be sent on the WebSocket for the
real-time translation service at the
back end to start processing over that
data right on the receiving side you get
to return streams coming back the first
of which is a text-based stream and this
will fire for one of two different
result sets the first one is partial
results so if I'm saying something like
this is a sentence that needs
translation as I'm saying that sentence
I'll be starting to get partial results
back from the translation service right
so I'll get the text stream coming back
that I could potentially show to the
person that wants to see the translation
of that so they get a feel for what the
conversation is saying even before the
final results are available we also
strip out as you're speaking some of the
most common kind of pauses and arms and
hours and gaps that might be in the
sentence that's being spoken right so
you just get the the rectified text
being sent back not only do we give you
partial results but we also give you
full results as well or final results so
within your your first callback you can
switch on both partial and final results
final results are fired when there is a
half second gap in the speech stream
that will then generate not only the
final text results of the translation
but will also at the same time generate
that second return stream which will be
a playable audio stream of the
translated voice as well okay that
sounds pretty neat
okay who'd like to see a demo of that
working okay so what I'm gonna do is
show you two demos actually of this
working the first one because I don't
actually speak that many other languages
is going to be doing an incredible
translation task of translating English
to English okay so the reason why I'm
going to be showing you that is so this
is this is the code for the application
actually let me show you the UI for the
application first so the UI for the
application is super simple it's got a
button it's got a couple of text boxes
what oh sorry yes predictor yes my bad
there we go
the UI much better okay so what we'll
see inside of the UI is I've got a
button that says capture I've got an
audio input device I'm using Windows
devices enumeration I'm sure many of you
have used that API to enumerate other
hardware devices in the system I'm using
Windows devices enumeration to find all
the audio input devices in the system
and for my device I should find two one
of which is the microwave built into the
laptop and the other one will be a USB
headset that's plugged in obviously with
the USB headset I'm gonna get much
better audio definition than trying to
talk to the laptop from a distance and
then what we're gonna see when I click
the capture button B will set up the PCM
audio stream for streaming the audio to
the translator endpoint and once that's
ready to capture audio will see this
audio capture status changed to the word
ready and then as I'm speaking we should
see both partial and final results being
displayed in this field here called
output okay
so let's go to the code and I'm going to
search for the word final so I mentioned
there are two callbacks that get
callback from the real-time speech
translation API this is the display
result callback I'll show you in the sec
just how this is set up and you'll see
that we get a string sent in as the
result from the callback and I'm simply
looking for the tag type as final or
partial and I'm putting that on the
front of the translated text that I'm
getting back and then because it's
returned obviously on a different thread
doing a dispatch of run async to then
set it up in the UI right so yeah that's
pretty straightforward so if I put the
hip set on now I should be able to run
this and what we should then see when I
start this running okay so let's take a
look in the combo box and we can see
I've got my mic array in the head set so
I've got the head set selected when I
click capture we'll see the audio
capture status change and then I should
be able to start speaking I know I can
start speaking and then we should start
to see some output in the output window
if I start speaking we should see some
output in the window
and there we have it ladies and
gentlemen English - English translation
crowd goes wild at that point okay so
that's that part of the demo is is
literally just to show you the partial
and final results you're getting back
all right got it
okay right let's just take a little
closer look at the code within this
application this is a simplified version
of the application that John and Ryan
have been showing you simply to set up
the audio translation piece okay so the
button that I clicked basically just
switching the text on the on the button
to either stop or start and I'm saying
capturing audio is either true or false
so I can kind of switch that in here I'm
calling start audio capture or stop
audio capture the audio pipeline has
already set up when the application
initializes I'm doing all the work to
set up the audio input piece to capture
the PCM stream so that's not actually
happening here
right okay so we connect to the speech
translation service I've got a class
that I've created which is called the
speech translate client and I connect
and what I'm passing in is the language
to and from which in this case is
hard-coded for English to English
translation right so I've hard coded it
here in reality you would probably want
to provide the user with some ability to
select the the tune from language based
on profile or something else right then
the other thing that I'm passing in is
the two output streams right the two
callbacks one of which is for the text
result that we've already seen and the
other one is for the audio stream return
which will be the translated audio which
in this case would have been the you
know whatever it was I said now some
text appearing in the window or
something like that okay so after that
we can obviously go dig in and take a
look at the speech translate client
software and that's where we're kind of
making the calls out
- the speech translation API but I think
given that we've only got a few minutes
left and we'll post the code online so
you can go take a look at it it would be
way more interesting for us to do
something incredibly clever which would
be to take the application that John and
Ryan have built and make sure that I'm
on the headset here and rather than
typing something to search it'll be way
more interesting to find somebody in the
audience that speaks a language other
than English have them come up here and
speak something as a search phrase put
that into Ryan's Lewis model to then
search for whatever it is that they've
said and then take the results of that
and drop it into John's search model to
give us the results back into the
application would that be the most
amazingly cool thing that you've ever
seen hang on it hasn't worked yet okay
so do we have anybody in the audience
that speaks a language other than
English so we've got a few hands going
up I'll pick the guy in the blue shirt
here that I've never met before Chris
why don't you come up onto the stage
okay so headset and this is the exact
same code that we saw in the simple
translate the the English to English
translation so I'm going to hit the
microphone button here which is the
start button that we saw in the previous
app and when this says ready in the text
next to the microphone then Chris will
be able to speak in which language in
German and then that'll be hopefully
translated into English and then we'll
pass that into the Lewis model and then
from the Lewis model into search and
then we should see the results in the
output so here we go
so I'm assuming he was searching for
purple Cal's okay so that we have it in
the last hour we've taken you on a bit
of a journey we've taken you through the
process of using the Bing search api's
to search for web results news results
images and videos</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>