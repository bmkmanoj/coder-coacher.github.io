<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Using Cloud Services with WP8 | Coder Coacher - Coaching Coders</title><meta content="Using Cloud Services with WP8 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Using Cloud Services with WP8</b></h2><h5 class="post__date">2016-08-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6Z3_zKp6-14" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">each year microsoft research helps
hundreds of influential speakers from
around the world including leading
scientists renowned experts in
technology book authors and leading
academics and makes videos of these
lectures freely available
okay my name is yahwah I'm program
manager on the windows azure team so
that's the unlimited mobile services
team and that's the team that delivers a
back-end as a service solution for
mobile apps built using Windows Windows
Phone even iOS Android even all those
platforms hey come on yeah no your honor
okay great can you guys hear me yes okay
so I work on the add your mobile
services team we let you create a easy
backend for your Windows 8 Windows Phone
app also iOS and Android how many of you
have heard about mobile services before
oh okay how many of you have actually
played with mobile services ok so my so
so my demo is going to be interesting to
at least half of you are still you can
touch pizza in the back and then just
gonna just going to come in after me so
Jeff wrote forth and Mayor you probably
heard of him and so I'm going to show
you how to get started building an app
in a very easy straightforward turnkey
sort of way jessup is not that turnkey
jessup is pretty involved and rather
complex so he'll show you how to go from
like a simple apps like actually a
really a really advanced full production
app so mole service is a great way to
get started when you grow up to a full
app you might have slightly different
needs and just going to talk about that
so I already talked about this but
basically we provide you an easy way to
add a back-end in minutes so if you're a
client developer if you're not used to
writing as your code you're not used to
writing server code mobile services is
for you we try to make adding a back-end
extremely easy if you if you look at you
know if this if you can compare these
two pictures right so you can follow the
directions and kind of end up with a
nice easy product you know kind of put
the Legos together do exactly what they
tell you that's kind of mobile services
for you right it's a it's it's it's very
straightforward it's very step by step
in turn key is very productive not
necessarily as flexible if you're Jeff
you'd go and build something like that
basically you'd be like Oh screw the
manual I'm going to go and put all these
pieces of azure together and a different
cloud providers actually
put them together and arrive at
something flexible Taylor to my knees
right so first we're gonna talk about
this and then we're going to talk about
that so what do you get from your mobile
services back end what are the what are
the things that we provide for you I
already mentioned we provide a back-end
so that's basically a sequel database
for you with tables for you know the
entities you'd like to store we we
support a variety of clients like I
mentioned we just today we just today
released to production our HTML client
by the time this recording is live the
HTML client will also be in production
so I'm allowed to talk about that so you
can now target websites and also
phonegap so you can actually do you know
you can do either native development
across all these platforms you can even
do phonegap or you can even embed your
code as part of a website at all using
the same back end yeah okay great yeah
and the key thing is we share the same
back-end across all these services so so
you only write the back end once which
is which is a good thing we we allow
authentication and authorization to be
done very easily using a set of support
off providers we support all the major
ones you know Microsoft account Facebook
Twitter and Google so you can go ahead
and configure you out very easily and
then authenticate your users and we
manage their identity on the server it's
very easy to do authorization against
their identity so that's a common
problem we've gone out to solve go ahead
right so that yeah you can also do
custom off there's a blog post by Josh
twist from our team so you can you can
even do your own off if you'd like we
also make Porsche notifications really
really easy so if you've read a lot of
the documentation for push notifications
they'll spend like 15 pages talking
about okay here's different tile
templates you know and it's so pretty
but they never talked about in this and
then there's a rest the rest api doc and
you have to figure out yourself how to
how to write a client you know rapid
internet service or something hosted on
azure you have to do all those steps to
actually send the notifications to the
app displaying them is easy part
actually sending them that that's the
hard part so that's the thing we make
really easy and I'll show that a little
bit oops
then we saw support scheduled tasks so
if you want to run a task against your
your your back-end you know every 15
minutes to clean up some data or to pull
Twitter and pull some pull some
information what we let you do that and
yeah we we also integrate with the store
right so if you would like to use a you
know pusher for example 444 WebSocket
connectivity you can do that you don't
have to you don't have to do anything
weird just go and add them as part of
the azure store and I've been authorized
by VPS high above me to give you 10 for
free for each of you today isn't that
super exciting you know I excited
because you know that they are free 10
are free for everyone so you can get you
can start with 10 for free then you can
start buying reserved ones if your app
grows really large back there safely
expander sirs yeah exactly so you can
you can begin so the 10 are shared
hosting right so they're going to take a
little bit of time to warm up when they
and you know you might get evicted
sooner because there's other tenants of
that machine but they're free now if you
really want to if you want to stay
always hot and you want to you know you
want to have the whole vm to yourself in
case you're doing crazy computation the
back end you can flip a switch in the
portal and get a reserve vm for you and
of course then you have to pay just for
the storage use yeah yeah so the mobile
service itself is free you're gonna need
to associate with a sequel back end you
have to pay for for sequel if your
Microsoft employees your msdn
subscription or if you have an msdn
subscription it's going to cover you
know it's going to cover well more than
10 sites i'm running a bunch of them and
i haven't gotten the bill yet so would
be for the bad thing okay uh in in the
free mode you're gonna get kept and the
free mode you're not gonna pay anything
you're gonna get kept yeah if you want
to give so it's at some point if you
exact same I have to go check what the
exact cap is but yeah we're not going to
start charging a credit card unless you
explicitly flip that toggle okay start
charging you then so the good thing
about mobile services is we've made it
super easy and and we've had we have a
great dev center with a lot
if content that I've written a lot of it
and we have a team of writers writing a
lot of it as well and we cover a lot of
the main scenarios with nice tutorials
lots of screenshots we've been heavily
inspired by Scott Guthrie's blog if you
notice how he does and he puts like red
you know things around the his screen
shots like step by step very clear so
great tutorials also our SDK is on
github so actually everything I even iOS
and Android it's all in our github
repository so you can go ahead read the
code you can file bugs in the issue
tracker you'll notice we have only four
bugs when I took that screenshot so
let's get that count up you guys can go
file your own bugs and the best part is
you can actually fix the bugs yourself
so if you find something it's really
annoying you you can actually a fork I
repository send this a pull request
we're going to review it and if you
didn't I'd check in garbage will
probably merge it emergent so you can
very easily actually fix the bugs you
find which is which is great you know
it's not the dotnet framework you can go
and fix stuff if you find it so that's
pretty much all my slides today I'll do
a little demo and I've written I've
written a game and so the the games is
something we're seeing quite a quite a
few people actually write with mobile
services even though like we'd like to
think of our sweet spot as like you know
like say something like a to do list
application i mean like so sort of a
like you know I saw something that needs
a back-end necessarily not a game not
not real time not our shooter or
something like that but maybe like a
leaderboard to your game in this case
I'm powering my entire game off with
mobile services so let's go ahead and
try it out here so for example I'm all
ready to have your phone alright so Jeff
and I started a game earlier which game
is that game six alright so let's see if
I'm in Game six alright so now let's see
if it's my move okay it was my move now
go ahead and try and make it move in the
phone version of the app I should get a
push notification there you go it's my
turn and I'm not very not very good at
writing these up so you have to go and
actually
fresh to see Jeff's move over there you
go okay so so you made a move and this
is the way this works is that we're
sharing the same backhand right both
both these are going is the same server
data so that's how this app works so
I'll show so I'm showing you the windows
8 version we're going to switch over and
look at how to actually build the phone
version of the SAP so go over to visual
studio here and yeah so this is just a
blank app it doesn't it has a bunch of
hard coded data in it doesn't it doesn't
actually connect to Azure at all so you
guys can see okay can the lights are
okay cool so the first thing is I'll go
to the azure portal and I've created a
mobile service already right it's called
a line 5 so basically up here is where
we give you kind of the getting started
information so you know if you if you
want to add this back end to your
Windows Phone 8 app you go to the
section here we let you download our SDK
add it to your app we give you sort of
the connection string to your mobile
service which is this basically that
this line here with the URL and your
access key for free application to talk
to your back-end let you create a table
and just kind of get on your way it's we
have a very nice easy quick star
experience I'm not going to follow this
because you're probably seeing the demo
of the QuickStart a million times but
I'll go ahead and add this information
to my to my app so you'll notice if you
go to the data tab here I already have a
games table in a player's table so
you'll see me reference that as I build
my application so let's go back to the
app will go to the code behind here and
i'm going to add that first snippet
which basically defines my mobile
service so i have this basically this
config file here I didn't want to this
is just to make my life easy because
this is checked in to a public repo I
didn't want to check in my secrets but
basically this one file here
contains the secrets I've just checked
them in separately so I don't have to
keep them as part of my source so
alright so i have this mobile service
variable then the next thing we're going
to do is we're going to go inside our
main page here and we're going to look
for this authenticate method and that's
the first step we do in this game that's
the thing you didn't see but Jeff and I
are already both logged in so we have to
we have to make sure the user the first
thing they do want to come to the app we
got to get their identity so we're going
to ask them to login so I'll drag my
authenticate method in here and this is
pretty much I'm just pretty much I'm
pretty much just taking advantage of the
live SDK so the other is called life
connect SDK now so this SDK basically
lets you sign it sign users in with
their live ID on the phone it basically
pops up a little browser control and
navigates over to live ID get listen to
type in their credentials and gets you
back an authorization token so there's
this code of essentially copy pasted
from their sdk so you notice i have this
check registration method missing here
so once I've authenticated the user I
want to make sure that I've registered
their poor channel so i can send them
push notifications so that's what i'll
do in that method so i can go ahead and
add that I think before that I actually
have to go inside of this because i need
to actually call that thang it methods
all just put it in here oops sorry
so I have to put it inside of unloaded I
think right here okay and then the next
thing is that that another change before
I drag in check registration we need to
basically get the current user identity
so that one I currently hard coded it to
this blank string but I can actually get
that from the live SDK so I'll just
paste that in here
so this is basically getting the the
user identity from with my SDK now we're
going to do the check registration stuff
to register the push channels and you
just know how do you get to meet this
little bit bigger so you can see oh is
it I can just minimize this thing is
right so you notice it starts with just
pretty simple like a push channel
registration code thats stolen off of
the sdk for for the phone sdk the one
thing you'll notice that i do
differently here is once i once i go
ahead and get the poor channel i
actually added to my player table so
this is how i'm actually going and
storing that users a push channel up in
the cloud right so that's basically a
reference my client side reference to
the server table here and if you notice
Jeff and I have already played the game
so in here you'll see you know here's my
Microsoft account user ID here's Jeff's
and then here's our push channels and
for in my case you know i'm using wns
for my windows app jeff has and i also
have a phone app as well and jeff just
has phone just because he's logged in
only on the phone but as he logs in on
more devices we're going to update this
this user object for him here and store
all his push channels so we can so
whenever we make a move in the game we
can deliver a notification Tim ok so now
yep go ahead and the device on the right
so currently we're identifying them by
the by well what do you mean so we have
we have the user's identity if they're
logged in if they're not logged in we
don't have a notion of their identity
sorry oh you know yeah yeah so i would
have to if they have multiple devices
this would break reg if they have
multiple phones then it will break
because i'll just keep overriding the
push channel so i have to be smart then
you're right like I have to basically
start adding a list of push channels I
get a popular ah yeah I always pushed it
both how do you know what is what what
the point is is it before is it good is
it oh well because notice like I had to
actually manually do this registration
right like this registration stuff like
I had to I had to go here and manually
set this property on my my player like
em p NS channel right so on my wns and
my wns code like my windows code i'll
actually have i'll actually says wns
property so i had to write i hit the
right custom code based on the platform
but you have to write custom code anyway
because they the poor channel
registration logic is different anyway
on the different platforms so yep you
have to know and I noticed my table
reference is missing so I have to
basically add my table reference so
here's my just rip the references to my
two tables mobile services that thing we
instantiate it off of the app object so
that's that's still there that's how you
get the references to your table you say
get table and you give it the type you
won't work with okay so now let's look
at the Refresh method where that is
right so currently the Refresh method is
kind of it's pretty bare bones actually
you notice I'm just saying data context
null for all my UI controls they're not
really doing much I they're just showing
blank data so let's let's let's let's
add the implementation for refresh this
and so here's some interesting code
right here's me actually querying the
server to get some data back so in my UI
you noticed when I showed you the up and
I can switch over again real quick so
you guys can see I had two columns I had
open games and I had my games and so
these are different queries against that
server table the open games is basically
games that don't have any players
assigned to them yet and my games are
games were either player one or player 2
as my ID so I have to write that logic
on the client right to do the right
query so open games basically you're
noticed I I'm just using link I'm saying
okay open games or games where player
two is no right because player one is
always the guy who created again so you
create a game you always set player 1
player 2 will be null if the game is
waiting for another player so I query
these things you notice I'm using link
right so that's one of the one of the
nice things about our C sharp sdk is we
let you query your server using link on
the client which is nice and easy then
the my games queries a little bit more
advanced so I'll say you know where
where either the players is null and
then one of them is me right so that's
what this query says so that's how my
games works so what so I where one of
the where none of the where none of the
players are null and one of the players
is me that's that's what this query says
but it's a bit scary but it's linked so
I was easy writing and it's just it's
hard to read it back and then I use the
you know I set these two collections to
my data context object so they can pop
book in the UI one thing I remembered
actually so refresh where that that
should get cold only after I'm
authenticated and registered right so
somewhere down here it should call
refresh
or maybe yeah yeah so I'm just wondering
with us the right place for it because
do you want refresh before with Anna
cated i think i'm going to put that
somewhere else to move that it out of
there actually let's keep it over for
now and see if it fails okay so then how
do you actually join a game so I
currently have just an empty button that
doesn't does nothing so join game on tap
sets that button here and the UI that
lets you join so go ahead and drag the
implementation here so you know it's
like the way I joined the game is but
actually I get the game table and I get
a new a game object and I stuff it into
the game table and that's that's going
to be interesting right like how does
updating something actually make me join
the game so that's just a little
convention I camp with the server so
let's look at the mobile service back in
because obviously that just that's not
that doesn't make sense if it was just a
simple update like it's a you know it's
not really doing anything it's not even
touching any properties on the object so
how does I even work well we have this
notion of server scripts and that's
something that you actually need when
you're doing a game right you need to
you need to have all the logic
encapsulated in a method on the server
you can't run your game loop in the
client so actually you'll notice I have
some smarts and a lot of these methods
I'm not going to cover this one but
let's go this update method in my games
table let's see what happened here so
you'll notice when I go ahead and insert
a game first it checks okay well is does
this game exists already and if it does
then I'll either join the game or I'll
make a move and that's kind of that's
that's really where my game loop lives
inside this update method so i'll send
an updated instance of the game back to
this update method and depending on what
it sees all know what to do so if i sent
it a game that doesn't have a player to
it will it will call this join method a
join game method here and they'll set my
user ID as player too so it'll register
me for the game if i send it again and
i'm already player 2 on that
it will call this make move method and
the make move method basically goes
through a bunch of validations I wants
to make sure okay is it your turn right
because it may be the other players turn
you know are you trying to move in a
column that doesn't exist right so I'm
trying to place a move in you know call
them 15 sony has seven columns so so
this is kind of it's it's a bunch of
server validation that you know the code
needs to this needs to live somewhere so
this is basically our our way to let you
encapsulate a little bit of server logic
when you work with your data so any
questions so this is actually running
nodejs on the server yeah so there's a
little bit disconnect for C sharp
developers a lot of time you look at
this and you'd be like oh that's right
JavaScript now but I mean if you think
about the bigger picture right well
first we're definitely looking at in
c-sharp support but if you look at the
breadth of developers we're targeting
we're also targeting people to do iOS
Android and HTML it's not just for C
sharp developers for a much bigger
community so we try to pick a language
that's that makes sense across everyone
and so you know node was was was pretty
lightweight and and pretty well received
so that's what we've used all right so
going back here we're back to opes sorry
going back to the visual studio we we
hooked up the logic to do a join game on
tapped right so that's when I go ahead
and join a game now how do i create a
game so i'm going to replace this other
handler you'll notice i insert a
basically a blank game object into the
game table so i can go ahead and take a
look at that so let's look at the insert
method and you know it will populate
some of the properties will populate my
ID as player one it will create a new
board it will create a empty new board
and you'll see basically that's how we
represent the board on the server so
like all that logic has to be in the
server side right so people can't cheat
so that's how it is why I create my my
new empty game okay
and now the last thing is my make move
method which is when the user goes
inside the actual grid of the game and
taps taps one of the columns to try and
make a move so let's go inside this game
board code behind and there should be a
make move method maybe it's not there
poor moved and I need my reference oops
whoa how did I do that okay
ok
actually sorry I'm pacing us in the
wrong method that's why it's not working
so I'm pasting instead of pasting it
pacing aside my game board class which
is just it's a UI only class actually to
paste inside my game page
okay now it makes a lot more sense
here's my empty method all right
right oh sorry oh yeah thank you alright
great so bored move bored moved so this
is when people actually tap a column you
know give a reference to my game table
the same way we did it before using our
client I will do some checks right as
the game in progress is it my is it my
turn and these are also these are
constraints that are also enforced on
the server as well right so but this is
just you know it's so that instead of
getting a weird response from the server
like a 500 error or something they'll
get a nice response within the game then
i'll i'll take the game object i'll use
this move property to indicate which
column they try to move into and then
I'll basically call i'll call an update
to insert the game into my table on the
server so that's all I had to do I mean
is so you know it's a bit of code but
it's actually it's you know I have a
full I have a full game working so let's
go ahead and just run it to convince you
guys that the right thing so go ahead
and start an emulator okay
these should be here somewhere well
anyway I have an easy way of cheating
actually because this is in version
control
oops
Oh Ralph older
two
Zoey stressful i try to fix your demo do
you guys have any questions about Jews
were kept house gift how's it working on
his phone alright so here's my app so
the first thing is we we did build in
authentication so this is basically that
called to authenticate using the live
SDK coming up to ask me and this case
actually i've already logged in because
typing the password on the amulet
actually reveals your password so i've
logged in before hand it's asking me to
give the apps and permissions you know
nothing scary so I say okay let's do
that and then the next screen should
just basically present the same
information I saw in the in the windows
a version of the app so here's the open
games here's my my games here's the app
here's the game I was playing against
Jeff I can go back I can go ahead and
start a new game I you know I can check
in on that game and you notice actually
like I have this interesting bug which
I've kept for demo purposes you notice
the windows 8 version of the game gave
me a notification it's my turn because
now I think now thinks I'm actually
playing as two separate players which is
nice for demo purposes so when 8 just
give me a push notification saying okay
it's your turn I can go ahead and make a
move and gives me location again so it's
very fun to play this play with yourself
I also i want to show you toast
notifications on the phone so if i
actually go to the windows 8 version of
the app and that's not what I wanted I
need to close the app because toasts
only show up when that app is hidden so
I go to my windows literally app here
you find that you actually bring it up
again
so here's a game I was playing and if I
make a move we should be able to see a
toast going up in the phone there you go
it's your turn so I i was able to
deliver the push notifications both to
the windows 8 client and to the phone
client I want to spend a minute on
because I'm three minutes left I won't
spend a minute on how I actually
configured push notifications and how
did I send them so the first so so you
know you can't for Windows 8 you can't
just send unauthenticated push
notifications that's you need to
register and on their developer portal
so on the on the push tab here I had to
go and add my client secret and my
package SID so that's how they
authenticate the guy who's trying to
push for Windows Phone actually if
you're under 500 notifications you don't
need to do you don't need to
authenticate it all you can send
unauthenticated pushes 22 up to 500
authentic Gabe pushes / poor device I
think so I didn't need to do any off for
that let's find this script where we
actually send those notifications and
that's going to be inside my games table
here it's going to be in sight of update
yep it's dinner okay so they're just
going to set up on the HP volunteer for
this one but we just want you don't have
to do anything for Windows 8 you had to
go and configure those two things you
have to go to the Windows 8 deft portal
we've got the basil stuff yeah start
placing stuff and then i'll show you the
code yes right but after that days okay
so then I
yeah yeah yeah that's the whole point is
that this is your this is this takes the
part of writing that relay yourself okay
so here's how I send push to wns I get
the wns channel that's the thing we sent
on our client when I client registered
so you know I send a toast announce it
to the to the to the Windows 8 app and
then 4am pns i said i have a very
similar API I just give it the channel
and then I give it the text i wanted to
push so it's as easy as this to actually
send the push notifications again for
windows 8 I had to configure those two
values for M pns I didn't have to do
anything at all so with that I'll take
quick pause and take any questions yeah
you go hi for someone like me who has
never done any cloud thing uh-huh
probably doesn't even understand most of
the concepts okay sorry where would I go
to see a walkthrough or to start just
the simplest thing yep so we owe sorry
European question if you've never done
any cloud development where do you go to
get started so this is our dev center
which I showed a slide of previously I
guess didn't come up yeah basically
you'd go to our to our developer center
and then you can go ahead and pick
mobile up here or if you can memorize
the URL even better you can start this
tutorial right so your phone developer
you pick windows phone 8 here and you
say start tutorial when you create your
mobile service there's a there's a
project there that you can you and that
quick start page i showed you there's a
project that downloads the zip file you
run the zip file inside the vs you get
your start up running so there's one
button to create a table 1 button to to
create this starter app and download it
it's very easy and you can just and we
show you how to do it in this tutorial
as well so very straightforward and easy
yeah question so if you've done so I've
done a bit of envy
see database stuff and I'm comparing
this with how that works and
specifically if you have associated data
so let's say you have you know game with
multiple players or an array of players
so the way you do it in NBC's you have a
navigation property right and you know
you have a list of players associated
with the game object now just take care
of it is there any easy way to do this
it seemed here you have like the you
just have player 1 player 2 is property
right what if you have a list of players
right yeah so we don't support
navigation properties it's like a no or
anything right so ideally you would have
basically the idea of a join you'll be
able to join on something you can do
that currently you can drop down to sort
of raw sequel and if you want that
second table to be queryable and you
want to actually be a table you can drop
the raw sequel and write a joint and
bring up the appropriate players so in
your actual table you'd store like a
little there a list of them a list of
their IDs from different table and you
write a join pull them in that's that's
if you actually want them to be in a
separate table and you wanted to be
indexable if you don't care there's
actually a really neat trick which is
you just take the JSON blob that came on
the wire and you stick it inside the
property as a text string if you never
need to search through those players or
list them separately that's a nice trick
you can do and Josh fists talk I'm build
get into that trick they didn't actually
talk about it okay does that trick
document it somewhere it's not in the
official docs because we hope one day to
actually do proper joins but I can I can
point you to a blog post or yeah just
follow up I'm we have it somewhere
question back there concurrency so are
our server scripts basically you have to
send a little bit of how node works so
node has an event loop that's single
threaded so there's a basically a queue
of HTTP requests the pile in and they
get pulled in one at a time and executed
so basically you only have one request
running at a time in your server script
so you don't have to worry about locking
or anything like that the the node event
loop takes care of that for you I guess
only one script is running I guess many
instances are filled one script may be
running in violent it's just that each
one is running and single program 115
that's right there's only one thing on
the thread at any given time let's say
500 requests coming at the same time
yeah and server has the capacity so it
starts 500 instances of your script they
don't share need a dollar more as long
as our partner instances the script is
gastar is it starts out in order and not
sharing any memory within the know ok so
i guess there's no case are one instance
of the script but it's gonna it's going
to queue up 500 these callbacks but UK
UK I you can there's no like static
variables or anything the Blue Nation
enemy tuna and the one yeah yeah yeah
and they'll be they'll be picked up one
at a time it was the evasion guys
imitated so you have a bunch of servers
right it is running on one server only
yeah if not being like a specific person
they are not being divided no no you're
always on the same machine with yeah
yeah yeahs euros insane machine euros in
the same process actually
the you have to so so your next question
is gonna be like I'm gonna I'm gonna peg
that thread and then my my app is going
to stop be responding right that's kind
of your next question not really i
thought Michael since this is running
the food shay butta I thought that
because we'll come and get to do acted
to the service and you know if they have
capacity they run your script a lot of
them women that's how yeah we have you
have one instance of the a purring by
default now if you if you configure
multiple instances yourself like you
there's a if you go to the configure tab
in the portal you can go ahead and say
how many instances would you like to run
and then in that case we will it will
get it will get low balance to one of
the one of instances a little bit is the
other one but yeah by default no but if
you go here to this configure tab or is
it scale the scale tab you can go ahead
and switch to switch the reserved mode
and you can start dragging this slider
and adding instances anyone questions
if we do localization yeah the question
is how do you do authorization we don't
have a nice declarative way like you
maybe you're used to in the framework
where you can put some attribute on the
method basically on whenever you have
any script here coming in so I can
slightly late let's say inside of our
game games table inside the aside all
operations you'll get this user object
passed to you and then you can you can
do validation based on a user ID so our
authorization based on the user ID but
you have to write imperative code to do
that yourself we don't have anything
like you know rules or anything like
that like sir can we do sharing in the
same way like a user created like let's
see a blog oh but you want to share with
another user and do this can we do the
code there and it says it's this user or
yeah like by default all users can
access everything that's being created
and unless you manually put a check to
block someone you have to man you build
the authorization mechanism you want
like I think you'd have maybe like a
list of users and their permission level
or something like that and then add them
to some kind of group and then check for
the group but it's it's a manual deal at
this point we are thinking of doing a
user's feature a first-class users
feature which would which would have
authorization built-in
hi person somewhere that you can use my
cell design clothes and describe how the
question is how to use a mobile service
and a cloud service together so
basically this is the same way you're
the same way your client talks to your
mobile service it uses a JWT a JSON web
token so that's that's basically
something that gets generated the token
is generated by the server and the
client sends it over every time like
they have a they both generate that
token using that that master key that
application key sorry so if you're able
to extract that token and then we don't
provide you an out-of-the-box way but
there's playing a blog posts and
workarounds if you're able to extract
that token and use this part of your dot
net app to send requests then you can
you can do it that way basically figure
out a way to generate the token or steal
the token and use that to authenticate
and talk to back-end so if your secret
gets compromised is it was the focus
from one keep it yeah so we give you I
think two at any given time and you can
go ahead and regenerate any of them
independently but you're not this will
die users get migrated to the new here
the government well that you know they
won't they won't matter it is a possible
to write a script through that
no but but that's the thing like so
slowly well no so actually so this is we
always get questions about the
application key right so the application
key it's really not a security measure
it's because because it's very easy to
open any any zap and reflector and get
the application key out yeah the master
key something you shouldn't ever give to
users or whatever then it gets
compromised I'm using Euler not eat
anything and I have some custom mod so
now I have five inches interpreted sort
of like my mobile service right yeah and
I want to not happen in convince all
those users and I just redo the whole
are you mad are you doing Christian
yourself in this case I have offered a
master key sounds a good vast question
okay we should take it we should take it
offline but if you regenerate the master
key the service its we turn off the old
key within within seconds so isn't the
master keys
I think I have to go read through
through through through Josh's thing but
you shouldn't ever have the master key a
client application so i won't leave time
for Jeff so I can take any questions
after all right great thank you guys my
name is Jeff Wilcox and I am kind of the
most successful failure on the windows
phone so my application has netted me no
money and cost about fifteen thousand
dollars but the good news is I'm sharing
my experiences there with everyone so
you win some and you lose some in the
past i was on the silverlight team i
worked on windows phone 7 and 75 and
these days you'll find me in Windows
Azure I run the open-source dev team
unlike the SDKs and I work with a boars
team quite a bit that said I didn't
build my my application fourth and Mayor
with any of these cool things because I
built it two years ago and about two
years ago next week actually so this is
my list of laundry topics to go over and
we'll see what time we have for going
through this feel free to interrupt me
at some point but hopefully I can get
through some of it I'll probably go for
about 20 minutes here so first of all
what the heck is my cloud environment
when i launched my app for the first six
months I actually did not have a cloud
store at all and so my application it's
actually based on the Foursquare API and
so if you want to check into a bar or
you check into work to do that you
actually use the Foursquare API and
that's not an API I run foursquare runs
it and so my application just went
direct with OAuth against their service
so super easy for me because it didn't
cost me any money foursquare allows me
to do this for free and it was easy to
code up the trouble is I can't add value
on top of that and so if you look at
things like live tiles toast
notifications you know doing work for my
users I can't do any of that since my
app just went direct to their service
and so eventually I started building up
this crazy set of you know independent
components and to be clear this is kind
of me as my non-microsoft self so as
employers Microsoft's nice enough to let
us moonlight do some stuff in the side
and hopefully we're being kosher there
that said at the time i was looking at
Amazon Web Services gosh the price was
right it was like thirty percent cheaper
and since i wasn't going to charge for
my appt this mattered to me and it was a
good time to learn about some
competitors products so v1 was built
completely on amazon and that sounds
great but it turns out when you work in
windows azure you should maybe just be
able to answer to you know your CBP how
would you run your service on azure and
so i'm actually in the middle right now
of kind of moving my entire app over to
azure just to prove I can I have a
couple actually unique reasons
economically that amazon is cheaper from
my very specific app but everything runs
in Azure great for the most part and
apologies if you're a phone developer
you probably don't care about most any
of these things but someday maybe you
will so on the Amazon side I use them
for all my dns hosting and that's
because today windows azure doesn't have
kind of custom arbitrary dns hosting and
so even when i move over to windows
azure i'll still be using that product
but the other classics on amazon side
ec2 is their linux virtual machines load
balancing storage text notifications all
these things are great that's kind of
what the app was built on and so the
infrastructure was a couple ec2
instances mostly small or micro
instances that we're running nodejs
running web servers doing push
notifications all these fun things and
then one unique service i use in amazon
is i'm talking to foursquare because my
application is a Foursquare application
and it happens the foursquare is located
in the US east amazon data center the
same data center is my app in amazon and
so I can talk to foursquare for zero
dollars i can download terabytes of data
i can send them terabytes of data 40
bucks that's actually a pretty big
driver for one of the reasons that i'm
running an amazon today because
foursquare is not in the azure data
center so in my case it's kind of a
unique reason we're today my production
service is still in amazon and that
probably won't change in the short term
but i'm finding ways to move it all over
and peace in things and so I'm actually
running some of my web service API
servers and my website now off of
Windows Azure and the nice thing with
DNS is you can move for writers you
can even do round robin I could have my
website some days be hosted by amazon
sundays by azure and you know kind of
smoothly work that through and tell you
you know fix all my bugs on the mongo
side i'm using mangos no sequel database
solution and it's mostly because i'm
written in javascript javascript is
super sexy right now and Mongo gives you
JavaScript JSON back and so it's really
simple in the Amazon data center I pay
mongolab it's a third party company that
hosts Mongo I don't want to worry about
administering this server I don't want
to worry about instances i paid them 40
bucks a month and in return I get a
pretty large amount of data just
completely hosted backed up it just
works no worries now on the windows
azure side in the windows azure store we
actually also have mongolab the same
exact company the same servers the same
smart guys they're actually hosted in
windows azure as well and the cool thing
here is that they're actually not
charging right now because they want to
get test users and so in azure this cost
me 0 bucks so it's kind of an
interesting thing where you know each
provider has its own pros and cons and
one pro and azure right now is it's free
in this specific case on the big list on
the right windows azure websites is the
big feature that was launched last june
and
not sure can go
link Justin thanks sorry we're rocking
link here share the desktop it's good
okay set butter okay great so on the
windows azure side windows azure
websites is a super simple way to host
your website so on amazon i have to
actually spin up entire ec2 instances i
have to install the web server i
actually go through the crazy steps of
building nodejs from source and crazy
stuff i can automate it but it takes a
while to kind of launch things and with
azure websites i literally just get
deploy my code and like 20 seconds later
all of my instances are running the
latest version and so I'm actually
running both a production instance and
then staging instances in my back end
there through as your websites and it's
super cheap I run a whole bunch of
different services and they're all
independent and so the idea is that if
my live tile generator goes down well
you know that kind of sucks but turns
out the rest of the app is going to work
just fine and so I've kind of done a
little bit of a hedging here on my
environments and so I'll actually watch
the load you know over mail
month-to-month just see how the loads
doing and the live tile server is pretty
much the most expensive part it's a lot
of CPU to generate PNG images but it's
actually the best part of the app is
live tiles are kind of a great Windows
Phone value-add and my code actually
also generates windows 8 live tiles
although I haven't released that app yet
other things that go on I'm actually
using the classic cloud services it's
kind of a traditional way in Windows
Azure that you push code and this is the
thing that sometimes takes in like 10-15
minutes to spin up in instance and it's
doing a full windows vm it's extremely
fault tolerant and so I'm doing this for
email processing if you send me a crash
report my code actually will parse your
email figure out what the bug is and
today I get that information but one
thing that i'm working at for the future
is actually emailing you back and saying
thank you so much for your bug report
here's the ID of the issue it's already
been logged or you know 10,000 other
people if sadly had the same issue today
I'm kind of some value add on the on the
side of crash reporting I'm doing that
there and then as your website's today
doesn't actually support having a custom
ssl certificate and so I have a wildcard
cert for anything that fourth Amir calm
and websites doesn't support this today
but according to Scott Key's blog some
day at will and so until that time
I'm actually running my own ssl load
balancer in Azure and so it's a bunch of
instances that have my certificates so I
get the incoming requests I will
actually rien crypt on the back end with
as your websites do the magical things
and then push it back out this is
actually it's like 20 lines of code and
some web config file it's pretty easy to
set up actually but it's important
because i'm looking at customer data i'm
getting information on GPS locations I
don't want this stuff just freeform on
the internet so I try to respect my
users a little bit i'm also using the
azure table store and so i have a log or
built into my note app it's kind of like
the equivalent of console dot log it
would really be painful like honestly i
have over 200,000 downloads of the app
and about a hundred thousand active
users and i cannot look at logs there's
no way I can I do that because I have a
day job it turns out and a girlfriend
and other things that don't really
compete very well with looking at log
files but if I need to I can kind of
pull up the log for a specific user and
I store a lot all that in as your table
store it's awesome because table store
costs the same amount as Azure blob
store so it's super cheap but I can
actually query that data and so I
actually partition it by a whole bunch
of crazy values but the magical thing is
it's quick I can Corey it quickly and
it's just just kind of works i'm also
using virtual machines for some
statistics stuff and then of course the
adjure store for Mongo the fun thing is
how much does this cost to run a hundred
thousand plus users this is kind of like
the fuzzy math on it again mongos 40
bucks a month amazon used to be about
150 a month but as i move more services
to azure i'm actually my last bill was
about twenty seven dollars and so I'm
finally seeing some reduction there as I
kind of moved my spend for the cloud
over to Azure and on adjure there's all
sorts of free trials and things I think
one of my accounts is currently on the
three month free trial so I get 750 free
compute hours and there's crazy things
that happen on on that I honestly
haven't been able to estimate my spend
because it keeps going down somehow but
I'm paying for all these things and so
for me I'm kind of watching my costs and
so that's a great reason to actually
instrument my app and figure out what
the heck is actually going on and I'm
actually trying to be redundant to you
know you don't want a hundred thousand
really bad reviews if you
wrap on the App Store and right now I
have tons of great reviews the average
scores about 4.5 stars I'd like to keep
it that way and so I need to run
redundant services I need to run
reserved instances I need to kind of do
the right thing from redundancy but I'm
just one guy you know so thankfully
cloudlets this happen before I actually
started using the cloud i was using
dedicated servers and when they went
down you'd have two days downtime while
they try to figure out how to get things
running so the world is better here is
kind of a look at the some recent bills
so on the top I couldn't find the break
out for the azure one but you can see
recently i paid forty six bucks there on
one of the accounts amazon kind of
breaks down your computers you know I've
got 300 hours of a couple instances here
from whatever this bill is I guess this
is the current month right now but you
can see that you know it's real cost I'm
using real services and I ask they can't
figure out day-to-day what's happening
but I can do you know some estimations
to at least figure out what my spend
will be when you're running Cloud bills
you know I think you often think hey
it's only costume you two dollars this
month to run my service but you know it
could easily be the next you know I
won't say Instagram because that would
be awesome but you know your app could
really kind of take off and when that
happens at least with the cloud you can
scale some but cost is going to matter
and so I don't have any silver bullets
there to share with you but here's a
look at the azure portal this is the
fourth ameya set for my subscription
here and so this resolution makes it
painful but you know there's a bunch of
websites i'm running both the standard
web sites and then the staging website
and its one hundred percent identical
code in these cases it's just different
branches on github where the codes
hosted and so when I push an update into
my github staging branch within a few
seconds Windows Azure actually pulls
that update and it goes live and then in
my app when I have my debug
configuration setup it uses staging and
when I hit release than a hits
production and so that's a good way for
me to kind of know that I'm testing
against a current version and when i get
my app looking pretty good i'll go ahead
and flip things over to release in
visual studio and then i'll hit
production for a while until i'm really
happy of course and then you know I'll
get my bits ready for the marketplace
other services in here you're going to
see as cloud services there's some
storage accounts pretty typical view
this looks way cooler than amazon's
portal so as is doing some good work on
the right you can kind of see an example
you can see some graphs of how the loads
going over time and so it's really nice
to pull up a week worth and kind of see
what the data looks like now these are
things that today at least Windows Azure
mobile services doesn't support or at
least not all of them clearly the most
important thing I do is push
notifications and so that is sending
toast to users so if I check in here at
building 99 my friend should get a you
know toast on their phone saying Jeff
just checked in at building 99 that's an
extremely expensive service for me to
provide because I actually have to do a
little bit of computing in the back end
I know where you you know if I know
where your phone knows you were and
where we're your friends were earlier
and I can look for changes in
differences but that's all cloud
computing time so clearly it's something
you don't want to do on your phone
device it would just waste the battery
on the phone but also it's not a cheap
service to provide crash reporting live
tiles live tiles again are super
expensive but super expensive compared
to like you know parsing an email at
least and then the magic is this
continuous processing queue that I have
and so I have some node code it is
JavaScript but it is quick you know I
can process about 50,000 people in 30
seconds and it'll go through it'll turn
through you'll talk to Foursquare it'll
look at the database tables and Mongo
it'll figure out what the heck changed
and it's actually some impressive code
and this is all open source on my github
account I doubt the open source would
help you because you're not running my
app but you know if you want to look
what these things look like you'll see
the disgusting code that it becomes at
times since I don't have time to do the
code right always there's a lot of code
where it's you know temporary bug fixes
and lots of to do statements like all
good code so this is kind of magic
though it's it's really simple like the
primary q is maybe 20 lines of code it
kind of pulls a little bit of work off
of the Mongo q it says who haven't I
seen you know who haven't had processed
in the last two minutes and it's going
to pull that data off and temporarily
kind of reserved it and then I know that
even if this machine goes down or
something happens I'll at least see that
person again in two min
so I don't worry too much about downtime
there but the good thing is is if I
scale I can scale out from what I have
right now is 3 reserved instances but if
I want to scale out to 30 if I get
popular I know that each machine will
pull you know the 20 or so people for
that work and I don't worry about other
machines pulling work and competing for
you no duplications and all these fun
things but this code is like super easy
and node and in JavaScript because one
machine is just doing one little piece
of work at a time and so it's actually
pretty fun there's some storage hosted
services and these are really important
things that I don't want my web server
to ever have to worry about really and
so when the app notices that it's been
upgraded from like version 3 to 3.1
there's actually a file that I store in
storage that I can pretty much guarantee
is going to be up more often than my
website is and so the app actually goes
directly to storage looking for that
version information and it'll pop this
information that finds and in my case
actually stored on a CDN and so i'll
have you know what's new in this version
i fixed some bugs you know i added an
easter egg or something i can put these
things in the what's new content i
upload it into the storage blob and then
the app just hit CDN and so it's really
fast for users but also there's 0 you no
worry on my side I could spin down all
these services on the left side and
people still get information about
what's new the basic live tiles and in
the app that aren't customized you know
all these nice things then on the other
side there's some other services they
use this is mostly for interacting with
users whether it's running a blog or
letting people report bugs just you know
everyone kind of has their own toolbox
and this is the tool box i use for my
app i've already mentioned staging so
don't want to drone out too much about
this but i will say that one of the nice
things i do is that i literally have all
of my keys and certificates they're
different for staging dev and production
and they're just literally a JSON file
that I don't check into my source
control actually push it separately but
it's kind of a standard practice you
have or did it in his app as well and so
that's nice because I can easily roll
these things just by changing the file
and I have to worry too much
in terms of production challenges I've
had the base one is that I am sometimes
a sloppy coder and I don't want to
regress my users especially if I have
sometimes 20,000 some people using older
versions of my app and so I'm actually
doing version 10 points and so if i go
to my api URL i'll have / v 2.1 / v 2.2
so each new client app i build a 0
actually for the most part clone or in
my application exposed the same endpoint
if I don't change anything and if I do
change things I do kind of like quirks
mode checks and in the first version of
my app I didn't do that and I found that
you know it's really painful because
people don't always know to upgrade your
app so so that's one challenge I've had
their other stuff obviously moving from
asher between Azure and Amazon is a
challenge it's it's a fun challenge it
turns out vendor lock-in is not real but
it's definitely work at some point and
it's actually really helped me I think
think more about the cloud is that you
know as much as we like to think that
all the cloud is a commodity there's
definitely a lot of work involved in
making an app that runs everywhere the
last two challenges you know things
happen cloud providers go down nobody
you know says it's one hundred percent
guarantee there's a guarantee that's
under that number and so what I found is
that in my app one thing i do is i
always go directly to foursquare when I
can and if I need to share that data
with my cloud service once the
Foursquare request comes back then i do
my processing with my cloud and so that
way the the core essential part of my
app which is completely separate from my
services will still work even if you
know I do something and my cloud goes
down that's really the best way for me
to mitigate it of course you know if
your app is using just your one single
first party service yeah you're going to
be issues there and you up down time and
so that's going to be about what you
show your users I should have some code
here I like to pull up on that
and that's way too big so a few
different things for how I do air
processing in my app the first thing I
use is a thing called JSON p and it's
kind of a specialized version of Jason
that lets it actually wraps the entire
request in an HTTP 200 response and so
it'll actually say everything's great
everything worked and then you'll notice
that there's this request parameter
it'll have this information about the
request that actually says the real HTTP
status code and this was actually a
workaround from Windows Phone 7 back
when we kind of had silverlight style
HTTP status codes and things came back
as 404 even when they weren't really 404
and so this is a hack that's been in
there for years now it just proves that
code never gets updated a little bit but
what I actually do is I can parse both
the HTTP status information as well as
special things that foursquare provides
for me and this is the real code right
now for the production app and I
apologize because there's things
commented out and I'm trying to localize
but what you can see here is that I kind
of have a different different exception
handling in my app depending on the
severity and so user intended exception
is something that at the root of my app
I definitely want the user to see and so
clearly I want to tell them here their
credentials are invalid there's really
no smart way for me to handle this
except let the user know it's invalid
they probably need to install again and
a long ago so actually sign them out of
the application but that's one kind of
thing we're clearly I can't do much now
this parameter error is a bug on my side
if it happens it's nothing my user did
it's either a bug on the server side or
it's a bug in my client code and so I'm
going to throw the standard invalid
operation exception that's something
that I'll get notified about either my
crash reports through the marketplace or
crash reports built into the app but I
found that kind of differentiating a few
of these is good here's one at
Foursquare sends saying that someone's
use the Apple whole lap in the last hour
because you've exceeded the weight limit
and so again that's something that's
intended for the user pretty standard
there the other one I have is I kind of
do the same stuff right here here's a
note from probably
two years ago before ingestion figure
out this error handling I don't know how
many of you have applications out there
in the marketplace or have code that
looks like this but this made it through
ingestion so I guess it works more often
than not but here I kind of do things
I've got some nice notes so someday they
should probably sign out and inform the
user to do something different today I
just break you know you can see here
that I've got all the notes I know
exactly how I want to do air handling
but I'm a lazy coder so apologies in
your app though you should totally do
cool things with these status codes and
you know inform users the right thing to
do this also proves that your app might
be a horrible code base but you know
find popularity so go figure this
stuff's not too exciting but again i'm
just literally using an environment
variable to kind of switch between what
mode my app thinks it is and it makes it
really easy to test on my machine on
another machine or in the cloud but
here's the good stuff for how you hook
your app up and the nicest thing is
actually the first one is the HTTP
client library this is something that
the clr bcl team like shipped maybe two
or three weeks ago and HTTP client
itself it's kind of the basis for using
HTTP in.net 45 so like in a Windows
Store app that's what you use and it
actually hasn't been available for
Windows Phone until recently but there's
a portable class library and new get
definitely use it it's got a sink await
all the cool methods you expect to use
windows phone also supports the classic
web client and httpwebrequest that is
really painful to code once you've used
web plan so definitely use that in my
case I have three versions of my app I
have the current version I have a
complete rewrite that I'm doing that
compiles for windows phone 7 5 8 and
Windows 8 and I'm not done with it yet
because it turns out that's difficult to
do but it's building and it works and
then I kind of have a future version
where I incubate new features and
special features and in the two later
versions that's where i'm actually using
HTTP client and the code is so pretty
now it's the way that things are
supposed to be
you should always think about retry
policies when you're doing kind of phone
apps some people will actually talk that
what you want to do is go ahead and
always do like you know two or three
back off requests if you have a failure
I don't do that in my app because as
you've seen I don't really even handle
ears properly but the best apps out
there do that I have a friend who work
in the Twitter app recently the brand
new one and they did a lot of work and
retry policies to make sure that the
right things happen there another thing
that today HTTP client doesn't support
is actually gzip compression and it
turns out this is huge when I finally
added gzip to my app there's a couple
new get libraries out there that do it I
literally saw you know just crazy crazy
improvements in download speed because
if I'm downloading a huge payload of
foursquare people you know I'm looking
at you know probably 150 k of data and
in gzip that's often down to about 15k
and so it just kind of flies down the
wire and so jeezy up is definitely
something you should look at using
unfortunates not built into the frame
work today but it's not even built into
like Android by default and we have to
enable it typically so definitely enable
it in your apps if you're doing lots of
lots of downloading on the wire in terms
of the technologies rest sharp is a
framework that makes it very easy to
hook into the cloud and I have some code
here it kind of demonstrates that so
right here is a user request and this is
where I'm trying to get information
about a user and so using using rest
sharp I literally say I want to make a
new rest request the resource is to the
users / whatever their ID endpoint is
and this is a get request here I'm
getting some information about you know
what their ideas that I need to pop in
there and then you just kind of call
methods for adding segments resource
names it's all API driven and so it's a
lot nicer than you know you'll see
applications where you have lots of
string math and string concatenation
this is on the client yes this is the
Windows Phone the legacy version that I
haven't had time to touch so here is the
wrong way to do it and this is my push
notifications connection in the live
application
so it works for a hundred thousand
people but very poorly and so you can
see here is that I have some goo to kind
of get some your eyes but the URI that I
want to send to i'm doing complete
string formatting for and this is dirty
this is what happens when you don't use
rest sharp it's just kind of you know
it's error-prone it's it's ugly it's
tough to maintain but the information i
send might be interesting so i send a
ton of data when i connect to the client
through https i'm sending their push
your eye that's the most important part
i'm sending their of' token so that i
can do work on their behalf on the
server i'm getting information about
their user ID the version of Windows
Phone that they're using the version of
my application how many times they've
checked in with my app how many times
they've used the app who the
manufacturer and the OS version are for
the phone so this is like this is the
awesome data i need to actually debug
for users if you're using as your mobile
services some of this is available and
you can plug it into your app yourself
but this is what i found useful I don't
find it useful to have like unique
identifiers or anything like that it
turns out this is pretty much all I need
but it's a ton of stuff and on the
server side unfortunately maybe I can
there we go on the server side this here
is no DJ s code and this is kind of the
inverse of this call and so it's really
basic I'm hooking up to this connection
URL it comes in this way I just
literally pull all the values out and
then I'm going to go ahead and I
actually do some verification and
whatnot and then i'll actually shove it
into my mind go database and this is the
data use for every user so it's pretty
straightforward of course think about
cashing my app starts up really quick
because I cash this data I don't really
have time to go into too much of that
but I'll answer questions of folks like
logging statistics Logging's impossible
is my message on the left you can do it
you should do logging it's helpful for
debugging but realistically once your
services in production you may not even
need to do too much logging instead you
want to think about statistics and so I
have a server that's called stats d
graphite there's some technologies built
there
it's running a node and Python and some
other tech and I'm running all this on a
Linux VM and Azure and stats d is
awesome because it listens on a UDP
socket and so from my server I'll send
these UDP sockets that are
fire-and-forget they're super
lightweight they'll say things like hey
I have a login or I just had an
exception or some other error and the
beauty of stats d is that you know if it
never gets recorded statistically you
can hope that you still have that data
but your app is not affected in any way
shape or form and so I I actually use
this data whenever I push up updates or
if i switch temporarily from like from
amazon to azure i can actually see what
my bug my bug and error counts change in
real-time using stats d and so that's
actually the best way for me to do
testing is i'll actually switch from
amazon web services to azure for like
five minutes see what you know changes
in my bug count and then i'll flip back
to amazon and so it's kind of funny
people have no idea that they're
changing hosting providers on my side
but it's the same source on both sides
for the most part so it's pretty cool
there's plenty of services that want
like thirty dollars a month for it and
I'd rather not spend that thirty dollars
a month if the azure vm is like 3325
right now it's or something you probably
yeah yeah I guess I just use what i use
today i have a bunch of migration
challenges that i'll jump through but
pretty much out of time so do you have a
question
I'm still using this however yes I'm
saying this is a horrible way you should
not do this and this is in production
right now so yeah so I think that the
rest sharp library is the ideal way to
do it rest sharp and so with rest sharp
it would look more like this where it
would have a single definition of what
it looks like and then I would replace
these segments saying like user version
comma the value I have and it's just
cleaner code it's probably slower code
as well but you know it's just going to
hopefully maintain you know changes over
the years instead of having to dig my
way through these strings so rest sharp
is really beautiful i'd definitely
recommend trying to use that and in my
new version i definitely am doing that
before you can use your own yeah yeah
definitely yeah just don't you know
strings are dirty when it comes to
scaling this one my biggest comment here
is that I actually treat every user a
little bit differently and so if you use
my app every single day I basically give
you the highest priority I will do push
notification work for you basically
every minute I will do all the work i
can i'll give you the best live tiles if
you use my app once every two days I'll
do just about the same amount of work i
will do work for you maybe every two
minutes not every minute every two
minutes but that really scales back my
traffic and my costs if you use my app
once a week I don't really care as much
about you I'll be honest because you
should be using it more often and so I
will do work for you every 15 minutes
and so I have a back-off algorithm based
on how often you use my application and
so if you I kind of just assumed that
people that use my app they're going to
use it often and in return i'll give
them really good response times on you
know their push notifications and
updates but it's actually expensive for
me to do this work all the time and so
by tracking how often people use the app
just based on when they connect push
notifications i can use that to scale
back my class and i've had people on the
web when i blogged about this say that
it's the worst thing ever I shouldn't
trust reit users that way it turns out
you know you need to make a call at some
point on what you're doing and for me
this really really
save me quite a bit of cost and then
just side note if you're doing nodejs
development you know that nets beautiful
but on the node side it's really quick
and it's fun it's JavaScript and I wrote
the the push notification module for
windows phone for node is just a module
called MP and s and it's actually what
also powers the dash or mobile services
and then one of my developers created
the one for windows 8 and unfortunate
there's some differences between the
frameworks it's why it's not the same
library but they're both open source you
can check it out and these are those
URLs my final little plug here is open
source and azure is awesome check out
this website that we have up at github
you can actually look at you know in
fork and open issues and learn about the
team and you actually find the source
then for things like the mtns and
windows notification servers as well so
questions yeah I how have you found here
cost scales so of course does help I
found that my cost of scale of users for
me it's it's definitely I see the users
come in but it's not like an exponential
growth for me I actually have a very if
i look at my download count it's almost
really just a static line so there's
growth that's pretty much well defined
and whenever I get featured in the
windows phone marketplace I'll see
probably a thousand fold increase for
that day and so I actually appreciate
when people send me tweets saying hey
your app is featured in you know the US
marketplace I like should go and
actually add I'll scale up in Azure I
had one or two more instances just to
make sure that it's quick that might not
actually be necessary but I definitely
see the spikes and then long-term it's
it's really live tiles where my cost is
and so for that I don't have a good
solution literally it's costing me more
for more users in that future and so you
know I think things about you know
pulling back how often I update tiles is
really what will save me money there so
again I think favoring the most popular
users might be the best thing there but
that's where my cost surely is
or I could charge a premium yeah I've
looked into that too maybe someday no
how about from the inception when you
first published this and there were no
users as you gained users what did you
see your cost how to cover damage so
when it comes to costs the question is
really over time how is my change you
know how's the change in my bill been
really and for me it's almost been flat
since the start because I kind of went
big from the start and i already had
about 50,000 users when I went to the
cloud before that I didn't actually have
my own cloud service and I decided to
build it kind of to be somewhat
redundant and somewhat efficient from
the start and so I'd be running you know
for VMS in amazon when I probably
could've been running one and so for me
I was I had more capacity than I needed
but it also let me get a ton of bugs out
of my coat when it came to you know
consistency in the code yeah any other
questions or we can end it right there
well alright there's actually one
keeping that almost seen just this may
be rather wrong way to do it I was
engineer so when I look at Cole they're
like okay they are birds thing about
ever my heart state so that's not her
today but almost feels like it's better
to build stuff that works and worry
about engineering later so the gluten
get your sample of course you're saying
do as I say suppose I do yeah so the
question is Jeff wires your code bad and
that's why I'm reading but would it be
right to surmise that don't worry about
the poor quality just go ahead and build
it and as long as it works you can fix
it later I think I Brown is a different
situation in mine I wish that I had
written some of my code better and so if
i look at my json objects i was hand
parsing json in my first version and
there's still parts of my app where i
still hand parse json there's no reason
to do that and so that's just a silly
mistake I was just you know hacking code
real quick late at night I shipped it
and I have some weird bugs as a result
and so that's just it's a bane of my
existence now it's fixing bugs that were
from sloppy code if I would have maybe
spent extra twenty percent maybe I'd you
know sleep better now I think it's a
call you need to make you know yourself
but I think today there's a lot better
tools in there were two
years ago for windows phone developers
so you know there's a profiler built
into visual studio now there's a ton of
good features there and so I think
Windows Phone development in this era is
much cleaner much nicer there's new get
modules when I started my app I didn't
have those those niceties so you know
right some bad code because bad code
feels good to fix but not all bad code
so we can burn you up creating on you'll
satisfy each and every app that isn't
saying environment yep so are you um so
actually in my current the questions
basically for versioning on the server
how do you maintain that so I'm not
actually forking the code because I
don't want to you know copy my code for
no reason today I actually exposed
pretty much all the endpoints through
the same node module and so it's
literally just one line of code that
says like app connect comma V 1 point 1
comma the module and so right now it's
like no cost for me to do that you know
it's very simple and then I have at one
version where I had a slightly different
implementation and so I kind of do have
two different code paths there but for
now I'm not worried about it too much my
app has a kill bit built into it so at
some point I can actually say that
version 2.5 is dead you can't use it
anymore and I store that file in storage
and so the app basically every once in a
while will ping that location and if a
file comes back with a specific piece of
data it'll display the message in that
file and so I could say you know please
update your app this version has been
deprecated and so that's kind of my
solution at that point it be happy to
delete it I've actually only used the
kill bit on a few versions right now and
sadly all the really old versions on my
app don't have a kill bit and so I still
see tests running I think maybe the
Windows Phone team has versions of it in
the test you know harness somewhere
because I still people using a version
that I know for a fact doesn't actually
work you know but it is what it is we
went over that
is there near that you are going to
crack it I mean partly to note that 2.5
is not used right so well the connection
code I had actually spent sends the
actual application version that is in
the client package I send that to the
cloud and so I can actually do a query
on my Mongo database to say you know
what are the versions give me that list
and so I do look at that another thing I
do those I actually do prune my list and
so if someone doesn't use the app for a
month I'll prune that data off of the
database and so I don't have long term
stats there but I know today what the
versions are and it's a little script I
ran to do that and that I also do have
analytics that will show me maps of
where users connect from and what
version they use so the question that we
haven't start off vandegraaff same
number versus working like all along do
people not okay I don't kind of happen
at the time for that so the question was
do you have historical trends and data
and I don't have enough I have the
marketplace data but that's about it
yeah question the back
yeah security measures that's a that's a
tough one so for me I'm just going to
open these analytics real quick for me
when it comes to security I'm doing
quite a bit of work when it comes to
actually protecting my endpoints and so
you know sure as you're secure or
whatever but I protect my credential
files and then I also protect I always
validate the data when it comes in and
so on the server side everything's
coming in through ssl but I'm actually
checking every parameter make sure that
it actually conforms and I'll pumped it
the data that I don't think you know
should go into the data table so that's
a little measure there when it comes to
the client side you know people can get
your OAuth token and if they were to
like steal your phone and you know be a
computer geek but it turns out you know
your OAuth token can be revoked and I
don't store any other data on the phone
that would be an issue there so that's
what I've done but I also know that if I
were to build this app at Microsoft my
manager would have a very different
opinion about privacy and security so
you know you have to kind of make your
own call on my server side I do have a
small amount of user identifiable data
since my app has to actually know where
you were recently i basically know for
any user i could look up this
information and I've kind of tried to
abstract that out so my logs don't have
the data but it is actually in that
mango table there's really no way around
that one without doing a lot of work
yeah question what you protect your
employees
how do i or do I protect my own plants
yeah they can anyone just write that
talk here yep anyone can write an app
and talk to mine but if I can't find
your legitimate push your eye which is
given by the windows phone notification
service on the phone then they're not
going to get anything he'll just punt
the request and there's really that's
like a huge encryption question is how
do you protect your web service
endpoints in the client and the answer
is usually you don't you know and people
will write these Instagram apps they hit
Instagram when they're not allowed to
they have ways of identifying it but in
general it's really hard to protect
those things yep maybe tiny work around
convergence are between your Windows
Phone and as you said you have something
in the words Windows 8
yeah so I do have a version my
application which I build across all
these different things so if i go to my
source code if i drop into the future
version of the app so Windows Phone 8
it's kind of hard to see but visually
there's links here these are all visual
studio links so i chaired the same exact
source file with every single version in
the app whether it's windows 8 windows
phone 8 whatever else and that's taken
work to maintain but it does build so
that's the convergent story but it's
very slow so I wouldn't recommend it for
everyone and I haven't shipped the app
yet because it's been a big challenge
not using a pcl pc l's are great in some
situations but for me the way I'm
structuring my data portable class
libraries don't work for me I'm also a
little bit over engineered and some
things okay well I don't want to keep
you guys too much i'm happy to answer
more questions but we haven't asked the
experts thing and this is just to show
folks that on the analytic side it is
useful know where your users are if i
zoom in on Washington State you'll
notice that most users are in the
Seattle Redmond area there must be a lot
of Windows Phones here so anyway thanks
a lot and I'll be around for questions</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>