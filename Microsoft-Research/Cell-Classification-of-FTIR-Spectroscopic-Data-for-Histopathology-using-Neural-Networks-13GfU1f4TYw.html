<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Cell Classification of FT-IR Spectroscopic Data for Histopathology using Neural Networks | Coder Coacher - Coaching Coders</title><meta content="Cell Classification of FT-IR Spectroscopic Data for Histopathology using Neural Networks - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Microsoft-Research/">Microsoft Research</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Cell Classification of FT-IR Spectroscopic Data for Histopathology using Neural Networks</b></h2><h5 class="post__date">2016-06-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/13GfU1f4TYw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">each year Microsoft Research hosts
hundreds of influential speakers from
around the world including leading
scientists renowned experts in
technology book authors and leading
academics and makes videos of these
lectures freely available
you
um so welcome everyone
it's with great pleasure that I
introduce venture desta who is an intern
on the Microsoft research outreach team
this summer he is a PhD student at the
University of Illinois at
urbana-champaign advised by Professor
min doe his research interest lies in
image processing and statistical
learning and his work focuses on
applications in the bio averaging domain
his talk he's done some great work with
us this summer applying his problem on
Azure applying deep neural networks and
trying some different implementations on
Azure and his talk today is titled cell
classification of FBI our spectroscopic
data for histopathology using neural
networks welcome Ben ok thanks for
introduction Bonnie and thanks for
joining
so Bonnie introduced the tight already
so there's a lot of things there but I'm
going to go through them a little bit
introduced in one at a time with all the
different what all those different terms
are for so as a brief outline of what
this is talk will include I'll first
talk about the application of FTIR or
which dance 4:48 transform infrared
spectroscopy for histopathology and some
of the current challenges with that work
and the motivation for using deep neural
networks in this with us at CI our data
I also talk about implementing dns on
Azure and what Asher can bring to the
table and then finally kind of
culminating all these different steps is
actually classifying cells of fgr data
to aid in the process of histopathology
so to begin I'll start with just
describing a bit about what is Fourier
transform infrared spectroscopy it is a
type of chemical engineering that uses
infrared light so infrared light is
emitted from a source and it passes
through a beam splitter which allows you
have a translating mirror here so you
can change the
phase of the light that's returning to
the original source and they interfere
with one another and they pass through
the sample they're detected and this
detector records what's called
interferogram which we use the Fourier
transform can get you a measure of
absorption so as this infrared light
passes through it resonates with the
sample with some of the vibrational
frequencies of functional groups of
molecules and then it's absorbed other
otherwise it passes through and we get a
spectrum here of four different
frequencies of infrared light
how much is absorbed and how much is
passed as it passes through and then for
each pixel or each each spot in the
sample we have the spectrum if we put
them all together we get like there's a
3d volume so if I look down one pixel
through the 3d volume I'll see the
spectrum and then at each frequency I
have an image which is a measure which
is an absorption map so for every
frequency I'll have a different image
yeah so that's the way that FDR FTIR
works so in the end you have not one
single image but actually at this 3d
volume the resolution of FTIR is about 5
microns so each one of the spectrum
we're seeing the response of possibly
several cells possibly a pure region of
one cell but possibly several cells
overlapping so this spectrum actually
tells us a lot about the molecular
composition of and chemical composition
of what's inside the sample so that's
where its power comes in so normal
histopathology if you want to go to a
doctor to look at a a tumor see if it's
cancerous or not the doctor would take a
biopsy and I strapped a core from the
site and the core is sliced very thinly
into different slices each one of these
slices is then stained and usually using
like H&amp;amp;E staining and from this a doctor
will observe under a microscope the
structure and then from the structure
will decide
a pathologist will decide if if this is
cancerous or not or the grading of
cancer so they're looking for things in
this the structure of this data
so with FTIR we're proposing to replace
this staining stage so instead of doing
the staining we actually image each
slice and we have this 3d volume and
spectrum and then from the spectrum IH
pixel I can looking at the spectrum I
can tell what a lot about the molecular
composition and I can create actually a
map of the different cell types that are
found there so some of the key players
are things like epithelium or collagen
or fibroblast
and from this then a pathologist could
look at this map and make a diagnosis
about cancer or the grading of cancer
and we like to do is to automate this
task of labeling using machine learning
so that's the current process but this
hasn't really seen much clinical use yet
because of a couple of different
drawbacks one of the main ones is that
the imaging is very very slow so the
image of core could take about a day and
if you're trying to see several patients
a day this is kind of prohibitive we
want to see more maybe like 30 minutes
to our patients core not a day other
issue is that to to know what the cell
label should be requires a lot of
insight by a pathologist or someone
who's trained to be able to look at this
spectrum and say what this cell type is
and so the features that are currently
being looked at for doing this
classification they are designed these
metrics are designed by pathologists and
another problem is that these features
are specific to each tissue type so this
spectrum for a certain cell type may
change from breast or to prostate tissue
so if we want to extend it to a new
tissue type then we have to create new
features each time and you know tune
them and engineer them and see which
one's work the best
so this is what we my project is looking
at is this pipeline of classifying this
data so I have my spectrum input and I'd
have some sort of feature extraction
classification stage and then in the
output I would have a cell label so what
we're proposing is to look at deep
learning for doing this classification
process so in deep learning and I don't
longer have the feature extraction stage
I actually just have a neural network
and I can feed into my neural network
just the individual data points
themselves the absorptions at each
frequency as the input nodes to a
network and I can train this network and
and get out the class label so neural
networks have a lot of advantages one of
the key ones for for us is looking at
learning the features automatically so
no longer need the pathologist to tell
me what things are important or what
kind of metrics I should be looking for
I can actually try to learn these on on
our own without any prior knowledge
they've also been shown to provide very
high classification accuracy and a lot
of problems like speech and image
classification but it also we face some
challenges with using deep learning
which if anyone's work with leave
learning you know it requires a
significant amount of computational
resources and parameter tuning and what
is also a challenge is the more data the
better so it's for all these which is a
good thing but also can be a bad thing
it's it's if you have enough data then
it can make and work well but if you're
limited on data it can be a problem
so to help with this computational
resource constraint and parameter tuning
is where azure comes into play so using
Azure for for data science problems we
can actually have great lots of
different virtual machines in the cloud
which I can access through the azure
portal or through SSA
I can be Windows or Linux machines I can
have storage and I can store on my own
my storage accounts a virtual hard disk
and containing my data or blobs is a
type of file storage and I also have
access to api's and Python or different
languages to access these virtual
machines and and my data so in terms of
parallelizing we're distributing this
task it's kind of two approaches that
that our user that we could take so it
let's see did the simplest approach
would be what we could call an
embarrassingly parallel which is the the
terminologies used in this area so
basically on each virtual machine I just
have a neural network and I train
independent of each each other and maybe
I have a head node that kind of
organizes and and distributes the
workload so when one virtual machine is
done it reports back and then it gives a
new job to another one a more
sophisticated method would be something
like that's very Iowa intensive where
maybe I'm training one network and I'm
distributing the work across many
virtual machines possibly asynchronously
and they're all doing different tasks
and reporting back to the head node so
this is more sophisticated approaches as
a more simple approach so this might be
the idea that I of intensive but I
actually think that just doing this
embarrassingly parallel can you can't
there's a lot to be gained as a lot of
the work and time that spend in deep
learning is tuning these hyper
parameters which we can do without the
need for this more intensive
parallelization so also if you look at
the libraries out there another
limitation is that not many of the
libraries allow for that's kind of
intense parallelization so there's a lot
of data there's a lot on this slide but
if you work with deep learning then
maybe a familiar with some of these
libraries but the one I'd like to point
out a couple I'd like to point out to
use and one particular that I'm using is
Theano
or PI learn T which is built on top of
the
so it offers a lot of deep learning
already implemented networks it's also
quite actively maintained and as new
features in deep learning are coming out
they're pretty good about adding them
into the into the code base another one
other good ones are like cafe at torch
seven cafe especially if you're
interested in doing convolutional neural
networks which is something I may turn
to in the future but I definitely would
recommend looking at those as well but
mostly I picked fire one too because
it's very easy to use it's in Python
which is something I'm familiar with and
maybe pretty pretty easy just for
getting started with and if you're
interested in knowing more about these
libraries like you can talk afterward so
I'll describe my setup and Azure and how
I'm using Azure to do that just do this
deep learning training so I have if you
start with the portal and the cloud I
can create my virtual machine and
through the portal and I can SSH into it
I'm making a Linux machine for instance
and I can install all of my favorite
Python libraries or whatever our
libraries you may want to include and I
can create a storage accounts where I
let I hook to the VM and where I store
my FTR data set so that's what I
currently have operating and once I have
this VM created then I can just I just
copied it and can make more instances of
the same VM and connect each one of them
to the same data set and access all than
through SSH and using Python scripts I
can kind of delegate different different
tasks for different networks for each of
the machines so I want to show a little
bit just of my Azure set up let's see
so the portal is really easy to access
it's just managed on Windows as your
comm OOP what I don't seem to have a
server well it's the Oh lost
connectivity let's try again ok here we
go
uh so I can load up the portal and
shares all of my items that I have I
could look at my virtual machines and
here I have five five virtual machines
currently running a group it illinois'
called CI G so I've called CI g pi learn
and then the instance number so I can
look at one of these and because the
dashboard and currently it's not doing
too much this is an eight-core machine
and it has 14 gigabytes of memory so
with as your research for R as edge for
research you can get up to 32 cores
which is what I'm using currently
ranging different sizes and I can also
also have my storage accounts oops you
go so I have a storage account called
CID general store and on here I have my
containers virtual hard drives and I can
see all the hard disks for my the
operating system of on virtual machines
and also this top one BR c96 one which
is the FG IR data set that I'm using and
so on here it's really easy to I create
new virtual machines or create new
storage accounts very easy to manage
everything the other great thing about
this is that I don't have to worry about
actually managing all the hardware of a
cluster or a server so our like our
group that Illinois has an old server we
got from an old group but now it's
basically not really usable as films are
old that it's you know obsolete in terms
of what's what's currently out there but
with Azure I can just have I have access
to the most recent you know hardware and
I don't have to
about maintaining the hardware or
backing up things so it's pretty pretty
nice in that sense okay
okay so now I'll talk just about
actually doing class label cell class
labeling using FTIR so the data set that
we have for our experiments about 97
samples so if you can see each one of
these is a sample like a slice taken
from a core of biopsy so from each
sample there's about 200 by 200 pixels
or so so each pixel spectra so that's
about 2 million spectra of which about
500,000 are labeled and then this is
just one image for one frequency a
response but we would have in an image
for each different frequency band so 501
bands and then there are seven different
cell types that we're looking at and
these ones we've that our labels were
labeled by a specialist and you'll
notice there are some holes in the data
those are not like missing cells or
anything it's just sometimes the cells
make up be constituted of multiple
different cell types or there may be
hard to identify so these ones we have
labeled are what are considered we know
for certain this is the cell type it is
so for using for training and so I've I
split it up into about 70% training 10%
validation 20% testing and this is the
the setup that I am using so i extracted
a spectrum from the 3d volume and i just
store the all the spectra in a to big 2d
matrix so each row is a as a spectrum
and then these are the across the row is
the different their response for
different frequencies and then I just
feed this spectrum into the neural
network this is actually a little bit
misleading because there's not one note
at the output but there's actually seven
for each of the classes so each node
representing a probability of that class
and then for the experiments I used like
2 to 4 layers but this kind of
preliminary work so there's no reason
not to go
for more so I'll be looking to do more
mmm
trying more layers and different
configurations also just using like 100
to 500 nodes per layer but again I
there's no reason that I can't go
we can't go higher then I'm just using
the entire data as the input layer for
500 501 nodes if you're familiar with
deep learning there's a lot of different
activation functions you can use it's
another part of the tuning and I'm using
rectified linear units and softmax
regression for the output and then at
the output we'd be getting actually just
one label which would constituted an
entire cell map the sum of the results
I've gotten just for some of the
networks but that did the best so using
it the rectified linear units for
activation and then some different
configuration of layers and those this
is just the number of nodes per layer
and the for each layer is the first
layer second layer and then accuracy is
around close to 90% but I think there's
a lot of room for improvement so I and
that's part of the deep learning work is
continuing to search different sets of
hyper parameters and different
configurations and different learning
rates can get can get better results so
that'll be something I'll be looking
toward the future toward improving these
results let's see okay so in conclusion
FTIR spectroscopy there's a lot of
potential to provide quality or quantity
that qualitative quantitative
morphological and molecular information
for histopathology and there's a lot of
they're still a great need in
histopathology for more accurate
diagnosis so hoping that FTIR can aid
greatly in that and using deep neural
networks this allows for accurate cell
classifications and hoping to in
continuing to improve without the need
for doing feature engineering or
domain knowledge and with a or we can
you know I was able to parallel eyes
this parameter search which greatly
expedites the process of searching for
hyper parameters so to acknowledge just
some people who were helped in like we'd
like to thank Vani my mentor and
Harold's I just what the opportunity
here to intern at Microsoft and some of
the staff I talked with Li dong
electricial really helpful gave great
insight other interns like David thanks
for the helpful conversations and then
my advisor back at Illinois and the
group we work with an Illinois presser
Rohit Bhargava and other members of his
group so that concludes my talk so
thanks for your attention and if you
have any questions to ask
but yeah I don't think I have a slide in
here for it actually but so let's see
yes I think in the future something
let's go back to the spectroscopy
picture one thing that I we're hoping to
do is to try to take more advantage of
this like the spatial beta that we have
information so not just labeling each
spectrum individually but trying to make
use of the entire entire 3d volume that
would be one that's one thing and also
if I go back to this vista pathology
section there slide I think the ultimate
goal is really to automate this whole
process so maybe we get to the late
decel map and then from the cell map
actually doing using morphological
features doing machine learning on top
of this is to create a diagnosis of a
grading of cancer or labeling cancerous
pixels I'm not a sorry to replace the
pathologist but there's a great need for
the second opinion so there can often be
a lot of inconsistency between
pathologists with diagnosis or even a
pathologists if doing subsequent
diagnosis of the same sample can give
different in different diagnoses so
we're hoping that an automated
histopathology process could actually a
the ada doctor and giving a second
opinion but that's the yeah the future
goal direction of any other questions
long does it take to go through the
process of legally assuming that which
once they're all that works penetrate
put the label of singling missing
spectrum once it's been trained the
labeling is quite fast yeah it's mostly
just in the training it takes a long
time so training these networks it can
take a few hours or several hours
usually for per configuration
yeah that's what I found so far the
labeling is pretty quick yeah no I'm not
using that yeah so I'm not using I'm not
using this method I'm just using the
simple embarrassingly parallel yeah
switch machine has its own set of hyper
configuration of a neural network and it
trains on its own so projects like Adam
do this style of parallelization or
belief net by Andrew um I think what
does something like this but but i but
is not doing doing that yeah Sheen about
the images so when you do FTIR mhm isn't
uh it's not a single slice right it's a
3d when you take do biopsy it's a 3d
mass or not or is it like oh yeah it's
see where was it here yeah it's
so if I have a body in a CT scan I would
say every slide is so when you've got me
a trainee body from CT scan it just
describes the organ and treating okay
but here it's it's not the case right
this is far yeah I said do the arm yes
you it actually would be like 4d
technically because you have yeah
because you have for each slice in the
core you have a 3d volume and then you'd
have so the fourth dimension is slices
I'm just using yapper I'm only
considering like one slice of the core
not at the whole thing yeah but yeah so
I'm just one slice and then I'm using
just just that slice imaging it and
which gives you a 3d volume and then
doing the labeling from there 97
Jase's slices yeah Chronicle orbs you
know
exactly
okay thanks for your attention</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>