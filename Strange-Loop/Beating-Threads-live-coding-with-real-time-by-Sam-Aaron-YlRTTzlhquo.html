<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>&quot;Beating Threads - live coding with real time&quot; by Sam Aaron | Coder Coacher - Coaching Coders</title><meta content="&quot;Beating Threads - live coding with real time&quot; by Sam Aaron - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Strange-Loop/">Strange Loop</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>&quot;Beating Threads - live coding with real time&quot; by Sam Aaron</b></h2><h5 class="post__date">2015-09-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YlRTTzlhquo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you very much for coming and
listening to what I'm about to say I
just want to give you a very quick
introduction and like a few sentences
about what sonic pie is but of course
who has heard of it already Ricky that's
wicked right cool
there's a bunch of talks already I've
given which describe why I've created it
and specifically like this title here
the live coding sins for everybody I
mean that that really is the goal I'm
trying to be as inclusive as possible to
try and get as many people from whatever
backgrounds or whatever age to be able
to have a creative experience of code
that's the ultimate aim and as such it
was born in the classroom created for
school children to use to learn
programming to be engaged with
programming but it's been used by all
sorts of wonderful communities to do
exactly that so it's not just limited to
school children and actually that's one
of the most interesting things for me is
that often parents would come and say I
need to get my son or daughter to look
at something pie and I'm saying what
about yourself right it's not just for
school children but again if you want to
look more about why I've created and
what it's about for their other talks
this talk is about the technical
internals of sonic PI and what they're
sort of the ideas I created and how I've
created them and why because it's it's
be the first time I really I'm talking
to a fully technical audience normally I
talk to school children or to parents or
to teachers and there have to be very
sort of constraint by the language I use
and the abstractions I describe because
obviously they don't have the same kind
of level of technical ability as the
majority of you do so hopefully you can
enjoy a little bit about the internals
of sonic PI and why I created it so
let's continue this is a few things I'm
going to talk about here get some
feedback from that I go to where these
these one two three four five things
place the in thread with the fact it's
live loop and cue sync right by the end
of this talk you'll understand all these
things so let's look at playing sleep so
the most simple thing you do in the
classroom is this now this is really
important because I don't know if you've
ever been to the classrooms recently but
it's a it's a depending on the school
like I've been to loaded
schools recently there's lots of
different behaviors of children and
different controls of teachers and
different attitudes and then in
different social structures and
depending on the age but one thing's
quite common is that you don't have the
teacher doesn't have much time to impart
some information to the class right
they're like clapping and trying to get
the children quiet and then when the
children are quiet what are your one or
two sentences to get children started
programming right if they are open up
eclipse or open up Emacs vim right
IntelliJ whatever right you screwed so
you because like when you open one of
these things it's like which project
what kind of project which style project
where am I putting the project's all
this sort of stuff which is I guess kind
of useful to some professional
programmers I really hate that stuff
personally but you guys are sort of you
appreciate the complexity of your
editors so the goal was from applies it
makes any trivial right so you open it
up and it just opens up like this this
is the full-screen mode right it is just
a normal app look with some buttons
which normally look like this since
we're getting feedback when I stand over
here so I try and avoid that yeah this
is no app here and and so you can enter
into full screen mode for performance
purposes and get rid of the buttons but
you really just need to write play
eighty right just two words play means
to have fun and eight years or how much
fun you want right and that's it that's
the first creative experience with code
and kids they go nuts like that's
amazing because sound is something they
could understand and appreciate but not
just kids but everyone appreciates
making some sense and the thing is right
I don't know have you ever heard of
overtone system a bit but before with it
it Jeff rose that was wicked and I did a
bunch of talks and workshops with that
and it was great because he'd walk
around the hotel lobbies or in the rooms
and the corridors and you'd hear these
noises coming from people's room but
it's like yeah people are having fun
with over to him but but that's all they
could do right they could make these
hideous sounds and so your the goal of
something prior to actually be able to
make it more interesting sounds with
more ease and the simplest sound is just
a sine wave is just a beep I don't have
to design that don't have to describe
what a sine wave is I just choose a note
to play and then the other thing is that
what's a cool thing about numbers what a
numbers do no no no you don't know what
number
they could go up and they can go down
right that's that's what numbers do so
the thing is right then this is like
you're a programmers right so we use
this notion of abstraction and the cool
thing about straps and abstractions as
you take an idea like numbers you can
map it onto another idea which has
similar properties right so what has
similar properties numbers pitch like
the notice this how high or lower sound
sounds goes up and it goes down
similarly we do the same with this but
um the thing is once you've got that and
we can play notes which are higher we
really like that we can play these
things so we play all the notes and we
can play notes in between as finite
floats right so you play in between
notes but at some point we need to play
a like sleep and 1/2 bigger melody so
I'm going to play that note then this
notes right so now when I first
implemented sonic pie this was this is
just pure Ruby I've got a function
called play I'm using Ruby's sleep which
is just going to ask the computer to
sleep for a second at least and then
it's going to play a note 70 this worked
perfect well in the classrooms but
another thing is that in addition to try
and give children a creative experience
of code I also want to actually make
them musical instruments I want it to
actually be something I can perform with
and play with because it's really
important to me to be able to go into a
school and to be able to say hey kids
you could do this if you practice and
learn right and it's not something which
is impossible all that stands in between
you now and where you could be is just
practice and play in experimentation
with the Ruby asleep that doesn't really
work so I mean people keep talking about
tests and types and stuff right I don't
have any tests or types right I know you
should abroad right it's not good I
really love tests so I really love types
but it's not great for everything but we
know software I write I use in
performances which hundred three hundred
four people is multi-threaded right and
it works it's super reliable so you
don't necessarily need these things but
what you do need is proofs so we have
like
we have proofs about the timing model of
sonic pine how it works
and this is nice paper I wrote with
doubly cultured and ellen blackwell and
here we've got like a description of how
cyclize timey model was initially
implemented right and this is
unfortunate so we're playing a few notes
like play see play EKG sleep for a
second play a bunch of the note to see
for half a second what actually is
happening is that the play function
takes time to execute of course right
because if we living in time and space
right and so we have some delta a time
it gets the passes play e now no a delta
a plus Delta B they're not the same
they're probably quite similar but
they're depends on the scheduler depends
on the operating system doing different
things and again by the time we get to
state one we've already incurred three
levels of Delta time plus if the GC
kicks in again more time just randomly
added then we sleep for at least one
second not one second at least one
second we say I like to sleep to that
one seconds but after that at some point
I'm happy to continue right so in the
Ruby Scheidler at some point goes right
you can continue and then off we go
again right now we can see we're just
adding up all these delta x so that
actually the timing or at this point now
it's not all in a half it's all this
stuff right and so if we have a live
loop or a loop looping round actually
there what we're seeing is adrift in
time right if we have two loops looping
around especially on a really slow
computer like a Raspberry Pi because
this stuff runs on the Raspberry Pi
these Delta is actually quite large
numbers and you very very quickly have
this a lack of synchronization because
these numbers add up and they're
different across threats so listen this
is a problem right so the solution I
came up with was to re-implement Ruby
slept sleep so when I write sleep in
sonic PI this sleep that Sam sleep not
really sleep okay and but it looks the
same which is good so they have to worry
about experience of kids and the way
it's implemented going down here no
diagrams is like this so what I actually
do is I have this notion of virtual time
and virtual time is just a thread local
variable okay starts at zero and when I
do stuff it doesn't increase the virtual
time right so the virtual time still
zero after have played the third note
but of course the real time is
moved on because the actual computation
takes real time now when we do sleeping
we actually make sure that this real
time is at 1 right and now we're
including the virtual time so how do we
do that
super easy right when you start the
program you capture the time when you
speak for one you speak for the
difference between what you want it to
be or what it actually is right so
sleeping is a delta sleep not a real
sleep ok so I'm not worried about
seeming for at least not doing that at
or misleading for - making sure the time
synchronizes with that thing and again
we do the same thing so we're getting
these deltas which are incurring only
between the sleeps but actually at the
times we actually make sure that we we
synchronize the thread with an actual
virtual time and what's ross are really
important because of these delta times
they also say what this would make
potentially there's no just slightly
after this notes and i really want them
to be exactly the same time because
these not necessarily notes these are
effects which are have very very very
fine-grained time they want them to be
spot on time with other other other
effects so this delta is not acceptable
and so what I actually do is I have a
schedule ahead time in this case it's a
adding half a seconds on the Raspberry
Pi that's what's needed because the Ruby
process that's drifting around so much
that I have this half a second on the
Mac it's much less that's like a ten
hundred milliseconds and then because a
play the way it works is I actually send
a message over a network to an external
process which is actually making the
sounds and so this this virtual time is
the time I'm actually sending and this
virtual actually the time I'm sending is
that time plus the actual fixed starting
point so when I actually start the
process I taps at the time and every
play is at that time plus this virtual
time so it all works very nicely and
what it also means is that the thread
itself is in synchronization with the
actual time we want it to be so and the
cool thing is that if if all this delta
stuff it's far too great so actually so
why should were actually the real time
is actually greater than where should be
the C just falls through it doesn't
actually do anything at all don't sleep
for any time okay and there at some
point if the with too far behind then we
actually raise an exception
which they timeout exception I can show
you this and then we have like if you're
interested in these kind of things
dominic has made some beautiful like
Haskell proofs to prove this as sound so
that's all there if you want to read
that kind of stuff so let me just
quickly show you this so if I ask it to
seek this and actually do a kernel sleep
for a second and play notes 8c that's
actually working that's nicely why is it
working
oh don't worry if I ask it to oh so what
would kids would always do so this is a
non thing I would observe as they would
create a loop like this play notes a T
and C and ends like this right so what
am I asking the computer to do here is I
ask the kids but when they've actually
done this their race requires blocked
and we have to read like a hard reset
but I say to the children what does this
even mean this is asking the computer to
play an infinite number of notes in zero
time which is clearly not possible right
so let's try that
prepare protect your ears right and it
dies right so we have timing exception
and thread got too far behind time right
so it tried to do it and then like
luckily my system decided that was too
far and killed it off right so this is a
really important thing to be able to
work with so the important thing is like
the the mechanism for time is a it's
really important to be able to deal with
the fact that we want to be on time and
we don't want to be too far behind time
and then we scheduled everything to be
exactly the right time as as close as
possible so that make sense how long
after slowly so that's playing sleep the
next thing was right so once it got that
we could start to teach like basic
things like loops and like I want to
make a melody three times do play you
know 80 or 70 C for the seconds and
combine that with play 90 so the kids
could go nuts and then do interesting
things and we could teach some
fundamental computing science and no
teach loops from teachers eration teach
conditionals can teach randomization but
what happened was the kids would like
write a cool melody like that
I know would write like they'd want to
do that with a baseline so Luke do
sample bass drum house my favorite one
end c4 second but I've got the pace drum
but I wasn't to play at the same time
how do I do this alright and this is not
what I expected like so normally you'd
teach concurrency university level but
these are primary school kids saying how
do I play bass drum they said well it's
an obvious question in a musical context
so like okay we need to teach threads so
I have a seriously right I know I do
and actually the kids learn it very
easily so that I initially built the
single in threads right so this is not
the same thing as a ruby thread it's
built on top of a ruby thread and it
allows me to sew so basically it has the
same kind of properties that I'm gonna
run this closure inside the in thread on
a on a separate thread so that the play
90 is going to happen at the same time
to play 70 and then this bass drum house
is going to happen the same same times
90 cuz there's no sleeps in between so
you can hear three things at the same
time then this is going to go round
every half second and that's going to go
do two more 70s let's hear that know any
action whatsoever what's going on there
well I've killed it Sameer wow that's a
reboot what did I do then I asked it to
play an infinite number of things then
so you play three times then we had the
bass drum going round so be able to do
this at the same time is really
important and so they were able to make
their melodies at the same time but then
it became really useful to me to be able
to think about extra things on top so
once we've got threads then one's got
playing sleep once we got the basic
constructs that Ruby gives us for like
iteration and and conditionals we had a
lot of cool tool tilt tools to teach
computer science but then I was thinking
about how do we move on from that how do
we actually think about teaching music
how do we think about using this as a
musical instrument this so far is
something which has got good sound
timing it's got concurrency but it's
it's it's lacking certain things first
of all we're only making a beep not
super musical and then also there's like
things I really wanted to do from over
term like bring in effects how do I add
reverb to this right I've only one ever
usually alive cutting systems that have
effects in them I just think that if one
person think of it from a program
perspective normally what happens is if
I want to play notes play this thing
through an effect I'd probably have to
do something like create an effect so I
like some sort of reverb new whatever
are equals and then somehow have some
operations at privates who are you know
and then that usually what would happen
is it would be in here some like this
because you don't know where the kids
are going to write this stuff right so
they're going to put they've got a crate
new reverb they're going to play 70
through the reverb through some weird
syntax that I haven't created this is
not gonna work but just imagine it but
this time what we're actually gonna do
is gonna create three reads three
reverbs right and then those three verbs
are going to continue running so we're
actually consuming resources at this
point so we have to tell our children
it's not just enough to be able to know
how to construct a new reverb and how to
point the sound through the reverb go to
consider killing the reverb that's
actually the most hard tricky thing so
at some point you can think well how
where do we kill the reverb well maybe
we need to have some sort of way of
creating a variable which represents a
running synth and then maybe like synth
ondestroy or something I'm gonna kill
the reverb do we kill or something right
we're starting to get really easy to
teach this in the classroom with our one
or two sentences then the problem is at
this point is that maybe well this is a
simple case right that's not listen this
would work right you can imagine this
working but what if what if the in
thread is here all right and we have
some stuff happening here that we don't
know how long it's going to take maybe
it's sleeping for a random out of time
right when and then maybe who got like T
here actions another play why we also
finish the reverb so now I need to do so
maybe this tidak on destroy so we saw in
turn actually a scale our complexity
about how to reason about creating and
just a simple women effects all I want
to do is make a reverb and for it to
work I want to for work through the
threads and so and also I don't know
here I'm explicitly saying play but
maybe I have a function which three
times do plays 80 if rands is less than
1 or not 0.5 right and now I know let's
say can't necessarily capture these as
variables it becomes much harder to
track these synthesizers to make sure it
all works right so the thing is that
this because this is this is looking
ridiculous now at this point to try and
teach 10 year old how to do this by
working on like a callback mechanisms or
some sort of compromise mechanism which
is waiting on completion of synthesizers
we've got some way of we want to be able
to actually make sure that the thread is
completed before we do all this stuff
because it might continue to create
nuisance or we might spawn more threads
which are creating nuisance so it's
really important to be able to wait for
all of the threads and wait for all the
synthesizers to complete before killing
the reverb but even then you can't kill
a reverb because if I make a sound which
is gonna last for a while or even it's
very percussive sounds then I kill the
reverb but it's when when the blocks
finished then that reverb is gonna cut
out what I really want to do is the
reverb to decay through time nicely if
it's an echo to decay a few time nicely
so I need to also sleep for wait a
little bit of extra time for the effects
to complete before I actually ask it to
die which is a lot of work right so what
do you do you actually think about a
system which does all this but raps as
simple constructs so the real thing is
like we don't need any vats we don't
need any of this you know this nonsense
get rid of that get rid of this right
there we are that's fine whatever that
was this is we don't need that or this
where are we now and we're getting there
right so let's get rid of this to the
moment cuz we're not talking about
concurrent anymore so I want to add
reverb to all of this how do I do that
well let's think about its what would
and this is where you think about
language design what is the simplest
thing you could write to say reverb we
say I'd like to start the reverb
somewhere let started on the outer
context and where do I want the reverb
to end here done
Reverb Rio I've owned it with echo yeah
over that came so any code where it's
got threads where it's got iterations or
whatever sleep from end amount of times
will actually work so this reverb block
does all that stuff I just described for
you right so I don't have to teach the
kids this stuff and you can you can even
see it working and they're in the log
step back here like this is all like the
message was sent to super kind of
synthesizer if I if I have the simplest
thing I could write like play 80 you can
see actually that one play eighty has
caused all these messages to go through
like I'm creating synthesizers and
groups and modifying them but it can
even see here that I'm actually asking
the echo to be killed at some points so
it's automatically so tidying up the
work after me and it's doing all this
stuff for me like like even like that
you can see all this nonsense here this
is all the these are all the parameters
you pass all the options you pass
through a synthesizer which is defaults
so it does a ton of work just even like
with one effect in one play that just
sort of hidden behind the scenes this
log is great for for debugging and
sending what's going on which is what I
use explicitly so that makes sense so
now I've got this in this mechanism
where what I'm doing is in this closure
I am capturing time I'm closing over
time I'm closing over threads and so
this this it doesn't just say I want
this to play 18 I'm also talking about I
want to make sure that our waiting for
all the work inside there and define
what that work is to be completely
before I tidy up the echo so this is
really quite interesting so I really
wanted it to be as simple as possible so
I can show to a ten year old kid and it
turned out to be the one of most
complicated things I've ever built if
you look at the implementation of this
it's just a horror show seriously like
100 line function right it's brilliance
and I tried to tied it up and I break it
every time but it really is super like a
fixed points of reliability right now
but at some point I'm going to revisit
it and we write all the underlying
things because when I designed this I
didn't really know what I was building
so you can't really write test for that
I tried to do the TDD thing a long time
ago but it is just a horror show unless
you know it lets me like a fixed thing
you know I want to build
it's fine but when you're really
exploring and having an interesting
ideas then if that doesn't work very
well so it was important for me to think
about what was a simplest thing I could
build and then try and make sure the
system honored that and so this is a
simplest thing I could imagine writing
and I wanted to be able to make it
possible for children to write anything
inside that 2n block and therefore just
work and it just works right well should
I talk about I've told to talk about it
in thread with effects live loop now
this is the other thing so once the kids
have the in threat right so now they can
do this and they can say with effects
reverb do loop do sample bass drum house
there's all stuff of showing you already
which is great so that's going there and
then maybe have another one of these
things and then we want to do like I'd
know and be lunar lands see for four
seconds so I know I got a weave a reverb
bass drum and it's Lindell and going at
the same time using all these constructs
really just described at once
capturing over the loop so this reverb
is gonna be open until I kill it kill
the thread then it will die and you
couldn't you can put them inside that's
no problem - so if I swap this round
this is gonna work
you're creating it in this top one I'm
creating a reverb every time rounds this
one I only got one reverb for the loop
and so this is this is a bad form
typically you can be using a lot more
resources though these are reverb
but it came great interesting effect the
kids are doing this and I I went to
primary school so these are in the UK so
these are like 10 year old kids though 9
and 10 year old kids and they had
created their own sonic PI band and they
had told themselves this syntax
themselves right so I'm saying to you
that this looks maybe this looks
complicated I'm using threads and muting
blocks and using reverbs but the kids
they were doing this and they submitted
a piece to the BBC for a thing called
the ten pieces which was creative
responses to classical pieces and they
became a finalist and this is how I knew
about them I watched a video is amazing
and so this is something that
ten-year-old kids can teach themselves
right with just reading a Behrman
tutorial and so but the thing was I also
wanted to be able to do live coding I
wanted to be able to modify this on the
fly so this is it this is this is enough
for composition right so I could talk
about things happening at the same time
but what I've got here something which I
can essentially press play and listen to
but I can't change it I can't modify it
I can't go on stage and perform with
this I could just start one piece up
press stop what I've had enough maybe go
to another buffer start another piece up
and do it like that but I really am
interested in changing things and so
there's a really easy way to figure that
out so if I create a function define foo
which is going to have this body here I
can do this and now I want to change the
bass drum Harris to a choir
it's working nicely and would have
actually had God now you do hear that
actually got to Flyers being played if I
try and train to something else maybe
like a play there's actually three races
now because every time I press run they
create this function that's finally
understand that it creates new threads
right which is looping called that
function so I press run three times I
have now three threads all calling
through with slightly different phase
offsets and then I've also got three
loads of these ambulinia lamps so where
I'm live coding I don't want to
necessarily be adding new things I want
to be changing the things which already
exist so how do I do that something in
our since that's a tough thing so that I
created and the reason why I've got this
in thread is because many reasons really
that the way it works is that it's all
about thread local so these threads have
their own logical clock so that timing
thing I showed you before this this
stuff wait
this stuff here this this this logical
clock here is virtual time it there's
one of those per threads right so each
thread can have its own time there's no
global bpm there's no simplistic thing
like that I can do quite interesting
face patterns with this by having
different threads operate with different
speeds and that's all totally possible
and so the in thread allows me to store
the current time and the current
synthesizer I can change the synthesize
at the top here use synth tb-303 play
notes 60 cutoff 70 it's used since at
the top defines a thread local variables
that saying this is the current
synthesizer this function has no idea
about that it's not closing over that at
all but this thread inherits the thread
local variable so it's local synthesizer
is the tb-303 so when it it's looping
calling that function that's then set as
a thread local so that functions
definition it is able to know which
synthesizer it is because it asks the
what what is your current synthesizer so
this inheritance thing works really well
and so I have the infrared for that but
I also have the in thread because I can
give them names so if I look at the
documentation I can say look and give a
thread a name make this thread a name
thread with name that's a really good
documentation string should fix that
name foo like this and I give this one a
name name bar like that and find out the
name because I need to give it a keyword
super annoying Ruby Center right so this
works so now I've got the same things
but the real business having names and
just the lows means that I can change
this thing here and I'm not adding new
sounds right so what the name threads do
is they basically say if there's no
thread with a name i crate it that's
great and if I try and create another
thread with the same name it's a new
lock right it doesn't allow me to do
that so only one thread with a given
name can exist at one time so that
allows me to do live coding so this is
what at this time last year probably
when I gave a demonstration at the
keynote last year this is the state over
that's right
had ability to do this kind of live
coding which was basically creating
functions which we're dereferenced by
threads which were names which then
allowed me to basically just do what I
just did then to live code by just
redefining functions and not necessarily
creating the new threads but using the
threads which currently exist but this
is this is getting to the level of
complexity of the with effects thing
where it's time to get hard to teach
kids how to do this right
you could have create foam cones you got
to give for it named threads their names
but a loop in the function looping the
thread calling this function right so
this is this is tricky so this is where
you like to think about how to as a
programmer what's the solution to this
is to create a new abstractions to
create new way of thinking
so there's a thing now called the lively
she call foo which I can do exactly this
I can take the body of this and put it
in here and that this live loop here is
a contraction of all of this nonsense
down here right so the live loop is
three things it's it's a function called
foo right so this will define a function
called foo with that as the body that's
the first thing it does right and so I
can when I when I that's let's just look
at this let's get rid of all this stuff
if I create this well we have this same
behavior but in another buffer I can
call foo and I can get the value of it
right so that's working notice that over
here it's playing it with a beep because
the current synthesizer is the beep
whereas here the current survived since
I was at tb-303 so the thread-local
thing really does work all I'm doing
here is calling foo which is calling the
body of that live loop just once because
it's just a function ok and then in
addition to that it creates a named
thread with the name foo and so that
then has the body which is to loop
calling the function foo so now we've
got two things called through a thread
and a function and function that the
thread is calling through the function
repeatedly and then that allows me there
and so if I run this code if I if I
started off and change the codes
what actually is happening there is that
I am redefining the functions why are
you hearing the behavior change but I am
NOT redefining the threads because the
thread was already named and one exists
so I had this ability to change it on
the fly and now are in a position where
I could teach this two ten-year-olds
again which is brilliance all right so
I'm seeing 10 year-olds using this stuff
and it's really trivial for them to pick
up and they can actually start to live
code now because this construct is much
easier to work with now the one last
thing I wanted to talk about is the Q
sync mechanism so what's interesting now
is like the last two abstractions are
described are not that useful for
teaching the curriculum for computer
science right concurrency is not really
the curriculum that was like an
extension
no that was where I've started to break
out of that but live loop that's not in
the computer science curriculum who
knows about live coding in school that's
good nuts and with effects what the
hell's that got to do with teaching
sorting algorithms right so this is not
these are not ideas for the curriculum
but what they are ideas for is for
engaging people in the curriculum and
there are ideas for having a lot of fun
because that's what
why are you engaged as it's because it's
a load of fun so with effect allowing me
to really be have fun changing the
sounds changing the properties of stones
the live loop allows me to do
performances so if you saw me perform
last night all I was doing was creating
these live loops had a bunch of them
going and change them on the fly that's
all I do
so you can totally do this as well it's
super easy but one thing that happens
when you're performing is that I might
have a bunch of these things so let's
have a live look foo a live Luke bar and
in this one all I'm doing is doing the
bass drum right so now we've got these
concurrency which is great if I want to
make the bass drum go faster that's
change this whole time but now I'm going
to introduce an error sample did you
mean sample yes did me example okay
thank you
so I'll then fix it so I know so it's
working but they're out of sync
well actually out of phase they're
installation so you know like even a bit
of down to the dance floor this is not
necessary what you want you want things
to be like time so how do you fix this
right the simplest way to fix it is to
stop everything because as we know when
we start the program we have a virtual
time of zero and those virtual times are
inherited by both of these live loops so
when I started again they both start
with the same time and it's a long time
right so that's one way of working but
can you imagine right when you make a
mistake you got to kill the whole sounds
right people play dancing on the dance
floor right what's going on
case it's made a mistake and fix it and
now we can start dancing right so so the
solution to this is I need a way to
actually to be able to fix it without
stopping the threads alright so this is
this another problem how do I do that so
any other ideas how you might do that
you should know because I've already
told you the answer it's called cue and
sink whereas the cheat sheets there is a
cheat sheet cue and sink right so what
is Q and what it's sink well we actually
noticed or whatever has a way of saying
synchronize aren't foo play sample and
be lunar lands right play oh and there's
no sound but you can see how the logs
here I'm synchronizing on foo so that
thread is blocked still running it's
still alive if I had effects look if i
if i stop this and i put an effect
around that write that effect has been
created there's a reverb running in
supercollider right now on that machine
it's really exciting you can't see it or
hear it but you got to believe me but
actually don't need to believe me
because if you look at the logs you can
probably see that create if you can if
you can find the right bit there's
definitely a reverb in there so the
thing is that what I've got there's a
mechanism for blocking so kind of like a
cloture promise so it's how I've
actually implemented these things and so
it's just blocking on the thread so what
I need to be able to do is from another
thread cue food when I run this it's
going to send a heartbeat message the
whole of sonic pies runtime system at
any threads which are blocked syncing on
foo will then wake up and make a sound
let's see this happens from this Hey
look at that you can actually see here
over on the logs here make it clear that
each each thread has run which is
wintertime press to the Run button it's
like the main thread has its own unique
ID
it's an incrementing integer so 35 which
is I ran before 36 was synced syncing
and then you can see that it shows you
synced and it's also inherited the BPM
this is the clever bit and then playing
it
Paul play the notes and then and then
it's finished and you can also see here
that 36 has queued it out so this is
what you can see here like there's a
race condition in terms of which gets
printed first but it doesn't really
matter in that sense but what really is
important is that we have now a way of
asking something to wait for something
else and what's really useful is that if
you notice over here if I move this over
here like no it's not nice this if I get
rid of comment this out we should notice
that every time it snow goes around I'm
actually calling you message so by
default live loops I'll send a copy
every time they go around right no one's
listening to that no one cares about it
but it's staying right so this is you
there's the fourth thing that I am going
to do is they also queue every time they
go around you can disable that if you
want to but they all so cute and the the
the really important thing that got got
worn it left I said it's not just enough
to wait for something to say go and then
go because we enter the same kind of
problems we have with this because we're
gonna have some delta T between so and
saying go and then you're going okay I'm
going right because the scheduler has to
tell you to go so that gives you this
give you some CPU time and so whatever
subscribe is not enough to be able to
fix that so the final piece of the cake
the final thing is that when I sink in
queue the the thread which crates the
queue message so also sends out its
current logical time it's part of that
message so the thread which then gets
synchronized with it gets its own
logical time completely clobbered and
it's replaced with the thread the local
time of the thread which created it so
that way we have absolute guarantee that
these are completely in sync with the
same time and also it inherits the BPM
which is the thread local so just as a
final demo of how it works it's going to
be amazingly glorious if I if I start
these off but then I make a mistake
boom no fix it up now you can hear that
out of sync right it's all I need to do
is ask it to sync now it's back in
Civilization again right so totally work
so if you're performing and playing
they're totally able to make mistakes
have only part of the system go down
because only the thread which twitch
which made a mistake dies the rest of
the music continues as you heard then
you have an ability to fix it and sort
it out
whilst the music's all going whilst that
people are still dancing saying well
there's a bit of sound gone but it's
still pretty good
and then you keep the kick drum in and
then they go nuts and it's also a way of
like adding drops you know and adding
beats and when you want it to you can
sort of set a bunch of live loop so it's
ready to go
stinking on something then you can queue
it in one go and you can sort of create
multiple live loops at the same time
trigger them so you can sort of set
things up stage them up and and and fire
them off at the same time that makes any
sense so hopefully that makes sense I've
just tried to give you like a background
of some of the interesting sort of ideas
of hat so implement their motivations
why to make these things possible to
make it easy to teach you a 10 year old
and also a tool that I can use to
perform with and more importantly a tool
you can use to perform words and I
really hope you do I really hope that
you can see that actually this is not
too hard to get started right and just
to just to finish I got Rory one minute
over time but um there's a help system
with a complete tutorial for you to read
it's written for you super simple and
then there's a bunch of examples and all
you need to do is copy and paste an
example and because we have music as
text it really just does allow me
I think is a moment away communicating
to other programmers yourself I use it
as a way of mixing in a sense so
hopefully you can see that this is all a
thing that you can use right now and
hopefully you can also sort of see this
is something you can show and share with
other people because one of the things
that frustrated the hell out of me is I
have such a exciting interest with
programming but only people like you
would listen to me right which is
brilliant thank you so much it's
fabulous but
but there's a lot more people in the
world that could also enjoy this and so
hopefully tools like this will help us
help other people understand these
things with greater clarity so please
spread the word please give me some
feedback please play with it and share
your drawing of love coding with as many
people as you possibly can thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>