<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>&quot;Architectural Patterns of Resilient Distributed Systems&quot; by Ines Sombra | Coder Coacher - Coaching Coders</title><meta content="&quot;Architectural Patterns of Resilient Distributed Systems&quot; by Ines Sombra - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Strange-Loop/">Strange Loop</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>&quot;Architectural Patterns of Resilient Distributed Systems&quot; by Ines Sombra</b></h2><h5 class="post__date">2015-09-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ohvPnJYUW1E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everybody this is architectural
parents of this resilient distributed
systems my name is Anna Sombra and I am
an engineer a company called fastly this
is how you get a hold of me and I'm also
part of an organization called papers we
love hello to all of the organizers and
speakers that are here whoo yeah so on
hello to everybody that is watching this
from home if you're watching this talk
or any strange loop talk and you don't
know what papers we love is I highly
recommend that you go and join your
local chapter because it's awesome so I
will fastly I don't know if you know
what fastly is this is kind of fuzzy
it's a content delivery network and
basically said globally distributed
network of service servers up so you
should really check us out we had a
booth here we shut it down so we can all
be here but real times are things so if
you're interested just like ping us
after the talk let's talk about what
we're going to cover today so we're
going to go on a journey together and
first part we're going to try to figure
out why we should care about this thing
called resiliency then we're going to
check and see what the literature tells
us and then see what the industry tells
us about it and then we're going to mesh
everything together into this big huge
pile of conclusions so I've actually
thought I was going to go somewhere else
huh so I don't know how many of you have
seen my talks before if you haven't seen
my talks before ah this is my obligatory
disclaimer slide think so you can expect
from this talk I put it in this little
table over here so you can expect pugs
fast talking life pondering and
tweetable moments because you may want
to tweet it but I'm gonna speak really
fast and you won't be able to so it
let's not do it
Monte Fester's what surprised me this
year and also wedding trivia so so I'm
getting married in 20 days yes and I
kind of underestimated the amount of
stress that you would go whenever you're
about to get married and you have to
make a talk so this talk has a lot more
of me in it because I am unable to
filter out the things that shouldn't say
so yeah also apologies to Norma whom I'm
gonna torture through the duration of
this talk trying to see how fast she can
she can close caption this so yeah what
resilience so
my year ago did you say something yeah
yeah good so so year ago I became with
the stupid assistance engineer so before
I used to dabble and and I decided to
just kind of make it official and see
what it looked like from from the
engineering point of view and then just
actually do that as a daytime job so I
switch jobs and I started my first day I
saw the studio system engineer and then
I realized quickly after that my entire
perspective had changed so before it was
kind of like more operational some more
orchestration and a different thing and
then now I had to like help construct
these systems and help the system stay
up and that was a little that was a
little different so everything that I
had read before and I thought I
understood all of the sudden became just
like everything that I thought it was
obvious once I was in there in the
middle of it it didn't really become a
Soviets anymore so so it's like
everything changed and everything all
became new and then I had to go and read
the same papers I had read before with
no contacts with much much more context
so I started wondering one of the things
that I'm gonna make to this particular
application that it's gonna actually
like make it less less robust and and I
noticed that for example when I
interacted one system I cost
availability problems in another
basically means that I just like funny
brought it down so so that was like yeah
I knew that this was gonna happen but I
didn't think it was gonna happen to me
so so yeah so yeah it happens to
everybody I guess and then I also had an
opportunity to start like a new
prototype and in that prototype
everything that I had read before
actually kinda like loomed over my head
and it was a little paralyzing because I
didn't know what I was going I would if
the things that I was making at that
moment we're gonna be like the biggest
pieces of that everybody that works
with me has seen or not so the key to
that the key takeaway is also copied the
patterns that are already there because
they've already come up with him so that
was a good initial initial thing so
let's talk about resilience so for the
sake of this talk I'm gonna define
resilience as the ability of a system to
keep working or other that whenever
things that are expected or unexpected
happen so in the resilient bag the
resilience bag I'm also going to put
fault tolerance evolvability scalability
failure isolation and complexity
management because we only have 40
minutes and I can't speak fast but not
that fast so so as I was starting to
work on
yes I also like then it was it's been a
year over like churning and churning and
this is kind of like what I wish I would
have known when I joined a little bit
and it's just kind of like okay they're
like very humble like points of views
but but I had to like actually work to
get here so this is interesting
but at the end of the day I think for me
resilience is what really matters so so
you can have a nice UI you can have a
really good product and if you have no
solid foundation to stand on it will
cost your business things like resources
operational expenses time and you may
even cost your system customer you may
even cut cust customers customers so so
it matter it's an EDC matters to me so
whenever now I'm undecided to think or
I'm helping with something else the
first thing that is on my mind is
resilience and everything else it's like
well my code maybe not pretty or me I
mean we may now be used in a language
that is like super awesome but but
resilience is like now where it's at the
forefront of my mind so I said that we
had like we had read some literature so
a lot of literature and then there were
three models that actually stuck with me
and change a little bit of my
perspective even more so they're going
to go through them fairly quickly but
but and then we're just going to carry
on so the first model that I picked is
called harvest and yield and this paper
is a little dissing oldie but goodie it
was produced in 1999 by Amanda Fox and
Eric Brewer and I read it recently again
from this new this new life that I have
now and I think the reason that it's
like it's still like so poignant and
install important is because it
formalizes the concepts that we use now
to build this tribute systems and then
also it gives us some ideas of
strategies so we can enhance system
availability in the presence of failure
also it gives you some patterns that we
can never even use to make things more
resilient so this paper has two concepts
that are like that the it relies for
everything else that it tells you and
Widom describe them again very quickly
we have yield that is the fraction of a
successfully answer queries and it's
kind of close to uptime but it's not
really uptime so for example say that
you have something that sells and
then this is Christmas and people are
trying to access your store you have two
minutes of downtime that has a
completely different yield than if your
site goes down for two minutes on a
Wednesday morning at 3:00 a.m. so so it
said it said it's much more related to
user experience and then uptime
asymetric miss me missus
so the paper tells us that we should
focus on yield rather than uptime
harvest now it's a fraction of the
complete results safer I've already
exempt from CODIS which basically is
being quoted all through these commerce
this talk so it seems like Koda emerges
once every year publishes a few things
and then we use his like slides forever
and ever and we compose grade very talks
but it's all of it like just go check
that that the reference so thank his ask
he says he tells us that we can have
like okay this example where we have a
cute baby animals and the indexes are in
different service servers and and I want
to search for cute baby animals and then
my server bit goes down but you can see
that now with one server gone I can have
still 6% 66 percent of harvest I'm still
how can I like like offer something that
would be acceptable to me like I would
say cute and animals there's bound to be
babies there so so yeah so again those
two concepts are very important but I
what I want to like emphasize is the
strategies at the papers that the paper
tells us so the first strategy that they
say they tell us is called probabilistic
availability and this deals with
graceful degradation of services as the
systems on the fault and then they also
tell us that we can use randomness that
is like we can make the same case we can
even out the worst case on the average
case scenario this is for example if I'm
going to distribute my data like
randomly through all of my notes on one
of my notes goes down and at least is a
random portion of my data and then it
also tells us that we can replicate high
demand data that is like high priority
so we can just actually control a little
bit or harvest so the likelihood of
losing that if one node is it's like a
little bit lesser because it's copies of
it exist in more places and also they
tell us that we can use decreasing the
result the greater result is almost like
what we've done is so with with harvest
that base is based on client capability
this is for example I have my phone and
I want to watch a video and my
connection is not great and I get a
lesser quality of video but it still
like it's fairly ok the second strategy
that they tell us is called
decomposition and orthogonality and this
fields was like we pushed down
everything instead of like having it at
the top level we push it down into
independent independent subsystems that
they may or may not be tolerant to have
a segregation but our entire application
can continue making can continue
operating if those subsystems fails also
this gives us
entity of only having to worry about
providing strong consistency for the
subsystems that needed and I hope that
I'm keeping at a good pace and my sis
too fast or too so I'm okay okay cool so
I've been told that it's okay
and then we can have a leverage
orthogonal mechanisms and this is for
example when you're trying to I I care
about security and I'm a leverage like a
library or something that does
encryption and security for me but I
don't have to actually build it or
codify and like a security thing in my
my application so we have then the
concepts and then we have these two
strategies that the paper proposes and
then but the thing that that was made
the most impact for me was that if your
system favors harvest to yield it's an
outcome of the design so so in a way
this was something that either is like
the most useful thing for me because
they're basically the things that we
actually have to pay attention to when
were there so the next model that I had
is it actually comes from healthcare
industry and I'd really really like this
one as well and they say that okay that
the systems tend to be always at
operating at the edge of failure because
we always want to maximize our system's
capacities and that any system that we
launch into the world and starts to get
used and it's relied upon is going to
become safety critical so in this model
they have the world and the universe
where we have three boundaries the
boundary on the pink is the accident
boundary then we have the economic
failure boundary and we have the
acceptable and unacceptable workload
boundary and then the thing in blue is
the operating point so it's kind of like
where we are in the world so we have
pressures that come from from one set of
boundaries say for example we wanted to
make this more efficient and then it
moves the operating point and then maybe
say we have like okay reduced cost and
then the operating point you suppose and
then at this point we have an incident
whoo so because it crossed the accident
boundary so we really don't like to have
an incident we don't really want to have
outage problems or resilience problems
in our application so we're like okay we
crack down and be like let's go and
launch a safety campaign and the safety
campaign moves the operating point back
from the accident boundary so we do this
over and over and then at some point we
realize that maybe there's a
a bit of a buffer between the accident
boundary and us so we end up creating
what is called a marginal boundary and
we have this little thing that is like
our perceive there are empirical error
margin so that this is very nice and
then this keeps going on going on and on
so this the operating point is always in
motion it always moves and at some point
we may or may not cross the accident
boundary depending on how how we how how
we are close to depending on our
position today to the marginal boundary
so say that we were to zoom in into the
accident and emergency landing
relationship then is okay like so we are
like really good at getting used to like
not having outages and then our
operating point is in an acceptable
acceptable place which is like on like
inside the marginal boundary but it's
like okay maybe one day accidentally we
go over it and like oh we freaked out
and then just like Oh like we should do
the things that way that we know how to
how to do them and we go them back into
the marginal boundary and where we
consider acceptable but you know what
like last time we didn't crash so
it let's let's go it again and you're
like okay we're didn't crash here either
so well maybe we go over this way and
then maybe move over this one and we
kind of get comfortable in this point
where we know that we're already close
to the edge we already know what the
edges but at this point we just like
started living really close to it and
what enough ends up happen and he said
you end up defining a new marginal
boundary so what you're going to fail on
it's not likely to change but then the
your closeness to to to the error it's
like it's much much it's like it's more
it's just much more closer to that
obviously we have many examples of this
and now I see it everywhere this talk
for example is like me like right next
to my my accident boundary like yeah
it's like right there so so yeah so I
guess you can tell me well this is fine
it's like we're still having crossed it
this is great so yeah maybe obviously we
don't really want to do that as I told
you I am trying to be at this point in
my life concerned about resiliency so I
would not condone this this this this
way of living so okay so what are the
insights from from the cuda model that
cook tells us and then this is again
from the health care scene industry they
say that in order to
engineer something with resiliency it
requires a model of safety that is based
on mentoring responding adapting and
learning also that the system safety is
about what can happen and where the
operating point actually is and what do
we do under pressure actually in their
study they said that the difference
between hotels hotels hospitals with
high mortality and no more a low
mortality rates it's like the way they
respond to the incidents like the
accidents happened in both of them but
one is actually like much more adapted
and fluid and they Sable to like not
kill people nicer or better than the
other one so so yeah don't keep people
but the thing that they tell us too is
that it's resilience operated it's like
this resilience it's also like focus on
the operator community so from the
harvest ano we have designed from this
one we have actually the a case for why
operations matter so all right how do
they tell us that we should build the
resilience in our system they tell us
that we should actually like build
support for continuous maintenance that
seems reasonable also that we should
reveal the control to the systems for
the operators and actually reveal the
whole control because basically they're
going to be the ones that are dealing
with your your system we may agree or
may not agree on that one but this thing
that is that is important or at least
the thing that stuck with me is that
basically you should really know that
your that your system is going to get
moved replaced and using voice you
didn't intend like period it's like it's
going to happen and then you should also
think about your configuration the
center phases so that that is a cook
model so for the next one I went to a
friend and I was like okay so what else
can I do
give me a different perspective and it's
like sure just read this paper and then
read this paper and then read this paper
and then this read this paper and it
went on and on for like two weeks so I'm
just going to call it the Borel model so
it's Paul boreal if you were to Chris's
talk he also like mentioned things to
Chris so this guy is kind of prolific at
the reading papers and then bombarding
you with them but they're very very good
so in this case I'm just gonna take a
little bit of Liberty and and and just
like not show my work but tell you the
gist of what I got from all of those
papers too because I wrote them so they
give us a different visualization for
system complexity so they said that in
one side we have the probability of a
failure on the other side we have the
rank and the rank is defined us the
order of the most probable to the least
probable
and with that but also like this and
then there's area sub where it's like
really at least probable most probable
is you cannot we're gonna address with
traditional engineering then we can go
to this thing called like reactive
operations where like maybe we cross the
error boundaries like we shouldn't do
this again and then we now we put like
either into a playbook or something that
we do and then there's this area
kong-kong which also peter baelish
cover but he spell it out i kind of like
the young conch because it's kind of
sounds like skunk or whatever but it
means are known unknown so and this is
where you have the cascading or
catastrophic failures so you don't know
what they're going to come and and and
the thing that my chart doesn't really
doesn't really display very well is that
it goes on and then eventually the area
of this unknown it's going to be as big
as the other two combined so trust me on
that one I don't really have time to
make it even prettier than what it is so
what so ok another thing that they tell
us is whenever we scale the areas under
the curve start to change and then that
we can truncate different a little bit
by explicitly like putting some
mitigation in place but then we
renormalized on the tail starts getting
fatter and then the onk-onk beacon
begins to like dominate more and more
it's like this is a system start scaling
up so the interesting thing is like it's
gray alright so we first like HUD design
then we had operations and now we know
that maybe we're just like our attention
should be split in three in three
different places where we can have
engineering and there's other thing that
is going to come and get us and we
there's nothing we can do so what is the
process is that okay this this different
things that we have in our world should
require different strategies of attack
or different different mechanisms so
like different failures should route
should match two different strategies in
order to like to like be concerned about
them and then but he also mentioned that
it will be really kind of cool it's like
basically we have the Kingsbury on one
side it's like and then we also have
like just the other on the other so this
is kind of like the embodiment of the
strategies and if you're building a
system you imagine getting your report
card from those two guys combined so
it's like you never never leave the
industry forever and then start weaving
baskets or something but but yeah okay
so like we need different strategies so
what are the strategies that we have
what are the tools that we have for each
one of them for example for classical
engineering we have things like code
standard
a programming pattern testing you should
just the full system by this point we
should know that the full system is the
client the code the provisioning code
and also maybe your operations start
mattering from the from the from the
model before right and we should have
metrics on monitoring all of this should
be your MVP you shouldn't wait until
like you put the system in production
they're like ha how do I see it and also
another thing that is interesting with
classical engineering and some of the
other papers that are read but basically
we're striving for something that is
good that is a convergence to a good
state so we want the system to be able
to at least like kill itself enough or
just like not freaked out enough to the
point in which you can just go and then
start like behaving the way that we
expected in reactive operations where
things like hazard inventories
redundancies feature flags there deploys
run books and coke and dogs and Canaries
and things around and then the unknown
unknown we have things like system
verification formal methods things like
Fault injections because basically this
is the area that we just don't know we
can't predict we weren't able to see
because if we were able to see we were
already engineered for it but the goal
of these things are saying that the goal
of like everything come by well the
first two combines the other ones you
can do much about it but it's to build a
failure domain independence so so it's
like if there's a failure on this area
of your system it won't take down your
entire application so again we can map
it down to the first paper and then we
see like this ability to like to respond
to failures if it keeps popping up again
and again which means that maybe I weave
my topics correctly so yeah so okay so
from the boreal method
the thing that I took away from is that
okay thinking about resistant resilience
means that we have to use more than one
discipline in order to in order to just
like attack it properly so it's one
discipline is insufficient trees more
and and and this is what we take away
from the third the third literature
model that I that I I prepare for you
but I also this kind of sucks right
because we have to like they protect
ourselves again three different fronts
now so it kind of follows our intuitions
but it's kind of like a bummer as well
so I promise you what is trivial now so
I wonder if you do what this is this is
a wedding cake ride it's like wrong it's
not a wedding cake there's this session
on Etsy where you can get fake wedding
cakes this one for example it's 160
dollars and it's fake is basically
styrofoam with some sort of sugar thing
on top that looks like a wet
cake so you could while your guests with
a wedding cake I'm for $10 more you can
actually have them carve out a little
piece so we can shove some real cake and
then you eat it and pretend you have a
little cake and then you serve your
guests really cheap cake because kids
are really expensive so also the
wedding industry is the worst so if you
were wondering how much it cost you to
have a 20 to 35 minute ceremony in San
Francisco you are looking around six
hundred to a thousand dollars another
one so that's great right mmm twenty
days I don't have an officiant yet or I
kind of have one in the works but who
knows so yeah not stress about that one
either so okay let's talk about
resilience and industry so it wouldn't
be a distributed system stock if we
don't quote like the soup the system's
poster-child so I go and then here's my
Netflix thing so I do want to lead some
thoughts so my matrix with sparkles so
so okay
so what did I pull for it like for the
Netflix our best literature so we have
this blog post a while ago a few years
ago that they talked about their their
API and how they're doing folder
isolation at the API level and then they
found out that okay the API as we
probably know it's inherently more
vulnerable to any system failures or
latencies in this tab we probably know
this I know this but then I was causing
availability issues in our appeal I
never said what the is the signal
staying up so so yeah so sometimes you
need the contacts they also said that in
their system without any sort of fault
tolerance and when it would when you
have like around 30 dependencies that
they were all around like four nines of
uptime it could resolve them in about
like two hours of downtime per month so
now great right and the way that they
solve this is by the day you actually
use client libraries and they provided
its client libraries to the rest of the
organization so in here for example in
this picture you have a request and it's
just finding out like things to the
dependencies and this is how I look like
after they architected it so basically
they created pools for each type of
dependencies and they started using
aggressive Network timeouts retries or
semaphores they also did lab ok I told
you just now that they separate their
threads when apart dependency pools and
then since they had timeout basic
we wanted to prevent this thing for
threads from locking and inches
consuming all of the resources on the
pool the interesting thing is that they
talk about like circuit breakers as well
and then it means that basically say for
example they notice over 50 percent
error rate on a span of 10 10 seconds
then they will back off and then chest I
try to relieve the pressure and only
start sending things to the system that
they were talking to after the health
check like came back came back ok and
actually they said also to that
exceptions cost the app to shed load
until things are healthy so again we've
seen this before in the literature
section with our first model all right
good so that is Netflix we can get move
on to the other one because instead of
having one poster child I'm gonna have
to yeah okay this is Google and they
really find the logo so now Google has
gotten skinnier and if you're preparing
for a wedding you have to do that too so
yeah so okay which paper from Google I
really really love I when I was reading
this I think they want to stuck with me
the most was the chubby paper and then
they try paper describes that the
locking system that they have and it's
coarse grain and then they also do file
a small file storage but then the reason
that this paper is really really nice
it's also because it describes their
thought process and what it looks like
whenever you're building something for
people that are in your side of the
fence so you can't really call stupid
but they're kind of there so you like
you kind of want to go and enable them
as well so the key insights for the
chubby paper for me were that okay they
also dealt with this this this decision
between a library and a service then
that fix people use a library and the
particular like blog posts that they
mentioned and in this case like the
people from Google decided to go on and
build a service and they build a service
and also they did the client library so
they helped control over both of the
those both both of those two things this
is probably the thing that is a bit slow
as I've said right so okay so they also
did a storage for they also like bid
support for small data files and and
they did that was to get the operations
that you could do with the files and the
receipt a layer you just couldn't pull
up with like something like huge so it's
just like very very carefully like
delineated of what you could do what you
couldn't do and the paper instead of a
lot more as well because they said that
engineers they found that their
engineers don't plan for availability
consensus primary elections failures
their own bugs operability on the
ughter also they don't understand
distributed system so like I like I
said yeah everything is awful
so uh so yeah but okay fine just I guess
they just had something and you use it
and then like it wet yeah so so I've got
more key insights since we're here and
then we're just already depressed
centralized services are hard to
construct but you can actually dedicate
some effort into making them more
failure tolerant and architects um well
and making sure that they're just like
resistance and and scalable and even and
just like you can just consume this this
thing that has been like well well
architecture are constructed for you and
also they found out that restricting
what you could do with this service
actually increase their resilience
because they had like one thing and then
to do it very very well and and also
like okay fine like the consumers of
your service are like basically part of
your uncle scenarios like they like gave
engineers a tough like a tough time
because not being able to predict the
future but in the paper they themselves
admit that people started using this in
ways that they didn't expect it and they
had to put things like you know throw a
cash on it but but but yeah it's like I
think you know nobody can't really
predict what the future is gonna be like
so like yeah so yeah so mmm so alright
so like okay with you a to posture
Charles and I was like alright the
reason that I became interested in is
because actually my contacts and my
environment was within the organization
that I work in so so how is our house so
I was just to start going around fastly
and see you like how do we do this and
areas and specially areas of the
organization that might I mean the
system seemed but there's like many
other teams so I want to see how they
did - and then what we can leverage what
can i when could I like what could
actually help me and this like cognitive
journey that I'm in and and it's funny
because like the old-school like web
performance people were telling me that
load balancing was the only way that we
did resilience but they themselves
noticed that it has been it's changed
since then and then they've noticed they
been reference in applications that are
on my side of the fence as well so it's
always very interesting so I'm going to
talk about two systems that we publicly
talked about and they're talks about it
Oh
so I will reference you to the talks
later and if you're interested in
checking it out a little bit more so the
first the first system is our protein
system is called Powderhorn this is
Tyler McMullen and I'm Bruce pang and
I'm going to you since I don't have that
much time I'm just going to use tools
for Tyler and Bruce together so and this
talk was given a velocity in Barcelona
last year and and they talked about the
evolution of our protein system from v1
to v3 and then they walk you through all
of the design decisions and the
assumptions that were there at the
beginning and everything that like Janna
screwed us up in at the towards the end
and then at the end of it like they
leverage leverage by modem otakus which
is a lots of protocol to provide
extremely fast purging speeds so if
you're interested in about like what is
the design concerns and system evolution
like I was this is kind of likely will
give you more insight into this like how
do people construct these things so it's
a really good thing
reading papers was very very beneficial
for us because it made sure that the
problem stopped at b3 who knows how many
bees we would have right now if we where
and actually like if we hadn't run
through this piece of piece of like
research and also like it also tells us
that planning for regimes is hard as
well our network expanded we went from
the engineering side of the problem in
the ER in the graph and to the UNK very
very quickly so new problems popped up
and this is a problem that I have then
with a conch I think that the problem
that the things that are problematic
with an arc is that things that you
didn't see but I guess your perspective
right like so if I didn't see it because
my universe is like less developed then
I can't genuinely say that it was
completely unforeseeable for me but for
safe somebody more experienced or
somebody that has like maybe 20 decades
of distributed systems it would have
been something very obvious for them so
I don't like the fact that this is a
personal perspective thing but I am
cognizant that it exists so maybe this
is yet another argument of why you
should have different cognitive
diversity in your team because like my
perspective it's just only one data
point in this realm of of that
could come and murder your application
so I went to the other side of the house
so we were at the core and then now
we're going to the edge how does things
look like closer to the internet and
this is my coworker ciao and
if you can't read the bubble because
it's a little bit small but says
existent best practices won't save you
he's a very cheerful personality and
those type of things that you're going
to hear him say but sweetly good his
team is hiring to everybody to everybody
sorry but this is like to all looking
very very suave on me trying to get a
photo with them so Java told me about
the system called fail deep and before I
tell you what it is
then we'll let's describe a little bit
like a simplification of what our point
of presences are so our box so we have
this ship called the Internet there
where there's like monsters and then
ships and everything is awful and then
we have our top with this little nice
little like red little line there and
then traffic comes on that we have
hosted there and at some point like some
host will fail and if the hosts fail you
have to be able to just like still go to
the right host but take that note out
and then just like bring it back in so
we use this thing called EC and people
plus multi pass and then if we use that
one and the problem that that protocol
had is that it recalculates it
recalculates the tables whenever I
please change so we didn't want node a
to go away and then traffic of B to move
to the position of node a so that was a
problem that we were running into so we
ended up doing something really clever
which is like again with the best
practices for failing us so we ended up
making making the system called filthy
that allows us to fail and recover hosts
be a match to happen in the ICMP on
switches so instead of being on the host
at this is apparently the replacement
for a system called keep alive D which I
have no contacts on but apparently if
you have contacts on that then you know
what this system is doing and it runs so
switches are supposed to there to the to
the host and yeah so basically what we
do is I could make fake IP addresses we
map them to MAC addresses and then
whenever a node fails the IP address is
still there but then we should switch
the MAC address so this is kind of cool
so if you're interested in this to all
has a much better explanation on key so
sorry 15 talk unnecessarily delivered
because I for me them for me that that
ok this this thing how it's done at the
edge is basically leveraging things that
that the same way that we do it at the
core right so all right but you may say
wait a minute we have a myriad of
systems then it's like what I mean why
were you where you where whenever you
started investigating this so what I
learned is that ok in every organization
likely you're gonna have like a lot of
systems and then they all have different
stages of evolution so resilient we have
a resilient systems like varnish
Powderhorn and fail
B we have taught us many lessons and
they have taught us how to do things
well but some applications still have
availability issues because I told you I
told you this this is so why is that is
that this is a moment I better take
another second and I drink a little
water just to make sure that I don't
pick up speed again but hmm remember
where I was okay so why why do we have
these things so so what are the things
that we fail to construct or fail to
consider whenever whenever we run into
these problems so so this is our like
the patterns that I picked up or the
patterns are they still that seem to be
the ones that are more like Franklin to
me so every tendencies matter so
surveillance if matters will elicit of
resources execution paths checks
replication of data replay of messages
anti an anti entropy all these things
like put together just like they helped
us with resiliency also a gossip and
epidemic protocols was another example
of redundancies because it resounded
remnants of messages as well and then if
we're talking about redundancies we this
is something that I learned this here as
well that capacity planning matters
redundancies it's like something that
it's resources and it's like yes it's
surplus but you need to be able to like
again just like increase that they just
like put a boundary or failure between
one area that could get and it's just
like just make sure that your failure
domain just like doesn't overlap to
other to other systems right so if you
can read what the Bible says
optimizations can also make your system
less resilient so say you want to run
something at a slower cost or say that
you want that to just like make
something like a little bit cheaper or
not replicated as much as you know that
you should do or save money on a node
instead of having five and you have
something that uses quorum and you put
like like two nodes or or like four it's
not right so another thing that we've
learned then is that operating
operations matter and we're kind of
unaware we can't forget where the arrow
boundary is and enemies that we're
always kissing right like I mean we've
all pushed applications to production
and then they're like okay and you
really guess where your first
bottleneck is gonna come from like I
don't I don't know like I don't know it
hopefully you do I but I would say that
if you tell me that you do know it I
would actually ask you to show your work
because maybe I think you're full of
 so so yeah so another thing that is
interesting is like complexity
of operations makes the system less
resilient and more incident prone it's
like if it takes for like if it's like
so painful to operate eventually people
are going to cut corners and and they're
just going to dis sacrifices the
resiliency of your system as a whole and
actually you should worry about a pair
ability whenever you're designing
because this is something that comes in
design as well so also just the biggest
cost of security breaches and
configuration errors is human error so
again so that's great we're all great
another thing that I learned is that
maybe complexity is not all complexity
is bad so some of the research talked
about the number of complexity and the
number of parts in airplanes and then
how that it's considered a good thing
whenever complexity is there to increase
safety so right now we have like cars
and airplanes that are significantly
much more complex than what we had like
few years ago and they're but they're
also like very very much safer and again
I mentioned this before but added
resiliency it comes at the cost of other
desire poles so so you should really
figure out which one is your goal
because if you want to run something
cheap then you really shouldn't expect
something that would be like super
resilient and available and also
complexities and avoidable so yeah so it
seems complexities unavailable and we
tend to build things that are like
highly structured communications
computing and control systems that
create barriers to cascading failures so
what you're trying to do is just like
make sure that those barriers exists and
we can rely on we should actually
leverage and rely on engineering best
practices resiliency and testing are
correlated you should test your system
also another thing that is important it
should actually put everything
versioning on everything pretty much
provide well you should person for
example I your API this format and
providing an upward path from day one is
very very useful upgrades an
availability of system is still tricky
if you give a version then you should
also try to support like mix mode
operations so you can actually run them
in parallel and just like slip one
versus the other that would be like much
more it would increase like your
operational happiness and I think that
there's also like it's kind of shitty
because we've seen all of this we're
supposed to put all of these things in
practice and and we're still prototyping
systems in a way where like what I was
one of my little prototype of things
where I was just making these decisions
that I wasn't sure if they were going to
that my system had no chance of you
making it out of production so I think
that I don't know like I haven't found a
better way to think about prototyping
there's there's a yahoo mentioning her
talk like we have you been finding a
checklist of things that we can borrow
from air like airplanes and then just
like start figuring out what we need it
for would run to production I found one
and it's listed on the references and
that was nice but it's not like by no
means comprehensive right like we
prioritize systems like so and then
this happens to us but then again like I
think it's like wait typically way too
many fronts to attack and when I'm in
the middle of it it's just like it's
hard enough to get something here and
then I have to worry about everything
else so so I think that there's there's
something there that I don't really know
how to reconcile but if so we went
through a whole journey and I have like
oh my god I have like five minutes to
wrap it up I think for so so what we've
seen we've seen like residency matter so
at least it matters to me and it's
something that I think it's like
basically why we're doing what we're
doing which is what are things to be up
on our business is to continue to be
running we've seen things in in in
literature that says the design is
important that that operations are
important and also like there's there's
things that we're never going to be able
to protect do we protect against and and
and we've seen some samples from like
some implementations of these things in
industry as well so like everything that
we learned before that's hopefully
connected in what we're seeing in
industry as well so if you have been
asleep - the entire talk I have a tldr
for you that kind of like meshes
everything together so so like say then
I it was like me over a year ago when I
was trying to look at this things fresh
so I got one of the things that we
should put like you keep keeping our
minds so one in a sign I wish you
wondering if I were favoring harvest to
feel harvester yield giving which is
like that is a design concern so like
we're not doing in design we're
eventually like just like not that I
haven't carve it well on us so we can
leverage orthogonality and decomposition
for example in the chubby paper people
like engineers don't worry about those
things but then engineers were able to
rely on chopping and Travie did all of
these things and I was like an
orthogonal way to actually get for
example member elections and then have
that member elections be highly
available as well do we have enough
redundancies in place while we're
designing is like I do you know how the
system
going to operator what is the loan that
you have and a half you can expect do we
have we give it enough like Britain
Bhumika we give enough padding
I will resilient to a reverse into our
dependencies what if one of our
dependencies for like fails again it's
like are we favoring harvest rugby
favoring yield and that Sheriff is a
business decision so you should know
which one your business needs you do
favor and also the theory matters so you
can continue reinventing the same thing
and then just make mistakes and then
again the onk-onk is a problem of
perspective so if my perspective is
flawed maybe somebody who has researched
this for decades will actually
have a better perspective on mind
operability am i providing enough
control to my operators like Carrick and
people actually do their job with the
thing that I provided to them also an
interesting one is I do I want to be on
call for this it's like I know you know
how to operated but do you really want
to be on call for this so that is a good
one and also I think it's like we should
run your grant your services based on
what can be dropped killed and deferred
and that is also listed in the
references but it's like very important
because whenever an incident happens you
know exactly it informs your operational
activities and okay do we have more
internal learning in place against like
though then we have this this again the
thing of onk-onk and I think that that
again it's like yes matter of
perspective I can't cover absolutely
everything but I think it also stretches
it stresses diligence on the other two
because it's a way that we can actually
make survive it whenever it comes and
then have we done everything we can and
if we think that we've done everything
we can I think maybe Camille was like
you should meditate in the flames of the
tires I am much more a proponent of
human has sacrifices and abandoning hope
so I think one or the other maybe you
have interns it's like it's like it
requires blood so so yes so you touch it
to that I think I mean there's like
there's we have leadership styles yeah I
like the meditation bed whenever I'm
with the engineer insider yeah so well
in a sign again so this a little bit
more place let's try to be a little bit
more practical well again we should test
our dependency failures code reviews are
not the same thing as tests and this is
covered in the chubby paper you can have
a test obvious
you have to do it but then the the
chubby team still reviewed the code of
applications that we're going to be
relying on Chubby's because they got bit
by people leverage in the system in ways
that they don't want to so they're not
the same you should have both
also you should distrust client behavior
even if you're internal because believe
it or not even a google-like they're
just like it's like really VC to bid off
yourself and it's much more easier to do
this yourself that somebody else so
dependent like I mean we're a CDN so so
we're like at the edge so so so there
was a talk at velocity this year but one
of the Google managers and she says that
like it's much more likely for them to
do those themselves so I'm paraphrasing
her and also you should check some all
the things check some your like the
anything that you write to disk even
things that you do write to memory so a
friend of ours Jordan is it works on
Cassandra and he told us that there was
this thing were like memory at some
point flip and then Cassandra had in
there in the membership like the
membership information I know that they
didn't knew before and then all of a
sudden started talking about to it so
now they put like checksum and even
index the group membership saying that
it's a memory not in this so you should
do like okay
things like error handler secret circuit
break-ins back pressure leases timeouts
all of these things are here to help you
and when it comes to operability any
automation shortcut that you take while
you're in a rush is going to come back
and haunt you and by haunt you I mean
something else
uh-huh yes so I'm trying to clean up my
language here so but also like I've
noticed this thing too that it's like
really stability like sometimes it's
like it's often tied to like how stable
your system is so so if you really have
ironed out your release process then
you're even adding more on this pile of
things that are going to come and get
you
also it's interesting that I learned
this year I guess it's like all of this
are like very humble opinions about the
didn't if you have an alert you should
link to something that is actionable to
it because you're being kind to your
operators whoever is going to be on call
and gets this alert needs to know how to
react to it and if you don't do it then
you're basically just like you basically
sign enough to be the person that gets
woken up because nobody else can be able
hear your application and another thing
that was interesting too is that since
we're thinking about configuration as
interfaces some standard variation in
interfaces is it's actually a good thing
so if you have a system that gets
configured one way for example if you
put a database thing on chef and the
other one is use a config file and one
person is switching from one to the
other
it becomes less intuitive to do so I
learned that this year tool and also
like again the operators of our system
determine resilient this is my last
slide and I also promised your auntie
festal and the biggest thing that I
think I took away is that we can't
really recover from lack of design not
minding things like harvest and yield
like means that we sign up for a
redesign of our system the moment with
we finish it so so just like you can't
really build on things like security
availability resilience and an
orthogonality really can helps us but if
you don't have a service that is already
available in your in your in your
company then basically you're just like
building something that you know from
the get-go is not going to be it's not
gonna be good so I think this was what
were we maybe missed on some of the
systems that I had that I was
encountering problems with and and and I
think maybe as a company we're going to
have to start making a choice maybe
we're getting to the point where we're
like small we're not us big as a school
or Netflix but at some point we may want
to have we I think we're going to we're
starting thinking about like maybe just
like we should put a service behind this
or we should provide a library and I
think when you're small like that the
trade-off is always either use a library
or like or you just Yolo it and and that
is interesting so alright so that is it
the end of the talk but I would like to
thank the people that helped me they're
all in this one and then I never have
time for questions because I always use
again I run my system at the very edge
and I prepare a repo for you where you
can actually open a pull request or just
say hi or whatever if you have any
questions and then all of the things
that I mentioned at all and the expert
references on the extra paper are listed
there so so thank you very much
hopefully it wasn't too bad Norma so
yeah so yeah and this is how short I am
yeah all right</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>