<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>&quot;PureScript &amp; Pux -- a safer, more expressive way to React&quot; by Michael Trotter | Coder Coacher - Coaching Coders</title><meta content="&quot;PureScript &amp; Pux -- a safer, more expressive way to React&quot; by Michael Trotter - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Strange-Loop/">Strange Loop</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>&quot;PureScript &amp; Pux -- a safer, more expressive way to React&quot; by Michael Trotter</b></h2><h5 class="post__date">2016-09-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/AE4ToMtTmz4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi how is everyone good this is a pretty
awesome venue so let's talk about your
script and a little bit of pucks so
before we get too far into this what is
pure script pure script is a typed pure
functional language it targets
JavaScript I'm more specifically
commonjs right now that might be es6
modules in the future and for comparison
peer script is lighter weight than Elm a
little bit because it doesn't include
any runtimes it's a little more flexible
you can do pretty much anything you want
with the FFI it's also a more functional
in style than typescript but otherwise
very similar they compile in very
similar ways and they interrupt with
JavaScript in very similar ways and then
it's also similar to Haskell because the
syntax and the libraries are inspired by
high school but it's also much lighter
because Haspel creates very large
JavaScript binaries or bundles but it
also has much less type system features
compared to high school so if you're
used to some of those it might be a
little bit painful so what I mean by
typed so I'm gonna read this quote there
are many ways to understand programs
people often rely too much on one way
which is called debugging and consists
of running a partly understood program
to see if it does what you expected
another way which ml advocates is to
install some means of understanding in
the very programs themselves and this is
from Robin Miller the creator of ml
which is one of the predecessors to a
library our languages like Haskell and
so what we're talking about here is
types for the programmer not types for
the computer some languages focus a lot
more on types for the computer like C
and C++ a little bit c-sharp and Java
but you can kind of get a little bit
closer to developer friendly types there
but here we in these languages we might
create types that have no runtime
representation they simply exist to help
us write our programs
and in JavaScript also has types number
string and boolean and object but it's
not very explicit about them but you do
still have to think about them because
you end up checking your inputs all the
time so we're trying to take this
concept of well there are types maybe we
can push that farther to help us get
stuff done and do it safer
so I also said it was pure and this is
pure D and they contacts the functional
programming so consider this function
average is this pure anyone yes good so
it does actually mutate some state here
this inner callback is not pure but this
average function owns all of this state
and it goes away when the function
returns so the average function itself
is pure how about this average no so
it's very similar and actually from the
outside it looks exactly the same but
it's no longer period so you can do a
pure functional programming in
JavaScript if you're super diligent
about it but the language doesn't help
you very much
so pure script is pure because it uses
its type system to represent
side-effects and control them side
effects can include anything like local
storage Ajax shared state randomness
time anything that makes you call a
function and either not get anything
meaningful back because it went and
touches something else or you call it
and different things happen each time
and peer scope uses this effect type
just called F to represent effects it
takes an effect row which describes the
sort of effects being done and then it
can return a type back to you so well I
have some examples so given that what do
you think this function does we're doing
some effect it involves the Dom and we
get a location so we're probably reading
from window location how about this one
so we don't really know what instant is
but we know that we're doing something
with time because we've got now it
doesn't really actually matter what
instant is or how its represented but
the basic idea is that we're doing
something that involves getting the
current point in time so like date now
or creating a date or whatever so how
about this one this one takes an element
we don't know what that is probably a
Dom element it returns an effect of unit
so unit is the type that represents
nothing so here we're trying to say that
we're gonna do some effect but you're
not going to get anything meaningful
back from it so this kind of tells us
that this element that we're passing in
stuff's gonna happen to it and yeah so
how about this one so I changed the type
this one returns an F which is a lot
like F but it's asynchronous you can
kind of think of F's like phones and
apps like promises sort of so this
function takes a user ID it does some
stuff with the network and then it gives
you back a user at some point in the
future so I also said it was functional
but functional is a very broad term lots
of languages are functional JavaScript
can be functional and closure scripts
reason LM all functional but there's one
thing that these all have in common and
that is the separation of data and
functions that's really tiny sorry so
we're trying to like take these stateful
bundles of logic and data and pull them
apart into simple functions that just
take data and return results sometimes
have effects but we try and keep those
isolated and then all of our data so
let's look at some code here's our
average function again maybe once it
so better okay so the implementation
doesn't matter too much full Del's
basically reduce we're saying reduce
over this plus operation start with zero
and traverse this array and then we
divide by the total number of items
makes sense so what's interesting here
is that we can actually use that same
plus operator for intz so what
javascript doesn't really have int but
pier script makes them work every time
you do an operation with an int it
truncates the result so you get pretty
predictable behavior so here we're doing
the same fold the same plus but now
we're using int and it just works so
this is because pier script has the
concept of type classes which is a you
can define logic for a group of types so
number and int define addition
differently and you can define your own
sorts of addition so what makes these
actually types for the developer because
so far we just looked at number in here
we've got a type user and the curly
brackets represent records so in
JavaScript this will actually be an
object but the type system we'll call it
a record and it has to have an email
field and only an email field and that's
it it has to be a string it can't be
known but string is also more of a
computer type so we can actually create
our own new type which is a wrapper
around string and we'll call it email
and this actually has no runtime
representation it goes away when it's
compiled but the compiler uses it to
decide what functions to use for example
if you're writing code that behaves
differently depending on which type you
give it so here we've got an actual
email constant so you know just left
side new type email that's the type on
the right side equals email string that
email is the constructor they just
happen to have the same name so down
here the first line we have the type is
email and the next line we call the
constructor with a string and then we
can redefine our user type to actually
have email
an email so wait a second you're saying
if I can just pass any string into this
what's the point well we can do
something like this you can write this
function that takes a string and it
returns either an error message or the
email and what this ensures is that
after it's done its regex to make sure
it really is an email if you get back an
email from this function you know it's
an email otherwise we'll get back an
error message and then what you can do
to take this a step further is you can
hide the email constructor from your
exports and so you know that no one else
can create an email without going
through this validation function some
other examples we've also got a data a
data type that's kind of like an enum
but they're a little bit more powerful
because in addition to saying that it
can be one of these things we can also
build data types that contain other data
so if it's anonymous there's no extra
data if it's a guest we might have an
email maybe if it's a full account then
we know there's an email and we know
there's a name so what this does is that
every time you write a function that
deals with users people make us handle
all of these cases so here's a function
that takes a user and turns it into a
string if it's anonymous we just say
login if it's a guest then we tell them
they should subscribe and if it's a full
account then we can actually print their
name all right
so how about putz quick disclaimer
before I get into the Puck stuff is that
this is kind of a quickly moving space
in pure script probably the most active
development there's a bunch of different
libraries some rap virtual Dom some rap
react bucks is one of ones that wraps
react there's one that just wraps react
and tries to encompass its entire API
and so it's a little more complicated to
use and career script but you can pretty
much do anything you want then there are
abstractions on top of that bux was
probably the simplest one and definitely
is used to get started with it's also
inspired by Elm so if you've done any
elements will look familiar
we've got at the top actions so these
are the possible things that can occur
in our system and then we've got our
state which in this case is just in it
and our update function so if you ignore
the view for a second this is all of our
application logic at the top and it's
pretty easy to reason about it and write
tests against it separately from our
view function so then down below I've
got view and you'll notice that it's a
function from state to HTML of our
action type so what this means is that
this view can only create actions of
this particular action type and so these
things all kind of go together and you
can compose these together from a parent
that might use two different sub views
so if this is inspired by Elm then what
makes bucks and pure script kind of
unique well this is actually based on
react not ritual dumb and it's a lot
easier to work with the JavaScript FFI
so you can take pure script things and
import them into react applications and
vice versa and we'll have a couple
examples of that so here's a view for
the spectacled library for creating
slide decks like this one so this would
be the JavaScript version with JSX
you've got your side component some
props sub component this is the same
thing in pucks yeah so I component we
have an array of attributes and an array
of children here's another one we've got
the route spectacle component that
defines the deck and some settings on
there and then the children is the array
of slides and same thing here instead of
using the array of attributes and the
array of children I'm using this helper
function that just applies a single
attribute so each exclamation point is
an extra attribute we're applying the
single pound is one child and the double
pounds is an array of children so
sometimes is one looks better than the
other and sometimes you use them in
combination but they're really the same
thing because these operators are just
functions
okay so how do we talk to JavaScript so
ignore the left side for a second the
right side will look pretty familiar if
you've done any react stuff with
JavaScript we're gonna import spectacle
but instead of actually using it in JSX
we're going to wrap it in this from
react and just export it there's a
common j/s module and then right next to
it the same file name but with the pure
script extension we import that code
pane export so this is where it's pretty
similar to typescript so we're actually
just saying this is the type of this
thing trust me
and we're saying it's a component so you
have to be a little bit careful with the
fo5 but it's also really powerful so how
would you actually use tux inside of a
react occation well when you build a
Puck's up the entire app ends up being
one component but you can have other
components imported beneath it but when
you build a view it ends up being one
component and that uses the architecture
to basically control all of the updates
and mutation within that little app and
what you can do is you can take that app
and render it just as you would with
react to a specific element but you can
also instead just call this to react
function and get back a component out of
it and this thing you can import in
JavaScript and use just like any other
component so I've got an example here
this is a little Rock Paper Scissors app
and you can click on them
and it tells you who wins and keeps
track of the score and we've got a reset
so this is a little bit we'll have two
examples at the end here so the slide
deck is written in Pierce script and
pucks and this is pure script folks but
this actually has some state management
and we'll look at the code a little bit
here
okay so this is our view function we've
got five buttons we've got a divider
we've got whatever's currently going on
in the game and then we've got our score
pretty straightforward so this is kind
of what I mean by describing Krypton
pucks as expressive so choice button is
just a function that we defined oops
nah I'm stuck hold on
there we go sorry so choice button is
this function right here and all that
it's doing is creating a button every
time we give it one of these game joist
types and what this lets us do is create
HTML that is really doesn't look like
HTML it's very descriptive but it's also
pretty easy to create and then for our
game choices it's just one of those enum
data types so these are all the possible
game choices and this is where the
compiler starts to get really cool so if
we add another option here so we're
expanding our game because originally it
was just rock-paper-scissors the
compiler will actually enforce the
places where that type is used that you
cover all of those cases
so here the compiler will complain with
the message like this some case
expression could not be determined to
cover all inputs and it'll tell you
which types we're not covered so that's
really useful here's another example of
those types being used we're saying this
is to determine the winner so we take a
player on the left and a player on the
right and we cover all the cases where
one player will win and then for
everything else they've lost so here's
one of those effect types that I
mentioned before so here we're doing
something that involves randomness and
we're returning a game choice so that's
a pretty descriptive we're gonna get
random game choices out of this and
we're going to use it to power the
computer player so this is our update
function let's just step through it so
we have this reset action it's really
straightforward it ignores the current
state and returns the initial State then
we have this update score action it's
assuming that it basically when we put
players choices into the state then we
call this function which removes them
from the state updates the score and the
labels on the page so this is where it
starts to get interesting when the
player makes a choice
and these actions come from the buttons
on the UI this first line here of the
effects is a do block so these are kind
of confusing at first but basically what
this is saying is for the lines that
follow each line is going to be a step
in this sequential operation and this is
usually the way that effects are written
it doesn't have to be an effect you can
write many different types can be
expressed this way but the do basically
returns the last line of this multi-step
process so here we're going to call our
get random choice and it's an effect but
Puck's lets you return apps from this so
you can have asynchronous effects so
this lift F thing just converts it to an
F so that the type system is happy and
we take that choice and we return it
back as our resulting type so this is an
app that returns the computers move okay
and then that hit that action was
handled right here so once the computers
moved then we put their choice into the
state and update the score okay that's
it so okay again you can kind of see
that working
barely we've make a choice and really
quickly the computer makes a choice and
then we show our results done here and I
didn't design those guys took them there
was actually a meet-up for learning some
Elm architecture stuff and I wanted to
look at pucks so it's pretty much the
same thing not anymore actually helm 17
changed that but yeah so if you have the
link to the slides there's a bunch of
slides from here after with resources
for learning Pierce kept itself if this
is all kind of like confusing you're not
sure why it might be nice to have these
sorts of ways to express code this first
post is just about JavaScript it's
really introductory don't let the scary
title scare you
and it's a really good walkthrough of
how a simple abstraction gets really
powerful oops and then we've got a
schoolbook pear-shaped isn't Haskell but
for the first half of the book it's
pretty much the same and they do a
really really good job of explaining all
of the concepts and all of the the names
of things and it's really the best
introduction to all of this stuff that
is that you can find in one spot tripped
by example is by the author of pure
script and he keeps it up to date with
the compiler so you should be able to
work through that it's got lots of
examples kind of walks you through
building a small application and then
this last one a lot of this stuff can be
daunting sometimes so I read this the
other day by Alexis King and she kind of
talks about whether how much abstraction
is too much and how it's just kind of
like a ladder that you keep walking up
so peer scripts there's a lot of active
community it's a fairly small community
but it's pretty much always active and
there's a IRC channel which is kind of
the original location and then there's
also this FP chat slot group with a peer
script channel which is also very active
and then pucks specifically as a getter
channel if you have any puck specific
questions and then libraries use here's
a link to pucks and I wrote this
spectacle wrapper it's really tiny you
can take a look for how you'd wrap an
existing react library and use it and
then peer skip react which I mentioned
before is kind of like gets you into the
nitty gritty react API and you can do
anything you want but your types get
really complicated and then this last
one isn't really any of this stuff but
it's a really great example of how a
type system can make something that
you're used to a concept that you have
to work with in your code and express it
in a way that's really really nice so it
makes it really hard to create invalid
dates it's got lots of ways of taking
dates apart and putting them back
together and converting times and
durations and it actually uses the types
to convert durations so if you say I
want minutes and something else has
hours
it will do the conversion as it assigns
it from hours to minutes it just kind of
works so that's really cool and daytime
makes sense
it's a date/time type is a date type and
a time type stuck together and you can
take both apart and look at them
separately this presentation there's a
link to the actual slides the slideshow
code is at this github link and I tried
to put lots of comments in it so that
you can actually see what's going on and
if anyone has questions please message
me or submit an issue or something I
don't know
because I want to see what what people
have trouble with when they first get
started so and then that
rock/paper/scissors up is right here
it's pretty small it's all one file for
the most part the game file and it's a
good example of stateful stuff and
that's pretty much it
my name is Michael Trotter these are
social links I work at Jane comm it's a
daily deal website and we do use a
little bit of pure script not so much
for our larger react application yet but
for like an autocomplete drop-down and
for our analytics client so we're pretty
much always hiring front-end back-end
and data science and Android so let me
know thank you and these are the slides
and I don't know how much time we've got
we've got ten minutes if you've got
questions yeah
yeah
yeah so you actually can if you wanted
to you could take one javascript file
and rewrite it in pure script because it
becomes common jeaious
the problem is that they don't always
line up exactly the so in pure script if
you have a data type that describes your
user when you send that over to
JavaScript it's going to look like an
instantiated class with fields and Java
will expect to be able to change it and
it's not supposed to be changed so you
end up doing a little bit of work at
your FFI layer to kind of make things
look nice from each side so if you just
do one file then your types aren't
helping you a lot because they go away
as soon as you leave that file and
you're doing some conversion back and
forth so well that can be done and you
might do that if you were definitely
going to convert everything but you're
gonna do it one file at a time it's not
the best experience so what actually has
been really nice is we've used peer
script for some self-contained things so
that autocomplete dropped down all the
networking code in that and the caching
for results that we've seen before and
always making sure that we're returning
the result for whatever they currently
typed no matter what order the network
things come back in that's all in pure
script and that ends up being a
self-contained file that just gets
bundled all by itself and so it's nice
to work inside that file but then from
the outside it just looks like a regular
JavaScript function you call it and it
gives you back a suggestion API that
stores results and so I've found that to
be the kind of the nicer way to just
kind of experiment with things that kind
of answer your question so really not
very much the peer script compiler can
convert straight to commonjs if you want
to maintain all of your separate files
but you can also compile with the
browserify option on which will bundle
everything together and there's also an
optimizing flag which removes all the
code you're not using based on the types
so we actually get like a four kilobyte
file out of the local
and it's written sort of like rxjs style
so it's really cool for those little
things yeah yeah so one thing we're
gonna do I don't know if I'll get to it
tonight but very soon I'm going to put
that back into the rock-paper-scissors
game because if you if you check out a
brand new there's a tux starter app if
you check that out and just get started
with that it comes with the hot
reloading stuff turned on but it wasn't
there when I originally made that and it
is up to date now I've updated all the
libraries and dependencies but I didn't
put in that hot reload code so I'm gonna
try and do that because it's pretty cool
it's a lot like Redux it gives you know
like a sidebar you can step forward and
backwards and stuff yeah great well
thank you and feel free to talk to me
afterwards</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>