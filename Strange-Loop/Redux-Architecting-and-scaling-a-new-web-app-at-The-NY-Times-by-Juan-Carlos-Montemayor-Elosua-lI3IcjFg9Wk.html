<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>&quot;Redux: Architecting and scaling a new web app at The NY Times&quot; by Juan Carlos Montemayor Elosua | Coder Coacher - Coaching Coders</title><meta content="&quot;Redux: Architecting and scaling a new web app at The NY Times&quot; by Juan Carlos Montemayor Elosua - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Strange-Loop/">Strange Loop</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>&quot;Redux: Architecting and scaling a new web app at The NY Times&quot; by Juan Carlos Montemayor Elosua</b></h2><h5 class="post__date">2017-10-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lI3IcjFg9Wk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">cool okay two minutes late so about me
I'm very punctual just kidding my name
is Juan Carlos smoke Tamayo de la sua
but most people know me as JC because
it's a very long name I'm from Monterrey
Mexico and I been living in New York for
the last four years I went to Tufts
University to study computer science and
that's where I really found a passion
for functional programming and so even
though now that I'm working in web I try
to be as function as I can all the time
for the last 4 years I've been working
for the New York Times I've been working
for there it's changed names a couple
times which is basically their new
products group so this product
specializes in finding product
opportunities building out prototypes
and launching full products and it's
been really fun I've worked on an app
called NYT now for news an app called
NYT watching where we will talk about
today you're so you'll see in a sec and
starting Monday I'm actually
transferring over to lead the iOS
development for NYT cooking so it's
gonna be a fun new adventure
oh and outside like working programming
I love to do I'm a big hobby person so I
am an opera singer excuse my sore throat
today I'm an opera producer so with a
bunch of friends we produced an opera
based on a doll's house and my latest
hobby is I'm on my way to be certified
as a wine sommelier so if there's any
any people out there like wine please
come talk to me after I talk about wine
more than I do redux so cool
so before we get started on this talk I
just want to give you a tour of watching
because I'm gonna use a lot of real-life
examples so it's not all just like redux
theory it's just like here are some
problems and here's how we solve them so
watching is based on a thing called a
recommendation so this recommendation
isn't like an a like you know machine
learning like recommended it's just like
it's an editorial thing so we write
things based on movies or TV shows in
this case get out and we can tell you
the year was released who's in it like a
short summary and we tell you why I
should why
 or maybe y-you should skip it
sometimes things are like really scary
or like you know specific like triggers
and we also tell you where to watch
something and that's gonna come into
play later in the talk so we can tell
you like hey this is available like on
iTunes for $4.99 you can save
recommendations into a thing called a
watch list so this is like a save area
and the important thing here then I'm
gonna keep referring to as cards so
cards is one of those words that mean
like a million different things at the
times but in this specific case they're
like literal UI elements called cards
you can save them you can like them and
you can click the dot button to see
where you can stream them we have a
thing called a feed so in this feed you
can see some tags at the top you can
click them and kind of like browse for
all of our recommendations and there's
like post so you can read about the
latest happenings in the media world and
then the takeaway here is also here are
the cards again and they're like in the
list and we call that list at carousel
so I'm going to be referring to a
carousel this is what I mean you can
click them and they'll slide over I also
mentioned the tags on top of the page so
you can click them to like search
through our recommendation offerings in
this case we clicked on the strong
female lead tag you should definitely
watch glow if you haven't it's pretty
great I'm not no one's paying me to say
that I actually really love it cool so
that's that's watching and as I
mentioned before I work in the new
products area of the times and it's it's
kind of stressful when you're making a
new product so we work we have a VC
model so what we have to do is pitch a
committee an idea and like we can be
like oh we can do something with film
film and television and we think we can
get this many readers using it in a year
will you give us like X million dollars
to build it out and we have to do that
every couple months so we first asked
money to build it out and then once we
build it out we have to prove that we
were successful and we want to grow so
we have to ask for more money
so before we started on watching the
goal was to launch an MVP version unless
a year and as you can see the word MVP
the acronym is under quotes because in
my opinion it was much more than MVP it
was like full product with like saving
and like a lot of features we also
needed the ability to pivot and change
features quickly because you learn
things you launch things you see how
your users react and you have to change
quickly because again you're on like a
timeline of a year or a couple months to
prove that your product is successful or
else they'll shut it down we also need
it to like keep growing quickly again a
little bit of time and you want to just
like make as many features as possible
and how many people here are web
developers cool any like non web
developers awesome okay I mean I mean
this is like a problem with all kinds of
software but basically yeah you have a
website and you need data so like this
arrow represents us getting data from a
cloud for a recommendation but you know
there's more data so we need to get the
user from the cloud also and once we
have our user we can tell the like safe
component hey now you should check if
anything saved or not like in the cloud
and like oftentimes we have your thing
with like multiple clouds and so just by
looking at all the arrows here you can
you can tell it's like a li you know I
mean you know because you program it
gets messy really quickly and the more
arrows we add to this diagram it's more
headaches
so we are dealing with this we're
dealing with very strict product
requirements that we need to grow
quickly and show success so we decided
to use Redux to help us meet all those
goals and that's what I'm going to talk
to you about today before we get to the
agenda I always like to know who here is
new to Redux here learn awesome who
hears like things are intermediate in
Redux and who here has been using Redux
for a long long time by which I mean two
years because that's all around for two
years or three cool that's great it's
good mix okay so first we're gonna talk
about what unidirectional data is which
is kind of like the philosophy of Redux
so I'm gonna take you through the steps
of taking yours
turning into views dispatching actions
to to do stuff and then have having
those actions results come back into
producers so you can change your state
and we're gonna see the whole flow we're
going to talk about how to separate data
from views using containers this is
going to give you some really nice
operation of concerns and we'll talk
about more of that later we're going to
talk about simplifying data
relationships with selectors so that's
when you have a lot of data from a lot
of different places and maybe you want
your views just to deal with like one
object so how do you merge all those in
and also it has some really nice
performance implications so we'll talk
about that and then the last thing is
we're going to talk about business logic
I'm gonna define it because it means
different things different places and
we're gonna tell you how we deal with
those kinds of things so let me take
water cuz my mouse is very dry cool part
1 what is redux redux is a predictable
state container for JavaScript
applications that word is bolded it's
gonna come back throughout the talk
redux help helps you manage your state
or other like your data and it's also a
nice way to organize your app and
separate things really nicely and the
last point here it's gonna come back
also in the talk I always like to
describe things in like a mathematical
way this is strange loop I don't need to
explain this like why I do this but let
me explain this so basically this is
this is how I look at my app you have
your UI and then you give it your state
and it becomes an application right the
app is what your user interacts with and
sees so we're gonna go back to that idea
soon so let's define some things first
of all when I say state I mean data so
that's JSON it's everything your app
knows views is your markup and your
display logic so that's all your react
your JSX
or whatever you choose for your views
there's a thing called actions so those
actions by now let's just say they do
Network calls and changes to state so
it's like where you do
basically reducers tell your app how to
respond to those actions and update the
state and we're also about middleware
later and all you need to know at this
point is that they extend the
functionality of your app before we move
on I would like to talk about pure
functions who here knows about pure
functions who here had their life
changed by pure functions where they
learned about them
cool me too so pure functions have a
definition their output is determined
only by their input values and they have
no observable side-effects we're gonna
see some examples in a second but
basically it means that it's a function
that all it needs to know it takes in as
its arguments and then its output is
predictable and repeatable it'll always
give you the same output so here's an
example of an impure function I have a
greet function it takes in my name JC
and it results in good-morning JC but
I'm in this example I'm calling it in a
lot of 11:59 a.m. but if I call it at
12:00 p.m.
it says good afternoon JC so as a
different output so something's
happening there that's it's causing a
different output and obviously this is a
really silly example but like in other
applications that this means that you
don't exactly know what your function is
going to output at any particular time
so an example of a the same function
written in a pure manner is this where
you pass in the time so that now the
function has everything it needs to know
to give you your output from the
parameters and so you are actually the
person who's controlling the time in
this case and this is a lot easier like
for example for testing right how do you
test the other one like your tests are
gonna fail depending on whether you run
it in the morning or at night but in
this this case you can control exactly
what to test also you can control things
like what if the time mechanism fails
and gives you back an empty string or
null you can check that in tests really
easily
okay so they're testable they're
predictable they give you the same
results every time and they're clean so
they don't have any side effects or
dependencies so that means if you're
working on this function here and you
change it it's you know well sorry if
you're working on another thing over
here in your app it's not gonna break
your function that's over here because
it doesn't depend on other things so
impure functions so side effects are a
part of life they're not necessarily bad
right there are things like API calls
random numbers checking time user input
and every program contains both pure and
impure things so it's not like it's bad
but you do want it kind of like know
where your impure functions are so that
you know what part of your app will give
you surprises and you know bugs are
surprises crashes are surprises so it's
good to know
to have like oh it might be this part
where everything is impure cool okay now
we know all that we need to know to talk
about Redux so Reedus has three
principles one has a single source of
truth and again this is strange loop so
we're gonna be like super like you know
purist about this so this in this case
means there's only one place in your app
with data right you're not keeping
multiple things your components aren't
keeping data so that's that's what we're
gonna talk about today State is
read-only nothing can change your state
so your components can't change your
state only Redux can and in fact it
doesn't actually change the state it
creates a new state and then replaces
the state
lastly changes are made with pure
functions we're gonna talk about this
later but we know what pure functions
are so this is like the third principle
okay now we got to one of my favorite
slides which is the Bree Docs cycle
slide so you start with state and state
again it's just data and what you want
to do is say to show it to the user
right and so your views take the state
and you have an app and you show it to
the user so at this point you have an
app that the user can see and interact
with just with these two things
but it'll be a boring website because
you can't do anything yet until you have
actions so if your user interacts with
your site or like there's like you know
it mounts or there's like a browser
event you can send actions and actions
talk to the internet actions do things
you know the work is done there then the
results come back and the action results
the reducers takes the action results
and the state and it's going to update
the state for you and you know this is a
cycle so now with a new state it goes
down to the views and your views get
updated and everyone's happy so let's
talk about state first so again here's
our recommendation page and this is a
really cool exercise to do if you
haven't done Redux yet is take a look at
your pages and try to see what your
state will look like right so in this
case we have a title a watch if like
streaming information information where
to watch it if it's saved if it's liked
and the state is you know a combination
of these things because we don't know
not only have information for a reducer
we haven't fish about a user or our app
or many things so another thing you can
define which i think is pretty neat in
redux is your initial state so for
example here's our actual initial state
for recommendations we can see an empty
recommendation object the GWI info I
meant to change that is streaming
information you can see if there was a
fetch error and you can see if it's
saved or not and actually like right now
you have a pretty good idea of what this
page looks like let's look a better
example because this is more like typed
out so this is for our list page we have
an ID a title of byline the description
lists items saved recs by slugs so let's
see if it saved information you can take
this and kind of like think like oh you
need a page and I say how it needs to
have a title needs to have a byline like
the design is mirrored in this initial
state which i think is pretty neat okay
so every state now you need to show it
to your user so your views again markup
and display logic react and JSX
so Redux state is passed in through this
dot prop so this is like a practical
like when you're programming this is
not the same as this dot state in react
in fact I'm gonna say that if you're
doing redox all the way do not use this
dot state to update your safe everything
has to go through redux
I see some nodding cool also views again
fire actions through user the user
interactions or browser events and so
now we're ready to come back to this
function right
your application is a you know is when
you give state to your UI so the app is
like the output of that function so here
is our recommendation page and actually
this is like the empty state and the
user is never gonna see this because we
do server-side rendering this is what it
looks like when you take literally take
the state out and it's just like a shell
of a page right and by the way you can
do like nice things you can like tell
the user oh we haven't fetch your data
yet we haven't done that on the other
side you have your data right so what
happens and what the way I think about
this is I don't know if you have ever I
mean hopefully someone here has used a
sponge right a dry sponge when you put
it in water it's just like soaks it all
up and becomes alive that's how I think
about this when you combine these two
things you get besides a nice animation
a full website and it's like it's
beautiful I love it
this also what what's in this function
too is is the inherent separation of
your views and your state right because
your UI is there to just grab a state
and display something it's not it's not
necessarily there to like do data stuff
in calculations it's just there to like
take in your state that's the way I
think about it by the way cool so the
next step is actually doing something
and again strange loop I can quote the
Haskell Docs it's great I can't do that
anywhere else but actions examine and
modify the current state of the world
okay they're invoked as a result of
events in views like mounting or user
interactions and they can happen
asynchronously so if you're making a
network call you know you have to wait
until you get the data
and they can also have been
synchronously like opening a pop-up I
mean you may check with your server
before you open a pop-up or not but
usually you just want to tell your app
like hey open this window no waiting
so some definitions there's thing called
actions and as the Redux Doc's define it
it's a payload of information it tells
your app what like what happened and any
data associated with it there's a thing
called action creators which is a
function that returns actions and
there's this thing called dispatch which
is of Redux function that you give it an
action and it takes it through that
cycle that we talked about I also like
to call action action results because it
for me communicates better that it's
just a JSON objects an action to me is
like you're going off doing something
but that's not exactly what the naming
condition is so here's an example this
function show watch list popover is an
action creator and it returns an action
in this case a simple one that just has
a type right so when my reducer C said
it'll see this type and it'll know to
like do something
oh the user press this button we should
show this popover that's it for actions
reducers they tell your app how to
change the state they're pure so they're
predictable and again you don't want any
surprises
that's how bugs happen that's why the
third you know tentative has read axis
there so it computes a new state based
on the result of an action so that
payload and your current state so that's
again a little mathematical way to put
it
it's a function that takes in your
current state and in action and it gives
you back a new state and let's look at
an example
so again current state dot action
results equals new state so if here's my
current state as you can see wait
there's my action results there we go
okay so my current state says I'm not
logged in but the action result says ok
you logged in like that's this is a
thing that happens so you reduce your
has to get back the same state
only with the differences based on that
action in this case that I am logged in
now here's more examples so oh I mean
this is the way you would actually type
it out I guess you have your old state
and your action right and you're
updating the old state with the result
of the action in this case am I logged
in or not and then your view can grab
that state and do whatever it wants you
have to return new objects it doesn't
you can't just like change a property in
an object in return it has to be a
completely new object that's one of the
rules cool so I promised you real-life
examples so here we go just as a
reminder here is our recommendation page
brass City great show and a secondary
reminder we can tell people where to
watch broad city right but this data is
coming from a third-party provider so we
can't like service site loaded or
anything so we have to make another call
for that data so we're gonna go through
how we make that call and update the UI
cool fetching streaming info so there's
a couple things we need here first we
app that we are loading new information
so that the UI can then show a spinner
or something the second action is to
tell the app hey we got the data this is
great show the data the third action is
hey there was an error of fetching the
data maybe you want to show like an
error message or something right so here
are the different action creators that
we need we need an action creator that
that tells the app that we're fetching
something so in this case rec info fetch
started is the type and we said we can
send them the rec ID if we want or or
whatever then in the reducer right we
look out for that type update the state
until the app that we are fetching and
then the view can just grab the thing
and say a reaching show spinner if we're
not sure like do something else okay
we fetch the info we have it and as you
can see up there it takes in two things
a rec ID and an info and so actually I'm
not sending the rec idea of action so
this is a good example on how you can
ignore arguments so we tell the app hey
we fetch the info and here it is in the
results here's what the reducer looks
like so it takes in again the old state
in the action and gets back a new state
with the differences in this case
telling the app that that hey we're not
fetching so stop whatever spinners
you're spinning and also here's the
streaming info no error we're good third
type is the third thing we need is there
was an error so we can say like hey
there was an error here's the error
message and it takes in an error for the
arguments and the reducers again we saw
this before old state action new state
where the differences hey we're no
longer loading but there was an error
right and so right now we've just made
the action creators we haven't actually
fetched anything yet we just prepared
and laid out the groundwork to do the
actual fetching so here's an example of
an asynchronous action creator sorry for
the texts a lot of code but basically we
can highlight it so here's the first
action creator that we made we're
fetching the info here's the second one
that no here's the API call right so
we're going to our API to get the info
if it's successful and we have the info
we tell the app hey we succeeded here's
the info and if there's an error we said
oh I should have sent that error in
there but basically you can send the
error in there to update the state and
then the other thing that to notice here
is that we're using dispatch to grab
these actions that are returned by the
action creators and take them through
the cycle and that's it
that's all you need to know to make an
app with redux and actually this is all
I knew when I shipped watching for the
first time so yay cool but the talk
isn't over yet there's more parts ok
reminder before we start part two
talking
containers we have cards they're
everywhere and carousels carousels are
when multiple cars are in one place and
you can like swipe through them or
whatever um so let's talk about
containers because this is the thing
these are the things that I started
learning about after I shipped an app
and have time to actually learn about
Redux so they bridge Redux to your react
views and a bridge links to things
together
but you know the two things are separate
which i think is an apt metaphor
so no rillette redux in your react and
so what you should be doing in your
views and you react is only focus on
turning data into views and some
callbacks that's all you should be
thinking about
so containers help you separate those
two concerns so you can also define and
filter what data each components receive
if I'm working on my streaming info
thing it shouldn't mean getting
information about whether something is
saved or not and you can control that
and also it allows you to like handle
things you don't necessarily want your
views like analytics we'll get to that
again later in another idea but
basically like you can start taking
things away from your views so that all
you're doing is doing react in your
views and then having those containers
like link everything together so here is
a rough sketch of our app after we
launched and again cards you can save
and stuff right so we had a feature
request where we had to implement liking
for cards right so if you like a thing
like rock city broad city you can click
the heart on the card and it'll like it
and basically we had an issue because if
you can cards are everywhere and they're
like the Leafs
in this tree of this application so if
we wanted to implement like in cards if
you see the little stars that means that
we changed the thing so we had to change
all the cards right and then if you look
at the very top that app has a thick
border that means it has access to the
data via a container
okay so containers give you access to
the data so everything else was just
getting data through props so we changed
the cards and we changed app so that we
got the new like data right
and but the problem is we have to
connect those dots so in order to
implement something in cards which are
everywhere we had to change our feed the
posts the carousels the rec pages the
watch lists the search and right now
there's a problem right how come
adding one feature in this card thing
means that we need to touch our whole
app it takes time it's you know you're
changing more files so there's more
entropy and and possibilities for bugs
so that's no bueno cool so you can use
multiple containers and that means you
can give parts of your components access
to data more easily and you should
definitely consider it when you know
adding functionality like this involves
many different files and the way I see
it you should use them for codes that's
super essential so like our cards
they're everywhere they're super
essential or also for code that's quote
non primary and quote to the app like
abs right so sometimes ads has
requirements like hey you need to change
this thing and we only want to make that
change in one place because if if if
otherwise we have to change like our
whole app for this like requirement
that's all not not very good and so
there is a trade-off right like why
wouldn't you use multiple containers
everywhere if there's a trade-off
between access to state versus pure
components because now for example if we
share our feed
it's not gonna be shareable to another
team unless they're also using Redux
right because they need the idea of
containers so now we can we can share
this like card component but not the
card container and definitely not the
feed container that includes you know is
it sorry the feed component that
includes containers in it so there's
there's trade-offs cool so how does that
same problem apply now that we're using
multiple containers as you can see in
the bottom of the cards now have thick
borders that means that they're their
components are wrapped by containers and
they have access to the data directly to
the the store so basically we just
change the cards component and that's it
and it's a lot better your dips are a
lot smaller but again you know there's
trade-offs so I would definitely
recommend it in cases like this where
there's you have one
important component across your whole
app okay we've gotten to part three
simplifying data relationships with
selectors and before we talk about
selectors we can talk about derived data
who here knows about drive data kind of
cool
so drive data is data that you can
calculate from your state's the goals of
this is to store the least amount of
possible states okay so for example if
you're working on a database right and
you have a user a user has a first name
user has a last name and you want to
display like you know full name are you
also going to store the full name when
you can just compute it by adding the
first name and the last name so in this
case the full name is a derived data you
can also derive data like combine data
from multiple sources so if we have our
recommendation from The New York Times
and are streaming information from a
third party we can make this object that
has data from multiple sources so
merging data here's an example we have a
posts we have our saved States so it
tells us whether an ID is either saved
or not in this user the users safe thing
and we can derive a single object that
merges the post and if you can see down
there it has an is saved equals true so
now we have this object that comes from
two sources which is really handy cool
so selectors are the things that you use
to drive to the compute derive data
there's a library for this there
composable so you can use selectors and
other selectors and the cool thing is
also there memo eyes so you can like
they're not recomputed unless things
change they're like cached so you get
some performance benefits but especially
when you're doing like really like a lot
of data and you're combining them
it won't recombine them they'll remember
them and won't recombine them unless
something changed so here's some
examples here this is a simplest kind of
selector so basically the selector is
called get posts you give it a States
and it knows where in your state to get
the post right same here
save statuses by ID where in my state is
this it's in the watchlist part cool
so here is an actual selector so we're
creating a selector and the way this
syntax works is you give it an array of
selectors and a function where the
arguments of the function mirror it's
like the result of the array that you
sent in so we're sending in get posts
the selector that we just made in the
previous slide and we're getting posts
here so it got the posts right same
thing
get safe statuses it got the safe
statuses and what we're doing here is
again we're expanding the posts each
post to inject the save data to it so
that each post now has hey this thing is
saved here's another example so this is
the one we made in the previous slide so
we're chaining selectors now here are
the posts with the saved statuses here's
the streaming info ID so like where to
watch something and again we're
injecting the information of where to
watch something into this object this
post object so at the end of this chain
are watching posts from the New York
Times has information from our like
saved servers and also information from
a third party right in it and oh yes the
other thing is I found so basically if a
user saves something that selector is
going to become invalid and recomputes
right if the streaming service changes
this selector on this slide is going to
be needed to recompute but the problem
is that the user is gonna save something
more often than the streaming service
change so actually while making these
slides I found a performance opportunity
improvement opportunity in our code
which is pretty cool so we should flip
right we should change we should start
the selectors for things that don't
change ought to change often and end
with the things that changed more often
cool okay business logic so I have my
own definition for business logic and
it's the things that people tell you to
add to your app it's stuff that's
non-essential to the user for an optimal
experience of the products I hope that
isn't too forced
but yeah so basically I mean working in
a company you get a lot of requirements
from a lot of different teams and they
all expect it to happen quickly and you
as a developer don't want that rush or
expectation to like mess things up
organizationally or like for bugs or
whatever so here I'm talking
specifically in my experience about
analytics onboarding and ads right so
we're gonna talk about some best
practice to implement this with using
pure components and having redux help us
along so the first thing is is upon
clients we need to differentiate between
server-side renders and client-side
renders because for example we have some
front-end libraries that if we render on
the server side it breaks things right
so we need to be able to say hey if
you're in the server do not render this
also those renders have to be the same
as in the clients so the client also has
to do a server-side render before it
mountain before it mounts on the clients
right because otherwise the two desks
are gonna be invalid and then what you
know I guess it's out of the scope of
the stock so we also want to avoid using
internal state like we could do this by
saying this stops State DOT update
you're not in the client when you mount
you say okay now you're on the client
and have your component like redo that
thing but we want to avoid it because
that makes the component impure and
it'll like you know behave differently
depending on the circumstances where it
is and we do this by adding something to
our state that we just call is app on
client so we can do this through Redux
and I'll show you how in a second but
basically all we have to do now is if
you're in the clients do this if you're
not do this and we do it all through our
redux state and we avoid kind of like
setting local state the other thing we
do is like window size so like
advertising this is a real requirement
they need a different URL call based on
whether the user is on a mobile device
or a desktop device now this is hard for
me because for me there's no such thing
as mobile or desktop it's all just one
webpage and there's no difference right
and you can't do it with responsive
techniques because in this case an
advertising was using it to like
analytics right so you like
doing it responsibly as you put both in
the HTML and you hide one depending on
your screen size right using CSS but in
that case it would load both images so
it would like double count our analytics
and that's not good so the solution is
to only render this ad when we knew the
window size and we had the same
technique where we when the app mounts
we update our Redux state with a window
size whether it's mobile or desktop and
once we know that not before we render
this ad and that leads me to something
that I'm calling an impure top component
by the way this is also like an epiphany
I have yesterday so basically what we do
what I try to do in my application is
get rid of all the impure take them all
the way up to the topmost component
because at least I know that if
something weird is happening that's
where all my impure stuff is and
everything else is going to be like
well-behaved so there's our initial
State for our app we have our window
size on mounts and our is app on clients
with their initial values and then when
the app component mounts we can update
those things right so this bottom
function only runs when we're in the
browser and so we update the window size
and we app update the if you're on the
client or not
so middleware we had this issue where we
had to update the URL based on a search
tag right so if you click on reality we
want the URL to say you're looking for
bids worthy reality shows
so middlewares exists between the action
and the reducer right and they respond
to actions before after a state is
updated their composable so you can have
a chain of them and they're very useful
for implementing side effects so back to
this issue the way that we did it was
when you click a tag we just take it
through redux it updates the store and
we use the middleware to say okay what's
the new States and based on that we just
have a function that maps through your
new state to your URL and we update the
URL because otherwise you know you can't
do this in the reducer because other
you're having a side effect you're
changing the URL
you can do this in an action but it's
weird to be like okay update tags and
URL like they seem like two different
things and you could chain them but
again you can make getting with
asynchronous it's kind of weird and you
shouldn't do in your views right because
then you have to wait until your
component gets new props and then check
the new state in the old state and also
your logic will be like in two different
places so it's it's complicated it's a
lot easier with middleware and the take
away with middleware is you can now
describe things side-effects in a
functional manner instead of just
chaining them so here's a skeleton this
is how you would this like middlewares
work you can first check if you're
interested or not in the action that's
being run you can get the state before
you run you run the action through the
reducer you can then you have to run the
action through the reducer and then you
get the state after it so what we do
here is we update the state we grab the
state and then get the selected tags and
then just have this function that map's
this new state to this new URL so it's
very nice and then quickly so for
onboarding you can also do this you can
describe onboarding events so if the
user clicks on a thing right you can use
middleware to say like okay they click
Save is this their first time in the app
because you have that in redux and then
based on that you can show this
onboarding thing right instead of
describing this logic in your views you
have this in another place for
middleware and then yeah a couple same
thing for analytics you can have this
middleware that grabs your analytics and
just like like send stuff like crazy or
you can like filter and select which
events your you want to send to
analytics the other thing is you have
you'll have a nice mapping between your
Redux actions and your analytics so if
your analytics person is like hey what
like what do we do with analytics you
can just send them all your Redux
actions and have them deal with it okay
so now we're almost done this is the
last slide we saw how views taken state
to display an app we saw how views can
dispatch actions to like do stuff in the
world and create a result the result is
that passed down to the reducer and the
sure knows how to update your state
based on what happened and then the
state goes through the views and
everything happens over again the new
things that hopefully we learned today
is we have containers and selectors that
help you deal with data combine them and
and memorize them and all that fun stuff
and separate your Redux from just
focusing on pure react fuse
we have middleware they can do stuff
before and after reducers and middleware
is a great place where you can describe
side effects instead of having to do it
imperative lis somewhere else and then
the last thing that I hope you take away
is always compartmentalize your impure
stuff so what I like to do is just like
send it either to the top component or
to the actions so that everywhere else
in my app everything is well-behaved and
this is actually something the
separation of concerns with Redux and
with Puritan pure is something that
allowed us in the watching team to just
build a website you know less than a
year pivot like we had to change our
whole UI and it was really easy because
we just changed that views part nothing
else changed we also refactor the way
that we save and store save and in that
case we just changed the reducer part
and nothing else changed so this is
something very powerful so if you're
looking to move quickly with less
mistakes there's something that you
should do thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>