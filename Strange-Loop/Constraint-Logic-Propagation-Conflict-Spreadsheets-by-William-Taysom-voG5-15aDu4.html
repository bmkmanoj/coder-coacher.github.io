<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>&quot;Constraint Logic Propagation Conflict Spreadsheets&quot; by William Taysom | Coder Coacher - Coaching Coders</title><meta content="&quot;Constraint Logic Propagation Conflict Spreadsheets&quot; by William Taysom - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Strange-Loop/">Strange Loop</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>&quot;Constraint Logic Propagation Conflict Spreadsheets&quot; by William Taysom</b></h2><h5 class="post__date">2015-09-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/voG5-15aDu4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright here we go it's an unruly name
for an unruly topic but it's all about
um sort of programming experience so
today we're talking about the future and
I want to share a programming concept
with you that was inspired by the
confluence of a few things firstly
there's Jason Jason the eyes nurse Dinah
programming language is sort of prologue
with aggregation operators there's a
Lexi Reed Jules propagation networks in
which reactive cells store information
about values rather than just values and
most especially work with analysts using
excel in real time during multi-billion
dollar spectrum auctions imagine if you
will a secure windowless room in a
national capital locked in with
consultants and economists and analysis
for about a month there are no external
devices no internet access except to
your auction software and the job is to
help them make sense of what they're
seeing to live code beyond the some
products and pivot tables at which Excel
excels so on these excursions I'm awed
by how efficiently analysts can lunge
their data dismayed by the hacks they go
through to maintain their spreadsheets
and I'm confounded that despite all my
programmer prowess they can come up with
numbers faster all the same after a week
or so I have the scripts to tabulate
interesting figures for them those don't
require the same amount of maintenance
as the spreadsheets do and so I spend
most of the next month stuck in the room
ruminating over what it all means this
idea is the outcome of my most recent
engagement what can we do to enhance the
data centric reactivity of spreadsheets
constrained Rajic programming provides a
natural bridge tables corresponds
relations formulas to rules pivot tables
to aggregators what-if analysis to
parameterization it's all cute and I had
but then I had an idea that I felt was
actually worth sharing what happens when
we treat prologue facts and relations as
nodes and edges in a propagation network
by way of example let's see how this
might play out so in the auction room we
often have measurements of an aggregate
phenomena how the bidders are bidding
and from which we want to in fear infer
the contribution of individual factors
like what do they like and why for
illustration suppose we can measure all
the traffic of some sort into a region
but we would really like to find out how
much comes from this specific place
certainly the amount has to be between
all a nun and it turns out that provided
information about traffic into and out
of other regions we can make some
inferences so suppose we live on a Big
Island's divided into regions we have
the north and we have the west to fax
basically prologue minus the parentheses
in case insensitive let's look at these
facts differently type ctrl G to group
by region it's a table just like the
inspiration bridge in example tables
we've already seen I typed notes for the
introduction so you could see that this
tool starts as structured text kind of
like a emacs org-mode the grouped region
block is basically the same as prefixing
each line with region let's see another
relation traffic data into and out of
regions these facts have associated
values hence the equal sign notice that
this spacing of this data is tabbed into
columns so now let's pivot this table
group by the direction of the traffic
group by region we have a table with
column and row headers the data is the
same the group by command just changes
the view both its appearance and the
commands for interacting with it I
present the interface in a text editor
not because text is best though text
editors have some advantages rather
because as programmers were all used to
it I chose the atom editor because it's
fairly easy to instrument a greater man
would use Emacs some of you have made
your own let's go ahead and name this
table indenting in this system creates a
new scope by naming the table we add a
prefix to all the relations represented
in the table so now we can ask some
questions about our traffic what do we
know about the traffic into the West
well the traffic people's 404 to avoid
the prefix we can include traffic facts
as example facts if we change a value
what then we get a conflict two values
that are at odds in the future the equal
sign will never be used for assignment
equals is an assertion that two
expressions have the same
value here we have assigned into West
multiple values both 404 and 435 to
properly override a value first we
should forget what we've already
asserted to forget suggest time and
state in order to permit imperative
refinement of a model while retaining
reactive update facts collect from top
to bottom each assertion is a function
from one set of facts to another a
change from one fact may change all the
answers to questions below it in
contrast reevaluating an expression in a
mathematica notebook does not affect
related expressions so that the text can
get out of sync with the heap of
definitions if you have non progra
friends who use mathematica just ask
them about how they work around this
fact some time to retract into a cert
together is to revise the reduced
command merges facts it normalizes their
total effect on the model its function
composition let's reduce again to revise
the original we update into West by
patching in place and what do we know
about the West overall well a blank in
the question is answered by every
unifying substitution the West is the
object of three predicates region into
and out of and if we add another blank
we get all of our facts because they all
happen to be predicate object pairs
suppose we just want facts involving a
direction colon Direction defines you
are unifies with everything that
satisfies the direction predicate
however direction is undefined so we hit
enter again for a quick fix the system
can guess what might be a direction from
the predicates that already match an
unrestricted blank there's no magic here
it just requires some context the trick
is having a system where context is
readily available so let's restrict
Direction property properly and we
reproduce the traffic table since
directions label a column in the traffic
table we can combine them likewise since
regions label a row let's merge again ok
we're going to press the key there it is
so now we have three relations embedded
11 table region direction and how their
product maps onto values
now when we modify the traffic table we
assert several facts at once notice that
new Hilo facts appear down at the bottom
as an answer to our direction question
let's consider Hilo specifically we know
that out of Hilo is a fact but we don't
know its value since we left its
corresponding cell blank to fix the
value let's use a formula so equals
click and hit return just like a
spreadsheet from the formula the system
infers the value of out of hilo out of
hilo equals into hilo into hilo equals
500 so we have a to link equality shame
if we want to focus on values instead of
facts we ask a different sort of
question and then when the question is
fully grounded here we go we find
familiar functional evaluation
evaluation is old school in the future
programmers upgrade to inference so
let's do that from our data about
traffic into and out of regions we can
learn about the traffic going directly
from one region to another let's see how
this could work the ? refers to the
previous relation notice that from two
is defined for every pair of regions
rather than declaring a type restriction
the colon syntax here populates a
relation with all the values that match
the predicate to many in this case
traffic should only make sense between
regions so to correctly define the from
two relation we should stipulate that
the two regions be distinct instead of
case I use underscores to mark variables
at last we see prologues famous a
turnstile notation the / tilde says that
the two regions should not unify so read
the whole expression formerly as the
traffic from one region to another both
exists and is bounded below by 0
provided the two regions are distinct
sounds very logically as we did with the
grouped and transpose traffic table we
can add some syntactic sugar I feel this
makes for a more natural read the
traffic from one region to another
distinct region is bounded below by 0
it's a little bit better sifting out the
syntactic sugar reveals that the colon
syntax is shorthand for a predicate in
the body surface syntax
a view rotated one way or another to
make these syntax transformations
bi-directional one should retain
representational metadata such as the
variable name underscore s and the order
of arguments to the does not unify
operator so to continue with our
analysis associate the from two relation
with our existing traffic info the
traffic into a region is the sum of all
traffic from somewhere into the region
the traffic out of a region is the sum
of all traffic from the region to
somewhere else in particular the traffic
into West is the sum of the traffic from
the North plus the traffic from Hilo
aggregators fold overall unifying
substitutions they remove the need to
explicitly construct a set of items to
sum over moreover each line actually
defines 3somes one for each region three
regions in each of two lines makes 4-6
linear equations six unknowns now a
linear dependency ensures that we won't
get a unique solution and that makes
asking about bounds or while in this
case so let's take a look at traffic
from Hilo to the west with shift enter
we can interactively draw inferences
instead of having the system do them all
automatically so let's expand into us to
see other facts about it reduce them to
one equation expand to see more facts
now we've arrived at the propagation
part of our tour remember grounded terms
have associated values each term is like
a slot or cell where you can stick
information equations relate cells
allowing information to spread from one
cell to another so let's take a look at
this chart showing the relationship of
into s to other facts it's equal to 4 35
and it's the sum of the two from blank
into West facts if we learn the value of
one of the sum ends we can infer the
value of the other propagation goes both
ways numbers propagate as do bounds by
propagating the inequality across the
sum we set an upper bound since addition
is monotonic a lower bound on one
and imposes an upper bound on the other
so let's expand to see the derivation
having found an upper bound for from
Hilo to west can we improve its lower
bound to how is that done so we're going
to copy and paste the that and then
press space or whatever it is yes space
to see the derivation let's add these
facts to our chart alright so we'll just
make a little smaller to fit things so
we have the out of hilo facts we have
the into north facts and we have the
other ones as well so where does the
lower bound of 135 come from it follows
from there being an upper bound on from
hilo to north which in turn comes from
there being a zero bound on from west to
North what if the traffic into hela were
different let's say 200 so let's scroll
up change one of the entries in our cell
hit return and everything updates not
only does the lower bound drop into west
becomes a tight constraint and into hilo
becomes a loose constraint so back in
the chart switching into hilo
invalidates the previous inference and
updates are and updates out of hilo as
well our new bound is not as strong
having come around from the other side
let's ask about both the upper bound and
the lower bound at the same time so here
we go what are the bounds on it we get a
closed interval from 50 to 200 instead
of working backwards let's see how the
zero bounds might propagate forward
start by stripping down to the essential
relations so we're going to pull our
diagram here to the center here we go
let's add our constraints there they are
okay propagate clockwise
buh-buh-buh-buh-buh bub counterclockwise
buh buh buh buh buh bum all right
reduced by taking the better bound in
each case there we go okay propagate
clockwise boom boom boom
counterclockwise buh buh merge again and
then one more time propagate clockwise
propagate counterclockwise and that's
forward propagation
alright so let's bring back the editor
alright so let's try I'm messing with
the numbers again if we changed from 200
250 we find that we get a quality and if
we go to 49 we have a conflict the lower
bound is higher than the upper bound to
see how these what-if scenarios are late
let's climb up the ladder of abstraction
for our scenario were interested in the
bounds on from Hilo to west include the
example module in the body of scenario
for unqualified reference the dot here
allows a rule to have local facts so
within this rule all example flax hold
let's take a look inside here we see the
definition of the example table I use
gray in the background to suggest that
the original is kept elsewhere beyond
just viewing the included table we can
customize it we can override the
included version the original remains
unchanged more importantly we can
parameterize over a term so let's close
up the module and see that we're simply
overriding one of the facts between an
overriding diff and the fully woven
version with all customizing patches
integrated some things are easy to see
in the derivative and some are clearer
in the integral in the future we freely
switch between the two let's try some
scenarios so if we check 500 or 700 we
get the bounds and finally let's ask
about a whole interval at once the
answer is an interval of intervals
charted crudely dashes for standard
intervals stars for conflicted intervals
an equal sign for Singleton's although
we define the scenario with scalars in
mind we can apply it to intervals by
mapping the scenario across the
selection of values from the interval
similarly we can automatically lift
other functors sets lists probability
distributions time varying signals a
generalized propagation network
separates the shape of the network from
the structure of the data that fills it
sells it offers a new kind of
abstraction with more potential than i'm
prepared to explore today
instead let's just review what we've
already explored all right being
reactive is par for the course in this
workshop for every wobble for every will
have related things wobble except we
don't actually want every Whipple to
wobble well in the middle of typing a
question or making a change a system
shouldn't interrupt every messenger app
seems to experiment with sharing your
keystrokes until they realize that
people put their thoughts together only
wanting to send after they hit return so
in the example I marked uncommitted
changes with a light yellow background
some questions don't have an immediate
answer it takes time to think things
through we saw this with the the base DB
stuff earlier the question of well how
can we tell give people the feedback
that there are systems processing how
long might it take to profit says so we
should build with these constraints in
mind first and always keep the interface
responsive process in the background
report progress aboard if asked be able
to pause a process inspect it rewind
this sounds like a list of operating
system services and i'm not sure why the
api's for dealing with processes remain
so true to their 1970s roots I don't
think Rob Pike knows either perhaps with
the web all the effort has drifted away
up into the cloud well that's a topic
for another time and time speaking of
time it's a funny dimension it's a good
place to keep bugs functional
programming goes to show that you can
get by without time some of the time and
when you do need time you should be
explicit about it io using monads he
says doesn't look like purely functional
programming and it shouldn't because it
isn't a basic spreadsheet is pure every
formula is a pure function but the
people who make them or not we build
things over time and their structure at
any moment is just a snapshot so when I
am working with people in an auction
room a lot of their job is to update
their spreadsheet when new data comes in
because the spreadsheet doesn't do a
particularly good job of maintaining its
sort of inner constraints so in order to
work with time we have to step out of
time
don't mean metaphysically I just mean
that the order of events in a story
doesn't need to match the order in which
year they're written you can write it
backwards the resolve becomes unresolved
clues skitter away to their hiding
places for shadows become regular back
shadows when reading when interpreting
begin at the beginning and go on till
the end until you come to the end then
stop with structured programming the key
idea was to have control flow match code
flow first instruction to first line
last instruction to last line with some
skiff and repeated bits in the middle
admittedly this never quite worked out
and I suppose that graphical universe
interfaces are partly to blame because
they don't go from beginning to end they
kind of go in a loop still in our
example facts accumulated from top to
bottom a question asked early on ignored
spoilers that came later time unfolds
strung along the vertical ask a question
twice you'll get the same answer unless
there are new facts in the middle if we
quickly alternate between the two the
effect is to highlight a change if we
have a long list of answers scrolling
from one to the next gives us animation
so analysts know some animator tricks in
our traffic table we tried several
values for into hilo seeing changes in
slow motion in excel to make transitions
immediate here's what you do you start
with a sheet you make a copy you update
some cells you make another copy update
some cells and so on then you switch
between tabs quickly to see your
workbooks become a flip book of course
the copies have no link back to the
master so it's easy to get out of sync I
think I think there was a mention of of
cells getting out of sync in an Excel
table so in the example including a
table makes the link an overriding
customizes it scope and variables
abstracted over it and then with Auto
lifting propagation we speculated over a
range of possible worlds possible
futures layer on a user-driven selection
function and then the animation would
become interaction so let's move on to
convenience speculation comes from
convenient modularity in the example we
just indented for new scope includes
graft branches so
we get multiple inheritance how's that
for a diamond problem all right Excel
isn't exactly a tool for dealing with
tables each sheet is a grid people may
treat part like a table you can mark a
box of cells as a table with sorting and
filters but maintaining the illusion
requires diligence for instance auto
fills let you see how each cell refers
to others but they hide the fact that a
parameterize formula is being applied to
a whole column other tools make table or
take tables more seriously but often at
the cost of freeform flexibility
moreover not all data is tabular we have
trees to the example showed trees and
tables trying to coexist with a tree
understood as a group to table so
there's more than one way to look at a
thing we've seen many examples group by
more or less syntactic sugar expanding
and included table one favorite is the
convention of spreadsheet cells enter a
formula the sense of what you want hit
return and see a calculated value the
reference that sense expresses in
context it's like binocular vision from
to slightly offset planar projections we
experience a 3d scene any representation
that emphasizes some aspect does so by
obscuring another with multiple
representations though we get to see
around the obstacles all right last year
it's splash Peter Norvig remarked that
mathematical specifications don't
naturally translate into c plus plus
there's no surprises here however with a
good declarative language the
translation can be made even better than
the math at seeing this slide I was
awestruck notation practically perfect
in every way ever since I've been
pondering why I reacted so strongly
earlier I said that aggregators fold
overall unifying substitutions by
listing out those substitutions we can
enumerate all the terms in a family of
sums unification gives us an unfolded
intermediate representation group by the
left hand side to see an expansion of
each some the beauty comes from having
both intentional and extensional views
with regular unification serving as the
lens in the middle so
aggregator puts each aggregate at the
hub of a network with terms spreading
out his spokes in our example these
spokes joined other hubs forming a sort
of benzene shaped ring we propagated
numbers and bounds along the network
when Gerald Sussman talked about
propagation at strange loop in 2011 he
propagated derivatives matrices voltages
he said the value here is that I'm
allowed to dynamically change the
meaning of all my operators add new
things that they can do one new thing
was to have a propagated value track its
journey through the network that's its
province I've long used a weak form of
this in object oriented set things proxy
and objects so that all of its methods
return a proxy whose methods all return
a proxy and so on by the end you have an
image of the data downstream from the
original object this is good for
measuring how tangled your system is
these tracer doodads are good from view
maintenance to you can collect all the
metadata necessary to map a view of an
object back to its model back
propagation makes tracing even better
given a wrong value you can trace
backwards to find its causes Sussman
went on to say I can pay a belief in
correctness for tremendous flexibility
the problem facing us as computer
engineers is not correctness but
evolvability the whole purpose of
thinking things through is to go from a
muddled confused contradictory idea to a
clear orderly consistent one the degree
to which our software tools can model
confusion matches their usefulness in
conceptualising brainstorming and coming
to understand things so a perfect
language one that only compiles correct
programs is a poor fit for a world full
of inconsistency in conflict I'm not
exactly saying that we should all be
writing Ruby but a better choice maybe a
pure language in which chaos is a
first-class construct in the example
some variables had multiple values
instead of the conventional
non-deterministic or semantics I
experimented with a sort of over to miss
over deterministic and semantics so
let's take one last look at our example
we'll just scroll up to see
what we wrote down here and all this
glory I like the economy of expression
in this from a table some equations in a
simple question we get a new odds we get
a nuanced answer there may indeed be a
wide and productive bridge joining logic
programming to generalize propagation
and I hope there's another bridge over
to probabilistic programming too but
this little demo I'm not going to say is
it it's more of a curiosity and
hopefully a thought-provoking one with
qualities that future tools will share
like reactive libel wobbles a cumulative
space is time speculative possible
futures modular indent and include
tabular trees grouping tables binocular
sense and reference a grits that unify
unfolds propagating flexible shape and
conflict that resolves the muddled to
the clear so i'll leave you with nine
criteria against which you can measure
your own efforts and the promising ones
that you'll hear about in the rest of
the day I'm certainly looking forward to
it thank you
and now I would love to hear your
questions and comments yes please yeah
so you have to understand I listen to my
podcast at double time so I'm just used
to talking twice as fast as a normal
person yeah you had a question yeah so
the question is um how far does this go
and the answer is I don't know so so the
idea with propagation is you sort of
let's throw out completeness and
soundness and see what we can get in
exchange um so the thing is you don't
need to have a system aware where you're
sure that you've made all the inferences
that could be made it's just useful if
your system make some inferences that
you might not have been able to make
yourself and so in the case of a sum if
i have if i have any two of the if i
have some of three things if I know any
to I know the third but if I only know
one of them i still have sort of a plane
of possible answers and there's plenty
of things that you probably couldn't fur
that that you're not going to but it's
the the idea is getting something rather
than getting something rather than just
being left to figure it all out on your
own so that's this where I'm sitting on
this is well you when you define a
propagator you're like well for any
operations how do we propagate it and so
you say well well here's the generic way
to propagate it this kind of thing
across that sort of thing and then you
can sort of refine it with more
strategies of well actually when you've
got this this in
this you can make a stronger inference
than you would otherwise so so one way
to think about this is maybe a little
too technical is so like if you have a
monoid a free Mon oyed just all the
operations make for a bigger string of
things that you've combined and then
sometimes when it's not free certain
parts of it can you can say oh well this
when I have all these things together
they simplify to something simpler and
when I have all these they simplify to
something simpler so you're sort of
generalized system is what we'll just
string together everything that
propagated from everyone and then you
have to then say well which of these
things can now be reduced to something
simpler so that's kind of the approach
generally speaking I'm ready for another
one yes ah ok so the first question is
what did I use to make my presentation
and the answer is keynote how long did
it take I did it on the flight I came
from Shanghai so it was a long flight
and there you have it all right why am I
wedded to clear but why am I wedded to
clear well I mean you wanna um well it
depends on what your goal is clear is
good if you want to understand something
useful is good if it's just works and
then you don't have to understand why
and so I'm coming from this from the
context of we have things going on that
I want to explain in a super clear way
so I'm doing this for auctions right
this is where this idea came from I want
to explain this in a super clear away so
that a bureaucrat can tell a politician
that can tell the press and then the
press doesn't write something that makes
no sense compared to where we started so
as we can get that transition through
people that game of telephone as clear
as possible then then then my job is
done so that's why I'm caring about
clear today useful wasn't on the agenda
yes
no cuz it doesn't really work very well
that this is the future of programming
not the present day of programming so
these are ideas that a system ought to
have not ideas that a system really has
down lately if you were to pay attention
to where my cursor goes after every
operation it like just jumps around
randomly I don't even know why is it's
it's not quite right to say the least
yes please
so are you what what is how does this so
how does things relate to the present
there's the question uh how does all
this relate to the present well uh
what's a good example well I have one I
have one so at the same time that I was
working on this and locked in that
particular auction room for a
unreasonable amount of time I was also
working on a different auction getting
something ready for it and in that case
I wasn't using prologue as a DSL to
create propagation networks instead i
was using ruby as a dsl to create linear
optimization problems and so i guess the
thing to take away from this the sort of
the key idea that I had here with the
tool was when can you use a more
friendly language as the domain-specific
language to generate something that's a
name or unruly language that's uh that's
what I got out of it that's practical so
there you have one thing yes please
so how is this different from closure
doing its logic thing that I've looked
at very briefly and I'd say it's not
remarkably different I think it's in the
same spirit and grain of things I
wouldn't say a single idea here is novel
I hope they're sort of juxtaposition is
kind of fun and cool I hope it's a
something to sort of all keep together
in a nice three-by-three grid so that
you can think about it some more have a
more clear way of thinking of well what
are all the different pieces and how do
they relate what's the grand unified
theory of doing reactive II things
because there's a lot of stuff that is
really in this same grain that a lot of
people are doing I feel
all right thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>