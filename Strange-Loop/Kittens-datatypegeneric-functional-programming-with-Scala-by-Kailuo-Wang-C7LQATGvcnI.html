<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>&quot;Kittens - datatype-generic functional programming with Scala&quot; by Kailuo Wang | Coder Coacher - Coaching Coders</title><meta content="&quot;Kittens - datatype-generic functional programming with Scala&quot; by Kailuo Wang - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Strange-Loop/">Strange Loop</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>&quot;Kittens - datatype-generic functional programming with Scala&quot; by Kailuo Wang</b></h2><h5 class="post__date">2016-09-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/C7LQATGvcnI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this talk is about Scala Shipley's cat
kittens all kind of cute cute things and
talk itself us about some cute features
they can do is Shipley's cats and
kittens right now so with some real
world examples first can I do a quick
survey so heard of top-level cats is
that during your class pass using it
cool and using scholars that cool
alright so we start with a tiny program
or application it's not that real word
but we start from simple we have some
sources at disposal HR service that can
return a number of employees for
department and so on so on budget and
extension numbers from different
services and we need to be a two
services I mean two functions out of
those one is to get a department out of
those services we need to get a number
of employees budget and extension as you
can see all those information are
already available from the services and
will be another service which is giving
an employee ID you can get the extension
number from for that employee ID so
that's it so very simple and everybody
knows how to do that without any help
from cats or scholars ads you just
beautiful that give ID and you build a
new department the problem is that you
have bound variables right i mean you
have a we are doing functional
programming why we need all dez you know
the first one you have to pass the aim
do all the services and get the value
out and then put them into a department
the second one you can create you have
to first call the employee department
function and you get a department ID and
then you call the directory service
extension number Messer to get the
extension out so we know better right we
can do functional function Combinator
you know for the second example together
your employee extension we can just we
can just get combine the two function
use and then and you just have two
functions combined and you get a 1
function off so you don't have bound
variable which is going to be employee
extension you call it employed
appointment first and then you call the
extension number next that's it so great
awesome what about this one so you have
a now this one it's a little bit tricky
right you're basically you trying to
have you have three functions and then
you have a department apply function the
three functions that you have all takes
the department ID which is simple but
the department case class apply master
takes three different elements I mean
arguments so okay so then here's what
cat can can provide the first in the gas
can provide for you first introduced
cats it's a library that provides
abstraction for functional programming
Scala so it also like trying to provide
a foundation for a ecosystem of pure
type for libraries they have I think
right now dozens of library spewed on
top of cats and also when of the
important goes for cats is to provide a
respectful and helpful kind communities
trying to you know provide really help
for function for doing functional
programming in Scala so so with cats the
first thing that we can do is say okay
function actually is just a monad we can
catch provide a Mon an instance for
function applicative instance for
function as well so that as you can see
we can do man Eric sequential
combination so the first one is just say
ok for any of all this dysfunctions we
just use like a for loop and when
for loop and then we got the department
out and that's the function for getting
the department you don't have bond and
variables anymore and second wise or is
the one that I actually could probably
want to use that this particular
scenario which is associative
combination you just use to apply and
computer to build three functions use
the TIE fighter Combinator the combine
is three functions together into a
condition pewter and you map that into
the pub to the Department of climate
certain function and then you got a
department function that takes ID and
then give you department so so that's
awesome yeah cats can do that so what if
the function is the synchronous the
function no longer returns just value
it's just no longer blocking the returns
the future of integer so in that
particular case do you fall back to how
many of you were full back to one
variable nobody cool so you all you're
probably all know the trick the trick is
cats has this thing called class lee but
you know it's a it's a typical
functional programming thing that you
can wrap a function which does that it's
a function from A to B and instead of
function from A to B you take a function
from A to F of B and then you can do all
kinds of things with this classy and
combine them and compose them just like
they are function of A to B so the
example we see here is that you can map
right Mac this clock sleek and you can
create a you have a class way from A to
F of B and you have a function from B to
C and you map it you got a funk you got
a classically from A to C so that's just
the same thing as you map a function so
then we can do the combination again
with this class with help of class Lee
right we can say for associative
parallel combine ater we just wrap use
the classy wrap each function and then
for each classy it's
active so we can just do the same
combination we did before which is use
thai fighter to you know come greet them
together and then build a bigger
computer and the map to the deployment
apply and then you finally get a
classically out of that and you called
the wrong method of the class early as
you can see the dot run is just a feud
on the top here it's just just the
function that class lee contains so you
can trap that you got a function from
department ID to future of department so
that is neat and then you can also do
and then so classy has this method that
helps you to do and then so you can do
the sequential combination as well so
you do have and then combination between
two class Lee's then you get a classic
out which is so the two classes you have
is a function from for employment dept
you getta you basically have a function
from employee ID to the department ID
and then you have a function from the
department ID to extension number and
you just call and then you got a
function or classy from employee ID to
extension number so okay so then what if
your function has error handling right
so we just keep making our function more
realistic error handling with future is
actual ready big thing so you can just
use the futures baking error handling as
most of the case but in some cases we
want to use either to do error handling
you want in this particular case i can
see i use a reason on the left of the
other side thus the reason is could be
just the adt where i have the full list
of all the possible reasons that i could
cause program fail and and because it's
ADT i can i can make sure that i had to
all of them when I handle them so that's
the beauty of that's the convenience of
using an ADT for your own error handling
instead of using exceptions which is
what futures does
so so what do we do is that there's this
thing called mo neon transformer
provided by cats so it's either is
Kaiser T used to be xrt and inning
latest cats we introduced either T so
with either t you can see the future of
either as this constant corn either T
which is this a single monea so then
let's look at the chart service if we
have this type we have this either T of
feature of reason t we can just create a
new type code a reasonable future of tea
and that thing is just either to your
future visa and that reasonable future
is just a monad and then just like
instead of using future you use
reasonable future which has this you
know error handling big game which it's
essentially just a future of eyes of
reason empty so with that it's the same
thing as before we have a bunch of
functions instead of returning future of
something neutering a reasonable future
of something but they are both just
Monette so we can compose them the same
way using class lee so that's that okay
now we go to next level so real word
functions have heater generous arguments
they are not the problem is the the
thing the simplest things simplify since
we soar previous example is that the or
take a single argument department ID and
you know but in real word you have
different kind of functions each take
different arguments and they have
different data presentations again this
particular case I this particular
example you can see we have assigned
dorm function that it takes a request
that has three different needs three
different fields which is named sacks
and mentor and we have register class
method which also takes different kind
of data so how do you compose those
we'll combine those that's before we do
that we need to do to a detour to
introduce shapeless and kittens socha
place is a type class dependent type is
generate program library it's kind of
messy but i can use example to explain
that and kittens just built on top of
shapeless and cats so the example I'm
going to use is first let's look at
generosity by structure we all know maps
right with the first map is a map
between string the valid okie extreme
the value is integer right and we know
how to work with the map we can map it
we can iterate Surya can do all kinds of
stuff with it and the second map is a
map from straying to strain it's the
same thing you know we we all know how
to do deal with map don't matter how
many fields it has done no matter how
many items it has we can do it the same
thing so what about generosity by shape
so we have two K's classes but if you
screen you really hard it's just like my
maps but they are just different it's
called product so they have you know
data from of different types they just
combine together each one say the
department has number of employees which
is a integer budget which is double
extension number a string but it's just
a product it's just you know combination
of several different data so the same
thing go with students so idea is that
we shouldn't need to write a code that
is specific to departmental student we
should just treat them as we treat maps
just the same thing so let's look at
continue look example so for example in
cats we have this type glasgow traverse
and which reverse one of the function
for which provides just call sequence so
if you have fga which is f of g of a and
if that G has effective instance you can
turn that into a G of f effe well that's
abstract so
a concrete example is that you have a
list of futures write a list of future
one two three you can sequence them into
a future of list 1 2 3 which is a lot
easier to work with right that's that's
cool but what if the it's not list it's
this thing it's this department case
class its product right you have two
three different items of different types
so you have this code that you just
extract them out in construct a new
department but I you wish you can what
you can do is just say you know number
of employees is this future but is this
future and extension of this future
that's just to a sequence and we can
sequence out a feature of department
right that's what generic valued
Combinator is about so basically karen's
has this functionality called sequence
exactly as you thinking it's sequence
against a hitter generous list H list
basically if you're at you for have an
edge list of a witch a as active has a
reflective instance then you can just
call sequence and it give you a a a of
the edge list so a concrete example will
be a future of individualist of the
future of in the future of strain the
future playing and you just call
sequence and you get a future of each
list of into string to blend that the
last thing is just kneel it's just you
know the same way you construct a list
so let me see so basically we're back to
the code that we just had the what we
wanted to do is they if I have a number
of employees the future budgets future
one that I want to just call sequence
and I get a future department and that's
exactly what the sequence generic in
kittens give you so you call sequence
generic of department that give you this
said a combined eight ER so that you
call this Combinator with number of
employees of you know a future of
integer and then quote budget equals the
future of a double and you have a
extension number equals the future of
extension number you call you give that
to the Combinator it combines that into
a future of department does that make
sense cool so now we can see potentially
this can help us to do is the combining
how do we combine functions that have
hitter generous or different argument
types right this gives you something of
that you can see but before we do that
we need to just introduce hanging a
little bit so that we can introduce our
more realistic example Hanken is
basically a very very tiny library that
are just a bunch of cup of experience
based on Shipley's cats and kittens so
it has automatic and types of data
structure transformation and some
building blocks for data type generic
functional programming so let's take a
look first we have to define some types
so the whole idea of hacking k module is
this is one of the models Hank and
provides is is to provide a building
blocks for generic function Combinator's
and the core ideas you do that using our
class Lee and so we've start with some
type definition we have abstract types
so classically must have a so-called
result monad or you have to provide a
tied coil result which you also have to
provide ammonia instance for it but the
result can be anything so then you
basically
this type called k ay to B it's
basically a function from a to a result
of B so to make that more concrete go
next slide which is we define the result
to be either T of effect and a reason
and a tee so this is just basically I
zorty the effect again is a abstract
type as you see above it and there's
also a reason that is why the
application fails it can be an ADT of
failure so this is a little bit more
concrete so you know the result is
always the eyes are t so you have error
handling there but you don't know the
effect and you don't know what
particular reason is so then the next i
can make it more concrete in your
application so you can say for my you
just extend that trait and you can say
the effect is just the future right just
that type is this future so it's a
synchronous and for the type of reason
you define ADT in this ed teachers you
know just the seal trades in scala and
you have a cup of possible reasons why
application fails like exception happen
or a user error or unavailable
something's unavailable so you also
provide a effect monad there now let's
look at a realistic example hogwarts
student registration so in this is quite
some code here but it's just business
logic so it should be pretty easy to to
comprehend but say I just trying to make
it as realistic as possible so bear with
me we have a type request the first
thing we want to build at the very top
is we want to build a que from a request
to a registration record a request is
basically a map
strangest dream this is passed by the
users it's basically some random data
not random like the data input from
forming user you can sync up as a
representation of HTTP request whatever
then you want to get this registration
record out which is some basic
information like name the address age
sex and you need to assign this user at
the student a mentor which used we use
the mentor service to do that the
mattress services listed below takes in
a assignment or request right this this
request has several I need server data
needs a wind you always need a one to
enter awkwards and you need to splash
the bank is provided for you
unfortunately fortunately so we use the
web service to provide a wind and this
one service needs a name address that's
it and then the last thing it does is to
assign your dorm room and the dorm room
service taixing a signed dorm request
which takes in a name a sax and mentor
the reason needs mentors that and then
try to make people try to make sure that
people from the same manner live
relatively close to each other so that
they can I don't know fight each other
so so the first thing we try to build is
the basic information from the request
which is the map of stream stream what
we want to butte is a que from request
to basically for visiting for again it's
just some data about straight about the
name the address Agent X to do that we
first beauty extractor okay from request
to string we request again remember just
a map of string to string so to get a
string out of map of strain of spring
for particular key is pretty easy you
just say request a gap key to result
and the user error is just error one
there's no such key in the map we use
that error so that's that's it the
tourism master is a helper Messer
provided by the you write that yourself
it's basically when you say request or
the map get key you get option you
wanted you want to turn that into a
result which is either a future of
either of reason or the actual string
value you you call this to resolve
mastered so cool so that is easy to
write now how do we get from there to a
extractor from request the basic
information this is the generic function
Combinator is first introduced here so
you call this composed to basic
information to compose to is provided by
honking k which is basically just using
the kitten sequence generic in this one
basically provides the CTB is basically
proven is a function Combinator to
combine multiple functions or multiple
anything actually into anything of basic
info so here's the example if you have a
string extractor of name is you can say
my name is just the strain extractor
with if you look at the function above
the strength raptor name you just say
extract the value of under the name
under the key name out of this map so
that's just a k so the first thing is
just like name equals to this k of
requests to string and second thing is
also that and then for age we just call
and then for string for four string
extractor of age basically extracting
the value out of the H key
and we say then what we want to do is to
try to pass it into integer we can just
do that by using the second function and
then combine them together using and
then and then we've got another k of
requests to integer and then we can say
age equals to that and then and then the
last thing is similar to age which is
just you know to get the sex so then the
whole thing is a function of requests to
basic info so as you can see you don't
have bound variable here you just you
know can't you just combined multiple
functions into a function that that
provides the all the relative
information needed for the basic info
still making sense everybody cool so
we can also do automatic parser fritz
Hankins so if you look at this this is
the manual part why do you mean by many
impressive because you still have to
compose a basic information pastor or
extractor or okay from requests to basic
information by providing name address
age and sex and you what the functions
do that but with Hank and dot extractor
you can basically provide a function
that from the map to you want to say
giving it a feud I want to get a string
value out so so the first thing you
provide is a way to get a string value
out of a map giving a key so that's
basically string extractor so that again
you can see the strength director here
here I just you give a key and you give
you require to give a function that you
know given a request to extract a string
out of it this is the first thing it
provides and then you provides functions
that giving a string I want to get an
integer and giving a string i want to
get sex so it's strange result of
integers Finch result of sex you
provides all those implicitly for in
Scala you can use Hank and extractor to
automatically compose extractor from
result to request sorry from request to
be a result of basic information so it's
a que of requests to basic information
again the cave is just a function from
request to a result of basic equation he
just called us in or may compose that
for you so you don't have to manually
write you know name equals slide 8
address equals to it you have you don't
have to manually combine those extras
three into one
and another thing that you have a
different data structure as long as you
provide all the primitives of you know
the same that you can convert in
primitive types you can automatic at
those the extractor for that data type
or presentation on mcilhenny for you so
that's automatic parser which should be
automatic extractor with Hankin alright
so now let's look at the final
application which we want to combine all
the services i mentioned before which is
mentor service you know the wench
service which gives you a wind the metro
service assign a mentor for you in a
dorm service a drum room service that
assign the dorm room for you so let's
look at this it's going to be a quick
Abby it's going to be interesting but i
think this as concise as can be so what
we want to build is as a service it's a
function from request to registration
record just to remind you again the
registration record has basic
information in it mentoring it and a
dorm room in it so what a function from
request is that how do we combine
function how do we do that so remember
we the housing each k is just a monad so
we can use for loops this is how we do
it and the first thing we can get is the
basic information extractor this is the
one that we just constructed using auto
extractor all the menu extractors so is
basically this guy this guy the guy just
appeared we use that here and we get a
basic information out the code bi
so that's why it's from auto extractors
and then we need to use the mentor
service to get a mentor the metro
services you can see above it requires a
wind and a specialty so this is how we
combine several functions into that
mantra service function we can say the
wind is from we need one service so the
wine service in this turn needs name and
address ok where do we have name address
it's in bi-rite bi has name address the
basic information has name address but
in this particular one service it takes
it different data presentation takes a
gat one request it also has the Naimans
address so what hankin does is provide a
convert module that you can just convert
from one case class to another case
class as well as the original case class
has all the feuds the target case class
has so in this case it is good so the
get one requires that address name and
the basic information also had those
fields so you can just call to and now
you gotta get one request out and then
you can call a Pew request this is pure
is the key is classified pure so it gets
the Creator class lee out of a constant
value and then you call equal and then
you combine that with edwin service
right because now you have you have a
class later when request sorry have a
class event one request so you can just
call and then then you gotta you gotta
classy from request to to win and then
we want to get the specialty to
specialty is just going to come from
them the request which is the map and we
use the screen extractor again
here which got the value of specialty
out of all of the special Tiki and then
we can call strain to specialty which is
a function simply convert a string value
of specialty into into a new more
specialty that's easy so now with when
and specially ready we have we can call
the Dementor service is ready we call
the contour map our which then is a
function from request to mentor now so
basically everything you see here is
just k okay you see a que here okay then
combine enzyme is another k is another k
and here is another k they just when you
call control map on them they also a
case everything is just k so classless
then the final one is the dorm service
what we need in a dorm service we can
see is string saxon mentor and so again
we remember that name and sex is also
valuable in the basic information which
is VI so but mentor is not so this is
the case we want to convert a basic
information into a sign dorman request
which has both name and sex but not
mentor to convert that we have to
provide mentors so we can call be i dot
to this new request and call set
montuori custom enter then we get an
assignment doorman request out so this
is another function provided by Hank and
convert if you're trying to convert a
case class to another cakes class but
you don't have all the fields that the
target needs you can just manually set
it in the set function so now you have a
simon doorman request kids class and
then you call that
the function then just combine this to
the registration record now you got a
function from request to registration
record it's a combined atar of all these
functions then some with some you know a
honking conversion you know kind of like
glue between the data different data
presentations needed by those so well
are you have the final product and we
don't have I don't we don't have much
many bind variables here and we used
functional function combination as much
as possible and hosting is a synchronous
is air has error handling baking so
anything goes wrong you get the error on
either side at the very last and then
the hosting you build here it's also
just a function so nothing is executed
here so if you'd want to run it you can
just call register give it a service and
then you give it then you call dot wrong
and you give it a request and you will
run that so it's a description of the
applications not actually doing anything
else so all these projects are except
Hankins are developed under under
umbrella called type level organization
which is a community of projects that an
individual organized around in a pure
type of functional programming so I'm
going to just introduce I just want to
give all the credit to type level
organization so questions but I don't
know anything about how good school but
but I have some top-level stickers if
you want those no questions all right
it's a wrap if you need top level</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>