<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What's up with the Duck?, Hak5 1501.1 | Coder Coacher - Coaching Coders</title><meta content="What's up with the Duck?, Hak5 1501.1 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>What's up with the Duck?, Hak5 1501.1</b></h2><h5 class="post__date">2013-08-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DY5VL3qcHM0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">windows exfiltration with the USB rubber
ducky or as I like to call it
involuntary backups oh yeah
this time on hack five this segment of
hack five is brought to you by
domain.com book nack5 my name is darren
kitchen I'm Shannon Morse and to weekly
dose of Technol us and it's season five
I mean 15 no you know what season is its
season f as in its text to hex Freddy
it's a hex joke for the one there yes I
got it yeah haha that was terrible X is
10 and that's really gonna confuse oh my
goodness yes so DEFCON was really fun
it's a I think I'm still recuperating
from DEFCON cuz it was that tiring
you got the DEF CON stars no I did not
get this DEFCON Czar's this year okay so
no DEFCON flew nothing like that
I actually survived I drank lots and
lots of water like they always say to do
yes I drink lots and lots of as well you
drink all the things it happens so
what's coming up for you oh gosh well uh
this season I will be wrapping up hack
across America for what is it q3 and
then we're going to be doing oh man I
can't even say we've got the fun stuff
planned for this this fall ah first mr.
whatever so it's good I can't wait to
check I'm good I've got a whole series
planned but I don't want to get too much
into it because there's stuff in the
works well I have some serious ideas for
season 15 of course if you guys have
ideas you can always email us feedback
at hak5 org but today I'm going to be
getting into how to run a whole bunch of
Windows programs on Linux a whole
wrap-up of every single way that I can
think of that you can possibly do that
yeah nice I'm gonna be finding out
what's up with that duck I'd like to do
every couple of months cuz there's been
some really cool development in that
community and yeah it should be really
fun as well as checking out a awesome
hacker space in Los Angeles a base where
I was last week as we were as I was
doing that that talk on Internet freedom
which was
my friend Patrick just moved down there
and he's checking out that place so I'll
have to ask him how it is hey speaking
of your friend
there's also another friend that we have
let's have Mountain coming out soon
yeah I don't know maybe oh yeah they
should be on sale by now here on IRC you
should check out on all mobile yay I
think he has some pre-orders or
something or they're already there
I don't know my dates get confused hey
do you like ducks I love ducks you just
did that
stay tuned well feedback thanks dude
thank you
today I'd like to take a look at the USB
rubber ducky and some of the fun stuff
that's happening within the community as
well as some really cool payloads for
data backups that may be useful to you
whether or not you have a ducky or not
this is good just Windows command line
foo but first and foremost in terms of
information security exfiltration is
simply defined as data theft I like to
think of it as a involuntary backup and
back in the days of the you know USB
switchblade if you've been watching that
long
I developed a fun payload known as the
hacksaw which would automate this
backing up of data off your target
machine over a secure connection to an
anonymous gmail account and looking back
at that it was actually really cool
however a little noisy I mean it
required SSL libraries to be installed
send mail like executable to be
installed and so today what I'd like to
do is look at a few better ways of
backing up and so a brief introduction
to the duck so the scenario is this if
you can get physical access to an
unlocked machine even for just a few
seconds all bets are off and to achieve
this previously we use USB switchblade
our go-to tool for Auto running code on
target machine that tool violated
Windows Auto trust model which you know
by having a specially crafted USB Drive
that both mimicked mass storage and a
cd-rom drive well it proved to be a
highly effective attack platform when we
introduced it in 2006 it's even been
reported that parts of it were used in
Stuxnet so that's kind of cool yikes but
Microsoft patched the autorun flaw and
with the unproductive Vista so then we
started digging deeper and it turns out
there was an even bigger inherent trust
to go ahead and violate and it affects
not just Windows machines but really
anything computers trust humans I mean
this should right and some humans speak
to computers through keyboards and it's
the simplest most single inherent
trustee in all of computing today and
and that's what the USB rubber ducky
sets out to do to violate that trust and
we began this project in 2010 with the
simple teensy dev board and since then
the project has really come into its own
as we developed cetera several
iterations of custom built hardware and
through some remarkable efforts of the
open source community
ducky has really come into a ton so I'd
like to share with you some really cool
stuff that's come out of that right now
I wish that I could share with you some
of the awesome duckies stories that the
pen testers and g-men told me at Def Con
but I digress okay
it's human interfaces human interface
device humans they interact with the
computers would like to computer to us
and so I talked to a computer with a
keyboard a mouse and joystick
fingerprint readers whatever have you
I mean previously each of these
different devices had their own
purpose-built
ports I mean you remember the the purple
ps2 port on the keyboard and the green
ps2 port for a mouse and sometimes you'd
have like a 15-pin you know orange sound
card you know on your sound card you'd
have a game port and each of these had
their own protocol but thankfully USB
brought some sanity to this with the
specification for human interface
devices and so in the world of hid
there's a device and a host and so that
would be sa a keyboard as the device and
a PC as the host it could just as well
be say a keyboard and a I don't know an
Android tablet or smartphone you know
the only thing is that the host just
needs to know how to communicate with
the device and for that all it needs is
this thing called a hid descriptor it's
a set of instructions that explains
basically how you know what the device
is and how its package structure works
and whatnot so you'll find the special
gaming keyboards but the more complex
descriptors because they've got all
those special keys but generic drivers
for most common heads like keyboards and
mice they're built into all modern
operating systems you know Windows Mac
Linux really anything so it's really
beautiful so with all of that said the
USB rubber ducky is the idea to take
that custom hardware hide it inside of
an inconspicuous looking thumb drive and
make a programmable head so that we can
actually get our auto run back on and so
I'm gonna show off some of my favorites
right now and some of the cool
developments in the community so just to
start off and give you kind of an idea
what I have running over here on my
Linux machine is I'm logged in to a web
server I'm logged in to a VPS up in the
cloud and I've done MCAT which is
version of net
and I'm listening on port 8000 - okay so
that's just to set that up now I also
have a payload on this USB rubber ducky
right here and I'm gonna go over to my
Windows machine and minimize all of this
now this these payloads a lot of times
what you'll want to do is do some sort
of obfuscation or other techniques to
try to minimize how much time the
computer looks like there's actually
that it's being interactive you know the
scenario may be that you know the
secretary leaves the desk you have a few
seconds to inject your payload or
actually how this was all came to be was
for me as assisted man you know I had a
bunch of these where you know I'd get
calls from you know people at the office
and it'd be like oh you lost connection
to the network printer will grab the
thing that says network printer and plug
it in so you know really depends on the
scenario but I like to try to keep it as
minimal fit footprint as possible as far
as the interactive bits on the screen
for these demonstrations I have not done
a lot of Albertus case in just so you
can actually see what's going on here so
let's start with the netcat because this
is a really beautiful example of why you
would want a typey typey and not a mass
storage device so all right I'm at my
Windows desktop and I'm just gonna go
ahead and plug this in the USB port and
so the first thing that's going to
happen is we're gonna bypass UAC
very quickly hitting yes we did that
with a little PowerShell goodness and
now we are copying a new file into the
computer this is a VPS script and that
is going to base64 and could take base64
encoded ASCII turn into my nary make it
an executable that's what we're
injecting right now all of these letters
are just its base 64 encoded and files
copied and we've run it and if we come
back over to it was that quick that was
all it was and so Paul if you're able to
pull off my my Linux machine here there
we are I'm in C colon backslash you know
windows system32 I'm on that system You
Know Who am I
oops Who am I and I am this machine over
here and that's you know that was that
quick and we didn't actually download
anything off of the network we didn't
you know mount mass storage to get this
I mean sure we are using a very simple
netcat reverse shell it was I think
about two kilobytes so it takes about 20
seconds to just jam that in keyboard
wise which is beautiful because this
thing never forgets anything it doesn't
have to you know take a bathroom break
or anything like that it's always the
same code that's really cool because now
that I'm on this machine I can have all
sorts of other fun there are more crafty
payloads whether it's using an
interpreter shell or for you doing an
encrypted netcat which was probably a
better idea but that kind of illustrates
what's possible so with that said I want
to walk you through my new favorite
payload and this is for basically
exfiltration for backing stuff up I want
to be able to backup files off of this
Windows computer without using mass
storage and without going over the
Internet
and so for that we're going to do a
little bit of Wi-Fi slurping so you've
heard of maybe pod slurping before where
take an iPod and you plug it into a
machine and using some auto run you're
able to you know have a ipod turn into a
portable hard drive and download all the
data to it you can do the same thing
with us we rubber ducky as well with a
second thumb drive but I like the idea
of taking the target machine and just
turning it into an access point so let's
dive into this code so this exfiltration
payload the first thing that we're going
to do here is pull up a GUI our that's
the you know windows our run menu and
we're going to enter in this powershell
string what this does here the start
process is it opens command but it does
it with a run as and so what that does
here I'll just go ahead and run it now
is I get
pop-up that says hey UAC is like saying
do are you sure you want to run this ad
with admin prigs and of course we do so
all we have to do is either hit alt Y or
the left arrow on our keyboard and enter
I like going without y but either way
there we are we're system32 we are in as
you can see it right in the top left
there administrator so that allows us to
do other cool stuff we do a little bit
of delay here obviously because you know
we want to make sure that the windows
are up this is you know fifteen hundred
milliseconds so after that I do a little
bit of obfuscation and so when this all
runs you'll see it's gonna go by really
quick so I'll just go ahead and run this
in the command prompt now this is kind
of fun you could do this on your Linux
box but hey check that out
okay I just made it yellow on white and
now I'm gonna do mode con :
coal's equals 40 lines equals one and
now my command prompt is itsy-bitsy and
completely illegible I know I know this
is nothing more than obfuscation however
it's kind of fun another way to do this
would be to just take that window and
kind of put it below the start menu so
that you it's still active and you can
still type in it however it's you know
not visible on the screen and so to do
that
that would be an alt space and then an M
and then just hit the down arrow a whole
bunch and you can see you can go way
beyond and then when you hit Enter it's
it's back there and it's still
highlighted if I hit alt space and M I
can bring it back up here okay so I'm
gonna close that out now basically the
rest of it I can show you in here we
create a batch file actually Errol to
show you this this is pretty cool copy
cannae is one of my favorites it's
basically like doing an echo with an EOF
and some Wacka Wacka x' and linux except
it's the DOS variant if you haven't
figured out yet I find all of this
fascinating because like das was my
first you know operating system you know
and didn't have a Windows machine I had
a IBM pc/xt so so copy column was
something that
pretty early on is an easy way to make a
batch file copy con hello you can type
hello world and when you hit control Z
and enter it saves the file so that's
what we're doing right here and we're
adding a new user called tech support
and then we set that new user to be part
of the local admin group so now we've
got a local administrator now we're
gonna hide that local administrator that
with this registry entry here and then
we're going to enable file and print
sharing so this is the new commands for
enabling file and print sharing just in
case is not already on we also come in
and set a new share so this share is
called tech support and it is C colon
backslash and unlimited and then we're
going to need to use IC ACLs that is a
utility that's going to allow us to set
the permissions for these users and in
this case I'm adding the user tech
support to grant access to C colon
backslash users backslash star because
if I were just to do this without doing
that but I do a start dot here or start
hang-on CMD start dot you'll see this
this folder right here this is my you
know my user home directory and it does
not by default have permission for this
user so that's what the ICAC else does
and we give it a F over here which gives
it full preps and then we bring up any
wireless interface now mind you that's
you know this is a bunch of net sh fun
stuff that enables the whilst that were
just in case that interface were to
happen to be down and mind you that
obviously for this payload to work your
target needs to be actually like a
machine with a wireless interface and so
it's kind of geared towards laptops in
that sense all right so with all of that
said the very last fun bit is to start a
network so this net Sh command net sh
double n set hosted network creates a
soft access point with the SSID of our
choosing
in this case tech support and the key of
our choosing in this case tech support
and then this command right here just go
ahead and starts at all so very last
before we exit I do like to do this this
is a fun one totally useful with or
without the ducky the 4 F in X you know
but basically what this does is this wev
T util allows you to do that CL which is
a clear and this clears out log files so
if I were to do this now let's paste
this into my admin prompt bypass UAC
and paste that in you can see what it
does is it goes through everything
clearing out all of my logs which is
great because then if say I was gonna
you know help my friend backup the data
off their computer over the Wi-Fi I
might want to also clear the logs so the
forensics investigator is gonna have a
fun day and so let's go ahead and take a
look at at running this so yeah it does
it runs it exits you know does the ctrl
Z to save it runs it and then I do a
null space and I love alt space and it's
one of my favorites alt space and
minimize right so that means at the
point that the window has become
minimize you can actually go ahead and
pull the USB rubber ducky out because
you're done it's done typing the rest of
it is buffered in that in that shell
script shell script that batch file that
is then running in the background it
only takes at a moment all said and done
I think this one is something like 25
seconds I don't know we'll see so let's
go ahead and do that but in this machine
now see
you
she´ll goodness on bypass some UAC and
now everything gets tiny and you pretty
much can't see what it's doing for the
rest of it until it minimizes and now
it's done and I can unplug the duct and
the man prompt here will disappear in
just a moment once it's done you know
clearing the logs and all that other fun
stuff that I had doing so let's come
over to the Linux machine because what
this this Windows box has done now is it
is opened itself up to a whole bunch of
cool possibilities so I'm in my Ubuntu
machine here now if I come over to
wireless networks here
and go to more I'll see my USB rubber
ducky Network I'm going to connect to
that password is tech support and now
we'll go ahead and browse the network
and I see my target machine and go into
that and now I see my tech support share
so let's go in there and there we go if
I go into users DK the user that I just
exploited I can go ahead and into my
documents and everything else and now
you know if I'd like I can actually
download all of the contents of this
computer to my computer to back it up or
I could even put new files on there or
change existing files whatever have you
as long as you know my fun little hacker
machine over here is within proximity of
the target I mean mind you you know
while it's convenient that I only have
to plug in the ducky for what 20 seconds
for this payload to run I do have to be
close by to be able to download all of
that information however I don't have to
do right now let me show you what I'm
talking about over here on my Windows
machine I've got some post exploitation
cleanup that you can do basically if
you'd like you can put a batch file in
in this location right here from your
from your other machine and basically
what this will do is next time the
person reboots since it's in the program
data Microsoft Windows Start menu
programs start up you know directory
this will always run and you basically
just have it delete the tech support man
that we did delete the user delete the
share clear the log files this Dell
right here with the percent tilde F 0
that actually deletes itself there's
some really cool stuff that you can do
with these well with all this magical
variables that start with percent but
one of the other fun things you can do
is for persistence you basically just
run these again and every time that
computer boots it will set up that
wireless network so if you are not able
to grab all of the data off of it that
you need to perhaps you can go back and
get it later which i think is really
cool some other really cool stuff going
on
ducky community let me go back over to
my Linux box here because sky sploit
right here I set up an awesome payload
generator I think we talked about this
um you know like I don't know a few
months ago but basically this thing has
really gotten more and more robust over
time this right here is a ducky payload
generator and we can go in here and
choose you know to create custom
payloads or to create reverse shell
payloads Wi-Fi attacks you know password
attacks payloads for OS 10 and Linux you
know all sorts of other really cool ones
that I can't even begin to get into here
this is this thing is so robust for
example here we'll do a custom payload
you know we're gonna do it for Windows 7
or Vista with admin access we're gonna
say yeah we have UAC
no we're gonna choose how we're going to
you know do our pre attack stuff whether
we're gonna minimize command prompt
disable the firewall enable some remote
desktop you know we can create those
users you know it's it's just so easy to
come in here and just choose some
options and and at the end of it you
know when we continue our attack we're
gonna you know we could set up a proxy
we can do some PowerShell stuff yeah
we'll do some shells will do a
Metasploit shell this will even set it
up for you you know you just enter in
the IP addresses it you know creates
everything for you I really love it so
that's definitely one to check out as
well as if you don't want to you know
this is a no it's a bunch of scripts
right so it's really easy to get started
on any debian-based you know whether
it's Kali or Ubuntu or whatever have you
because there's installation scripts
that take care of all of the
dependencies if you're running Kali
Linux it's really super simple to get
started with this but if you don't even
want to go that route there is also a
new online generator that I really want
to to show some love to because 411 on
the forums has put together this this is
the
ducky toolkit the duck toolkit version
one is out and basically walks you
through creating payloads over the web
so you basically just come in here and
choose what you want whether it's
reconnaissance if we want to go grab
user information if we want to get you
know a network scan going let's say we
want to share some Drive information we
want to you know copy the wireless
profile I'm gonna copy the Firefox
profile let's disable the firewall and
add a user and opens the firewall ports
and here the C Drive and enable RDP and
then we can save all of this to an FTP
or we can email it to a gmail account
and then we just hit continue and for
all of these when you continue first of
all you get to choose your keyboard
layout I'm gonna go with American and we
can just basically fill in the blanks
here and it does the rest it generates
these payloads which is really fantastic
I just love the cool stuff that's coming
out of this open source community
there's way more than I could even cover
right here that applies whether you know
you're doing a ducky style or you're
just looking for ways to automate all
sorts of fun windows administration you
know I'm saying so I'm going to take a
break now gather some feedback feedback
a hack five org on this and next week I
want to show off some other kind of cool
slurping techniques but until then I'm
gonna hear from you that feedback at
hack five Gorgon we're gonna take a
quick break
budding entrepreneurs startups and
innovators are all turning their ideas
into realities backed by the strength of
a dotnet domain that's right dot nets
they're globally known it's one of the
world's most popular domain extensions
and dotnet domains inject your business
with instant credibility entrepreneurs
and startups are immediately discovering
the advantages of building their web
presence around a dotnet domain so get
this and you already have a.com
purchased the corresponding net and
protect your online brand or is the
dot-com you want already taken you want
to register a.com name that's like
twenty five characters long it's cool
the dotnet is a perfect alternative you
can find a new dotnet domain over at
domaine de
I love domain.com because they're
affordable they're reliable they're easy
use not nets are only like $8.99 a year
plus domain.com is active social media
presence on Twitter at domain.com and a
great customer support makes it really a
fun place to do business so get this the
guys over at domain.com are huge fans of
hack 5 and you guys so they want to hook
you up get 15% off they're already
affordable domain names and web hosting
all you have to do is use the coupon
code hak5 at domain.com check out that's
15% off and big-time savings so don't
forget to use the coupon code act 5 when
you think domain names think domain.com
last week's trivia question was who is
the creator of hack RF an open source
hardware project to build a software
defined radio peripheral and the answer
was Mike Osman now this week's question
is Advanced Encryption standard aka AES
was introduced in one year by what
establishment you can answer that over
at hack 5 org slash trivia for your
chance to win some awesome hack 5
goodies</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>