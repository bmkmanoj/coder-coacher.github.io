<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Snagging Creds From Locked Machines With a LAN turtle - Hak5 2104 | Coder Coacher - Coaching Coders</title><meta content="Snagging Creds From Locked Machines With a LAN turtle - Hak5 2104 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Snagging Creds From Locked Machines With a LAN turtle - Hak5 2104</b></h2><h5 class="post__date">2016-09-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/AVqh5mcFcFU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">stealing creds from locked machines with
a land turtle and mobic all that more
this time on hack five hello can hack
five my name is Darren kitchen I'm
Shannon Morse
it's your weekly dose of techno list
welcome everybody we have a very special
show today why is that because really
hacks we've got move exciting us on the
second half of the show and we're
showing off fun attacks using the land
turtle nice and basically recreating
what move exceed in that stealing creds
from locked machines so I hear you just
got back from Beirut it was good time
yes that was you know my first time in
released and Lebanon was was awesome
Beirut was a beautiful city and what
were you doing that I was doing a social
engineering engagement for National
Geographic with Jason Street will and if
you're at Derby con this weekend come up
and give us a hug and we'll tell you
some stories on camera yes we've all so
what devices were using when you were in
Beirut we were I don't know how much I
can give away about the documentary so
else I'll just say that what we were
doing was we were using a lot of USB
rubber ducky
okay it was very effective why didn't
you use Lanter at all well you know in
all honesty we should have because while
we're in the middle of this engagement
Rubik's drops this awesome attack using
the land turtle the snagging creds from
locked windows machines over at ro
Russia 62 calm right go and check it out
in fact that's why we have this why we
have Bob here because we're gonna steal
these threads and yeah we could have and
so actually as this dropped I was like
rushing to install it on my turtle but I
was like at a dinner where of course
there isn't like an Ethernet drop for me
to get my turtle online course I didn't
know about turtle Sh which is up on the
github repo which shares the internet
connection from your laptop to your land
turtle anyway long story short it
involved tethering my phone to my
pineapple my pineapple to an USB
Ethernet adapter a short cable to my
land turtle connected to my laptop and a
couple iptables rules that means that
that worked we I think what it really
illustrates is kind of my impatience cuz
I'm like
cool attack have to try it right now and
I'm like in the middle of a dinner with
a bunch of folks from National
Geographic oh yeah I can attest that
kind of thing happening all the time
with Darren not I'm not impulsive I'm
just impatient
I just want now all right so it can
happen I want to know how this works
okay so you know what movie is gonna
join us after the break to kind of get
into the the does not smolts of how the
attack works but essentially what it is
get it set up is he's run it you bring
your own Ethernet you know you bring
your own network and at the USB the land
turtle is a USB Ethernet adapter you
plug it into a machine it's like all
cool the network and then it does all
sorts of stealing stuff to grab ntlm
hashes over a network to set it from a
locked machine from a locked machine
which is really fun because we ran into
a few of those and as you know the USB
rubber ducky can't do much against the
lock machine and it hasn't been fixed no
and this is prevalent all the way back
to Windows 98 so let's let's just dive
into how to get it set up on the LAN
troll because of course after I saw you
know movies is awesome right up here
detailing you know how to get it set up
and you know all of the different you
know commands and options and all of
that stuff my first thought is ooh let's
script it and make it easy
of course the land turtle is all about
okay so I've got one plugged into my
Linux machine right here so let me go
ahead and just SSH into it and show you
how to set it up if you have a land
turtle as well so I have an IP on my
land turtle which is at 172 1684 one
I'll log in and I get my turtle she'll
go to modules and basically there's an
app store in that the module manager if
you go over and configure it you can go
to the directory Atlanta turtlecom and
download any of these over the air so
it's called quick creds and it snags
crabs from LOX machines
Moving's is awesome attacks so we hit
okay that's installed and now when we go
back to the directory I will have quick
creds so all you have to do and this
kind of explains basically it implements
the responder attacks and saved creds
into number directories and slash route
slash loot and an LED will bring blink
rapidly well quick creds is running and
then upon capture of the Intel M hash
the amber LED will light solid really
simple in fact there's nothing to do to
set it up other than to hit configure
and say yes it's like yo dog you once
all tendencies
okay yeah and then after that it's just
updating packages and installing
dependencies it's there's nothing to do
them I press that we go to Starbucks I
guess we can we'll be back right after
no we kind of could actually oh I might
have actually already done that anyway
uh yeah boom we're done so that's it
it's now configured and I like that you
named it /root slash loot right it's all
about the loot you know it since since I
oh the one other thing that you need to
do is enable the service so you get a
quick creds and you say enable so now it
starts up every time you boot okay um
I'll show you that looked really hard
yeah I know right well let me show you
like what it actually does so that
there's like you know some knowledge and
stuff in this episode so basically
turtle modules are all live in at sea
turtle modules on the land turtle and
you can see that they're literally just
shell scripts and they can be written in
any of the languages that are supported
by the land turtle and I just use bash
because you know what let's get that job
done we got better things to do but if
you if you're feeling okay if you feel
in Python go pies yeah I'm not going to
hate you no yeah I'll just open it up in
nano so you can see basically you need a
couple of functions you need one that
allows you to configure the module to
start the module to stop the module and
do a status on it to figure out if it's
running or not okay if you've got those
four you're done that's that's really it
that's awesome
and so as I was talking about the
configuration module all it does is it
uses this pretty dialogue to you know
say like yo Dawg this is going to
require an internet connection and so we
you know ask yes or no and if it's no
then we exit and if you hit escape it's
exit but if it's yes we continue okay
and then otherwise it's just checking to
see if you have an internet connection
and then what else you know we do that
by paying land turtlecom and then we
install the dependencies and basically
these are just a bunch of if statements
saying oh package list installed and
it's grubbing forget so it's checking to
see if you have get installed and if you
don't then it's just going to do an OPEC
egde install get and it pipes that to
this dialogue progress box thing just to
make it pretty
just to give you something to look at
right but otherwise that's
that's pretty much it and so it does
that with the rest of the dependencies
like sequel light three and screen and
OpenSSL and what else here core utils
sleep and then finally what it does is
it doesn't get clone on responder and
then pops that and at sea turtle
responder and that that's pretty much it
we I know
make the loot directory we set up the
log
now when you ever you start the service
what we do is we kill this DHCP detect
script which which is typically on the
land turtle what it does is when the
target computer gets an IP address from
the land turtle and you plug it into the
USB port we have this special blank
pattern that goes on off on on off on
which is a which is like some stupid
like inside joke between seven I about
putting the original wife at pineapple
firmware offset on a fun they fought
anyways its Arctic anyway the rest of
the script is really simple we just we
basically set up our directories this is
the fun thing where it basically creates
a numbered directory based on the
previous number in there so every time
you plug it in you'll get a new number
directory and you'll save all the loot
there and the rest of it is pretty much
you know running responder in a screen
session with all of those options and
these are the ones that maybe we'll talk
about that makes it all work and then
the rest of it is looping around looking
for any ntlm logs and if it sees those
it goes I got it wildcard ntlm wildcard
right nice and then it goes to finished
when it's done creds otherwise it just
blinks the LEDs and you can you just
blink the LED by echoing 255 gone hmm
and 0 to off and gives you the same
thing with LEDs with Arduinos oh yeah
that's up yeah
255 all the way down to 0 you can't like
pulse them cuz it's really just on or
off yes it would be really India you can
do it if you if you change the numbers
slowly yeah but that would require some
work yeah I don't think this hardware
will do it be either way that's pretty
much it I mean the rest of it is just
the more bash it's you know it
when it's finished it just makes the LED
go solid and then you know stopping it
and checking the status of it or just
checking PS and you know running kill so
essentially what happens is you know you
go up to a locked Windows box here and
you plug in the land turtle okay and you
wait I don't know 30 seconds
the attack starts going and the LED
starts blinking rapidly while it's
working and in a minute or so it'll get
the creds and then the LED will just go
solid so is this your baked turkey over
here yeah yeah this one's already set up
that is when I just installed in this
ready to go so do we know Bob's password
and it's just locked right it's not
logged out yes so it doesn't work on a
machine that is logged out it does have
to be logged in but it can be locked and
so you know in corporate culture we've
been taught you know as soon as you walk
away from your desktop you know you're
going to go get some coffee go to the
bathroom whatever you hit Windows key l
or ctrl ll or whatever it is on your
workstation to lock it right
you think it's safe and you think it's
safe until someone brings the network by
and then your computer is all like ooh
networks I love those here's my hashes
oh we should we should take a break and
the move explain the rest because I've
just been silly all the a block and with
that we're gonna thank our awesome
sponsor if you have yourself a great
idea like stealing creds from locked
windows boxes you should do what we do
and that is to register an awesome
domain to bring it to the internet in
style and the way Shannon and I love to
do that is to head over to domain com
domain accom is the place to get
yourself your website up and online in
no time flat they have a super simple
checkout process they've got an
intuitive domain discovery system that
will help find the perfect domain name
just for you and get this the guys over
at domain comm are such huge fans of
hack 5 and have been supporting us for
years so they have a coupon code for you
that's going to save you 20% get this
it's hak5 that spells hack 5 used at at
checkout over at domain.com and get
yourself a sweet sweet deal and you know
what tweet at them at domain.com and say
hey thanks guys for supporting hack 5
all these years when you think domain
names think domain.com we're back in
here to talk about how all this works
look at Fred movie Express
it's awesome we just finished a pen test
with act 5 and it was so much fun and
everyone was just asking all of these
questions because in the headlines
lately it's all about getting creds from
locked machines man yep it's it went
crazy it like I posted it like 4:00 4:30
a.m. and like the next day I woke up and
it was like on the register hey you made
the register I'm up whoa and then it
just went crazy from there right I was
actually in Beirut when this happened
and I'm like they're at a dinner with
like my machine and I'm trying to get it
installed I'm a turtle and I'm like oh
my god let's go um tell me the how do
you get creds from locked machines well
you don't really get creds okay so
credentials are is a stretch you get
ntlm network credentials so it's
actually hashed a path your so your
passwords say it's lame password it's
hashed into until 11:00 stored and then
over the network
it's then salted as it connects to the
attack okay so walk me through like what
is it so I'm I'm imagining I'm a Windows
machine I'm making a connection to a
remote server as I typically do in a
woman environment and when I
authenticate with that remote server
what is that process what does that
process look like and and how are we
able to get that sure so when I when I
go to a share I say hey share can I
access you know you're awesome files you
say
sure no problem authenticate to me I say
ok and then you send me a server
challenge you say here's the challenge
you you hash your stuff so I take the
ntlm of my password and I hat I add a
salt on to it I it's there's a lot more
crypto and I'm not a crypto guy so
there's a lot more stuff that happens
and then I say here here's the network
ntlm v1 you compare it against yours
since you're the one that gave me the
the challenge you can do the same for
that and then you compare it just like
you do and tell every citizen tell em
this is just over the network so that
people who are sniffing it can't see it
as much okay so and and how are you able
to when when you plug in a device like
the
turtle or the USB Armory able to capture
that right so the only big thing about
this thing is that it's a small little
device the the armory or the turtle and
it plugs in pretty fast and the way you
capture it is by becoming the default
route so the default route the default
DNS server and all of the other things
that DHCP does for you by adding those
things in well as we know with say the
Wi-Fi pineapple over years of experience
is that when you become the network you
have an immense amount of power right
and there's a lot of inherent trusts
that are built into you know trusting
the network that the computer is
connected to right right so windows will
automatically trust its local area
network for HTTP and SMB authentication
so in a way this is like a bring your
own network attack yep in that both of
these devices are going to enumerate as
you know as networks and then the
Machine is going to be like oh cool a
network I love a network hey you got a
DHCP server the DHCP server is like yes
I have a fine selection of IP addresses
as well as all of these other IP options
right yeah specifically the 251 actually
helps quite a bit it's a specific DHCP
option only for Windows and I thought it
was only for Windows there might be some
other things in there but what it does
is say here's your W pad options in
there okay so explain to me W pad
because I've seen you speak at
conferences about W pad in the past give
me like the explain it to me like I'm
five what is W pad and what can I do
with it as an attacker sure so W pad is
basically wpad wet windows proxy
auto-discovery
or something similar so it then says hey
I need you to find my proxy settings for
me and that Windows machine will go out
and say hey is there a W pad computer
out there
I need my proxy settings and then a
little JavaScript file called W pad dot
that is pulled down parsed and then it
goes and follows the rules in that flow
inside of that javascript file awesome
so I've been following along with your
write-up on this on your blog at room
362 com
and it looks like one of the major tools
that you're using to spoof W pad
is responder yeah that's um so
responders been around for a long time
Laurent Gaffey is the original developer
of it and still keeps making changes to
it to this day on his github repo and it
basically stands up and spoofs a bunch
of different services everything from
LDAP to SMB to HTTP as well as proxy
authentication so it also does W pad
spoofing as well so n VN s and L LM n
are requests that come over the wire it
will then send out fake responses as
well as DNS and that's where we're
really utilizing this so what you're
saying is it's sort of like the
pineapple in a way when somebody
requests something it's just going to
answer yeah I'm that and then give them
what they're expecting to see and in
this case
capture this ntlm hash right it's the
pine ap of networking nice so tell me
what are the affected operating systems
and what kind of hashes are you seeing
because I at me as an attacker
I want a me know what what I want is
that LEM hashes because those are like
stupid simple but it's also not night
it's not 2006 so I want an ntlm or or do
I so so the interesting thing about this
is that it works all the way back to
Windows 98 se like you plug this thing
in and drivers are automatically seen
and the authentication happens it's been
around forever but as as Microsoft has
gotten better at securing things the
type of ntlm that gets passed over the
wire goes from ntlm to NT lan b12 mt l
MV - so indium v2 is Vista and above
ntlm v1 is I think it's Windows 2000
above I could be wrong there but it's at
least XP right so the interesting thing
is that ntlm v1 has been totally broken
so until out that yes because it because
what you're talking about quote because
ntlm is the hash that you're that for
you know all intents and purposes it's
how your password is stored locally on
your Windows box right and if you could
crack that you'd get the plain text
password out of it I don't have to you
can pass the hash with it right
whereas and when I pass the hash what am
i doing so you're taking the hash and
so basically when when I have the
ability to have your hash I can do the
exact same thing with any other computer
on the planet so remember when I talked
about I need to actually know the
person's password as long as I have
their hash I can connect to servers that
they have access to they have access and
then just pass them that hash and then
they'll trust me as being the legitimate
user right so and number how we talked
about how you give the challenge and I
give the response well in order to do
that I have to have the straight ntlm
right so that's how passed the hash
works so I can take your challenge
convert it and then it then it syncs up
right and so but that that passing back
and forth though it ends up becoming the
and the network version of NT land right
those ntlm v1 and v2 s and that's why it
gets a little confusing is because they
have the same name yeah so ntlm v1 is
just with the server challenge and there
has been quite a bit of research to
break that out using just DES cracking
with crack SH now actually hash cat
supports as well
cracker sesh does is in 23 hours a hash
cat can do it within a couple of days
depending on how big your cluster of
GPUs are time to buy some 1080 video
cards right but the cool thing about
that is that no matter how long the
password is you get it back to the ntlm
and then just past the hashable versus
the ntlm v2 where you get from Point
Vista 7 anything above Vista and
anything misconfigured to still allow
until everyone I've seen a lot of domain
controllers that still do ntlm v1 - so
so the difference being is that in ntlm
v1 it uses the client challenge as well
as a server challenge to it do the
crypto fungus inside of that so you
can't have the DES cracking that's there
you have to crack it so if someone has a
long password even if you do this attack
you're not going to get anything useful
out of it I see whereas with ntlm v2
right so with ntlm v2 that's you where
you don't get the useful stuff as where
as NT on v1 you can crack it into MTM
and no matter how long the password is
you got something useful gotcha so here
on my turtle I was able to pull up let's
see cat that
Roxy auth Intel and v2 and there we go
that's the hash for Bob and that's the
ntlm version too right so the only where
this the only place this is useful is if
you can crack the password so if you
have long passwords that's a great
mitigation for this Oh fantastic tell me
tell me about some other defenses in
mitigations for this then so one of the
things that I've heard so far is that
that Microsoft accounts don't
automatically authenticate on on local
area networks
so there's your there's your mitigation
there but most domains and most real
targets have to say like don't I like
there's active directory and domains for
a reason right right right right we are
using MS accounts um there's another
thread that I'm working on about turning
into MV want are ntlm off completely but
again hard to do on an enterprise level
there's I've heard so many different
mitigations to this that I haven't found
one that really works solidly that's
easy for an enterprise to do across the
board right and it's still very new
implementation of this attack so we're
there in the early stages of this
research but where can people find your
research and and the continuation of
this so look I don't like it being
called research because it's it's just
me throwing a DHCP server on a small
device but on room 362 comm is where I
will post any mitigations that I come
across that actually work awesome well I
really love the I mean I think it's
novel the the byom the bring your own
network you know it sometimes it's just
kind of the the implementation that
changes everything right and making this
easy exactly this is really cool I'm so
glad to see all of this kind of develop
and I'm so glad that you could come on
that you were just here for pen test
with hack five everybody should go and
check out Metasploit minute by the way
rubik's does an awesome job on hack five
channel with that show and so if you're
new to this and you want to learn one of
the best frameworks your penetration
testing you need to get in on that
series and check out his patreon because
it's a fantastic show Rob it was awesome
to have you on I know you've got to
catch up lightly right now but this is
just awesome stuff and we'll have to
have you on again we're Derby cons
coming up towards coming up this is
going to continue developing so yeah
stay on this but thank you so much room
three six to calm guys go and check it
out well that just about wraps up this
week's episode of pack five but before
we get going we've got WinRAR we do so
this week's technology of the week is
from lord helix if you guys are
wondering about technologies of the week
you can send us a photo use the hashtag
hack five to count and we will choose
our favorite one every single week and
you will win something really cool out
of the hack shop so this week is lord
helix and he said here's your hack five
hash tag along with my modded Gen 1 game
boy with a Battletoads cartridge a la
Cali dude and he also said toads
it has XY L&amp;amp;R buttons for what I'm
actually emulating the entire NGB and
SNES library hacked the Gibson dude that
is amazing
that's sweet I love me some emulators I
also love the little pop from from
fallout he's so cute
right yes need to get back to that
emulator box because uh-oh I have a
hankering I know
Mario Kart yeah and uh cool well lord
helix we are sending you this land
turtle that one right there
now this one's mine but I'll get another
shop that's gonna say I'm gonna bite it
if you want to get one yourself as well
as all the other cool tools that we have
and develop here like the Wi-Fi
pineapple in the USB rubber ducky you
can support the show directly by heading
over to our store at H a K shop calm
thank you guys so much
yes thank you so so much and you can
always email us podcast inquiries to
feedback at hak5 org we love seeing what
you guys would like to see on future
episodes and also don't forget we will
be at Derby con this weekend so
definitely hit up hack 5 org and you can
see all the different things that we are
planning to do coming up in the most few
months we have some good stuff coming up
in fact we have let's see Derby con is
this weekend yeah we have torque on in
San Diego and I'm going to be teaching
at that one so check out a home page of
hack 5 to find out how you can get in on
those that training I will also be
teaching with sub and Robin wood in
Vienna Austria in November so if you're
in the Austria area come out to deep
sack it's going to be so much fun
and then more conferences about so stay
tuned h EK 5 orgasm the home
page where you'll find all the Deeks to
those exciting times I think that's
about it
that is so I'm Shannon Morse i'm darren
kitchen too rustic take a look good
right what oh no no we still feel</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>