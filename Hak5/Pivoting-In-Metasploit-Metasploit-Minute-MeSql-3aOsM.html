<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Pivoting In Metasploit - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Pivoting In Metasploit - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Pivoting In Metasploit - Metasploit Minute</b></h2><h5 class="post__date">2014-04-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MeSql-3aOsM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">pivoting this time on Metasploit minute
this Metasploit minute is brought to you
by hack five and viewers like you
support us directly HHH all calm
welcome to Metasploit minute the
breakdown on breaking in I'm your host
Rob fuller but you can call me mix as
you may recall last time we set up
persistence on our virtual corporations
DMZ with some PHP meterpreter Thank You
Egypt today we'll be continuing on the
attack with pivoting around that Network
around the DMZ and looking for other
things so first off we're going to just
recap what we have we have a root cell
with Java meterpreter
and PHP interpreter with WWE data now
both of these will serve just fine to do
network based pivoting we're going to
just go in into our root shell go off to
a shell and before I do that I'm going
to show you that the shell command all
is actually running is running an
execute oops execute command and our
shell died the reason why our PHP shell
died and we can just get it back is
because it finally timed out execute - H
hidden doesn't really work on Linux so -
help then F or bin bash that didn't work
either
oh because we have to interact with it
so I to interact C to channelize now
we're in bin bash ID will root net stat
deck ano and let's do knits that - ano
pipe to listen to find out what these
things are
oops doesn't really help if you don't
grep it mints that - a no grep listen
all right it has way too many listening
things on it awesome so if you go
through the net stat you can actually
see
some of the connections that are going
on actually one of my favorite is LS of
I don't know if this version of Linux
has it yeah it does there you go
LS I will show you all the listening
ports and the connections that are
happening so we can see that we have
outbound connections to us and not
really much else and we what we could do
is use ping to ping around the network
if we wanted to but I think I like to do
stuff with from inside of Metasploit so
one of the things that we didn't show
you before is the UDP probe yeah so
exploit or I'm sorry auxilary I believe
it it's in scanners discovery then UDP
probe now there are two modules inside
here there's UDP sweep and UDP probe the
UDV probe is very similar to the UDP
sweep the sweep is much faster but will
not go through pivots the probe is
slower but we'll go through pivots so
we're going to set get into our probe
wow that's so bad show options and
didn't just not working there show
options now we can set up our hosts so
in our sessions we can see that the the
IP range that we're in is like 191 655
something and we can set the our host
there dot 55 at 0 / 24 and we could just
hit and send it going right now but that
wouldn't do us any good because we're
not sending it through anything
Metasploit doesn't automatically tell
you where to where or doesn't
automatically figure out where these
things go what we need to do is set a
route now route and dash H so is you the
same thing route allows you to route
specific IP ranges or IP addresses
specifically through an interpreter
session so I could if I wanted to send
all of 192 168 55 dot
whatever through the first mentor
procession and then another range the
second session so let's do one nine two
one six eight 55.0 255.255.255.0 and
send it through our route ad it helps if
you say ad route ad so now we have a
route we can do route print there's our
session it's going to go through session
one and we can say threads let's just do
twenty threads that way you can hit 20
hosts at one time through our Java
meterpreter
and look at that we see that one
fifty-five dot one which is probably the
firewall whoo that's beautiful so if you
run into this situation because the
Postgres this is usually because
Postgres has died on you because it's
trying to add too much data in we see if
we're still connected hosts and that
works and it's still going to die and
all right so why is that failing all
right so we're going to do the UDV probe
the cool thing about the UDP probe is
that it hits it and tells you a number
of different systems and a lot of
different OSS have UDP ports that are
open by default Windows has 135 Unix
usually has an NTP port or an NFS or a
number of different things so it helps
you identify and it's really really
quick to go through so we're going to
just show options that we got here route
print okay and we run we see that we got
NTP on one I to 168 55.1
instead all right so we were having some
issues with the UDP probe so what we're
going to do is switch gears on to just
setting the specific port or post that
we're going to target now normally you'd
want to do this for all the slash 24 but
for some reason it's just not working
right now we're going to go after the
192 168 fifty-five dot 101 show options
then we set our route show because we
flush that route print route ad so 191
six 855 dot 0 255 dot 255 dot to 5 0 and
then I think we're on five there we go
route print and we're good show options
we hit run alright so we can see that
137 is available its Corp XP it's on
sitting duck domain and we have a
Windows host that we can target awesome
but how do we get there well let's try
and you can find 9 billion different
videos online about how to use MSO 267
but let's try it let's exploit Windows
SMB ms o 8 o 67 set our our host to 10
or I'm sorry 1 I 2 I 160 8.55 that 101
and let's run check
check is a MOT is a is a special
function a lot like exploit and run but
or generate but all it does is is checks
the remote host to see if it's
vulnerable to the exploit you're trying
now the Java RMI module has a scanner
module instead of a check option there
are other exploit modules that don't
have a check option so try it out see if
you can just check and see if it's
vulnerable well our target is so we are
going to set up an exploitation now
right now if you see there's no there's
no there's no payload selection selected
so we're going to set our payload to
Windows interpreter rush TCP and since
our 1099 port that we used earlier is
not no longer working but the HTTP
request worked just fine we're actually
going to set a payload of reversed HTTP
and set the L port to 80 because we know
that works for these hosts set our L
host
- we can't tab complete here the reason
why we can't tab complete here is
because the reverse HP and HBS can also
select take host names so you can say my
evil server dot hak5 org and put it in
there that way if you switch IPS because
they block the IP you can simply change
the dns around and you can still get the
callbacks for it so let's set our l host
to our our IP address which is i don't
know let's do sessions and our IP
address is right there so copy and paste
that set our L host
there we go let's try exploiting fingers
crossed and see if Emma stole just seven
does what it's supposed to do
attempting to trigger should not take
this long probably needs a reboot yep
all right that first exploit didn't work
for some reason we're going to try again
just one more time
now this exploit does tend to crash a
service as most exploits do what they
are crashing services and then the
developer or whoever made the exploit
they exploit developer made it so that
that exploit will execute shell code
into instead of crashing all the way
sometimes it always does all the way
this is not working so if you're
following along we've had some issues
trying to exploit msr7
we actually had to upgrade to service
pack 3 to get this to work so we're
going to try type exploit again and
hopefully with our fingers crossed get
this to trigger and give us a show I
forgot that the target was set to
service pack 2 manually all right let's
try this one more time this time without
having the target set to service pack 2
specifically yeah awesome we actually
got our pivoted shell one thing to note
about this is that it's coming directly
out even though we have a route to push
the exploit and one thing to mention is
that interpreter itself is usually TLS
encrypted so there's no there's no
visual TCP capture or TCP dump that they
can see on this one and they exploit
going across the string as soon as it
hits the the Metasploit will host that's
when you have that detect ability so
across the firewall they wouldn't see
anything so we have our session it came
out it did reverse HTTP like we wanted
it to and we've officially now got a
shell on a Windows host as system yay
again this this connection although we
sent the exploit over and different
session is coming directly out at us now
there are ways and we'll definitely go
into this in other segments there are
ways of having to come back out the same
path but in this
since we chose not to do that because
they were just talking about another DMZ
host all right that's it
finally got our exploit to work and what
I want to stress about this whole thing
is exploits crash services or crashed
things so unless you are sure about what
that target is and how it works and
everything I wouldn't recommend sending
exploits across the water until you've
got all of the information at hand so
what did you think how much did I mess
up
MSF at hack 5 org and stay tuned -
meditite minute promoter shows like
these thank you again for supporting the
show and if you want to support us even
more go - hh-f com enter coupon code mu
bik's and get free Metasploit minute
stickers until next time i'm rubik's and
i'll be trying to hack till the cows
come home
in this video you're going to have me
going to do</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>