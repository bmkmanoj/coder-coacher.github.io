<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hak5 - Metasploit 101 with Mubix | Coder Coacher - Coaching Coders</title><meta content="Hak5 - Metasploit 101 with Mubix - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Hak5 - Metasploit 101 with Mubix</b></h2><h5 class="post__date">2009-10-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RxyD0F38WYg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this episode of hack 5 is brought to you
by goto assist Express Gamefly and
domain.com got a great idea it all
starts with a great domain hey guys and
welcome to this episode of tech 5 my
name is Shannon Morse and you guys have
been clamoring for some Metasploit so
we're bringing you just that whole
episode dedicated to it rubik's from
room 362 calm is down for some tips and
tricks about Metasploit that you may or
may not know stick around for that but
first a word from our sponsor go to
assist the best way to provide technical
support is to do it online would go to
assist express you can help friends
learn how to use new software or fix
family computer problems without being
there in person go to assist Express
lets you easily view and control a
computer online so you can quickly
resolve technical issues whether you're
in customer support technical consulting
or management or just a computer guru go
to assist Express will help you increase
revenue reduce travel support time and
service more clients try go to assist
Express free for 30 days for this
special offer you must visit go to
assist calm / hack 5 that's go to assist
calm /h a K 5 for a free trial
so today we're going to show you basic
101 on Metasploit it's not that scary
exploitation tool that everybody thinks
we're gonna show you how to like dig in
deep with it and kind of understand the
total value of it as more than just an
exploitation framework and when I say
framework I that that really defines
Metasploit Metasploit started in 2002
and it has grown into the biggest ruby
project in the world and it has so many
libraries and makes so many other things
than just exploitation easy because the
libraries in the API called wrecks that
it's it personifies the word framework
it has so many things so we're gonna
show you some of the advanced features
the little hocus-pocus stuff that I've
shown before and then we're gonna get
into some of the cool stuff that it can
also do that isn't exploitation so we're
going to start off with the exploit
module section and let me set that up a
little bit before in but first a real
quick public service announcement please
use the SVN copy you can find out how to
do that at the bottom of the download
page it helps the Metasploit devs and
all the people on the mailing lists to
answer questions because you're using
the most updated version which probably
has fixes for some of the stuff that you
might be asking anyways so just real
quick of that and we're going to go over
here and show you what we're going to be
what we're going to be doing so we have
the hacker box out here and we have
perimeter and defense in depths we have
a web server out here web SQL Server
here a domain and a workstation you guys
all see that cool all right so we're
going to show you real quick how to get
into that set of systems and start
moving around with the exploit exploit
modules and to make the demo go a little
bit easier we're not
actually use a real exploit because
sometimes they fail you just have to
kind of get the right setup so demo fail
gods can't get us when we're using
standard username and password so let's
start off with getting into Metasploit
pen test exploits framework three MSF
console takes a second to load the
reason why it takes a second to load is
they've have both ruby 1.9 1 and ruby
1.8 compatibility 1.9 1 if you get it
working is so much faster and they're
really trying to get people to move over
to that so that they can get it so that
you can run Metasploit 10 times faster
than it is loads right now because it
look it literally loads all the modules
up at once
so we it's loaded and we are going to
get into use because that's how you load
a module windows SMB PS exe now PS the
PS exec module is exactly like
sysinternals except for it has one cool
little feature that we'll talk about
later but what it does is runs a runs a
binary or payload as we're going to show
you on the target box so we show the
options that it has available and
there's also show advanced where you
have some of these advanced options
including proxies so you can actually
send this through tor if you want to
show options so we set our our host and
I'll probably be delighted Dyslexic
again and get this wrong
we set our payload now let me show you
before I get into the setting of
payloads show payloads that this thing
has show payloads this thing has a ton
the Metasploit project has a ton of
payloads and they're really well set up
so that you can kind of if you know the
format you can understand exactly what
it does so the first part of the payload
name is the OS or operating system that
it's that it is run on or available for
the second part is kind of what it does
there's shells upload execute VNC inject
meterpreter interpreter is the fun one
that's the real good one but it's a ton
and you can look through it now if that
portion of it is followed by an
underscore you know that it's an inline
payload and what an inline panel is is
means that the whole payload is sent
over the wire all at the same time now
this can be good for stability reasons
but what is most widely used is the
stager one stager
is used when there's a slash right after
the second portion of the payload that's
how you know it's a stager or in the
description and a stager payload is
smaller it goes over the wire quicker
but comes back and gets the rest of it
and pulls it in now this is good because
some exploits have a very small buffer
area a spare small amount of room for an
exploit to happen and sometimes cannot
take the whole inline injection because
the the VNC inject one particularly is I
think around seven Meg's when it goes
over the wire so staging that is the
best way to do go so we're gonna select
windows from interpreter reverse way and
see that means it's a reverse tcp that
means it's coming back to us from that
box to the system that we're running now
the cool thing the other cool thing
about Metasploit is that it tells you
what variables are required you have to
actually use set and the variable name
or it doesn't work
so as you can see now we have more
options set L host that's our local host
ten ten zero again I think I've been
just lexicon this and four PS executives
a SM B user and password and we're doing
this again for demo purposes when using
an actual exploit you won't need these
you'll just use the exploit code and
you'll it'll loads exactly the same way
this is PS exact is an exploit module so
you're doing everything exactly the same
as you would a real exploit which has
four hundred odd experts in Metasploit
so SMB pass we already know we're just
using the password so we can get this
demo done again you need to use set s
and rerun exploit but before we do as in
a lot of things in in the Metasploit
framework you can do a tech h and find
all the cool help most people don't know
about the help inside of exploit there's
a lot of cool features you can actually
get to a point where you can script this
using something called a resource file
that we can talk about on another time
and script the whole thing and get it in
one line you can get all the options the
payload and in the background all in one
line with with exploit we're gonna run
exploit tech jtech z now Tech Z will
make sure that when the payload comes
back the session isn't immediately
attacked this is this is good when
you're doing multiple exploits or
multiple systems you don't want it to
automatically attach to the session so
that you have to background it you can
just exploit have it automatically
background with teca's 8-z and run the
exploit again on a different box if you
wanted to attack J puts it in a job
background in it so the Z is actually so
it doesn't interact them so
all right so exploit tech G and our
meterpreter session is open so there are
a ton of commands in here everything
from upload to execute to to reboot to
do registry changes interpreter can do
amazing things with a little bit like
with least amount of knowledge whereas
with if you just add a command shell you
would have to know a lot of commands to
get a lot of the stuff that we do here
done so what we're doing is pretending
like we just exploited the web server
out on the perimeter we have an
interpreter session going we got some
kind of web exploit or some kind of an
SQL injection to get this going and we
have interpreter so if this if this is
actually attached to a domain so we got
our domain server over here our SQL
server here and this is actually
attached to a domain which happens all
the time
then we're going to show you how we can
take that and pivot into the internal as
part of the network so one of the one of
the modules that is automatically loaded
when you have a when you have a
meterpreter script that is running as
administrator or system like we are
right now is Prive now there's a bunch
of other other modules that are out
there including incognito which we'll go
into next
but privelage you to do hash dump and
hash dump allows you to do basically a
pw dump without having the tool that
gets caught by a ton of Av products so
hash dump is on our privies
automatically loaded so you don't have
to use or do anything to your my server
show and you just do hash dump and there
it is there's all the hashes that are on
the system
and hopefully people don't use different
passwords on different systems because
hashes in windows world are exactly the
same on every other box so if Bob uses
password password on the web server and
he uses his password password on the
domain controller the hash is gonna be
exactly the same so instead of cracking
passwords we're gonna use something
called passed the hash now remember that
cool thing I said that PS exact does in
the module for when Metasploit does that
the PS exec from system journalist
doesn't that's passing the hash now
Hernan Otero Hernan otua from course
security actually created this method
and what it does is instead of well you
know what let me white board it and show
you exactly what's going on when you're
doing pass the hash so when this Windows
workstation wants to talk to this domain
controller and login it will take the
password that the users has hash it
we're using until them and then send
enough to send an authentication request
to the domain controller the remaining
controller then goes let me look at the
hash that I have on file and compare it
if it's good then you are syndicated so
at no time does the clear text password
go across the wire security right well
that's good for us because we can take
that hash without the precomputing part
because we don't have to have it and do
the exact same thing that the
workstation did so that's the basics
behind pass the hash so what we're gonna
do with with this is we're going to
background that meterpreter session
using control Z we're gonna copy the
administrator password
or administrator hash I'm sorry show
options we're gonna pretend that we have
a another system and we've changed the
our host we're going to change it from
the from the Windows or the web server
to the domain controller hopefully the
administrator password is the same on
both so we're going to set SMB and paste
in our hash now done show options now
you can see in the options that instead
of a password we now have a hash as the
SMB now if we're running in an actual
domain in the show Advanced portion you
can see that SMB domain is another
variable that needs to be set but we're
not for this demo so we'll just run run
the exploit with the hash now we have
our meterpreter session open on our
domain controller easy as that we've
just now used a hash instead of a
password that we obtained from a
different system on another system
virtually in our minds right to access
another system without using a password
without cracking that actual password
pretty cool huh well so that really
eliminates the use the need to crack
passwords right well what if it's
attached to domain but all you get is
the local local accounts can't really
use that well not true tokens are
another method that are you another
authentication method on Windows that
are used kind of like cookies now if you
think about when web cookies they store
your authentication so that you when you
go to a different portion of the site
you don't have to authenticate it every
single time imagine if you had to tweet
or if you had to log in every every time
you tweet it suck especially for people
with like thousands thousands of updates
so that's where tokens come in let me
show you oh I'm bored again if domain
admin a or Bob decides to log into the
workstation to help out the user or
whatever problem his token instead of
his username password or his uh his
username password are sent so he
authenticated to the domain but once
he's on and starts doing things his
token is actually stored on that machine
now there's a bunch of tokens that are
loaded by default and used for services
and things like that and if you're a
system level on the domain on the on the
computer or workstation or server that
you're on you can see all of those
tokens administrators can only and users
can only see the ones that they have
access to but system has access to all
of them
so tokens have a limited lifespan though
hashes don't so that you know there's
pluses and minus devotes tokens you can
use for domains and possibly pivot that
way hashes have more lifespan tokens
stay until a system is actually rebooted
so we're going to show you how in
meterpreter we can we can use those
tokens to add a user and and essentially
execute commands on a different system
using using the tokens available so in
meterpreter you actually have to load
this module called called incognito by
saying use incognito and this loads that
DLL into the meterpreter session still
not hitting disk at all now you have
some extra commands available to you in
the incognito commands category
ad group user ad local group user add
user impersonate token list tokens and
snarf hashes lists tokens is the one you
want to start off with all right so we
ran list tokens and we actually have to
do attack you to list all the user names
the user tokens at least and let me let
me go to the right board and show you
let's let's alter our little reality
real quick so say through the web server
we got to the SQL server because a lot
of corporations and people are not that
bright and do the web and the SQL server
inside the perimeter so because the web
server has to talk to the SQL server so
say we have our second meterpreter shell
here on the SQL server now there's a
possibility that someone with privileges
is going to be on the the SQL server or
the tokens at least or someone's going
to be logged in because that's a high
maintenance type of server so we're
gonna use the tokens that we see here
and we're going to pretend that one of
the domain tokens showed up just as if
right here where it says new PC
administrator we're gonna pretend that
that says domain Bob with domain madman
Bob whatever and easy we just use add
user and it shows you some help if you
just hit enter right here we do attack H
if we're going to add a user to the
domain controller and you can see that
or you can you can like type in the IP
address or the host name and add a user
to the domain using this token but for
our example right now we're going to
pretend that we're doing that and we're
just going to add a user locally to the
box the VM that we're
so we're gonna run Bob admin password
same that we've been using and there it
is we've now added a username and
password that we can use the PS exec
module without any hashes to be done so
we can if we had done this on a domain
controller we can now use the PS exec
module and throw it at our domain
controller and now have meterpreter on
our domain controller so we've
officially pivoted from web server to
SQL Server to domain controller and once
you're on the domain
game over so next we're going to go into
some of the auxilary modules oh shoot
real quick the other cool thing that
meterpreter does that I'd like to really
point out is they in the not-so-distant
past they they added a key logger
now the key logger is kind of cool
because what you do is attach it to a
specific process and that's cool in the
fact that you don't get all the other
depending on what process you attach to
if you attach it to win log on you just
get logins and log outs so guess what
that gets you usernames and passwords
and that's it so you have have it
attached to win log on
when log online ever stops because it's
always running
you just get using instant password so
you type dump a key key key dump passer
and dumps what it's been said so use
names and passwords is all you get which
is nice so no gunk to go through so next
up we got the auxiliary modules
are you doing it's a freeze pop diet
that's ridiculous no it's a real thing I
did a bunch of research so it turns out
you can lose a lot of weight on this you
can eat anything you want as long as
it's a freeze pop you're guaranteed to
lose weight so I kind of figured out how
to edit Wikipedia it's a stupidest thing
I've ever heard actually it's the best
idea ever and I'm gonna share with the
world my registering freeze pop diet
calm no I'm gonna risk some free stuff
that come first and put a picture of a
coke cuz you're more on too late I just
got it how I use domain.com it's domain
registration with all all the BS brief
pool with coms for less than ten bucks
without pushy upselling reseller
dedicated servers with cPanel and killer
VPS hosting with root access
domain.com is the place to go next time
you're looking to start a website or
build your new massively multi skilled
side business best of all they're
offering hak5 fans sweet deals on domain
names private registration and web
hosting just go to domain.com and use
coupon code hak5 that's hak5 at checkout
to get 15% off your order got a great
idea
it all starts with a great domain
domain.com so we've covered kind of what
Metasploit is we've covered you know the
hocus pocus part where you can do some
cool stuff like pass the hash and tokens
stealing and kind of pivoting through
the network to get weight where you want
but now I want to show you some of the
some of those features that I really
like about Metasploit but first I want
to show you some of the other cool
things that meterpreter can do in inside
of the scripts directory under
meterpreter there are a host of just a
ton of meterpreter scripts that you when
you're in your interpreter shell you
tell you attack or a run space the name
of the script - the dot RB and it will
do like there's
just go look at them you got things from
get GUI which is a cool tool that will
enable remote desktop add a user for you
so that into the remote desktop users
and basically you can then RDP into the
system to a cool thing called get
countermeasures where it will stop the
firewall kill the AV kill Windows
Defender and basically make it so that
you can load anything any tool that you
wanted to on there after that so that
you don't have to worry about your key
logger if you're not using the one built
in the Metasploit in the meterpreter
getting caught by AV so let's get back
into the auxilary modules so inside of
you know just Metasploit or MSF console
you hit show auxilary if I can spell
right and like I said earlier it's a
hundred ninety something different
auxiliary modules that they have in
there right now
everything from voice over IP telephony
brute force or scanning like was what is
things then used war dialing - just SQL
mix-ins where you can connect to an SQL
Server and issue SQL commands - cool
thing called W map it's a set of modules
scanners SQL injection servers this and
if you've ever heard of car Metasploit
car Metasploit actually uses the servers
inside of Metasploit in a RC or resource
file to script out the starting of all
these servers so that you can grab
credentials out of the air but I really
employer to go into and look at the
modules and see just how many there are
and how they could be used but for just
the time that we have I'm going to go
into the HTTP options one which is
pretty cool
it shows you what options are
sometimes you get lucky and you got
WebDAV or put but I'm gonna I selected
this one because later on we'll show you
how to get into and develop your own
auxilary modules or exploit modules if
you're so inclined so in here we do use
just like an exploit module scanner HTTP
options so show options just like we
would again and now you have all the
available options for that scanner the
difference here if you've noticed is
that you have an hour host option
instead of an hour host our host has the
ability if you take in just like you
would with a our host option you have
either a DNS name or an IP but with the
our host option you have to added the
ability to do cider notation and a
little known fact that you can do file
file is a line separated list of hosts
that you want to load into your scanner
so say you do a nmap scan and you grep
out just the hosts that have port 80
open and you have a you have a list of
hosts that have that in just so you can
run this module you can do a file colon
first let me show you set our hosts file
colon temp HTTP servers dot txt now if I
hit enter right there it would then load
into the our host variable and when I
hit run instead of exploit because it's
long Hilary module it would load that
file and iterate through each line and
run the scanner against it but for this
demo we are going to use Darrin
kitchenette again you can use proxies so
tor is your friend run it's real fast
because we're just running on one single
one single host and we got get head post
option methods available to us and that
it seems simple and it doesn't seem very
powerful at all but it's the little
things that really gets you far in a pen
test and if the little pivots and little
footholds that really make a difference
and the more information you have the
better so we're gonna get we're going to
back out of this and out of the MSF
console and we're going to show how easy
the framework makes it to make something
like this so if you go into the
directory for the framework and you go
into modules you can see that it's set
up exactly like it is inside the
framework you go into auxilary into
scanner into HTTP and there's only eight
there's all the modules that are exactly
the same as if they were in the menu
system so you can I so when you make a
new module you put it in the same
directory structure and it'll get loaded
just the exact same you know so it'll
show up in scanner http-based fee
options or whatever you name your string
so let's go back in here and nano I know
Vai whatever options and we're gonna
look at the options module so the first
part you got the basics to load a very
basic module you say include MSF
auxilary scanner included MSF support
all this stuff that you can kind of copy
and paste into all the modules you make
and the initialize is just there now
that is it you see that let me do it
again
that's all the lines of code needed to
send a get send an options request parse
it
and put it to the screen so the socket
opening the requests getting the
response back parsing it and that's it
even parsing the the file for the our
hosts the cider notation all that is
handled by the framework that's the
powerful thing and most of this most of
the stuff in there is just the
incorporation of it into the W map
Parshin of the database section that we
haven't actually covered so I mean it
gets down to maybe ten lines of code if
you just look at the only things that
are actual code that you have to think
about and write so that I don't know how
to say it any better that is the power
of the Metasploit framework that right
there I mean all right so I challenge
you to check out the SPN I get the most
updated copy and make a module for
yourself most likely there's something
similar to what you want to do or
something that you kind of know
something about and can make it like I
said ten lines of code to make this
module plus the initialization stuff so
you can find out more at Metasploit comm
download cygwin version if you want to
run it on Windows check out how to check
it out from via SVN you can also see how
to get involved via the Metasploit
mailing list the IRC and some of the
other community ventures that Metasploit
has you can also of course get it on
backtrack like i'm running in it now and
the guys over at backtrack actually have
a course called Metasploit unleashed at
offensive - security comm slash
Metasploit - unleashed it's a great
course and it's completely free so you
can go through and step through all of
this by yourself at your own pace and me
you can find at room 362 comm and
Twitter / twitter.com slash move X and
as always hack 5 doors will have
the show notes and links and feedback at
hak5 org if you have any questions for
me I want to let everybody know that
Gamefly is an amazing service they are
the largest online video game rental
service and offer a choice of over 6000
new and classic titles across all
consoles and handhelds with plans
starting at fifteen ninety-five a month
Gamefly members can rent one to four
games at a time and keep them for as
long as they like you can also purchase
a game if you fall in love with it
they'll send you the box and the manual
for a nominal fee head on over to
gamefly.com slash hak5 to get two week
free trial membership gamefly.com slash
I would like to thank mu Bix for coming
out to the episode this week you can
find all of his information at room 362
dot-com and if you have any questions
concerns or comments for us be sure to
email us at feedback at hack 5 org this
week on revision3 and he is reviewing a
rock band iPhone application on App
judgment be sure to check that out at
revision3.com slash app judge app
judgment excuse me on Mondays Wednesdays
and Fridays coming up next week we're
going to have everything from the VPN
cracking to Linux device hacking and all
sorts of other nifty tips and tricks for
you but first I'm just going to remind
you to trust your Titan to lust and see
you next week
welcome to module three of white 41
doing today we're going over this and
that and that and maybe you know some
others</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>