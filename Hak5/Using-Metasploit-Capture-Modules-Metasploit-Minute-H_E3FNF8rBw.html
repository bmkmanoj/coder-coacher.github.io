<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Using Metasploit Capture Modules - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Using Metasploit Capture Modules - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Using Metasploit Capture Modules - Metasploit Minute</b></h2><h5 class="post__date">2015-01-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/H_E3FNF8rBw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">using Metasploit capture modules this
time on Metasploit minute Metasploit
minute is brought to you by viewers like
you if you get value from this show and
you can spare even a dollar or change
please consider contributing at
Metasploit minute calm welcome to
Metasploit minute the breakdown on
breaking in
I'm your host Rob puller but you can
call me Moo vics this time we're going
to be going over Metasploit capture
modules now this is a subset of modules
that are particularly interesting
because what you do with these capture
modules is you capture incoming things
of all different types and the one in
particular that we're going to be going
over is the HTTP basic capture module so
this what this module does is it
receives HTTP request and then says hey
you need to authenticate I'm using basic
auth and then the web browser or
whatever you have you then authenticates
so we're going to set up this module
real quick
use aux server capture and this is where
all the capture modules are so if you
hit tab you'll see all the ones that are
in there so the one we're going to be
using is HTTP basic show options and you
can see that you can set the realm the
server host the surf port SSL SLE cert
you can even make it have a valid
certificate the URI path and that's
pretty much it the awesome thing about
these capture modules is if they capture
credentials they actually put them in
the database all right so what we're
going to be doing is we're going to set
up this list capture module to say serve
host is already good serve port is 4 4 3
because we want this over SSL make these
this basic off a little bit better a
little more secure set SSL to true set
our URI path this is where someone will
go to authenticate so if we don't put a
URI path in there if we don't set
anything it's gonna be random and while
that's great
for some instances what we want to do is
make it make it specific so it's very
it's really easy to type so if you want
to do random it'll only require
authentication on that random your
Rell all other URLs it won't so if you
want to be a little stealthy you can
make it random unless you're having
someone actually type it in so in this
case we're just going to make it easy
that's gonna be in slash so we're gonna
show our options again just to make sure
that we have everything correct and
realm secure site is just fine we have
as a cell going and we type run that's
it we have our capture module set up so
what we're going to do next is we're
going to swap over to the no instead
we're gonna just show this on on our
local box so we open up our web browser
just to make sure we have everything
going HTTP 172.16.0.0
that was poor day this is so add
exception yes we're good now it's
requiring secure site authentication so
we're gonna type Bob test try this out
and you can see that it tried a couple
times with Bob test great now we have
everything set up so how do we make this
actually useful like how do we use it in
the field so what we're gonna do is
we're gonna use a little bit of
powershell kung fu ER e that I found in
the Red Team Field Manual I think Carlos
Perez actually originally made this this
post about how to do things he has a
bunch of other great PowerShell things
that you can check out on his website
so I've already typed this out and I'm
gonna make this a little bit larger just
so you guys can see it easier so we have
the first thing is we and this is all
PowerShell this is not Metasploit so we
we have a credible that says get
credentials says failed authentication
it says don't look at the server
certificate so with PowerShell it
automatically verifies the server
certificate and won't let you go to
things automatically without a valid
cert and since we're using a generated
cert using Metasploit this is not going
to be valid we make a new object called
web client we tell it use all the proxy
settings and credentials that
the proxy for this setup has and then we
use those credentials we literally use
the credentials that are going to be in
this pop up against ourselves so let's
see how this works first what we have to
do for anything to happen is we have to
convert it into something that we can
use on on a Windows desktop now you
could put this over as a file on the
Windows desktop and then change the the
permissions for PowerShell so it doesn't
require a signing of PowerShell but
that's a lot of work this we could do a
little bit easier we can cat our bad all
right I think it's pop-up or did I save
that as evil pop-up so we could add our
evil pop-up and we and we can convert
using I convey this changes it from a I
forget the encoding that it is by
default but changes for from the default
encoding over to UTF sick - 16 l e and
you can see it still looks the exact
same
nothing's changed other than the
encoding and then we're gonna base64 it
and this specific encoding is what
PowerShell requires when when it's using
an encoded command and I'll show you how
that works in a second so we tell it to
base64 we copy all of this over to our
windows box and you can see that this
this is the get credential method for
PowerShell so we're just going to type
in PowerShell just directly to our
command prompt paste this in long
command hit enter now if we were doing
this in the background we could we could
hide that wallpaper or that that that
command prompt and you can see that it
says fail authentication just like we
had enter your credentials okay the and
it automatically populates the username
so of whatever user we're executing is
and it's Bob so let's let's say my
password is this is a really long
password you could never guess enter
so there's a there's a one little error
that it cuts doesn't come back as
anything and that's because it's
actually authenticating but not getting
anything back again you wouldn't see
that if you were doing this in the
background we go over to our basic auth
capture module and there we go we see
that the domain that this computer's log
is logged into is win 7 x64 dev and
that's actually the computer name so if
it's not attached to a domain it
actually uses the computer name
automatically the user name and this is
the really long password you'd never
guess and this great thing about this is
we go into our creds database oh it
didn't store it it should well that's a
bug request there were bug finding we're
gonna have to submit but normally this
request would directly go into the
credential database and we could see it
in here that's it so what are you tell
me what you think email MSF at hack 5
org and stay tuned in Metasploit minute
com for more shows like these and a huge
thanks to everyone who supported the
show directly you can find ways to
donate or get awesome Metasploit swag
merchandise all kinds of things at
Metasploit minute com
every dollar goes towards making this
show just for you and for that I'm
deeply grateful so until next time mom
muack sand I'll be hacking til the cows
come home
as well yeah I went into HTTP capture
modules I didn't say capture modules hey
there
yeah you thanks for watching all the way
and I really appreciate all the awesome
feedback and support we've received from
viewers exactly like you not as cool but
you get the gist if we haven't already
checked it out you could really help if
you go over to our patreon and support
the show directly if you can't that's
cool simple like or subscribe goes a
long way too
either way thanks for watching and we'll
talk later man take it easy</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>