<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Hide Ducky Attacks, Hak5 1502.2 | Coder Coacher - Coaching Coders</title><meta content="How to Hide Ducky Attacks, Hak5 1502.2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Hide Ducky Attacks, Hak5 1502.2</b></h2><h5 class="post__date">2013-08-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6Ay9tpvnuJM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the segment is brought to you by
CrashPlan sign once again to play the
game what's up with duck and we're
talking once again
exfiltration with these guys I love
these guys the little Quackers of course
you guys know I'm talking about the USB
rubber ducky these guys look like
innocuous little thumb drive but no they
are actually a simple programmable USB
tool for all sorts of fun keystroke
injection attacks for use in penetration
tests and other fun social engineering
last week we talked about
exfiltration which is a fun nefarious
word for things like well I like to call
involuntary back up but some people call
it data theft last week we talked about
a way to do this without ever using you
know your an ocular your regular mass
storage thumb drives or even using the
network or the internet which is kind of
really beautiful sets off very few
alarms however today we're going to look
at another method you see last week we
used our target Windows machine was for
instance a laptop with a wireless card
in it and we were able to take that
wireless card and turn it into a
wireless access point that we could then
connect to from afar not really afar but
you know within you know parameters of
Wi-Fi afar and pull down data which was
awesome right we're going to do it again
today using two pieces of gear of course
we've got the USB rubber ducky whether
it's in a case or just the naked board
and you're just standard thumb drive I
happen to be using you know fun little
hack five and graved one here but
otherwise you know any drive will work
and this should be a really fun even if
you don't have a USB rubber ducky as far
as you know techniques for getting some
data off of your target PC so if our
target in this case does not have Wi-Fi
yes we could use the internet to you
know backup data from this machine
however I find that to be the least
desirable technique as it might set off
alarms if there's you know intrusion
detection filters or other sorts of
things on the network that might
actually see this and report it so to
set this all up I want to first give mad
props over to over wrath over ass right
here on the USB rubber ducky forums as
an awesome USB slurp ducky slurp payload
and so if you're familiar with the
concept of pod slurping you know this
was back in the day where you would take
an iPod and you know especially craft it
with a payload so that it would aught of
a since the iPod has nothing more than a
giant hard drive I would download all
the data to it and we did something
similar with the Switchblade and things
of that nature I would like to revisit
this payload and make it a little bit
more stealthy and do some debugging so
that it works a little bit more reliably
so that's what I've done I've added some
you know cloaking techniques also mad
props to goes to Google knows best what
an awesome handle for adding some fun
stuff to this and so without further ado
let's just go ahead and dive in because
now it's all about the windows batch foo
which is almost as fun as bash shell foo
actually it's it's kind of more fun in a
way because you have to be you have to
let get your head into like a insane
sideways mode like if you're used to
like bash or TCL that's the proper like
yes okay I can do this and then to think
in DOS mode you kind of have to just do
this so I'm just going to do this for
the rest of segments and so I'm going to
pull up a command prompt here of course
is my favorite way to pull up a command
prompt is with this PowerShell goodness
because this pops up the UAC dialog
which we can simply bypass by holding
down the Alt key on our keyboard and why
and so now we are an administrator on
our command prompt we're going to go CD
backslash and I've already what is it
wait dot bat I've already created this
right cat no there's no cat
there's type
I hate switching back and forth between
Windows and Linux it's just sometimes it
messes up my brain that's weird to see
here let's see it this way
all right so this is the batch file be a
little bit easier to show it off this
way and what this is going to do is
start a very simple loop in fact we're
going to use something really god-awful
here called goto to do our loop but
we're going to call this loop while one
this is just naming our loop and this is
the secret sauce right here this is
really cool what it does is we are
taking a look at this command which is
echo list volume that we pipe into disk
part and then we pipe that to find
string and we finding a string ducky so
let me show you what this does first so
we echo Bo's it again list volume and
pipe that into disk part we do that this
is just going to show us all of the
volumes on our computer which is great
we can actually see hey look at all
those healthy hard drives I have
wonderful and if we do that again and
pipe that to find STR for fine string
ducky we're not going to get anything
back because I don't have anything on my
machine named ducky however we will soon
and that's why we're doing this little
loop here so we're going to say hey take
a look if there's any drives named ducky
we're going to tell it to do some stuff
if that's not the case we're going to
loop around again and so to do that you
know if we've said token 3d limbs this
is basically kind of like said an dock
on on Linux where we're going to take
you know the delimiter is a space and
we're going to take the third token
which in this case is the drive letter C
C F D the reason for all of this is
because after we've injected our machine
with this little payload which sits here
in weights it's waiting for a regular
mass storage thumb drive named ducky to
be plugged into the computer and the
beautiful reason for this is we could
take you know this is just a four gig
thumb drive but we could take something
massive a 64 gig we could use a USB 3.0
drive if we know our target has that
capabilities and really pull down data
off of it very quickly so I like the
versatility of this in that case and the
thing about it is to make this work
beautifully for any machine we want to
be able to know what the letter of the
thumb dur the yes the drive letter of
the thumb draw
this see if this was Linux we would just
you know find it with /dev or take a
look with DF Tek it H or several other
different methods you know they don't
have the try of letters but Windows is
crazy and has Drive letters and it's
based on das and all that other fun
legacy stuff so that's what we're having
fun with here so in order to actually
find out what the drive letter is that's
what this loop does and and there you go
Bob's your uncle so what we do is a
little condition here we say if you know
and we're setting all of this we're
saying in this loop you know do run this
command and set the third variable you
know if it if it's found it to be ducky
to to this variable which we've set as
ducky drive now in this case you can see
I've run it and I just get a blank write
this blank right here means there's
nothing so this is an empty variable so
I'm saying if this variable now equals
nothing well then we're done and in this
case I've actually done a little echo
says waiting on the drive right so we're
going to just wait I'm doing a timeout
/t 3 as you can see does exactly what
you would expect it waits three seconds
and then moves on and then we do go to
wild one so this is it this part of the
loop is when nothing's plugged in but
else else we actually have a drive named
ducky on our system and I guess this
whole thing assumes that your target PC
doesn't actually have a hard drive named
ducky or else that would really throw
this for a loop but who has that we're
going to go to break break gets us out
of the loop and this is where we start
the fun stuff and actually this is how
we literally start the fun stuff and
I'll show you more on making that crafty
and invisible later but just as an
example let's go ahead and take a look
at what we're going to find on the
special rafted thumb drive so I'm not
running this and just going to plug in
my thumb drive here and go to a computer
and you can see it's named ducky f2
rename it to whatever in this case I
want it to be ducky right all right so
my drive is labeled ducky
going to come in here and first things
first create a folder on the root called
duck slurp you don't have to do this
this payload setup in such a way that
everything is all nice and neat so if
you're using this drive for other stuff
it's not going to kind of you know tidy
up your filesystem right so we go into
here and we can see I have a demo bat
which I'm going to show you in a sec and
then this duck slurp bat okay it's going
to create a new folder for all of the
machines that we're going to target with
this attack which is really nice because
then you know at the end of the day we
can run fun reports and actually have
like names of computers and again
tidying up your file system but let's go
ahead and take a look at the demo batch
file which is similar to the duck slurp
batch okay so this demo batch by edit
this notepad we'll see we do simple echo
off and then mad props to Mike W for
sending this by in the YouTube comments
of last episode pointed out there's a
really fun way again this is obfuscation
and it's actually not necessary we'll
see in a second but still really cool we
echo installing Windows Update or
something else innocuous you know as we
showed off last week you could also do
color F E or whatever the hex code was
to make the terminal yellow on white or
you know you could do mode con colon
calls equals 14 and rows equals 1 and
all of that to make it very small but
for the time being we're just going to
print on the screen installing Windows
Update we're going to set the
destination this is the destination
where we're going to copy our files to
to this to this very special magical
variable which is % tilde d0 okay so the
% is in all special variables start with
the % in the DOS world and tilde D is
specifies the actual drive that our
batch file is living on and in this case
well I don't II it turns out it's Drive
letter e or is it's going to be
different from system to system and then
0 in this case is the actual file itself
so in this case what we're doing is
we're setting the destination to this
Drive backslash ducky slurp backslash
again computer name is a special
variable of
come back over to our command prompt and
echo and paste that computer name we can
see there's the name of the computer
just as a via KHOU user profile we can
see it just gives you back the the
directory for my home and all of these
other fun things let's continue on here
so after we've set that destination we
make the directory on the USB Drive then
we do an if exists user profile as it
just demonstrated backslash documents
which I know it does over here so if I
go to CD user profile and CD to
documents and then start dot which is a
fun way to just open Explorer in that
directory you can see there we go I've
got all of these files here that I may
want to keep you know on my PC but it
may also you know want to be a helpful
guy that wants to help back these up to
my thumb drive so in that case in the
batch file here we just specify this is
our target and so if this exists what
we're going to use is X copy and we
haven't even done all that there's a
bunch of other options we can do an X
copy but just to make it simple we're
going to do basic X copy of that
Documents folder to that destination
variable which we set as being I guess
in this case would be e colon backslash
ducky slurp back slash the name of my
computer and then here's the bit where
you know mad props to Mike check this
out so we pipe this null and in Windows
that just basically means it's not going
to display it on the screen so when you
run this batch file the only thing
they're going to see on the screen is
updating windows or installing windows
updates wonderful thanks for that tip
that was pretty awesome
so let's go ahead and put all of this
together save come back here and run my
CLS and run my wait file ok so I'm going
to unplug my USB Drive this is no longer
on my system I'm going to go ahead and
run this wait and as you'll see
it's waiting for the ducky drive it's
going to wait three seconds goes through
loop again still doesn't see the ducky
drive so let's go ahead and plug the
ducky drive in with this now in the
system
you see it's mounted and there we go
installing Windows Update now what this
actually did was that xcopy and I've put
all of these you know pauses in here and
other things so you can actually see
what's actually going on because in a
minute we're going to make this really
discreet we can even see ducky Drive
found you know this year where we
execute the payload and so let's come in
and check out our payload because under
ducky slurp there's in the name of my
computer DK is d3 I go into there hey
check it out
secret plans for world domination all of
my files they've been stolen or I'm
sorry they've been backed up which is
fantastic is now I can easily back up my
computer whenever I like but just
plugging in a duck in a USB Drive so now
let's make it stealthier so that when I
go to backup my computer all the time I
don't have to see a whole bunch of stuff
pop up because that'd be really
inconvenient alright so in that case
let's take a look at the actual ducky
script because I've updated this just a
bit so we do the you know basic stuff
like bypass UAC open a command prompt
and then we change over to the temp
directory which again here are these
magic variables % temp right then we go
over and I love this actually delete or
actually not delete but erase you know
ducky wait that just in case I've
already done this to my system which is
kind of nice you know it's always good
to clean up after yourself as well after
that we do a copy con which is my
favorite task man we talked about last
week about injecting you know text right
into a file through the command prompt
and we do that that file I just showed
you the difference in this case is the
very end here rather than you know
running demo dot bat we're actually
going to execute W script for Windows
scripts in Visby be s a visual basic
file and then that ducky slurp top that
alright so as we can see we've got that
ducky slurp dot bat here
as long as I'm in explore I'm going to
delete this so we can do a demo again
and see that it got it and we'll take a
look at that here in a second but let me
just keep that open but we'll run that
ducky slurp batch file in troll Z you
know and then we erase invisibie BS
before we create it this is a really
beautiful file invisibie BS this is all
you need to it not going to walk you
through it basically you run this and
with the parameter of what batch file
you'd like and that batch file becomes
invisible just fantastic and then at the
very end we just go ahead and W script
invisibie bs ducky wait so no more will
we see like we did right here you know
waiting for ducky Drive waiting for
ducky Drive that's the kind of stuff we
don't want to see so then we basically
exit out so let's go ahead and actually
inject this on our system and we'll see
that when it's all said and done it runs
this with the invisible or the
difference here is you know it will
still say installing Windows Update
right I don't have a pause anymore like
I had before but I've taken that out and
even though it's it's actually set to
echo installing Windows Update we will
never see that because of that visual
basic script that we used so once again
to take a look at my ducky drive we can
see a duck slurp folder I do not have a
computer folder here so I'm going to
unplug my USB Drive and so alright here
we go so I come up to the target machine
I only need a few seconds you know Paul
walked away from his computer for a few
minutes
oh well Bob's your uncle I'm just going
to plug my ducky in
and first things first bypass UAC with a
little command prompt goodness go over
to the temp folder injector batch file
and start it that was it
we're done I don't know how many seconds
that was but it wasn't long and we can
unplug our duct now because it is done
it's dirty work and now we just take any
USB Drive that we've named ducky and put
a folder called duck slurp with that
batch file into the computer and you'll
see here nothing pops up
nope nothing pops up that's why I did
the the other demo to kind of show you
otherwise it really isn't much here to
demo but if I open up Explorer and go to
my ducky drive you'll notice now there's
my DK z3 again there's my computer's
name folder again with my super plants
world domination and all of the other
files that I had in my my Documents
folder and it's not just my Documents
folder it's really you know any folder
if I were to come in here and you know
just edit my duck slurp batch file I can
you know just basically redo this over
and over and over and instead of
documents we could say pictures or
whatever have you so yeah that's that's
the demo right there we can also build
on this with the techniques that we
talked about in the previous episode as
far as persistence is concerned you know
either to clean up this script or to
make it so that this the the wait batch
file is always running in the background
which could be really useful if say this
was a server or a workstation that I
needed to frequently backup information
off of I can now as a systems
administrator running around the office
just have this one drive named ducky and
all of these machines all ready to back
up their stuff too and I literally all I
have to do is plug it into the machine
and it copies the file that's it and
actually all of this comes back to
systems administration I mean I show off
here with like exfiltration and stuff
but to be honest the ducky the whole
project started because I like many
systems administrators and lazy and
laziness brings automation an automation
brings all sorts of fun so yes that in a
nutshell is how you could kind of
automate all of this stuff if you really
wanted to get crafty even further we
could take say one of these little squid
USB hubs plug both the duck and the guy
into there and then now I have one plug
factor but really wanted to be like
secret agent man I could you know hide
that here and run a USB extension into
my sleeve and oh you know but you can
have as much fun as you want with it so
once again props it over Rath props to
Mike W props to Google knows
best for you know this ducky script
stuff this is my contribution making it
more stealthy and I value your feedback
so hit me up feedback at hak5 org let me
know what you think and prepare for
other fun good stuff in the coming weeks
with this but until then I'll look
forward to your feedback and we'll take
a quick break I want to take a quick
moment to thank our new sponsor
CrashPlan as you guys know I have been
using crash plans for years now and I
never thought I'd be really enthusiastic
about backups but let me tell you I am
and it's because these guys do it right
okay the way that I feel is that data
should be for your eyes only and that's
why
CrashPlan offers the best security
guards trust me I've tried out
everything nothing even comes close
because these guys use Bruce Schneier
open source Blowfish cipher you can use
it to generate and import your own
private key so it's never Serta stored
on their server you can do you know the
thing where you put it on the USB Drive
and you put it in a safety deposit box
encrypt it however you'd like it's yours
and what's more CrashPlan get this I
love this they're cross-platform it's
not just for Windows and Mac no they are
awesome for people using Linux even
Solaris and so couple that with truly
unlimited backups and not like unlimited
look oh yeah it's unlimited until we
throw all your connection down it's like
unlimited seriously I have a couple of
terabytes up there Paul's got all the
hack 5 episodes you can see why we are
so excited so the fact is crash-land
software is so flexible
it'll backup any file not just off-site
but even to your own external hard drive
or even your friends computers for free
so you should just check out the client
for those reasons whatsoever when you
guys know as hackers as geeks as IT
professionals we understand the
importance of off-site backups and here
hack 5 just for you guys because they
love you know hack 5 and our supporting
hack across America they're giving us a
huge discount so get this their one-year
unlimited plans are normally 59.99 a
year it's about 5 bucks a month
but get this we've got a special plate
page just for us you have to go to
CrashPlan comm slash hack it up you get
a whopping 20% off that's a year of
unlimited backups for less than four
bucks a month so it is never too soon to
back
I highly advise you guys take advantage
of this or at least just check up
software it's super rad CrashPlan comm /
hack get up this week's tech no less
total of the week comes from Kalyan or
Callen sorry if I said that wrong he
sends us a photo of his project the
rogue Pi and you can read all about this
project it's actually really really cool
and I'm kind of thinking about doing one
myself on the show over at his blog
which is crush beer crush code.org thank
you so much for sending that in that's
actually really cool I really enjoyed
reading the entire blog about your rogue
pie and yeah I can't wait to try to
build one myself and I would be honored
if you even helped me with that segment
as well now you can share all of your
awesome technical eyes photon to put in
the subject line tech molest so that
it's easy for me to find your photos
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>