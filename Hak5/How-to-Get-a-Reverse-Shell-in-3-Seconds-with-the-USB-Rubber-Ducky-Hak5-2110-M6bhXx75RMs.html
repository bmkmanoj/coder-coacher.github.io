<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Get a Reverse Shell in 3 Seconds with the USB Rubber Ducky - Hak5 2110 | Coder Coacher - Coaching Coders</title><meta content="How to Get a Reverse Shell in 3 Seconds with the USB Rubber Ducky - Hak5 2110 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Get a Reverse Shell in 3 Seconds with the USB Rubber Ducky - Hak5 2110</b></h2><h5 class="post__date">2016-11-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/M6bhXx75RMs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">a reverse shell in three seconds this
time on hack five hello welcome hack
five my name is darren kitchen my name
is Shannon Morse
it's your weekly does a technology did
it right no and it's so good to be back
in the studio it is good to be back I
just got back from Denver which is
apparently six thousand feet above sea
level or something like that
fantastic it's very very high up in like
walking through the airport which is
apparently full of conspiracy theories I
got video of everything I'm going to put
them on my like snubs report on my
personal youtube you guys funny have to
check out the snubs report it's if
you're on the hack 5 youtube scroll all
the way down the bottom left on the
playlist Shannon's vlog it's really good
did you know they have alien skulls at
the Denver Airport no yeah it's true
there's an alien skull it's real I just
remember Denver the last dinosaur so
that's my lair
so hey guess what we're doing today what
are we doing reverse gels we've done
that before now we're doing a better
house that's one with power show when
we're in a faster and more intense
faster and whatever like that is that is
the number one direction that we had in
the first leg couple of seasons of hack
5 faster with more intensity yep do dig
yeah I think that's a Spielberg thing I
don't know I think it is I'm not a big
movie buff so I don't think it's a Lucas
thing someone will let us know in the
comments but faster and more intense
alright so for everybody out there who
is fairly new to the world of hacking
Darren what is a reverse shell why
Shannon I'm glad you asked you see a
reverse shell is a type of shell where
the victim computer calls back to the
attacker computer the attacking computer
typically listens on a specific port and
when it receives that connection it's
then able to execute commands on the
victims computer in essence its remote
control of a machine on the internet
that's super fun and of course we need
to have specific methods to get that
remote shell correct right so our
typical methods of any shell might be
say netcat or SSH SSH being my favorite
is awesome when you're talking about
reverse shells it's instead of me
calling the computer and having it
already waiting there listening yeah me
to connect
instead since it's not already set up to
do that I'm setting up a reverse shell
so it is going to call back to me so
that's the reverse nature of it and the
typical things are meterpreter which is
part of the Metasploit framework or just
simple what we call netcat reverse
shells it can just be done over it's
just raw sockets that cat is so easy yes
makes the entire thing easy love me some
that cat all right so I've gone over net
cat so if you're fairly new to it you
can check out my hack tips but for today
specifically I want to know how you get
net cat onto a victim's computer all
right so there's a couple of different
ways obviously you can if say this is
boring windows box here is our you know
our victim computer and then we've got
our you know hacker Linux box over here
waiting to to really stick it up the
Linux one and you didn't sticker up the
Windows one
oh yeah Shannon I mean that's how it
works that's how works if you don't know
hacker stickers on it it's not a hacker
laptop of course these make it go faster
folks they do ok Dan so the typical ways
to get information on to any computer
whether it be a reverse shell or
anything obviously is you can either
download it from the network or you can
install it from a floppy disk or
or USB rubber ducky or USB Drive yea or
whatever what a form of mass storage a
cd-rom these days is all USB right but
those are the two typical ways of doing
that ok there are some reasons why you
might not want to do that when it comes
to doing things like reverse gels
because you're hacking you don't want to
necessarily say download something over
the internet right because it may throw
flags yeah and some nitrogen detection
systems yeah another reason why you
might not want to use mass storage is a
lot of group policies for instance and a
lot of organizations will prohibit or
whitelist various different types of USB
drives because of policies against
foreign USB drives and organizations I
mean there's good reasons why you don't
want somebody walking off with 50
terabytes of NSA material or so hmm I
wonder that's like that's ever happened
so are you gonna type it in or you could
type it in and so for today's example
we're going to be using a USB rubber
ducky I want to see a demo of how this
is going to work okay so this is a fun
one I'm just going to go ahead and set
up the listener here on the the hacker
box so
I don't know on this command prompt here
I'm just going to do net cat tak listen
tuk port 8080 alright so I'm listening
on port 8080
I've already preset this up so now let's
go over to my windows box alright so you
know boring windows box nothing really
exciting going on here let's go ahead
and take a look at what happens when I
plug in a USB rubber ducky you guys
should be familiar with this by now this
has been all over mr. robot recently and
and this is essentially a USB Drive that
acts like a keyboard and then types a
pre-programmed payload very quickly so
this payload is going to get us a
reverse shell over netcat without
downloading over the internet and
without X you know showing up as mass
storage right so I'm going to go ahead
and just switch over to this Windows box
here and plug it in and plugged in
plugged in it's not going to look like
anything at first because it's just you
know numerating with the system but in
just a moment you're going to see it's
going to start typing ok so we're doing
a little PowerShell get a little pop-up
we're bypassing this UAC prompt here by
just hitting all Y for yes now we've got
a system command prompt and we're going
to go ahead and start typing into the
command prompt this right here is doing
a copy con command it's an old DOS
command that's creating a VBS file in
the root and then it's tithing typing
all of this into a reverse txt file so
I'm gonna switch here you can see my
hands are off the keyboard and it's
continuing to type and that is basically
poor encoding
when you can't type that fast because I
can alright so when it's all said and
done it basically uses C script to you
to take that visual basic script that we
just created that VBS file and then it
takes the input file which is that
reversed txt that we had created so all
the user has done is created two text
files on the system reverse txt file and
a decode VBS file ok use the visual
basic script to take that text file and
then basically convert it into an
executable that's so cool right and it
was able to do that because it's base64
encoded it is just a text file and then
now suddenly there's new executable on
the machine whereas there wasn't over
the network or over mass storage that
file copied now I notice that this took
about 20 seconds or so not two or three
seconds like we said it would right now
I'm not
that's that could be a problem in a
social engineering scenario yeah 20
seconds I mean I feel like you would
have to keep somebody very distracted
for 20 seconds and in a lot of cases
that might be very hard to pull somebody
away for you know 20 or 30 seconds so
what other drawbacks are there to that
kind of method well the other I mean a
couple of things can be done to
obfuscate this payload for instance if I
were to switch back to this machine and
do say color Fe in all caps you could
give a command prompt you know hard to
read I'll do color a to reset that I
could also do you know the various ways
to like change the size of the window or
even move it beyond the command prompt
so if I hit alt space and M you can just
hit the down arrow a bunch okay remember
there was a bunch of stuff on the screen
I hit enter
okay what's the active window silly it's
hard to tell what the active window is
right if I type CLS right now and hit
enter you didn't see anything happening
until I alt space and M again and bring
that window back to the foreground and
as you can see I was able to interact
with the command prompt even though it
wasn't visible on the screen it's it's
an all right payload in that it gets us
a reverse shell if I actually switch
over to my windows box here remember
that netcat listener was listening on
port yeah you're on windows system32 Who
am I and I am that machine that's on a
container our danger animal it's the
name of the computer and boom there you
come I love it that's awesome I have
that reverse shell but yeah it takes a
while yeah and it does so by putting an
executable on the system that is a it's
essentially a very small version of net
cat and that may be detected by you know
Windows Defender or any other antivirus
and things of that nature it's a fun
example of what's possible as far as
getting executables onto a machine it
doesn't necessarily have to be a reverse
shell executable that's a 2k file and it
took about 20 seconds yes you might
imagine if you're trying to put
megabytes on here right it would take a
lot longer really long so this was using
netcat but what about PowerShell cuz
can't use that now and how does that one
different from that cat absolutely so
that's a much better way to do it in
these days PowerShell if you're not
familiar it's the Windows command line
shell and scripting language that was I
guess it was introduced in like service
pack 2 of Windows XP ah it really became
commonplace in Vista
and beyond and that means that it's a
really nice alternative to that
old-school dass style CMD if you're
familiar with a disk operating system
CMD has been around since Windows 95
oh yeah and das predates Windows
completely so there's been a bunch of
bolt ons to make CMD more useful for
systems administrator but over the years
Microsoft was like ok look we need to
write something completely new and built
specifically for systems administration
hence PowerShell it's a really powerful
scripting language and with it we can do
net cat-like functionality in its own
code without having to inject a binary
onto a system but I like toss I know
right but I like it well I like CPM as
well but you don't seem to be running
that so this reverse shell is staged
right yeah so that's the fun thing about
the new one is what I just showed was a
single-stage kind of think about it like
how you get to the moon it's like a
sting single-stage-to-orbit would be one
spaceship that just takes off and then
it ends up on the middle right a
multiple-stage would be like an Atlas 5
rocket that takes off and then it
jettisons you know a portion of it yeah
when that has depleted its fuel and then
another portion then takes off ok so
what we're going to do is using
PowerShell we are going to stage this
and and there's yay right ok so let's
just talk about the quickest way to get
code onto this machine because that's
what it really comes down to if I come
back over to this windows box for
instance the fastest way to get anything
onto a Windows box is to hold down the
windows key and hit R and you get
yourself a nice little run
yey run and I could do CMD slash K tree
C colon backslash in it I'll put that in
quotes right so what that's going to do
is run the tree command and it's going
to run it in CMD so this is like the
damn simplest way to run anything the
unfortunate thing here is and let me
stop this tree because let me guess are
you limited like in character count how
many characters you can stick in that
little box no it's like a tweet really
it's exactly what 140 characters no no
it's actually does it it's 260 and
there's two tweets almost right and
here's the problem this reverse shell
that I really want to use as a single
stage and and maybe there's a way to
shave it down I'm hoping but it's
currently 284 characters oh man
right so close 24 characters you ever
like write the perfect tweet and you're
like I'm two characters over yeah all
the time that's kind of why we're gonna
have to stage this payload okay yes and
so for that reason instead of just
executing the entire thing into that run
line were actually it right into the
prompt we're gonna actually be hosting
this PowerShell script on a web server
somewhere and then with my script up in
the cloud I can then have my payload go
and download and execute that on the
victim machine oh that is cool so let's
take a look at what that reverse shell
actually looks like now here on my
hacker box on the left I'll go ahead and
just stop that command I'm going to cat
or ps1 this is write reverse shell okay
this right here opens a net socket on it
as a TCP client and then you specify
your endpoint in this case it's this IP
address is port yeah which is this shell
that I have over here so let me actually
get out of that net cat shell let me
cancel out of this and I'll just real
issen okay so now I have my listener set
up and I have my payload over here but
I'm actually need to host this on a web
server just to be you know cheap or
whatever I'm going to use PHP to host a
web server if you do sudo PHP with
attack capital s you can actually spin
up a little web server you just have to
give it a IP address and port now 0 dot
0 dot 0 to 0 in this case means hey
listen on all of my interfaces on port
80 and then tack T is the directory that
I'm going to be hosting so in this case
I'm hosting tilde which is my home
directory and if I had for instance like
an index.php file in there I could now
test that in a web browser by going a
localhost that's really cool yeah fun
little tip and I'm just going to use
this so that I can host my second stage
let's see what that looks like all right
so I've got that going it does need sudo
because it's on port 80 and let's go
ahead and in a new terminal I'll go
ahead and look at for instance the the
actual
ducky payload so if I nano reverse shell
I don't know
here let's make this bigger reverse
shell netcat right this is the one that
we did before and this is many many
lines of ducky script yeah see what it's
doing it's you know it's hitting Windows
key R and it's typing in this PowerShell
and it's hitting alt Y and then it's
doing all of these DOS commands like
copy con yeah and you can see this is a
long ducky script I mean we're talking
what 84 lines right there yeah let's
take a look at the new one nano reverse
shell power shell staged what that's it
that's thought so it's just going to
that website on the server and it's
pulling the power shell script yes that
is so cool so it's five lines if we
actually walk through it the first thing
that it does is waits for one second
which is to give the computer a chance
to recognize the ducky of the keyboard
then it hits GUI R which is Windows key
R to pull up the run line it waits 100
milliseconds and then it types in this
right here and we've used this before
actually this is a great little piece of
PowerShell all this is doing is this
this net web client object here allows
us to download as a string whatever we
want and then it'll execute this and
this right here is this r dot ps1 that
I'm hosting with that little PHP and
then it hits enter so it just types in a
one-liner hits enter which is faster
than my than then typing in the hole
8284 characters my question was going to
be it's still running a script though
and it's running pretty much the same
script you're still getting a reverse
shell and everything so but it still
makes it faster on the on the target
computer yeah this way it's actually
faster to deploy because as you saw like
how many characters did I actually type
let's see I don't know this is a lot
less see you'll see I'm on character
number 122 less the word string space so
this is very few characters that it's
typing in hitting Enter which is what's
making this a three second payload in
facts process I'm faster than three
seconds but I just want to be
conservative it's like a reverse shell
in two seconds
don't worry somebody in the comments
will be like I made this one second tray
which I would love to see I'm going to
real quick and code this
and put it on my USB rubber ducky you
guys have seen this before basically all
I do is have to go ahead and tie take
the microSD card out of my ducky put
that in the SD card reader I always pull
the microSD card out with my teeth you
would all right so I have my new volume
here I can see I can open it with files
I've got my inject up in right and so I
just do Java attack jar duck and code
jar my input file which in this case is
the reverse shell power shell stage and
then the output file will be slash media
slash my username slash whatever the
name of the SD card is and inject bin
now I've already done this so I'm not
going to run that but essentially that's
what going to go ahead and put the
inject up bin on the card go ahead and
safely eject the card by hitting the
little eject button there alright always
important always important SD cards are
terrible about just going read-only if
you yeah properly eject them they really
are so pop that in the duct and then
last thing is to just go ahead and make
sure that I have everything listening
and waiting okay okay so on my hacker
box let's see on the left the netcat
right on the left you can see I've got
my PHP - yes and it is hosting up that
web server right there and then over
here I'm listening on port 8080
fantastic so that's all good and well
now let's switch back over to this
windows box and I'm just going to close
this and I'm just going to plug in the
ducky now and this is going to be real
quick so let's just watch that alright
and then if we switch back over here in
just a moment you'll notice right here
and that it just made a request for our
ps1 that the file is serving up and we
don't see anything over here on there
netcat listener because this shell it's
not the prettiest but if I do a dir
there you go how do am i you get the
output of all of these commands so it's
not a pretty shell it's not but a weird
shell yeah it's a shell in three seconds
yeah and it's much more obfuscated than
the previous one
and it is a lot quicker on the target
computer it's like that in out you're
done right that's so cool there's a lot
of opportunities to make this even
better switch is one of the reasons why
I'm throwing this out
to the universe because I can't wait to
hear your feedback and see where we can
go with this so we're going to talk a
little bit about fun things that we have
coming up here but first we're gonna
take a quick break time to take a moment
to thank our awesome sponsor domain.com
which is the place to go when you need
to take your brain idea and put it onto
the Internet it's where Shannon and I go
whenever we need domain names because
they have a super simple domain
discovery system that will help you find
the perfect domain name right for you
and their checkout process is a breeze
which means your website will be up
online in no time flat and I've told you
guys time and time before that
domain.com are awesome folks they love
hak5 they love you guys which is why we
have a special coupon code that'll hook
you up with 20% off get this just enter
the coupon code hak5 as well as hack
five over at domain.com checkout and
save yourself 20% and so when you think
domain names think domain.com
we are back in it's now time for the
technology of the week every single week
we are asking you what tickles your tech
no less you can tweet us Instagram or
Facebook with the hashtag hack 5 that's
hak5 for your chance to win some awesome
gear from the hack shop Darren what do
we have for a winner today Oh guess what
given the segment we're gonna be sending
you your very own USB rubber ducky
that's right and our winner this week
comes from Twitter its power slave hey
that works perfectly with our PowerShell
segment so he's got a mark for an alpha
and a battery inside a Jack Daniels tin
of course oh you know what number seven
I believe it is a good ol number seven I
will say it looks really great but I'm a
little concerned about those SMA cables
they look really coming they're
connected to the to the 10 it's a tin
yeah so you get 10 on the metal SMA
connector with your antenna my ones on
it that's my advice to the one there
Shannon it's good advice is always good
advice you know what I actually feel
really bad that he's got a mark or a
mark for that we're gonna we're gonna
upgrade him we're gonna send him a nano
in addition oh lucky ye gotta get the
upgrade alright I like it so I'll be
sending you a direct message to get your
address and stuffs I promise I won't
keep it for myself a right like when we
need to clean out the closet and we find
- II do Ram and we're like how are we
gonna eat cycle all of these 16
megabytes sounds and then we're like oh
let's send it to anyway we've never have
done that if you would like to receive
eto Sims I mean if you would like to win
awesome stuff from the hack shop all you
have to do is use the hashtag
hak5 on your favorite social media and
we would love to pick you guys next well
I am super excited about the feedback on
this because I would love to see how
this iterates finds game show notes over
hak5 org that's where you're going to
find all of the scripts you can copy and
paste them into your web server and did
it not like anyway I'll save it for next
week there's some amazing possibilities
here okay yes if you guys have feedback
you can email email us feedback at hak5
org that's for the show the next shop
context over at a chase shop calm yes
yes it is and hey if you want to
supports directly get some awesome cool
swag like the ducky and the turtle and
the pineapple and all the other fun farm
creatures that we have here in the
tropical island pond that is hack 5h a k
shop comm we take this pretty really
obviously yes we do yes this is what
happens to podcasters after 11 years hey
with that i'm darren kitchen I'm Shannon
Morse
trust your techno lust
- hello welcome to hack 5 is your weekly
dose of Technol st Oh my name is Shannon
Morris
oh why don't we do this I'm Darren
kitchen now how do we do this again
a little welcome to hack five this is
your weekly dose of Technol s my name is
Darren kitchen and I'm cher divorce and
then we go on with the show
Nega and I'm sure you're more sure I'm
just gonna leave that in I just got back
from Denver you guys have a really cool
town over there it's very high up it's
like six thousand feet above sea level
like it's kind of scary
I got there and like my heart freaked
out it was so weird and I was like oh my
gosh
I just walked like a mile in the airport
why in the world is my heart freaking
out but it was because it was so high up
it was weird that's blue forever
yeah good love doing this show Shannon</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>