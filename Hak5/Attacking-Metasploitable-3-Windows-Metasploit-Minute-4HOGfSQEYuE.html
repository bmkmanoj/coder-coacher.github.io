<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Attacking Metasploitable 3 (Windows) - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Attacking Metasploitable 3 (Windows) - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Attacking Metasploitable 3 (Windows) - Metasploit Minute</b></h2><h5 class="post__date">2018-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4HOGfSQEYuE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">attacking Metis winnable three this time
on this point minute Metasploit minute
is brought to you by viewers like you
if you get value from the show and can
spare just a dollar please consider
contributing it Metasploit minute calm
welcome to minute minute the breakdown
on breaking in I'm your host Rob fuller
but you can call me movies last time we
showed you how to build Metasploit well
3 we didn't show you how to put it in
OVF or load it in but I assume that you
can once you have the OVF file you know
how to double click a file goes into
VirtualBox or VMware or whatever so once
you have it in VMware setup you have to
have networking capabilities put it put
in place so that your attacker and your
victim Metasploit well 3 you can talk to
each other once those things are set up
you can then start exploiting it so the
first thing is network discovery so the
first thing we're going to do using the
IP addresses we've already written down
of the attacker our Kali box the
defender our victim which is Metasploit
all three so we're gonna copy and paste
that in pretty simply DB underscore and
map
now I'm gonna caveat this again just
just let you know that DB NEP does not
go through matter / or it doesn't go
through routes it doesn't go through
matter prefer it doesn't go through
anything inside of Metasploit it also
has the negative effect of not giving
you anything to output other than inside
a database I know that I've said this
before I just want to make sure that you
know what you're running when you run it
so DB nmap we're gonna hit it should
come back pretty fast
lots of ports the ones that we're gonna
actually target I'm gonna add some port
numbers in here because Metasploit will
Metasploit able 3 has a couple ports
that are non-standard so I'm going to
add 8 4 8 4 &amp;amp; 8 5 8 5
so those two are open we're gonna use a
version scanner aux scanner
HTTP it should be
version to see what's on the other end
of those things
set our our host to our target set our
our ports to 9200 to start off with see
what's there not very much
8 585 844 if I can actually so we got
jetty and eight five eight five all
right PHP with dev and all these things
or we could just open it up into our
browser which is one of the best hacking
tools out there right using the client
for whatever your targeting is usually
the best way to do things Metasploit is
great but sometimes the client can do
things that are outside of what
Metasploit can do so let's try this so
insert this again go to port 9200 this
if you didn't know is exactly what looks
like elasticsearch and ninety two
hundred is almost always elasticsearch
if you don't know what elasticsearch is
it's basically oh my gosh I can't
describe this right now it's a search
engine of data that you can put on stuff
anyways go look it up
I am blanking on it right now so then
let's look at 85 85 WAMP server windows
apache my sequel PHP it happens to be
PHP info we can look all there ooh
running and see what it's runny nose is
running a system oh it's running as
username where's username local service
nice that means we're system alright
let's look it has an uploads directory a
WordPress and HTTP dev we're gonna be
looking at that in a second let's even
up the WordPress unable to connect
alright so let's go to 8044 and see
what's there
wooo jank
I love Jenkins Jenkins is a build server
so if you don't know what that is build
servers are essentially a place where
all of the developers can put things in
to have it build and test and do all
kinds of series of tests along the way
or they commit a small piece of
something and then this build server
puts all the pieces together and the
build server basically has access to
lots of things because it has to pull
everything in right and then sometimes
it even publishes to websites so a build
server is a critical piece of
infrastructure if you go into manage
Jenkins and you go down there's this
wonderful thing called script console
screen script console takes and uses
groovy script now I think the only thing
that has ever used groovy script is
Jenkins but it's pretty awesome because
what you can do with it is run commands
so if I go over to Metasploit search
Jenkins you can see that there is a
number of exploits for it let's do first
off the the numerator so use paste that
in and that is port 844 set our host to
192.168 actually we're going to set G
our host because we know that we're
going to actually be doing this target a
lot so and remember why is it doing that
so remember that set G sets this
globally right so setting this global
you means that we don't have to set it
again for every single time we're doing
this set our our port to 84-84 just
confirm that over here yep 80 44 and run
404 does not seem to be Jenkins I just
go o target URI it's on slash awesome
so this enumerator told us a lot so
Jenkins 1.63 7 script is their new job
as they're acing people's their system
info gets all the sensitive information
now since we built the machine we kind
of already know that it's Windows 2008
r2 but this is great information about
what you can learn from just Jenkins
system info being there all right so
let's exploit this thing search Jenkins
again let's look under exploits now I
think I've already covered this in
another episode but let's do let's do a
search on with grep so inside of
Metasploit there's a wonderful command
called grep now it does exactly what you
think it does so grep - h4 help grep
search we got to actually say the
command first right do pattern then
command so grep exploit search Jenkins
alright so grep then search for exploit
within search Jenkins so this only shows
us where exploit the word exploit shows
up in our search for Jenkins
oh there's deserialized deserialize
script console that's what we're looking
for
script console no username nope
no path oh we gotta set our target URI
we know that from the last one we know
our targets windows so that's good serve
port I wonder what a serve port is for
this it's probably because we're
actually serving out something that
Metasploit again this might be a
passive-aggressive exploit so serve port
is probably where it's going to have to
serve something that it pulls down now
where do we find that info remember we
only always type info when we're looking
into exploiting stuff so the description
of this is actually pretty horrible
that's amazing
so I don't know what surf port does
because it doesn't tell me actually I do
know because I've run this module before
but just playing dumb alright so we
don't need an API token because we don't
have a username or password this is all
open now our host our host is not set
why because we only set the our host
globally so let's go ahead and set our
our host globally as well that way we
don't have to go back into it
hope don't want to exploit set always
set a payload set payload windows I can
type correctly Terp retur reverse tcp
because hopefully that works l host tab
complete set l port because we never do
4 4 4 4 5 5 5 is more more important
it's more secure all right
exploit no session refused port 80 we
forgot to set our our ports 8 5 8 5
right I know
whoa what is all this
so what this is doing is actually
sending an echoing over using groovy
script a base64 encoded binary that it's
going to run on that system so the thing
about this is that if there was a V on
there which there isn't because it's
midopls Metasploit well 3 and we built
it ourselves this probably would have
been detected right
at least the binary itself once it's
decoded so you can see that cert util
which is an awesome little built-in tool
inside of medicine or inside of windows
decoded the base64 into an executable
and ran the executable we got a shell so
I don't care if a these they're not I
have a shell so option ooh get UID we're
local service that doesn't say system
get bid yeah
all right we see that we are running as
a local service right here I think we
can get system wrong so this is running
as a local service which means we don't
have root and we have to look for an
escalation path so let's try out some of
the other ports just to see if we can
get a better ground to stand on all
right so we're gonna go with
elasticsearch and see what we can see
there there's already look at that
there's already an exploit for it so
elastic multi-or exploit multi elastic
search search groovy script
why is everything using groovy script
vulnerable so this is actually something
else that runs for groovy script so
let's use groovy scripts
why not we've already done it so 9200 is
right the ports right show targets yeah
it's the only target we have available
now we can go back and hit that 9200
just to see if that's the right version
so version loosing version one point one
point one this is older than that so
we'll see all right set payload let's
see what payloads we have available Java
meterpreter all right Java meterpreter
first TCP let's set our el host again
why don't we set that globally so we're
gonna set that globally take a different
L port 9999 and exploit Java has not
been executed all right so that failed
obviously groovy script wasn't wasn't
something we could go forward but there
were other exploits were going to try so
let's look for other exploits so search
elastic search again let's look for an
older one because that one was looking
for one point four point two we're gonna
try something a little bit older and we
didn't type info in it so that's
probably our fault info here there is
one point one point one all right I
think this will work better okay we
already have our home
set our L port to 9999 all right let's
just look through our info real quick
REST API dynamic scripts yep yep yep yep
yep so far so good
and the writable directory is only for
Linux all right let's try explaining
this whoo all right we got an
interpreter session so it'll it looks
like we have some cleanup to do that
dropped a jar file we dropped an exe
with the with the other one
so we definitely have to keep track of
what we've dropped in what cleanup has
to happen but let's look and see if this
motor procession is any better than the
one that we got previously so get UID
we're vagrant we're actually this server
itself so let's see if get system works
oops uh-oh this didn't actually load all
the options so this is great opportunity
right so this is showing that standard
API got loaded but get systems not in
there because it doesn't think that it's
privileged
so load Prive this is it it looks like
it's already low oops
ah solo trip didn't work because there
is an extension isn't an extension for a
Java meterpreter on windows to get
system this makes sense if you actually
think about it and we are currently the
system user essentially but we are only
in the context of the Java meterpreter
we can actually take advantage of this
so let's let's look at this so we have
one session that's in service sessions -
we're in the scripts if we look in here
there's a Jenkins ps1 file that we
created nope we didn't what was let's
try and find that executable that we are
so PS we are right here so we're going
to take advantage
of our other shell the binary or that we
dropped on there and use the permissions
from our Java mature / to execute that
binary since that way we don't have to
drop another binary and hopefully get a
system shell using Windows meterpreter
let's do that this is crazy this is
awesome
alright so jump over to the other
session 3 now because we're running the
multi handler in the actual exploit
modules that means we don't have a
handler set up so if we go back round
and type jobs we don't have a handler
step so we have to set up a handler so
how do we find out what the handler was
listening on it's easy in the sessions
we see that it's 5 5 5 5 and it's a
Windows mature / so we use exploit multi
handler just like we have before set our
payload to Windows interpreter reverse
TCP set our payload we already set our
payload options so that should be good
I'll port 2 5 5 5 5 alright so we
exploit - Jake means that it starred in
the background now if we use our
elevated privileges on session 3 to
execute the payload that got dropped
with sussing - we'll hope for the best
let's see how it works alright oops we
got to go back and get that paste again
sessions - PS we've got to get that
binaries path again and hopefully be
able to execute it background sessions
so execute - H make it hidden we don't
need to interact with it so I and C are
useless for us because we just wanted to
execute it so
now the problem here is that those
slashes need to be escaped so we just
need to do that real fast and we got
execution that's amazing so let's see
what it is
let's go background background if I can
type right to excited look at that we
actually have a system shell using
Windows meterpreter from our binary that
got dropped because of the the Jenkins
shell to use the execution from the
elasticsearch shell to get system pretty
awesome so sessions for just get UID to
make sure we are PS look around
we're definitely system we're executing
from that local service on the system
now we can do all the stuff like mini
cats and hash dump why not hash dump
hash dump let's do it oh boo remember
one of the things about hash dump is you
got a you got to be in a decent process
to do it and we're not we're in an x86
process and we want to be in a 64-bit
process because that's the system info
that's the architecture of what we're
going after
so PS - spool migrate one on one to
hopefully that migrates correctly cool -
dump yay all right we got a hash dump
I'm gonna call it that that was awesome
that was great
and we're just gonna stop there because
that was so much fun there was a lot of
stuff inside of Metasploit all three
Metasploit oh well three to look for
just this hash dump if you want to type
out what you see here or get your own
hash dump or look inside and cheat and
see that all the configuration and
vulnerabilities that are on the github
page you can do that but
oh yeah I'm just gonna leave it there
that was too much fun so let me know
what you think email me at MSF at hack 5
org and stay tuned to Metasploit minute
comm for more shows like these a huge
thanks to everyone who's supporting the
show and if you'd like to support the
show as well head over to patreon calm
for size move it every dollar goes
towards making this show better and just
for you I'm very grateful for everyone's
support so until next time I'm ubah kan
I'll be hacking til the cows come home
the first thing we're gonna do is get
Metasploit running now obviously we
started it with go cow right go cow
equals one make sure that you get the
cow which means that you get more luck
when you're trying to attack things</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>