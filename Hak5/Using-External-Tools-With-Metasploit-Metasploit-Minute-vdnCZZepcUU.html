<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Using External Tools With Metasploit - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Using External Tools With Metasploit - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Using External Tools With Metasploit - Metasploit Minute</b></h2><h5 class="post__date">2015-01-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/vdnCZZepcUU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">using external tools with Metasploit
this time on Metasploit minute - plate
minute is brought to you by viewers like
you
if you get value from this show and can
spare even a dollar in episode please
consider contributing at Metasploit
minute calm
welcome to Metasploit minute the
breakdown on breaking in I'm your host
Rob folder but you can call me wigs
today we're gonna be going over using
external tools through Metasploit now
the very first thing you have to have is
eye Metasploit she'll to push things
through so we're actually going to start
up Metasploit just as we would and in
this example we're gonna actually be
using one of the coolest new exploits
that just hit the fan about October time
frame probably have that wrong but it's
ms forty no 68 so we're gonna wait till
the Metasploit starts up we had there we
go we got the cow so we know we're good
we're gonna use exploit multi script a
script web devote delivery so what this
does is it actually has a way via the
web to deliver a Metasploit payload so
what we're gonna do is set up our your
our surf path is fine we're gonna say
target so by default this particular
module has a Python target and we can
say that there's target 0 1 2 just by
hitting tab or do show targets so that
we can see what targets were since this
is a Windows install and PowerShell is
the default scripting language there
we're going to set our target to 2 and
we got to change our payload to windows
from interpreter reverse tcp now we
should be good to go our serve host is
fine we're gonna keep the serve port
8080 just because it's going to be going
over us via the web our URI path we're
good with it being random because we
don't want just the random person to go
up on our site and and see our payload
just sitting there and we're going to
just set our
host and our L port so we're gonna say
you know 2 1 1 2 just for example no no
big deal there so this is our setup are
done and type exploit with an e so when
I recommend when you run this pit when
they run this module is that you
actually keep and copy this portion the
PowerShell portion the script that needs
to be run on the system so we're gonna
start up a just a little leaf pad so
that we can copy and paste that you can
see that it goes to our website over
8080 and downloads this string from this
long URL alright
random URL so we're gonna go over here
we're gonna paste it in goes away and we
should be getting interpreter session 1
now that we have interpreter session 1
and you can see sessions sessions it's
there now what we can do is we can put
we're using a route and we've talked
about routes before we can throw all we
want through all the modules through
that meterpreter session so if we were
inside of another network and we could
have it pivot from the initial host that
we've exploited through that to other
hosts I'm using the route command so use
we're going to route ad 172.16.0.0
255.255.255.0 session however there's
this awesome tool and I think we've
touched on this a little bit before is
the auxilary server socks proxy so the
socks proxy actually imitates a real
socks proxy and pulls in traffic inside
of Metasploit so once it's inside of
Metasploit it conforms to all the
routing rules that Metasploit has set up
so we're gonna set our serve host just
because we like to keep our Sox proxies
to ourselves as
and eighty and on one two seven zero or
one alright so we've got the socks proxy
set up now we can use any tool outside
of Metasploit that that can support a
Sox for a proxy so if I went over to
burp burp suite and I wanted to browse
internal websites through this through
this meterpreter session I could then
set up in here use socks proxy and then
just change it to 1080 and hit go now
everything I use in burp will actually
go through this this tool the thing is
with burp though it doesn't support
socks5 so you actually have to use
something like provoke see or or filippo
to get it to go through there it needs
to be proxy that will then forward it on
through the Sox boxing so something that
will support Sox for a is is proxy
chains so we're gonna configure proxy
chains and proxy change is basically
something that will automatically
proxifier
an e application as long as it uses TCP
so tor is a great example and that's
what it comes default with so we're
gonna just nano proxy chains skip down
to the bottom change this to 1080 and
now we have our proxy chains ability so
what we're gonna do with this is
actually use another thing called in
packet it's a library by course security
so we've already pulled this down from
Google code and you can find it on
Google code very easily it's in packet
so we go into in packet once we have in
packet installed since it's a library
you just Python set up install done
setup install that's it and we already
have this done so we don't have to worry
about anything
in there and it actually has a bunch of
examples and we could go ad nauseam in
these examples but one of the biggest
coolest recent ones was the MS 40 no 68
example which is called golden pact and
we could go forever on what and how this
exploit works but we're just going to
start off real easy to show you
something kind of cool so Python we see
that this golden pact takes a couple
arguments our target using them and
password or username in hash which is
great this is one tool that exploits the
MS 14 Oh 68 without having have a
straight-up password
so let's proxy change that over to our
domain controller so this exploit
exploits a domain controller it's so in
particularly the Kerberos listener the
Kerberos KDC
and it modifies this pack thing and we
could go over that in another episode to
make it so that any user any user owner
domain can be domain admin just because
of this exploit just because of some
Kerberos funny business so they've made
this into a proof of concept and we're
going to proxy change it in so golden
pack and then we tell it a domain so
exploits dot local and our demand user
is our user and we've already got his
password we saw that PowerShell pop-up
in the last episode we're gonna put his
password in and we are going to say at
DC 1 dot exploits dot local and it is
DNS request hold on
so it's doing this DNS request and for
some reason principal the name unknown
ah it's an exploit not exploits that
local so exploit that local with the
drain we said it again and did I mess it
up again let's see yes I did exploits
that local exploits the local alright
now that it's actually working correctly
and because I had the exploit versus
exploits local issue I'm you can see
that this extra weight was pivoted over
over a meterpreter session you can see
all this s chain or proxy chains going
on with port 88 for Kerberos and port
445 for for SMB it requested the shares
that hid the shares open the SVC my
manager more four four five traffic and
now I have a shell full interactive
shell not quite interactive but it's it
is more interactive than normal CMD on
the domain controller and Who am I Who
am I we are system we've essentially
pivoted the entire connection that we
have going to this domain controller
through that one meterpreter session and
exploited the latest MS 1406 t8 so what
do you think email us at MSF at hack
five org and stay tuned to menace wait
minute calm for most shows like these
and huge thanks to everyone who
supported the show directly you can find
ways to donate or get awesome Metasploit
minute MIT merchandise at Metasploit
minute com every dollar goes to making
this show and other shows just for you
for that I am deeply grateful so until
next time I'm new extend I'll be hacking
until the cows come home
hey there yeah you thanks for watching
all the way to the end I really
appreciate all the awesome feedback and
support we've received from viewers
exactly like you not as cool but you get
the gist if we haven't already checked
it out you could really help if you go
over to our patreon and support the show
directly if you can't that's cool simple
like or subscribe goes a long way to
either way thanks for watching and we'll
talk later man take it easy</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>