<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[[ PAYLOAD ]] - OS Detection Payload - Hak5 2319 | Coder Coacher - Coaching Coders</title><meta content="[[ PAYLOAD ]] - OS Detection Payload - Hak5 2319 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[[ PAYLOAD ]] - OS Detection Payload - Hak5 2319</b></h2><h5 class="post__date">2018-01-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GEyDkd6DS8c" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello and welcome back by my name is
Darren kitchen it's your weekly dose of
technolo
today we are building a cross-platform
OS detecting payload for the batch Bunny
because I got a tweet check this out so
Kuro beats writes to Jason Street saying
hey man do you know of a good batch
Bunny reverse shell payload that does an
if/else based on the operating system
well you're in luck because there are
two recent new features in the batch
Bunny that's gonna make just this
possible so first and foremost is get
which is an extension that gets your
payload lots of different information
whether it's the switch position or the
IP address of the target or the hostname
or any of those things and it can now
get the operating system using get
target OS so with that let's go ahead
and start building a payload I've got my
batch bunny here connected in arming
mode I've got my generic payload txt and
that might look like basically get
target OS and what that's gonna do is
return a variable called target OS which
you could I don't know echo out if you
wanted that doesn't really do anything
much useful but that's what it's gonna
do it's gonna end map the target figure
out if it's a Windows matte machine a
Mac or a Linux machine and then give you
either the word Windows Mac or Linux as
the return so using that we can actually
do some F else but to be honest I'm just
gonna use a switch case because I think
it's prettier way to do it but we could
do it the other way as well so poor that
we'll do case dollar target OS and put
that in quotes there in and then
basically we just have to save the
different conditions so the different
conditions are Windows Mac OS and Linux
and then for each of those we'll go
ahead and say what to do so I'll do LED
I don't know red so I'll do LED are for
Windows LED g4 green for Mac and on the
Linux side we'll do our G or sorry LED B
and then we finish our case statement by
es AC which is just case backwards Bay
that's
right so there we go that will determine
the operating system but you're gonna
know that there's a problem here
right it figures out the target
operating system by and mapping it and
that's fantastic so you're like okay
cool well this the payload needs an
attack mode and it's obviously going to
need to be an Ethernet attack mode for
this to work yes and as we know well
windows hosts like our NDIS Ethernet
types where as Mac and Linux hosts like
ECM Ethernet types so what are you gonna
do well previously you would just you
know map them to different switch
positions on your bash Bunny and then
when you get to the target you would
just you know flip the switch and it
shoes which payload to execute well if
you update to bash Bunny version
firmware version 1.5 or higher you get a
new awesome attack mode for Ethernet
called
Auto Ethernet which will automatically
try the best Ethernet possibility for
your target so it starts with ECM
Ethernet and then on a Windows box it's
gonna be lower on underdo which is cool
because then it'll just wait time out
and then switch failing back to our NDIS
and then your Windows machines are happy
so it will determine which are NDIS or
ECM Ethernet is most applicable to your
target and it basically looks like this
you could do attack mode auto Ethernet
and you can also specify a time out if
you don't like the default 20 second
timeout I can do Ethernet underscore
timeout underscore 40 for 40 seconds if
I want now to pretty this up we should
probably start with LEDs setup before we
do that so that we know hey it's now
switching over to the attack mode and
then once it does pick whether it's
gonna be our NDIS or ECM Ethernet for
that target we can go ahead and choose a
different attack mode so in this case
we'll do LED attack so now we know it's
gonna start blinking like we've gotten
an IP address from those guys and we're
good to start profiling them and then
the next thing is to get the target OS
and then depending on if it's Windows
Mac or Linux we're just gonna go ahead
and run those appropriate things now
this could probably be cleaned up and
made better with functions or calling
other scripts which we can totally
extend upon
but for now I think I'm just gonna go
ahead and prove the concept this thing
here and save the payload run it and see
what does so we safely eject the bash
bunny unplug that guy and now we're
ready to start testing got a Windows
machine booting up and we're doing our
setup gets an IP address starts blinking
to say it's an attack mode now it's
going ahead and scanning it and it goes
red for Windows Mac gonna go ahead and
use a USB C dongle here Mac OS and Linux
so there you go what do you think submit
your payload over a hack 5 org slash
payload for a huge hack 5 gift
certificate and until next week i'm
darren kitchen trust your deck no less
if you've got a great idea bring it to
the web boy we do and head over to
domain.com
I can't tell you how many times their
domain discovery system has helped me
find the perfect name and they're
quickly easy checkout process means it's
online in no time flat and get this the
guys over at domain.com have been
supporting hack 5 for years and they
want to hook you up get 20% off at
checkout at domain.com with the coupon
code hak5 and send your thanks over on
twitter at domain.com so when you think
domain names think domain.com</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>