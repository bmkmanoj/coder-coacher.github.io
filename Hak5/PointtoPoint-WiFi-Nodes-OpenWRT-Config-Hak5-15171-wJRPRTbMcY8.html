<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Point-to-Point WiFi Nodes - OpenWRT Config, Hak5 1517.1 | Coder Coacher - Coaching Coders</title><meta content="Point-to-Point WiFi Nodes - OpenWRT Config, Hak5 1517.1 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Point-to-Point WiFi Nodes - OpenWRT Config, Hak5 1517.1</b></h2><h5 class="post__date">2013-12-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wJRPRTbMcY8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this segment of hak5 is brought to you
by domain.com hello welcome to act 5 my
name is Darrin kitchen it's your weekly
dose of techno lust and here we are with
our continuation of the Wi-Fi pineapple
mesh network kind of series that we're
working on here and I want to show the
second node in our network and kind of
how that all con comes together so let's
just jump right into it right so here we
are we're about 500 feet across from the
other building where we have our
parabolic antenna on the roof we're
doing a point-to-point link if you
haven't been following along between two
Wi-Fi pineapples with high gain antennas
and we're doing this legally because it
is a point-to-point meaning only one
node to another node and then from there
the beauty of the Wi-Fi pineapple mark 5
is that we can use the second antenna as
a or a second wireless adapter as
another access point then to reshare out
that connection to well in this case
it's going to be more clients here at
this loft as well as a bunch of other
nodes throughout the neighborhood as we
continue putting together the system so
I say pineapple however we're really
talking about we're not even getting
into some of the fun esoteric men in the
middlee bits we're really talking about
just using you know open wrt as a
beautiful base to do some really fun
wireless networking and so let's go
ahead and take a look at the hardware
first and then we'll get into how the
software works so this being the second
node we're actually using rather than a
parabolic but a panel antenna here pull
this right off and this guy I've just
got you know velcroed onto the window
you know I find that I get better signal
than if say I have it in front of the
locker or cement or any of that other
stuff and we can see here our
orientation all antennas are going to
happen orientation last week I messed up
and said it was a horizontal
polarization it's actually vertical and
we can see that we've got a V there and
that's you know letting us know to put
the antenna this way instead of that way
because it is a square so I don't know
how otherwise you would know and then
we've got our pigtail here and just set
that back up and this pigtail is coming
over here let me grab
this guy and this is our pineapple mark
5 so that pigtail is coming into this
SMA port here and that is for our real
tech 81 87 radio and that's the one that
is a client to the station across the
street this antenna is just the you know
five six DB I gain dipole that comes
with the unit because we're using that
for a point-to-multipoint so this is the
high gain guy and then this is just our
standard running as an access point you
may notice I've done a little
modification here that's called electric
tape and that's called wondering how
many LEDs you have blinking in your
bedroom fun stuff huh so one of the
things that I'll point out here is that
I'm actually using a pretty good length
of coax cable here I'm getting a little
bit more signal loss and wanted it's not
exactly cut to length so I may go back
later and get a smaller antenna cable
however what's nice about this is it
allows me you know with the the previous
pigtail pretty sure I have it in here
somewhere but previous pigtail is only
about this long and I actually noticed
that I get much better signal when I
have more diversity between these two
antennas especially this being really
high gain actually I learned a lot about
that when first experimenting that with
this and channels so let me just put
this right back up here you know the fun
is em band that we love to have too much
fun with and and in the 2.4 gigahertz
spectrum when we talk about traditional
Wi-Fi and in this case we're using G we
have well in the United States 11
channels to choose from in Europe you
can have 12 and 13 channels and in Japan
only you can have the 14th channel but
as far as like channels they're they're
really just slices of the spectrum and
each channel that you operate under
takes up about 20 megahertz of bandwidth
so channel 1 for instance actually
overlaps with channels 2 and 3 and as
such there are only three
non-overlapping channels so one of the
things that I like to do whenever I'm
setting up a system is I want to see
what's in the neighborhood what channels
are available what's what channels are
most school
and and then choose the one most
appropriate so for that I like to use in
SSID or by Metta geeks this is good
stuff
also kismet is a great tool and really
anything that is going to allow you to
take a look at what's out there so in
the SSID or insider or however you
pronounce it is showing me here that we
have a ton of different access points in
fact channels 1 6 and 11 are kind of
your defaults your standard that most
routers are out of the box are going to
want to try to use and I honestly do at
you this is one of those things where
you have to experiment because it's
going to vary depending on your location
and this here being a busy neighborhood
we have a ton of different access points
here so I've opted to stay on channels 4
&amp;amp; 9 kind of non-standard stuff but I'm
finding as long as you have enough of a
slice of the spectrum that isn't being
squashed by somebody else you can
actually get some pretty decent
throughput as I'm getting right here at
about 9 and 1/2 megabits per second
until that's not bad not bad for G and
definitely considering a 23 millisecond
paying I could almost game with that so
let's go ahead and get into some of the
configuration here now I mentioned that
I'm using pineapples but honestly it's
just because it's what I have at my
disposal and it's already an open wrt
device that has to two independent
radios and so since I'm trying to do a
point-to-point mesh I want to keep
things simple and just use one antenna
or one radio adapter as a client and one
as an access point and so that's what I
have set up here so let's go ahead and
log into this pineapple but the one on
the roof over there because from there
we can take a look at how that's the one
that's Power over Ethernet connected to
our to our network at the hak5 studio we
can take a look at how that's configured
and then take a look at how this one's
configured
it doesn't matter whether you're a UDP
packet or a joke I'm not sure you got
when that killer idea hits you got a
snag that domain name and the web
hosting fast and with domain coms quick
domain discovery system and there easy
checkout process you'll have your
website up and running in no time I love
these guys domain.com because they're
affordable they're reliable they're easy
to use plus domain coms active social
media presence I mean it really just
makes it a great place to do business
and the guys over there domain comm are
huge fans of AK 5 so they want to hook
you up with this coupon code hak5 really
easy want to remember use that at
checkout for an extra 15% off so when
you think domain names think domain.com
and we're back with the trivia question
of the week now first off last week's
trivia question was unit Junction
transistors aka you JT's are often used
in simple oscillator circuits what
characteristic of a transistor defines
it as you know Junction and that answer
was its internal structure has only one
actual Junction now this week's question
is if you are the victim of a smurf
attack you're the victim of what you can
answer that over at hack 5 org slash
trivia for your chance to win some
awesome hack 5 goodies
so let's go ahead and ssh into our first
node here
and immediately what we want to do is
edit three configuration files found an
Etsy config and here we'll see that we
have wireless network and DHCP so let's
first start with network basically what
we want to do here is define our you
know IP address so option IP a derp
we're going to set this with a static as
dot 73 31 9 we're going to set a gateway
and this is the gateway of the router at
the hak5 studio as well as an option for
DNS and I just like to use Google's
because it's easy to remember that's
pretty much all we need to do as far as
changes under Etsy config Network now
let's go into let's nano Wireless and
take a look in here now under wireless
we actually define the two devices radio
0 and it's using a Mac 802 11 driver HW
mode is the hardware mode and we're
doing 802 11 both N and G we see our MAC
address here HT mode is actually the
bandwidth that we're using so in this
case HT 20 means 20 megahertz of
bandwidth you could even do HT 44 twice
as much bandwidth really just depends on
the regulations in your area and you can
see as far as the area is concerned
option country us so we're here in the
United States option TX power 24 we've
coupled our 24 with a DBM with our 24 DB
I to get that 63 DBM power and then our
channel and in this case you just I just
have coded this 2 channel 4 I want to
make sure that our first node and our
second node are not read broadcasting on
the same channel because then they're
kind of talking over each other and it's
not as much fun otherwise once you have
defined the actual Wi-Fi device which is
the physical radio 0 then you can define
the Wi-Fi interface so again it's using
the device that we just defined is radio
0 we're putting on the network LAN and
we're setting up the mode is ap so ap
access point real simple we just give it
an SSID so in this case point mesh 1 we
give it an encryption type now this
encryption type PS
okay - what that means is WPA so just
like we have that really weak WEP which
you should not be using we have WPA
which would use a tkip cipher as well as
wpa2 which will default to a CCMP cipher
which is a lot more secure so that's
definitely one that we want to use and
we'll come back to that here in a minute
as far as the key since we are using PSK
PSK means pre shared key as opposed to a
more enterprise level where we have a
radius server authenticating us and
we're not quite there yet so we're all
just going to share the key and in this
case I'm just temporarily using lame
password after that you know you can
comment out the other radio we're not
actually using the other radio in this
instance however doesn't matter what you
do because it will come back when you
rerun the Wi-Fi command and reinitialize
the radios so nothing to worry about
there I can close out of that and then
finally since this is actually being
used as an access point on our existing
local area network attack five studio we
want to go ahead and turn off DHCP if I
nano DHCP the easiest way to do that is
simply to comment it out I mean yes you
could stop the service but I just
commented it out that takes care of
everything there so that is our first
node let's go ahead and take a look at
the one that's actually our second node
that's connected to it and you know
rebroadcasting a network here in this
building and then that will then use as
a jumping-off point for so many other
places
so let's SSH over
and again the same three files are going
to be the ones of interest and so I'm
going to CD to /t config and let's start
with network so in this case we're using
a static IP and in fact I'm just using
straight out of the box very similar to
the way the Wi-Fi pineapple works we're
using an address scheme of 172 that's
sixteen dot 42 dot well one for the
router but with our net mask of
255.255.255.0 network so we can have 255
hosts so you can kind of think of it as
one 7 2016 dot 42 X and again we set our
gateway now in this case our gateway is
actually the gateway of the router on
the hak5 land not the first node in our
network ok so we're using 10 73 31 1
which is its gateway as well we set our
dns options again I just like to go with
Google but Open DNS is a good
alternative and then the rest of it
pretty much bone-stock alright and so
now let's take a look at the wireless
configuration of our second node same
idea you define radio 0 we've set up our
channel in this case it is on channel 9
again 11 and G we're using 20 megahertz
bandwidth here and radio 0 is our access
point radio
that's the atheros chip here that we're
using and that's what's going to be
running as our access point and so
that's why I'm running on channel 9
because I don't want to overlap with
channel 4 we give it an SSID and again
same idea PSK - I'm using WPA with the
ccmp cipher pretty strong stuff and
again a super lame password for our
password so now we've created another
access point but it's backhaul is
actually - the first access point and so
to look at that we take a look at Radio
1 so whereas the previous one we were
only using radio 0 as an access point
now we're using the second radio as our
backhaul
so radio 1 set it to channel 4 and we
give it a MAC address that's the only
thing that we need to specify physically
after that as far as the interface is
concerned
we choose our device that we just
defined now we put it on a network the
network is going to be ran because
that's our backhaul that's the wide area
network and we're going to set its SSID
to the SSID that we're connecting to so
this is now becoming a client it's
connected to point WESH 1 and we can
tell it to client because the mode here
is Sta
so instead of mode ap for access point
mode sta for station station means it's
a client again we give it the same key
for that PSK and we tell it what kind of
encryption we are using and so we
actually specify p sk + c cmp and we can
close out of that and then lastly it's
dhcp which we really haven't changed i
mean this is pretty much stock from the
pineapple and this is really standard
for any open wrt configuration you can
actually come in here and choose what
address blocks like right now we're only
giving out 50 addresses where you're
giving out the ones that end in dot 100
and the ones that end in dot 150 then we
set our least time and all of those
other options like these DHCP options
here are actually the IP addresses of
the DHCP server anyway suffice it to say
with all of these up and running that
one access point connects or two to the
other that has the backhaul to the
internet and it realized its own access
point with a different SSID and that
keeps things the most simple if you ask
me and this is a great jumping-off point
and so there we have our second node
which is actually the most useful node
because it's actually one connecting to
our network across the street and this
is like I said a beautiful jumping-off
point because I can actually see so many
other places here in the point where
we're going to be deploying more I guess
less permanent nodes to the network this
is a really fun - because I actually
have like decent throughput here I'll
get anywhere between you know eight or
10 megabits per second which I'd say
over 802 at 11g with a theoretical
maximum of 54 megabits per second is
pretty good I've gotten it up to 30
megabits but the thing is there's a lot
of stuff going on in the 2.4 gigahertz
spectrum and while you could go ahead
and do all your neighbors that's no way
to make friends I'm not advocating that
in the slight
so one other thing on when we're talking
about the the ciphers that I'm using
here for the backhaul PS guy 2 is using
wpa2 with the CCMP cipher now you could
use WPA one with the tkip cipher however
there are attacks for that and you
should absolutely not use WEP wireless
equivalency protocol because it's you
know cracked in ten seconds
so the thing that I will mention about
that however is that depending on your
client if it's not set up properly it
may or it doesn't know how to speak wpa2
very well it may reset every 10 minutes
and if you've ever like noticed
something we're like your Wi-Fi
connection resets every 10 minutes it
could have to do with the group key
renegotiation the thing about wpa2
and CCMP is that it'll you know rekey
meaning it'll choose a new you know a
set of data that is going to use for its
cipher every 10 minutes now you can
change that with the option in open wrt
using wpa underscore group underscore
rekey if you set that to 3600 it'll
rekey every hour if you set that to zero
it won't rekey which isn't suggested
it's probably better to kind of
troubleshoot what your client is to this
I haven't thankfully since I'm using
just two pineapples needed to do that
but if I were using some other gear that
might be an opportunity to look into
anyway again this is very exciting to be
doing this kind of ad-hoc project here
no pun intended as far as Wi-Fi modes
are concerned and I'd love to hear your
feedback so feedback at hak5
org and until next time let's get back
to the studio and see what's going on
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>