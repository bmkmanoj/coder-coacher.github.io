<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>In Depth Core Commands - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="In Depth Core Commands - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>In Depth Core Commands - Metasploit Minute</b></h2><h5 class="post__date">2015-04-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Il-c4qO7_MA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Metasploit minute is brought to you by
viewers like you if you get value from
this show and you can spare even a
dollar please consider contributing at
Metasploit minute calm
welcome to Metasploit minute the
breakdown on breaking in I'm your host
Rob fuller but you can call me Moving's
this time we're gonna be talking about
Metasploit core commands so this time we
actually have four months ago ish we had
we did the core commands or system
commands
yeah core commands on this season and
Rahmi rom as well as Marik I will not be
able to pronounce that innate wind the
Nate guy they all wanted more
you know scenario-based core commands
right so some of your favorites some of
my favorites in and it's really easy to
pick my favorites because one of them is
definitely migrate the something about
migrate so migrate is black magic so I
don't know if you've ever tried
programming in C C++ I don't like to do
that because I don't like to member
manage memory and all of that stuff but
I like the Python type languages so
think about it this way migrate you have
mature per in memory sitting there just
you know minding its own business not
doing anything then you type migrate and
then you give it a process ID and what
it does is it actually opens access to
the the other process that you want to
migrate into it then creates a shared
memory space and talks to that socket
pushes the socket into the jam Ramirez
moves over to that shared memory space
and its closes down so you're basically
keeping the same connection going and
pushing it from one process to another
so it's like process hopping for your
like for your session why what's the
advantage there well okay so a lot of
things a lot of people migrate for a lot
of different reasons one of which is to
like just get out of the process that
you just exploited so let's say you're
an internet explorer right and it's
frozen
because the you know the exploit froze
it crashed Internet Explorer ish you
should you still have code execution but
you can migrate out right so so they're
going to kill that process yeah they're
Fredo no they're gonna kill I explored
out exe and I'm toast
right and there's a lot of other reasons
too so let's say that you want to
migrate into Explorer dot exe because
you want to do key logging so in in
Metasploit key logging it only sees the
keys that the process you're in can see
oh right so that's that's the cool thing
about Metasploit ski logger is it's not
a traditional key logger it doesn't
register the same hooks well that's
actually really cool because you may not
necessarily be interested in the keys
being used in everything you might only
want them for the instant messenger app
or the browser or or the or or a say
token thingy or key pass yeah one
password or LastPass that is pretty cool
right so you migrate into whatever you
want and and it's totally black magic
like I am so interesting you become like
a parasite on that process right yeah so
it's it's like people take it for
granted too because they're like oh it
migrated and then died okay
do you understand all the things that
are going on here okay and you could be
like wetly round robin and just like
keep bouncing from process to process
because it's like it for evasion or oh
yeah you could but one of the things
that to keep in mind is you as soon as
you migrate to a different process you
take up all the properties of that
process so the user's permissions
whatever so if you're in a system
process and you migrate into a low-level
user process like in Windows 7 if you
migrate into Explorer you lose all of
that capabilities as system you don't
you don't get that back right so is this
you know can be used for privilege
escalation not really like privilege
escalation requires you to have the
privileges all ready to migrate I see
right to open that process with an
all-access or se debug okay so we're
actually gonna migrate so right now
let's take a look we are in PS
get kid so wordy Rosie's ID 2196 so
let's look at 2196 scroll up a bit
there we are power show and this is
we're in PowerShell because that's how
the the web script module works so we're
in PowerShell where we want to go is we
want to go to Explorer so how we get
there is we PS with a - s uppercase s -
search Explorer dot exe we find Explorer
and then we type in migrate 2 4 9 and 6
because that's the process ID for
Explorer more black magic yeah look at
what architecture X ok x86 64 bit so
it's 64 bit right right what are we in
right now let's do sis info we are in a
32-bit process so we're we're gonna go
kinda with our shell code is 32-bit
right now yeah it's going to migrate and
run in a 64-bit process ok let's see
this
so migrate 2 4 9 6 so that's it
like people take so much granted like
that that they see that it's like it
weren't or it didn't like it and then
complain about linking cursor of please
work right yeah but like now if I do
system so so what's the advantage of
that is it that you can now run 64-bit
code on this I mean it's only a yes see
so so a lot of things inside of
interpreter require the correct
architecture to be in like mini cats so
if you load many cats and you're in the
next 86 process it will tell you hey
kinda need to be in 64-bit because the
system itself is a 64-bit right so if i
if i went back to powershell and then
used or loaded my main cats it'll
complain about it
so that's migrated and that's well i
want to express how much to all of you
that this is awesome stuff and you
shouldn't complain when it fails because
it's doing some amazing things i can
tell that there is deep love in your
heart for the migrate
well I tried coding it myself and I just
took my mic but I just tried coding
myself like my personally and I couldn't
do it I Oh like I really wanted to see
if I could do it myself and it couldn't
it's an awesome thing that is working
you know what if there's deep love in
your heart you can actually subscribe
you can actually use your very own
dollars or even Bitcoin you can find all
the ways that you can support Moo bik's
at Metasploit minute calm and that's and
then also you can go to
patreon.com/scishow and it's so cool to
see how every dollar is getting you out
here to that warehouse to shoot more of
the season 5s completely supported by
patreon oh it's it's amazing and I
really appreciate all the help that I
see that Season 5 has come alive because
of you so if you find some value from
the show and you want to give some value
back we really appreciate that keeps
move it's coming out here and we're just
ecstatic to have you and all of the epic
not just the patrons but everybody that
just watches and subscribes and likes
and shares and you know all that social
stuff that keeps us doing the thing it's
great so let's get into your other
favorite commands right soloed now this
is this is another black magic and you
can use it I I like use because it's the
old way of doing things and it's just
built into my head but load is actually
the right way of doing it so what load
does is it loads the the extensions the
Metasploit armature per extensions and
you hit tab and you can see that there's
a bunch of these extensions now the way
that does this and I'm gonna just go to
load you know Kiwi I'll load yeah okay
it's alright and and it doesn't look
like much it doesn't look like anything
really is going on right actually
happening it's actually like using those
it's like copying them into memories so
that you can go ahead and use these
exploits or what well it is copying in
memory but not in the way you think it's
copying it not into the memory of the
hosts into you but into the remote hosts
into the victim so it's using something
called reflective DLL injection where
it's actually throwing that DLL into
memory on the remote
not ever writing it to do it and then
being able to call that dll so you don't
even show up inside of the process you
won't see like sniffer DLL branded whoa
that's kind of crazy so like I think you
know I've got a show now let me copy
like you know tools over to there now
they're on the desk
great forensics guys are nodding their
head good yeah do that that'd be awesome
but it doesn't work like that if you can
use a reflective DLL injection right
means that you can then take that tool
and put it right into memory so that if
the machine reboots it's gone
yeah so again like the black magic that
this is this is literally going and
taking though that that well the process
yeah I'm talking about the MZ the the I
forget what it's called the pixie thing
they like executed health what is it
called what is a Windows executable
called PE a PE file Thank You jobs
somewhere in there so it create it takes
that PE and the DLL and and strips it
apart throws it into memory and then
somehow and you can read the paper over
harmony security on how it does it it's
actually a really good paper but it
loads it so that's what I like and and
people do take advantage of do take for
granted what's happening here like when
when core Lib doesn't load or whatever
it's just like do you understand what's
going on and actually as a little teaser
and later on in the season we're gonna
be talking about staged lists
meterpreter so you can actually load all
these details into the binary itself so
when you actually throw it over into a
remote host it's already ready to go
that's our automate the automates and
okay what's your other favorite here so
my other favorite let's just scroll up
now that we have all these commands
loaded because we did it so every
actually I'll real quickly so you every
time you load them now they just show up
in your command list yeah just show up
in the command list so if you're not
sure what
you know what your options are and what
the commands are you can just a question
mark right so BG run so background run
now this this isn't as useful anymore
simply because post modules you can just
run - J and it's runs as a jobs a job
right so and we just talked about mods
ponchos now you can create them and use
them and you can automate all the stuff
and then use you know DES J to run it on
all you know every single one of your
sessions one by one one by one but if
you're still doing scripts and I do
scripts all the time even though they're
deaf crated and it will never be added
to the actual medispa instance I use BG
run to throw it into the background and
then so BG run wallpaper and this is our
wallpaper that we the script that we
created a while back it just says
executed meterpreter with job zero and
it's actually going in the background
and you can see it executing stuff
Erika's we've got a little bit of output
there yeah so this is kind of what
similar to putting an ampersand at the
end of a command and Linux basically um
and it was not as well known command and
not well used but I still use it and I
still love it
and I write scripts that are 40 page
long scripts first off because I'm lazy
and don't want to make it into a post
module and I just BG run stuff and
that's what I like about it
that's rad if you want to tell us what
you think is rad you can leave it in the
comments you can also email MSF at hak5
org
and of course find all of the ways to
subscribe and to support the show at
Metasploit minute comm that's where
you'll find the links to the patreon
that's patreon.com/lenguin
I'm just you know I'm just blessed that
we just get to hang out and make more
shows so rad so if you if you do leave
comments this is this this in most of
this season is actually a viewer
supported so all the comments that we
got and I like to go through there and
find out what people actually like and
do and stuff like that so when I go and
look at the comments there's some trolls
in there but that's okay
piñon but if you want to see something
on the show if you think that there's
something that I'm missing something
that you want to actually see more of
i'm totally amped about doing that and i
want to cater this to what you guys want
right and if you guys want to get
hands-on in Metasploit with mo bik's and
you're keen on coming out to the San
Francisco Bay Area June 26th is their
very first penetration testing with hack
5 and testing with act 5 it's gonna be
epic if you're in depending if you're
into act 5 if you want to play with some
of the cool hack 5 tools you'll find all
of the details on how you can get an
epic tactical bag full of all the hack
fiery - yeah yeah you got over here and
then the training to have the confidence
to go out in the field and use
everything properly for any experts from
you know mu bik's and myself and the
other developers to actually you know
like rock all of this stuff with that
hands use practical stuff nice yeah so
we've got epic labs set up and anyway
I'm just gonna tease this out here
because you know June's coming up and
there's not a there's not a whole lot of
seats and this is our very first one so
there's a massive discount especially
for a Metasploit minute fans so check
that out
hack 5 org slash training right yeah
there we go so that's it for Metasploit
minute until next time I'll move excite
I'll be hacking to the cows come home</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>