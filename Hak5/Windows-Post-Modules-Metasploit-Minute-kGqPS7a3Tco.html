<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Windows Post Modules - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Windows Post Modules - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Windows Post Modules - Metasploit Minute</b></h2><h5 class="post__date">2014-09-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kGqPS7a3Tco" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">windows post modules this time on
Metasploit minute this Metasploit minute
is brought to you by hack 5 and viewers
like you
support us directly at HK shop calm
welcome to Metasploit minute the
breakdown on breaking in I'm Rob fuller
but you can call me mix this time we're
going to show some of the windows post
modules that I personally use quite a
bit there's a there's 120 some odd and
I'm sure by the time this airs there's
going to be a lot more but we're going
to start off with just the list that I
kind of use the most so first off and as
you can see on the screen I've got the
list already pre-populated so if you
want to kind of work ahead you can is
this ARP scanner this ARP scanner is
basically uses something called railgun
and we've talked about railgun a little
bit it's a Windows API calls that
meterpreter can use it uses railgun to
create art packets across the network
that way you can find out what hosts are
in your local broadcast or ARP broadcast
range without having to scan them so it
enumerates all the hosts that are there
without having to do a scan or a ping or
have any ports open off honestly so
since we already have from our previous
segment all of the hosts already scanned
in ARP scanning us we're not going to
actually do that we are going to do a
cache dump though so we take it and it's
very easy to use a post module you just
say use and then we paste in what we're
going to do we have a debug option but
normally it's just a session option so
we're going to set session and you can
actually tab complete whenever there's
more than one session you can next it'll
give you options but set the session
type run and since our actual box that
we're targeting it's not on our domain
you're not going to get any cached
domain credentials obviously so next one
we're going to do is check VM and I'm
going to just talk about some of these
as we go along we're going to check VM
why this is important why checking for
virtual machine is important is
sometimes instant responders or whatever
can get kind of sneaky and puts you in a
honeypot or a virtual machine or you can
be on a virtual machine or a server
that's a virtual machine and sometimes
you'd like to know that that's that's
there and then you can start targeting
the actual host OS so show options again
sessions the only option so we're going
to just up until we hit session one run
and this is definitely a virtual machine
because it's running on my Mac right
here so yes it's a VMware virtual
machine great
the next is GPP if you haven't heard of
DPP just google for it it's group policy
preferences and the great thing about
this is in Windows 2008 I'm not 100%
sure if it goes back before that or or
ahead but in Windows 2008 you had the
option to set preferences for the group
policy that said this username and
password is used for a few things one to
create a local admin if you wanted to
create one local admin across all of
your domain attached domain or machines
then all you'd have to do is is set that
username and password inside of the
group policy and it get pushed out to
all of your boxes and it is great
initial thought on ways to set a local
admin so if you use this it'll actually
pull that out the reason it can pull
that out is because Group Policy
preferences are stored in an Aes
encrypted and pretty sure say AES and
AES encrypted format but the key for
that is actually published on MSDN which
is awesome so you're just inside of the
module you can see the keys in there and
then you can run that the next one is
tortoise SVN most of the admins who use
Windows for stuff either use tortoise
4sv and stuff or or some kind of cygwin
alternative and great thing about
tortoises you can save all of that using
password stuff and if you use it you can
pull out all of their credentials for
any Sen connections that they have so
so not only get the host box you get any
server that they have access to for SVN
usually those are code repositories of
all kinds of fun stuff the next one
we're going to actually use is this
winscp so if we use post winscp we're
just going to paste it in there show
options I've already set the session in
this so winscp is a Windows secure copy
alternative and if you store passwords
it actually stores it and in a
reversible way and there you go you have
the password right there it winscp does
tell you that this is not a recommended
option when you click Save password so
it does give you the option to not to be
stupid but we know that sometimes people
choose not to the convenience over
security so cool we have a password now
now even we haven't even gotten off this
one box you're using this post module
and we already have the tortoise SVN
server if we had run that module we also
have the password for this SSH server
that this person goes into and we're
also going to do some DNS cache dumping
so use post well we're going to skip
that but DNS cache dumping is
essentially dumping all of the DNS cache
for that Windows machine so if someone's
gone to you know android hacks comm for
instance they're going to see android
hacks comm in the Windows DNS cache and
then the great thing about that and why
I usually use is not for the external
websites but for the internal ones this
way you can enumerate websites that
users inside of a corporate network or
inside of a network go to that are
internal without you having to kind of
do an nmap scan or do any form of
advanced scanning so we're really
focusing on with all these post modules
gathering as much information as
possible about that local network
without ever having to get off the box
or send other packets out other than
that ARP scan obviously in the GPP stuff
so continuing down the list we have a
new map locations and pneumatically
occasions are great because you can it
enumerates all of the applications that
are installed on that Windows machine in
Chrome and a new ie and an in Firefox I
just put in Chrome in there these all
get not only the cookies that are stored
in but for firefox and chrome and ie
they also take out all of the passwords
that are stored on each one of those so
anoon chrome specifically it looks at
the sequel light database and pulls that
out so whatever user you're actually
logged in as it pulls the passwords
cookies and all that stuff out so you
get a lot more information about it then
a new term server is a very important
one that I think many people under
utilize it tells you where your user or
where that box that you're currently on
has ever already peed into so normally
you can assume that RDP access usually
means and and some cases it's not but
usually means admin access to add an
access to a server so you can find out
where your user not only SSH to using
the winscp stuff SVN stuff you can find
out where there are deep into that way
you can easily pivot into those other
boxes
you knew unintended XML file that is
stored on a Windows box when it's first
deployed when a domain or our group has
created a deployment image it uses
something called on its head on a 10x ml
to create that local settings including
sometimes the local admin password or
other accounts that are added to that
box
and it includes it sometimes then
unencrypted format so you can get free
passwords out of that the next one the
next two are some of my favorites inject
CA and remove CA inject CA actually
injects a certificate authority and if
you know anything about us as well
that's a really fun thing to have a
certificate authority cert into that box
that means if you're on that box using
an injection of some sort or
Hastur some thought and you find out
there is some kind of restrictions so
that only signed binaries are allowed to
be executed or allowed to run you can
inject a CA and then all you have to do
is sign something with that CA and now
you can run the binary it's great
remove CA also this also helps with SSL
decryption so if you want to inject a CA
and then change their proxy
configurations Allah pineapple then you
very easily can be man in the middle
with SSL and they won't know the
difference
there won't be any pop-up saying this
SSL cert doesn't work finally we're
going to go into the WLAN profile
another one I feel is quite
underutilized but we're going to show
you how this works
so W line profile it's already set up
takes and runs a command in Windows that
gives you if you are system and an
administrator gives you all of the
passwords for any WPA PSK or WEP
networks that someone's logged into so
Windows 7 and above keeps those
passwords in clear-text if you ask if s
you ask for it so the great thing about
this is this is more of a side channel
so let's say that I get on to a box
using a fish or some cut other network
connection and I want back on to the
network but for some reason my my
session died or that user the cat or
system got reimage because they found my
stuff now I can go to their office or
close to their office and log in if
they're using WPA PSK or whatever so
this is a persistence method that isn't
persistent on any box as long as they
don't change this pastor for their WPA
right so you always want to have this
other method to get in that is if you
can go to location wherever it is so the
next is some active directory post
modules that I enjoy new computers tells
you all the computers again very few
packets on the wire showing you all the
computers that are in the active
directory service principal names this
allows you to find
sequel servers or anything with SPNs
that identify themselves like a
deployment server and then user comments
so many times in so many assessments as
when I was a consultant you'd find
accounts on networks that had comments
that said password is X and then you'd
have the password for that like student
ones are the the the most common so
you'd have student account one student
account three so you didn't count four
and then it'd be student account one for
password or whatever in the stuff or or
student one two three four and it'd
always be in the comment so it'd be easy
to remember so those are the three
active director ones that I use quite a
bit and then finally passing shells this
one is again we're going back to a few
episodes ago where where I talked about
two is one one is none you will not be
surprised that I still fall prey to this
whenever I whenever I got on a machine
I'm always amped to continue forward but
I have to take a breath you know step
back and say two is one and one is none
because when you have a session and it
dies if you don't have another backup
session you've just lost that entire
connection on however it took you to get
in so and a lot of times it's a lot of
work to get back on a machine so if you
have a backup session you can do that
and the way you can do that is using
that specific post module so show
options there's a bunch of options in
here and you can set the payload you can
set the options what it does is creates
a new new process or injects into
current processes throws the payload in
it and get you a shell back so you can
do this to yourself to your handler that
we've set up previously or someone else
so if I want to send Darren a session
from this box all I have to do is
payload inject to them I want to send
Paul one that way we all have you know
sessions and we can all do stuff on them
and if mine dies I can say hey Darren
could you send me a new session and he
can do that for me
because mine died or we can have
multiple sessions of the Mike so that's
the majority of the of the
those post modules that I really enjoy
using I use all the time tell me what
you think hit me up at MSF at hak5 org
stay tuned to Metasploit minute comm for
more shows like these thanks again for
supporting the show and if you have if
you want to support us even more you can
go to a chase shop calm until the coupon
code new bik's and get a free Metasploit
sticker until next time I'm moving sand
I'll be hacking to the cows come home
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>