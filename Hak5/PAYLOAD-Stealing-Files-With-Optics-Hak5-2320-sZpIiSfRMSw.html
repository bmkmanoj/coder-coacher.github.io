<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[[PAYLOAD]] - Stealing Files With Optics? - Hak5 2320 | Coder Coacher - Coaching Coders</title><meta content="[[PAYLOAD]] - Stealing Files With Optics? - Hak5 2320 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[[PAYLOAD]] - Stealing Files With Optics? - Hak5 2320</b></h2><h5 class="post__date">2018-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/sZpIiSfRMSw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">stealing files without privilege
escalation networking or storage where
exfiltrating with optics and a
smartphone all that and more this time
on hack 5 hello welcome to hack 5 my
name is darren kitchen my name is Jana
Morris this is your weekly dose of
techno less welcome back to the studio
let's do a pillowed series thingy with
you with me yeah it's gonna be fun yeah
I'm gonna explode all the things here
it's gonna be good I don't know we got
to blow up the old place before we move
into the new place right okay we got
something super fun to eat today for you
so as we know the most basic input and
output of a computer is a keyboard and
the screen duh it is the primary way
that we as humans interact with our
machines so the question today is can we
use just those two effectively
exfiltrate files
so to start Darren yeah what do you
think would make a good payload ok so
get this alright basically the concept
is we're gonna attack a Windows machine
because sorry but you've normally what I
find in office is a walk into and you
guys have the juiciness yeah so targets
a Windows machine we're gonna try to use
keystroke injection techniques only so
no storage no network we could use the
ducky we can use the bunny but the the
concept here is we are going to rely
only on that users local privileges so
just what they can type with their own
say there's no administrator no admin no
escalation and no dependencies that's
another big thing want to be able to
develop a payload that you can just plug
in and it'll go and then you can just
record the screen walk away okay no this
is perfect for that situation where you
can't rely on being able to get nice
escalation or they've got it locked down
to where you can't use network for
exfiltration or USB storage so I'm
thinking like you know one of those bank
jobs or something where they've actually
done the due diligence and the actual
security there sweet so really this is
more of like a thought one where it's
like hey basic i/o so you're gonna find
out with us yes so the only thing that
we are relying on here is the users
ability to actually type at their
keyboard just like you know he's drawing
bad
we're strong bad yeah that works too and
their computers ability to show pretty
pictures on a screen so that's literally
all you need and if done properly the
concept is that we will be able to
capture the desired desired media not
over a flash storage or Ethernet or
Wi-Fi like we normally would in a
penetration testing scenario but
optically so like physically to a
smartphone so I'm gonna take myself like
that idea we're just gonna record onto a
smartphone so you pop in your ducky or
your bunny you have the payload scan the
drive for the whatever good stuff you
want to find and then display it out so
that we can record on the screen and
then off we go because this way no logs
and that's kind of beautiful so here's
the thing I'm not dead set on the
encoding technique here although I would
like to be able to get more than just
ASCII right if this were like if I was
just looking for text files here I would
do like type secret plans txt pipe it to
more take a picture of it and then yeah
exactly and then have the ducky script
like every half second or something hit
the spacebar to page across and then you
just record it and it would be very
different that would be like a lossy
situation where you wouldn't actually be
Rhian coding bit for bit you just watch
the video file and actually read the
secret plans okay it's not the way it
works in this day and age what we want
are the XLS files we want the you know
docx files we want all of it you know so
the easiest way for me to interpret it
that stuff into ASCII so that I can get
stuff out is to base64 encode it yeah
right now before going down that rabbit
hole though I do want to actually proof
a concept this thing which means it's
really easiest to just hop on my Linux
boxes so if we take a look here for
instance I've got a couple of files and
and really I just want to take a moment
to go ahead and figure out you know how
feasible is this to get a good amount of
data in a short amount of time
okay so with just Opik so what I've
chosen to do here is take this kirby jpg
file and basically I mean I could just
cat you know that file but no pun
intended but I'm just going to get a
bunch of binary data so instead of
actually gonna do it base64 curvey JPEG
and
there you go right so that's easy enough
yeah I get this big blob and well you
know really what I want to do though is
this is this is too much data I want to
be able to iterate through it line by
line thankfully that's easy enough by
just passing all of that here we go
increase this a little bit as well if I
just pipe that over to while Reed and
then I don't know pick a letter R and
then what we'll do is do echo dollar
sign R and then done okay that looked
cool although I gotta say it's it's
pretty dumb it's like the worst use of a
while read ever that I pretty much ever
seen basically you're you're literally
just reading each line of the file and
then you spit it back out and then at
that font size there's gonna be a few
problems first off you won't be able to
read it all on your phone and then two
reconstructing that I mean even with OCR
if you're using OCR it's going to be
kind of impossible yeah and I mean yes
you're right but what I'm seeing some
issues though yeah I'm building on it
okay so what that read command thing is
doing actually we take a look at that
command again and I'll just make it up
here is we're saying okay for every line
in the file read that line store that
flight line in the letter R then we can
do stuff with it so what are we gonna do
well in this case I'm just echoing it
back out to the terminal okay so it's
you know no different than just running
this it's cept it's slightly slower what
it means though is I can now do more
interesting stuff with it so instead of
just encoding it in basic stibor I'm
gonna take that line and I'm gonna pipe
it over and make a QR code ascii with it
so for that I'm gonna use QR in code
with tack T and C and what that'll do is
it'll make an like right there and
determine allanne ansi representation of
what I'm creating here and all right so
let's go ahead and see an example you
want to go ahead and record this sure
all right
no maybe you guys can see it at home as
well aha that is Oh a lot of goings
really fast yeah
okay how long do I have to stand here it
might be a while okay I'm just gonna
stop recording okay so yeah it works
clearly clearly absolutely okay yeah
this is actually the part where the
rubber meets the road and what's
important about developing any payload
you see Mike Kirby JPEG file is exactly
one megabyte because I want to be able
to get a baseline of how long it takes
and to be honest our little secret it's
not actually a JPEG of Kirby you can do
the exact same thing to create a one
megabyte file with DD I F equals slash
dev slash you random and then your o F
equals you know whatever you want so
like test file dot txt and then if you
say BS equals 1024 and count equals 1024
what you're gonna get
whoops not 2014 anyway okay in this case
I got almost two megabytes because I
didn't it would have been 48 right
booyah and now I've got a 2 Meg file you
get the idea okay just a little tip for
you there actually here's the fun thing
about this I can find out how many lines
of this is now cuz we're gonna find out
all the things that are wrong with this
so if I base64 kirby jpg and pipe that
to WC for word count Tech L for their
lines I'll see it has oh wow yeah
eighteen thousand three hundred
ninety-seven lines and basically I can
actually time this how long it's going
to take to QR codify all of this with
the aptly-named
time command and then it'll look
something like this if I do control a
back to the front and do time space that
and then we just sit here and wait
forever
if I make this font bigger you can see
here that the real time was about a
minute and 38 seconds
so yeah proof of concept I would say
that doesn't even account for the fact
that the final payload actually needs to
bring its own cure generating script
most likely in PowerShell I feel like
this would end up being a really awkward
scenario with the penetration tester and
like a security person coming by and
being like why are you standing there
recording on your phone that's that's
probably release for the concerns here
because there's another problem that I
was watching the video on my phone which
does about 30 FPS I can go up to 60 FPS
but that takes up a lot of memories so I
just record in 30 but for a lot of
smartphones out there you can only get a
video like recording at 30 FPS so if you
look at the playback it's gonna be
horrible
like smear it all together and
everything so you're going to miss some
of those QR codes you're never going to
be able to systematically extract all of
those frames and then reassemble the
data in fact you don't even have all the
data so even assuming the best-case
scenario of 30 FPS yeah maybe even 60
which does not account for any rolling
shutter or artifacting those 18,000 397
QR codes would require 614 seconds just
a transmitted right if we were
transmitting 30 of them every second
rather than this which is as fast as the
video that's like oh that's about 10
minutes or so yeah 10 minutes for a
megabyte and actually to be honest
that's optimistic at best you figures it
working so well I figured with a good
margin you know it would actually take a
little bit more like 30 minutes to get
get a megabyte out of there which and
you know interestingly yeah there's the
conversation with the security guard is
gonna be interesting to say the least
but to put this into perspective 30
megabytes for one minute is for one
megabyte yeah sorry 30 minutes for one
megabyte 550 something bytes that's a
little over 4,000 baud okay which is far
less than the 9600 baud requirement of
the 1993 into title doom it's a
different kind of fps okay so what we
have learned today is going any
into any kind of good payload idea it's
really important to outline its
requirements so in our case it was to
develop a technique of recording the
screen as a means for arbitrary data
exfiltration without any kind of
privilege escalation so you kind of got
there number two is before building out
the payload the proof of concept you
should proof a concept it with some kind
of off the shelf shelf tools to
determine if it has any kind of
viability so in our case not it's cool
so ever I guess but totally impractical
practical for anything bigger than like
a few kilobytes and even then you've got
a fro it's not like the script that to
generate the QR code and that's gonna
any I don't know then we have number
three so binary data is going to be
easier on the eyes when base64 encoded
but on Linux it's just a matter of using
the base64 command which is cool yeah
however on Windows there's a PowerShell
command that yeah it's this little
longer so quick and easy test you should
do and then there's number four you can
create quick and easy test files of any
size in Linux using DD with a source of
slash slash you random you can even use
zero but all you're gonna get her cool
zeros and then number five QR n code for
Linux that's very handy tool for making
QR codes on the command line and ASCII
or ANSI and it will even do PNG ApS or
SVG if you are looking for bitmap or
vector art as opposed to just like a jpg
I love this tool yeah that is a very
very cool tool it's good for like air
gapped key exchange and you did that
once using like PGP keys and two
machines that were air gap yeah but it's
you know good times yeah not good for a
lot of data there is one more thing and
number six for me at least the time
command does exactly what it says on the
tin so if you want to use time you
totally can't it works just like you
would think it does so there's some good
parts and then there's some pretty big
negatives you can time time and it took
no time to time the time man-woman and
it took it took 0.078 seconds to tell me
that there was new
you will enter a for a woman it's true
number seven though I would say is that
if you're gonna go back to 1993 and play
a doom deathmatch you're gonna need at
least a 9600 baud modem but really to
completely pone you want a twenty eight
eight oh my god saying I was such a baby
at that point like did you not start
death matching until like quick three
Unreal Tournament no it was before that
1999 we should have a you teen any any
much yeah either that a quake one of
those it wasn't doom though it wasn't
doing her good I was busy with like some
other goosebumps goddamn
horley and Wow you know me I was just an
HP B anyway I'm gonna be the first one
to admit that this payload went wrong
from the start as it often does because
you know what I did I fell into the
traps of start coding first which is
what my first and reaction is when I've
got a great idea I want to start writing
code and I went down the rabbit hole of
you know finding all the cool PowerShell
module is to build QR codes so I'll link
those in the show notes because there's
cool stuff you can do with them it was
only until I got deep into it that I
realized hey how practical is this
really so I just wanted to demonstrate
that sometimes doing a rubber meets the
road test is ideal it's very important
to go through the entire testing
procedure before you get on to your
penetration test yes your location
that's your stuff before you tape this
is very important so what do you think
does this technique lend itself to other
information-gathering payloads if you
have a payload that you would like us to
feature head over to hak5 org slash
payload and drop us a line we would love
to check them out feedback at hak5 or
leave a comment below let us know maybe
you have a better idea for a way to do
this better times better times better
times time better
nope I have to I have to get installed
better what is this before we leave
of course we always like to show off
stickers from the community there's a
lot of really cool hackers out there
that like to share stickers with us for
our sticker walls so this week I have
two that were sent to us one is from
Jason over at skinny
research-and-development who sent us a
couple of his own logo stickers like it
very cool yeah cool research and
development R&amp;amp;D stuff over at skinny so
definitely check him out he's over at
ERD calm if you want to check out what
he does and we also got a little message
from Toombs DK who said just some
stickers just some stickers for the wall
thanks for the great videos and they say
they're so cute they're little three in
a movement no there are five minute
quarters 600 makes cyber grade again
listen before this was a cyber industry
that meant something totally different
on IRC oh yeah thank you for this that's
definitely going on the wall talking
about it yeah showing your age man what
rights
well what's weird about it is because
the industry mode moves so quickly it
does seem like like archaic it seems
almost like ganya like archeology to dig
up a twenty eight eight even hey as long
as we were putting stickers up on the
wall I just got back from South Africa
and I figure you know if our buddy Casey
is gonna go ahead and rock a Wi-Fi
pineapple sticker in the back of his set
we'll rock a I heart camps Bay which is
pretty cool very cool so just pop that
guy over there if you want to send
stickers as well you can just check out
hak5 org slash address for the address
to send them to and that'll always find
the best place wherever we may be yes I
can't wait to find out where we're next
sheesh okay in the meantime I'm Darren
kitchen I'm Shannon Morse
trust your techno list domain.com has
all your website needs from command
dotnet domains to intuitive website
builders so you can take that first step
in creating an online identity let me
tell you there's no domain extension
like a.com or.net or if you want to
brand yourself domain com has over 300
domain extensions like Doc Club and dot
space these guys are huge fans of hack 5
they're affordable reliable we've been
using them for years they've got all the
tools you need to share your ideas with
the world and because they're such big
fans they are hooking you up with 15%
off their already affordable prices
so get domain names and web hosting and
email and just be sure to use that
coupon code hak5 so when you think
domain names think domain.com
I kind of like full sky better I don't
know Paul's be yeah it's like this point
and then there's the Atlantic and then
and then the Indian Ocean is there and
then they're all like mixing there's not
a dotted line there is one on the map
but like in real life like you go to the
point it's not there I don't know where
your mind is right now southern Africa
Oh dotted line I get it okay yeah I was
thinking about like physical geography
like a real world I was told that they
paint them every morning but they wash
away have you ever been over the states
like going from California the grids and
very cool yeah cuz the one-mile grids
from the no no no there is a grid
because the way there no not about the
country you know there's no dotted lines
but the country is parceled out there's
a Wendover production video that
explains all this that is fantastic to
be able to subscribe go every - yeah</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>