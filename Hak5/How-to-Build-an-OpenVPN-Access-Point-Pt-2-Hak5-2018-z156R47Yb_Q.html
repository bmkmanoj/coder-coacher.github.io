<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Build an OpenVPN Access Point Pt 2 - Hak5 2018 | Coder Coacher - Coaching Coders</title><meta content="How to Build an OpenVPN Access Point Pt 2 - Hak5 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Build an OpenVPN Access Point Pt 2 - Hak5 2018</b></h2><h5 class="post__date">2016-06-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/z156R47Yb_Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">part 2 of our Open VPN access point bill
this time on hack 5 hello welcome to
hack 5 my name is darren kitchen hola my
name is Shannon Morse it's your weekly
dose of tech deluxe welcome everyone
today's show why are you excited because
I'm sticking it to the man and running
all of my traffic through a VPN that's
right none of their business so if you
didn't watch last week's episode yet you
should probably watch it we have been
building a VPN Wi-Fi hotspot using open
wrt and open VPN so with this setup all
the traffic from clients connected to
our Wi-Fi access point are going to go
through our secure open VPN tunnel so
last week we set up the open VPN access
server and we set up a few user accounts
- including me there we go snobs so
today we are going to work on the access
point side of things an open wrt by
setting up the open VPN client
configuring that IP routing and then
testing the connection with Wi-Fi
devices I'm assuming that will use my
laptop to test that Wi-Fi device you can
be a Wi-Fi device Shannon so what does
this require so basically this will work
on any modern day open wrt base to
device I have to be using a pineapple
because it is my home Wi-Fi access point
and because we have lots of pineapples
around egret don't figure that's true so
I'm actually as a penetration tester if
you're looking at this on that side of
things this could be useful as well if
you want to gather data in the cloud Oh
smart think about that for a moment so
to just go ahead and briefly get up to
speed here is what we've done so far I
have added an additional account just
like last time in the open VPN access
server in addition to snobs
we now have pineapple very much the same
thing and so the next step is to just
grab that user profile for that
pineapple account and you'll notice that
I have that auto log-in check box
enabled yeah very important that means
we're gonna be able to get a single file
that has all the certificates in it so
in order to log in so that was just like
that text file I got last week exactly
like that text file okay so we're going
to go to the non
slash admin and I'm gonna go ahead and
login as pineapple and here's the thing
you want to make sure that you choose
login and not connect
if you connect it's gonna try to detect
your operating system and do weird stuff
you want to just hit login so you'll get
this page and then down here at the very
bottom you want to download the the
profile for your Open VPN connection and
I want to use the auto log-in version
not the user locked one which requires
that password oh that's the difference
okay that is so this one contains all
the certificates and everything else you
might you know need to get that
connection automatically without any
user intervention I'll just throw that
in my downloads folder so with that all
I need to do is now start setting up my
Wi-Fi pineapple so let me just head over
to my Wi-Fi pineapple it's already
plugged into my computer and actually
it's like recently updated so I need to
go ahead and go through the proxy I know
right so unless you gotta press the
button on the bottom to go ahead and
verify okay that this is your pineapple
and I'll just set up a password really
bad one and call this Luigi because I
use Mario characters as my test
pineapples I have a peach yet I do not
have a peach let's see I have a Mario
Luigi and a toad
you don't have a Yoshi really don't have
a Yoshi or no Yoshi and nope I need
three development about Daisy I'll save
that for my next tetra setup okay there
you go all right
and then alright and they accept all
that and complete the setup cool all
right so I know what I've done and I
have done this a few times in fact yes
so there we go our Wi-Fi pineapples set
up I'm logged in and actually all of
this is going to happen under the hood I
don't necessarily need to do too much
here in the web UI I will set up
networking I'm going to go ahead and
keep this connected to the the Wi-Fi
here at the office so so that my Wi-Fi
pineapple is online so this is just
using its second radio I was using a USB
dongle oh I've been using the third
radio and this is just a quick and easy
way of getting this Wi-Fi pineapple
to the internet so that when our clients
then connect it has a way to get out to
the internet so it would be like from
say my Kindle or my phone or whatever
have you device to my Wi-Fi pineapple
from my Wi-Fi pineapple to whatever it's
internet connection sources and in this
case I'm using Wi-Fi at home I tether it
with an old phone
oh yeah modem yeah because hooray for
unlimited LTE yeah okay so I can go
ahead and actually test this connection
by hitting load bulletins from the
dashboard and make sure that it's on the
Internet yes it is yeah so with that
it's now just a matter of getting this
open VPN client file over to the
pineapple I'm doing a whole lot of this
in Windows which means I'm not I mean
everything is clicky booty right now
yeah
172 16 42 one I'm using this tool winscp
here other than the SCP command that I
would be using in Linux and this is
pretty cool this allows me to very
easily transfer those files and I'm
going to go ahead and update this I use
lots of pineapples so I'm constantly
updating those and let me get over to my
downloads directory and all you do is
just a very basic File Explorer I'm just
going to copy the client to VPN file
over to my pineapple and there we go now
it's in slash root on my Wi-Fi pineapple
which means if I pull up putty and SSH
into my Wi-Fi pineapple one seven two
sixteen forty to one and yes log in as
root okay so I'm on my Wi-Fi pineapple
now in fact let me see if I can make
this a little bit easier to see there we
go much better
so what I'll need to first do is I'll
just do an LS and you can see there we
go I've got my clients file I need to go
ahead and do an opkg update and so what
that's going to do is download all the
latest from the repository and update
the database so that the Wi-Fi pineapple
knows what packages are available to it
it's very similar to apt-get install and
yes to things like that or yum or any of
those other repositories on open V are
an open wrt it
would be opkg cool so in this case I'm
just going to do opkg update and this
will apply for any open wrt based device
not just the Wi-Fi pineapple so it's
updating its updating so it grabs its
list there we go I'm all set
the next part here is to just go ahead
and install Open VPN there's a couple of
variations I want the Open VPN open SSL
variant which will allow us to do that
TLS VPN yay lots of acronyms here I know
what if we did not just watch them just
watched active we've gone over all of
these if only there were characters that
would help us get through these acronyms
anyway uh with that said let's go ahead
and now install Open VPN - open SSL so
this package right here is my OH Open
VPN it's actually either server or
client it doesn't really care it'll use
whatever config file you throw at it
alright and so the next thing is I want
to before I go ahead and dial in as it
work I want to run route and show you
something so my default gateway is 10.7
3.3 1.1 that's our network here at the
office so if I were to you know paying
like whatever have you those packets are
going out through this gateway yeah okay
what's gonna happen after I dial in and
I'll go ahead and run Open VPN with just
in fact I think all I have to do is
specify a file here if I Wow
I almost did that if hi - Open VPN with
that client uh-oh VPN file remember this
is that file that has all those
certificates so I'm not prompted for
anything which is great because now we
can automate this to do this on boot
every single time oh cool an
initialization sequence complete okay
well what does that mean here let me go
ahead and create a new it means you're
going through the VPN now right yes it
does and so let's take a look at how
that looks I mentioned how annoying
Windows is so now in a new putty session
I'm gonna run route again and you'll
notice that I now have a default route
through this 172 address well what is
that
the interface is ton zero so I can see
that here if config and I have a ton
zero now and this is a this is the
actual the actual like interface for our
VPN so this means that now when I go to
use the Internet I will be going through
zero one zero and cool okay yes good now
the Wi-Fi pineapple itself is a client
interface so it has an interface that is
connected to that server in the cloud
yeah right and when it goes to fetch
things online it's going through that ah
that's awesome it's one more step yeah
how do we set up clients to go through
it exactly so now we need to set it up
so that when you connect my Wi-Fi
pineapple you as a client also go
through that tons ear just automatically
automatically okay and so to do that all
we need to do is actually I have a
little cheat sheet here this is the IP
tables foo let me just in fact I'm gonna
put this into a script yeah I'm gonna
nano move my bits SH cuz we need to get
those bits moving alright and so I'm
just gonna save that out and and
basically what this is going to do is
tells everything that's connected to our
Wi-Fi pineapple at this network here to
go out through ton zero okay right
rather than going out through WLAN one
gotcha
so that's saved I'm gonna make it
executable and I'm just gonna run that
alright so all of those things could
have been easily automated in fact I may
just you know for my Wi-Fi pineapple at
home I'm gonna just put this in you know
my script I'm gonna make this a script
that's going to run on boot of course it
will always dial into that VPN and set
it's set that ton zero interface as the
default gateway so now if I connect to
Luigi the Wi-Fi pineapples and I'm gonna
be automatically going through that VPN
there we go so we're gonna do that in
just a moment and
some fun little tips as far as checking
IP addresses cool as soon as we get back
using a VPN is always a great idea and
if you have a great idea and want to get
it on the internet do it Shannon and I
do head over to domain.com
they have an epic domain discovery
system that I'll help you find the right
domain and their checkout process is
super simple which means you'll be up
and online in no time flat and get this
the guys over at domain.com huge fans of
hack 5 they want to hook you up with 20%
off all you have to do is use the coupon
code hak5 that spells hack 5 at checkout
and save yourself a bundle and you know
what go ahead and tweet them tweet at
domain.com and say hey thanks for
supporting hack 5 all these years when
you think domain names think domain.com
we are now back in it's time to get our
clients connected to the Wi-Fi pineapple
through the VPN oh yes writing so why
don't you go ahead and first check your
IP address to show the before and after
because right now you're connected to
just the the Wi-Fi here at the office
yep and my IP address ends in 2.1 5/8
fantastic ok so now I need to connect to
the Wi-Fi pineapple crap oh do you know
yeah exactly now this is here's the
beauty of this this is something super
simple grandma knows how to connect to a
Wi-Fi access point she didn't know how
to set up an open VPN client but if you
just say hey connect to this Wi-Fi
access point and everything will be ok
yeah so luckily all I have to do is go
over to the Wi-Fi access points that are
available and I connect to Luigi because
that's the name of it and put in the W
ap or WPA okay so we've got connected to
Luigi so I'm gonna open a new tab and go
to IP chicken ok so now instead of being
2.15 8 i'm 0.24 7 we're going through
the VPN and all you had to do was
connect Wi-Fi access point how easy is
that that's awesome I know right it's
nice to not have to configure everything
for once in fact I have done the same
thing here on my phone and voila now
anything connected to it right so ok
that's the nice thing because you're
probably not going to find like a VPN
client for your e-book reader or I mean
as everything becomes you know
ubiquitous with Wi-Fi I think you
generally need an app too for like
phones and smartphones and stuff like
that unless you're using something
customized like the pineapple right in
fact the same concept would be applied
if we're instead of using a VPN we could
use a socks proxy oh yeah so that would
be a fun one to follow up on because you
know it uses socks proxies
tor tor so you could set up a wireless
access point as a tor gateway oh yeah
lots of cool opportunities here lots of
fun things especially now that you
consider your Wi-Fi pineapples deployed
we're not using pine ap or any of the
tools we're just using it as you know
regular Wi-Fi access point here what if
you were and you wanted the traffic to
go elsewhere now you have an endpoint
where interesting things can be done now
that wraps up this episode I believe I
see where one mini series MVP ends that
was really cool yeah it was a lot easier
to set up than I thought it would be
makes a fun travel router it totally
does I really missing that bash RC so it
always happens do you have a story about
these stickers oh oh right we've been
playing with 360 photography yes we have
the in the previous weeks and I was
using the theta which is a really fun
camera however we have some friends that
do 360 videography and have built much
bigger and cooler cameras like the one
at Facebook so this is the giant Tim
right or any of you guys saw this at
Facebook like like 6,000 or $16,000 it's
insane it's a very complicated and
awesome camera and they're open sourcing
all this stuff for everyone to enjoy so
how fantastic is that that's nice so
yeah we got some stickers from them and
I'm going to go ahead and hear one get
that one peeled while I work on oh good
this one is easy lucky this one I like
but luckily have nails that's one right
over there oh yeah that looks pretty
good
tada indeed yeah all right the wall is
coming along it is that's awesome and
you guys can always send us stickers the
address will be down there yes indeed
all right hey with all of that thank you
so much for supporting hack 5 really
appreciate all the likes subscribes and
all of the other things you
the social stuff or if you want to
support us directly and you have need
for a Wi-Fi pineapple of your own you
can find those at hae shop calm that's
what we do to make this whole warehouse
happen and don't forget we are having
another pen test with hack five it's
coming up in September September 16th
through 18th I believe and you can find
out all the information about that at
pen test with hack five.com super super
excited seats usually sell out early so
make sure to get on it if you are
interested in participating it is a lot
of fun yeah definitely I love the
challenges we have some updated
challenges time around yeah we're
working with myself as well as Sebastian
from the wife of pineapple and Moo bik's
from Metasploit minute so great I don't
know why evil servers there hey you know
join us and find out it's always a good
time we'll be there with all of that
said my name is darren kitchen my name
is shannon moore Esther Technol US tea</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>