<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hak5 - Hacking out of Application White Lists - Shaffer and Cuevas report, Hak5 1025.1 | Coder Coacher - Coaching Coders</title><meta content="Hak5 - Hacking out of Application White Lists - Shaffer and Cuevas report, Hak5 1025.1 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Hak5 - Hacking out of Application White Lists - Shaffer and Cuevas report, Hak5 1025.1</b></h2><h5 class="post__date">2012-02-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9zWGLiGaNow" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this time on the show breaking out of
the sandbox Shaffer and cuevas share the
research on bypassing application
whitelists plus what does it take to put
on an ipv6 network at a hacker con Brett
Thorson of shmoo labs explains and
finally it wouldn't be a hacker con
without Johnny long in the latest from
hackers for charity all that and more on
this pack 5 special from shmoocon 2012
this segment of hak5 is brought to you
by domain.com hello welcome to hack five
my name is darren kitchen I'm Shannon
Morse your weekly dose technol us
bazinga I don't get it don't worry about
it I want to protect I want to profess
my undying love to IP tables or tables
or however you want to say it because
there's something something that just
makes me so excited when I see that tack
NAT tech a post routing tak your subnet
and the tacho the interface and j
masquerade and everything gets happy
again i think i lost you when you said
I've been doing a lot of development
work Oh does this have to do yeah and
it's all working and the blinks the
lights blink you turn it on the lights
blink everything's happy and it's
because of iptables know where are we
hearing next week this is actually the
last episode of the 10th season so I've
got to make a big deal about it even
though dart NC next we'll be back next
week and then next week we get to make a
big deal back oh it's the first step so
even though we've got the new set
already we got it earlier then wrap the
news so I thin your self like we need to
touch something back there Paul make it
right now here yeah make it happier that
do the thing give us a wee look yeah
yeah oh you need it's a family show I
want to see like a shadow box back here
with a lot of cool stuff that we've got
from fans hmm I thought that would be
really we could actually put an entire
trinket wall up we could it would be a
Museum of retro computer part
or cycling and some let's see what you
cycling like no let's play the was the
game that we call it it's in the box
yeah all right what do i get actually
yeah let's play so um you're gonna open
this one all right because I'm pretty
sure it's a gift for me ah wait it's a
gift from you you said war me oh boy
yeah it's from the Netherlands it is
from do want to say do it better agents
from Shannon's nether regions comes
what's wrong hey I think it's from evan
is this a decoder ring oh yeah I know
what this is gimme here no that's not
the part I went that's not the part I
want the car is it part of white there
it is that's the part I want this is so
cool I know what this is I saw these tom
has then Oh jobs tog then hmm have fun
with it love ya fool thank you yep
uh-huh ciao uh you just chose Todd me
yeah it says ciao you just have me trash
ciao is um chub me hello and goodbye and
Italian I believe haha thank you this is
awesome Elise our estimates a tag them
all snubs have fun with it love gefle
yeah I get it now I'm slow today
actually if you want to put me in bash
then like I'm in my heavy place and then
we can all talk about persistent no
fails with 46 800 no off default routes
what yeah user s bit or you srs been
another one of those talks that a
mistext me calm no no no maybe i'll get
to talk on it would that be real
actually i'm giving a talk on it at
South by Southwest are you officially
yeah yeah I'm on the 10th the 10th March
10th I'll be there South by Southwest
will BBQ oh that's gonna be cool yes
excited to feel we have awesome stuff
here from shmoocon this is our part two
of our MOOC on conference that we go to
every year and have an awesome blast at
and we're sorry if we didn't see that
but we will see you at talk on defcon
der beek on got a con
con yummy con enemy expo not that one
anyway we're right now gonna tease you
about how shmoocon labs and Johnny long
are coming up at the end of the show but
right now we're going to throw it over
to shave and cuevas to talk about
application whitelisting Katya so what
was wrong with traditional antivirus is
where we're just like oh this is bad
stop it I like to think about it like
this the spam thing that was going on so
when you're thinking about spam before
we were running these black lists and
they were just getting unruly right so
they're getting so big because you're
just jumping servers changing system is
changing email just exchanging domains
so people started doing white listing
with email just saying you know I only
want these people to be able to send me
the messages I think it's the same thing
with the executables we're just chasing
our tails we can change payloads on the
fly polymorphic stuff you know with msf
encode or whatever you want to do so
that's not going to work there has to be
something better so white listings gonna
be the only way so is this like a trend
for the the industry's this is this
direction that we're going to see more
and more with AV vendors I definitely
think it's gonna be the trend with the
industry I think it is the right
direction the the antivirus just isn't
working it's good for detecting things
almost after the fact this is a more
proactive approach i feel so i do think
it is the future again
it's the marketing guys kind of selling
it more as the Silver Bullet so there's
a couple of different vendors out here
with a couple of different sweets for
application whitelisting what does that
mean for the end-user what does it mean
for the administrator on the actual
client with the application whitelisting
the pieces of software will set up a
white list of hey these are the ten
things you can execute by default a lot
of these you have options you can just
say hey these are the executables you
can do by check some of the executables
if you really really want to get into it
in a more in depth level you can approve
certain paths where you can run
applications from so we can run anything
in system32 yeah exactly exactly they
tend not to do that app Locker was the
only one that they thought the path
thing was really yeah the great way to
go uh yeah no yeah but then you can also
do it by sign software and you can
approve certain digitally signed
software like hey if it's from Microsoft
let it run okay so for the end user and
from the management perspective you set
up a client on a desktop machine or well
any machine actually yeah and then those
will only be the applications you can
run so what's wrong with that model and
it sounds pretty good if I can just say
okay the only thing I want execute on my
machine is explored I'd exe chrome X
chat to you know the other four programs
i use the thing is is that because you
need those programs there's an inherent
trust so for example the browser you
know we can use javascript to execute
things on local systems so and then
you're gonna need to browser you're
gonna have to use these things another
thing that we found like Microsoft
Office applications for example you know
using VBA that's already built in
functionality of Microsoft Word oh my
god are we going down the path of a
Microsoft macro virus earth they could
be but yeah but yeah they totally see
what you mean because it has that
functionality in it and if you trust
word then you trust anything that words
going to execute absolutely and like
Chris did a lot of work on the
PowerShell stuff you know admins are
going to use PowerShell more and more to
manage these systems so it's gonna be
there was going to be an inherent trust
for text okay so what is it exactly
about the industry that annoyed you with
this that made you want to target
application whitelisting marketing plain
and simple they're selling this is a
silver bullet and it's just like back
when Oracle said hey we're unbreakable
and then they said oh well here's 20 0
days on you like ya know nothing's
unbreakable you should never advertise
it like that you should just say this is
the best solution this is just another
good layer for your arsenal yes I again
do you think we a direction that we
should be going yes I I do believe this
is the right direction our talk our goal
was not to just shit on the vendors what
vendors are we talking about here uh
there were three vendors that we have to
look at and this was really just due to
time constraints and these were the
things that we could get access to so we
looked at a bit nines parodies bit9
Microsoft AppLocker and McAfee
application control and what did you
find what were the the weaknesses of
those and start with I don't know what
was your favorite my favorite ended up
being bit9 just because I was the inner
defensive rule when I started looking at
it but I also had an offensive twist so
you know the vendors are coming in
saying these this is the silver bullet
to fix the problems that you're dealing
with and I just said there's no silly
it's got to make me try so that's one of
the ones that we wanted I wanted to look
at personally I also wanted to look at
microsoft's because it's built in i
think a lot of people are gonna use it
because it's free there's no dish yep
cost on top of what you already
purchased and I think mcafee is a good
choice because a lot of governments use
it and a lot of companies use it and
just because of the EPO model that they
have the ability to just tied in with
the rest of their pieces so those that's
why we chose those so where were the
vulnerabilities I'll start with the
vulnerability that I found actually was
uh the the biggest one was in bit9
parity service so when it notifies you
that is blocking something it starts
something called notifier dot exe pop
that's just like the devil just that's
how about box it says you can't do what
you just tried to do alright so when
that came up I realized well I had
already been trying to inject into the
parody service so you're just trying to
put your code at the end of some other
code and make some shit happen yeah yeah
so I was just fuzzing around like that
and ice
well what's this notifier dot exe let me
try that and when I tried it bingo I was
able to execute a meterpreter shell back
through their service and it had an
inherent trust of parity which is the
highest trust number so out of all of
the things that it whitelists the only
thing it doesn't check is itself that's
true and the funny thing is is that one
you know I was doing research about i
think it was in november of 2010
somebody found the same vulnerability
with the same product but only they were
able to inject into the parity dot exe
service so they've already fixed this
issue once um it's just what the old is
new again Wow came back again that's
that's a real bummer i'm sure those
vendors aren't too pleased but you know
this is how we get to a more secure
state so you know again thank you for
this research because it just makes
computing more skier as a whole or the
other vendors like a plonker is actually
a complete disaster that's the microsoft
that's the microsomal I need to hear
that because normally their software is
really good and you know it not today on
Microsoft their their products over the
years they've really started to take
security seriously give this yeah well
you're right the latest batch is so much
better than NT 4 ya know they're killing
me you're saying you know yes
historically the last 20 years it's
gotten better it's gotten and that's
something and that's something uh but
obviously the programmers were smoking
crack one day and said you know what we
should include this cool function called
loadlibrary exact and we'll give it this
argument you can pass that says we'll
just ignore the code authorization level
and so if there's SRP take that down for
me how does that work what is that it's
a PowerShell I was action long this
woman was in AppLocker originally was I
believe DDA Stephens did a bunch of
research on this he was able to inject
shellcode into VB as a macro within an
office document and then he discovered
this function its built-in basically and
there were actually two different
arguments there's like a sandbox
argument and then it ignore the
authorization code level and it says
right in Microsoft's documentation this
will bypass app Locker software
restriction policies and group policy
how long like those installers that tell
you to turn off your antivirus before
you install yeah brilliant uh and
Microsoft has released a hotfix for this
not a patch so you have to know to go
and get this okay but you know that that
will lead to a patch it will get make
thank you better soft good good yeah
well hey you know it serves it really
pays to read that documentation because
sometimes they spell it out right there
in the spec you know here's the whole
hackers this way so what was the other
vendor the mcafee product right the map
mcafee product the application control
yeah or solidify ER i believe is what a
call uh down was interesting uh uh uh
because we turned on the memory
protection in that one and we're still
able to dump shellcode the other words
don't care about memory at all no bit9
parody does memory protection as well we
did not have a carbon aversion to yeah I
like heard speed the power bit9 does
have memory protection the version we
tested was 600 we couldn't get I think
the latest that's out is 602 which
totally has full memory protection
capabilities so does that mean that the
notifier exe thing wouldn't work no that
doesn't I mean that is that was a patch
that we released on or a workaround for
it shows that you can turn on memory
protection for notifier dot exe but the
version that we ran was 600 which memory
protection isn't supported but it's
there gotcha so you can turn it on it's
just not in the interface you just have
to call the PHP directly but i think we
had trouble with the vendor they
wouldn't give us a trial after i left my
place where I was at um they basically
at that point didn't want to help so
they said that they wouldn't give us a
30 day trial but they offered to fly me
to Boston to show them the problem and I
said I don't know how that's cheaper
than a 30 day trial so we didn't have we
weren't able to taste test the latest
greatest version but I can tell you from
when I was where I was using the latest
version that was out at that time this
is all the stuffs the same it's alright
cool so what kind of vectors did you
guys
used to demonstrate these sorts of
attacks I mean I guess at the end and
also to that what is the end goal in
this just like executing your you know
interpreter payload or what my angle I'm
pentester I want shell yeah I get an
interpreter shell life is good i've won
hmmm uh we came up with a number of
vectors basically we got it down to if I
can call command exe and power shells on
the machine which by default on windows
7 2008 it's there I could pop
meterpreter shell uh so everything from
windows help files to Firefox extensions
to the lovely hak5 USB rubber ducky
which i think is what i use for my demo
awesome and the demo gods smiled all
three went off loves thank you nice I'm
glad that they they were there happy
with you your work um and so how do you
go about that like you say PowerShell
like like you just it don't they just
like you know not whitelist PowerShell
actually by default most of these
software restrictions don't allow you to
execute powershell scripts there's a
couple interesting things with in
PowerShell you can do get content of
PowerShell script and pipe that into
powershell and it executes a line by
line so yeah you can't execute the
script but you can okay then the other
thing that we found that was interesting
and again other people smarter than I
figured this out I was just able to
leverage this was that power shell is
tied into dotnet framework you can
import a function from a running dll and
you have access to open a page and
memory as read write execute pump
shellcode in and spun off so if you can
just add it to an existing dll that's
already whitelisted then you know Bob's
your uncle yeah like kernel32 all right
that's a good one nice well this is
fascinating where can people find your
research and start mucking with this
more
I'm going to try and follow up with a
blog post a couple reports to write but
as soon as I finished that there will be
links to that on the secure ideas
website the secure ideas blog so if you
go to secure ideas net I you'll find
links to all that and as soon as I can
publish the material I will and the same
thing I got some things going on but
foreground security com you go there we
have a link to our blog right there I'll
put a blog post up I think I wanted to
add a lot more detail of the things we
tried that didn't work yeah we kind of
wanted to focus on what did work here
and then later we want to let people
know like what we went through cuz we
tried a lot of different things so we
want to make sure that everybody's aware
of everything cool well thanks so much
guys I really appreciate it it doesn't
matter whether you're in the shower
hanging out with friends or showering
with your friends when a killer idea
hits you you need to snag your domain
fast and with domain.com simple search
and checkout process you're gonna have
that domain in like no time plus when
you're ready to take the next step
domain com has rock-solid hosting
infrastructure to create a perfect
foundation for your project and get this
the guys ever domain com they're huge
hak5 fans they want to hook you up so
they've got a coupon code just for us
it's hak5 a check out get to fifteen
percent off so when you think domains
think domain.com</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>