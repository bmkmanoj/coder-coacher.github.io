<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The USB Switchblade - a toolkit for silently auto-pwning | Coder Coacher - Coaching Coders</title><meta content="The USB Switchblade - a toolkit for silently auto-pwning - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The USB Switchblade - a toolkit for silently auto-pwning</b></h2><h5 class="post__date">2008-07-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PsgH8NbHTy8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so as everybody knows if you have
physical access to a network security
all bets off yeah assumably sure I'm
making the most part yeah but now what
happens if your physical access is
limited to only a few seconds Darren's
found a neat little software thing that
you can use on this to take care of what
you need to do Darren what is this well
this is a USB thumb drive or as I'm
going to call it it you know the
switchblade just because it's got this
sweet little slider right you know the
cruiser it's pretty cool and I got to
say that this was originally developed
by some community members on our forms
and they've done a really awesome job
putting together some interesting tools
to compromise systems when you have
physical access
okay now this USB thumb drive is just a
little bit different than the normal
ones that you may already have and that
was what what what is that difference
would it uses a piece of technology
called u3 technology again what that
basically does it puts a separate
partition on this on this little USB key
here that looks to windows like a cd-rom
which means it will auto run because
question with that question because
normally when you plug in a removable
hard drive or a USB key it a little
pop-ups it says hey what do you want to
do you play music or photos or open the
folder this is just like popping in a CD
like you know you pop in your
battlefield 2 CD and it pops up the
installation right okay so it's gonna
auto run what what's it uh what's a
daughter running what where where's this
attack come in okay it auto runs a
special payload now when you normally
buy these from the store they come with
some software from SanDisk
that this particular one has Skype on it
and a few other little applications so
when you pop it in you can run you know
your little applications right off the
drive just like we've talked about
before when Rob or Moo bik's came down
on episode 9 or 10 to talk about little
applications for USB thumb drives right
and
what we want to do is flash the you know
firmware or the little what would you
say see any Rompin cd-rom partition
sorry I'm a little loopy still but you
would flesh the cd-rom partition with
our own payload and that would then run
some scripts and some tools that are on
the flash partition of this and allow us
to get our black hat on so what happens
if you plug it into a Windows machine
well it will work on Windows 2000 and
above machines and the limitation on
that is that it needs to be a machine
that's logged in with administrative
privileges okay so it's definitely a
windows-based attack and you have to
have administrative privileges to get
anything done right and you may run into
some problems when it comes to
educational networks and corporate
networks with machines that are not when
I logged in by default as administrators
in our case you know I run as admin on
Windows I do as well and you know it's
very populous it's different with
Windows and UNIX because in UNIX
moonrunners root oh no you can't get
anything done in Windows unless your
administrator so a lot of times this
will come in handy and there are some
ways to escalate privileges to
administrative status we don't have a
way to that's automated right now right
now maybe somebody in the community will
help develop that but that's out of the
scope of this right ok so if you plug
this in go ahead and do that right now
all right you know it's access the the
that's it that was it it hacked it
doesn't like I get this little pay
removable disk right mm-hmm and now
that's the big partition that write the
actual USB thumb drive so what happened
what what did we just hack what did we
gain from this sure let's take a look at
the scripts okay so if I go into my
computer you can see that I have now the
e Drive which is the cd-rom partition
and I have the F Drive now when I open
the cd-rom partition you see I have my
auto run to INF file here and if I edit
that
you can see all it does is run the Cisco
vbe that's a visual basic script now
this go visual basic script is what
allows us to invisibly run our payload
which is located on the the readwrite
partition of our USA this pseudo cd-rom
oh no no that that on the removable
drive ok oh yeah I'm sorry so if we go
into here what it runs is in our WIP
directory under CMD this CMD file or
batch file and that's what our payload
is so if I go ahead and open this up in
notepad I can see everything that this
is doing now what this is doing is it's
doing some PW dump to grab the LM hashes
from that machine it's also stealing
product keys it's getting our URL
history from Internet Explorer it's also
getting it's creating a backdoor which
we'll get into later it's doing all
sorts of fun stuff in fact in later
versions and in another version that
somebody else created Amish and one that
even steals your a I am and MSN has
realized stuff like that yeah ice so
we're gonna go ahead and close this and
it saves all of that to a file on the on
the the writable partition and under
documents and log files and if we go in
here it names it based on computer name
deep blue being my workstation in my
room and art book being this notebook
right here mm-hmm
okay so we've got the information we
need what do we do with it now well all
we did was plug it in wait a few seconds
it created that log file we can eject it
we can head over to our machine back
home and now we can crack that hash
right now this is an LM hash this is an
LM hash and those have some certain
weaknesses which we'll talk about in a
moment so let's quickly take a look at
the log file that this is created now
I've got an IP config in here so I know
what the IP address is of that machine
so I can remotely access it later it
also gives me the LM hashes and gives me
product keys which I'll probably be
pointing out in posts as well as LSA
secrets which are
other interesting things that windows
stores that it probably shouldn't be
doing right right okay so let's go into
our command prompt and head over to the
F Drive okay and head over to documents
and I head over to log files and I'm
going to write I'm sorry I'm going to
type our books out log and I'm going to
find dude's key okay so now I can see
this user on my system whose name is
dude's key and I have his LM hash so I'm
going to add that to a file in C colon
backslash Rainbow crack backslash PA SS
WD txt okay okay so now we've written
that hash to password txt in my end the
rainbow crack directory right now
rainbow crack we've talked about this a
little bit before rainbow crack is
basically a tool that allows us to use
rainbow tables our pre computed time
memory trade-off tables to crack
passwords and it's very efficient but
we've talked about those before
yeah and so let's just go ahead and get
into the attacks and now that I have
that hash I can go ahead and run our
crack star dot RT and I'm using the
three gigabyte rainbow tables and I tell
it - F pass WD txt so now that's going
to go ahead and load up the three
gigabytes of rainbow tables and then
it's going to start computing those
against the hashes that it knows and say
we can get the clear text from it right
okay and so now what now what we're
talking about with the land manager hash
is it's a non secure password and this
is gentle over your overview but it's a
non secure password it's a hash this
hash on des right and it takes the
password and divides it into two seven
character hashes correct and then from
there it's just going to break down each
half hmm
well in it also one of the other
weaknesses is it converts everything to
uppercase so if you've got lowercase
uppercase its ID doesn't matter right
which makes it an insecure password now
so I imagine that the best way to defeat
this kind of cracking is to not let
windows make an LMS exactly and there is
a registry edit that you can do so that
Windows will not store LM hashes and
those are for backwards compatibility
with 9895 and ME computers on your
network if you don't have any of those
you don't need LM hashes and it's
probably better to just turn them off
anyway
now just assuming that you needed to
keep those which at this point it
wouldn't matter anyway nobody runs that
anymore
so that's a nobody but but another
another option is is to use a cat a
password that has 15 or more characters
because it can't divide that into two
and then it can't store the LM hash it
so a good idea would be to create a
passphrase such as rent is due on the
fifth or my first computer was a IBM
pc/xt I mean you're not going to forget
stuff like that and it makes / pretty
little lamb and her fleece was white as
SN 0 W sure why not whatever
yeah that's it there's a whole other
discussion as past phrases but 15
characters are is what you need to
remember there and special characters up
or lowercase numbers I also need to
mention that another thing that we've
noticed in the lab testing this is that
does a nother preventative or way have
met measure to prevent against this
attack is that if you're running a an
anti-virus in our case we were running
Norris I'm sorry Symantec AntiVirus
corporate Edition and notice the PW dump
tool and was able to catch it before it
could run okay so it just did zoom it in
the bud and right so I'm sure that
McAfee and other you know and um
big-name antivirus software will
probably you know prevent that this key
from you know owning that machine as
well okay but let's talk about the
backdoor for a second well this still
cracks okay it's it's question along
here pretty well I'm in a way okay so if
I pull up my computer manager and I
click that twice so it's gonna take a
second okay okay I'm a computer manager
up in here and I'm looking at users
there's this user here called support
underscore 389 blah blah blah right that
is the use
that Windows XP uses for remote
administration now this is Remote
Administrator Remote Assistance or
excuse me
Remote Assistance kind of like how when
mobic she was helping me with the gen to
install and I had something kind of
quirky happen that I couldn't figure out
so he was able to connect to my machine
over the Internet and exit and use the
command line as if he were there it's
it's just like that or it's the Windows
equivalent it's just like VLC which
we've talked to talked about lunge in
the past it's like a remote desktop so
that user is in there by default but
it's also locked so what this does is
creates another user with a very similar
name the only difference is the one on
the end here and if I open this up and
take a look at its membership it's
actually a member of the administrators
group
so now you've created a user with
administrator privileges on our target
machine within seconds and we have from
nestle to that so we have remote we have
the IP address we have our own user that
we've created and that's with the
password that we've generated in our go
dot CMD file our payload in my case I
made high for flakes because you can't
go wrong with that south lakes course
not so how is our rainbow crack coming
along it's humming along nicely so it
should be done here momentarily I think
it's taking a little bit longer because
we're running the camstudio software to
record the screen right at the same time
that it's cracking okay so whoa why that
hums away let's go ahead and talk about
where we can find any kind of further
information with this sure interesting
thing about this exploit was that two
people came to me with the same with it
with very similar exploits one of them's
names max damage and he's the one that
created the tool that reimage 'as the u3
partition on this type of flash drive
and allows it to do it automatically
with that virtual cd-rom partition the
other one his name is Amish and he's
come up with one that'll work on USB
drives without the u3 technology using a
little bit of social engineering and
we've got a write-up on both of those in
our show notes on the wiki okay and so
it looks like right here the rainbow
cracks done rainbow crack is done and as
we can see down here the result is
username dude's key password one two
lowercase Q W a s
Capital Z capital X so he has numbers
she's got lowercase she's got uppercase
you would think that was a characters by
many corporate standards that meets
criteria in fact if I went by dual
standard you don't know by windows 2003
server standards and you need eight
characters at least two lowercase two
capitals and two numbers so that by
Windows 2003
would be a secure password and as we can
see with a three gigabyte rainbow table
in about two minutes of work cracking
about three seconds of retrieving time
we've been able to own that machine Wow
wow so you know what Darren I don't want
to see that anywhere near my box but
you've got to sleep sometime</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>