<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[[ PAYLOAD ]] - The Situation Response Payload - Hak5 2317 | Coder Coacher - Coaching Coders</title><meta content="[[ PAYLOAD ]] - The Situation Response Payload - Hak5 2317 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[[ PAYLOAD ]] - The Situation Response Payload - Hak5 2317</b></h2><h5 class="post__date">2018-01-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0cRoCuwW9s4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello movin act 5 my name is Darren
kitchen it's your weekly dose of techno
list and today we are building a payload
for sitrep what does that mean situation
report to be quite honest I learned that
from Battlestar Galactica but it's a
military term and it means like what is
going on and to be honest one of the
very first things I ever do when I hop
on a box is I want to find out who am I
and where am I and literally Who am I is
sometimes actually Who am I is the
command I'm running his route because
I'm here on my Kali Linux box but we're
going to be doing this from the
perspective of our packet squirrel and
we're gonna be building a payload which
will automatically scan the network and
give you a visualization of I would say
the battlefield because we're using that
military jargon but really I guess I'm
just saying we're gonna find out who our
neighbors are because we might have some
interesting neighbors so let's just go
ahead and start out by SS aging over to
our packet squirrel and really this is
going to apply to any box that has bash
and and map or any of those standard
tools I mean we could be doing this from
Cali the situation is pretty much the
same we're just building a payload for
our packet squirrel to do this
automatically so if I just run if config
here and I can see I've got two
interfaces I've got f0 which is the one
that's connected to my Kali Linux box
here and then I've got f1 which is
connected to the rest of the network
well if I take a look at that network I
can see f1 has an IP address of
192.168.0.0
and you give it that slash 24 I was
talking about and it's gonna go ahead
and scan the entire network and tell you
it was around and in my case is the
slash 24 and there we go we've got a
bunch of IPS on the network that are up
in fact hey check this one out right
here it's a Phillips lighting blah blah
blah you know what that is that's my hue
lights because I like the hue lights
anyway the problem with this though is I
got that information the way that I
typically do when I hop on a box which
is doo doo doo to do to run if config
well that's great but there's no way for
me to pass that information that what
nmap expects that insider notation
netmask slash 24 from what I can see
there that's the problem
I want to automate this so it's gonna
happen every time I plug in my packet or
with this payload well as you might
imagine yes there are ways to convert
this 255 255 255 0 into slash 24 with a
bunch of awesome hacks and bash and Perl
and Python and yeah we could do that or
we could you know use the modern way and
do it the right way and that's what I'm
gonna show you so I have this problem
where I've got the muscle memory of
typing in if config but really I should
be typing in IP so IP is basically a one
of the many tools in the IP route to
package which is the modern way to do
stuff in Linux and if I do IP addr show
I can see hey there's the information
I'm looking for
I don't think it's as pretty but hey
this is the modern way to do it so I'm
just gonna go with the flow if config
you've served me really well you were a
part of the net tools package which came
out with bsd 4.2 in 1983 guess what else
came out in 1983
so with IP I see I get my IP address
here and I get the net mask insider
notation that's last 24 there so let's
go ahead and just get that for that will
do IP addr show again but in this case
we're only interested in f1 so I do that
and okay well I get two results now I
just want one of those let's do the one
that's the second one that starts with i
net so we'll grep for i net and there we
go that's just the information I require
at least out of that line but it's only
that second part here that has the IP
address that I'm really interested in
I want separately the IP address and
then in one separately the netmask so
for that I'm basically just gonna go
ahead and use my good friend Ock to
print out the second part of that line
by doing dollar sign to there and there
you go now since I'm interested in them
separately I'm gonna go ahead and cut
them apart using an aptly named tool cut
and we'll tell it the delimiter is that
slash and I'm gonna tell it which field
I want field number one is the IP
address there you go and field number
two is the netmask there we are I have
everything that I need now to do that
same end map command except automated
let's see how that looks basically and
map with what I say like tack SP and
we're gonna go ahead and first tell the
IP address now I'm gonna do dollar sign
and then two parens and basically what
that means is says run everything inside
of these parentheses first and the
output of whatever that is becomes the
variable it's kind of like algebra so in
this case I'll run that that command
again and I'm just gonna copy pasta that
and then we'll do slash and then again
this but second one the one that gives
me the field - and that goes inside of
its own dollar parens Boop
I know it's looking pretty long but when
I run this I get the same output as the
previous one except with all the all the
think II think ease which means I've
automated the knee which is good and
there we are we can see all our hosts
awesome so let's turn this into a
payload now this is really quick and
dirty I'm just doing a proof of concept
from the command line on the packet
squirrel to make sure it works and now
I'm just going to real quick adapt it to
my needs by heading over to the packet
the payload directory and creating a new
payload file
in payloads I don't know we'll assign it
to switch one and I'm gonna go nano
payload sh started with a shebang bid
bash now with the packets coral payload
we are gonna have to specify which net
mode to use or which network mode you've
got a few different ones to choose from
whether you're cloning the interface or
being transparent or just using that or
bridge or VPN in this case it's not that
I want because I want the packets cool
to get an IP address from the network so
I can scan it so net mode NAT and then
the next thing is to make those
variables so call the first one cider
and the second one IP and we know from
our previous example that cider is
filled to and IP is filled one and then
the other thing that I probably want to
do is make the nmap options a variable
of options so that anybody else using
this payload can just change that one
part of the string it probably doesn't
make so much sense for like a 5-line
payload but it'll make sense down the
line now finally we can go ahead and
just run nmap as we did before but
instead of having our super long command
this time we can use those variables and
we probably want the contents of that
file to go somewhere that we can then
read later so just to make this quick
and easy I'm going to pipe the output
into a file in the I don't know slash
root called nmap dot log and we'll of
course use two Walker's to append save
the file make it executable and there we
go let's reboot have our payload run and
see the output so in terms of the packet
scroll it's just a matter of unplugging
the power flipping the switch over to
switch position one that's where we put
our payload and give it power again wait
a few seconds and you'll notice I didn't
really do much in terms of prettying
this up I didn't even put an LED command
in here so I'm not gonna know when it's
done but the oven is alright so I've
done some quick debugging I've run the
payload I've now switched back to arming
mode and let's
take a look at what we got and the
tweaks that I made to get this to work
beautifully now I can cap my nmap log
here and I see there's all of the hosts
so that's kind of what I expected to see
happy with that and if I take a look at
the payload here basically the big thing
that I've done okay have prettied it up
given an LED set up at the top before
the net mode so I know that neh it's
setting up the network then I sleep for
5 seconds right after setting the
network and the reason for that is while
saying net mode NAT I've said okay cool
set yourself up to you get an IP address
from the network
I can't immediately then just start
scanning it because guess what I need to
wait for the DHCP server on the other
end of the network to say oh hey welcome
to the network here's an IP let's be
best friends so I just do a sleep five
in kind of the similar way that you
might on the USB rubber ducky do a you
know as a sleep 1000 before you start
injecting keystrokes because you just
showed up on a computer and you can't
just start sending frames down the wire
before it goes like hey let's your
keyboard let's be friends so common
mistaken I even just made it myself and
that is maybe one of the big takeaways
here is you always have to think about
payloads in terms of computers running
things rather than humans running things
where as a human we're constantly you
know just like okay there's those
nuances there's a pauses that we don't
that we take for granted because we
can't type like machines but when we
start programming machines to
communicate with machines well they will
operate at the speed of well many many
megahertz so in this case I've gone
ahead and waited five seconds so that I
get a chance to obtain the IP address
from the network then the rest of it is
pretty much the same idea grabbing the
site or grabbing the IP address I know
this could all just be the same command
and then setting our options doing led
attack to let myself know hey we're now
doing the attack part then we run nmap
with our options against the IP with the
netmask insider notation and we pipe it
into a file and notice since I don't
have an ampersand at the end of it it's
not running in the background so it's
actually going to be blocking the rest
of my script which is good which is
we want because the very next line is
gonna say LED finish hey I'm actually
done with this payload it's safe to
eject so a very quick and simple proof
of concept that you can do to scan the
network and it is just that it's a
proof-of-concept it's a total hack and I
can't tell you how many times like on a
site I will whip up a quick payload that
is an absolute hack that works for me
and it's great because it gets the job
done in that limited scenario
whereas I could have also just said hard
code slash 24 is the netmask but it just
wouldn't be portable when I take it to
the next location
so I just wanted to point that out
because we're gonna build on top of this
and I'm looking forward to hearing your
feedback about that so go ahead live
comment blow feedback at hack 5 Gorgon
until next week i'm darren kitchen trust
your technical left
if you've got a great idea bring it to
the web boy we do and head over to
domain.com
I can't tell you how many times their
domain discovery system has helped me
find the perfect name and they're quick
and easy checkout process means it's
online in no time flat and get this the
guys over at domain.com have been
supporting hack 5 for years and they
want to hook you up get 20% off at
checkout at domain.com with the coupon
code hak5 and send your thanks over on
twitter at domain.com so when you think
domain names think domain.com</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>