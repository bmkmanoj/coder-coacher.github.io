<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Secure your VNC traffic using SSH tunnels | Coder Coacher - Coaching Coders</title><meta content="Secure your VNC traffic using SSH tunnels - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Secure your VNC traffic using SSH tunnels</b></h2><h5 class="post__date">2008-07-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IDKzeSWIDKA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">getting remote access to computers uh
Darrin's done Network insolvency on one
of his computers and then Harrison
showed us how to take access a BNC
session using a med metasploit and we've
also shown how insecurities with simple
tools like Cain and Abel and ethereal
but talking to them we've he's told me
about a way to secure it using SSH and
tunneling right now V&amp;amp;C is inherently
insecure okay it does encrypt the
password but it's not very strong
encryption it can be easily cracked with
tools such as can enable like you said
so what I'm going to do is use SSH and
tunneling to secure that traffic so I
explain these things V&amp;amp;C okay so agent
tunnel enemy now if you're just tuning
in you haven't seen the previous
segments on VNC BMC is a remote desktop
application it's a piece of software
they install on a computer that you want
to remotely connect to and then using
client software you can connect to it
and it will allow you to see the display
and interact with it with a mouse and
keyboard it's almost like being at the
computer it but remotely now SSH is a
way to secure securely communicate with
the server it's normally used to get
like shell access oh so like getting das
on a Windows machine or bash with Linux
or something like that exactly all right
but one of the cool things that ssh
offers is tunneling and what that allows
us to do is take any normal TCP traffic
and tunnel that through an ssh
connection it actually encapsulates
those packets with encryption so that
they're secure okay so what do we need
to do to prepare our network for this
right okay now if you want to connect to
your machine overlake your cable or DSL
internet connection the first thing you
can want to do is actually port forward
port 22 on your router so that's as
simple as logging into your router and
setting up port forwarding the second
thing you need to do is make sure that
on the server the machine that you want
to remotely connect to you open up port
22 on the firewall okay um commands with
that sure now in this example we're
using the windows service pack 2
firewall and that command to open port
22 would be neta sage firewall
port opening TCP 22 SSH just enter in
that in the command prompt and that'll
open that poured up for okay next thing
we need to do is set up the actual ssh
server sorry I'm going to remotely
connect to my machine that has the ssh
server using VNC so again a little ahead
but i want to show something right here
and that is I'm running Cain and Abel
and I'm going to show how Cain and Abel
will just sniff up that packet and show
us this password so we've turned on our
sniffer and VNC or in Cain and Abel
we're going to open up VNC and as you
can see i'm connecting to 192 168 1 dot
139 the lan IP address of the machine
the other room but we're going to
connect to so i'll enter an that and
they're in our password and here we are
we're on my machine and the hak5 chat
room well let's take a look at the ssh
software what i'm using yeah servers and
yeah there's various ssh servers you can
run one of them thats very popular is
called openssh and that will run on mac
on linux on Windows I since this is a
windows machine like this package called
free sshd because it's lightweight its
windows native and it just gets the job
done really easily okay well there's
still plenty out there that other you
can plenty yes so we've already
installed the free sshd server and it's
a really basic installation in
information on the the all the nitty
gritties and the show notes for that so
we'll open it up here and as you can see
the ssh server is running what we had to
do here is add users so we go over to
users tab and we would click Add we'd
enter in a name and in this case for
authorization we'd want to store the
password in the sha-1 hash we'll give it
a password and normally would give it a
more secure password but for time I'll
go ahead and apply that as you can see
and what are all these different
settings yeah sure well these checkboxes
say that it's getting this user has
access to the shell in this case CMD
SFTP which is just like FTP but it's
secure and you'd use an SFTP client nice
and tunneling and that's what's
important so we'll apply that and then
we'll save and hide this that's all
there is to it on using ssh side now for
the VNC
we're going to set up a VNC server and
we've touched on this last episode
there's several different flavors of VNC
my favorite is actually tight VNC and
that's the one that I'm using right now
you can also use real VNC ultra VNC and
many others so we'll go ahead and open
up the VNC properties right here and in
tight VNC there's button advanced and
this is just the most important thing
after you set up the VNC server but we
want to check this box says allow
loopback connections so why is that
important well what this is is it's
allowing you to connect to the loop back
and there's a loop back on every
computer and what that is is your
localhost or IP address one two seven
zero to zero dot one and what we have to
do is tell VNC to let us connect to our
machine from our machine by default it
won't let you do that because why would
you connect to your machine from your
machine and I make this in this case
since we're using SSH we're connecting
to that machine and we're going to tell
it we want to connect to ourselves it's
just going to you know bring it to the
other machine so we just check that and
hit OK now if you're using another
distribution such as realvnc there's
actually it's not as simple you have to
go into the registry and there is a D
word value that you have to add and
that's in the show notes all right so
we'll hit OK on that and we're going to
sign off of this VNC session that was
the VNC session that was just done yeah
not plain text but easily cracked so as
we can see here in Cain and Abel we
actually have the hash right here so all
we have to do is right click on this and
say send a cracker we go over to the
cracker and there's our VNC cash we
right click on that and I'm going to do
a brute force attack I'm going to click
start and should take just a moment
there we go and there it is so click
exit and well here we go password on act
5 yeah so now let's do this again
keeping the sniffer running this time
using SSH alright so the next step is on
the client side we need an ssh client
and there's various ssh clients the
particular one that i enjoy is called
putty but because it's really
lightweight its windows native it gets
the job done so we're going to open up
this and we need to specify two things
first
the hostname and in this point since
we're already on the LAN it would be the
lan IP address of the other computer if
we were doing this over the internet
would be the public IP address of a
router and since we port forwarded port
22 it'll allow us connect to that
machine ok or if you've got a dime DNS
you could use that in so in this case
it's 192 168 1 dot 139 and then we'll
head over to tunnels down here what we
need to do is for the source port add
fifty nine hundred and the destination
port 127 001 colon 5900 we click add and
then open now it's connected to the
machine and it said well what it's
saying here is that we haven't connected
to this machine before or the key
fingerprint of that ssh server isn't in
our registry and we have in cash nikka
it's going to ask us do we trust this
machine i know that's my machine so I'm
going to trust it i'm going to click yes
and it won't ask me subsequent unless
it's on your computer down we'll just go
back to that so now we just need to
login with the credentials that we've
set up in the free sshd server so in
this case username sortable fall
ensuring my password and there we go it
I've got shell access but I don't I
don't technically need shell access and
I want to interact with you I want to
interact with some of my programs on my
computer that don't have shell commands
so we'll go ahead and open up tight VNC
and remember we port mapped 5902 1270
2021 so we'll open up that localhost and
VNC viewer give it the password and
there we go and we're in the chat hello
guys so let's minimize this and head
back going to khane enable it and look
it hasn't seen it that's just the hash
last time we have a new new well that's
the cracker hang on the head of a
sniffer passwords nope we still only
have one hash from when we did it
previously in and this is really just
fundamentals that will work with any
kind of protocol now there's various SSH
servers there's various ssh client and
you can do more than just VNC
encapsulation you can
just about anything you could
encapsulate with the ssh and secure for
example few episodes ago we talked about
streaming music and my favorite way to
do that was / apache and I was running
an Apache server with port 8080 I could
just add port 8080 get map it do the
same exact thing and my mp3s would be
secure like I mean it's going to add
some overhead though because it's got to
add the encapsulation and the extra
headers so it's not really great for
streaming it's not like a good trying to
play game through it or something I
wouldn't even bother no but it is great
for stuff like B and C or any other
server interaction type stuff thanks
Derek no problem bring up a detailed
article yeah i've got all the info you
need to do to set up the servers and the
clients all the nitty-gritty details are
in the show notes awesome so they'll be
on the hak5 website in the forms exactly
awesome and if you'd like to leave any
feedback or have any questions please
feel free to post them on forms</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>