<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[PAYLOAD] Steal files with QR codes? Yes - Hak5 2322 | Coder Coacher - Coaching Coders</title><meta content="[PAYLOAD] Steal files with QR codes? Yes - Hak5 2322 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[PAYLOAD] Steal files with QR codes? Yes - Hak5 2322</b></h2><h5 class="post__date">2018-02-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WBkNgb-iPGE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">can you actually steal files with QR
codes well yes
welcome back five it's a weekly dose of
technology I'm Darrin kitchen and on
today's payload I'm looking at a
follow-up of a episode that we did a
couple weeks ago with Shannon where we
looked at the possibility of
exfiltrating documents or doing an
involuntary backup stealing files using
optics the concept with the payload is
that we would go ahead and plant a
device like a USB rubber ducky or a
Bosch finding on a machine that would
inject some code that would then get us
the files off the thing in way of QR
codes basically moving images not too
dissimilar to this exactly like this and
the idea was that you would just record
it with your smartphone and then you
could reconstruct those files back on
your hacker box back at the headquarters
later and have exactly those files we
ran into some problems with a
proof-of-concept in that it went too
fast so the exfiltration like throughput
was not very large and then it caused
problems with potential blurring of the
image and anyway there was also a huge
problem which was all of the
dependencies there was mocked up proof
of concept in Linux requiring some stuff
that you're just not going to find on
your target machines but today we're
revisiting that because as we threw it
out there into the universe one of our
awesome viewers by the name of BG tak
waa or BG - waa Hey awesome payload
contribution I'm now going to feature
and then we're gonna riff on it because
this one is super sweet essentially what
this does is replace the dependency that
would have been QR encode with some HTML
and JavaScript and it does it as a
single payload single stage using just
hid injection so only injects keystrokes
the beauty of this is because it brings
its own files it's not necessarily going
to cause alarms intrusion detection
systems and things of that nature so no
firewalls are going to get involved in
this and that's good because it means no
logs on your pen test so I'm just going
to go ahead and give you a demo now of
what this actually looks like the B gwas
version is written
using the run extension and that means
that you know you can go ahead and
specify Windows Mac or Linux and his
proof-of-concept uses Linux so I'm gonna
go ahead and demonstrate that here on
this Dell XPS 13 running the latest
Ubuntu what it does there's pulls up
that all f2 bar and then this is really
gonna be hard to see here but that's X
term which has a tiny tiny tiny font on
this machine and you can see what it's
done is it's pulled up by or VI it's not
exactly my favorite text editor but it
works in a pinch and it's literally
writing the HTML and the JavaScript for
this file and once it's done with that
it's going to go ahead and open it up in
Firefox and we're gonna be able to
exploit rate documents with it and what
its gonna end up looking like is this
and the speed varies let me see if I can
get that to go the speed varies such
that if you record it with your
smartphone you should be able to go
ahead and grab all those frames and
reconstruct that file and QR codes are
pretty resilient for this kind of stuff
now mind you this linux box it's still
typing it in i mean it's a minified
javascript that creates QR codes based
on whatever you give it obviously we're
gonna use something like base64 encoded
whatever the file is but it's still
going so I think this is super awesome
and I think it has some potential to
make it even better and that's what I'm
going to attempt to do right now and it
finished and then it opens up Firefox
and then from here you have to click
browse and choose a file so there's
still a lot of room for improvement but
I think that we're well underway to
having a functional exfiltration payload
with free space optics I don't know
recording screens with smartphones so
that IDs sensors don't go off okay so
let's go ahead and make this better I'm
gonna switch my bash money into arming
mode and plug it here into my dev Mac
and as that pops up let's take a look at
the code here so bgw a put together this
optical exfiltration payload that's
based on that hack 5 episode 23 20 and
you can see here the stages it does a
setup where opens vim it does an attack
where it writes the HTML
then finally it finishes it by saying
hey you're ready to process those files
it does this by going into attack mode
head and then we go ahead and run unity
and then basically it deletes file
creates the file and them and this is
actually really cool I love this part
right down here basically this do while
I FS equals read data this whole part
right here where you pipe in that source
file that right there is gonna go ahead
and iterate through every line of that
file writing it into vim this is a way
cooler way to get your you know you know
if you've got a lot of data that you
need to go ahead and inject into a
payload this is a great way to do it hey
there she's got a bone now are you just
here for the the licks I thought you're
here for the clicks she's here for the
licks probably just the clicks thanks
girl anyway uh um let's go ahead and
make this even better with a a second
stage if you will so what we're gonna do
is instead of typing all of that code
into the computer since it's just a web
page in HTML and JavaScript anyway well
guess what we're gonna go ahead and
attack mode as both hid to inject the
keystrokes and Ethernet to run a web
server so let's go ahead and pop over to
the bash money here and under payloads
it's put it on switch position to I
already have the index.html here which
came from our friend over at github in
fact you can find B gwas github over at
github comm /b gwa exfiltrated your qrx
hole trader that's good stuff and I've
already had a gonna head and saved his
minified index.html to the directory
that I'm going to put my payload txt n
if basically is then going to allow me
to come over here and say if I edit my
payload txt and let's start out like we
typically do with an LED setup I'm
saying okay let's go magenta I was gonna
say pink like Princess Peach over there
but its Tecna
magenta and then do our attack modes so
we'll do attack mode ECM underscore
Ethernet that's just gonna save some
time since I knew in this case I'm
targeting a Mac and then we're gonna say
hid because we're gonna inject
keystrokes now since I am targeting a
Mac it's important that I specify a
vendor ID and a product ID that is going
to be friendly to that device in this
case and to be honest this is probably
the best hidden pid' to use across most
machines as far as hidden or keystroke
injection is concerned but it's the
vendor ID 0 X 0 5 AC and the product ID
or pid' 0 X 0 21 II and that is for the
Apple keyboards next thing we need to do
is get the targets IP address which
would be the IP address that the
computer gets from the bash money will
also go ahead and get the switch
position and at this point we're gonna
sleep for 5 seconds this is a part that
we need to clean up later essentially
what I'm doing is I'm throwing in this
delay because the Machine needs to get
an IP address from DHCP there's a better
way to do this I'm just not doing that
right now after that we're gonna go
ahead and from the perspective of our
bash money we're going to CD over to the
directory where that index.html resides
which in our case is /root slash u disc
slash payloads slash dollar sign switch
underscore position which we got from
that get statement there and that's
because on mine it happens to be payload
switch two but on yours it could be
payload switch 1 so that solves that
problem ok
and then now that we've seeded there
we're gonna do Python attack em simple
HTTP server we're going to specify the
port of 80 which is standard web server
port and then we're going to end it with
an ampersand so that is running in the
background you can also do this with PHP
- capital s 0 - 0 0 0 and then you could
specify the directory I just happen to
like the Python 1 I'm probably going to
look at ways to speed this up
because this Python server takes a
little bit to get running I'm putting in
a sleep 15 right here it's not great
we're gonna fix this up but again it's
proof of concept so I can't wait to see
your feedback on this so that's the
first stage of the attack is to get the
server running that is gonna the web
server running that's gonna host that
index.html file the next stage of our
payload is to actually convince the
machine to browse to it and here's a fun
one we are just going to use run and
this is where you could easily adapt
this to windows or mac or linux so what
we'll do is you know specify a new LED
because we just went into the attack
stage so led attack and we'll do run the
operating system so it could be when a
community it could be or window manager
for linux or it could be OSX in my case
and then we just specify what we want to
go into the run dialog so in Windows
it's in the bottom left it's next to the
little flag if there's a little flag you
know your machine's been owned and if
you're on a Mac its GUI space and then
you get spotlight and you can just type
in the URL so in this case the URL is
going to be HTTP colon slash slash 172
dot 16 dot 60 4.1 slash index.html and
then what we have to do here is we can
actually pass it base64 and have it
encode that without us having to then
click browse to a file and choose a file
and have it generate the QR codes and
JavaScript and play them back to you you
can specify that by doing question mark
base64 equals now here's the thing again
we're still kind of in a
proof-of-concept phase there should
probably be another stage of this
payload that base64 encode x' the target
files that we actually want and then we
passed that as an argument to this but
for the time being just to make this
short and because I haven't figured out
that part yet let's go ahead and just
pass it some base64 I don't know like
EEE f5 to 0 4 d6 I never heard of it so
there we go and at this point we can LED
finish and go ahead and save that guy
and now here we are living the dongle
life living dongle life now you're going
to know this you're going to notice the
first stage of this attacked it takes a
little while because - setting up all of
those services but thankfully once it
hits spotlight we should know that our
Python web server is running in the
background I'm also running in the
background
oh and there we go you can go ahead and
scan that now so that's pretty much it I
think this is a really cool extension to
this proof of concept I want to see your
feedback and how we can continue to make
this better together mad props to BG tak
waa you can find his links to his
payload down below and if you are bgw a
can you hit me up at hak v dot org slash
payload and let me know it's you and
will verify because I want to hit you up
with an awesome hack five
gift certificate and if you'd like to
have one of your payloads featured you
can go to that same URL and I would love
to show your work so with that i'm
darren kitchen trust your technical
domain comm has all your website needs
from command dotnet domains to intuitive
website builders so you can take that
first step in creating an online
identity let me tell you there's no
domain extension like a.com or.net or if
you want to brand yourself domain comm
has over 300 domain extensions like dock
club and dot space these guys are huge
fans of hack v they're affordable
reliable we've been using them for years
they've got all the tools you need to
share your ideas with the world and
because they're such big fans they are
hooking you up with 15% off their
already affordable prices so get domain
names and web hosting and email and just
be sure to use that coupon code hak5 so
when you think domain names think
domain.com</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>