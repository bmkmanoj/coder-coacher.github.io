<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Build An OpenVPN Access Point - Hak5 2017 | Coder Coacher - Coaching Coders</title><meta content="How to Build An OpenVPN Access Point - Hak5 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Build An OpenVPN Access Point - Hak5 2017</b></h2><h5 class="post__date">2016-06-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/XDCv_xw4BW4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">building an open VPN access point this
time on hack five he'll open hack five
my name is Gerren kitchen hello my name
is Shannon Warren if you weekly dose of
Technol is waving weird I'm just always
weird was part of my personality we just
got back from vacation we're getting
back in the swing of things we're not
pressing any buttons today know that
exciting watch this super magically I
will turn what's the camera change there
good yeah that's so uh and then when
when I turn back to this one yeah the
neural implant really working out yeah
the psychic yes psychic abilities so
before we get into today's topic we have
a couple of things first off we are
happy to announce our next pen test with
hack five that is happening September
16th through 18th so if you are
interested in joining again that's going
to be at the hack 5 warehouse really
really excited to do another pen test go
over to pen test with hack 5 com2 sign
up there space is limited so make sure
you sign up early because it will sell
out it always does yes you can find out
pen test with AK 5 com
looks pretty good you can get all the
information yeah they're about how you
know basically get learned up by sev and
mu Bix and I all about Metasploit views
B rubber ducky Wi-Fi pineapple Lantern
we're going to put it all together in
this little red team challenge which is
a lot of fun and I hope to see you guys
there I've been getting calls from some
people that are like signing up and it's
just going to be good fun because we do
its story based and there's like a big
overarching mission and it's like one of
those whodunits in the holiday and then
last off we also have some stickers yes
these aren't from the fan though no well
I'm a fan here's a knickers right we're
big fans very excited to have our very
first Justin Robert Young stickers check
that out we got those and let's see what
else is in here okay we got The
Contender which if you haven't played
already what are you doing stop watching
the show and go play The Contender
yes ended up playing The Contender with
a bunch of Aziz in the Gold Coast
with so much fun American politics board
games with um okay that's a rubber guy
well with a bunch of Aussies that was
really interesting cool yeah they have
some perspectives on American politics
as it turns out did you drop on it I may
have we will see as the show progresses
okay well at the very least let me go
ahead and get these beautiful die cut
stickers up on the yes a right next to
space shuttle oh that's great I love it
yep overlook that that looks awesome
yeah yeah so today's a fun episode we
are building an open VPN access point
yeah so cool concept so tell me a little
bit about Open VPN because I've never
used it myself I've used other VPNs but
does it work the same as other VPNs
Virtual Private Networks basic principle
is yes it absolutely does and it's open
source right it is open source there are
many different protocols for doing
Virtual Private Networks so you know
some of the more common ones might be
PPTP which other crap don't use it or
IPSec and there's many different vendors
in in this space whether it's Microsoft
or Cisco or whatever have you
but Open VPN over the last decade has
really made a name for itself as being
like the go-to open source one okay they
have a really beautiful Linux base it's
all command line very simple to setup I
save it simple to set up actually it can
be quite complicated and we're going to
dive into some more of the fun
open-source goodness that you can do
with it today we're kind of cheating and
using one of their uh
clicky booty products that makes it
really simple too so it's a nice GUI
interface yeah we're doing a nice one
with the GUI just to get started but all
of this is going to apply on the
client-side whether you're using the
pretty version which they have a paid
offering that's like free for up to two
concurrent clients or their open-source
offering which you know have fun can
handle you know infinite multiple
commands and things of that nature so
the basic premise here is using a VPN
all of your traffic gets tunneled
through right here connection click we
secure yeah well no I mean pretty good
right in this case the technology that
we're using an open VPN is based on TLS
or layer security yeah talking about the
SSL stuff a little lock icon at the top
of your browser when you go to a website
that's HTTPS yep
so we're going to be generating
certificates we're going to be
exchanging certificates and setting it
up so that there's you know a secure
tunnel between you and this in this case
it's going to be our server in the cloud
yeah and then my security between my
devices to my access point are going to
be through WPA Wi-Fi encryption so in
this case the access point that you're
using is Wi-Fi pineapple nano yes this
is my travel router I use Wi-Fi
pineapple nano I'd like to do in the
tactical case with battery pack and
stuff and and I'll use the second radio
or even a third radio to relay a
connection so if I get if I'm at a hotel
that offers Wi-Fi yeah I won't connect
my laptop to the hotel Wi-Fi you'll
connect it to this and use Open VPN to
connect through right of that Wi-Fi so
the only thing exposed to the actual
hotel's Wi-Fi connection what is this
and then this initiates an open VPN
connection to my server in the cloud so
that anything connected to this which is
really nice it means that I don't have
multiple devices connected to that but
all of them be secured over the same
open VPN protocol yep that's the mill
had that's exactly what comes down to is
because while it may be trivial for me
to set up an Open VPN client on my
Android phone and my you know Windows or
Linux laptops what about my Kindle right
what about any of the other devices that
I have that connect over Wi-Fi and I
want them to be secure as well
so for my travel router when I want
everything to be going through a VPN
connection because I don't necessarily
need any of these hotels or you know
when I travel internationally it's none
of these government's business what I do
absolutely oh if you end up in some
interesting countries use a VPN so today
what we're actually doing is installing
open VPN access server that's the idea
yeah we're going to go ahead and get our
server configured we're going to set up
our clients we're going to test those
connections so that we'll be ready to do
the access point stuff oh and then what
are we doing next week that's the access
points access point stuff aria it's all
open wrt based I'm using a Wi-Fi
pineapple of course you could use any
open to RT based device right for this
and we can set up the routing and talk
about
how all of that works and you know this
is this really fun stuff in fact it's
it's good for not even just a travel
router but I actually use this at home
how do you use it at home so my actual
my Wi-Fi access point at home is a Wi-Fi
pineapple really yeah it's in fact one
of the early dev units when we were
first developing the device so like I
like to you know I have like months and
months of uptime on this thing which is
sad because I'm gonna have to reboot it
soon anyway that notwithstanding I don't
have like a traditional internet
connection at home I use like I just
tether a phone yeah my Wi-Fi pineapple
and I just use my old cell phone as a
modem because I get better LTE speeds
than I would DSL are you serious yeah
with my wireless carrier racing plan
I've got unlimited data unlimited what I
started doing is they started rotting if
it's streaming video in certain
instances and that that's kind of a pain
yeah I'm not surprised my point my plan
is to just go ahead and tunnel
everything through the open VPN server
through the Wi-Fi pineapple and then the
carrier won't know the difference
between if it's streaming video they
can't do if they do D they can't see
what data is yeah the older see that
you're there you're just gonna see TLS
data they're not gonna know what's
inside of it and so hopefully they don't
throttle that yeah find out okay so are
we ready to get started we are ready to
get started so I'm using a virtual
private server in the cloud as you can
see here I'm SSH tin to it it is called
twist Avenue because I use the NSA
codename generator to realize yeah no
seriously though if you haven't already
NSA duty to do name generator' and you
can just just refresh this and you just
always get awesome names
I like color Celeste right that sounds
like a great screen name mm-hmm colors
the last yes post on the crane outer
some of them get naughty so anyway I've
got this set up here and it's completely
empty because I just wiped it so let's
go ahead and get started first thing
that we're going to need to do is
download a copy of the access point
server so you can find that over SW
update OpenVPN org and actually I'm just
going to go ahead
and link this in the show notes but
alright so as long as you don't
fat-finger that you can go ahead and
download your Deb file now and as you
can see there we are
it's just a matter of doing D package
tack I to install that particular
package that we just downloaded cool
alright and so the installation is
complete you get some information here
here's the thing is actually not it's
totally messed up but there's a way to
fix this so first of all we're going to
need an Open VPN user and actually tells
us here we need to just go ahead and set
up a password for it so I'll just go
ahead and set a password for Open VPN
all right and then we need to
reconfigure the server so it does the
configuration by default but it messes
it up so it's how does it mess it up it
just does or at least if you were using
a digital ocean is my provider and it
messes it up for some reason and I'm
going to show you why you know what it
is it gets the wrong interface so it
shows it's assuming that you want it
like a certain configuration and it just
screws it up in the process yeah so what
ends up happening is if I do an if
config here you'll see I have several
different interfaces and it always
chooses the wrong one
so I default so if I do this
reconfiguration command and then I'm
asked to type delete till I confirm like
yes I'm going to be deleting my entire
config and I get prompted to go through
this setup wizard type of thing where
I'm like yell accept your EULA and
basically saying yes for all the
defaults except for where we specify
which interface we're actually going to
be listening on and this can be easily
solved by choosing all interfaces or 0 0
to 0 to 0 oh so I choose one and then
it's basically just go with the defaults
for the rest of that that's been
everything will work so there you go
that's how you make it all like not
totally broken which is fun that's kind
of the rest of it is pretty
self-explanatory it just tells you right
here when it finishes that it says you
know after you set this up here's your
admin UI and so I'm just going to go
ahead and
sorry I'm so I'm doing this in Windows
for some god-awful reason but there we
go
and of course so it's saying like hey
here's the admin UI and then here's the
client UI and so it's just the IP
address of your
openvpn like whatever your virtual
private server is and then you know :
943 for the port number and slash admin
if you're doing the admin interface okay
alright so they come over to Chrome of
course it's going to throw a hissy fit
because it's a self-signed certificate
so you have to go to advanced and say
yes go ahead and proceed and now we can
log in as OpenVPN yay with and this is
the password that you just said it's the
Passover that we had previously set up
okay and then once again agree to the
EULA and there we go our server is
running okay we're all set awesome okay
now all we have to do is start adding
users and we can dial in that was
surprisingly easy it is you should take
a look at the steps involved in setting
up openvpn vanilla like not the access
point access server yeah cuz this one is
the nice friendly gute GUI it's like oh
how convenient the other users I feel
like we should do the other one just
because it's important to understand the
steps of like what it's doing in the
background they have absolutely
interface you know similar to the Wi-Fi
pineapple it's awesome interface but
it's also important to understand what's
going on deep down inside yeah the
better understanding of how you know the
tax work and things of that nature so
we'll go back and redo this using the
vanilla one sequel option like building
yeah most of it is really just building
your your certificates that's ok which
is I like to know those things yeah it's
good let's get geeky
let's get Giggy all right well right now
what we need to do is set you up with a
user count so again you can dial in to
dial into this VPN so in order to do
that I'm going to go ahead and oh nice
your that's right you switch to a bow
too and did switch to boot choice how's
that been going
it's been going great all right I have
not needed anything on Windows for the
past couple of months so wait what
happened here was something I switched
from Linux to Windows and you switched
from Windows to Linux huh
figure alright I blame Adobe once again
yeah so what we're going to do is we
just need to configure our user settings
in the open VPN server over here so if I
come down here to under user management
and are actually under authentication
and go to general you'll notice that we
have several different authentication
types that will allow us to do
Pam radius LDAP all of those are
different Elda LDAP is kind of a filled
up um but it's kind of cool if you're in
a kind of like a Microsoft you know yeah
if you're you're part of a domain and
you've got you know like a Active
Directory you could hook into that so
that you can use the same sign in
information for all of your users okay
right because we know that users hate
remembering additional passwords yeah
we're going to just create something
locally because we don't want to have to
bother tying it into Pam or radius or
LDAP so I'm just going to choose local
here okay and then save those settings
and then update the running server then
under user permissions here's where we
actually add a user so I'm gonna add one
force NURBS is it SNU RBS yes that is my
alternate that's yeah first people many
know this it's nerves nerves and I'm
gonna check this box for allow auto
log-in save that setting you know I can
memorize passwords right evil right what
I'm still going to need to set up a
password because I have to click on to
show next disturbs now and set you a
password 1 2 3 4 5 6 7 8 o character
password yeah old digits and then top 1
have settings no and I can memorize yeah
we're gonna have to delete that account
when we air this segment okay and then
save those settings okay so everything
is saved and and all ready to go and so
at this point we're gonna take a quick
break
cuz when we get back you're going
to the VPN yay using a VPN is always a
great idea and if you have a great idea
and want to get it on the internet do
what Shannon and I do head over to
domain comm they have an epic domain
discovery system that I'll help you find
the right domain and their checkout
process is super simple which means
you'll be up and online in no time flat
and get this the guys over at domain.com
huge fans of hack 5 they want to hook
you up with 20% off all you have to do
is use the coupon code hak5 that spells
hack 5 at checkout and save yourself a
bundle and you know what go ahead and
tweet them tweet at domain.com and say
hey thanks for supporting hack 5 all
these years when you think domain names
think domain.com we're back and it's now
time to set up the first client on the
VPN server and that client is going to
which is going to be fun too because
you're using Linux so there we go
the instructions are going to differ
ever so slightly if you're on OS 10 or
Windows but actually on those it's so
soft explanatory its next next finish
this is going to make so much more fun
so mine is the harder one yes so in this
case all you need to do is go to the
user login similar to how I went to the
admin login
oh so that address is going to be or in
our case HTTP HTTPS one five nine two or
three to ten to forty seven to ten dot
what was it 247 247 colon 943 so on port
number nine forty three and it is 159 to
a 3 to 10 to 4 7 943 and its HTTP there
we get there guys
great so now just log in i'm snubs right
you're snobs and my password was oh it's
really password yeah absolutely
go cool so here we're prompted like hey
how are you I wanna connect cuz you're
on Linux No
so what you want to do is actually
download the auto log-in profile so see
the connection so at the very bottom
where it says yourself user log not I
don't log any auto log-in so go ahead
and download that ok it's gonna give you
a client ovp n file so that should just
be in your downloads folder right yeah
fantastic so it's just
and actually if you scroll through this
you can see basically what this is is
all of the directives as well as all the
certificates and key yep
I'm one file and since and so because we
have all of those certificates in this
file we don't need to enter in the
password every time we connect which
makes this great for automation and
deployment on embedded systems and
things of that nature
okay uh so the rest of it is just
basically getting the Open VPN client
installed oh yeah so for Linux it's
actually just chewed up get install Open
VPN if you're on seriously okay I be in
base system yeah so sudo apt-get install
and it was what open again
Oh own Open VPN all right and so now go
ahead and move to your downloads
directory okay alright and you should
have that ovp and file there I have all
sorts of things in here oh man I bet you
do well in that case what we're gonna do
there it is client ovp n okay all right
so here's what we're gonna do let's go
ahead and actually test first what IP
address you're coming from okay so in
your browser open a new tab and go to
one five 9.20 3.2 10.2 4 7 : 91 91 91 91
slash 9 1 9 yep slash test dot PHP ok so
this is your point 1 5 8 what does that
mean right so what that means is your IP
address that you're browsing from right
now ends in those last four characters
oh cool yeah me so I don't have to use
IP chicken to find my IP you could go to
IP chicken I'm gonna tell your IP
address but this way I just see cuz
we're being caddy here we're only
showing the last few characters that's
like burlesque nice for IP addresses
you're weird with the new an actress hi
so that little bhp script is going to
give us the last couple of characters of
our IP at all all right and that means
we don't have to do any blurring and
post so what I'd like you to do now is
go ahead and dial in and very simply all
you have to do is open VPN config that
file so in your terminal in a terminal
okay go ahead and do Open VPN space - -
Figg space client a VPN that's it that's
it
and you can see it goes ahead and it's
for everything and it gets a fatal error
because operation not permitted oh hey
license yes let's do that with rib
access man all right every single time
and in just a moment you're gonna see it
set up our routing and everything and
our initialization sequence is complete
and you see all of those IP route add
commands down down there at the bottom
yeah so what that does is set to your
default gateway which means if we go
back to your browser now and you can see
it is the IP address of our own server
we're 700 which means now you were
successfully a client of the VPN and all
girl is going through it which is
fantastic oh just your laptop that's
awesome
and we're gonna take it a step further
next week when we make it so that our
Wi-Fi access point is going to allow any
client of it to go through this we can
serve that really fun really needs so if
you have questions and such leave them
in the comments let us know what you
guys think of course a like a cherub
scribe that goes a long way too so thank
you so much for the last almost eleven
years of Awesome technolon org to find
all the more details and show notes on
this as well as the huge back catalog of
lots of good stuff involving VPNs and
other all the geek things and then of
course thank you to everybody who
supports us through the hack shop that's
over at HHF com you can go over there
and you can find your own Wi-Fi
pineapples and all sorts of other super
awesome hak5 gadgetry we're also going
to Def Con this year fashion and we will
be bringing our hack shop with us all of
our hack 5 products is super excited to
meet everybody at con if you are gonna
be there definitely stop by the booth
it'll most likely be interesting that's
all I'm going to say that's our gonna
end on I think I found the very best NSA
named Thor defender Oh Morty finger yeah
crows all right that's weird
hey it's actually here's the UNIX
command
I'm gonna leave it at that yeah yeah
just let's just end it here so with all
of that said I'm Darren kitchen I'm
Shannon Morse
trusts you Tecna West Oh</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>