<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Meterpreter Transports - Metasploit Minute | Coder Coacher - Coaching Coders</title><meta content="Meterpreter Transports - Metasploit Minute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Hak5/">Hak5</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Meterpreter Transports - Metasploit Minute</b></h2><h5 class="post__date">2016-04-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/AlnBgoM7ss0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">meterpreter transports this time on
Metasploit minute Metasploit minute is
brought to you by viewers like you if
you get value from this show and can
spare even a dollar please consider
contributing at Metasploit minute calm
welcome to Metasploit minute the
breakdown on breaking in I'm your host
Rob fuller but you can call me movies
today we're gonna be going over metaphor
erm interpreter transports the
transports are pretty cool functionality
where you get to add new transports on
to current sessions now most people
don't know about this functionality
because you extend by standard you only
use a single transport so let's go into
one of our sessions sessions s13 and hit
transport or transport and you can see
that just like any other option inside
of Metasploit you can see all the
valence just by typing the command so
transport list will actually show you
the current transports and you can see
that I only have one transport listed
here its port 9090 the comm timeout
retry timeout and all that stuff that we
talked about on last episode is per
transport okay so if we add a new one
what's gonna happen is when that times
out we can actually move on to the next
transport this is really awesome
functionality because it can be used in
a bunch of different creative ways one
we can make it so that if this port or
this IP fails we can move on to another
one
specifically ports or you can send a
different IP so you can make it so that
you have 13 different IPS on the on the
internet somewhere with handlers on
going and if for whatever reason your
current sessions die because they block
that IP that whoever the target is for
your your valid ethical pen test right
then it'll move on to the next one and
then the next one to the next one as and
you you play that game of whack-a-mole
on the incident response side alright so
what we're going to do is actually add a
new train
sport and for for fun you can add all
kinds of different transports reverse
TCP reverse HTTP HTTP and this is
particularly on the windows side so
let's add a transport and let's make it
mmm let's make it reverse HTTP this time
reverse HTTP we're gonna set our l host
and this l host is any other IP or dns
name on the internet that you want one
that you can actually set up an
interpreter session on our handler i'm
sorry on alright so 1/6 102 dot 1 and
we're going to set our port to 8 4 4 3
and we're gonna set that up in a second
alright what else can you set here we
can set our are let's see our retry
total time or RT down to because we're
doing this for a demo we kind of want to
shorten this down so that it retries
only first not at a full hour because we
don't want to sit around here and wait
for an hour down to probably around 300
all right let's make it 120 seconds so 2
minutes alright let's see if this works
ad boom transport list and it's there
you can see that the URI for this is
pretty long this is a randomized URI now
we could have set the URI up here the
URL somewhere around here yep cost them
you alright right there but we're not
going to so we've got this set up now we
what we have to do is set up an actual
handler ok so background use exploit
multi handler set up the same options so
set payload to Windows of SU Windows
meterpreter reverse to HDTV and I'm
doing this out of order you can do this
in any format you want if you want to
set up your handler first as long as
your session is good you can set up new
transport so now every whist you can set
your handlers later on if you wish to so
L host 1001 72
one six one or two dot one port that was
eight four four three right yeah eight
four four three show options we always
want to show options as we go and one of
the cool things about this is that when
I take or give Metasploit training I get
to find out all kinds of new options
that people just either stumble upon or
have used in the past and one of those
options that we just figured out in pen
test with hack five that we just got
done doing and by the time this airs
this is going to be a couple weeks after
that and you guys should come out
definitely if you get a chance on the
next pin test attack five is that you
can just type options I am so ingrained
to do show options but options does the
exact same thing so exploit - J get that
handler going now you see that I didn't
get any sessioning because that
transport the previous transport is
still very much active all right so
let's go back into that session that we
just came out of what was it drew to do
13 sessions - aye 13 transport list all
right what we're gonna do we're gonna
cross our fingers and hope that we setup
everything correctly transport next now
what this will do is kick over to the
very next transport and almost instantly
as soon as I hit next because I have
both handlers going I got my session
back and what you can do with this is
very you can also do egress busting so
let's say I set up a bunch of handlers
on TCP 30 20 to 21 3 to 389 and
you know all those ports that are
normally allowed of out of corporate
networks and then I hit next and I make
sure to set the retry total time till
something less than an hour and
hopefully one will get out and then I
know that that's another port that I can
get out of their network on so let's go
to sessions see that we have sessions on
14 awesome so what we're gonna do now is
we're going to play a little trick so
transports lists okay
now our timeout on the HTTP is two
minutes our time out on the 9090 is
3,600 and know what we're gonna have to
do is transport next get back over to
that one to change it hopefully it comes
back so transports 15 transport set
timeout just like we learned in the last
hips I got to interact with a stupid
thing 15 set timeouts typing is not my
forte timeouts too and we want to set
the retry total timeouts down to 1 and
20 all right now if we set transports
again we can transport lists again we
can see that now it's 120 so what I'm
gonna do now is they want to background
jobs dash V and I'm gonna kill my
handler that's going on 90 9000 what's
gonna happen if I transport next now
what's gonna happen is that it's going
to try to get out on 90 90 and fail for
about two minutes so we're gonna do a
little bit the time lapse for talking
for you in a second and push forward in
that two minutes hit transport next I
got it back why did I get it back
because it was already on 90 90 so we
got to do transport next again so 16
transport next and now since we don't
have the handler running we're just
gonna lose our session and hopefully
within two minutes we'll get it back all
right we got it back after about two
minutes of waiting we got our session
mech and we have it back on our system
so the reason why we got it back is
because after the 9090 failed for two
minutes
it didn't see that it could connect
anymore so it switched the transports
that it had again you can add I don't
know if there's a maximum probably
around 255 but you're not probably not
going to get to that maximum very easily
you had all these different transports
in and you can test things exactly like
this now that we know that 99 you can't
get out of their corporate
we're gonna stick with eight four four
three one of the things that I will note
on this is that transports do not stay
with that binary that you have just like
timeouts if your binary for persistence
runs whenever our user logs in or
whatever every time that new session
establishes when they run the new binary
that's a completely new session so all
of your transports go away so I just
don't want you guys to get confused when
when you get a new session coming in
after someone reboots a box and all of
your transports disappear because I know
that that's one of the things that I
felt about when when it did it to me
anyways
I just want to say if you have any
feedback for anything that we've done so
far on the show please email MSF at
hackpad org and stay tuned to Metasploit
minute for more shows like these huge
thanks to everyone who's supporting the
show your support you can support us
directly at patreon.com slash mu b IX or
move it's every dollar goes towards
making the show just for you and I'm
really grateful so until next time I'll
move it and I'll be hacking til the cows
come home
Wow
I don't know if you saw it in my mouth
but it hak5 was coming out like because
yeah I don't know if you can see it or
not it was like Metasploit Benny</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>