<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#18 User Schema &amp; Query - Full-stack GraphQL with Apollo, Meteor &amp; React | Coder Coacher - Coaching Coders</title><meta content="#18 User Schema &amp; Query - Full-stack GraphQL with Apollo, Meteor &amp; React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#18 User Schema &amp; Query - Full-stack GraphQL with Apollo, Meteor &amp; React</b></h2><h5 class="post__date">2018-01-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hUIs8ricJFE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so in the last video we got our
login form working and it's pretty ugly
let me add tab over to it we can check
it out in this video what I want to do
is well we're gonna get our user schema
set up we're going to get it logged in
and everything no way we can query off
of our user schema to be able to improve
some of our interface such as being able
to show this login and register it's
sort of when the users logged in instead
of just having all of these things that
aren't necessarily important showing all
at once so let's come back to our
application and in our API folder I'm
going to create a new folder and this is
just going to be users okay instead of
this user's folder I'm going to create a
new file which is capital user graph QL
this is going to be the schema for the
user now in here I'm going to say a type
and the type is simply just going to be
a user now check this out I'm going to
have an ID which is a string and an
exclamation point here because it's
going to be required and I'm going to
have a field called email now email is
going to be a string as well and this is
going to be one of the fun ones we're
gonna get to actually do something
really cool here with our resolvers
something that we haven't seen just yet
and since that's pretty much all the
information we're caring about in terms
of a user right now that's that's going
to be it okay and in another video I'm
going to show you how we can have our
type of query in here as well but for
right now we're just going to keep this
as a type of user now I'm gonna head to
my register api's file here and I'm
going to import the schema so I'm gonna
do that as let's actually move this one
to the bottom I just copied this line
and this is going to be import users
schema from API users user graph QL and
I can throw it into our type deafs where
we had an array of a test schema we had
a resolution schema and now we're going
to have a comma users schema
okay so this is pretty much what we need
to get our users and schema up and
running if we check our server there
should be no errors when so ever at this
point we haven't really done anything
crazy now next I'm gonna go ahead and
create a resolver so just like we have
in our resolutions resolvers file I'm
gonna just basically copy and paste some
of this line of code but all I really
need is this export default query okay
so in the users folder we're gonna do a
new file and this is going to be resolve
verse dot J s and paste this in here
just like so okay
so we're going to export default query
and then query is just going to be and
this could be something anything you'd
like it could be user and it could be
current user in this case I kind of just
like user as a way to say hey this is
the the current user that's logged in
here now this one's going to be
interesting because in our past query we
had to accept some arguments or we use
the user ID to find our resolutions here
instead of that one of the actual
contexts to remember we had user ID but
we also had user itself so we could pull
out user straight from our context and
simply just return user now one thing I
should note is if the user isn't logged
in users I think set to null or
undefined and that might cause some
troubles if this resolver needs to
return an object so we can always say
user or an empty object I'm not 100%
positive that I need this or empty
object but I'm just being safe here okay
so as you can see in our user resolver
we simply have to find a new query user
which doesn't do anything with object or
args but it does pull out the user from
context and it returns it now at this
point we'll again want to register this
user into our API here we can have
another copy and paste fessed down here
and we can it I like copying and pasting
this resolve verse one here we could say
users resolvers and it's from api users
and then the resolver file well
copy this and then throw this into our
merge down here where we have test
resolvers and resolution resolvers okay
and apparently prettier wants that to be
on one line for some reason even though
it's kind of long line but as you can
see here all we simply did was merge it
into our test tree solvers resolution
resolvers and users resolvers okay so
that said now we should actually be good
to go with this however it looks like
query dot user is defined in resolvers
but not in schema right okay so this is
an issue that we're going to solve in a
better way in the next video but for
this time I'm simply going to just like
we did in our test schema ad on our user
schema because we need to define it in
the query schema again I'm going to show
you a better way to do this in the next
video and again instead of having just
an output of an array of users or
whatever if you remember our type itself
was defined as user that means we can
say hey it's just going to simply output
a user so this is again just a stopgap
we're going to fix this test schema up
at some point here and now our server's
restarted and we should be able to check
out our graphical I'm gonna head to my
graphical and I can come in here and I
can say user and then maybe give me the
ID hit play and you can see what's going
on here cannot return null for the non
nullable field
now this error is coming up specifically
because well in our schema we defined a
user schema we said the ID has to exist
and since nobody's logged in at this
moment what we're returning is an empty
object now that empty object doesn't
contain a user ID so a quick solution
would be to just say hey maybe the ID
isn't actually required that we can
remove that exclamation point now that's
just say the the ID isn't required
anymore so before you make a change like
that you want to make sure that that ID
is certainly isn't required now luckily
in our case it's not actually required
for the query I'm not quite sure what I
was thinking it was at the time but we
can just simply remove that and now when
I run our query in here it gives us a
user with an ID of null which is
actually a decent way to check to make
sure a user is logged in right if we
have an ID that's null and therefore
they're not logged in okay so let's
check it out here we have our user query
I'm gonna actually sign in now login
user okay we can see my resolutions have
now officially changed to what my actual
resolutions are and if I run the same
query again I'm going to get my user ID
so we know that our user query is now
working now next step here is to write a
query in our app we head to our App ADAT
j/s you'll remember we had our
resolutions query right here now this
query is named resolutions but it
doesn't necessarily need to only bring
in information about resolutions in fact
if we were to copy this query as it is
even with the name query in here
resolutions its pasted in here we could
see okay it gives us a resolution but
check it out we could also just say hey
give me the user ID as well inside of
this whole thing this is one of the
cooler things about graph QL is that
well even though this this query is
grabbing us our resolutions we can say
hey give me this other stuff too and in
graph QL is going to know what to do so
as you can see here this looks pretty
nice so let's go ahead and copy this
query back and paste it back in here now
you don't have to do that you could have
typed it directly in your text editor
and that's fine I'm pretty much mostly
do it that way anyways but this way
gives us the ability to confirm that the
actual query is going to return what we
want it to so now because of that we
should have a user prop because of this
line right here brought it into our
react component now this react component
is getting a little ugly but let's go
ahead and not worry too much about that
right now and we can simply have a
ternary operation here operator sorry
Terraria operator and we can say hey if
let's bring in the user prop if the user
dot ID right because null is going to be
a falsie value if the user a dot I dot
ID then we're going to want to
show them the logout button okay so this
one right here otherwise so we have a
colon and then parentheses now in here
since I don't have the ability to use
fragments on this app I don't have
babble setup for it
I'm just gonna make a div right now this
needs to be refactored into its own
component anyways and we can just throw
the register and login form inside of
here
okay so as you can see here let's check
it out make sure this all worked but if
the user ID exists then we'll show them
the logout button if it doesn't then
show them the registration or the login
form again this needs to be in its own
thing and likewise we should eventually
be hiding this resolution form and
resolutions as well but that's something
for another video
and check it out we should now see look
check it out we have our logout button
we click logout and instantly the logout
goes away and we now have a registration
and login forms we can reverse this by
logging in log and user show that as
well so in the next couple of videos
we're gonna be doing some really nice
things here to clean up things a little
bit we're going to show you how to an
extend a type which we haven't done yet
and we're gonna show you how to make a
custom resolvers so that our email
actually returns an email instead of
right now it's not going to really
return anything if we were to say hey
give me the email it's not going to give
us anything just yet that has to do
because meteors email is currently
stored inside of an object called emails
that is an object full of arrays that
has an address and the validated object
and stuff like that so right now just
simply saying hey give us the email
there's nothing that lines up one-to-one
with the user object that says email so
therefore nothing is output so we're
gonna do some custom work to fix that
and you're gonna see one of the cooler
cooler aspects of graph QL involved in
that so as always this is Scott with
level up tutorials I hope you enjoyed
this free series so much if you want to
help support level up tutorial head on
over to level up tutorials comm and
either become a pro or purchase some
stuff from the shop it doesn't matter as
long as you help support I can continue
to create excellent free and paid
tutorial content so thank you so much
and I'll see you the next</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>