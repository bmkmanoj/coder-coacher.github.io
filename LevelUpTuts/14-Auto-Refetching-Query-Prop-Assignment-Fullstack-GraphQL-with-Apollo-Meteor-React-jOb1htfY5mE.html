<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#14 Auto Refetching &amp; Query Prop Assignment - Full-stack GraphQL with Apollo, Meteor &amp; React | Coder Coacher - Coaching Coders</title><meta content="#14 Auto Refetching &amp; Query Prop Assignment - Full-stack GraphQL with Apollo, Meteor &amp; React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#14 Auto Refetching &amp; Query Prop Assignment - Full-stack GraphQL with Apollo, Meteor &amp; React</b></h2><h5 class="post__date">2018-01-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jOb1htfY5mE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">way to pick up where we left off
what we had was basically a form that
will submit something and well we had to
actually call a refetch to get this data
to actually research and now part of the
benefit of Apollo is that we shouldn't
have to do that because if Apollo is
aware of when you are mutating the data
shouldn't it be aware of if that date
has changed and if you want it to well
we grab that data so let's take a look
at some of what we can do to actually
make that process a little bit easier
and I'm also going to simplify the query
just a little bit too we could talk
about some of the things that you can do
within your queries so what we actually
want to do here is first head to the
area of our code which was in a
resolution form where we said hey
refetch am going to comment this out
simply just so we know that the refetch
isn't happening we can actually even
come to our app after it refreshes and
try to add a new one new one submit
nothing happened until a refresh and
then you could see new one shows up
after a refresh so obviously this
refetch isn't happening so let's go
ahead and get this refetch happening
simply within our mutation itself by
well we have to specify the query that
we want to be Rieff etched within our
mutation so we have our constant
mutation right here we defined it as
create resolution but when we actually
use it which is down here and we use
this graph QL tag we pass in and we give
it a name create resolution we can
actually pass in some options as well so
these options
let's do actually a comma here comma
options and options is going to be an
object now inside of this object are all
sorts of things such as update queries
have refetch queries optimistic response
variables all the sort of stuff right
but the one we're most interested in is
in re fetch queries and here we actually
need
tasin an array of strings of the query
name now let's actually head back to our
let's see I believe it was our app J s
where we used our hi query here even
though we defined this constant variable
a high query as graph QL this didn't
actually assign this query itself a name
this high query variable was simply just
the variable or the constant variable
that this graph QL tagged was stored in
the query itself is starts with this
bracket here and we saw an example of
this in our resolution form during our
mutation which was right here and here
we said hey we have a mutation and
here's what it's called and then here is
the bracket starting that mutation so
just like that we could give this a
query and then a name and so this is
where you actually define your name and
this can simply just be well you can see
we can just say resolutions okay it's a
basic name and it's super easy so just
query named resolutions and I'm going to
go ahead and now come down in here into
our mutation under refetch queries and
give this the name of the query that we
want to read fetch which is resolutions
okay so just like this so we're
basically saying here is hey on our
mutation whenever this is actually
mutated go ahead and refetch this query
name resolutions the query named
resolutions is defined right here and we
just passed it in to our graph QL on the
app file so if we had in here to our
application now we'll be able to see
that this query definitively has a name
if you come into your network tab and
click on the graph QL that's right here
and then select headers you can see that
we have well an operation name so the
request payload has an operation name of
resolutions to query named resolutions
and here's all this sort of stuff
so now let's actually see this in action
here if I have a new one which is get
mutation auto-updating submit you can
see now we are now getting this to
refetch the data automatically without
having to tell well manually run some
sort of refetch command that was passed
in via a prop into our resolution form
so let's go ahead and we can now delete
this data dot refetch boom it's gone
from resolution farm and resolution form
right here we can go ahead and well we
can even remove this entire then and
just have a catch here and this should
work entirely just fine now that we
don't have to specify hey go get that
data again but the cool thing is that
graph QL or Apollo specifically gives
you the ability to research if you want
to reach here or you can have it well
hey do it automatically when Yuri
fetches query and we can always just
verify this is working ok so obviously
there are some things like the the text
not removing itself but these are all
little react things are not necessarily
great graph QL specific so I'm not gonna
spend too much time on it one other
thing I wanted to cover in this video is
how to simplify our query in our app dot
j s we simply said hey you know here's
the query and we passed it in via graph
QL on this high query right here for one
let's go ahead and just change the name
of high query I'm gonna remove hai from
the query entirely and we can just
change this to Reza Reza Lucian's query
itself just so it's a little bit more
obvious and what we're gonna be doing is
dealing with this data because in the
past couple of videos what we saw was
when we returned data from graph QL we
had data with a whole bunch of stuff in
it right it had the loading state it had
our actual data sorry I gotta delete
this data dot hai as well
it had our resolutions but it all lived
within data this stuff props data dot
whatever I mean that's a lot of well
depth I think for an object so what
happens if you don't want to have to
deal with data
and you maybe want your data prop to be
passed in as a prop so just the loading
prop or the resolutions proper that in
the data dot resolutions well we can
actually have access to the data that
comes in to our query via some options
here again within this graph QL so you
saw this a moment ago with our mutation
where we got to pass in some options and
you even saw before briefly with the
name but we could even do very similar
things with our queries themselves so
let's go ahead and add a comma here
after the resolutions query and I'm
simply going to have an object now
instead of this object one of the things
we have access to is a property called
props which is where we're going to be
able to assign our props that come in to
our component now you could do a few
things here but the main way of doing it
here is as I simply have a arrow
function that accepts an object we can
do some destructuring here to access the
data and I'm simply going to return an
object now the object that we're
returning here is now going to be what
your props are for instance if we wanted
our resolutions to come in as
resolutions rather than data dot
resolutions we could say resolutions is
now equal to data resolutions now this
is tedious and this is a lot of extra
code just to get well the removal of
this data property coming in here is
there a faster way to do this and
absolutely if you don't need this kind
of control the fastest and best way if
you is basically through plain
JavaScript if we were to say object dot
dot data what this is now saying is hey
give me all of the things that are
coming in data and assign them each as a
prop because we're using this spread on
the object to assign all of our props
now our whole app is gonna break right
now because obviously did it no longer
exists but what we should be able to see
is we should have access to instead of
data dot loading we should be able to
remove data from here and now have
access to loading and resolutions
themselves as props rather than having
to deal
this data stuff so let's remove load
data downloading and data resolutions so
this is a little cleaner what this does
is it's going to make your react
components a little less reliant on the
graph QL stuff because now we don't have
to deal with data right and I just
realized I'm sorry these file names are
getting cut off this is app dot J as I'm
so sorry what we're dealing with here is
now a react component that's simply
looking for a loading State and
resolutions and this component is much
less aware of graph QL because well your
data isn't stuck inside of a data dot
right and so again here's our app code
it's much cleaner and down here is our
query which obviously we had to add a
line of code here but this beats having
data dot everything in my opinion so two
things again refetch your queries by
being able to pass in and refetch
queries into your mutations too and your
queries we can actually give our query
the access to reassign the data coming
in as props via this little slick line
of code right here okay so I hope this
simplifies some things for you in the
next video we are going to talk about
getting this connected to meteors
account system which I know is something
that everyone wants to see because it is
actually it's going to be easier than
you're expecting to and we're gonna do a
kind of quick and dirty with the form to
sign up I hope that is okay I have a
longer-term solution for that as well
but so in the next video we're gonna be
getting an account setup and then we're
going to start having your resolutions
being attached to the current user so as
always this is Scott with level of
tutorials if you have any questions or
comments they become in the video area
pet Twitter or Facebook at level up
tutorials thanks so much for watching
and I'll see you the next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>