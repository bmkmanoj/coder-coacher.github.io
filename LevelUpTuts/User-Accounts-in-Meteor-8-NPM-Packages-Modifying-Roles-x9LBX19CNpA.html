<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>User Accounts in Meteor #8 - NPM Packages &amp; Modifying Roles | Coder Coacher - Coaching Coders</title><meta content="User Accounts in Meteor #8 - NPM Packages &amp; Modifying Roles - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>User Accounts in Meteor #8 - NPM Packages &amp; Modifying Roles</b></h2><h5 class="post__date">2016-04-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/x9LBX19CNpA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up this is scour level up
tutorials and in this video we're going
to bring in an NPM package and we're
going to start modifying our rolls and
we're gonna make some really key
upgrades to our user dashboard so that
it actually gains some functionality so
let's get going on that right now so now
my table should be looking quite a bit
more like yours because I've headed the
styles that should be already existing
in to the repo by now now what we have
here is really just a table full of all
of the users on our website now what's
so great about meteor in general let me
just head to my incognito window notice
how first let's check it out we have 1 2
3 4 5 6 7 users here let's go ahead and
add a new one and we can just have this
be let's go ahead and click register I'm
sorry new @ gmail.com you don't have to
obviously create these many users I just
want to show you a bunch of this stuff
so we can click register and if we tab
back you can see without doing anything
we now have this new user in here I know
that's little but you could now monitor
this stuff in real time with meteor and
that's one of the things I like so much
about it I could come back to my page
after not refreshing and just see who's
registered right and unless we have them
where they're created with their date
we're gonna do this to make this a
little bit nicer here let's go ahead and
use the power of meteor 1.3 by
installing moment dot j s now you can
get here by moment dot J Escom moment J
s comma moment J s and we can install
easily with npm install' save moment or
npm installed moment - - save so from
our project I just have a new tab let's
go ahead and jump to the actual site
itself wherever you of course you keep
this change directories into the root of
your project and we're going to run NPM
in it this is going to initialize our
project with a package dot JSON file
if we can it enter through all of this
stuff actually the first one you can't
because it's complaining about the name
so you can just enter the name it
doesn't want capital letters and you can
just really breeze through all this
stuff because we don't need it right now
when it asked it so okay we can hit yes
now we can head back to our code and we
can check it out we've seen that we have
now been created a package JSON file
which should be empty and just have this
stuff in here that we entered or hit
entered through now what we want to do
is go ahead and install that package so
it gets saved to our packages dot JSON
file and we can do that with NPM install
moment - - save now this is great this
is exactly how normal Java Script
projects and node projects work so this
should be very familiar if you've ever
worked with node and if you have an NPM
installed moment - - save is going to go
and fetch this moment package and save
it into our node modules so now if we
check out our code we should see another
new thing we now the node modules folder
we don't need to access this folder ever
really but inside of it we have a moment
now if we the reason why we have - -
save - that install command is because
what it does is it adds this
dependencies as moment now it's great
about this is is that you can pass this
repo along without the node modules
folder in it as long as the user has a
package.json file they can run npm
install it's going to go ahead and grab
all of the dependencies for them so
obviously this is a benefit to using the
npm stuff and now we no longer have to
rely on a wrapper package from
atmosphere so let's go ahead and now I
users jeaious we get to do something new
with meteor 1.3 we can import moment
from moment this is brilliant because
this is so easy we don't have to have an
it we don't have to have a wrapper
package we don't have to worry about
somebody else updating this stuff okay
let's go ahead and just check out our
site make sure nothing is broken we're
not getting any council errors it's
always a good idea after you install
something new and you try to import it
that way you can make sure that the
import
actually worked okay import seems to
have worked let's go now to our date
function where we can use moment so we
can say date format let's say a moment
which is a function it's going to wrap
around this that created at and now
we're turning this into a moment
variable and now we're going to say
format which is also a function that
we're chaining on here and we can pass
it in a format now the format's are all
listed on moments website the one I'm
going to be using inside of a string
here is mm mm capital d yyy and I also
want to go ahead and just have h H you
might be wondering what this all is
you'll see in a second this is the month
date year and hour but let's check out
what it actually ends up looking like
well as you can see nothing because we
didn't use that helper yet so now we
want to actually use that with a date
format let's come into users change
created at to date format so this helper
date format looks at this grabs the
current created that date gets it turns
it into a moment and then formats it
based on the moment formatting we should
now see nice and pretty created at dates
March 12th 2016 and it was at 3 o'clock
now I'd actually don't need that our in
there it seems sort of a little
extraneous here we can get rid of that
and just have what date they created
their account okay so that's great a
nice little addition here we've now
added moment yes - nicely format our
dates for us in this table here but
that's not really the point of what we
want to do here what we want to do is
have a detailed view for the users sure
we've cleaned this table up quite a bit
but now I want to go ahead and be able
to click on one of these users and
actually manage them now a typical web
application in the past may have done
something where you click on this and it
takes you to a whole nother
age with form fields and stuff like that
but I don't think I want to do that this
time I think I want to do something much
cooler than that when you a select a
current user what it's going to do is
fill a session variable with their ID
and it's going to load that information
up right in this very window here and
you can see exactly what a modern web
application can look like so let's go
ahead and set up this click on here
first let's go ahead and head to our
users HTML let's give this a class of
user ID let's copy this class let's head
to users j/s and now let's make eight
events we can say template users dot
events and this is a method with an
object inside of it and inside of here
we can have a new click event on dot
user ID let's go ahead and grab this
here now let's have a function where we
can just Council log this not this dot
but just this ok let's go ahead and head
back to our site now let's click on a
user ID and you can see we have this
object here which includes all sorts of
stuff includes the entire user object
created add emails profile all that good
stuff what we want to do is set a
session variable so we can say session
dot set and we can pass in the current
user comma and then we can just pass in
this let's check this out now
I'm gonna open up my jetsedder with
command M command M here we can see our
session variables I can click an ID
let's hit over this and you can see
inside of that we have everything of
that user now we can go ahead and click
any of these and as you can see it
updates and changes based on what
we said here beautiful so we now have
all this information anytime we click
one of these user IDs it's going to go
ahead and give us all of this
information let's go ahead and do a
couple of things one this click area
right here is you can't tell us a click
area so I have this user ID class if we
head to our Styles we can always say dot
user ID it's going to have a color of
dollar sign red and it's going to have a
cursor:pointer this is going to ensure
that the user knows that they can click
on it although we might want to have a
hover State you know what this red is
not really doing it for me let's go
ahead and just say blue it might be a
little bit better cool that looks a
little bit more affirmative instead of a
little less you know don't don't touch
this so now we have these blue links
obviously we would want to have some
sort of hover State eventually but we
can click on them and get that pointer
and you could see that we should in fact
be able to click on them cool so we have
this we're getting our value set inside
of jetsetter and what we want to do is
we want to build a div within our table
data here so in users dot HTML we can
really put it in any one of these td's
I'm gonna go ahead and open this last
one just because and inside of here what
we can have is a div with a class of
scroll this up so you can see a little
bit better the class is going to be user
- edit ok and we can close that div out
here inside of this I can put whatever
we want here so let's actually just have
like an h3 that says edit user let's go
ahead and have a button that's just
going to say make
admin ok now this button should only
exist if they already are in Edmund so
we could use our is admin however right
now it's outputting two things right
it's outputting normal and admin I don't
really feel like that needs to have that
normal so we can have either admin or
nothing here so if this is true output
admin so now it's going to output admin
when they are and absolutely nothing
when they're not you almost we have this
big annoying form right here or this
this edit area we are going to do
something about that in a second don't
worry about it but as you can see we
have admin here and nothing so let's
head back to our code in here in users
dot HTML we can use this as an actual
conditional now and we give this a pound
if is admin now what we want to have is
something in here if they're not an
admin we can have an else and then an
and if by /if okay let's go ahead and
have another button in here and this
button can be remove admin now upon
refresh you can see that the current
admin has the remove admin option and
other users have make admin so we're
either making an admin or removing an
admin cool so let's go ahead and write
the helper that actually makes this
button work we can have something like
class of we can have a class here of
toggle admin and we can use the same
class on both of these so class toggle
admin for either/or and let's go back to
users j/s and let's make a new click
event for this we can take comma click
and then we want to say dot toggle -
admin now this is going to be a function
where we're gonna grab some information
we want to actually set the user's role
based on what they currently are now
what we want to do first is check if
the current user is and delete this
counsel log by the way what we want to
do in this toggle admin is we want to
check if this current user is in fact an
admin already we've used something like
that to check with this this dot
underscore ID is admin so when we click
on something we can say if roles user is
in role this ID admin so if they are in
admin we want to roles dot remove users
from roles and we want to say this dot
underscore ID comma admin so this is
going to remove that individual from
being an admin and if we have else here
if they're not currently an admin then
they're going to get the opposite
they're going to be added to the admin
will just copy this and paste this in
here but what this is going to say is
instead of remove users from roles add
users to roles cool so our toggle is
checking to see what their current role
is and then either removing them from
being an admin or adding them to the
admin group let's go ahead and in here
let's go make somebody an admin and
you'll see I get an error add users from
roles yeah that's not correct we need
add users to roles so add users to roles
remove users from roles cool and now in
here we should be able to make someone
in admin but we get insert failed we get
access failed we're not allowed to make
someone else an admin on the client side
obviously this is here to protect just
any old person from coming in here and
saying yeah make this person in admin
make me an admin ok because they would
be able to run this roles on the client
side let's go ahead and now jump to our
methods now we don't have any methods
yet so let's head to server let's make a
new file I'm just gonna have this be
method
jas instead of here we can have a meteor
dot methods we can have a new method by
saying meteor dot methods and inside of
this object we're gonna have our new
method which is just going to be toggle
admin now this is just going to accept
an ID because we need whether the
current user is an admin or not and
let's go ahead and have this brackets
like this so toggle admin ID and now
inside of this function we can paste in
our whole stuff here so let's come back
to our users j/s let's grab all this
stuff here cut it out and paste it into
this method if users and roles know
instead of this dot user ID or this
underscore ID we want to say ID ID and
ID and this is all going to be run
server-side now we can call toggle admin
in users j/s by saying meteor dot call
pass it in the string here which is
toggle admin and we can give this the ID
with this dot underscore ID super cool
now we're not calling the server-side
method with meteor call it's going to
pass in this underscore ID this
underscore ID is going to come in here
it's going to come in as ID check to see
if our role is an admin based on that ID
and then remove or add the user to the
role based on what that is and this time
we shouldn't get any sort of access
error so let's click make admin and look
at that we have an admin and we can just
make all these people admins if you want
but as you can see edit user remove
admin we can click remove it's gone now
let's see what happens when we click
remove admin on the current logged in
user
instantly gosh-darn that is awesome man
that right there is why I love meteor
I clicked remove admin I don't have to
do anything else I'm suddenly not
authorized to view anything super cool
okay let's head back to our page and
let's go ahead and make ourselves an
admin once more you can hit control m
users update your current user comma
admin save it and well once again have
access to all this stuff such as the
user management page we're here we have
our users ok so we have our admin
buttons working and we can now quickly
demote and promote people however this
interface is no good so to advance this
interface I have some CSS for you or
it's actually some sass so I'll give you
a link to a code pen here and you can
paste this in to your sheet here at the
very bottom of styles dot s CSS no I
don't want to actually paste the URL for
that I'll make the URL for this in the
description of the video you can come in
and grab this code or you can head to
the github for this series and just grab
it directly from there but basically
what we have here is we're taking the
user edit object which we created in our
users HTML which is this div right here
user edit and what we want to do with
user edit is we give it a position of
absolute we're floating it left 300 and
we have a width of 280 so it's just
pushed off just a little bit we're also
giving an opacity of none and a
transition as well as a card of 2 which
gives a little bit of a drop shadow and
some padding basically we're just making
this into a nicer looking interface
basically we're just making this into a
nicer looking interface then we have
this close button which is going to
we'll get to that in a moment and then
once edit mode is enabled we're going to
go ahead and give this an opacity now
you might be wondering what's edit mode
okay well I've made something here that
allows you to click this and what we
want to do is when one of these is
clicked we want to toggle edit mode on
so to do that edit mode is going to be a
class on the table itself where this
user edit is
edit mode is going to trigger a couple
of things to CSS wise so let's go ahead
and write that code I'm gonna head to
users dot HTML and all the way up here
at table I'm going to actually have a
class is equal to and inside of here is
a string with double brackets what we
want to do is have a helper here we can
say edit mode okay let's come to user
dot j s and we can have a helper which
is comma edit mode it's going to be
equal to a function this function is
going to return if there is a user
selected right so if we've clicked one
of these and it exists within jetsedder
as session current user if current user
has data see if it's null will get null
but when we click on one of these it's
going to have data so if current user
has data then we're going to output edit
mode otherwise we're not gonna output
anything so we've worked with session
before we can say session dot get
current user and if current user is
equal to anything so we can just have a
question mark here and we can return
edit - mode otherwise return nothing so
this helper is going to just check
globally if current user is has a value
often it does it's going to turn on edit
mode let's see what that does for us
let's come back here and you can already
see some change here we already have
this thing pushed over in an odd way
let's go ahead and refresh this so what
I'm doing with edit mode is I'm really
just translating this whole thing over
to the left and I'm triggering an
opacity change on this form here when we
click this you can see it slides over
nicely and we now have access to this
make admin button well you'll notice a
tremendous mistake here what we have is
this form however it's all of them it's
all six or seven of these however many
of them so obviously this one you don't
even know what this pertain
- at this moment so what we can do to
modify this is let's go ahead and only
have the one that even exists which ever
has the ID equal to whichever ID is
stored in our session let's make another
helper we can say current edit is going
to be equal to a function and this is
going to return and we're going to grab
first session get user so we can say let
user equal to session get current user
now we can say let's return if user dot
underscore ID is equal to this dot
underscore ID now you might be wondering
how does this work here well we're gonna
be using this in our each so it's going
to look at this current user right here
and it's gonna say hey does this
person's ID this number right here equal
the one that's saved in this session
data now we can use that as an if right
here so pound if current edit then show
this stuff otherwise don't show anything
so now not only is this edit the only
one going to be shown on our screen but
it's not hidden with CSS or anything
it's out of the Dom entirely
so let's come in here and now we have
one user and you'll notice it says
remove admin because Scott are scho at
gmail.com is already an admin if I
select a different one you can see it
updates accordingly now we obviously
want to make this be able to close so
let's go ahead and add our closing icon
in here as well we have in log in modal
we had this FA icon close let's go ahead
we can actually
grab the same thing from login modal
it's the icon it's just a fun awesome
icon we can have this in here in our
user edit and instead of closed login we
want this to say close edit mode and we
can save this and now we should see this
thing's going to be in the top left
let's go modify this CSS I'll make sure
this is modified by the time you grab it
so it doesn't look so weird here and the
modify this I want to give this a bigger
click zone so I can say padding 20
pixels pushes it away a little bit
it looks like fur got a semicolon okay
and now you can see we have this X which
isn't going to do anything yet so we
want to have close edit mode as an event
on users j/s where we can comma click
users we can click dot close edit mode
it's going to be a function and check
this out this is gonna be really cool
we're gonna set current user to null
we're gonna set it to nothing we're just
going to say session dad set current
user parentheses here we're gonna say
current user to null
brilliant okay so now what's going to
happen we click this close button it's
going to set our session of current user
to nothing and it's going to close edit
mode because of that brilliant check
that out super cool right so this is a
nice little admin interface we click on
one and we now have the access to modify
them and it's not taking to a note to a
new page or anything we can actually add
a whole bunch of stuff in here which we
will do in the next video now there's
certainly our a bunch of additions we
need to make to this right now if you
were to come to this page after not
looking at it you would have no idea
what user you were currently editing in
addition all we can do is remove our add
admin status to this user so what we
want to be doing is we want to turn this
edit user form into something way more
usable we could delete that user we
could promote them we could change what
they are in the system we could maybe
upgrade their account you could change
their email you could really do anything
and we're going to get into that in the
next video as well
also giving you an indicator of which
user is actually being edited over here
but as you can see this user dashboard
is coming along this is pretty cool
right awesome so as always this is Scott
with level up tutorials if you have any
questions or comments leave a comment
the video hit me up at Twitter or
Facebook at level up tutorials I'm in
over 850 probably hitting up to 900 free
tutorials this since I started level up
tutorials all on YouTube if you want to
have more free tutorials head over to
start at level up tutorials calm and
help support level up tutorials creating
these free tutorials so I can continue
to hopefully hit over 200 or even 300
more videos this year thanks for
watching and I'll see in the next one
bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>