<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#16 Connecting Meteor Accounts To Apollo - Full-stack GraphQL with Apollo, Meteor &amp; React | Coder Coacher - Coaching Coders</title><meta content="#16 Connecting Meteor Accounts To Apollo - Full-stack GraphQL with Apollo, Meteor &amp; React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#16 Connecting Meteor Accounts To Apollo - Full-stack GraphQL with Apollo, Meteor &amp; React</b></h2><h5 class="post__date">2018-01-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MRV_9KnGV_w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we created what could be seen as
like the world's worst user interface
for a login system here but it's fully
functional you can register you can log
in and you can't lock out yet which
actually maybe we should do that really
quickly before I get any further on this
and we can do that simply just by adding
a new button here that just says log out
and when you press it on click it should
run a new function here which is simply
just meteor dot log out and I should
actually we run this like this like this
okay so basically we have an empty arrow
function inside of this on click that is
simply returning the meteor dot log out
method okay and now when we have it here
we should be able to click this have
ourselves logged out meteor user ID we
can log in once more oh incorrect
password well I thank you
okay login right here and you can see
meteor that user ID logged in a ok okay
so I mentioned in the last video that
this video is going to be about getting
meteor accounts talking to graph QL and
there's two components to that process
the first of which is going to be making
sure that the server is aware of the
meteor user and we're going to set in
the meteor user as what's called context
inside of our resolvers and queries
something that we haven't gone over yet
and the second component is going to be
writing our graph QL query so that we
can pull our user data and our schema
and stuff like that so let's go ahead
and get started with the first part of
this now I should mention that part of
this as being taken care of for us if we
would actually head into what was our
our startup and then on the server side
and on their index files are in our
register API file when we added in our
schemas and everything we ran this
create Apollo server now create Apollo
server as you may have noticed came from
me or Paulo package and the meteor Paulo
package is doing some things for us too
well make sure that the current user is
going to be available so if you're not
using this meteor Apollo package then
this stuff will not be available to you
as well as this obviously create Apollo
server but this takes care of this
create a babo server takes care of some
of the complex stuff for us so what's
cool here is that we can now actually
head to what is our client-side files
which is client index dot j s what we
want to be doing is making the user
login token available to apollo so we
start by doing that by creating what's
called an auth link and we're using a
package called Apollo link now we've
seen a little bit of that with this HTTP
link where we said hey here's what the
URI is but we haven't done anything with
Apollo link itself
Apollo link is new to Apollo - and that
basically allows you to use some
middleware right
Apollo link is used for persistent
caching it's used for maybe local
client-side state it's used for all
sorts of stuff and in this case we're
going to be using Apollo link to connect
and to meteors accounts so I'm in my
startup client index.js file and I'm
going to import and I'm going to import
Apollo link and I'm going to import it
from and you probably guess this it's
Apollo - link and you might be thinking
hey we never imported or we never
installed Apollo link well it's a part
of this
Apollo client preset package so we don't
have to have Apollo link installed here
to use it so that's fine what we want to
do here is now create a you can always
if you don't like that install NPM
install Apollo - link if you'd like what
we want to be doing is down here
underneath our HTTP link we want to be
setting a new constant variable named
auth link which is going to be equal to
a new Apollo link and Apollo link is a
fun
which is going to first accept a couple
of values so we're going to have another
set of parentheses here and we're just
going to have the word operation and
we're good then going to have forward
next we're going to have simply an arrow
function here so the Apollo link is
accepting a function and inside of this
function what we're going to do is set a
new constant token is going to be equal
to and here we get to use our accounts
package so accounts dot underscore
stored login token okay and if you don't
want to write all this stuff you can
always copy it from the github that is
in the video description here there's a
ripe opportunities for spelling mistakes
if you're not used to this so we have
accounts that stored underscore stored
login token next we're going to have the
operation parameter here so operation
and operation dot set context is going
to also be getting a I'll say a method
here that is going to accept a function
as well and inside of this function
we're simply going to return an object
an object with the property of headers
now headers is going to be equal to well
another object which we get to give this
as meteor - login - token token okay and
the value of that is going to be equal
to our token that we pulled out of here
so token nice and easy okay let's have a
comma here and let's simply at the end
of this before the end of our earth link
we're going to return our forward
perimeter here forward and we're going
to forward we're going to pass in the
operation itself when I spelled
operation with two peas I don't know
what's up with that let's get rid of
that make sure it's spelled correctly
and this sorry this C should be forward
as we've seen here this new track pad on
the MacBook
is it so large that my thumb just sort
of hits it sometimes and moves my cursor
around so apologies for anything there
this is what we should be looking at
right now we created a new off link with
Apollo link we have our operation and
forward coming into us through this
function we're setting a token with the
account stats stored login token and
we're using operation at dot set context
to store it the token in our headers
meteor login token and then we're
forwarding the operation ok this is a
little the Apollo link thing as a little
bit above this series so I just want you
to have this code snippet here that we
can use now we actually need to use our
off link in the side of our Apollo
client where we created it and here we
simply had link before and we passed an
Apollo League or HTTP link here now we
want to go ahead and pass in our pass in
our a link as well but to do so we need
to use something called from ok so let's
all head up to the top where we imported
Apollo link and let's import from ok
from is just going to allow us to use
multiple things here and we can say from
which is a function that's going to
accept it an array so let's wrap HTTP
inside of an array and we have HTTP link
here let's go ahead and add auth link as
well so we can say auth link comma HTTP
link ok so that seems exhausting it
seems like I mean this whole bit of code
is a little bit skier right it's
especially since we don't really know
what Apollo link is doing inside of this
tutorial series yet but needless to say
we're simply grabbing our login token
and making sure that Apollo is aware of
it using this from author link I'll get
into Apollo link much more in later
tutorials it's definitely beyond the
scope of this one so I mentioned that
there's two parts we had to make sure
that Apollo sort of knew that this user
existed and that it was an actual
authenticated logged in user and that's
what we're doing here between this
and our server register api's file
Apollo is now aware that meteor has an
account system and that we're logged in
and what it's doing is it's giving our
user available inside of the context
object now you haven't seen in context
yet so let's go ahead and dive into
context so let's head to our resolvers
if we head to our resolvers here you'll
remember that we had our resolutions
resolver that told us to find it fetch
you remember we had our create
resolution mutation which had an object
a name and context now just like our
mutation does we also have access to an
object a argument args and context text
okay so let's go ahead and not contexts
context let's go ahead and grab this
context and simply just output context
on our query because context is where a
user information is now going to be
stored on the server this gives us
immediate access to all of the nice
stuff if i refresh this page it's gonna
hit that query again and that query
should now council logout our user which
includes at this point an ID the emails
and the user ID as itself so if you
wanted to grab the user ID or the user
object itself out of context we simply
just need to say an object here and we
could say user ID user ID and let's
check this out when the server refreshes
we can refresh and it's going to just
simply output our user ID keep in mind
this is all server-side so what's cool
about this is that we can now come in
here and say hey find me any particular
resolutions where the user ID is equal
to the user ID now we haven't done
anything with attaching resolutions to
users yet and obviously if we went to
say hey give me something where the user
ID is equal to the user ID it's going to
return a whole bunch of it well nothing
because we even though we're logged in
we've created resolutions we didn't
create them as a user and there's
certainly no property user ID on the
resolution object so obviously querying
for it's going to return a big old empty
array okay so in the next video what we
want to do is actually get our
resolutions to be attached to a user
specifically and that way we can query
and only show the users current
resolutions and what's nice about this
is because it's all connected to the
locking system the user ID is coming
from meteor itself and this is going to
keep our individual resolutions nice and
secure so as always this is Scott with
level up tutorials if you have any
questions or comments and if you're
asking for comments directly on Apollo
link the best I can do right now is just
send you to Apollo links documentation
again I don't want to necessarily get
into the nitty gritties of something
like this just quite yet so as always
this is Scott with level up tutorials if
you want to help support level up
tutorials head on over to level up
tutorials comm and check out all of the
series we have available for there
there's some new excellent series such
as modern CSS layouts or redux and react
for every one that you can get by
signing up to be a pro subscriber and
help support the creation of both free
and paid premium tutorials thanks so
much for watching and I'll see in the
next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>