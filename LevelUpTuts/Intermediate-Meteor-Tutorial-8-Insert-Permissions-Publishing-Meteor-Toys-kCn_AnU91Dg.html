<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Intermediate Meteor Tutorial #8 - Insert Permissions, Publishing &amp; Meteor Toys | Coder Coacher - Coaching Coders</title><meta content="Intermediate Meteor Tutorial #8 - Insert Permissions, Publishing &amp; Meteor Toys - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Intermediate Meteor Tutorial #8 - Insert Permissions, Publishing &amp; Meteor Toys</b></h2><h5 class="post__date">2015-10-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kCn_AnU91Dg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up this is Scott with level
up tutorials and in this video we're
going to actually submit data into our
database finally so using simple schema
using this quick form we're now going to
set some permissions and some rules and
we're going to dive in a little bit how
you can make sure everything's working
so let's get going on that right now
okay so in the last video we had our
auto form generated with quick form now
we just need to get this working right
if you remember we removed in - and we
removed auto publish so to get started
let's get actually publishing our
recipes that way when we do load them up
we'll actually have them working okay so
let's go to our publish dates that we
created a long time ago that was blank
we can type meteor dot publish and now
we can say recipes now we're going to
have a function and inside of this
function we're going to simply just
return recipes dot find so we can say
return recipes dot find and now we're
actually going to be asking for some
things right we want this where the user
ID is the author's user ID so we're
going to say only publish the recipes
that the author is equal to this that
user ID this way only the current users
recipes will be available to them okay
so we now have this published so let's
go ahead and head to our website now
where we can actually sign in and create
an account I'm just going to create a
basic account here
okay so I have an account now and I
should be able to add a recipe you think
right because we have our OTO form it's
set to be inserting into the recipes
collection now what's a great way to
know if your contents actually being
published or not now we want to use a
package called meteor toys at the time
of creating the first video I just gone
through an update and there were some
things weird about it so I didn't have
it in the initial list so now what we
want to do is head to our packages file
and let's go ahead and add a package
called meteor toys now meteor toys is a
really sweet package to have it it has a
whole bunch of extra features in fact
jetsedder is one of those features we
don't need jetsedder anymore because
we're going to be including it with
meteor toys let's go ahead and just
delete that a jetsetter package and on
the bottom line here we can go ahead and
add a package that's meteor toys as the
package owner : and then all things all
things as the package name all things is
all of the packages right so it's more
than just jetsedder it's also Mongo
which is the one we're going to be using
to check out our Mongo database this is
an extremely useful package you just
make sure you check out your command
line to make sure everything is here so
after we have that meteor toys installed
what you can do is hit control m and
you're gonna see some tools pop up this
is really great we have jetsedder over
here and jetsetter is our session
variables it allows you to look at and
modify session various and mangal over
here allows you to look at an update and
delete records in your database so keep
in mind these are only what's published
so we're publishing all of the current
author's recipes as you can see there
are none of them but when we have this
working
you should instantly see recipes being
filled in here I use this package on
every website I use so meteor toys is
definitely something I would highly
recommend okay now let's try to add a
recipe here so we can just say let's say
ahi tuna
sushi okay let's click Submit and if
you'll notice I'm not getting anything
happening but if you open your command
line you'll see an error class and what
we're getting here is an access denied
error and you maybe shouldn't be
expecting that because we've removed the
insecure package from our code we no
longer have a method that says insert
right so what's a way that we can get
around this well a really nice way to
get around this is to use the allowed
denied rules and we can do that in our
collection so head to your recipe
collections and we're going to be adding
to these rules as we update our site
here but we can say recipes that allow
and now this is going to be an object
inside of here and now the value now the
value that we need to worry about is
insert okay so this is going to be rules
for who's allowed to insert into recipes
we can say recipes and this is going to
take a function the function is going to
take arguments of user ID and a doc of
which we don't really need doc but we'll
talk about it in remove now we can go
ahead and have these brackets here like
so and what we want to return is return
exclamation point exclamation point user
ID and how we finish this off with a
semicolon and so what this is saying is
who can who is allowed to insert into
this recipes function well you are
allowed if this comes up true and this
comes up true if user ID exists so if
user ID exists and that means you are
signed in that means you are able to add
a recipe for more complex allowing
tonight when we go to remove an item
we're gonna want to make sure that the
owner of that item is the one removing
it so we'll get into that more once we
do that okay so now that we've added
we should be able to submit our form now
you notice we click Submit here however
we're still not getting any recipes in
our Mangal let's check out our command
line to make sure that there's no errors
okay because we don't see any our error
so let's go ahead and open up a new tab
here I'm going to leave these site
running and I'm going to use ok so once
we're in the root director of our site
we get type meteor Mongo now that's
going to take us to a Mongo shell if we
type help here we can get some different
commands that we can use for instance if
we type show DBS it's going to show us
our databases if we type show
collections it's going to show us the
collections of the current database
since we're using the recipes database
right since we're using the correct
database right now you can see that
recipes is there we can say DB dot
recipes dot find and this is going to
ignore our publish rules because we're
running this command from the Mongo
interface here and if we hit enter here
you can see that our aji to know what's
in fact saved into the database here so
we have saved this correctly so even
though it's not showing up on our site
here under recipes it is in fact saved
into our database so let's go ahead and
find out why it's not showing up well if
you remember we publish our recipes but
we never subscribe to them so let's go
ahead and just overall subscribe to our
recipes on the front end code here and
our client folder and recipes I'm gonna
make a new file and it's simply just
going to be recipes dot J s now if you
don't like having several files named
the same thing you can certainly use a
different naming convention I sort of
like the folder to dictate what an
actual file is but that's just me now
from here because this is already in the
client-side code we can just simply type
meteor dot subscribe and then we can say
recipes like so have a semicolon to
finish it off with head back to our site
and upon refresh you should now see
Mangal
related with your recipe and if we were
to add any more let's go ahead and just
do that I'm gonna leave this on but
minimize it here there we go let's just
say salad it's a salad okay
nothing crazy we'll click Submit you can
see this immediately increments to two
okay so we now have our auto form
completing with the name and description
this is so bare-bones but it's
absolutely working in the next video we
are going to take our simple schema and
we're going to make it quite a bit more
interesting so as always this is Scott
with level up tutorials if you feel like
supporting level up tutorials and our
free tutorials head to store dot level
up tutorials calm and check out the
merchandise we have there thanks for
watching and i'll see in the next one
bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>