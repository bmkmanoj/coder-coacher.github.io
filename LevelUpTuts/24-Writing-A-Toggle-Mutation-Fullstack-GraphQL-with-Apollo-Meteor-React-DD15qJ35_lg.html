<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#24 Writing A Toggle Mutation - Full-stack GraphQL with Apollo, Meteor &amp; React | Coder Coacher - Coaching Coders</title><meta content="#24 Writing A Toggle Mutation - Full-stack GraphQL with Apollo, Meteor &amp; React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#24 Writing A Toggle Mutation - Full-stack GraphQL with Apollo, Meteor &amp; React</b></h2><h5 class="post__date">2018-02-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DD15qJ35_lg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay and so in the last video we tuned
this up a little bit we actually have
our new goals outputting here and they
have checkboxes next to them like this
these checkboxes are though they're not
doing anything so this point what we
want to do is go ahead and actually
write a mutation that will allow these
checkboxes to submit so let's go ahead
and head back to our code and we're
going to head into our goals resolvers
right and we have our mutation object
next thing we want to do is add a new
mutation which will just be toggle goal
okay now tako goal will have the object
and we're gonna pull out simply just the
ID now I'm going to use this underscore
ID here because that's the that's the
way the ID will be in the database is
underscore ID then we can have a couple
of brackets here now the first thing
we're gonna want to do is do a find one
on the ID so you could say goals dot
find one with the ID now the reason why
I'm finding one is because I want to
actually grab the current value of
completed to toggle it I don't want to
send in a new value here so we're gonna
do Const goal is equal to goals find one
with the ID we can then look at the
value of gold dot completed right which
is what we're gonna want to use when we
update so if we do a goals dot update
we're going to want to first give it the
underscore ID comma brackets now we're
gonna do a dollar sign set we haven't
done any updating yet so if you don't
know what set is going to do is the
things that we pass in to set are the
only thing that they're going to get
updated right if we were to try to
update completed equals goals that
completed whatever without using a set
it would override the other properties
but by using set it's going to say hey
only override these ones that we're
telling it to so we're going to say
complete
is now going to be need to make sure I
spelled that correctly is going to be
equal to goal dot completed and then
we're going to say exclamation point s
and hey give me the opposite of that so
we're going to find the current value of
gold
completed and we're going to reverse it
and then set that to the new value of
gold
completed now at this point we can once
again do a new return with the find one
here just like we did before
you could always if you didn't want to
hit your database again you could always
just modify this object itself I kind of
like hitting the database here it
doesn't really matter in this particular
situation considering this app is so
small we're not into sort of micro
optimizations or optimizations really so
you can see here we're gonna say hey
toggle this goal first we're going to
find it then we're going to update it
using the reversed value of the current
state of completed and then we're going
to find it again from the database and
return what we found all while only
accepting an ID here so let's go ahead
and now head to our gold graph QL we're
going to say toggle goal as we define
inside of our schema and we're going to
say we have an ID which is the type of
string and it is required and we're
going to return a goal like this okay so
we have our mutation which is going to
define well that we only need to pass in
an ID and we're going to return a goal
now at this point our app is going to
complain simply because again there's
that issue well maybe there's something
else here yeah the issue where the
schema changes in diagraph cool files
aren't being recognized someone
mentioned that if you use the there's
like a meteor package for graph QL files
I was not able to have that package
doing anything different so I don't know
what's going on with my install but if I
use that package it doesn't actually fix
the issue so as you can see here we now
have
okay our our code is back to normal we
have our mutation defined in goal and we
have our mutation to find in a resolver
next thing we want to do is actually use
our mutation in the goal dot j s now
from gold j s I'm going to copy some
stuff out of goal form specifically the
gql and graph QL dependencies that we
need again I like to copy and paste
dependency so I don't miss type anything
at any point we can do export default
goal is now going to be equal to let's
wrap goal in parentheses and then have a
graph QL you should be a pro at this by
now because we've done this so many
times
now just like goal form if we head to
the goal form page we're going to want
to actually bring in our query we're
going to want to give it a name I mean
our mutation give it a name and then at
this point we're just going to do
refetch queries again so let's head to
here back to gold j s and paste this
stuff inside of graph QL obviously we
don't want to create goal we want to
toggle goal and the name is going to be
toggle goal as well next we actually
want you to define toggle goal again I'm
going to copy just the query directly
out of goal form because why not write
paste this in here and again we're gonna
change some these words to say toggle
goal because obviously that's what the
name of our mutation is now again the
names that we're using here as in like
toggle goal here is just defining this
variable that you're storing the graph
QL query language and this mutation name
right here is just what we're naming the
mutation on the front end of our site
this right here this third-most
inset toggle goal is the one where we
need to have the the actual name the
same as our mutation I like to keep them
all the same name although that's I
don't know if that's necessarily a best
practice or what that's just what I like
to do let's go ahead and delete all this
stuff we're now going to be saying hey
we want a dollar sign ID it's going to
be a string it's going to be required
and we're going to say hey the ID is
going to be equal to our dollar sign I
d I'm not using underscore for the
dollar sign 1 just because it doesn't
necessarily matter I don't think but
okay so check it out we now have toggle
gold which is going to run our toggle
gol mutation and it's going to research
our queries after it does so so the next
thing we want to do is do some sort of
unclick event here where we click our
checkbox and it goes ahead and toggles
this completed state and then we're
going to go ahead and write our updating
to this UI so that this checkbox gets
the value correctly so let's go ahead
and we're going to first off we're going
to have a toggle method here toggle goal
there's a lot of toggle going going on
right now this is simply going to be a
function here and it's going to accept
well nothing really
because all we need to do is run a this
dot props dot toggle goal because that
name comes from this name property down
here and then we're going to have inside
of this function a variables variables
okay now variables is just going to
accept an ID and this ID is simply going
to be equal to this dot
props dot gold dot underscore ID so
we're grabbing the current goal right
the current one that's passed in here
we're grabbing its ID we're passing it
in as the ID variable into the step
props that toggle goal and of course
that's going to come into this mutation
as the ID that's going to then come into
the actual mutation as underscore ID
that's going to head to our resolver
where we're going to find one update it
and then return one so chances are let's
go ahead and see this whole thing
working I'm going to go ahead and on the
check box I've been on click and just
say this dot toggle goal like this and
even if the UI isn't updating at this
point we should be able to check it out
in our graphical we should be able to
see let's add in goals here we can come
in here and say completed okay
so we can see that all of our goals are
false we can come in to react Apollo and
I'm going to click on one of these let's
in here and rerun this query and you can
now see do 10 handstands completed it
true okay do 30 seconds is still false
so one last step to actually get this UI
to correctly actually because if i
refresh this they're all going to be
unchecked
I want this UI to a pollute you know
correctly reef reflect the data here
we're going to have this B we're going
to have the checked property checked is
going to be equal to this dot props dot
goal dot come not component complete it
completed like this okay so check it out
what's gonna happen in is the value of
completed is now going to be setting the
value of whether or not this checkbox is
checked if we click it we're going to
hit this mutation if the mutation
happens we're going to refetch our
queries and all of the all that should
keep our UI updated so let's head back
to our app let's see this thing in
action let's give this a refresh and
still well none of these check boxes are
checked even though they should be one
last thing we need to do inside of our
app J s our initial query we went got
the ID and the name but we did not get
completed okay we didn't ask for
completed in our query so it didn't give
it to us let's head back here and now I
can see that everything is checked is
needs to be checked now we are getting a
little warning in here saying that hey
you'll want to make sure you add either
an on change on change I guess that's my
fault
instead of having a in our check box
my apologies here let's cut to gold J s
I have an unclick in here rather than an
on change my bad
that's going to clear up any sort of
error we have here now we can select do
30 seconds it's going to hit the
database it's going to update our inputs
if we now refresh this you can see that
everything is all good so this is all
pretty cool here this is all writing to
the database if i refresh this is going
to persist because all of these values
are coming straight from the database
we're now have our Tuggle mutation in
here now obviously we're gonna want to
maybe have these things be labels of
these checkboxes so you could click the
code and actually have it do the
checkbox itself these are all small
things and not necessarily things that
are important to this series itself now
the next thing I want to talk about is
well when we check one of these off we
kind of want it to be indicated that
this is checked off right maybe we can
throw a strikethrough on this if you
were getting really fancy you could
animate a div to do a strikethrough for
you but when we check off all of our
individual goals shouldn't the actual
resolution be considered done I mean in
my eyes that's sort of how I envision
this thing working it's like you have
these individual goals you check it off
and then the whole thing is done so what
we're gonna be doing is adding in a
another result that's going to check to
see if all of the goals associated with
this have been completed so in the next
few videos we are going to continue to
improve this interface we're gonna do
another little resolver here we're gonna
maybe talk about some updating
strategies to our cache and then from
there I don't necessarily have anything
planned so if you have suggestions of
what you'd like to see out of this
series further let me know I will be
doing more and more with without meteor
with other systems and reactant Apollo
so fear not if you don't want to learn
meteor here as always this is Scott with
level up tutorials if you want to help
support level up tutorials hand over to
level up tutorials calm I have a brand
new series now available for pros which
is level 2 react native with graph qo
and here I use graph QL with Apollo and
we make some really cool stuff I do a
journaling app that has user accounts
and all sorts of amazing stuff using
react native there's also a reactant
Redux course as well as modern CSS
layouts a lot of great stuff so become a
pro over at level up tutorials for word
level up tutorials calm forward slash
pro thank you so much for watching and
I'll see you the next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>