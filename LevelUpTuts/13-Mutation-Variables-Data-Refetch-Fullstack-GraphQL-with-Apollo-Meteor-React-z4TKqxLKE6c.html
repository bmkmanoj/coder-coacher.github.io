<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#13 Mutation Variables &amp; Data Refetch - Full-stack GraphQL with Apollo, Meteor &amp; React | Coder Coacher - Coaching Coders</title><meta content="#13 Mutation Variables &amp; Data Refetch - Full-stack GraphQL with Apollo, Meteor &amp; React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#13 Mutation Variables &amp; Data Refetch - Full-stack GraphQL with Apollo, Meteor &amp; React</b></h2><h5 class="post__date">2018-01-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/z4TKqxLKE6c" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we are cruising we now have
graphic QL connected do actual server
mutations from the client side using our
new mutation endpoint and what we want
to be doing now is actually passing in
data from this form and sending into the
server for instance if we were to say
you know work out and hit submit we want
this workout to not only be logging here
but we want it to be logging on our
server side because that's where we can
actually do some database entries and
stuff like that so to get started the
first thing we want to do is well we
want to grab this dot name that value
and how do we get properties from our
actual mutations onto the server and we
have to do it through the query language
now we haven't talked about parameters
inside of the query language just yet
but we're going to be doing that right
now in the form of mutations keep in
mind the same sort of thing can exist
for queries themselves if you want to do
sorting and limiting and that sort of
stuff or passing in information that
goes to your server
maybe you're filtering based on a
parameter in a URL this is sort of how
you do that as well but we're gonna be
doing in the context of a mutation so
the first thing we need to do is on the
definition of our mutation this create
resolution we need to first define what
types of values are coming in and we do
so by saying dollar sign and then the
property so we want the name coming in
and and what is the name well the name
is a string and guess what we can
actually insert this mutation without
the string existing so maybe we should
have an exclamation point here it says
hey there's a string and we need it next
thing we need to do is actually pass
that information into the mutation
itself and this right here is where we
actually assign the property that's
going into the mutation from the thing
that's coming in from
this string here so this is a little
confusing but we have name is going to
be set to we keep in mind this isn't an
object this is graph QL query language
here this is graph QL so it's
parenthesis name colon and then dollar
sign name as in the name is going to
come in from this function it's going to
make sure it's a string then it's going
to assign dollar sign name into our
actual mutation okay so take a quick
look at that this is how this is going
you need both of these this is sort of
defining what's coming in and this is
sort of defining the data that's coming
in itself next thing we need to do is
actually pass the stud named that value
into our mutation via our function
create resolution we do that by passing
an object in to create resolution that
object accepts a property which is
variables variables is going to be where
you pass all your stuff such as name
which we're looking for right here and
so name is going to be equal to this dot
name dot value like this let's get rid
of this console log let's save this and
in these two lines here or are these
changes what we're now doing is passing
in a variable into our mutation this is
going to handle it make sure it's a
string and then pass it along to the
mutation itself now there's one little
problem here if you've noticed well it
may not actually notice it yet until you
actually try to submit this but the the
problem is is that we defined our
mutation as create resolution but we
didn't actually given any sort of
definition in here that it can accept
props remember this this type def these
the schema is sort of your public facing
API so by saying create resolution here
you're saying hey there's just a
function you can run but we need to do
is say hey there's a function that we
can run and this function accepts a name
property that's a string so it's going
to say name that's a string and again
this is going to be required
because why would you want a resolution
without a name okay
so we've now created a mutation and our
API is saying hey we're making available
this function that's going to accept one
parameter which is named and that has to
be a string so we are getting there if
we were to go ahead and try to submit
this hello hello I guess submit let's
see what kind of error we get well right
now we're getting an error and I'm
guessing this is actually because I did
not update our register API in the last
video I mentioned or a couple of videos
ago that this file is not importing
correctly right now for some reason so
you need to make a modification to this
register API file before your schema
updates a change this is dumb I'm hoping
this gets fixed really soon
let's come back here let's now send this
and you can see I made a submit and
there's no errors a lot of God hears and
our server so the good news is that
there's there's no errors happening so
it's actually you head to our resolvers
and talk about how we get the data out
of our resolver now and actually modify
the database so what we want to be doing
is we want to say what comes into this
thing well the first thing and I'm not
going to give a master class on this
right now I think what's important is
just that we get our arguments out the
first thing it usually is listed as obj
or object next we're going to have a
comma and you could see it as arcs which
is going to actually be an object full
of our arguments and the last one is
context
okay now we're not using all of these so
just ignore them for now but if we were
to counsel log args you're gonna see
it's an object with our name in it let's
check it out
we can say hi we submit we check our
server and it's outputting an object
with name
so just like any other JavaScript object
we can D structure this and say name and
now we could just say name here and what
we should be seeing is that the name is
coming into our mutation we're pulling
out just the name property and soon
we're going to be able to pass that into
our insert let's check it out once more
and though this is sort of tedious and
unnecessary but when I run this we now
see the actual high I'm sorry if this is
too small to see but it's outputting the
text from our input box on the server so
so what this all means is that we're
sending information from an input on the
client side through a mutation that's
all type checked and all good and is
hitting our server with that actual
string super nice and easy now let's
disco had an uncomment out to this
insert let's replace the name with well
name itself so for inserting an object
you can just have name here instead of
name : name okay and let's go ahead and
do a return and check this out if you
remember what we were doing what we
wanted to return from our create
resolution was a single resolution we
can return a resolution by doing
resolutions dot find one and the one
that we're going to find is the
resolution ID so we're going to insert a
new one into our database collect the ID
then we're going to find one with that
ID and return it again this isn't as
important because we're not doing
anything with this return information
but the graph QL mutation is expecting a
return so we want to satisfy those needs
here okay so let's check it out if this
all works I should be able to insert
something into our database now and say
let's work out submit well not a whole
lot happened if i refresh you can see
that work out actually did show up into
our database and if we do another one
let's say hangout submit okay refresh
there here cool so although I'm having
to refresh every time to actually see
the information coming in this is a
major major progress because we're
actually hitting this form we're
submitting it and new items are coming
into our database okay and since this is
going to be the last video I can record
today let's actually wrap this off
nicely with a nice little bow here by
talking a little bit about the refetch
and sort of what happens after a
mutation so what happens here is that
our mutation actually returns a promise
so we could do a dot then or if your
async/await e you could do something
like that as well inside of our then
we'll have an object that is data and
that data you could see we could
actually do something with our data if
we really wanted to or inside of here if
this was successful we could then
potentially tell this to refetch the
data which you're going to see in a
second we can also do a dot catch and
inside of our catch same thing we're
going to simply just have an error an
error arrow function here make sure I'm
ending and closing all of my brackets
and everything like that so basically if
we wanted to I don't know we'll just log
out an error if we have one but you can
see here this returns a promise so well
we want to be doing this working inside
of our then data if the data exists and
there's no errors like what do we want
to do next and the answer is we want to
refresh our query if we save this and
add one more I'll just give this a
manual refresh just for fun and we can
say let's go ahead and do handstands
submit ok added one more refresh we have
another one ok nothing is broken here
but we want to tell this query the query
that's grabbing all of our resolutions
we want to tell that query to hey man go
refetch that stuff so to do that
actually let's chat head in to react dev
tools here and let's look into our app
inside of our app is a couple of props
let's go into their app component where
we had data and if you remember data we
have things like loading and and stuff
like that we also have something called
refetch which is really what we want to
access here okay so keep in mind that
refetch is inside of our data now
refetch comes from the query itself
inside of our app dot JS component so
the high query is where refetch is
coming from and refetch is going to
refresh this query so we have a couple
of ways we can go about this we can just
pass in all of the props in here as just
the stop props or whatever or we could
say refetch is re missing something
there fetch is equal to theta dot
refetch okay and now we should have
access to refetch as this stop props
that refetch instead of our resolutions
form so inside of r then we can do this
dot perhaps that refetch okay so this
time perhaps that refetch is fetching
this query from app over and over again
every time that we add a new one and
it's gonna cause this to update its data
let's see this thing in action here we
can say test work out do handstands all
this good stuff and now we can say let's
do one more and we'd say drink tea this
is something I already do we can said
submit and you can see it pops up in our
list now this seems like a massive
amount of work to get a to-do list going
if you could think about it like that
but we didn't just do that we learned a
lot about graph QL queries and schemas
and stuff along the way so I want to
make this very clear that I could have
made this list in this this form a lot
faster than what we did throughout these
videos but there was a lot of key points
I wanted to touch on and so if you're
thinking like hey this is a lot of work
is this always this much work the answer
is no once you gain this the feel of
things and you
know that defining your mutations and
your schemas and your queries and your
reusing all this stuff this is going to
feel very very effortless I found
working within the system to feel
extremely effortless most of the time so
yes there are some tedium for instance
on the resolutions form in our
resolutions mutation we had to write the
word create resolution like five times
and that's just that's just part of it
we had to have this and you don't
necessarily have to you could pass this
query in without creating a constant
variable first and we could have had
this mutation defined somewhere else and
we could have just imported this in here
right and reuse this kind of thing but
for all of those little tedium sort of
stuff the the benefits are extremely
nice we get type checking on both the
client and the server side so the
clients going to know what the variable
we're passing in is the right thing
before it even sends it to the API the
API is going to make sure it's the right
thing it's then going to be able to
insert that information into our
database and we get control over when
weari fetch our data so this is all
super excellent stuff and this should be
enough to get you pretty far because
what we've done is we've written a
mutation we've written in it's well
we've done it we've written an insert
hand we've written a find now I'm gonna
leave it to you over the next couple of
before I can make the next few videos
here to attempt to make delete
resolution mutations and potentially an
update resolution mutation go ahead and
just try to do that stuff yourself we'll
go over it really quickly
in another video just but you have all
the tools available for you to do that
so I would like to see you know in the
meantime attempt to create a delete
resolution as well as an update
resolution if you are the type of person
likes to have some challenges here okay
so I hope this is making sense if you
want to go test out this code it's on
the github as always this is Scott with
level up tutorials thank you so much for
watching if you have any questions or
comments leave a comment on the video
hit me up at Twitter Facebook yeah that
that's pretty much it if you want to
help support level up tutorials which I
hope you do head on over to the new
graph QL powered version of level up
tutorials and check out the level up
tutorials store or become a pro and get
access to all of the content available
again there's gonna be a ton of graphic
QL stuff I'm sorry I have to advertise
so much without promoting and
advertising like this this channel and
these free videos could not exist so
take time help out if you can and I
would certainly love it if you would
become a pro subscriber and contribute
to the creation of all of these videos
thanks so much for watching and I'll see
in the next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>