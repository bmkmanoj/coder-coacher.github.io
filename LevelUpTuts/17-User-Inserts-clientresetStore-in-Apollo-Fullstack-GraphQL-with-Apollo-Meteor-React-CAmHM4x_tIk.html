<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#17 User Inserts &amp; client.resetStore in Apollo - Full-stack GraphQL with Apollo, Meteor &amp; React | Coder Coacher - Coaching Coders</title><meta content="#17 User Inserts &amp; client.resetStore in Apollo - Full-stack GraphQL with Apollo, Meteor &amp; React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LevelUpTuts/">LevelUpTuts</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#17 User Inserts &amp; client.resetStore in Apollo - Full-stack GraphQL with Apollo, Meteor &amp; React</b></h2><h5 class="post__date">2018-01-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CAmHM4x_tIk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so in the last video we sort of
connected meteor and Apollo using an
auth link that we created using Apollo's
Apollo link package okay and we did this
all and it only took a few lines of
codes it's a little confusing code here
if you don't know the intricacies of
Apollo link and go ahead and head -
Apollo's Doc's to read a little bit more
about that and what we want to do now is
actually make use of this for instance
we showed here that in our resolvers
file we now have access to the user ID
as well as the entire user object simply
by heading into the context object that
is passed into all of your resolvers as
well as mutations any of that stuff and
then we said hey not only just logout
this user ID but give me all of the
resolutions that are saved with a user
ID as the same as this now obviously
nothing worked there because well
there's no resolutions attributed to
that particular user also right now I'm
seeing this login button is below the
submit button this is all sort of a mess
I'm going to need to take some time to
do some CSS in here let's actually move
this above here I'm going to move it all
the way up to the top here just to keep
it away from the resolution form okay so
just sort of ignore the sort of
bare-bones design here for now we'll
make that better don't worry and what we
have here is simply just a submit button
what we want to do is we want to attach
each resolution that's saved or mutated
here to a particular user again I
mentioned that we have access to the
entire user object as well as the user
ID via context and if you remember we
have context available to us in our
mutation so if we want to say hey give
me the user ID from context and next
time we insert a resolution with a name
go ahead and insert it with a user ID as
well what this is going to do is it's
going to attach the user ID to the
object we stored in the database and
when we go to find it well we should be
seeing all of the resolutions
to buy this specific user so now let's
go ahead and add a new resolution which
is going to be do handstands more enter
submit and you could see it popped up
what's gonna be great about this is well
if we click log out here now we've
refreshed the page you can see that do
handstands more does not show up but do
handstands does if I click login user
incorrect password okay change the
password login user refresh this page
it's only going to show my current my
current resolutions so just like that
we've now added some sort of user
authentication we're saving data to that
specific user but one thing you might be
noticing here is some extreme annoyance
we click login and logout and the data
here doesn't refresh which is super
annoying right because who wants that
that doesn't make any sort of sense in
any sort of practical application so one
thing we want to do is we want to be
able to tell Apollo that something major
has changed in this application and you
know what because something major has
changed you should be reef etching all
of the data not reef etching one query
you should be reef etching the entire
store because let's say you are a user
and you've logged into an upgraded
account such as a LevelUp pro account
you now want to get access to all of
those premium tutorials on level up
tutorials kompy's let's face it who
wouldn't and we want to be able to
actually give you that authentication
now so we want to reset all of the
stores we want to reset all of the
queries all of that data so how do we do
that well it comes through a method
called reset store and that comes to us
via Apollo well we can have access to
that with a higher-order component
called with Apollo that we can import
directly from Apollo with our arts from
react Apollo so if we head to our login
form component and we want to import
and then inside of an object here with
Apollo we can import with Apollo from
react - Apollo now in my own work I use
decorators quite frequently and we
haven't setup decorators inside of this
project and I'm not going to but if we
were you could simply just have this up
top here and say with Apollo and then
have access to everything but since this
project isn't set up yet to use
decorators if you know how to you can do
that we're going to simply need to
output this login form the same way we
have been with our graph QL by doing an
export default and we want to wrap our
component inside of with Apollo and
inside of here I think is just login
form okay so we're going to export
default with Apollo and we're we're
passing in login form - with Apollo this
is going to give us access to some
variables or some props I should say if
we go to our react dev tools and we
check out our login form if I can get
these windows squared away new login
form select this you can now see we have
access to a prop called client inside of
client is going to be some stuff of
which there's really only one thing that
we're super interested in which is going
to be reset store which is a method
that's is it says it's going to entirely
reset the store now you might be
thinking hey why are we putting with
Apollo on login form if we need access
to it within registration form as well
as an app and that would be a good
question so I know we just did this
let's go ahead and move with Apollo from
login form and put it into the app
itself like here with Apollo head over
to look in our login form
if you're under copying and pasting you
can copy and paste this right out of
here again let's export default class
login form okay so and you'll notice we
had our graph QL query in here now we
can simply just wrap our app in with
Apollo just like this and we'll now have
access to the client property with
our actual APA s and we can pass that
client property down to all of our
components so again with Apollo what
this does is it gives us access to a
bunch of stuff the reason I wanted to
show you this is really just because
sometimes the Apollo refetch and all
that stuff well you want to have it
happen globally just like we do now and
to do so you'll want to use this Apollo
client okay so on our app we are now
getting access to client which is going
to again have the reset store method on
it and so let's go ahead and actually
throw that in here so a couple things
let's let's bring this in as client so
we had our button on click where we had
a meteor logout so what we want to do
here is turn this into more of an actual
function here and we'll say hey run
meteor logout first but after you run
the logout we're going to do client dot
reset store okay like that much prettier
do its thing
okay now the next thing we want to do is
pass in a client to our register form as
client client client again client equals
client to the registration form in the
login form or again what we're going to
be doing here is essentially resetting
the store anytime anyone logs in or out
let's head into our register form now we
want to head to our count stack create
user here we had a callback where we
were checking for errors and we could
say if there is no error then run this
stop props dot client dot reset store
now you could pass reset store in here
just as itself but this works fine with
me okay copy this line here so if
there's no errors we're going to run
this step props client reset store head
into our login form dot J s and the same
exact thing if no error then run the
login or the reset store so we now have
reset store firing in three different
ways it can fire on the log
it can fire on the register and it can
fire on the login and what reset store
should do is reset all of our stores so
let's see this in action here as you can
tell I'm logged in because it says do
handstands more I'm going to click the
logout button and just like that our
store is refreshed and all of our stuff
is here we can click login and now and
of course it didn't reset because I had
an incorrect password for like the 500th
time here and we can click login again
incorrect password sorry about that
password and once I click login you
could see it immediately resets our
store okay so we've done it quite a few
things in these past couple of videos
we've made Apollo aware of meteors login
system we have in our resolvers learned
about context where we now have access
to the user as well as the user ID we
can use those in all of our finds we can
use those in all of our inserts and soon
we're going to be using those to help
pull in the current user data in a query
as well and lastly we learned about the
reset store which is available to us
through with Apollo
now with client reset store it's going
to reset your entire store and should
probably be only be used in cases where
the entire store whether it's things
that are secure or not secure whatever
it needs to be reset such as logging a
user in so we used client out reset
store inside of our logout as well as
our login and our registration now in
the next couple of videos what we're
going to be doing is making this
interface it quite a bit nicer right
like the login button should not show up
if a user is logged in as well as these
register and login buttons so we're
going to start writing our graph QL
stuff a for our user itself where we can
then query and get access to our user
data through graph QL on the front end
rather than having to rely on some
meteor stuff like having to type in
meteor user ID in the command line here
cool so that is a lot of stuff as always
this is Scott with level up tutorials if
you want to help support level up
tutorials on how to level up tutorials
common sign up become a LevelUp pro it's
a premium tutorial experience with new
tutorials added every single month you
can see modern CSS layouts react and
redux and let me tell you there's going
to be eight
of graph QL content this year with and
without meteor with react native with
all sorts of cool stuff so if you're
interested in learning more about graph
QL head on over level up tutorials comm
and sign up to be a pro and help support
this content thank you so much for
watching and I'll see you in the next
one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>