<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Learning to Scrape with Python and CasperJS: Episode 3 - User Agents and Such | Coder Coacher - Coaching Coders</title><meta content="Learning to Scrape with Python and CasperJS: Episode 3 - User Agents and Such - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Chris-Hawkes/">Chris Hawkes</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Learning to Scrape with Python and CasperJS: Episode 3 - User Agents and Such</b></h2><h5 class="post__date">2014-03-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hrPR2AhbDbk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys welcome back all right so in
this example we're gonna build upon what
we were building upon before and you
notice that we got a message saying that
our user agent was like now we're using
Safari or something and it's out of date
so we want to get in and change that
user agent to something else I just want
to show you how to do that
after the Casper got required let's go
ahead and just say Casper dot user agent
and we'll say we'll give it a mozilla
mozilla 5.0
all right so we're gonna change that
over to Mozilla 5.0 let's go ahead and
see if we get any sort of different
message from YouTube on that
okay that's good
it looks like I need to update my my
Flash Player but you see the videos
unavailable just because it's not done
uploading yet but that did work propria
doesn't think that i'm safari anymore so
that is how you change your user agent
alright so another thing that we can do
after changing our user agent is we can
actually enable cookies so that we can
try to stay logged in between different
phantom sessions so go ahead and just
say phantom dot cookies enabled equals
true make sure there's not a problem
with that
nobody doesn't appear that there's any
problems with that
all right so after enabling cookies
after we grabbed the start page let's go
ahead and add another variable here
we're gonna call it FS equals require
and then just say FS we're gonna be
adding cookies and that way we can try
to persist our session to remain logged
into a site instead of having to log in
every time let's say phantom dot cookies
FS top right cookies dot txt cookies
I really I'm gonna put this above our
request here
all right and then to retrieve our
cookies file we're gonna say variable
actually I'm today yet so let's go ahead
and just save that for a moment and
watch what happens when we actually run
our application so we see it ran and
view the output exact same but now if we
look at our folder here you can see that
actually wrote a cookies file and
there's nothing in it there's no cookie
stored or anything but assuming the
website required cookies then they can
be written to that file so I'm just
gonna delete that for a moment so now
that I've done that let's go ahead and
see what happens when we go to the video
in question
it's now available but we know that we
click the like button
hey guys what's up welcome to and what
happens on and Casper scraping tutorial
hey sign it so let's go ahead and a look
for this environment using a visual
studio you don't have to use visual
studio you just pause that so you're
gonna right-click to inspect element go
to XPath let's go back to our file and
we'll do the same thing here it's gonna
be a lot of repetitive motion Casper dot
wait for selector XPath is what we're
gonna pace our XPath then we'll say
function Casper got quick XPath
same thing alright so now what happens
after we did that I can say wait for
this XPath so it's going to the same
thing Kasper got wait for selector
Kaspar
and then here what you're gonna do is
the same thing Casper wait for selector
here's where things are gonna get a
little bit different though in this
video what I want to do is show you how
to inject jQuery into your fam scripts
because jQuery is gonna be a lot easier
to be able to manipulate your page using
a JavaScript library that's very
reliable subscribe to jQuery here and
we'll click download jQuery it's gonna
be the one version here so I'll say I'm
gonna grab the compressed version and
I'm just simply gonna copy all this and
so ctrl C in our directory where our
application is let's create a new file
create text document it was really not
the way to do it but go into your text
document created ctrl V and we're gonna
save as switch this to all files and
then just save this as jQuery min j/s
now get rid of the text file that we
just added and now we have jQuery done
men in there
alright to add jQuery we're gonna go to
our Casper create method do an open
curly brace and then in down here we're
gonna say client and then capital S for
scripts
colon and then inside square brackets
we're gonna say jQuery and since it's in
the same directory as our current let's
go ahead and just keep it there and now
that we've done this we're gonna end up
using jQuery now in order to use
JavaScript with Casper you have to have
a Casper method like this so it's Casper
wait for selector function so this thing
it shows up and then it functions
it throws it does the next thing so
inside here we're gonna say this dot
then evaluate and we'll just say
function
and then I'm gonna go ahead and just
give an example we know that the idea is
password so now we can use straight
JavaScript inside this this dot and then
evaluate which is nice so we're looking
for an ID which means in JavaScript you
start or jQuery you start with the pound
symbol for ID and then just put that in
there so password I'm gonna say dot Val
and we'll just say testing I can't give
my password obviously online that would
not be smart but if everything goes well
we're gonna be using jQuery to insert a
value into this ID here so let's go
ahead and see if this works we made a
few changes here so it wouldn't surprise
me if I'm missing something but who
knows we're about to find out all right
so it waited for 5,000 milliseconds
which is the default amount of time for
a wait for selector before it crapped
out on us I'm assuming it was waiting
for this ID selector this XPath right
here I'm assuming this is another good
example of something else that we can do
so by default Casper doesn't give us a
whole lot of information where it craps
out on us you saw it just simply printed
something simple to the screen it didn't
really help but you can turn on some
additional logging just put a comma
after our little jQuery injection there
and we're gonna do it and say verbose
calling and true and then another comma
and then we're gonna say a log level
capital owl debug
I don't need that come on the last month
and so here it's because of the way
Visual Studio is actually in firing this
this script here and it depends
everything at the same time actually
because we're if you remember correctly
it's being called from sub process here
so it's not reading it dynamically is
just gonna kind of steal the whole
output to us so normally if you're
running from like a command line it not
a Python program you're gonna see this
like boom boom boom one thing after
another but this gives you an idea where
things have screwed up so you can see
so you can kind of just go through and
it's saying step six of nine darn and
Kaspar way for time out okay well one
good thing that we can do another
debugging tool is to actually start
taking screenshots of where we may be so
Casper dot capture will just say test2
dot PNG and then I'm gonna do it here
because I think we know that that this
works and we've already seen that in
action so let's just do a Casper dot
capture test1 dot PNG
and we're gonna run this again hopefully
get some better ideas on what's going on
all right so it's not what I was hoping
for at all
what that probably means is that this
it's probably failing right here so I'll
just call this example to proving a
point anyway let's see if that is where
we're tripped up right now
so just as I thought that is where we
are tripping up okay so we're waiting
for this selector we know that that
Joker exists we're able to click this if
that image let me go back to that image
however it doesn't look like we actually
clicked it probably because yeah what's
most likely going on is that we clicked
it successfully we captured the
screenshot at the exact moment after we
clicked it probably didn't even give the
page enough time to actually show a
different click some icon if we actually
said Casper dot wait and then I'll give
it just 3,000 milliseconds for three
thousand after three seconds function
opening closed bracket and we're just
gonna say capture Casper capture example
dot PNG
all right I'll remove this part fire
this thing again
okay
so now you can see it's exactly what
happened we didn't give it enough time
when we did our screenshot but what's a
little bit more concerning is that it's
actually not finding that particular
XPath and the sign in which is
interesting so I do want to leave this
video where we're at we've done quite a
bit of things we've added log level
we've added the verbose mode so that it
prints out more we've injected jQuery
we've actually used a jQuery on this
page although we couldn't see it work in
the next video we will touch upon more
of how we get contact inside of that
additional pop-up modal most likely
that's what's causing the slip-up at the
moment so this also this XPath is
freaking humongous so I'm going to show
you a different method to try to to try
to click that element based on its text
as opposed to such a long drawn-out
XPath because I have run into the
situation where large large x palettes
don't seem to work as well as if I try
to drill down into a more creative way
to select those items so we'll get into
that in the next video and I just want
to thank you guys for watching please
subscribe and if you have any questions
hit me up thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>