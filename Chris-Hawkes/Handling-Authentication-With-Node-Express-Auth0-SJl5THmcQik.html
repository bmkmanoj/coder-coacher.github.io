<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Handling Authentication With Node + Express + Auth0 | Coder Coacher - Coaching Coders</title><meta content="Handling Authentication With Node + Express + Auth0 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Chris-Hawkes/">Chris Hawkes</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Handling Authentication With Node + Express + Auth0</b></h2><h5 class="post__date">2018-04-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SJl5THmcQik" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up so in this tutorial
series what I'm doing is I'm showing you
guys how to use nodejs with Express J's
and also use a third-party
authentication authorization service
called auth 0 which really abstract out
a lot of the complexities of having to
deal with salting and hashing passwords
dealing with encryption or even just
dealing with security standards and
there are a company a very successful
company that is being used by a lot of
major products and things they're not
free but they do have a free account to
get started with you could always custom
roll your own authentication if you
wanted to but I think in this tutorial
I'll be able to show you pretty quickly
that you could interface to a product
like auth 0 and get up and running
relatively quickly and and not have to
rely upon databases and those standards
and like I said the encryption and
everything that you have to deal with
usually when it comes to security
alright guys so let's go ahead and get
started with this tutorial first I'm
gonna go ahead and put this folder and
my tutorials directory under my projects
folder and that's just typically where I
put everything so I'm gonna go ahead and
create an ode folder in here that way if
I do any other tutorials on node which I
am gonna be doing more tutorials and
make sure you guys check out my Python
stuff and everything else I have out
there there's gonna be links to some of
the other tutorials that I do and other
languages and libraries and the
description tab so make sure you check
that out now once I have this folder
here I'm gonna go and create my project
we're gonna call this just node off like
that you know just underscore off and
that's gonna be the name of the project
now I know you guys can't see the font
very well because this is a high
resolution screen but I'm gonna do a
shortcut where I can command into the
directory that we just created and from
here what I need to do is create in a
configuration file which is the
package.json file every node.js project
needs it and it just basically it spells
out everything that that project needs
in order to be able to run now because
we're going to be using a few different
pieces of technology here number one
we're using autho we're using Express
which is a framework but I'm gonna go
ahead and step through this line by line
so we can
actually work on this so let's go ahead
and create the initialization file which
is an it and which is short for
initialization so the project name can
be anything that you want I'm just gonna
call this node off that's fine for me
version 1.0 is fine I'll just say Chris
Hawkes node J s tutorial and then the in
the entry point we're gonna have the
entry point being app j s that's what I
want to call it test commands don't even
worry about that get repository for
right now this will I'll go ahead and
release the source code to github to my
profile but for right now I don't have
one created so I'm not going to do that
from the Chris Hawkes here MIT licensed
and then that looks good that's good
alright so now that we have this package
JSON file what we need to do is use our
editor I'm going to be using Visual
Studio code so I'm going to pull that up
here alright so I opened up the folder
within Visual Studio code and you can
see that we just have the packages out
JSON file that we just created that's
all we have here we need to go ahead and
add a few things though for now number
one we need to go ahead and add some of
the dependencies that we're gonna need
but we're not going to add to this
package that JSON file manually
typically you don't have to manually
edit this file too much but let's go
back to our command prompt and then from
here we're gonna use the NPM save
command to be able to add our dependency
so if we say npm install - - save and
that will add it as a dependency now
there's a few things we need know any
body parser and this allows incoming
streams to be read and we need this for
auto so that's reason one we're using
that we're gonna be using Express which
is a web framework for nodejs nodejs is
just a technology and expression is is
like the actual framework like ruby on
rails or Django then we need express
session this allows us to have session
variables so that we can keep track of
who's logged in so that way every time
you refresh your page you don't have to
real Auggie and things like that so
allowing us to have sessions will
prevent that we're gonna be using
passport which is the authentication
piece that nodejs most nodejs websites
are using passport in some capacity
the passport is just really an interface
to be able to use all kinds of different
strategies when it comes to
authenticating whether you want to use
Twitter Google Facebook well you want to
custom roll your own thing or use a
third-party site that which we're going
to use in this tutorial so that's what
passports doing and because we're using
that third-party tool although we want
to go ahead and add another plug-in
which is called passport auto that
allows that to work well and then
finally we want pug pug is our final
dependency here and that's actually our
view engine for our expression AS web
application alright so everything was
good there except for except for the
fact that auth Oh is supposed to be auth
is 0 that is a typo sorry about that
alright so there we go alright so this
will go through it's probably take just
a few minutes depending on how fast or
slow your internet connection is but
just going across the internet and it's
installing everything that we just said
that we need to it to install but not
only is it just installing those things
it keeps track of every dependency that
each one of those projects that we just
listed has so you don't have to worry
about oh bug needs this this and this
pug is already reaching out and saying
oh I need this this and this and it's
grabbing it all for you now where does
it all go it goes inside of a node
modules folder now so if you look at our
project we have this node modules folder
and look at all this stuff in here this
is all the stuff these are all separate
projects that just got downloaded off
the internet and they all have to work
together so that's some of the craziness
of modern-day web development especially
with node and these package managers
that we have these days that you know
these dependencies that projects have on
one another it's pretty interesting how
reliant there's actually a story that
goes back a couple years ago but there
was a file that was only 16 lines of
code but it was included in referenced
in so many major projects like babel and
a few others and somebody decided to
take that file off of a repository off
of github and nolan and those other
projects couldn't reference it anymore
so it literally broke like half the
internet because one guy removed sixteen
lines of
and it makes you wonder why we're
actually like including dependencies for
16 lines of code and not just like
rewriting it ourselves and that's but
anyway just a little story there all
right so now that we have what we need
here for the dependencies install this
is where things are gonna get a little
bit hairy and this is where things get a
little bit more complicated we're gonna
start adding files now number one we
need our entry points so if you remember
when we created this package.json we
created our entry point you can see that
the main entry point is a pious but
there is no app.js file so when you're
going to add that so I'll be the first
thing that we do now the the the fact
that we're using Express as a web
framework we need to go ahead and
include that so we're gonna stay
constant Express which is it really just
a name of a variable it could be
whatever the hell you want it to be
called but we're saying you need to
require Express so really what this is
doing is it's loading the Express
library and it's putting it under the
name of a variable called Express that
we just created but again this could be
whatever like you could do that but you
wouldn't want to do that you wanted to
be expressed because you just downloaded
Express and you're signed into Express
so it makes sense to call it Express
write next next thing we want to do
we're gonna be using the path path
allows us to quickly figure out where is
your project living right now so
everybody's computer is different you
probably put your file maybe under the
same directory but maybe it's under a
different directory or whatever but path
is gonna allow us to say okay where are
we from within where this file is being
executed right now so which directory
and you'll see why we use that in just a
second now we also need to use our body
parser this is again this is actually
again it's picking up the the incoming
stream from auto you don't really want
to I'm not gonna get into this too much
we just really need to just copy along
right now because it's gonna be too much
of a tangent going down that so the next
thing is session because we are going to
be using sessions again you don't want
to have to real aughh in every time you
refresh your page or whatever so that's
why we're going to be using this
expression and then the next one we're
gonna be using passport which again
that's our authentication piece or just
a require
passport and then finally we're gonna
say we need to add a strategy now
passport always requires a strategy if
you're gonna be using Google or Twitter
or whatever our strategy is going to be
using auth Oh
so let's go ahead and add the auto
strategy we're going to create that
right now the author kind of it kind of
throws me that the the O is a zero and
that's actually the name of the project
so we want to make sure we follow that
same naming convention I think so
at least that's my opinion so that's
going to be the name of our variable and
we are going to require passport and
zero which is really off oh all right
there we go all right so now that we've
done that let's go ahead and I've said
before in order for us to be able to use
passport we need to go ahead and create
our strategy that passport is going to
use so the first things first let's go
ahead and do that we're gonna create a
strategy object if I could type I say
this again we're gonna new up the auth
Oh strategy object that we included and
then inside of here we need to go ahead
and add a JavaScript object and then
this is going to be a bunch of key value
so we're gonna have a key values that we
actually need to obtain from auth Oh so
let's go ahead and touch base on that
right now so I call this product off oh
because it looks like it says author but
it's actually authors eros its I don't
know man
you call it whatever you want but this
product is a third party software is a
service application that allows you to
interface to cyber security experts to
authenticate authorize you can store
user accounts information if you have
credit card information on people things
like that you may be more comfortable
storing that type of data and with you
know a more advanced cyber security
company like Auto said in this
particular video like the only pain
point with this product I think is is is
the price but depending on I don't think
that like most new websites or new most
smaller companies have much to lose by
going out and using the free
account that you can use with with auto
now as you start to grow and you decide
that you know maybe you need to custom
roll your own thing to try to save money
because you don't want to pay for their
service or whatever as you get bigger
although we'll give you like seven
thousand monthly users and and most
websites I'll be honest with you you
probably want some you probably won't
surpass that but if you do then you know
obviously you could pay and it's not
that much but as you get like really big
it starts to become more of a cost but
again it's also a cost to have to
maintain that data and everything so
anyway that's that's the whole selling
point of this product so you need to
actually login or register to it it's
free again so anybody can register and
you're gonna need to actually have an
account here in order for this this
tutorial to work from here now I have
this one application that I went ahead
and created and if you look at the
settings I don't really care that you
guys are seeing the client ID or the
domain I'm actually going to be deleting
this so just for this tutorial don't
really care but you're going to get this
information which is your client secret
key your ID your domain and you're gonna
need this information so once you have
that information that's where we need to
insert that into our strategy so let's
go back and and see what do we need to
insert so number one the first thing we
need to do is we're gonna have a domain
that's gonna be the first argument we're
also gonna need to include our client ID
make sure you have the right casing as
well because otherwise that will also be
a problem because auto expects things in
a particular spelling format obviously
and then we're gonna have our callback
URL and I'll explain this all in just a
second so these are the four fields that
we're gonna need to include in this
object so how do we get our domain let's
go ahead and take a look and then I want
to do these are all just gonna be
strings for right now alright so we're
gonna have our app listen on serve port
3000 so when we launch our Express
application it's going to listen on port
3000 and that is going to be the
callback that we're going to be using
after they log in with auto so they're
it's gonna be localhost because we're
gonna be running the app locally
and it's gonna be ports 3000 and then
we're just gonna have this callback URL
that we're gonna pass to it now let's go
ahead and get our client secret so let's
go back to the website and over here
we're gonna grab this again I don't care
that you guys are seeing the client see
we're cuz I'm gonna be deleting this and
then the client ID let's go back and
grab that and then finally the domain
alright cool so now we need to actually
have this also comma delimited and we
can get rid of the syntax error there
alright so that is the object that is
the first argument that that needs to be
passed to this often Oh strategy and
then the next one is going to be the
callback function that's going to be
called now this is just it's gonna be
just like information that you guys just
don't have any idea about and neither do
I really you don't have to worry about
it this this is all just stuff you need
to actually write it out because it
needs to be there these are values that
are gonna be inserted in the callback
function so make sure you just you just
follow along here but we're not gonna
get too much into this this is actually
an example that is provided by author
themselves sometimes they return done
and no and then we're gonna get the
profile that we get back from Google so
like we're gonna be able to log in with
Google in this example and the profile
that gets returned we're gonna get
information like what is their nickname
what is their their profile image and
things like that so but that's that's
what we're gonna get back and ultimately
this callback function if you've
successfully logged in this callback
function will will be fired and then
this profile will actually be serialized
into our session and we'll be able to
access it from within our templates so I
know that that's that's complicated guys
but like this this is kind of
complicated to be honest like it just is
but if you could follow along I think
the more you do it the more it's just
gonna make sense but anyway let's go
ahead and now you we're going to
use this passport object that we created
up here and we're gonna say passport and
we're gonna say use and then we're gonna
pass in that strategy object and again
the strategy object is the one that we
just created so now we've set out
passport to be able to use that there's
a few other things that need to be done
remember how I said that when we get
that profile object that we're gonna
serialize that into session that's
actually what we need passport to do as
well and that's what this is going to be
doing and again once you actually do
this like one time you guys are gonna
have to mess with this a lot so because
I'm showing you how to set this all up
you're gonna be able to just take this
and you're gonna have a working
authentication system and you don't
necessarily have to be an expert with it
like this code is going to work and and
you'll see that it just will it just
will damn it
all right so that is the first thing
that's going to serialize the user and
then we also need to be able to
deserialize the user from session as
well so let's go ahead and do that
passport deserialize user we're passing
in a function that has a user and done
which is the callback and let's go ahead
and say done which is once again the
callback function and we're putting this
user in session all right so there we go
and once again we're gonna be accessing
this user so that user got image user
got nickname you're gonna see that
that's how we're gonna actually be able
to get that information from from
session and it's automatically gonna be
done and view all these tools all right
so now we now need to tell Express to
use our poke template engine so we're
gonna say we're actually going to create
our our app object which is gonna be
we're gonna new up an express object so
this is constant equals Express so we're
doing up this to Express object and now
that we've done that we can now say
Express I want you to use the pug
template engine so I'm going to say app
dot set and we're gonna save you and
and then we pass in the name hub all
right now we also need to create a views
directory that we're gonna actually put
all of our views into so I'm going to
create that now and inside here I'm
gonna just create my first like index
hug file and you can see that it's smart
enough to pick up on the the Pug symbol
this used to be called Jade by the way
and I don't know if you guys remember
that if anybody's remembers that but
anyway let's go ahead and also tell this
thing to use that views directory so
we're going to save views and this is
where we're gonna be using the path
because I didn't want you guys to have
to worry about you'd be surprised how
often people get stuck with bugs on
these tutorials because they don't put
like their directory names right or
something or they don't have like the
directory hierarchy laid out correctly
so the computer can't find it and then
that like throws them off and they give
up programming forever and things like
that so that's why I'm like using this
path and I'm hoping that this shortcut
even though it's a little bit like
archaic or whatever like maybe
foreign-looking to a lot of people it's
gonna hopefully save time and help you
alright so now we also need to tell
Express now to use the body parser
because again this is going to be used
automatically by these tools so we need
to actually to set that up now so again
just follow along hopefully this stuff
will eventually make sense to you but
right now it doesn't necessarily need to
and then app dot use and this is a body
parser and we're saying to you or I'll
encode it and we're going to be extended
false so we're calling this function
we're passing in an object and saying
extended is false all right guys so now
that we've done that what we need to do
is go ahead and initialize our session
and again because we're using Express
session this is what we're doing right
now we're actually initializing this new
session object that we created and it's
just a function and we're passing in an
object and the object has a again a
bunch of values and the first one is
this secret value and this could be like
whatever you want it to be but it's
gonna be like your secret key and
it should be private to just your app
and other things should not have it
because of some latest changes we do
need to pass in two more arguments which
we're gonna say resave because otherwise
it's gonna throw a flag saying you
didn't specify it so resave is gonna be
true and then save uninitialized is also
going to be true and again that's just
to prevent warnings when we fire up our
expressjs application let's go ahead and
close off that statement so we're done
there now finally we need to tell
expression has to use passport again we
told passport how to use auto but now we
need to tell Express how to use passport
so we're going to say app dot use and
this is where we're going to passport
initialize and this is a function so we
need to call it as a function and then
we're going to say after I use a
passport dot session and this is that
session object that we just created so
that's going to allow once again our
application to be smart enough to not
have to allow somebody to have to real
aughh in every frickin time now also
though how does this damn thing check
every time you refresh well we need to
create an actual function that's going
to be called that's going to check
whether or not a user is logged in every
time a page is requested on our
application so we're gonna say app dot
use and here we're passing in a function
that is the request and the response and
then the next where it's goes next a
callback function all right so here
we're gonna say this is um this is going
to be where we actually create a session
variable that we're going to be using
inside of our poke template to figure
out whether or not somebody is logged in
or not it's simply just a true or false
which means in programming speak boolean
or Bull so it's true or false but how
that is set needs to be determined every
time a page is requested and you need to
know whether or not that person is still
logged in the the client browser doesn't
like know that information has to come
from the server so that's what we're
doing right now so we're gonna say
resource dot locals dot logged and and
this is the name of our variable that
we're creating and it can be whatever
you want it to be but I'm gonna be
calling it logged in because that's
pretty descriptive of whether or not the
mother effer is logged in right
I'm just playing not trying to custom
anything and in fact I didn't cos I held
back requests
session passport and type now this this
part here this is a double if check that
you're saying that you know request that
session is going to be there but you
need to make sure that that passport is
initialized because you don't want a
reference passport if it's not there and
then furthermore you don't want to
reference a user which is on top of
passport if that is also either not
there or undefined and really it doesn't
matter if it's not there it's it's
undefined so that that would be fine so
let's say request session dot passports
and then we'll say that user remember
this is getting serialize into an out of
session if you remember we just did that
and we're gonna say as long as it's not
equal undefined that's yeah this should
work so if that's not equal undefined
they're gonna say resource locals logged
in equals true so we're changing the
value so it's it's false by default but
if these bugs are logged in it's going
to be changed to neck to true and then
we need to actually fire file or god I
can't talk we need to fire our callback
function afterwards no matter what and
we're gonna be calling that and that's
really just the next page that the app
should go to alright so there I'm gonna
have a space I like to have a space
after all my ifs and really any time I
have an if I usually have space above it
as well I'm not sure I think that's the
Python and me like that Python days just
all that white space alright so let's go
ahead and try to wrap this up to the
point where we can actually get this
thing to start listening and fire it up
and make sure it's working so we're
gonna say listen on port 3000 and then
let's just console.log a message that we
know that the server is running and just
say your server
running it's usually helpful to say on
poor 3000's well just to whatever port
just in case because they they don't
know unless they look at the source code
or whatever so depending on who is
looking at your app that would make some
sense now also let's go ahead and create
a home page that we have some something
to actually deliver and we're gonna say
that that apt I get now with nodejs this
isn't really a nodejs tutorial we're not
trying to do anything basic it's about
authenticating with node but this is
just setting up your route so you're
saying the forward slash is the home
directory and this is request response
and then next again so you get used to
that whole callback request response
next within nodejs
alright so this would let's just say
we're gonna deliver the index now
because we told it to use Pogue it's
gonna know to look in the views folder
for this index and then here we should
probably just say hello world just for
right now
let's go ahead and see if we can run
this app so let's call pull back up our
command prompt and in here let's go
ahead and run our app so we're gonna say
node app you can see body parser is
deprecated I need to look into that I'm
not sure but don't worry about it's just
giving you a warning it Saints
deprecated you can still use it but it's
basically saying you better find an
alternative because it's not gonna be
supportive very much longer and for
whatever reason that is it's just that's
the way software works it happens maybe
the one dude just decided to get a
girlfriend and doesn't want to maintain
the project anymore you'd be surprised
some projects can in that way as well
but anyway we have a working web
application Express - yes no js' and a
lot of that stuff is going on we even
have session going on behind the scenes
that we're going to be using in just a
moment alright because we're gonna have
a few pages of our application what I
want to do is use the layout ability of
Pogue in order to be able to save on
some code reuse so it's going to create
a file that we're just gonna call layout
bug and inside of here this is where
like the bulk of our code is gonna be so
we're gonna say doctype HTML now if
you've never used Pug before I actually
don't like it very much I don't
like the whitespace even though I come
from a Python background I think it's
just like I just think it's it's just
really bad I'm not sure like I can't
really describe it I just don't like it
anyway but what we're going here is
we're actually defining our HTML
elements within poke so this is not a
pug tutorial but it's something that
needs to be done what I want to do is I
want to use a CDN which stands for a
content distribution network and it's
really just servers that are cached set
up to cache like JavaScript files things
like that and what we're going to do is
we're going to include the bootstrap CSS
and it's going to be on the the
bootstrap CDN so if you want to pause
the video for a moment and just actually
write out this direct URL I want to be
able to have some pretty style and and
bootstrap provides that so that's what
we're doing here I'm also going to
include a script tag and we're going to
do it the same way the source is going
to reach across the web and it's going
to go to the CDN of of auth Oh to use
their their authentication their
JavaScript authentication to communicate
with their servers so that's what we're
doing we're including that in our layout
file let's go to our body and inside the
body let's add a nav and the nav bar is
gonna have a container class as well as
a navbar class na navbar expanded and
this is all just a boot this is gonna
provide us the bootstrap navbar and
you're gonna like it when you see it
it's gonna be pretty cool I'm just
better better looking than obviously not
being styled at all so if you just
follow along with those classes that's
all we're doing is we're just adding
classes to a navigation element and now
we're adding an anchor inside of that
and we're gonna say navbar
brand is the I will just say Chris I'll
just say Chris ox that's fine now let's
add a this is we're creating our actual
we're going to create our top navigation
menu so that's what we're doing right
now and I'm gonna have this B collapse
I just I don't know why that keeps
deleting like that stop doing that all
right let me add my UL element in here
all right and and then here is our
anchor so we're finally getting to
actually where we can say what is the
actual friggin anchor to this but we're
almost done we have nav link and this is
our home link so I want you to be able
to follow along you're gonna be adding
anchor anchor tags like this but let's
go ahead and take a look at what this
looks like but before we can do that we
need to tell the index to actually use
the layout file so we need to at the top
the first argument you need to say is
extends layout and that's going to tell
it to bring in all the layout code and
then go ahead and inject this here but
where does it inject hello world it
doesn't really know we need to actually
create a block from within our template
and we're just gonna call this a block
of content and that's where HelloWorld
is going to go and we need to actually
tell also the the layout where should
the content go so we're gonna put that
outside of all this stuff like we want
to go back basically after the body and
we'll just say block content that should
be fine it'll inject it right there all
right so that should work now if we go
back to our server and try to run it so
if we look at it we can see that we have
some styling going on here but it's not
exactly what I was looking for I was
hoping that the thing would be all the
way across and I believe the reason why
is because this is actually a typo I
said expanded it's supposed to just be
expand and that's actually going to I
think fix the problem another thing too
is we shouldn't have to like refresh the
server every time you can see that
actually that expand help solve the menu
issue and the menu issue and the reason
why we're using those classes in
bootstrap is you can see like this
automatic shrinking in the and
responsive aspect of the website and
everything it's all controlled by
bootstrap and that's typically what we
want these days but we don't have to
want to have to write all that CSS and
that's what bootstrap is doing for all
right so now that we've done that let's
go ahead and add a few dynamic links to
our navigation menu number one we want
to have a profile and a login button and
then we also need a logout item as well
for when they're logged in they want to
log out so we need three links that we
need to add but what we're gonna do is
reference that variable that said
whether or not the user was logged in we
created that in our app j/s file and
we're actually gonna go ahead and use
that now so we're gonna say if logged in
and remember it's it's false by default
and it's looking to see if the session
variables exist and if they do it
changes it changes it to true
so all were simply saying is if it's
logged in now we're gonna say add a few
nav items so we're adding this and then
a the href here is going to point to our
we're gonna create user endpoint so
that's essentially going to be the
profile page and it's gonna be a nav
link and then we'll just call this
profile all right and then if they're
logged in they also need the ability to
be able to log out so we're gonna say
nav item again and then here we'll say H
ref equals forward slash log out and
again nav link and then we'll say logout
all right so those are the links now
let's give it the else condition that
way if they're not logged in they have
the ability to see that they can log in
so we're gonna say Li nav item and then
down here H ref is going to be login
alright so that looks good so let's go
ahead and and see if we get any errors
um you can go back to the app run it and
you can see that we're logged in because
we don't have or it says logged in
because there is no we haven't logged in
so it knows that you know it that the
logged in very
from weather application is is false all
right so that's good that's what we want
all right let's get back over here and
you saw that we made some obviously some
end points in here we have this user we
have a logout we have a login we have
this this forward slash the only
endpoint we have available so far is
this forward slash in our app and that's
our home root directory so we need to go
ahead and add the other URLs that are
going to be and necessary in order for
this app to run and you may also
remember that we we added a call back up
here and we have this callback URL so we
also need a callback end point as well
says another endpoint that we're going
to be creating so let's go ahead and do
all that stuff now and this is where
this part is going to be another
complicated part that you just really
have to kind of follow along on because
it's difficult I'll try to explain it
but let's go ahead and say like let's
create our app login endpoint so we're
gonna say app get and enforce slash
login
so in this one is um is a bit different
because instead of this function we're
actually going to be calling passports
authenticate functions so that's the
function that we're passing in but
that's a complicated beast of a function
you have to pass in a bunch of stuff so
the first arguments are saying Auto is
the way you want passport to
authenticate this and then you're going
to be passing in an object and this
object is going to have a bunch of stuff
on it so first is going to be the client
ID so we need to go ahead and grab the
client ID which we had up here we could
also reference it because we have this
this strategy really we could have
probably just created an object in fact
I'm going to do that now I'm not gonna
just for right now I'm just gonna say
constant we'll just say my Barr's equals
all right so we just created this this
object and now I can reference down here
client ID we're gonna reference the
object and then say client ID all right
so the next argument is going to be the
domain and then here we're gonna say the
same thing next one is the redirect and
this is redirect URI and then here is
going to be pointing to our callback so
really I could just reference that as
well my VARs dot callback and the
response type is going to be called code
and this is just for passports auto
object it just configurations for auto
so just follow along and then this
audience here this is where you need to
pass in your actual domain so it's it's
going to be the domain name at Auto comm
and then user info is the forward slash
so I'm actually going to call
in there so I don't mess that up I'm
grabbing this from the the actual
website of Otto and it's inside my
settings all right so now I'm actually
saying the final cryptic thing that
probably makes no sense to anybody open
ID profile that's really all we needed
there all right then the final argument
is going to be our callback function
this is a request response and this is
just going to be the function that is
fired after they have been logged in and
it's going to redirect them you could
redirect them anywhere you want but
we're going to redirect them to the home
page I also you clean this up
all right there we go so that is the
login function I know there was a lot of
information there I think that my VARs
is just it's just a shortcut you don't
repeat that information over and over
again all right so now that we have that
let's go ahead and create our log out
functions or ease the app dot get log
out we're gonna say request log out and
this is a built-in function and then
we're gonna redirect it back to the home
page as well
all right that's probably all we need
for the logout and now let's go ahead
and create that callback function that
we've referenced earlier so let's do
that get a callback now this is going to
be a relatively interesting as one as
well because if you if you fail
authentication we want to be able to
handle that relatively gracefully we
want to deliver some sort of failure
page instead of like giving them no
indication at all that something bad
happened because it wouldn't actually
know to tell you that like they didn't
they failed in a authenticate or
whatever so let's go ahead and the first
argument for this is going to be
passport dot authenticate
all right and then what we want to do is
pass in an object and we're gonna
specify where it should redirect to if
it if it fails so we're gonna say
failure redirect and then we're gonna
just tell it to go to a fail your
endpoint and we'll create that and the
failure is just gonna for just the first
simple purposes we'll just say oh you
failed the log in or something just just
basic like that and then finally should
they not then it's gonna go ahead and go
along to where it originally intended to
go and that's going to be to the users
profile page which we put we're gonna
put under a URL of user just that's
typically where you see the profile I
think on websites usually have like I
think it's user right on Stack Overflow
you guys could tell me I'm not sure it
doesn't really matter it could be
anywhere you want it to be all right so
that's pretty good
all right yeah that looks pretty good
for right now so let's go ahead and
create the user endpoint for the profile
now here we're gonna actually tell it to
render a view page that we haven't
created yet we're gonna create it we're
gonna call call it user and what we want
to do is we actually want to pass down
the user object to is a template because
we're gonna reference it and this user
is serialized to and from again by
following along in the code it's going
to be to it serialize to and from
Google's data to our session variable
and then reference from within the
templates and that's how we're gonna be
able to display like their and their
nickname and like their profile image
from Google if they log in from Google
all right and then I guess we can go
ahead and create the failiure endpoint
it's not exactly like I've just to make
it a little bit more robust in case you
guys take this example and like
immediately start making it into a
website you should definitely have some
sort of fill your endpoint I think and I
guess we'll just create a failure page
that'll work alright let's go ahead and
create these endpoints that we need so
we need a user and we need a failure so
new almost a failure pug and then user
pug our failure page is gonna be
relatively basic we're just gonna have
like an h1 that's all I care about
we're gonna extends the layout you have
to make sure you do that otherwise
you're gonna be missing a lot of your
styling and then inside the block
context again everything asked me inside
of a block once you're using Excel a
outs and extensions and we're gonna say
we'll use the danger text which is like
a dark red color within bootstrap and
we'll just say an error has occurred
with you authenticating your
all right there we go now let's go to
our profile and this is what we're
actually going to display the nickname
and in the profile image of the user so
it's going extends the layout again
block content again div we're gonna do
container classes the bootstrap class
and now some I hate how it does that
maybe I don't need to do that but it it
pisses me off really pisses me off how
it does it
don't do that all right I'll have to
look into that I'm not sure why it's
doing that if you guys know please leave
a comment because that would save me
time having to figure that out later all
right so now I'm just simply doing some
styling here I want to be able to just
say hi and an h1 and then here we're
actually referencing the user object I
got serialized to and from a session and
Google is providing a nickname that
we're going to be able to display inside
of this h1 all right and then let's do
one more row it's absolutely killing me
make sure you guys leave a comment if
you know why it's doing that
and then here's where our image is going
to be showing up so we're gonna set our
source is going to be the user that
picture again this information is being
provided by Google so you don't even
have to store it on your servers it's
actually coming from Google servers but
they're giving you the location to where
you can find it for any particular user
that logs into your site so that's
what's cool about that this is just
where where you will alright anyway
that's that's good enough for this I
think we're we don't need too much
detail here I just want to see this
thing work and so let's go back to our
application and see what happens so it
looks like I was still just hello world
I'm gonna get rid of this hello world
and I don't like that
all right here we go so let's go ahead
and login now and we cannot get login so
let's go ahead and restart our server I
did not restart my server if you're
changing and adding URLs and such you
have to actually restart the server you
can get something called no daman which
is gonna actually restart automatically
for you if you want but right now we
don't have it I don't want to add
complexity where it doesn't need to be
this is already a relatively complex
subject alright so now we're gonna be
able to log in with Google and then from
here we're going to check the whatever
account you want to check in I'm gonna
use this one and then you can see it's
redirecting to our user page so because
I have sessions enabled I'm able to
refresh and you can see it's still
logged in it knows that I'm logged in I
can even change the page go back to
profile it's still logged in this is the
nickname that we were referencing inside
the template this is the image and again
profile we log out you can't get to the
profile page anymore you can log right
back and it all just works so the main
main benefit of this and is really just
this simple fact that you can restrict
certain pieces of your website to
certain users and you can actually have
to not deal with the headaches of you
know SSL dealing with the like these new
cryptography standards sha-256 whatever
it is you know even encrypting and
decrypting password salting hashing all
that crap there's a lot of stuff that
goes into cyber security obviously
within to you know users credentials and
everything it's very important obviously
like from every government every major
business credentials is one of the
biggest things it's one of the things
that companies pay a lot of money for
that's why this product exists I
actually recommend you probably use it
at least out of the gate especially if
you're new one of the reasons why PHP
got such a bad rap as a language is
number one it's a piece of lying
but number two it also has they had
major security flaws because people were
just they weren't they weren't locking
down their systems and they were
releasing it to the public which is
terrible but with this particular case
this product you're gonna be able to
kind of avoid that you could custom roll
your own authentication probably no
issues you probably nine times out of
ten you're knocking up a problem but
when you do and you become a big enough
company it's gonna be a problem
and it could even sink you depending on
how bad it is but anyway guys thank you
for watching make sure you subscribe
make sure you vote up and have a good
day take care of I so this video was
brought to you by a dead mountain coding
boot camp there are a boot camp that is
based out of Utah but they're also in
Texas in Arizona now and they have very
good reviews so make sure you guys check
them out the link is in the description
tab below they offer courses in web
development iOS development UX or user
experience design Quality Assurance and
just a few other ones in fact they're
even getting into Salesforce as well now
so they're continuing to adapt their
courses based on what the market needs
are and major companies are hiring some
of their alumni so make sure you guys
give them a look they have great reviews
and thanks for watching bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>