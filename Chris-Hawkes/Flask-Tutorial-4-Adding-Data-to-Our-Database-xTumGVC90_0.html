<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Flask Tutorial - 4.  Adding Data to Our Database | Coder Coacher - Coaching Coders</title><meta content="Flask Tutorial - 4.  Adding Data to Our Database - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Chris-Hawkes/">Chris Hawkes</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Flask Tutorial - 4.  Adding Data to Our Database</b></h2><h5 class="post__date">2016-01-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xTumGVC90_0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up welcome back so in
the last video we went ahead and we set
up our database in this video we want to
look at HTTP methods I don't know if I
just said three T's I meant to say two
HTTP methods so HTTP methods they may
consist of like get post put patch and
most the time you're just going to get
and you're just grabbing some data
basically whenever you're not making
changes to data on the server you're not
trying to persist something you
typically do it get and anytime you like
go to YouTube or something you're mainly
doing and get now if you're uploading a
new video you're actually posting and if
you're updating your profile on Stack
Overflow you're going to be posting data
to the server because you're changing it
and that data needs to be persisted and
by default all these methods that we
define like right now we only have one
we have our our home page method and by
default it's only going to allow and get
so if I wanted to allow a post I need to
actually pass in an argument after the
URL so we're going to have actually
we're going to create a new URL to post
to and it's going to say post user and
after that we're going to add an
argument really need one comma here and
it's going to say methods equal get or
post so we're allowing gets and post and
really we don't want to get on this
because this is just going to handle
posting our user and we'll call the
method the same thing so we'll call it
post user now in the index method that
we had before we were actually passing
down static HTML we're typically never
going to do that it's just terrible
Flass comes with a template engine which
is called Jinja too and Jinja too is
pretty good and we're going to go ahead
and make use of that now so let's go
ahead and import render template which
is going to make use of
so from flask I import render template
and we're actually going to return that
now so instead of returning all this
static HTML we're going to return a
template that says
and user HTML and automatically it's
going to look for your templates folder
inside of your root directory so let's
go ahead and add a new HTML file right
now and we're going to call this add
user and inside of the body we're going
to do the form method equals post
then we'll give it the action equals add
user so we're telling it go to forward
slash which is where director and then
go to add user so if we go to app dot py
you can see that it's not actually right
it's post user so if we call it the
right method we're saying post user so
it should hit this method here and we're
telling it to do a post action so
anything inside of the forum which will
say like input name username type equals
text so this is all just a standard crap
here instead of a label we're going to
say user name and then we can copy this
same line for the email
and I also want to give it the name so
the name is going to be the same thing
as the ID so username then down here
name equals email all right so there's
our basic form and now we just need an
input type of a submit all right so if
everything goes well this template is
going to be rendered using jinja okay
also because I copied this code we want
to get rid of name we're actually not
making any use of that right now so now
if we restart our server and we pull up
our HTML you can see that the template
is now being rendered using Jinja and we
have this basic HTML form it looks
terrible but we're not worried about
that right now we just have user name
and email so what we want to do is we
want to update this post method so we
can actually add a new user of data
that's actually posted to this method
once we hit submit on that form so let's
go ahead and do that now so under the
method we're going to say user equals
and we're going to reference the actual
user class object that we've already
defined up here which is what our
database schema is created around and
then we're simply just going to put the
two values that are going to be passed
in so we have the first values gonna be
user names second value is going to be
email we don't have to add the ID that's
done for us automatically so you're
going to ignore adding that value now
you're probably wondering how do I get
the data from the form that's posted
well that's what we're going to be doing
right now all you have to do is we're
going to reference it like this request
dot form and then we just give it the
name so this is a username and then
we're ready to same thing across that
form name and then this is email
all right now once you actually populate
this user object it's not going to save
it to the database so we actually need
to explicitly save it once once we're
done adding those values so we're going
to actually use our DB objects we're
going to say DB session and then dot add
and then the name of the new user that
we just created and then we also then
need to so I'm sorry that's actually
adding it to the database so this is
creating the object that we want to add
this is adding the object to the
database and then we're going to save it
by saying DB session commit so we did a
lot of changes and we're going to go
ahead and run this thing to see if it's
if I'm missing some things I haven't
done this really ever so for it to take
effect we're going to restart our server
we're going to pull up our page test is
going to be test 1 and test at test com
click Submit and we get this internal
server error so obviously something went
wrong we have no idea what it was this
tells us that we have some sort of 500
error and then if we went over to our
database and we refreshed everything if
we looked inside of our users we can
right click and say view data view top
500 to top hundred you can see nothing
was posted so something went wrong
something's definitely not right and the
problem that we have right now is that
we actually don't have the server turned
on to give us any sort of useful
feedback if there is a problem so we're
going to look at turning on debug mode
and we do that by actually going up to
before we actually run our app we'll
just put it underneath the config
actually and we'll say app debug equal
true and that way we restart this thing
we'll see if we can get any sort of
helpful message so you can see debugger
is now active so hopefully we'll get a
better
message than what we had before so if I
said submit and you can see name request
is not defined so obviously for
developer sanity it's good to have this
debug mode it has this nice little
pretty error that tells you what the
problem is instead of giving the generic
500 if you're in the production
environment you out you don't want to
give a hacker any sort of information
that they could try to exploit your
website with so that's why they give you
just a standard 500 even though flask
itself knows what the problem is it's
not going to release that information
because that will cause a problem so
what it's saying is we need to import
the flask the request object from flask
and this allows us to get the whole
request body that's posted with that
form and then from that that body that's
posted we actually can reference the
username portion of the body and the
email portion of the body and that's
just how typical forms are posted and
everything in a web world so it's going
to do this again we probably to restart
the server
so it's actually waiting it might be
choked up we probably should have
restarted it I'm going to do that
now this says method not allowed and the
reason why is because post user you can
only access it via a post and right now
we're not posting a tree using the
browser and it's just doing a simple
gate and we said only post methods are
allowed and that's really the way we
want it because I mean that that method
is only you know looking at posted data
so anyway let's try this again
so now we get a new message that says
view function did not return a response
and these are all good error messages
because this tells us a lot about how
flask works every request that flask
gets it expects to return a response
object and what we did is we added data
to the database but then we never
returned anything and that caused the
error and I wouldn't be surprised to see
the data in our database because we had
a chance to actually save it but then it
blew up after that because I said oh
 you didn't return anything so you
always have to return some sort of
response back and what we wanted to do
probably say like return redirect and
then we could just simply give it the
name of or the location of the URL that
we're looking to redirect to so it's
going to match the home page so if
everything went well it'll go right back
to the forum so in order to be able to
use redirect we actually need to import
that as well so after request we're
going to say
yeah that should work right there you
know we can actually double up all this
stuff we don't get sloppy when you have
all that you can double it all up just
like this and get rid of that
technically even put flasks over here
too but we're not going to do that so
let's go ahead and see if we get a
better result now we did get a
successful save to the database which is
cool so let's go back to our home page
now we're going to add test to test two
at gmail.com URL for is not to find
son-of-a-bitch we've needed
oh yeah we're using both okay yeah so
this is also a special method that
allows you to redirect specifically to
but you guys get the point
so flask obviously needs to explicitly
get imported the portions of the
framework that you plan on using it
keeps things lean and mean
so test 2 is also going to be saved in
there so now we're going to be test 3 at
gmail.com
so I've actually never used that method
before so this is a raw and uncut as far
as how this is going right now so I
think I needed to pass in the index
instead so instead of giving it the
actual route it's looking for the name
of the view which is index so I
apologize for all this is a good way to
learn though I mean typically you learn
by making mistakes and I'm actually
brand new to flask and everything I'm
just kind of bringing expertise from ASP
and Django into the flask community here
so now you can see the redirect works we
don't have any blow ups and everything
if we checked our database we refresh
this date over and have several users
now including the four that we just
added so things are looking good if we
tried to add you know duplicated data is
to test one and then test which all did
test two so we should get some sort of
an error message here because integrity
error means um you know we're not
allowed the duplicates which is what we
want because we tried to duplicate
requests too and you can see if we
refresh the database sequel alchemy did
not allow the duplicate entry to go in
so that's really awesome because you
don't want duplicate users or duplicate
emails in your database alright guys so
that's how we we query sequel alchemy or
query using sequel alchemy in flask and
Python 3.5 thanks for tuning in to this
series please upvote this thing share it
if you would positive feedback allows me
to know whether or not I should continue
to try to pursue the series and then
negative feedback is also a good way for
me to learn as well so um just let me
know if you guys have any questions and
thanks for watching good night bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>