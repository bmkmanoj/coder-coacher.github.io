<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Automating &amp; Scraping with PhantomJS and CasperJS | Coder Coacher - Coaching Coders</title><meta content="Automating &amp; Scraping with PhantomJS and CasperJS - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Chris-Hawkes/">Chris Hawkes</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Automating &amp; Scraping with PhantomJS and CasperJS</b></h2><h5 class="post__date">2013-07-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Kefil5tCL9o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up welcome to the second
video and the fandom JavaScript Casper
JavaScript and I'm going to give you an
example here I have a website that I'm
looking to automate some stuff on and
here is the website what I do is I put a
song title in here and what I need to do
is we're going to get in just do a song
called stubborn love by luminaire so
when I type that in pulls in a bunch of
results but what I'm looking for
specifically the luminaires stubborn
love so I need to grab this album link
so what I need to do is I need to click
it and then I need to click large button
and then I need to capture all of this
text so I'm going to go ahead and show
you guys how we can automate all that
using phantom JavaScript so first things
first let's go into our integrated
development environment and start a new
file and my case it's JavaScript ok so
first things first is when you're
dealing with Casper we need to go ahead
and create our Casper object so it's
variable just like this regular
JavaScript so variable Casper equals
require of a second my dog is making a
bunch in the word sorry about that I had
to let the dogs out all right so inside
of the parenthesis you of Casper and
then dot create so you're creating a
Casper javascript object now in order
for us to be able to use XPath
expressions that are created in Casper
for us then we need to actually create a
variable that we're going to reference
all of our X pass with so I'm going to
create a variable X for X path equals
require Casper and parentheses again and
then this time select X path with camel
casing okay once we do that let's go
ahead and create our user agent
sometimes websites will reject or
display things differently if you don't
have a user agent so in this case we're
creating a user agent of Mozilla so it's
going to look like we're a Mozilla
browser which essentially we are a
Mozilla browser but disguises it so it
looks like a regular user and then this
is some standard stuff that you have to
to put in here for the user agent
so we don't really have to get into put
all of this stuff means just copy it and
that will be your user agent now this is
where we request the actual webpage that
we're going to be going to so I'm going
to Casper start and then in the
parenthesis that's where we're going to
put our link so there's the link that
we're grabbing
now everything and the using caspere and
JavaScript it's object-oriented
programming so they have set objects
that we do to take step by step so to
reference an object but if we create a
function basically so to Casper then dot
then our function so everything we do is
going to be inside of these functions
here and we're going to say this which
represents the actual page that we're on
send keys and this is where we need to
figure out okay how do we send a key to
this website so what you want to do is
you want to right click on the text box
that you're trying to enter text into
and just go ahead and inspect the
element and I'm just going to go ahead
and right-click on the element that is
highlighted using google chrome and
click copy XPath and actually know what
we're not going to do XPath this time
that's one way of identifying if you
want to but since we're actually doing
send keys it's a different function
within Casper JavaScript so we want to
grab the ID since it has a unique ID
that we can grab it'll know exactly what
we're looking for here it'll grab this
text box so I'm just going to grab that
ID and then inside send keys we're going
to copy that ID now in sense it's an ID
you need to reference before the actual
term you're going to want to use a pound
sign which signifies ID if it were a
class you would do a dot but since it's
an ID we're going to do a pound sign and
inside this parentheses after the ID
name we're going to go ahead and put a
comma space and this is where we're
going to do our search term so the
search term that we had listed before is
stubborn love
and then it's going to do another comma
which I'm sorry we're just going to go
ahead and close this statement off so
another parenthesis close this statement
off and you end the statement with a
semicolon and then we close off our
function now in order for when the
program runs so that we know what it's
doing let's go ahead and display
something to the screen so that we know
that it's not hung up and to do that you
just say console dot log and then in
parentheses again you write whatever it
is that you want it to say so we'll just
say searching iTunes alright now after
we've done that let's go ahead and run
the program but before we can do that we
have to give it one final method call
which is called Casper dot run open and
close parentheses and that will actually
run the program when we launch it so
let's go ahead and save this file I'm
actually saving it under our music
directory as the name our test
JavaScript or Jas and let's go ahead and
open up a command prompt and I'm going
to go ahead and head over to where my
file is located which is in my projects
directory and music you're just going to
want to go wherever you have yours
located and to run it what we're going
to do is type Casper J sbat
and if you don't have this installed
properly the video before this I explain
how to install Casper and put it on your
and add it to your environment variable
so Windows knows how to handle it but
we're going to Casper JSI b8e and then
the name of the file that we just
created so our test dot J s now what it
runs literally behind the scenes that is
actually pulling a browser it's
searching its locating the text box and
it's entering the text into the text box
so you're probably asking how all that
happens or even how do you even know
that that's happening since it doesn't
actually show me anything
what a cool feature that Casper adds to
this is something called a capture we
can actually capture the image of the
current state of events so what I'm
going to do here is I'm going to say
Casper capture and then I'm going to
name the actual image that I'm capturing
so I'll say our image dot PNG and close
that off and
okay and now let's go ahead and run the
program again
all right worked exactly the same I'm
going to pull up a Windows Explorer I'm
going to go into where I have the file
saved because it's actually going to
save the image the screenshot which is
what capture does it takes a screenshot
and it's going to save it to wherever
directory the program is located so in
my case it was projects and in music and
in here you'll see that we have our
image and we put that in there you can
see that it actually put in the text it
didn't hit submit or search or anything
like that but you see the text that we
wanted to put in is put in so let's go
to move on with our program the next
method call that we're going to create
and really these are methods functions
somewhat the same thing here and I'm
going to go ahead and I want to click
the search button so to actually do a
search so let's do Casper we're going to
say then click and click is the first
this C is capitalized so now this is
where the xpath is going to come into
play the XPath variable that we created
up at the top we're saying Casper died
then click and we're going to say X and
then another open parenthesis and in
this next open parenthesis is what we're
actually going to put the X path but
then after that we're going to put a
comma and then function so we're
actually starting another function upon
the click element so this time we'll say
console dot log will say searching
iTunes and the console log that we
created earlier is a little bit
misleading because we said searching
iTunes when really it wasn't actually
searching at that point so we should say
just entering data because that's really
all it did
so we'll say entering data and the next
function will say searching iTunes now
we need to give it an X path so it knows
where to go and we also need to close
this function so in order to get the
XPath you just pull up the webpage you
right-click on the element and then in
if you're using Google you have this
Google web developer thing which is very
handy just right-click on the selected
element and then just say copy XPath and
now we can just paste our XPath right
into that and what we're essentially
doing is just saying hey find that XPath
and click it and if you notice here we
actually have two functions that were
invoking so we need to close that off
see here's the first one and then this
second one so we have then click and
then we also have the console dot log
actually I take that back I'm wrong we
only have one my bad I was looking at
that we only have one all right so let's
go ahead and this time we'll take our
image after we hit the enter button now
I'm going to show you something here
now I'm going to show you a gotcha when
using something like this and let's go
ahead and run the program so I can
explain what I'm talking about
okay so it's saying it's not finding our
XPath
let's make sure we have the right
element oh you know what I grabbed the
wrong thing what we're looking for is
the actual search button I did a
right-click and grab the XPath of the
textbox but what we want to do is where
the XPath of the search button so that
we can click it so that was just a case
of grabbing the wrong XPath so let's put
the right one in there all right so
let's try to run it one more time all
right we're going to know that it's
undefined on the plant is not a function
and has a problem with our XPath so when
we look at this let me see what's wrong
here okay it's actually this XPath the P
is also capitalized which tends to move
away from camel casing because really
I'm not sure why the X and the P are
capitalized but that is the way it needs
to be so let's run that again it's
actually slightly improper for the
casing to be like that but anyway that's
built into Casper so go ahead and just
make sure you do it that way and that is
going to catch a lot of people I'm sure
all right so now i'm our image let's
take a look at it and the Gotcha that i
was talking about is that you'll see
that it says loading and the previous
image didn't say loading so this
literally caught the image right after
we click so it didn't even give the Ajax
enough time to go and request that data
and display it back so what we need to
do is we adn't need to add a weight
feature any time you're doing Ajax
intensive things or even page loads and
stuff like that you need to account for
that so what we're going to do is before
we take our image everything's fine as
far as where we click the button but
we're going to add another function here
where we're telling Casper to wait so
we're going to see Casper dot weight and
we're going to say 5,000 which 5,000
milliseconds equally equals one second
or really five seconds I'm sorry 1000
milliseconds per second so the 5,000 is
five seconds and this fires a new
function it's going to be
Kaspar that's just inside of this this
weight function it's going to wait 5
seconds and then let's go ahead and then
capture the image Casper capture and
then we're going to do our image PNG
right let's go ahead and run this
all right you notice the pause now it's
waiting for the five seconds that we had
declared so now that that's done let's
go back in here and look at our image
and now you can see it has all of the
data that has been pulled back so that's
pretty cool and you can see the song
that I need though is still up here so
we're still in the early stages of being
able to extract the data that we need so
let's go ahead and move on to the next
feature the next feature is that we need
to be able to locate the the right band
number one and the right album so it's
not even the first artist that pulls up
so that can be very problematic so you
really need to add a lot more logic in
here so that we're grabbing the right
stuff so let's go ahead and figure out
how we're going to do that so you can
see that obviously the artist that we
want is the Lumineers and really there's
only one anchor link after the Lumineers
appears within the Dom tree meaning the
HTML structure so in order to be able to
get that we can identify an XPath to say
hey find the Lumineers and then find the
next anchor because we know that that is
what we want to click on so in order to
do that with XPath let's go ahead and
within our weight function let's get rid
of the Casper capturing the image and
we're going to do Kasper dot click and
let's do another XPath so let's leave
that blank for right there and then go
ahead and do since it's a click method
you don't actually have to add anything
on to it it's strictly just going to
click the XPath so now we need to figure
out okay what is the XPath going to be
that will grab the Lumineers so there
are several ways you can accomplish this
but the best way to do it is strictly
just doing forward slash forward slash
and then a star which means that the
text can exist in any sort of div
element it doesn't matter if it's a span
a paragraph anchor it doesn't matter
whatever it's what the star signifies in
it and the double forward slashes means
that it doesn't have to start at the top
of the dom tree it doesn't have to start
at the HTML or the head tag and work its
way down
it can literally find that and jump
right to the middle of the document and
find any tag that matches what we're
about to match so what we're about to
match is we need to put a open square
tag and then I'm going to say text which
means simply what it means text equals
and then this is where in double quotes
we're going to put the texts that we're
looking for and the reason why the text
and doing it this way is the best way
because you can also do contains but the
thing about contains this contains is
not going to be able to handle spaces
very well and in my case I'm dealing
with an artist that has a space and
they're named da space lumineer so
contains isn't going to find what I'm
looking for so I'm better off just
sticking with text equals so da space
lumineers and I close that off and after
the double quote we're going to close
off our square bracket and they say
forward slash and in XPath language
we're then going to say following colon
colon a and then that is our statement
now we need another parenthesis marker
here because we have to open parenthesis
on this left end so that's simply it so
we're saying Kasper click the text that
equals the luminaires the anchor will
essentially we're saying Kasper find in
the XPath the illuminators then it's
following anchor tag which is going to
be the link that we're trying to click
on and we're saying clicking so let's do
that let's go ahead and do another
weight function and we'll just copy this
entire part here paste that in here and
let's close it off now
before we forget it and let's go ahead
and do a Casper capture once again our
image dot PNG that way we know whether
or not it got clicked so now that's go
ahead and run our program again
and you can troubleshoot any way that
you want like in my case I'm doing five
seconds maybe five seconds is overkill
maybe one second is enough maybe two
maybe three I don't know it's going to
be up to you but in in this case you
know but I just want to make sure that
it is there so it might be a little
overkill but bottom line is it should
work alright so let's go back and view
our image of the screenshot after we
entered the data and then clicked on
that XPath and you can see that it
actually grabbed the right artist the
Lumineers and there's the link and all
is good so it you know we gave you time
to load and it's there now let's move on
to the next step of the program where
once this thing is selected let's go
ahead and see the next thing now this is
going to be easy because this particular
pop-up modal is going to be the same no
matter what artist we're dealing with so
we know we want to click the large
button so really all we gotta do is
right-click on that and let Google do
the work for us and we're going to right
click on the element and then copy the
XPath so let's go ahead and do the same
thing we'll get rid of our capture
statement and just do click we'll do X
open parenthesis and then we'll place
our XPath inside of there close it off
and that's simply it that's so we're
clicking that element now the next thing
we're going to do is we really need to
do another weight statement so let's go
ahead and copy this because we want to
make sure it gives it time and really we
probably don't even need it's probably
over killed it you know what inside of
the same weight statement let's go ahead
and not even create another function it
you can really just sense nothing as
loading
I take that back that would make a that
would make us screw this up so let's go
ahead and just wait another five seconds
it's not gonna be that bad it's not the
end of the world will click the element
after we click the element we do need to
wait just a second so that it registers
because when if you notice here when we
click the element there is a slight load
there it loads a little bit of text so
we can't we have to get at least a
second or two so let's wait in this case
we'll wait to 2,000 milliseconds and
we'll do it we'll fire another function
I'm going to close off the function so
we don't forget now this time we're
going to create a variable that I want
to print to this screen so the variable
that I'm looking for is this embed text
that is returned here I need all this so
what I'm going to do is I'm going to
create a variable and I'll call it the
text I want equals and then this is
where we're going to say Casper like
we've done before but this is a new
method that we're calling it's called
fetch text so it's made directly for
that and we can feed it in XPath so just
like we've done before we'll feed it in
XPath and now to figure out what that
XPath is going to be once again Google
can do the work for us
we can right click on this inspect the
element right click on the text area to
copy the XPath and place the XPath right
inside of our item here and let's go
ahead and console.log the text variable
that we just created so this is going to
be the full working program that I'm
going to do on this video and let's go
ahead and see if it works
so you see the idea behind printing the
processes as it goes through so that way
if ever gets hung up you're not like
what is it doing
you know just sometimes depending on a
website's traffic things might get hung
up here so we do have a reference area
can't find variable text oh yeah do I
the name of our variable for some reason
I thought we named it text it's called
the text I want my fault all right so
now that we have the right variable that
we're printing to the screen let's run
it one more time
and there it is that's the exact data
that we're looking for so we can write
other programs I mean this could be
output it to like a text file it could
even have you can even fire off another
program or another script with that text
so the possibilities are endless as far
as automation and testing and things are
concerned I don't endorse scraping any
particular site or anything like that so
this is just strictly how to tutorial on
how you can automate testing for a
particular tasks so please subscribe
rate positive and thank you for watching
bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>