<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Use MOQ With C# For Test Driven Development | Coder Coacher - Coaching Coders</title><meta content="How to Use MOQ With C# For Test Driven Development - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Chris-Hawkes/">Chris Hawkes</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Use MOQ With C# For Test Driven Development</b></h2><h5 class="post__date">2016-02-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Krj3-h198KQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up hope you're doing
good
and what we're going to be looking at in
this video is test-driven development
unit testing the examples I'm going to
be providing are in c-sharp but this
also applies to JavaScript or any sort
of other programming language that
you're using if you're new to
programming just getting involved this
is something that is going to be
difficult for you to grasp it's
something that is completely different
than just pounding out code in a
procedural manner or even an
object-oriented manner unit testing is
all about isolating dependencies in
order to actually be able to isolate you
know just one particular chunk of your
code so that the dependencies itself
don't cause the code to break and you
can test the logic inside that codebase
without ever having to worry about
database connections or reaching across
the web or something like that because
anytime you have to do something like
that then it no longer becomes a unit
test it becomes an end-to-end test where
you're testing two different services
that are communicating with each other
and that's known as an integration test
and that's not a unit test in c-sharp
there's a project out there called moq
and moq is a free project you can
install using GNU get but it's all about
making it easier on you to to mock up
any sort of dependencies that any
particular piece of code that you're
testing has so every code anytime you
have a complicated project dependencies
are always going to crop up and finding
out you know ways to have been able to
to you know mock up those those
dependencies it's very very difficult
moq makes it easier and we're going to
look at how to do that so let me go
ahead and just given a background of
this this example code I did not want to
actually have all of this in the
tutorial where I'm creating all this
code because it is just kind of
boilerplate it's basic level code out
here but what we have is we have a
simple band class right so there's just
four strings nothing big name origin
genre best song and then we have a band
controller now this controller class is
going to be the object that we're going
to test so this is where we run into a
problem in the real
and this is just a small example but
things get way out of control
when you start dealing with complex
systems especially in the enterprise
world this band controller class has a
repository which is an interface and so
it takes in an object that implements
this interface now if you know c-sharp
then you know that you can instantiate
an object from an interface it's just a
contract that classes use in order to
fulfill but the classes themselves are
the ones that actually implement what is
called concrete objects from the
contract interface so hopefully I didn't
just lose you there if you don't know
c-sharp but um if you do know c-sharp do
you know exactly what I'm talking about
but this is just an interface and if we
look at the interface file it has one
method which just is it returns a list
of banned objects so we've already
looked at what a banned object is and
this implementation has a class that
implements it so this is the actual
concrete class that implements the
interface and then it fulfills the
contract by creating that get bans
method which returns a list of bands so
it's returning three bands now
particular in a repository isn't really
going to return static content like this
right this is just an example typically
what your repository does it acts as a
middleman to reach out to a database to
reach out to some sort of restful
service and it's responsible for that
two-way communication both you know
passing data to these services and also
getting data back from these services in
this example this is just simply
returning three static band objects as a
list of bands but we're going to pretend
and that's why I have this common here
we're going to pretend that this thing
calls out to a database so there's our
concrete implementation of the
irepository contract and then you have
this is a typo here so then you have
since this is just a simple console
application
the static main method is just building
a concrete class or concrete object from
this concrete class and then it actually
also creates it will call this instead
of example we'll just call this a band
controller since that's what it's doing
it's newing up a band controller and
then it passes in the concrete
implementation of the repository which
is needed so if we look at the band
controller you can see this is where the
dependency comes in this is where unit
testing gets difficult especially when
you have a lot of classes like this that
need to be mocked up so you can see here
that this thing says that I need a
repository object to be passed in and
that's what's going on here that's
creating the repository object and it's
passing it in so they can create it now
in a unit test we do not want that to
happen because we have to pretend that
this concrete this this concrete
repository here is going to be calling
out the databases and things like that
and we we don't want that we want that
to be isolated our unit test if it
relies upon that is going to be subject
to failure for things that are out of
its control then you're no longer like I
said going unit test you're looking at
more of an end to end type of test so
without further ado let's go ahead and
look at how we add a testing project to
our c-sharp solution so here is on our
solution if we want to add a unit test
project we just simply right-click on
the solution itself go to add say new
project go down to test we're going to
do a unit test project we can just call
it whatever sort of name it wants to
give it which is unit test project 1
click OK this is going to add a project
to the solution and this unit test
project needs to be able to access the
code in moq example which is the name of
the main project and it needs that code
otherwise we wouldn't be able to test it
so in order for a unit test project to
be able to access that code we need to
go to its references and we're going to
say add reference and over here we want
to click on projects and solution and
then you can see that it has moq
examples so we're just going to check
that and click OK now the unit test is
going to have access to all this code
here so that we can start testing it
let's give this unit test one that was
created for us which is a test class
file we want to rename that to something
meaningful since we're going to be
testing band controller we're going to
actually and this is the normal
procedure that I've seen is that you
actually name the test file whatever
sort of thing that you're testing
whatever class you're testing you're
going to give it the same name except
you're going to put tests on the end so
we went ahead and we rename this to a
band controller test now this test class
and test method this is all just
built-in stuff for C sharp and Visual
Studio in order to make it easier for
you to be able to test and we're going
to make use of that but for right now
let's go ahead and create a test method
for our band controller which is what
we're testing and we have this method to
test and I want to copy that because
we're going to go into the band
controller test and then we're going to
change this method name to method to
test so it's clear what we're testing
and in our test file in order for this
thing to work we need to be able to say
variable controller in fact I'll call
this band controller to be specific
equals new controller actually band
controller I'm sorry band controller not
test a band controller so it's going to
say it can't find it so we need to
actually say using moq example so to add
the using statement at the top and now
we can access so if I do an f12 on this
object you can see it actually points to
the right project and the right band
controller so let me go back now you can
see that it's saying you can't you can't
new this object up because you haven't
passed in the right data to the
constructor the constructor here needs a
a class that implements the irepository
interface so this is where we run into a
problem when you try to isolate
something because you can't just simply
say variable repository repository
equals new repository now you could do
that but the problem with this and I
could just simply now pass in
repository right and now it's satisfied
and I can do up my band controller but
the problem is here and what we're
pretending is that and in most
situations when we look at repository
this is returning static data but we
have to pretend that it's actually
connecting to a database or calling a
downstream service and if it does that
in order to return data we do not want
that to happen because if that service
goes down that it's interfacing - then
your test is going to fail and it has
nothing to do with the test that you're
actually trying to test you know what I
mean it has to do with an external
dependency and that's where moq comes
into play so we don't want to do this
this isn't going to work for us
it's a complete no-no in unit testing so
that's where moq comes into play and moq
like I said is a free library and if we
go to a let's see new gates and we can
see a new gate library so here's this
new gate is a real big piece of by
the way compared to some of the other
package managers that I've seen like NPM
or paper I mean I just it seems like
nougat fails on me all the time in fact
it's one of the primary sources of
frustration that I have an enterprise
development is having to deal with it
but anyway hopefully it's going to work
here so let's go ahead and pull this
join up so now let's go over to our
tools and say nougat package manager and
we'll just go to the console that'll
work
we have to wait for PowerShell and all
that stuff to fire up here
all right finally that took forever so
now we're just going to paste an install
package moq it's actually going to you
know what we're not going to do that
because that that's actually going to
put it in our main project don't do that
so let's go over to our references here
and we can just say manage NuGet
packages and we want to do that in our
unit test project make sure you're doing
that and the unit test project and not
the moq example assuming you're
following along
so we'll say manage NuGet packages and
here I can go ahead and search I don't
need to do all that but I can search moq
and here's moq so I can go ahead and
click on that click install and click OK
alright so now you can see moq is now
being referenced so we have it installed
that's good now this is where we're
going to go ahead and use moq to
instantiate this irepository object so
all we need to do is say mock and then
whatever it is that we're actually
implementing so we'll say I repository
and then we have to give it a name so
typically you'll say like mock
repository or whatever whatever sort of
object you're you're mocking up you just
simply say mock and then whatever the
object name is so say new repository and
that if this needs the same mock as well
now this actually so you need to add the
using statement using moq that doesn't
need to be repository like that all
right there we go so now we have a
completely mocked up object here using
moq
and in order to be able to pass it in we
can't just simply say mock repository
like we did before because you can see
if we highlight over it that were
actually this is a see look you cannot
convert from moq mock to my moq example
i repository so that's not going to so
what you need to do anytime you're
dealing with a mocked object using to
say dot object and now this will work so
if we went ahead and we let's just do it
we're going to add one more project to
our unit test go ahead and right click
and we're going to say manage NuGet
packages again and one helpful thing
that to deal with anytime you're trying
to do assertions is fluent assertions
and here it is right oh
damn it all right so here's fluid
assertions go ahead and add that
all right is it in there yet there it is
yeah so now it's in there all right so
now it's always a lot easier to be to be
like this a band controller God should I
need to use using fluent assertions will
say God should we'll just say not be
known so it should not be no so this
makes it a little bit easier to unit
test and let's go ahead and put a
breakpoint right here so if I
right-click on this this test method you
can see visual studio gives the option
to debug tests so we're going to do that
now
you can see down here it's building it
it's kind of slow
it's actually very slow especially when
you start getting like 25-30 thousand
tests and a solution it gets it gets
ridiculously slow all right so now we
hit our breakpoint and you can see that
we were able to successfully instantiate
a band controller object using a mocked
up dependency so instead of actually you
can see that this is a mocked object and
everything so assuming of you know you
pass this in anything that that band
controller does to call out using that
repository is actually though they're
not going to make those calls because
it's a mocked up object so what we need
to do and you can see band controllers
should not be null so it won't be null
it'll pass the test and you'll get a
little green check marks because the
test passed so let's look at let's look
at our band controller again if you look
at the band controller the method to
test it says this dot repository get
bands so let's put a breakpoint before
the for each because we want to see what
happens with bands and if we run this
unit test again so since we put a
breakpoint on this off for each method
all right on this for you statement in
our method to test we need to actually
go ahead with our band object and our
test here we're going to say our band
controller thing so the band controller
dot and then the method to test a method
to test so we're going to execute that
and now if I right-click and we say
debug test it's going to hit the
breakpoint and band controller so here
we hit the breakpoint but you can see
bands is null and the reason why it's
null is because our repository isn't the
real deal repository that that reaches
out to the database or the restful
service or wherever it is that it gets
its data because we don't want it to
because then it would be like I said an
integration test and not a unit test so
that being said
we need to use moq let's stop this test
we need to use moq to say when you get
called out to get bands you need to go
ahead and return something so what I
would do is I would go something like
that so you say mock repository so after
your instantiation statement here you're
going to say setup and then you use a
lambda where we could say like X dot and
this is where we'll say get bands and
then we tell it to return get bands dot
returns because this is a meth you
actually need to have an open and close
parenthesis there and then this should
be capital returns so this is going to
return a new list of banned in fact
really what you would probably want to
do is just say a list of bands and we'll
go ahead and create that list of bands
objects so this is where we would
actually go ahead and create our
dependency so we'll say create list of
bands to return and this is where we can
say variable list of bands equals new
list of band let's make sure we're
requiring so using alright now we can go
ahead and add to the list of bands new
band
and then here is where we're actually
passing it so we'll say name equals
Bayside origin Queens New York
genre equals alternative then best song
equals I and is all subjective by the
way so here we have this list of bands
which we created so in we're basically
saying hey under a normal situation
repository would return this but since
repository is mocked we actually need to
specifically say you know return this
expected data and then we we take the
mocked object and then we use this set
up and by using a lambda we're able to
say when request bands or get bands is
called return this mocked up list of
bands that I've just created inside of
my test so now if we run this unit test
and instead of the list of bands
returning null it's going to return a
list of bands with just that one band
that we just added Bayside or it's
actually not because we have a we have
an issue here
so there's actually good that we ran
into this issue because this is
something that we'll probably trip you
up as well so we're actually mocking up
the at the the concrete repository
implementation but instead we should
just be mocking up the interface and
that's one of the reasons why we use
interface and interface injection
because interfaces allow us to to build
mock to objects from those interfaces
and it makes things a lot more flexible
than having to mock up actual concrete
implementations so let's go ahead just
some change this over to our repository
so by switching that over to the AI
repository if we were to now run the
same test over again let's right click
debug test and now if we look at bands
instead of it returning null we can see
it actually returns one so now it's it's
returning the exact mocked up data that
we just provided it and our our test can
go ahead and proceed you know with this
data which is completely mocked and
completely isolated without ever having
to worry about having to reach out and
and having your network connection
problems and stuff like that that could
cause our unit test to fail
all right so I'm probably going to do
some additional videos and moq I'm kind
of curious if you guys are even will
even embrace that or not this was more
of an example of why you would want to
do unit testing and why it's important
to use mocking frameworks
if you've ever done unit testing and
JavaScript there's a framework that you
probably hear a lot about if you've
never used it before but it's called
Jasmine and Jasmine is JavaScript way of
similar to moq with c-sharp for being
able to you know mock up and be able to
spy on tests and things like that
moq is almost like you know like how
jQuery is a library and there's all this
you know semantics syntax and stuff you
have to follow and roles and things for
chaining functions together and what you
can and can't do moq has a lot of
complications in the different ways that
it can actually monitor arguments being
passed and whether or not methods were
called and things like that this is
typically what you're going to end up
doing a lot as far as having to use moq
to mock up implementations and things
like that in order for your tests to
pass so let me know if you guys are
interested in having me explain more
into moq because I'd be happy to do that
but if nobody's going to really embrace
that or watch the video I don't feel
like dealing with it to be honest with
you because I have to do it a lot at
work anyway but anyway guys this video
was all about how you can get unit
testing and why unit testing is
important and the difference between
unit testing and regression testing and
also just a quick example on how to
actually get moq working with visual
studio and your c-sharp project alright
guys please subscribe thanks for
watching please upvote please share and
I appreciate all the support have a good
day bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>