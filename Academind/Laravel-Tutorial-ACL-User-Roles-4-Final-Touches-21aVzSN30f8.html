<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Laravel Tutorial - ACL (User Roles) - #4 Final Touches | Coder Coacher - Coaching Coders</title><meta content="Laravel Tutorial - ACL (User Roles) - #4 Final Touches - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Laravel Tutorial - ACL (User Roles) - #4 Final Touches</b></h2><h5 class="post__date">2016-04-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/21aVzSN30f8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi welcome back so this will be the last
part of this ACL video series where you
see how you can implement a user roles
functionality in Larra well we get our
middleware we get our data in the
database the last step is to wire this
all up to protect routes and use some
additional finishing touches the first
thing I want to do is a minor thing but
still important for this overlapped work
correctly
let us if you're not locked in you can
sign in or sign up excuse me sign up as
a new user in this case I want to assign
a default role to each user
now you could of course also say
identities assign a default role but in
my middle of where I say that no role
role is always declined access to
certain routes not your average but I
just want to show you how to set up a
default role so in my off controller
where I get my sign up function I get
this placeholder here for me here I was
just say basically the same as in my
user table cedar that I want to attach a
role to each user and the role I want to
attach is role where the name is users
of this default user role and here the
first element we find in the database so
that's really all that every user that
signs up is by default normal user and I
can show this functionality why while
trying to sign up here as let's say
Chris Chris Jen chris at example.com
password tryst like sign up and Yahoo
that's why you should always be careful
we need the role model import here so
again sign up at and now in the admin
panel you can see that we got this new
user with this
user role already assigned to it well
that's one thing the other thing is in
my app controller which controls
basically all the functionalities of the
remaining app you see I already get this
app role import here at the top I didn't
forgot to delete it prior to this
recording session so you may add it now
because we're needing it down here where
we'll add some functionality this method
here is called when you can we click
this assign roles button and we want you
to change the roles for a certain user
as an admin currently this won't do
anything instead it just will just
redirect us and not change anything so
what I will do here is I will first
retrieve the user off this row where we
want to change the rules I will retrieve
it by the email which is set up to be
unique request email first user where
this email matches because there is only
one as it is unique and then I will
access the roles of the see of this user
and detach them all because I will
reassign them and yes I could do a check
where I have a look at which roles
actually changed and I only change these
roles but that would be a bit more
complicated and it's not really the core
of this video so what I will do here is
just detach them all and then check if
well my request has this role user field
here checked this is the name of this
first checkbox for the user role and the
other checkbox names our role or for a
little admin so I will see if this is
checked and if this is checked then we
know it user should have this role and
therefore I can then say user roles of
course here attach and the role where
name is equal to user because this as
well the user role and again here the
first row we can
with this username and now I'm going to
copy this pretense and again this is not
very dynamic you could of course come up
with a better way and in your project
you might need to do this but this is
not really a cool thing to this roll
setup that's a general thing and I just
want to keep this as simple as possible
here
so here offer and admin and of all this
setup we can now actually change the
user roles so if I now click on offer
here and a click assign roles
we're also redirected but this time this
role stays now I'm going to reset this
and at the moment this does not have any
result we can change this but we could
access any route anyway because we
haven't set up our middleware in the
routes file and this is the very last
thing we're doing here and of course the
important one to use all the building
blocks we now set up on the last videos
to actually protect certain routes based
on roles I will start with the orange
route here
and this route will get a middleware
this is a default level key here which
assigns middle of where and of course
you could design now do you find any
default Milla where there are all ships
with but in this case we're using our
own roles middleware here but currently
this roles member would not do anything
because what is attached but we have
defined which roles should be applied to
this specific route here so we'll add a
new well action and this is where this
yet action thing comes in I talked about
earlier I'm defining this roles key and
this is not a default level key this is
my own key and I'm retrieving it here by
receiving the whole action array and
then just accessing the roles key if it
is set this allows me to define an array
of roles which should be able to access
this route in this case I want admins
and offers to be able to access it now
just copy this to the next route this
generate article link
this is oh it already works and I have
two wrong permissions I just wanted to
show it but poor is it's not possible
anymore
this is just generate article link and
here I only want offers to be able to
generate articles so admins are able to
access the offer section but they may
not click this link so this is this the
next protect your eldest is admin route
but here of course only admins should
have access and the same goes for the
assign roles button which if another
user would somehow try to do this via
the command line or any other way we
will also catch him here and not allow
this action by anyone else but an admin
this is all the protection I want to set
up and now let's see I'm the normal user
and I can actually show this by now not
logged in and all from the route doesn't
work aDNA route doesn't work if I sign
in as Chris the user we created and I
probably get to sign in credentials
wrong okay I so and let's use the other
one here visitor visitor this is the one
we see that so now I'm locked in I'm on
the man main page and I may access this
but I can't access you all four page and
I can't access the admin page let's log
out and let's try signing in as an offer
now I may access the main page which is
successful by everyone
I may not access the admin page but I
may access the offer page I also make
like this generate article link which
says article generated now again I'm
logging out
I will log in as the admin here I may
access the main page I may access the
offer page because
we set up that both offers and admins
may access the offer section but if I
click just generate article link we see
insufficient permissions because this is
not allowed
however I made at xst admin page and I
may change a role let's say Victor
should no longer be a normal user but an
offer I may assign this logout and now
let's log in again with Victor and
remember before the change you were not
able to access this offer out well now
we are because now we are an offer so
this is how you set up a routing how you
use it how you create your middleware
and I hope this is helpful and helps you
with all your projects see you all the
other videos have a nice day bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>