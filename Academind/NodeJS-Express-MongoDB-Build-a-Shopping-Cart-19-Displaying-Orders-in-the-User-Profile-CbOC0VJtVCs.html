<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>NodeJS / Express / MongoDB - Build a Shopping Cart - #19 Displaying Orders in the User Profile | Coder Coacher - Coaching Coders</title><meta content="NodeJS / Express / MongoDB - Build a Shopping Cart - #19 Displaying Orders in the User Profile - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>NodeJS / Express / MongoDB - Build a Shopping Cart - #19 Displaying Orders in the User Profile</b></h2><h5 class="post__date">2016-08-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CbOC0VJtVCs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in order to show all the orders on
this profile page I'll go back the
application in the users routes file
here at the bottom or not at the bottom
here at the top actually where I get the
profile I want you well retrieve the
order data for that user well in order
to do that I'll needs this order import
that are a lot of orders are that so
like this this order model and then I
could use the model here to directly on
it use the find method which is just a
mongoose way of querying the database
basically doing the same thing I was
doing here in the shell client with DB
dot orders dot find I'm doing it here in
my net J's code now I don't want to find
all orders though I only want to find
orders for D locked in user and you see
them that I'm checking for the user
being locked and here by adding the
middleware so I can be safe where I can
be sure that the user will be logged in
if I reach this code therefore I'm a
passing an object to the find method
where I say the user field remember my
order model has this user field here
which will be a user ID in the end this
user field should well be the same as my
locked in user and that's the cool thing
I can use the logged in user passport
stores on my request to compare it with
the user field in the database and
Mongoose will do all the rest of course
my locked in user here probably has more
than just the ID but was clever enough
to figure out that it needs the ID from
this logged in user and compare it to
the well user which the user field which
just stores an ID in the end so with
that I'm finding only the orders of the
user then I'm setting up my callback
where I ever get an error or all the
relevant orders and I'll quickly check
if I do get an error
here in this case I'll make it simple
and just return a response where I write
error to the screen so really not the
best error handling here but well it
really shouldn't fail and well I want to
focus on the success case here so we
were successful we retrieve the order
what's next well I want to get the card
from that order I will therefore create
a new variable card and then I will loop
through all my orders why do I need to
do that you'll see in a second I'll use
a foreach loop to do something with each
order in this array of orders because of
course I get or at least theoretically I
can get more than one order if the user
well ordered more than or made more than
one purchase so here I'm looping through
all the orders and then I want to
manipulate each order I want to change
something there I want to fetch my cart
and I want to create a new card on each
new or on each order remember I have it
stored in the database but I want to
create a card based on my card object
here and that's the same approach I used
here in the index chess file and the
routes folder all over the place where I
generated a new card every time we were
reaching in you're out I want you to
generate a new card for each order here
too because I will need access to the
generate array method which is set up in
this card object or model here and I
need this generate array method you give
me an array of items which I will then
need in my user profile where I want to
output my order order data which should
not only be the total price of the order
but also the items of the order exactly
that like they were stored in a cart
that is why I need the same behavior as
I need it in the cart related routes
India next or chase file so enough the
talking card will be a new card here for
each iteration and for the
new card I will pass order top card
because again I'm storing this card on
each order in the database then I want
to set order items this is in you field
I'll add to have some convenience to
conveniently access all my items I'll
set this field equal to Cart generate
array like this so this method here will
return me an array of the items in a
cart and then I'm storing them in a new
field items on the order so with that in
place I can then render my response and
I want to render the user slash profile
view here basically this one so I'm just
pulling this into my callback and of
course I need to pass an object to that
view and the object should hold my
orders which I can then use there so
back to the profile view to the profile
HPS file pretty empty right now well
we're going to change this first I'll
add a bootstrap row here then I'll add
some bootstrap columns to give this some
well nicer look or a better look so
let's do this like this maybe of course
you can stall this however you want to
style it then here yes this will still
be my user profile then add a horizontal
line and then let's say add a heading
which says My Orders something like that
now here I want to loop through all my
orders and I want to display them in a
certain way I'll head over to get
bootstrap come to pick the right styling
basically and I want to make each order
a panel and to be precise a panel with a
footer we're here in the footer I want
to have the total price and in the
content field here I want to have the
individual items off that order so I'm
copying this panel
here from the bootstrap page and I'll
and I'll enter it here below denied my
orders heading and as I said here for
the content I want to have the items of
the order so this shall be a list group
and I want to have a list troupe with a
badge because in the badge I want to
display the overall price of the items
here these items will be grouped as they
were in the shopping cart so if I
purchased a certain book twice then here
will be the price for two items off the
book but we will only have one row for
the book so I'm placing that in here and
with that it's time to add do you
required loops I'll first add a loop
around the panel because again each
panel should be one order so I'll enter
the each block here and then quickly
just copy all that code cut it enter it
here like so and thereafter I'll add or
here first I want to loop through all my
orders of course and then I want to loop
here inside man or the list
I want to loop through all my what all
my items of course so this is the
keyword I can use for the currently
active ordered since that is my outer
loop and looping through all the orders
and I'm here in the items field remember
the items field that's this field I
created here in the user chess file so
here I'm looping through all these items
have my new for each loop here also coop
view all of that cut it and paste it in
here like so and then I can go here
while adding the relevant data so here
in the footer as I already said I want
to output the total price so this will
be dollar and then well the price and I
can access the price on my order
so using this
again because I'm in need for each loop
here this cart and then the total price
field on the cart I also want to enter
the total price for each item group and
dispatch here so I'll also do that here
again I can use this now I'm in the
inner for each loop but this is still
available here so this will be this
price and then here I also want to
output the title so this shall be this
item title and thereafter I also want to
output the quantity so the last field I
want to enter here shall be this
quantity and these are all fields
available on my items you asked setup
here in my cart model right so here I'll
just add units after it with that I'll
restart my server again go back to my
application reload my profile page and
get an error because yeah because cart
is not defined well that's certainly
something we should do so in the user
chess file I'll also need to import my
cart model here because I'm using it in
the any profile route here here where I
create a new cart
so yeah good catch restart the server
reload the profile and we see the order
here $60 and then the individual items
as we bought them just some fine-tuning
maybe here the total price we could also
wrap this in strong tags maybe like this
oops
just to make it a little bit nicer and
then put total price in front of it
maybe something like that but that's
just Eiling great so let's make another
purchase let's say we buy each game once
like so go to the checkout page copy
that
dami credit card data enter all the
dummy data here fill out the form submit
it your card num oh yeah dad is not a
card number I do agree with that
so maybe add or correct court card
number here is submitted go to the user
profile and we see these second purchase
who made here great so with that we got
the working shopping cart we're able to
add items to the cart to then checkout
we ensure that only logged in users
can't check out we're actually saving
the orders to the database of course we
do make charges using stripe and finally
we also display all the orders a user
made on his profile page</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>