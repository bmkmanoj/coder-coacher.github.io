<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Fetching User State | Vue.js + Vuetify + Firebase FULL PROJECT | Coder Coacher - Coaching Coders</title><meta content="Fetching User State | Vue.js + Vuetify + Firebase FULL PROJECT - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Fetching User State | Vue.js + Vuetify + Firebase FULL PROJECT</b></h2><h5 class="post__date">2017-09-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BZ9FcjsA9ZU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in the last video of this view beautify
and firebase serious we add a logic to
be able to register and unregister
our users now that's nice however the
problem is if we register and reload our
app and therefore lose our existing
application state we against Keys
register even though we can see on
firebase that the user has a
registration now that's what I want to
fix in this video I want to make sure
that when we load our application I
fetch that initial user state from the
firebase database let's dive into that
together
now to fetch this initial user state
will work in our index.js file in the
store folder there we already got a lot
of actions and so on and we also have
one special action that's auto sign in
now in Auto sign-in we basically commit
set user right now now I want you
basically dispatch another action at the
same time I sign my user in so once I
know that we have a valid user basically
I want to dispatch a new action which
I'll add right below it maybe I'll call
it fetch user data because signing the
user in is nice but now we're storing
extra data in our normal database here
the registrations we don't get this
right now so we have to fetch it as soon
as we know that we have a user who
signed it
so in this fetch a user data action I of
course get commit and I'll also need
access to my getters salt already add
that to and pull that out of this
context object
now inside fetch user data I first of
all as always want to commit set loading
and set it to true to indicate we're
loading some data and then I need to
reach out to firebase to the database
call it as a method and there to my
users note for the given user which I
can get with the getters so getters user
ID because we stored all the
registration data under users and then
the different user IDs and then add
slash registrations here now for that I
want to get a value once once value does
just that it fetches the data under this
node once it doesn't set up a permanent
listener it gives us this data once in
the den block I can use this data in
this function here now in this function
I first of all want to retrieve the
values I got and for that I access data
with the well helper method the firebase
data basically isn't an a format to be
used immediately
so if well we transform it into normal
JavaScript data we can work with so
wellness gives us the data we got and
we'll be an object with all our
registered meetups so if the
automatically created Keys firebase
created as properties and our meetup IDs
as values of these properties so the
work therefore I'll create a new
variable which will name registered
meetups which is an empty array
initially now before I continue here
let's console.log values let's comment
out adjust your meetups and see what we
get back right now now I got a linting
error
this is gatherers here now I can use
that here and to see what happens here
of course need to call or dispatch fetch
user data now we're dispatching auto
sign-in in the main dot JS file down
here I can simply also dispatch fetch
user data here and I don't need to pass
a payload now with that if I save this
and I go back to the application reload
you see that's the data I get back this
is my key value pair and now the key the
property is this part here so this
automatically generated key by firebase
whereas the value is the firebase meetup
ID or just immediate idea I should say
so I'm interested in an array of these
strings and I get back a JavaScript
object unfortunately now what I can
easily do is in my store I can loop
through all these properties in this
values object to store the values of
these keys in my registered meetups
array for that I'll comment this in
again and simply create a for in loop
where I have my keys in values and this
can be kind of problematic from a naming
perspective I guess so these will be my
data pairs whatever you like and now I
want you use for just registered meetups
and push data pairs key onto it because
if I access a given key on data pairs I
get the value and that's just this
meetup ID string I'm interested in so
with that I get an array of
meetup IDs I can again simply prove this
by printing it to the console again now
we have an array of media by DS that's
looking good now I need to store that on
the user of course however I also want
to set this FB keys value you remember
from the last video which allows me to
easily get the ID of a registration to
easily delete it that's basically almost
what I get back in data pairs there I
have a property which is the
registration ID and the value which is
Tomita by D now that is the wrong order
I need a object where I have the
property B the meetup ID and the value
BD registration ID I need to delete so I
need to swap this object basically the
data pairs object now that can easily be
done I can actually do it in the very
same for in loop so I'll create a second
array may be swapped pairs and swap
pairs is an empty object initially now
in this foreign loop where I go through
all the data pairs I can now also use
swap pairs and there I want to set data
pairs key because remember data pairs
key is the value is the meetup ID is
what I want to use as a new key so
therefore I assign it as a key to swap
pairs and the value shall now shall now
just be the key which is the key of the
registration I know this can be
confusing so let's quickly print both
out so console.log registered meetups we
saw that before but also the swap pairs
let's save that and let's see what we
get now we get an array of meetup IDs
that makes sense we had that before and
we get an object where the key
remember this kr pdy is actually the
meetup ID and the value K SNS is
actually the idea of the registration so
later when we define or when we see that
we want to delete the registration for
this meetup we can simply access this as
a property and we get
the value the registration ID we want to
get rid of that's the logic we're
already using and with that we're
setting it up in a way to easily work so
now we swap this and now I can create my
updated user this is a JavaScript object
with the ID being my user ID so the user
can be retrieved from the gathers of
course getters user ID and D registered
meetups will be my registered meetups
array I created so disarray and FB keys
will be my swapped pairs and this is at
least an empty object so it never fails
if I try to access it but in the best
case it holds any registrations I have
now if that I can finally commit set
loading and set this to false and also
commit set user with my updated user we
already have that set user mutation now
I also want to catch any errors of
course so let's add a catch Handler and
in the catch handler in the error
handler I will print out the error and
of course also set loading to false now
if I save that and go back to the
application we see it reload and we also
see that I now have the unregistered
button begins because this user happens
to be registered for this Meetup so if I
now click this and confirm we're
unregistered hence it is gone here too
if I click register again we create a
new registration and if I reload the app
that state should be kept no one other
thing is if I log out I actually get an
error that's interesting cannot read
property registered meetups of null well
it makes sense for log out on that
meetup the button here should disappear
I'll take care about this in a second
let me first of all sign in again with
the other user I have in this project
this is not the creator of that meetup
and now if I wizard that meetup here
reload this user is not registered for
it because the other user is if I now
click register with this user though
here
we get a second registration remember
that this is the one with WSB or here
the UD registration ideas ends with rwv
if I now I register it hopefully deletes
that and it does so this works now with
multiple users queue however let's fix
that back here when we log out that of
course stems from the fact that we try
to find out if the user viewing this
page is register or not and we're logged
out there is no user hence there is no
registered Madhav's array we could check
well that's something we can easily
prevent though let's go to the meetup
dot view file and in there the app
meetup register dialog here I want to
make sure we only displayed us if we are
authenticated so if we if and then user
is authenticated this is our computer
property here we already have I also
want to make sure we don't see this
button if we already creator so only
show it if we are authenticated and if
we are not de creator so not user is
creator now if there if I save this we
don't see that button and we don't get
an error if I now reload this meetup
page when I'm not logged in if I do a
sign-in though with the Creator account
you'll see no button if I switch to the
our account so the user who didn't
create this I should see my button and I
do and I should be able to trigger this
- and now the registration is finished
and overall I'm happy with that
application now we could always continue
on with it we could work on the profile
where we don't have anything yet you
could display all registered meetups
here you can add email notifications if
you do sign up but I'm happy with the
state of the project as it is you have
to come to an end sometimes and I have
so many new ideas I want to work on so
this is the project as I will conclude
it for now well almost there will be one
more episode where I will do some
optimizations split up my store
and see if there's something else I feel
we can improve or we should improve so
we'll definitely have one more video
until then have a great time bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>