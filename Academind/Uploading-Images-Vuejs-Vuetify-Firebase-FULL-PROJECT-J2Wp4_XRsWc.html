<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Uploading Images | Vue.js + Vuetify + Firebase FULL PROJECT | Coder Coacher - Coaching Coders</title><meta content="Uploading Images | Vue.js + Vuetify + Firebase FULL PROJECT - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Uploading Images | Vue.js + Vuetify + Firebase FULL PROJECT</b></h2><h5 class="post__date">2017-08-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/J2Wp4_XRsWc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back to this view of unify and
firebase project the last video we made
sure that only authenticated users can
reach well this page here it is create a
media page now I want to work on
something on this page which isn't
working in the way it should work the
upload we only can paste the image URL
thus far and that's nice but it would be
nicer if we could pick one of our files
and upload that file to the server so
this is what we're going to work on in
this video we'll add an upload button
here and we'll make sure that we can
upload a picked file to firebase
so let's get started implementing this
upload functionality and it starts in
the create meetup the view fault in the
template here where we have our image
URL text field now as I just mentioned
in the intro I don't want to enter a
download URL into a text field anymore
so we can basically get rid of that
instead what we need is we need an input
oops
input op type file now if we change it
like this and don't do anything else it
looked like this and that's not super
pretty now it turns out that your apply
at least of the point of time I'm
recording this doesn't have a component
for this file upload so if we check out
DD the inputs there we only get text
fields we get no file input and if that
changes feel free to use that until then
I'll use a nice workaround though a
button which will trigger this file
upload window opening so what I'll do is
I'll add another element here next to
this input field and this field I'll add
here is a V button element so this
button ear should be a race button let's
say and I'll give it a label of upload
image now if we saved as we go back we
see this upload image button here now
obviously we can give it a class of
primary to style it according to our
primary style to make it red but the key
thing is we now have this button here
now if I click this button I want to
trigger this input so that I can hide
this input because it's ugly so there's
a first step I'll hide the input here by
assigning a style and setting the
display to non-fans the Dom we can still
work with it but of course we don't see
it we can't click it directly that's why
I have this button I'll add my click
listener to this button and I'll say on
click I want to pick a file so let's
maybe execute a method called on pick
file it doesn't exist yet I'll add it in
a second so that's the file or that's
the method I want to execute and then
manhood I obviously wanna target this
input here and simulate a click on it
because it's hidden but I still want to
interact with it
now view chess gives us a nice feature
so-called references we can assign a
reference to any element in our Dom in
our template here we do this by adding
the ref attribute or directive to it so
this is the directive we add wrapped and
now here we can assign any key we want
like for example file input again this
string here is totally up to you though
so with that assigned we can create this
unpick file method by scrolling down to
our methods and here I'll simply add it
as a new method here and I want you
trigger a click on this file input on
this hidden file hidden file input so
what I'll do is I will simply say this
and now dollar sign ref gives us access
to all the references in this template
of this component so we can access our
reference here by simply saying dot file
input because that's the name we
assigned and all I want to do is I want
to execute a click there with click this
is using this native Dom element click
method we can execute
- well simulate a user click on it with
that this file input will now do its
default behavior which is open a file
picker and if we feel like it we can
even go up to this file input where is
it here and set the accept attribute
here to image star to accept any image
but nothing else we could also of course
say image PNG delimited to PNG is only
so there is the picker setup now let's
see if it works we save this we get an
error which error do we get here yeah
often working too much with typescript
I'm adding semicolons again we don't use
semicolons in the style we use here
right so back to our template if I now
click this button we see this file
picker open up and we can pick
a file here now if I click open we don't
see it here but it was indeed stored in
this file input so that's one important
step we're already closer to uploading
this the next step is to make sure that
whenever the attached file so the file
attached to this input here does change
that we actually get notice of that now
for that well first of all structure is
over multiple lines to make it easier to
read but then I'll add a listener to the
change event which is fired whenever the
attached file changes I'll simply
execute a method called on file picked
so let's add this method here at the
bottom on file picked here I'll get this
default event passed into this method so
the default Dom events is automatically
passed into this method we don't have to
do that explicitly and now we can
retrieve the file from this event so on
this event which is fired upon changing
default input we actually can easily
retrieve all the attached files by
accessing event target which refers to
that file input and then false so that's
a list of false however we only will
have one because it's not a multi-select
input or anything like that so we can
only select one file here in our
application therefore we can retrieve
the file by accessing the first element
in this files array I'm more interested
in the file name though for now so I'll
create a new variable named file name
wherever access files then the first
element isn't set because we only have
one element here in this array and it's
the first one and then we can access
file name on this fault that's a
property provided by JavaScript by
native vanilla JavaScript so now we get
the file name as a next step I want to
make sure that we actually do have a
valid file with an extension basically
so I can check if file name last index
off
if that is smaller or equal than a Syrah
which means it doesn't have a dot in the
filename which means it doesn't have an
extension and even though that could
theoretically be a valid image I don't
want to upload that so here I will
return an alert where I say please add a
valid file and of course feel free to
fine-tune this to your needs and be more
helpful with your error message or
whatever you like so we got a file and
it's well well it at least with our
basic validation here next I want to
turn this file into a base64 string
basically so you could say I want to
turn this binary file into a string
value which I can then later use to
upload it so this can easily be done
with the JavaScript file reader API for
that I'll create a new constant file
reader seems like a fitting name and I
instantiate a new file reader again this
is a vanilla JavaScript feature the file
reader allows me to convert this file
for this I have to call or I can call
read data I read as data URL and I pass
my file in there so the first element
any files array however this will only
trigger an event want to the stand it's
an asynchronous action so I have to set
up an event listener add event listener
and I have to listen to the load event
which is fired once it is done in the
callback here I can now get access to
the result of this operation which can
take a couple of milliseconds up to
seconds and here I want to set this
image URL equal to file reader result
and the interesting thing is the result
here is this base64 value which is our
image as text you could say now we use
the image URL here on this image element
in the source and the source is able to
handle base64 strings so we will still
get a preview with this approach which
is why it shows it I want to make sure
that you foul pick by the user can be
pretty
and that is easiest done by using such a
base64 string now with that we store the
result of this file reader operation in
the image URL property which again we
use the image element and our dom and
with that we're pretty much done here
one other thing I want to do is I want
to store the raw file too and for that
I'll add a new property which I'll just
name image which is null initially and
while I do have the text representation
the base64 representation in the image
URL in the image I want to store the raw
file which is the file a later use once
you submit the form so I will say this
image equal false 0 so simply store the
fall without any changes let's see if
that works let's first of all compile
this and let's now pick an image here
like this one now that hasn't work we
open the developer tools you see an
error cannot read property last index of
undefined the issue therefore is related
to this line however it's really related
to this line because I made a mistake
here it's not file name it's just name
so with that in place now it should work
we now pick that image we see the
preview here so that is working as
intended and work that we can now
continue filling this out and submit it
but we still won't upload the fault
because we haven't added any logic to do
so so this is the next step we have to
do make sure that upon submitting the
form we actually store the file in
firebase to upload that file once we are
done we first of all have to change our
uncreate meetup method in you create
meetup component still there right now
we submit the image URL and we store
that in firebase and that was nice at
the time we just pasted the image URL
into this text field but with a real
fault this won't work yes this would now
hold this base64 string and yes
theoretically we could store that in a
database because if we then fetch it
again it will work but it's not optimal
because
string is obviously a very big string
and from our file size perspective it
can get really big it's the whole image
in a string in the end
so therefore storing the image like this
in that good we should store it at the
database instead we should store the
file as a binary file in the database so
to achieve this what I'll do is I'll get
rid of the image URL here and instead
store image and refer to this image
remember this image really is just the
image which I set up here and we're then
ultimately safe to fall here so this
really is what I want to submit and what
I want to store now of course you can
even go ahead and add some validation
here in oncreate meetup and make sure
that the file is null so here we could
check if this image or check the
opposite to be precise if not this image
simply return so submission will not be
allowed if the image is still undefined
or null as it is initially now with this
basic validation in place let's move
over to the more interesting place the
create meetup action here in our view X
store because this is where we pass this
data to so let's head over to our store
index.js file and let's work on that
there we get this create meetup method
and we store the image URL like this at
the moment now of course we can simply
remove that because in the first action
here basically where we push our new
meetup onto the array of meetups and
firebase there we don't want to pass
that download URL queue now what I want
to do here is like a free step approach
because we have like a egg chicken
problem do you say that egg chicken we
say that in Germany so whatever what we
have here is we want to store an image
on firebase and we want to make sure
that it is connected to our meetup here
so we need the idea of the meetup the ID
of the meetup is created by firebase
though so what I'll do is first of all
I'll upload all the data I have to
firebase to the database there which
the idea the idea stand returns here
there's keyword already retrieving I can
then use this key to upload my image and
associated with that Meetup
then I'll get hopefully a success
response and in this final step in the
success response I actually get the URL
to the image where it was stored by
firebase then I reach out to the
firebase database again and update my
meetup there to add this download URL to
the firebase object I have stored so to
the meetup object I have stored on
firebase I should say and then we're
done so step one is already implemented
we're storing this on firebase and let
me quickly head over to firebase so
here's our database and we already have
to meet up here now I'll get rid of
these for now because we'll replace all
that anyways and let's head over to
storage this is where I want to store in
my meetups and this is basically the
bucket where I want to put them now in
the main dot J's fall where we set our
project app there we have to add this
storage bucket to the configuration so
it's simply this URL here you just copy
that including the GS colon slash slash
at the beginning and enter it here this
is important so that the firebase SDK is
able to do that uploading for you with
that let's head back and let's implement
the actual uploading logic so as I said
we already have the first step where we
upload the meetups by pushing them onto
this array and then we get this key now
I won't commit my meetup at this point
I'll comment this out for now instead of
when I use this key to upload my image
next so I will simply return the key
here to keep it really easy to keep
track of everything and I'll chain
another then call here now and this then
call here I'll get the key because I
returned it in the previous than call
here and here I now want to reach out to
firebase storage first of all I'll
determine the file name and I can get
that from my
payload and they're from the image the
name remember payload has an image
because we pass image as part of this
object here so image is part of the
payload which reaches this action here
so we're retrieving the name of that
image additionally I want to know which
extension has so I can receive retrieve
the extension and store it by simply
taking the filename and slicing it and I
want to slice it at the position of the
last index of a dot so this will
basically give me the slice after the
dot which should be the extension and
with Dad we got the extension now I want
to store it in firebase so for that we
already import firebase here for that
I'll reach out to firebase firebase but
not the database but to the storage part
of it instead just like with off and
with database we get access to the
storage related methods by executing
storage as a method on the firebase
object and then there just like on the
database you get a reference to the path
where you want to store it and here
meet-ups makes sense however I don't
just want to store it on meetups I want
to store it on meetups and then connect
it to the key we have here
so this basically will be the file name
we save it at so I want to store it me
at meetups and then slash plus key plus
a dot plus the extension so what this
will do is it will store it in a meetup
subfolder because of the slash so that's
a folder and then the file name will be
the key
so does random ID generated by firebase
dot the extension of the file so that we
keep that extension on the fall we store
and that is actually as novel return
this because it will return a promise so
that we can chain another then call now
here I will get some image information
I'll call it like this or generally
maybe file data so the data about this
file upload
was successful which it hopefully was
the important thing I can retrieve here
is the image URL which I want to use now
I want to use the image URL to reach out
to to firebase and update the on the EDD
image their device URL there now to do
there's an easy way and because all you
need the image URL in a number then
block there after I'll quickly create a
variable before I start this whole
promise chain and I'll name it image URL
I'll also create one for the key and I
will therefore store the key in that key
variable here and I'll store the image
URL here in this image URL variable by
accessing file data and then there we
can get access to meta data and then
download URL source download URLs now
these could be multiple as URLs if we
had uploaded multiple files we only
uploaded one so it's basically the first
element in this array this is the URL
pointing to our fall and it is the URL
we can paste into the browser to load
our image so storing this now I want to
return a number fire-based call this
time to the database again because as I
said now I want to update update my
element in the database with this
download URL because I still want to
store that in the database so I'll reach
out to my database and there rep queue
meetups because that is where I stored
my meetups right however now I need to
access my specific meetup which I can do
with child and then the key that is why
I stored it in a variable here because I
needed in this then block to key was
created by firebase and it is the
identifier of the element which was
created in the first step of this
promise chain in this step here so now I
get access to that and we can now
conveniently call the update method to
update this which means it won't remove
it it won't override it it will only
overwrite the fields we specify
we specified them in a javascript object
and here I specify the image URL field
and if that feels doesn't exist yet as
it is the case here it will simply
create it
so here image URL should have a value of
image URL so the image URL we fetch them
saved in this variable now with that
let's add another than block here here
we would get back some data but I'm not
interested in that instead what I want
to do here is I want to commit this to
my local store because thus far I can
remove it up there that's far we only
worked in firebase we are stored data we
uploaded the file but we haven't
reflected any of these changes in our
local store which I of course want to do
so here it's time to commit create meet
up again I want to take my old meetup
data which I already have so that is
just the same code we we used before so
use this meetup here
however this meetup lacks the image URL
so I will add it here I will add image
URL image URL and we of course need this
because we're retrieving it in our
template we need dead image URL and this
will be the image URL we got from
firebase from firebase because we're
referring to that image URL variable
which I'm setting here whoo so that was
a lot so with that it's set we're now
having this hopefully stored of firebase
and now let's simply try out if it works
if we head over and we organize a new
meetup we already are logged in still so
let's create a new meetup de San
Francisco meter because the images from
San Francisco so the location ship roll
be their cue let's pick that image it
will be awesome and I won't bother
changing this year I'm interested in if
that works too let me open the console
to see any potential errors click create
meetup and we get an error cannot read
property download URLs of undefined
now let's check our firebase back-end
the meetup was created here we don't see
the download URL because they clearly
failed and
storage we also see no fall there so the
file upload itself seemed to fail that's
why we don't have any download URLs
probably now let's investigate why that
happens so after a short investigation I
made a nice discovery and it's super
hard to spot but there is one thing I
forgot when setting up this code do you
spot it well it never hurts to actually
also send the file to the backend right
I got my reference here when I reach out
to storage and I basically set up where
to store the file and how it should be
named but it would probably also be
beneficial if I would specify the follow
on a store and we do this by storia by
chaining put so just like on the
database where we also set up a pop and
then we call update or push well for
files we use put and that always is a
good idea to use if you want to get this
file on the server so for today isn't
there of course we now simply pass the
payload image which is this raw image
file keep that in mind so with that
crucial change in place let's go back
and I'll quickly get rid of my entry
here in the database first don't want to
have that so let's reload that should
should be gone it is so let's organize
the number Meetup let's see if it now
works so the san francisco meetup in san
francisco where we upload these san
francisco image and i've awesome here
let's hit create meetup now we don't see
it here now it's there now the image
loads that seems to work and obviously
we saw it work but if we check out
firebase here we see the image URL and
unrestored we also see that we have this
meetups folder where we have this file
in there keeping the file extension and
having this cryptic name which is the ID
we got in the firebase database so with
that this is working and obviously if we
click on it we also see the image here
so now firebase upload a
is working here we are now able to
upload images and not just pick URLs
when creating new meetups and I say this
is a huge step forward now in the next
videos I want to dive deeper into how we
can actually change existing meetups so
add some edit functionality and of
course finally implement a registration
functionality so we're nearing the end
of the series but we're not there yet
see you on the other videos bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>