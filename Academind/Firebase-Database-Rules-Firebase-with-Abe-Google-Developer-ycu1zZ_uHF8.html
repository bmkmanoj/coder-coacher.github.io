<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Firebase Database Rules | Firebase with Abe (Google Developer) | Coder Coacher - Coaching Coders</title><meta content="Firebase Database Rules | Firebase with Abe (Google Developer) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Firebase Database Rules | Firebase with Abe (Google Developer)</b></h2><h5 class="post__date">2017-08-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ycu1zZ_uHF8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this video and the previous videos we
had a look at parvis general and then a
total structure or data now we get our
structured data we get part of a setup
but now we wanna ensure that well we
write to this data correctly yep and
what can you tell us they're about the
rules basically which is a super
important feature yeah so the firebase
security rules are basically how you
restrict who can write your jism because
when you're dealing with a database that
gets written to from client devices the
likelihood someone could try to add
malicious data or you're you are just
not filtering out all the veteran of a
night right it's very high so we want to
use these security rules which will this
kind of JavaScript D type language to
say here's who can write where kids what
they can write that way you know that
the schema and the data that you're
having in your database will be great
then rendering that perfectly and
everyone will do what's expected and you
will be leaking user data to anyone who
shouldn't have it yes so like I said
this is a Java Script like language that
will kind of mimic the structure of your
database to let you let you lock it down
before we dive is that there's one screw
important thing because you could think
well why do I need this I could check
this in my client code right I could
basically do validation there I couldn't
even check the user ID there's one big
issue with that that your client that
code is especially with the web
application Joseph's always exposed so
even if you min apply it and make it
really unreadable there's always a
chance of getting there and basically
disabling your validation for example
and that's what we need to do that all
the time every time on the server you
can't have delegation on a client to
improve user experience but never just
rely on that exactly yeah you want to
use your contest validation to say oh
but that isn't a valid email address or
you know you you clearly didn't need
that character in there whatever but in
terms of saying you cannot write that
I'm not allowing you to write that
that's where you'll go zero yeah so why
don't we do a little bit into that with
with an example yeah yeah so let's go in
your data for a second and look at our
structure and the simplest possible use
case here is like a user profile so if I
have a profile we were talking before
about using this user ID here too
look up who created this message and
using that to pull in a photo URL or
anything like that so let's build with
that structure in here so we can see it
and then we'll write the rules to lock
it down to only I can edit my profile
and you can edit yours so we have this
unique ID that came from our app so in
this case I'm going to type it in in
reality you could make the structure
when your user signs in do it on the
client do it with a cloud function
whatever you want but here I'll just
type it in for fun so we'll go up here
we'll add a new top-level node called
users then under that will use this user
ID as a key I'll paste that in there
that is copied from that then we'll have
a name and we'll causes your Abraham
asking and you know photo URL I don't
have one so I won't actually going back
but we an add that and we'll get named
Abraham Haskins so that's our user
profile right now anyone could come up
with this right if you knew my crazy ID
which you would if you came in and
clicked at this message that your client
read the message you ever got your ID so
we need to lock this down to remove the
rules by default you have two rules in
your firebase database you have your
read rule which obviously controls your
ability to read data and your very rule
which controls your ability to write it
and the defaults are opt doesn't equal
null revolt mm-hmm this is already a
little strange because we now know the
soft object is but it's pretty
straightforward
the object is your user so when you sign
in with any type of authentication
firebase authentication and try to write
to the real-time database the user ID
the information about what's up a
provider to github or Google or whatever
August past through to these security
rules as this alt object so this is
opposite you can think of it as your
user resume to what we're saying here is
that you can read all the data in my
database
if auth doesn't equal no if so in other
words if offers anything or if you're
ascendant yep if you're not signed in
off it's just going to be nope it's oh
it's going to be empty so you can't read
anything if we change this to for
example true that would mean anyone can
read our data and that has some
interesting side effects you can go and
for example polio and Qatar they said if
it's down education right now so you
generally don't want to do that but you
could if you really wanted to or if you
were cut it up yeah I was not not mine
it a boy's mother maybe fewer yet so you
could do that but if we want to do
control that's not on the database look
like this is allowing reading of
everything we need to step in a little
bit but I think I think one cool thing
though strategists will publish this
will go over to this rule I will copy
this link there's an MC open up a new
tab paste this in and if we type in dot
jason on the end of that URL it'll give
us that permission to not commit because
our rules are saying you can't you can't
read that hospital no you're not
authenticated so if we say read true
published at hop back over here we'll
get our entire database back now as we
step in we're going to allow reads at
different depths at different locations
but we're not going to allow wreaths at
the root like this what we're just
saying pull my entire database ever yeah
there's no reason any user we need to do
that yet so let's make a profile so
we'll leave that as often doesn't equal
actually well completely remove that
rule because we don't want anyone ever
read at the root of our database and
then we'll mimic the structure of our
and quote yeah here I go
will mimic the structure of our database
so we'll have that and then there's a
lot of crazy fun yes yes you're you're a
mustache bracket oh that's that's a
whole week all today oh yeah
all right so have users and then under
users will have dollar signs
UID which I'll explain in a second then
under that will have I'm just gonna copy
and paste the whole dumb alt open I'm
already I'm cool yeah
and under here we'll have our read rule
which will look like men sometimes read
shell inches in they are it's like
programming is too easy as general we
definitely got to add in extra extra
difficulty isn't equal no so what we've
just done is made this hierarchy clean
it come there we publish this if we go
back over here we were regularly refresh
this as soon as they permission to not
yet we removed that renewal at the
beginning or further of the database but
now if you read users slashes specific
user ID so this is a wild card
yeah so we're sending users is going to
line up with users here this top of them
then it's the wild-card is going to
match this crazy ID Elton so give you
any any I yep and then down here we're
just saying now you can read it so the
table card here isn't going to be used
right away but we can use it in a room
so I guess that this off object is
actually our user it has all the
properties about who is trying to make
this request so if we set off that you
ID equals dollar sign UID digital is now
going to say the only person who can
read this is the person whose UID that's
been secured and verified by firebase
authentication matches this UID mmm-hmm
so we've not lock this down so if I go
in here even if I like stuffed into you
know deep down let's let's run these
down into this location and we can read
this type of signal also to slash users
slash that shift elements to keep there
you go it's going to give us a
permission denied but because we run
authenticated which is exactly what we'd
expect but if we went into our app and
tried to read that
it'd be all good but this isn't quite
the case we want write a user profile
should be readable by everyone but it
should it be writable everyone so we'll
change the through a rule and then we'll
change the dot read
the reason to green actually to say true
by default we already saw it basically
but by default if we don't specify read
it it's all sinful but everything is
locked down by people exactly exactly so
now anyone can read that profile but
only only you can write to it and we can
check out one more time I can actually
step all the way down into this because
URL command ztp is that in Jason and it
will let us read it now you'll notice
this object that gets returned has a
property called name and it's a of
haskins which is just like the data we
have under that object but we can
actually set in a level deeper if we
wanted to so we can say slash fashion
name and pull out just the name and then
it's just a string so by giving someone
read access at the user level we give
them read access completely read access
to everything under echo spectral we're
talking about where you're loading data
you're always loading all of it onto
that location if you're giving someone
to read access to something you're
giving them read access to everything on
dissolve location but at this point
we've lost the step that user profile is
not getting changed unless you are the
person who is signing with that UID and
that's not happening unless you sign it
with that residential and you have to do
anything special on your client and
forces as long as you've signed in your
you're good to go okay cool um and do
suspicious it will go down so if we have
read access there we can also read the
note space here but doesn't it doesn't
doesn't also propagate up so if we have
some read or write access level user IP
can we also write to user since yeah so
you can review can write anywhere below
so if I'm if I have write access to
dollar sign user ID I can write to
anything below edit so I can write to
the name I can write to the account as a
whole but if I have write access only to
my account and I try to write at users
that even if the only change to the data
my you ready it would be disallowed so
you have to write to a location where
you have either an explicit rule or one
of the parents has a reader right room
for what you're trying to write okay and
we do a read and write here
yep I believe there also is a burdock
like valios
yeah what's the role of that now that's
compared to two like yep so read
obviously reading writing is saying can
I write this or not validating is for
checking that what you're writing is
okay so where's writing is I am like
allowed I have the right you ID valid if
you're checking is this a number is this
a string is it within the length does it
match the trigger all of those things
which really aren't part of the
permission model but part of this schema
that gets enforced in a dot validated
role so we could add one for our user
profile we could say under this so we'll
have a child that is named and we'll
have what we actually might add it to to
mess just maybe because we can but or
just from our weapons and now we have
this looks good you know we could force
said it has to be like six characters
long or something like that
yeah so we can do a bunch of different
stuff like that in this case we're using
our UID here so what would you want to
enforce on the method everybody said
it's a cause and should be at least our
own yeah something like that
all right so let's do that we can go and
make another structure so we have users
but because messages are separate we
need to make another structure in here
oh this is a great catch actually so
this rule is still here yes aunt does an
equal null because that rule is still
here this rule would actually be
overwritten because this is saying at
the right yeah anyone can write so if we
didn't delete that that would allow
somebody to write in any location so we
really need it as we thought yep
absolutely
all right so we'll do that message is
node max so say messages and do
under that we'll do that same wild card
because our messages each have those
crazy ideas so we see a wild card match
Camacho and Peter Wong I'm so practicing
with the keyboard day yeah okay good
bananas I'm going to be like a pro to
imagine so
yep you're correct message kids and
we'll call this message ID this can be
anything you want yet whatever makes
sense to you is what that should be
called under there so now we're at the
messages level so in this case who
should be able to write a message
I think everyone who's opening at it yes
with me okay that's right alright so
we'll write that rule in real quick so
we'll said do that right anyone who has
off doesn't equal no good all right
who should be able to read messages
let's say everyone should be able to me
so here's an interesting point like I
was saying before if I was trying to
write at users and even if I was only
writing through UID I wouldn't be
allowed with this rule yeah that same
thing happened here with reading if I
wanted to read every message and even if
the read rule on the message ID allowed
it it wouldn't allow me to read messages
yes guru block down but evil yep so we
have to go a little higher to be able to
get the list of every message for this
writer for this read rule so if they
read and on this one we'll say aw
doesn't equal not like that what we're
looking for
yeah all right so now we're saying
anyone can read messages as a list they
can get every message ever but these
rules are the message ID we're stepping
into because we're going to do something
a little different all right so message
ID now I'm here we wanted to validate
the content length right yes but before
we can actually jump into the app and
show how it's working so far
absolutely that I've read and write set
up so we can simply open the application
still running and we need to sign in
there anyway so let me do that create
the user before hit sign in and now we
can what we're reading already so the
other time
yep right that works and about the
console too super
getting any hammers people you know what
it's good to good yeah it's very very
difficult all okay let's now try it
again and let's end and you message here
maybe mm-hmm let's hit Send and would so
that's what okay even maybe before we
continue writing it some screwed it up
and go back to our rules yeah and if we
set off simply to false here then we
shouldn't be able to do that so we can
still read everything so we still see
our messages here but if I now simply
sentences and the same message again
bizarre it was out there for a refurb
three if ii bejaz lost just duty
prompted f word to some optimistic
updating that's exactly and that's
something to keep in mind every stay
optimistic updated the firebase says oh
I think this red succeeded until realize
that didn't that didn't make it a server
that was never in the data's no one ever
saw that but your client side up so I
thought that was okay and then enrolled
yeah Joanne we see the error message
here to we're not handling it here
that's why it's just printed there but
we could catch that and outfit their
Krishna nicer way but here we got a
permission denied error so that's
exactly what we wanted to see because we
got some foolishness so yep yep 10 yo is
a great so now we're back to the
original state and now we can try to
validate it to make sure that we only
can write messages which have at least
six characteristics on yet so we should
be able to score heads in here right a
new valid a rule mm-hmm of course it's
all documented on the sides if you need
help following along with us
link can be found in the bishop's for
PDF and we have a reference for all
these variables everything like that so
when you write data to firebase it's
going to come in to the security rules
and two different ones one is data data
is the data app the location you're
writing when the right happens yeah
so what that means is if I have a user
profile and I write to it data is the
data that's currently that not the data
coming in with it right so we have data
and then we also
have new data and both our research
words we have to be have them can't we
can't take anything with a dollar sign
in front of it basically but these are
these are agents built-in - yes exactly
so new data will be the data that is
coming in with the right what's their
time - right
so in this case we're going to go and we
care about the content field it's what
it's called
so it's a content and it's validated
rule is going to happen on the content -
all right then we'll say new data
doctrine Val mm-hmm I can type that in
same job link also just a professional
development sense because that's also
how we can to treat data what we get is
in decline exactly and we say greater
than 6mm so just like a string in
JavaScript we can check it and we hit
published that's been published and one
of the really cool things is if I had a
mistake I didn't make any mistake here
but if the length was in a field eval
wasn't right it would tell me right now
this isn't something that would like
bubble up in your application if you
write your rules
although the logic might not be right
these variable names and stuff will be
right at each other's public okay so we
hop over here now and what they should
do is enforce the length of the content
field so try this with a new message
that's nice and long that should senders
fine yes but if we try to shorter
message that's only three characters we
just send flashes and we get failed
permission denied it looks the same way
on a client to security reasons we don't
want to say on the client like oh you
didn't fit this criteria because then
people would like work around it and
they try to get through your security so
we just say Commission denied you can't
write that that message is too short but
you could definitely catch that and if
you're doing client-side validation you
do the same validation - oh it's too
short
I can bubble up a good message and
there's xxe the thing we talked about
earlier so here obviously dis message
alone doesn't allow us to create a good
user experience because we couldn't tell
is this because we're not allowed yeah
what's wrong it's not like the off
message right that wasn't really nice so
that's why it's important to do decline
that authentication a validation when we
were smells check this before we send it
and
someone disables dad well then we don't
need to show a good error message
anyways yes yes and generally if you get
permission deny there's those are
malicious users these aren't the type of
thing we expect a normal user in the
course of juicing you have to hit yeah
so if they are hitting those you don't
have to really be that nice to them yeah
if they're probably probably not being
nice to you because through the trees
should manage nice stuff in your client
app anyway yeah exactly yeah
and validation rules are a little
different there but in general should be
in the middie permission designer yeah
cool so the very last thing in terms of
our message that I want to implement is
not want to make sure
right now we're constricting who can use
who can write to their profile and we're
relying on the data here inside of our
messages this usually built to be the
right user ID that we're not enforcing
that yeah so anyone could write anyone's
user ID and it would end up looking in
the applications like people sent by you
or if I need when that's not who's
sending it yep so let's make sure that
this user ID field when it's being
written is the UID of the actual user so
we can do that same thing here where we
have will step in to a field this one's
called user ID just like in our actual
data I will say pull up that and this
will be another validation role this
could be a write rule but remember that
we're giving them right permission at a
higher level so if we had a right rule
here it wouldn't be enforced because we
give the information up here so it has
to be a validating rule which allows
them to write I go to this location or
this location and have it be validated
all right and then we'll just say new
data file and that's going to equal
equal equal ah you ready it publish
that's all you need and now no one can
read a user ID that's not various and I
don't believe we have a super simple way
to show us in the in the app but we
could try to pack it and write data and
it would
we not let us edit so we know that not
only is this profile locked down to the
right user but every message that comes
in has the real your idea crew rotor
yeah that that makes makes a lot of
sense can actually I guess now we can we
can show if we add a new user and edit
the code here arm could simply our code
D oh yeah I'm saying that I write it now
a Big Island down with something you
can't do it with disuse or even simply
just at any random string here it
doesn't matter so in this case it's
random but it could be another user ID
and admins ID anything like that that a
malicious user might get their hands on
exactly and if we know safe this and
quickly log in again you saw the Pyrates
all to make sure that we can test
multiple yeah that my friendly error
message probably on a provides from the
year a speaker yeah and now we can see
that if we open up the console and would
you like some message here you're gonna
get out permission not because we well
try to override this is ready which
doesn't worry yep
and you mentioned something else very
important that in the rules very birth
question is what's the exact difference
we could be between right and delegate
because obviously you can use the new
data variables and so on yes also in the
right here at i/o we can no that's not a
difference the technical differences in
how they castrate which is an applicated
way of saying this right rule even if I
put another retro key content instead of
that validate rule this rule would be
overwritten
every time that by the parent one it
would be ran if they were trying to
write specifically to messages message
ID content but otherwise this parent
location is going to be the right role
that gets rid validation rules get
applied at any location so if I'm
writing even though like messaging and
I'm writing a really deep object that's
message
message-id whatever whatever those
validation rules have to pass
so the validation rules are like I said
for enforcing schemas of making sure
that this data if it gets in here in
regardless of what allows them to do the
right that it matches the format you
want it to match that's what you do in a
validation that's really important to
know because it can be confusing because
you have two ways of controlling the
items accurate actually when terrorists
can say right is for everything which is
we're going to write permissions to
authentication to or doctors indication
of permissions who is able to write
something or what can you write and
validations we just four well
publications yes yeah right it's for who
relatives for what yeah yeah perfect
and obviously if you want to dive deeper
into that and learn about all the
built-in variables because here we saw
new data and eight Minch data you're man
we come off but there are more than that
and you can find them all in the
firebase reference you can also find
great articles here so if you scroll
down security rules there of course the
same for all infection yeah there's a
lot of information about it with a lot
of examples because super important to
get that right obviously because always
important you can't control it from your
province you need to do this here and
you have a very expressive language you
need to get the grasp of it I guess
because it is not super obvious how it
works maybe at first look but it's super
easy to get into the end yeah once you
start saying that's just mimicking the
structure of your data and put in my
little JavaScript snippets in there it's
it's pretty straightforward and
realistically your rules don't have to
get that complex if you do good
client-side validation as long as you're
enforcing who is writing where you'll be
able to get a spot yeah that's that's
important too because here in the
Security section there are really
complicated rules too which makes sense
but oftentimes you doing me to go that
yet a lot of times you don't have to
yeah and India is the type of thing
where if you really care about your
schema or you think about malicious
users like you could or if you really
care about rendering right and you don't
want a malicious user to break your UI
you can also be smart on the UI side
because there you can write some ugly
dated
I'm not going to write every valid rule
to be completely perfect
but when I get it back I'm just going to
check it I'm going to be like does this
make sense for what I'm trying to do and
if it doesn't you throw it out and
either delete the record from firebase
or send you an alert and say hey someone
did this you have a bunch of options but
you don't need to dive super deep and
divide into security rules to get a ton
out of them but you should definitely
invest enough to lock things down and
understand what users you're writing
wire yeah so that was good but just one
last point notice here's we all have
have children and child here I think
these are many things you don't need
that office we just set but it is
important to know about them because
right now we always considered rules
where we only have a look at the node we
were writing or reading we can also
reach out to the parent Bill clicks on
your condition is like to death life
yeah for example you're on content you
could check that it matched another
field or you know like content or you
know a timestamp matches another that I
created and things like that where you
rely on each other's data you can
definitely do that and on the parent
level you can also say I this parent is
only valid if it has these children so
it needs a content field it needs to use
your ID field you can basically do the
same as these validation rules on the
parent and say okay this parent child
has to be a string it has to be that
it's a little cleaner to do it this way
but you can definitely do that where
you're like reaching out
and you can affect control the entire
database or not control it but access it
from any rule so you could say okay you
can right here if you're the right user
or if they're an admin and you could
have a table of admin users that just
have you IDs like to true and when you
go right go in your rule you can look up
in that list and set up the Soraa you
ID'd their ads and let them write so you
get access to everything it's not just
the field that's being written to that's
super important to you and what did I
guess
gonna love tools to work with I want to
say a big thank you to you we're walking
up through that and giving us a little
more well an introduction from someone
who works on the product
absolutely thanks for my hope everyone
got something out I think I hope my
genuine excitement for the product shows
through kind of absolutely love them
stuff if I read it sure does and I will
also do some I'm religious about that
where we dive into you how we use the
SDK and so on so that all part of this
series but we often see awesome this
Custis yes thank you
mm-hmm</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>