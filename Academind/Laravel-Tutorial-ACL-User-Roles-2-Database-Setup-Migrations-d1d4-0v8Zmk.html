<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Laravel Tutorial - ACL (User Roles) - #2 Database Setup &amp; Migrations | Coder Coacher - Coaching Coders</title><meta content="Laravel Tutorial - ACL (User Roles) - #2 Database Setup &amp; Migrations - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Laravel Tutorial - ACL (User Roles) - #2 Database Setup &amp; Migrations</b></h2><h5 class="post__date">2016-04-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/d1d4-0v8Zmk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm going to start implementing my roles
by starting on on the database ads way
adding these roles setting them up in
the database for this to work I will
need three tables I already got one
which is the user table which holds the
users of course I will have a table
holding the roles and then the third
table will hold well kind of the matches
where which basically will hold a user
ID and they're all ready to match users
with roles because this will be a
many-to-many relationship one user may
have multiple roles and one role can of
course be assigned to multiple users
therefore we need free tales I'm going
to use the artisan command to do this so
in my terminal video I'm going to write
PHP artisan make model and first I want
to create a role model
- am to also create a migration file as
you can see this added this role
PHP file this model file here and it
added this migration file let's start up
the migration this is the well
boilerplate level traded for us and I
will need two additional fields here
both will be stringfield's a name of the
role and well though this isn't really
used in this application to be honest a
description just to show how you could
configure your role so it does all I
need for the migration file here the
next thing is I want to go to my role of
PHP Maru file here and I will set up the
relation of this role to the user and
this will just be a public function
which we'll call users because many it's
many users and it will return this
belongs to many app user this is the
relation because as I said my role may
assign too many users therefore it
belongs to many users on the upper hand
in the user model here I will well
basically define the same but
just called rels and this will be
returned this belongs to many and that
app roll now we've got this many-to-many
relationship set up the next step is to
set up this matching table this third
table I was talking of so again back in
the command line here I'm going to write
PHP artisan make migration and then I
will call this create user role table as
he has created this file here this
migration file and inside this file I'll
have to read a little bit more than any
other migration files but I'm just going
to copy this here from my role migration
file down here I'll have schema drop and
table will be called user role here of
course to user role I will have well
increments time stems that is fine
however here I will have an integer
which will be called user ID and I just
copied this line because I'll have the
same for while the role ID the naming
here is important because level will
look for a table called user role and it
will also look for a user and role ID in
this table when we actually use this
relationship we set up in my our model
files here you through levels eloquent
model so this is very important to
understand now you could change this
default behavior by when creating this
relationship adding additional
parameters here where you could say and
let's actually do this even though it's
not necessary here you could say okay
the matching table is called user role
that's just a name I gave this table
here and as a set level will infer this
name by default but if you have a number
table name that's no problem just
specify this an extra parameter and then
as an additional parameter you can say
well the foreign key here in this case
we'll be well user ID also you might say
well the other key of my row will be row
ID now I'm just going to copy all this
and in my role model file I'll insert
this and of course this has to be
changed here in this order so that's
very important to understand to get
right as I said wouldn't have been
necessary here because that is the
default level at first but whenever you
change names does the way to set it up
so what this out of the way the next
thing I want to do is I want to see some
data I want to create some default roles
which are always in there when we start
or create our application so as I
already get my user table cedar which
sets up my users I will create a new
cedar for well my my roles and I will
again oops
do this in the command line here where
typing PHP are titian make seed and then
I will just call this role table cedar
and the name is purely up to you here so
now this cedar here was added and as you
can see it's just an empty function or
the run function and inside this
function I will create a code which I
want you run through upon seeding or
yeah when I basically run the seed
command on the artisan command-line
interface what I actually want to seed
here is I will well say we have the row
for a normal user which will be a new
role and I will import it at the top so
we will use app role so that I can just
write new role here and while this role
user this user role whatever the name of
let's say user and it will have some
kind of description and I will just
write a normal user
and thereafter I will save this now I'm
going to quickly copy this and create
two new users the first one will be my
my offer user here role offer another
will be called offer and here the
structure will be an offer and then I
will have my admin that was the wrong
key
I will have my admin here role admin so
with that we get the free roles we need
for our application to work now the last
thing is in the database cedar file here
I will basically uncommented here
because I already wrote it but we have
to call the role table cedar and then
thereafter the user tables here now the
order here support because I were to
change the change the user table cedar
in a second because in the user table
see the ruler very setup our users I
also want to assign some basic roles to
them I'm currently not doing that but I
told you in a second
therefore it's important to first create
the roles so that they can then use them
in the user table cedar which I'm doing
now assigning roles is pretty easy first
I'm going to retrieve my three roles by
just saying well accessing the database
through a lock when so with the role
model and you're just say well my user
model is where the name equals user it's
a name we just defined and here we will
get the first role and I know I only
have one set us will fetch the only role
I have the only user role now of course
this will change to role offer here and
here it will be rolled admin and here I
need to make these changes you
so this retrieves the roles and now to
assign them to user is super simple
letter well allows me to do the
following I can access the user of
creating here or I already created
saved and the order is important here
again it has to be saved to the database
so the letter can actually create the
relation because remember we have this
third table where we have the role ID
and user ID level can only create an
entry in this table which defines the
actual relation if we have a role as
well as a user in the database because
it needs the IDS of the user enter role
so we have to save the user and
therefore write into the database before
assigning a role and hence creating the
relation that's very important and I
hope it's clear why so what I'm doing
here is I access the roles relation with
parentheses here because we're still in
the query I'm not accessing at it as a
property where I then want to let's say
loop through all the roles this user has
but instead I want to kind of create a
join statement if we were to translate
this into SQL so I use parentheses to
say now connect the user with the roles
table here and then I use the attach
method the rule provides me with the
eloquent model and this allows me to
attach a role because I'm accessing
rules here to this user and the role I
want to attach is role user now of
course attach tests only work with roles
and users it would be the same behavior
if you have posts and comments for
example this basically just says or
tells angular angular wearable that you
create a relation and to create this
entry I was just talking about in this
third table not just copied this here to
my admin where I'm going to assign role
admin and finally to my offer here at
the bottom where I assigned role offer
okay so now let's write all the data to
the database for running PHP our it is
my great - - see
to also run the seeding after the tables
have been created looks good and now
what I did here or with what I do have
here is I have my well this is a sequel
Pro which allows me to connect to my
database and have a look at the contents
and as you can see I got my rolls user
roles and users table in the users table
I got my free users and roles table I
got the free roles I set up and then the
user role table you can see I got the
assignments of user 1 has Row 1 and if
we have a look user one is the normal
user not the admin not the offer and it
has to roll one which is the normal user
role so this works this is how we set up
our database how we see it data and in
the next part we'll have a look at well
the actual work how we protect our
middleware and how we restrict access
based on these roles which just set up
see you there
bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>