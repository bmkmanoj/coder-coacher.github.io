<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>LARAVEL JWT MIDDLEWARE | Laravel + Angular 2 / Vue.js 2 | Coder Coacher - Coaching Coders</title><meta content="LARAVEL JWT MIDDLEWARE | Laravel + Angular 2 / Vue.js 2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>LARAVEL JWT MIDDLEWARE | Laravel + Angular 2 / Vue.js 2</b></h2><h5 class="post__date">2017-02-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jWYqulDpZWo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back in the last video we
implemented this check if we can get the
user from the token and only if we are
able to extract the user and we can't we
could use the user object thereafter to
maybe assign it to a quote and so on
only we were able to extract user does
this code proceed so only in this case
are we able Q well X is our quote here
or create a new quote in this case now
also want to protect the other action
and as I mentioned at the end of the
last video we could simply copy the code
into every other action and that would
work but that is not really the best way
to do it because it repeats our code all
over the place if we change something we
have to change it everywhere at last not
in the best way we can use a middleware
for this and the JWT off package which
we are using already ships with some
middleware to use so all we have to do
is register this middleware and we
register middleware in the kernel of a
PHP file this is where our level
application gasps kind of configure to
where the requests get me a configured
you could say where we can in general
set up middleware you we want to apply
to our requests and we can set up some
specific middleware which gets applied
to every request we can define some
groups which you can assign or we can
assign or create some off middleware
choosing some route middleware like the
off mode where it is all built in
middleware lateral ships with and you
might know this middleware now didn't
Laurel ultimately we're here won't do
the trick for us because we're using
your normal off system we're using the
JWT token thankfully de package we're
using ships with its own middleware all
we have to do is assign it here in the
route middleware array so that we can
then assign it in the routes file now it
doesn't matter where you add here I'll
add it at the end simply to well have
the separation between built-in and new
malware and you can give it any name you
want you're totally free to choose that
name I will name it J WTF you kind of
resemble this off here or maybe off dot
JWT makes even more sense and then we
have to point Q Delaware now the
middleware path is taemin so this
package
then kwt off and in there
we got a middleware folder named space
basically and then we have to get user
from token middleware and here we need
to get the class so get user from token
as the name implies fetches the user
from the token and validated so it
basically does what we did manually here
this is what this class does and with
that check in place we can apply this to
any route we want to protect so let's go
back to the API to PHP file and simply
add Milla where's so for example here on
the host route here I want to assign a
middleware and the middleware is off dot
JWT we'll aware of course just like this
I'll do the same for this pointer out
here and for the delete route these are
the routes I want to protect and of
course you could also group them and
sign amble over to the whole group I'll
leave it like this for now what's that
the middleware is in place and let's
first see if this works as it should so
let's create a new quote here and I'll
simply change the content to a novel
quote the token should still be valid if
it is invalid for you simply get a new
one by authenticating again and if I hit
Send and now a quote this works now
let's try a put request to change this
quote now let's quickly have a look at
the quote controller for the put request
we also need to pass the ID of the quote
so if we have a look at the database we
could change one or two let's change one
and we don't pass the ID here we passes
in the URL before the query string here
so just slash one to change quote one
change this to a put request and change
the content to change and let's now hit
send because this is only protected by a
middleware we haven't got our own check
in place there and that looks pretty
good to me looks like it was
successfully changed and we can of
course confirm this by having a look at
the database what we see change
so our middleware protection here seems
to work but now we did it'll just a bit
works right what happens if we provide
an invaluable
touken here if we do this then we get
detailed cannot provided error and the
sense of course true if we strip the
token all together then we get this
error Hugh if you're wondering why the
error message changed that is that the
or because the UM DTU package has its
own error messages in the arm in the
middle where where we're using here so
it overrides our handler if you want to
change this behavior you can find a
description on the documentation of the
package I showed you earlier in one of
the last videos where you can see that
it requires a couple of events whenever
the validation fails and you can hook
into those events listen to those level
events and overrides the error message
there but I'll leave it as it is because
typically you don't display this error
message to user anyways you just need a
kind of identifier to to see which error
messages is to check this in your
front-end code and then display a
user-friendly error message anyways but
yeah enough of that let's remove this
check here in the post code message
because we're now using the middleware
we don't need it anymore
but how could we now retrieve the user
if we still need it well we can simply
get the user by using the chat uh beauty
of off the safe and then parse token
again as before but now not authenticate
we don't need to do that we already
authenticated the user in the middleware
instead we can call to user and what
this will do is it will give us the user
only call this if you are sure that you
already did validate the token and
authenticate the user which we did with
the middle aware because this will not
check if the token is valid it will not
check if the user exists and so on it
will try to give us that user encoded in
the token so it definitely only run this
code if you did check the validity
before with that though we get access to
the user because now use it to assign it
to a quote I will simply return it in
the response so that we can see that
this does indeed work and with that back
you postman if we change this to a post
request like and try to create a new
quote therefore change the URL and make
sure to pass the token again if it
expired
make sure to a penta Kate again to get a
new one
and then change this to a new quote
let's end now we see that if we turn it
too pretty here we get the quote return
we also receive the user so retrieving
that from the token worked fine this is
how we can use a mail aware and then
still get access to the toolkit but use
the middleware to protect the route
without repeating our code all over the
place with data blaze our back-end
authentication works we can now protect
our routes the next of us goal is to go
back to the front-end and implement some
code in angular 2 and view chairs q well
get to token there to store the token
and send the token to authenticate our
front end user</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>