<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Final Touches &amp; Deploying the Blog | Nuxt.js &amp; Storyblok - Building a Complete Blog | Coder Coacher - Coaching Coders</title><meta content="Final Touches &amp; Deploying the Blog | Nuxt.js &amp; Storyblok - Building a Complete Blog - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Final Touches &amp; Deploying the Blog | Nuxt.js &amp; Storyblok - Building a Complete Blog</b></h2><h5 class="post__date">2018-04-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JHCKab2oS4s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to this video by the end of this
video we'll have our example next and
story block block deployed I will show
this at the example of AWS as free but
any static hosts can be used because
we'll finish this app up do some nice
well fine tuning steps and also ensure
that we can build our application both
in development and production mode that
we can publish our posts on story block
previously we only worked in draft mode
now we'll we'll use that publish button
up here and that we also are able to
preach generate the page with this nice
generate property in the next config
where we dynamically fetch dynamic
routes a lot of grounds to cover so
let's dive right into that
so let's start preparing our application
for production first thing I want to do
is in story block in our block folder
right now the a second post post works
fine in the preview right we we see
everything the way we wanted to see
however if I go to our first post we
can't find that page and the reason for
that is that here in the URL we still
have slash blog as part of the path now
we fix this for the second post by going
to the Advanced section here and
defining a real path which was just our
first post now the problem is that we
effectively have to do that for all
posts we create which of course we can
do but of course we can also organize
our content differently here on story
block to circumvent this issue or to be
very precise what I want to do is we're
on the blog path here so we can go back
to our next project and in our pages
here we could also add a block folder
here in that block folder we add an
index dot view file and we move our
underscore post id folder into the blog
folder so I'm kind of rebuilding the
structure as we structure our content in
the content management system on our
next project tube so now we got the
pages laid out like this of course this
index dot view page here in my block
should now receive the content I
currently have in my main index of view
file so I'll move that over here so then
now I simply copied the content from the
root and it's the view file into my blog
in next review fall and with that we're
fine we can now still fetch our stories
as we did before we don't need to change
that now in our main index or view file
I'll also leave it as it is but the big
advantage is that now our blog posts are
indeed loaded under their ID as a sub
part of our blog folder so now if I save
that and I go to our first post this now
actually works because now our path on
the front-end includes the block segment
tube and for second post I now need to
fix this by going to advanced
and removing this a real par value after
I had safe there it now all the works
now of course this is only an option if
it's fine for you to replicate your
back-end conte instruction your
front-end but you typically want to have
these two in sync because the logic by
which you structure your content
typically is the same and here I'm
perfectly fine with having slash block
as an additional path so back on our
page we can reload the main page but if
I click on a post this doesn't work
anymore
because now I obviously need to update
my links there in my post preview
component here there I'm linking to just
ID now this simply has to be slash block
slash and then the ID so like this if we
add this year and we now reload our main
page like that now we can go to our blog
page and of course this now all works if
I now go to just blog here then I'm
loading the same page and I can navigate
there too so now this is working
whenever think we could work on is that
all posts now brings us back to slash
blog instead of the root page even
though that's the same here but if we
wanted to fix it we can go to the header
and there we have all posts that we
could navigate to blog here one
advantage of this technique is that now
if I go to a single post I can enforce
this to be highlighted just as if I'm
just on slash blog because if we inspect
this item in the navigation if I
selected here inspected we can see that
slash blog actually has this nav link
next link active class added to the list
item when I'm on slash block and we can
take advantage of that we actually do
already do that here we're assigning our
or a color here border bottom I need to
adjust this though to not have to exact
in it because I now actually want to
color it like this always
even if I'm loading a sub-segment of
/ block so now I'm just removing the -
exact part from my next link active or
exact active classes and with that you
can already see now it's marked as
active if I'm on a blog post as well as
if I'm on the here are all blog posts
page now one other thing we can also
notice is that if I shrink this page the
blog posts don't have an equal width so
back to post preview there on the
overall post preview there we're setting
the width to 90% and on bigger screens
to 25m now theoretically you would say
this looks good right they should all
have to equal width the problem just is
that if we go back and inspect this all
we're setting these with settings on the
post preview CSS class which is attached
to the article element however these
articles are wrapped by a link and that
link actually is not a block level
element it doesn't take 100% of the page
width and therefore the width in here
90% refers to the width of our anchor
tag which is an inline element which is
only as wide as it needs to be to fit
the content into itself and therefore
these 90 percent don't have any effect
at least they're not relating to the
page width so if we one relate to the
page width we have to ensure that we
style these anchor text differently and
one of the easiest ways of getting the
result you want is to simply take our
class which is attached to the article
and simply add it to the next link
instead if we do that and we saved at
all and we reload now we get the style
we want on both mobile and desktop
devices because now we're styling this
anchor tag differently and Disney n is
the wrapping container holding our whole
post preview here so this also is an
important change I definitely want to
put into place with that our application
is taking shape and now when I prepare
it to get published now to publish the
application or our blog there are two
steps which are important the first step
is performed or done on storey block
our posts here they're still in draft
mode so we can go to a post and click
that publish button up here to publish
it that's all now you see that this
green bullet here is lit up and I can do
the same for the first post and now this
means that we can fetch them on a
different API instead of fetching our
blog posts with the draft version we can
fetch fetch them with the published
version however I don't want to replace
this manually here instead in
development mode I want to use the draft
version so that whilst I'm working on my
code here or if I'm spinning the server
up to see a preview on story blog when
I'm drafting posts that I already see
the draft the posts and not just a
published ones if I build for production
though I of course want to use the
published version and now we can take
advantage of another feature offered by
next next actually tells us in which
mode were running our application it
switches the mode to production whenever
we're building or generating our next
project if we're just running it with
the development server in the package of
JSON file that's the case if we run the
def command so just next year indirectly
then we'll be in the development mode in
build and generate will be in the
production mode the generate will become
important in a second so we're in
development mode right now and we can
get access to the information which mode
we are through an environment variable
debts injected into this build process
so to say by next we access this
environment variable in a node.js style
by accessing process and now there's a
simply global variable we can access in
our build process it's populated by next
and it gives us access to an environment
property which holds environment
variables which are set up by next and
they're on the other hand we can access
the node and environment variable now
note n is either production in this case
I want to switch this to
published or it's not productions
development then I want to use draft so
this is one way of getting that version
and therefore respecting the environment
in which we're running an alternative is
that we can also use the context
variable or argument here I'll show this
in the block index here here we're
fetching the blocks and I also need to
pass the version here now we can access
context and there there was a is def
property this is either true if we're in
development mode then I want to use
draft or it's false if we're in
production mode then I want to use
published so just as in my index table
you fall in the post addy folder but now
with a different approach a both can be
used this environment variable file is
available everywhere this context based
approach is only available in async data
where we get to context now I need to
copy that code here into our route in
next review file because here we're also
fetching our blog posts and I'm adding
it there too and with that we now have a
setup that should actually still work
fine in development mode and it does we
can still fetch our content here oh we
also need to update this in the about
page there we also should use that
either the environment variable or
context and with that we got an
application that works fine in
development but that should all the work
fine in production and now that's the
other part I want to build this
application for production of course I
want to serve it from a real web host
now preparing our CDN links here to
fetch the right data is one important
step another important step of course is
to simply build and optimize our
application now thankfully next gives us
the entire production build process out
of the box with all the optimizations
already configured we don't need to do
anything about that we just have to run
a command and now we actually have queue
commands for building our next step we
can either deploy our entire prod
check folder here two web hosting
service that runs node.js and then we
can run NPM start to use next start
indirectly which will spin up a node
server provided by next which will
render our pages on the fly so then
we'll have our application on a node.js
server the alternative is that we pre
generate all the pages so that we can
deploy a bunch of static HTML Javascript
and CSS files to any static host like
AWS s3 like firebase hosting this is the
approach I want to use because this
allows us to host our application in a
very cost-efficient way on hosts that
only charge us for actual requests
instead of for uptime so I will quit my
development server here and I will run
npm run generate this will execute this
highlighted script here and now it will
try to generate all our routes like the
about page ends on so first of all it
builds the project and once it's done
building it renders everything and get
an error here now let's see where this
is coming from if we scroll up we see
for the about page we get a 404 error
and the same for the just slash nothing
page now this makes sense because whilst
we did change the version we're fetching
we did not update the token we're using
for fetching this if we go to the next
contact we see we're always using data
access token here now that access token
if we go back to story Block in to the
dashboard this is our preview token
which we can only fight use to fetch
draft versions now we can create a
public where token for published
versions by selecting public in this
drop-down and clicking create token now
this is DX is token we actually have to
use to fetch our content in production
now of course we can switch the access
token like this now if we rerun npm run
generate here
then we still get an error because the
problem wasn't really that token it was
a 404 error right not for a one for
unauthorized now that 404 error is also
coming from the fact that at the about
page isn't published so if we publish it
and then we run this again and we
replaced to token then we indeed do
fetch our content correctly so let's try
this again let's see if this now
finishes successful
now does looks better but of course we
have a problem in the next config we
hard coded that production token in
there but if we ever want to test our
application again want to run it in
development mode or maybe just want to
spin up the development server for the
preview on story block then this won't
work because now we have to publish
token and with that fetching draft
versions will be hard we can only fetch
published versions so we should go back
to the dashboard and story block and
fetch our preview token again and now in
the access token field we actually want
to swap that token dynamically and we
can again use a an environment variable
for this so again process enth
and now it's no 10 so that's the same
approach we used Nia next or do you file
any post ID folder and now we can again
check whether this is production in
which case I want to use that production
token we just hard-coded in there
otherwise I want to use that development
token I just fetched again from story
block and now we can try running npm run
death again and this should not work
with the preview tokens with token that
allows us to work with our unpublished
posts too and it should also still work
if we generate again then it will
automatically take that public token
which allows us to fetch published
content from story block and now we have
a really dynamic setup where we are
using different tokens and different
versions for fetching our story block
content now npm run generate gives us
this dist folder which holds all the
content we need to deploy so we only
need to deploy a color of that folder
nothing else to a web host however in
that folder if we watch closely we got
the block subfolder which makes sense
but in there we only got the index.html
file now in their index.html file if we
scroll to the right we seem to have our
blog posts in there that's looking good
but one thing is missing
we don't have subfolders for the
individual blog post pages if we were to
deploy
the content of the dist folder we could
only directly navigate to block to the
block root folder here not to the
individual blog post we would get in 404
error there because these pages haven't
been pre generated by the generate
command the reason for this is that
these pages have a dynamic title dynamic
ID underscore post ID now at runtime
when we're clicking around in our next
application and it therefore runs like a
single page application then this
doesn't matter because then this will be
loaded on the fly and rendered in the
browser for pre-rendering however so for
pre generating the pages we need to
configure which dynamic pages we have
the problem with that of course is how
do we notice an advanced worthy
developer we don't know which content
will eventually exist thankfully we can
fetch the content dynamically from
within the next config
there we can add a new property which is
called generate generate is simply added
to the route object in that next config
and it holds a JavaScript object as a
value now in generate we specify which
routes should be generated for this we
add a routes property and that object
and that in turn holds an array it can
also hold a function that returns an
array by the way and in that array we
specify which routes well we want to
render now we don't know these routes in
advance so we need to dynamically fetch
them for that I will indeed add a
function as a value so that we can
execute code here and now here I want to
actually fetch my routes from from story
block I want to find out which posts we
have so to find out we need to make an
HTTP request and we can do that in NOx
conflict this Java JavaScript file which
it is in the end is executed dynamically
during the build process now for that I
want to use access we can't use the
story block API in here in that
javascript file because it's not part of
the next project so I will simply import
Axios from and now it's just from axis
like this we do have that folder in the
node modules folder we should have it
there at least if we go to node modules
you should have this X is folder because
it's a dependency of next is X's of that
module so we're importing X is here and
now with that and this function we can
use access to make a get request and now
we want to make that act that get
request to that story block API to which
you can find the URL in the official
Docs but the URL is just HTTP slash
slash API dot story block comm /v 1 / CD
n slash stories and here we now need to
specify our version which is published
here we don't need to switch this
dynamically because will only run this
if we want to publish our application
will add a token that token will be our
publish token here so this first one so
we'll specify this here and we need to
add an extra parameter CV for a cache
version this should be a timestamp for
that I'll use the logic the story block
SDK uses you can look up its source code
it's public open source they use a
formula which is math.floor and then
date now / when e free so this should
give us a number which is passed here
this just ensures that we're always
fetching the latest version and I'll add
one thing in front of that and that
starts with block because we of course
only want to fetch the content which is
in the block subfolder now this will
give us a promise and in there we get
our response of course now that response
will hold all the blog posts we have so
now here we can infer which routes we
got in the end so I will return access
yet so that this function X
you should we'll wait for this promise
to resolve and in here in this den block
I want to return my routes array which
should be rendered dead will be an array
and in there we just pass a bunch of
strings for example we have just slash
we want to render the route route we
want to render slash block and we also
want to render slash about so these are
the pages it would have rendered anyways
but we specify them again here but now
we can also add our dynamically fetched
routes so we got that in the response
data so block posts can be fetched from
response data this will be a JavaScript
object and there will have a story's
property which holds an array of all our
blog posts and this array is in the end
what I want to add here however I'll map
it because I only need to extract one
piece here so this will be mine dividual
blog post and I want to return blog
posts like this will just be the URL ID
thingy off the blog post so now will
return or will get an array which only
contains these slacks so these strings
and I can use the spread operator to add
this to my array of routes here with
that we should have a setup which
actually fetches all the blog posts and
then returns an array off the routes you
want to generate let's give this a try
by running npm run generate again we get
an error right away
yeah we're in a no js' follower this
JavaScript father's executed Bruno chess
so of course here we got access which we
actually require so like this so wrong
import this is using nodejs requires
syntax here because no tre has execute
set file
so with that updated import statement up
there let's see if it now works still we
get an error could not resolve routes
let's see what's wrong we got a typo in
that URL here in the next config file
there should be a question mark after
stories before version because it's the
first query parameter so now with that
if we run and can run generate again now
this is looking a bit better though we
still get arrows here for our sub pages
this page could not be found
the reason is because we should use the
full slug here full underscore slack
this will include the slash block so not
just a - second - post which is too
slack but full slack contains the full
path which includes the blog subfolder
that of course needs to be added sorry
about that so now finally with that it
should work by using the full path as it
is stored on story block so now with
that if we run generate again now this
looks way better now if we inspect the
dist folder and go to block we see
subfolders for the blog posts and in
there we have our pre-populated HTML
files so finally this is the finished
set up and now we can deploy this for
this I will use AWS as free but you can
use any static host as free is really
comfortable or convenient to use though
in there you simply create a new bucket
something like next story block YouTube
she was a region that should be fine we
can skip the other steps and just click
create then we can go to that bucket and
now we'll simply upload all the content
from this test folder so you simply
navigate into that dist folder
and select all the content which is in
there including the subfolders so simply
click open and now the subfolders are
missing so let me quickly drag-and-drop
that all in there it's a bit easier so
all the content including the subfolder
should go there uploaded thereafter so
that you have the content of the dist
folder in that bucket and now you just
need to configure it to serve as a web
host for this we go to properties an
able static website hosting use this
bucket to host a website now ensure that
you do indeed surf the index.html file
as your root document and we don't have
that here but if you have an error page
you can of course create one you should
point to that here too
here I'll just point to an XHTML and hit
save and now under permissions we need
to provide public access to this bucket
we can do this with a bucket policy
there you can click on documentation at
the bottom to see some examples like a
policy examples here we want to have the
read-only permission to anonymous users
copy that bucket policy here go back to
the bucket and paste it in there and now
example bucket has to be replaced with
next - story block - YouTube or whatever
your bucket name is of course hit save
thereafter and now we have public paksas
which is fine of course we want to host
it back on static website this is the
link if we click on that we can see our
working web page here and if we reload a
page this will work too because now
we're really just fetching the
statically generated content and this is
all this is all I wanted to show you
this is our very simple block which we
built with next and story block finished
now we have everything in there which we
need we have our content management
system story block which works headless
which uses an API so that we can get
access to the content and we built a
nice front-end which will work like a
single page application after the first
page load but which will also take
advantage of pre rendering or pre
generating our pages
so that we always fetch the pre-rendered
version which of course is great for a
search engine optimization I hope you
like this and I hope this was helpful of
course you can tweak there's a justice
styling dive deeper definitely play
around with next and with story block I
hope this gave you some ideas and
something you can use in your next
projects bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>