<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Adding Controllers | Creating a REST API with Node.js | Coder Coacher - Coaching Coders</title><meta content="Adding Controllers | Creating a REST API with Node.js - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Adding Controllers | Creating a REST API with Node.js</b></h2><h5 class="post__date">2018-01-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ucuNgSOFDZ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back to this series where we
build a restful service with noches we
added a lot of functionality we added
authentication and I'd call our service
finished right now you can always tweak
it can always improve it and definitely
share any tweaks additions or
alternatives you created in the comment
section in this video I wanna have a
look at one improvement it certainly
makes sense so let's dive right into it
and see which improvement that is
as I mentioned you can't do a lot of
things but one thing I want to bring
your attention to it are our route files
we have a look at them you see they're
relatively big now obviously not super
big everything's fine we can leave them
as they are but we could also argue that
in the route files we in the end just
want you distribute our requests we want
to tell them where to go right we want
to tell our get request targeted at just
slash products to go somewhere where it
is code runs that code itself doesn't
necessarily be have to be a part of that
routes file so therefore I will add a
new folder in the API folder and I'll
name it controllers and therefore we
will get closer to an MVC approach
though the via the view is of course
missing because it's a restful service
we don't render a view but at least on
the back end we have our models we
created these with Mongoose and then we
have our controllers where the actual
logic should live and that will allow us
to trade cleaner route files so now I
could create our orders dot J's file
here too and the idea is simple I want
to export a couple of functions here in
the ordered J's files then the end
chests are the same functions as I
passed to my router here so for example
for getting all orders I can grab that
function which I passed to my get method
here like this and cut it out of there
out of my get route and go to the orders
J's file and there I now want to export
it now to export it I'll add exports and
then a name of which under which I want
to export this and here I'll name it
order get orders get all maybe and
assign this function as a value and
that's actually almost all done there's
one thing of course I need to get access
to the order here so I will take the
order import from Mongoose and copy that
and put it into my orders controller
here like this so that I can still use
my order here with that added here I can
go back to my route to the orders jazz
route and import my controller so I can
import the orders controller from and
now let's go up and then to the
controllers folder and the orders file
and now I can simply assign orders
controller that orders get all here as a
function I don't execute it don't pass
parenthesis just a reference to the
function telling DD Express basically
that it should execute this function
this is pointing to whenever we receive
an incoming request here and yeah yeah I
got an error because I worked too much
on the front end it's of course Const
orders ik controller equals require we
should use the nodejs import syntax so
let me save this and let me also make
sure that check off here is of course
incorrect in the orders controller that
should stay in the route foul this still
is my extra check I'm executing here in
the middle where now if that if I save
this it should work and now if I send a
request to orders again I get off failed
so if I do quickly authenticate and I
grab that token here and now use that
new token instead of the old one from
the last recording session I now sent
this this still work so we're still able
to get all the orders now for the
controller keep in mind what I
accidentally messed up but good thing I
guess that the check off middleware
stays in the routes file you could of
course also rule change your controller
to also kind of expose that but I guess
adding the middleware directly here
makes sense so you can easily see okay
any requests reaching that route goes
through that middleware and then
ultimately is handled by this function
here in my orders controller and this is
how we well can set this up and now we
got a very clear
route file at least once we did this for
all the routes so now I will grab the
next one here this is the route for
creating a new order so in the orders
J's file in the controller file I will
now add this and export this as a
function to so I named this one orders
get all here a limit orders create order
maybe assign this function as a value
the one I just grabbed from the routes
file there I also use the product model
and not just your order model so I will
import that you I will import product
wire require models product to get
access to this too and now in your
orders J's file I just want you add this
here orders controller and then its
orders create order and now if we test
isn't postman and I also will add my
authorization header here I'll copy the
one I just used on the get request here
and I'll use this old product ID here
which helpfully works if I now hit Send
here I get product not found so let me
quickly grab all my products yeah all
failed thanks very much so let's add the
off header here quickly to change this
to a get request get all the products
let me now grab this product ID end now
try again by creating an order for this
ID I get an error we have a look at the
log mongoose is not to find yeah makes
sense I guess because here I'm creating
a new object ID by accessing Mongoose
types so we should also add this import
which we have a new routes file so let's
also import Mongoose here in our
controller we need it here too now if I
save disincentives again now we stored
it order so now that is working too and
now to continue in our orders J's file
here in the routes folder we got our
route for getting a single order so I'll
cut this code here to go to the orders
controller and add
here so I'll now have exports orders get
order and assign this as a value and we
got all the imports we need for that so
all I now need to do is go to the routes
file and assign orders controller and
now orders get order if I now save this
and we try this out - in postman now I
want to get a single order why not the
order we just created so let's copy the
ID from that order and attach it here
orders IDs and I get requests to it now
we get that single order so that's
working - and finally for deleting of
course I want to do the same grab all
that code cabott and go to the orders
control controller exports orders delete
order and assign that value here again I
got everything I need I got the order
import already so now in the orders file
in the routes folder I'll simply access
orders controller and then there
it's the delete order and with that if
we save that and we tried try this too
so we delete this order now we got that
deleted response and now we get a very
clean route file obviously we now got
our crowded orders controller but that
is where the logic should live and it
makes it easier for us to understand the
flow of our application of the incoming
requests if we got a leaner route file
at least it is an alternative or an
option you should think about it also
means that we can now remove all these
imports like the order and product model
of course and Mongoose and I only need
Express router my mail aware which I
still apply here and of course the
controller and now we can do the same
for products and users so I can add the
products dot J's file in the controllers
folder and then the product J's file
here in the route folder I will still
he'll still leave the team altars set up
here and the file filter and everything
here which is related
that malt urmila where we could also
outsource this into its own file if we
wanted but I'll leave it here and I'll
now just grab that code for a getting a
single product and getting all products
excuse me and put it into my products
chairs fall there I'll also have exports
products get all and assign this value
and now here we well have the logic to
get all the products I there for all the
needs that import from the product model
in the products J's file now in the new
controller file so that we have access
to that model and let's now try this out
first of all of course let's go back to
the products file and reroutes folder
and let's import so let's import our new
products controller with the required
syntax by going to the controllers
folder and then importing that products
file and now we can use that product
controller here on the get route
so here the products controller with the
products get all method we're pointing
to you and now if we save this and we go
back to postman and send a get request
to slash products we get all the product
so this is working fine now the same of
course for posting a new product I'll
leave to check off and team ultimately
we're in that routing file I'll not put
that into the controller I'll just grab
this function here cut it out of the
route file and create a new function
which I export in my products controller
file I'll name this products create
product here like this in there we now
also again need to import Mongoose to
create that ID so that is an import I'll
get from my products J's file and add to
the products just follow the controllers
folder like this and now we should be
able to create a new product let's try
this out let me quickly send a new post
request here let's add an authorization
header to this post request and in the
body should be form data let's pick a
fitting file and let's
and make sense that we get not found I
should maybe also hook this up here in
the product shares for the routes folder
there for posting I forgot to use my new
controller function so on the products
controller
I want to forward requests to that
function the create product function now
if we save that and go back and try this
same request again it works so now we
successfully added that product now if
we're getting a single product obviously
that's also something I wanna do
so let me cut this code here and go to
the products J's file here and now it's
exports products get product like this
now back in the products file in the
routing folder I'll use my products
controller and use that get product
function we just created and now if I
try to get a single product like the one
we just created so let me get this ID
and set a get request to slash product
slash that ID then it still works so
that's fine now for patching a product
I'll of course do the same copy or cut
the code from the route file add a new
function in the controller so exports
products update product would be a
fitting name in my opinion like this
assign that function we should have all
the imports we need now I'm point to
that function in the routing foul so
products controller update is the
function I want to call and now we have
this too now let's also add our delete
function to our controller by exporting
products delete and assigning this
function here we should all have all the
experts we need here - and now let's of
course also point to that newly created
function in the controller for this
route - and now we got a very clean and
lean products routes file - and then I
said you could
outsource all the Malter related code
here if you wanted to now finally let's
create a new user JS file in the
controllers folder where we manage all
the logic for our user j/s routes so
I'll copy or cut the code here for
trading a new user and export it in the
user J's file here user signup let's
refer to this code I just cut from the
user J's file now we need p-trap we need
Mongoose and I need to use her model I
will actually copy all these imports
because I will eventually need them here
in my controller file so I'll add them
there now we should have everything we
need in the user J's file I now need to
import my controller so Const user
controller is require and now let's go
to the controller controls folder and
import the user file and then here for
signing up I can use my user controller
and use the user signup method point to
it the method I just created and with
that if we test this and we try to
create a new user so for that don't
forget we need to pass an email and a
password field so if we try this out and
I turned this into a post request to
slash user slash signup can remove the
content EDD authorization header set
content to application Jason though to a
raw data here which is Jason and then
simply pass on email which could be test
55 at test comm and a password whoops
like this password she could be test her
and now hit Send
I get not found because that should be
user not users now I get user created so
this works and with that let's also put
the login functionality into the
controller so let's cut this and go back
to the controller and exports user login
and assign this to the function I just
cut and then the user J's file in the
routes folder I'll then point to this
new controller function so to the user
login function and now if we try this
out here and send the post request to
user login with that same data I get off
successful and a token so this is
working to you and now finally let's
wrap that code for deleting a user let's
put that into our controller to user
delete it's pointing to that function we
need to use remodel which we already are
importing here and then the user route I
can then also point to user controller
whoops not delete user delete like this
and now if we try to delete a user and
we therefore quickly grab the idea of
the user we just created and I then send
a delete request user slash with that ID
and I had sent and I turn this into a
valid ID maybe then I get user deleted
so this also works now with that I just
recognized one tiny thing we should also
add the check off middleware in front of
delete to prevent that and authenticated
users to lead our users so that would
make sense so let me quickly add check
off here which I require from my
middleware folder check off like this
and let's simply add it here check off
and now if I try this again and I first
of all try to create a new user
so I post a new user here
whoops user signup of course someone to
create a new one now if I grab that idea
of the new user and I go back to my
delete request and I try to delete that
ID I get all failed and I would first of
all have to log in and delete it and
even then any user could delete an
average user you would have to add some
kind of authorization where you manage a
different table in Mongoose where you
assign roles or permissions to your
users that is something you can simply
add to this application but at least we
got this basic protection against enough
indicated users the cool thing of that
video however will ask that we create
these controllers and we did and now we
have very lean routing files and of
course we can now clean these routing
files up remove user cattle UTEP crip
Mongoose from the user J's file here
only leave the controller and the
middleware and of course Express and
router and for products it's the same we
no longer needs the import to the
product model there so we can remove
that we can remove the Mongoose import
we need Malter still and we need check
off still though and for orders we
already clean this up so now this is all
cleaned up we got leaner route files now
we're using controllers to manage our
logic there and to only manage routing
and the route fault which I guess makes
sense and now it's up to you you can
enhance this application you can try to
add authorization so try to manage
different roles for different users you
can of course add other routes our
functionalities you can exchange
mongoose with my sequel database if you
want lots of stuff there you can dive
into I hope you enjoyed this series and
you'll learn a lot about how you can
build a restful service with note and
Express</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>