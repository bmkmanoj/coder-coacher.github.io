<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>NodeJS / Express / MongoDB - Build a Shopping Cart - #4 Seeding Data | Coder Coacher - Coaching Coders</title><meta content="NodeJS / Express / MongoDB - Build a Shopping Cart - #4 Seeding Data - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>NodeJS / Express / MongoDB - Build a Shopping Cart - #4 Seeding Data</b></h2><h5 class="post__date">2016-05-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/V30Rpqi6kYE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now with Mongoose setup it's time to
actually create data which we can see to
seed some data and to do this I will
first define the model of the data so I
will create a new directory here in my
project file and I'll call this folder
models now in this models folder I will
store all my Mongoose models because I
said Mongoose uses schemas to define the
data with which we work and later on I
will use Z defined models here to then
interact with the data and easily work
with it while having this validation in
place since we defined how the data
should look like so in the models folder
I will create a new file and I will just
name this product yes because I will
define the model of a product in this
file the first thing is I will import
menus here to with requirement goes and
then I will create another variable here
called schema with a capital S of course
name is up to you but that is a good
convention here and as well just use
mongooses schema object here with that
schema I can create a new schema notice
the lowercase s at the beginning by
simply running new schema and then as an
argument I pass a JavaScript object
defining that schema or describing that
schema so here I define how the data I
work with should look like now what
should a product have or what does it
currently have in our application if we
go back to the application we have this
product image we will have a title we'll
have a description and of course we'll
all will have a price now to keep this
app simple
I'll leave the price and dollars by
default and I want to find currencies so
I will not have a multi currency app
here so we got these four fields here
image title description and price let's
set them up here the image will more be
like an image path because will not
store the actual image database but a
path to the damage therefore and as you
find the type or the
and you find this key is fuel this field
in the in a collection or in the
document by using a JavaScript object
here as a value this will have a type of
string since it will be up half and I
will make this required so I will always
need this image path there are in
products without images of course you
could set this up in a different way but
that's the way I will deal with in this
application
next I will duplicate this because title
is exactly the same definition as is
description and now regarding the price
I will make this a number so this
defines the schema and the schema is the
blueprint we will use for each new entry
we enter into the database however this
plume print is well as as a just a
blueprint it will not be with which we
work in our application we will work
with models however those models will be
based on this blueprint now to make this
happen and you to do this I will export
something from that file here with model
exports because of course I want to be
able to import the functionality of this
file and other files of my application
and what I will export here is long use
and then the model function and this
model method here allows me to specify
the name of the model I will name it
product here and then the schema on
which this model should be based in this
is of course schema I defined up here
and with that I'm using my blueprint to
actually create a model with which I can
work so this is set up the next step is
to actually seed some data into this
database so then we have something to
work with now there are different ways
you could do this you can store some
external packages which make seeding
symbol or like a loo-loo here you write
your own seed or because it's no rocket
science and if it would be you would
learn a lot right so great thing so I
will create a new directory which I'll
call seed and then the
directory I will create a new file and I
will call this file product cedar now
there are different setups you could
choose here and should have kept up case
but I will go with that it's totally up
to you though so I will create a cedar
per model you could have one cedar for
all the data but for an hour legal with
that approach here so I will import my
product model by simply requiring the D
file in the models folder where I export
this model so I will navigate their
models product notice that I don't have
the dot J s at the end you never have
that when requiring other files energy
has and next step is I will create a new
product so I will create product new
variable which will be a new product the
model I import here and then I pass
JavaScript object with the bait above
the actual data I want to write into the
database so I will give this an image
path and I will just pick the path of my
view so the Harry Potter image or gothic
Harry Potter was in the level app so the
Gothic game just add this path here next
step I will add a title give to the name
gothic since this is the title of the
game or in Gothic video game and next
the description also gave of course and
more exclamation marks always make a
message more meaningful so always put as
many exclamation marks where you as you
can
sarcasm of so with that next field is
the price and I'll just give the
surprise of ten dollars now this will
create one product however
I want multiple products how do I do
this there are a lot of ways you could
do that I will go with the following I
will make this products and array like
this and next step is I will simply
create multiple products like this new
product another new product now I don't
want to have gothic all over a place but
I also don't want to bore you with me
typing or searching for fitting products
here for the next 10 minutes so I'm
going to quickly pull this out and then
be right back
with that array of products I want to
store all the products in the database
now how do I do this well I will simply
loop through all these products so loop
through and as long as we have products
in this area - well to use and then I
want to well store it in here now I can
simply call products save because the
save method with Mongoose allows me to
save a model to the database so Mongoose
will then create a new collection for
that model so for let's say the product
model model it will create a products
collection and into this collection it
will then insert or save this new
document so it's like with my sequel
where you have database tables and
entries here you have collections and
documents so it will create a new
document with the save command based
upon the data I work with here however
this doesn't work here because Mongoose
or MongoDB will not be connected to this
application now you could say well we're
connecting it at the app.js file right
yes we are but the seeder will not be
run in the normal application it will
not be running all the time during run
time because that's something I only
want to do here during development or at
the beginning but not it's not a normal
part of the application so I will
manually run this file with
no chess and in order to do this I need
to connect to Mongoose inside of this
file here so I will quickly do this
require Mongoose here and then of course
copy the connect logic from the app.js
file and at the end of the file I will
disconnect also I spotted a little error
I had in when I created this model this
should be module exports
I had model exports which is not correct
to many models in my head so modules if
I do it like this what will happen
okay this products air is created we
started with this loop we save the
products then we disconnect now that's
not going to happen
saving to the database is asynchronous
what will happen is we will start this
loop we will loop through all the items
and initiate is saving for each item but
then we will continue to disconnecting
and chances are high that we will
disconnect before all the items have
been saved therefore this is not the
right place for the disconnect
disconnect method here
I should disconnect in the call back off
this save function here however that
would also not be the right place
because then I would disconnect arm
while on each object here so for for the
first one for the second one and so on
so that also doesn't work how can we fix
this I will implement a little helper
variable which we'll call done which is
0 at the beginning and then in the whole
back of each save arm operation here
where you have an error or a result in
this callback here I will increment done
by 1 and then I will check if done is
equal to products length so if we just
finished with the last item in the array
and therefore I have to increment first
because the products length will be not
starting at 0 like the index but instead
of an array has 5 items the length
five but the last item has to index four
keep that in mind therefore I'm
incrementing it first so if this is
equal I know that I'm done and then I
can call the exit function which I will
did find out your function exit and end
this function I will disconnect now this
should work so if I never get into the
seed folder and run my product cedar
chest file and then I will go to my
server now we'll open you terminal and
also navigate into that MongoDB binary
folder and I will run Mongo so not Mongo
DeWitt was the server but just Mongo
which is declined a shell client here I
do this to have a look into the database
so I'm going to use my shopping database
then IX action by typing DB dot products
since I said Mongoose will create
collections which you have well the
pluralized name of the models of the
models product this will be products
lowercase and then the find method to
see all documents in this collection and
this looks pretty good so with that the
data is in the database I got my cedar
working and the next thing I want to do
is of course output those items in my or
on my index view</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>