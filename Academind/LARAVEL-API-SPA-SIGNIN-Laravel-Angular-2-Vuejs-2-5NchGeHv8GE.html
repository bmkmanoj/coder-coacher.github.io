<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>LARAVEL API + SPA SIGNIN| Laravel + Angular 2 / Vue.js 2 | Coder Coacher - Coaching Coders</title><meta content="LARAVEL API + SPA SIGNIN| Laravel + Angular 2 / Vue.js 2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>LARAVEL API + SPA SIGNIN| Laravel + Angular 2 / Vue.js 2</b></h2><h5 class="post__date">2017-02-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5NchGeHv8GE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back in the last video we
successfully created a user we added the
functionality so that we can sign a user
app and we tested it with postman in
this video we will do the same for
signing in a user and this really
differs to the sign-in process as you
probably know from level because we're
not going to use the session based
approach but as shown in the
authentication theory video earlier in
this video series in this playlist here
we're going to send back a token a JSON
web token now let's see how we can
create such a token and send it in this
lecture in this video now creating such
a token is not super simple but there
are packages which do it for us for
example JWT off by a time and designs
you can simply google for level kwt off
or just JWT and you will find this
cadaver repository there you will also
find a link to the wiki which explains
how to install it so let's check this it
tells us that we should grab this code
here this version number and go back to
our level project and in there in the
composer touch JSON file composer is the
Bayeux PHP package manager which manages
the dependencies of our project in this
file here we configure which
dependencies you want to use and here
under require I'm going to add this
entry at just copied so that we require
this package version 0.5 which is needed
for level 5 if you are using level 4 use
version 0.4 so this version here and now
with that we're telling our project kind
of that we want to have this now in
order to download it because this
edition here alone doesn't do the trick
we have to go back to D terminal
navigate into our project folder and run
composer whoops update which will update
our dependencies and fetch any
dependencies we haven't downloaded and
we did add this one dependency so this
is now getting downloaded and added to
our project this is how we add for party
packages to a level project so let's
wait a couple of seconds until this is
done
and then I'll be back so the setup
process finished and it also updated a
couple of our
which is here in my project but this is
the important one year which we added
now whether it install we can go through
the other instructions and now we added
the package to our PHP project but
letter will still isn't aware of it
would you make it aware by copying this
entry here which is by kind of two paths
to this newly installed package D
namespace and in our level project we go
to the conflicts folder and then to the
apt of PHP file and down there if we
scroll down we get a providers array now
providers are basically packages level
users it will kind of boot them whenever
we create when we start the level F
which is the case for every request we
send to it so here we can add our own
service providers or the third-party
package service providers so here we add
this namespace important though at colon
colon class at the end and a comma so
this will point to this package we just
download it and this package also helps
to ship with by hand for hand easier to
say we can use so let's copy this assay
to and back in the apt of PHP file in
the context folder down there under
aliases we can register our own to
Said's
and here we were just ready to say we
just copied now the documentation is not
correct on this one this shouldn't be a
string here as the value and see this
instead it should be the path to the
class so with colon colon class again as
we had to add at forward II service
provider with this we now add at the
package which we download it also to our
lateral application and we created this
alias this to say we can now use and now
with it added we can go back to the
terminal to run one additional command
here and that is PHP artisan vendor
publish this will kind of get a config
file this package to shadow UT package
ships with and put it in our route
config file so that we can easily edit
the configuration of this package not
every third party package has to have
such a configuration but this one
happened to have one for just to work we
should then also add dash dash provider
equals and now simply in a
in a string so in quotation marks so
going back to this documentation you can
also scroll down to see this command
here it's this pause so let's add it
between equation marks and hit enter and
this will now give us this configuration
file if we go to this configuration file
it has been added to our config folder
here under JWT we can now configure this
package now the default should be fine
but you can adjust things like how long
should such a token be valid here under
time-to-live then how long are you able
to refresh a token so you can cut and
kind of send a request which sends the
existing token and requests a new one
because the old one is about to expire
maybe and so on now again the most
settings should be fine important here
point to the model you're using for your
user and we're using the app slash user
model in this file here so we're fine
but if you use a different file a
different model different class may make
sure to adjust this setting here but one
thing we definitely need to change it's
a secret now again the secret is what
we're encoding the token with and we
need the secret to validate a token
later on doesn't do one thing which
ensures that we're not getting sent
random strings by the user so that we
always know if the token is valid or not
now the package we install ships with a
convenience method this one your piece
peer Justin JW to generate which
generates such a such a secret so let's
run it and you now you see that this
file has been populated with this secret
which is now used to sign our token now
with this in place we can start creating
tokens and validating users or signing
users in now we do so in the user
controller I'll add a new method public
function sign-in like this and I know
that I get the request object here and
then well I first want to validate the
data I don't have to check if the email
address is unique though because I'm not
storing it in the database I'm just
seeing if I do have one and if it is a
valid email address and with this in
place we can now well find user in for
this
I'm going to try some things I'm using a
try/catch block here I'm catching a JWT
exception
make sure to import it from time and
flashback /title UT off backslash
exceptions so I would catch this
exception your if it fails and what I'm
trying in here is I try to create a
token so here in the if block I'll see
if I'm successful if I don't create a
token here I try to store it in a token
variable load with TJ WT off to sate and
make sure to use JWT off here does this
be important you to add so with the
state I'm calling the attempt method and
this is kind of like the same method on
the knodel level authentication
it's called attempt for a reason because
you attempt to you signed user in and
here we have to pass the credentials now
we can retrieve them and store them in a
let's say credentials some variable here
by reaching out your request and with
the only method we can get the data
we're interested in and I'm only
interested in a field named email and
password so in these two data pieces
which is stored as an array in
credentials and then I pass credentials
here whoops credentials like this so if
this I'm passing credentials to the
attempt method and I try to create such
a token now if this fails here then it
fails so if this if check fails I should
say that if this try block is triggered
but if this if check fails that is the
case because the credentials are not
valid and here of course the type of
credentials so makes let's make sure to
spell it like this so that it is correct
so credentials if this fails then I will
return a response JSON response of
course with the error code 401 four
unauthenticated and I will send error
field in this JavaScript object and
basically sending back where I say in
valid credentials like this now this is
a
fails if this whole block fails so this
happens because we somehow fails
creating such a token so here I then
want to return a response JSON response
of course 500 would be an appropriate
state of code and also with the error
field and here I say could not create
token so something went wrong during the
token creation to you the token package
here basically failed now if all that is
successful though then I can return
another response and in this response
here I simply return the token so status
code 200 let's say and then in the
JavaScript object kind of what it will
be in the end I have let's say a token
field and in this token field I
basically store the token so here my
token variable which is here set which I
only reach if this was successful
so since I'm sending back the token if
we successfully sign-in now we need to
add a route in the API dot PHP folder
and copying the post route here and I'll
limit user slash sign-in linking to the
sign-in method in the user controller
and what's the place let's go back to
postman and there let's go to slash
sign-in these are valid signing
credentials here of course let's its end
and we get back a token here so this is
your token which you can now store to
send it with subsequent requests we make
to all two protected resources to get
access to those resources now I will
show you how to store the token and
angle to application once we reach that
front end building part again but we
will use this token for getting in the
next section in the next video I should
say when we start sending it via postman
to get access to protect resources
before in that so before doing that
though let's see what happens if I send
in valid credentials like an email
address which doesn't exist now I get
invalid credentials and if I send
something which is only in email address
we get the email must be a valid email
address so this is all working on we go
to the next video when we will use the
token to get access to protected
resources see you there
bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>