<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>LARAVEL PARSE JWT | Laravel + Angular 2 / Vue.js 2 | Coder Coacher - Coaching Coders</title><meta content="LARAVEL PARSE JWT | Laravel + Angular 2 / Vue.js 2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>LARAVEL PARSE JWT | Laravel + Angular 2 / Vue.js 2</b></h2><h5 class="post__date">2017-02-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ka-Nn3sifnc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back to the serious about
angular2 view chest and level we already
covered a lot of ground and we hooked up
UJ s or angular 2 level and right now
we're working on the authentication we
already implemented ways for users to
sign up and Q sign-in and now we're
getting back this jwg token or this JSON
web token and we want to use the token Q
make sure that we can control which user
is able to access which resource so if
we have a look at our back-end at the
quote controller this is where we
basically allow the user to create
quotes get quotes update them and so on
we probably don't want to allow access
to all those actions for every user only
authenticated users should be able to
create a new quote or to update quotes
or to delete quotes I say so this is
what I will work on in this video here I
want to protect certain methods here so
that users are only able to access them
if they have a valid token let's work on
this now in order to use that token make
sure that we only allow access when we
have a token I'll start here in the post
quote method for trading a new quote
here I want to check if a balla token is
present and for this I can use the JWT
of package we installed in the last
videos which has a useful function or
method for checking if the token is
present at ballot so here in an if block
I will check if not so I will check if
something is not the case and the thing
I want to check is if I can create a
user can fetch a valid user for this
I'll use teakettle Yuki off to Sade so
make sure to use kwt off here at the top
of your file and on this for Sade I will
call the parse token method now as the
name implies this method parses the
token if any is present if note hooks is
present well we get an error instantly
so here on the parsed token which means
basically extracted and decrypted or
decoded to token I can now call the
authenticate
method a method also provided by this
package this node tries to match the
data encoded indeed token with the data
on our well in our database on our in
our application here on the server it
will also check if the token is valid
remember that in the config file for
this package this JWT file in the config
folder we had to set a secret and this
secret is used to hash our tokens to
kind of sign them now the package will
automatically use the secret to not only
parse to decode this token but also to
check if the token was actually created
by us then no one else created a token
hash to them pass it to us so this is a
two-step process and with that if this
is successful we have a user so inside
of the safe block since I check if this
is not the case with the exclamation
mark at the beginning here we know we
don't have a user because we weren't
able to parse or to extract user and
authenticate the user so here I want to
return a response I just will be of
course a JSON response and here I want
to have the error code 404 or you could
argue for 401 because you're not
offended but I'll say 404 and simply
return a message where I say user not
found score send any message you want
this is to check I wanna implement here
now this check can fail for a couple of
reasons
for example no token could be sent if
you try to access this resource without
providing a token and I will show you
how to provide it soon well then this
will fail and therefore it will throw an
error so what we can do in such a case
if this Despero an error we can use a
try-catch block here or if you don't
want you use to try catch block here and
then again here or wherever wherever you
try to parse the token you can set up a
generic error handler in the exception
handler dot PHP file in there we have
this render method and this is called
whenever Larry will detect an error here
it is right now calling the parent
render method which is a default
built-in method of rendering our
arrows and this is fine but before doing
this I want to implement my own check
and here I want to check if certain
arrows occurred so in this if block here
I will check if the exception I'm
getting here as an argument if that is
an instance of the token expired
exception and you need to import this
from the following namespace time and
backslash - WTF - backslash exceptions
backslash token expired exception so I'm
checking if this exception is of this
type in which case I want to return a
response and for this I can use the
response to sate just make sure to use
response simply an alternative to
response helper I showed you before in
the code controller and so on so on this
response of state I can all recall the
jason method which is the same method as
before and here on this jason method
well i want to get the status code from
my exception so here a can call the get
status code method and i want to send
whip send my own error message here so
we could store it as an error object and
then simply say token expired because
this is what is the case here what is
the problem you can also check for
another exception and see if the
exception is an instance of the token
invalid exception here this also needs
to be imported at the top same path as
before but ending with token and valid
exception this exception will be raised
whenever well we gather token it's not
expired but it's not using our secret
somewhere it's not valid this of course
is important check - and in this case i
also want to return my JSON response
here but I will say token invalid as a
message here so that is another on yeah
error I can handle and the last check I
want to do is if the exception is of
type JWT exception in general so if none
of these specific exceptions from the
for matches I will catch this generic
exception and then all the returns I'm
Jason here
where I say token or let's think to
either air or fetching token something
like this so this is my error message in
this case and what that I'm checking all
the token specific arrows which can be
thrown if I get any other error
I still use the default method here
which ever site or you could also
convert to send it F Jason maybe so that
would be something you could do I'll
leave it for now though and I now handle
all the JWT of specific errors so
instead we get the error handler we get
the check here if we are able to extract
the user well if we did extract the user
successfully and we know that therefore
the user is authenticated executing this
code here is fine because in this case
well I know that the user is a finnegan
and here we could even match and connect
user and quote that's something we
haven't done here we well we we store
quotes in a generic way we don't assign
to users so that would be something you
can do here I'll leave it out for now I
just want to see if this check works if
we are able to protect our route here
doing it like this so what does in place
let's now see if it works
I already signed in get my token here so
let's simply copy this token it's pretty
long as you can see and now let's try to
target our route for creating a new
quote so let's quickly have a look at it
we will need to pass some content there
and the route whips which we need is
here this post / quote route so the path
therefore is slash API slash quote and
all we need to provide here is the
content so some quote content like this
and if I now send this request and I
copy the token before if you didn't do
this make sure to sign user and again to
have a token in your clipboard you see I
guess error fetching token which makes
sense because no token is present now
how do we send a token we can simply add
a query parameter which is simply called
token like this and then pass the token
now if it has anything here which
not the ballot token and I click send
again now I get token invalid which
makes sense
now let's pass the valid token one to
the C string I copied and now you'll see
that indeed we created this quote and we
can also check this in the database if
we have a look at our clothes table you
see a new quote was created there and
then now we can use the token to protect
our resources now I could of course
quickly copy all the code here and add
it to any function any action you want
to protect to put it into the put quote
method and the elite quote method I
could do that but I don't want to do
that because it's not only the best
practice to simply copy that code it's
easy to forget it somewhere and if you
make a change you need to make this
change everywhere so to make this a bit
easier the package here JWT all ships
with some middleware we can use so let's
have a look at the middleware in the
next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>