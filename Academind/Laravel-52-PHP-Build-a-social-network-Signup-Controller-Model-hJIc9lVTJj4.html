<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Laravel 5.2 PHP Build  a social network - Signup Controller &amp; Model | Coder Coacher - Coaching Coders</title><meta content="Laravel 5.2 PHP Build  a social network - Signup Controller &amp; Model - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Laravel 5.2 PHP Build  a social network - Signup Controller &amp; Model</b></h2><h5 class="post__date">2016-01-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hJIc9lVTJj4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back everyone and the last video
we both kind of our or view or basic
view we put our sign up in our sign-in
form and now in this one you will fill
it with some life right because we're
developing with Larry ball and therefore
well like it's it's time for us to
create some flat back and logic which we
will need for application so what I'll
do in this video is I will create a user
model set it up and level and will then
hook it up to my sign up or my sign-in
form so that we are actually able to
either create a user by signing up or to
login if we already have a user so let's
get started
I'll start by creating my model and I'll
use the command line tool of level 4 for
this so I'll write PHP artisan make
model and I want to name that model user
now I know that I first have to clean up
my installation here I guess because
yeah because level already ships with
the user model and while I could use
that and would provide all the
functionality I need I really want to
show you how to set up your your own
user model and it's real easy to do so I
just deleted a user PHP file here in the
app folder which is the level user model
we have and in the database folder I'll
also get rid of the two PHP files which
live in there so now I can execute my
make model command and I want to make a
user model and I also add tag - M - also
create a migration for the user model
right away now what our migrations what
our models and laravel models are
basically as an every MVC framework and
the place where you wear your business
logic is where you access your data
where you were able to connect to your
data fetch data manipulate data so yes
it's the data decor logic of your
application so to say and migrations are
to level offers to us where we can very
conveniently generate our tables in the
database so we what we do is use a
migration file create a bolero or we
create when we are on our own and in
this file we basically define a scheme
which should be used to create the
respective table so for example to make
the more classical I created my user
model and told laravel to also create a
migration file by using - M at the end
now if I go into that migration file
under database migrations I got this
basic setup here and what this file
basically does is it specifies a
function which will be run when we when
we migrate or our migration files so
this will create a table in our database
that's all it will do this up function
will create a table in our database and
here inside this function we specify how
this table should be structured which
fields it should have how this field
should be configured so if they are not
able and so on that is what we do in our
migration file and we also got the down
function which basically says if you
want to roll back my bed migrations
because that is possible narrable if you
want to start fresh or undo things then
what should what should be done and
normally you just drop the table so that
you could recreate it
if you migrated again so there's that
convenient way of accessing your
database and creating and deleting
tables if you need to roll back without
having to write any SQL or without
having to go into the database even if
you might use a graphical interface and
it would still be a lot of clicking and
doing it by hand whereas here you yeah
you just create this table like you
would set up a model by accessing
certain or adding certain properties so
to say to a object and then you just
write it into the database so it's a
very handy feature and
when you'll often use when developing
with laravel and the sequel database at
least so this is a migration file for
our users table and I want to have a
very simple and plain user model so all
I will do is add a string here so this
will be a bar chart field if you're
familiar with sequel and this string
will have two name or this field will
that have the name of shares email
because let's say we want to have our
users registered with an email instead
of a username and I'll copy that and
have another string which will be the
password so string as I said will just
be a bar chart here and that is almost
all I want a password in an email
there's one more thing I want to add
because otherwise so rather to some
problems with to build a level of
application I'll add another field which
is called remember token and this is
basically a field where Larry could then
store a token if we had like remember me
checkbox and which store that key are in
a cookie on the user's computer and also
in our database table so that we could
find out if the user closest in his
browser and then comes back later if
he's still locked in we're probably not
going to use that in this application
though it would be very easy to
implement and we should implement this
field nonetheless because otherwise when
we as I said when we use the built-in
authentication methods which level has
you get kind of an annoying error if you
don't have to remember tilton field
specified so let's just do that good so
that's everything we need to do that
we'll set up our database table and what
do we do in our user model file this one
here in our app folder at the moment to
be honest nothing because in the
background
lerigot we'll have as we're using a
sequel database a kind of a strong
connection to the database with eloquent
which is leras or m so it's M yeah it's
it's yes it's really a connection to the
database table in the background so as
we set up our table here we will be able
to access all our fields in this table
very very conveniently and intuitively
through this user model without
specifying any finger that's Celtic
magic done by Lera low as we're using
eloquent which again is a convenient way
to access the the tables or the database
behind the user Malone we're very user
model is stored so for this to work it's
important that we have a certain naming
convention so our class here our model
is called user uppercase user with
beginning with an uppercase letter and
our table for the user is called users
all lower cases and plural with an S at
the end this way level we'll be able to
figure out that the users table belongs
to the user model if we were to have say
users - as our table name for some
reason then we would have to change
something in our user model name you
would have to tell arival the table name
because it would look for a user's table
with an S at the end and it wouldn't
find the table so then we would have to
add our protected property table here
and just give this the name of users -
if that was the name were choosing and
then again it would work because now
would know okay I'm not looking for
users I'm looking for the table
specified in this model here but won't
be necessary since we're using users and
yeah so everything is working right out
of the box that is a very cool feature
of laravel in my opinion that was a lot
of talking about the users but that's
really an important thing to to
understand how to use that because is a
core feature and you might have a non
sequel database in your back and then
you will have to come up with your own
code but if you're using a mice
Oh database then hey why not use that so
now that we got that it's time to create
our first controller because we want to
be able in our in our welcome few here
will click on a sign up or on the
sign-in buttons here and then we want
you to fire a certain action which will
check if if you can sign in the user if
the sign-in button was clicked or if we
can sign up the user if the button in
the signup form was click and we'll
handle that logic neck control first let
me get rid of this off folder here in
the controller's directory and now I'm
going to create a new file which I will
call user controller dot PHP and yeah
it's a PHP file it is it has a name
space of app HTTP controllers and it is
called user controller and will it
extend the default controller that's our
user controller and now what I want to
have here is I want to have a post sign
up method 0 which is executed when we
click the submit button in the sign up
form and a post side in method which is
executed if we collect a button and a
sign in form so I'll create those two
functions public function post sign up
oops and another function post sign in
both of those function will receive a
request object because we click on our
button and then the request is sent to
to our server and is handled by Lera lo
and we will soon in our routes file hook
up our functions our methods were
writing at the moment to the responding
requests phone from this form and as
this will be post requests we won't have
any get parameters obviously but we will
have our parameters in the request body
therefore we need to access the request
we do this by using laravel dependency
injection which is very powerful and all
we have to do for this is to specify the
object you want to specify to inject so
the type of the object in this case it
will be off type request and will be
living in the illuminate HTTP namespace
so you want to use to add this import
here this use import routing to
illuminate HTTP request and then we'll
just give this variable which will be
injected a name and then we can use that
name or this mary i will throughout our
function so that's how the patency
injection level works really really easy
and really cool you can inject all kinds
of objects lateral knows about a lot of
objects by default how to inject them
and you can also create custom objects
where you will then have to like add a
one line in one file to tell learn how
to create that object and then you can
inject this custom object too so that's
really powerful thing and we will see
this in later videos and yeah I'll just
inject we request your cue and now I
want you yeah do to basically create
this to sign up functionality here so we
will have a email industry
we can't just access it access it by
adding the request function here and it
will be an array where we can just
access our email field because if we go
to our welcome few in our sign up post
here form here we got our email field
here and here this name of this input
will be passed in this request array and
we can access this name a word this this
field in this area by just using the
name we specify in our view very very
easy and intuitive to do just recognized
I also had a first name so let me
quickly add that to our migration here
so yeah just another string first name
so that we can add us to if we got it in
the form we should probably store it
somewhere go ahead back in the
controller I'll copy that three times on
the first name we'll all three store now
requests the access accessible by using
this first name key because this is the
name we are using here and then we'll
have our password here our password
which will be storing this password
variable here and now what I want to do
is I don't want to store the password in
its raw format in our database right
I want to encrypt it in some way
therefore I'll use a helper function
level the bcrypt function oops
bcrypt which will hash my password so
that it is safely decrypted in my
database and later when we try to
authenticate a user we will put a little
use a built-in function or yeah helper
provided by level which will
automatically match or hash check the
hash values of excuse me which will
automatically check the hash values of
the entered password and the password
stored in the database
so that it is able to find out if the
correct password was entered now let's
finish this user sign up here by adding
by creating the user now and I will do
this by just adding a variable called
user which will be a new user new
instance of our user object here and be
sure to add this import to app user
which is just where our user model lives
here app user and now we can as a set
just access the fields of in our
database table like properties of this
model so we'll just access user email
like a property and set it equal to
email then I'll access user first-name
and set it equal to first name and I
will access the password and set it
equal to our encrypted password and all
I do then is I run user safe and this
will write it to the database and then
let's say I want to return
just yeah let's just returned back for a
moment I will between a redirect back to
the few where we came from so are
welcome few back and that's all I'll do
for in a moment obviously later we will
automatically be automatically be
redirected to like a dashboard or
something like this and this is all now
it won't work at the moment because I
haven't set up my database connection so
I'll just do this do this real quick and
this will be done our dot Ian V file
here under the these for database
parameters now you will have to
obviously configure that the way you
need it to be configured on your local
development environment or wherever
you're working in my case I am using
vagrant and a virtual machine my
database will be called larold ville
basics but you have entered whatever
name you your database has obviously and
I have this very secure default settings
on my local environment and now we can
run our migrated command under the
command line by typing PHP artisan
migrate and this will create a table in
our database and now if we have a look
at this this is just my secure program
your application now I have these two
tables in my database the migrations
table just holds we are information
about migrations which we run and layer
we'll even use this if we were to roll
back or reset our database now the users
tables table we just set up in our PHP
file and as you can see we got this
email field first name password or
remember token and an ID and our two
time steps so that is everything we need
here and now let me hook our our signup
form up to this function here therefore
I will go to my routes file under app
rau HTTP routes and in here
in this route group here as of level 5.2
I will add a new route post and this
will just be called signup slash sign up
that will be what it will be displayed
in the URL and I will then pass an array
as the second argument and here this
array I'll first specify the users key
should be the controller we're using
user controller and then add post sign
up this will be the function which will
get executed when we hit this request
here to sign up post request and I'll
also give the drought a name for me to
make it easier to identify and use it
throughout my application by just naming
it yeah really sign up now back my
welcome view here I'll take my form and
currently it has no action and I'll just
actual change because I will use my
template expression here by using those
double opening and closing curly braces
and here I will use the route command so
that in this action in the real HTML a
link should be filled in leading to our
signup route because I just gave it a
name and I can just type route signup
and this will then when it's ready to
screen we turned into a full link which
will be used as the route of this for
now currently we would get an error
because it might look correct here and
got all the fields we need and so on but
what we haven't got is a certain hidden
input field we need to add do two levels
built and security features so to say
level has a built in protection against
cross-site request forgery which
basically means that someone gets your
recession key so to say he'd be able to
to log in or to
to tie check that session shortly
briefly described so to have some extra
protection with each request we are
passing a very specific session key
already stored in our yet error in our
current session and not in a cookie or
something like this and as we add some
protection against this these attacks
therefore I'll create an input field of
type hidden' and this will have a name
of underscore token its name is
important otherwise level won't be able
to identify it and a value off again in
template expression here session token
this syntax here session double colon
token is not accessing a static method
in some session class instead session is
a Sade and Larry will uses a lot of that
besides these are basically just
shortcuts cue to other functions to how
core functions you could say in a way
and we have different objects which have
different helper functions and we can
access them through these facets and a
lot of those how the functions or the
sales are already injected into our
views or are usable in our templating
engine here and therefore we can access
the session token
even though over nowhere in this file
like is in any way injecting a session
object and all this does is it fetches
the token of our current session and
will store it in this field here which
will then be also submitted to our to
our yeah and in our request now we don't
have to manually check anything that'll
stand by level automatically we just
have to edit and put field otherwise you
would get an error boo
so again lot of talking and theory but I
think it's very very important to get
those core concepts right and now let's
see if that works
so in my
sign up form here now I'll just enter
some random email at but first name and
then any password click Submit now we
ran into an arrow here in our view even
though we specified this in input field
because it wasn't actually outputting
any data or any token with this command
and that is because in my routes file
here I got this route in this middle
work group but I have got my default
route now it's important that I have
both routes in a small workgroup because
it is dis middle where the webmail where
newly added layer of 5 to 2 which will
ask the description here says add that
CSRF protection so that's kind of little
where which is useful or which should be
used if you're doing front-end
development or if you have like a
wearable app which has fronted views and
this back-end logic where you opposite
would be for example simple restful
service where all you would do with your
lateral application would be consuming
routes coming in from all kind of
computers and servers and therefore no
no sessions going on because as you know
rates rest full service don't have
sessions so here we have normal
application we have sessions and network
therefore we have to use this Web
middleware for all our routes which are
meant to be involved in some kind of
sessions going on and let's and let's
try this again and now this should work
yeah don't get an error let's look in
our database get an entry here and as
you can see our password is hashed this
is not what I entered in this form and
yes we created our user and with this
user were able to now in the next video
create our sign-in form and then
actually go a step further than just
being stuck at our welcome view but it's
very important to get these basics right
to know how to create users how to
access the database
and how to submit forms correctly so
very very important concepts now one
thing we haven't going on in this form
is validation we could pass an empty
form here and we obviously obviously
don't want to do this so that will be
something we'll also have a look at in
the next video so I'll see you there bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>