<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Laravel 5.2 PHP Build  a social network - Likes &amp; Dislikes (2/3 - Finishing the Backend) | Coder Coacher - Coaching Coders</title><meta content="Laravel 5.2 PHP Build  a social network - Likes &amp; Dislikes (2/3 - Finishing the Backend) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Laravel 5.2 PHP Build  a social network - Likes &amp; Dislikes (2/3 - Finishing the Backend)</b></h2><h5 class="post__date">2016-03-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/drM19VKbCgU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi welcome back so we started with the
JavaScript implementation in the last
video and we also set up the tables we
need enter relations so now it's time to
work a little bit more on the back end
so first I will create a route we set up
at the end of the last video and this
will be a post route leading to slash
like and it will use a controller action
even though we haven't created that yet
so we will have post controller here and
then post like post let's say and then
here as a name for this route you will
have like and his name is important
because in the dashboard few who are
already using this name here so they
should match the name you just created
here in the routes file this is like
road now in a post controller let's
create this new function public function
post like post this method here will
take or will get a request object and
check that sort of that can access the
parameters or the data passed with this
HX request and what I want to do here is
I want to retrieve the post ID so this
is request post ID if you remember
remember this from my JavaScript file
setting this post ID here and I'm also
sending this is like data so this will
be the second thing I extract here just
check if it is is like if it well it's a
liking actual we're doing he here or if
we're disliking something there's one
thing I want to do or what we have to be
careful what we're getting passed here
will be interpreted as a string so does
it's not a boolean
so what I will he do here is I will
check if we get true if what we get
submitted is true as a string and then I
will well set it to true our wise to
false so kind of Quan word it now of
course as before I can't get rid of this
and just save this check here but it's
important for the rest work correctly as
you will then see the next thing is I
will have two different actions whether
I'm updating and entering the database
or if I'm adding a new one because what
are the cases we could have I already
explained them a bit at the beginning of
the last view now it's time to dive into
that deeper we have this table where we
have post ID user ID and the third
column which saves is if it is a like'
or dislike' on the dashboard we have two
like and dislike button case one is I
neither like nor dislike this post like
in this case both buttons would say like
or dislike the database nothing is safe
because I haven't published my opinion
regarding this post yet next option is I
liked his posts I click on like now in a
database and you row will be created in
the in in the table in the like table
where I saved it I the authenticated
user like this post so the like column
will be set to one to true for this row
so it's the second case
now I do already like this post to this
text put something and say something
like you liked his post or so now I
could click on this you like this post
link to undo my liking of this post but
not to dislike it which again
something different here as this is kind
of a negative expression or I'm really
saying I really don't like it instead of
saying I I just don't care so I click on
like after I already liked this post and
I want to undo this liking so it's the
third case and so now what we do is we
have a row in the database table for
this user and post and currently it's
set to one now when I click on like
again I will just delete this row
because I don't want to turn it into a
dislike I will just get rid of it so
that I'm back to case one where I
haven't expressed any opinion on this
post yet okay next possibility is I
already liked this post but now I decide
no not only do I not care so I'm not
undoing the like I will turn it into a
dislike instead because now I really
don't like this post anymore therefore I
don't click on you like this post to
undo the liking but I directly click on
dislike so when doing this I could
delete the room and enter a new one with
the last column set to zero instead of
one but why would I do it the easier way
is to just update the entry so that I
change the one the true in the like
column to zero so that now it is a
dislike so that are the four cases I
have and of course mice words are for
disliking but that's basically the same
so this is what I will have to somehow
cover in my database or in the
background
it sounds may be a bit more complicated
than it is but I will start by adding a
update variable which is set to false by
default this variable is only there for
me to store that after checking if the
user already likes this post and so on
and if he now wants to dislike it
instead of undo
the liking that I can store it if what I
need to do in the end is updated update
this entry or a save a new one and I
want to keep track of that with this
variable next thing is I will find this
post we're talking off supposed and then
I will use post now finds a shortcut
here to find it post find the post idea
extracted and now we don't need first or
get after dead just semicolon is enough
this will automatically or already
retrieve the post for us and then I
check if well if I had found something
if they got the post and I will then
return also I will just exit yeah it
would be better to return some jason
with an error message but here I will
just well just leave that method and
nothing happens because I did not find
the post or whatever happens something
wrong something's wrong next thing is I
will retrieve the user this is easy just
off user again because well I'm always
doing this from the view of the logged
in user next thing is I want to well
check if I already liked this post so if
there already is an entry regarding this
post
oh it just called like and what I do is
I take currently logged in user now used
likes relation we set up to get all the
likes this user head and then I want to
see if from the likes of this user or in
all the likes this user did in the past
I can find one where the post ID off
that like matches the post ID of the
post I'm now trying to like or dislike
and here I get the first element there
should be only one returned but here I
have to specify specify first to not get
a query boater object but
collection or in this case individual
element so now I will check if I did
find something if I did not find
anything that means I haven't taken any
liking action on this post yet I never
liked or disliked it or at least maybe I
undid it but right now there is no entry
saved regarding that user and that post
but if I do find something so now it's
the case where I already have an entry
regarding this user and post if I do so
find something I want Jack if I'm
currently liking or disliking it so now
I already got this is like variable so I
will call this one let's say already
like there might be a better name but
just to make it clear that it is not the
same like this where we're just
retrieving the data we're getting passed
through this function but here we're
checking if we currently already liked
or disliked this post so what I will do
is I will take the like I retrieved and
access the like property or column
remember just a name we set up here this
column has the name like I'm now
accessing this column here to get if
it's currently alike or a dislike so if
this returns true we already like if it
returns false we already dislike it so
to say I hope this is clear what we're
doing here even way I can send updates
true now because we already gather entry
and we're going to change it the last
question is how are we going to change
it if we're currently liking it and we
again clicked on the like button in the
dashboard we want to undo this liking
ever currently liking it and we clicked
on this like we don't want to undo it we
don't want to delete that entry but we
want you change the light column
zero to dislike now so in this case what
I will do here is I will say if already
like equals
is like so what we passed into this
request in this case I know I already
for example like the supposed and I
clicked on the like button again so now
I only want you undo it I don't want to
change it into a dislike so in this case
I will just delete this like from the
database and then I will return all
about just exit because everything's
done I just want to delete it i undid it
otherwise i will well continue basically
here so let's just write the out
statement for the question if we did
already find a like now you might wonder
whereas the out statement here if I'm
disliking it I'm writing this outside of
this if block here because by returning
now I'm exciting anyway if I'm finished
if I just in here to undo it and
otherwise I can just continue after this
if block because there will be some code
which is now relevant in the else case
of this F statement and D general Al's
case or next steps when creating a new
like but you will see this in a second
and then it should be more clearly so
here I'm checking if I already do have a
like entry for this post user now in the
case I don't I know that I will create a
new like because I don't have one yet
that's all here make sure you add does
use app like import here at the top to
be able to actually use the like here in
this file so otherwise this would result
in an error so now I'm creating a new
like but either way if I'm creating a
new like or using the already created
one and this is what a check was just
talking about now we're continuing
outside of this F statement we
cuz now we're on the same page again I
want you edit this like so in all cases
I will set like column now she would
ever get passed into this router into
this method here so is like which you
were passing for the HX call then I also
will set the user ID equal to user ID so
I currently locked in a user here I'm
accessing his ID or her ID and then I
have post ID and well I already got this
as a variable right here I could of
course also just access post ID because
I retrieved the post anyway here so now
the like is configured either as a new
like if we didn't already have it or we
just changed it if we did already have
an entry but now it's important we
either have to save it if it is a new
one or update it if it already existed
now here is where my update variable is
important remember I said it to true if
you found a like entry so if you already
had one
otherwise it is false by default so if
he already had an entry well all we do
is we update the newly configured like
otherwise I will save it to create a new
row a new entry and then I will again
return null again it would be better to
return some kind of message but it's
fine like this here so now this is my
Ajax request or how I handle it and this
should really work now let me reload
this page
and let me click like here and then I
will open up when ii will open up my
database here it is
and then the likes table you can see i
get a user ID of 1 which will i only got
one user but which is this one and a
post idea of 2 which is supposed with
the body and never post its correct i
clicked on this button I also have a
like state or value of 1 which is true
because I clicked on like if I click on
like again and reload you can see the
entry was deleted because I undid it if
I click on dislike and reload you can
see I got the same entry as before but
now with a value of 0 for like because
it's a dislike if I click on this like
again I'm undoing it but now it's the
interesting part if I click on like I
get a new like entry if I now click on
dislike this should not disappear but
instead only this year should change to
0 and that's exactly what happened also
maybe you recognize that the ID of this
entry didn't change because we did not
delete it and create a new one which is
updated it
that's exactly behavior we wanted now
the last thing is to update the Dom once
were done with well this part here and
we will see this in the next video bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>