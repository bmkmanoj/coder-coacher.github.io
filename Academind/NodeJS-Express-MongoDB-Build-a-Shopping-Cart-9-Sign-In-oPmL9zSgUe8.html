<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>NodeJS / Express / MongoDB - Build a Shopping Cart - #9 Sign In | Coder Coacher - Coaching Coders</title><meta content="NodeJS / Express / MongoDB - Build a Shopping Cart - #9 Sign In - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Academind/">Academind</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>NodeJS / Express / MongoDB - Build a Shopping Cart - #9 Sign In</b></h2><h5 class="post__date">2016-06-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oPmL9zSgUe8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back great to see you again time
to handle the user sign-in so sign up
looks good but sign-in is missing I'm
closing all these folders here tabs here
and now back in my project I'll go to my
passport chess file to also implement a
strategy for signing the user in I'll do
this right below my sign up strategy and
of course I start by you again using
passport use I'll name it local sign in
and this will also be a new local
strategy where I first have some
configuration where I again basically
pass the same config as before setting
up username field and so on and then I
have my callback here where I again have
my request the past email and password
as well as the done callback function I
may execute whenever I am done now here
again I could validate but I don't
really have to because I'm just checking
if the entered data fits the user data
in the database so technically I don't
need to validate but I think it's nice
to give some error messages if the user
simply forget forgets to enter the
password or anything like that so in
order to do this I will copy the
validation logic from above all that
code here but I will get rid of the
minimum length because that really
doesn't matter I'm comparing passwords
anyway as well as of T is email or well
now I own leave T is signal I think
that's fine so with that I'm yeah doing
the validation again the code of you saw
above and of course you could refactor
this for example but I'll leave it like
this and next I will try to find the
user and I can also copy the code here
from my signup method because I'm
basically doing the same line once you
find a user I return done with the error
if we have an error however if I find
the user this is of course the good case
so here I will reverse this
to return an error if we don't find the
user then I will return a message say no
user found so if yeah if we try to find
a user with the email address which
isn't in the database and then I also
need an upper case where the password
might be invalid so to check this I will
run user and then valid password this SD
helper function or the method I defined
in my user model here if you remember
this this function here so now I'm
executing this function to verify the
password with the encrypted password in
the database and if this fails if the
password is not valid well then I will
also return done with n with defaults
case here so that it was not successful
and the message will be wrong password
in my case here if all of that is passed
successfully so no error user found and
password is correct well then I can
simply return done with no error and the
retrieved user and user of course is to
use ref found in D in database so this
is my sign-in strategy and now any index
chess file I have to create the routes
for that so I'll do this here where
again get my user sign-in route with
request/response next to show the
sign-in page first and all I will do
here is I will render the sign-in page
and I will copy the code from the
sign-up route here because I'm basically
doing the same and also want to display
error messages if there are any a also
want to pass token so that's all the
same and next I will add another route
the post route user sign in but here of
course I will not use my request for
once next function but instead I will
use passport authenticate and then my
local sign-in strategy HS set up with a
JavaScript object to configure it now
the configuration equals the one from my
post request here and with that I'm
making sure that I redirect it to the
profile if successful but to the sign-in
page not sign up if we fail so with that
all this is working I'll restart my
server and I'll go to the sign-in page
here and I'll try to log in with the
credentials I provided email already
news doesn't sound right and this of
course is the case because here well hmm
first I'm returning these sign up view
not design in view so that's wrong
but it was good because my sign-in views
totally empty so I should probably add
this here I just copied all the code
from the signup view but of course I
have to update my action here to
actually try to sign me in not sign up
and I'll replace the text here to also
be correct now if I reload so go to sign
in again this should not really be dis
sign in form and this looks good
I am for varlet to do user profile so DS
signing in works s nasty sign up let's
try what happens if I enter an email
address which is not valid or okay if I
enter this for example invalid email and
if I enter a wrong password for a valid
email address I get wrong password so
this works but that was not really what
I wanted to do here what I want to do
next is I want to protect my routes and
it would be nice to have some kind of
route grouping because if we have a look
here we got slash user slash user slash
user and it's totally unnecessary
because all these routes shared a slash
user I don't want to write it on
throughout here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>