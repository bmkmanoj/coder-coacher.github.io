<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>8. Survival Game Tutorial in Unity 5 - Sleeping | Coder Coacher - Coaching Coders</title><meta content="8. Survival Game Tutorial in Unity 5 - Sleeping - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/SpeedTutor/">SpeedTutor</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>8. Survival Game Tutorial in Unity 5 - Sleeping</b></h2><h5 class="post__date">2017-09-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-__NE-WXor0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys welcome to another unity 5
tutorial today and this is going to be
specifically about working out how to do
a sort of sleep controller or the way
that we can sleep to rejuvenate our
player in terms of the fatigue stamina
and other attributes that we want to
affect now in the previous video we did
a fatigue meter that when the fatigue
drops to a certain value illa jewel the
overall stamina so we need a way to when
we go to sleep will renew that fatigue
which will then renew the stamina which
will do all those sort of beneficial
things and it'll be dependent on the
time that you actually sleep so we're
gonna go by creating a simple UI then
I'm gonna show you how to script it in
to write a couple of scripts to disable
the player so you can move when they're
using the UI and actually working out
how to do the functionality for the
actual controller itself you want to
make sure that you're into the 2d view
up here in 2d and you want to be looking
on your canvas and what we get it to
create here is we're gonna create a
brand news of UI selection of elements
so what I'm going to do on my canvas is
just right click create empty and I'm
gonna make sure that it's all centered
to 0 0 0
if not we can right click at the top and
just click reset then I'm just gonna
call this sleep UI and then from there
inside the sleep UI which is still
inside the canvas we'll right click and
we'll go UI and we'll create a panel now
the panel is gonna be the thing in which
is just gonna hold everything that we
want to have in the UI and I'll just
make it bigger so we can see it nicely
and I'm gonna select the color of the
background and just turn the opacity up
so we can maybe just see a little bit at
the background and then we're gonna add
things to them so on this panel what I'm
going to do is go right click at UI and
the create text so I'm going to create
some new text and this is going to be
the solved title area I'm going to
centralize it and then put it to the
middle and I'm just gonna write in and
I'm gonna type in how want to sleep and
it just cut off because we just need to
extend the bounding ball
here I might just increase the text size
a little bit so it looks like a heading
that we've got here so now I'll add this
I'll put it centralized roughly with the
guides that give so how long do I want
to sleep so what we can do here is
really create a slider between two
values we're gonna have something that
is a value that updates to show you how
many hours you're gonna be sleeping and
we're gonna create a little button then
what I'm going to do is I'm going to
right click on the panel again go you I
and the text and I'm gonna play text at
this side I'm gonna just call this for
this one just have it zero so this is
gonna be you know we're sleeping for
zero hours it's just this is just a
visual indication our setters Center a
middle again and I'll just put it next
to this UI again then what I'll do is I
will rename that to 0 at X just that's
something that we're not really going to
use and then I will duplicate that with
control D and just put it at the other
side and this is gonna be our the
longest we could probably sleep is let's
say 24 hours so I'll rename this to 24
underscore text duplicate this 24 with
control D and we'll just pull that down
we'll just pull that down under here
I'll just leave it centered there again
I will rename this to on this wrap right
hand side in the inspector two hours and
I will just scale the box out so we can
see it nice and big or maybe put this on
this side this is gonna be the thing
that we're going to update and then I'll
call this hours text on the left and
then I'll make one last duplication of
the hours text I'll put it on I'll put
it on the right-hand side of that we
just created and have this as let's say
0 for now because this is the actual
specifically the UI element that we're
going to adjust so when we adjust this
bar that when we adjust this bar that's
the number that's gonna update so we'll
just rename this to slider
number and then I could grab these two
elements and just move them maybe along
it's roughly towards the middle now what
am I actually do is where this UI slider
already is I'll right-click the panel
just create UI and choose the slider
once again and we're gonna actually
create a slider with a little handle on
it and I'm gonna place this roughly
where the other one was and just drag it
up so we just scale it out a little bit
and you can see it like so so place it
where that one was so what I'll do is I
will delete the old the actual slit old
sleep slider that we had underneath so
now we have the one with a handle and
that'll be a new slider and we'll just
call that one sleep slider and you can
see if things help now when we decide to
move this we'll have some code which
will update this number to show how many
hours we're going to sleep now what we
can do is we need a button to make sure
that we accept how long we're going to
sleep for instance so again we can
right-click that panel we created choose
UI and then choose button now we can
just drag the button below and we can
just leave it there we could rename it
something that you might want to rename
it so I've just renamed my button sleep
so if we press play now you'll see you
can see the UI element there and you can
see that when i unlock my mouse we can
you know move this bar up but do some
stuff and things like that and press the
button potentially but it doesn't do
anything until we decide to tell it what
it needs to do but there's the basis to
the UI that we're gonna decide how long
I'm gonna sleep and then we gonna press
a button to the Sun and then to actually
sleep is we need to open up all of our
scripts that were previously using so
we'll have a look at all of the scripts
and I'll go along with what we need to
create so if you open up the rare case
manager or we don't actually
realistically need to do anything with
this script because we're gonna use the
script in the item properties which we'd
already done and we're gonna add a new
element to this so we decided that in
the rare case manager if we found a
consumable that we could use it'll find
the object find item properties and then
it will run the interaction method and
call the specific parameters that we
need and then it decided if it's war if
it's food water our health it will do a
different thing accordingly so now we
need to Chris
to actually control what our sleep is
going to do so we'll right click in the
project panel go Kriya and choose C
sharp and we'll call this sleep control
and then once that's written will open
up in visual studio so I'll get rid of
the two starting function and in our
script we're going to start by looking
at the different things that we're going
to want to do to be able to make this UI
appear disable the player and then do
the functionality that we need to so
first of all we're gonna write a few
variables to understand what we need to
do is so we're gonna write square
brackets serialized field then we're
gonna have a private game object as
sleep UI and what this means is that
we're just going to create a variable
which we're going to reference in the
inspector this one here I'm going to be
able to turn the UI on and off when we
want to so I've only I've created this
is an object again object reference
because remember we created an empty
game object to put all the UI inside so
I'm going to turn it on and off like
that then what we're going to do is
going to have another serialize field
and we're gonna have another private
variable and we will once we've done
collected the correct names best so at
the top right using unity engine dot UI
and that gives us access to the things
that we're going to need so we're now we
can go back to our original variable
that we created and say the private
slider will you set that to call that
sleep slider and that's one of the
things that we're going to you know get
some information from then we're going
to have another serialize field private
variable called text and have this as
the sleep number because again this is
the sleep number is that number that we
wrote next to the hours that which
you're going to update when we change
the actual slider value and then we're
gonna have two more so we need a
sterilized field again private float
hourly regen so that's how quickly our
or how much is gonna regenerate every
hour and then we're gonna have something
which
well detect the disabled manager but
will create that once we've created that
several manager battle just not that
down for now I saw with the disabled
manager in mind what we can do to make
this apparent we can go back into unity
and this is always good to do in any
different sort of project is splitting
up into a lot of different classes and
scripts so you can control every
different aspect especially if it's
stuff that you solve for a novel like
maybe disabled manager so we'll career
and you see sharp script and what we'll
do is we'll call this this sable manager
will open up a visual studio I'll get
rid of their starting methods again and
what we'll do for this is we'll use
another name space which is caught using
unity standard assets at the bottom dot
characters dot first person with a
semicolon because when I got access to
the first person Whisperer specific
information that we're going to require
to do to disable things that we want to
first of all what we're gonna do is
write to square brackets serialized
field I'm going to write a private
variable called first-person controller
and we needed the the reference at the
top to get access to that via shorthand
and then we're just going to name this
FPS controller with the semicolon so
we're gonna reference this in the
inspect it's gonna be the thing that
we're going to disable know what I'm
going to do is gone with a write a
public void so a public method called
disabled player two brackets two curly
brackets below and then we're gonna
write FPS controller dot enabled equals
false and cursor dot lock state equals
the cursor lock mode you've got none
with a semicolon and then cursor dot
visible equals true so what this means
is that with this reference up here for
the FPS controller we're going to
disable it so we won't be able to move
and we won't be able to use the main
camera we're gonna also make sure that
the cursor is visible and it's not
locked anymore so we'll be able to just
use it freely but because we all want to
use the UI because you would disable the
player we expect to be able to use the
mouse features just so we can interact
with the UI for the moment
then as you would expect we're going to
create another private and another
public method as a public call avoid an
able player with two brackets two curly
brackets below and we're going to just
do the exact opposite so we're gonna
crop here all those lines there and
paste them in and then we'll say that
the FPS control is equal to true because
when we enable the play we want to be
able to run around and do stuff then
instead of having cursor lock mode non
will have it has that locked and if you
want when we want the cursor then to be
not visible anymore so hide it away so
this is a good way to split your script
up sir this script we can call these two
functions whenever we need to disable or
enable the player and you can write
whatever extra functionality need if you
needed to turn sone scripts off
especially if you access it all the time
because there's no right point having to
write all these lines in every different
script if you've just got one script
that controls it for you so that's
perfect for that now we can go back into
the actual sleep controller
remember at the top we had a variable
that we wanted to create we want to now
do square brackets sterilize filled and
then we'll say private disabled manager
as disabled manager with just a
lowercase D because this is the thing
that we're going to reference to call
those actual methods that we require
okay so seem as we've made this
reference we're gonna write an actual
star method just to find it
automatically because this is something
that you can do if you don't want to
have to drag into the inspector every
time so alright void staff two brackets
two curly brackets then we're gonna Gus
so that lock is disabled manager equals
a game object don't find game object
with tag not game objects you must
you'll be aware that you don't have the
S on the end then we'll put in brackets
in quotes then we'll say disabled
control because this is the tag that
we're going to be looking for and then
we'll say don't get component angled
brackets disabled manager with a capital
and then
rackets and a semicolon so what this
essentially says is that in here for the
inspector would be expecting us to add a
component in there to find the disable
manager we require but instead of that
we're just gonna say that we're gonna
automatically fill the disabled manager
with a game object we're gonna find the
tag disabled controller which we'll set
up in a minute and then it will
automatically find the component which
is the disable manager and it will put
it in there for us without us having to
write any code which you could
essentially do with this one as well but
I'm just giving you some examples of how
you could possibly do it okay so now we
need to actually be able to activate the
UI and things like that so all right a
public void because we'll need to access
this enable sleep UI all capitals for
this method stuff then we'll add two
curly brackets and we'll write in the
sleep UI which was the original variable
that we created at the top well-said dot
set active is true and that's active one
we call this method which we'll do from
another script and then we what we'll
say because we'd already done this
reference for the December ones we'll
say lower case disabled manager dot
upper case disabled player with two
brackets and a semicolon which then
calls the method from the day they just
sit at the actual disabled manager to
disable the player so we can't now move
once we've activated the UI so we also
need to do a new another thing to update
that slider so when we move the slider
along is going to update that number for
us so all right public void update
slider with two brackets and then two
curly brackets below and we'll say that
Sleep Number which was another one of
the things that we created which was the
one of the text elements dot text which
we need to access the text box in there
then we'll set equals the sleep slider
which is another variable dot value dot
to string open brackets in corpse zero
and add a semicolon on what this means
is that we're gonna act we're gonna
actually put this
into the sort of unclick functionality
of the slider so every time the slider
moves it will do Sleep Number texts or
whatever the Sleep Number that we'd set
which was the UI element or put in there
the value of the Sleep slider and we
have to convert it to a string because
the sleep slider dot text is a string
component so we need to convert the
actual value to a string before we can
put that in there so make sure you save
that out and now we want to add the
functionality so that one we press the
button in the actual sleep UI we want to
be able to do the stuff that we need to
do so I make stamina and stuff go back
up to normal
so we'll do public void sleep BTN and
then we'll open up the brackets and
write capitals player vitals and then
lower case player vitals and then we'll
add two curly brackets below and what
we're doing is we're passing a parameter
here so that we can access the player
vitals script that we you know we want
to be able to access similarly how we
did in the item properties it does the
same thing we put the parameter into the
method so we can access the player
vitals in the other script to change
things without us having to do solve
long handed them caused back to it so
we'll go back to sleep controller in
here what we'll do is we'll say that
player vitals with a lower case dot
fatigue slider value equals sleep slider
dot value times by the hourly regen and
we'll save that it will say player
vitals with a lower case dot fat Max
stamina equals player vitals dot fatigue
slider dot value with a semicolon once
we've done that we need to go back into
the player vitals we need to open up the
stamina variables and fatigue variables
and we're going to look at creating fat
max stamina to a float value because the
slider is a float value so we can explai
can actually convert a float to an
integer without
and being the same thing without doing
some code but if we change the fat max
time into a flow it would be absolutely
fine then under here we can also do
player vitals dope stamina slider dot
value is equal to player vitals dot norm
max stamina with a semicolon
and then we'll also say that sleep
slider dot value is equal to one then
we'll say disable manager dot enable
player with two brackets in a semicolon
then we'll finally say sleep you I don't
set active in brackets false with a
semicolon so everything here said when
we press the sleep button we're going to
do the fatigue slider is going to equal
the sleep slider dot value so depending
what the value is it could be all the
way up to twenty four times by the
hourly region so if we set the hourly
region to one let's say we'll just get
one stamina back four times by the
amount of actual hours that you've slept
and then what we'll do is we'll set the
the fatigue max stamina equal to the
actual fatigue slider that we've just
set so we make sure that we get the
maximum amount of summer back depending
on how long we've slept then what we do
is set the stamina slider to the normal
max stamina because say we sleep for an
hour we should have full stamina back so
that's absolutely fine then we'll set
the sleep slider which is the actual
that a little slightly bar that we
created today just back to one to a
normal value then we'll disable that
will enable the player with the disable
manager so we can then move around again
and then we will close the UI because
it's all done almost as one go so
there's pretty much one thing we need to
do to connect this all together we need
to open up item properties and like I
said in here we need to reference
something to actually make sure what
what are we gonna click on so we'll
write another an else if statement in
here and we'll say the else if that
we're gonna look at this time is it's
gonna be if it is a sleeping bag let's
say and then we're gonna have to kill
the brackets below now it'll be
squiggling because
need to add another square bracket
serialized field private bull sleeping
bag for instance and then what I might
do is we need to reference the actual
sleep controller so we can do something
with it so we'll have two square
brackets again and sterilize field then
we'll say five ER sleep controller as
lower case sleep controller with a
semicolon then what we'll do like we did
in the actual sleep manager or write
void start two brackets and two curly
brackets below and say that sleep
controller with a lower case equals game
object with a capital dot find game
object with tag without the S then in
brackets in quotes we'll do sleep
controller and we'll say don't get
component I'll put up the triangle
brackets in there we'll say we want to
get access to the sleep controller with
two brackets and a semicolon so that's
all well and good back into our sleeping
bag down here we need to make sure that
that's actually a lowercase s to match
up that's not now working then what
we'll say is the sleep controller don't
enable sleep UI two brackets and a
semicolon which was the public method
here which just activates the UI that we
want and then disables the player okay
so now we need to go back into unity in
our managers or we can do is we can
right-click create a new empty game
object make sure it's a zero zero zero
what we'll do is we'll call this sleep
controller I'll do is all I add my sleep
controller script that's all well and
good now we can right-click managers
create empty and then what I'll do is
I'll call this this servo controller add
my disable manager script there and it's
asking for the FPS controller so what
I'll do is I'll add the strain because
that's nice and easy in my sleep
controller script is looking for this
disable controller so it's right there
the hourly region can be one the sleep
number is that UI which we'd already add
it which was the called the slider
number and we'll add the sleep slider
which was that one though it's called
sleep Slater perfect and then we'll add
the Menace sleep UI to the top here so
what we can do to make it more
consistent is if we go to the sable
manager we can add a new tag and call it
well add a new one we'll call it
disabled controller liking the script
press save well another one called the
sleep controller and save that now our
disabled one we can add disabled
controller on our sleep controller we
can add the sleep controller just in
case we have anything that we require in
the future
so what could do before we start is that
we can close up the new sleep UI and
just on ticket so now it's not available
to use at the very start we could go
back to the scene go to 3d view again
find the FPS controller on what we can
do is we can add potentially a sleeping
bag here so we'll just add a 3d object
so I'll add a new cube just here and set
that as tag it's going to be consumable
and I'll put that into my consumables
and I will just enable that entire fold
so we can see them all there we need to
make sure that Cube has at the
interactive layer on it and what we'll
do is we'll add the item properties to
that object then what we can do is gonna
say that oh look this is a sleeping bag
and we've got a consumable here and we
can call it a name of sleeping bag just
so we can update the UI accordingly so
once we've done that and made sure it's
ticked as a sleeping bag and we've it'll
find the sleeping controller
automatically so when we press play we
expect that to autofill which it does
you can see that there these are all
working and you can see that I can run
around and you can see that that's now a
sleeping bag we can left-click on this
and you can see that now where UI
appears I can actually move when I press
my buttons anymore
I can't look around my currently my
cursors are locked and we can move this
slider but it doesn't do anything yet
because we're not connected it but it's
all well and good because we've got that
all pretty much working and there's no
errors as of yet so what we can do is we
free go back into the sleep UI we wanted
to click on the sleep slider and we
wanted to update the actual thing
we were looking to obtain so in the on
value event we can add a plus it's gonna
look for an object we want so we wanted
to get something from the actual
managers the actual sleep controller so
we can add the sleep controller in there
and we'll go down we'll want to select
the sleep controller script and we want
to select the update slider method so if
we go back into here again and we look
at the sleep controller in the update
slider it's gonna every time we move
that slider it's just gonna update that
Sleep Number for US based on what the
slider value actually is and then the
button that we created which was going
to be our just you know pretty much
sleep at the time is that we're gonna do
the same thing so I'll add an on click
event and want to drag our slave
controller in here and then we can go to
the nerve function select the sleep
controller and then what we gonna do is
we want to do this sleep BTN and then it
will automatically be looking for the
player vital script so what we can do
there is we can add the so we can add
the player vitals thereby doing putting
the FPS controller into that slot so all
fine so that's all found for us then we
can press play again we can have a look
at our sleeping bag we can left click on
it you can see that all updates there it
pops up can't move now if I move my
slider you can see that now when we move
that slider from 0 to 24 only updates by
one so what we can do is if we go back
on to our sleep slider we can change
something so the minimum value can be 1
and the maximum value can be 24 and then
we'll keep it as let's say a whole
numbers or press play will go over here
back to our sleep and by again left
click and then what we can do is we can
just do it I like so it will start up
pretty much 1 you could upload that
number to be 1 if you want and then we
can you know go all the way to 24 so you
can see that the stamina and fatigue is
all the way down the bottom which is
moving pretty fast so we can decide that
we might want to sleep for let's say 10
hours and then we can click the sleep
button and we expect
that the two bars to update and then
this UI to disappear so we'll click
sleep now what we could do is that
because the values are moving quite
quick we can just do the hourly region
something like 10 and then we can press
play because you can slow these down if
you were doing you know a normal game
then we can update that and we can just
maybe we're going to sleep for 20 hours
let's say and then we can press sleep
and you can see that the fatigue went
all the way back up and so did the
stamina and what we can also do is say
that player vitals dot F at stage 1 is
equal to true player vitals Dolph at
stage 2 is equal to true and player
vitals dot
stage 3 equals true when we come to do
it and then if we test that out and we
go back on to the actual object itself
and we go to sleep we can choose to
sleep for say 10 hours which you can
choose to sleep this fatigue will go
away back up stem and all go to fall and
then it will drop down as it would do
normally there may be some problems that
you'll need to iron out depending on you
know when the stamina will fall if your
fatigue is already dropped you know what
portion of time that you need the
stamina to come back if the stamina only
comes back halfway but for the sake of
these videos that I could spend any
number of time you know going through
all the little miniature
issues that you might possibly get but
it's up to you to sort of optimize and
work out little things and how you can
improve the code as you go along on what
issues you might see in the future so
this is just the basis to creating the
UI creating the sleeping controller and
creating the things and updating the
sliders as you need to so thanks again
for watching
dov gets a light cone and subscribe
Cheers</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>