<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Location-based Queries with GeoFire and Angular Google Maps | Coder Coacher - Coaching Coders</title><meta content="Location-based Queries with GeoFire and Angular Google Maps - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Angular-Firebase/">Angular Firebase</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Location-based Queries with GeoFire and Angular Google Maps</b></h2><h5 class="post__date">2017-08-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dWn9iBYiJrk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">when building a location driven app it's
critical to be able to query data based
on that current user's location in this
episode we're going to use angular
Google Maps along with firebase geo fire
to accomplish this task the app will
first detect the current users location
and then query firebase for any items
within a certain radius of that location
then we'll display those items on the
map along with their distance from the
current user to help us along the way
we're going to use the angular Google
Maps package which includes several
pre-built components and directives for
common Google Maps elements you can
install it with NPM install a GM / Corps
flag save from there you need to go to
the Google cloud platform console and
enable the Google Maps API once enabled
you can generate an API key and then
we'll use that API key in that angular
environment here we already have
firebase configured via angularfire -
and then we'll also add our Google Maps
API key here then we can go over to our
app module and we'll import the
environment as well as the angularfire
module and angular Google Maps then we
can pass a GM or Google Maps API key
when we import it in the module from
here we'll go ahead and create a new
component to handle the map called
Google map then we need to give the map
a CSS style we want it to be full screen
so we'll just do 100 width and height in
the HTML we'll wrap the map in a div so
it only displays if the latitude and
longitude is defined then we can use the
AGM map selector and pass it the
latitude and longitude as input
arguments this will define the center
point of the map then we can nest ajm
markers inside the map and display them
at whichever coordinates we want and if
we want that marker to have a popup
window then we can add the ajm info
window and we can transclude any HTML we
want in here so now we just need to get
the current users location so we can do
this in that component by defining a
Latin longitude variable then during ng
on an it we tap into the global
navigator object and we call get current
position and this will return the user's
current position latitude and longitude
on their browser or device now if you go
to the app and check it out you should
see the map centered on your current
location
along with a marker exactly where you
presently are now that we have a basic
map to work with let's use geo fire to
query firebase based on a GPS location
you can install it by running npm
installed geo fire flag save when you
update the firebase database with geo
fire it saves a unique string along with
the GPS coordinates for a location this
makes it possible to run queries in real
time based on a given locations distance
from these coordinates now let's create
a service to interact with geo fire
first we'll import the angular fire
database and we'll also import the geo
fire library and we're also going to use
an rxjs behavior subject to save the
ultimate results we get back from geo
fire so I'm calling the results hits and
for now they're just gonna be an empty
array to work with geo fire you need to
send it a database reference of the
location that you're working with this
can be done with angular fire - by
calling DB list and then passing that
reference to a new geo fire instance
first we'll create a function to create
new data using geo fire it takes the
firebase push key as an argument along
with the Latin longitude in an array and
then we can call geo fire dot set and
pass at the key and the coordinates this
will update the firebase database in the
proper format the next thing we'll do is
query data based on their presence
within a radius and kilometers from a
given set of coordinates we do this by
calling geo fire query pass at the
center which is the GPS coordinates and
the radius that's how far out we want
the query to go then we can listen to
the key entered event which occurs when
firebase is returned a relevant data
point it's going to have the key the
location and GPS coordinates as well as
the distance from the center of that
circle we'll go ahead and save this as
our own data object called hit then we
can get the current value from the
behavior subject append the latest hit
to it and then update the value of the
behavior subject by calling next on it
now let's go back to the component and
inject the geo service into it then
we'll display the hits from geo Fire as
markers in the map so since we have the
hits as a behavior subject we can just
subscribe to them during ng on a knit or
you could also use the async pipe in the
template to subscribe to them as well
then we just need to tell geo fire to
make the query by calling geo get
locations and in this example we'll do
it within a 500 kilometer radius in the
HTML we can add another AGM marker
inside of our AGM map and this time
we'll loop over it with ng 4 and we can
pass it the latitude and longitude for
each marker as well as a custom icon
then inside the pop-up window we can
tell users exactly how far away they are
in kilometers from any of these markers
now if we go to the app we can see when
we navigate up to the markers and click
on them it'll tell us exactly how many
kilometers we are away from that point
that's it for angular Google Maps and
geo fire if this video helped you please
like and subscribe
and if you want to support the channel
consider becoming a pro member at
angular firebase comm or you'll get a
free copy of my book as well as one on
one project consulting thanks for
watching and I'll see you soon</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>