<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angular Chatbot with Dialogflow (API.ai) | Coder Coacher - Coaching Coders</title><meta content="Angular Chatbot with Dialogflow (API.ai) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Angular-Firebase/">Angular Firebase</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angular Chatbot with Dialogflow (API.ai)</b></h2><h5 class="post__date">2017-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CKhV7-NF2OI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">building a chatbot with angular and
dialogue flow is almost too easy
in this video I'm going to show you how
to go from zero to chatbot in about 10
minutes
dialogue flow which was formerly known
as API AI is an engine for building
conversational experiences it harnesses
Google's machine learning and natural
language processing technology then
gives developers a user-friendly
interface to build chat BOTS and deploy
them to any platform including the web
or slack or facebook Messenger in this
episode we're going to use the
JavaScript SDK to build our chat BOTS
directly in angular this is just the
first video of a multi-part series so
make sure to subscribe if you're just
finding me for the first time and head
over to angular firebase comm to grab
the source code for this feature let's
start by building a new angular app from
the command line using ng new chat bot
and then we'll CD into that folder then
we'll install the JavaScript SDK via NPM
in the development environment at this
point the SDK is still called API AI but
that may change to dialogue flow in the
future then I'm going to tell the
angular CLI to not prefix our components
with app so we can just go into the
angular CLI JSON file and replace app
with an empty string so at this point if
you run ng serve you should just have a
basic angular app the next step is to
flesh out a feature module for our code
this step is technically optional but it
is a good practice and it will make your
life a lot easier as your app grows more
complex the first step is to generate a
module called chat and we can add
resources to this module for example a
service and we'll use the M flag to make
sure that it's included in this module
and then we'll also create a component
called chat dialogue and placed that in
the module as well you can see on the
file structure on the Left how all of
our resources are nested under the chat
folder and components and services are
registered inside the chat module the
only extra bit that we need to add is
the angular forms module and then we're
also going to set our chat dialogue
component to exports so it can be used
directly in the app component you might
also do this with the router but our app
doesn't have a router so we're not going
to worry about it then we're going to
jump over to our main app module entry
point and import the chat module there
so all we have to do is add it to the
import section now we can go into the
app component and we'll just
the default code and we'll declare our
chat dialog component here if you pull
up the app you should see that chat
dialog component works now we can get
into the fun part of actually building
our chat bot in dialogue flow so go
ahead and sign up and it's a completely
free service so you don't even have to
enter any kind of billing information
and then create your first agent so in
this case I'm just gonna call the agent
angular bot and its purpose as a chat
bot is to just return general
information about the angular framework
itself so let's go ahead and call it a
sidekick for angular developers the most
fundamental purpose of your agent is to
detect intent that comes from the user
let's say our user enters something like
what is a component if the chat bot has
been trained to recognize this phrase it
will detect the intent and then you can
run back-end code at this point or just
send a response down to the user in this
case we'll just tell it to respond with
it's just JavaScript when the bot
doesn't recognize the intent then you
can have it respond with any kind of
customized message that you want the
dialog flow allows you to customize this
in many different ways but for now we're
just going to focus on that back and
forth dialogue between the user and the
bot the first thing you'll do here is
add a phrase that the user might say and
you want to add multiple phrases here to
make your bot more robust to different
types of ways of expressing this intent
the next thing we'll do is have the bot
send a response once it recognizes this
intent so in this case if it recognizes
that component intent it'll just say
it's just JavaScript go ahead and save
the intent and then up here on the top
right corner you can test it out so I'll
say hey what's a component do and then
you can see we get the response here and
we can also look at that JSON response
that we'll see once we get back into
angular so that's actually all it takes
to build a basic chap out with dialogue
flow but I also want to show you a
really cool feature called small talk
this allows you to quickly customize the
personality of your bot without having
to create your own custom intents so it
already has a huge list of possible
scenarios here and you can add your own
custom language to them so if the user
says who are you to the bot it's going
to respond with I'm angular bot I know
stuff about angular this is a great
place to impress your users by adding
funny or intelligent responses to these
common questions now that we have a
basic agent let's go ahead and put it to
use an angular
before we leave dialog flow we need to
grab the client access token so we do
that by clicking on the agent then from
the main agent page we can just copy the
client access token right there then
we'll go back into angular and add that
client token inside of our environment
ts file in some cases it's not secure to
add an API key here but since dialogue
flow is free and doesn't have write
access we're okay to do it if you want
to learn more about API security check
out my dark sky API video the first
thing I want to show you is how to
communicate with your bot so we're going
to go back into the service that we
created earlier and we'll import the
environment that we just added our API
token to as well as the API AI client
that we had installed at the beginning
of the video first I'm going to set a
read-only variable for the token and
then I'll go ahead and use that token to
initialize the API AI client so we just
set that as another variable called
client and pass it the API token then
we're going to send a basic text request
to the bot so I'm going to set up a
method here called talk and then to make
this request we just call client text
request with the text that we want to
send this sends an HTTP request to
dialogue flow which then responds with
JSON of the actual response from the
agent so we'll just console.log that to
see what the data actually looks like so
I can set this up by going into our chat
dialog component and then I'll inject
the chat service in the constructor and
then I can just call that talk method
that we just defined then you can see
the response is just a plain JavaScript
object we don't even have to parse it
and it has all of this information
including the fulfillment speech which
is the actual text we're looking for
which is what the bot is saying back to
the user so that's how you get the raw
data but now let's refactor things so we
get something that's a little more user
friendly I'm going to use rxjs to create
an observable array of messages so I'm
going to import observable as well as
behavior subject and then I'm going to
create a message class just to define
the way a message should look so it's
just gonna have content which is a
string and it's also going to have a
sent by property to distinguish between
bots and humans then inside the chat
service I'm going to set a variable
called conversation that
a behavior subject typed to an array of
messages with a default value as an
empty array then to make updates to this
array I'm going to create a function
here that is called update this just
calls next on the behavior subject and
it will clean up our code a little bit
so anytime we want to add a new message
- the message feed we just call this
method with the corresponding message
object so the conversation is going to
start with a message from the user that
message is going to be in the form of a
string so we'll just go ahead and take
that string and convert it to our
message object so we'll set the content
equal to the message and sent by
property to the user then to add this to
the UI will just call this update with
the user message once we have that we
can go ahead and send the request to
dialogue flow with that text just like
we did before we'll call client text
request which returns a promise and then
we'll take the response from that
promise and format it as a message from
the bottom so we can get the bots actual
text response from result fulfilment
speech then just like we did with the
user message we'll make this an instance
of the message class and then call the
update method on it so let's go ahead
and switch over to the chat dialog
component and put this service to use
first we're going to import the chat
service as well as the message class
that we had defined in there and then
we're also going to need in rxjs
observable class and the rxjs scan
operator so we want our messages to be
an observable array of messages so we'll
be able to do that by tapping into the
behavior subject that we created in the
service so we'll set a variable for
messages and then also one for the form
value which we'll see once we get to the
HTML and we can go ahead and inject the
chat service in the constructor then we
need to convert that behavior subject
into an observable array so let's see
how we can do that with the scan
operator we'll go ahead and call the
behavior subject as an observable so
chat service conversation as observable
and then we'll add the scan operator to
it so skiing gives us the current value
as well as the accumulated total in that
behavior subject so what we can do is
use those two values to King
made a new array together in JavaScript
that's as simple as saying old array can
cat new array the end result is an
observable array that we can loop over
in the HTML with the async pipe as we'll
see here shortly so the next thing we
need to do is have the user send a
message so we can do that by taking the
form value which we'll set up with ng
model here in the HTML then we can call
the converse method from the service so
this is just an event handler that will
bind to some events in the HTML so the
first thing I want to do here is loop
over that observable list of messages we
can do that with ng for and the async
pipe so that will give us access to the
message object and I'm going to use ng
class to distinguish the bot messages
from the actual human messages so the
friend messages will be sent by the bot
and that two messages will be sent by
the user then we can just drop in the
message content and that's all we need
to show the message the other step is to
set up a form so the user can actually
type their message the quickest way to
take care of that is with ng model so we
just set up a form input here with ng
model set to the form value and then
when the user clicks the enter button
we'll go ahead and fire that event
handler that will send the message to
dialogue flow and then I'll also go
ahead and set up a button here that
fires the event handler on click as well
in case the user doesn't have an enter
button if you want the same front-end
styling I have here you'll need to
include that miligrams CSS framework in
your project and I also posted the
custom CSS styles on the main lesson
page now let's load our angular app and
try it out if we say hello there the bot
responds with good day
so we respond with how are ya and the
bot says couldn't be better
these are the default responses from
small talk but you can customize this
behavior any way you want
for example we customize the who are you
intent so if we ask that question then
we should get back
I'm angular bot I know stuff about
angular and we can trigger our custom
intent by saying what is a component mr.
bot dialogue flow is smart enough to
detect the corresponding intent and it
responds with it's just JavaScript when
we're all done we can just say see you
later and
responds with goodbye that's it for
angular dialogue flow if this video
helped you please like and subscribe and
if you want to take your chat bot to the
next level and deploy it to other
platforms consider becoming a pro member
at angular firebase comm you'll get a
free copy of my book as well as one on
one project consulting thanks for
watching and I'll see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>