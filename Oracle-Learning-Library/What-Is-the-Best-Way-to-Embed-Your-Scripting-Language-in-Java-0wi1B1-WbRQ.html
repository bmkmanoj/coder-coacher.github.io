<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What Is the Best Way to Embed Your Scripting Language in Java? | Coder Coacher - Coaching Coders</title><meta content="What Is the Best Way to Embed Your Scripting Language in Java? - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>What Is the Best Way to Embed Your Scripting Language in Java?</b></h2><h5 class="post__date">2013-02-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0wi1B1-WbRQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so thank you for coming to this talk
today I one of the things that I'm
that's interesting in the Java the right
now is the number of languages that are
being and that you can run on on the JVM
when you if some of you went to the to
the keynote speech yesterday you may
have heard Jason McGee talk about Java
in the future of Java and he
specifically said that one of the
important things about where Java is
going is that we need to be looking at
putting more and more languages or
supporting more languages or scripting
languages on the JVM and what's clear is
that yes java can provide a lot of
solutions to many problems but it's not
going to sip it's not going to perhaps
it's not going to provide solutions for
everything and that's where it's true
scripting languages can come into it
hence this hence his talk
so a little bit about me so my name is
birth weight and i work at IBM in hers
lee in the united kingdom I've been
working in Java for over 11 years and
primarily I've been working in the
Quality Assurance team right recently my
role is the quality assurance Java 8
test lead and I coordinate testing
across various continents where we have
testings one of my recent focuses is
working in the OpenJDK community where
we need more tests in the community so
that we can ensure that the OpenJDK is
of sufficient quality so what are you
going to get from this talk I'll be
given an introduction is too is too why
me and what is that that I do in my day
job I'll be talking about why we run
scripting languages on the JVM there are
different ways of embedding Java within
so embedding scripting languages within
the within Java and there are various
models of doing so too and then our then
I've chosen two frameworks where I'll be
comparing and contrasting two frameworks
in how you can you can embed Java and
then we can talk about what we think is
the best approach so my team and I our
job is to break Java in in IBM we test
many SDKs we have 18 platforms that we
support and if you look at the number of
operating systems available with it on
those platforms we have a big job ahead
of us and one of the things that we
focus on is the system test side of
quality assurance so the the unit
testing fe testing has already been done
and is and is is being done in parallel
so
system test so what do I mean by system
test I could there could be a whole
presentation on on system test so I only
have two minutes to talk about it so I
I've narrowed it down to two things one
of the the interesting things about Java
is the JIT and when you look at jit
defects across different platforms we
find that that low-level testing so
effectively we're stressing the JVM to
the point where we're trying to break
the JIT we're trying to break the vm and
and i find that with multi-threaded
stress test run for 5 10 and 3 hours 60
hours helps stress the JVM and find
books so that when IBM delivers a jitter
SDK it's if it's a good quality and then
there's third party applications there
are endless number of applications out
there there are open source and they and
these applications is what you I bm's
customers use so we need to make sure
that those applications work so when IBM
shipped its java on day one those
applications are good so where does this
fit into into scripting languages let's
go to scripting languages over the last
many years we have become very popular
and we need to make sure that those
languages work on the SDK so that's what
we did so we so the reason for this talk
is because we've been testing scripting
languages on the IBM SDK so I asked you
a rhetorical question how many languages
one on the JVM I did some Google
searches and I found that if you go back
to enter into Java one when java version
1 there's probably over 800 languages
that currently run or have run on
jvm if you ask wiki wiki wikipedia that
typically narrows it down to about 60
which are which are currently active
that's quite a lot now it's very it's
very hard to narrow down which languages
I should put on the next slide because
there are so many of them and we all
have our own favorite language so
forgive me if the languages i'm going to
show are not other languages that you've
used but typically we find that these
languages are the popular in terms of
running on the JVM right now but and
they all have different benefits and
they're all there for different reasons
and we all use them for different
reasons in this presentation i'll be
going through some code snippets using
codes and these for these languages when
I when we compare and contrast the
frameworks that you can use to embed
Java before we do that we need to
understand but why are we running java
why we're running java on the road in
scripting languages in the jvm why is
the JVM really that popular at the
keynote yesterday it was it was clear to
me that the performance is one of the
important things about Java the JVM is
fast the runtime performance benefits
that you get with running description
languages on the on Java I really
important but important and that's one
of the reasons why we do it you also get
the threading support and scalability
that Java brings to the platform that
you're running on one of the other
things that the JVM brings is the the
Rason the profile tooling that you get
so you could profile your drive
application and make it run better and
all these they all these tools are free
as part of the JVM that's why it's so
useful to be using the JVM to warn your
scripting language and if you look at
the the array of API is that are
currently available to a Java programmer
it is is it's amazing that you think you
can you can you
some or all of those API to within your
language and we'll go into that little
bit later and then finally the support
but for multiple languages is there
right now so that which is one of the
reasons I think we're using it so let's
let's have a look at some of the
implementation methods that we currently
have available at the moment some
languages compelled to byte codes so we
compelled to byte codes because what's
when we get the performance that's when
we get the performance with with
compiling to byte codes and these these
three languages here examples of doing
that in particular jivin which I have an
example within a minute and then we have
languages which are interpreted on the
JVM I should point out here that again
I'm only limiting the presentation to a
number of languages there are many more
that are the fitting these categories
I'm only limited to a few otherwise the
chart will be extremely busy when we
mean by interpreted on the JVM is that
the the language has provided a Java
interpreter and you're effectively
running your script on that interpreter
on the JVM and then we have embedded and
what we mean by embedded here is that
the you you how you effectively
embedding your script on your joint in
your java application on a JVM and all
these languages support that which is
what we're going to be going into so a
little bit more day to detail of what we
mean by compelled to byte codes in this
example here we're taking a jive on
script and we put and get through jai
jai thon see under the covers enjoy on
see what it's doing is doing two things
it's converting your at the Python
script to a in this case it would be my
Python App Java so effectively creates a
Java file and then it puts it through
Jarvis decompiler and at the end you get
a mile a class file and then like
anything you can do that like in most
case with Java you can then just run
that on the JVM
interpreting on the JVM is where you
have where the B implementation the
language implementation has provided a
interpreter so in this case jruby has an
interpreter which you can run on the JVM
and all you do is just passing in your
script into that and then it all run and
embedding which is essentially what this
talk is about is is a little bit
different because you have your Java app
running on your vm and there's this
concept of an engine which is what I'll
be talking which is what I'll be
mentioning a lot now an engine
effectively is is your access to your
scripting language and we create an
engine and then we do things with that
engine in order to run and interim in to
operate with with the description with
actual the description language that you
have inside that engine so in this
example here we have our driver app and
we're reading in our script and we're
using that script to evoke origin which
effectively means we are running
embedding the scripts in our driver up
to prove the point that's one of the
things that we can do in terms of use
cases that's all it's arguable as to
whether you'd want to do this or not but
the point is you can if you wanted to
take one JVM and you can have multiple
scripts from different languages running
on the JVM and that's the reason for
this slide is just to make it clear that
we can run multiple versions of both
Java I'm sorry multiple versions of
scripting languages so what models are
available when we when we talking about
scripting on the JVM there are three
models which I'm going to go inside a
bit more detail about what we mean by
scripting and the first the first one is
where the domain knowledge that the
knowledge of the of the developer is is
in the script domain
hit in this example what we're doing
here is that we are creating java
objects within our script so there's no
reason looking at the code snippet here
why we this is a.j Ruby code snippet
that we if we wanted to we can use our
JRuby scripts and we can the top line is
required Jarvis effectively we saying
give me access to Java and then we can
create Java objects and we can put
things on the screen if you wanted to so
there's certainly power there if you
wanted to do that in terms of knowledge
you do need to understand the scripting
language so you've already chosen your
scripting language because you will then
need to understand how you go and
unemployment or how you go and embed
java objects within your script there's
the issue that the biggest problem we
have with this is that the reuse
capabilities are very small but that's
because you are spending time
understanding the description language
specifically on how in order to be able
term to embed java objects each language
will do differently because that's
that's how the language does it that's
based on the script on the syntax of the
language so you are kind of locked into
using that scripting language it's still
a valid thing to do and people do do it
because there are they want to access
the Java API is from their language so
in this example which is where as the
domain knowledge is now Java and we have
a we can run a script which is embedded
within a java application the API to do
that is provided by the language so so
for example with JRuby you can go in you
can download the jruby embed a call
embed API which will allow you to to run
your scripting language on the JVM again
driver knowledge is required because you
need to understand you if that is the
main thing here you need to be able to
implant
the scripting contained us need to
understand how to do that and also you
also need to know how the language
specific API works on this slide I have
a bridge here and what I mean by bridges
that if you would consider a scenario
where you have legacy scripts that do a
particular function and you want to run
those scripts from your java application
they may be it may be more appropriate
to wrap that with a rapper a bridge so
that you can only so it makes it a lot
easier the downside of doing that is
that as soon as you've done that you're
then supporting the bridge as well as
the script finally finally we have a
that this is the the most interesting
one of all and the models because we're
talking here about having Java and
scripts talk between each other so here
we can invoke a script from a job
application and we can we can create a
news java objects inside the script as
well in this code snippet here what
we're using is j sr 2 to 3 which is
hobbit I'll be mentioning that and very
soon and with JSON two to three that
provides a a common API to run your
scripting languages on the JVM you would
still need to have knowledge of that API
in order to do this and you'll also need
Java knowledge as well the depending on
what it is that you're doing you will
also need scripting language knowledge
but it going depends on what I'm what
those scripts you have whether you are
writing scripts from scratch or whether
you already have some legacy scripts the
important thing about this particular
module is that you can support multiple
languages because Jace or two to three
will I you to do that so what do we mean
by embedding it's it's not particularly
clear what we mean by embedding so going
back to our previous example where we
multiple scripts running on a JVM this
is this is embedding a a script or more
than one script in an engine which then
runs and you can interoperate with
interoperate with with that particular
engine so embedding what you can do is
you can you can run a script you can say
to the engine I what I want a an engine
with this particular feature say
JavaScript and here's my script go and
run it where it gets powerful is that
you can actually pass variables to the
script and you can return their value so
all of us or so sort of a sudden this
guess where this is where it gets
exciting because you can have your
script to it which performs a function
which you want to keep separate from
your drive application would be it some
logic that a maybe a customer keeps up
to date and you just have your
application and all of a sudden you can
then separate that out by having your
java application run the script and that
script could be managed by anybody be a
customer or somebody else in your team
the other thing you can do is you can
call a function within your script so I
have some examples of doing that and the
de beauté the the advantage of that is
that you can run your java application
will you can call out to the script to
do something specific I have an example
where it gets sort it works out a square
root of a number but it but in real life
you'll be more complicated than that and
you can run run multiple scripts on the
same jvm which ever mentioned already
finally and this is this is an
interesting part of embedding is that
you you can run your script now
relatively easily on your own JVM but
one thing that you don't necessarily one
thing you may need is you may want to
take advantage of the the power of the
particular language provides and you do
that by configuring the environment
but it's not always easy to do that and
that's what we'll talk about so ways to
embed description language on the JVM I
have identified two here we have jsr 2
to 3 which is JavaScript API and we have
a language specific and bedding
implementation so already previously
we've seen the jruby mentation which
allows you to embed your scripts with in
Java in looking at just jos are two to
three for a moment it is a common API
and it's available for multiple
languages the languages that I've shown
you already I do provide support for
Jace are two to three all right and it's
it the point here is that they are that
JRuby has physically gone on created a
implementation for JS r 2 to 3 which
allows you to effectively and i'll talk
about jay sauter to throw in a second
language specific API is is very similar
to two to three but the main difference
is is that they provide language
specifics and it allows you to fine-tune
the engine that you're running it allows
you to take advantage of the JRuby
language for example and you can't
easily do that with jsr two to three and
again of the languages I've looked at
both both of them provided two to three
implementation and their own embed
implementation as well the talk will now
go and look at these two frameworks and
I'm going to provide some code examples
on how to do that i'm good i'm going to
introduce javascript and i'm going to be
using j-jerry be trifling greevey
languages to provide examples and how to
do this just for your information I have
removed some exception handling from the
slides
because they get a bit too busy when
you've got too much code on there and I
want you to be able to read it but if
you're using any of the IDS NetBeans
eclipse it be very obvious that you need
to include these so what is javascript
why is it there and and why why do we
use it so that suit josiah 223 was first
delivered in java 6 SC so it's in the
Oracles built now it's in IBM's build
ibn dejarme rather and effectively it's
allows developer to embed a scripting
language in a java application the the
inter specification defines six
interfaces and we'll be touching on some
of these later what's important here is
that the bottom two in football and
compiler ball are actually optional
interfaces and this is actually quite
important when you're considering which
in which the framework to use because
you may need to use those interfaces and
your language may not provide it how you
set up Jace are two to three is
reasonably easy you identify the
language or languages that you want to
implement on Java and bed rather you
download the relevant jars for that add
it to the class path and where your
scripts exist on your computer you just
need to add that directory to the
classpath as well the way the script
engine works is that it at runtime the
jar services mechanism is you is invoked
and that allows us to determine which
languages we have installed
in this example here we have a we are
querying the script engines to find out
what we have installed so we are using
scripts engine manager so I'll just
start from the back so we're importing
Java wrecked script which is the API
we're creating a script engine manager
object and on the objects we asking it
give me all the engines that you've got
and once I've got that with the engine
the scripting engine factory I then go
through them all and I'm listing the
diversions so if you can see at the
bottom of the slide when i did this i
had groovy scripting engine installed I
had jython and I hi Jerry beam rye know
which is javascript is installed by
default and that's what Oracle purpose
what Oracle provide so that's always
there in this example we're using JRuby
and we in the next couple of slides I'm
providing a JRuby example as I HSR 223
example and I'm comparing that to the
equivalent that you'd be available with
Jay Reapers implementation so again we
create we're creating your scripts and
engine manager and this time what we're
doing with that is we're saying ok I've
got little manager now going I want to I
want an engine that's called jruby so as
you can see we're in the abstraction it
is completely abstracted it just says
give me an engine giving engine which
has Jerry beam if the jruby engine is
not installed you'd be through an
exception would be thrown we then have
to read in the script and once we've
done that the engine dotty vowel so the
eval method of the avenging class will
effectively allow us to invoke the
script so eval is evaluate and go and
run my script so soon as your call
engine devel that script will get
and whatever the script does really a
run compare this to Jay rubus
implementation you could argue that it's
simple line because all we doing here is
Miss we're creating a scripting
container and we're running the run
scriptlet method and again you'll just
go and run it now this is fine you can
run a script but that's okay but it's
not particularly that exciting so what
else can we do we can we can pass a
variable to the script and we can
retrieve it back again so we do the same
thing again the case description manager
we get our and our engine and this time
we're using the port method of the
engine so what the way this works is
that when you have an engine when you
have a scripting engine that it got that
effective defines your script so if you
are adding a variable or rather putting
a variable into your script you use the
put method so essentially what happens
is that you've give you've already
you're adding the variable to the engine
you're then running your script using
the eval method and then we're using the
get method to to get the this the
variable back again from the script and
you can see that in the example bottom
right where we we've got Jonathan out
port driver output similarly you can use
the DJ phone embed API which is called
Python interpreter and here where we can
recall in the exact file which allows us
to so I'll go back one second it the
recruiting a Python interpreter and we
call in the set method of the Python
interpreter to create a string java
string and giving it the value red green
and blue we're then invoking the script
and then we are calling the get method
the Python interpreter to give us the
contents of that string back so this is
this is very very very simple and it is
it can't be quite powerful depending it
is what it is that you want to do here
we're using groovy and and we are
invoking a function so again this the
same percent code at the top for Jace
are two to three you have that always
I'm asking for Jai thon engine and I
mentioned before that the the of the six
interfaces that jsr 23 provides two of
those interfaces are are not mandatory
so the implementation say Jay rebe does
not have to implement those two
interfaces and it does that can be
problematic because you then have to go
and change how to program your
application to take that into
consideration so here I have to check
that the engine is an instance of info
keable before I can even use it that is
this is actually one of the limitations
of 2 to 3 which I'll get into because
you're now changing your driver logic to
to to make sure that you've got the
implementation / vocal so anyway so we
have so we have one so JRuby does
provide it an instant just provide a
mentation if in vocal and what a vocal
portlet lets us do is that we again
we're reading in this case we read the
script and we call the function invoke
functions so the function is called
square root and I'm passing it the value
3 160 so the scripts will then run so in
the bottom left hand corner you can see
the script and and you can see that we
have defined a function called square
root and all that's doing is receiving a
number as an argument and it's running
the the math dot square root function
which is AJ Ruby function my apologies
agreed function
so as you can see the invade function
it's fairly easy you can go and don't do
some work for me and give me and giving
you some data back and then your job
application can then do something with
that data and just just just make things
just to give you a the groovy embed API
also allows you to do this and here
we're creating a groovy script engine
and we we go we're getting a groovy
object and then we are cooked when we
are calling the invoke method method the
passing square root and also passing the
the number 316 so there's two easy ways
of I've been able to call a function
within them within the script now this
is great this is really good but what if
you wanted to to tune your energy what
if you wanted to take advantage of your
of your script engine of Jerry Buss
implementation the power that Jay really
provides for example how would you how
would you do that using two to three and
this is where two to three falls apart
to some extent because you have to
understand your specific script engine
and what it is you want to what how to
do things so for example here i'm
creating if I want my JRuby engine to be
thread-safe I have to set a system
property which is not ideal because once
you set that system property becomes
available to any relation that you want
to create I also may want to to set a
gyp verbose logging for my JRuby and I
do that as you can see that the the
value that I'm setting is jruby jit
login verbose how would I know that the
only way I'd know that is by going to
the api docs for jruby to find out so as
soon as I want to
figure my script engine used in jazz are
two to three I am deaf or moving away
from what two to three provides and
looking at what this description can do
so it although it's just it's just not
ideal because you don't know how to do
it you have to go and find out and
finally you can add you can set the
jruby path so using the thread safe
example take a little bit further here
we have the JRuby embed core API and all
we all we do to make the crater thread
safe environment for mp4 JRuby is we're
just passing in the thread safe in our
gross doctor that's all we doing and
then we've got an engine which is then
thread safe and similarly as I've
already said we have to set a system
property so it isn't particularly ideal
so the it is but it is well documented
and easy to find Joe represent bed coy
API it's clearly listed of what things
you can and cannot do with the engine
and it provides a very clear table of
this is how you do is in two to three
this is how you do it with the pudgy
rupees specific API javascript is it set
system-wide the multiple engines will
have the same behavior and it's harder
to find documentation typically because
not all documentation is as good as Jay
Ruby's comparison the hit in this
example where I said we're comparing
we're looking at a groovy and we are
looking at the setting the compiler
warning level the point of this example
is that it's easy to do using Grievous
implementation but it's not easy to do
at all using JSL two to three I haven't
found a way to do it so all of a sudden
you notice this service is where the two
frameworks diverge
how far does job execrable I cut that is
that everything is abstracted from you
it's easy to use you can plug and play
language support multiple languages it
is brilliant for embedding and it's a
great API very easy to use but it is a
bit basic and if you it's great if you
don't have a scripting language already
chosen or you don't have any legacy
scripts because you can just go and
create them bond go and create them in
user but the limitations of josiah 223
driver x dot script i've already
mentioned that the the two interfaces
revocable and compatible are not
mandatory which means that you have to
change your logic within your job
application to test for these which i
don't think is particularly ideal and
when you're setting language specific
options the abstraction just kind of
disappear little bit because you then
have to make your java application
specific to that language and as I've
known as I said just a second ago the
how jruby implements option settings is
different too to grieve me for example
so you would have to go and investigate
these options language by language so i
think that the running scripting on the
JVM i think it's brilliant i like it
it's good it's fun and they're certainly
going to be a lot of of innovation i
think in this area over the next couple
of years given the fact that most
languages supported i haven't found one
yet that hasn't though i haven't gone
through all 60 of them to be fair the
it's it's clear that the the languages
want to support two to three so it's
it's so the api is still very useful
I think the way to look at it is that if
you have if you're starting from scratch
jets our 2 to 3 could be useful if you
want to do some basic embedding but if
you want to to let a leverage the power
of your language that you're using then
two to three falls apart because you
just don't have the flexibility to to
fine tune your engine so as as I as a as
an IBM as a test done one of the things
that I'm particularly interested in is
is how you IBM's customers how you use
Java and more specifically how you embed
your language with in Java so I this is
the end of the talk i would love you
know great if you could if you have any
would you want to share your experiences
with embedding in java and how you do it
because one of the things that we want
to do it my TV is improve the testing
that we do and i can only do that if i
understand more about how java is used
and how you use these AP is so when
thank you for listening i just wanted to
say that quickly that later on this
afternoon this evening for those who are
interested in testing is specifically
openjdk a colleague and i are running a
buff with oracle on on testing testing
testing with openjdk and that's today at
seven thirty so if you're free please
come along and get involved any
unavailable for questions and answers
very buddy once for asking thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>