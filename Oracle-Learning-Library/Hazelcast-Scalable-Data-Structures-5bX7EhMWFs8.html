<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hazelcast: Scalable Data Structures | Coder Coacher - Coaching Coders</title><meta content="Hazelcast: Scalable Data Structures - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Hazelcast: Scalable Data Structures</b></h2><h5 class="post__date">2013-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5bX7EhMWFs8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone my name is Talib i'm the
founder of hazel cast what is hazel cast
is an open source in memory data great
solution all right so he's using his
cast most of the who's using yet really
yeah is anyone using here one here one
here when we work I it's quite a lot
very nice uh anyone who didn't hear
anything about hazel cast all right
that's good okay so he's using his cast
um a lot of the big companies if you're
working for a very big company probably
one group in your company already using
his cast look for them every second in a
hidden new his cast instance stars in
the globe and garnered things that this
year we're cool so in case you're
wondering so Anna he's growing it's the
ninth fastest growing skill in LinkedIn
it please if you're his cast user
already a task add his case as a skill
so that we can be the number one the
keywords we're talking about a medida
grid elastic cash no SQL these are the
things that were really talking about
here so basically you everybody knows
hashmap you're heavier at javaone so it
says it's not thread-safe if you want to
make is thread-safe of course you have
to use king something like concurrent
hashmap and now that you can share that
map across threads right now right so we
should and the question is what if you
want to share this map across multiple
JVMs okay how can you do that and what's
the code for this and here's the his
coat his
Kaskade map now you have the map the jvm
touching hazel cast will order discover
each other and from the cluster and then
if the name of the maps are the same
then you're looking at reading reading
the same map we also support queues and
multi maps we're going to come to that
so let's yeah so why hazel cast because
we want to build highly scalable
available applications right the
alternatives Oracle coherence kike
spaces IBM infiniband terracotta gems
jimster it's not gentle anymore being
where jump fire okay so just make sure
you know all that so that and also try
please so that you can love hazel cast
more first of all I admire all of these
products I think they're they're
brilliant product so not I'm not I'm a
big fan of all these products and so of
course he discusses a little better so
difference is licensed caused feature
set easiness and main focus like some of
them are more a tuple space processing
some of the more more this will be cash
some very light some very heavy and
that's why we came up with the hazel
cast and we thought it should be really
free in freedom term right freedom free
so it's very lightweight it's 1.7
megabyte single jar that you put into
your classpath that's that's what it is
it has no dependency there's no like no
other library that you have to get or
here's just one single básicas jar ok
so is Lucas is that distributed
implementations of all this good good
stuff map q set log semaphore topic
executive service so whatever I mean
most of the
um Joey tool interfaces we have
distributed implementations for them we
do have a native C sharp java client raz
memcache interface we expose the cluster
information so that you can know who the
members are who joined the cluster
things like that everything is dynamic
there is no fixed partitioning
everything is dynamic you can add more
notes as you need or when I no dice
everything should be similar running
it's transactional and secure we support
the symmetric encryption plus HTTP ssl
in case you want to be really secure
security companies do care about that
use cases we want to scale our
application of course we want to share
data if the data is so big like
terabytes who want to partition so that
it can fit in the memory and process in
memory send receive messages across the
jvm process things in paola let's go a
simple demo so let's say okay let me
take a look up yeah here let's go okay i
have this zip here you can download the
zip viscous calm and then you when you
unzip you should see something like this
bin directory containing scripts and we
should have ja Java Java Docs and manual
libraries that's probably the one that
you'll be using the very just single jar
if you are connecting to Isaac ass
cluster from from from remote places or
if you want to become a client to
discuss cluster then you use his guys
client if you're running Hisoka seen ec2
and you want to take advantage of
the auto-discovery in Amazon ec2 that's
why you need or if you're if you want to
use it use it as a hypernet second level
cache that's what this is for if you
want to attach to JT transaction that's
the resource adapter for that if you're
a big spring guide then you definitely
need this if you need just simple HTTP
session clustering you need this or you
just take this single jar says it'll
cows all containing all and be happy
yeah okay okay single jar containing
everything you don't need anything else
but some people are so like straight
down I just need this and that I don't
care about rest of the classes okay
everything is in maven so just define
maven dependency that's it so as I said
the license is Apache right there and we
have a management center of war file
here so that you can manage the cluster
it's free for up to two two nerds so for
testing purposes and comes with these
fashion support alright so so for the
purpose of demo we have command line
application so it reads my commands and
sorry and then parses my commands and
does his cuts calls okay so I'm going to
run a command line test application or
demo application you can sort of you I
want you to be able to go home download
the thing run the run this essay the
application so that you can start
playing easily can get started quickly
where are we not this one so I'll get
into this
ok bin directory should be able to
Ferrari yeah I'm here ok I say start
running sage is the is the test up
command line application so this car
will start and say hey there's only one
member it's me this is me so and I'm um
my IP is this and if I say map dad put
one let's say SF now if I do him that
get mapped out get it will tell me SF of
course if I then go and start in other
instance it will take up the next port
and hopefully they will cluster and we
should be able to see the entry that we
entered right so now they're clustered
if i do and i get from that from the
second node i got so so so if i open for
fun another one blah blah so the
question here is that what do you think
the data the entry is like i have three
nodes right now I have one entry it's
somewhere right is it all is it on every
node is it on one node so hazel cassis a
package partition his gospel partition
to your data your map into and
distribute on two nodes so it's not full
replication thing it's a partitioning
with replicas so for each map you can
define the number of replicas so if the
default is one if you just start it has
one so let's put more data like there's
a put many command that I've we made it
up okay just just just to make things
easy I now have I just added 100 more if
I down the size 101 you got the point so
we're sharing the map and it's the
entries are spread across
notes okay now the one of the good
things so it's a straight male
java.util.map but it's a little more
than that
um yeah yeah so um ok so in hazel cast
are internally you don't you don't have
to know or any of these but I'm just
explaining how it works actually knowing
these things is very nice but when
you're writing the code you don't have
to you're using the same interface so
internally there are 200 and 271
partitions there their virtual
partitions there's nothing really
partition so that we can rehash the key
and mod with this partition ID part
number count and then we'll tell us what
partition this key falls into and in on
every node there's a partition table it
tells me which partition is owned by
which now then the PUD will be routed to
that owner note because when you when
you're doing a get its same happens
because you have to be reading from the
even if you are the backup of that key
you should not be reading from the
backup you should be going directly to
the owner for consistency consistency
you can enable back up read if you want
to but default is a no read from the
backup you had a question so again now
yeah so do the way we do do it is also
that we did serialize the yorkie into
byte array and then I should take the
hash are on fire hash function and it
will have fun the hash function we
defined the partition and then from the
party me to find the target okay so we
we extended map of course a concurrent
map so that means we have put up put if
absent do plays and things like that but
we extended regular Java concurrent map
we added things like queries listeners
locks things like that so if i do end up
lock meaning get map and the map dot
lock real IP api and then the past the
key and now this there's no node owns
the lock for this key not the entire
thing just for this particular key so if
i do this something like to i'm from
istanbul so let's all right try to write
that so what do you think will happen if
i hit obviously it's locked i should not
be able to do it so it will get blocked
until when obviously until i unlock the
key so it's your turn so of course so i
can also add listener to to it like a
laptop listener now this note is
listening for the updates now if I do
I'm not proof from another node with to
be in New York okay then I on this
listener listening node we should get an
event saying that it is updated it's
added right so a straight map but with
more more more things on top
so it replicates too sorry Avery yeah
okay for application yourself no so a
sick ass is always always partitioned
with replicas and you define darker
space but if you if you want you can say
I want five replica you can they do the
way hazel castles is designed is that we
don't care about small I mean now I
shouldn't say that but it's designed to
scale to hundreds o notes that's the
idea so scaling means I should not be
copying things on everywhere right so I
should not be replicating everything to
everywhere so everything should be
partitioned in a way that i can if i add
new more notes i should be little mostly
near the scale right that's that's the
idea behind it so everything is designed
to scale
single program for multiple data so
have the wrong
asuncion I say
the job
robbery
s p.m. d-1
the group
okay yeah I understand okay yeah so so
actually actually not replicating is a
nice thing when it for for doing what
you're asking like it match so we are
partitioning right so then let's say
let's say we want to we want to
calculate let's say uh yeah we want to
calculate yeah right just just for fun
so since everything is partitioned I can
issue an issue a command saying that
take this account and run on every node
and as and and that code will be only
operating on local entries and so that
way I can process the entire thing in
parallel I don't have to fetch things on
processor or I don't have to go one by
one I can say go take your data process
and give me the results so parallel
processing yes so you can add had global
listeners like this one or you can add a
local listener listening the data that
that's on you so local locally maintain
data so so we all have we extended as I
said a map we also added think new
things like distributed Q so like if I
offer something from here hello I should
I should be able to take it from here so
it's a regular blocking Java bleep
blocking q but it's distributed so if
the names of the queues are the same
then you're operating on the same block
and cure it's a 500 so it's still 50
sure
like filtering the queue okay
okay oh so and then this value is about
hmm then you should you probably should
have two different cues and put the
numbers in two numbers q and the guy who
is crossing yes yes I understand i'm
sanna not yet but that's a good good
edition edition yeah so maybe looking at
the attributes of the items that you're
putting in it might be routed to a
different thing right okay yeah yeah
yeah yeah yeah yeah yeahs told God yeah
or like adding a consumer devil devil
consume based on a court area very good
question should we try that where should
I get the lock for years I which one
which just visit this one is good okay
all right this fight this guy has a log
now this guy is trying to update that to
sleep I don't know obviously it's
blocked oh ok if you want me to kill
this all right control C was it ok boom
so it got it it's not blocked so if I do
I'm dogged what was it five yeah nice
see you did believe that I was afraid
awesome good actor sit again okay so box
are also locks are also it's been
recorded that's why I'm I came here I
know I'm loud enough locks are also yes
backed up the so that if if the lock
holding no dyes you see you had the log
you should be able to keep up keep going
right that's that's true but in this
case will kill the guy who had the lock
he found owner the lock if I die you I
should release a lot because I died i'm
donor the lock and I should I die my
luck should be released but uh okay
but who okay if yes who's gonna unlock i
am the owner of the lock I can only
unlock it okay
so
they have found one means of them come
easy there's one other guy holding the
data pricing one of the guy dies what we
expect it was ended so currently this is
how it is right so the default is backup
count is 1 so if I kill any of these
guys I already did actually right so
what was the number of entries we had
101 and then 102 you should be yeah let
me let me limit keys okay so okay these
are these are the entries stole so we
had two one two and three 125 yeah we
have all of them right so so if you kill
of course we had to back up somewhere so
it did recover so actually i wanna i
wanna i want to become a little quicker
I want to speed up the things so if you
if I oh I i deployed the war file
somewhere in a tomcat i'm going to log
in and see what's going on inside
cluster i don't know if it is going to
be looking good here
still there
I was going to show that that's so yeah
please yes so right now we have two
notes left so and half and half owned by
two to two guys here so as you can see
the partitions is like one has fifty
percent that one two percent now I'm
gonna and if i look at my maps here so i
should see a total of one hundred and
something and these are the these are
the entries so so this guy has this many
entries this guy has this many trees
okay so we know that so it's good so if
i if i if i open if i start another one
where was my nose here okay so this is
the one that I killed i want i'm going
to start it again so and I want to watch
I want to watch this so the third guy
will come up in Wells I should see the
third member here and he will start
empty and then it will start acquiring
some of the partitions so you already
got 29 of them so let me let me go to
here and actually like home and see it
okay so we had very tiny data and so it
did occur the part of repartitioning
very fast but if you had like millions
of millions of entries then it was going
to be doing slowly like getting one
partition second pattern so he
eventually in Santa like I had 20
minutes or something it will get it
equal partitioned on 23 of them so yes
good no in no no and yes no meaning it
has a fixed logic internal it built like
it has to do one by one we don't want to
a problem migrate in parallel why
assuming assume that
have hundred million entries okay on
hundred node cluster so we don't want
you to like we don't want to like what
while because the migration I got into
details very quickly I should have let
me followed it yeah so it's a bit now
but it then you're affecting something
else so so here's the thing let me go
over the demo no presentation I'll be
answering your question I totally
understand your concern so as I said
it's partitioning thing this is the way
we define the partition ID for a given
key and then so these are our members
three members members and as you can see
out here right there these are the
batteries and these are the backups okay
so now let's see let's say the new one
is added as we saw us eventually we're
going to be my gratings some of these
partitions and eventually we cannot
become what equal equal right so but I
said migration so migrating the data so
if you have tons of data and migrating
one bar if he market in parallel we
might assume while migrating entries so
I invocation should be redoing because I
think that he has the data but he is
about the Margaret to you if I go to him
to get the entry he should not be giving
me because he's these part migrating
that partition to you so the question
becomes what if that migration takes a
lot of time so we don't want that too
right so we because so if you do the
partager migration Impala then the
number of his that's being redone or
revoked will be increasing right so
that's that's also another
that's also a problem so what we are
trying to do is as you're adding nodes
your performance should not degrade
that's that's why we are saying one one
partition partition at a time you should
be migrating they will get blocked the
until that's why it's it should not be
it should not be in parallel and one of
the time is a good strategy here and of
course as I said you have 207 one
partition that means or you can adjust
that number of partitions if you have
really really big data because that way
your chunks are going to be smaller so
you can understand you can calculate
like hey I have this many entries in in
each partition that that 1i one we
squeeze when we zip that thing it will
be that small then it can be transferred
in half a second oh that's good and that
that's the way you do you specify the
number of partitions okay that because
we want to avoid also latency on the
calls right during the migration so so
migration is complete so what happens if
a fan out crash of course as we saw
before so again we'll be gaining the
will the backups are going to be owning
the backup partitions they are no longer
going to be back up there going to be
owners on the back up and then taking
backups so that we have enough backup in
case in case for next crash so if you
are all safe so no types
for that
for that item at a time when the node
has not detected that the remedy is down
so what happens at that time it there
would always a time between all these
weird cases like so I'm thinking that
something's the cluster is in this state
but it's not because I just I need to
wait a little more to understand the
state of the cluster right they do
whatever always a latency between
everybody knowing ever the entire state
of the cluster so i think that the party
is owned by him but he it's about to
migrate obviously I don't know the I
don't know the right thing so so for all
these cases that the from the color
perspective I mean our developer it
doesn't understand it doesn't map that
put underneath hazel cast tries to
resolve that fuzzy state right so I
think that this is it's like dying I
think he thinks that he's starting
things like that so it's going to be
frozen the oil pressure will will will
be blocked until the state the fuzziness
result so I have to know exactly who
owns it and if I go to that guy he
should be able to say yes I own it so
both both sides should be agreeing on
the the cluster state so
okay okay so when you say stealing it
says good code goes through security
okay it's oh yes yeah yeah yes you want
to separate the clusters yeah okay yeah
so without really really like strikes
security the easiest way of doing it
having a changing the net at the group's
group names in the configuration app one
app to in the configuration then they
won't they won't cluster together so
they won't touch it each other or if you
are using multicast change the multicast
address so they don't take enough find
each other but if you're I mean talking
in terms of security then you have to
use our security module to ensure that
you and everybody in the cluster has
this a good credentials to join the
cluster yes devil did these are common
things even like the imagine you have a
production side and test test
environment and developers are also on
the same network so we don't want
develop a machine to talk to testing
servers or in mistakenly they're just
joining the cluster right for those
cases yes so that's why I we we should
what I'm saying is you should we should
have a groovy all group names for the
different applications should be
different oh and also you can you can of
course your network guys are going to be
more careful about that you are gonna
probably they're going to have virtual
never chill villains for all these
setups but program
from hazel class you can also divide
these clusters separate this faster
that's fine i mean what his gas cares is
the connectivity so do you want them to
join or do you okay so your network
network guys should be should should
enable tcp connection among these
subnets that's it still a multicast if
you're using multicast they should open
multicast for those subnets or if you're
using tcp/ip with multicast is not
possible use the CPI / clustering give
the IPS directly that's it so let us cut
this picture as it should servers are
with the data on top our data service
service without the data data things
pictures they are called light members
they are not holding any data they are
they are the member of the cluster they
have very facts at fast access to the
data data nodes but so they are they are
part of the cluster but they are not
holding anything on them okay so maybe
you want to separate your web
applications from data servers but still
on the same cluster also on the Left we
have native clients connecting to the
the nose in India in the cluster there
there they connect to one of the notes
and the delegates all the operations to
that note so everything it so if the
client is doing a put put is done on the
connected node on behalf of the client
okay so it's very scalable to have
hundreds or even thousands of clients
but the idea here you should we should
be able we should try to keep the
cluster small to avoid network problems
as much and if in if you need thousands
of things connect
back into the cluster we should be using
Native Client ok so smaller the cluster
the better Enterprise version is
something that we have something called
a lasting memory ulf heap storage so
that we can avoid GC problems where
normally with the community edition
everything starting on on the on heap
which is subject to GC pauses if you use
the last memory then everything is start
off the heap you can have 100 gig / JVM
in memory storage and as I mentioned you
can also enable security making sure
that no no bad guy can connect your your
cluster off it's a very simple
configuration you have the map
definition you'd say the storage type of
heap default is on Ani on heap I'm going
to pass the jazz hard sample code so we
saw that get the map get the list so on
a single jbm you can start a cluster of
five nodes this is how you do it so you
do config create a config and then you
say he'll get new instance every new
instance is really a new node okay so
you can have five note cluster on a
single JVM process if you want to ten
and note this is how we test things so
our test will will start five notes and
then it will put things from somewhere
and then remove things from from other
other place and make sure that the very
we're getting the expect yeah Sippie ink
in the case of like like tom cat has
stumped you know tom cat you can deploy
multiple devops you don't want ya got
the point right okay okay yes
wow that was quick okay the question was
why do we need this why do we need to
start multiple instances on a single JJ
be m and the answer is in the in the
case of Tonka for example or any
application server you can deploy
multiple applications and in most of
time you would say the applications
should not be showing the same his last
thing every application one I have their
own cluster as this is how we do it so
for per application you do his guys new
has because instance
very very possible yes I totally so some
people as you said we would run 10 notes
and on the same machine so that they can
avoid GC but yeah yeah so this is for
running on the same jvm you can always
do what you're saying always do so
objects up must be realizable we rely on
sterilization but you can always
implement java citizen serializable but
if you if you implement our day
serializable it's going to be way faster
not because the java sensation is bad
and ours is better because we think that
you know how to sterilize your objects
you don't have to give their object to
java to sterilize in this area lies java
tries to do a lot of things they so he
uses caches and things like that tries
to resolve all the problems possible so
what you do in the most most cases you
don't need that you know your objects
you know how to say write and write you
read them so implement our data
serializable it will be faster so in
clustering your face as you can guess
you listen for the membership events you
can get the set of members in the
distributive map you can use you know
them put and get but make sure you take
advantage of prefab sent there are very
good atomic operations a very valuable
thing in the key in the queue as you can
guess it's a java two concurrent
blogging q interface you do offer paul
whatever so it's all this blocking
operations are all supported all of them
block you can do to way we can use the
luck interface or you can you also have
the locks in / / map so as
is short in the demo you can lock
particular key and this is how you do it
can get the map lock the key and make
sure you of course do follow the pattern
like log try finally thing sit again
Oh No
poor conditions only the lock/unlock and
trilok trilok is it also supported
topics yeah the idea here is that you
have ten node cluster say some of them
are listening for a particular topic who
are we listening we're for this
particular default map default topic
will get the published messages from any
node any node can publish any node can
listen whoever is listening will get
them so just like a JMS topic but it's
where lightweight so ninety percent of
the time this is going to be what you
need but if it doesn't fix it fix our
problems of course go with the Gemma's
yeah
ah
was asked for
it's a what we have is also already a
BSN but not be like so how to
so yeah
oh yeah I got okay yeah same for the
data centers like one datacenter should
be holding the backup and the other one
should be owner okay yes we do yes I can
so I think we're out of time if you have
particular questions I'm here and we
have a booth at the exhibition hall 5105
yes please come visit us and ask her all
your questions I'll be around so if you
want to ask more thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>