<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angry Duke: Physics-Based Games in JavaFX | Coder Coacher - Coaching Coders</title><meta content="Angry Duke: Physics-Based Games in JavaFX - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angry Duke: Physics-Based Games in JavaFX</b></h2><h5 class="post__date">2013-02-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jcSp2E0MTyE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to this session about angry
Duke physics-based games in JavaFX
actually this talk has just has been
renamed to angry nerds because when I
submitted the talk at JavaOne after I
submitted it I went to a conference and
I met the guys of Atlassian and they had
at their at their they had these nice
t-shirts here
and they had a mock-up flash game on
their site on that page so I went up to
them and asked them if I could use that
and if I could use their graphical
assets for creating my game so I'm
saving a lot of time with this and yeah
they said yes and they're basically
sponsoring this talk so saying thanks to
a question so is there anyone my name is
Tony Apple and I'm from Munich I'm a
consultant and trainer mainly for
desktop development and mainly for the
NetBeans platform and in the last few
months I've been playing a lot with
JavaFX
and I'm also on Twitter as Monaco Tony
and I've kept my blog on che skills calm
so is there anyone who follows me on
Twitter or reads my blog okay
you shall not go home empty-handed okay
for next time you know what that you
have to show up raise your hand
in that case okay
so I much as I said I'm a trainer and
consultant and got a blog and I'm also a
Java tools community leader and I'm on
the NetBeans Dream Team so I'm doing a
lot of NetBeans stuff
I'm also organizing the che day in
Munich so is there anyone from Germany
here okay where are you from okay but it
pays to come down to Munich December 3
come to the che day I'll give you a free
ticket so this talk is about how you can
use box2d or che box2d to add physics to
your applications and specifically games
and well it has been used in many
context but it has not been used so
often in JavaFX yet so I'm well I don't
have to tell you anything about JavaFX
probably the whole conference is full of
talks about JavaFX it's anyone or here
already using JavaFX creating JavaFX
applications ok I see a lot of interest
but actually when you ask people who is
using it it they're still they are still
a little bit well
anxious I guess to use it in commercial
projects but I saw I saw those great
canoe projects and I I must say there
was very impressive in the keynote so
now that it's available in Windows OS 10
and Linux and you can develop it in many
languages I think there's nothing that
should keep you from developing with it
at least playing with it so che box2d is
the main part basically of this talk
because since you all know Java FX at
least to some extent
this one might be new to you J box2d is
a 2d physics engine so it simulates two
dimensional worlds it's actually very
very popular the the original project is
box 2d and che box 2d is an almost
one-to-one port to the Java world and
you can actually tell that from from the
user interface from the api's so it
really doesn't feel like like a Java API
sometimes it's very strange but I
created my own wrappers
with so it's much nicer to work like
this
J box 2d box2d the original one has been
used in the game Angry Birds which is
very popular and J box 2d is the Java
port has also been used for the game
Angry Birds I didn't know that first but
the Android version and the version that
comes with that you can play in chrome
that is created with gvt with Google web
toolkit is created with J box 2d so this
is really a very nice library that is
not just some kind of toy you can really
use it for a serious development if you
use J box 2d the debug rendering if you
create your first worlds there's a
debugger renderer and that is written in
swing and it also is extensible so you
could actually write your own debug
renderers in other UI toolkits but
unfortunately it's there are some some
things that really bind it to swing in
the background so I couldn't use that I
had to create my own stuff so let's have
a look at how box 2d or chai box 2d work
works the main class that you are
dealing with is world and the world
class
is created very easily you create a new
world and you give it a vector a
two-dimensional vector that gives you
the gravity it defines the gravity of
the world so it makes sure that the
bodies actually fall down at least most
of them and the bodies that you're
dealing with are rigid bodies that means
they are like diamonds they are not like
big when you have two points two bits on
this body they're always the same
distance so they don't deform and you
create a body by first defining a new
body death that is something that I've
for my own for my own stuff I've I've
hidden that behind builder but if you
work with plain J box 2d you would
create new body def and you would tell
the body what type it is so this is a
dynamic body
there are also static bodies they are
for creating the world the environment
for example the ground and there are
kinematic bodies those are bodies that
are not influenced by the normal forces
but they are they're moving independent
of that each body has a position that's
nothing very fancy a density that makes
sure that the body has a mass it has
restitution restitution makes it bounce
so the values are from 0 to 1 so 0 means
no bouncing one means it really jumps up
the whole way again they've got friction
so when you when this when they hit some
ground and and or they go down a slope
then they will slow down do friction
they've got an angle so they rotate when
they when they fly around which is very
nice because this is most this
one of the most important parts of the
physics engine so your body's like feel
natural you can allow the body to sleep
which means that when the simulation is
running and this body has reached some
some point where it's not influenced by
other parties there are no forces
anymore then it goes to sleep and it
hasn't doesn't have to be simulated
anymore
only when a collision happens the body
will be will wake up again and will be
used in the simulation again there are
some other settings like linear damping
and angular damping which is responsible
so if something flows through the air
it's there still some kind of slowing it
down you can set fixed rotation fixed
rotation is important if you have like
sprites that are your players and your
your games your player sprites and you
don't want them to rotate but you want
them to stand up the whole time then you
set fixed rotation to two you can set
them as bullets bullets means if you
really shoot them very fast then there
might be problems with a weather
simulation they might go through bodies
because the discrete simulation steps
might send them through through a wall
and that's not what you want so this
starts a continuous collision detection
you can define that the body is inactive
which means active is the default if
it's inactive this means it's asleep but
you cannot wake it up so that is if you
want to park a character for example or
sprite and it should not take it should
not collide with any other stuff until
it's it's active like in Angry Birds the
birds that are sitting there and waiting
for their turn and you have user data
and user data is you is the payload that
you can put in and
in some of the tutorials that you've
maybe seen in the internet for using
box2d together with JavaFX they put a
note in there which is nice which is a
good thing I'm not doing it like that
and I'll tell you later why and yeah
when you're ready when you have defined
all of that you simply create let your
world create your body so that is the
first important step the next thing that
you're dealing with is shapes so the
body itself only has a position you saw
that it doesn't have a shape so the
shapes are independent of that and the
shapes actually don't know too which
body that you belong they are reused in
in in different calculations obviously
so that is the reason why the shapes are
actually don't know anything about the
body and the body itself doesn't know
about the shape directly there are three
important ones that circle shape polygon
shape and change shape change shape is
used for creating like the environment
that is really cool there's also at
shape I'm not sure what what is missing
here maybe it's because my presentation
crashed when I when I connected it to
the Beamer here but well those are
anyway those are the most important ones
the change shape is consists of edges
interconnected edges and those edges can
be used to make the tearin of your of
your game so I'll talk about them in
more detail so the first shape that is
the circle shape the shapes are
important for calculating the collisions
and they are used to compute the body
mass so you take the shape and the
density of the body to calculate the
body mass you can do ray casts with them
and you can test the point if it
overlaps the circle shape is very simple
it just has a position that is relative
to the position of the body
and it has a radius what yeah that's
what you would accept from a shape right
the polygon shape is solid and convex
body and the points here must be defined
in counterclockwise order it's a bit
that's also something that is a bit
strange about the about the API that the
the system itself doesn't test when you
create a new polygon if you really
define it in counterclockwise and it
doesn't throw a warning or so so you
have to really be careful
what you do it does also not test if
your body is actually convex and if you
create something like this the system
won't complain it will just not work
very well so like for example if you
create polygons clockwise then bodies
will stick together when they collide or
something like that
that is an indication that you did
something wrong so the polygon shape is
also very simple you have this array of
vectors and you can set them you also
have a count here and the count means
which of those vectors you want to
actually use so you can have like you
can define eight vectors and only use
three of them I don't know why that is
it's just the way it is okay here I've
got something about each shape the
missing edge shape edge shapes are
specials in that they have no volume and
they are mostly used for for creating
the taryn and they've got basically two
vectors and they are connected together
at shapes are something that is used in
the current version of chai box2d they
already have implemented change shapes
but they are not in the official version
in the actual in the official release
I'm still using them but we can they
work fine and they've got a benefit
because those if you put edges together
to
shape you can have some some kind of
ghost collisions here so if a body
slides slides here you get a collision
when it hits the corner here and that is
something unwanted because this
collision is going to be reported and
you don't want that so it's better to
use the change shape the change shape
takes care of this problem so if you if
you are gutsy and you want to use the
development version and you can use this
also the change shape like the polygon
has a couple of vertices and you can
either create a chain which means shape
like this or you can create a loop which
means the system will close this like in
a polygon I'm not using it in the angry
nerds game but I also created a pinball
game I don't know if it's it's you can
see it on on on YouTube I made some
videos with it but right now I free
written the whole engine so it hasn't
run I cannot show it here fixtures so I
told you that there's a body and there's
a shape and then don't know each other
directly but in order to attach a shape
to a body you create a fixture it's
important to know that a body can have
more than one shape so you can have a
rather complex bodies and that is
something very typical but in my
examples I'm also only using a one by
one mapping to make it simple so to
create a fixture again you have to have
a fixture def you create your shape and
set it on the fixture Def and use the
body to create the fixture with the data
that comes in from the fixture def and
that's it now you've got your first
bodies and you actually can can run
so the next step is to start the
simulation
box2d simulates those of all those
physics equations Newton basically is
running and calculating in the
background at discrete time steps which
means that you have to tune your system
for the correct value
well usually and when I'm using it I'm
using 60 Hertz basically and that works
quite well so like this is a simple
example we create a new world and we
create a new time step here and we walk
through this I'm just looping here
usually you have like an infinite loop
but just for the sake of testing I I
started like this and then I step
through the world you call the method
step with the time step and you also
have two values for defining how many
iterations are used for velocity and
position in two iteration so when the
velocity and positions are calculated in
in in the the higher the value is the
more accurate the calculation actually
is 8 + 2 is I think a very good value
that you can work with so we can now do
a little hello world
at least I hope so check
to do that I create a new job
application
okay
and I need to have a couple of libraries
so obviously I need J box2d
and I also need some logging framework
that they re they require okay so let's
create a new world
oh by the way you probably can't read
that right so tell me when I'm when it's
okay for you like this okay okay so I'm
creating a new world
and this is a typical value that you can
use so what's wrong here
okay so the arrow here was was actually
some feature that I added to to the
checkbox too deep which is I created a
XML persistence format for it so I want
to be able to edit che box2d worlds and
I want to store them and reuse them as
levels so I created this format and this
is also in the library so I used the
wrong ones I imported the wrong ones
these are the ones we need or che box2d
dynamics world do a time step
and we do the loop let's do 100
iterations and we create a body so I'm
not doing it like I've just shown it but
I'm using builders for that
so here's circle shape builder I create
it
I actually always mix up the the
builders from JavaFX
with my own ones and in the builders of
from JavaFX you say like circle shape
build a create and with my builder so
you have to say new circle shape builder
okay so we want to set the position
let's say this one is at position X 5
and y 10 give it a density
what else do we give it radius
we have to set the type we want the
dynamic party because we want to see how
its simulated that should be it build so
here's my circle
I can say world's step time step 8
- and I'll simply ask my circle for its
position
and printed out so this is probably
going to be very hard to see here maybe
I can set the default font so you can
see something otherwise it's going to be
boring
mm-hmm fonts and colors
I don't know if the output picks picks
that up I'm sorry I will you will have
to believe me watch out here okay so I
simulated it and you can see here the
body position
yeah the exposition stays the same but
the body falls down so here we're
already at zero not yet I have to add a
couple more cycles to the loop okay and
I will add a second body a static body
that it can collide with so new box
builder type static position I will
position it just below the bodies that
means also at position 5 zero and I set
the height to something small and I make
it
like 10 meters long
actually we're dealing with meters here
so the you're not you're not talking
about pixels because this is just
simulation these are meters and the
bodies that you create should be between
10 centimetres and one metre in size
otherwise they are not very well between
10 meters and and 10 centimeters in size
otherwise they're the simulation doesn't
work so nicely okay anything else we
need to do type is set so that should be
it okay you can do a simulation
okay so we see the body comes to a halt
it stays here because we didn't set
restitution on it and we can do that as
well
so make it bouncy and what maybe some
guys in the front row can see is no it
doesn't actually bounce yet oh yes it
does it does like here it bounces up
again so the values get bigger
yes che box2d doesn't do anything else
but simulate the world so it doesn't do
anything fancy it doesn't do graphics
for the graphics you have you have a
different debug renderer so you can
create your own rendering so I've
created a netbeans plugin that's work in
progress don't use it for anything but
playing around with it
but I want to show it anyway maybe I can
get somebody interested in helping with
it so this is che box2d support the
interesting stuff about this is that I'm
using my persistence format there so you
can create a new file and in this file
you will have your bodies you can drag
them around and you can simulate them so
I don't have it open let's check where
it is
we won't open the required projects
so what I'm doing here is I'm using the
visual library from NetBeans to
visualize the bodies and I'm using the
default debug renderer from box2d to to
render the results and simulate them so
let me create a new world for you okay
here we've got the world and we already
have a body here we can simulate that so
it falls down also not very fancy yet we
can add in more stuff like a static box
as I said this is not very polished so
shade box to these J box 2d support it
is called so it's yeah it's a plugin
it's not you cannot install it you
really have to build it because I don't
make a plug-in from this because it
would probably crash at some point your
IDE it still work in progress so it's
basically work it's it's my it will be
my world editor so you can add complex
bodies and create your own your own
bodies this one here is for example
strand beast I don't know if you know
strand beasts there there's some crazy
guy in the Netherlands who creates these
huge structures that are actually only
moved by wind and they look like they
are their actual animals or something so
and this is a simulation of a strand
beast whoa I guess I don't have to
so that's not box2d problem but a Tony
Apple problem okay so and you can see
you have like this revolution here these
motors that you can define and they
really act very cool I really enjoyed
that kind of stuff
so if you're interested in in in
something like that and in helping me
and you want to learn a little bit of
net about NetBeans just contact me after
the talk and we can maybe make you a
committer or something or a tester
so what we've seen here was the debug
renderer from J box 2d it's implemented
in swing and it also enables you as I
said before to create your alternative
implementations but problem is the event
model is EDT thread a WT event model and
it's a canvas based rendering concept
and well we have canvas now in Java FX
but you don't want to use it for that
because we're programming with nodes we
want to have nodes and we want to move
the nodes around but what the debug
renderer gives you is some vectors that
you can draw on a canvas so you don't
find out anything about the nodes
themselves you cannot reuse them so
that's another way to go
so you have to create your own rendering
if you want to do that and in order to
do that you have to know how the box2d
worlds look and the box2d words look
like this you've got a coordinate system
and the bodies can live in each of the
quadrants and they they do that because
the physics engine sends them there so
as I said the bodies should be not
bigger than 10 meters and not smaller
than 10 centimeters problem with this is
that the y-axis is positive is pointing
because it's natural well this is up so
this is 10 meters or this is not 10
meters this is 2 meters and 50 maybe and
bodies should fall to the ground so it's
natural to program like that
so it's natural that they have this kind
of coordinate system but that is a
little bit of a problem if you want to
render it because when you do it one by
one and you just define your your your
bodies big enough and and transcend and
want to translate everything everything
will be upside down
so you have to do some kind of mapping
and there's even more problem when you
bring everything to the screen it will
it will be not very not sliced very
nicely because those things are like 10
pixels if you just scale them one to one
and your screen is maybe 1000 pixels so
to speak with my famous with my favorite
Little Britain character computer says
no I don't know if you know a little
Britain here anyone okay I should not
use this in the States then okay but
what you can do is like you can first
off flip the y-axis and do some simple
scaling you set the meter to pixel ratio
and you set an offset so you really move
the bodies where they can be seen where
they can be displayed in the screen and
you calculate you calculate your screen
positions like this and maybe wonder why
I'm doing that because JavaFX
can actually do transformations of theme
transformations very easily I use that
in the in my first effort and it worked
pretty well
but after a while you get lost because
it's very hard to find out where the
actual where the objects are actually on
screen and if you want to do things like
follow body around and for example in
Angry Birds if you launch a bird it
flies and the camera follows it so you
can see what it actually does and if you
want to do stuff like that it's very
very hard if you do the transformations
so it's a good idea to actually put put
those nodes where they can where they
should be displayed on screen
it's much easier my my brain was about
to explode when I did that that kind of
stuff because it was so hard at both
drawing diagrams and I was dealing with
the three layout bounce that JavaFX has
and it really was very hard so the basic
calculation is this you you translate it
and you you set your meter to pixel
ratio it's it's very very if you do that
kind of stuff it's very useful to have a
camera class that do that that's the
conversion for you so when you really
want to place the bodies and you ask the
bodies for their position or for their
rotation and stuff you can simply you
can simply use the values from convert
world to scene and pass in the camera to
the to the providers that actually
create your notes and that actually
place your notes or locate them on
screen so I created that in a project
and this is this is yeah this was the
first problem that you need to solve if
you do something like that
the second problem is with the canvas
based rendering concept so what I want
to do when I do JavaFX
a rendering I want to create notes and I
want to display them on screen and I
want to reuse them I do not want to
create a scene with hundreds of notes
every sixth every sixtieth of a second
so I need some kind of map and that is
one approach so I can in each step when
I'm called and I'm asked to render the
world actually when I'm rendering I can
look for the body that I get the body
from the from the world
and for each of the body I look up the
note that corresponds to it in the map
and place it where it should appear
according to the to the simulation that
is one approach the other approach that
you see very often on the Internet is
you put the note into the body as you
saw that in the beginning each body has
has a slot basically where you can put
your own custom objects you can put
anything in there and a lot of people
are doing that I'm not doing that
because what I created was debug render
and with my debug renderer I want to
simulate worlds and if you for example
create a world or created a world before
and you want to simulate it with my
renderer I cannot be I cannot force you
to put put notes in there but you can
put anything in there so I created some
a map and whenever I get a body I look
it up and if it's already there if it's
not there I ask for a provider that
gives me gives me the note that produces
the note for me and that can configure
it with the new positions so that is the
the approach that is better for if you
want to do something generic you want to
have some generic rendering and not
something specific if you want to do
something specific later on and you
create your game or whatever then you
can go with the concept of putting the
notes actually into the body that's
easier so in each step that we've just
seen you can call a method and in this
method you loop through the bodies so
this is how I'm doing it I ask the body
for its user data now this is the this
is basically the other approach sorry
this is the approach where you use the
body to
or the actual note and then you can
configure it accordingly you just get it
from the note you configure it and you
display it on-screen
I'm not doing it like that in my project
which is also on github and it's called
jfx box2d
I uploaded it today so if you want to
play around with it it's well it's a
couple of probably like two hundred
lines of code maybe a little bit more
and it gives you a very nice nice idea
what you can do very simple examples and
I will show you how it works
so I've got it here
as you can see this is this is all there
is to it we've got this world view
that's the most important thing it takes
the world as a parameter and displays it
there's the camera class it's extremely
simple world metrics will will disappear
soon and we've got a node manager
and the node manager actually gives you
it's responsible for providing the notes
for the bodies so you can use the node
manager too and ask it for a node
provider and the node provider will give
you a node for your body and you can
register your own providers that is what
I'm doing and in my angry nerds game and
there are a couple of predefined
providers that you can look at they are
not very elaborate and they will be
improved soon but for for some basic
stuff they are sufficient
and I've created an empty
JavaFX application to show you how to
use it so we will again
use the world that we've just created
I'll simply copy it over
okay so this is what we've what I've
just created and now I'll create a world
view
give it a size that is actually not I
think it's not even necessary anymore
but still this is work in progress so
I'll create a new scene
also 800 per 500 and I tell the primary
primary stage to display this scene and
I show the primary stage mmm sure it is
I think okay and I start the simulation
okay nothing happening it actually don't
need this because the worldview is doing
the simulation and that is because I
haven't translated it yet so I get the
camera and configure it
like 50 that's the meter to pixel ratio
and I need to translate it by Oh actor
and for this I'm going to let me see
where where our bodies are you're at
okay they started 0 and 10
so here we can see our bouncy buddy
still not very fancy but you can see how
that kind of simulation is supposed to
work so the most important class inside
this project is the world view and the
most important method is the method that
actually does the simulation and for
this I'm using timeline timeline is is a
chav FX class that you can use to time
events and I set the cycle count to
indefinite duration is the is 1 by 60
that is the time step that I'm using
actually here this and I add a handler
that it should be called on every
whenever the timeline whenever the
keyframe is is true and in each of these
in each of these steps events I call a
world step that is basically the loop
the game loop so here the assimilation
is started and after I simulated it I
update the bodies I call a method to
update the bodies and relocate the
objects on the screen
and in the update bodies method I ask
the system I asked the world for the
body list well as a Java guy I would
expect I had expected to get a list or a
collection here but since it's a one by
one translation of box2d what you get is
a body and this body is linked to the
next body so I loop through it like this
well next party knot is now next party
is next body get next but the more
important part is I then get the shape
from the from the body and I asked the
node manager to give me a node provider
and this know provider is the class that
chillie can configure my note that knows
what my note is for what how my note
should be displayed and I pass in the
body and the shape as a parameter and
the note provider will then the node
manager will loop through its note
providers to the registered one and
we'll ask each of them can you create a
note for this body and if there's no no
no manager that you registered no note
provided that you registered it will
give you a default renderer for if it's
a polygon there's the default polygon
node provider if it's a circle the
default circle provider and then you ask
this node provider to configure your
note which means relocate it and scale
it and maybe rotate it and well if and
one if we do not have this node in our
map we add it so we added two to a map
so next time we can we can look up the
node in order to to configure it so we
do not have to create we just have to
create the node once in the first run
through the loop this is how the node
provider interface looks it has this
configure node a method and the provides
node for method this is what you need to
implement to say like if based on the
user data that is in the body for
example I can provide a note for this
body so if I for example if I create the
angry nerds game there's the bird and I
register a bird provider and the bird
provider says yes I can provide a note
for this body if the user data is a
string bird
here's the implementation of one of
these providers so it's very simple
actually you just use you if it's if the
note is if you don't get a get a now
past in here you have to create the note
and if you have the note you have to
configure it and you use the cam you can
use the camera to convert the
coordinates of the body so for example
the position and you can also use the
camera to scale your body in that case
you scale the radius and then the note
will be added to the world view if it's
not already a children of the world view
and it will be displayed on screen so
for this I have created a little game
that builds on top of it and that is
still called angry Duke and I will run
it first and then I will show you how it
works and how you can extend it so
you've got these different levels here
just a second I will first show you the
result
this was the empty level that we are
going to so first you see something here
you see the other enemies and then I'm
using transitions to actually move the
world around and you can see our our
note here our nerd our angry nerd and
here's one of the enemies flying around
in the air this is already simulated by
box2d it's actually not flying it's
dangling on rope and these are the notes
I'm using the note providers that are in
the project on github so you can you can
reuse these this one this guy here is
not simulated by box2d
this is regular JavaFX note it's
actually two notes so this is the chair
the error note because this chair I
learned is called an errand and this is
this is just image view and I use a
couple of transitions and combine them
to make this effect so the first one is
a translation then when it's up here
there's a rotation and when it's down
again I make a pause or two pauses and
then I switch the image which makes it
blink it's very simple it's like I can
show you
it's a couple of lines of code
so here are the here's the animation so
first we have the translate transition
please interpolators that make the
transition us often when when it reaches
the end and when it starts so it's
really like it starts slowly then it
goes faster and then it slows down and
I've got the rotate transition I've got
a translate transition that brings it
down again and I've got a custom
animation which is a custom transition
where I simply it's probably there are
better ways of doing this and the JavaFX
experts will probably tell me that this
is not the right way to do it but I'm
simply switching the image here and
JavaFX allows you to create parallel
transitions and sequential transitions I
first this is you can see from the front
of the code that this used to be
actually a parallel transition in the
beginning but I found out that the
blinking is is better when it's when it
happens at the end so this is actually I
shall rename this now because it's
probably a little bit
okay so it's actually a sequential
transition and this is the important
part of the sequential transition you
have this add all method and here you
can add all of your transitions and I
will show you the first one that I add
in here is a pause transition then we
have the animation that makes it blink
then we have another pause 500
milliseconds then we again let it blink
then we translate it make it jump jump
up we rotate it once when it's on top
and we start another translation to move
it down again yes yes
no in this case I'm doing it actually
there is this this bird that you see
there is not is it's not in the world
yet so it's actually a fake it's just an
illusion exactly that's the that's the
trick here so we have our bird here and
then I use mouse events and I drag it so
it leans back and it flies and you can
see now it's now it's the actual world
2d body and it rotates and while the
level is reset
so it's zooms back and as you can see
when it's flying
the camera is following it and this is a
nice effect and
I've implemented this in the level this
is basically the base class oh where am
i doing it yes No
oh yeah that's there's another thing
that I'm doing
you saw the score up there there was a
score label and the score label is not
supposed to move with the scene so what
I'm doing is I'm using this this binding
API to add a change listener to the
score property so we've got these
properties in in JavaFX and you can you
can listen for changes to properties
that's a very nice pattern actually
there are a lot of people who want this
to be part of of standard Java so it can
be used anywhere so we've got this this
the score I add a listener and I know
it's the translate property up here I
add a listener to it and whenever the
scene the main panel translates so when
when I move around
I set the translate to the negative
value of what I get and it works pretty
nice I was expecting to see some
flickering or something but if you have
a look that really stays solid in the
position and I also bind the values here
so here I've got this is just a regular
Java Facts label and here down here I've
got a score property which is just a
simple a number property and when I hit
something when there's a collision
detected I increase the score and I
don't have to do anything I don't have
to add listeners or so the only thing is
I have to listen to the score property
when it changes I get the value and then
display it on the score label that's
really very nice that's that's very nice
to implement with Java FX
okay let me see
so the next thing that I'm doing in here
is I have to make I have to detect the
collisions so I have to find out when
the bodies collide and I have to decide
whether I should explode them or remove
them so that is also very easy because
there is the contact listener class and
the contact listener class allows you to
to register on this world and whenever a
collision occurs it will inform you and
I've simplified this code a little bit
here but it's like a couple of lines
longer it doesn't fit on the slide
there's one method that is important and
that is post solve and in post solve you
get the impulse impulse and you get the
bodies here and you can ask you can loop
through the through the impulses and
that you that you get and you can find
the maximum impulse and you can check if
it exceeds a certain threshold and if it
exceeds that threshold I will say the
body should crash it should explode it
should be removed removing it is not
very easy actually I've had it was hard
to find out and this threshold is
something that you that is very
important for your that your gameplay
feels nice but you have to really find
out by trial and error what is the right
value we have to play around here so
when I want to destroy a body I actually
register it for register for destruction
because the world it's again like we're
Java developers and we are living in a
very nice world because most of the
api's we were working with are really
good and it's it's it's for example here
it's there's a method in the world and
that is destroy body I think yeah
destroy body it's called and you think
you can just call it and the body will
be destroyed and removed but that isn't
true it's only it only works if you do
it inside
the step inside the one step of the
simulation after one step of the
simulation is over and before the next
one has started so what you need to do
is you need to you need to create your
own world class you need to extend world
and override the step method and then
you can you can take your bodies that
are registered for destruction and you
can destroy them and you can tell the
view that it should also remove the body
and then you can well then you clear the
list where you stored it at least that's
how I'm doing it one other important
thing to know about you heard about the
bodies and the shapes in box2d but
they're also joints and those joints
make it possible to have these like like
this strand piece that I've shown you
the the strand beast is using motors and
revolute joint distance joints the
distance joined this is for example a
distance joint a distance joint is
created by creating a body and or
actually creating two bodies and
connecting them wireline so it's almost
like a rope but it's a it's more like a
pole that keeps them at the same
distance I will show you in in the box2d
project J box2d support that's the
easiest way
so I will create a new template well a
new file from a template and I think it
already has one body predefined so we
can reuse that and know okay I will
create a new body
and I think somewhere here probably this
one is yes
so I created a distance joint now and
when I simulate the world
yeah it should dangle here so you can
see the movement of this body actually
this one is I think it's fixed rotation
that's why it's not not moving around
probably I can should zoom in a little
bit okay and I will create another body
no actually I've wanted to do revolute
joint a revolute joint is but but well
it's a bug in here that you still you
always keep the tool that is selected up
here but the revolute joint would be
when they overlap and you make like a
hinge I think you call it right okay so
it's it dangles around one hinge so
in in my project basically when you
create your your levels or your game you
import your assets you create your
bodies you save your world you you
simulate it you play around with density
and friction and you very very soon will
get something that is really playable
like for example the game that I created
is like I don't know how many lines of
code is really not very much so you can
see here this is just the main class
that will launch the game it's just it
adds in the main scene the level board
that we have here the level board
displays these buttons that you can
click and start a level and the most
important part is the level here and you
can see it's like well 320 lines of code
and that's that is basically whether
where the whole game is is is developed
so what you can see here is what I'm
using for deleting the bodies
that's the explosion so I pass in a
position actually and I create a couple
of particles at random locations with
random speeds and I let them spread so I
don't know if you saw this little
animation when when it explodes when
something explodes and I create a
timeline for it and and and run it and
after while these particles are faded
out with a fade transition there's also
something very handy and as you can see
those 300 lines of code are actually not
a fake there are lots of empty lines in
here so you've you have this fade
transition and it creates this effect
here
I should add a button to go back to the
level board as you can see this is work
in progress I actually finished I
rewrote the engine a little bit and I
only finished this yesterday I have to
go to level 2 so and have a close look
when when the bird collides you saw this
little gray I can that is the translate
transition and this explosion also done
with the timeline I was actually
expecting with all these transitions and
animations in there that the system
would somehow slow down or that it would
put a lot of load on the system to do
stuff like that but it's actually I do
not have to optimize anything there are
no performance tracks or something it's
really very very powerful as a system so
from this base class that you've seen
you can extend and we will do that and
we will create our own level the last
thing I would like to show you in here
is the function that you use to actually
launch the bird here and what I'm doing
is I'm stopping the simulation for a
second and I find out what force is is
used so how far the user has dragged the
note and the angle that I should launch
the bird and then I use my my regular
builder to create a circular shape and
that's the circular shape because I'm
lazy it should be a polygon it's much
nicer if the if the bird doesn't roll so
far but I add the string bird as the
user data and that is used in the
mapping in the world view to find the
correct node for it
I set linear velocity on the bird so it
gets impulse
so it is launched and it has with a
certain force and then I asked the view
to play again so I start the simulation
again and let the world do its magic da
and what I'm also doing here is I start
another timeline so the game doesn't go
on forever or I don't have I don't want
to wait until all the bodies settle down
because it takes too long so what I'm
doing is I tell the system that after a
certain amount of time it should simply
reset the scene so in this case it's
eight seconds so after eight seconds I'm
stopping the view again calling the init
method the init method will set up all
the notes the the base notes and it will
create the the initial world for us and
then I'll call play and the game will
continue so I've prepared one empty
level and well level is abstract class
and there's one at least I thought it is
let me check yes it is and it has a
method create bodies that you need to
override and this is where you create
your your own world and you create your
your assets so let's create a new box
that we can shoot at
we'll be a dynamic box
we have to position it I have to look up
where where actually the floor is so a
good position is obviously here
so let's see
okay good like top one F and
give it a density and build let's see
okay let's see what we've got
it should be a dynamic body somewhere oh
the demo gods okay obviously I did
something wrong so let me check okay
these are the bounding boxes actually so
the position was probably wrong that I
had here ah okay I know what happened
there's no floor
these these things here that I create
are the floor and the bounding the
bounding boxes and they are missing so
everything is falling down and that's
why everything is screwed up so what I'm
creating here is simply boxes and what I
did is for convenience
I added in a string that is hidden and
whenever it's hidden I don't want the
note to be displayed actually it's there
but it's not displayed so we have the
body now we have the the world now the
environment and I've created actually a
method that you can use to create these
these blocks and these blocks are our
image have an image attached to them so
I just have to tell the system where
they should create it and if it should
be rotated and if it should be rotated
to what angle so I call this method make
one we can have a look here so it's just
calling a regular box builder again it
creates a box of a certain size and what
I pass in here is an image a string that
here defines my resource and well then I
position it set the width and height so
toward an angle and totally irregular
stuff so let's go back so now I created
one box and I hope this time it works
okay so here we've got our our box and
we can shoot at it missed it
okay
so I encourage you to play around with
JavaFX and box2d it's a whole lot of fun
and it really well I enjoy it a lot and
I enjoy a lot working with JavaFX and I
hear a lot of people here at JavaOne and
I discuss with them where is JavaFX is
it there
how are the controls why is there no
formatted text field and stuff like that
and and I get very different opinions
most of them saying like ah we will have
to wait we'll have to see if it will
pick up in my opinion Java fix is is
going to stay because it's going to be
part of Java so um I will use it and I'm
using it for playing around and one
thing that I think is very very
important a very important thing to say
about the technology is it's really fun
to play with it it's really you really
enjoy to work with it so I encourage you
to play with this and here are some
resources that you can use to learn more
especially for creating games this one
is an Italian programmer and she's got a
blog and she's fantastic
it's really on this blog every few days
you see a new article popping up she's
creating flash games but she's using
box2d and all the stuff that she does
really applies one by one to what you
can do so the code is very readable the
code examples can be transferred very
easily one other resource that is very
important is the box 2d menu this is not
for che box 2d but for box 2d but it
explains everything in great detail how
the bodies work how the joints work how
you can build more complex vehicles and
stuff and there's che box 2d dot org
where there are forums and where you can
download the stuff the project itself J
box 2d is on github
I think a Google code um I'm not
actually I'm not sure it's it's it's
linked here so you can get the latest
sources from there and you can play with
it I'm actually trying to to put in some
extensions there especially the builders
because it's much easier to program if
you have builders available and I also
try to contribute my persistence my XML
persistence for NetBeans because this
persistence format would be fantastic
you could even use it in in Android or
you can use it in in other worlds the
persistence format that they are using
is based on what's it called it's a
Google project Google some some some
kind of protocol buffer I think it's
called Google protocol buffer but the
bet there there are a couple of things I
don't like about that and one of them is
with XML you can very easily create an
editor that you can with with code
completion and syntax highlighting and
code folding and stuff so you can
actually have a look at the at the code
at the generated worlds at the
persistent worlds and I'm using NetBeans
to to create the editor for this it's
really very very simple and the other
thing is that in its current state it
doesn't support for example change shape
and and some of the shapes that I need
for creating my pinball worlds and stuff
like that so so I would rather go with
XML here so the XML format I'm using is
not perfect and it's also still
work-in-progress the whole project that
I show here is not very old but I I will
continue to work with it and if there
are guys here who would like to help
you're welcome
how do you get the t-shirt and
you can get you can find the slides I
will upload them on my blog on chase
skills calm the project that I've shown
you are the che box 2d support is on
github and also the chafe Xbox 2d where
the world view is is also on github it's
not much there but it's you really
really don't need much to to create a
little game and yeah it's time for
questions
I'm very quick I we still get you get a
lot of time for questions actually so I
encourage you thank you sorry
that's in the level I think at least let
me check yeah the background is it's an
interesting story what I wanted to do is
I've got this style sheet here and in a
style sheet you can set the background
for JavaFX for charm FX nodes and
parents but I had a problem actually it
would probably work if I would use it
again now but I had a problem because in
in my development version the scene
would also assume in when the when then
when the bird node would just reach a
certain height so you can cannot see it
so you can always see the bird node and
in that case and also when when I when
I'm translating the background would
vanish so it would only show for the
initial screen so what I did was I
created a couple of image views and
added those it's
not something I'm proud of I think there
must be nicer ways to do that probably I
could use a canvas and simply draw
everything into a canvas and use that as
a background but but it works so this is
how I'm doing the background wait who
was that we did ask the question is here
okay which one do you want i from
Atlassian gave me only very very strange
sizes okay sorry
haha I remember you know I have not
tried yet I'm sorry but I will I should
try that
oh wait you get a t-shirt so do you want
the blue one or well you can use it as
for at night because it's way too big
for you
another question okay ah sorry okay I've
shown it in the slides but I didn't show
it in the code wait a minute the
collision is detected no there's a
contact listener class that you use
exactly here the contact list in the
class has a couple of methods I'm I'm
only using the post so it's cold I think
yes and I will get I will get informed
whenever - whenever there is a coded
collision and what I'm trying to get out
of this collision is who is colliding so
I can ask it for the body and what I'm
trying to find out is the power actually
is the impulse and if this impulse
exceeds a certain threshold
I scheduled the body for Destruction
okay wait
I'll go around with a bag I guess okay
let's see
good I don't know what this is what size
this is is it okay this is okay cool
okay just wait I didn't do that before
but that's very good for getting
questions so I'm doing this in the air
on note I think yeah here so when the
mouse is pressed I'm getting the lay out
X and the mouse X and when the mouse is
dragged I'm first calculating the
distances and so here I get the distance
and from the distance Y and Destin's X I
can get the angle did you get your shirt
already okay okay
so sorry I didn't fully get that how
hard would it be to
well I can do that there there's nothing
there's actually nothing involved in
that it actually works when I I could
like just do a back button and and and
switch back to the level board and if I
store the level if I don't really need
reinitialize it the you mean persisted
between two sessions so when I stop okay
what you can do is like just keep the
object in memory then it will keep the
state yeah but that is that's actually
nothing to it so if you like hit a
certain note so you want to bring up
another scene is that what you would you
would like okay well you add a contact
listener and from the contact listener
you just tell the system to display
another scene you didn't do not even
have to persist because those those
scenes that I'm using don't have many
objects so you can keep them in memory
for a huge game okay I can show you I
created them using I don't think I have
I still have one iced I think I have no
do you want to exchange no I don't need
to only have extra XXL sorry that's
that's all I have sorry I can show you
well actually I'm using some I'm using
GIMP and I get this assets here so
there's a lot of a lot of room for for
other stuff but this is the important
one so what I'm doing is I'm really for
this one and and and this is the way to
go is I'm putting all of them in one PNG
and then I have a class that simply
copies a portion to the image view and
displays it so there's basically an
animation going on
that cuts out apart from the image and
and displays it that's in if you want to
see that that's in the world view
project that is that I upload it today
okay
sorry you were asking for no this is all
of that is 2d I'm sorry well if you
you're limited in but you can you can
create well you can you can simulate a
2d world and you can display it in 3d
but you're limited in a way that it's
it's still going to be flat there's no
way of I'm not sure who was the next one
to ask okay I'm doing that why our
timeline is this I'm doing it
timeline this JavaFX has the timeline
animation and at the end of of a
keyframe I get an event and then I'm
calling step yeah I did that in another
game I can I can actually show you I
think I've got it but you will probably
not hear it anyway I'll go closer with
my mic so let me see
where is it
out here
but it's hard to get good game sounds so
that's why
so you will have to wait until I
actually finish one time to see to your
sound play so do you know the tetris
gods the gods of tetris it's a very or
did you hear that
impressive isn't it okay multiplayer
games no I'm sorry what I wanted to do
actually with this with this Tetris game
I wanted to to use their there is I
think it's called project Dark Star and
with project Dark Star you can have like
a scheme server and with this o level
increased and you can connect to it and
you can have multiplayer games and I
wanted to have it like why are the
internet so you can play against each
other but I didn't did never implement
it well you just have to you just have
to play the sound at the yeah I'm not
sure if I fully good we've got the
question okay okay when it's for example
when it's flapping its wings or so okay
you have you have keyframes and you can
use keyframe animations and then at the
certain keyframes when you switch the
image you can also play the sound that
is that way you can really very nicely
synchronize between those two
the animation in at what points at what
yeah okay
no because the scene itself is not in is
not affected from this it's just a
simulation in the background that is
affected and it will stop for a very
short amount of time okay I think I'm
almost out of shirts now Oh actually oh
okay she left I've got one small yes you
have that okay sorry
so it's actually a quiz that's that's a
good question there it's not forgetting
a t-shirt yes you can do that there are
you can have some you can distort
gravity so so partially and you can also
there are some tricks that you can do to
have like like radial gravity so you
don't have like usually the gravity
vector is just one direction about there
yeah yeah you can do that and actually
the exactly exactly and it's it's also
an on this block that I pointed out from
this girl she she has a blog entry about
exactly that how you can do that I must
these are reserved so I I have to keep
those but if you still have questions I
can
okay what I'm doing is well there are
two ways of doing that one of them is
you can create a map in the end of you
that's what I did and the other way is
like a lot of box2d guys are doing it
like they use the node as the payload of
the body so you have bodies that use the
data and they just add the node there
when it's first rendered and next time
they get it out of the node but the
problem with that is that it's not
generic solution okay can you can you
wait a second I would like to talk to
you I want to find out about your
project to use the same box in two
separate worlds actually I haven't
played with it and I haven't
investigated that I'm sorry I don't know
okay no so far it's it's really it's
actually running too fast
so when yeah I'm thinking about how to
slow it down because the bird is flying
too fast
every bank when you compare it to Angry
Birds in Angry Birds the bird is is much
slower so it's it's way too fast I'm
probably doing it by other timeline slow
it down a little bit but it's absolutely
non limitations I've seen this so far
the reason I asked that question or that
scene also say people use I think it's
public animation time or something yeah
yeah I'm actually doing that as well so
I can I can slow it down but I actually
as I said I finished this this version
of the game yesterday evening and it's
it's it's ongoing work though so there's
a lot of polishing going on what a next
thing I'm planning right now my builders
are for example only creating you can
create a be have a box builder and that
is actually something stupid because you
can attach multiple shapes to one body
so there should be a body builder and
after that a shape builder that will
change and in the project but it's it's
very usable actually like like this and
I found no the most glitches I found
actually we're in Java fix and
calculating the positions that is really
really very hard because you have that
is the only thing that has really
fighting within a lot in Java effects
because you have these layout bounds and
you have the bouncing parent and you've
got the
the local bounds and it's not very clear
how they are calculated because it
really depends on in which parent
container you are and there is one tool
that you can use to debug to debug the
scenes and I think it's called scenic
view or so and if you have a look at
cenek view and and you put the same the
same object the same note in into
different containers the the bounce of
your object will change you will totally
change and in in a for me unpredictable
way I didn't find a pattern to this yet
okay you if you have to use eclipse then
well it's it's just a couple of lines of
code basically it's if you if eclipse
doesn't run it just copy the mountains
project from it but it's it's an ant
based project so it should yeah there
should probably be support in eclipse as
well
no Android this one not because it's
JavaFX but J box2d is running on Android
it's actually what on and on the Android
version of Angry Birds J box2d is used
yeah they said there's a box2d
implementation for yeah but it's not J
box2d
maybe I did there's box2d for iOS that's
where it first where it first thrived
actually
and if you want to do that again well
she's creating flash games that's also
probably nothing for the iOS sorry yes
yeah yeah there are ways of doing that
but it's not possible with one shape but
you have to combine the shapes and you
have to you have to use different shapes
and you have to use joints between the
shapes for example if you want to have a
blob or something that that really
creates the world cannot cannot do with
it
what you always can do is like you can
you can remove a body and replace it
with another one and copy the impulse
and then air forces that should not be a
big problem actually
yeah but if the way I do it it is
extremely simple I just the notes are
actually weird position is that there's
not much translation going on the only
thing is I'm translating the scene and
that is something that is that is easy
yeah yeah so it's easy to do back no
problem okay no more questions
yep
okay if you have a USB key I can also
give you the presentation you do have a
wispy stick no okay I think if I can
port it to Java fax so it's like is it
using box2d nodes no I wrote a small
collision engine so it's like a race
between fruits and vegetables so I was
thinking if I can also pop it that's
probably very easy to port yeah so it's
just I have a small MVC drawing so if
it's it's it's probably very easy to do
that and it's really it's really fun to
do that but I just was I don't want to
keep you from from from from going
somewhere I just want to chop down your
your name and your and and the name of
the project because I want to look it up
okay I will try other wise
let's go ahead say anything I'll send
you information thank you very much let
me see
slide this one
we all look the same he's good then I
got this very new and the strange thing
yes yesterday I wanted to connect it to
the network oh yeah there was something
it doesn't have a network connector just
let me see where it is this should be it
you have to have an adapter yeah ok ok
I'll put it up again
you should go to the demo grounds they
there there's a there's one spinning
wheel and if you answer the question
also if you don't answer the question
you get a USB key just the tip nice yeah
yeah sure I know the side scrollers cool
excellent yeah I'm always interested in
let's but I have to write it down
because you know with the science thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>