<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing Best Practices for Using Hudson CI | Coder Coacher - Coaching Coders</title><meta content="Developing Best Practices for Using Hudson CI - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing Best Practices for Using Hudson CI</b></h2><h5 class="post__date">2013-02-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ItzAMvueISw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay good morning everybody and welcome
to a lovely San Francisco wednesday
morning thanks for coming in too early I
know this is a great place to hang out
before the bagels arrive so as penance
for that you have to have to sit through
us talking but we do appreciate people
turning up this early I think it took
Winston around two hours to get in this
morning the traffic was so bad so we're
lucky to have him but there we go just
to introduce myself my name is Duncan
Mills I work in the development team
tools team at Oracle looking after our
ids frameworks and hudson's part of that
overall mission and you switched on
Winston hello yes this is winston
where's the cash so instance the project
lead on hon hudson nucleus foundation
and breather the powerhouse behind
moving hudson forward my role on the
project is more i like as i put it here
project gopher so I deal with the
uninteresting stuff like legal and so on
okay so developing best practices or
really as we can put it towards
developing best practice this is one of
these areas where there's no right and
wrong solution and if we start out with
the assumption that we know it all and
we know how to do everything correctly
from the star then you know we're not
going to really have a very successful
time of it so we have to acknowledge
that this area at in any field of
software engineering best practices are
something that change their very
dependent on your environment and what
you're doing but what we try to do in
this presentation is kind of pull
together some of the the core good
practices that we've seen particularly
with some of our work with the Eclipse
Foundation and try and at least distill
those into a working document let's put
it that way we have to assume that's
going to change so before we get into
that section in which winton will be in
charge off because it's more his area I
just wanted to give you a little bit of
background about where Hudson is at the
moment just in case you are unsure of
where we were in the life
Michael just have some consideration
about what continuous integration really
means beyond the way we might think of
it today and then we'll get into the
best practice side because those two
things are actually very closely aligned
so a little bit about Hudson Hudson
itself is in a state of migration at the
moment we're moving from being a
java.net project hosted through the
Hudson CI dog website on to what we call
a hybrid project and that will mean that
Hudson is actually kind of co-hosted so
Hudson core the actual core engine that
does the majority of the scheduling work
is actually an eclipse foundation
project but the plugins the various
reasons which we'll explain in the
second are mostly outside of Eclipse to
drill down on that the reason there is
mostly around IP concerns library
approvals and so on and of course the
fact that it can be a more onerous
process to commit code into Eclipse
based on their procedures and so on and
a lot of plug-in writers don't want to
go through that rigmarole so we've tried
to make it nice and easy so that you can
keep your plugins on github or indie
wherever else you want and still have
those of course as part of the ecosystem
so going forward from eclipse sorry from
hudson 320 there'll be this kind of dual
license situation where hudson core is
eclipse licensed and then by default
plugins will continue to be MIT licensed
unless their authors specify otherwise
in terms of the versions that are out
there right now so to 21 is the official
production version of hudson as you'll
see we're very close now to the hudson
30 release from the Eclipse Foundation
which will become the next next
production version hopefully within
three weeks or so we're hoping if all
goes well there's a few little things we
need to do just to get the approvals
through and go through the final release
process with the Eclipse Foundation but
we're just about there and I'll explain
in a second a little bit about what
we've been doing
in that migration across to eclipse
because it's taken a lot longer than you
would imagine but I'll explain why so
add eclipse itself we're a top-level
project under their technology area so
it's not some folks have been a little
bit confused this week and they say well
if you're in Eclipse do I have to
download the IDE to get Hudson no you
know the Eclipse Foundation is is an
open source environment with all of the
facilities but that doesn't mean that
we're bundled with eclipse the IDE you
can download and use the war file as you
always have or the other distributable
so no real difference there so quickly
if you're not familiar with with Hudson
you know what we've tried to do and what
qashqai originally did when he came up
with this brilliant idea was have saying
that was really easy and simple to use
and I got the yes the Eclipse Foundation
start on next page so you know the idea
is that we can get going from zero to
hero if you like within a few minutes as
long as it takes to run the war file and
you can start to build these very
complex integration and CI projects I
manage it in a simple simple way I'm
trusting you let me just check is
everyone here actually familiar with
Hudson before I start or at least in it
yeah that's somewhat of a relief for
Saints it's not a bad room to wait for
the bagels in but there we go so I won't
tell you what Hudson is could you hear
that so in Hudson three what have we
been doing so the the major job is
actually being what we call the IP
cleanup we always knew this would be a
consideration and a possible problem
moving to eclipse the Eclipse Foundation
has very strict guidelines and processes
for ensuring that the codebase that's in
and hosted on Eclipse is from an IP
perspective clean so people can with
confidence use that code they know
exactly this traceability if you like we
know exactly every developer who's
touched every line that's the idea so
this extends to all of the libraries
they use downstream by a particular
piece of code now this turned out to be
a real challenge in the case of Hudson
because just because its name
shirin the nature of the kind of plug-in
ecosystem and so on in the way that over
time Hudson Corps had been kind of had
stuff added on to help downstream
plugins we ended up with an awful lot of
downstream dependencies which all had to
be worked through and many of those from
an IP perspective or from a licensed
perspective were not acceptable to the
Eclipse Foundation I'm rightly so right
this do they do this stuff to protect
them and to protect you that's the whole
idea so just to give you an idea Hudson
core if you compare that to to with
three we've dropped down from a 63 mega
bike or 224 megabytes so that's the
download and reduce the number of jar
files by around 20 and considerably
change the jar files as well so we've
taken the opportunity here to actually
upgrade a bunch of stuff we're very old
versions had been used in the past so
we've upgraded where we can to the more
recent versions of those open source
libraries as I've mentioned in some
cases such as in the case of jeffree
star jfreechart and winstone we've
actually had to wholesale replace those
with alternative implementations other
places like we had a dependency on
jackson lands on which various reasons
were incompatible from the license
perspectives we actually have to write
some extra code of our own to plug that
gap so there's a lot of
behind-the-scenes work that's happened
which isn't very glamorous and doesn't
really seem to move Hudson on from the
perspective of the consuming user but
the reality is that we've ended up with
a good stable and good quality core okay
there are some new features in hudson 3
but there's a lot more to come we've got
great plans and if you want to join the
community meetings you can get to those
from the Hudson wiki on the clips every
two weeks we have a community meeting
and discuss you know what's coming next
and we're getting to the stage now that
30 is just about put to bed we can start
looking at what we're going to do in the
next two or three releases we've already
got some plans so the things we have put
in very important one in
is the ability to have switchable update
centers this is really a key interest to
people who are trying to run up PI
private or public clouds where they want
to use Hudson as part of their hosting
solution but they want to limit the
plugins that people can be running
inside the Hudson instance so the
pluggable update Center allows you to to
do that and constrain things and there's
been a whole load of changes around the
way plugins are managed and the whole
system is bootstrapped mainly to do with
the library reorganization and the IP
cleaner anyway enough about that let's
move on to the real content what to see
I really mean and I think this is
something we have to think about rather
carefully because it does feed into some
of the conflicting demands on the CI
system and in turn some of the
requirements for the best practices you
have to worry about we've got a whole
community of people who are interested
in CI in most cases you know the the
instigating factory any organization is
going to be you know one of these groups
has a particular interest and dives in
and starts using had some usually it's
the developers because it just makes
their life easier right or it may be the
QA folks or maybe to build engineers it
doesn't really matter but we tend to get
an initial island within an organization
of people who are interested in just
making my day to day life easier but
then the use becomes more pervasive and
you start getting more stakeholders and
that has an interesting effect because
it does mean there is a different set of
requirements as far as managing that
Hudson instance and the best practice
around it right so as a developer who's
just running you know a small hudson
farm to build for a couple of different
platforms maybe i don't mind if i have
to shut that down and bring it up and
you know occasionally interfere with the
thing but from management perspective if
they're suddenly starting to use hudson
as a key part of their reporting
infrastructure and they're you know I
want to check who's done the most check
ins this week or who's fixed on those
bugs or who's got the best Co quality it
goes from being a handy useful utility
that developers just used to make their
life easier to being part of the
infrastructure that suddenly has to be
supported maintained and available when
that management team wants it and that
really changes the nature and that has
has a knock-on effect so we have to
think about all of these consistent
constituents if you like and how what we
do with our Hudson instances will affect
those and it's a matter of the kind of
conflicting needs of those groups you
know from the development point of view
I want something is going to make my job
easier so I can check in run the basic
sanity tests maybe deploy that thing
into my test instance depending on what
I'm building and that's all I need
that's all I care about from the QA
point of view well those guys may well
want to be running a full regression on
every check in right those are often
very conflicting things because a full
regression test may take way too long
compared with what I want as a developer
so we can start to see how conflicts
creep in to the requirements of the CI
system we're obviously all wanting to
have faster development processes and
better visibility into the results of
those processes but sometimes we get
conflicts and the point is of course
that you just have to start looking at
your CI system as something more than
just a build tool and start using it in
multiple ways and don't try and do
everything in one go and that's one of
the things we'll come onto later so of
course Hudson's an ideal backbone for
this and this is why you're beginning to
see this kind of CI engine as a core
part of people's cloud development
strategies this week we at oracle
announced our cloud developer Oracle
cloud development service in preview and
that's using Hudson its core both for
the backend provisioning but also as a
service within that developer service
okay so we know Hudson's got all the
right bits that's why we like it right
the fact that it's so extensible with
plugins if you are doing something
slightly exotic in your organization and
you know not everyone's the same a lot
of us do use standardized tools and
capabilities but pretty much every
organization has their own extra bits
they do whether it's custom scripts they
need to run or custom processes they
need to employ a
which you can plug those things in and I
think we're finding a when we look at
the plug-in usage you know the some of
the most popular plugins are in fact
nothing to do with building and source
control their all to do with code
analysis and quality and that kind of
stuff and that's quite interesting it's
really an indication if you like of how
Hudson has moved beyond just being this
build utility to make developers life's
easier into something that suddenly of
interest to management because they can
get visibility into this code quality
for example I think this is this is a
great quote so Jared Davidson is a
long-suffering Hudson user he actually
runs the build farm for oracle
jdeveloper the Oracle Java IDE or rather
one of the Oracle IDs one of it there
many IDs and he runs a huge farm of
servers managing all of the
cross-platform cross JDK builds so he's
got the world's best matrix builds you
wouldn't believe it but he made this
very pertinent point right that one of
the problems with with Hudson is the
fact in some ways it's too easy to set
up and this is where we really lead into
some of the really common mistakes we
see and problems that people come up
with because it's so easy to get Hudson
up and running that by stealth it can
just creep in and become a critical part
of your build infrastructure without you
even realizing it yeah it's running on
the spare Linux box under the desk or
it's running on the obscure vm that
someone put up and they can't quite
remember where it is but it's going fine
and so we can end up in this situation
that you're beginning to depend on
infrastructure that really isn't
properly maintained in the IT sense and
if you've just done all the default
stuff not only that is it's potentially
a huge security call a lot of
organizations rightly so care about
things like how visible their source
code is across your organization you
know though of course Hudson's very
widely used in the open source community
and we're quite happy for example on
Hudson CI or on the Eclipse Foundation
everyone can see our Hudson builds
happening that's that sets to be fine
everyone can check out our source code
that's why
that's not the quite the same way that
other organizations might see it so we
have to be aware of that particular
issue so with that long preamble
apologies for that but I thought it'd be
useful just to fill you in on on where
we are and where we're going when I hand
over to to Winston to actually give you
some meat and get you through some of
the breast practices that we've kind of
creamed from the the top of the
community and some of the things we've
learnt with some of the tuning work
we've done recently the clicker sir good
morning let's just go a little bit like
right okay can you hear me probably so I
thought that Duncan is going to talk the
whole thing because he has a very good
English accent I don't but he said no he
had to talk so I thought it okay I'll go
through that so I hope Duncan will just
jump in and he may quit I should
comments in into the presentation yeah
so my favorite topic to usually talk is
about plug-in development I since I
wanted more people to do write plugins
for that I have written a lot of
articles and I have I spent a lot of
time teaching people how to write
plugins but i noticed that i get about
two to three emails every day asking me
asking me about Oh Hudson is slow Hudson
is not doing what I want to do how do I
make it work properly for me so that's
what i thought that okay I should keep
aside be talking about plugin for a
while and talk about best practices so a
few months ago we happen to work with
eclipse foundation so it Eclipse
Foundation webmasters Matt and then each
day they called me and said that you
know we have a big problem that eclipses
this it's slow can you take a look at it
so I told him that next time the Hudson
is going to grinding down don't do
anything just send you an email
I'm going to get the heap dump and I'm
going to analyze that so I I I analyzed
about about 2 gb per heap about 10 GB to
12gb analyzed 10 and i found out that
it's so simple i mean if you if you do
the things in a very simple way and put
the put Hudson to work in a proper way
you get more productive Hudson so that's
what i thought that will just put
together and yes it was very much the
triggering thing that made us think
about doing this presentation so just
well which was talking there i got up
this is actually the the live bill
format at Hudson that's re eclipse
eclipse here so they run a huge number
of jobs you can see oh yeah I'm just
looking at their posture aggregation so
it gives us about 450 jobs and they have
about 9 to 10 slaves and it is
continuously it's continuously building
throughout today and especially when
there's a release like juno or something
like that it was it was going crazy I
think does the right time for me to look
into that so that's when I look at that
so let's go back it's like yeah sure
okay you talked about that what do I you
took today oh yeah we don't the Eclipse
I later when we talk about the the best
practices for Hudson we actually need to
look at what are the stakeholders of
Hudson so we thought that the best way
to look at this divide their real uses
of USS of Hudson are the maintainer of
Hudson so we thought that we should look
into the developer point of view a
product or project manager point of view
and Ori point of view that's a build
engineer so it's all these three people
have to come together and do it
correctly if you are not doing that
correctly then you are going to have a
private system which is unstable it's
not doing the things so the very first
thing we need to talk about is are we
using Hudson as a real CI system
so he briefly he talked about what he
said what is a CA system as an example I
happen to talk to enough the engineers
from Oracle she came to me and said that
i'm going to buy your lunch if you fix
this for me so I asked her what is
exactly the problem she told that i'm
using matrix bill and it takes about
nine hours to finish so after nine hours
to finish if there is a problem and if
it is if it is the build is breaking
then I have to restart the whole thing
and I said are you kidding me it takes
minus to the bill is that the way how
you use the CI system and she was very
upset and I never got the line chapter
that so so so what I told her is you
know you need to follow what s CI is I
told her that there are two books which
I highly recommend for everyone to read
one is the test driven development and
other one is the continuous integration
by Paul do all these two books very
clearly explain what i see is so very
first thing how many of you build a
system built a job which runs more than
10 minutes is going to admit to it yet
little hands are creaking up yeah you
know according to the modern fowler if
you if your bill if your job is taking
more than 10 minutes then you're not
doing real CIA continuous integration
must be done within 10 minutes but you
can say that my project is so big how
can i make it to build it within within
ten 10 minutes that is exactly what they
talk about you have to do architect your
build just like how you architect your
software you have to architects your
build system also you had to reduce into
what you call as buildable chance and
this is really where you get this
conflict as i mentioned earlier between
if the build engineers you want to build
the deployable product just hand on to
someone else and the needs of the
developers which we're talking about
here which is just this really fast
turnaround
and so we want to look at well maybe not
try and do everything with one built yet
split up we have the builds that they
get triggered by the check-ins which are
within this 10-minute boundary and they
just do the relevant smoke tests or
enough regression sanity stuff to make
sure that at least your stand less
chance of breaking the world you've
caught the obvious things and then sure
if the build engineer wants to have his
full regression sweet running and
building on five different platforms
happening he can do that overnight right
just create another job for that yeah
and do it that way and I think this is a
mistake a lot of people fall into it so
the continuous integration build should
if there is a failure it should play
within 10 minutes and the notification
should be sent to the corresponding
people so there's a lot of way to do
that like email jabber RSS even lower
lamps and I don't mind if you hook it up
with your fire alarm also so anyway so
find the correct identity from your
visas easeus send the email to the
corresponding person send your email to
their boss to the person who broke it
and then just fix it I remember we used
to have a jar where you had to put a
dollar every time you quickly break the
bill and end up the week we have enough
money to buy beers so so I mean it we
have come a long way from that of that
manually doing everything and right now
Hudson is a is doing the things but make
sure that you what you do the bills are
doing the right way okay next next like
living okay so as I said you have to
break your jobs into so many so many
things so what happened when you do that
so you ended up with ink which happening
large number of jobs so when you have a
large number of sub there's some
maintenance overhead because they're the
same job and the same properties and
same thing maybe repeating in several
number of jobs when you break up that is
the reason why we there's a lot of
people are asking about the cascading
job how how I can
sorry how I can inherit a lot of things
from a previous job to that one this is
why we introduced the concept of
cascading jobs in two point two point
zero and of course we are not saying
that it's doing everything but it does a
lot of things and it reduces the overall
maintenance by I would at least say
fifty percent so really try this if you
are not using it because you know you
look at a lot of jobs and and there's so
much duplication that doesn't need to be
there and of course that's more making
sure to make one change you go make that
change cross the farm in all the
different similar jobs so having this
kind of templated approach is a huge
productivity boost yes okay next right
so I'll be hung I'm going to be your
clicker boy and cite the ten Winston is
Larry Ellison and I'm the person who
says click to there we go I told you
also Khalifa yeah the I will just talk
about this so again there are a lot of
plugins which is help you to identify
what are my job structures and what is
that so we are not going to talk about
all the stove all the plugins that there
but I can talk about couple of plugins
honest I really like the bill pipeline
it just actually show you the downstream
job bills and upstream couples and gives
a very good idea about what what builds
up breaking thing as I said when you are
trying to break your job into so many
different jobs then it is hard to find
that which which job is breaking the
whole what he called a strike three of
that one so there are plugins which is
actually allow you to view that one is
the bill piping plugin and the
downstream view plugin these things will
give you a good idea about how to hard
to look at that so as I said simpler job
is better so keep your job simple and
make it to build fast and fail fast yeah
better to have more jobs linked together
the lincoln huge jobs you can't debug
yes just out of interest I mean this is
one area where when we look forward to
what we're going to do beyond Hudson 300
this whole area of making these
workflows these these complex job trees
easier to handle
I think or is certainly an area we want
to look at so if you've got any ideas
will was pleased to hear them okay okay
job management you all know that when it
comes to okay I think again I should
talk about this example I got an email a
panic email saying that oh we upgraded
Hudson version now everything is broken
and our production is halted so we came
back and said that why don't you just
take it from the back up they said oh we
didn't bash up the whole thing then I
think that because of that I think this
this product what I'm talking about is
one of the very very important product
within Oracle I don't want to say what
product exactly except that it is
installed in millions of computers in
the whole world it's so so then because
of this the whole production was stopped
for almost a week because they did not
back up the things whole so as much as
possible try to back up the things and
there are plugins which is helping you
to do that I mean what the other thing
we want you to make here and I think
this was a great piece of advice that
she and remember who gave us maybe in
man for it but anyway the there's a
temptation as well when you're you're
building had some jobs to the fact that
you can have multiple steps within the
job people try and start to use it
almost like a scripting language right
so they have you know these big
multi-step jobs and that's fine but then
you're kind of using Hudson almost as as
a scripting a programming tool almost
and the problem there is you end up with
it even with the templated jobs and so
on you can end up with a situation where
you've got really too much logic and too
many steps tied up in the build
processes themselves so absolutely makes
sense when you're looking at doing a
piece of work in a job or how much of
that can I actually put in some kind of
external script now whether that's you
know Maeve on whether that's aunt or
whether it's shell script something that
can be parameterised
reused again and again I mean a lot of
us will build very many similar things
and if we can encapsulate that into some
kind of script that's parameterised that
then just gets wired up to a very simple
job that fulfills Winston's desire for
short simple jobs it also helps with
this whole backup thing because you just
check those scripts into source control
we'll talk about backing up Hudson
itself in a minute but you know a
specifically we're thinking about the
scripts here so you know it's a it's a
great idea to think about how you
externalise the logic and obviously
doing that in a standardized way so get
one project isn't using and another
one's using shell script whatever yeah I
the one other point is that naming the
job you know this may looks very simple
but believe me I when I was talking to
some people and asking them what is that
what is that what he called
corresponding jobs corresponding to that
then they go and start and search on
that one so give a good clear name
starting with certain prefix so that you
can easily search are you click a
creative you with that one though this
is a very simple thing believe me it is
going goes a long way yeah when you try
to find out if we just pop back to the
Eclipse Foundation is a good example you
know they're using a very well-organized
scheme here and you can see the back but
you know all the different sub parts of
the clips are nicely separated into
views so you know you're not interested
in the entire eclipse foundation from
the point of view of being a committer
you know we care about Hudson and if
jetties building my toe buddy care so
you know just using views and making it
easy to use views in the sense of as we
have here in pretty much every case the
jobs are well named so we can just use
Hudson as a regular expression and we
don't even have to name each individual
job so if Winston adds a new job to the
build as long as he calls it the right
thing it's going to appear in that view
without any further thought so it's just
a little thing but it's a great idea
okay so let's move on so yeah let me
talk about this one so this kind of
highlight some back to that comment that
jared davidson made to me which is you
know we we tend to start using CI by
stealth and suddenly wake up one morning
and find that it's business in the back
side the system goes down you have got
to back up for it right i mean it
exactly the kind of scenario and so you
need to be thinking about see I in terms
of being a production service to your
development organizations or of course
you can go to a cloud vendor and get
that same level of service hopefully but
you need to think of the builds
themselves as valuable data they're
valuable metadata that you need to own
and control so you don't have to spend a
week trying to rebuild all your jobs if
you can remember even what they were all
doing right so it's very important that
the metadata is managed which we'll talk
a little bit more about in a second that
you invest the right resources into it
certainly the tendency is for because we
start out small you know you might have
a small set of Hudson slaves running on
the odd machines you've got lying about
or on other developers boxes or you know
these kind of informal networks were
again because we started from making a
developer's life easier or making a
team's life easier you're then in a
scenario where there's no management of
that infrastructure yeah so you know
when when a developing adversely removes
that virtual box you've suddenly lost
one of your slaves or even your master
so that kind of stuff can be a real
issue so these CI installations have to
be resourced properly right and there
are there are various things that we can
do around the infrastructure to make
life that it'll be easier and we'll talk
about some of these as as we go through
so metadata first of all as I said this
is a valuable part of the business right
as we can see it's fine if I'm just
building a little solo let's say I'm
building a plug-in for Hudson right
which I am in a moment we would tell ya
I've got a Hudson job building that if
it gets blown away i lose the Hudson
instance it's not the end of the world
it will take me about two minutes to
recreate the job right
that most of the work is done by the
checkedin scripts so I'm following our
own best practice now but if we can
imagine the impact say the Eclipse
Foundation have we lost the descriptions
of all of those jobs that would be a
huge huge effort to reinstatement as I
said in many cases you might not even
realize what they were all doing so
you've got to treat the Hudson metadata
like a valuable asset that needs to be
backed up and managed properly there are
as Winston said some plugins to help you
with this there so the backup plugin and
the thin backup plugin but you know just
treat the whole environment as something
you can backup and restore instantly and
of course test it yeah don't just use
the thin black up plugin and assume it's
working yeah actually test it it's
trivial stuff we should all be doing
this but it's amazing that it doesn't
happen all the time right so treat it
like a production system there's another
very useful plug in the job config
history plugin if you're in a scenario
where you have got multiple users who
are all privileged to start playing
around with the configuration of jobs
then yeah at least get an audit trail of
what's happened there and work out who
it was that put that step in or change
that particular thing okay so resource
management this is a lot of the stuff we
love from eclipse I let some Hudson
quiet I was go Winston Hudson Estonia
this before going into this I wanted to
talk about are we going to talk about
that great later yet Wilson okay so yeah
if you are upgrading when you are
talking about back up back up back up so
we we always recommend that if you are
upgrading your hearts and even if it is
a plug-in don't do it on the production
environment this is what it happened the
JDK team oh and sorry I'm not supposed
to tell they are down for a week because
they just upgraded a plug-in and which
they broke the whole thing they didn't
have the breaker back up and they were
halted for almost a week so don't do
your update in your production system if
you are if your system is really
what we call mission critical system for
you you don't upgrade your email system
in place you have a test environment
make sure all your email gets into it
and so on it's the same process yeah
right so Eclipse Foundation has a
excellent way of doing that we need to
the same box so they have a turd so yeah
here's the sandbox this is this for
sandbox and right now they are running
hudson 3.0 on this mission and they are
giving me constant feedback what is
breaking what is not breaking and I'm
trying to fix in hudson 3.0 as much as
possible as i said we changed a lot in
hudson 3.0 literally we rip apart the
whole thing and put it back changing a
lot of libraries and also things are
breaking and because this eclipse
foundation is running that in their
sandbox i'm able to get a lot of
feedbacks and they are also able to test
it so i'll create if you don't have one
create a sandbox and upgraded only after
you are fully satisfied that is there so
this this upgrade you can just copy that
you are entirely and you can just test
it down that one but make sure if you
are using a slave go modify the slave
and use a different home for the sleigh
otherwise you are going to mix up with a
slave home facility that's very
important when you are doing that a
quick appeal here we're in the process
of testing as many old versions as we
can through the the QA team so if if you
have a set of old builds so if you're
running on hudson one for example we'd
be really interested in having those
build scripts so we can actually try and
migrate them up to three and see what
happens so i've actually already spoken
to a few people on the demographic if
you'd like to help out we just love to
have your scripts and give them a go
because people just use this stuff in so
many different ways you can never
predict exactly you know what's going to
happen so we do our best on the testing
the yeah do it one of us one of the
issues is when you are upgrading to a
new version and if plugins that if some
older plugins are there
and this those plugins might break the
Hudson and Hudson may not start so in
3.0 we come up with the idea of
bootstrap mechanism so when you when you
actually install and you start hudson
for the first time you get a nice UI and
asking you to tell that okay all these
plugins are outdated you need to update
this plugin for for this version to hurt
so you either you can just uninstall or
you can just install the new plugins so
there's a bit more kind of upfront
warning of where there might be problems
rather than you just trying to bring up
the instance and it or not working okay
so just a little bit here on on resource
usage so again based on a lot of
scenarios we've been seeing right the
the number of bills you keep it's
certainly a big factor as to what the
resources resource requirements are on
the system so restricting the history
depth is a good idea in terms of just
restricting the amount of memory that
you're using at any one time and that's
often the cause we see of slow systems
you know it's it's nothing to do with
the environment they're physically
running on or the amount of memory
that's allocated to the JVM it's just
the fact that they're having to
manipulate such large structures in
memory and we can really cut back on
this my my analysis of the heap at
Eclipse Foundation has given me a good
idea about how the I mean the I'm though
I think we can improve a lot of the
efficiency by using these best practices
we still found that there's the data
model of Hudson is inefficient in
certain area which we are planning to
improve in the next release and not not
in 3.0 but in the version after that 301
or whatever yeah yeah okay let's move on
so the at the other biab we just wanted
to mention it here I think apart from
the slow performance aspect but the kind
of number one cause of systems failing
is just as simple as displaced right
again because people are managing their
CI environments as production
environments and things fill up because
they're keeping thousands will
build thousands of build artifacts never
cleaning it up the Distilled up and of
course or hell brenchley so again it's a
silly thing but it happens right yeah
and one example again I bring it from
eclipse foundation the Eclipse
Foundation has an NFS set up and what
happened is this NFS was the filled up
and these an emphasis mounted on all the
different slaves and this caused the
entire system to crash so the best
practice is again to have a script which
goes through your jobs bill bills jobs
and try to find out which user is using
more amount and set a fixed amount and
send an email eclipse foundation is
doing that so every often I get an email
saying that your workspace is beyond 1gb
so please try to adjust it and keep it
less than one gb I think that's a good
practice I mean if as if not if a
particular user is trying to take away
all the space it is it make sense to
find who is using the space just it's a
very simple script using Python or use a
shell script just try to find out the
amount of memory used by the different
people send an email so I think that's
the best practice yeah so this is kind
of just a summary of the stuff that we
learnt if you like was looking at the
the Eclipse scenario that we kind of
talked about most of these so keeping
the the number of real districted just
promoting those artifacts you actually
want to keep rather than every
intermediate you know regression test
result or whatever managing the amount
of information that's going out into the
log files again just purely from the
disk based perspective right and of
course making sure that you are both
backing up your metadata and then also
using the relevant plugins like the
artifacts plugin to move those big
artifacts like ear files or builds of
Eclipse IDE in this case off on to some
other separate manage storage so your
build server isn't also your download
server for example could be a problem if
if you're a large site like this son I
thought I should talk about this manage
artifacts externally
there's again another best practice we
thought that everybody should follow
that so again the same issue came from
eclipse foundation one day I got an
email listening that suddenly the Hudson
is running very slow so I just did a
thread down and I saw that about like 93
or nine more than ninety three threads
are just serving data I mean it's file
serving to somebody so then I asked
somebody's and if anybody is downloading
a lot of data from that then somebody's
raise their hand and said yes I just say
curl and I started downloading lot of
works based data from the web page so
please don't use Hudson for as a file
server please keep it as a execution
thing if you want to download you you
keep your all your artifacts externally
so we understand one more slide which is
explain how you can do that we will talk
about it another yeah yeah okay so
security I mean this again is something
that the Jared raised in his comment you
know the stealth acquisition of CI
through someone just installing it you
then suddenly got this open window into
your source control system in your build
processes that is very convenient very
easy to use and if you like I think you
know in some way we are very much a
victim of these abusive of Hudson in
that it is so easy to get it up and
running but that is not a secure
environment so again in terms of looking
at how we can make Hudson more suitable
for enterprise development as well as
you know open source and work group
development this is an important aspect
right and we get into difficult
territory here because you know you you
don't want to raise barriers to people
to using it and quite often if the very
first thing they see when they install
something is right start providing me
with a key or with credentials before
I'll even boot up that can actually put
people off so it's kind of a delicate
balancing match and we'll have to just
talk around this in the community as to
what the effective approach will be but
it would be good to actually have the
things secure by default out of the box
because there's a lot of CI service just
sitting out there on the public internet
and when you think about what you can do
from Hudson well let's create a shell
script you know that's incredibly
dangerous and I know and you know any
kind of security review of an
organization that's that's using this
kind of tool if they haven't secured the
Hudson instance then they're be in real
trouble right yes I mean even if you're
not going to use your Hudson for
anything extraordinary it's still a good
idea to secure Hudson so I happen to
talk to one of the security guy who
taught me told me about some up to
security holes in Hudson so I asked him
so how did you find that is that it's so
easy just to just do a Google on on on
the Hudson CI server and certain URL you
get hundreds and hundreds of instances
we are just sitting without any security
so even if you are having your own
laptop and if it is not you sure that
nobody is going to use still keep it
secure because Hudson is it's open the
entire world to the people they can do
anything it's simple get scraped and
this also highlights the the fact we
made earlier about moving artifacts off
of of the Hudson CI server so even if
you are for example and we should
probably do this ourselves if you are
building artifacts for an open source
project where you absolutely want people
to have access to those artifacts
doesn't mean they had to access to the
build machine to do it right so move you
know you have your public-facing web
site with all the security and all of
the capabilities around that don't make
Hudson serve that process as well right
yeah on the point of security if you are
in a if you are a huge organization and
if you have a lot of teams using this
Hudson even though they have their own
hands and the best practice is to set up
your Hudson wait SSO so that's what we
are trying to do it in Oracle so this
gives much more secure because those
security what already set it up the
single sign-on and maybe much secure so
it's easy to set up Hudson on that
within your firewall yeah and then it's
also someone else's problem which is
even nicer
is the last thing you know someone were
running a work group Hudson server wants
to do is to worry about creating
credentials for everyone you just hook
up someone else looks after the sso
system or the ldap that's that's
actually great okay so I think we've
probably covered most of these again
just about you know thinking about how
the default environment is probably not
the best environment you know it's very
easy to be running either on Winstone or
jetty depending which version of Hudson
you're on but you know let's think about
actually where can I put this in terms
of a more robust and secure application
server what can I put in front of it as
I said maybe we'll move the artifacts
even on to a different machine so you
know that's as much about scalability
and management of the running Hudson as
anything else because if you move into a
more upscale app server like like glass
fish for example that least you can get
a little bit more management control
over what's happening inside that
instance yeah the front in your your
Hudson whether it is running as a
standalone or if it is running in an
another container like flash fish or
weblogic RJ bars it's always a better
better practice to have fronted with the
practice server either it is an Apache
or user ng what is it linked server for
proxying so as I said earlier so don't
use your Hudson instance as a artifact
download some keep it for downloads so
whenever a build is done there are
different plugins one is a copy artifact
plug-in RCP plug-in SCP plug-in you can
use this plug-in to copy your artifacts
into that proxy server that's for exam
Apache so if somebody wants to download
it they download it directly from the
Apache server not from the Hudson so
that makes your Hudson to run faster for
for execute faster because you don't
reserve any of its threads to show the
files for for the people who are
downloading the artifacts
ok so again that's this issue of
designing your environment as a
production environment as I mentioned
before there's this tendency for the
infrastructure of many Hudson users to
just kind of evolved gently you know
I've got a spare laptop that no one uses
any more because it's no good for
anything else but it runs the CI server
really well we've got a whole bunch of
machines in the lab that well we could
use those right and you end up with
these really heterogeneous mixed gridded
machines and it's good because you can
use those things and in many ways that's
you know one of the attractions that you
can make use of this obsolete hardware
but the downside there is that can
really lead to a lot of issues with or
conflicts if you like with some of the
other things we want to achieve such as
a good backup regime and an environment
that we can restore easily and quickly
and if you've got you know one of your
slaves running on solaris another one
running on red hair another one running
on Windows you've now got three
environments to manage if you need to
restore all of that as well as making
things like your script writing a little
bit more difficult and so on so if your
quotes designing an infrastructure the
way you need to look at it is obviously
first of all start simple you do not
need to buy a huge XE something box from
Oracle to run your Hudson builds on
right if you do you're doing good good
work but somehow don't think you need to
do that right we need much less
infrastructure so yes start simple but
start thinking about right as I expand
this up as I want to add more nodes more
executors into the overall process try
and do that in a consistent way you know
ideally if you could just stamp out a VM
image that provides that environment and
just provide more resources for it then
you'll get me in a great position
because your backup and restore policy
is right there almost so having a
consistent and simple approach to to
laying out the infrastructure is really
key right and don't try and overdo it
and certainly get rid of the old pizza
boxes under the desk so private plugin
site I want to talk about that so I
heard from several teams there
especially the build engineers who is
monitoring all this Hudson they came and
they told me that I have I'm maintaining
about five to six Hudson instances but
what happens is these people they just
to go and install any plugin and then
they break the whole thing and they are
coming back to me and this is a painful
problem for me how do I make them
touristic to install only the certain
plugins so that's why we came up the
idea about update site which you can
have exclusively you can set it up and
then the Hudson can talk to that Hudson
already has a way to do that but we try
to make it much more easier way so now
okay so we set up a new hudson site so
how do i maintain that inside is there
any UI for me to do that yes we came up
with an idea of call plug in central so
this is a I forgot can you shoot it
where we go to Hudson see a dark / plug
in central ok so this plug-in central is
a full flood jus I it gives you a good
way to monitor update your own Hudson
Hudson updates and roller from outside
of that so the the source code is
available you can just check it out and
do it you can install it on your own
plugins and plug in
333 turn it yep no am I missing a dash
we'll find out okay yeah on with the
show cuz they were getting short on time
because I talk too much was the way
their minds okay just a few other things
we've kind of talked about some of this
already particularly the disk space one
which we've seen so many times both
within the organization at Oracle where
we've got hundreds of Hudson instances
running but also externally it's a it's
probably the one of the most common
issues we see from folks using it there
and as I say just you know manage the
environment you know ensure you've got
identical jdk versions you're not going
to get weirdness happening when i
compile on one thing this is another
thing another build another slave I get
different results why is that well you
got different the MS so the whole thing
about maintaining consistent
environments it's kind of helping you to
help yourselves right yeah i mean that's
again another one important thing a lot
of times they say oh I both certain
things it is working on this slave but
it's not working on this layer then I
say that then after going through all
the things then I asked oh are using the
same JDK at both places then say oh no
here it is a jdk and there is some JDK
5.5 different version and unless you are
building your software for particular
I'm in particular JDK on different
slaves try to keep the JDK and ain't all
those things uniform at all the
different places it's hard to maintain
that manually that's why I think the
puppet and other infrastructure
maintenance teams are there so this is I
mean these are all very simple things
but this goes a long way yeah so on top
grades of winston talked about this at
length say it's it's a really dangerous
area because we make it too easy so you
really want to be thinking about the
upgrade process as a planned process now
you know from a code quality perspective
we've done a lot of work over
last few had some releases to make sure
everything is well qaid and it should
upgrade fine but that should is very
dependent on the tests that we've run
and the build jobs we're trying to
upgrade and as I said earlier you know
people do weird stuff they use weird
plugins or they use old versions for
plugins all sorts of things can go wrong
so let's let's just be you know sensible
about the whole upgrade process and
protect ourselves by using a sandbox
testing it out first and so on okay so
that's brilliant on timing because we're
just about there so I think they're the
key takeaways here you know we're not
talking about tremendously difficult
things to get real progress in you know
the effectiveness of your Hudson
infrastructure and the way that it works
is not a matter of writing better
plugins or being cooler in the way how
complex your jobs are the way your jobs
hang together it's all about just
treating the system like a grown-up
system it's a production infrastructure
that is probably critical to your
business or your project just think how
much it's going to cost you in either
grief late nights coffee whatever when
you have to rebuild that thing from
scratch and then think well actually am
I approachin isn't the right way plan
your upgrades manage the infrastructure
back it all up keep things simple and
you'll actually be going a long way
towards what we would call best practice
yeah so with just a few few thanks so
these are some of the folks who gave us
all to help with this presentation
either through direct input and ideas to
include and I do thank them all some of
them are here but also the Eclipse
Foundation themselves for letting us
poke into their stack traces and heaps
and the JDK platform team as well yeah
so with that we're just about that
waiting time whatever we talked today we
learn from our users of Hudson so if you
have any trouble just send me an email
where every day morning first I see the
emails and make sure to reply to all of
them then only I start my coding so
don't hesitate to send email i will
reply goodbye okay well thank you for
attending they could thank you for
waiting</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>