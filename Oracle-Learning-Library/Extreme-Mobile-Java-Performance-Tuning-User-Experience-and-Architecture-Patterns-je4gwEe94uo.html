<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Extreme Mobile Java Performance Tuning, User Experience, and Architecture Patterns | Coder Coacher - Coaching Coders</title><meta content="Extreme Mobile Java Performance Tuning, User Experience, and Architecture Patterns - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Extreme Mobile Java Performance Tuning, User Experience, and Architecture Patterns</b></h2><h5 class="post__date">2013-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/je4gwEe94uo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Paul Houghton and I came here
from Helsinki and I want to tell you a
little bit about performance now if
you're how many of you are mobile
developers mmm-hmm okay server a few
more okay good have any of you done
mobile java j2me or have you been
working with android yeah yeah the other
one they warned me not to walk talk too
much about it but I've got some demos
for you anyway um but what this is
really just about my favorite topic in
the whole world because I like to make
things go fast and really want to talk
to you about some of the things I've
been doing in the ways I do it all this
source code is available so you get
links to it I'm not going to go too deep
into the source code but just try to get
you the flavor of how to think about
approaching it and how it's different
from the server side stuff you might
have been looking at in the past so
let's dive in ah there's not much of an
agenda basically going to punch down
every myth that I know this out there
about mobile performance one by one
because I assume that your developers if
you came to an advanced session like
this and let's just talk about the furry
edge where there's some misconceptions
and misunderstandings about it so I've
literally taught in places like this in
northern Finland and also I privilege to
travel around the world this is Lagos
Nigeria where I'll be going in a couple
of weeks again um there are some very
skilled developers around the world and
mobile java for them may not be the same
as the purely Android view that you have
here so I want to give you a little bit
of perspective on that and why this
matters so even if someone is using a
phone such as this one this is the asha
311 costs about a hundred and twenty
dollars
and it has very similar performance to
an Android device so it's competing with
the low end android devices from China
and it's already pretty much crushed
blackberry in many cases very nice
phones but there's one main thing there
is not a lot of RAM so you need to
design differently you need to think
differently to build your apps to go
crazy fast in a phone that has a great
processor 1 gigahertz processor and not
a lot of memory but nobody wants slow
phones so the reason we're concerned
about performance isn't just because we
love to make things go fast but nobody
will wait the whole user experience with
mobile is a bit different from web apps
you pull that out of your pocket you hit
a button you expect it to come up right
away you do one thing and you get out so
you might be done in 15 seconds you're
not waiting around for page loads and
whined and whined and let's go out and
get the CSS from here and fiddle with
that so it's a very different use case
and they're different patterns that we
want to talk about for how that's done
so the model that's between my ears is
if i'm not totally maxing out every chip
on the phone I'm not doing my job right
so when I see something lazy like this
or I install an app and it's running I
expect it to be maxing out all the
course not just all the course but all
the memory all the network bandwidth
because the faster I can get things done
the faster the phone can shuttle back
into low power mode so the faster you go
the less battery you use you have the
same amount of work to get done if you
can get it done quickly it's good for
everybody um the phones are typically
like this you may not be familiar with
them but we're dealing with 5-point
capacitive multi-touch accelerometers
all the goodies you're used to just in a
budget package
I have to laugh when I look at like the
keynote did you guys go to the keynote
on Sunday and they're talking about how
they're going to get everything down to
10 megabytes you know how much RAM is in
this phone 2 megabytes everything I show
you today runs really nicely here and
fast as fast as an android phone with
128 Meg's and it's about architecture so
when Microsoft is bragging that they
have an app that's doing nothing and it
only uses 10 megabytes of memory I'm
like okay there's a whole different
world um but let's look at one of the
apps this is just a video I shot bang
you're up you've got your data we've got
some special effects squeezing out the
pictures as they come in and we can go
through and now we're on the net so this
the key to the way that worked is
everything is in the cache so really
cash centric cash heavy because just
like in this room where you have lousy
network that has maybe a few kilobytes
of data that's the real world that
people are dealing with out there and
you have to design your app for the
worst case not for the best case
scenario when they have 4g on a sunny
day and they're not moving and they have
lots of battery power so let's go
through and bust some myths just go
through them one by one and please stop
me if you want to I have a lot of
material I could talk for days on this
but we've got one hour so if you want to
go into more depth on something stop and
then we'll focus on the things that are
most interesting um android is the
biggest market opportunity for mobile
java true or false well yes and no 675
million phones in active use like this
one that's the size of Android and
iPhone put together on a worldwide basis
but it doesn't show up anywhere in them
in the
bex they try hard to classify this is
not a smartphone so that don't look
small compared to that it is a very
different environment it's used in
different places especially look at this
thirteen percent of people in the
richest countries have phones like this
so for me in Finland it's a drinking
phone it's so i can find myself face
down in the snow and i have something
that's definitely going to work and it's
still going to have battery power and
when i'm talking to people in places
like Indonesia half of the people there
have nokia phones and it's not that they
don't have choices and it's not that
they don't know any better it's that
this is a really good device for their
needs and now it runs apps really well
also so a large reason that I go out
training is so that we get local
developers in each country to make the
content that the local people want to
consume and there are a lot of downloads
a lot of numbers there cross-platform is
a really interesting thing that comes up
frequently how do you make one app
that's going to run everywhere okay
maybe you believe me is all right Paul
how do I actually make an app that's
going to run on both I'll show you and
I'll give you some source code arm
there's several approaches I'll show you
how I go about it and whether or not you
do it that way you'll hopefully learn
something and be the better for it the
first approach people use is a library
for the UI so they sail all right let's
do a soft you I like swing put it on top
of Java but it never feels quite right
my company has 150 people in Northern
Europe most of them are developers the
customers never want this because the
customers are companies like Vodafone or
nokia or rim blackberry
or their big brand customers very often
who want it to be sharp and they want it
to be really nice and they want it to
feel native on the phone so we've
actually adapted Luet so that it looks
and feels like native so that's a very
nice choice when you're dealing with the
higher end phones but there are phones I
don't have any here that go down to
about thirty-five dollars that will run
these apps but you don't want to
necessarily use Luet there so there are
other choices um but you have to think
why do I want to abstract miui I think
and I'm may be the only person in the
world but I think you should abstract
your back-end and do the boring stuff
once and make the UI good so if I have
to communicate with some company's
server to get music to provide voting
information all of the Facebook hey that
never came up before well I don't want
to do that over and over again so i
wrote a library that does that and it
also works on android so you can choose
to do the back end once and then you can
choose whatever you are you want it's
not a UI library it's just tools and
that's what I talked about engine
abstraction you don't have to use my
library but hopefully you can think
about that approach because Java does
run everywhere even on weird cousin
foams like C sharp that's basically Java
right C sharp branched off from Java and
they didn't pay any licenses either so
we've got at least two successful
spin-off and that's good flattery Java
is alive and well and kicking um
concurrency is is one of my pet things
the way I can get things to go fast is
by making the phone do many things at
the same time all of these phones are
single core so concurrency doesn't mean
I have to have a four core tegra
device actually some of the two core
devices outperform the four core devices
it depends there are many factors of how
a phone performs and people think okay
should i be using javac on current data
structures that are going to allow my
hash table to have 16 simultaneous
accesses if they happen to spread out
sure but this is a little built for
server guys so most of the stuff you
find about concurrency doesn't really
apply to how are you going to do it in
the phone world this is a nice book I
look forward to reading it but when I'm
doing stuff on the phone half of it is
wrong because they're not thinking about
working in a really small environment
and the fact that I don't actually care
that much about synchronization and
thread collisions when I only have four
or five threads anyway it's just a whole
different set of problems and a whole
different set of solutions and the best
way is to look at some examples and and
think about that um you can have
functional concurrency which is a nice
data structure that automatically gives
you some parallelism microsoft offers
that same sort of thing in Windows 8
they try to make it automagic for you
you can have an algorithm which is
inherently parallel one of my favorite
tricks is to request everything from the
web simultaneously so I'll just queue up
30 40 HTTP requests and I have four
workers and I'll pull the data as fast
as I can and start shoveling more and
put that back on the net and let it work
itself out so there's no static
organizational structure there's just a
single queue of stuff that needs to be
done and I'm not queuing up events on
queuing up code so this is like lambdas
I put a little snippet of code on the
queue and that's what's going to execute
almost all of my code
is something usually an anonymous inner
class that I throw on to the queue and
say do this do that and then I include a
strict separation between things that
are done on a worker and things that are
done on the UI thread that's one of the
most complex and most difficult and
least documented parts of this process
because their parts of every UI which
magically have to be done on this thread
or that thread and they don't tell you
until it breaks usually when you're
giving a log demo so if you pay
attention to what should be where and
everything that doesn't have to be on
the UI should be on the background and
just I'm trying to make it easy for you
to shove the data back and forth between
those two for example in Android they
have something called async task have
any of you guys use that it's nice if
you use that you understand what this is
about I have a full implementation of
async task you can use it exactly like
you're used to or there's some
simplified in slightly different
patterns based on that so async task is
the top of the hierarchy then there's a
task then there's just a workable which
does something in the background and
doesn't even come back but everything
has side effects so usually it's getting
something from the net setting a
variable storing something so this is
the sort of stuff that goes on in my
head when I'm designing an app to make
it go crazy fast I usually have four
workers you can have a few more if you
have several cores to deal with but this
is what I do on a single core 1
gigahertz phone or less there is no big
benefit we're going with more there's a
slight cost but you could have a hard
time measuring it there is a slight cost
of going with less so that seems to be
the magic number and I've got the one UI
thread all the UI's I've seen lately
I'll have one thread they said in the
keynote that they had played around and
if you have a separate thread for the
rendering you can double the speed
because
concord see i fully agree it's great go
for it if it makes sense you can do that
as a separate dedicated thread or you
can do that as pieces of code on the
worker but the key is you do this is
each of those pieces of code executing
on a worker doesn't last that long
because what you don't want is for the
queue to grow too much on the other key
that I'm always thinking about is when I
put something in I can put it in this
high medium or low priority on to the
queue if it's high priority i just put
it on the bottom of the queue and it's
the next thing that's going to be done
for example if it's a UI element I have
an image that I need to display I need
to go out and get it or need to load it
out of flash memory I'm going to make
that a high priority item if the user
does something else before that result
comes back something else may bump it up
by default i put things in is normal
priority and i use low priority pretty
much only for prefetching i'll fire it
up load up things on my first paint and
then I'll start prefetching and I never
use more than one thread for that it's
automatic if you just put things in
library and I'll just get the data as it
comes but with a single core keep in
mind that your CPU can do something and
if it runs out of work it will switch if
it's getting doing a heavy memory access
it might even switch all of those are
optimized and taken care of for you so
you don't need to worry about it just
hit it as hard as you can as many ways
as you can and let it sort it out um the
problem I've had teaching this is it
looks complicated right I started doing
this because I had some students in
South Africa who said all right you're
running your mouth how are you actually
going to do that what does it look like
show us a good example and then I stayed
up to a4 a.m. and that was tantalum one
and I've been evolving it for
a year and a half two years since then
so tantalum for is in the repository you
can see that but I'm not fully happy to
punch it out as a zip file yet but
you're welcome to join me if you like
this it is fully open source of patchy
too and I was figuring how can I make
this easier because it is a little bit
complicated you've got all these little
bits of code flying around how do you
keep it straight so I looked how how do
this everybody else do it and it turns
out async task is nice that's one of the
most popular so I copied it java 7 has a
fork join framework that's for all this
boring server stuff and it's actually
not even for that it's for academic
research but it's got some nice ideas
there are other fork joined frameworks
that might be more productive for server
work so i put fork and join in there i
used to cue things now I fork them it's
the same thing joining was a little more
challenging because I have to have state
and then figure out where something is
in the execution cycle but that's also
working nicely so with a join you
essentially say I would like that result
but I'm not willing to wait more than
say 200 milliseconds for it and you can
set that time out if the result comes
within that time or if it's already
available you get it right away
otherwise you can continue yes
arm it's just synchronization and the
lockin states so java.util concurrent is
probably faster if and when that ever
hits the phones it'll be great and I
look forward to using it at lambda
expressions with I think it's coming in
Java 8 but it's not there now so I've
got a few years ahead it's a nice time
to start designing and playing around
and working with that and then we'll
adapt when those tools come but um it
doesn't have vm support for this so
everything that I've done I write in
Java too and then I pull it over to Java
five and then I'm going to add Java 7
yeah so I start with the small guys
because it's easy to take it over and it
works really well C sharp has slightly
different things they're trying to make
it sort of automatic in the vm how to do
things in parallel for you I'm a bit
skeptic but keep my eyes open and test
it out when it stabilizes arm and then
we tried to combine some of those best
things into one place so there is a
project it's not all my code but I am
the biggest contributor and you're
welcome if you're interested in this
type of thing because it's a nice way to
reach a lot of people if you haven't
done mobile proguard easier best friend
and this is a tool you need to
understand because when I put out a
library I have things in there like JSON
that you might not be using it doesn't
matter proguard will strip it out if you
don't use it so it makes your jar file
smaller makes the whole thing run faster
it makes a significant difference and it
can also help you on server side
although it's less popular there it can
make your debugging a little bit more
complex if you're looking at long stack
traces um
recursive algorithms is one other thing
that is nice for mathematicians and
computer science classes don't go there
on mobile because you have limited
amount of stack memory and there is
always a non recursive solution and
usually it works out better for you so
there's just in general be cautious
about which algorithms you choose be
very aware of large things that you
allocate and how soon do you d allocate
them um I've got links in the slides and
I can provide you references what we've
gone through and we've done a lot of
testing on the phones to see which
patterns work and which ones don't work
we'll have a few of those at the end but
it's an interesting read if you like
high performance stuff because some of
the results are surprising um all you
guys are single threaded so is
multi-threading difficult well it is
necessary if you want to use the
techniques that make the phone go really
fast you can see and smell the
difference it's worth doing here's a
little bit of code um for reading
something from flash memory so I create
a new I don't know if I have a pointer
here but at the top we create a new
workable workable is just an interface
that has one method execute and it
executes on a worker thread always just
for simplicity and it goes out and it
does the synchronous reading data from
flash memory and then based on the
result it gets it's either going to call
one of two methods on a call back most
of which is off-screen here so workable
doesn't have any callback structure
inherent in it but one level above that
a task is an object implementing
workable that takes care of those for
you if that's what you want slightly
less efficient usually you won't smell
or care the difference it's useful if
you're returning a result
arm not crazy hard code it will get even
more pretty when we have lambda
expressions in the language and down at
the bottom we for kit which means we
push it on the queue as item 0 so that
it's going to be the next one to be done
since its high priority um here's an
example of a demo application called
Picasso viewer and I obsess on start
time I set obsess on what happens when I
hit the icon how soon is it going to
come up what am I going to see on that
first screen is it dynamic let's see
there's the app click the icon we're in
pretty nice and we have the same app on
this phone you can play with it it runs
on some of the low end phones are which
don't have a full screen touch they have
they call it touch in type you have a
qwerty keyboard and touch on the same
device if you ask a lot of questions you
can take one home arm and we have lots
of other goodies d this is an example
that has qwerty keyboard so it's it's
pretty nice what is going on there is
I'm actually doing a live local search
out of the cash so if I've done a search
previously when I type in CA T or C AR
as I'm typing the result comes the ripe
right away with all the pictures so you
can run the whole app offline and you
can test that these foams these apps are
inherently online offline and that's
extremely important if you have spotty
network infrastructure or if data costs
too much to be practical so really
trying to take care of the budget when
you're putting apps in people's hands so
I don't want them to give more money to
the operator then
they have to I used to work in an
operator they are eagle I was a business
analyst of all things yeah yeah got rid
of that multithreading it can slow you
down but most of those cases are
theoretical so if you are using
synchronization the classic way just
don't stay in a synchronized block that
long and you'll be fine because you
don't have that many threads think about
it common sense but don't be scared of
it it's not a big deal and all the
performance patterns I'm talking about
the absolutely required you can get your
app to be four five times faster than
the serial version doing this because
the phone really has multiple chips it
really can read from flash memory at the
same time that it's doing networking at
the same time it's processing at the
same time it's doing memory operations
and bluetooth so you can jam it you can
have several HTTP connections life and
it's worth doing because there's a
there's a start and an end time and if
you stack all those up you just it's
like a pile of cards coming in in Tetris
they just fall where they may um but
we're not at all interested in scaling
this is the opposite of these scaling
talks you have on the server side right
I'm just here to burn as much power as
quickly as I can and get it done it's
all burst mode so anything you can do to
trick the eye to give the perception of
responsiveness one of my favorite tricks
is I hit the button and I start sliding
the screen in I don't even have anything
to put on the screen but it's sliding so
by the time it slides in I'll have
something to put on the screen meanwhile
it looks crazy fast so you can trick the
eye it's like being an illusionist to
design a nice UI and synchronization
everybody thinks all synchronization is
slow well look at the hardware specs for
an ARM processor it's got at least a six
stage pipeline in there
it does the synchronization in one stage
while it's doing something else while
it's chilling a sandwich so it really is
basically free forget about it don't use
it if you don't have to but don't worry
it doesn't cost anything weak reference
have any of you guys use this class it's
in standard Java very good yeah it's
twisted so let's say each of you guys is
an image inside my phone right and i'm
just going to like throw you all into
the phone and if the phone needs some
space it's going to flush a few of you
out of memory and i won't know till i
request so weak reference is just an
object that has one pointer and that one
pointer is a soft pointer its weak so
I'm telling the computer that if there
aren't any normal pointers to that
object then you can trash this thing if
you want to so yeah so I don't throw
anything away I just put it all in a
weak reference Hashcash and it's all
automatic in there's examples in there
you can just pull the one method out if
that's what you want but it's brilliant
you just throw everything into a hash
table and it grows as much as you want
to and if you pull back and you get a
null then you get it out of flash memory
if there's nothing in flash memory to
get it off the net all automated for you
you can do that any way you like on any
platform you like you could make servers
like this if you want to but it's a bit
of work so people don't and they're
really losing a huge opportunity because
I have the exact same app running on a
phone with two Meg's and with 128 Meg's
and it's comparable this one is faster
yeah it's one point two gigahertz
dual-core and it has all the memory and
stuff but you won't really notice a
difference you can see it in the video
you can try it for yourself um yeah so
if every time you see pictures on the
screen I'm only referencing those with a
weak reference and if I try to paint and
I don't have it I'll do I'll fork off a
get and they'll pull it out a flash
memory fraction of a second later and
put that on the screen yeah so where
that was a cold boot there was nothing
in memory everything came from flash
bang in parallel because i want to start
reading and then I want to start
decoding image remember the images of
byte array I want the image to turn into
something else so I'm reading and then
decoding but meanwhile I've released the
lock so the next thread can start
reading and decoding in the next one can
start reading and decoding that's why I
just cue everything up and let it sort
it out it's crazy fast you can tell when
it's coming off the net because it's a
lot slower this is in one of these
horrible javaone networks so there's no
network performance to speak of as you
know everybody thinks they need more
memory well go with weak reference it's
a very simple class but it's easier to
like look at an example that uses it
another good example is a lightweight
user interface toolkit or Luet they used
that for images and I use it properly
you can use it in other ways if you have
procedural graphics if I need to paint
up an image so that i can scroll it
quickly just use them with weak
references don't fool them throw them
away well you you can pull them in some
cases depending how heavy they are so
there's a there's a cut over point if
it's a really big image and really
expensive to rebuild then you should
pool it to reduce your garbage
collection thrash but in general just
throw it away if it's not there the one
trick with these that took me a while to
figure out is I started scrolling and
then stuff was like blinking on and off
it was disappearing because they were
garbage collecting you have no control
over what's going to be collected so I
came up with a trick I just create a
normal reference to the things I really
want to keep on screen but I still get
everything from the weak reference
Hashcash it keeps my code really simple
but if I want to make sure something's
going to stick around let's say I'm
scanning through several images I'll
preload the image on the left the image
on the right and keep a normal reference
to those and that takes care of it those
items are going to be stuck in memory it
reduces that blinking effective weak
reference is the only reference you have
um well you've all got 4g networks right
yeah as long as there's one weak
reference to that object it won't be
garbage collected so if I want to make
sure something stays around because it's
on screen maybe I just make a pointer to
it and then I know what's there but I
don't have to change my code flow it's
just sort of to the compiler it looks
like I'm doing this for no reason yeah
or when the object that owns it it dies
it then it's gone and then it will stick
around and if I come back very quickly
it's all still there it doesn't even
have to go to flash saves power saves
time ah mobile internet you've all got
4g 10g phones whatever right you don't
need this stuff I just go and get
everything off the net try it right now
yeah the net sucks it's only available
to some people sometimes so for design
purposes if you're building a mobile
service it's almost useless it's a
best-case scenario yeah you can get 4G
and it's even faster than the Wi-Fi in
your house
if you have enough money but you can
only do that every now and then so are
when you design the service you want to
design it for plain old low bandwidth
stuff because that's what people are
going to have to work in that's why I'm
in love with caching caching is the boss
for making your apps go well and servers
like you know they all bogged down and
break and you can't log into oracle when
you're trying to find out where your
session is going to be right people
think here's another myth I have to
design a different app for every phone
know if you think about it you can make
the appt work with keyboard non keyboard
I just have Angry Birds because I happen
to have the picture laying around but
it's a good example they took the box to
D open source library did it in C put it
on every phone when they needed to put
it on Windows Phone they ported it to
Windows Phone I know the guy who did it
he's brilliant when they ported it to
j2me I'm not sure who did that but it
plays very much like it does on and
high-end Android phone on a small phone
with not much memory takes a bit more
work but it's fun I mean why do the easy
things adaptive design this is a web
thing and all the web guys think they're
so cool because they have a language
that has no structure at all but you can
use the best of their world which is
they already have lambda expressions and
things we would love to have in Java and
C sharp so you can throw around pieces
of code like objects which is really fun
but they have a new framework every week
because they're all trying to figure out
what to do with all that power adaptive
design is one of the best things they
have going so ideas you make one app and
then rather than hard coding it for 137
different screen sizes and all of that
and doing
that on the server that's like
responsive design adaptive design it's
in the distant logic inside the phone
itself and it figures it out says okay
the screen is this wide let's
manufacturer graphic and stamp the logo
on left side this type of logic is not
particularly hard on and if you have an
app like on the BBC reader if I have it
vertically I've got I guess three rows
of icons and if it's horizonte it's
something like five so as you rotate it
just changes it around that's adaptive
design just common sense stuff how you
lace things out on the screen and one
piece of code can do that it's can be
ugly if statements if you do it wrong
but think about it it's a nice little
design challenge but try to enhance when
you have a feature for example this
phone has a bar at the bottom covered
with icons which this phone doesn't so I
enhance the application by adding that
navigation bar and some of the other
features to this app and then on this
phone I just put normal soft keys that's
the fall back a little bit of if
statement and it it goes quite easily
arm there's a picture showing responsive
design is going through some mediator
like a server where as adaptive you just
take care of it yourself based on the
device you're in a nice thing is you can
run well in devices you've never even
seen before they might not have been
released so your code lasts longer if
you plan around this when you're dealing
with large screens and tablets yes you
do need to spend more time on the design
on the graphics you may need a separate
graphics set you may need also that for
localization you might want gaudy colors
in some countries um it's up to
up to those but those are easy additions
osgi what's that
okay yes yes nice um I've done that I
didn't call it osgi but yes you can
download it and there's some advantages
the bigger there's a cousin of this
phone which has relatively slow flash
memory and so when the jar file is
really large if everything is in there
it starts to grind and it affects the
launch time so I'd rather have a small
jar file and pull it in from the server
and store it you can also use in-app
purchase or you can actually bury the
stuff in and crypto it on the device so
you've got in app purchase with operator
billing and all of that on the Nokia
phones the only thing that you're
missing is push but you have pushed
because you have SMS you can send push
directly peer-to-peer and wake up a nap
at any time so let's look at it running
on a slightly different device notice
we've got soft keys instead still fast
response I'm not too happy with that
little flash that appears on the screen
but there's some differences with the
virtual keyboard because I want to have
the search field active immediately and
all the time and I don't pop up a
virtual keyboard when I'm doing that
here I click search it's grinding on the
network to go and get pictures of cats
from picasa web service and eventually
because it comes back with some images
there are a lot of people on the network
at that point
um but I can hit the Delete key and
start typing in something else do
another search for pictures of dogs and
again I'm grinding I had an empty phone
so I'm loading up the cash and each time
those things come is in I'm storing it
in the flash memory at the same time I'm
putting it on the screen so it may not
be flash cached by the time it shows up
in the screen but the coherence is good
I can go over to the featured images
like that so cross platform design I use
a j2me first approach so I start with
the smallest fault make it run and then
it's easily going to run on a big phone
right it's just going to be a little bit
faster it works very nicely you do have
to give up some of your nice toys that's
the gap I'm trying to make up at the
library some of the toys are even nicer
than the ones you might be used to
related to parsing and such perhaps but
it's not your favorite set so I
understand not everybody will like it
though with the small phones if you need
to do something like storage I have a
little abstraction layer where I replace
one type of flash memory access with
another very simple stuff so anything
that you want to put into your app like
this arm you can but then the boring
crypto and other things only has to be
done and maintained once and then that
same jar file can pull be pulled into
Android it can be pulled into desktop
Java or server Java I once made an
application that had the same exact
database on the server and the client I
tuned it a little bit differently but I
couldn't find one out there so I made my
own it worked very nicely I never lost
data completely online offline stuff but
the difference i have from the main line
view is this sort of nativist if I'm on
an Android device I want it to look like
an Android app if I'm on a nokia device
I wanna talk nokia etc
so um the codename one guys are not here
I think that they have a nice approach
that they try to make it look native and
they're doing a pretty good job I
haven't investigated enough to to know
in depth with Luet if you go to Nokia's
website and get their packaging it's
been pimped up and sped up and runs
nicely and it will look and feel pretty
close to a native app but you gain nicer
transition effects um but there's Ram
caching with weak reference is an
important part of how you can make it
run and take full advantage of the big
phones at the same time so here's the
Android device dual-core this is an EVO
3d and the network still sucks and it
has to pull in some images from the net
down at the bottom of the screen there
but the next time we come in that's all
going to be ready so I can click over to
the search I didn't implement a live
search as you type on this version but
now it's searching for pictures of cars
and pulls them in there are three
classes to make this whole app run on
Android versus what we have brought over
from our j2me app three classes mostly
just for laying out a grid of images
everything else is the same and suddenly
you have three times the potential
number of users that you had before now
they're in different countries that may
not have as much money they may have
different user needs you have to decide
but I would rather make my apps with
nice tools the ones that I'm familiar
with arm for both it's kind of a why not
we get some more pictures and just like
on the j2me it's storing the data in an
SQL database in this case on the phone
so another myth I have a designer I
should just trust everything he tells me
because he's cool anywheres thick-rimmed
glasses right don't be a moron the
designers have a specific worldview and
it doesn't involve motion and speed as
much as the way your head works as a
developer so they look at screens they
can make things really pretty they can
come up with kind of cool concepts and
they can come up with a nice flow
between the screens and then you need to
push back so make it a hands held
approach in our company we have I don't
know a hundred and some desert
developers and probably 15 designers and
the reason we started hiring and making
our own designs is because we were
working with companies like Disney which
would bring in some marketing agency
that has never done mobile and they come
up with some really stupid idea and we
have to clean it all up and then you
spend all your days in meetings and it's
a mess and then they they throw another
mickey mouse over the table to you and
you're like ah ha ok I'm not singling
out Disney I mean this happens over and
over again name any major brand and
they've got a marketing agency that sold
them on something that may or may not be
a good idea sometimes they're brilliant
their ideas I would have never thought
of I won't name any of the ones that
failed customers that didn't pay
but from the UX world the three numbers
you need to keep in mind is 100
milliseconds makes it feel like it's
instantaneous you can get it done in
that time people are happy one second it
is more than that it breaks their flow
of thought they're going to notice that
it's more than 100 milliseconds but you
get to a thousand milliseconds you're at
the limit then they're going to start
thinking about something else like you
know how to scratch the doors on your
car ten seconds they're gone they're
somewhere else so that's the time limit
that we're dealing in and you don't have
time to go out on a broken network to
respond to that always so get the data
beforehand prefetch it just run it sort
of hybrid online offline if you can not
every app works that way um here's an
example where you need to add value to
the user experience as a developer so
what's wrong with this startup
experience flash flash flash alright
here's another example because of you
were with a little extra flash in there
show it again maybe
see if I can break the computer okay
some extra flashing it's not a very
clean experience here's your first
experience with the picasa viewer it
goes through like three different states
before it settles down quickly but not
so pleasant so there's the code we load
of feed in this case it's JSON data in
the BBC it's XML data and we're saying
get it from anywhere either from local
or from the network we don't care we're
not going to force a network yet and
then we're going to change the view and
the data is not all there yet so it
starts saying a little widening circle
and then the data comes in a second
later from the cash so how can we get
rid of that we can add just the word
join and the result looks like this
that's the wrong video it looks better
than that but by having the word join
there at the end I'm saying do this and
stop this thread for up to two hundred
milliseconds for the result but not more
than that so if I'm going out to the
network I'm not really going to notice
I'm close to that 100 millisecond
barrier if I'm getting it locally I'm
never going to see a blank screen it's
just going to pop right up as a very
smooth experience I might have had those
videos in the wrong order I don't know
some things about performance um there
are a lot of things that call Micro
optimizations or I call the mega
optimizations because I'm obsessed with
these tiny little details should have
been an accountant definitely not the
word final should be used everywhere
first thing I do when I'm going to like
sport-tuned somebody's code because I
just add the word final to every class
and every method that I can if it lights
up red I delete it takes you a couple of
hours your app is twice as fast it's
worth doing doesn't hurt anything it
actually makes your code a bit better
because you're marked this variable is
not going to change I do it on the
parameters I pass into a method it helps
me understand what's going on as I'm
reading the code so it's very nice um
there are some things that are different
in the optimization on servers and
clients and a good JVM may be able to
automatically munch some of this in with
a jit and there are more aggressive jets
and other things on server environments
so I don't know exactly how much
difference it makes there but on all the
mobile platforms it makes a big
difference it is the number one thing um
static you would think a static variable
is faster than an instance variable but
it's backwards for some reason the frame
of reference in memory or something I
haven't figured out but we did the tests
and it's actually twenty percent slower
to use a static than an instance
variable we use the slowest phone we
could find of recent ones addition and
multiplication are you'd think
multiplying is slower right it's more
complicated but it turns out that they
put a lot more silicon in there for
multiplying than they did for addition
and definitely not for division now this
varies by processor and device so some
of these differences are this is from a
nokia device it might be a bit different
if you're dealing with a intel or an arm
device with android different virtual
machines and such but let's look at the
performance arm use the micro
optimizations as a habit that's why I
differ again with like sort of the
standard like you shouldn't optimize
early like I can use the word final it's
good good design
little things like that matter it turns
out that the bytecode obfuscator or the
JIT or both is going to take care of all
the bit fiddly manipulations for you or
most of them so you don't need to work
with bit shifts instead of multiply and
divide unless you like that sort of
thing I can show you some really ugly
code afterwards if you're curious um but
lambda expressions are basically a piece
of code that you passes an argument and
then it gets executed somewhere else
that's what JavaScript does all the time
that's what's coming to Java and that's
what we're doing when we extend workable
to make an anonymous inner class it's
the same thing just more tightening and
fortunately your IDE does most of the
typing for you so it's not that bad it's
a really nice style to learn because
that's essential to passing bits of code
around from one thread to another you
can do it other ways but it's a lot more
typing um focus on the visuals focus on
the acknowledgement time that burst
speed the perception of performance you
can trick the eye you can start painting
things before you have all the data
you'll have the rest of it soon but
entertain people make it fun because
everybody in the world not just in
America has choices as what they're
going to do which apt are going to use
so your should be fun it's a privilege
for someone to build to be using your
application so fight for them and the
more speed you have in your app the more
spare bandwidth you have to do fun
things little extras
I once built a museum demo where you
walked into a room and you hit a button
and it would all shake like a earthquake
I had one channel left so i made the
lights flash that's nobody cared about
the earthquake they just like the
flashing lights people are like cats um
and do the back end only once because
it's boring focus on the fun things back
end meaning back end of your application
inside the phone the thing that
communicates with the server and if you
can make that piece of code the same on
the server and the client all the better
then you have time for race tuning and
candy so thank you and a little plug for
our company we were voted the best place
to work in all of Europe
and then use a logline and my logging
tools show you the current time so I'm
always measuring the time and I can see
how many milliseconds since the app
started I find it those practical ways
so everything is a benchmark every time
i get an error message i can kind of see
and smell the difference as i tune
things up and let's start handing out
some goodies good question next yeah arm
I had some let me back it up a little
bit here you're fine see
this is a if you go to developer nokia
calm and just search for adaptive design
you'll find this this is something on
how to make one application that runs on
a variety of different form foam foam
factors and those techniques in this
case it's written with the nokia bias
but a lot of those techniques are useful
for other platforms the project that has
all of this code is project's developer
nokia com / tantalum with a capital T
tantalum is a light lightweight metal
they use in electronics yeah i think the
the slides they've collected and
hopefully they'll have it it was not
easy to find last year so you might yeah
and there was another you are i think
it's actually close to the end here
there's another URL they asked me to
write a brief thing about performance
and i came back with half a book and
that's on the website you can read it's
broken up into a few pages but this
slideset is 1.2 gigabytes so tends to
hurt the computer
um I've got some cards i can i can mail
you the links if you like that might be
the fastest way yeah
yeah i'll put my email address up drop
me a line
and I can send you a PDF of these also
without the video or posted somewhere
have to be careful because Rijos here
and I the best profiler is actually
Oracle's the one from Nokia like it
doesn't give very good profiling data
and rehook came in from India and that's
her team who does that so I don't want
to say say everything but the the data
on your total amount of memory and such
is available and what I do is I create a
separate I'm using netbeans so i'll
create a separate build fire it up in
Oracle's emulator and then I get a full
breakdown of which objects are using
what the only thing I'm missing are the
proprietary Nokia bits but it is worth
it if you want to get deep into the
profiling and sometimes dealing a small
amount of memory you definitely do that
because it's um it's sometimes necessary
I had one case making a facebook client
for series 40 and we had to go through
and combined five objects into one
object just to save memory because
somebody in our company had like six
hundred friends and they kept breaking
it it was a good test case you want
large
if you mention riding back in once
Taylor a near-riot specifically I made
put your strategy for dealing with
different platforms
I actually build it first for j2me and
then I just replace aw in this case
there's only one class I call it
platform utils and it has the same
signature and then when I'm building it
for Android um that one class gets
overridden and replaced with the Android
version there were only about eight or
ten methods you need it had to do with
networking get in post and reading and
writing flash there really wasn't much
else needed everything else runs out of
the box by design would you like a shirt</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>