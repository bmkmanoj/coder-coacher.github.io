<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing Multitenant Applications with HK2 and EclipseLink | Coder Coacher - Coaching Coders</title><meta content="Developing Multitenant Applications with HK2 and EclipseLink - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing Multitenant Applications with HK2 and EclipseLink</b></h2><h5 class="post__date">2013-01-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QBi-Tj_a_Ew" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so this is a bob so it you know it would
be nice to have interactive discussion
that's what we are planning there are
some slides you can watch and enjoy but
I guess one of the aims that we have is
that we have more interactive discussion
where we talk about multi-currency your
experiences or what are you expecting
out of it so it might help if we compact
but you know if you don't want to move
that's also okay I understand we don't
but anyway anyway it will be easy to
discuss since not such many people so
we're gonna talk about development
multi-talent applications but this is
not a full-stack approach but we have
some ideas with hk2 and eclipse ink and
we want to show them to you and discuss
it later so this is legal slide and our
plan is to introduce ourselves and the
topic better to position it in the world
of cloud computing the narrow down it to
subject of multi-tenancy we are looking
at and make you familiar with hk2 which
is actually dependency injection
framework then show what support is an
eclipse link which is GPA implementation
for so what is support for multi-tenancy
is there and use it how can we use it
and finally have discussion so it's just
a lightning talk we have some ideas but
we want you to come with more ideas
suggestions and share your experience
your expectations of how multi-talent
applications you would like to develop
so about us few words
I'm Andrey I live in Prague I like beer
there very much is cheap at cheaper than
water
Natasha's based here it's a close to
here in Santa Clara yeah beer is
expensive here you know weather is nice
so we're both both fish developers and
have whole life experience in Hawaii the
development and develop enterprise
applications mmm
beside it we are both fathers of I just
three months ago small daughter so me th
has more experience you need to so let's
quickly try to narrow down a huge topic
of cloud computing to what we are
looking at I'd like to start with first
level infrastructure as a service and
highlight its physical isolation of
tenants so like I think it's very simple
and that's very effective as example
Amazon elasticity cloud computing having
isolated tenants in physical machines or
virtual machines based on it there are a
lot of cloud platforms already available
some of you maybe have been to the
session about making sense of past
platforms so I just list a few of them
what joins them what what what is
similar among them that they allow you
to develop your web application normally
and just deploy to the cloud and let it
be scaled in physically isolated
machines the difference maybe is Hiroko
that uses git commit instead of deploy
bar but somewhat different approach have
such multi tenant plot such cloud
platforms like Salesforce I know it's
also it has also Sarah but it has beside
it it has platform for development
software as a service partner for
developing software and W so to also not
very famous the difference is that
you need to develop your application
specially designed for these platforms
so inside the online interface on
Salesforce using epics code oh it must
be carbon application for W so - and
they this application is executed in
shared container in container shared
between tenants so it's not it doesn't
use physical isolation of terms but
running heaven applications together but
in both these cases you have like your
developer have a copy of your
application being executed in this or
another cloud platform so it's all of
them are great but we would like to look
at this point this software is a service
at potential that it must be multi
tenant also like we would like to be
application tenant aware and leverage
cloud platform for scalability and also
for like reuse tenants of cloud platform
to be tenants of it application like to
let it be one instance of application is
excluded for terms like shared mountains
big picture of software is a service
it's like everything it's does not need
to be multi tenant Linda said multi
tenant software services through
software service we kind of agree but do
not let's not go deep into these
discussions but so we want to talk about
this multi tenant software as a service
okay
no comment so far
yeah few points about it if you don't
have great examples for it of course
everybody would like to see CRM in this
place but it's very complex and you
would not be able to think about it I
think so I Breen as as example analyze
online service solution which would let
companies have different questions and
answers and reporting tools like
companies as tenants they use the same
application but if data is related and
probably different user base accessing
the same instance of application and
different look and feel of cost what
challenges are there no but you know we
can think about then developing
multi-talent applications first of all
it's the isolation its yeah everybody
thinks if tenants well you'll actually
be will actually agree to share the same
database between its competitors so it's
the first scene to solve and we want to
show how it is possible this clip
stinkin hk2 awesome then data model
extension like it would be nice to have
a different slightly different data
model depending on tenant and more
advanced would be behavior
customizations pertinent this well that
is what actually those multi-tenant
cloud platform self but we don't take
care about it yet and tenant
provisioning and this is actually our
highest priority I make this approach to
development attend application be
applicable to some cloud platform but
have it available so we don't have any
cloud part from suitable for this like
in tight integration of so I've liked a
couple of things here which is you know
if you have attempted to develop a
multi-tenant application or thought
about you know how to make your
application multi-tenant you would have
gone through almost all these challenges
right I guess one thing that we missed
here is customizing UI for for tenants
you know so you're developing a
multi-tenant application I mean the
example that we were talking about here
was an online survey you know you are
providing services service to do service
for different different companies you
know let's say GM and Ford are your
client and they would come in and they
would want you know UI that is specific
to to them you know they might want to
place their logo onto there you know we
would of course want to isolate the data
between them you know GM surance reports
data and they might want to have some
extensions to their data model be number
one company wants some attributes that
the base application provides another
company might want some extension also
modification to that and of course they
might want some behavior customization
attendant at the end of the survey you
might want to say Howard thanks for
taking survey you know the results would
be emailed to you the second guy might
want to say something else or you know
might grow in some other other
customization so as a scientist is you
know we and the next couple of slides we
are going to take care of the data
isolation part of it and to some extent
data model extension which are
interesting challenges to solve the
other challenge is we have not touched
upon and it would be nice to discuss
that within us you know what are your
thoughts have you encountered those
problems how are you planning to solve
it is there anything that we can do as
observer provider Hawaii level to solve
them so yes under you can go ahead into
you know the details here yeah quite
technical and now goes very unknown hk2
so how many of us here have are known
about HK - have you heard about HK - of
great yeah all right okay maybe under
will give you know a bit of background
about it so that would get a Spaniard
they wanted to have a separate session
Jovan but unfortunately they didn't get
into this so it is first of all
dependency injection yet another
framework of dependency injection it's
this abbreviation stands for 100
kilobyte kernel it used to be very small
and powerful framework to develop
enterprise application now it implements
GSR 330 dependency injection standard so
which is - which defines injection
points and contract contracts and allows
to make support for inversion of control
but white is so great each each key -
beside these dependency injection it has
quite powerful API that allows to
firstly control like these injections
and services and bindings between them
and this first service is service
locator which is registry of all
services where services are looked up by
active descriptor which defines a
service it's it's very flexible and we
will show this advanced it API to
demonstrate usage in multi-tenancy and
other great part of hg 2 is
configuration subsystem mmm this is
actually a whole foundation of GlassFish
application server so if anybody
familiar is developing commands like how
it works it's it uses this configuration
support for configuration when your
application configuration can be stored
in XML file and HT 2 allows provides
easy mapping to Java playing objects
this is very similar to Jags be quite
popular but this is own increment
implementation
it used to be separate because each key
to team wants to allow to save to other
data to data repository than XML this
configuration can be modified at runtime
also for modifications there is support
for validation using hibernate
validation and to perform any
modification you need to to establish
transaction and there can be change
listeners that can wait a transaction to
roll back changes or react in some other
way
the great thing about it is that this is
integrated with dependency injection so
you can inject this XML configuration
into your java service and this is
modular and also extensible you can have
configuration changed or extended in
some model that depends on parent model
the parent model does not need to be
aware at all and you do extensions by
classic Java sub cousin we will have
will use this configuration subsystem to
have different configuration pertinent
and if you go deeper into details this
hk2 has so defines also scope and
context which is probably not part of
the SR 3:30 and default scope is
singleton and all services by default on
this scope it means that single instance
per application exists or others
standard scope is per lookup and
whenever it is requested from registry
new instances created so there are also
is
great extension points like you can
define custom injection resolution if
you were weld a presentation they showed
like and how you can inject logger this
also can be done with each Quito and
custom scopes allows you to have
something completely special and this is
what we exactly will use from
multi-tenancy this is not our work it is
available in HQ two examples CTM example
it stands for cloud tenant manager and
just for demo of customs code they have
more demos actually but not relevant to
us so let's go further its configuration
so we'd like to have configuration of
environment pertinent supposing supposed
for our cloud platform but it defines
mean and mark size of its environment
how it would like to scale and then it
is represented in Java is simple
interface name and means name of tenant
and mean and mock size okay and we would
like to have a service in singleton
scope that we would have this
configuration being ejected that's what
is great about HT 2 and the problem in
our case is this configuration is
different pertinent and we would about
this service in sin sir in singleton
scope we would like this to be changed
depending on current tenant using the
project running the process this can be
done this proxies and we would like to
do this with customs code which needs to
be marked as proximal so for this we
define annotation tenants code and just
mark it with scope and proximal that's
very easy but there is back-end of these
tenants like context tenant scope
context which takes care actually about
services being created once per tenant
and provides a real object depending on
the current state of the
system so it is also just a service it
can be injected with tenant manager
which will take care about how about
which will take care about the state of
the system
it just has set and get current tenant
so we need more working tenants called
context and this is how it will take
care about context pertinent adjust a
map of tenant name to services container
so like you see map of map so this
second map is as services like map of
active descriptor to real service object
so this is the most complicated part I
would like to pay more attention at this
point and then this interface context
interface requires us to define find the
create method when we have get current
context per tenant it is just gets
service from the services container if
it's not available it creates one
leverage in each key to itself like this
active descriptor that defines our
service is has create method and if it
is normal service like logger for
example we'll just be created by hp2 but
in case of our configuration object it's
more problematic we would need custom in
sensation and for this we can use
factoring which is another service that
also can be injected with our talent
manager to know the state of the system
and it needs to define provide method
and the key point here is it is marked
as tenant scoped which means that this
factory provides object in our scope but
service itself is in singleton scope so
provide method will just use HQ to
service locators which will have
configuration pertinent in this service
locator and just get this configuration
from service locator so I would like to
quickly recap what we have just seen
so we declare tenon scoped annotation
and huge main work is done in context
including limitation of contacts
interface which needs find a create and
it has map of tenant services container
and factory that takes care about
configuration objects in which are
pertinent in service locator and service
locator has XML to environments mapping
so and then we can just have our service
provider engine like it was injected
with config this environment object and
it has different value depend on current
tenant set in the system little
technical division so the the formatting
of flight is all messed up because we
switched from our primary left or do
this so you know seeing some code at the
bottom but maybe under you can walk that
the points that is the same so this
entity sets another tenant and it
verifies that the tenant name is Bob in
the second case so here is the point
that like Satan current tenant
let's service provider engine as in
singleton scope have correct
configuration but it is injected as if
it was just one configuration like
now I would like to see how it can be
used in Italy clips link I hope more
people now eclipse in that moment it is
Java persistence a architecture
implementation it has support for
multi-tenancy since recent version to
the form they have great example at
their repository and website like
describe very good it's my sports
example and we will probably touch
quickly visual properties that allows to
have custom data model pertinent so at
the tenant it this allows you have data
is related in your in the data database
it can be table pertinent or single
table using tenant discriminator column
so when different roles have different
data per different and it's also forced
to mention that using Oracle VPD it's
much more secure but we've just covered
like programming aspects of it so it can
it allows to have these application
architectures like dedicated persistence
you it when you have one persistence XML
pertinent and everything is separate or
persistence you need pertinent and
sharing single persistence unit but
having separate entity manager Factory
pertinent this is what we will use in to
illustrate how multiplication can be
developed and other share more
approaches persistence context pertinent
it means that persistence unit is shared
and the manager factor is shared and
context is
like different but it shares cash and
those multi-tenant entities that must go
to different cash so it must be carried
specially so yeah we will look at this
pestis persistence in a patent case and
just quickly we define multi-talent
entity customer using talents trade
discriminator column which you have
talent as its column name then using our
talent scope that we just created we can
so we create a factory for this entity
manager factory persistency unit and you
just need to put talent named as
eclipsing property this multi-tenant
property default it says term tenant
named and provides so this method
actually provides entity manager factory
and very quickly to review it once again
just will use tenant sculpt and will use
context tenants called and just another
factory entity manager factory that has
provide metal and then the great magic
is that you can inject entity manager
factory to your service that can be in
singleton scope and you can use it
normally like in single tenant
application but setting so we assume
that the same ten talent manager is used
like in this it has the same approach
exit current talent when it is changed
entity manager factory pertinent is used
in this case
any questions at this moment
nicer I didn't catch
no it's not it's not integrated with zgb
it's it's quite separate yet so just mmm
so this is a HD 2 injection
so if you do that you you would be
sharing an EMF between tenets and and
what that means is that you will you
might be sharing the second level cache
between tenants and so so III believe
technically it would work you know it
would do the job but I would recommend
doing that another question
yes you're absolutely right it's just
another in dependency injection
framework but it's used in GlassFish
it's live project and it's heavily
developed and recently we found like
this can be used with this custom scopes
it can be used to develop multi-tenant
application in normal way like in this
CGI like that everybody used to sorry
the the entitymanager well as I said yes
it would be possible yes no that that's
not possible right that's there's a
point I was trying to make yeah
HP - integrates with those a container
for this modularity and this is how it
used in Gaza fish actually okay great I
see some people got the idea and that's
great so like we have some more time
they just mention another feature of
eclipse link it's quite available but
it's like it's quite 1080p if it
actually useful
so like this this is about custom schema
or custom data model pertinent so how it
is proposed to be done in eclipse lean
you define you declare your entity visit
or guilt or access method that needs
just getting set method and it actually
stores properties in a map so it can be
any data that maps directly to string
only so the same column is shared for
differ like different properties we
would like to have a custom mapping
pertinent for this we declare in
persistence unit XML we declare meta
data source and using our tenant meter
data source class we get tenant name
from properties this is the clips link
context properties and Cleveland has
support for external entity mappings so
we just use eclipse link ORM
tenant name XML file that have that has
tenant specific data model so this is
small extract what it can have just
different name it marks its view at all
so tenant ACMA has AK my property intent
main his main property and then
mmm so Tribunal's keep it then you can
in your service can use this property in
your entity so it's not like type it's
not static name but if you said for ACMA
customer cannot say in the vein property
it won't be not just saved mmm
ok that was it I would like you to
follow up with anything you may come up
here's a short link for everything we
covered there are like my book there is
my blog also a link to my blog yes so
this I mean all the resources that I
mentioned here you would be able to you
know get to them using this if there's
one thing you want to copy you can copy
this and you should be able to get most
of the information they were discussed
here there so sure
mm-hmm yeah in fact yeah it's actually
standalone so if this this link has some
points two examples it has like very
basic example that without multi-tenancy
like it stands for hello world this hk2
services it has more extensive example
like this EDM example and my personal
work is equipped engage key tool like
when I'm trying to work on complete
stack but at this moment it just
excluding an educator so if you have any
questions about it of course contact me
I'm very interested in yeah yeah and as
we mentioned in the beginning right this
is this is more like an academic project
or you know you're trying to explore how
multi-tenancy can be implemented and how
different challenges that we mentioned
can be solved so you you might be able
to take ideas from here and expound on
it and work on it but this is not a
complete stack that you know you just
take it and and working well so this is
still work in progress or you know what
just started which is there is a problem
that HQ is not so popular of course you
don't probably want to build your
production application in this but this
is a playground to model what we would
need in Java Enterprise no no it's nice
yes Katie you can run standalone but you
can run it within nos the environment
also so hk2 is OSG eyewear you can
understand alone as well as in OS the
environment so it's possible to be used
in production but I just say that
probably you won't want so yeah I guess
this brings us to what I think is the
most interesting part of the ball fan
which is to exchange ideas let's let's
talk about you know how how we can
expand on this this is just as you could
see you know it is raw work at this
point of time but one of the themes of
Java EE 8 is going to be multi-tenancy
we are part of Java EE group within
Oracle and wanted to see feedback about
you know what would you want from
multi-tenancy future what would you want
as support for features you know I mean
as we as we discussed there can be you
know there
various challenges that we face while we
develop a multi-tenant app like you want
to develop UI pertinent yeah I know you
want to have customized UI per tenant
there are some mechanisms that we can
use to solve it you know what would you
prefer what capabilities would you want
in there you know just having templates
for tenant is going to be good enough
would you want you know the UI to be
customized more finely more granularly
what would you want you know so maybe I
think a good idea would be to Pola
how many of you are actually play toying
with developing a multi-tenant APIs is
there anyone here who is toying with
they're developing a multi-tenant about
who has done that anyone here all right
so so maybe it's very interesting to
share you know what yeah well you guys
you try what challenges have you faced
and and you know
okay
hmm
- sexual American students
some lame
mmm
correct correct correct all right all
right all right
so are you guys we're you guys
developing this app within a container
like an app server it's a noisy I can
tell you another thing all right okay
okay and and and how important is it was
it for you guys to to have fair sharing
between tenants so you know we are
running in same VM currently at least
the JVM doesn't provide ability to you
know restrict users of threads per
tenant or something you know we can
always implement something but you can
have a runaway tenant that can be
consuming the whole whole VM CPU power
power and the other tenants might be
starving so how important is it for you
guys to control it are
mm-hmm
so would you like to share something
that you are facing or you know how
important is you know one of this point
for you what have you faced this or
why
all right all right
all right moment
mmm
mm-hmm-hmm-hmm all right valets so the
typical life cycle for you is a tenant
comes on board you you prepare a new war
with customization and deployed
and so that's a manual process at this
point a human does that it's not a
machine driven process okay okay so so
as far as data isolation is concerned I
guess eclipse link has solved that
problem pretty nicely you know you get
the abstraction of using JPA and it
provides you know there are various way
you know I mean basically there are in
my mind three ways of doing data ocean
you can have you know schema pertinent
as you are doing you can you know have
separate tables pertinent that's that's
one approach that I have seen being used
in the field so or you can have table
striping that is one table that is
shared amongst all the tenants and using
eclipse link you know I mean Eclipse
link has got features to implement all
these three at this point and you can
mix and match so maybe you know you can
have a look at the what eclipsing
provides that that that might help solve
some of those problems in
all right all right all right
okay okay
on the current tenant yes on the current
energies
uh-huh haha alright okay okay uh-huh
uh-huh sure sure so one of the things
that can be used you know I mean I would
speak you know using the logo here is
Oracle VPD that solves this problem very
nicely so you know that's a commercial
thing I just want to discuss technology
here but Oracle VPD also solves that
very nicely and you can use that you
know with eclipse link and you know
eclipsing provides I believe some hooks
to integrate nicely with VPD also does
anybody face here you know the problem
of data model extension which is you
know you got tenants and they are going
to you know any of them scheme up a
tenant table pertinent or table striping
but conceptually they might want to have
more attributes or you know some
attribute customization per tenant and
have you guys face that problem are you
solving it
uh-huh
all right
alright alright okay
correct correct correct so so that means
you will have to maintain separate code
base but per tenant in some ways not the
whole code base but they kiss the
extensions at least the extension yes we
are
yeah that is the next thing I wanted to
develop I
the customer actually has 500 mythix
N'Diaye
and of leashes Indians some kind of
all right well yeah that's a good
feedback thanks yeah
I guess we are almost out of time
we are available for discussion if
anybody's interested we'll be outside
the room or something and you can also
you know contact us by our email ids
which would be pointed to by on on the
link so please feel free to do so we
would eagerly look forward to it
and thanks a lot for attending the talk
it's thank you for sharing your sauce</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>