<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Using SQL for Pattern Matching in Oracle Database - OLL Live recorded event | Coder Coacher - Coaching Coders</title><meta content="Using SQL for Pattern Matching in Oracle Database - OLL Live recorded event - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Using SQL for Pattern Matching in Oracle Database - OLL Live recorded event</b></h2><h5 class="post__date">2013-11-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LfIHUFXnzw8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome to this oil
is live even as Korea introduced my name
is Supriya Arnold and I work as a staff
curriculum developer in Oracle in
today's session we will be learning
about the new pattern matching feature
in Oracle Database 12c the agenda for
today's session we will be identifying
the benefits of pattern matching first
followed by tasks and keywords in
pattern matching and then finally we'll
execute few real-time examples to see
how pattern matching can be applied to
day-to-day work the benefits of pattern
matching the ability to recognize
patterns across multiple rows is
important for many kinds of work for
example all kinds of business processes
which are usually driven by sequence of
events let's take for example security
applications where unusual behavior must
be detected or let's say financial
applications where you see patterns of
money transfer not just that pattern
matching can also be applied to stock
charts to identify patterns such as V
shapes W shape and u ships and the list
goes on so any pattern of interest can
be found out you using the pattern
matching feature as far as the X can
express the source of the pattern in the
form of a table with data in it
coming to the overview of pattern
matching the match recognized class is
used to perform pattern matching in
Oracle sequel so it is used to first
logically partition and order the data
that is used in the mash recognized
clause so we use the path of the
partition by and order by clauses to do
this then we define patterns of rows to
seek using the pattern Clause of the
match recognized plot we specify logical
conditions required to map a row to a
row pattern variable using the define
clause and we define measures which are
expressions usable in other parts of the
sequel query with the help of the
measures plus
so before we get into the syntax and key
words of pattern matching let's
accomplish a task of finding W pattern
in the stock chart which is displayed in
the slide so along with W pattern we
must also find two things first is the
beginning and end date of the pattern
and second the patterns that lasted less
than a week so without using sequel an
individual or element can break down the
starch into strata so the first what you
will do is you will identify W patterns
in the stock chart just as identified in
this slide here
then you will match the W patterns to
the x coordinate to find the start date
and end date of each starter and then if
there are n number of W patterns you
will use the tables to collect the start
and end values as we doing here with the
help of a small table
and then finally you will subtract the
start date from the end it to identify
the patterns which lasted less than a
week's time so in this example the first
W pattern is discarded as its as a class
9-1 eat day and second w pattern is
identified as the passing of search as
it lasted six days
so just the way we charge the task into
subtasks and accomplish the objective
seek will also perform the task of
finding patterns by jumping to down into
scuff tasks using keywords in pattern
watching let's have a look at the
keywords
so these are the key words for pattern
matching
so each keyboard has a unique task and
will help you program place a small sub
task to identify the pattern so the
first keyword is a partition by Clause
it divides the data into logical groups
based on the columns specified in the
match recognized class for example let's
say we may partition the table
containing structured information by
Stockman's so what does partition by
class do so each partition will have a
group of rows this is unique to a single
stock so partition by will partition the
data based on the column name that you
specify and if you specify the column
name to be the stock the stock name so
for each stock will be as will appear as
a partition in the table next we have
one roof to match which means that for
every pattern match found there the only
one row of output and then we have all
rows to mash which displays all rows
which is responsible for a match in the
output so all rows for match is used for
a detailed view of the match and one row
per match will give you one single row
which wants to do single match we have
the measure keyword measures defines a
list of file that will appear in the
pattern output table so it defines
columns whose value will be computed by
evaluating the expression related to a
particular match so we have also have a
few built-in measures to help the
developers understand how their patterns
is being applied with the help of a
match number and classifier function
which we will be looking at in the later
slide then we have the pattern keyword
which defines the row pattern that will
be matched that is it defines what
pattern we looking for in a table for
example in a stock chart are we looking
for a W pattern a V pattern ru pattern
so whatever is
pattern of interest that you are looking
for in a table will be specified in the
pattern using the pattern keyword and
then we have the define keyword which
gives us the conditions that must be met
for a role to master row pastor and
variable that you define so what if you
look at the previous example we had X Y
W and said so what logical condition
should be should be applied for X or Y
or W or Z should be mentioned in the
define class and then we at the end we
have aftermath script which restarts the
matching process after a match is found
so these are the keywords of pattern
matching now let us look at the same
example from the previous slide and see
how each of these keywords constitutes
to find W patterns in the structure
first we have the pattern it defines the
searches X plus y plus W plus red loss
so this signifies that we searching for
a W pattern to seek the pattern down
followed by up to two consecutive times
so one down followed by up constitutes
to B and down followed by up for two
consecutive times formed a W pattern the
plus sign after the pattern variable
means that at least one row must be
masked for each of them so we can call
this approaches a greedy approach by
saying we have to make sure that the
database returns at least one row which
masks each of these pattern variables so
that is what Katherine stands for
and then we have the define so because
the pattern class depends on the path
the pattern variables you must have a
class to define these variables so we
use the define class to specify the
condition that a row must meet to be
mass to a specific row pattern variable
so here we've defined the pattern
variable egg to match the roads which
whose prize in the current road is less
than the price in the previous row so
this is the logical condition which
sales the price of the current row must
be less than the price of the previous
row and any rows which constitutes to
this logical condition will be masked to
X so if you look at the diagram X
signifies the speed down fall or depth
in the price of the stock
next we have y-value mat is two rows
whose price in the parent row is greater
than the price in the previous row so if
you look at this top chart by signifies
the increase in the price of the stock
now that we are looking for W patterns
in a stock chart we will use phantom
variables W and set to do the same
functionality which X&amp;amp;Y is doing so W
pass use to a depth in the price and Z
constitutes to an increase in price so
all four four variables put together
then search for the W pattern note that
the values of the stock shock are loaded
into a database with the help of a
create and insert statement so in this
scenario we have the Pico table which
holds the values of this particular
stock chart and the values of this stock
chart are already inserted into the
table using the insert statements
a passion with passion there are also
few keywords which are displayed in the
slide let's study them let's start off
with a partition by Schloss so typically
you want to divide your input data into
logical groups for analysis so in this
example the part the pattern matching is
divided so that the pattern search
applies to just one stock at a time so
if we if we look at if we think of a
stock chart we will have we will have
lost stalks which which which can
contribute to a table containing stock
information so we want the pattern to be
applied for each and every stock for
this we partition this the stock table
by this name of this stock so partition
specifies that partition by specifies
that the rows of the input table are to
be partitioned by the name of the stock
therefore the sequel statement
identifies W pattern for each and every
stock so once the table is partitioned
based on stock name we have the order by
the order by clause is applied for each
partition to order values with the
partition based on the time of purchase
so within each partition order by class
is applied and the it orders the the
rows within the partial based on the
time of purchase next we have measures
so measures defines two measures here
the time at the beginning of the ugly
shape which is calculated by using first
of X time at a time at the end of study
shape which is calculated by last of
this time so the x time and Dec time
measures use the first and the last
function to ensure that it retrieves the
values of first and final value of the
time which is written each part or not
so first of x time will always save the
value when the pattern started and last
of the time will hold the value of of
the pattern end so this is required to
find the time duration within which the
stock existed
so you can apply functions like
subtotals
let's account running totals or moving
averages in this measures class
next we have one Roca match as
highlighted in this slide if you use one
row per match pattern matching generates
only one row each mass that is found so
if you want the output to return every
row that is much you have to use this
although super match
so looking at the static statement here
I think we've reached to a level so in
the process of family rising with the
keywords and the functionality let's not
forget that we are on a mission here to
find W patterns in the star chart with
two specifications first the beginning
and end date of a pattern second is to
find which pattern lasted less than a
week's time so if we take a look at the
sequel statement here we can see that we
reach the point where the sequence
statement has been able to identify all
the W patterns in the structure so if
you look at the stop shot we will see
that it's two in number and we can find
the beginning and end dates of both
these patterns so first of X time and
last of bedtime variables have the dates
already stored in it now all we need to
do is to find which pattern lasted less
than a week for that we include a
logical condition status we define the
last transition which their last of that
time - first effects time should not be
it should should be less than or equal
to 7 which applies that this condition
we should successfully identify that the
second pattern in the stop chart if the
pattern of the search we also have a few
additional path the additional keywords
with pattern matcher apart from the
mandatory keywords
these are match number and classifier
and these keywords mainly help us
analyzing the pattern in detail so you
might have a large number of matches for
your pattern within a row partition so
how do you tell apart all these matches
for that we use the match number
function the match number function
numbers the match within a partition
sequentially starting at 1 in the order
that they're formed so for each
partition the March numbering starts
over again at 1
along with knowing which match number
you see you also want to know
start on variable applies with which
specific role so for this we use to
classify a function the classify
assumption returns a character screen
whose value is the name of the variable
the row is mapped to so let's understand
this keyword more in detail with with
the help of an example which I'll be
demonstrating now
so if you look at the sequin script here
we have a create table Const occur which
has symbol and which are T stamp which
is the time stamp and the price values
let's create the ticker table of which
with stores information of a stock chart
and then insert values into it
once the values seek are successfully
inserted let's have a look at the select
statement the choses match number and
classifier so if we look at the select
statement here we have a select still we
have a select statement which queries
the take a table and we using mass
recognizer to apply pattern matching and
we're finding a real pattern here where
in mrs. start the search that you have
down and then enough constituting to be
pattern and we say we need all rows to
match this says give me a detailed
description of the of the pattern that
you find or for each match give me all
the roads which which were responsible
for the match and then we have the March
number which specifies the number of the
March and then we have the classifier
which says which pattern variable for us
with responsible for which match so
let's execute the select statement
so if you look at the output here we
have a March number which says for
particular symbol acne we have three
matches one two and three so the first
six rows constituted the first match
rows from seven to ten constituted the
second match and rows from 11 to 15
constituted to the third V pattern in
the table we also have the classifier
function which is displayed as a
variable March Paulo which stays let's
say which states that the first start
the first pattern was started at the
first row wherein the price dipped down
and then gradually increase giving rise
to V pattern second we again started the
match at at row seven that this row
seven constituted to starting the V
pattern eight and nine constituted to
down fall in the price or dip in the
price and then we had tenth row
constituting to the pattern variables
half and that ended the pattern that
ended the second pattern we also have
the price associated which shows that
there is a dip and then there is
increase for each and every free pattern
so this is how you get the developers
especially apply mass number and
classify your functions to study each
pattern that we retrieve in detail
you
you
so next let's move on to the last and
regular of today's event so I will be
demonstrating a real-time example of how
pattern matching can be apply to
financial transactions before that let's
have you answer some quiz question
3f sure so can i yes
can it be the open of the polling
question yeah sure
they open up the first one okay so which
function returns the value of an
expression evaluated in the last row of
the group of pros math to a pattern
variable so which so which function do
we have to apply so that we hold the
last row of the pattern match is the
Kressel so please take time to answer
the quiz graph to
reviews the similar example in our
previous W pattern match so which
function did we use so that we could we
could cache the value of the last row
responsible for a pattern let's take for
example a w pattern we have received pi
responses so far just making couple of
more seconds
show
you
you
you
you
okay I'm closing this poll question now
soup every like to give up the answer
yes so the last function always stores
the value of the last row in a group of
proof so na is the answer for this quiz
question
we also have another quiz question clear
can you please open that up
sure
yes open up
okay so you have a select statement here
so identify the functionality of order
by in the following select statement so
note that there is also partition by and
try to
analyze what order by gar in this select
statement which is mentioned here into
question
you
you
you have the feed for Responsive so far
again actually for couple of seconds
paper closing the poll
you
you
you
okay I'm closing the poll now spread the
biblical all right so in this particular
query so order by is used to logically
order the rows within a partition as we
already have the partition by clause
which logically divides the rows into
groups so whenever there is a partition
by clause followed by an order by Clause
we say that for each partition the order
by clause is applied therefore here it
logically ordered the rows in a position
all right so as I said let's look at a
scenario here so the scenario here is we
need to help the ID database for detect
suspicious money transfer patterns for
an account which involves create a most
small amount of less than $2,000 money
transfer within 30 days duration at
followed by one subsequent large
transfer with less than or equal to 1
million dollars within 10 days of last
small transfer so when you think of a
suspicious money transfer it's very
important for us to define what a
suspicious money transfers right so but
before without defining what a
suspicious money transfer in how did you
find out that what is the pattern that
they're looking for
so if we look at the example or the
scenario here we have a suspicious money
transfer or the patterns of the search
define that so these small transfers of
less than $2,000 within 30 days followed
by one subsequent large transfer within
10 days of this last last small transfer
so in the report we want the user ID the
date of first small transfer date of
large large transfer and what is the
amount that's being transferred so this
is the scenario here and we need to help
the IP database book detect the
suspicious money transfer by using
pattern matching
match recognizes let's see how we do
that before that let's create the table
and insert values
so here even log is the table which
contains information of then the even
took place who is the user who deposited
the money or transfer the money what is
the amount that is being transferred
what are what is the event so in in a
financial transaction they can be
deposit they can be withdrawal and they
can be transfer of money so these are
the three even and then we have
transferred to column which stores the
name of a person to whom the van the
money or the amount is transferred to so
ensure make note that when the event is
deposit they will have the transfer to
value as null as we're evolving as the
depositing it depositing the amount into
our own account and then we have and we
have the even type of transfer we will
have the transfer to column holding a
value so this is the table with values
for a financial transaction so let's go
ahead and insert the values
you
so all patterns that we have to look for
we need to look for in table which has
data in it so for this suspicious money
transfer we have already inserted the
table with Dana on which we are going to
perform pattern matching and find a
suspicious money transfer so the table
has been created and the rows are
inserted successfully let's get back and
look at the sending statement for the
suspicious money transfer here this
select statement X shows that we have
three or more small transfers of money
less with less than $2,000
and the time within which the small
transfers have to happen is within 30
days followed by one large transaction
of more than or equal to 1 million and
the large transfer must happen within 10
days before the last small transfer so
we have queried the table here where in
we expiry the even o'clock table here
where we restricted the even to transfer
as we're looking only for suspicious
money transfer we are selecting the user
ID first T which holds the value of the
date of the first transfer last P which
holds the value of the last transfer and
then we have a pattern with face X with
3 in brackets saying that we need three
small transfers comma specifies that
three or more transfers can be allowed
so our specification says that we can
have three or more small transfers
amount followed by Y which constitutes
to a large transfer so X is defined as
when the evil to transfer and when the
amount is less than 2000 and Y is
defined us when the event is transferred
and the amounts is greater than 1
million the last of X I'm - fastest X
time that is the last transaction of
small amount and the first transaction
of small amount must be less than 30 so
it has to happen within 30 days and by
time - last of small transfer should be
less than 10 days so this is the select
statement which will come up to find out
the suspicious money transfer with three
or more small amount transfers with one
large transfer let's execute the select
statement and find the report that we
are looking for and find the person who
is responsible for
suspicious money transfer
you
so we have the same select statement
here which we will be executing to find
suspicious money transfer so according
to the pattern that we've specified John
is supposed to be responsible for
suspicious money transfer wherein he did
his first transaction on 6th of Jan and
last transaction on 26th of Jan and the
amount transferred of the large amount
transferred is 1 million
let's go back to a slide and you know
update the scenario to find the
recipient of the transfer so we already
know who who is the person transferring
the money we also want to know the
recipient of transfer with two more
conditions so in the small three small
amount transfer we want two or more
small transfers to happen to different
accounts and then we want sum of all
small transfers to be less than $20,000
so we have to update the select
statement from the previous slide to
make sure that within three or more
small transfers two or more small
transfers should be to different
accounts only and sum of all small
transfers should be less than $20,000
here this enhanced or let's say update
this the Select statement there is X
where is that holds a small transform of
amount less than 2000 which constitutes
to one small transfer XS where the even
is transfer and the amount is less than
or equal to two thousand dollars that
previous of X transfer to is not equal
to X transfer to which said that this
person to whom the amount is transferred
to should not be equal and then we have
Y which says which holds the definition
versions even has to be a transfer and
the amount should be greater than 1
million and the last condition which
says sum of X amount plus that amount
that is the total amount small transfer
should not be greater than $20,000 so if
you look at the pattern here we have one
file transfer followed by smooth two
small transactions wherein we do not
have the deposited or transfer to the
same account followed by one large
transfer let us execute the Select
statement and find the recipient of
suspicious money transfers with an
additional two conditions which give
away
you
so we have the same select statement
here let us execute the Select statement
to find the recipient and we see that
yes the transfer was from John and first
transfer date with 15 of John and the
last transfer rate of 26 with John the
large amount that is being transferred
is 1 million and the transfer to has
happened to think so since is the
recipient of small transfer so this is
how pattern matching can be applied to
find in financial transactions or in
structure it also has it can also be
applied to special you can also place a
call the call information so as far as
you can you know consolidate it and I
put the information in the form for
table you can use the Select statement
with match recognize Clause through
which you can perform pattern matching
so there many more features with pattern
matching so we have just covered the
basics of pattern gnashing there you
know with few keywords with mandatory
keywords and a few optional keywords you
can also see how we can exclude
a pattern from pattern matching and
there many more features he is looking
to Oracle Learning Library for more
Obie's
and videos on pattern matching which is
a new feature in Oracle database
currency so this concludes our webcast
thank you all for attending and have a
great rest of the day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>