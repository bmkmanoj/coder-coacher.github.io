<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Custom Static Code Analysis | Coder Coacher - Coaching Coders</title><meta content="Custom Static Code Analysis - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Custom Static Code Analysis</b></h2><h5 class="post__date">2013-02-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/01tQsMmLzUU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good afternoon ladies and gentlemen I'm
yehuda I work for oracle under netbeans
ide and today I would like to talk about
a custom code analysis so first of all
let me show you this slide I'm sure
you've seen way too many times already
and now let me start is this some kind
of motivation so in each bigger project
where the multiple people working there
are some anti-pattern things that that
the developers shouldn't do about things
that they typically do because it's
maybe simpler or they don't know they
should be doing that or whatever other
reason they have to use to use the
antepartum so for example in netbeans
rylann in that means when we have a
project instance we shouldn't look up
this project information interface
directly in the projects look up we
should use some butyrate a method that
will pull up the project information
from the hook up or provide some default
implementation if there is none in the
hook up but people still from time to
time right the like type the first the
first why and which lookups the
interface instead of using the the
utility and so it would be good if we
had a way to cut against against such
mistakes to god about use usages of this
on the patterns and the question is can
we do that is out i think tons of
jericho and answers yeah we probably can
using the NetBeans
language for relative effect or earrings
where you can use just the just part of
a part of it that finds pieces of code
that that matches that match some
pattern so we can specify a pattern that
you want to find and pepper a warning on
on code that that match is this pattern
so for the example from the previous
slide we would have we could have a rule
like like is shown here which actually
fixes the problem but if he will use
just the bolt part the good the bell
visible part it will find the deep
places in the code that that use the
incorrect incorrect pattern and report
that that code which bring which brings
us to another question how do we check
the code that it that it is not using
the anti-patterns V right escaped that
or we declare the anti patterns in some
way and now we need to check the code
that it doesn't doesn't use anti-pattern
so in that means if you open the file it
will underline the the line that
violates my rights the my condition in
korean tank builds one could use source
inspect to check for that or so but it
still requires some action on our side
something we need to do to see to see
better days some wrong code or not what
would be better is that if you could
turn this this these checks inside the
continuous belt then it would be an
automatically for us we would see the
results for the whole project and we
wouldn't need to like do something it
would be the mistakes will be pushed
into our face
and the question is how to do that and
what you can do is to stand alone rather
stand alone Hannah for d4d custom rules
and that there is there is a wiki page
with some with some details about that
and this this standalone header is
basically a very stripped of very
straight up version of NetBeans back
into vanja that can be easily on that
can execute the the rules that can also
run standard netbeans warnings it can
even perform the changes if you have
some rules that that actually do some
changes then the two can actually do
them to the code but that is not not the
main topic of this talk there are
bindings to aunt and maven for for this
tantallon honor and I should well knew
that this is a little bit or still a lot
work in progress there is a lot to do in
the future so now let me talk about the
NetBeans language for the creative
effect rings it as the name suggests it
allows us to decry the effect rings in
decorative way or more precisely almost
a creative way we can we can go go or
fall back into Java if you need to to do
so the language is similar to java in
some aspects or embeds parts that are
very similar to java we can we can do
some api changes with it much simpler
and change code structure in some cases
and so on as we are using it in in the
stall for checking for other patterns
it's a real it can be used to get
against anti battalions and we can also
say hey how many clients are calling
this method with this parameter zero for
example and it can tell us which which
colors are passing by a meter 0222
submitted for example so a quick
interaction into how this all began at
least from what I know in year two
thousand in sun labs there was a project
jackpot founded that was created to
improve IDEs and improve the way people
develop cold and it created some
interesting technologies and interesting
tools and one of these one of these
tools was a tool for automated code
transformation it was based on on the
asd from josie even at the time there
was let me say working prototype and it
allowed to declare the transformation
either fully in java or using a custom
decorative language in netbeans we
adopted the right model of this tool in
nineteen 60 and basically at that point
one could write in in java
transformation tool or transform code
using using this this right model but we
didn't have the like decorative part of
the transformation and gene and this
this decorative part was revived and put
into NetBeans 71 under name Jay Paul Co
and now let me talk about the language
in which we can declare the gigafactory
ins and declare like that
for the anti-pattern the the file that
contains the D rules can contain any
number of rules that look like it is
which basically consists of two main
parts one is the sauce pot and the piece
of code we are looking for and then
there can be any number of target
patterns that means the target of the
transformation the new code that we
would like to see in the in the source
code inside of the old one and in this
in this presentation we will mostly
focus on the on the first part only as I
said we can have any number of such
rules in in one file d files typically
end with extension that hint which is
the NetBeans name for days and if he
place them inside under under meta a
brigade it will be automatically picked
up by NetBeans and it will do the
underlining in editor and so on like
sorry now let us see what what can be
the source patterns the very first part
before DD before the conditions so it it
can be various things it can be
basically any job expression it can be a
statement it can be multiple statements
it can be a class variable or method and
it should be possible to include several
variables methods and classes as well
because like if you would be looking for
I don't know system.err.println that
takes empty staying it's probably not
the most useful rule ever we need to say
that we don't care about some part of an
expression or about the value of
and for that we can use identifiers
starting with the dollar sign which
means whatever is is in the code at this
planes is fine and bind that into the
variable under under the name of the
variable and if we start this variable
and this variable is a dollar it it will
consume any number of please oh I should
have stressed out that this this
language is also based on on sds so
there is a lot of places where piece of
code and st note means means the same in
this language so I notifies starting and
ending with the door sign will consume
any number of st nodes and the
difference between consuming man and
many is is shown on on this example the
first the first button don't match only
such invocations to Isis less that take
exactly one parameter the other one will
match any invocation to erase this list
regardless of the number of parameters
they can be 0 1 or any anonym or any
other number so it an important point is
that if a variable is used more than
once in in the pattern the engine itself
will enforce that the IST sts that will
be bound to each of these occupants are
structurally the same or in in some like
meaningful sense so for example in this
case if we have fields a and B then
assigning a to be well they'll match
this this button above or I mean this
pattern
and assigning this a to a lo mejor
pattern as well but assigning be to a
bell note it this this they are not they
are not magic this pattern do not match
this disk old there are some bit special
cases where the syntax of the patterns
deviates from from standard Java or from
was from what was taught before so for
example for statements if you want to
match a statement we can use a variable
and a semicolon and it will consume one
statement if you want more than one
statement you should use mark tip multi
variable which starts and ends with a
dollar sign but what's important we need
to end for statements we need to end
with a semi-colon so that the pattern
can reckon recognize that we mean a
statement in some cases where p is
optional for example in for if stealth
section is is optional we can use the
variable starting and ending with a
dollar sign to express that we don't
care whether whether that part is in the
code or known for modifiers we can we
can use the multi variable as well with
it and it will consume basically any
modifier including including any
annotations under under the variable man
there is special form for matching a
number of keys because without this
special special handling we wouldn't be
able to express a number of keys go into
here and there are some very special
special forms for very specific users
now we have seen that that the rule
consists of of the sauce pot end and
some conditions and then some target
patterns and conditions so let me talk
about the conditions now that the there
are basically three types of conditions
the first kind are conditions that I
defined directed by this language and
these are incensed event and otherwise
condition we all talk about them like
tribe then there are some standard
conditions that are also defined by by
the engine but note not directly by the
language and Jerusalem as well and then
one can define custom conditions and
that is why I say that it's almost a
creative and we can we can combine
conditions with the ensign and then the
combined condition will only be two if
all of these conditions are too and we
can negate the result of a condition as
well so let me go into the into the
language conditions basically the most
important condition in this language is
the instance of condition and it
requires that variable that the
expression won't available is of some
type so for example we can look for
invocations of is empty on staying and
not for invocations of is empty on on a
collection for example and then there is
condition otherwise that can be applied
to 2d fixes or to the target parts and
it's valid only on the on the last
target target attend and it will be
chosen if no other target patent but
then if the conditions for no other no
other target patent are two and
just quickly about the standard
conditions that I defined by the engine
there are basically methods at hood it
somewhere so they are invoked as as
method invocations and try to few of
them there are conditions for pattern
matching so that we can require that the
AST bound to available for is matching
some other pattern it is used for
sometimes that the st bound variable
contains or does not contain some some
other pattern and so on we can inspect
the element that corresponds to whatever
is bound to a variable so that we can
check that if you are assigning to a
variable whether the variable is
volatile or not for example we can
inspect where the where the piece of
code that that fulfills the source
pattern occurs in what cars in what
package so that if you are in a bridge
that bridges the some new API to some
old API you can disable we can disable
the warnings and out some other random
checks for new lethal and so on so now
let me show you show you short demo and
okay
so let let us imagine yes the model that
is used by by some clients and did this
model needs to be locked and so there is
there is this this right loc method for
example and it returns a log and plug
then has an unload method as you can see
here and the users then need need to to
block the model do something to it and
allocate but what what the clients may
do my do is they they may not unlock
hello the model inside the final section
so I thought the result of this will be
that if something goes wrong in the
element at element method and which also
an exception the model will never be
unlocked so to get against this we can
we can create a rule like this that
basically says if someone takes a write
lock then does it is this someone takes
write log then does whatever but
whatever it is done and that then the
lock is unlocked but there is no tie
finally because there is no ty finally
in the pattern then you should produce a
warning so
now it produced a warning like this
which is not very useful so we can you
can add some we say display 948 that
should be more more clear and now okay
now we have something that that wants us
in the editor that we are doing
something wrong but we want to see that
inside in in the continuous belt as well
so let me commit oh sorry let me commit
this into into the repository and now
the ability started but it won't do
anything because the the bird is not
configured so I will configure the
configure the the belt to hand the
analyzer so that I i will call a special
goal that is called j paseo our eyes and
i need to enable us and I I need to scan
for the warnings in the Kampala output
which can be done using the burnings
plugin for Hudson using using this
confer comply warnings option and we are
looking for the Java compiler warnings
here okay and now when the project is is
built one more time which will take a
few seconds
we see there are some compiler warnings
which actually come out from the zoo
file and say that we should elope and
all the log film from finally now let
let me go back to the IDE and have a
look at another part of the model class
we are adding a change listener here and
let us imagine what what happens if
someone adds a brand new instant like
cause the a change listen a method on a
brand new instance that is not stored
anywhere then it's unlikely he will be
or the client will be able to to remove
this listener and it may cause a memory
leak so that so we can go to to the in
file and create a warning for days like
like here and so we found something that
that may go go on Kate it some roof or
eight and then we need to denne denne
then you commit that into into the
repository and let's see what see what
happens so needs to run the belt one
more time and now we see there is there
is a new warning and it's tells us there
is some class that we didn't see so far
that is actually breaking this tissue
that we set up that we shouldn't pass
brand new instance of listener to this a
change less than a method so we can you
can look
Oh story
you can look how this class looks looks
like and three see that we are governing
key the editor and we can do something
about that and I also said that this
this tool can harm the standard netbeans
warnings and for that we need to enable
some of them and I have a maven project
and so inside it i will i will declare
some configuration file and I oh sorry
and using the show hue option of the
analyzer I will break up a dialogue that
allows me to set up witch burnings
should be it should be on on the server
so let me label is studying one and and
we want to to commit that into the
opposite array again and see what what
will be there is out like now it's it's
checking it's running some standard name
means warnings and we will see if if the
code violates them or not so okay
apparently there are some violations or
some warnings produced produced by days
and VC there are five new warnings
inside the model class and it basically
says that we are synchronizing on a
field that is not final which is not
very good because it's not guaranteed
that we are synchronizing that all all
the runs through through the
synchronized block are synchronizing on
the same object so that is how it can
can run the rules how it can hand the
standard NetBeans warnings as well and
now let me show you some what other
sessions we have created two days and
where they are whether the format for
these for these rules is defined so
first we have a tutorial tomorrow that
goes very deep into the language and
toes basically about every aspect of the
language then we will have another
tutorial tomorrow that shows us how to
do static analysis using the Java Sea
model for jolla because the decorative
language is powerful but not Almighty so
sometimes thou think so maybe complex
that man needs to hide em hide em in
Java and if you would take them using
using netbeans API and against the Java
Sea API is then they can be principally
on on the on the server as well the
language is described on on this this
wiki page and there is a repository
under big bucket this quite a few
examples of how how to define some some
transformations using the language so
now let me wrap up this session the
NetBeans language that else's to declare
custom like a custom refactorings can be
used also to to check for some anti
patterns for those things that we don't
want to see in our code and we can check
for them or guard against them also
doing the continuous belt and we can
also check for the standard NetBeans
warnings that netbeans provides in indy
editor using the same same technique
basically the same stunt alone staff so
thank you for attention and question
but
no it has to be exactly as I said Satan
in the pattern so if there is like if if
the unlock would be in a blog on its own
that then it would find it but if there
would be I don't know an if statement
then they disowned on itself wouldn't
find it it can it can be written a
little bit differently and then it then
it would find the analog also in inside
inside for example if statement but if
it's written this this simple I it it
will just catch if there is log
something something something unlock
okay is there any other okay please fine
at least at least some of them yes some
of them can be can be defined easily and
in some cases it might be I think it's
sure I possible using the custom
condition which is a bit more complex
but not that much complex and I think in
at least some checks can be performed
even using rida standard conditions for
this and so the ref yeah
yes
no not really that's i would say that
support for things like this it is like
i would like to see affirm that that
would L to to describe such such
constraint but there's not nothing
really simple right now so I thank you
for the question so I there any other
questions yeah okay please
well so I I didn't understand
well not right now but it could be
enhanced this way I think at least in
innocent as long as long as the goal is
in my own is wrong it could be allowed
to fail the belt I think but I don't
think it's it's implanted right now it
that it will actually do that
so yeah so if done no more questions
then thank you and goodbye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>