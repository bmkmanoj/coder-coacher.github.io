<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Oracle ZFS Storage Appliance Performance Insight | Coder Coacher - Coaching Coders</title><meta content="Oracle ZFS Storage Appliance Performance Insight - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Oracle ZFS Storage Appliance Performance Insight</b></h2><h5 class="post__date">2014-10-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RD6U5f0J4ds" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi this is Darius zegenei now I'm going
to talk to you about the some of the
performance benefits of the ZFS storage
appliance one of the things about the
ZFS storage appliance that really sort
of sets it apart from the competition is
the amount of cash that the appliance
has this particular box that I'm working
on happens to be the smallest previous
general generation box that Oracle sold
to 7120 it only had 48 gigabytes of
memory which compared to the competitors
is a huge amount but now we ship boxes
today as of the recording of this video
with either 512 gigabytes or one
terabyte a video which assume in a
double as well
that allows us to have extremely large
amount of cache hits out of memory and
have extreme extreme performance we can
get massively more performance from DRAM
based cache than we can out of even
flash which we use in our devices for
both read and write performance and I'll
show you that so let's move ahead and
show you some workloads running on this
appliance I guess just to show you the
appliance like I said it's a 70 120
previous generation only 48 gigabytes of
memory the actual storage pool itself is
also extremely small
it only has 10 drives in it they happen
to be there two or three terabyte drives
and they're married in American
figuration we have one log device and
zero cache devices so we have no read
SSD but we have one write SSD and we
have 10 spinning just mirrored in and a
mirror configuration so if we go start a
workload on this first of all start off
with a couple of small IO so I have a
whole bunch of threads running these are
running 512 byte hundred percent reads
and we'll start both of these wear
clothes and go back to the appliance and
immediately we'll come over here click
on NFS operations per second because
it's all running over vmware and
immediately what we'll see is we have a
tremendous amount of i/o per second we
could drill down on this and look at
latency which is probably even better
measurement of performance and you can
see all these iOS are all sub
millisecond response time so they're all
hitting our cache you know if you were
divided this number out that would be 53
549 divided by 10 you know we're doing
something like 5354 I have two per drive
well obviously you can't do that with 10
7200 rpm hard drives that's all coming
out of our cache and that's why when you
look at the performance numbers in the
ZFS it does extremely well customer
environments benchmarks for that sort of
thing let's take a look at some
different workloads so that's
small-block IO which typically there
isn't very many applications actually
that run that way
but let's look at some others what about
large block now there are lots of large
block customers and in this case I'm
running a couple of different workloads
lots of threads
these are 32 K in size again I'm doing
all reads let's see if the cache can
handle this
start the workloads come over here so
now we start the I ops latency cell
looks fantastic we do see now we're only
doing about 10,000 IAB's but
interestingly what we should take a look
at is let's go take a look and see what
we're doing for NFS bytes per
second because usually when we measure
their open applications we care much
more about the bytes per second so now
you can see here these two virtual
machines are doing over 400 megabytes
per second over these 10 hard drives
which is a decent amount let's see a
peek
then next let's check another workload
so we'll get rid of the high throughput
and we will run a couple of what I would
call more production type workloads so
these are running they're actually
running an 8k let me double check that
let's change this it looks like the save
file is a little bit incorrect that's
okay it's quickly changed remove that
there we go a Kay let's just double
check this parameter yes a k5 a K blocks
75% reads which is more like a
production environment especially like
an Oracle database we'll add a bunch of
threads check out that guy and we'll
come over here and let's do the same
exact thing
see these welfare correct they are a k
start that workload and then let's go
back and see what's happened to our
performance in so now we're doing a more
traditional workload I option 19,000
let's see what the peak is are we still
do about 34,000 I apps which is a huge
amount but now we're doing rights as
well as reads if we go and look at our
they're open numbers let's sync all
these screens up we can see I'm just
doing quite a bit at their output 270
megabytes a second on this box but all
of our i/o is still below 5 milliseconds
per second so the way that ZFS is able
to do this was such a small amount of
drives and you can see that we're doing
a mixed workload by the way let me
going here and if we say show me by type
of operation it'll show that we're doing
75% he's 80% rights we can get extremely
granular you know look by client by file
name by size we could see the block size
let's take a look at that there you know
the majority of the blocks are after the
overhead right around that 6k mark but
the way we're able to get such a high
performance is it has a lot to do with
our right SSDs if we go in and look at
disk i/o operations broken down by desk
you'll see our 10 drives in here they're
all fairly busy but one of them is
extremely busy
that's a scary here he's doing 4700 cups
per second that's the right SSD so what
happens is when a right comes in its
buffered by this right SSD drive and you
can have multiples of those in our
appliances just to show you the effect
that would have if you were not to have
those and then you're relying on either
battery back cache some sort of NVRAM
much smaller amounts than where I'll
have this drive is actually a 73
gigabyte Drive let's show what would
happen if you ran in a write cache like
you typically do on other customer
environments we can simulate this by
going into these file systems and
turning off the write cache so I'm going
to go into the VMware project and I'm
gonna turn off synchronous write bias so
that says use the right SSDs I'm going
to say change the thorough put for all
the shares that a VMware is running on
which is my workload if I go back to
analytics I'll see a dramatic difference
so now I went from doing you know 30 to
40,000 high ups you know latency all
sub-millisecond now said and I have many
iOS much much slower in the you know
Fifty's hundred milliseconds the bytes
per second
you know dropped from a couple hundred
down to I'm only doing about twenty
megabytes a second and now the rights
are bottlenecks
so we they're trying to write to disk
and now what you see is what you
typically would so now the two hard
drives are extremely busy are the ten
hard drives extremely busy trying to
write all these because now everything's
being having to go to disk because we've
ran out of cash and so from a write
perspective so everything's going to
disk so in in a real ZFS environment if
we sell this issue we would basically
turn around and purchase more right SSDs
add them into the pool and get the
performance we needed so let's go back
and add some more right SSDs in our case
we only have one there it is we'll
change it to latency hit apply go back
to analytics and instantly we'll see a
performance come back like this good
DBAs are happy thirty thousand apps
seven millisecond response times good
thorough put the operations are good and
and the drives look good now our regular
drives are not having to do much work
the right SSDs doing most of the work so
the other place where we do performance
which I don't have the ability to demo
here is as data ages out of our cache
typically most systems we sell will also
sell them with some 1.6 gigabyte read
SSD devices that are acting as cache
so it's data ages out of our cache
instead of which is a large amount
instead of just kicking it out and say
go get it from disk we then can send
that data down to these read SSDs that
sit right in the controllers and can
give you many additional flash-based
chops so that's the
hybrid storage pool and a high-level
overview of how ZFS provides incredible
performance at incredible prices thanks
so much for your time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>