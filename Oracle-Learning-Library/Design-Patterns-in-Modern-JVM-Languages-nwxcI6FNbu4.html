<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Design Patterns in Modern JVM Languages | Coder Coacher - Coaching Coders</title><meta content="Design Patterns in Modern JVM Languages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Design Patterns in Modern JVM Languages</b></h2><h5 class="post__date">2013-02-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nwxcI6FNbu4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right good morning welcome to the
session on design patterns in modern gym
languages my name is Venkat Subramanyam
we're going to talk about patterns but
I'm going to use a a couple of different
languages here I'll certainly use groovy
i'll use Scala but I'll also use a
little bit of Java 8 here and of course
any information on Java 8 is you know
purely a speculation at this point until
it gets finalized so take that with a
grain of salt examples may vary if you
attended my session yesterday there is a
little bit of an overlap so please bear
with me when you see a similar examples
but certainly ask Allah and Java would
be different than the pattern session if
you attended my scholar session
yesterday there's a little bit of
overlap there as well please bear with
me on that but there's enough new
material as well in here best term to
ask a question or make a comment is when
you have it so please don't wait till
the end anytime is a great time for your
questions and if you don't have a
question and I'm not responding to you
that usually means that you're not in my
line of sight just you know raise your
hand or start speaking that way you will
draw my attention I'll yield to you and
in this room no matter where I scan I'm
going to hide from somebody here because
the pillars in the middle so please
apologize for that I apologize that I
can you know be in one place to for
everybody to see but the content is more
important than me so you'll certainly be
able to see it so let's get started why
should we talk about patterns that's the
first thing I want to talk about and and
the reason is of course in in in an
enterprise development we often hear
about patterns we the Gang of Four book
of course made a revolution about what
19 years ago and and patterns are very
common but let me start by telling you
first of all that I really hate patterns
there you go that was very motivational
wasn't it to start a talk on patterns
and the reason I say that is because
oftentimes we end up looking at what
patterns to use and I think that's a
very long way to design software and the
reason is you you cannot possibly take
something as creative as design and come
to work and say let me see what patterns
you can put together to make this design
work today right that wouldn't work
that way in fact if you wake up one
morning and the first thought that comes
to your mind is I wonder what pattern i
can use in the design today i recommend
you call the boss and say you want to
call in sick because it's no point going
to work with that kind of thought in
your mind right and the reason simply is
that parent it takes a lot more to
design good software now let's take an
example for a minute we all know that
grandma makes the best pie right no
arguments about it and grandma makes the
best buy and you talk to Grandma and you
talk about this to your friends and your
great friends say well if grandma makes
that greater pie why don't you get her
recipes and make the pie and so you call
grandma and say grandma I want your
recipes because I want to make pie for
my friends and grandma says oh it's no
big deal is another no grandma tell me
your recipe I want to really make a pie
with it and grandmas starts telling you
the recipe you say tell me slowly and
she says I know take some flour and then
take some sugar and you say wait a
minute don't tell me some sugar tell me
exactly how much sugar she says about to
you say he's a tablespoon or teaspoon
and you write all of this down and then
you tell grandma could you please tell
me what are the best practices I really
need to know what is the do's and don'ts
right and then you end that we can you
invite all your friends in the morning
you get up early and you made the pie
how did it turn out to be I hear from
your laughter it was a disaster wasn't
it last time I tried it I couldn't get
the spoon out right I had to run to the
store and get the part say go to
grandmother weekend and say you know
what this was a disaster you know it
just didn't turn out what did you give
me wrong and grandma says oh it's not a
big deal i'll show you how to make it
and she goes into the kitchen he starts
making pie and she takes a teaspoon
measures accurately sugar and puts it
right no no chic she's in the kitchen
she takes some sugar and puts it right
there and does that and you're like what
was that and you say that was sugar how
much did you put enough and then you
realize that all the measures you ask
for makes no sense because people just
don't follow a speech that way well the
guys who wrote the grid
patterns book is the grandma and grandpa
in our business and the worst thing they
ever did was to write that book and
everybody said I'm going to read that
book and go to work and follow design
patterns now the point really I'm making
here is we should never design software
based on which patterns to use I want
patterns to emerge out of the design and
patterns are a wonderful tool for
communication so when we start designing
software we can say hey here's what I
want to use and what are you doing here
oh I'm using an abstract factory or i am
using a strategy here so it's a really
good design tool for communication
rather than a design tool for inventing
or creating the design itself in my
opinion now having said all of that it
can be a really good communication tool
let's talk about how we could apply some
of the patterns now these patterns have
been around for a very long time even
before Java came out but because Java
really leaned so much heavily on
object-oriented programming some of
these patterns but kind of lost in time
but we can certainly benefit because
Java itself has grown to have the lambda
expressions now and of course we have
other languages in the JVM that are as
powerful so let's talk about some common
patterns and then that's not so common
patterns as well what I'm going to do
here is to talk about iterator oh by the
way i'm going to write quite a bit of
code and the code i'm going to write is
available on my website you can download
it anytime you want her to be there for
a long time until they remove my the
website from my fingers are premised you
know axis so you can download it at any
time agile developer calm is the URL now
I'm going to talk about some common
patterns and not so common patterns and
towards the very end I will introduce
some things we can really do very cool
with functional style and function
composition which will be really very
nice way to compose application so kind
of you know hang in there and we'll look
at some cool things towards the very end
so what are we going to do here i'm
going to talk first of all about
iterators now iterators are extremely
common let's start with Java for a
minute now let's say for example in Java
I have a list of numbers so I'm going to
say integer right so very common these
may be prices Val
use whatever so let's say numbers equals
and I'm going to simply say arrays dot
ass list and let's just say this is
going to be some numbers right couple of
numbers a few numbers let's put together
now how do I go about to you know
iterate through these collections of
data well normally we use a for loop we
say four int I equals 0 I list then and
then we would say number starts sighs
and there's a mandatory pass right there
to think is it less than or less than or
equal to write all of us have gone
through that right that there's a name
for that kind of pattern it's called
self-inflicted wound pattern right
because every time we use this pattern
we really suffer through it I don't know
it maybe even illegal to use this for
loop in some states you may want to
check your local state line you know
that's how old that isn't and n really
archaic well at least what we can do in
Java is we could use a for each
statement so we could say number of
course in we use a colon for that and we
could say numbers and then we could
start printing the values out as a
number for example in Java we would do
something like this so we could we could
run through the Java code and get the
output as you can see it prints these
values but I'm going to take a shorter
route here I'm going to just print these
values just like that and I'm going to
simply say output and we'll say numbers
and just print it out so that's the
numbers as a collection but the real
interesting part is we not only want to
iterate through this like this imagine
the job given to you is to double each
of these values how many of you have you
know taken some values in a collection
and done some stuff with it in this room
almost everybody of course right we all
remember that so let's try this again so
I'm going to say a list of integer
doubled equals and what do we do now new
array list of integer right so we create
a rail list first of all empty one of
course right so we create an empty
collection what does the next thing we
do for and we say int number in numbers
and then we say the doubled value-add
number times to in order to double it
and when we are done with this whole
thing we can print out the doubled value
use out right there so look at the code
we wrote to do just that we first
created an empty collection and then we
iterated through one element at a time
and doubled each of the elements and add
it to the collection and then we printed
it out how do you feel after writing
that code dirty that's right if you go
home that evening you're tired already
and the kids run over to you say don't
touch me I have to shower first right
that's so dirty you feel about it right
there is a name for this pattern it's
called primitive obsession and Java
programmers have a lot of that we all
share that right but do we have to
really go through that length to do
something simple because notice what we
did we told every step of the way what
the program should do that is extremely
low level isn't it so we don't have to
do this fortunately anymore we could
simply say output numbers dot map so we
call a map function right there and to
this map function we simply say given an
element e return to me e times too and
that is basically simple mapping that we
are trying to do and that is Java 8
syntax right so Java 8 allows us to do
lambda expressions and it will
fundamentally change the way we write
code from now on so what we are saying
here is we are saying given the numbers
I'm not interested in iterating through
one element at a time I want to apply a
mapping function so basically we said
Matt this and given an element e apply
the transformation of e times two but
the beauty of this is the given value is
immutable as well and as a result we get
a new collection without touching the
original collection given to us so not
only is it more concise and more
expressive this is much safer as well
like what it is easy to decide how to
iterate through this but I'll kind of
keep you on the bay for that until the
very last example where we will look at
the benefit of that towards very end of
the session so we can do this pretty
nicely here in Java but let's go a
little bit to further too groovy for a
minute so I'm going to say Val over here
sorry grew weed
fine numbs let's say equals and I'm
going to create a bunch of numbers same
thing as we did on the other side but I
want to loop through these numbers how
do I do that here is groovy and I simply
say print it and it's able to print
through these values and say here are
the values in this collection you can
see that it printed it right but I want
to be able to map through these and here
is again the groovy collection I say
collect and I'm going to say it x 2 for
this collection and you can see how
that's able to respond to the collection
here and we can see that it's printing
the value twice of it so it looks very
similar to what we did collect rather so
it's did something very similar to what
we did in in the case of Java except
that we didn't have to say element but
if you do you could simply say e arrow
and then you can say e times and you can
say the same thing in groovy as well so
you can see how the Java syntax looks
very similar to the groovy syntax in
this case almost similar if you want to
find an element let's say I want to find
the first element which is a double
value how would you I'm sorry even value
how would we do that we could say num
start find and I'm going to say it is
even so this is a check to see if the
value is divisible by by two and i'm
asking him to give me that result and we
can see that it tells us the first value
that is even or we could say find me all
the double Val excuse me values and you
can see that it gives us all the values
but one of the interesting things about
functional style of programming is not
just this higher order functions where
we can pass functions two functions but
also it's about immutability now you say
how do you really deal with immutability
what if i want to find the total of all
these numbers here is an infinitive way
of doing it right we would say total
equals zero to begin with and then i
would say for example print the value of
total when you are done and in this case
i would say given a number n which is in
numbs go ahead and add it to the total
so total plus equals the value of n
itself and we could add it now this is
an imperative style we are used to this
style of programming we could do this
readily in Java but if you ask me how do
you do this immutable it would kind of
puzzle you right how would you
possibly total things without changing
anything well let's take a little
experiment how we could do that imagine
I want to total everybody's age in this
room I want to know the collective Java
experience we have in this room right
and I'm gonna start with this gentleman
over here he's not smiling anymore
because he's worried I'm gonna ask for
his age no you look pretty hungry as
well you don't have to anything to worry
about it so how would we go about doing
this right so I'm going to take a pinup
a little paper put a zero on it that's
the age of everybody to his left right
now and I give the value of zero to him
and he's going to total his own age but
remember we are talking about
immutability he cannot modify this
post-it note i give to him right so he
takes his age adds 20 but what does he
do now what can he do any any options
create a new post it note right and he
creates a new post it note and forwards
the person next to him and what does he
do he takes the post-it note from the
person next to him adds his own age to
it creates a new post it note and
forwards it notice how we're not
mutating any post it notes here but in
the end of course the value we get from
the last person in this room would be
either the age of everybody in this room
totaled or an integer overflow exception
you know just kidding so basically we
will get this value computed right how
would we do this in groovy code by the
way notice what we're going to do here
I'm going to simply say in this case a
print line num start inject and we start
with the 0 value to begin with because
this is the seed value I gave him the
value of zero and this is going to be a
carry over and I element as a parameter
to begin with and all that I want to
return from here in this code is a value
of the carryover plus the element to
find the total of all the values in this
collection so again we are using a
higher order function and this is a
different form of iterator so you let I
saw a couple of different iterators here
right we saw the each method we saw the
collect method of the map method we saw
the find and find all each one of them
is an iterator but with a different
flavor and each of them are called the
internal iterators that we can very
effectively use so you can see how easy
it is to work with these color
actions of values and nicely put things
together in the code right so that is an
example of how we could use iterators
you can do similar things in Scala as
well but I won't show that here because
it's going to be very similar to this
i'm going to show you what yet another
pattern we can use here which is called
a cascade pattern let's take an example
of this in Java first of all but I'm
going to write this in groovy but it
should be very easy to see how this is
going to look like in Java let's say we
have a mailer class to begin with and
and my mailer has some functions may be
public void to which takes an address as
a parameter I'm being verbose here just
to show this is a java code and i'm
going to say system dot out dot print
line and maybe all that i want to print
here is to so we can see that it's being
called right there so similarly i'm
going to write a method for from and
then subject and the male body and then
the send itself so this is going to be
the from method this is going to be the
subject method and this is going to be
the body method and finally I'm going to
send it I'll say simply say sending over
here so this is going to be taking the
from address this is going to be the
subject I'll say sub and this is going
to be the subject it's going to take
will say subject and here is a body that
I'm going to send to this and that could
be a message I'm calling into this and
finally here's the send method which
doesn't take any arguments at all right
so that's a simple Java code now how do
i use this Java code mailer equals new
mailer right that's a way we create an
object of this particular mailer class
and then we would say mailer dot 2 and
this could be a email from to me so it
could be my email address and i could
say mailer dart from and it could be
maybe an email from my build machine so
build act agile developer calm and then
it may be a mailer dot subject right and
and some subject is going to send to me
and then mail or dot body it's going to
be an email body content for it so
finally of course i would say mail or
dart send right now if we around this
code this is purely a Java style code no
difference key or right so we're going
to send this from here and this is going
to be the sub method there
and you can see that it's running and
but look at the code for a second
anybody here who has written this style
of code before of course everybody in
this room how do you feel about this
dirty again right actually it's worse
than that those of us who work from home
this is even worse if you're working at
home and a kid walks in immediately
close your monitor right because you can
see this they look at you and say that's
what you do for a living right and they
never want to take after a profession
tried this is really big nope hard right
so absolutely this is tough now what is
wrong with this code well where do we
start the first problem with this code
is look at the duplication we have in
this code right the redundancy mailer
mailer mailer mailer mailer if you do
this to a human being don't strangle us
right that's how did analysis the second
problem in this code is look at what's
happening at the very end we call the
send method and now we say do I we use
this mailer object or not what's your
answer don't know and then you say go
read the documentation right how do you
treat the documentation right
documentation don't give us anything
these days right I mean honestly the
other day I was reading a function the
function name is called pass through and
honestly I didn't understand what pass
through means so I went to the
documentation and the documentation was
very helpful it said this function
allows you to pass through ok that's
excellent right very helpful so how do
we deal with this kind of function right
so here's an idea even in Java we can
use this this is called a cascade method
pattern and I'm sure you've seen this
pattern in you know tools like Jews are
easy mark and various other tools I'm
sure you've seen this and this cascade
method pattern by the way another
favorite name for well I'll come back to
that so basically what I'm going to do
here in this pattern heirs to the very
end of this function I'm going to simply
say return this and every function
returns the current object the context
object right and so they are returning
that this object at the very end so now
what I can do in here is simply remove
all these semicolons at the very end of
these so those are gone
I will remove this mailer here and I
will remove this noise from here as well
so they can all kind of you know tag
along and execute this through so this
is going to be all these functions I'm
going to lower the phone so I can
actually see what I typed so in this
case I have the return this in each of
these functions right there and then
finally at the very end of this function
i created a mailer i create a two and a
from a subject in a body and then i
finally a close it with a call to the
send method itself now what is what's
happening in this case let's see why
he's giving us an error in this case
anybody sees the problem of course the
void methods of course of course so I'm
so used to working in dynamic typing
that I don't care to give the type but
let's put mailer here that should make
the compiler happy right there you go so
we are able to return that so this is
called a cascade method pattern but if
you want to use a different name for
this pattern there's a very friendly
name for this pattern it's called the
trail a train train wreck pattern right
because you kind of kind of record like
connecting these things together and of
course you can get very creative with
this pattern along the way in order then
returning that this itself you can morph
the object you create and as a result
you may receive an object of one kind to
this function but create another type of
object and then it can flow through a
nice interface and you can tighten it
with the interface functions so there's
quite a few interesting things we can do
with this pattern itself but let's say
we don't want to do that we don't want
that we want a little bit more fluency
now we can get a little bit more fluency
but what I'm going to show you here
unfortunately he's going to work in
groovy but it's not going to work in
java at least not yet and the reason is
we're going to use two things together
we're going to use the lambda
expressions but they're also going to
use a GUI magic here and the groovy
magic is a concept of delegates that it
has so let me show you what you can do
with this the first thing I'm going to
do here is to make the send method
static over here so notice the send
method is static and as a result in this
method I'm going to create an object of
mahler right here so i say mailer equals
new mailer created an object of mailer
and
i'm going to say in here block dark and
i'm going to send the mailer to the
block where the block is a closure i'm
going to receive as a parameter so
notice what we are doing here rather
than calling a function on this object
we're going to send a function to this
function and that function is going to
be this block function lambda expression
after this part we can do in java 8 as
well we create a mailer object we pass
the mailer to this block and then when
it comes back we're going to do the
sending operation how does this help the
beauty of this approach is we no longer
have to be calling the new on this
object anymore so we're going to simply
say mailer darts end at this point and
we got to get a mailer object on our
hand and then I'm going to grab all this
part and then move this right here and
we could remove some of these noise from
here as well and then we could just call
this directly from here so we can see
how that's working as you can see we
have removed quite a few interesting
things the first problem we addressed
here is it's very clear what happens
after the send after the scent is over
the object doesn't exist on our hand
anymore right so as a result when we get
out of this the mailer is gone / if we
don't have to worry about it right
that's one of the advantages but you say
wait a minute but that's great but this
noise is still there right and how do we
get rid of the noise so let's get rid of
the mailer from here and run this and
that doesn't work really does it no well
what do we do it turns out that groovy
closures have a special property if you
call something on it that it doesn't
understand rather than complaining to
you like you just did it will just take
one more opportunity to say let me check
with the delegate and if you have a
delegate assigned on this object it will
check with that i like it and say hey do
you really have this method if so i
would like for you to handle it so
notice what i'm going to do here i'm
going to go back to this code and say
block dart delegate over here equals
mailer and now I no longer have to send
the mailer to this function and when I
execute this you can see that in this
case it works like a charm now basically
the idea is that when you attach a
delegate to this
Jack it will take all these unhandled
methods and route to the delegate and
say could you please handle it now
without going into details unfortunately
I don't have time to dig into these
details but you look at this code and
say that is two lines of calls you have
to make that is not groovy right because
I'm groovy we should do everything in
one line of code right you know that so
absolutely we can do that so we can
simply remove that code and say simply
mailer not with block and that's good
enough for it to handle it there's a few
more details about it but unfortunately
I won't be able to go into those details
right now but look at the beauty of this
it leads us to something fairly
lightweight kind of like a DSL kind of a
call if you will and you can even go to
the extent of making all of these guys
single code to make it really
lightweight if you want to so if you do
this really right notice what happened
in this case you can notice that how
lightweight this really is and if you
run it it works but it is a beauty right
if you go to somebody and show them this
particular block and say what does it
look like what are the chances they're
going to look like that looks like gooby
code right only if they are groovy
programmers so this looks like more like
a configuration data so data becomes
code and code becomes data it becomes
very easy to create BS elves or domain
specific languages very easily in this
language and that's exactly what we did
using lambda expressions and groovy
fluency together the next pattern I want
to show you is one of my favorite
patterns it is called the execute around
method pattern and i'm going to use
scala here to show you this example well
actually let me show you this example in
java first so let's say for a minute
that you are working with the class that
is expensive so class resource and this
class resources expensive class so
public resource and we will say here
output create expensive object all right
great now have a function called public
void and let's call it as up one and all
this is going to do is simply say up one
over here so we know that we are calling
operation one similarly I have an
operation to that I'm going to use here
and that's going to simply say
operation to and of course this is an
expensive object imagine for a minute
that I write a finalize method what do
you think of the idea finalize method
yeah great go for it or boo don't do it
boo don't do it this reminds me of an
experience one of my clients called me
up one day and said we got a problem
with our code while you do code review
maybe you can help us find it and I
asked the boss what's the problem is
that go talk to the programmers they
will explain to you what the problem is
I went ask-asking programmers and one
program explained is the best and he
said our application works fine most of
the time I said that's great tell me
when it doesn't work he said it doesn't
work between 7 15 and 9 in the morning
I'm like damn that's awesome you're
predictable every day is that no only
monday through friday right it works
fine saturday and sunday so I was kind
of puzzled what would happen monday
through friday well it was a large
company with a hundred thousand people
working for them you can imagine right
people come to work around this time and
of course this was a portal application
as i started looking through the code i
realized that these guys were creating a
database connection in their object and
in the finalize method they were
releasing it and of course the day Liam
said look I have a lot of memory I don't
have to release these objects so as the
code was running it would create these
connections that would never release of
course the exceptions were not being
handled properly and as a result things
kind of ended up failing once they
understood this was the problem I wanted
to make sure thats really is a problem
so what I did you simply went in and put
a little method called close and in the
close method I did the cleanup right so
i just said clean up right so this is
where I release the connection what have
you and to make sure this is actually
working all that I had to do was this so
resource basically let's say start with
the resource object I want to create so
resource basically here so let's call it
resource equals new resource and then of
course resource dart up one was called
resource start up to what's called and
this is kind of like the code they had
in the beginning right and all I did was
to make sure this is being cleaned up
properly I call the clothes
and of course once i call the close
method the problem was gone poof and and
they were kind of doing a little
profiling and they said well look at
that the problem is really gone but the
real fun was that afternoon the boss
comes back and says how is it going and
the team said well we fixed the problem
so he was obviously very excited to hear
this he said what did you guys do and
the team said well rank it asks us to
add that one line of code and it fixed
the problem and then it was a little
pawson day and then he said what else
did he do well that's it and then I
heard them say do we still need to pay
him right so okay fine we could we could
have this little you know called to this
close method great but this logic is
still flawed what's wrong with this say
it again for me exception handling right
what is operation one or operation to
through an exception we're in trouble oh
here's an idea let's put a try block and
then within the try block we will do
this and then in the finally block will
clean it up so we have to write code
like this what do you think too much
work and this requires discipline and if
you ask me to do this I'll forget this
most of the time right and then you come
back and say programmers should have
discipline you got to know how to write
code and then we write this in effective
Java right I mean why force me to do
stuff if this is the right way to do why
don't you make it easy for me to do it
the right way well java 7 has a
wonderful feature called a RM remember
that automatic resource management
anybody aware of that yes so more of the
story never trust a feature with the
word management in it right why the
reason is the way you would do this is
you would say try and you would say
resource you would put the resource
right here in this call and you would
then have to say all right here is the
try block and then i'm going to say call
this within here but the nice thing is
you don't have to call the finally
method of course if you run this it's
going to complain to you because it
doesn't have a clue what
clothes Methodist and clothes will be
called automatically here so it says for
this to work you have to implement an
interface called Auto closable I mean
that's Java way of doing things right
for everything we have to solve will
have another interface to solve it so
right there is out a closable interface
now why don't they like this I mean just
a grumpy old man who doesn't like this
well partly that but the problem really
is that the try still requires us to put
a try block if I don't put a try block
we are back to square one in fact this
is exactly what dotnet dead back in two
thousand one with the using statement
and I hate the using in dark net as well
and so this is no different from that so
what is it that I'm really trying to get
to what I'm saying is if this resource
is really that critical if we have to
release it right away let's make that
happen by design so the programmer
doesn't have to know this boy please
absolutely I have to still remember to
do this otherwise be back to square one
and then you have a bug in the code and
you got to fix it and that becomes a
problem and and we also use this for
another purpose i'll talk about what the
purpose is a little later but notice
what i'm going to do this is java 8 by
the way and you can do this in java 8
and i would not definitely use a RM
anymore and java van java 8 comes out so
notice what I'm going to do I'm going to
make a spurt of all I'm going to make
the constructor private isn't that
awesome and I'm going to make the close
method private so now the programmer
says man how do I use this resource I
can create it I cannot close it right
yeah now we got them thinking now I say
public static void use and I'm going to
provide a use method and this use method
says use resource as a interface i'm
going to send to it and i'm going to say
block let's see where this is going to
go in just a second what does this use
resource and i'm going to write an
interface here so interface called use
resource assuming a type interface
correctly interface called use resource
and this only has one method called
apply
I which takes a resource as a parameter
let's call it resource right just hang
in there with that interface right there
for us so I write a use resource method
but how am I going to use this really
well you see I can no longer create a
resource like any of these so what I'm
going to do instead is simply say
resource dot use and I'm going to
provide a block of code for it and the
block of code says I'm going to take a
lambda expression here and I'm going to
simply not do a whole lot within those
lambda expression let's start with this
for a second right so that is all I'm
starting with maybe it needs a little
bit of something here let's say you know
to return pew or whatever right so
basically I have a little lambda
expression in this case now how is this
going to help us really the point really
here is that the use resource is an
interface I'm going to call the use
method and I can no longer call the
resource and the clothes and of course I
don't need this auto plausible method
anymore all that is gone from us right
excellent so how would i go about to use
this method now method use in the class
resource cannot be applied to given type
not here why it's complaining that but
we'll figure out so now what I want to
do here is simply say within this block
of code I've got a resource on my hand
I'll say resource top one here and
resource start up to here but the beauty
is this I enter a block of code right
there the lambda expression and when I
enter this the resource has been created
and hand-delivered to me and when I
leave this block of code I returned
control back to the use method and the
use me that can clean this up for us so
we don't have to do this manually and so
there's an ottoman automatic
instantaneous garbage collection that
can happen for us right at the moment
but how would this really be possible so
what I'm going to do here is to create a
resource object will call it resource
equals new resource but I can remember
to this one's right I can as an author
of the class write a try block I can
write a finally block and then within
the finally block I'll do the close
method remember this is the author of
the class now the user of the object and
then
done this I'm going to yield control and
i'm going to say the block is going to
receive the apply method is going to
receive the resource given to it so the
point really is that if somebody wants
to use this they call the use method and
then the use method is receiving a block
of code before we enter the block of
code we create this object we even troll
to the block the block does whatever it
wants to do when we come out of the
block will do the cleanup and go home
this is called the execute around method
pattern because around this code you're
doing your pre and post operations
sometimes people call this as a loan
pattern as well because it's kind of
like kind of like renting a car before I
rented the car they check they clean it
up and give it to me when I return it
they check for damages and accept it
right so it's kind of like that you have
little loan pattern going on here as
well let's make sure this is running
before we continue further with this so
I have the try and finally block what am
i doing wrong here so we'll call it as
use a resource uses the method the
public static void and I've got the
method here so I've got those two
private and I have the resource over
here so let's see if we can able to find
the error let's see what the error tells
us actually okay fine so you can see how
the cleanup happened and notice in this
case whatever we do here right just to
show that it's working yield control so
let's say output yield control right so
we are ile de the control to this
particular closure given to us a blob
given to us so we ended the control
right there we did the operation what
you do in your block of code is entirely
up to you let me show you tell you what
I where we used this this is really good
for our resource cleanup certainly but
that's not the only purpose of this I
was working on a project where we had a
service dear and in a service dear we
had to do transactional and I notice
very quickly all the service to your
classes have the same boilerplate code
where we'll create a transaction do some
stuff with it and clean it up after that
and I got really annoyed with this
because it's copy and paste of the code
and then changing it so what we did
quickly was we created a class called
transaction class and then we wrote our
a method called run in the context of
transaction which would return a
transaction object in the block of code
and so all that we had to do now was in
a record say transaction dot run in the
context of transaction who would receive
a transaction object right of a code and
then when we leave the block of code the
method would then in the end up in the
finally block would smell the
transaction and find out if there was an
error if those error it will roll back
the transaction otherwise it would
commit it so we then had to really
simply use that method and we didn't
have to create transactions anymore but
look at the beauty of this approach this
is a first step towards a benefit but
imagine you are interested in unit
testing this code and you don't want a
real transaction a real database it
becomes trivial because the function
that calls this can give you a
transaction a completely different
context right it could be a database
transaction a remote transaction or a
market transaction what have you so this
really takes you to the next level of
dependency injection and inversion and
that's in the right direction so those
are some of the benefits of using this
approach as you can see that's one of my
really favorite patterns now I said how
you could do this for some of the two
approaches one is to resource clean up I
also showed you how you could do this
for really performing these transaction
eng but let me kind of bb-8 from this
example and talk about something else oh
by the way you could do this in Scala as
well and the concept is really the same
except it's going to be a lot more
cooler to do that in Scala that's all
right so so i'm not going to show that
to you right now all right so let's talk
about what where else we can use you
probably have used j unit test cases
right so let's say for a minute we have
a test called avoid test something and
in the test to something i'm going to do
this i'm going to say you know object
d'art some method I'm going to call some
method and I got a bunch of code here
then I say dry and I say catch and I say
some exception e x and then i'm going to
say here usually I like to put a smiley
here to say that I'm expecting an
exception and then within here i'll say
object d'art some you know do something
so do
do something and I want to do something
to throw an exception on me so i'm going
to say fail expected exception expected
exception for whatever reason it is
sounds familiar right so this is called
an exception test now of course you
probably have written test cases like
this and you realize gosh this is so
boring to write in this verbose manner
and when J unit for came we were excited
because in j unit for you don't have to
do all of that right so you could simply
say test and then you could say expected
exception equals some exception dark
class and then you could say public
something like this right void and you
could say void pests something and then
within this method you could simply say
object d'art some method and then you
could write all these methods you want
to call and then you could simply say
object d'art do something and and that
was really cool isn't it I hate this
approach and and I refuse to use this
and the reason why i hate this is
because this is an example of a code
that is not concise it's an example of a
code that is Turs there's a difference
between being concise and being terse a
concise code is helping us a terse code
is hiding to stab us right and that's
what this code is doing right and why is
the such a bad idea and the reason is i
want my unit test to pass for only one
reason and that is the coldest doing
exactly what it's supposed to do notice
the reasons for which this test is going
to pass this test will pass if do
something throws some exception
absolutely that's great but
unfortunately this test will also pass
if any of the code in the test including
do some method and any other method that
follows any of those throws an exception
this test will incorrectly pass and I'm
not happy with that right because I
don't want my test you ever pass for the
wrong reason so what do we do about this
the beauty is we can use lambda
expressions and and use
execute our own method pattern to solve
this problem let me show you how you
could do this in Scala and groovy today
and hopefully you can do this in Java 8
as well when Java 8 comes out with
lambda expressions so the way you would
write this in groovy is you would say
public void tests or do something right
to test something and in this method you
would simply say object d'art you know
some method you would call these methods
like you normally do whatever those
methods are but then in the very end you
would say should fail or something like
that right and when you say should fail
you would simply say what exception you
expect so some exception and then you
would put the block of code object d'art
do something and notice how we contained
that to that one line of call so it is
going to call this lambda expression
evaluated if that lambda expression
through that exception called some
exception this test will pass if that
lambda expression doesn't throw the
exception this test will fail so it
really narrows it down that's an example
being concise without being terse and
again we are using the the pattern
called the executor and method pattern
here but essentially for a very
different purpose so that's one of the
reasons why I think this is my favorite
pattern as this pattern can be used in
so many different ways nicely to
formulate our you know objectives in
code and get to a very concise code as
well so we looked at quite a few
interesting patterns the next 2 i'm
going to show you are pretty interesting
in terms of pulling in stuff and mixing
them together in the case of groovy
mix-ins r run time in the case of scala
traits are compile time and there's
going to be a little bit of redundancy
in this example I apologize for that for
those who attended my scholar talk
yesterday you've seen this most of this
already but for others this would be new
so i pologize bear with me when I go
through this so in terms of the
functional composition that will be
relatively new I've been spoken about
that here so we'll we'll get to that so
what is a mix in and what is a trait and
what can we use that for I want you to
think about a design problem just for a
few minutes and and when we finish this
I'll come and show you how to do this in
in in scala for a minute in india and
groovy rather after afterwards so let's
switch to scala and look at an example
here so let's say class called human and
i have a class called human and this
class human has a method called listen
and the listen method simply prints out
a print line basically in this case I'm
just going to print out I am and then
I'm going to print the name and then I'm
going to simply say listening right so
this is going to be simply printing this
message called I'm listening and I'm
going to try this out so let's go ahead
and create a object so Sam equals new
human and then i'm going to say Sam dart
listen and call that method here of
course I need to provide what the name
is it's going to fail because of that
but let's go ahead and fix that real
quick there we go so let's say Val name
is well actually we can give it up here
so let's say Val name is going to be a
string so I can give a name for this
object as I'm creating it and then call
the listen method now this is not
something really unusual right we start
modeling applications and very quickly
realize you put a listen method in the
human class what does listen god do with
the human right who listens by the way
yeah well he says he does well we have
to take with the other better half of
viewers to know if you're really
listening right we got a we all have
selective listening well I'll tell you
who listens a friend listens to us I
mean that's what I've been laying on
friends for right you even you're really
down you want to go to your friends and
say you know what my job sucks and your
friends say is tell me how it sucks how
can it listen to you you say well it's
not my job that such it's my boss that
sucks and what does a good friend say
tell me how does your boss up not so
good friend says maybe you suck not your
boss right so that's how we know who is
who is your real friend but but there's
another friend we cannot ignore who is
that friend somebody who listens to you
but never talks back to you dogs are
awesome friends now we got a very in a
hard predicament on our hand imagine
you're in Java for a minute in this
wonderful world of Java you create a
class called human and it has a listen
method and
and your requirements change on you now
you realize you got a model a dog which
can listen to here's one option I can
think of very quickly inherit dog from
human no dogs don't like it what would
be your Java way of solving this problem
Oh a friend double interface that's
correct so we create a friend herbal
interface what's the next thing we would
do inherit human from friend and in her
dog from friend of all right will
inherit from those two those two classes
from their interface then we scratch
overhead but wait a minute where do I
put the listen method it's a common
method he put it in the interface and
interfaces cannot have implementation
right why interfaces don't do anything
kind of like my boss right it's
pharmacist you a lot but never delivers
anything right so you need to really
implement this in a concrete class but
how do we do that hey here's an idea
will create an interface called friend
the bowl will create a class called
human create a class called dog they
both inherit from trendabl then we'll
create a separate class called friend
double abstract class which will have
the interface method and then from the
human class will call into it from the
dark class will call into it make sense
well if that's what we're going to do
why do we have to do that work in the
language do that for us that's exactly
what Java does I'm sorry scholar does so
in Scala traits are nothing but
interfaces so how I'm going to use it is
I'm going to simply say in this case
that I'm going to create a trait called
friend so I'm going to say great called
friend and the friend is going to simply
have a listen method and within the
lizard map third I'm going to simply go
ahead and call this particular class so
it's going to have a name so Val name
and I'm going to simply say this is
going to be a string and of course it's
not implemented then in the human class
I can simply extend this over here and
say extends extends friend right so I
could do this now what i can do is
simply create the human and call the
lizard method on it but look at the
beauty of this we could create a class
called animal and
animal can have a name of course so we
could say a name and that's going to be
a value as well so let's make it a
string and now I can then create a class
called dog and the dog class can say
oops there we go dark glasses extends
from so override the value name so name
which is a string and this is going to
extend from animal right so this is
going to be the name that I'm going to
send to it but I'd say with friend and I
can mix in that parade at compile time
so we could say buddy equals new dog and
I'm going to create a buddy dog and I
can say buddy dot over here listen and
call the listen method on this
particular dog object right so how does
this really work in this particular case
so override a value name which is what I
want to create here value override name
so I think it's the other way around but
let's figure out what the problem here
is oh what did I do oh what a picky
audience fine so thank you so right
there it's it's able to run through that
right so notice how we didn't go through
redundancy we nicely though the
interface or your treat and Scala
quietly create an interface for us an
anonymous in your class sorry an
abstract class for us and then mix those
two n it did everything we would be
doing otherwise now let's extend this
example one more time class saw a cat
and cat is going to extend from animal
as well and this is the beauty in Scala
is now I have a cat class so I say Val
alpha equals new cat and create a cat
object will call it Alf and I want to go
ahead and call F dot listen will that
work no that's because cats are not
friends right cats are evil but you say
but my cat is really friendly well fine
what you could do is don't mess with Alf
it's a lost cause but your cat right
your cat can say equals new cat let's
let's say this is Oscar here and Oscar
says York
at dot and then we could say listen but
right on this instance we can mix in a
friend so only instance level mix in
rather than class level mix-ins you
could do very similar thing in groovy as
well using a mix in by simply creating
the object and doing a mix in and then
add that so I won't go into the detail
right now now unfortunately though
because I have eight minutes I'm going
to skip this decorator but get to the
real functional composition because
that's something that in cover so far
and I'll be really fun to see how that's
going to change the way we do things so
you can do this in Java as well when
java 8 comes out so there's really good
hope for us so let's look at an example
here I want to first of all make sure my
internet connection is up so let's make
sure because i want to connect to the
internet to do this seems like it let's
do this so pickers so i'm going to bring
up a bunch of ticker symbols so i want
to go out to the web and look for some
ticker symbols and values that I want to
connect to so I got a bunch of thicker
symbols up you know just a value set of
values right it's a value that I've
created right here that's what I was
missing the double coat right there
there we go so now that I create this
stickers I want to go out to yahoo and
ask for stock prices so get price from
yahoo as you can see i write code really
fast so right there is a you know code
to go to yahoo and get the price not a
big deal but my problem on my hand is
this I want to get the highest stock
prized picker less than five hundred
dollars that's my problem right so I got
two functions i need define is less than
500 and what is this going to do notice
i have a stock price class on my hand so
this is going to simply take a stock
price as a parameter and simply returns
stock price dot price is less than 500
right so that is all i'm returning right
so stock price is less than 500 that's
my ease less than 500 make sense so one
more function a pic high and pick high
takes to stock prices stock price one
and stock price to write and very simple
again and what does this guy do he
simply says if stock price one stock
prize
one price is greater than stock price to
dot price return stock price one else
return stock price too because if it's
an expression in Scala we could do this
so I'm done with all my preparatory work
this is simply to get me the highest
stock price now think about this the job
of way of doing this how would we make
this work well our first step we got to
go to yahoo and get all the prices for
the stocks isn't it see if this makes
sense the first step is that a variable
tickers and the prices equals so this is
going to be a list of stock prices and
this is going to be an empty list I'm
making sense like the map example I did
a long time ago right what appeared to
be 40 minutes ago and then what am I
going to do for a thicker in tickers you
can relate this to the sky java syntax
and what am I going to do here pickers
and price equals and I'm gonna say get
price from yahoo for the given thicker
and i'm going to add it to the tickers
and prices so what I'm a done so far all
that i did so far is to go to yahoo and
get all the ticker prices for all this
stock prices for all the tickers i have
let's make sure this is working first
before we go any further so i'm going to
run this code and it's going to go out
the yahoo and get the stock price for
all that pickers i have this takes
anywhere from 20 seconds to three days
normally to run and and we'll get the
prices really quickly mix and so forth
notice how step by step we are moving
right what's the next thing I'm going to
do okay now that I have all the stock
prices on my hand I got to only select
those that are less than five hundred
dollars right so right there we got the
prices what's the next step get all the
prices less than five hundred dollars
how do I do that VAR tickers less than
500 equals so this is another list on
our hand right stock price equals to a
empty list for stock price in pickers
and prices right tickers and prices and
I'm going to simply say in here
if is less than 500 stock price go ahead
and add this to tickers less than 500
equals and this is going to be stock
price on our hand plus that occurs less
than 500 so this should give us all late
occurs that are less than 500 leaking
sense very simple loop right nothing
complex the syntax is different but it's
a traditional for loop our last call
what is it VAR high-priced equals stock
info empty comma zero point zero that's
our initial value that I start with then
I say for start price in pickers less
than 500 high-priced equals big high
high priced and stock price when we are
done with this whole thing print high
price out because that's our highest
price talk less than 500 make sense well
before i run this let's do one more
thing let's go up here to the get price
method just for the fun and i'm going to
print out getting price for and we will
say thicker so we can kind of see this
actually happening so let's go run this
little code it should go out and get a
stock price for each one of these guys
and report it as it's running it should
report it right so right there it went
and got all the prices it reported right
in the end that the Oracle was hey what
a chance Oracle is high price right here
so I want to open up a command prompt
here so we can actually see this run so
bear with me here so I'm Scala there we
go so what I'm going to do is simply run
this on the command prompt so we can
actually see its Carla and then I say
sample darts column so you can see that
it's ending one request at a time right
right there makes sense one request at a
time awesome let it work we don't have
to wait for it but look at the code we
wrote this is primitive obsession isn't
it we first said go get me the stock
price for all the tickers then pick the
ones that are less than 500 then by the
way pick the highest price right by the
time we're halfway through
lunchtime right that's too much work
comment all that out look at the code
i'm commenting out i'm commenting all
that code out so far so good let's do
this one more time can we take curse
what do I want to do go out and get the
price for each of that occurs map get
price happy okay filter is less than 500
reduce it down to what big high and when
you are done printed so we've simply
said go out get all these prices when
you are done go printed let's run this
here one more time again it's going
through one price at a time as you can
see right but what's happening in this
case though it is saying I'm going to go
run through but I'm going to filter
through what's happening in this case
it's still Oracle good news the market
is still open it better be the same
result but what did we do tickers go get
all the stock prices so we started with
an array of ticker symbols and now we
have an array of tickers and prices then
we narrow it down filter and then we
said is less than 500 from those values
ready sit down with me so far what is
the big deal the big deal it is concise
the big deal is it is it is less work
and the big deal is look at this I copy
this one more time and I go back to this
guy and say hey i am going to yahoo and
getting all the prices that's my first
step i'm doing a little math here and
then i'm doing a little bit more math
here so there is one drink goes to the
web and do math with all respect what is
slow here going to yahoo unless you are
a 1984 processor right i'm making sense
going to yahoo is the slowest link here
isn't it well if we can take that and
make it paralyzed that would be so cool
and you sitting at work and they're
saying make this parallel oh no
I don't want to make this parallel what
amount of change I have to make for that
dot par there you go done so notice this
for a minute we sent request one at a
time I'm gonna hit the return notice
what happens but all the requests Yahoo
is waiting to send the response back
right so you can see how it was trivial
to paralyze the code because we had used
lambda expressions and because we made
them pure so less code means it's easy
to maintain easy to modify less clutter
less noise it gives us the power and the
beauty is this right these kinds of
techniques gives power to us the
programmer because we make this world
run electronically right so these are
tools we can make use of and look at the
beauty of how we can turn around and
make this very efficient I hope you
found that useful that's all I have
thanked
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>