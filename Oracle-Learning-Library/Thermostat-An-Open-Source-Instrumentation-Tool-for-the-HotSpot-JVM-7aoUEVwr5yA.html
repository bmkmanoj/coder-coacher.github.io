<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Thermostat: An Open Source Instrumentation Tool for the HotSpot JVM | Coder Coacher - Coaching Coders</title><meta content="Thermostat: An Open Source Instrumentation Tool for the HotSpot JVM - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Thermostat: An Open Source Instrumentation Tool for the HotSpot JVM</b></h2><h5 class="post__date">2013-02-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7aoUEVwr5yA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we are here to talk about thermostat
which is a new nice open source
instrumentation and monitoring tool and
that should only we should start well we
can assume we are famous enough for
maybe we should introduce ourselves let
it snow goose also suppose okay so I am
Mario daughter work for read that as a
senior software engineer in the Java
platform I'm woman kanga I'm also
working for redhead and yeah java that's
one platform so let's start explaining
what is what is actually thermostat so
thermostat is an open source tool for
capturing diagnosing monitoring chewing
and providing the job give to a machine
that's one way to see absolutely another
way to see it would be you can say it
some kind of deformation hub very
collect and display data coming from
java virtual machine or the operating
system or whatever so various sources
basically exactly what are so if i want
to extend this concept actually all i
can see thermostat basically i can see
this as a first of all as an information
of the Collette's the vertical stock of
the information what it means this we
can go very low on deep from the camera
so collecting data from the colonel a
little bit higher operating system other
application other to the come with the
operating system memory manager and so
on then let's say that this is the most
important part what we are most
interesting is actually the openjdk
which means either uninsulated vm or can
be something more complex like an
application framework or application
server that sits on top of the
jog-a-thon machine that runs other
application that's not all i think no no
I want to take a higher level few and I
can say we can get data from horizontal
level you start with the local JVM look
at this or we can have a remote Chevy
I'm sitting in some
room was completely different content
whatever or you can even try to monitor
and do all these things with a whole lot
of JVMs sitting on various machines like
a cluster or some people like to call
this cloud whatever oh well I need
that's also the coffee or just makes
little bit over set you know I think it
does not go okay then again what it is
actually we say it's an instrumentation
to butt out what are the features of a
thermostat that we want to see today so
we have some features that are already
fully implemented work in other fish are
working progress we will show you in few
minutes the demo but what is currently
implemented just to have a very high
level overview we can call it data we
say from the operating system so we can
have vm specific cpu usage by natalia so
the overall cpu usage is layering that
comes from from the can or we can call a
memory usage again for in the case of
jar gift on machines we have several are
young memories and we can collate this
data together we the region's the
garbage collector and see profiling
across time so that we can see how an
application behaves across time and you
can actually call it is with GC
invocations and this is implication
exactly so we can see if there are
memory leaks or if there are too many
collection heavens and so on same thing
for a trend monitoring this is also a
tool that tries to go late that data
from multiple variety of sources in the
screenshot with hey we just see a view
this is a pie chart of the execution of
a single thread there are also more
complex views that collates the number
treads in in their time with the
timeline and try to be quite accurate in
what we see so that we can collect and
analyze this
and we will also see some in heap dump
analysis and tools of and not
screenshots so di no screenshots for
this it normalizes classloader
information and we will see also some
typical usage for a for class low you
know p beguile the class loading the
grass looks the same way which is normal
but it's possible to see if something
goes wrong exhausted from from this and
ice we say we were gathering data from
of our ideas sources what are those
sources from so you have basically three
of them right now one is an JVM stat
which is in kind of internal api that
sits in the JVM and provides us data
about the running application another
one there's bit similar some jmx which
is a kind of public API for ya
monitoring JVM applications we are also
getting data from and from the PI system
from / croc in this case which is
provided provided by the Linux kernel
and yes some of the things that the
currently working on is including data
from third-party tools like system tab
or a profile for getting this low level
profiling data and those tools will
allow us to cross the border between
Java and native side so for example with
the system to happen Oh profile you'll
be able to not only look at Java code
but also when Java code enters into J&amp;amp;I
or native code we will see how well they
interact and what kind of cool is also
for example 2 analytes I don't know
let's say we have a trailer BS a little
bit funny but from the job interview
it's all fine but then we can see if
it's not in our system call or something
works or something that uses so all it
does work what is the architecture we
choose for for our tool in a moment with
its widest but anyway their architecture
is this we basically have a division
between who is collecting data and with
analyzing this and where this data renza
load this picture makes it very very
generic on purpose because we want to
support
a number of different situation the very
simple high-level overview is this we
have monitoring agents those agents just
call it data they can react to some
heaven that are guided by the clients
but generally speaking they collect data
from all the sources they are capable of
then they put this information in a
storage facility and clients application
which are thermostat clients to call it
this data and analyzes and inform the
user events or other situation and the
important aspect is that those
monitoring agents are very small and
lightweight they don't incur significant
runtime overhead we can run this on in
production machine without worrying that
it will slow down significantly anything
and they soon as day after day they just
push it off to the storage yeah good
this is always the cloud yeah so we were
saying about the agent so we say that
agents basically a very stupid in nature
because you just call it data but the
client actually do a lot of computation
and work where we have a number of
clients so that we can add up to
different situation for example let's
suppose we want to monitor so I am a
developer and very unhappy because my
application crashes all the time
consider consumers a lot of memory I
really cannot figure out what was going
on it's not that I'm going to configure
a cloud environment just to see a little
bit of help Dada know so what I do is
just start the client the GUI client the
lid to the agent then I don't care about
the rest then I am a system
administrator I don't have any X 11 or
graphics development the machine but I
have a remote ssh session what i do then
we can we offer a command-line tool even
if the GUI is hopelessly the most
advanced even in front and functionality
in terms of functionality the GUI allows
provides a shell that gives the same
information as the graphical application
because they share the same controllers
code but also gives the chance to to
scrip the the functionality so we can
for example list a vm perform a net dump
we will not get the fancy graph but we
will get a lot of numbers that we can
then parse in a you know in a script so
it can be part of the work of work for
those things not only did not we also
have something gets in in the play
dating yeah we currently working on
eclipse plugin and it will be useful for
you know including the sorting in
developer workflow oh this is work in
progress and another thing is that front
end you can use to almost at from your
browser this would be a good thing to
have for web developers obviously but if
I up their application and applications
/ they can go to you a look at
thermostat and see what's going on I'm
thinking about the west front and I last
time I heard from somebody inside of
source we had to actually web front-ends
not actually from 10 in in a street
census two components what is about we
are working on two components one is the
web front end and the other one is a web
service which provides a kind of common
API for this storage so when we will
come to this later basically you can
come can write an agent or client
yourself and then interface them lift
this web servers and write something so
we direct api for four ok like a PRS on
the rest it's not really nice ok but i
think i have some use case for this for
example they are be easy to plug this in
I don't know another shift
implementation so that you can have your
web front end this we call it actually
web storage because we will see a little
bit later in more data storage
implementation can be
set of web service is actually surface
this would be useful in a case where you
have monitoring agents a cloud solution
like openshift that collects the data
you don't have to care then or setting
up your classes or databases scalability
because it's taken care bye-bye open
shift in this case and then your client
it can be also the web wizard but now
there is the big big question I know
that everybody wanted to give to sadies
in the question and answer but we will
anticipate why we are doing this from
scratch another two why not choosing I
don't know we shall we amour je rocket
whatever right that's a good question
and so we had a couple of ideas what
such a tool should do and so one of this
is you wanted to be able to monitor
multiple up too many hundreds of holes
so we added some scalability
requirements you want this this tool to
be extensible by plugins so that people
can write their own extensions or data
agents inside their own applications or
stuff like this we want to be the data
collection to be very lightweight so
that we don't incur a runtime overhead
in production systems for example anyone
this to be open source and editor now
turns out none of the existing tools
provide all of this those of those to
provide a subset of those but none of
them really provided us with ya all of
those things that we wanted to be right
so down and start at all yeah but then
they also did about the license I put
this the bold in this slide because it's
important to know that this is the same
licenses openjdk itself so it's closed
what GPA pass the class but exception so
we we were talking about this in CBD how
does it work what what are the
technologies we are using under the duck
sure it will allow the assistance e-bill
but first of all especially by for the
for the buoy client because this is
where is mostly visible when
implementing it but this is why for the
wall thermostat
a application stuck this is based on iOS
GI so we have a set of services that are
exported that are used by plugins
implemented it basically providing you
plug-in API for thermostat for every
aspect so it's possible to for example
let's say I want okay the developers
were not smart enough to think about you
know collecting some specific kind of
data will be possible to esten this
function I to create a new data layer
subscription like this absolutely yes
you can write your own agent that does
collect some data and push it off to the
thermostat storage and you can also
write your own GUI or command line
client or eclipse extension or whatever
to actually show this data to sue's
admins users and this is you said
actually everywhere in thermostat
already because they're all the
functionalities provided via plugins so
there is nothing including the default
thermostat is so true we will see this
that was not see this yeah okay so we
call the demo time the mark Ronald f it
hopefully no hopefully not let's see if
is true or not so
so this starts so actually this is
starting the agent ass are collecting
data from running vm this is for
starting the GUI it's going to take a
bit because of the network
you did pretty demo God's right yeah I
know I this is the prob is a mock crying
of that said no
does it comment on the cork screen yes I
hope so that's the man what I'm
interesting yeah should be there by now
something is up anyway
that's right again I don't want to stop
yeah okay what's there no it's going to
be
yeah so this is what happens when we
were on development code ever do this
again okay so okay this is how I present
a very basic interface for the for the
week line there is an issue collected it
says the number of gift on machinery
currently throbbing in the life then you
can go on host overview it basically
tells you about the overview the
processor speed network interfaces and
so on processor memory consumption so
let's say some let's see some use case
where you put it sorry
so for example let's see I want to
analyze an application this i created
this before it's an application that
keeps using all the memory so it always
growing role growing since there is out
of mind this machine is probably not
going to crash while doing the demo but
you can see how it behaves first of all
you can see cpu usage of the application
with see garbage collection psychos it
doesn't do anything because I mean the
purpose is this what will it will at
some point actually because they are
different machine tries to be alive so
we can start recording thread this since
this is a very expensive operation we
don't enable this by default we always
give some control to the user so this
start tracking treads you see we have
some beyond capabilities that we can
transfer if the vm doesn't support
everything we have a list here thinks
that we can track a monitor get a table
with the overview and the timeline what
do the colors 24 so the colors are there
is a legend here you can see there are
this represent of the various state of
the thread so typically we will see
running both blogger waiting and time
waiting we will not seen you and
terminated because the virtual machine
actually doesn't give us this
information if a try this terminator
just doesn't appear anymore but we can
we still record this ok
so as possible to have some data by
clicking on that
getting a thread down as we shown in the
screenshot before this actually lets you
see this memory leaking application
growing its memory usage over time yes
exactly yes I don't hear this is the
dump is from the vm that is being
triggered so is the age and it is
collecting it but it's analytes it in so
what happens in this case when we
request at red help Dom the agent there
is a communication channel between agent
and clients between akshay between
client and agents and the clients
request the threat they have dumped the
agent perform this on the BM there is
been struggling that moment and then it
stores the the Dom in the database but
it doesn't perform any analysis on this
so there is this road data in the
database and then the client perhaps
this data is informed by the age and the
day is actually in unit account so since
happen is possible to do more dumps of
course so and since this information
then stays in the database because it
can be analyzed later then it's
collected there you can this is a
histogram it shows us which types of
objects take up how many how much memory
what usually happens is that shower
weights are the very top of them and
then you can also browse search for
specific objects and what would be a
good type I don't know hashmap yeah
probably ashman is stuff existing or
string also no strings ash map is ok so
you can search for specific objects here
you can if you found something you can
follow the object craft foot by
referrals or bio references and you can
actually say okay find me the route to
TC okay this window comes up somewhere
this is trenches no wait let me try
again because my B's somewhere is the
application window yes they are it's
alright sub sorry it's my fault so
easier exactly and it shows you the
connection to the GC route why is this
object head in memory if you have a
suspicion that this guy is leaking you
can find out why this is the case so we
are still organizing the UI anyway but
the function ID is quite advanced
they're ready because it's possible
exactly to find GC roots and all the
information i want to show something
else now is very interesting is the
memory use
so those are the various region you want
to stay a little bit more in detail go
straight to the hip is divided into
various and regions and you can see here
at the top of it is the very short-lived
object region it's called Eden there are
various other ones and bottom years to
perm region which is latest open to UK
it's gone but we still have it here and
you can see how objects are allocated on
the Eden region here in the other panel
and then over time they progress into
the old region here this is why this guy
keeps growing yes the first one is the
most active one obviously what else we
have you yeah and then you can relate
this to these you see activity whenever
this CC guy kicks in you can see objects
being either moved between those regions
or d allocated or whatever or maybe
notice is why we are leaking here yes
exactly and those the graph shows there
if you see for each graph there are
actually a kind of information first of
all is the timeline so you can correlate
with the garbage collection so how the
memory gets allocated or collected then
there is this which means is the user
thought there is a capacity and it shows
you how much of these capacities are
currently use it but then this capacity
is also dynamic it means that there is
possible that you get increase it over
time and this is struggle by the second
bar right which is the small one here
and finally the classes I was saying
before most of the class loader graphs
look the same because the application
time through all all the glasses right a
start-up and this is why we you get this
huge peak and then establishes the true
believers yes
so close this lemon and the application
didn't crush you can also show some bits
of the command line interface yes we
want this their common is this a bit
broken
slow or no no the shamen be nice okay it
usually works like this you enter
commands you put parameters like what we
can do something simple like p.m. oh
okay and he would an idea let's put
first one here Oh study
so this command vmstat will give us some
just general information it's just
columns of numbers that we can later
process or whatever basically all the
functionality that we can have in the UI
we can also have on the command line
witches could be useful for scripting or
for you know remote monitoring if you
only have an ssh connection or something
like this you can do that for us yeah
this is a body for the name on let's go
back to the presentation yeah holy
mackerel def it kind of weapon a little
bit at the beam ok so what sex what
we're cooking so first of all we want to
have known my support what is no and you
must support means that we want to be
able to find out when objects are
allocated on one thread assigned to one
processor and then used by other threads
and on different processor which is kind
of incurring overheads that we don't
want as we are changing up yeah this
thing is changing you want to detect
this and they provide some useful
features for that that won't be able to
actually tune the JVM live right right
running change parameters like heap size
or another GC parameters or something
like this so regarding this so not
everything we are talking here is
strictly speaking thermal stuff it was
of course part of our work is to create
some of this functionality in the JVM
itself because not everything is
implemented sauce but doesn't give us
all the capabilities for example for
tuning or changing other parameters so
we are creating also patches that we
hope we can get into a spot for
supporting for example for a new my vm
tuning same for a system top and low
profile which is very important for
low-level collection because it's on top
is exactly what can give us access to
this information from
I'm coming from the kennel you can tell
us if excited is something stuck in a
system call or something else then of
course improving the other graphs and a
good client memory leak deadlock
analysis even streaming so we want to be
able to perform live analysis of the
head instead of just getting the dump
from from the from the me and from time
to time and we already say about what
services decklist client and a web
client what we want to be able to do we
are seeing already this in a very very
in beginning of its development there is
an issue view what we want to improve
this is to give the ability to inform
the user that something is happening but
also to give some instrument to call it
the program so for example we can give
some tips memory is low increase used
different data structures or do any kind
of analysis that can be useful for ever
the user then this what we call you to
mode versus drill down mode you don't
mode is basically what you've seen here
so we have week since this data is in
the database so everything is collated
it can be considered always kind of
offline analysis so that will collects
the data and then shows up we can go
back in time or forward in time and see
when actually problems started to appear
and why but there is also another whale
collating this data which is the drill
down mode what is it is not related to
the to the issues over fuel and when you
start thermostat there would be some
issues overview some kind of dashboard
that gives you information about all the
running VMS that you are monitoring and
basically show you which grams ok which
are which dreams are running with india
parameters which ones go crazy when I
don't use excessive memory or whatever
they could be shown in red and green and
yellow or something and then if you see
that something goes out of control you
could click on one VM and then get a
better you know lower level feel still
high level but can do some analysis and
eventually you can go down to the lowest
level and see which objects are
allocated or I don't know what thread is
doing what and those sort of things very
low levels of going from very high level
those eyes due to very low level ground
view of things lately Rubio idea so
still continue in the woods next time we
are we already discussed about oven ship
deployment but also it's possible
exactly for the same concept also super
something different than then Linux at
least from the point of view of the
clients that means other operating
system for the gooey clients but also
iOS Android because it's actually an
offline tool in the end even if it's
quite a real-time no so there are any
questions no no
I don't know the folk I don't know about
Jabbar of itself but if you if you
consider I don't know that it so there
sa as we said before there are number of
sources so it's possible to have
instrumentation as at the age and level
which is I think what happens in jail
broke no but it's also possible to get
data from the vm itself as supported by
the system top scriptlet so there is
something that is actually written in
the gospel call that when the script is
a stolid and then it gives us this
information so it's a sum there are
multiple sources for this that the goal
is always to be lightweight as possible
so you have seen in there in the demo
everything that is expensive for the vm
require manual intervention from the
user so it's possible to perform an appt
dump you know in our running clustered
application but this is expensive so if
it's needed then the user must do this
manually
okay yeah yes actually this is this is a
low point for example that goes to
support both words but try to be a
lightweight so it's not always easy of
course so what what is the point here is
to have we assigned this in the overview
in the issue but this is also possible
to use from agent side so if the client
dead x that something is going wrong so
there is an acclaimed client that can be
the command line tool that is actually
analyzing the stream of data from the
agent is possible to react to this for
example we can say that we allow to
change parameters around time of the vm
so fine tune the behavior and we dated
that there is some misbehavior from the
lift on machine on the remote O's we can
tell that the agent to change the
parameters of this p.m. but this doesn't
have to be the user manually doing this
is possible to use scripting or
functionality that obviously we still
didn't implement in that release but we
plan so that we can say okay there is
this misbehaviour please change increase
the memory or or do something else or
maybe just keep the PKG there's not no
not nice you know maybe do some
specialized you know instrumentation or
analysis or whatever
okay there is a number of tool available
in this moment currently we are using
MongoDB but we want to support other
sources as I introduced it before we
call our web kind of middle layer web
storage which is actually our
obstruction so we have something a city
in the middle that provide access
control list and security and whatnot
that can be installed in an application
server itself so like the boss or Tom
cotton it doesn't have to be something
to to resource intensive and then this
will actually talk to the database there
is a number of database we are
supporting like MongoDB or postgresql we
want to try to be flexible because not
all the user have SSOs the BD especially
you know you know enterprise context
they cannot simply say okay I don't care
about Mongo postgresql or maybe horrible
DB but then maybe we just require them
to install manga but this is not
possible so we want to be able to adjust
to this kind of situation dynamically so
right now we are supporting MongoDB n we
are working for postgresql but this is
basically supporting the toward no SQL
and rescue ions we finish for the SQL
part his ship super most of the most
important data base especially
so the agent is very like way we we
perform at some analysis we expect jvm i
think it was around two percent i think
um maybe even the one person now i don't
remember exactly we try to keep this
number very low not told the operation
are lightweight as I say the formula
abdom is expensive so if the user keeps
pressing up dump especially for huge
application then well it's a stop the
word operation there is no way over it
but for all the collection is actually
very very lightweight because most of
this data comes directly from the vm
this information that bham already s so
we just take advantage of this
information that they be a must have any
communication outside the world either
we via MX beam or via system top or
other other options
sorry security for the you mean for the
data yes we are working on this we are
working on access control lists and also
on encrypting the stream because
especially when you do memory analysis
you don't want to have you know your
banking application stream out credit
card numbers and whatnot so yes this
this is taken into account in this
release which should happen this is the
02 for release we name the releases
after important books this is the
Marshall chronicles release for the
ground but the opportunity anyway in
this release we don't have yet support
for encrypting and we don't have full
support for access control lists we we
have only log in but it's like anybody
that can log in the system can see
everything but then in the next release
we will have food a self support and the
only database layer that the users will
see will be the this web-based layer so
we will be able to use Java do he
security and and they're ready
give any more questions
what is do we have resources sword
resources everybody yeah right or how to
participate so basically this is an open
source tool so you are welcome to just
come and say I want this picture you
didn't implement it please accept my
code because i implemented it well you
can also ask us to implement that is
nicer if videos anyway this those are
the main the most important resources so
the homepage is hosted on class but the
torque this is the ice under the ice tea
umbrella project same for the code and
the main list we have a thermostat on
freenode we always there 24 hours per
day we are always awake we never go to
sleep and and then there is this open
ship read calm which is very interesting
so check it out it's very very
interesting and for this presentation we
use as a number of yoga major setting
cute little nicer from everywhere from
the net this is actually this is not a
JBoss project but i would like to invite
debug here on stage maybe you can give
you a very short introduction on ice tea
and then you would go we will all go in
this room for the rest
that one's on top of OpenJDK that can be
monitored with this tube but the tool
itself is intended for OpenJDK and to a
certain extent it will also work with
other j decays with limited
functionality which is why we wanted to
have it independent and I see seemed
like the best place for it because
that's where we incubate other projects
like our plug-in and 0 and arm stuff is
going into ice tea as well so that's why
thank you
all right I think that's it oh thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>