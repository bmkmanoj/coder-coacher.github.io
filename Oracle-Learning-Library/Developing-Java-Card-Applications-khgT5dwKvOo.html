<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing Java Card Applications | Coder Coacher - Coaching Coders</title><meta content="Developing Java Card Applications - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing Java Card Applications</b></h2><h5 class="post__date">2013-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/khgT5dwKvOo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we have two kind of sections to this
presentation I my name is Brian Cole I'm
the business manager for the javacard
product line and then Eric vidyard he's
responsible for the technology bit of
Java Java card together Eric and I have
a long long history in this industry job
Eric has been very very involved in the
java card specification for many many
years is one of the main contributors to
develop with a platform where it is
today and I've been very much involved
in the ecosystem of where Java card is
and the presentation will show this so
Oracle has us to a standard disclaimer
about things so for every presentation
you've been saying you've been seeing
this disclaimer so we'll go over some of
the use cases we'd all be covering and
then Eric will take over about Java card
what it can do for you
and also kind of some programming which
will be applicable to most of you
because most of you are the developers
so some of you I may not realize where
Java card fits within the ecosystem of
Java but Java card is one of the
smallest footprint versions of Java that
there exists within the java family it
traditionally targets secure element
chipsets and is run in a virtual machine
like everything else we'll go into that
so what is Java card it has
interoperability that is one of the
things that you'll hear me say quite a
few more times in my portion of the
presentation where as you don't have to
worry about the secure element chip that
you're choosing once you deploy Java
card on it you the developers you can
write an application for any sim chip or
smart card chip then also the hardware
itself as well as Java card has a lot of
security built around it and security
all by itself is a nice word it doesn't
mean much until you certify it so part
of this is a story of certifiable
security in which Java card and the
hardware targets that gets put onto
are achieving everyday so briefly West
Java card is not it's not an API of SC
it is its own full platform it's
optimized again to run on small devices
it's optimized to run again though
securely but also power efficiently and
also Java card is not specific to only
one industry it is a general
specification that does apply to
multiple industries and again we going
into that in just a moment there are two
editions of Java card that exists today
one called Java card classic and one
called Java card connected Java card
classic is the version that is most
prolific around the world today to the
point where we are now talking about
over 10 billion devices in the world
have Java card classic on it
Java card connected was a evolution of
Java card classic back a couple years
ago and it was trying to meet the
objectives of the mega sim that seemed
to be the promise at one point in time
back before smartphones became so
popular Sims were doubling in size
doubling in capability through Moore's
law and the telco industry really wanted
to add web-based services onto the sim
as opposed to what SIM cards usually
speak is as proprietary apdu
communications protocol so in response
to that the industry collectively got
together together with Sun Microsystems
at that time to define Java card with a
web-based interface I'll have a further
architecture on that so once again just
making reference of what Java card is
it's a virtual machine it's a collection
of AP is some of these api is our
vertical specific for example a
biometric api for the ID industry and it
has a runtime for java applications to
be able to run on top of
then also in regards to the
functionality to extend Java card into
the market space one needs to securely
load applications onto the chipset this
is where a industry consortium called
global platform got together initially
just a little tiny bit of history was
started by visa and I used to be called
visa open platform and then eventually
it became as I said more of an industry
consortium now called global platform
the global platform is the management
layer that exists within a standard Java
card product to be able to manage the
applications on the device and to be
able to load applications whether it's
during the initial delivery or post
issuance be able to load them global
platform also defined something called
secure domains these are secure sand
boxes where you can collect multiple
applications into a secure domain then
once again because of the security
elements here the additional layers were
placed on to Java card to be able to
leverage both the security from a
software perspective as well as a
hardware perspective a lot of the target
devices that Java card is placed on to
have elements to detect intrusion and
Java card can leverage those to those
countermeasures that are built within
the chip as well as the software itself
has code isolation and firewalling
and then less in regards to this setup
is talking about the certification once
again when you are dealing in the
security world simply by saying that you
have a secured chip you have a secure
software secure applications you really
need a third-party entity that has
various security tools to be able to go
in and truly determine what how secure
that device is and for the European
Union it's something called common
criteria for the United States it's
something called dips and these are all
different certifications security
certification layers Russia has its own
security certification Brazil has its
own security certification so different
regions of the world also but to be able
to achieve security certification you
need to certify both the hardware and
the software and the applications so
once again the Java card architecture
allows for simplifying this security
certification especially in the case of
Common Criteria
so again applications can be certified
sure might as well good
versus
so the question is as bits recognized
outside of the United States for the
most part no FIPS itself is not
recognized outside the United States
however Common Criteria oftentimes is
recognized outside of Europe so the
value of Common Criteria in Asia a lot
of times you'll see requirements in age
or same Common Criteria
the FIPS is more of a u.s. specific
security certification potentially yes
you would have to to do that as well and
so the question is we would have to
certify in each region and depending on
you know the market you're going after
then yes you would have to certify in
each region no not necessarily they but
they do have uniqueness as to all of
them so Common Criteria believes in well
take a step back FIPS believes more of
certifying the whole complete solution
where Common Criteria is more of a
that's what I'm trying to give Eric
where you can certify this a hard
component you can certify the hardware
you can certify the runtime you can
certify the applications all separately
composite certification that's also I
think of so come on criterias biltmore
run to composite certification model
whereas FIPS is more of a that's the
whole complete thing you change one bit
you have to recertify the whole bit
there is a lot of push in the united
states to adopt more of a Common
Criteria certification just because it
is harder to modify things when you you
know make one small change up to a
research by the whole device as making
reference to a Java card connected so
this is a high level architecture here
in regards to Java card connected when
the requirements we had was to make sure
that it was backward compatible so I
don't know how much this laser will work
but if you notice on the right-hand side
on the side of the solid line this here
is all the Java card class
functionality so everything that would
have run on a normal Java card classic
so to speak would run on Java card
connected within the right hand side
then on the very left hand side you'll
see the servlet container so there is my
Java EE engine running in Java card
connected so you can write Java EE
servlet applications and have it execute
of course we needed to maintain the
security we needed to maintain the
firewalling we needed to maintain the
code isolation so these are all things
when when we architected Java card
connected that remained within the
security side then you have kind of this
bridge in the middle which is called
extended applets they behave the same
way for the most part is the classic
applets in that they respond to a PD use
as opposed to a web interface but they
benefit from multi-threading
capabilities where classic does not and
again we we get we gain multi-threading
capabilities on Java card connected
because of the CL dc-based
virtual machine here is just kind of a
little you know raw raw cheer cheer for
Java card in a sense of you know this
year we are celebrating our 15th year of
innovation we have crossed the 10
billion unit marks mark so you know the
volumes make Java card the most prolific
computing platform in the world you know
nothing else comes close to you know
when you're talking about 10 billion
we're also at a run rate of about to 2.2
billion units per year so I'm very very
very prolific and we're its prolific is
in these industries in the telco
industry with Java card Sims in the id
industry with government IDs Enterprise
IDs epass ports border control cards
healthcare ID cards so varies in the
payment industry in Europe and Asia
people are already very familiar in
Latin America with chip cards for
payment whereas places like United
States we're not so familiar with it
this being said by 2015 the major credit
card companies have internally mandated
that there be a migration to Chip and
PIN cards all throughout the United
States same mandate is happening in
China as well so we're now talking about
another four point five billion new
cards that are hitting both the Chinese
in the American marketplace in the next
two to three years that never existed
before so that's an interesting market
opportunity and it does tie into NFC NFC
stands for near field communications and
we'll be going in just a little bit more
depth in near foot communications and a
couple more slides so again kind of
reiterating here is with the sim card
side Java card makes up about 90% of all
SIM cards in Europe United States the
regions it doesn't do so well at the
moment is India and the ID space Java
card is very very much a dominant player
there as well with 24 countries if not
more adopting it payment growth is
strong and NFC 100 percent of all NFC
what's called card emulation cards are
Java card the benefits to the telco
operators for the sim side is again
interoperability between devices so that
a telco isn't is not only stuck with one
hardware vendor for their SIM cards but
also interoperability between the telcos
because the application sets can remain
the same so if I'm on AT&amp;amp;T and then I go
over to China and I connect into a
network over there with you know and
some of that interoperability is
provided through the application sets
that exists on Java card I already made
reference to the chip card migration
that's happening in the United States
and China but it's definitely taking the
world by storm and a lot of small text
here and but for the most part what the
point is here is that when we are
talking about payment cards it's the
banks that choose the technology you
know discuss visa has a visa logoed card
it's ultimately Bank of America or Chase
or Wells Fargo that chooses their card
that they distribute to you and in light
of that banks are very conservative they
our very very careful about where they
spend their money and javacard with its
volumes of you know ten billion units
with its history of security
certifications javacard is becoming more
and more the de facto platform for the
banking payment industry here again
small text and hopefully you can see
some of this but the countries listed in
red are known adopters of the Java card
technology for different verticals the
ones that are in black some of them may
have adopted Java card or not many
countries are kind of quiet or secretive
about what technologies they adopt for
ID systems so but the ones in red are
definitively Java card and again we're
talking about national IDs we're talking
about healthcare IDs passports and then
what are called ear esident permits when
you are a resident of another country
but in another country military ID cards
the US Department of Defense is one of
the biggest success stories for Java
card and a government ID smart card in
the world and driver's license for
example in Australia they've started
issuing smart card driver's licenses
which are Java card and one of the
interesting things about that talking
about certification this isn't
necessarily a security certification but
it is a interoperable certification
called iso twenty four seven twenty
seven iso twenty four seven to seven is
a european union ID specification so
that european IDs are starting to align
so you can use one european ID in one
country in another country well the
first successful implementation of a iso
twenty four seven to seven card is the
australian driver's license so again
showing some of this crossbreeding of
the standards across boundaries near
field communications that's again a very
short-range RFID type of technology
where a device can communicate and it's
exploding in regards to its popularity
there's been a lot of hype around it but
at the same time the amount of money
that the industry is putting into it
it's definitely aggressively growing and
here's just a handful of phones it
already adopted NFC and that keeps
growing in Mora phones with NFC and more
phones but it's not only on phones NFC
is also being adopted by tablets and
other devices as well and the basics
about NFC is it works in three different
modes it either works in a card reader
mode and I peer-to-peer mode or card
emulation the last one card emulation is
again where Java card is 100% all NFC
devices that are in card emulation or
Java card this realises a point is again
card emulation is all Java card but
there's some other really interesting
use cases for the reader writer and the
peer to peer and you may be aware of the
different wallets from Google Google
Wallet also the telcos major telcos the
United States AT&amp;amp;T Verizon and Sprint I
think have joined for a group called
Isis and Isis is also coming out with
its own wallet and we're going to see a
preparation of different wallets
MasterCard has its own wallet in regards
to that these wallets are leveraging the
NFC communications and are using card
emulation so the Google Wallet the ISIS
wallet on mobile phones are all Java
card as well so you guys could copy
these slides so I'm not going to go
through these but again just making
reference a Java card is important to
put in NFC and Java card is very much
baked into the solution of NFC and
what's interesting about NFC for you all
is it many cases NFC will be a secondary
secure element that isn't to the SIM
card in some cases NFC will be the SIM
card as a secure moment some cases it
won't the reason for this is the
industry really wants to leverage the
ability to have somebody other than the
telco controlling the secure element and
so this is going to open up new
opportunities for developers as well as
new marketplaces yes
that question I want to hold to the very
end just because it's a little bit
longer answer and I don't want to take
up too much of Eric's time so we'll
table the question was is you know by
nature he said by nature NFC isn't
secure how does Java card secured and
how do we add security to it we'll come
back to that
the last one is where Java card is going
in with we're talking about here and you
may have been hearing a lot of the vibe
is the embedded space and when you talk
about the embedded space you're not
talking about edge devices on the cloud
and then the edge devices on the cloud
connecting to a cloud or data center and
again right here when things that Java
card provides a lot of importance to is
in this peer of this cloud services
security and identity at the very basis
of being able to provide these cloud
services then you get up to the top
where analytics exists where again
that's the big data base in big Oracle
back-office and in light of that that's
already happening today there's new more
and more form factors that Java card is
now being placed onto as listed by the
list over here on the right hand side
for embedded devices as well as SD micro
SD chipsets and these as I said are
being shipped in number of these today
are being placed into cars and to mobile
devices into smart meters and and again
Java card is on these different devices
providing communications and security
for these devices and with that I will
pass it off to Eric
okay good afternoon so I think we're
going to get a bit more technical too I
start by you maybe some general things
about Java carne is my kinda general and
watch how we can use it the first thing
is when you talk about smart cards it's
about tamper resistance usually this is
about resisting two attacks so if you
don't have a security issue usually
you're not thinking too much about smart
cards so here we don't want just to
protect against software attacks but
something coming against the web is
whether we can provide some help for
that we also want to protect against
physical attacks so if you think about
the kind of attacks can happen it's
observation attacks where people will
don't look at it but look at it with a
some kind of monitoring the power for
instance to get some information from
there and deriving some keys from some
computations or fault attacks when the
attackers actually use you take the
example of lasers because that's the
trendy ways these days but you can use
all sorts of things to actually do fault
attacks and we get back to that the idea
about using a smart card it was with the
Java code application here is to get
either a physical isolation from your
client and the web so that basically the
secrets of the store in your client are
actually stored in a separate device
which is not directly accessible for
instance from from the internet if you
on a phone or on a on a device one even
on a PC and also physical protection and
that's basically if the card is in the
hands of the attackers
it doesn't mean yet that they're going
to have the keys they're going to need a
lot of equipment a lot of efforts to
just get whatever secrets are trying to
protect their from your current so the
ID usually is that since cards are small
you're not going to put the entire
contents you have to protect their what
you're going to do is that if you
encrypt your content you're going to put
the encryption key on and on the card if
you have some authentication you're
going to put the pin codes the passwords
potentially the biometric data
but you're not going to put once again
the entire profile for a user the idea
of that the Java card products is really
to protect these credentials and help
you for this so especially for pinkos
passwords and so forth a kind of
authentication data and for
cryptographic data there are dedicated
classes in Java card that helps you in
protecting these assets first storing a
key in a byte arrays bad idea in Java
card because if you store it instead in
a key container it will be properly
encrypted scrambled whatever needs to be
done so that it's harder to get out of
the kind same thing for a pin code you
don't have to take care of it the system
does that and that's one of the
advantages of Java con here which is
that you don't have to deal about this I
would say little problems or low-level
problems because it's already dealt with
for you and something else is sorting
that Brian mentioned global platform so
in terms of the management you also have
all sorts of things that are defined
already this time within global platform
that you can hop in manage the
applications and make sure that you get
your applications and their data
provisioned on your cards
so if any if you look at the way global
platform works well since you have you
have something even initialization of
the kind that needs to happen so a lot
of service providers can do that and
then once you have that do you have a
key there and if you if you import a new
application you'll be able to encrypt
your own data based on the key derived
from that original key so that there's a
full infrastructure to do this once you
have put this root key or the in the end
well not a brute key per se because it's
usually a you know secret key not public
key never the master key there and then
you'll derive something and the idea
that it solves your problem as an
application provider if you're deploying
your application to you know in the
payment card for instance that exists
already you will be able to rely on some
key that's already there to bootstrap
your initialization so that because
otherwise it's unsolvable now how do you
protect your first scheme and this is it
has to be there at the beginning and
that that's that's what the kind of
things the global platform offers so
something interesting is that in terms
of what do you need to use Java con well
nothing I mean Java code is Java it's a
small subset of Java so we'll see really
look at some examples later you'll see
it may be a painful dialect but it's
just you know Java so the problem is
it's also on a smart card and if you're
thinking about development of a smart
cards it will require some security
skills at least to design your
application I mean if you know nothing
about security it's quite likely that
you'll make some mistakes in the design
of your application by forgetting to
encrypt something or by you doing
something that hacker could exploit so
that's that's the experience that is
required as you're developing a security
protocol or a security product you need
some experience in designing these
security things and then there's the
security certification so there are
already some discussions about that but
a common criteria or fix 140 so it's
funny because my vision as a European is
more that Common Criteria have used
things globally in 51 40s
focused on little crypto details but
that's I guess this is cultural the FIPS
140 that doesn't that's level 4 there I
am yeah I draw because you can do for no
it's leveled wall 2 to 3 I think it's
double 2 and Samia and basically anyway
that what you need to get in terms of
security certification depends on the
market you're targeting that's very
simple if you want payment you most
likely go come on criteria if you want
ID depends on the country that you're
targeting anyway they will have
different requirements so you will have
to design to at least slightly different
products security certification that's
that really requires specialized skills
I mean you have documents that are far
from obvious that needs to be written
you have to interface with labs that is
definitely not easy so basically there
are consultants that do that using Java
card can provide you some help because
if you use a Java card instead of
building a native card from scratch
you're sure that you have the crypto
library that has already been set
refined so pheasants for FIPS that's it
that's definitely you know simplifies
things you know that you have all the
basic things that have been already
certified and so you just need to add
your application to that and that's much
simpler which means that you know being
much simpler it only will require you at
least six months delay and a few a few
hundred thousand dollars but that's
that's a price to pay for certification
I mean it's so it depends on uncommon
crotch area you can we can do some
maintenance of the of the certificate so
it depends on what you change now it
depends on what you change I would say
it also depends on your relationship
with the lab but you know that's
no no that's great no and also you have
you know Common Criteria is ISO things
so you have national contact points so
in the US I'm not sure who it is no the
the the the the certification authority
there it's NIST I think that's done
nothing its nest so this may think one
thing maybe if you go to France or
Germany they will think otherwise but
they will recognize each other's
certificates so sometimes you have to
politically choose in which country you
certify your product yeah so okay so
when you when you certifies it code
review or a black box both so you first
get lots of documentation so it's a
really white box code review because you
give full code full documentation full
testing and then you get the the well
it's not really a black box cuz they I
have the source code but they will
attack it know so they will try to find
vulnerabilities okay so I know we have
time in the last part here what I will
do is go through a small application
just to show some examples of what we
can do with with Java code so the
example here is not really realistic
because lack of time to get anything
that real so its password storage at
least that's a problem that everybody
can relate to the idea is really to try
to protect some passwords by storing
them in in the smart card I just write
an application that does that and of
course we'll try to do a bit good
security practice doing that so the
functions is basically you have you know
some login records identify your
username password and you can you know
and look up list all Ines values modify
a record delete a record that's the
first year computer science exercise you
know no tricks if you look at the
implementation here you'll notice that
we
are working on a subset of Java so there
are some good news here so you have
classes so you can define your own new
classes you can define your own methods
you have virtual methods you can have
interfaces you can have inheritance in
all possible ways there's no restriction
on that and then there are the bad news
storing user names in byte arrays is not
natural for most Java developers but hey
that that's the way it works with us you
have very limited basic types so it's by
it shorts interruption or so on some
cards you get in on some cards with
basically smaller ones you don't get
support for 32-bit ends now so what's
the memory size on a Java card it
depends the first now in the first
version of it we we require 256 byte of
RAM and 8k of EEPROM I think now we were
a bit over that so most reasonably
you'll get you know between 64 K and and
256 K of EEPROM and somewhere between 8
and 32 K of RAM but 32 K is luxury and
you'll have to share it with many other
applications so you won't be alone on
your 32k so notice very little memory
you know we will see that later and that
has some consequences yes yeah ok so no
the question was is the annotation the
connected now under connected additions
you don't have the same kind of
limitations yes but then the connected
additions only water contents largest
thing you need the 32k of ram otherwise
it's not enough
even for having limited basic types you
know because of the storage so there is
the limitations are basically because
you know the OS that you know needs to
take a few hundred ohm or at most a few
hundred K and that includes everything
not just the VM it's just you know so
it's it's really Emily you may think th
if you heard that uh know what we've
heard about Java Amy embedded Java me a
bit it can have a VM that's 100 200 K
and works well here were in a stage with
the entire software including the device
drivers the VM the libraries and
everything has to fit in this thing
sighs so choices were to be made and you
know we don't use great large values so
in so optional long sigh useless and
floating points anyway there's no
floating-point library it will be too
slow so you know so that's why they're
that out and the reason for strings is
mostly related to actually the problem
with memory because anytime you do an
operation of strings it allocates a new
string and this is just unbearable if
you don't have memory so now when you
start our programming in Java code
basically you have the structure of a
Java program but inside methods it looks
a lot like C
I mean you you're not going to get much
table it's going to be you know byte
arrays and array copy Union and things
like that so that's typically what we
see here so in terms of memory something
that is very specific to Java card is
that the objects are persistent so when
you allocate an object it's not
allocated Ram remember at the beginning
that were 256 byte of RAM so you don't
allocate objects there you'd store them
directly in flash memory or EEPROM and
the idea is that once the the objects
are there first there is cost more space
and the other advantage is that smart
cards don't include power so the power
is external which means that you always
have to to make sure that
you're allowed to lose power at any time
and you also have to power up very fast
so one way of powering up very fast that
basically that the state of the VM was
the object etc is already it's in
persistent memory so as soon as you put
power the objects are there they're all
laid out you don't need to get things
out of files or whatever it's already
there so you just need to initialize
your stack and you're ready to go and
that's really what allows us to do a
transaction in 200 milliseconds
everything included when you do that in
transport applications because with this
kind of constraints you can't afford to
initialize many things and an important
consequence of that is that there's no
garbage collection because it's too time
consuming the thing is that if you think
about a prom and your flash memory
writing to these is very slow that's but
well it's erasing but basically you know
writing over something is very slow so
it will takes milliseconds to do that
and even though our you know we only
have you know a few megahertz of of
power milliseconds that's still a few
hundreds of thousands of instructions so
you don't write just for the fun of it
and garbage collection of course means
that you need to do a lot of write
operations and that will take several
seconds to actually do that and we
cannot afford to do it without being
warned so the objects are usually
allocated statically and if at some
points you just modify your the
configuration of your app that's when
you will manually start a garbage
collection so basically we are back to
some classical logarithms so that that's
what we see here that what you have the
password entry well you have to have
some kind of a linked list but you do it
by hand and that you have to you know
get back some memories from from school
because your linked list has to be done
by hand so you next it was first first
equals this you know put this thing I
hate a new one I put it in front of my
list no we all did this so then there is
another thing which is atomicity when
you write into
memory in persistent memory you have to
make sure that you're right our atomic
because remember you can lose power at
any time and since the operation of
writing is very long you have to make
sure that there are no errors in your
and your writing if it's interrupted you
may get a random value instead of the
value you want so you need to do
something so that there is some
atomicity and there actually two ways to
get atomicity in java card one of them
is to use or record a transaction so
that's what we see here it's so it shows
in red
there's a begin transaction commit
transaction and that does what you can
expect so all the updates that are done
in between will be done together when
you do the commit and then there's
another thing which is called a single
write atomicity which is that if you
have a write operation outside of a
transaction it's atomic by itself it's d
and that's what we see here if we
remember that for the first one the
first equals this here that's going to
be an atomic write because there is no
some need to be able to back it up so
the other ones before it don't need to
be atomic because there's still no link
you know that this new one newly
allocated password entry it's it's
there's still nobody linking to it so if
we waste something it's no big deal we
don't have a problem it's only the last
one when we actually make it really
persistent that we need to have the
atomicity here so yeah the java code
programming style i mean you want a
deeply embedded platform so whatever
embedded platform you've dealt with this
one is that you know maybe not smaller
but it's at least as small as what you
did before so it is java but you still
have a lot of constraint to deal with
you have limited memory management
limited computing power the only thing
you have that is good is that the crypto
is good I mean the the kind of crypto
power you get is significant because you
have crypto accelerators in hardware
that that make it
possible to do no significant treatment
their interview rigidity classes you
basically down to nothing it's no array
copy array or whatever but nothing and
there is no automation so we're back to
thinking I just developers and you and
it's been worse than then on on mobile
stuff I remember people complaining that
the ME developers just be lazy and
instead of just to make their
applications easier that would pass hash
tables as arguments to you know to
methods so that you know they can have
the any number of arguments yes you're
not even allowed this kind of laziness
here because it's new Dilma hash tables
and something importance that you will
end up counting bytes if you have a
industrial application because you need
to be able to answer to anybody's
question which could be how large is
your application how much data doesn't
need and it will all ask this so you
have to count the bytes and you have to
keep track of the atomicity clearly and
this is atomicity is a bit tricky
because it's a bit like when you do i'd
say they would saying that the race
conditions it's only when you have a
problem that you see it so when the
atomicity it's only when you lose power
that you may notice that you haven't
protected something correctly so that's
another thing that's another issue that
it's difficult to to test sometimes so
in terms of security okay what do we
need to protect our little password
thing here we need some access control
so basically like usual will protect
that passwords with another password
because well that's easiest way of doing
this we're going to do something where
we require master password and that make
it valid as long as the application is
selected so a non java card since you
can have several applications on the
card so you can select an application
then do something then select another
one and for this one you want to make
sure that the
the lifetime of the the master password
is limited to a single application
session I would have loved to do with
valid only five minutes but we don't
have real time so we don't we countdown
we cannot count minutes or whatever so
we'll have to do without that and I
remove the secure Channel requirement
because this is fairly easy to do but
it's all takes some times here so we're
assumed that will connect this thing on
PC without hackers in terms of the
security so okay then we look at the
interface and the security together so
when you write an application in in Java
kind so you have to process what we call
the apdu commands which is the protocol
unit that we use in n smart cards there
is a standards family of standards
called the ISO 7816 don't read them
whatever you do don't read them you know
by your book because that's standards
are not made to be read by human beings
and so yeah and then you get some
security mechanisms that we are going to
use here so when you write something you
extends a class called applet so they're
going to need to implement a few classes
then you define your comments so add
password entry find password entry etc
turn around they all need to have a
number there the number needs to be even
these kind of things you know you have
to learn in the book that's not and then
you have a constructor there where for
instance here you're going to allocate a
pin so in that case it's a pin I'm sorry
I didn't use constants this is not good
I should not have done that but this
append was three tries and 16 bytes long
maximum switch rather small pin but we
have no big choice here and then the
other things you need to implement in
your applets the first an applet needs
to be installed you need to be
instantiated so that's what the install
method does so what you doing an install
method that you allocate your applets so
in select cases our past
what manager you do whatever you need to
do to it to initialize it and then you
register it what I mean by initializing
it's mostly allocating data at this
point you're not putting data into it
because that will come later as commands
it's always incoming commands that will
give you the the data then you have to
select your application at some point in
that case there's nothing to be done
except saying yes I accept to be
selected so that's a return true and
here remember we said that the pin
should be valid only for one application
session so when I deselect the
application means which happens when I
select another one I reset the pin which
means that you know I I forget about the
occurrence of education and then the
main thing you have in any Java card I
place is the process method so in the
process method every time there's an
incoming command or apdu it gets
forwarded to this process method so
there are a few things you have to
verify that no well I'm not currently
selecting the applets that the command
selecting and in that case I will switch
over all possible commands here
so yeah so yeah there are several things
so with the ads password entry and
verify pin so see the difference between
the two of course we we do the
processing but in the add password entry
we also check that the pin has been
presented before so you have the
security to apply your security policy
and this is typically the kind of things
you're going to do so the yeah the first
one is it checked authenticated that's
fairly simple it's going to verify if
the pin is validated so if it's very
dated it's okay and if not it's going to
throw an exception and once again we
don't throw exceptions like anybody else
because you don't allocate things so we
have actually pre-allocated instances of
exceptions so there is system level
instance of each exception that you're
going to throw so there's a static
method on and every exception class so
there it's the throw each method so you
give it the parameter which in that case
is the the return value that that we
want to have it's an error code from the
ISO 7816 the conditions not satisfied so
if that ISO exception is not cut during
the process and gets back to the runtime
environment then it will return this
code to the to the client yeah and then
we have the verify pin so the way in
which you you verify a pin okay so I get
the buffer I verify a few things about
the the application so here we know we
are an instruction where for some reason
in the standards I say that this p1
should be 80 if it's not it's incorrect
otherwise we continue so this is what we
have here this is how we we're going to
actually process the command so that
continue here
it's very important to always strictly
verify everything and the spec I mean
we've seen small bugs being used as a
way to actually introduce a little
vulnerability somewhere so when you
verify the verify the pin the first
thing you verify that actually can I
verify other some tries remaining if we
will use all three tries there's nothing
to be done
so in that case we'll just reject it
with the data invalid otherwise we
verify that there is actually whether or
not there is incoming data so LC is the
size of the incoming data that's
important under protocol thing if there
is no incoming data then it means that
we're not actually presenting a pin but
asking the pin status so we'll return
some value here is Ariana which is the
good work so we'll throw an exception
here saying that you know it's a wrong
pin and there's also many tries
remaining otherwise we just receive the
data and maybe call another method that
will do the actual verification and the
actual verification once again has to
read now get the data from the buffer so
this is all very painful because we
still haven't verified anything at this
point we're just you know looking at I
think so we here we're verifying that
the length is okay we're actually
checking using the pin and then if there
are no more tries we'll return one of
our value up sorry
and otherwise we'll return by using up
one less try remaining
so yeah yeah I so because in the middle
I did this I did check the pin so the
first one is that I won't even try to
check the pin
if there are no tries remaining and once
and the other thing here is that after
when I need to return the status there I
will not return the same status if there
are stir-fries remaining or or not
that's the typically if your pin is
blocked you get a real error if your pin
is just you know your you're wasting
tries you get a warning which which is
different because so that this time they
get tries remaining is only to make the
difference between should I throw this
exception or that exception actually I
couldn't make a method out of this
because I think I'm using it twice so of
course here this has been extremely
basic if you want to really do an
application that will do things like
that you have to do much more of course
it's always a case if the user forgets
the password loses the card most likely
you want to have some kind of backup and
this backup will need to be encrypted
with a key and then you you're getting
into another security problem here which
is a how to what to do with that key so
if this will private use you have no
other choice but using a secret key and
making sure that someone hides the key
somewhere where it can't be found so
okay but it's just transferring the
problem from not losing the password
from not losing the key it's it's it's
good for losing card though that's
that's the advantage of it
of course it is if there is a commercial
offer it will most likely be a public
key so you'll be able to do your backup
would be encrypted whether with a
private with a with the public key and
you can come back to you provider and
for a small fee you'll be able to
decrypt your backup so you know smart
cards are one way to address some of the
problems but in the end they're always
part of a larger security infrastructure
if you want to have a product at the end
you're going to need to manage your keys
too
generate them to do whatever is needed
smoke out is just one tool here that
will protect the assets while they are
in the users hands now you need to have
some things in place for initializing
them for doing something when the user
loses them and cetera so you have to
remember that we have no time to do this
here now if you need to go a bit further
for sis if you really need to have
something that is going to be in the
certified at a quite high level so if
you're working an ID payment and things
like that you're going to have to go
maybe a little bit further than that
since that the reason for using a smart
card is because it's tamper resistant so
it means that you need to do something
when there are attacks and the
countermeasures some of them are there
other hardware level so that's very easy
you have nothing to do some of them out
of the system software level so it's
basically what it's done to protect your
keys its address so this once again you
don't have to do anything but you may
have to protect your own applications so
we're going to see two kinds of attacks
but the very typical attack is really
about leaking information so that's
called a way of often do power analysis
or no electromagnetic analysis but
basically there are some information
leaking a particularly from the power so
depending on what is running on the chip
it will not consume the same amount of
energy and by analyzing very precisely
the energy that is consumed you can get
some information about keys or whatever
so in that case well since the ability
of this one is to get some data out you
have to be careful about try to encrypt
things another attack is about provoking
false in the execution so that the the
false thing is is really exploiting the
fact that silicon is a semiconductor as
a semiconductor under some conditions
it will start being a conductor so
usually we you know the the say the
silicon manufacturers are very good at
figuring out when the silicon should be
a conductor but if you start you know
say lighting the the this piece of
silicon with a laser or with some
radiation of some kind it gets excited
it becomes a conductor and there's a
short somewhere and I with years and
years of experience the attackers or at
least in the labs that have learned to
exploit that to generate a short in the
you know in specific regions so that
they get an effect that is predictable
to you know maybe they have ten percent
chance of having this effect or that
effect so in many cases it's about
making believe that you know some memory
read it should have been a value it
reads at zero or these kind of things so
the only countermeasure against this is
redundancy because it's every time you
do an attack like a fault attack you get
maybe a ten percent rate of success so
if you do something redundant
mathematically immediately the ten
percent chance of success becomes ten
percent times ten percent that's one
percent chance of success three or four
we're down to you know negligible times
for side-channel attacks know that there
are effective countermeasures I mean you
know the guns are not getting attacked
every day so though that it's the usual
cat chase now today there people find a
new attack and then there's a new
countermeasure but that's that's the way
it works but know that there are some
good countermeasures didn't it and
remember that there is no perfect
countermeasure so we're never now nobody
claims to be tamper proof with tamper
resistant and the whole idea about using
a card and putting some security is to
make sure that it's not possible to
design a good business model out of an
attack you don't really care if
something is broken what you want is
that there's no way for an attacker to
actually get what he wants from that and
this is actually did this think about
the business model it's also why at
least for these kind of security it's
easier to fight against the Mafia and to
fight against the terrorists because the
service doesn't have a business model
you can spend almost an infinite amount
of data to effort to get somewhere
because you know it doesn't want to make
money so it's always more difficult if
you have an attacker who doesn't want to
make money because then they can spend a
lot and that's basically you know much
more difficult to fight against but no
luckily that's a small minority of a
problem yeah we get a lot of you know
it's for smart cards more protecting and
people want to make money and that's
typically the problem here so one thing
that works here is that with Java we can
get some real help so if you want to
encrypt your objects for instance
encapsulation is going to work really
well for you because you still get the
same you don't have to change your
methods everything looks the same from
the outside but then on the inside
everything is stored encrypted so there
are some encryption method
in in Java card so they are really close
to the ones using Java the Smuts just
subset it but it's the same thing so you
have a cipher you have to in it you you
can do mobile at the end you do final
that will generate a result so here in
the buffer and now so you can return
that that length here so that's the
typical way of doing it and then this is
the second one that I've used is the
tricky way of doing it so in the first
time I do it by hand but something that
as I told you before the keys themselves
they are heavily protected by the system
but in a key class there is a
possibility to set the value of a key or
to get the value of the key so basically
you can use it as a secure store so this
one for instance could be a DES key DES
key is 16 bytes so you can put a 16
bytes you know byte array store it in a
key container it's very well protected
from then on and when you need the value
you get it out so it's a trick that is
very much used you know by practitioners
because it's easier than having to
allocate your own keys because then
you're also relying on the system keys
so the advantage of the system keys that
have been protected by people would
supposedly know how to protect their
keys
No well you can have your own encryption
algorithm but it won't work that's the
problem that's because the thing that
the the power of the chip is not
sufficient so if you don't rely on
hardware acceleration it's going to be
so slow especially if you do it in Java
it's going to be way too slow to do
anything so you have to rely but you you
get the usual D si es you know RSA
elliptic curves whatever you get a lot
of them oh I'm out yeah it's okay I'm
all goes done and then it you want to
protect against fault attacks so this
one I'll give you some pointers to where
you can find all of this it's a
nightmare
here Java doesn't help you're in it
basic hell everything as I would say
more difficult so this code here this
page of code you can try to guess what
it does basically this page of code if
it's not you know if we use a system
that is not backed up and redundant this
is basically twice left - - that's
that's what we're doing here but we're
doing it by reading the value then
reading a backup value making sure that
they're there they're they're okay they
correspond to each other otherwise
countermeasures will probably verify
something then we decrement both values
the the first one and its counterpart
and then just to make sure we're verify
again that they have been really really
modified so that's the way you have you
have to for instance deal with counters
if you develop an EMV application for
payment your counters are vulnerable
because by default in Java card you know
if you do twice left - - it just does
you know - interactions and that's what
it does if you want to protect it
against the tax you have to do this
otherwise most likely will never dick
riman if it's under attack because they
will know how to avoid it
so we need to conclude on all of this
once again Java card is simple it allow
to program the applications you have a
lot of support for pin cryptography and
all these things you need to do these
applications but your applications will
be complicated that will not be simple
because that's the problem that's you're
not trying to solve a simple problem you
have a security issue somewhere in the
part of a more complex something so
programming will not be the main issue
here we're not we're mostly talking
about security engineering which is you
know where's my key was my so that's
really the problem you have any fears I
didn't mention it but if you have
certification the code that will also be
one of your problems but yeah that's
definitely related to security yeah so
just let me finish on on this so some
references so you can get some
information from farmers from Java cards
so I also have a full tutorial on this
so this is an excerpt OG from the
tutorial so you can find it on my blog
there and also global platform is a good
source for information so thank you so I
know if you have any more questions I
think we have to close soon but yeah
booty oh why don't you they already know
ok well then thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>