<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Design Patterns in Groovy | Coder Coacher - Coaching Coders</title><meta content="Design Patterns in Groovy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Design Patterns in Groovy</b></h2><h5 class="post__date">2013-02-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YSEcVlYiGIU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to the session on design
patterns in groovy my name is Venkat
Subramanyam we're gonna talk about
patterns and some of the ways we can
implement it in groovy I'm not going to
use any slides here I'm gonna be writing
some code examples play with some little
things that we can do in groovy what I'd
like for you to do is of course if you
have any questions please don't wait
till the end any time you have a
question or comment is a great time to
hear from you
if you're trying to ask a question and
not responding to you that I'm not
trying to ignore you at all just that
I'm not you not in my line of sight so
just either way with me or drawing
attention I'll be more than happy to
yield to you and listen to you so let's
get started first of course is why why
talk about patterns this brings back
memories when I started programming I
was back then programming in C++
predominantly and when Java came out and
I started trying out some of the
patterns in Java it was quite exciting
to see that it took a lot less effort to
implement some patterns in Java compared
to for example C++ and to a certain
extent I call Java as a post pattern
language if you kind of look at the time
when the famous Gang of Four book came
out and Java came out about the same
time and then when I got into groovy it
was about like reliving that experience
once again I found out it was much
simpler to implement certain patterns
and groovy relatively speaking compared
to Java itself and so I want to share
with you some of the things we can do in
groovy and how we could apply some of
these techniques now before I even get
started with that one of the problems
with using patterns is that it is really
not a great tool to design software in
my opinion it is a great communication
tool more than a design tool so in other
words I don't think we can develop good
software by just sitting down and saying
let's figure out what patterns we can
use I think that's a very poor way to
approach designing software on the other
hand when we are designing software when
we are looking at different options to
consider I think it's a great
communication tool and rather than
taking many words to explain something
we could quickly say how about using
this pattern in this context so I want
patterns to emerge
the code rather than being forced into
the code itself now having said that
let's talk about some patterns we could
use now one of the interesting things
about language like groovy is it is a
dynamically typed language and also
groovy has meta programming capability
where we can extend the program at one
time by adding features and this makes
it extremely powerful to do certain
things in groovy that we cannot even
imagine doing in a language like Java
and as a result the way we would
implement certain patterns in Java would
be different in from the way we would
implement it in groovy and there is also
a slew of patterns we could probably
implement in groovy that we can dictate
even fathom using that in a language
like Java so we'll take a look at some
of those things along the way and see
how we can use it I'm gonna look at only
a few patterns from the Gang of Four but
I'm gonna then go on to look at a few
patterns that we normally don't find in
the Gang of Four and even for the
patterns I'm gonna look in the Gang of
Four you will notice that we're gonna
implement it very differently here with
a lot less code in groovy then we would
do in Java itself so let's start with of
course the famous pattern the abstract
Factory what's the purpose of abstract
Factory abstract Factory abstracts out
the creation of an object from its
implementation so we can say what object
we want now of course when you're
programming in C++ creating an abstract
Factory requires an arm and a leg you
have to write a hierarchy of classes and
and we rarely do that in Java because in
Java we have the class class remember
and then you can go to the class name
the class and say give me an instance of
this class and you can work with it so
Java already makes a abstract Factory
much simpler to implement so would there
be a reason to you know do it any
differently in groovy when it turns out
the minute you create an object in Java
how do you populate this object with
data well you would say well we could
use Java beings right well unfortunately
Java Bean is a very sad story right
because when Java Bean was introduced
beans were excited they said cool we are
beans and then they came to know that to
access a bean you would have to use
those stupid getters and setters and
they were kind of in depression ever
since they learned about that right well
and grow we we can treat beans with
respect they deserve its
to talk to them and and if you're
programming this in Java what would you
do normally the minute you learn you
have to set properties into it you
realize said that citizen Gators are not
really that great to use and then you
would say could I use reflection to do
this and that kind of becomes messy and
then you say well have to reach out to
the Commons API and then suddenly you
have Commons API being used and and a
lot of times in Java the libraries and
of tools are there to make up for the
deficiency in the language to a certain
extent let's see how this was gonna
manifest and grew we really want to
implement it so let's go ahead and take
a look at an example here
imagine you are developing a web
application and you're gonna be selling
different kinds of products a book a CD
a t-shirt what have you and you realize
most of the time what you have to do in
your web application is receive a
request create an object populate the
object with some data that comes from
the web application that's a pretty
routine things right and you would
notice that if you were to write this
code every piece of code exactly looks
the same except for the names of the
classes the names of the property and
you realize why are we duplicated this
code over and over and over right and
there's a principle behind this it's
called the DRI principle the DRI
principle stands for don't repeat
yourself and it's not just a copy and
paste of code but also duplication of
effort in doing this so let's see how we
could minimize that effort here I'm
gonna create a class called book here
and let's say our book simply contains a
title and I have pages just two
properties that I'm gonna have in here
and I want to create a book of course I
want to populate the book with some data
let's take kind of baby steps and see
how we can do this so I have a create
method over here and my create method
simply says I'm gonna take a class as a
parameter we'll look at other parameters
in just a minute so I'm gonna create a
class and I'm gonna you know use it so
define I'm gonna say instance equals and
how do I create an instance of a class
well if you're using Java you would say
I would go to the class mera class and I
would say new instance on it and the
minute you do that you realize you've
got to put a huge amount of trycatch
around it right and the mere thought of
you and putting those try-catch around
kind of scares you and don't want to do
that well in groovy there are no checked
exceptions so we can simply say
class dot new instance and create an
instance just like that as you can see
right so that was pretty easy to create
the instance and then I'm going to
simply return that instance back to us
let's give this a try I want to just
print out a call to create and I'm gonna
send book to it this is another thing
that I really like in groovy in Java you
would say book that class to get a
miracle ass of this object you don't
have to do that in groovy because in
groovy the name of the class itself
becomes the metaclass
once you create the class so you can
simply use the word book here you don't
have to say book that class over here to
get access to it right so if I know how
to get the doc there right you don't
have to do that so we're gonna send the
book and I'm gonna once I get the object
of that I'm gonna simply dump that
object so we can take a look at what's
in that object and you can see that it's
a book object doesn't have a title
doesn't have the pages yet because we
didn't set it now where is the data
that's going to come from so I'm gonna
say comma and I'm gonna simply put a
hashmap right here now why am I using a
hashmap because typically in a web
application you may get their data from
a hashmap as a name value pair and so we
can simply use that very easily here so
I'm gonna say title and and I'm gonna
use the title of one of my favorite
books here who moved my cheese and so
then of course I could say comma pages
and let's say 96 pages so I'm gonna use
this little a hash map that I'm gonna
send to this guy and have him populate
the data for us in this particular case
so how would this look like so I'm gonna
say comma properties over here that I
want to send to this particular object
now still of course the name and the
title and the pages have not been set at
this moment how do we set those well
properties dart each and I can start
looping through the properties and we
could say name comma value or the
properties for this particular object
now this is when you say oh gosh now we
gotta set these properties and should I
use a reflection API should I reach out
to the comments API we don't have to do
any of those so what do I do I want to
say instance Dart
well of course I cannot say name equals
I wouldn't make any sense over here
because the name of the proper
is not value but the name of the
property is the value within the
variable called the name so you have to
say get the value of the name and then
set the property with that name in the
context well that looks pretty daunting
but surprisingly that's extremely
trivial to do simply put an expression
in a groovy string and he's more than
happy to you know said that for you with
a minute you said the name of the
property and say that's exactly what I
want to set here as a value let's see
where I made a mistake here he says page
oh part of me it's page and over here
and did I call it page pages so you can
see how he handles exception as well in
that case tells you that property is not
known but notice the minute we have done
this it's able to go ahead and set the
property in this case it tells us the
book is there the title is the title we
set it to and the page is 96 so we were
able to set the values very dynamically
here and look at the fact that it took
us only about a couple of lines of code
to accomplish this task so factories
become extremely simple to create for
example if I want to create another
class here for example let's say the
class I want to create here is a CD we
can see that we can use this class for
other purposes as well very easily for
example I could say there's going to be
a title for the CD also but in this case
I would say volume of the CD and we can
quickly set in this case we can call
create and of course I would just send
the CD in this case and then when I'm
done with that I'll just dump the data
for us to see but within this I could
say title maybe a title for this CD is
nature and then I can say the volume is
gonna be let's say volume - and here we
are creating and dumping out the data of
the CD itself we can see nature and
volume to came out as the response so in
other words creating and using a factory
of objects is extremely simple and it
and Rubik provides us a very dynamic way
to access properties and if this was not
a property if this was a method we want
to call it wouldn't look very different
at all you would simply say instance
dart double code a dollar name of the
method double code parentheses open
close invokes that method for you or you
can pass data in the parent
this as well it's that simple to call
dynamic methods as well as much as
setting properties on the object as you
can see here so we looked at the
abstract Factory and how we had we were
able to do that let's go a step further
and look at a pluggable pluggable
behavior I'm sure we all have kind of
used the strategy pattern before but
let's take an example for a minute
imagine you're at work on a Friday
afternoon and you're eager to go go home
or go anywhere you want to go on the
Friday night right and but unfortunately
you have a task on your hand to finish
and you're pretty desperate to go home
after this right and the task given to
you is that you have a bunch of prices
on your hand so prices equals and let's
say the prices you have are 10 20 some
price values right and and so you have
these prices with you and the tasks
given to you is to total up all these
prices and you're saying that shouldn't
be hard I can get there done and leave
quickly you know from work so you write
your method called total prices and what
I gonna do you're gonna take a bunch of
prices on your hand and you're gonna
define a total equals zero you're gonna
return the total value so let's get this
moving first of all I'll say total
prices and send him the price values
first of all of course it's gonna be a
zero to begin with but we can total it
really quickly so we could say for a
price in prices and then we can simply
say total plus equals the price itself
so that wasn't hard at all right so you
got that done very quickly but as fate
may have it before you could leave your
colleague who nags you all the time you
know who I'm talking about comes to you
and says I need one more function from
you and you say what do you really want
well I want to not only total the prices
I want to total prices over say $35 you
say you mean you want something like
total prices over 35 and your colleague
says yes that's exactly what I want and
you look at your watch and it's getting
late already you really want to leave
and you think about what would it take
to write total prices over $35 and you
stare at this code for a minute and you
realize this code does almost everything
want isn't it it takes the price as it
loops through it it totals it the only
thing you have to do is skip a few
values and you kind of look at this and
look at your watch look at this look at
your watch and then you tell yourselves
there's got to be a reason why God
created copy and paste right so you copy
and paste it really quickly and then you
see a total prices over 35 and then you
simply say here if price is greater than
35 so you say then go ahead and total
not otherwise right so you're basically
asking him to total only prices greater
than 35 and nothing else so you got back
working but unfortunately though before
you could call this done your colleague
catches you and says I also need a
function to total under $35 now you're
really desperate you want to leave so
you look at this one more time and you
tell yourselves hey this is almost there
all I have to do is change the greater
than to less than but you know copying
and pasting code one more time is an act
of criminal negligence
right you should never ever do that but
such morality doesn't apply on Friday
nights does it so you copy and paste it
one more time and then you get this
working really quickly right and this is
going to be of course price under $35
making all the copy and paste mistakes
we normally make and that works and now
you kind of slip out quietly because you
don't want to take any more things on
this Friday night well on the way home
there it really hits you and you realize
how terrible you have been writing this
code and the guilty eventually kicks in
you pull over to the nearest Starbucks
and you quickly want to refactor this
code but unfortunately as the luck may
have it some of your friends are hanging
out right there and they take a look at
this and get to know your dark side
right and and imagine what happens now
they don't return your phone calls they
don't want to hang out with you anymore
how life turns right definitely we don't
want to go that far right so how can we
do this so here's an idea let's go back
to this and say you know if I want to
make small change here and I'll simply
say if true great and total prices
then you can see that all those three
methods were almost the same except for
what's in the if parentheses block so we
can easily extract that out that's where
the strategy really comes in so what we
going to do here is to say comma
selector and we're gonna extract that
strategy out over here and say this
selector he's gonna decide whether an
object should be totaled or not so we
send the price to the selector and the
selector says yay or nay and depending
on that we will do the totalling now
let's go ahead and take a look at this
example here
if I go back in let's remove all of
these for a minute and I'm gonna simply
say total prices and I want to total all
the prices so I'll simply say price is
common and this time I'll provide a code
block and I simply say true and this is
going to total all the prices as you can
see it totaled them up and display the
result on the other hand if I only want
a total prices less than $35 and I could
simply say total prices and in this case
I can say it does less than 35 where it
is really a name for this parameter that
groobie uses as a default and we are
simply passing a lambda expression to
this function and becomes a lot easier
to work with
now while this function is just fine in
groovy we can make use of another syntax
sugar we can simply remove this from
here and move this right outside of this
function for example so the last two are
really equal and except we have a fuse
commas and parentheses in this
particular call and becomes a lot easier
to work with now of course this
privilege by the way is only for the
last closure or lambda expression we
pass two functions because the last one
is very special kind of like how last
children are special and families right
I know it because I'm not one of them I
feel it it's kind of like that right so
it's basically the point is that you
kind of treat it special by moving it
outside and you can just keep it like
it's a parasite on this on this function
right so you can just attach to it so
that is an example of how you can
extract of the strategy
and this really becomes very simple to
work with now a lambda expression is
being used here to extract the core
behavior and we simply let the function
do the looping and as a result we can
separate what we do with the data to how
we select it and as to separation of
concern much easier to design and also
notice how lightweight this is we didn't
have to sit there and design an
interface we didn't have to design a
class in fact in Java if you decide to
use a strategy pattern you would have a
corporate design meeting in groovy you
just get it done right it's that simple
to get that done very quickly alright so
we looked at the pluggable behavior at
the function level but we can also do
this at the class level if you're
interested in for example what I can do
here is I can create a class called
equipment and this requires a calculator
for doing some calculations so I could
say calculator as just an object over
here and this guy can take a parameter
of a calculator and I can simply set the
calculator here as a parameter as you
can see now what I can do in this case
is if I want to do a compute method I
can call this compute method for example
running calculation over here and I'm
going to just call the calculator and
and and ask him to run the calculation
at this time so in the constructor I'm
passing a block of code a lambda
expression I'm gonna store that away on
line number 5 and then in the compute
method I'm gonna use that stored away
lambda expression now what I can do in
the code in this case is I could say for
example equipment EQ 1 for example
equals new equipment and I want to pass
a lambda expression to this so I'm gonna
put a little parenthesis and say you
know calculation 1 for example I want to
just print that out so we could simply
call EQ 1 dot compute method and that
should go ahead and call the calculation
we just created not as a small
idiosyncrasy here I mentioned that you
could put this code block outside the
parentheses that is true most of the
time but the problem here is that you're
calling the constructor
if you move this outside gluey things
you are creating an anonymous inner
class and gets confused so you have to
put that in the parentheses in this
particular case but there's a way to get
around this at the same time what if I
want to reuse this particular closure in
my code so I'm gonna say another
calculator and this time I'm going to
simply set this to a equals a little
code block and I'm going to simply say
here a calc two for example so now I can
create an equipment to for example EQ 2
equals new equipment and I can send the
another calculator to it I can even use
this reuse this in another equipment as
well so if I say EQ do not compute in
this case and EQ 3 dot compute we can
see that our another calculator is being
reused in this particular case of
running this example so you can see how
we are reusing the calculator in these
multiple calls so GUI makes it fairly
easy not only to create lambda
expressions and send them around we can
even save them and then reuse them in
multiple calls that trivially without
almost any effort at all so that is an
example of how we could use a pluggable
behavior not only at the Klunk ssin
level but also at the class level if we
wanted to so let's talk about iterator
and of course you may say hey but a
iterator pattern is such a common
pattern we have known this for a long
time absolutely true but we've been
using iterators very differently in Java
and we we will have to kind of realign
ourselves when we get to these languages
that support lambda expressions let's
take a look at an example let's say for
a minute I have some names on my hand
and I'm gonna say this name is Jo over
here I'm gonna say Jane is a name and
I'm gonna create a bunch of different
names I'm gonna use let's say Jill here
and I want to go through and loop
through the names and print it how do I
loop through this in Java you would do
this right int I equals 0 I less than
names darts eyes and usually your
fingers will automatically pass here
because you have to think about is that
less than or less than
equals two right that's called
self-inflicted wound right we
programmers impose that on ourselves
and we don't have to do that right and
and this is kind of really troublesome
in expression to use we don't have to do
that but instead what we can do is in
Java we use the for each statement isn't
it
so we could say name in and then names
in the case of Java we would use a colon
instead of an in to use this whereas in
jar inclu we we can use the in and then
we could simply say print the name for
me and you can see how we are able to
print the name so this is the for each
statement that you already know in Java
it's just that instead of using a call
and we are using a in and instead of
defining the type we were letting groovy
to figure out the type it's a
dynamically typed language after all
right okay that's great but what if I
really wanted the index then of course
you would have to use for I equals 0 and
use it that way well include me we don't
have to do that let's talk about
iterators now under the covers this for
each unfortunately still uses the
iterator so in other words if you look
at the byte code being generated the for
each is simply gonna say if iterator has
next go to the next iterator that's like
having a rude dog that won't move right
and you keep pushing it every few feet
and you got to manage the iteration all
by yourself on the other hand an
internal iterator is a lot more powerful
and internal innovator says I will take
care of iterating and you just tell me
what you want to do for elements
considered in the iteration so this
separates the way we iterate from what
we do in the iteration let's take a look
at an example here let's say I have a
names over here and I say names dart
each and I want to just print the names
I could simply say print it like this
and we are able to use an internal
iterator notice this is looping through
the elements and printing each one of
them you say AHA but wait a minute what
if I really wanted to print the index
value along with the iteration the for
loop makes it very easy to do it isn't
it now this is where the beauty of
groovy iterators come in there are
different flavors of iterator available
so we
say each with index for example how
about that and now we can simply say in
this case I have a index over here and
an element on my hand and I can simply
print the value of the index by the way
and then I can print the element as well
in here and we can ask him to print the
index and the element along the way so
we can use the each with index if we
really care about the indexing and only
user each if we don't care about the
indexing so this becomes quite easy is
it a question back there
no okay so so basically you can you know
use the iterator pretty easily and then
you can index through it but iterators
come in very many different flavors what
if I want to pick the first element from
this collection well let's let's talk
about that for a minute but before then
let's think about this what if I want to
get a collection of the number of
characters in each name just think about
how you would do this in Java I won't
write the code in Java but think about
this what would you do you would first
create a empty collection correct and
then you would loop through and within
your loop for every element you consider
you'll get the length and you will add
it to the collection how do you feel
about that code not so good isn't it
right that doesn't feel right but do we
have to put that much effort to create
this code so notice what I'm gonna do
here I'll say simply names dart dart
collect and it times length because I
just want to find the length of these
elements in this case it's in there so
length is the property or the method in
this case I'm gonna call and that was
one shard to get all the values in this
collection so collect is basically an
iterator that iterates through but
collects the response from this lambda
expression and simply gives it back to
us and then we are returning that and
our we can do more things with it if we
really want to but on the other hand
what if I want to find the first person
with the four-letter words in the name
so we could simply say names dart find
and in this case I say it dart length is
equal to let's say
three or four in this case and it's
going to find Jane obviously because
Jane has four letters in her name so
what does this do
the fine method is another form of
iterator but this iterator only goes as
long as the lambda expression doesn't
return a true as long as the lambda
expression currents are false
it keeps marching to the next element
but the minute the lambda expression
returns are true it immediately returns
the context element back to you saying I
found what you're looking for so again
it separates you were cold from the
looping aspect of things now what if I
want to find all people with four-letter
words in their name I can simply call
find all instead of calling find itself
and that makes the life lot easier now
here's one more thing for you to think
about I'm sure everybody in this room
has done this at least some point in
their lives you have been given a task
to take a collection of data and you've
been asked to print them out with a
comma separated string right so let's
think about this for a minute what would
you do you would safe our name in names
and then you would you could start with
simply saying I want to just print the
name itself right you could start with
that but unfortunately that doesn't have
a comma in the very you know between the
values you could try to put a comma here
and you realize that it puts a comma but
it puts a comma in the very end as well
and and then you say gosh how do we
remove that comma in the very end and
you realize to do that you have to put a
stupid if statement remember that day
and how do you feel about that once you
have to do that first of all for doing
that you probably have to go back to the
for I equals 0 format and when you got
that done you felt terrible isn't it
that's the lowest point of your career
that day right when you wrote that code
and then you went home and you said that
is ugly code I am going to refactor that
and you probably stayed up that night
late into the night trying to figure out
how to get rid of that stupid F and you
could never find a good way to do that
remember that night very dark night
wasn't it well let's see
what GUI does for us in GUI you simply
say print line names dart Joe in and
then you just call that method what a
cool way to do that that not the day I
learnt about join I cried that night
right I mean how could this be that
simple to really remove all this
complexity from code right and we don't
have to write stupid code it provides us
a higher level of abstraction while
you're doing all of this
you are kind of curious you know what is
this riddle you know collection we are
dealing with so you say names dot class
to examine this particular collection
and to over surprise we have been using
all along a Java util erased right so
one of the beautiful things about groovy
is it doesn't give us a new data
structure it simply uses the collection
of the JDK but adds these fluid methods
to the JDK so we don't have to put as
much effort to use the collections we
are already very familiar with so as a
result we can use the collection we
already know about but with a greater
amount of fluency in the code as you can
see right there so we looked at some of
those patterns from the Gang of Four but
let's move on to look at a couple of
other problems we want to deal with the
first one I'm going to talk about here
is really about fluency of AP is that we
want to introduce so let's look at an
example of a common thing we have all
done let's say we have a malar class on
our hand and this malar normally has
word it's got some imagine this to be a
Java code for a minute right it's got a
two method and in the two method I'm
going to simply print out let's say two
and similarly I'm going to provide from
a subject so here's a from method and
here I'm gonna simply say from for us to
see this is going to be a subject method
and I'm going to simply say some subject
I'm gonna pass to this and this could be
a body method which takes a message over
here and this could be a message I want
to print let's call it body and finally
I have a sending method so it's going to
say sending and do a send method it
doesn't take any parameters but this is
going to be a sent
so how would
use this typically in Java well the way
we would use this in Java is we would
say mailer equals a new mailer right
would create the mailer object first
maybe you even put a semicolon to say
that this is a way to look like in Java
and then I would say mailer dot and then
what we do here mailer doc and we could
say two and the two would be whatever
you know address you want to send here
that's gonna be my email address it's
gonna sending it to and I say mailer dot
from and this is going to be water were
from address maybe this is going to be a
my builder that's gonna send it to me so
let's call it as builder at you know
calm and then finally I have a mailer
dart subject and it's gonna send me an
email with the subject I called it sub I
think so we'll call it sub and what does
it do
sub is going to simply send me a message
of some kind right so this is gonna say
you are code sucks or something like
that and finally a mailer dart it's
gonna say body and then it tells me how
my code sucks that day and mailer darts
send finally to send out the email
itself now of course the code works
this looks very similar to how we would
write in Java but the point really is
this code suffers from a number of
problems right the first problem is look
at the noise in the code we kept saying
mailer dot mailer dot mailer dot mail it
out so many times and that's got total
lack of fluency the second problem is
that we also don't know what to do with
the mailer at the very end of this code
can I reuse the mailer or should I throw
it away there's no clear answer here
unfortunately right so can I just go on
and call more functions in the mailer
well unfortunately we don't know that
and the worst thing we can hear is go
read the documentation right and we know
how helpful documentation usually is so
what can we do about this well even in
Java we could use method chaining for
example so one thing I'll do here just
as an example in this cases I will
remove the body of this code at the very
end we'll simply return the current
object at this and now we can do a
cascading actually so we could do this
in Java as well so I'm going to remove
all these guys and
Kaskade it so rather than putting a
semicolon in the end we just ask him to
cascade through and this is called a
cascade design pattern so we can kind of
chain these method calls we can do this
in job I'm sure probably seen this
already in things like Jews are easy
mark and you know tools like that you
can nicely flow through this and
implement it very nicely so that is an
example of a cascade pattern and we can
do this in Java but we're not
programming in Java here let's see what
GUI can make you know provide for us so
I'll remove that little feature and get
back to this code and how would we use
it so back to where we were a minute ago
so so how is this going to look like so
let's go ahead and put the code back and
rather than doing this I'm gonna turn
this around just a little bit so I'm
gonna make the send method static first
of all so this is no longer on the
object it's going to be on the class and
to the send method I'm gonna pass as a
parameter the body or a block of code as
a parameter so in other words I want
this to run within a context of the send
method a few things so we turned around
the send method to be a static method
and we are sending a block of code to it
so what am I going to do within the send
method I'm gonna create a mailer equals
new mailer and once I create the mailer
I'm gonna say over here mailer dart
width and I'm gonna pass the block
object to it now what does that really
mean that line of code says when you
call a closure or a lambda expression
which is the block that's given here run
that in the context of the naylor object
that's what the width is saying so in
other words if this block of code
doesn't know certain things it will then
send it over as a delegate to the object
to which its invoke the target object so
this becomes very convenient now what
does that really mean how does it really
work to understand that I'll take a
break from this example and we will come
back to this example in just a minute
so let's go ahead and look at a little
you know closure here let's say closure
equals and and simply I'm gonna say
print hello here and that's all I have a
little
rent of that and I call the closure
right here so you can see that it just
printed hello but on the other hand I'm
gonna remove that part right there and
I'm gonna simply say print line to
uppercase for example now when I run
this it breaks because it doesn't have a
clue what to upper cases it says what
are you talking about right now the
beauty of closure is if it doesn't know
what you're talking about
it can either complain like it just did
but before it complains it'll go look
for a delegate object and say hey
delegate do you think you can handle
this and if their delegate can handle it
then it's more than happy to use that so
what I'm gonna do here you simply go to
the closure and say dar delegate equals
and I'm gonna say hello here for a
second now I invoke this method and
notice how it prints hello and the
reason is now that I've attached a
delegate to the closure it knows to go
find the to uppercase in the delegate
that's attached to word so this is a
very powerful mechanism we can use in
groovy code so what I'm gonna do here is
to make use of that right here in the
code we're working with and that is
exactly what I did by using this method
called the width method so the width
method really sets the delegate of this
object into that flow to the closure
into the closure so it can really use it
so now I can come and make use of this
very nicely so what am I gonna do I'm
gonna get rid of this mailer stuff from
here and I'm gonna simply say mailer
dart send
I'm calling the sender method and within
the send method so I no longer have to
call this send method that's not needed
anymore and I'm gonna move this code
into this here I can get rid of quite a
few things here so I can get rid of this
mailer entirely from here I can get rid
of this parenthesis from here also so
notice what happened to this code it
looks more like a configuration file or
a data file more than anything else and
this leads us to creating something very
lightweight like a DSL or a
domain-specific language and if you just
show this part alone to somebody and say
what does it look like chances are
they're gonna say look
the GUI code unless they have GUI
programmers right so they gotta say that
looks like a data file or some kind of a
configuration file but notice that's
executable code so data becomes code and
code becomes data in a way and you can
create that almost effortlessly here and
and that introduces fluency so in this
particular pattern what we have done is
we have simply used the simple case of a
delegate attached to a closure and we
are able to execute in the context so
we're using lambda expressions to create
a fluent interface in this particular
case and that becomes pretty easy to
work with so so as you can see that's a
very powerful mechanism that we can
implement by creating these lambda
expressions
very powerful to play with lambda
expressions and create fluent interfaces
if you will the next pattern I want to
talk about here is really gonna tailor
on the ability in groovy to create meta
programming what is made-up programming
meta programming is where you can create
really code at runtime on the fly now
there are different ways to do meta
programming and and I want to kind of
separate meta programming into two
different ways of approaching it and I
would like to call it as method
injection versus method synthesis and
and metal injection is good but method
synthesis is even more powerful that's
where the real power is in my opinion so
what is this metal injection is where
you walk up your class and say excuse me
would you like to have another method I
think this will be very convenient to
have that is Method injection let's take
a look at an example of method injection
real quick so I have a string equals
let's say hello over here and I want to
just print this string right there I
print the string value that's all I have
done right but on the other hand I want
to be able to print out let's say I meet
somebody after a long time I'm excited
and I want to shout hello to them so you
decide it'll be so cool to say shout on
this like this isn't it now of course
when I try to run this it doesn't work
because shout method doesn't exist on
this object well it would be so cool if
we can have a
method so Gluba metaprogramming allows
method injection method injection is
where you can walk up to a class or an
object and say it would be so cool to
have this method here take it so this
could be like an encrypted or in a web
service it could be a method that really
based on the flow of logic through the
system you decide to inject certain
behavior into this object so I can say
string dot meta class for example dot
shout and I can say this method is going
to be simply returning to uppercase in
this particular example so notice in
this case I call the shout method right
now and it's able to implement their
child call and of course you say wait a
second did you just add the method shout
to the famous Java dartlang.org ant ache
any class and add methods to it you say
how dare you touch the java.lang string
well the last time I checked we live in
a free country right so it's our code we
can inject methods to do anything we
want to right so absolutely we can
inject methods into that now this is
Method injection but notice we injected
the method into a class but I'm not a
big fan of doing that I would much
rather inject methods and to instances
rather than classes now why so the
reason is injecting methods into classes
pollutes the all the instances within
that context in the container in in the
JVM the class loader in the JVM which is
not very desirable I would much rather
inject into this particular object and
that's very useful in the case of web
applications where you can get a request
and through the request you have
something injected once the request is
over that's that's for garden right
you're kind of isolating it in the test
cases it's very useful because within
that test I can inject methods into this
particular object very easy to mark
things but it doesn't affect the other
test keeps the tests isolated from each
other how do I really do that extremely
simple rather than saying string dot
Mara class you simply say STR dot mara
class now you injected into the single
object rather than polluting all the
objects of this predator class so if I
were to call
the shout method on another object of
this class now it wouldn't have the
shout method only that particular object
has that method so you saw method
injection at this point but like I said
the real power comes in method synthesis
method synthesis is where you can create
methods on the fly based on certain
context an example of where method
synthesis is being used very heavily is
Grails for example and in Grails
based on the tables in the database you
can call methods dynamically on it and
it would synthesize the SQL query for
you on the fly based on some convention
another place where I use method
synthesis quite heavily is when I create
highly dynamic VSL domain-specific
languages because as I'm flowing through
the DSL my program will learn about a
certain kind of input that come in and
based on that input I can create certain
behavior that can be exercised further
down in the chain in other words this is
kind of like the application of the
command pattern but with the application
of meta programming on our hand let's
look at an example of how we would do
this so I have a class called person and
this person is going to be having only
one method right now called work and
this work method simply says a print
line working that's all I'm gonna put
here right so pretty boring method it
all that it does is work now we can call
for example we can say Sam equals new
person and create a person object and
once I get the person object again say
Sam dot work over here and call this
method right so but what if I want to
make this very dynamic well I don't know
what all these method can do so I could
say Sam dart activities and I could set
some activities on Sam for example I
want Sam to play a football for example
and then I want Sam to play a let's say
tennis for example right so we could
give capabilities of Sam Sam on the fly
and say here are things you can actually
do now of course in order to facilitate
this I'm gonna write activities as as a
property in here now I want to come
down to Sam and say Sam dart play
football for example if they play tennis
and I want to call play tennis on Sam
and I want Sam to play tennis all of a
sudden of course this could be creating
SQL queries could be creating some other
dynamic methods but another example I
just print out that Sam is playing
tennis but how do I do that so if I run
this code right now we got a error and
the error says missing method exception
play tennis it doesn't have a clue what
play tennis is so what do I do I'm gonna
go back to this code and write a very
special method called a method missing
and this takes the name alpha method and
also an arguments collection I'll also
along the way and I'm going to simply
say you called and I'm gonna print the
name that's all I'm gonna do here right
I would like to call this method missing
as the mother of all methods right it
says come to mama if you don't find it
so it intercepts the call and says I can
respond to this for you so it says you
call tennis but of course you want to
put some logic and rules here so notice
what I want to do now I'm gonna simply
say if the name of the method starts
with play then consider it otherwise
what do I want to do else I'm gonna
simply say here throw new missing method
exception and the method exception is
going to be for the name given to us on
this particular object with this
particular argument so if I don't have
this method it's gonna throw an
exception for us and tell us that it
doesn't know what to do
so I'll just simply return if it was
supporting that method and you know
supported let's say supported and
otherwise it's going to throw an
exception so you can see the working was
called because I have the work method
let's get rid of that we don't need to
look at that anymore in this example so
I call the play tennis it says you call
play tennis it didn't fail but on the
other hand if I say Sam dart run for
example that fails because there's no
run method on Sam so that part is
working fine right but of course I don't
want to just support any method I only
want to support methods that start with
the play so notice
we are introducing some conventions or
rules in the code but I could also say
but not any method that starts with the
play because Sam is a nice guy he
doesn't want to support play politics
for example right that's not a good
thing to do so he's gonna support play
tennis or football but not play politics
how do you implement that so I'm going
to go back over here and say if it
starts with the play then I will say
define activity equals name dot split
and it's gonna split on the word play
and get the first element out of it if
activities dot contains over here and
what does it contains the activity we
are interested in then I want to support
it and similarly I will say return
supported otherwise I'm going to simply
say supported activity let's say
activity and even want to print it here
and then I would simply say you know
return supported let's say true for a
minute so supported activity or let's
say I would like to play right and we
can print that value right here so when
I run this now you can see it says I
would like to play tennis but it says in
the call to play politics it ended up
failing right there so we can see how we
can inject this behavior into this class
and then based on the context we can
resolve what we want to do in this
particular case ok that's great so far
but how do we go about utilizing this in
the code to really inject this in a more
efficient way that's the next thing I
want to look at so notice what I'm gonna
do here I'm gonna call this play tennis
a few times and notice each of the time
it takes a hit because it says you call
play tennis you call play tennis so
every time it goes to the method missing
after all this won't be very efficient
isn't it
so when Grails was being created grando
sure came up with an interesting way to
avoid this overhead he called it the
intercept Kash and invoke pattern
basically the first time the method is
called you intercept it then you
dynamically create the method and then
you cache the method so from the next
time onwards
don't take a hit in calling it so notice
that in this case every time I call the
meth that it goes to the method missing
and we're gonna completely avoid that
let's see how we can avoid it
so what I'm gonna do here is rather than
simply executing that body of the code
right there let's go ahead and capture
that code into a lambda expression so
I'm gonna say implementation equals and
I'm gonna simply say object array is the
args I want to cash that away right here
and I'm gonna say this is the activity
that I'm creating right there and I'm
gonna call that activity with the
arguments given to me but before I'd
call that particular method and I can
even return whatever he returns to me
but before I call that I'm gonna cash it
but how do I cash it so get Mara method
on the object and I'm gonna say on this
object I want to set this property but
the name is really the variable that
contains the name of the method itself
so we use the technique we learned
earlier so I'm gonna say dollar name
equals and then I'm gonna simply set
this value right here which is the
implementation that we got so far so
when I run the code this time this is
going to be get Mara method on the
current object right so on the current
object we'll get the Mara method I'll
get metaclass rather right so part of me
so right there
we're gonna say you call play tennis but
I'm going to basically reuse this object
and not having to call this several
times so notice what happened in this
case I want to say print line of course
when I'm printing this so let's say
print line so now notice what happened
it is able to say you call platon is the
interest if we happened the first time
it created this implementation cast away
the implementation and now when I call
play tennis the second the third and the
fourth time notice it never went to the
method missing it ended up using the
method it already cashed away here is
another way to look at it so notice
right here I'm gonna first of all ask
him Sam dot Mara class dot methods darts
eyes and he's gonna tell me how many
methods he has he's got eighteen methods
in it but after I inject the method
ask him one more time how many methods
he is guard and notice this time he's
got 19 methods because one method was
added by our method missing so we
synthesized the method but immediately
injected it as well so it can be very
efficient for subsequent calls so that
is an example of how we can use the
intercept cache and invoke pattern in
meta programming so we can give dynamic
behavior to code but at the same time
you don't have to suffer the
consequences of overhead in calling
these methods we can cache them and use
them as well and the last pattern I want
to talk about here is a pattern of
delegation now we all have read books on
object under design and what does it say
it says delegation is better than
inheritance and we should not use
inheritance merely for code reuse we
should use inheritance when
substitutability is really needed
meaning you want to substitute an
implementation of a class into another
place where a base instance is expected
well that's great we all agree to it and
then we put down the books and we use
inheritance and the reason is Java
doesn't make it easy to inherit in fact
if you're using something like a good
IDE to like in you know IntelliJ IDEA
they give you features where you can
right-click on the inheritance and you
can say turn inheritance into delegation
and then in front of your eyes you will
notice it removes the inheritance and
adds each of those methods and routes
the call to it but unfortunately while
that's very fancy IDE that doesn't
really stay longer because the minute
you modify the class you add a method to
it you have to come back and add a
method over here if you delete a method
from the class you got to come and
delete the method here right becomes
painful would be nice if the language
can handle delegation
really nicely let's look at an example
of how we can use delegation and groovy
because groovy has this baked them
already but the beauty in groovy is this
is a compile time metaprogramming not a
run time metaprogramming so in other
words when you compile the groovy code
the groovy compiler will
add at compile-time these extra methods
so when you recompile the code the
methods would go away based on whether
new methods are added or removed from
the class itself so let's look at an
example let's say we have a worker class
and the worker class contains a method
call to work and all that the work
method does is simply print out let's
say working right let's also create
another class here called you know
expert over here and this also contains
a work method so I have written the work
method here and this work method simply
says you know expert working this is
also another method called analyze and
this method simply says analyzing let's
say analyzing right so that's basically
our code now I have a class called
manager as you would expect this manager
does nothing and I want to simply create
a manager object here so manager equals
new manager but this manager is very
smart I'm gonna say manager dot work and
I'm gonna call manager dart analyze or
the two methods I'm gonna call on this
manager but this manager is extremely
smart he simply says define over here
actually I'm gonna define a word cur
equals new worker and I also have an
analyst or expert equals expert equals
new expert right and the manager simply
says I am going to simply have a
delegate over here and I'm gonna
delegate everything to the worker first
if the worker cannot handle that I will
give it to the expert right pretty smart
manager as you can see right here so I
run this and notice how the managers
work is calling working and the managers
analyze is calling analyze and it's not
calling the experts work method in this
case and the reason for this is when you
run this code what you will notice is at
the compile time it takes the manager
class which doesn't have any methods at
this point go ahead five more minutes
thanks so it takes the manager class and
which doesn't have any more any methods
in this case and
basically says I'm gonna add all the
methods of worker into my class if that
methodology doesn't exist then it says
I'm going to go to the expert and add
all the methods of expert into my class
but only if those methods don't exist so
at that very moment remember the work
method has been added to the manager
class from the worker so it will not
bring the work method from the expert
but it brings the analyze method from
the expert at this point so you can see
how it does this but but the beauty of
this is this is purely a compile-time
metaprogramming so if you're interested
in looking at this a little further you
can do something like this you can bring
up groovy shell or a groovy console
rather so if you bring up groovy console
this is a little IDE that you can kind
of type a little bit of code and play
with it but what's really exciting about
groovy console is that it can also show
you the transformation of code along the
way as well so so I'm gonna take this
code we just wrote right here I'm gonna
copy and paste that code here into
groovy console so we have this you know
worker and the analyst analyst and
manager all this code sitting here I run
this code and it tells us what the
output is and then goes through the
compilation process but what you can do
here ignoring that error for a minute
you can look at inspect ASD and you can
take a look at the abstract syntax tree
if you will so I know what the problem
here was when it copied it copied a
bunch of things that didn't belong to
the right place let's fix that so here I
have the manager right there let's
remove all this part so there we go I
run this code and now I go to the
inspect ast and you can look at the ast
in different faces so at the very
beginning of this I don't have much over
here if you if you look at this output
that I show here I've got the worker I
got the expert sitting here and I also
have the manager right that's all I have
as you can see at the very bottom I have
the manager class but if I go through
the ast faces and look at what was
generated eventually
would be seeing a lot more code in here
and if I scroll up to looking at the
manager itself over here you will notice
that the manager class has acquired some
really interesting methods over here
notice the manager class right there
after the transformation was over not
only contains a constructor but it's got
the work method added to it and the work
method is simply calling the worker dot
work similarly it's got an analyzed
method added which has export dot
analyze go ahead please like like
debugging things well I really don't
know because I don't write code with
bugs no the point is you still well
remember that ruby is dynamically typed
so off right off the bat we have to do
fairly decent amount of unit testing so
certainly we have to rely on more unit
testing you could use the debugger to
step through the code but remember again
any time we are using any language on
the JVM the JIT compiler already does a
lot of transformation as well right so
we still have those concerns but I would
say rely more on unit testing and
debugging itself that's that would be my
answer and then we can make sure that
behavior is what we expect in that
regard so so that shows us how we are
able to use delegation pattern and the
beauty of this approach is if you remove
a method you're going to remove the
method from here as well in the class if
you add new methods those come into the
class as well so it's pretty much in
sync with the code and becomes very
effective so we saw not only how we can
use some of the patterns we are already
familiar with but with a lot more
conciseness here in groovy but they also
see that if there are other patterns we
could use because of the dynamic nature
and meta programming also that we have
available to us in the language itself I
hope you found that useful that's all I
have thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>