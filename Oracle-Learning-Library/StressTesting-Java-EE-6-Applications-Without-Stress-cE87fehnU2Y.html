<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Stress-Testing Java EE 6 Applications Without Stress | Coder Coacher - Coaching Coders</title><meta content="Stress-Testing Java EE 6 Applications Without Stress - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Learning-Library/">Oracle Learning Library</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Stress-Testing Java EE 6 Applications Without Stress</b></h2><h5 class="post__date">2013-02-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cE87fehnU2Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Adam bean I'm freelancer
working mainly was mainly I'm working
with Java and Java 6 and Java EE mainly
with Java 6 about 90% of my projects in
Java 6 and I'm usually in projects which
either have some trouble or starting um
it is unusual to meet or to be in a
project which goes well which is
probably not another another good sign
I'm usually hired us to help by task
forces or stuff like that and what I see
and I've spent most of my time in Europe
so all my experience is biased on Europe
so I have no idea how it's how it works
here in US but in Europe I can tell you
our what they or I encounter in my
projects and I would like to share the
experience with with you this is my
fourth talk and in the course of the
first three talks I got lots question
asked like what is the overhead of
interceptors on our is jax-rs slow
what is the overhead of eg B's is there
are three questions I remembered and I
thought it is a lots not funnier to you
and probably to me as well to show you
on stage what the overhead really is how
to watch which tools to use and and and
how it looks like and how it operates
and then I can I can explain you how you
can apply this on real real world
knowledge this is a my my idea
so instead showing you 200 slides now we
show a little bit a little bit more code
and working deployable code I think is
okay you see someone who previous slides
over code no one okay no managers here
okay perfect Oh two books somehow
related because of time these are great
but you have no time to explain how
great they are
so in the green one came yesterday on
Amazon could be interesting for you so
in Europe most of the projects leaders
project managers and kuai departments
are really excited about code coverage
and unit tests what I do not understand
at all because if you say you have code
coverage of 80% it could mean that you
did your architecture is crappy and you
tested 80% of getters and setters and to
string some hash code but because of
lack of time you forgot to test the 20%
of significant code by the way how it
works you can ask me question at any
time I really like questions I don't
like to speak the whole the whole hour
so if you have questions feel free to
ask immediately this is the how how it
how it works in my sessions so and the
strange thing is in Java II if you if
you think about this and unit test is
executed by a test runner in single
threaded mode it means your application
will never ever run in single thread
mode and I have to admit I never had a
problem because of wrong implementation
of business logic but we had a lots of
problems because of memo leaks
bottlenecks inconsistencies with
optimistic locks transactions cache
cache problematic and this problems are
widely ignored so not ignored in most of
my project they are so called load tests
and what load test mean at least in my
projects pick a project or a solace so I
would say two days before going live
production yeah they are starting their
load test and praying that the load test
is green and if it isn't can you help us
you know the tune the parameters so we
can pass and go to production so what it
means the actual testing happens always
in production and it never works and
this is why I'm actually busy so because
after that I get contract to fix the
problem and the funniest story is I have
a customer which hires me once a year
after the release and they never learned
from that when and the last time I send
him exactly the same image as year
before so look we have do exactly the
same as last year let's do it and what
we did I would have shortly explain so
why load tests are strange load test a
strange because they are in my case is
defined by the business department and
they are more or less realistic and
realistic mints means there are lots of
think time and what think time means is
like thread sleep so you have rod lots
of users and no no contention so I mean
with a usually load test you can just
test whether your system somehow meets
the requirements
but whether it works no idea so this is
why the talk talks about stress testing
and not load testing or robustness
testing I don't care about load tests so
all all systems and projects I saw there
are parts enough but they didn't work so
I'm more important to me is to try to
break the system with with massive load
and see what happens behind the scenes
so before thinking about them is a
shion's just write simple code perform
stress test and see how it behaves and
you can learn a lot this is actually my
idea but this is not very common so in
my project okay actually great but we
have no process for that so because
there is no process for that we create
our own process so I will show later
what you actually do integration tests a
little bit more interesting what what I
always do is I separate between unit and
integration tests unit test means
everything is mock out so it's nothing
to do with job basics with mojito for
instance an integration test either you
are starting embedded derby for instance
or using great tools like Arcadian
graphene or satin with something like
this where it can actually boot the
application server in process and and
and test your dependency injection or
whatever some infrastructural dependent
code so stress tests this is what I like
and how to start with stresses just keep
it simple so the first day other the
best stress tests were created by
students so and and the mission was
break the system here are the machines
generate as load as much load as
possible try to break our server that's
the best job ever for a student just
take the system and the first experience
we have meet hire meet with I would say
and also a consultant with I would say
with consultants who make you know
doctoral theses about how to create a
stress test just Jerry generate massive
load and the first page login page or
the funny story
I was hired to evaluate one one portal
and I started with the login page and
what in the login page happened this new
threat start and it loaded something
asynchronously which was actually
expensive
just with testing the login pages well
actually this year I was able to create
1500 threats I was I was not even a word
that the the window system is able to
handle that and after ten minutes are
tough to my customers see you in two
weeks because I mean or the broker you
know they use Tomcat of course because
of lightweight I don't know what but so
stress test so why we need application
service so this was already so from my
point of view a little bit extreme
statement what containers are no more
interesting for me never never were
why what's actually very important in
building enterprise application is have
a little bit more control over parallel
processing so what you can easily do
with any application server you know is
just create a session bean pool for
instance and say Mac size 10 what Mac
size 10 means there will be never more
than 10 exact parallel transactions try
that was tanka impossible so it is very
easy to break a tomcat
because tomcat does or any any other web
container because web containers have
global global resource management and
the application server far more
fine-grained you can you can you can
create dedicated thread pools and
associate for instance with one single
egb you can prevent the yell of service
attacks in terms of the application
server will not break without of memory
for instance what's also very
interesting the application server
they come with JX java management
extensions all my task forces based on
web containers were more or less a blind
flight so you can connect the tomcat or
whatever web container you you would
like to what do you see this number of
sessions number of requests and nothing
else
everything is poacher so what we
actually did in one in the worse case we
build in six weeks
j makes monitoring from scratch for a
tomcat because was too late what you
usually would get for free on every
application server since j to you one
for this is the crazy thing so
why is that because at least in Europe
the development operations are separated
so the developers do not care about
whether the system will work or not they
just create the business logic right 80%
of coverage and pass it to production
and the pure production guys say they
don't know the system try to run it in
some companies they just look at top for
instance I had worked with with experts
and so it does the system running so yes
the protests still alive that which
approaches a PS marks there okay but
everything else is dead I mean okay you
see the job approaches working does the
system work what you mean by that
okay forget it right and this were
Enterprise expert Rudy so I'm okay after
harder arguing with them they told me we
need a Java course okay it is a great
idea so I'm so application service gamax
pulling something like incoming queue
but this is also available in Tomcat so
you can see whether the application
server is overloaded or not connection
pooling you can monitor connection pools
really interesting so and why is that
interesting because if you try break the
system you have to monitor it somehow
whether it works or not with web
container you don't see anything with
application server you see everything
but in my projects no one was interested
in the information you've just widely
ignored it didn't even knew that the
application server is capable to provide
this monitoring data okay what can go
wrong what we went orgh orgh can go
wrong
I mean static synchronized and you have
a memory synchronized and you have you
have a bottleneck system.out.print line
in your in your scalability is damaged
and can cause cause deadlocks single
system out print line because this this
print line is synchronized what else
memo leaks newts new new new thread dot
start this is a typical case you only
will find that in stress tests never in
low tests because the think time you
will get 300 users 300 users 300 threads
not a huge problem then in one system
they use spring which wasn't a problem
at all but what what they didn't know is
that spring defaults are singleton and
then
synchronized and at they build an own
the old system of course but I know JPA
but the problem was then that a certain
amount of load it just broke and you we
were in it because everything queued up
and it's a heap went up and this this
was 32-bit a JVM so game over we
couldn't do nothing about that so um and
my point is you don't have to know
everything up front but you have to
perform tests from day one and learn how
it looks like when the application
server breaks you have to learn from day
one and this is actually fun that is
never done and and how it how it can
work is what we do we create every night
a stress tests which is run
automatically by Jenkins and in the
morning we look at the at the results
and see whether the actuary's is still
alive or not an interesting story
regardless how simple the application
actually was it never survived it the
first two first few days so either the
connection pool was too small or the
thread size was too big or whatever it
always died but not in production this
is what why the title is without stress
people have only stressed because they
do never do it and in production that
they they pray that the system will
survive the load in production or the
hackers question so far everyone agreed
this web containers are not usable
there's the odd one very good this what
this yeah Tommy is great but Tommy is
they recognize that plain Tomcat is not
a solution the build on Tomcat jar
basics and by the way Tommy is very fast
I used Tommy for my current project for
testing is just great Tommy but Tommy
you know it's openly GB with this is a
full spec application server I mean yeah
but I have to admit I never never
monitored Tommy yet but I would like
JBoss is no problem GlassFish great even
WebSphere provides monitoring
capabilities if you have enough time to
boot everything then
WebLogic other others they have her
grades monitoring capabilities and Tommy
I would have to never did it because
it's been you but yeah okay other
questions TC server ah
okay I know about that this is a this is
a great alternative to Java six I was
asked about if he is spring okay yes I
would if I were forced to use spring I
would use TC server why but it comes
already with with support everything and
monitoring this is service also not
comparable to pure web container because
it comes already with the monitoring
capabilities I'm saying just using
Concord right now is crazy this is my
personal opinion
okay very good
yeah yeah yeah very easy we can do it on
stage with no resources I will show you
how and you can so this is continuous
stress testing so what it means just to
answer your question straight I use
Jaime test open source and now is the
first tag you use the UI from jay Mita
to record the test or whatever now
recording test can be hard
so the first tag is I show you later is
what I always do in case the system
doesn't have convenient api's I create a
sublet 300 in the do get method I
implement my test script with Java and
expose the do get method foo jmeter
extremely simple okay I have one simple
URL and can access the server directly
and the servant accesses in process my
eg be CDI or whatever and then you store
the configuration from jmeter and you
can launch jmeter from the command line
without you I and this is the hack and
the command line parameters are J meter
minus n minus C minus n is no UI minus C
minus
is your configuration yeah here's the
configuration and then write a shell
script or batch file and you can launch
the test from Jenkins all okay all you
have to do agreed
so the next challenge is what if my
system is dependent on legacy host
as/400 I don't know cos then you have to
write a mock simulator or something like
this you have to mock out the external
system otherwise it's not always allowed
to access their the external system at
night for instance right because the
host can do something else or whatever
so then you have to write a simulator
which you would probably need anyway
okay any other questions you are tired
of the Java or nothing no generation not
interesting for me for us why because it
is defined by the department with lots
of sink time it is net it is nice but
not really usable to find out bugs
performance barks stability bugs my
personal theory is there more a lot we
are able to generate that more likely
will find the box it is not given that
it will find everything but we can
increase likelihood this is actually the
idea yes
less likely to find out to find barks it
makes the test more realistic in terms
of the system the system is able to
handle this users would be and without
think time we are able to find
synchronization bottlenecks and we can
find out we can more easily break the
server yeah and I'm yeah a bike and you
can tune the application server and
unsubscribe questions for instance can
we sort survived 300k sessions so I get
the question a lot and they argue in
meetings two days
what can we handle instead to lunch and
jmeter in one hour and see what happens
this is this is actually the idea so we
stress testing you can reduce the amount
of meetings which is great okay I I
cannot stand that eight hours you know
dream sitting on arguing about
scalability on whiteboard you know and
in five minutes we can find out on a
laptop you know this is okay monitoring
so I keep it simple at the beginning use
the standard technical monitoring which
is available by application server and
now it comes what lot most of the
systems are lacking is like I don't know
what the real name is something like
business monitoring so how many others
we are able to produce per second not
how many transactions do we have some
some learn more business and you can do
it easily in with Jam X and of course eg
bees the easiest way we see the I not so
because you need sometimes timers or
something like this
it means you know what you are building
and you probably know what's interesting
so just expose that also by atomix or
even now comes the interesting part via
rest because Jo mix is great but the
operations don't care about gem X if you
expose the monitoring data by arrest
which is really really really simple you
can access from perl PHP or whatever
hack you have the HTTP data and monitor
that continuously this is the other the
first thing which can happen it happens
rarely my project because there is no
use case on the user stories so there's
my Mike my my fight with our they come
scrum master
say no no no there is a the product
manager has to define it and they go to
the product manager at this guy don't
even know what what we are talking about
okay this is out of scope I don't need
that okay it's extremely important to
expose monitoring data business
monitoring data okay then there is a
concept called synthetic transactions
what synthetic transactions are is
something like a pink a real pink it
means an empty transaction this is
actually a term you can look up in
Wikipedia an empty transaction which
passes all the layers and comes back and
you can see whether your system is
actually behaves correctly or not so in
some cases I saw a synthetic transaction
like JSP with hello world which was
exposed in production you can imagine
not hello world but some kind of JSP
with useless data this was used for a
huge portal to see whether it is alive
or not okay profiling so if you if you
are under stress you can provide the
system and get an idea how much overhead
is generated by jeebies restful
communication core bar whatever you have
and the problem was profiling is it's
heavy weight so heavy weight means most
profilers changes the byte code they
inject interceptor interceptors between
the calls and it's really slow so now
comes the hack you know probably visual
VM I will show you later so visually
will VM the newer one comes with sampler
what is great so you have about 2 to 3
percent overhead and you can it is not
exact because it samples every 100
milliseconds or something the system
what it does it it causes tech traces
and compares the stack traces this is
how it operates so without even using in
production if you project interview
projects and what do you what do you see
what you see then what is the main
overhead of the system so what actually
causes the overhead you will be
surprised what it actually is so it's a
bit yeah yes I don't on all platforms
I'm aware of so I'm using an Linux
Windows and Mac I have no idea about are
you didn't found that
here's a or you don't get my Meg what
you can do visual VM door java.net then
download the DD newest one and you get a
native package from Meg could drag it to
application it works and I'm always use
the recent one because sometimes if you
have JDK one six this visual VM which
comes with JDK 1/6 doesn't have the
sampler just the profiler and the
profile is not really usable by the way
visual VM is actually NetBeans okay it
so on and so on every machine you have a
NetBeans no oh
j9 I don't know whether we were able to
connect to - j9 but you don't get all
the all the profiling things if you have
IBM WebSphere for instance I've been
website comes with a great I won't know
what's called it is built-in in the
administration console called like
performance something and this is also
great so you'll get all the metrics
right there and if you have WebSphere
there is a great book like administering
web so with Titan which we can access
via scripting API all the data as well
so I mean there is no excuse this was
actually the basic basic answer yeah the
trace the trace is great if you have
linux solaris and linux a little bit
less but what DTrace is you are able to
monitor the system from the JVM to the
network drivers for some application may
be interesting for my application it
wasn't because because we had problems
with system.out.print line or not you
know whatever but decreases getting a
great tool if you have Solaris very good
other questions
so what are my slides profiling ah this
is the last slide very good so ignore
thank you I thank you for your questions
but the think it was for later so so
first question how much overhead is
generated by an application server so
you cannot imagine how how many hours I
spend in meetings to explain that there
are over it is not as expected so and
the
easiest way to find it out is just to
see what it happens here this is a
connected with GlassFish perform GC and
you see it it uses right now 77 megabyte
but I already deployed an application so
it would usually use 60 max so if you
use JBoss is very similar and to me as
well I think J what is the smallest J
with seven is the smallest one so I
measured but but this doesn't matter
this is five five makes difference so
and and Tomcat is of course the smallest
I think Tom case comes with five two
eight eight makes REM and in my project
you have to imagine we have no huge
service and I'm in a room full of full
of architects and managers say ok glass
which consumes 60 max and Tomcat 5 so we
have to do the two to use Tomcat so ok
we have we can we can save about let's
say 100 makes RAM try to get go to a
radio check or whatever and try to buy
100 make REM Ric you will say probably
two cents you know with the Tomcat in
production and this is just crazy even
space disk space on disk there's almost
no difference so all application server
size no web sees a little bit different
but it's getting better the web say 8 is
get is really really an improvement it's
like all the services are about 100
maxims disk and Glenn and Tomcat is
about 10 mix on this so there is no
reason for resource resource consumption
to use Tomcat except you really have to
save 20 cents and then you have
completely other problems I would say
with your budget you know and so I am so
this is what I don't get and also the
notion of lightweight and heavyweight we
have argue Tomcat is lightweight but the
problem is there is nothing there are
just a sublet of course and what I saw
is no kidding worse 500 makes big
because everything which was lacking on
the Tomcat was in the war and they so
and the architect told me is a
lightweight project ok yep lightweight
server bond audio project and what I
thought my improvement was there was not
very serious but it taken the sea
just package Tomcat was depart on a
trifle and make war it doesn't matter
anymore you know you can just rip
everything and just start the DD war we
like check Jenkins does and they saw
then how crazy this actually is so this
times are over
for my from my perspective but the best
thing is just connected with visual VM
stand the server without any
optimization this is actually a fresh
installation because yesterday a
download NetBeans beta and the guest is
the glasses which came with the beta and
this is actually out of the box so it
grows because it has max size 500 Meg's
so there is no pressure to release the
memory okay so these are the threats
this is a nice plugin called stack trace
Explorer or something so if you click on
the threads you see the stack trace it's
very usable if you have some dead logs
in production so there's a couple of
plugins you can install with with the
visual VM so what I have is visual GC
thread inspector but you will find that
it's just I don't know a couple of
threat inspector and and visual TDA
model and visual GC the visual GC is a
little bit more interesting here what
you see here is what the application
what the garbage collector collector
actually does so you see here perm gen
alt and Eden during their stress test is
essential to us that this doesn't move a
lot so this is the first thing because
this this causes the major of garbage
collections now this is actually the
first thing so if you have the students
huh
look at the green bar it should move on
out and if it doesn't move is everything
okay
the Eden can move this shouldn't and if
this gets increased we have other
problems usually OSGi on something
static loaders or whatever Canon of
course
visualg see threat inspector and I think
this is what just this lock file module
adjust you will get installed it because
its dependency so the crucial ones are
threat inspector visual G C and T DSS
wet damp analyzer ok but the great story
is you don't have to write that because
there are all available plugins here you
can just choose them here so it's yes a
part not part of installation but you
can choose them and download it
immediately and we installed that's what
the it doesn't yeah yeah the GlassFish
plugin only works with all the glass
which we - but not with with with squeak
okay yeah it would never be yeah this is
what I always do in all stress that I
just look at that and see how bad it
actually is okay this is the first thing
and this already amazes in most project
leads wow what is the tool that comes
with JDK look and on your on your disk
and then isn't there and then comes the
trick don't start at this visual VM
started with J visual via so okay now it
works you know
so I'm questions really no no questions
yes you can connect to the remote
machine then you have to run jcd I think
J start T but I don't like to connect to
remote machine if I am task force mode I
always installed where the server is try
to install that because it doesn't
matter anymore
and we have direct link to to the JVM
yet is harder you have to sometimes
firewall issues with the connections oh
it spend you know two hours who set up
or something other questions
Oh Jerrica does should I explain Jarrett
so Jarek it comes with unique feature
this is great
it's called flight recorder and what it
means so there's now comes the heck if
you have lots of trouble with some some
Oracle JVM with JVM with locking
particularly the only way in one project
we are able to find the deadlocks worth
worth
Jerrica and the reason for that is there
is no overhead during profiling injure
akut why is that because the Jarrell kid
needs the monitoring data for GC anyway
so it collects all the data so if you
connect with the analyzer it just
exposes the data is the only over and
for what Friedrich order means you can
move back and forth what happened in the
past and this is great so if you have
you know hopeless situation try to run
your system on Jarek it just for for for
back fixin yeah I have no idea what the
license actually is but you can do it
for for for back fixing but not in
production I think you have to double
check that Panem yeah they moving the
tool start to hotspots but but they are
not yet there it will take some some
weeks or month yeah for hopeless
projects I did it few times in all other
projects you can find a lot too with
that question the question then I could
make something for you right so um let's
say one project very simple one web web
application and I call that load stress
test is actually the idea stress test
its enable and finish
so and I would like to start the
application works then I would like to
create a servlet what I did
performance gate work Java one stress
package name and then I would like to
write you something
Oh
it actually looks nice already and would
like to test that it was stress tactic
right
nice performance gate thank you
so it seems to work so now I copied the
URL then I go to my command line
this is Jamie Tam pin it can start DJ
meter from command line and then I can
say I would like to have a new test plan
threats it always starts into a threat
group and I can say five users meets
five threats ramp-up period one second
is okay for five but this is more should
be longer and they should look forever
then I add there are nice tutorial on
jmeter so you don't have to remember
those exactly describe everything in the
jmeter page I would like to create an
HTTP request sampler and this is the
localhost
what number is 8080 path was stress test
and then I need add listener and there
is summary report this is just great it
just shows what is Error or not very
important and somehow throughput is
interesting so we can launch that run
start No so you see we have 8,000 not
transactions requests per second no
error and the GlassFish does something
so we have CP usage of 30 30 percent so
it's okay but what's amazing already is
how many transactions no transactions
are no transactions 19,000 can be
protected so this empty servlet doesn't
mean anything but it's running on
application server ok so this was the
first setup of a load test now No so
what we did right now we access the
server from jmeter so just to show you
how I Jamie to operate the problem must
rest assist
I cannot loop the whole night on visual
VM so what we always did is the
following we expose the monitoring data
via restful web services or GMX and
wrote a very simple application
with Java which gather the data data
installed the data every five seconds in
a broad table in the next day morning we
connected with Bert jasperreports
whatever and draw nice lines and so what
happened at night and then you can
compare the days you can say yesterday
was the performance great but today it
looks strange so the challenge is to
record the data and I did exactly five
times it's okay now it becomes boring
but I will rewrite everything in
open-source dad and wrote a very simple
tool of you classes called light fish
the way the does it it's mark that's
exactly that it persists the data in a
broad table and you can analyze that on
the next day so um the light switch is
already installed this is why I saw this
already at one application running and
with a little bit luck it starts so if I
start that it would collect the data and
it's over the problem is you don't do
yeah I would so in a second so it's it's
if I started it would collect the data
or capture the data and you would be
done but I would like to see the data in
real time so I brought I'm very simple
actually in three hours and job Attucks
client I can start the monitoring and
I'm able in real time to gather the data
and now to your question
there's the episode muni minimum which i
would gather a sip size thread count
Peaks read count and why is that
interesting during the stress test you
know the average should be even nothing
should increase neither strength nor
heat if there's threats increasing means
some threats are struggle whatever
transactions so we have a number of
commits should increase rollbacks
is great because there are no wrong roll
back so far which is a good idea
this app is it actually doesn't matter
because you can build it in view hours
by yourself this is an open source
project called
light fish with apache license on the
github so you can download everything
you have exactly that but that would
forget the application this is just it
visualizes would happen on the
application server and the light fish
accesses the rest monitoring data from
GlassFish one redhead guy on this
conference asked me whether you should
implement our JBoss binding sir sure
with one class do it and I would include
that so you will get J about seven for
free probably tomorrow if you're boring
fly time yes what's the V to connect to
HTTP yes there is here you can use
authentication and use the HTTP so
paranormal activity is more interesting
so um opens or should be fun so um cute
connections what cute connection means
the server is overloaded it means the
connections are cute and they are
normally able to process them very
important so arrows means there are no
errors and busy threads crown is one
thread then performance I build it
actually under flight here so you feed
transactions per second and rollbacks
per second are no transaction the two
transactions not HTTP requests for the
real transactions web HTTP sessions and
expired sessions also interesting and
now we'll just which applications are
installed and which resources JDBC
connections and this will be the
absolute no no absolute this is what I
used in my projects okay question asked
I think right so we can just start the
performance again worse
and you see Peaks read count we have
about 100 transactions are just a
transaction from rights which itself
shoot connections one so some something
happenings business let's count three
performance no commits per seconds
because we don't don't have transactions
web to HTTP sessions and expired
sessions so now the yeah I did this is
not visually being plugins Java fix
applications standalone why I did it
like that because I only had three Tower
three hours time really I was in a train
from between Frankfurt and Munich and it
was boring that go let's do that and I
did it with two charts in the table this
was the first proof of concept and even
funny story I showed the by a customer
and there's one html5 guy said why I
didn't do that was rapidly GS and GS
like because I don't have to tweet three
hours time so okay then you alright
other questions ah this is what I would
like to show you right now so as you as
you see the light switch administration
is a JSF consoler
JSF application so I would just invoke
that and it should increase the number
of sessions why is that interesting most
common questions how many sessions and
applications if I can handle so instead
of so we say okay I would like us I
would right now to go to light fish
straight light finish and start and you
see number of sessions we have 600,000
and now we can open for instance where
it's my visual VM here and you see the
memory usage so what you learned so far
5,000 sessions cost
about 200 mix okay
so and if you for instance just playing
with that if this is a real light fish
that is already running applications so
if you have application er like that
just to try to break the system so you
know ignore J session ID
so it will start on new request new
session and you will easily see what
happens behind the scenes and how big a
session really is okay
so amazingly we are about 25,000
sessions right on 400 mix of memory
shortly before out of memory so do you
mean with this configuration out of the
box were able to handle 70,000 sessions
a funny story because of scalability
reasons one architect forced us to to
build stateless systems and there were
300 employees of the company and we
because of error configuration error in
in in in in stress test we created in
the first night 30,000 sessions per note
and we had four notes so we're able to
have 120,000 sessions we have the next
morning I told him look we are able to
handle 120,000 employees you have only
300 we scale well enough you know we
have some room say yeah but in future
and you know and this is the discussion
of the very stretch so just test it
there's really fun to play with
so just tested and most of the of the
developers are amazed how small actually
our session is okay so next hack so we
have visual VM and there is a heap dump
so now create a heap dump this was
actually a bad strategy because it is
already big and there is a great
exceptionally eclipse tool called memory
analyzer counts for free because of this
Eclipse you have to be little bit
careful what do i download downloading
there is a plug-in set and thousand 1000
different possible configurations but
the most common one is a native
installer is what you should download
the native installer if you launch that
is a great great tool is able to analyze
to analyze to analyze the the heap dump
and and show you how big the objects are
and how they are connected and this is
really great too far to find memory
memory leaks question no no this is life
it sessions so what I did I just take
lightish itself you know this is the ADA
monitoring application create session
per request so it is an empty it is all
the monitoring yet as already there so I
monitored actually the light fish which
is small but the real world application
it isn't empty
is this in the servlet it is like this
mm-hmm
in verse casein do get from sublet is
the easiest way I have to say before I
record everything outside I can use this
and if you have tools like loadrunner
for instance I don't know
this changes companies frequently but
it's a great tool so you can use it to
record the DD windows as well so this is
the best tool but usually you don't have
the resources or the licenses to do that
so with jmeter it is just fine enough
and what jmeter is able to do gem it is
able to to record to record the HTTP
traffic as well so open hip dump
I don't have to store that yet but um I
would just keep the memory of we have 15
15 minutes times I would like to
concentrate on more stuff but who is
memory analyzer you can just walk
through the heap and see how big the
objects are is very very simple very
intuitive how to find memory leaks is
another great great tip hopefully it
works in my cases it work always with
NetBeans so what you should do if you
have memory leak and you cannot find the
memory leak you can connect with
NetBeans and there is this the last
column in NetBeans is called generations
and now come the hack what generation
means how often the objects survived the
garbage garbage collection cycle and I
sort the column by garbage collection
cycles and if you have memo leaked you
will see something like 100 90 80 and
the third row is like 10 and this gap
indicates you have memory leak and you
if and in 90% of all cases if you go to
the first the first line the first row
you will find the memory this is the
object which causes the memory leaks
yeah NetBeans connection profiling sort
for generations if there is a gap memo
leaked then go to the first row right
mouse click take snapshot and you know
which object it is this was a virtual
wizard yeah
um yeah if you catch the object that
they would survive and you will see that
the route is for instantly kept in
hibernate then you have to decide
whether it's okay or not but you will
see but you will see how big this is
this is the great story so that you can
compute with a memoir memory analyzer
the cumulative size so you see how big
this really is and it's a lot easier to
do that you know okay so what I also
would like to do or I can ask questions
I would like to implement an EJB and
show you the the over hat but it's just
fun but you don't land anything new
except you will see that we will only
have five thousand transactions per
second about see they ask a question as
I would try to hack that if you have
questions just ask me so I try to be
multitask so I'm in a production system
you have to to created up front so you
need a specific transaction with
specific idea whatever the system knows
that this is synthetic transaction and
there's no side effects so this is you
have to know it from the beginning but
all big systems are blocking it away so
they expect for you new synthetic
transactions very good question other
questions
ah on my machine I was open everything
so far and the biggest were several
gigabytes though several gigabytes who
can open there's no problem and even
before that but I had 8 gigabyte RAM and
in you need 64-bit JVM but it will take
time but you can open nearly everything
but about several gigs under 10 above
the 10 I never tried er yeah
no I prefer a memory analyzer phone
eclipse for that not NetBeans NetBeans I
use NetID some profiling and and finding
memo leaks okay other questions so now
what do you learn Durst apply this
techniques so what what you should do
first so just to summarize because we
only have ten minutes
so I provide expose first technical
metrics and which are interesting
dependent is depends on your application
what's critical from my point of view
number of rollbacks why number of robots
indicates for instance you have lots of
optimistic clock collisions for instance
and this indicate you have two in the
tool to create a caches or invalidated
caches or something similar so we we had
for instance two to replicate reppin or
replicate to invalidate the caches in
one project because of that you do find
a certain amount of load you get lots of
roll backs of the mystic lock except
caused by optimistic lock exception
critical critical knowledge for you then
connection pool size and why often the
connection puts a completely forgotten
so if if you have max pool size of 10
you will never get more than 10 parallel
transactions everything will queue up so
this is also critical then if you have
JMS you are it's the same story you can
monitor JMS resources jsj JCA resources
and this metrics on what you should do
at the first day is just just visualize
them on a chart and see what it actually
means how the system behaves what what
we can reach and from day one you could
be able to estimate what we can actually
handle in production ok so having that
you have to conserve the data and in my
case it was derby so just zip the derby
this but they one two and three and four
you can provide additional column in the
database and and compare the days and
now it's also important that this tests
are performed automatically what it
means what the jmeter did created a file
called something dodgy mix jmeter
configuration i think this or xml
configuration something like this so
save that in your repository check it
out with jenkins and one the last stable
builds the whole night
dressed as like that in the morning the
server should the application server
should survive the next trick is measure
the most expensive sequel queries so we
do not optimize anything at the
beginning then if you've already is the
enterprise manager or whatever tool you
have and just optimize queries which are
really critical and what we do we have
kind of dashboard was a meaner
screenshot basically and if you have
scrum meeting or something like this you
can it can go through ok see your
queries of the most expensive expensive
one should we do something about that or
not so as the project involves just take
more and more matrix and put and remove
the old ones if they are there
uncritical and you will see how much you
will learn the strange thing is also it
is fun it doesn't cost anything so we're
able I mean I would like rather answer
question then monitor need your bees we
could inject a GB we'll see what would
be performance and in minutes you can
you can have such a system running it
doesn't have to be perfect from the day
one but if you're starting from day one
the first day you will probably just
monitor you know the login field the
next day you can you can evolve the
system with the with the business logic
which is a lot easier than afterwards
and you will you will see so ok I'm
liking this on this metric right and you
can you can create it from day one you
will see oh what's interesting for
instance my blog statistic
software broads a blog system I got I
was surprised why I built that because
ok it cannot be that my blog can handle
that traffic so I build the system to
see what it is and what I exposes number
of hits per seconds what from where the
users come which were these this was
actually my monitoring data exposed via
rest is business data in my production
environment we have number of orders per
seconds number of whatever heap then
slowest methods extremely simple just
create an interceptor measure the
performance and saw the methods it I
mean you get it for free what's also
interesting which methods cost exception
a hashmap was interceptor right so you
know interceptor so you can catch all
the exceptions you know the method name
so you only have to put in hash map you
can count which mesh mess of cost
many exceptions would I see in status
they have writing looks like crazy and
then try to pass them in the year 2012
so what he could do we can learn in real
time what the system actually does and
my point is is very very very simple to
do that and for instance what I what I
try to avoid put such statistics in lock
files and if the my customer says we
need that then we store it in a database
because the news case but I don't know
that because I use ik uses as Jo mix and
it's positive et Utley to database or
whatever but that Donald Wright
extensive log files and then tools to
process the lock was just crazy and in
most project I don't even have access to
the production so you can just request a
lock price and again get their lock
files after two weeks which is you know
crazy so other questions five minutes
for questions right now
yeah so then then I have to I mean I
have to build that right so um slow be
not just slow is better so then
so and the Interceptor would look like
cool names are important
so now we have the method you have
parameters
and you have
the exception is the Interceptor in if
the interceptor if you're interested in
that check out x-ray this is this block
statistics officer I monitored
everything with such such interceptor
and this is I think those are patchy
license if not I can change it for you
don't matter and you can just download
that and still the Interceptor it is
already implemented x-ray you will find
it in my home page as well but this is
subdued pseudocode of the Interceptor
right so you have the method to get the
method here you have the method of the
name you have number of parameters which
is not that important for monitoring and
here you could you what I forgot is
around invoke and this would be an empty
interceptor so we can here for instance
already monitor performance or something
right so and we could inject the
performance gate here performance drone
and I could devote it somewhere what was
the name
not the drone they're slow no clumsy
oh okay
so method and then we can change my
script from what was it stress test you
know that
something like that and then performance
get exactly this is what I need and you
will able to perform this the same test
with an EJB so save that we have the
clear the results clear all tables empty
right now and we can we perform the test
still fast you see the transactions
performance 2200 transactions per second
with an e gb so now the next question
was which is actually slow I think
because the application servers almost
on the boundary to out of memory so um
so we introduced in the GB now we
measure the performance of e gb
transactions going up thread and
paranormal activity cute connection one
still boring so we could include
increase the load the load okay but we
think time we will never see the
contention the QB always empty two will
be just you know happy living and
nothing would break okay the intercept
is not measurable if I would activate
the Interceptor it would take about one
millisecond per call or something it
doesn't matter so questions
to set up the interceptor okay what I
did what I did is I'm the interceptors
and the CDI event the CDI event can be
received by a egb which is a synchronous
for instance but because of Heisenberg
there is no if you measure something it
will have impact you know other
questions yeah oh can I disable on
enable intercept on condition no but
what you could do you can do it within
an interceptor with jmock for instance
it's possible but you cannot just drop
the interceptor okay but you can
activate interceptors easily with
portable extensions what you can do and
I've wrote an article for Java magazine
it's a free Oracle about aspects in Java
6 or something
so I did exactly that with source code
so you can check it out pattern the AOP
aspect oriented programming for java
magazine from Oracle's the 3-3-3
magazine so you can just check it out
questions enjoy Java one and see you
next year</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>