<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angular Universal:  Pre-Rendering with renderModuleFactory | Coder Coacher - Coaching Coders</title><meta content="Angular Universal:  Pre-Rendering with renderModuleFactory - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Angular-University/">Angular University</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angular Universal:  Pre-Rendering with renderModuleFactory</b></h2><h5 class="post__date">2018-03-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/v6CKlV7kGVM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome back in this
lesson we are going to pre-render this
angular application that we have here we
are going to generate the HTML that we
see here on the screen and we are going
to output that to an HTML file we are
going to be using the universal bundle
that we have generated here and to
perform the pre-rendering we are going
to add here a file to our root folder we
are going to call it pre-rendered TS the
first thing that we are going to do is
we are going to import our server-side
bundle into our pre-rendered program so
we are going to import it in the
following way we are going to do a
normal load require of the main bundle
file which is under the dist server
directory and we are going to get a
reference to the application server
module Factory the module Factory will
enable us to render our application and
in order to use the model factory to do
that we are going to need a function
from platform server which is called
render module Factory this function can
be used to render the root of our
application in the following way we are
going to call render module Factory and
we are going to pass in as the first
argument the module factory of our root
application and as the second argument
we are going to pass in here a series of
parameters the first parameter that we
are going to be passing in is a document
so whenever we are rendering we are
basing ourselves on the template in the
case of our client side application that
initial template is going to be our
index dot HTML so if we open it here we
can see that this is our base template
and here is where our application root
is going to get rendered in our case we
will not use initially and index dot
HTML instead we are going to specify
here and hard-coded string that simply
renders the application root the second
argument that we will specify here in
our render module Factory call is going
to be the URL parameter this is going to
specify exactly which route do we want
to render because let's remember our
application root component will have
here its templates a Rooter outlet so we
need to identify using the Rooter what
is exactly the content that we need
inside this Rooter outlet tag in this
case we are going to be rendering the
route route which should render here
this list of cards with courses this
function call to render module Factory
is going to return us a promise and if
the promise is correctly evaluated the
value that we are going to get here is
the HTML that was rendered in order to
have a good look at that HTML we are
going to save it to an HTML file we are
going to import here the right file sync
load function and here we are simply
going to write this HTML to a file we
are going to do this call write file
sync we are going to write the output to
a pre rendered HTML file and here is the
HTML that got rendered let's also add
here a console log so that we can see on
the terminal what is going on so this is
the case where the rendering occurred
successfully now we also want to cover
the case when something went wrong we
are going to add here a catch to our
promise and in case of an error we are
going to log it to the screen let's
quickly format the code with out command
l and from here we have already an
initial implementation of our pre
rendering program let's try this out we
are going to be calling this pre-render
file from the terminal using TS load and
for that we are going to be using this
npm script that we already have
available here in our package dot jason
which is the pre rendered task so as you
can see it simply uses TS load which is
a small command-line utility that allows
us to immediately execute type script
files and to TS no we are passing in our
file pre-render dot TS so if we now head
over to the terminal and run npm run
pre-render let's have a look at the
output while running the program we can
see that we got here an error we can see
that we are missing here zone dot G
so we are going to be adding here a
couple of global imports to our program
that are essential for server-side
rendering to work so the first import is
going to be an old version of zone dot
GS and we also need a reflect metadata
which is in place let's head over to our
terminal and try pre-rendering again
this time around we get to a very common
error that you might find while trying
to pre-render an angular application
which is cannot read property module
type of undefined so what is going on
here the problem is that this bundle
that we have here is not a production
bundle let's then quickly rebuild our
server application in production mode so
we're going to take the same command
that we used before
ng build - - app the name of the
application and we are going to run this
in production mode after a while the
production build is going to finish and
we are going to have here a couple of
production bundles that are going to be
available here in our distal there is a
small problem which is the bundle file
names have this hash here we usually
want this hash in the case of
client-side applications so that each
bundle is unique but in the case of a
server-side application we would prefer
the name of this file to be constant so
that we can import it here right now
this import here would no longer work in
order to fix this problem we are going
to rebuild our production application
but with an extra parameter - minus
output hashing equals false this is
going to remove the hash from the file
name and we will be able to import
consistently our universal bundle again
after a while our build is going to be
completed and if we head over to this
server we now have here a production
bundle with a constant file name without
a hashing let's then try to run our pre
render function again we're going to run
npm run pre-render let's have a look at
the output as we can see we had here a
console dot log of some data to the
screen but we also have here this
message pre-rendering successful the
pre-render dot HTML file was saved
if we now open the file we are going to
see that we have here a lot of HTML it's
not formatted so let's select it with
command a and format everything with
command alt L this is going to take a
moment
but after a while we are going to get
here a formatted version of this HTML so
as we can see here on the head of the
page of the HTML page we have here the
typical styling that is generated by
angular let's then collapse here the
head with all the styles and we can have
a look here at the HTML so as we can see
we have here a series of cards of
material cards that are getting rendered
if we do a search here by Matt - card we
are going to see here for example that
we have here the card that corresponds
to the universal course and here we have
several other cards if we now is crawl
down to the bottom we can see that we
are not important here any JavaScript
bundles and also on the head we are not
importing any CSS bundles this is
because we used here essentially an
empty index dot HTML file that all your
Enders the application itself let's have
a look at what this HTML looks like on
the browser for that we are going to be
using the HTTP - server utility so in
case that you don't have it installed on
your know the global installation let's
then start by installing it with NPM
install - G HTTP - server and after a
moment we will have here this utility
globally available so if we now do HTTP
- server and we serve the current
directory we are going to be able to see
what this file looks at the level of the
browser so let's head over to localhost
port 8080 and we are going to lower the
pre-render dot HTML file so as you can
see this is what the HTML is looking
right now on the browser so as you can
see it's not yet the complete
application but it's a pretty good start
so what is missing here we can see that
the styling of the application is not
complete and this is because we are
missing the CSS bundle also if we click
on the buttons we can see that the
application is not
active this is just a plain static HTML
page so we also need to lower the
angular bundles at the level of the
client and we need to have angular to
take over the front-end as a normal
single page application</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>