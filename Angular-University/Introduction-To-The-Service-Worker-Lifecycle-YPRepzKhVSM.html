<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ðŸ’¥ Introduction To The Service Worker Lifecycle | Coder Coacher - Coaching Coders</title><meta content="ðŸ’¥ Introduction To The Service Worker Lifecycle - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Angular-University/">Angular University</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ðŸ’¥ Introduction To The Service Worker Lifecycle</b></h2><h5 class="post__date">2017-11-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YPRepzKhVSM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome back in this
lesson we are going to dive deeper into
the Service Worker lifecycle we are
going to cover application versioning
for that we are going to cover the
install and activate phases of the
Service Worker lifecycle this is
absolutely essential even for our
development experience with the Service
Worker otherwise we will constantly run
into things that don't seem to make much
sense if we don't understand why the
life cycle works this way let's say for
example that we now want to deploy a
second version of this Service Worker
here inside the Service Worker J's file
we have access to a variable called self
this is a reference to the service
worker itself so from here we have
access to all the service worker API we
are going to do that to add here an
event listener to our service worker
this API works in a similar way to the
browser API that you already know we can
specify here with the first argument of
the add event listener function call
where we will specify the event that we
want to listen to in this case we want
to listen to the install event of the
service worker and the second argument
is the callback where we are going to
specify what is the behavior that we
want to execute in response to the
service worker installation in this case
we are going to log to the console that
a certain version of the service worker
is installed another very important life
cycle event that we are going to go
deeper into is the activate life cycle
event after the service worker has been
installed the service worker will
eventually become active we are going to
understand exactly the difference
between these two steps of the service
worker lifecycle installation and
activation so here is what we are going
to do we are going to deploy this
version of the service worker in the
browser then we are going to change it
we are going to create here a new
version version two and we are going to
see how and when will the new version be
activated and the previous version the
activated let's have a look at how this
works let's switch over to the browser
to a larger window we're going to open
here the application tab and we are
going to unregister any service workers
that we have here running another option
is to use the clear storage tab this tab
is going to allow us to clear all
browser State for a given web
application in only one place we can
clear for example local and session
storage index TV web SQL all the cookies
the application cache and we will also
enhance their service workers we switch
here to the service worker tabs and we
are not going to have here any Service
Worker active it's instead deleted we
don't want to check any of these
checkboxes for the moment so what we're
going to do now is we're going to
refresh the page and we are going to see
that the version 1 of the service worker
which is the one that we have just
created is just been installed we have
here the logging statement that the
service worker is being installed and we
are going to install the service worker
and we are going to activate it
notice how the hedges tration was
already completed even before the
installation and the activation took
place let's now check the application
tab as we can see we have here instance
990 of the service worker up and running
if we click here the source of the
service worker we're going to see that
we have here version 1 as expected if we
will open multiple tabs we would still
have version 1 installed now let's go
back to our application what we're going
to do now is we are going to change the
Service Worker script in order to become
version 2 for the moment we are not
going to change anything else on the
rest of the program these will be
considered by the browser is a different
version of the service worker because
it's not bitwise identical to the
version currently running whenever the
browser is going to lower the index page
it's going to then run the registration
script this registration script is then
going to lower the again the same file
service worker dot
yes the browser is then going to do a
bitwise comparison between the version
of the serviceworker that it has running
and this new version of the
serviceworker it's going then to detect
that there is a new version and it's
going to proceed with its installation
and activation it's important not to
change the name of the serviceworker
file so that the version detection
mechanism works correctly let's now
switch back to the browser and see how
the new version of the serviceworker is
going to be handled as we can see
because we saved the file the angular
CLI development server already refreshed
the page for us so what we have here on
the console is the registration of the
new serviceworker we are going to see
that the new version of the
serviceworker v2 is being installed and
that it actually has been installed
already but notice that this new version
of the serviceworker is not active yet
we don't have here the activation
console statement let's have a look here
at the application tab to see the
current state of the serviceworker so we
can see we have instance 990 still
activated still running and we have here
a new instance 991 waiting to activate
let's have a look to see what is the
current version of serviceworker running
right now in the browser so as we can
see we are still running version 1 this
is normal and it's the expected browser
behavior the new version of the
serviceworker is going to be downloaded
and installed on the background but it's
not going to become active immediately
let's remember that this new version of
the serviceworker could have triggered
the installation of a complete new
version of the application we want that
process to take place in the background
so that the user experience does not get
disrupted this means that the user is
still running the previous version of
the serviceworker and had it cached the
whole application it would be running
the previous version of the whole
website so let's see how can we activate
version 2 here is what we're going to do
we're
start by reloading the page and checking
if version 1 is still running so as you
can see we still have here version 1
running let's now try something else
let's open a second time and see what
version of the serviceworker is running
if we switch over here to the
application tab we are going to see that
the exact same version is running on the
second tab which is version 1 which is
actually great because it means that the
user will not experience different
versions of the application or parts of
it such as for example the Service
Worker depending on the tab that the
user is on the user will have a
consistent application version across
tabs so if we continue to open more tabs
we will still get here version 1 let's
see then what would we have to do to
activate version 2 because the
overarching theme of the Service Worker
lifecycle is to ensure consistency by
default from the point of view of the
user and that means that the new version
of the serviceworker will only get
activated when the user closes all the
tabs that were still running the
previous version let's see what happens
when we close the last tab we are going
to check here in the about blank page
that we are running instance 990 let's
then go here to this tab we are going to
close it this is the last tab running
version 1 let's close it and see what
happens so as you can see immediately
version 990 was stopped and now version
991 is now activated and running and of
course if we click here on the
serviceworker dot JS file we are going
to see that this is version 2 as
expected so now if we open here a new
tab and we check what is the version of
the serviceworker that is running as
expected we are going to see here
version 2 let's confirm our
understanding of what is going on here
in the console so as you can see we have
executed the new serviceworker script
the version 2 is active and the
registration is completed
notice that we don't have here the
installation step that's because the
installation happened here indeed about
blank page where we have the complete
list of all service workers we can see
why the service worker life cycle works
this way the goal is to ensure to the
user a consistent experience many times
the application itself so all the files
that make the application the multiple
CSS and JavaScript bundles they have
been cached by the service worker we are
going to see how to do that in a future
section now if that is the case if most
of our application is being served by a
given version of the Service Worker
we can see that we only want to activate
a new Service Worker when we want to
activate a new version of the
application that is why we want to wait
for the user to deactivate all current
running instances of the application on
his browser before installing the next
application and before cashing the new
files of the next application this is
going to depend on the user different
users depending on their browsing
sessions will install the new version of
the application at different moments in
time now that we have a good
understanding of the life cycle
let's implement a concrete service
worker that gives to this application
offline capabilities</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>