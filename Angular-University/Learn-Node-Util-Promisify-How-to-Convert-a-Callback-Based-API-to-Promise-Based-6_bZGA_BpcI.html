<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ðŸ’¥  Learn Node Util Promisify - How to Convert a Callback Based API to Promise Based | Coder Coacher - Coaching Coders</title><meta content="ðŸ’¥  Learn Node Util Promisify - How to Convert a Callback Based API to Promise Based - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Angular-University/">Angular University</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ðŸ’¥  Learn Node Util Promisify - How to Convert a Callback Based API to Promise Based</b></h2><h5 class="post__date">2017-08-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6_bZGA_BpcI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome back in this
lesson in order to create our session ID
we're going to be using some core node
API is that our callback based the first
thing that we are going to do is to
convert these callback based API is into
promise based so that we can write more
maintainable code and on the future
lesson so that we can leverage the node
a sink weight mechanism that is
available here in this version of
typescript that will allow us to write a
synchronous code that looks and feels
like a synchronous program in order to
do that the first thing that we are
going to need is a promised version of
this API the crypto dot random bytes API
which takes here a callback but we need
to transform this into a version that
takes a number of bytes only and not the
second argument and returns a promise so
that we can pass that on to a sink await
and create the type of load code that it
reads like it's synchronous code but
actually everything is happening at
synchronous just like it's happening
here with these callbacks in order to do
that we are going to create here a
utility file we are going to call it
security details so these will contain
the security related utility functions
that will be common to multiple parts of
the program we are going to import here
the node crypto module that contains the
random bytes API and we are going to
import here the util module as well this
util module is available since version
eight and it contains a function that
it's called util dot promise if I and
this function like the name suggests is
going to take as input a known function
that has a standard node callback api
such as for example crypto dot random
bytes this is a function that has the
typical node callback based API where
the last argument is the callback
function and the covert function the
first argument is the error so this
promise if I function it's going to
take a function that corresponds to this
standard convention of a load callback
and what it's going to do promise if I
it's going to return here a new version
of this function which is promise based
instead of callback placed so we are
going to call it random bytes we are
going to keep the same name and what we
have here is a promise based version of
these random bytes callback paste
utility so to better understand what we
did let's see how the original crypto
dot random bytes utility function would
be used so we would pass in here how
many bytes we want to generate and the
second argument and the last argument
would be a callback that will receive
first the error and then here the
pseudo-random number that was generated
so here we would have the random number
available in this callback and here we
could do something like console dot log
and we could use the number that was
generated now as we know this type of
API would tend to get nested very
quickly so these random bytes function
here this will be a promise based
version of the crypto random bytes API
so if we call random bytes this is not
going to take a callback this is going
to return a promise so if we want to
receive the value of the numeric value
that was created here we can by passing
him here a function to the then block so
if the promise gets resolved
successfully that is if the Kovac gets
invoked without any error we are going
to receive here the random number that
was generated and we are going to be
able to put it here to the console if
something goes wrong we can catch the
error and do some error handling here so
the error that we would receive here is
the same error that would be passed to
the load callback so we could add here
our error handling inside this inline
function so this is what util that
promised if I is doing it's a utility
avail
is not 8 it converts functions with this
type of load callback api into an
equivalent function with a promise based
API instead and having all our
synchronous functions in promise form is
the first step for being able to
leverage the async await node
functionality let's have a look at it in
action</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>