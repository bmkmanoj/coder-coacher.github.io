<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP and MySQL with MySQLi: Inserting records (Part 6/9) | Coder Coacher - Coaching Coders</title><meta content="PHP and MySQL with MySQLi: Inserting records (Part 6/9) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP and MySQL with MySQLi: Inserting records (Part 6/9)</b></h2><h5 class="post__date">2013-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cq_wz116Bbc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in the last part we looked at
deleting and updating we've actually
deleted a record so why don't we go
ahead and insert that record back in and
look at how we how we actually insert
data so we're going to do more or less
the same thing as we've been doing we're
going to create a statement if you like
inside of a query and we're going to
check if that if that was successful or
not so we can then say if insert equals
DB query now bear in mind that when we
looked at the assignment here before
this doesn't really matter we don't
really need to assign so I'm you know
this this result here because in terms
of updating deleting stuff at that this
doesn't actually return the useful
information that we can reuse but we
might want to check this a bit later on
down the line so we can assign it to a
variable any way that the performance
cost isn't too bad so to insert we want
to first of all look at the the language
in actual fact we can do more or less
the same thing that's that we've already
done which is DB effected rows because
we know that we want to get an affected
row count back and if we were inserting
one record we'd get one back if we're
inserting five records we'd get five
back so I'm going to say insert into
people now what I'm going to do now is
to find the fields that I want to insert
in in actual fact I'm just going to pull
this down so it's a little bit easier to
read so insert into people and then I'm
going to choose the fields that I want
to insert into so let's go ahead and
just remind ourselves of the field so
we've got ID which we don't need to
include it's also increment it will
automatically increment for us first
name last name bio created so let's go
over to here so first name last name bio
and created so now inserting and let's
just pull this to here okay so now what
we want to do is to find the values that
we want to insert so depending on the
data type we either if it's an integer
for example we don't have to supply
quotes if it is a string we have to
supply quotes so for a first name it
will be quoted and then last name
obviously be a string bio is a string as
well so we need to say I'm now we're
going to escape that character there a
web developer and then for the last is a
function sort of course to put it inside
the string would be silly because it's a
function it returns a numerical value so
we can just insert that there and that
will be updated and created so now we
have structured our query now let's go
ahead and refresh and see what happens
there we go we get one back so we can
safely assume that one row has been
affected and we've inserted a record
into our database and this is now our ID
three because it's following on from the
the ID that was last which was too so
it's incremented to three and one has
been lost now forever unless we
specifically define that we want a
record to be value one now there's a
couple of things to note here
particularly particularly reticent to
user input so when you're allowing input
from anywhere really that you don't
control into your query you have the
potential for an SQL injection to happen
and an SQL injection is basically the
manipulation of data so that it fits
into a query for a destructive purpose
so you can read about SQL injection
pretty much anywhere and you know look
on the PHP website PHP security
consortium you know there's websites
that explain SQL query much better than
I can in this video but we're going to
look at sanitizing data or escaping data
rather as we put into our database now
this doesn't protect against things like
XSS attacks or anything else we're just
concerned with not letting SQL
happen we're going to look at binding a
bit later on which is a cool way to bind
values makes it a lot easier to write
queries where you're inserting a lot of
data but let's take a quick look at how
we escape data that goes into our
database now let's say I have a variable
up here called name now I'm going to say
this is Alex in fact I'm going to say
first name equals Alex I want to allow
the first name to be chosen now this
isn't a real life example I guess
because it doesn't make too much sense
let's go ahead and just append this here
so I'm going to say sorry first name so
this is basically now going to be
inserted into our database with the
record Alex so let's just change this to
Dale so what's going to happen here is
when i refresh we have one record
inserted and we can go into the database
and see that a record has indeed been
inserted so that's fine we know that we
can use variables with string values or
integer values or anything to put this
into our database we can even have this
as a a MySQL or an yeah MySQL function
however what happens if this data was
somehow provided by a user or another
source that we don't necessarily trust
so for example we'll use the get array
of data that we can submit via a URL and
I'm going to say first name so one
lineage is going to do is create another
if statement here wrap the entire thing
in it and say if is set dollar
underscore get first name and we'll move
this to this line here hopefully this
doesn't look too confusing all we're
doing is checking if this get this get
value exists or have a key value pair
and then if it does what we're going to
do is we're going to trim it and then
we're going to insert it into the
database the first name so we can define
this now in the URL here so when I
present and nothing's going to happen
but when I define
first name equals so I enter a name and
I hit enter so we get one record
inserted what's happened is this value
has then been checked and we say yeah
it's been set we trim it so we remove
white space from the left on the right
hand side we assign it to this first
name variable and then we put it into
our database here now when we refresh
the page or refresh our database table
here in PHP myadmin we see that the
records been inserted now what happens
if this data here had perhaps a single
quote in it well it doesn't look like
anything's happened here so nothing's
been you know nothing's been inserted
you you know there's a variety of things
that can be put into a into a query and
we don't want to allow a user to insert
this information from you know URL now
this shouldn't be the case anyway this
should never be how we work how we
insert data we want to always make sure
a date is sanitized protect against XSS
attacks but what we're concerned with
here is how we escape this data how we
basically remove the ability for an SQL
injection to happen well that's easy we
can basically use dB my skewer up sorry
MySQL real escape string so what's now
going to happen is when we refresh the
records that this data is still inserted
but we're actually escaping any data
that we don't want to be inserted along
with this so you can see here that I've
included a single quote here when i
refresh and I edit this looks exactly
the same but to prove this concept if we
echo this variable
you can now see that we've got a
backslashes so it's been escaped as it
goes into our query so using the real
escape string method on the database
object allows you to escape data that
you insert into your database it is
extremely important any data at all from
an untrusted source be that an RSS feed
an XML feed data that is provided by a
user in a form data that's provided by
an API somewhere always escape before
going into your database so in this part
we've looked at inserting data fairly
straightforward inserting nothing too
tricky we've looked at replacing this
with a particular variable so variable
in this case that's defined in the get
array and then we've looked at escaping
this data before we put it into our
database now what we're going to do now
is in the next part go on to looking at
binding which is a more efficient way of
escaping data as being inserted into the
database and it also allows for it you
know the structure of our code to look a
bit nicer by binding values as we are
sort of preparing statements and then we
execute a statement</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>