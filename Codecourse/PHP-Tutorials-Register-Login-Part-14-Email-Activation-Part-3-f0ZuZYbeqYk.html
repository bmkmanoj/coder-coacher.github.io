<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 14): Email Activation (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 14): Email Activation (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 14): Email Activation (Part 3)</b></h2><h5 class="post__date">2012-05-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/f0ZuZYbeqYk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so now that we have successfully
sent the email to the user we need to
create this activate dot PHP page which
is going to take in the email address
that you can currently see in the URL
bar and the unique code that's been
assigned to that user
in order to match their data up and
activate their account so the activate
dot PHP file that we're going to be
creating is not very complicated so
let's go ahead and just create a new
page we'll save this now root directory
because remember we are sorry let me
just spell activates properly activate
dot PHP obviously we are directing the
user to activate our PHP within the LR
directory this will obviously change
depending on you know the way you're
setting your site up what do we need to
do now well I'm going to go ahead and
just copy a template across from any old
page really
we'll just so protected let's just copy
that in fact no we need something that
has protection against users so log in
logged in redirect so we need this
function to be within this page the
reason being is because we don't want
users that are already logged in to
activate this page so let's go ahead and
just open up protected will copy that
over and we'll go ahead and use this
logged in redirect function as well get
rid of them to put that there so just to
explain for anyone that didn't catch
that we're including our generic
template that we're using our header and
footer and our init door PHP file which
is important because it contains our
function and things like that if the
users already logged in we don't them to
access this page so using the logged in
redirect function to you know kick them
out of this page if they're they're
already logged in because they don't
need to be activating their account and
we've just got a header and a paragraph
here so we don't really need these as
such at the moment I'm also going to
just pull this down pull this down get
rid of these so we're just just within
PHP tags and that's it
okay so now we can go ahead and actually
create our activate dot PHP page let's
just go ahead and hit enter again on
this you can see that we've now got our
template but we are parsing data we're
not doing anything with it we're not
activating the users account
we're not outputting anything so let's
go ahead and get on with doing this okay
so the first thing we need to do is
actually check whether this data has
been passed through to the page so we
need a if statement here and the
condition is going to check whether
these two get all these pieces of get
data to have being passed so their email
and email code and if you haven't
already guessed email and email code
correspond to email in our code this
will this will basically return these
values here well this won't but this
will check that they're set so if that
is equal to true then these values are
set so let's go ahead and echo
set just to make sure we're all good and
working perfect set and obviously if we
don't have them nothing so if we don't
have them what do we want to do so we'll
create a conditional an else story on
this conditional and we'll just we'll
just redirect the user to index to PHP
you don't need to do this you might want
to display some kind of friendly error
message oops something went wrong but
chances are your users trying to access
this you know unnecessarily ok so within
here now what do we want to do well
let's go ahead and create some variables
and store what we've just passed passed
in so email equals dollar underscore get
email let's just pull this down a bit so
it's easier to see and email underscore
code is equal to dollar underscore get
email code let's go ahead and trim these
so this will trim white space from the
left and the right hand side just in
case they've accidentally copied or
pasted copied and pasted any extra
whitespace we want to get rid of that
that's important now what we want to do
is check if this email address actually
exists because if the email address
doesn't exist there's no point
continuing with the validation so if
email exists and you'll remember this
from the login process we pass through
the email if that is equal to false we
want to append some or an error message
on to this errors array and this errors
array you should now be familiar with
we've used it in the login and the
register process so I'm going to say
oops something went wrong and we
couldn't escape that find that email
address okay now what do we want to do
else if something so if this is okay and
if the email address does exist what do
we want to do now well we want to go
ahead and we want to activate their
account however the function that we're
going to be using is going to return
true or false depending on whether this
activation was successful and what is an
activation based on well it's based on
the email address and the validation
code match against one record so we want
to say if activate is equal to false
false and what do we want to pass this
activate function bear in mind we have
created that this year and we want to
pass the email and the email code and
this activate function will pick up the
email the email code and it will go
ahead and you know activate our now
users account if it successfully
activates it will return true otherwise
it will return false so if it is equal
to false
we want to append something to errors
and we're just going to say we have we
had sorrow problems activating your
account okay so assuming people fiddle
it it's very rare that something is
going to go wrong in the case that we've
set this up okay so what do we want to
do now well let's go ahead and before we
output any errors or anything like that
let's go ahead and actually create this
active activate function so over to
users dot PHP we're going to create it
in here so function activate and
remember we want to pass through an
email and an email code and we need to
escape this data because we you know at
the moment anyone can pass through
anything in the URL bar so we need to
use the MySQL real escape string
function on this so email equals MySQL
real oops
real escape string and then pass through
the email and I'm just going to copy and
paste this line because the data is
almost identical with email code just
pull that in email code so sanitized the
data now we want to go ahead and check
first of all that these these pieces of
information Maps so we're going to do is
we're centrally going to do two queries
here we're going to do a query within a
conditional statement so it's going to
start to look a little messy but
hopefully you've got the hang of this by
now so we're going to check if the email
address and the email code match in one
record and active is equal to zero so
we're making sure the user hasn't yet
activated their account and if
everything goes well we're going to
update the active state of the user so
if something else something else the
else is going to return false so if
something goes wrong the the condition
here is going to return true
and up here we're going to query the
database to update user active status so
in here if now we're going to use the
MySQL query function and we're going to
say select count count is a function and
accounting by I'll just count by user ID
from users where and here's where we
need to compare email and email code so
we're the email is equal to email
passing this in here and email code is
equal to email code and active is equal
to zero we don't want to allow any users
that have already activated their
account to read to act about again it
would be silly now we're going to wrap
this all in the MySQL result function
and we're accessing row zero and that's
it now that if this is equal to one ie
the count has returned one then we can
go on and we can query to update the
users active status so just a recap of
what we've done here we've done a query
within a MySQL result the query fetches
the count of rows where the email is
equal to specific email the code is
equal to specific code and active equals
zero so essentially the email and the
code that you know returned one row on
row zero if this whole thing bear in
mind that's if the result is equal to
one then it means that we have a match
so that means that the users provided
the correct email address and activation
code so we can go ahead and activate
their account so here we do another
MySQL query this time we want to update
users so updating a particular table
we're setting a field equal to something
so active equal to one we're email
it's equal to email okay it's a slightly
complicated but you know if you're
struggling with this go ahead write this
code out try and grasp what we're doing
what we're returning and then what we're
doing based on that return and then
obviously we're telling true here we
don't have to do this but then we're
returning false if this the first thing
has failed okay so if any a date any
data doesn't match okay so we are very
nearly done this will essentially work
now we just need to go through the
process again and test it so join me in
the next part to actually finalize this
and get everything wrapped up and and
get this working</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>