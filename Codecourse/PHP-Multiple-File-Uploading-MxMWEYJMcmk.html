<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Multiple File Uploading | Coder Coacher - Coaching Coders</title><meta content="PHP Multiple File Uploading - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Multiple File Uploading</b></h2><h5 class="post__date">2014-04-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MxMWEYJMcmk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we're going to be
uploading multiple files with PHP so
let's take a look at how this works
first of all I'm going to choose some
files here you can see I've got a txt
file out to txt files and a PHP file now
I've currently set this to only allow I
think txt and JPEG files so what's going
to happen here is this PHP file is going
to be ignored if I go ahead and open
these and click upload you can see we've
got two arrays output here one here and
then one here this one happens to be the
files that was successfully uploaded and
this one here it are the files that
weren't upload is and you can see that
this actually contains the file name
that failed and the error message so
file extension PHP not allowed and in
this successful array we just get the
path to the files that have been
uploaded I've got this open in my
browser if I just hit refresh you can
see that these files have been
successfully uploaded so we'll be
building this in obviously we're going
to be building the HTML form and then
we'll be submitting our fast through to
PHP looping through these and uploading
each one that's allowed ok so a quick
look at the files that we're going to
need here first of all you can see the
inside of my PHP multiple upload
directory I've got an index.html file
this is the file that we saw a moment
ago and this is the file with the form
or set you can see that I've got this
open here we've just got basic document
outline here with no body here so we'll
enter the form here and we've also got
upload dot PHP this is obviously going
to contain the script that's going to
handle the file upload now inside this
directory we've also got an uploads
folder which is currently empty we've
not uploaded anything and we've also got
stuff and this just contains a few files
that I'm going to be using to actually
test my file uploading so let's now
build the form that's going to allow us
to actually submit these multiple files
to upload dot PHP so we obviously need
form with the normal attributes you'd
expect an action a method and we also
need to define the ink type as
multi-part form data so the action will
obviously be uploaded up PHP which will
process our files and the method will
just be post as we usually expect so
within this form element you would
normally see an input type of file and
that's the case with multiple file
uploads as well so we have an input type
of file now for a single upload the name
you'd give would be something like file
that makes sense now not only we're
going to be we're going to be
pluralizing this we're also going to be
adding brackets to signify that this is
going to hold multiple values and in
browsers that support it to actually
allow multiple file uploads we need to
say multiple and this will allow
basically you to open your normal dialog
and actually drag and highlight multiple
file so use ctrl or shift or whatever
you do to select multiple files so let's
build the submit form quickly and then
we'll test this in the browser so let's
choose submit and the value would say
upload for browsers that don't support
multiple file uploading this isn't a
problem it will just fall back to allow
only one far to be chosen so when I hit
choose files here you can see that I can
actually drag and select multiple files
and it says choose files rather than
choose file if I were to remove multiple
you see that the ability to do this goes
the plural goes and we can't actually
select multiple files we can only select
one so that multiple attribute allows us
to do that but what about processing
this in the backend now it's actually
quite difficult to do this in the
backend because the the array that we
get back from PHP is actually really
complicated so to loop through we have
to use slightly more unconventional ways
of looping
so probably the most thorough way to
start this out and check things is to
check if we have a specific where we're
going to drill down and check if a
specific element in this array exists
and after I've done this we'll describe
how this looks in fact we could probably
do that now so let's do a print our on
the files array and let's see what
happens when we select multiple files
here so select the reason these three
files in here open and hit upload
in actual fact it might be easier if we
just wrap this in pre-tax this is just
format it so we can read it a little
easier okay so this looks a little bit
confusing because what we've got here is
we've got this files element here which
we would expect because that's what we
called it in our form but then we've got
an array in here with name type TMP name
evidence size so all of the properties
we'd expect to be associated with
uploaded of files but then within this
we've now got these properties within
these sort of outer these values within
these self outer property what would be
ideal is if you had a list of 0 and then
you have name type TMP name error all of
the properties within it these are sort
of broken up in a way that's a little
bit more difficult to traverse but
that's okay we can get around this so
I'm going to create an if statement here
and I want to check if something is not
empty now I'm going to drill down into
files as we've already seen name and
then 0 so what this is going to do is
it's going to tell me if at least one
file has been chosen or not
so let's echo out ok here and we'll
change your world
test this out in the browser let's
select three files and hit upload and
that's as okay perfect so let's choose
one file and hit upload and that's as
okay now let's choose nothing
and that doesn't so we know that we can
check if at least files have been
selected using this so now what we want
to do is we want to store these in a
variable called files this is purely
optional it just means that we can reuse
this a lot easier so we don't have to
keep typing this superglobal so what I'm
now going to do is I'm going to create
two arrays and these are basically going
to store the uploaded and failed files
so uploaded and failed we're going to
put these into an array whether they've
uploaded or failed and then later on we
can do something with them we're not
actually going to look at doing anything
with these but you can do if you want
you can got the option to do whatever
you want so we're also going to create
an an array called
allowed and this is going to store the
allowed values in this case I'm choosing
JPEG and txt and we'll be using the in
array function within our loop to check
if each of these files is allowed
so we're basically white listing what we
want to allow so now comes the slightly
unconventional way we're going to do a
for each loop on this ideally what we'd
want to do is do something like for each
files as file and then be able to access
properties like file name and file size
but we can't do this just because of the
way that the array is structured what we
need to do in here is we need to say for
each files name as position so this is
the index of each array or each element
and then we say file name so now a
position we have 0 1 2 0 1 2 because
we're uploading three files and file
name will represent the file name
because we're looping within the name
array now what this means is we're going
to have to store the file temporary
location the file size and access the
TMP name array size error at that
specific position so let's do that now
just so we've got them handy at the top
and it
everything's clear so we say file temp
is files which remember is what we
stored up here so it's the same as
saying with this super global files TMP
name and then after this we then want to
inject the position to here so that will
then give us if we just output this we
choose the three files here that gives
us each of these in a row so we can
basically do this with each sort of item
we want to gain get to sort of grab back
so the size in the error and as I said
it's a little unconventional so it's a
little bit confusing but unfortunately
this is probably any way that we can do
it all the best way to do it so we also
get the size and that's at the position
and we also want whether this errors so
we get files error position so we've now
got each of these every time it loops
we've already got the file name remember
because that's already contained within
this files name array so we don't need
to wreak it this down here so as with
whitelisting files against their
extension we need to extract the
extension this is no different to how
you would do with a single file upload
we basically explode by a dot and that's
the file name so this will give us an
array of basically what's been exploded
this will turn a string into an array
you can see that will give you txt for
the first file at the last element it
will give you PHP for the second file at
the last element and txt for the third
at the last element so because these are
at the last element because we've
exploded by dot any file extension
always comes last we say file extension
end file extension we could combine
these but later versions of
HP will generate a warning I think so we
say string to lower because we're only
providing the whitelist in lowercase and
that gives us our file extension for
each element so with that what we can do
is we can check whether this file is
allowed to be uploaded now we're going
to nest
lots of if-else statements here and this
isn't good practice but what it's going
to do is it's going to basically show us
how we can upload files here there are
probably much better ways to do this so
please choose your favorite way or have
a research around of your the best way
to do your error handling here we're
just purely doing this as a more
functional example so you know there's
nothing wrong with what the code that
we're writing here there's nothing
nothing Bad's going to happen but it's
good to go ahead and look up better ways
of doing things like this this the way
that we're doing it's just going to save
time and focus on what we're talking
about so we want to check whether the
file extension we've extracted is win it
within this allowed array that we
created up here so in this case this if
statement will only rent or this
statement here will only render or
expression will only when to true for
the thirst and first and third file
because the middle file the second file
it has a PHP extension in this wall
generate false so what we want to do is
we want to say else and in here we want
to say failed and we want to save
position is and then we're going to
create a string and in here we're going
to enter the filename and this is purely
for debugging purposes you don't have to
do this but we're just interested in
checking which files works and which
didn't so here we're going to say file
extension and then something is not
allowed so you can make this up or not
include errors at all but we're just
doing an example of an error system here
and I'm going to place a file extension
in there
so before we do anything else let's look
at what we would normally do down the
bottom here now outside of this for each
loop obviously we're going to do a
couple of if statements we're going to
say if not empty uploaded remember this
is our array that storing the successful
files we're going to print are on
uploaded ordinarily you do something
with this array maybe pass it back to
another page to output the errors to the
use of the successfully uploaded files
to the user you could output it as a
JSON string if you wanted to for a
JavaScript application to pick this up
it really depends that's why I'm not
going too much into this it depends on
how you want to handle uploads so I'm
going to do exactly the same check with
the failed array checking of this
elements within it and then we'll do a
print our failed so at the moment as you
can guess if i refresh and submit these
files we get an array back here because
our failed array contains one element
and that is on me to PHP which remember
we output in square brackets file
extension and the file extension is not
allowed so we've already got a sort of
error system in here anyway now inside
of if this does or if this is successful
we want to create another if statement
so we're going to say if file error is
equal to zero if the file error is equal
to zero remember what we picked up here
that means that the file successfully
was uploaded or was read successfully or
whatever now otherwise we're going to do
exactly the same thing as we did down
here we're going to say failed position
is equal to or we're going to assign
this value and we're going to say the
same thing file name fail to upload or
you could say forever dwith code it
might be a little bit better and then
give the
phile ever that might be a little bit
you more useful so we're not going to
test this one we're not going to try and
generate an error but if that did work
we can go on to our next check
now our next check is checking the file
size obviously purely optional but
highly recommended you're not going to
want large files to be uploaded
bear in mind also that in within your
PHP configuration so your PHP dot ini
file you're going to have a maximum file
uploads size set already
so consider changing that there plenty
of resources to tell you how to change
that or just go ahead and look inside of
your PHP dot ini file change your max
upload max post sizes and then restart
your web server so the file size I'm
going to choose is 2 megabytes and in
bytes this is this value here you can
use Google to come up with these numbers
for you to convert them now otherwise I
want to do again exactly the same thing
you can already see that we are getting
into chaining lots of ifs here probably
not the best way to do things but it
works for our example so I'm going to
say file name is too large and you might
want to include a maximum size in this
error message now otherwise we are all
good to go the first thing we want to do
is generate a new unique ID for this
name because if we allow file uploads to
be their current file name if we have
duplicate files they'll be overwritten
without warning so let's create a new
file name and we're going to be using
the unique oops the unique ID function
and we're going to add a prefix of
nothing and we're going to set the last
parameter to true this just increases
the entropy so the likelihood that it is
a random value and that helps us when
we're doing this there might may be
better ways to this but for now this is
a random enough value for us to upload
files we also want to define a file
destination this is important this is
basically the uploads directory that you
know that we have here
no faster at the moment
this is just going to be uploads /and
then we're going to concatenate on the
filename new so now that that's done we
can use the Move uploaded file function
and what this is going to do is it's
going to check if this is a valid
uploaded file via an HTTP request and
then it's going to move it to the
destination that we choose now we've
already got the name for the file we've
already got the destination which takes
into account this name and we've also
got the temporary location for the file
that we're currently looping for so we
can do this within an if statement
because move uploaded file will actually
check whether this operation was
successful if this fails then we can do
an else and we can add an error in here
in a moment so the file name is the name
of the father we actually want to like
this is the temporary file that's been
stored in our webserver and we want to
put this into file destination so if
that was successful we can finally
utilize this uploaded array and these
are the successfully uploaded files and
we'll just add the file destination to
here but you can add whatever you want
this could be another array with perhaps
a name of the file and the destination
or whatever you can do whatever you want
in it otherwise we want to say failed at
position is now we want to do exactly
the same thing as we've been doing let's
just go down here actually and fill
these brackets in just to keep
consistency make sure we've done it here
yes we have so far name fails to upload
simple as that so let's test this out
we'll run over what this does again
first just in case you're a little bit
lost because we have got into nesting a
lot of if statements so we've got the
unconventional for each loop inside
of the name array on our main files
which we did a print our on earlier if
you're confused do a print are on this
and surround it what by pre HTML
elements and that will give you a good
idea of how this all works
so we're looping we're getting the
position so for the first file this is
going to be 0 the second file is going
to be one and then the third file is
going to be two because it's a zero
indexed array and we're also collecting
the file name because we're looping
within the name array we're collecting
the temporary location the size and the
error of the file we're currently in the
loop for remember this is going to loop
three times because we're uploading
three files if you're uploading ten
files at loop ten times simple as that
we're grabbing the file extension by
basically extracting this from the end
of an exploded array exploded string
into an array we're checking if that
file extension is allowed in our list of
allowed extensions we're checking if the
file is errored if it's equal to zero
that means it has an error otherwise
we're adding in the error saying errored
with the code and then giving the error
and we're checking the file size to make
sure this is smaller than two megabytes
otherwise we're saying file is too large
and then we're generating a new name
using the unique ID function which
basically creates a value based on the
current timestamp and we're adding more
entropy to make sure this is even more
unique or more likely to be unique we're
defining the file destination this is
where it's going to be uploaded to in
the uploads folder forward slash the
name of the file and then we're
comparing basically the temporary file
to the new destination if that's
successful we're uploading the file well
we've already uploaded the file here
we're just adding to our successful
uploaded array and obviously down here
now what's going to happen assuming
these three files or two files remember
because we're uploading a PHP file as
well which isn't allowed assuming that's
going to work we are printing the
uploaded array and we're printing the
failed array as well so now when we
choose these three file
again remember we've got to txt files
and a PHP file this one won't be allowed
this will then give us an array of the
files that have been uploaded and it
also gives us array of the files that
haven't and for me to PHP the file
extension PHP is not allowed these two
have given us the destination so I can
assume that these have been uploaded so
let's check inside of uploads and it
looks like they both have</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>