<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Card Payments for Membership with PHP: Pay Button (3/5) | Coder Coacher - Coaching Coders</title><meta content="Card Payments for Membership with PHP: Pay Button (3/5) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Card Payments for Membership with PHP: Pay Button (3/5)</b></h2><h5 class="post__date">2014-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RJIZHqFetc0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now that we've checked if a user is
premium or not we want to go ahead and
set stripe up so we can actually use our
pay with card button so if you don't
already have a stripe account you're
going to want to go ahead and head over
to stripe comm and as long as stripe is
available in your country you can go
ahead and sign in here now by signing in
we can either use existing details or we
can go ahead and sign up and the great
thing about stripe is you don't actually
need to provide any details if you want
to just play around with this and test
you don't need to sign up so you can
skip this step just here so if I do that
what it will do is it will go ahead and
sign me into my dashboard and give me a
temporary account if you want to carry
on using this account after you've
finished playing around with it you are
going to want to go ahead and save your
account up here but for now a session
has been stored and we can just come
back to this later and use it just
looking around the stripe dashboard
we've got the difference between live
and test currently I can't actually go
to live because my account isn't
activated so we can only use our test
API keys here so apart from that you've
got the total volume that you've
collected in sales you've got things
like customers which we're not going to
be looking at storing also you can
filter through payments and things like
that what we're interested in the moment
is at this at the top of this page here
we've got this account settings here so
I'm gonna head over to this and I'm
going to click on API keys so these are
the API keys that we use to connect with
when we're writing code so we can
connect to stripe to be able to actually
process payments you're not going to be
able to do anything without these but
the first thing that we want to do
though is build this premium dot PHP
page here so let's go ahead and do that
now so let's create a new file in here
this is where the user is going to be
able to click the payment button so
let's call this premium dot PHP so in
here we want to bring in our
initialization file so app init dot PHP
because we're not need to access the
users details and down here let's just
create a basic document
let's just say premium here so inside of
the body we don't really need to write
much ourselves because stripe provides
us with the code that we need for this
button so if you head over to stripe
comm slash Docs slash check out this is
basically the functionality we need to
be able to enter card details and then
actually protis them so here you can see
a little demo of this but down here
stripe provides us with some JavaScript
here that allows us to actually do this
and I'll explain what this is in a
moment so you're going to want to head
go ahead and copy this and paste it into
here and let's just saw the indentation
out so you might be wondering what this
form is for so the way this works is
this script here brings in the stripe
JavaScript library it's important to
note it's served over HTTP obviously now
it's also got a class of striped button
which is going to star that out nicely
this all of this will inject everything
that your page needs to be able to pull
up this little box and for the user to
enter details validation things like
that the only thing that we need to
change is some of these data attributes
now the form itself is where the token
will be passed through to once the
user's details have been validated
basically now the token is essentially
just a token that stripe will generate
on their end give to you that you can
then pass in the back end through the
API now the important thing about this
is that this means that you don't have
to process any credit card details on
your server you don't have to store
anything on your server even just by
sending a post request to your server
credit card details might still be
logged to your server so you need to be
really careful here but doing it this
way will mean that you don't touch any
of the credit card details so you have
no liability here so the form action for
this is going to be premium underscore
charge PHP and that's going to be a page
that we're going to build so let's now
look at these data attributes here and
exactly what we need to change
we need to change the public key here
this is the publishable key that stripe
gives us we also need a private key that
allows us to make a charge on our server
let's go ahead and look at the keys and
how we can store them so inside init dot
PHP I'm going to up here say stripe and
that's going to be an array now inside
of here I'm going to have a publishable
key which is going to be a string and
I'm going to have a private key which is
also going to be a string so let's copy
these over we head over to our dashboard
the little thing we just saw a moment
ago and we've got a test secret key test
publishable key and alive and
publishable key so when you switch over
to production you're going to need the
live ones so I'm going to copy the
secret key and I'm going to paste it
into here we can call this private or
secret it doesn't really matter and we
also need the publishable key here which
we're going to copy and we're going to
paste into here so we've now got access
to this stripe array it's inside of our
premium page we can go ahead and echo
this out so echo stripe publishable
there we go so that will inject our key
into there that's really important is
obviously required now the data image
I'm not going to include here but you
can include a little image maybe the
logo of your website or something like
that I'm going to get rid of that for
now but you can go ahead and play around
with that if you want so here is the
name so I'm just going to say website
now the description is exactly what the
user is paying for so I'm just going to
say Premium Membership now the amount is
a little bit odd and this is currently
by default setting set to US dollars so
I'm actually going to add an additional
data attribute here to say currency and
this is going to be GBP so I'm going to
charge in GBP so pounds now the amount
is in pence or cents or whatever so at
the moment this will be 20 so I'm just
going to do 1000 for 10 pounds so now
what we can do is on
mium dot php' you see with you get we
get this little pay but pay with card
button let me just add a little
paragraph up here so you're about to go
premium okay so we've got our page setup
here we've got our pay with card button
if you open your chrome developer tools
or whatever browser you're working with
your network tab you can see here that
when we actually refresh we do get the
stripe javascript file here as well as a
few other things that that stripe needs
for this button and this this library so
when we click this button as expected we
get website Premium Membership we get
the ten pound label here to say how much
this is going to cost but the user still
now has to enter their email address
which is a little bit annoying remember
we have the users email address stored
here so we can remedy that by adding an
additional data attribute so later email
and we can set that to user email
remember we have that user variable just
here with all them properties on so now
when i refresh and i hit pay with card
you can see it gives me my email address
there already that's really useful so
stripe does have as i've mentioned some
test cards so you can see down here on
stripe calm slash dock slash testing
you've got variety of different test
cards for different card types at the
start of the series I was using the 42
42 which is probably the easiest to
remember for Visa so we're going to be
using that one here but we need to work
out what's going to go on from here this
isn't actually going to charge the user
we need to manually do that on the back
end using the private key so we now need
to work out what's actually going to
happen when the user successfully enters
their details and submits this form so
at the moment we obviously just have a
form going through to premium charge dot
PHP and the way that this works is it's
going to generate a token for us which
is then going to be sent through to the
page that we specify here and that is
for the sheer ease
that we don't have any card details
touch our server so what we need to do
is we need to create this premium charge
dot PHP page so I'm going to create that
inside of here
like so we'll save that as premium
underscore charge PHP and I'm going to
actually just echo this out now it's
sent obviously in the pipe where it's
available in the post superglobals
because we're sending this with a method
of post and the token name is that sorry
the key name is stripe token so all I'm
doing this page I'm echoing out that
token so let's look at how this works
when we submit through so I'm going to
hit pay with card I'm going to enter my
card details and I'm going to type in an
expiry and a CBC I'm going to hit pay
and as long as that's validated and all
them details are correct we're then
going to be sent through to premium
charge with this token so this token is
the only details or are the only details
that hit your server no card details or
anything like that
touch your server at all you might be
thinking well what's the point in that
how can I then charge the user this
token we can now use to make a charge
because all of your card details have
been securely sent and stored with
stripe so or not yours your users so now
what we can do is we can use this token
to actually charge the user and we're
going to be doing that with the stripe
PHP library in the next part</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>