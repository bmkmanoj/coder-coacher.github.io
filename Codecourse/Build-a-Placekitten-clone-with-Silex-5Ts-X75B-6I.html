<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a Placekitten clone with Silex | Coder Coacher - Coaching Coders</title><meta content="Build a Placekitten clone with Silex - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build a Placekitten clone with Silex</b></h2><h5 class="post__date">2017-02-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5Ts-X75B-6I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this course we are going to be
building a place kitten Cologne now if
you're not sure what this is when you
are building out a site you perhaps
sometimes want an image that is a
specific width and a specific height but
you want it to be interesting enough
that it makes your design look fairly
good so in this case what we can do with
this place kitten sight is go ahead and
pass in a width passing a height and
this will give us a random image of a
cat and it will do it at that specific
width and height so as you just saw just
a moment ago we have this here fully
working we can go ahead and provide any
width in any height and this will go
ahead and pull out a random image for us
and it will go ahead and give it to us
of course with that specific width and
specific height so the reason I chose to
build this project is we're looking at a
few things we're looking at the Silex
framework so this is a really nice micro
framework based on symphony and what we
are also going to be looking at is
database support to pull out a random
image from a list of images that we have
in a database table and of course we're
going to be looking at caching so we
have this really really quick so you can
see that once I first request this we've
got about 197 milliseconds but when I
rear equesticle ass'd and of course the
last thing we're actually looking at is
the actual image manipulation itself so
there's a few things to do here it's not
too difficult but if you are wanting to
get into using Silex we're going to
cover a few core concepts that will give
you a really good idea as to how to
start working with this framework and at
the end of the course you'll have built
something really fun that you can
perhaps go ahead and deploy it and use
if you want to so that is pretty much it
let's head over to the next part and get
silac setup and get this very quickly
built out alright so we are starting out
with a completely empty directory here
and the first thing that we're gonna do
is get Silex installed get a basic
structure set up that will not only
serve us now but into the future if we
need to add anything and then of course
we'll move on so the first thing to do
is go ahead and install Silex I'll leave
a link to the document
in the course link section if you need
to come over here but we very easily can
just pull this in using composer so
let's come over and inside the directory
working into a composer require on Silex
stash Silex and go ahead and wait for
this to finish okay so that's done now
for a fairly small project like this I
still kind of break this up just in case
like I said I need to add anything to it
so usually create a public folder in
here just for any public assets we'll be
moving all of our cat images over to
this folder as well later but the first
thing I do inside of here is just create
an index dot PHP file this will just be
the kind of landing point of our
application so what we need to do now is
just come over and create some kind of
bootstrap folder where we need to
bootstrap anything up that our app needs
and in our case we're just gonna have a
very simple app dot PHP file now this
will be responsible for just pulling in
our vendor autoload file so let's go
ahead and require in dir and let's go
back into the vendor folder and then go
ahead and pull in all todo PHP so we'll
go ahead and set our upper up in here in
a minute but for now over on index we
want to require this bootstrap file in
and then from within here we can go
ahead and run our app so very very
simple structure but it's pretty
effective to work with a small project
so we want to go into the bootstrap
directory require an app dot PHP and
we're pretty much done down here we'll
run our app in just a moment but of
course we need to get everything else
set up in here in as well okay so let's
create an app variable just here and to
pull in Silex or at least boot Silex up
we just go ahead and new up application
class as part of Silex and what I'm also
gonna do for the purpose of this is just
turned it bugging on just so if we come
across any errors we get that output and
we can fix anything up so now that we've
done this we overran our index dot PHP
far because we've required at this
bootstrap file in very simply we can
just run our app now in between this we
need to include our roots so again I
usually create a folder for this and
depending on what I'm doing I just
break these up so in this case I'm going
to create a web dot PHP file if I had
any API routes I'd maybe create an API
far again you can structure this really
however you want so now that we have
that over in our bootstrap file we can
very easily require this in so let's go
ahead and pull this file in so it's in
there so again we go back a directory we
go into route summary will require web
PHP in and we can set up a very simple
route in just a moment for now what I
want to do is just create an HT access
file in here just so if we do create our
routes we don't run into any problems
now I already have this created so I'm
gonna go ahead and pull it over it's
pretty much from the Silex documentation
and I'm working with Apache if you're
working with nginx this will be slightly
different but shouldn't be too bad so
now that we have this done let's get rid
of that and we should be good to go so
we can come over to here we obviously
know that the entry point is public and
it's like we've got a little error here
in our bootstrap file on line three so
let's just head over to this and of
course I didn't concatenate this
properly perfect so give that a refresh
and there we go so we obviously see this
error because we don't have a root for
the home page but that's absolutely fine
we don't need to worry about that just
yet so let's look at just Auto loading
everything in then we'll go ahead and
create a very simple route just to test
this out and then of course we'll move
on to making this will work so we're
gonna have an app folder because we're
gonna be registering a silac service
provider which we're gonna need to auto
load from somewhere from some kind of
class so i'm gonna create an app
directory in here and then i'm going to
update my composer json file to also
load files from here using the psr-4
standard so all we do is give our app a
root namespace in this case I'm just
gonna call it app but of course what you
could do is give it a name of whatever
project it is in this case it'd probably
be place cat and then we tell composer
where we're loading them files from and
in this case it's app so now that we've
done that we just need to do a composer
dump auto load so that's all registered
in there and we are pretty much good to
go so that's just very very sim
okay so let's create a really simple
route just to test this out it's very
very simple because we have a pin scope
here we can just say get forward slash
we can go ahead and create a closure in
here we can use controllers but for this
it's going to be very simple so we're
only going to define out one route and
in here we can just return a response
maybe so what I'm gonna do is pull in
the response object so we can actually
return that we are going to be using
that later so it's worth pulling it in
now anyway so let's go ahead and use
Symphony and this is under component and
it's under HTTP Foundation and we also
have a request so I'm gonna pull that in
as well
and why don't we go ahead and pull in
our response too so I'm gonna use the
PHP seven update to pulling in things
like so just so we don't have to
duplicate this down onto a new line so I
really like this so let's just return a
response in here let's go ahead and give
null a 200 status code and we should see
something in the browser so what we
could do in fact if we just fix that up
he's just returned home just to kind of
see something on the page at least give
that a refresh and we see home so that
is our basic application set up and
ready to go the source code for this all
of this as it's plain form will be in
the course downloads if you don't want
to go ahead and get this set up or you
already know how to get a silence
application set up so you can go ahead
and grab that if you're having any
problems setting up this base
application the only thing I want to
kind of do is just pull in my request
here so we have anything from the
request that we can use and we also have
things like our select app as well so
what we can do is just go ahead and say
Silex
application this will give us an app
instance that we can use to access
anything out of the container and that
is pretty much it so if we just go ahead
and make sure we didn't break anything
looks good and we can kind of use this
when we set up our route for our width
and our height which will again later
return an image either way that is
pretty much basic Silex app setup and
we're ready to move on now that we have
our app set up we are going to dive into
our database we're going to create a
table which will write
in each image and then from that what we
can do is extract a random row from our
database table or map that to an image
that we have in storage and then we'll
go ahead and eventually return the
actual image for now what we're going to
be doing is just looking at how we grab
this from the database now the first
thing that we need to do is install
doctoring DeBell so let's go over and
pull this in using composer this will
just provide an object relational mapper
that we can use within Silex so let's
require in doctrine D Val and we all set
this up when it's finished okay so now
that that's done we need to configure
this and we can do this within bootstrap
app because we need to attach this to
our application so what we're gonna do
is go ahead and register this on our
application and in here we go ahead and
pull in the provider for this so it's
under Silex under provider and it's our
doctrine service provider very very
simple and then inside of this what we
want to do is go ahead and pass in some
configuration so in this case what we do
is we take DB options we can readjust
some multiple database connections in
here but of course at the moment we only
need one and we just basically provide
everything in here that we need so we
need a driver and I'm just going to be
using MySQL but you can pretty much use
anything you want so we're going to go
ahead and define that in we also need
our host which is pretty simple again
we're just working locally so we have
local host and we have a database name
which in my case I have called place
cats so again create a database if you
haven't already we have a user so pretty
standard stuff which again is root for
me we have a password again this is root
and then we have our character encoding
as well so in this case it's utf-8 and
it's mb for like so so let's fix that up
and we're done so that is our database
configuration setup now over in our root
we need to kind of create this out a
little bit so we can actually pass in a
width and a height so we'll set that up
now we don't really need it at the
moment because regardless of the width
and the height of the image that we're
requesting we always pull out an image
at some point we're gonna cash it like
but we always need an image so I'm gonna
go ahead and update the URI just for now
and I'm gonna simply provide two
placeholders in here so what we can now
do rather than access home which now of
course doesn't exist we go ahead and say
something like 200 by 200 or literally
any size at all this will work for any
size at all so now that we've got that
in there the other thing I want to do is
kind of make sure that a width and a
height is always some kind of number and
also always a positive number which is
really important so what we're gonna do
is we're going to use the assert method
here to say that we want the width and
we're gonna use a regular expression
here so we're just going to very simply
say zero to nine and we're gonna use
plus to make sure that this is unsigned
so it has to be a positive number of
course we can't have an image with a
width and a height that's negative so we
go ahead and use assert against and we
do the same thing for height
very very simple we just pass in zero to
nine and again we make sure this is
unsigned too it has to be positive so
give that a refresh it works in exactly
the same way but now if we provide some
city value in here that's not a number
it just doesn't recognize the root okay
so now that we've done this we already
pulled in app just here from the last
part so we can actually use this to go
ahead and grab that from the database
because we've now registered this on our
app so this is really really simple all
we're gonna do is create a variable
called image and we're gonna be kind of
switching this round in a minute because
or a bit later because we've got a
couple of other things that we want to
do here but really simply for now what
we can do is just access app DB we can
go ahead and fetch an associative array
back from a query that we give now this
is really simple we just need to select
something like a file name so I'll go
ahead and write this out before we put
this into the database just so we kind
of know what we're doing and this is
maybe going to be from an images table
and that is pretty much it so that's all
we need to do for now what we could also
do at this point is order this by random
so that kind of helps and we're going to
limit this by one so that will just give
us a random record from this table okay
so now that we've kind of figured out
how to do this let's
do a var dump on image here go ahead and
kill the page and we'll set our database
up and get our images into a location
that we can pull them out from so the
images table as we know we're extracting
from this and we know that we have a
file name just in here this is going to
be a varchar' maybe 2 5 5 it can be
anything and really what we want to do
now is just kind of map this two files
that we have on our file system so over
in public I'm going to create a folder
in here maybe called image and I'm gonna
go ahead and copy over a load of images
to here so if we come over to public I'm
just gonna pull over a load of cat
images I'll leave a link to all of these
in the course download so you could go
ahead and grab these let's make sure
they're in the image directory and we
now have 1 to 10 of images perfect so
now that all we need to do is just go
and say 1 jpg and of course you could
host these elsewhere you can do really
whatever you want here but it's
generally a lot easier to do this on the
file system so we can just go ahead and
duplicate these down now and make sure
we have 1 to 10 in here so we're always
plucking out one of these so I'll just
quickly go ahead and duplicate these
down and up back with you in just a
second ok so these have been duplicated
down now we now have 10 images in here 1
JPEG through to 10 JPEG and we have them
in the database as well so now now that
we're picking out a random image we
should have the ability to map that so
if we give this a refresh we can see 5
JPEG give it another refresh we see 7
and so on and so forth this will just
pick this out in a random order ok so
now that we have done that we pretty
much have a random image that we can do
something with the next thing that we
need to do is actually respond with our
cropped image so we need to reduce the
width and the height we need to actually
return this in the response rather than
home so let's go ahead and just revert
this back let's go ahead and stick null
in there because we of course need to
change that over and we'll go over to
the next part and look at how we use
intervention image to manipulate this
image and then respond with it ok so now
that we have a randomly selected image
we need to manipulate
and go ahead and actually respond with
it then we'll work on things like
caching and all the other features that
we want to implement now we're gonna be
using a package called intervention
image which is a really nice way to
manipulate things either using the GD
library or the in magic library we're
gonna be using the GD library but it's
pretty straightforward
we're not gonna be diving too much into
this all we really need to do is reduce
the size make you grayscale and we're
pretty much done now there is a little
bit of work we're gonna do around this
because we're gonna create a service
provider for this and we'll look at how
this works so let's go ahead and get
this installed we'll create a select
service provider for this and then we'll
look at how we use it within our route
really nicely and then we can reuse it
elsewhere if we need to so first thing
is let's go ahead and actually install
this so we're going to use composer
again to require this in and this is
under intervention and then slash image
so we'll wait this to finish as always
and we'll get this included ok so now we
want to rather than just start using
this within our route and get into a
little bit of a mess I'm gonna create a
providers folder over here we'll go
ahead and cry our own select service
provider which is really useful
knowledge because then any kind of
service you pull into a Silex
application you can reuse and we're
gonna go ahead and create an image
service provider so feel free to call
this whatever you like you can make it
as specific as you like really doesn't
matter now with any service provider we
need to implement the pimple service
provider interface so let's go over to
service provider interface and pimple
comes as part of Silex so we can just
have a look at this interface see what
we need to do and we need a register
method in here that's all we need and we
need to have an instance of the pimple
container into this as well so let's go
ahead and pull these in so let's first
we'll set the namespace for this because
we are using PSR for Auto loading for
this so we have app providers and let's
use pimple container because we know
that we need that inside of that
register method and let's also go ahead
and use pimple service provider
interface and
I'm gonna use this syntax for filling in
my namespaces because they are under the
same root namespace so let's go ahead
and say provider interface and we're
pretty much done so we're gonna create
an image service provider class of
course and we're going to implement the
service provider interface and then we
need that register method in there so we
can just go ahead and create this up
like so and then into this we know that
we get a container instance in and we
can just call this app it's usually
convention that we call this app it just
makes it a little bit easier when you're
writing code down here rather than
naming this pimple okay so now that
we've done that we need to figure out
how to actually pull in intervention
image now there's a couple of ways that
we can do this we can do this either by
using a kind of facade a static class or
we can use the intervention image image
manager and I must prefer this method so
we're gonna say intervention and then
image and then image manager and we're
basically just going to bind this on to
the container so to do this we say app
we give it the name that we want in this
case we're just gonna call it image and
this is how we pull it out of the
container and then we're gonna say app
factory and then inside of here we give
a closure and we just return whatever we
need and in this case we're returning a
new image manager so this is now bound
onto the container once we register this
without app and we can use this anywhere
that we have our app instance available
so let's go ahead and register this and
then within our route we can very easily
use this with app image so over in
bootstrap app we just register this as
normal so much like we did without
doctoring service provider and of course
it's our own service provider now so
let's say app register and we create a
new app providers and of course it's our
image service provider and of course you
can import these at the top if you
prefer it doesn't really matter too much
so let's go ahead and just give this a
refresh make sure we didn't break
anything everything looks good so we can
come over to our roots and start to use
this inside of here so we know the
location of the image we know that our
images are inside
public image and we know that we get a
file name through this query that we
created earlier so now really all we
need to do is map this up to
intervention image we can manipulate
using intervention image and then we're
pretty much ready to go so to do this
let's go ahead and create some kind of
placeholder variable will be again
fiddling around with this later because
we really need to cache these images we
don't want these to be pulled out and
then manipulated every single time you
make a request we want to cache these
for speed so we're gonna say app image
because remember we have our app
instance in here and we're gonna go
ahead and use the make method so we're
now using intervention image methods in
here
to go ahead and pull in an image
manipulate it and then respond with it
so in this case we're gonna go ahead and
pull in the current directory here we're
gonna go back a directory into public
we're gonna go into image and then we're
gonna basically using the result from
that query that we used earlier we're
gonna grab the file name so we now have
that image ready to start manipulating
and I'm just gonna kind of pull this
down onto a new line because we need to
chain on a lot of methods here so now
all we need to do is fit this to a
specific width and a specific height now
we don't have access to these two
placeholder values at the moment and all
we do is just add these onto here so I'm
going to say width height and so on and
so forth depending on how many
placeholders you have now we can say
well we want to fit this to a width and
a height that's provided in the URL we
want to make it grayscale so all of
these kind of methods here are available
and the intervention image documentation
so if you need to do anything else to
these feel free to refer to that
documentation now what we need to do is
create a response for this placeholder
so very simply we say response PNG and
we're done we now literally have a PNG
image so we can't really just say well I
want to place that inside of the
response we can do but what we'll get is
if we just fix up the path here so you
can see we've got image but we didn't
add a slash just on the end of there we
should now say the raw image to hater
which is not good so what we want to do
is inside of
response send over some headers now we
know that when we respond we're using a
PNG all the time regardless of the
source type of the image so as a third
argument to our response we can simply
start to pass in some headers so we want
to tell the browser that we have a
content type here of image / PNG like so
and that is pretty much it so grabbing a
random image from the database looking
that image up and responding with that
image at the width and the height that
we've requested give it a refresh and we
see a cat perfect and of course if we
refresh this we get a random selected
one every single time so that's pretty
straightforward what we can now do is
start to change this around so I can say
500 I could change this to 200 and we
get the same thing so works really well
of course they're cut off a little bit
but I'll leave you to fiddle around with
that depending on the images that you
use but that is pretty much the basis of
it that's how easy it is now we can't
really stop here because if we are using
this as a service if you were building a
service like this you really need these
images to be as fast as possible and the
problem with this is we're always going
ahead and fitting this to a width and a
height
we're always processing this as
grayscale so it's taking a little bit
longer than it should do and we can kind
of see this if we open up our network
tab over here and go ahead and give this
a refresh you can see that this is
actually taking if we pull this out 172
milliseconds now that doesn't seem a
long time but ideally what we want to do
is once we have at a specific width and
a high manipulate this image cache it
and then just serve that image back to
us if it already exists so with that
said what we want to do is go over in
the next part and look at caching our
rendered images so now it's time to
cache the images as we've already
discovered this is going to be a lot
quicker
of course because we're doing image
processing now I really like using this
service provider for caching it's really
really flexible I'm going to go ahead
and implement this setup file based
caching but of course later down the
line if you wanted to use this package
it's very very flexible so you can use
any
Cashion drive you want so let's come
over and install this first of all and
we will look at how we set this up so
very simply do a composer require on
this wait for it to finish and we'll go
get set up okay so that's done I'll
leave a link to this in the course link
so you can go ahead and grab this let's
go over and start to create our caching
directory maybe we had another directory
with a cache directory in it in this
case what I'm gonna do is literally just
create a cache directory in here and
then maybe have some kind of images
directory inside of this but of course
feel free to structure this however you
want okay so now that we've got this
directory of course what we need to do
with this service provider is register
it on our application as we've done with
everything else and then of course pass
in the options as well to say where
we're caching to which driver we're
using and all that kind of stuff
so somewhere around here let's go ahead
and register this and this is under a or
this package name space and it's under
Silex
provider and it's a cache service
provider and now what we need to do is
go ahead and pass in our options so
cache options in here and then we can
just go ahead and pass these in now this
is really simple we just need a driver
which is a file based driver and we need
the cache directory which we use if
we're using firebase caching in this
case we can just grab the current
directory we can go back into cache and
then into images and that is pretty much
it so now we can use this inside of our
route to retrieve an image from the
cache if it's previously been stored now
the way that we're going to do this is
first of all attempt to get from the
cache and if it doesn't exist so if it's
not in there we're going to process the
image as we're doing down below and then
we're going to store it into the cache
so this is just a kind of common way to
look at look something up in a cache if
it's not in there we go ahead and do
whatever we need to do we store it back
into the cache and then on the next
request if we do attempt to get it from
the cache we're probably likely to see
in
and we can just use that value from the
cash so let's go and first of all say
that our placeholder is instead of this
so we'll add this into a conditional we
want to say app cache so this is how we
access that package now we want to go
ahead and fetch at a particular key now
what we want to cache by is the width
and the height so if we say we request a
200 by 500 image we want to grab an int
and omim egde we want to cache this and
the next time we request 200 by 500 this
is simply returned from the cache now
the only downside this is you're always
going to get the same picture but
there's not really a way around that you
can't then reprocess another random
image but not cache it so that's really
the only way to get around this so what
we do is we fetch by specific key we're
gonna choose the key and this is going
to be the file name so I'm just gonna go
ahead and pop these in here we're gonna
separate these out by a colon and then
we're gonna say the width and we're
gonna say the height like so so that's
just pretty standard and what we're
gonna do is at the same time as fetching
this we're gonna go ahead and grab the
cache key so we can store this at that
particular key as we've checked it so
we're kind of checking it setting the
key and then down here we can use that
same key to go ahead and set it just so
we don't have to repeat ourselves repeat
any code okay so now down here if the
placeholder is false which will be
returned if we don't have anything in
the cache we want to store it into the
cache and to do this we only need to do
this when we can't retrieve it from the
cache so this is the only time we're
ever going to be processing an image so
now what we can do is after this we can
store it into the cache and then we can
return the version of that image so
we'll return this if it's not in the
cache we'll go ahead and store it here
otherwise and then on the next request
this will be true or it will at least
hold a value so then we'll just return
the place out of this is why we're using
the same name so now down here we're
just going to say app cache and we're
going to store this at the cache key
that we
signed as we've looked it up and we're
simply gonna place the place hold it
into the cache so just to kind of
reiterate if you are new to caching
again we check if this is in the cache
setting the cache key if it's not we
processed the image and store it in the
cache and then either way whether it is
in the cache or not in the cache we
return with that image very very simple
let's go over we know that we're getting
a time of about 137 to 150 milliseconds
give it a refresh this time around it
will be a little bit slower because it's
the first request but now when we
refresh again and it looks like we've
got a little error so let's go ahead and
just have a look so file name in web on
line 8 let's have a look here of course
so in this case it's not file name it is
in fact image file name but I think in
this case actually we could probably
just get rid of that I think the width
and the height is enough to satisfy our
cache key so give this another refresh
and we see again 153 milliseconds but
now when we refresh we're getting a much
lower response time because of course
what's happening now is it's just being
pulled out of the cache not manipulated
anyway and just returned to the user so
there we go that is our caching of our
images done very very simply using that
package very nice to work with and what
we can now move on to is in the next
part looking at if we perhaps won a
specific image to be pulled out so for
example I might want to say image equals
and then give the ID of the image that I
always want then we can use that to
specifically return an image that we
want so at the moment it's not going to
work but we need to do a little bit of
updating
to use a specific image if we want to
all right then so if I want to use a
specific image by its ID I need to be
able to pass it into the query string
and I must have that image returned to
me at the size that I gave but we also
need to think about caching as well so
we need going to need to update a little
bit in here as well
so we have all of our images inside of
cache images we can go ahead and remove
these if we need to the first thing I
want to do is update this to go ahead
and adjust my query based on that query
string that we pass in
so the best way to do this because we
need to kind of modify the query we want
to kind of keep the same thing we don't
repeat this line of code within an if
statement what I like to do is say
something like clause and then inject
that into the query and then of course
we need to use prepared statements for
this because we're passing something
from the query string directly into our
query so we need to think about security
here as well so what we're going to do
is using the request that we have inside
of here we can actually say get image
and that will give us that value that we
use in the query string so if we just
kill the page here and go ahead and just
die and dump on Clause or just kill the
page on Clause give that a refresh we
see five so we have that value now that
we can use to check now I'm gonna do a
ternary here to check if that is a value
because this will be null otherwise and
then I'm gonna say where ID equals and
then a question mark that I can later
bind in so we're checking if that exists
the clause will be a specific ID which
will pull out one image only now
otherwise we basically just want to
order by Rand and then limit to one so
we can go ahead and get rid of this and
pop that in there and then really simply
into here we can just place our clause
so we can put that in there and now
depending on whether that's been passed
into the query string we now have either
where ID equals 1 or 2 or 3 up to 10
which will always return us one image or
we're ordering by random and we're
limiting by 1 now of course at the
moment we're not actually passing the ID
of the image in so we need to do this
within an array as the second argument
and this is just the value that we want
to find in or the values we want to bind
in in order if we had more than one and
of course we know where that comes from
it comes from request and we say get
image like so now it doesn't matter if
we're ordering by Rand limiting by one
and we're passing this in as well so we
do have this passed in even if we don't
have something in but to be honest it
doesn't really matter too much it's not
going to affect the way it works so now
that we've done this we know that this
is going to give us back a specific
image if I just go ahead and refresh
here I don't think this is actually
image
five so even if we change this over
notice that we're still getting the same
item back so what we really need to go
ahead and do is update our cache so this
takes this into account now by this I
mean that we're gonna add on to here the
image that we're potentially requesting
so we're gonna say request get image and
now of course that's not going to exist
in the cache so now what we can do is
for a specific width a specific height
and a specific image we can grab this
and go ahead and cache it based on that
as well so this is just making it a
little bit more unique now what we can
do then is come over here and say well I
want image 1 and there we go we have
image 1 we can change the width and the
height over and of course that will
still bring us back image 1 but of
course it will cache it at this at this
specific width and at this specific
height so we can go ahead and change
this as well if we want to we could do
the same width and height for image 2
that would cash that out 500 by 500 we
can adjust that and still get image 2 so
now we pretty much have the caching in
place but we have more flexibility to
pull out a specific image if we want to
and there we go that is how we update
this to specify the image that we want
to see but it's still cash here for that
width and for that high so we speed up
our responses</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>