<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Streaming Your Webcam To An HTML5 Canvas Element | Coder Coacher - Coaching Coders</title><meta content="Streaming Your Webcam To An HTML5 Canvas Element - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Streaming Your Webcam To An HTML5 Canvas Element</b></h2><h5 class="post__date">2014-09-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nCrQ1A2BEZ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so as you can see in this video we
are going to be streaming a webcam to
our browser and then going to be
applying some fun effects to the video
as you can see down here I've got some
kind of spinning of this canvas element
I'm drawing this webcam stream onto and
have also added a sepia effect as well
now we are going to be focusing on CSS
effects and CSS or CSS filters should I
say and CSS animation to do things like
this I spin around but we are then going
to look at doing a black and white
directly on the canvas so if you do need
to say manipulate this directly on the
canvas rather than CSS we'll look at an
example of how we can turn each pixel to
a black and white value so we'll do both
and then you can see which one you feel
the need to go ahead and use at the only
downside with the CSS effect is that you
can't then capture that as say a as like
a photo as easily you can't do it so
we're going to jump straight into the
code build the actual stream that you
can see here and then we're going to
look at adding like I said some effects
to this so we're going to be starting
completely from scratch here and the
only thing that I've done is just laid
out my document and I've got a video J's
file within a Jas folder linked in at
the bottom of the page and I've got a
stylesheet linked in the top and that's
purely going to be for the little gray
box that we saw that video in and then
we're going to add out our key frames
for our animation apply them to the
canvas as well as doing the black and
white directly on the canvas as well so
let's just quickly mark this up it's
nothing too difficult we have this or
booth class that I'm just going to apply
some stars to in here all this is really
going to do is set a width on this say
400 pixels we'll give this a background
as well so si si si and we'll give this
a large border as well nothing
complicated you don't have to do this
it's not required obviously but if you
want a nice little area to play around
in then you know that's good so if I
just have an A in there you can see
that's basically what it's going to look
like
so within our booth what do we need well
we're applying video to a canvas element
so we need both a video and a canvas
element so the first is a video we don't
need a source because we're going to
inject the source once the user hits
allow on their browser to use the webcam
but we are going to predefined a width
here and the height you don't have to do
this you can do it with JavaScript you
can do it with CSS I guess but I'm going
to specifically define this it's just a
little bit easier than doing it any
other way I'm going to set the autoplay
attribute here as well so we're going to
be taking this video and applying it to
a canvas element so as you probably
guess the canvas element is also going
to be 400 in width and it's also going
to be 300 in height and that's all we
need here so let's jump over to our
javascript file here and let's actually
I'm going to create a self invoking
function quickly so this will just be
run as soon as our page works at a load
and what I'm going to do in here is I'm
going to select all of the elements that
I need on this page to be able to do
this so the first one is the canvas
element so let's grab the canvas so
document dot and we use the get element
by ID method which is self-explanatory
it just grabs that element
now we also from the canvas need to grab
a context this is going to be 2d so we
use usually a variable called context
you can call this whatever you want and
it's canvas and we use the get context
method here and we supply the value to D
so that's just going to allow us to draw
things onto our canvas so the third one
then is the actual video element itself
so document dot get element by ID again
and in this case is going to be video so
remember we have fact we didn't actually
give these an ID did we so let's give
these an ID quickly so this is an ID of
video and this is an idea of canvas
there we go that makes a lot more sense
so we've now got the canvas the context
of the canvas the video and we also need
the URL API within our browser this can
either be non pre
fixed or WebKit prefixed so let's create
a variable for this now this just allows
us to build up the URL later on that
will then inject into the video element
so window dot URL or if that's not
available window dot WebKit you are ill
in caps and there we go that's all we
need for there so now what we need to do
is establish the vendor prefix version
of getting the user media and this is
basically just taking like a video
stream or an audio stream from the user
so I'm going to say navigator get media
and I'm going to assign something to
this and this is going to be much like
what we just did with the URL API it's
going to be navigator dot something in
this case it's get user media now I'm
going to do some more in here at the
moment but if you do need to find out
what you require within a browser just
type navigator here dot get user you can
see there's nothing but if we have
WebKit yet to use a media you can see
that exists there so I've just bought on
my console by the way you can get it
from this menu or just right click
inspect element so if that's not
available I'm going to come in I'm just
going to end these for readability we're
also supporting the WebKit prefixed
version which you've just seen so it's
WebKit yet
user media or if that's not supported
navigator dot mods which you can
understand is Mozilla Firefox user media
and understand this is tedious as well
but you are going to need these if you
want it to work in cross browser or
cross browser so getusermedia there we
are so we've got all of them now so all
we need to do now is start capturing the
video so we use navigator get media and
in here we pass in first of all an
object then we pass in a callback
function for the actual stream itself as
long as the user has hit allow and then
we have a last callback which is an
error and we can extract the error code
from that if we need we're not going to
be going into that too much now because
we're just sort of playing around here
we're going to say video true in here
and we're going to say audio false so
remember this is a JavaScript object
in here so that's the first argument of
this get media method the second
argument and all of these arguments are
required by the way it will give you an
error if not the second argument has a
has a sorry the second yeah the second
argument of this it media method has an
argument itself of get straight out of
stream sorry so the stream contains that
stream and we're going to apply that to
the video itself so we say video dot
source we're creating the source
attribute by doing this and that is
vendor URL which is what we have up here
remember and we're going to use the
create object URL method and then we're
going to pass in that stream so down
here we're going to play the video so
you can control the video with play
pause stuff like that so when i refresh
now oops okay so oh yeah of course we
don't have the last argument here so
let's pass in the error callback and
this has an error argument here which
contains a property called
error code so an error occurred and you
can use error code to find out which
error it is so maybe the user click deny
or they don't have a webcam whatever so
I hit allow there and there we go I am
back on the top of part of this screen
essentially but what we want to do is we
want to take what we see on the webcam
here and we want to place that down here
on the canvas so we want to place that
on this canvas element and then we can
manipulate it so we're basically you
know doing what we want here we can of
course apply CSS transitions and things
like that directly to this video element
we don't need to use CSS transitions on
this canvas but we'll be looking at
applying them to this canvas anyway just
so we can see a normal version of the
webcam feed and of the canvas here so
let's go ahead and look at doing this
now so what we need to do is we need to
add an event listener for when the video
is playing or plays so down here what we
do
we say video and we use our add
eventlistener method and this is for
things normally like click and and stuff
like that
you probably aware of but this time it's
play we have our callback here and what
what we want to do is we want to call a
function to draw this onto the canvas
so I'm just going to say draw and then
we need to pass through a few things the
first is the actual video itself and we
can either use video we can use this
it's probably advisable to use this we
also want to pass through the canvases
context so in this case it's just going
to be context and what we're also going
to do to help ourselves out in the
future if we ever want to modify this
code we're also going to pass through
the width and the height just in case
you do end up changing the width and the
height here of your video stream you're
going to want to be able to easily just
pass in more and not have to modify code
because we are going to be using the
width and height quite extensively okay
so we also pass false just through here
and now onto our draw function so we
create this function here this could be
some kind of method if you have a sort
of app object now what we want to do is
we want to well we need to define what
is being passed through here the first
is the video the second is the context
and then the width and the height so
down here what we can do is do something
like context draw image now what we do
here is we take the what we want to draw
on in this case it's the video the X and
the y offset where it starts and then
the width and the height where we want
to place this so in this case it's we
start at 0 and 0 and we want to draw
this for the width and the height let's
now take a look in our browser and
you'll notice something's not quite
right here I'll just allow this again ok
so it doesn't seem to be working the
reason for this is that what we're doing
here technically is we're calling this
once but we don't want to call it once
we want to keep calling it so we keep
updating the canvas with the new video
image so to do that we easy we just use
a timeout
so we
set a timeout here we need to set which
function we want to call normally you'd
do something like an anonymous function
in here but in this case we know the
name of the function that we want to
call that's draw and we need to provide
how many milliseconds this refreshes at
we can do 20 10 whatever it doesn't
really doesn't matter too much and then
we need to obviously pass in the
arguments that the draw method requires
in this case then it's going to be the
video the context the width and the
height you can shorten these if you want
to make it look a little bit neater but
now when we refresh and we accept or
allow there we go so whatever I do on
here you can see on the canvas below it
awesome so we're now replicating this
onto a canvas which we can then
manipulate you can take screen grabs
from you can put silly hats on people
whatever you want to do in terms you
know however far your canvas knowledge
goes but you can look that up and start
playing around with it so now comes the
fun part I'm going to start to add some
CSS transitions onto this canvas and
then we'll look at how we can make this
image black-and-white using the canvas
element so looping through the pixels
turning each one grayscale and then
applying it back to the canvas so now
what we want to do then is head over to
our javascript file and this is really
just playing around but it just goes to
show how powerful this is so we're going
to target everything under the canvas ID
you'd probably give this a class if you
were doing this for real but we'll just
use the ID for now so for the canvas we
can use different CSS properties we have
a filter CSS property which allows us to
do things like grayscale and then
provide the percentage that we want to
make the image at grayscale in my case
on Chrome I require the WebKit vendor
prefix in that case you would just then
apply the WebKit and Mozilla and
whatever vendor prefix and then fall
back to the standard implementation with
no vendor prefix so now when I hit allow
I'm black-and-white down here and color
up here so we can do other things as
well
this gets quite fun and probably
quite addictive so we can say we want
CPR on here or sepia however you
pronounce it and I've just removed the
standard implementation just to be quick
and let's allow that again and there we
go so we can add all sorts of effects
here but let's look at just one more fun
thing before we go back to the canvas
and let us create a animation CSS
animation so we need to define the
keyframes again you can need vendor
prefixes for these at the time of
recording so we do at because this is
technically not a CSS property as a rule
so we are defining the vendor prefix
here keyframes then the name of the
animation we want to give this you would
then before I start coding anything else
you would then use the non vendor prefix
version as well as mores you don't need
MS and opera as well so I'm just going
to using the WebKit vendor prefix for
simplicity so what a hundred percent of
this animation so basically from 0 to
100 I want to apply a transformation so
we're now using the CSS transform
property to rotate this 360 and we use
the degrees unit and there we go
we haven't applied it yet so this isn't
actually going to work what you do need
to do is use the animation CSS property
like this but in our case we our vendor
prefix we have and prefixing it so
WebKit animation we choose the name of
the animation first of all remember we
call it rotate we then choose the amount
of time that we want the animation to
take place from start to finish in this
case I'm going to choose like five
seconds or something we can then choose
the times we want it to loop but we can
handle II define infinite and then you
want to provide the motion so I could do
something like linear this would just be
a linear movement or we could do things
like ease in out in this case that I've
just done a linear rotation which takes
five seconds to complete and there we go
I'm rotating in sepia so I'll just
quickly show you the
in out and there's plenty of these and
you can define custom motions as well we
just allow that you can see that it
starts off there we go so it starts off
very slowly gets a little bit faster and
then ends very slow it's easing in and
out cool so now that we've done that we
can actually get rid of these because
like I said these aren't very useful if
you want to then snap a photo from the
canvas and we have another lesson on
that as well so go and check that out if
you want to take photos from the canvas
and you can apply this to that lesson so
inside the video j/s what we want to do
is down here rather than drawing the
image to the canvas and then looping it
what we do want to do that but in
between that what we want to do is we
want to grab the pixels from the image
loop through them turn them grayscale by
basically setting the each of the RGB
values we get an RGB and an alpha value
on a pasty value through from the object
that we'll get back in in a moment and
then we just set them all to the same
value which then gives us grayscale
that's basically how it works if the RGB
values are are the same you'll get a
grayscale image or the brightness sorry
so let's do this now the first thing
that we need to do is we need to grab
the image data so I'm going to define up
here the variables that I'm going to use
so we need the image which is the actual
image data if you like but then we have
a separate method to grab the data so we
just add a variable for that we have I
which is going to be our incremental
when we loop through the pixels we have
the RGB and the brightness and that's it
so this is basically what we're going to
make ourself and they're applied to the
RGB values so down here and the reason
I've done this is because you always
define the variables that you're going
to use at the top of your function
rather than barring all the way down
okay so let's set the value for this
image then it's basically just context
because we're applying this directly
from the canvas so we're taking what's
being drawn
under the canvas and then we're actually
manipulating that rather than
manipulating the video and drawing that
onto the canvas so we're going to say
get image data and then we want to grab
that from 0 0 so from top-left basically
at a width of the width that we have and
that's a height of the height that we
have so that now contains all of the
data for our image but we want to
extract specifically just the data so we
want to say image update ik so there's a
lot else that's returned from this as
well so let's just do a console log of
data and just see what we get out here
so let's inspect this allow and let's go
over to the console there we go so you
can see all of these values are
basically as I move around and do things
and this is going really slowly now
these are the pixel values basically the
color values within each pixel so that's
great and they're set out in a way that
we can really easily manipulate them so
we're going to do a for loop here to
basically loop through all of the pixels
turn them grayscale and then set them
back on themselves and then draw the
pixels back on so we're going to say for
I equals 0 we're starting at 0 and we're
going to say while I is less than data
but length that's just the amount of
pixels and then we're going to say I
equals I plus 4 you can do i plus 2
equals 4 or whatever however you want to
do that so now we have access to inside
of data we have 0 which is our 1 which
is G and then 2 which is B and then we
have 3 which is the Alpha Channel so
we're going to say R which remember we
set up here RGB values up here R equals
data I it's fairly straightforward G
equals data I plus 1 that's again fairly
straightforward and then B equals data I
plus 2 so we're grabbing 0 I is still 0
so then we say 1 and then we say 2 so
we're getting them values now what we
need to do is we need to take our be our
and be add them together and divide it
by three which will give us an average
value so brightness equals R plus B plus
G and then we divide that by three so
now we have that value that we're going
to apply to both Otto sorry to all of
the channels so RGB which is going to
then turn that image grayscale so we're
going to say data I equals data I plus
one equals data I plus two this is
basically just assigning one value at
the end so if we were to type one there
one would then be assigned to this this
and this that's just what all of all of
this equals means going on and we're
going to set that to the brightness
there okay so now that we've got that we
want to basically put the new data that
we've got in here remember when
manipulating this data up here directly
inside of this loop so now we have all
grayscale what we now need to do is want
we want to apply that back to this data
so we're going to say image dot data
equals data so we're just reassigning
that basically and then what we want to
do is we want to put that image data
onto the canvas so we use our canvas
context here to basically apply this but
sorry context and then we have a put
image data method which will take the
image here which is the original data
remember remember we've changed the data
within that we're just basically putting
that back onto the canvas at 0 0 like so
so now if everything has gone well and
I've not mistyped anything and I allow
that we should have let's just refresh
we should have me at the top and there I
am grayscale at the bottom with no CSS
filters at all we've done that purely
with the canvas and obviously you can
muck around with this so for example if
you wanted to increase the different
color channels you could do you can
maybe times that by 4 and times that by
5 for example and we'll see that that
gives us an entirely different result
there I'm really sort of weirdly
contrasted now and you know you can muck
around with
these values once you've understood how
this works you can you can start to play
around with this and now that you know
that you can grab the image data and
manipulate it in that way you can also
grab it and manipulate it in other ways
so perhaps you can increase the blue
channel or the red channel you know have
a play around this is really cool to
play around with like I said we do have
another lesson on actually taking a
snapshot from the canvas and then
downloading that photo so check that out
if you want to apply it effects to your
videos and then actually go ahead and
snapshot a photo but for now that is
drawing a or or streaming a video to our
page applying the data that's from that
stream onto canvas and then manipulating
the pixels within that canvas</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>