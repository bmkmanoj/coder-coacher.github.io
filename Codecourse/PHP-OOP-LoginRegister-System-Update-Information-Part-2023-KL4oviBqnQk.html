<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP OOP Login/Register System: Update Information (Part 20/23) | Coder Coacher - Coaching Coders</title><meta content="PHP OOP Login/Register System: Update Information (Part 20/23) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP OOP Login/Register System: Update Information (Part 20/23)</b></h2><h5 class="post__date">2013-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/KL4oviBqnQk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">we'll now go ahead and give a signed in
user the ability to change their profile
details so for example at the moment the
only thing that we can really give the
user the ability to change is their user
name or their sorry their names or their
full name so most of the functionality
already exists to do this we don't
actually need to develop much new
functionality because we have a
validation class we have the ability to
check if a user is signed in or not
we have form tokens we have input
helpers validation helper and the
ability to pass the user back to the
home page to tell them that they their
details have been updated we don't
actually have a lot to do here so let's
go ahead and actually just start to
build this up and work out how easy is
to use everything that we've already put
together so I'm going to go ahead and
require on the update dot PHP page the
initialization file for our code and
then going to say user equals new user
and from this I can determine if the
users logged in or not
now if they're not logged in I want to
redirect them back to the home page
I could even redirect them to a 404 page
but that's probably not very helpful so
what I now want to do is in fact before
we do anything here let's go ahead and
just build our form
so our method as usual is going to be
post and inside here all we're really
going now the user to update at the
moment is their write their name so I'm
going to say label and find out div
class equals field and let's go ahead
and create a label for their name now
this would just be name and then input
for the name as well so that's also
going to be text the name is going to be
just name and the value here is going to
be their current name so we want we want
to put this in here as well obviously we
want to escape it escape escape using
the function that we've already created
and we want to grab the data and we want
to grab their name okay so we obviously
need an input field here and we want the
value of this just to be update and we
also want to token as well we've already
looked at token functionality so the
value here is just going to be echo
token generate lovely so let's go ahead
and preview this in our browser in fact
let's create a link here to just you
know give give it the ability for the
user to click this it just makes a
little more sense so let's just
duplicate this and we'll just say update
details or something and this will be
update dot PHP so now that we're on the
home page and we are signed in we click
update details and we get this page here
the ability to enter a name and an also
update so we click update and that that
data is submitted so now that we have
our form created we can start to check
whether we have any input we can check
whether the token exists if that's if
that's a correct token or not to prevent
cross-site request forgery so we're
going to say if in
exists then what do we want to do where
we want to check the token that's been
supplied it's the same or we want to
check that's the same as the sessions we
have a method to do that and we pass in
input get token and if that's the case
then cool we'll just echo out okay for
now just so we can see that this has
worked so that's going update okay so
perfect we we know that that's worked so
now we want to go ahead and validate
stuff and this is really important
because we want to validate it to the
same standard as we validated it as we
register a user so you want to say
validate equals new validate and we want
to say validation equals validate check
now we want to check the post data and
we have an array of rules as we already
know and we only have one field here so
let's say name and we obviously need to
define whether it's required which is
true because we required it for
registration so why wouldn't we require
it for an update we want a minimum value
which was 2 and we want a maximum value
which was 50 and that's it so we then
check if the validation has passed
so if validation passed we want to go
ahead and update otherwise we want to
loop through the errors that we returned
so for each validation errors as error
we want to echo out the error and append
on a line break so it's functionality
that we've already built we know exists
in our applications so we don't need to
worry about it so if I get rid of this
and click update name is required if I
put my name is a it says name must be a
minimum of two characters you know so
we've included all of this functionality
already it you know it's nothing new to
us we're just using our application as
we know that we've built it so we're
going to have a try block with a catch
and the reason for this is that we're
going to actually throw an exception
inside of our user method and whether if
this fails
I see if the database operation fails
you have an exception here e and we want
to die e get message by the way I have
explained this but this get message
method is just part of the exception
exception object in in PHP so there's no
this isn't something that we are
actually building now we're going to
introduce a new method on the user
object we've already instantiate AddThis
all we really need to do is pass or call
this update method which we haven't
created yet so we're not to confuse and
with this functionality we want to pass
a list of elements that we want to
update and their values so name is going
to be input get name that's all we need
to do so we've now complete this
functionality we need to go back now and
rich reflectively create this update
method so let's go ahead and do that now
so we'll head over to our user our user
class and we'll go ahead and create a
new method here now this method isn't
going to do you know isn't going to do
too much work because we already have
the ability to update using our our
database so we're going to create an
update method and this is going to take
it obviously the fields and by default
that's going to be an empty array if
that's not being defined and so what
we're going to do now is we're going to
fill this in but there's a little caveat
because we need to call the update
method on the database object so let's
just do that quickly and then see what
kind of problem we may potentially face
and so I'm going to say if if not this
DB updates users with a specific ID with
the fields then we want to throw a new
thrown throw a new exception and we just
want to say there was
a problem updating okay so we need to
get this ID from somewhere and what we
could do is we could just say ID calls
this data ID but we want to make sure
that this function as he doesn't break
if there's there's not an ID available
for whatever reason so therefore it
probably a good idea to be to sort of
bake this into our update method as a
second optional property a parameter and
so we can update other records as well
for example if we had a user panel or an
admin panel sorry and an admin panel
allowed an admin to update users data we
want to define an ID because we wouldn't
necessarily want to get the admins ID
and update it like that so here what we
can do is we can say if there's no ID
being defined and this user is logged in
then we want the ID to be this data ID
now otherwise by default this ID will be
the ID that we specify so if we were to
say here update user idea for this block
won't run and then we'll update here
with a user idea for if we don't supply
this it will update the current users
our ID which is what we want our
otherwise the functionality would be
useful we not actually can include this
in in this application so I'm going to
go ahead and change my name to just Alex
I'm going to update this and it looks
like that worked but obviously we have
few redirection issues there we'll deal
with them in a moment once we've updated
successfully if we browse here you can
see that my name has been changed Alex
so the functionality works as we would
expect we've already we already built
the database functionality so there's no
reason it wouldn't work so once we've
updated a user uses information let's go
ahead and session flash
home your details have been updated and
we'll go ahead and we'll redirect
obviously to the home page so now what's
going to happen is when we update I'll
switch back to Alex Garrett I'll click
update your details have been updated
and then you know that they're they're
changed so we've not really interested
any new functionality here we've seen
all this before but what we've done is
married it all together to mean that we
can actually you know build on the
functionality to have created that's why
we've created the application in this
way so that's basically how you Doug
data uses details if you were to update
say a name and you want to allow more to
be updated you just need to define it in
here and in here that's all we really
need to do</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>