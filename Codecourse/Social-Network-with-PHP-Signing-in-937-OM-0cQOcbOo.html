<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Social Network with PHP: Signing in (9/37) | Coder Coacher - Coaching Coders</title><meta content="Social Network with PHP: Signing in (9/37) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Social Network with PHP: Signing in (9/37)</b></h2><h5 class="post__date">2015-08-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OM-0cQOcbOo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now that we're able to sign up we
want to sign in and there's a little bit
more involved here we obviously need to
authenticate a user but we're also going
to change the navigation as well I'm
going to implement a method on the user
model to output the user's name so
before we get going I'm just going to
update this template quickly with the
header so I have my auth controller and
routes open but I'm just going to head
over to my view for sign up and I'm just
gonna add a little h3 up here saying
sign up you can obviously add whatever
else you want in here so that's just
improve that page a little bit so over
on our sign-in page then we obviously
don't have any controller methods to
handle these so let's implement these
quickly now so we have a get sign-in
much like we had forget sign up and here
we're gonna have a post sign in and as
you would imagine the get sign in is
going to return a view and this view is
going to be both sign in so let's create
this file just now so under out views
create a new file and we'll go ahead and
call this sign in a PHP and again you
would have had the mark up in the course
files so we can just paste this markup
in here in fact let's pull over our base
template first so let's paste that in
there get rid of all of that content in
there and let's copy over the mark-up
within the course file and just re
indent this we'll go ahead and we'll add
an h3 just up here and we'll say sign in
like that so we now need to modify our
routes so I'm just gonna be really lazy
and I'm gonna copy these paste these
because they're very similar we're just
gonna say sign in change this to get
sign in we're gonna call this off sign
in instead we'll do the same for this as
well now of course you can give this any
URL you want it doesn't really matter so
then I say posts I
and again for the earth controller will
kill the page here and say sign in okay
so now that we've done that let's go and
head over to sign-in we can see our form
there I've got this remember me checkbox
as well handy so we can check this if we
do want to be remembered but we're gonna
update the navigation quickly so we can
click on sign-in so from any page within
click sign-in so over to our templates
partials and navigator we know the name
of this route so you can update it here
so we say route Earth sign in and then
we can go ahead and we can click on that
everyone you can move between pages
perfect so when I hit sign in now we get
a token mismatch exception again so we
need to include that in our form let's
just close these off go ahead and add
that here so remember it's an input type
of hidden the name is underscore token
and the value is session token so now we
should be able to submit this through
and then we get sign-in great so
although that was signing submitting
through we still have the action as a
hash that we've just gone to the same
page it's always good practice to
include your full URL in here so we have
auth dot sign in for that form action
okay so over on the auth controller then
when we do use post sign-in we have the
same request here so we can just pop
that in there and we do pretty much the
same thing we just need to validate
everything so the validation here is
really straightforward we just want to
make sure the email and password are
required there's not really any further
validation that we need so we're gonna
say this validate request then we pass
our array of our fill of our names and
rules so that email is required
and the password is required to and then
here again we'll just say all okay just
so we know that we're working well so at
the moment then we can hit sign in and
nothing happens because the validation
has failed and under our form then we
can do pretty much what we did before
with our errors so under our form group
here we're gonna say if errors has email
we're gonna output a space and then has
error otherwise we'll do an empty string
and we'll do the same for our password
as well so if errors has password we
want to output as error otherwise an
empty string so now that we've done that
we need to do the same thing that we did
before where we looped through any
errors I have not looped through we
checked if there was an error and then
we output the first error so we can do
that here too so if errors has email
remember we won that span with a class
of help - block and then in here we can
say errors first email and we can copy
and paste this be a little bit lazy pop
that down there just replace that in so
now when we submit we get these to read
and the email and password field are
required great so we're not going to be
including the values and keeping the
values in there if things fail but you
can change changes however you want you
can even remember the state of the
remember me button if you want I'll
leave it up to you to customize this to
however you want so I'm gonna enter my
email address my password I'm gonna hit
sign in and we should get
that all okay string perfect so now is
the job of actually authenticating here
rather than dying dumping a message
so to authenticate we can wrap this
pretty much all in an if statement and
we need the or facade so I'm just gonna
import this at the top here so we're
just going to say use auth and we say if
not or attempt so we're attempting a
sign in here and if this does pass it
will automatically set all the sessions
you need so you don't need to worry
about setting them manually so we're
here we pass in request only this is
just a method that allows us to pass in
two bits of data or more than two but in
our case it's just email and password
and once we've done that you can see
we've got this array here or this piece
of data here got this array in here and
what we can also pass in to author tempt
is the remember me state so we need to
do here is so request has remember so
what that will do is it will check if
our remember checkbox here it has
actually been checked if it has a non
value and the name of that is remember
so it's pretty straightforward
so if that is the case then we want to
return back and say we could not sign
you in because remember this is checking
for false so we want to return redirect
we could we can redirect a route or
we'll just do redirect back with info so
our lurk box we created earlier could
not sign you in with those details so
otherwise down here we want to redirect
the user to the home page and give them
a some info that they've been signed in
so we can return redirect to of a
specific route with some data and that
data is going to be in the info key in
session
you are now signed in so we'll test this
out it won't look like we're signed in
when we do successfully sign in but then
we can update our navigation to reflect
that so I'm gonna just enter in Alex and
I'm gonna enter in a wrong password hit
sign in and okay so class chatty user
not found and I think I know the issue
here so what we actually have is under
our come fix if you bring up config here
and off this obviously allows you to
choose either a database or eloquent
driver for for authentication we're
using eloquent and we have an
authentication model here so what we
need to do is change this because at the
moment we are using the chatty namespace
but remember we deleted that original
user model and we replaced it or
recreated it inside of the models
directory so that's the error that we're
seeing here chatty user that was trying
to access chatty user there or the class
from that but we're now in models so
we've gone ahead and done that get back
to our sign-in page let's go ahead and
sign in with the incorrect details so
could not sign you in with them details
and I'm now going to go ahead and
authenticate with my username and
password my password is just password
I'm gonna hit remember me and hit sign
in okay so let's see redirects have
route missing argument one okay so let's
go and check out what we've done here ah
okay of course we didn't enter home
there so let's go on to the sign-in page
and just go ahead and do that again okay
so we are successfully signed in but the
templates that you would have downloaded
if we go over to our navigator you can
see here that although I'm caught I've
come into these out these are still
being rendered by blade so this will
still be outputting PHP so what we can
actually do now is we can uncomment
these coming to them without HTML is
useless so I'm gonna get rid of this
actually and I'm gonna keep that
username in there that's just hard-coded
use then we'll change this in a moment
so now what this is going to do then we
can get rid of these comments as well so
make sure these are uncommented and
we'll just go through through this very
quickly so if the user is authenticated
we want to show links like timeline
friends we want to show the search form
so they can go ahead and actually search
for a user on the site and then down
here on the right navigation bar this is
a bootstrap markup and styles obviously
we're checking if the user signed in if
they are we're showing their username
we're asking them or giving them the
option to update their profile and we're
also giving them the ability to sign out
which we'll be looking at next otherwise
we're saying well you can sign up for
sign-in so let's save this make sure
it's in this state let's go and refresh
now and you can see that we get the
navigation that reflects a signed in
user now let's quickly implement this
get full name or user name method that
we saw in the template but we didn't
actually implement on our user model so
I'm gonna head over to our user model so
remember inside of app models user and
let's go ahead and implement this now so
we're actually going to have three
methods here
just in case you want to choose between
them use them individually or just have
the flexibility there so the first one
is going to be a function called get
name this will get the users full name
otherwise it will return null so have a
quick check in here this is going to
check this first name so our first name
column and this last name so if they are
both available we know that we have a
full name so we can return this
first name a space and then this last
name so that's gonna get get our first
name so now we are going to implement a
check for our first name so we're going
to say well otherwise if this isn't
returned this is the next check so we're
gonna say if first name returned this
first name now otherwise as a last
resort we're going to return null and
now we're gonna implement a method to
get the users full name or first name or
their user name so this is really
straightforward because a lot of
checking is done here already I'm gonna
say get name or user name and this is
going to return this get name which is
the method that we've just created or if
that isn't available it's gonna return
this user name pretty straightforward
and we could also go and we could
implement a method like get first name
or user name so we wanted to address
them in an email or something like that
or we just wanted to informally address
them somewhere and not output their full
name we can have get first name or use
the name and all this will do is it will
return this first name and if that
doesn't exist so if it's null value
we're gonna output their user name
because we know that always will exist
so what we can now do is using get get
name or user name you can even use get
first name or user name but I'm gonna do
the full one in the navigation we can
now replace this dÃ¡il placeholder with
that so we can say for user which is
I'll use a model now and we can use that
method so this for me will just show
Alex but if I were to update my first
and last name which we'll be looking at
later when we work on update profile
then that will show my full name but of
course you can change that and just show
the users user name if you want
so we are now successfully signed in we
have our remember token store if you hit
inspect element and go over to resources
and cookies and over the domain you're
working on you'll see that we've got
that remember token in there as well as
well as our laravel session so that is
signing in not entirely straightforward
but really pretty easy to do so next
we're going to be looking at being able
to sign out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>