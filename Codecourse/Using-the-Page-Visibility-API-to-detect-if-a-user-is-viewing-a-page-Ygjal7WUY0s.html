<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Using the Page Visibility API to detect if a user is viewing a page | Coder Coacher - Coaching Coders</title><meta content="Using the Page Visibility API to detect if a user is viewing a page - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Using the Page Visibility API to detect if a user is viewing a page</b></h2><h5 class="post__date">2015-03-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Ygjal7WUY0s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're gonna look at the
page visibility API and how this is
helpful for us but mainly our users now
if you have a site that may be us
something repetitively with some kind of
loop some kind of interval in JavaScript
like polling you can see the bottom
we're just pulling over and over and
over again just doing a fake pole and
just incrementing some count when the
user navigates away from this page do we
want this website to continue polling
probably not because they're not
actually viewing it if we're in a
different tab we might not want some
action to be performed over and over
again and this isn't just useful for
polling is useful for a variety of
different situations for example you
could have an image carousel which
automatically rotates through images you
don't want that to happen when the users
not on the page so let's take a look at
how this actually works so if you keep
an eye on the console just around here
I'm gonna switch over to this other tab
we're going to return back and we're
gonna see what's happened so let's say
we get to 75 and then I'm gonna switch
over to another tab okay so I'm now in
my other tab we left the count for that
poll on 75 and we're gonna leave it a
couple of seconds as I'm talking and
then we're gonna go back to this page
now you can see that it's still polling
but it's it's it paused at 75 so we're
continuing to poll now and if you notice
you can see that we have visibility
changed to hidden visibility change to
visible so what we're doing with the
page visibility API is we're detecting
whether the viewer or the visitor is on
a page now why is this useful which
useful for particularly mobile devices
devices that you want to reduce battery
consumption CPU usage while the user
isn't on the page it's going to cost a
user a lot of money in beta or a lot of
data if you are constantly polling
something when they don't need to be
polled so that's how it works that
why it's useful now let's take a look at
how we can actually use the page
visibility API we're gonna build this
example and you can go ahead and
implement it in your own projects so
we're starting out with a completely
blank page here we're gonna build just
some script tags in line on this page
and just demonstrate how this works so
we're going to get our polling going and
then we're going to detect whether the
user is actually viewing the page or not
so let's create some script tags just
here and we'll go ahead and start
writing some JavaScript within here so
let's get our poll started first of all
so let's go ahead and define the hole
count up here we want this to be 1 or 0
default we don't really care it's only
an example and we're going to create a
function here called poll which is
actually going to poll something this
could be anything so inside of here
we're gonna console.log I'm not actually
doing anything and we're gonna say
polled x times so we're going to replace
this X with the poll count we're gonna
go ahead and increment that poll count
like so so now what we want to do is set
an interval we want this function to run
every minute every second so we're going
to say set interval I'm going to pass in
the name of the function or the variable
that's holding that function and we're
gonna say we want this every 1000
milliseconds so now what we see is the
following on the page it just keeps
going it polls and polls and polls when
we move over to this tab obviously
they're still polling in the background
which is a massive problem so we don't
want that to happen so let's go ahead
now and look at how we can stop this if
the document is hidden so all I'm gonna
do is within this poll function I'm
gonna do a quick if statement here to
access this hidden property on our
document object now if this returns true
that means the document is hidden by the
users not currently viewing you so we're
gonna do
this function is we're going to return
we're not going to continue with the
rest of his we don't want to do whatever
we doing down here
if the document is hidden so let's go
ahead and test this out let's refresh
the page that will stop that on to and
want to switch over to this other tab
wait a few seconds we'll come back and
you can see that that will then continue
that will continue to poll now how can
we actually detect with an event
listener as the visibility changes let's
say for example you have some kind of
video playing let's say you have an
html5 video playing this is another good
example when the user switches to
another tab you might want to
automatically pause that video and
that's entirely possible with this so
what we need to do is we need to set up
an event listener so we're going to add
an event listener here and the event is
visibility change lowercase V so here
we're gonna pass in our callback and
what gonna do here is we're just gonna
console.log I'm gonna say visibility
changed to and then we're gonna append
on something set X so let's go ahead and
just concatenate on document dot and now
we have a new property called visibility
state like so so visibility state let's
just pull this in a little bit so what
we're now doing is we're listening for
this visibility change when that does
change we can just run something so in
the case of an html5 video when the
visibility changes to hidden we can go
ahead and pause the video and then when
we come back and it changes to visible
we can play the video again so we're not
going to do this in this video but you
can go ahead and implement that if you
need it so let's go ahead and run this
switch over to a new tab come back and
you can see that as we switched over we
didn't see it because obviously we
weren't on the page but the visibility
changed to hidden and the visibility
changed back to visible when we landed
back on this page
so we can use the hidden value to detect
if it's if it was hidden and we can use
the visible value to detect if it is now
visible again
ie pausing and unpausing a video so that
is a little bit about the page
visibility API and how you can go ahead
and use it in your projects there are
like I said different applications to
this so you can go ahead and choose how
it's going to be useful to you but it
will save your users a lot of bandwidth
and a lot of their CPU usage while
they're not viewing a particular page</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>