<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Form Database 'Exists' Checker jQuery Plugin: Backend (2/3) | Coder Coacher - Coaching Coders</title><meta content="Build A Form Database 'Exists' Checker jQuery Plugin: Backend (2/3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Form Database 'Exists' Checker jQuery Plugin: Backend (2/3)</b></h2><h5 class="post__date">2014-09-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NDXvv-Q4Dvg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so to start things off then we'll build
our back-end check and essentially what
this is going to do is output a JSON
string that we can then easily grab with
JavaScript and then check if the
username exists or not so essentially
what this check dot PHP page is going to
be doing is it's going to be returning
something like the following so it will
be brackets like this it will have
exists here and then we'll have a true
or false value so inside of our browser
we can head over to that far and we see
here exists true I'm using a plug-in for
Chrome which shows me a nicely formatted
JSON object here but if you're not then
that's fine it will you'll just see text
that looks much like this and that's not
a problem it will still work fine so
this is our end result but we obviously
want to be able to pass a type in here
so I want to say well I want to check if
a username exists and the value of this
is going to be say Alex and then we want
to get this back to say exists true
exists false and then we can chop and
change these around so this could be
maybe checking if an email exists and
then we could type an email address in
just here so that's what we want to end
up being able to do so let's head over
to our PHP file and it's open some PHP
tags now the first thing to do is
establish where this data is being
stored and where we're going to get it
from so I have a database created called
website and I'm gonna create a table in
here called users you might already have
a user's table that exists at the moment
that's apps that you find I assume
you're gonna have an auto incrementing
ID this basically just means that every
record you insert this will increment by
one and that's obviously a primary key
and has an auto increment on there so we
have a username here we have an email so
I'm just adding fields in here and I'm
just gonna add an extra dummy field
created which is going to be a date/time
and for the user name this is going to
be a varchar' and that's going to be a
length of 20 and the email will also be
of our char and we'll say 2 5 5 for that
so remember we're just testing here so
we can insert some dummy data so I'll
enter an email and then the creator that
they so we've got one record at the
moment Alex Alex at Co course comm that
creates that date and then we'll enter
another one as well so we'll say Billy
Billy at code course comm and then we'll
do now okay so we've got two records in
here we know what our database structure
looks like we can now start to connect
to our database within this file and
then check now you probably have a
database connection established
somewhere else in your application if
you aren't starting this from scratch so
you'll probably already have that
connection available in which case just
require in the files that you need to be
able to access that database connection
otherwise I'm gonna just quickly
instantiate a PDO object here and I'm
going to connect my database up here
exclusively within this file so I'm
using the MySQL MySQL driver the host is
the localhost or 127.0.0.1 so now what
we want to do is as I mentioned earlier
we are going to be able to pass in the
type here and the value so if the type
is email and the value is Alex at Koko's
comm we're gonna look for this value
within this field on our users table and
if it exists we can return that it does
exist so we'll do an if statement here
to check if both of these exist in the
yet superglobal which basically just
means have they been passed through in
the query string when we accessed their
the name that we gave that in the query
string by the key it's a type and we
have value as well like so so if that's
the case then inside of here we can
continue with our code we're not going
to provide any else here we're just
gonna bind sort of completely return a
blank page if the user hasn't supplied
these and because you know there's no
real point in returning
an array for an error you can do this if
you want but either way so it will store
the type here which is dollar underscore
get type and will also store the value
here as well so we can access these
quite easily so value now for the type
we're gonna be checking that this exists
within an array because what we don't
want to do is we don't allow this to be
anything at all and because you might
just be out you might just want to put
it straight into a query what I'm going
to do is I'm going to do a switch on
type and then I'm going to choose which
one is appropriate but I'm also going to
include the in array function as well to
check just in case you want to take a
different approach because remember you
don't want to blindly allow people to
just choose any value from here and then
place into a query whether it's escaped
or not so I'm going to trim this first
of all and I'm also going to trim the
value as well all this is doing here is
its removing whitespace from the left
and the right hand side of these strings
and for the type as well I want to use
the STR to lower function
so we've now both these values stored
we're going to check that this type
exists within an array but first of all
let's define how our output is going to
look so my output is going to be an
array here and we're gonna have exists
false you can set this to true by
default if you want really doesn't
matter and in here we're gonna have our
little if statement to say if in array
type and then in here we're gonna define
the allowed types so this is username
and email you can define this array in a
variable up here if you want but I'm
just gonna put them straight into here
so we have a username and the email so
if that if all that's worked I'm just
gonna echo okay then oops you've got a
little parse error let's have a look
here ah there we go
extra
so this is okay if we were to not
include the value it doesn't say okay
and if the type was to be something
other than username or email so for
example created then we don't get okay
so we're only allowing this to happen
within that so now what I'm going to do
is I'm gonna create a switch here with a
case for either the user name or the
email just in case you need to do
something else other than just a query
within here you can go ahead and modify
this depending on how you are working on
the back end you might even not be
working with PHP in this case you would
do something entirely different to this
but either way let's carry on with this
just so it's as flexible as possible for
you to go ahead and use so we have a
switch here and we're gonna have two
cases the first case is going to be
username so in here we need to do a
query to grab the count from the users
table where the username equals the
value that's been provided now otherwise
we have another case here and we're not
going to include a default here that's
going to be for email we're gonna do
exactly the same query but we're just
going to modify the email field you can
of course do one query and inject in the
type but it probably best a hard code
this just from a security point of view
and that's why I'm taking the slightly
longer route just so it's a little bit
more secure so let's take a look at what
the query looks like for the username
and then we can essentially duplicate it
for the email I'm gonna name this
variable check here so we're gonna say
DB prepare so we're gonna do a prepared
statement with PDO I'll bring this down
a little bit just for readability I'm
gonna select count on asterisks which is
optimized within MySQL to return the
count and we're gonna alias this using
the as keyword as count so we can access
that as a property when we fetch the
object so we're grabbing that obviously
from the users table and we're grabbing
that where the username equals a
particular value so we're gonna
a placeholder here so we can execute
this later passing in the placeholder
and that's all we need to do within here
so we can basically copy this and paste
that for this change username to email
and there we go so we're selecting
account so that's either going to be 0 1
2 3 should never be 2 or 3 because you'd
obviously check that they weren't cheap
look at records but now after the switch
down here what we can do is execute that
query so all we do is we say check
execute this is now going to actually
run the query and we need to pass in
this value here now obviously the value
is the value that's been passed in to
the URL so we just say value value so
that's a little array in there so now
let's do a print our just so we can see
what's going on here so I'm gonna do a
print our on check fetch object this is
going to grab the record as an object so
when i refresh now you can see it says
we've got a class here an object here
sorry and we've got a count of 1 because
we know that the email Alex at Koko's
comm exists if for example we were to
change this to user name and we want to
check if the username dial exists we get
a count of 0 because we know the inside
of our database we don't have a user
name called Dale however if we were to
change this to Billy we get a count of 1
or Alex we get a count of 1 you get the
idea
make sure this is working and then you
pretty much 98 and there so what we now
need to do is change this output to set
this exists key to true or false based
on the fact it we have a positive count
or a negative count or ie 0 so all we do
is we say output exists and we want to
assign a value to this and we're going
to use a ternary operator here to say
check fetch object much like we just did
within the print are checking on the
count property we know that this count
property exists if that's a positive
number we can assign true
to this otherwise we assign false so all
this is saying is assign something to
this exists key now output array up here
if the count is positive assign true to
this otherwise assign false that's all
we need to do so we've now got if we
just do a print R on our output we now
have exists one exists one exists folks
so that's how it's represented true or
false values when we do a print R but
that's not good enough because this is
going to be really difficult to pick up
with our JavaScript front-end as the
users typing what we need to do now is
use the JSON encode function to
basically take out array and encode that
so it turns into a JSON string so we
echo JSON encode output like so it's a
JSON if you're not aware it stands for
JavaScript object notation and it's
basically just a data interchange format
so it just means that we within
JavaScript now we can pick up this
exists key by doing data dot exists
checking that equals false jQuery will
automatically parse this JSON string for
us and convert it into a or posit to a
JavaScript object so we then have the
exists property that we can check this
value being true or false so obviously
this is now working we've now completely
done the back end this is all the code
that we need you can go ahead and modify
it depending on how your application
works but now what we can do is we can
focus on building our form creating our
JavaScript file linking that in and
actually putting all this functionality
together</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>