<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Poll With PHP: Polls &amp; Choices (5/7) | Coder Coacher - Coaching Coders</title><meta content="Build A Poll With PHP: Polls &amp; Choices (5/7) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Poll With PHP: Polls &amp; Choices (5/7)</b></h2><h5 class="post__date">2014-09-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/W79uXioky18" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now that we've listed polls we want
to first of all get the general poll
information and display this here so
we're just gonna output the poll
question here and then look after that
dealing with outputting the particular
choices relating to this poll so let's
stay on this page a poll here we've got
all the information that we need to
actually replace so we've done our
markup now's the time to actually start
to create the queries let's close off
index and let's close off next we don't
really need that anymore
and under poll dot PHP let's start to
make this a little bit more dynamic so
at the top but we want to obviously
require in our initialization file so
I'm going to do a require once on app in
it dot PHP and then down here we're
gonna start to do a few checks the first
thing we need to check is if the actual
whole ID has been specified because if
we just go through to Pulver here pull
up PHP we you know we need a pol ID to
be able to display Paulo information
simple as that and the reason we get an
error here is because of this so inside
of the condition we basically want to
check if something isn't set that
something is the dollar underscore gets
super global and the polky that
basically means this here oh sorry we've
called this ID when we probably should
have called it let's just reflect this
whole you can leave it as ID as you want
I think Paul is a little bit more
descriptive so let's just go back to the
index and click on one of these so you
know what Paul equals one so we want to
make sure that set if it's not set all
I'm gonna do is just redirect back to
the index page there's probably better
ways to actually structure moving around
your application this is probably not
the best one but for now just because
we're learning we can you know just get
away with doing a header redirect you
may even want to display a message
saying can't find that Paul or please
specify poll ID or something like that
anyway otherwise we have this key
available this key in this this value in
this key here so we can just store that
so I'm gonna say ID equals dollar
underscore get pot like that now because
we're gonna be outputting this to the
page and we are going to be using
prepared statements and we'll talk about
them later when we actually query in
this case we may want to output the poll
ID and we're gonna actually do that down
further down the page inside of the form
so what we want to do is make sure that
this is cast to an integer and that just
involves adding this at the start of
this variable and that basically means
that no text can be included in here or
anything so we're we're so safe to
output this the page pretty much so what
we want to do now is get general poly
information so I'll just put a little
comment here get general poll
information and this involves preparing
a statement selecting specific
information that we need and then
executing that and grabbing the object
back so it's pretty much all like we've
done with a query but we're gonna be
using prepared statements so I'm gonna
call this poll query and this is gonna
be DB and this time we're going to use
the prepare method not the direct query
method and let's pull this down just for
readability so we're gonna select ID
question from polls but this time we
want to select it where the ID matches
the ID that's been supplied here so we
say we're ID equals and then we then we
give a placeholder so we use a colon and
then the name identifying the
placeholder what you might usually be
used to doing or if you've not learned
before sometimes you would just insert
the ID like this if this wasn't escaped
and if this was a query you've opened
yourself up to SQL injection which is a
little bit beyond the scope of this
video either way we're going to prepare
this statement which we've done here
remember we still need the the between
hole
starts and pole ends so we're gonna say
and date now between two end caps
between starts and ends just to make
sure that we're not trying to be no
one's trying to access a pole that
doesn't yet or hasn't yet started so
what we're gonna do now is down here
we're gonna execute that so we say Paul
query executes no need to reassign this
to a variable like we've done here the
inside of execute we create an array
depending on which PHP version you're
using by the way you might want to use
this array that I'm using a version that
supports short syntax and here we need
to specify the value for the
placeholders that we've given in the
prepared statement in this case it's
just Paul so here we're gonna say Paul
and that's going to contain the value ID
here so this is just as good as saying
ID equals 1 that's pretty much what this
is doing so now what we want to do is
store this in a variable called pole
which we can use throughout our page and
I'm gonna say Paul query and that's
going to fetch object we've already seen
this method in use on the Pala index
page so we've now got this pole
information let's actually just do a
print R on Paul like so let's go ahead
and refresh there we go what do you
think of the new website that's a pole
one let's just switch this over to pole
ID of two and there we go you get the do
you like Paul to information so we've
got this information so we now know that
we can actually output this down here so
let's do that now so we're gonna say PHP
and let's say echo Paul question like
that so let's refresh here and there we
go do you like poles and what do you
think of the new website now just a
little bit of advice or a little bit of
warning I'm not escaping anything that's
being outputted if your data in your
database is being inserted by in fact
even if it's not
you should escape on output I'm not
gonna cover that really in this video
because to escape properly is a little
bit beyond the scope of this but
whenever you're outputting anything
stored in a database and make sure you
escape it so please bear that in mind
and go ahead and research into properly
escaping with with PHP so we've got our
poll question here we've output up whole
question but what happens if a poll
doesn't actually exist
remember we're checking whether this
isn't available and we're redirecting to
index dot PHP or if it's PI D of three
well in this case what we're doing is
we're generating an error here because
we're trying to access a property that
doesn't exist from this poll variable
here so we need to create some kind of
check down here to check if that poll
actually exists or not so we'll do this
before we even start to generate this
mark up here there's no need to do that
otherwise so we're gonna open up a PHP
tag and close a PHP tag and we're gonna
say if not poll and down there we're
gonna do something and then otherwise we
want to output all of this and then down
here we want to do an end if I will just
indent this as well so if the poll
doesn't exist we're just gonna say that
pole doesn't exist like so and when we
refresh there we go so pull to work
still and pull one works excellent so
we've done that but we now want to
output the actual questions of the
choices rather sorry because we've got a
list of hollow coded choices here but
that's not really good enough so what we
want to do now is we want to get all of
our polls and we need to do this down
here we need to do a couple of checks
later on once a user has actually voted
but let's just out with the choices
first of all so down here we're gonna
say get poll choices and we need to do
another query here so we say poll
query or we could probably say choices
query that might let make a little bit
more sense so choice is query and this
is again a prepared statement because
we're going to be inserting variables
into this so we're gonna say select now
this is going to be a little bit
different because what we're going to be
doing is we're going to be joining the
choice is table the pols choices table
we can't just pull from the pols table
because this doesn't contain the choices
we need to join these on it sounds a
little bit more difficult than it
actually is but follow along and it
should make a lot of sense so what I'm
going to do is when I select now I'm
going to explicitly define the the table
name so polled thought ID so on the idea
of the poll
Paul's choices to ID as choice ID and
this basically means from the polls
choices table grab me the ID but because
ID and ID exist together we are going to
have a duplicate key here so we're going
to just call this choice ID what we also
want to select here is the name of the
choice so holes choices don't name so we
are selecting this ID here we're
selecting this ID here and this year but
MySQL has no idea where this is coming
from it doesn't know that we have a
polls choices table joined where the ID
here matches the poll field here because
remember this equals this so we need to
join that table on but first we're gonna
select that from polls but then we're
going to join on the separate table so
we're gonna do a join holes choices and
we need to say which field match which
to be able to join that data and we use
the on the keyword for that and we say
polls dot ID so the ID here matches this
whole field on the polls choices table
so positive
equals holes choices dot hole and then
we're gonna say where holes the ID
equals hole and we also again need this
so we're just copy and paste that there
but this time we need to use the and key
word because we're and and we're gonna
say holes dot starts and pulse to ends
alternatively you might want to do that
one of these checks up here and then you
know later on but I'm just gonna include
these in here anyway just for clarity so
hopefully that makes sense remember
where selects from two different tables
and we're joining them on these on the
fact that these two match and we're
doing it inner join here so we have left
joins in a joint etc so we want to
execute this will actually check if it
worked so pol query executes and inside
of here again we have our array and pol
is going to be ID much like we did oops
we've done this on the wrong page
excellent so let's move this over to
here
there we go so we know what we mean
we've got this executed again we're
inserting the ID here brilliant so let's
go ahead and just refresh here it looks
like we don't have any errors which is a
good so let's do a print our on whole
query fetch object just to see what's
come back we'll only get one result back
here and we get oops
let's do oh sorry choices query like
that
there we go so we should now get just
one choice back there we go so we get
the first choice within that table
within that choice for each one if we
need to do a loop on that we would get
all of them so what we can actually do
is extract the choices and put them into
their own array so let's do that now
so let's extract the choices and we do
another while loop much like we saw on
the index page so we assign each fetched
object to an available row and we say
pole query fetch object and then we
assign these to have an array called
choices like so so now when we do a
print our on choices and we can actually
wrap these in pre text like so then we
will find we get the following okay so
let's check that out again that needs to
be choices query I'm sure you spotted
that so there we go so we've got three
choices as we'd expect we've got the ID
which is the ID of the pole we don't
really need this to be honest we've got
the choice ID which we know and then
we've got the name of the choice so we
can now actually loop through these and
output them down here where the options
are so we're getting a little bit close
as this being complete so let's get rid
of this here
and let's go down and we'll actually
output these so we obviously need to
check if there are actually any choices
available first of all because if Iran
there's there isn't any point in
actually outputting them so what we want
to do is just above the form because
there's no point of even having a form
otherwise we want to do a little bit of
a check and we want to say if not empty
we want to check if the choices are not
empty we want to create this form
otherwise let's just indent that
we want to end if there so if there are
no choices we want to say there are no
choices right now that's probably very
rare and in the case you do launch a
poll that doesn't how many choices
attached the user would just get this
message now let's just take a look at
this
so let's maybe create a poll three that
obviously doesn't exist at the moment
let's create that inside of here so
we'll just say this is a test poll and
let's go ahead and start that now I'm
gonna end that now and just alter the
date in here okay
so that's how poll and you can see that
we don't get the form we get the message
that we just output okay so we've
covered that let's go back to poll - and
that's output these choices because we
know that these choices now exist or
these options now exist so inside of
here we've got a polls options if and we
want to get rid of these and we want to
loop on this so here we do for each
choices as choice and we oversee and our
for each just there I mean then that
okay so now things get a little bit more
complicated not too complicated remember
the value here relates to the actual
choice ID so we can just output this
here we've already seen an example of
this so choice and remember we call that
choice ID this ID here basically just
needs to be an incrementing number from
1 to however many choices there are so
in this case we just need to output the
index of this loop or this array sorry
so in this case we just say index choice
so here instead of that hard-coded 1
we can echo the index and that will just
mean that for each loop this will be one
two three four and we do the same for
this here so they basically match up the
choices so again
echo index now obviously what's left to
do is actually output the choice itself
so here remember this is choice name
like so so when we refresh now we've got
the actual choice name here but if we
inspect this you'll also see that we
have we just pull this up we've got for
each pol option C 0 because arrays are
zero indexed we've got a value of 4 4 I
love poles so that relates to I love
poles idea 4 so we know which choice to
assign to that user
we've got a value of 5 here C 1 we
should have C 2 here and the value of 6
there so this all looks like it's sort
of working together the only thing we
need to do now is replace the pole ID on
this hidden field here so let's go ahead
and do that now here we just need to
replace this with and what we can do is
we can either take it from up here which
we escaped or we could take it directly
from this choice array because we know
that for each choice or for the choices
we have this available so now just to
keep things simple I'm going to echo the
ID up here might look a little bit
confusing but there we go does the job
so if we just view the page source to
make things easy we've now got a pole up
with the idea of 2 as well as our
options that we have already seen there
we go let's switch to pole 1 just to
check it and there we go
everything looks cool so that's
basically we've outputted everything now
what we need to do in the next part is
focus on the actual ability to click on
submit answer and actually passed a
polar vote</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>