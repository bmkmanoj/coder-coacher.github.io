<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Node.js Real Time Chat: Inserting Data (Part 4/7) | Coder Coacher - Coaching Coders</title><meta content="Node.js Real Time Chat: Inserting Data (Part 4/7) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Node.js Real Time Chat: Inserting Data (Part 4/7)</b></h2><h5 class="post__date">2014-02-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GkXQEwHn2nA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we're now going to go ahead and set
up house server Jes file just to see us
connecting to our MongoDB database and
also going to obviously listen for
connections with socket IO as well so we
will need to work somewhat on index.html
just to include in the JavaScript the
socket IO JavaScript that we need so the
first thing I'm going to do is just play
around with our server so let's go ahead
and just open up our command prompt to
make sure that we've got that open and
ready so as long as we know that that's
open that's fine we can go ahead and
just run our server and we need and
we'll go ahead and just start to write
out everything we need in server J s so
the first thing to do is create a couple
of variables and this is going to be
requiring in the MongoDB
package or mod module that we created or
installed earlier using node package
manager and we're also going to then do
the same for socket IO so it's basically
a case of creating two variables that we
can refer to the first ones Mongo so
we're going to require in MongoDB it's
just basically the name of the package
so Mongo DB ok so now we want to access
Mongo client as part of that so that's
going to allow us to make a connection
to the database and dual various sorts
of things
the next is we'll just call this client
and this is going to be require socket
the IO
as we've seen we installed this earlier
and then what we're going to do
something slightly different we're going
to use the listen method and listen on a
specific port this could be absolutely
any port at all it doesn't necessarily
matter that much I'm going to listen on
port 8080 and then I'm also then going
to access sockets now what we're going
to do now is leave that as it is
and we're going to go ahead and just
connect here so basically if we just say
go back to our server JSO node server
j/s when we run this now now we can see
that socket IO is started and it's sort
of kept this connection running and it's
going to wait for clients to connect
it's going to wait for things to happen
so now we've done that we can go ahead
and actually test this out so the first
thing that I'm going to do is go over to
our index.html page and down here we're
going to go ahead and include a
JavaScript dependency so script and we
need to include a source here now rather
than install do this locally what we're
actually going to do is we're going to
include this from the server itself so
all we need to do is go ahead and supply
the server IP which is obviously
127.0.0.1 because we're working on a
local machine and then that's going to
be on port 80 so let's go ahead and do
that now so it's 127.0.0.1 on port 8080
and then that's four slash socket Daioh
forward slash socket die ojs so what
this is now doing is it's connecting to
our nodejs server and is serving the
installed socket IO file so we don't
actually need to include a local version
of it so we can go ahead and just test
that this works by refreshing and under
the network you can see oops it seems to
have failed and that is because we don't
have our node server actually running so
if I were to go ahead and run our node
server and then refresh again you can
see that that's now been loaded in so we
get an okay on that so now that we've
actually loaded in nodejs
we can go ahead and access as sorry
we've gone ahead and loaded in socket IO
we can actually go ahead and access any
of this information from our our server
and obviously that will be coming from
our database but the general gist of
things would be to create a variable and
we'll do this all within the code in a
moment and this will be ayyooo connect
and we'll go ahead and actually connect
to the server that we've supplied so we
know that that's HTTP one to seven not
dot dot one 8080 and that's obviously
return undefined but it's worked so now
what we can do is if we say socket we
can see that we've got a socket name
space here we've got a load of methods
that we can use to actually you know
check for you know data that's coming
through and stuff like that so we now
this is what we're going to use to
create the connection to our nodejs
server essentially so once that's
working well good now go ahead and sort
of create a little test just to see that
this works on the server side of things
as well so if we go ahead and just bring
up our text editor so under server j/s
what we want to do is we want to connect
to our Mongo DB database eventually
let's go ahead and create a little test
for now what we actually want to do is
we want to say something like socket dot
oh no sorry we want to actually connect
first so we want to say client dot on
client dot on remember referencing this
here so client Ami's the on method which
is going to be on connection we have a
callback here our closure which is then
going to provide us with whatever we
need to do once the client is connected
so in this case what I'm going to do is
I'm just going to provide socket in here
and that's going to give us the ability
to listen for things like different
input so we can listen for when messages
are sent and stuff like that but for now
what I'm going to do is just console.log
someone has connected so we can actually
test this out now let's go ahead and
just kill out
no Jeff server and rerun it and so we've
got no sort of problems here it says
someone's connected but let's go ahead
and just refresh this page go ahead and
back to our command prompt clear that
there so nothing's happening at the
moment but what we're going to do is
we're going to keep an eye on what
happens when we actually you know create
a connection in here so let's keep an
eye on this just by pulling this to the
side just so we can go ahead and connect
so there's our nodejs server we're
listening for connections now remember
so what we can do is you can go ahead
and do the code that we did before so
socket equals i/o your connect and then
the server so when I hit that you can
now see that this says someone is
connected so this is how we're managing
how people are actually connecting and
remember that this is slightly different
because each person that connects is
classed as a different client and we can
actually push messages specifically to
that client as connected so everyone
that connects is basically separate so
we all they
keep the separate connection to the
server so we've got that covered we know
that we can actually you know determine
whether someone's connected or not but
that's not very useful at this point
what we also want to do is wrap this in
a connection to our MongoDB database so
we say Mongo Connect let's just pull
this down for now and we'll do this and
then we'll insert this in a minute so we
want to say Mongo Connect and the
connect method will take the server and
then a callback so we're going to say
MongoDB forward slash colon forward
slash forward slash one 27.1 and then
the name of the database in this case
it's going to be checked
so we have our call back here and as
part of that we have an error or the
database sort of object so in terms of
an error we want to go ahead and check
for an error so we just say if error
throw error basically that's all that so
that will just handle any errors and we
can see that in a moment
so once we've actually connected to our
database then we want to start listening
for connections so every time a client
connects MongoDB would have already
connected and then we listen for
connections here so this is where we do
our console log earlier this is where we
listening for connections so let's go
ahead and just test this out again just
to see what would have what will happen
here when we run this you'll see we will
get actually get and we got MongoDB
running yeah we have let's cancel that
and we'll close that and then run this
again so what's going to happen here is
yeah there we go so we've got an error
here so it's throwing this error and
failed to connect to 107 or not to 1 and
then the port number of MongoDB so this
has failed so as long as we have
actually got our Mongo daemon running
this will work and we can listen for
connections and then start to do things
so what we're now going to do is
actually test sending data from our
index dot HTML page to our server so
we're actually going to listen for input
so let's go ahead and just comment this
out so we'll say wait for input and this
is just for testing really but we are
going to eventually integrate this into
about input when a user actually sends
data to us so we're going to say socket
dot on now this is going to allow us to
basically define what name that we give
this incoming connection if you like
this incoming data that's been sent so
I'm going to call this input this is the
name of my choice this can be whatever
you want and the callback is going to
contain the data that actually gets sent
so if I do a console log on data we can
go ahead and monitor how this works so
let's go ahead and restart our node
server so that's all working let's head
back over to our browser and let's go
ahead and just reset this so we've now
connected you can see things are going
on here sorry now we're connected what
we can now do is we can actually push a
message to the node.js server so we're
going to go ahead and use the emit
method so I'm going to say socket dot
emit and what this is going to me to do
is Amit Amit input and then I can go
ahead and pass whatever I want into this
so I'm going to pass an having just a
part an object I'm going to say name
Alex and message hello now remember this
looks a bit like what we did earlier
with our MongoDB database and this is
what makes things perfect what we can
actually do is put this straight into
our database if we wanted to so
eventually we're going to be taking this
input that's sent and pushing it into
our database when I hit enter here and
that's basically sent that and you can
see we've now got named Alex message
hello so we've sent the data from our
client to our node.js server so we now
know that within our server J's far
we've got a sort of waiting for input
ready to actually build into our you
know proper application so now that
we've done that we may as well go ahead
and actually create the functionality to
insert this into our MongoDB database so
all sort of wrap this up with actually
validating this data and then going
ahead and actually
putting this into our database so we can
actually see this now transferred over
to our database so once we've got some
input what do we want to do well we want
to go ahead and actually grab the data
that we have from this data object here
let's go ahead and create some variables
so the first one's going to be name and
that's going to be data dot name so
remember we're passing a JSON object or
an object in which is then going to
allow us to grab name from data and we
also have message as well that's data
dot message so what we can now do is we
can go ahead and insert this in so let's
come up here a little bit so what we do
is once we've connected to our database
we want to go ahead and actually obtain
the color the collection and we already
have so what we're going to do is inside
of here we're just going to create a
variable called Col and that's going to
be the database collection and that's DB
dots or using this DB here DB dot
collection and then we define the name
of the collection we know that's
messages so remember earlier when we
looked at the MongoDB server we created
a collection called messages and we were
just playing around with inserting some
data in so to insert this it's very
straightforward we just say call dot
insert and then we can go ahead and
actually define what we want to insert
so I'm just going to say name name
message message and that's fairly
straightforward and what we then have is
a call back as well and we can check for
an error as well we don't really
necessarily have to do this but I'm just
going to consult log inserted so we're
going to now test that that work so what
we need to have open is or get you to
restart our nodejs server also going to
need open our browser and we're also
going to need open our database as well
so at the moment you can see oops we
need to go ahead and start this there we
go so sorry that that either happened
okay so we've got nothing in this
messages collection at the moment
we can go ahead and get rid of this so
what we now would do is we can go ahead
and omit this that says inserted so
remember we console logged inserted now
when I do DB doc messages found that's
now put that inside of the database so
we've got a name and a message now
stored perfect so we've actually done
what we need to do we've connected to
our nodejs server we've then connected
to MongoDB and we've then inserted that
data so the last thing to do is just a
little bit of validation well you know
talk before we forget and we're going to
use a regular expression basically just
to check that there is no white space
here so now you know that dummy data can
be inserted so I'm just going to create
a whitespace pattern here and you don't
need to do this if you're not worried
about people's names being blank or the
messages being blank but you know you
probably are so we're going to create a
regular expression here and we're
basically just going to check for spaces
and blah blah blah blah and or
whitespace within what we're testing and
what we're going to do here is we're
going to say if something else something
else in here is going to be the test so
we're going to test this so we say
whitespace pattern test and we want to
test name or white space pattern test
message so if any of them test true that
basically means that we then have you
know we don't want to insert the data so
we're going to console.log incorrect or
something like that or invalid that
makes a little bit more sense eventually
what we know is push this status to the
client to then go ahead and and show it
in our little status area and but
otherwise what we want to do is then go
ahead and insert our message so there we
are perfect so let's go ahead and just
test this out we've created our
whitespace pattern we've created our
tests for these and let's go ahead and
just check this actually works so it's
open this and there so that works that
inserts it but if for example the
message is blank it says I inserted it
of course we didn't restyle server
would help a lot so I'm going to go
ahead and do that and it says invalid so
we know that that's an invalid message
because it's empty
and the same with name as well if that
was empty we would also get an invalid
message but if we fill them both in we
get inserted and then we can just cross
back over to our database and we can see
that these messages have been inserted
ignoring this one here let's go ahead
and just remove them for now we don't
really need them okay so now that we've
done the validation that's it we have
you know done everything we need to do
there's still a little bit more work to
do on here and there's a lot of work to
do on our actual index to HTML file as
well in terms of actually you know
handling messages that come back so we
can actually use our chat so in the next
video we're going to hook up the text
area to allow us to actually enter a
message within our chat line and send it
to our nodejs server using socket IO and
this won't appear in our sort of chat
area but what we will achieve is a bit
more of you know functionality we don't
have to use the console within our
browser to actually send messages as
we're going to hook this up with the
functionality in here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>