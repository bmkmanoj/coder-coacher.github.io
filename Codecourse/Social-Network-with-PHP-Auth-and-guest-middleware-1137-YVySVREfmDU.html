<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Social Network with PHP: Auth and guest middleware (11/37) | Coder Coacher - Coaching Coders</title><meta content="Social Network with PHP: Auth and guest middleware (11/37) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Social Network with PHP: Auth and guest middleware (11/37)</b></h2><h5 class="post__date">2015-08-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YVySVREfmDU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">later when we create protected routes
that we only went one authenticated
users to access we're going to be
implementing the authenticate middleware
so this will redirect any users that
aren't signed in so for things like
liking someone's post or updating your
profile you don't people to access this
if they're not signed in but at the
moment we have a problem I'm currently
signed in but I can still access pages
like sign up and sign in so this isn't a
massive issue but it's nice to not allow
people to access this if they're signed
in because really they don't need to so
let's take a look at the route
middleware that we have this is under
app HTTP and middleware
and we'll take a look at the
authenticate one first so this
middleware will basically check if your
User is a guest
if they are we have an AJAX handler here
which will return a response with a 401
status code and otherwise it will
redirect the user to guest or login now
we need to modify this because later on
we're going to be doing this a little
bit differently so what we're gonna do
is we're gonna remove this I'm gonna say
auth dot sign-in that's important then
we change that now because when we come
to use it later
we need to redirect at the right place
now we also have redirect if
authenticated so what this will do is if
the user is authenticated we can choose
what to do with them so if we open up
our routes far here for sign up for our
get request for our post and the same
for the sign-in we want to make sure
that the user is actually a guest
because we don't them to access if they
are signed in so I'm going to do this in
a very verbose way you can create route
groups but I'll let you decide how you
want to organize these based on how this
application grows for you in this case
we specify middleware here this isn't a
rake so we can have multiple middleware
and in here I'm gonna say guest now
where's this guest value coming from
because over in here I can't see
anywhere where it actually says guest
apart from obviously
you know in here obviously this guest
method so how these being named we have
this kernel file here which contains our
middleware and it also contains our
route to middleware so we have earth
earth basic which we're not going to be
using and we have guests and you can see
that these point to redirect if
authenticated and authenticate so this
is how we named that in our route so if
we go ahead and just copy this and paste
it here as well we don't be a we don't
to be able to access the post route as
well and we go over to sign up that's
gonna redirect us off to home now
obviously that doesn't exist so we need
to update that so over in redirect if
authenticated let's say redirect to
route home so now when we go to signup
that redirects are straight off home and
we can just carry on as normal so the
last thing to do then now that we've
understood how that works is just copy
this and paste it for sign in as well so
we know that we can't access that and to
sign out technically you need to be
authenticated but I'm not gonna add it
to this it doesn't really make sense
so we'll just double check our sign in
route there we go we're redirected off
so that's just a little look at the
middleware that we have we have
authenticate which hopefully understand
now we're redirecting the users to the
right place if they are not
authenticated and we can use the guest
method that just allows us to perform
specific actions afterwards but you can
go ahead and say redirect route if you
really want to and we have seen redirect
if authenticated which is essentially a
guest room and we know where these are
kept as well if you want to add any more
to your route middleware so that's it
we've now protected against that when we
signed out we can go ahead and sign up
and sign in as usual</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>