<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Laravel Subscription with Card Payments (11/11) | Coder Coacher - Coaching Coders</title><meta content="Laravel Subscription with Card Payments (11/11) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Laravel Subscription with Card Payments (11/11)</b></h2><h5 class="post__date">2014-07-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ytXxyW8fIps" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now when I look at protecting pages
for subscribed users and we're also
going to look at creating another filter
for those who are on the big plan rather
than those that are just on the small
plan so I'm gonna create a new group
down here because we want to separate
this from the subscribed group here we
don't want to include this because
that's under the subscription prefix it
down here we're gonna create an entirely
new group and before this we want to
check that the user is successfully
subscribed so if that's the case we have
let's say a protected page here and in
this case I'm just gonna add just some
city information here and we're just
gonna say echo subscribed only and we
can create another one here called big
and we'll just say big only and we can
even go as far as creating a new group
here before this we want the user to be
on the big plan so what we can now do is
put this inside of here and there we go
so just to recap we have an entirely new
group here because we want to keep it
away from the subscription prefix these
could be areas that are just you know
premium content things like that so we
have a route here which is protected
which is for subscribed users only we've
got a area where you need to be on the
big plan but we don't have this filter
set up so under filters let's create
this now and it's just copy and paste
this so we're gonna call this plan big
and we're gonna say if orth check and we
want to say if the user is not on a
specific plan and we can use the on plan
method provided up to us by laravel
cashier to do this so we say on plan and
then we choose the plan in this case I'm
just gonna say big so now if that's not
the case we're gonna return to what we
can return to the subscription I guess
and we're gonna say we've noticed you
need to be on the big plan to access
that so let's take a look at this make
sure we've not done anything wrong
so I'm gonna say public protected and
there we go that's for subscribed users
only now I'm gonna try and access big
remember I'm on the little plan so
that's taken me back to there to say you
need to be on the big plan so what I'm
gonna do now is I'm just gonna head over
to my database and I'm just gonna get
rid of all this information some of the
search stripe active 2-0 I'm gonna get
rid of that and I'm gonna get rid of
that so almost like we're starting out
afresh so under here now I will not be
subscribed so I'm gonna go ahead and I'm
gonna join and I'm gonna choose - 44 -
maybe and I'm going to sign up to the
large plan in fact just before this
let's try and access protect it and
you'll see there we go you need to be
subscribed to do that so we're not
subscribed at the moment we can't access
that protected area now I'm going to
sign up for the large plan there we go
so we're now subscribed we can check
that just under here there we go on the
large plan and we'll need to modify this
to large this to large as well just my
mistake and this to large as well like
so I will just call this large and I'll
call this large okay so let's now check
for that works so we're gonna say public
large and then we go we now have access
to that because we are on the large plan
brilliant now we do have a slight
problem here because if for example we
would just sign out and access the large
plan again all the
again you'll see that we've got a
problem
so let's do an auth logout and we'll see
what happens here and there we go so
although if we were to return to the
subscription page we get an error
because obviously we're not not
subscribed and we're trying to call this
on a non object you'd have to go ahead
and do the work to check if the user was
logged in before this so we haven't
actually covered that but it's pretty
self-explanatory we've got a problem
because the user can access protected
areas and particularly areas where you
have to pay for the larger option so how
can we actually combat this well under
our routes what we can actually do is we
can go ahead and modify this to say
before we do any of this we want to be
signed in and we have filters for this
already so you can see that we've got
earth just here so if I was to add the
auth filter just into here you can see
that when we're trying to access this we
need to be signed in as well so let's
just test this out we go ahead and
change this back to signing us in and
we'll choose the large option here and
because we're already on the large plan
we get access to this and we also get
access to the normal protected area and
of course the authentication protection
doesn't just stop there you are going to
need to protect all of this as well
because obviously a user can't purchase
a subscription if they're not already
signed in so you could either wrap this
in an entire group just using earth or
in this case you could simply just add
this to the prefix subscription so we
could say here before Earth and that
would protect all of this as well so now
a user can has to be signed in before
they even access this subscription page
so you could think of this subscription
page as some kind of account area where
only signed in users can visit I guess
it's up to you to define how this works
for your application but just be careful
you don't fall into any other traps of
not defining this and mess things up so
as well as allowing us to sign in now
we've also given the ability to access
specific areas depending
on what plan we've chosen</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>