<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 18): Forgotten Username (Part 2) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 18): Forgotten Username (Part 2) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 18): Forgotten Username (Part 2)</b></h2><h5 class="post__date">2012-05-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7t0Atslop5w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we're back and we're going to create
this recover function that I mentioned a
moment ago or in the last part of the
video so we need to pass through two
parameters the first one's going to be
the married the second email so we know
that the mode exists within the get
space here and we also need to pass
through the post the email address okay
so we're taking the mode I'm actually
you know passing this absolute value
through all this value that we've
clicked that we're using in the URL bar
so this will be equal to username and
this might be equal to say Alex and PHP
academy' dog
so once we've completed the recovery
process we want to redirect the user to
this page we're going to have a success
message there and then I just exit so
let's comment this out and quickly
create this success message because this
is the boring part you know it's one of
them one of them things that we have to
do so up here I'm gonna say if something
if this is equal to true do this
otherwise and I want to do all of this
otherwise all the way down to here so
now I'm gonna just select all of this
and indent that there okay
so if basically here we could just going
to detect whether this success thing is
on the end so if is set dollar
underscore get success if that's equal
to true and this value is empty
so if that's equal to false then I'm
just going to escape out of PHP back in
and here I'm gonna say it in a paragraph
tag thanks we've emailed you okay so
obviously feel free to make this a lot a
lot nicer so now let's go ahead and like
typing a little rubbish and click
recover and we get our error message
let's go ahead and type a sensible email
address that we know exists click
recover and we're back to index dot PHP
for some reason so let's check why this
might be oh there we go and that needs
to be true sorry so making sure it is
empty so let's start that again username
type in Alex of PHP academy' to org
click on recover and thanks we've
emailed you so everything's working the
only thing we are not actually doing is
actually emailing the user using this
recover function I've commented out here
so let's uncomment that and let's go
ahead and open up our users dot PHP
function file now the very top let's
start to actually create this function
so I'm gonna create a function called
recover we've just seen there the first
thing we're taking is the mode the
second is the email so we're defining
which parameters that we passed this so
we're going to just sanitize this data
because we know that is coming from user
input in the mode isn't well the mode
isn't but we'll sanitize it just for
good practice and the email address
obviously is coming from direct using
but we're not validating against
anything particularly so we'll just
sanitize it anyway also if this
functions ever used anywhere else then
it's obviously good practice to sanitize
so we're sanitizing the mode there using
the sanitize function that we've already
created and the same of the email as
well as I said so sanitize
email okay that's it that's out of the
way now what we want to do now is we
want to grab the user data for this
particular user by their email address
and we need to call the user data
function which we also have in this file
and that will return as many fields from
this user as we like so we're just sort
of collecting data about this user where
their email address is Alex at PHP
academy' dog or whatever they've entered
so we actually need a new function here
and we needed to create a function that
grabs the user ID from the users email
now doing all of this and calling all
these different functions isn't probably
the best way to do things because we
could have sort of one big collective
function or we could actually modify the
user data function that we created let
me just find it here we could modify
this C at the moment it takes a user ID
but we don't have a user ID because we
only have their email address so we need
a function to convert their email or
grab their user ID from their email we
could modify this user data function to
take an email address as well
or instead of a user ID but we're not
going to do that we're going to do it
the long way around just for learning
purposes but maybe make that a challenge
go ahead and modify this to take an
email address or a user ID okay so we've
got our recover function what do we need
to do create this user ID from email
function now we already if we scroll
down have a user ID from user name
function so an add your fact I'm just
gonna be lazy and copy and paste this
down and I'm gonna change this to from
email what I'm giving the function is an
email I'm sanitizing the email so we're
just basically modifying the data it
throws out and the data it takes in so
the query is select the user ID from
users that's fine where username equals
username well that's not because now
we're passing through an email so where
the email is equal to email and we're
throwing out the user ID which is good
so we now have this function that we've
essentially copied been lazy and we can
use this up here
to grab this particular data to user
data is equal to use a data function
which we'll just have a look at now
usually a user ID would go here
but we don't have that so we need to we
need to you know use this function that
we've just created so I'm going to call
this function within this function it's
a user ID from email the email we
obviously know and the fields that we
want to get come after so I'm going to
grab the first name just so I can
address the user in the email that we're
sending to them and obviously we need to
grab their user name because that's what
we are giving the user in this recovery
process okay so now we need to determine
a mode that has been passed through to
this function and that's relatively easy
just with an if statement so we can just
say if something otherwise if something
else do this so the first thing to check
is obviously if the mode is equal to
username recover username otherwise if
the mode is equal to password recover
password simple we've got the user data
here we can go ahead and even modify
this to you know I don't know we
couldn't obviously can bring the
password in there but anyway we're gonna
fix them the username one here so what
do we want to do well all we really want
to do is send an email to the user we
have an email function that we created
earlier in the series and this just
makes it easier and and avoids us having
to add headers to every mail function
that we call PHP is built-in mail
function so the email address that we're
sending to is email the subject is going
to be your username and the body is
going to be slightly trickier and not
that much trickier so I'm going to say
hello X which will be the first name
I'll go a couple of lines down and I'll
say your and use the name is and then
I'll give them their username and a
couple of lines down and then I'll just
sign it off so I'll just say PHP
academy' for
so we need to replace these variables
here so what I'm gonna do is I'm just
going to escape out of this string and
I'm going to concatenate on user data
which remember is this here and this
user data function returns an array and
we just line these up a bit so we want
to grab the first name oops
the first name to address the user hello
seven so so your username is again we'll
go ahead and just escape out here and
this time we are giving them their user
name so use the data user name perfect
that's it that's all we need to do to
recover a user's email address at sorry
user name from their email address so
let's go ahead and test this out I have
got a my email address hit open which is
Billy at PHP academy' de org it's got
the to activate account emails that we
used from earlier but this time I'm
going to go ahead and I'm going to
recover this user's username so I'm
gonna type in Billy a PHP academy' de
org click on recover wait a couple of
seconds just while the the email goes
through and it says thanks we've emailed
you perfect let's go check our email
click on inbox and we should have an
email through with your username which
is the subject that we gave it let's
just double click on that and there we
go so the email address now says hello
Billy which we've extracted from our
database using the email converted to a
user ID passed through to our user data
function and it gives us the username as
well and it's essentially as we expected
it to perform so that is how to recover
the users user name by their email
address
in the next part of the chunk of this
series we're going to look at recovering
the user's password</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>