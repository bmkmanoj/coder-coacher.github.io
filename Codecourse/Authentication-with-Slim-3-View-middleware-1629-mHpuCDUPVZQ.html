<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Authentication with Slim 3: View middleware (16/29) | Coder Coacher - Coaching Coders</title><meta content="Authentication with Slim 3: View middleware (16/29) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Authentication with Slim 3: View middleware (16/29)</b></h2><h5 class="post__date">2016-04-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/mHpuCDUPVZQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the traditional way that we would use
this package that we've installed is to
take the name key the value key the name
and the value and pass it through to a
view or render the HTML here or whatever
we're doing now we're not doing that we
have a slightly more advanced setup and
also this method takes a lot more code a
lot more duplication and we really want
to try and avoid that so we're not going
to be doing that instead we'll create
some middleware to set this all up for
us so let's head over to our middleware
section and we can call this something
like cross-site request forgery view
middleware so CSRF view middleware so
again we can just copy it over from here
and just change the names up just to
make this a little bit simpler so
cross-site request forgery view
middleware we can get rid of this
because we don't need it we can go ahead
and add this middleware to our app so
let's go down and we're done so let's
just refresh to make sure we didn't
break anything and it looks good so what
do we want to do in here well again we
want to share with our view a name and a
value but what we also want to do more
conveniently is share a prebuilt field
that we can use so if we just head over
to our signup form the way that this
would look is down here we would have a
hidden input now the name would be
cross-site request forgery name that's
the method we used earlier and this
would have a value what we would also
have is a cross-site request forgery
token and then this would have in here
the actual value so we don't have to
keep writing this out every single time
so we're gonna build this up so we can
eventually do something like this
cross-site request forgery raw or
cross-site request forgery filled raw
whatever we want to do so let's do this
now over in our middleware what do we
need to do when we need to save this
container view get environment
add global and in here we want an array
so we're gonna call this cross-site
request forgery and we're gonna pass an
array in now you can pass the name and
the value and both tokens if you want to
but I'm just gonna send through a field
here just make sense and this is just
going to be a string so I'm gonna pull
this down this gets a little bit messy
but it doesn't matter too much so in
here we're gonna create out two inputs
these are hidden inputs we have a name
for these inputs and we have a value for
these inputs so let's duplicate this
down so the first one we need to use the
get token key or get token name key
method that we saw earlier so all we're
going to do is just append this onto
here and we get this from our container
so remember we have our container on our
base middle where we have the cross-site
request forgery package attached to our
container so we can now use get token
name key and if you're wondering about
this cross-site request forgery package
remember it's called guard you can go
over to cross-site request forgery
source guard and you can see these
methods so get token name get token
value get token name key and value key
these are just convenient methods so you
can pull them out of here so now that
we've got this we now need the actual
value for the name so remember this is
either cross-site request forgery name
or cross-site request forgery token so
here all we do is say this container
cross-site request forgery get token
name and we're gonna do the same for the
value as well so again we just pull this
in this container cross-site request
forgery and this one is get token value
key and obviously we need the value so
it's this container again cross-site
request forgery and it's get token value
so now that we have this passed through
to our views what we can now do is use
cross-site request forgery
filled with in our form and we'll see
both them inputs and that means that
whichever form that we create because
remember all of our post routes are now
protected so we can't submit them unless
we have these values in here
so this is really handy because now we
can just say cross-site request forgery
field and we need raw because otherwise
we will actually see this markup so we
can test this out so there you can see
we've got an input type of hidden
cross-site request forgery name and this
is the name of the like key essentially
if you want to call it that and then we
have the actual value which is the hash
and submitting these through the form
will then work so all we need to do is
use the raw filter within twig when we
refresh they are now part of our input
so we can just make sure that they are
in there you can see that they're in
there now and now when we submit our
form it works obviously our validation
rules have come through but we now have
cross-site request forgery set up and
ready to go
so whenever we create a new form we
don't have to do anything else all we
need to do is use this just here and
everything will be nice and protected
against cross-site request forgery
attacks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>