<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP OOP Login/Register System: Changing Password (Part 21/23) | Coder Coacher - Coaching Coders</title><meta content="PHP OOP Login/Register System: Changing Password (Part 21/23) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP OOP Login/Register System: Changing Password (Part 21/23)</b></h2><h5 class="post__date">2013-11-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nhAIU-p8Tk4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">we're now going to give the ability to
update or change a password now this is
more or less identical to the ability to
update profile information because
essentially all we're really doing is
updating fields where the user IDs ID is
concerned so it doesn't really differ
that much to updating profile
information the obvious or the only
obvious difference is that we need to
check the existing password matches and
also that the two new passwords are the
same so what we're going to do is we're
going to create a form here down here
for the sake of the of the tutorial I'm
just going to paste in the data that we
need because what's you know the point
here is that we we get this form created
and I'm not going to go ahead and type
it all out again we've already seen how
these form fields are set up we've got a
method of post divs for each field and
then labeling an input and if you just
pay particular attention to the name of
the field that's that's what we're going
to be working with we're obviously
working with generating a token and we
have a field or a form basically to
update so and we're going to add a
little link to our index.php file just
do the ability to change a password
let's go ahead and do that so over on
index dot PHP let's just create a new
link here to say change password let's
change password dot PHP that we
currently work in here so let's just
preview this change password page it
looks like that
very straightforward again the field
names are consistent and we already know
what we're doing on that side of things
so what we need to do now is all the
standard stuff so we want to include
core in it we want to instantiate a new
user object so we can take advantage of
that functionality we want the user to
be logged in so we want to say if not
user
is logged in redirect to index dot PHP
okay so now we want to check if the
input actually exists and then we want
to check the token as well to make sure
this isn't the result of cross-site
request forgery so I want to check the
token that's been supplied by the form
which we can get with the get method in
deck the token
yep that's fine so that's the token
there that we submit into the token
check so if that all goes okay let's
just output okay so we know we're know
that that's works just a reading really
further so click change yet that's
worked so what do we need to do well the
steps here are validate the the current
password and the password you in the
password new again to make sure that
they're all required and that the
password new again matches the password
new and if that's the case what we then
want to do is we want to make a hash
from the current password and the salt
of the user and compare it against the
current password just to make sure that
they both match so if the users password
is is the is exists as their actual
password then we can go ahead and let
them go and change their change their
password we generate a new salt as well
which is a little bit exciting so we're
going to generate a new salt every time
they update their updated password so
what do we want to do well we want a new
validator validate object so we want to
say validation is sorry validate check
or to check post data and again we're
going to provide a list of the field -
through a password current password new
and password you again so password
current
we've got password new and password new
again so inside of here
password current what we need to check
well this is absolutely required in fact
all of these fields are required so
we'll set this to true and we want the
minimum to be six now I guess this isn't
really required because you know we're
not setting a new password it's more
important in the password new but you
know either way we'll we'll add that in
anyway required so on the required to be
true on the new password obviously and
we want that to be a minimum of six as
we defined when the user signed up the
password new again is going to be
exactly the same as this so we'll just
copy and paste that but additionally we
want that to match password new so we
want password new and password new again
to match so if the validation passes we
want to do a change of password
otherwise we want to basically loop
through the errors that we already have
so what we get returned
so for each validation errors as error
remember that's a method you want to
echo the error and just append a break
so let's go ahead and just roughly test
this
let's click change validating passes
okay
validation passed my mistake
there we go okay so the current password
I'm gonna set to password and click
Change Password news required password
I'm going to change it to just changed
can't see what I'm typing and I click
change that works password let's have a
load of rubbish in here and load a
little rubbish in here
click Change Password new must match
password new again okay so we've
successfully validated it now how do we
change our password well we already have
the update method on the past on the on
the user object so if we're going user
class we can already update data so
that's not a problem we can use that to
update and update a password but we want
to first of all check if the users
password matches their current password
so it's a simple if statement what we
want to do is want to make a hash and
this hash is going to be made from the
password current the current password
and we want to append on a let see where
are we we want to append on the current
salt of the user because we require that
to efficiently detect like we do when we
login if the user if well that will be
that the hash will be the the password
that the user entered plus their salt
if that doesn't equal user data password
then the password is wrong so we want to
say echo your current password is wrong
now otherwise this is a success
so we're let's go ahead and echo out
okay so let's go ahead and type in an
incorrect initial password in fact let's
type here correct initial password and
two new passwords okay now if I was to
type an incorrect password and something
else and two new passwords and I click
change it says your current password
wrong so we know this works now now to
update the password it's as literally as
simple as just doing a user update the
first thing we want to do though is
generate a new salt so we just do hash
salt as we did when we when we register
the user and that we are 32 lengths salt
then we want to say user update and we
want to obviously pass a array of things
we want to update we want to update the
password and we also want to update the
salt as well so the password will be
input get password new but we want to
make a hash out of this so we want to
say hash make and then we also want to
supply the salt now we also want to
store the salt and that will be just
salt perfect so what we can now do is
flash the session to home your password
has been changed and we want to redirect
to index dot PHP and that's it nothing
new we've we've used all this
functionality before we built this up
from scratch we know what classes we
have we know the helpers we have so it
doesn't you know we're not doing
anything new it's not it's not fantastic
new functionality so I'm going to change
my password here and click change your
password has been changed and you could
log a user out at this point but now
when I go ahead and login
in actual fact let's take a look at this
you'll notice that this will have
changed so keep an eye on this row here
in this salt and you'll see that they
both change now so you can see that my
password has been changed even if the
user enters the same password so even if
I supply password as my old password and
password as my new password the hash in
the stop the salt will still change
because what you're doing is you're
changing the salt which is randomly
generated 32 character and
a value and that's being applied to you
the same plain text password effectively
with a new salt so using the existing
functionality that we have we've updated
the user's password using the update
method generated new salt used
everything we've already used and user
can now update their password</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>