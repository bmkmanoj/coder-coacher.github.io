<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>AJAX Polling: Checking A State | Coder Coacher - Coaching Coders</title><meta content="AJAX Polling: Checking A State - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>AJAX Polling: Checking A State</b></h2><h5 class="post__date">2014-03-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eCQuGc0PlBs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we are going to look at
polling a file using Ajax to check for a
state and then when it gets to a
particular state we're going to stop
pulling so we're basically doing
something efficiently in this case I've
chosen to go with an example at game
state upcoming so perhaps this is some
kind of game sport game whatever but the
point is that we've got a true or false
value determining whether something is
happening or not or some another
so essentially what's happening is you
can see here my networks have I'm
pulling over and over again we've got 29
requests so far every two seconds we're
polling to this JSON file here so what's
happening is we're polling to this file
and at the moment live is false so it's
saying upcoming as soon as I change this
to true and save the file you can see
that the game state changes to live and
the polling stop so that this is no
longer polling anymore if it continued
to Paul it would be a little bit
pointless because once something has
changed to a state where you know you
don't need to continue to pull anymore
there's no need to carry and polling it
will cause server
you know it'll cause unnecessary load to
the server etc etc so what we're going
to do is we're gonna build a little
script that allows us to Ajax to this
JSON file retrieve this state and if it
says is true we're gonna stop polling so
let's go over and start looking at our
code so at the moment we just have a
basic document markup there's nothing
here at the moment let's go ahead and
look at what we want to actually appear
on the page so I'm just gonna say game
state and this could either be upcoming
or it could be live or whatever so I'm
gonna assume that I want it to be
upcoming initially well at least if the
game JSON file represents that and if
you'd be just set this to false and then
I want this to change so I don't want to
have to enter anything in here because
I'm not sure of the state of it at the
moment we can't add markup for this so
I'm going to go ahead and create a span
with a class of game state so what we
can then do
go ahead and modify this based on what
is displayed in the JSON file so we're
going to be going ahead and using jQuery
for this because jQuery provides really
good JSON polling or JSON hitting
functionality so we can go ahead and use
the Ajax method and hit that but what
I'm gonna do now is I'm gonna go ahead
and just grab jQuery from Google hosted
libraries and this is essentially just a
CDN server jiin from Google so it's
extremely quick and if we just pop that
in there change this to http cuz I'm
working locally ordinarily double
forward slash would be for a secure and
non-secure HTTP connection so I'm gonna
go ahead and just write this code on
this page you would probably go ahead
and do this an external file somewhere
you wouldn't necessarily do it on this
page but we'll do it just for the sake
of the video so the first thing we want
to do is create a function and all this
to execute as soon as I hit the page and
let's go ahead and just console look
something out so test just to make sure
that works so if we go ahead and refresh
you can see that we get tests in the
console here so we're going to be using
the console to go ahead and monitor this
as we go along so what do I want to do
well I need to build an interval so we
want this to poll every say to 2000
milliseconds so every two seconds but
then what we want to do is we want to
check the JSON file so we need to hit
the actual file grab the state and then
apply the state so let's go ahead and
create this game state variable first of
all what this is going to do is it's
going to hold the selector for this
element here and that will mean that we
can just quickly reference it and go
ahead and change the value inside of it
so game state now we can comma separate
down and indent for new variables we
don't need to declare var every time so
I'm going to create a function called
Paul and then down here I'm going to
create a function called Paul interval
now the polar interval is going to be
the set interval function in JavaScript
and I'm going to go ahead and
function within here and then define how
long I want this to pop out or how often
I want this to pole so let's just go
ahead and console log out polling and
what this is going to do is basically
just console.log every two seconds the
text polling down here you can see that
the number within the blue circle
represent how many times this particular
string has been log to the console so we
obviously don't want to do that what we
want to do is we want to call the poll
function here now the reason that was
separate now is these actor functions
and this into a variable name is so that
we can actually clear the interval so
what I want to happen now is within Paul
I want to go ahead and console.log Paul
now what's going to happen here is when
i refresh the page you see that we get a
two-second delay and then we see the
word Paul down here now I don't want
that to happen I want to initially run
this poll function because remember this
function is going to include the Ajax
functionality so down here underneath
all my variable declarations I'm going
to go ahead and run the poll function so
this is going to console.log Paul
immediately keep an eye on down here
refresh pol immediately and then every
two seconds it'll subsequently go ahead
and output Paul so Paul at the moment
just console.log something but we want
to go ahead and replace this with this
without Ajax functionality this is
extremely easy with jQuery if you've
never worked with jQuery or if you've
never Ajax or anything your life don't
worry too much
jQuery is just a JavaScript library that
helps us do things really quickly and
Ajax seeing is just hitting a file
without having to refresh the page it's
just sending an HTTP request to that
file and it gives us the data back so to
actually Ajax we're gonna use dollar
Ajax this is basically the ajax method
or function if you like from the jQuery
library which is represented by a dollar
we could do jQuery like that but dollars
shorter and in here we supply an object
with a few properties and a few values
so in here I'm going to say URL is game
JSON so if we look at our directory
structure we've got index two HTML is
what we're working with now and we've
got game JSON which is our Joe
some fire here so we're Ajax into that
file and this alone will actually work
if we go ahead and just refresh you can
see that we already Ajax into this every
two seconds now you see the keeping an
eye on this request countdown here every
two seconds we're hitting this file if I
just click on one of these you can see
that under preview we get the actual
object here with the properties and the
value so we're sort of 90% there already
we just need to figure out how we need
to work with this data we get back but
what I'm gonna do now is go ahead and
define a few things that we don't need
to do but it kind of helps looking at
this exactly what you need to do so data
type JSON just basically says to this
this method I'm expecting JSON as a data
type being returned
this is JSON jace JavaScript object
notation it's literally just an object
with the property and a value can be
more complicated than this but can be
just as simple as this but you could be
hitting say XML or any other sort of
data type including you know text or
HTML so what I'm gonna do now is also to
find the type of request so if we look
under our network tab you can see that
under the headers you can see the
request method is get so we didn't need
to define this but it's a good idea to
just define it anyway just so perhaps
when another developer comes along they
can see exactly what's going on here so
now what I have is this is a success
callback and what's going to happen is
this is going to be run whenever this
this sort of Ajax request is successful
so in here this is where we want to go
ahead and grab the data and data as an
argument if we just console dot log data
represents basically our object and you
can see that we'll just be console oft
logged every two seconds obviously we
don't go ahead and do that but we do
want to do is access the live property
so the initial thing that we want to do
is set the game state to upcoming
because we want to automatically assume
it's upcoming so in here I'm gonna say
game state to remember we created the
selector up here so this has methods
attached to it like dot txt which lay 10
to text in here and change the value but
what we want to do is go ahead and just
say upcoming okay so now what's going to
happen is instead of this just being
blank it's can automatically show up
coming so we've set the text of if we
just inspect the element that we've set
the text of this to upcoming what we now
want to go ahead and do is create an if
statement here and go ahead and say if
data dot live so that will basically be
true or false and then we want to go
ahead and set the game state to live so
game state text live so we're like 98%
there if I go ahead and over to my
networks having refresh let's just take
a look at this so it's polling game dot
JSON it's still says upcoming let's go
over to our game dot JSON file move this
down here and change this to true and
see what happens when I save it that now
says live what we're not doing however
is stopping the polling when this
changes to true because we don't need to
pull anymore because the game states
live or whatever you're trying to do
with this functionality so let's go
ahead and just return this back to false
and I'll go ahead and refresh so back to
the original state it's gonna it's going
to carry on polling every two two
seconds but now what I want to do is
within here I want to go ahead and clear
interval and then the interval name in
this case the set interval function has
been stored in this poll interval
variable here so we go ahead and type in
pollen Turville and what that will do is
when the game state changes to live it
will change the text as we've already
seen and it will go ahead and clear the
interval so let's head over to here and
test this out and we'll go ahead and
open the game dot JSON file as well so
this is polling we've got five requests
six requests keep an eye on this number
I'm gonna go ahead and change this to
true save that out the state changes up
here is you can already see but we're
stuck now a nine requests no more
polling is taking place and no more Ajax
requests to this file are taking place
now that the games
is set to live so this could apply to
any functionality at all that you're
building it doesn't matter what you're
doing but at least now we know how to
poll a specific particular file in this
case it's a JSON file and then we go
ahead and stop the polling once we see
the result that we need</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>