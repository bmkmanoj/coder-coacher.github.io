<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Multiple File AJAX Upload: Uploading (Part 7/10) | Coder Coacher - Coaching Coders</title><meta content="Multiple File AJAX Upload: Uploading (Part 7/10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Multiple File AJAX Upload: Uploading (Part 7/10)</b></h2><h5 class="post__date">2014-04-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gmhVK1-wTL0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now that we've got everything looking
exactly how we want it we're going to
build the upload dot PHP file to
actually deal with file uploads so we're
going to be choosing some files in this
case we'll choose a few of these files
and we'll go ahead and actually check in
upload dot PHP that these have been
uploaded we're not going to touch upload
dot J's for now we'll be looking at that
in the next part what we're going to be
doing though is making sure that the
files actually upload first of all now
files will be uploaded to this uploads
folder in my root directory of where I'm
building everything so remember I've got
my CSS folder J's folder and I've got my
uploads folder which is currently empty
so all files will be stored here let's
make a start on upload PHP then we're
going to use the header function to give
a cut different content type to this
output a reason we're doing this is
because with with the upload js4 we're
going to be outputting or reading in
rather JSON a JSON string so we're going
to be outputting JSON in here without
succeeded and failed error messages and
don't worry if you're unfamiliar with
this we'll look at this later in detail
so I'm going to say content type
application forward slash JSON just
capitalize that T there so now that
we've done that we can go ahead and
start to build the rest of the page so
I'm going to create a variable could
upload it and just that just assign that
a empty array and I'm also going to
create an allowed array and this is
going to hold which file types are
allowed in my case I'm going to allow
mp4 and nothing else although we could
go ahead and allow something like mp4
and JPEG or mp4 and PNG if we wanted to
so now I'm going to create a succeded
array and I'm also going to create a
failed array so we're going to be
storing the succeded files in here and
the failed files in here so let's go
ahead and create a quick if statement to
check if the files array
through - this is empty or not if it's
not we'll say okay so we can actually go
and test this out because remember
inside of here we've got the action to
upload dot PHP we've also got the method
set to post and we've got the ability to
upload files so let's take a look at how
this works I'm going to choose a file
I'm going to click upload and it says ok
here now notice if we inspect here we
can go ahead and check the network tab
refresh continue and you can see that if
we scroll down this has a content type
of application JSON so we're going to be
reading in with this or via an ajax
request later on but we want to go ahead
and nail the actual PHP functionality of
this beforehand so let's now actually
build some useful functionality in here
I'm going to go ahead and loop through
each of the files that we've chosen
remember we have multiple files here so
we need to do something for each of the
files that we've chosen so I'm going to
access the files array I'm going to
access file that remember that's the
name of the file that we called so if
you go ahead and name this something
different this will be different too so
I'm going to loop through name and I'm
going to say as key name so we'll go
ahead and output these so I'm going to
echo key and then I'm going to
concatenate on name let's see what this
looks like now so let's choose two files
and upload so we've got 0 which is the
key this is the position in the array
that this file is at we'll be using that
later on and then we've got the name of
the actual file then we've got the key
one which is the second file and the
name of the second file so we now know
that we can access this data what we
need to check though is whether there
wasn't any error here so I'm not going
to I'm not going to be allowing or I'm
not going to be logging error handling
here but you can go ahead and choose
what you want to do here so we're going
to say if the error
at this specific key is zero that means
that everything is okay so in this case
we'll go ahead and say temp and we need
to access the temporary location of this
farm that allows us to actually upload
the file because when you choose a file
in your browser this will be stored in a
temporary location before you go ahead
and issue the move uploaded files
function and actually move this so
remember it's file and in here its TMP
name and that's a the position of the
key so we can echo temp to see what this
looks like let's go ahead and refresh
choose these two files hit upload so
we've now got the location of these
uploaded files these temporary files so
we can move this later on now I'm going
to enforce a little bit of security here
in terms of the allowed extensions there
are lots of different ways you can do
this and this isn't a foolproof solution
so you may want to go ahead and actually
implement your own way of uploading
files this could be using a framework or
something this you know had a
long-standing code base and the codes
hardened for how the security's checked
on these files but what I'm going to do
for now is grab the extension so I'm
going to use the explode function and
I'm going to explode on a dot and by
passing a name here that will give me an
array of hopefully two elements so if we
just check this out in fact I can just
refresh here there we go so we've got an
array here so the last key is basically
what's been separated by a dot so in
this case it's mp4 and what we can
actually do is go ahead and now assign
extension the value of string to lower
because remember we're checking or were
only providing lower case values here
and we can go ahead and use the end
function which will grab the end element
of the array in this case it'll be mp4
so when I go ahead and echo out
extension this is now string wealth and
race we don't need to use print our on
it
you can see that we get mp4 for both of
them so with the extension stored we can
actually check if this is allowed based
on that extension but first of all I'm
going to generate a random file name or
not random we're going to use the mp4
md5 file function on the temporary file
to generate an md5 hash of the file and
then going to append a timestamp onto it
and then append the extension on and
this allow us to upload the file but
give it a unique name so we don't
accidentally overwrite existing files
and we don't want to store files with
the same file name we want to give them
a random name and this ensures that
they're just on well not unguessable but
as unguessable as possible for this
example so we'll use the md5 file
function on our temporary file which we
stored up here remember and we can then
append on the timestamp and then what we
want to do is append on the extension so
if we echo this we can see that for each
file we've got this
so this md5 hash of the file with the
timestamp here appended on the end and
then the same with this file as well so
we've got two files at the moment now
that we've stored that file we can
actually store this in the upload or
uploads folder that we created here so
we create a if statement and we say in
array this checks if something is in an
array in this case we're going to check
if this extension is in this array if it
is we can assume that it is a allowed
file so we say ext in aloud so if that's
true we can then go ahead and nest
another if statement and say move
uploaded file choosing a file name and a
destination now move uploaded file will
actually move this uploaded file to the
destination for you but the same time
we're checking if that's true so if
that's actually worked or not so when
does the file name come from in this
case it's the ten
the stored in our temporary directory
and we know the destination we just do
this in double quotes this is uploads
slash and then the name of the file that
variable that we created here and that's
it so if that's work then we've
succeeded so we can go ahead and append
on the name of the file and the file
itself so we can link to it with our in
our succeeded array so let's do that now
so succeeded equals this means we're
appending an element onto an array we
want to add an array into an array and
within here we want to have a name
that's going to be name of the file and
the file which is going to be the actual
file name in this case file so we're
we're storing name in here and we're
storing the file in here we'll output
these in a minute just to see what they
look like so otherwise if this doesn't
work something's gone wrong
so basically this is only if in fact we
can probably combine these if statements
so let's go ahead and combine these just
to make sure that this it's foolproof
let's go ahead and get rid of this if
statement here so now what we're saying
is if it's allowed and it's been
uploaded successfully then append to the
succeded array otherwise we've got an
error either due to this or due to this
so we can go ahead and say failed equals
array
this is appending an array on for each
of the files remember and all we need
this time is the name so we just add the
name there so this will actually work
and go ahead and upload our files let's
just go ahead though and down here do a
check
so the check is going to be if not empty
post Ajax and we'll look at that later
this is something that we're going to
add on in our JavaScript call but for
now let's go ahead and just echo JSON
encode ray so JSON encode is going to
take the an array in this case it's this
array here which we're going to add
values to in a minute and it's going to
encode it to a JSON string with that
JSON string we're going to be using this
in the Ajax part of things to actually
upload the file so I'm gonna output
succeeded as succeeded and failed failed
rather as failed so we're going to place
this in a moment inside of here the
reason that we're doing this is because
we're checking whether it's an ajax
request if it's not an ajax request we
don't need to output this we could do
something else we can direct the user
off somewhere and this is basically what
we were talking about earlier when if
javascript isn't available this form
will be traditionally submitted as we've
been looking at in the example here in
this case if ajax isn't within this
request which will be adding with upload
KS then we can cut the user off someone
else somewhere else and say your files
have been uploaded so let's take a look
at what this actually looks like first
of all though start the process again so
we'll choose a couple of files and hit
upload
okay so succeeded begotten and it's just
take a look succeeded okay so when we go
ahead and refresh this time there we go
so we've got a succeeded array and a
failed array so we've got failed as
method txt but we're obviously not
seeing anything in our succeeded because
I've gone ahead and spelt it wrong let's
go ahead and amend that refresh continue
and there we go so we've got a succeeded
array with a name and father's
successfully been uploaded
and a failed array with the name of the
file that hasn't been uploaded what we
can now do those checking out uploads
directory and see that them files do
actually exist we refreshed a few times
we've had these uploaded a few times I'm
going to go ahead and delete them like
so now that we've done that we've
successfully completed the upload
process so we can actually upload files
now what's missing is the intermediary
to allow us to use do this via Ajax and
actually then allow our progress bar to
determine the progress of the file
upload so it works in terms of the back
end in the next video we're going to
look at doing this with JavaScript
without Ajax or an ajax request to
submit this our data to our PHP file go
ahead and upload this these files</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>