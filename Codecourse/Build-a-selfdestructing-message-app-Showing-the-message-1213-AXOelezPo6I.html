<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a self-destructing message app: Showing the message (12/13) | Coder Coacher - Coaching Coders</title><meta content="Build a self-destructing message app: Showing the message (12/13) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build a self-destructing message app: Showing the message (12/13)</b></h2><h5 class="post__date">2015-11-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/AXOelezPo6I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">once someone receives that email we want
to build up a link to a new route which
when they click on it will pass through
the hash and then we'll they'll be able
to see the message and then we'll go
ahead and delete it as well so to get
started we'll define a new view and/or
route rather and this will be messaged /
and we're going to include a hash
placeholder in here so let's do our
normal call back with request response
and that arcs now args now will contain
the hash that gets passed in so what do
we need to do in here well we need to
grab this from the database so we're
going to say this DB prepare we're still
using a prepared statement because we're
going to be passing data through to a
query that a user can provide in the URL
so that's important and we're just going
to select message so we want to select
that column from messages where the hash
equals a hash placeholder and all we do
now is we execute this so message
execute we pass through that hash value
so the hash value remember is within
args now this will be an array of
anything passed into the URL so it'll be
eggs hash like so and now we can just
fetch the record and pass it through to
a view so message is going to be message
fetch and we're going to fetch it as an
object so now we need to tackle passing
this through to a view we don't actually
have a view yet so let's build up a new
folder here called message and then
inside of this let's create a new view
to show the message so that's so short
wig so what we can do with in here then
is do the same thing that we did with
our homepage we can extend the default
template so to do this we just are going
to copy this home page paste it in here
and we're just going to get rid of this
con
so what we'll do is we'll come from here
and our message can be displayed in here
so this will be where the message you'll
be so let's just render this view so
we're going to return this view render
we pass in our response here and message
/ show twig and into this we need to
pass the message so message message so
now we can actually test that this works
so if we go over to here and say message
and then a hash this can't actually be
found but we'll be dealing with that
later but if we were to have a hash in
here that could be found we could
actually show the message so let's test
this out by just setting up a new
message so let's type in an email
address we'll just say hi there hit Send
obviously that's going to send over to
my mail client but we'll have it in our
database here this is the hash so I can
copy this and I can go over to message
and then paste this hash in there and
now our goal is to show that message so
over on show in here we need an if
statement and this is just going to be
if message message here we can say else
and then in that if now if there is a
message we just want to output the
message otherwise the message has self
destructed so now we see that message if
we were to do something that didn't
exist so I'll just add an a on to the
end of the URL we see the message
self-destructed perfect so now what we
want to do is generate a proper URL in
here so when it sends it through to our
mail client we don't just see this and
that's really easy
because remember when we were actually
setting up our forum we used the path
for method now we didn't actually give
this route a name so we can go ahead and
do that now so we're going to say set
name I will just call this message but
again you can call it whatever you like
so in our email view we can generate a
URL here we have this hash variable
passed in so I'm going to generate an
anchor here and I'm just going to output
path for message and here we need to
pass it in the hash so we just say hash
hash like that and we can do the same
thing for the href so it's actually
clickable so let's test this out we'll
see there's a slight problem with this
let's just go back to my empty inbox and
let's just go back to our form send to
an email address into a message hit send
and if we go over to my email client
you'll see now that we have this forward
slash tutorials destructive public
message whatever now this will update
automatically based on whatever URL path
you're using but in our case we don't
have the URL appended and this isn't
clickable now so remember I've mentioned
this before but when we set up our views
when we added our two extension we pass
through the URL to our application just
here that was from our config so /or
HTTP localhost so all we need to do is
use the base URL helper within our
message and that just looks like this
base URL and that's all we need to do we
can do that before this text as well so
we've got the text in here which is the
base URL and then the URL for that route
and in the actual href attribute we have
the base URL and the URL for that route
so you can put any text in here that you
want but resting it's nice that we have
the URL so now let's test
this out once more and see what happens
and hit Send there we go that looks like
it's sent and when I see this we've got
the full URL I can click on this and I
actually see the message so there we go
we've actually been able to view the
message now via the send email however
this is not self-destructing so in the
next video we're going to look at how we
can delete this immediately as soon as
it's been viewed</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>