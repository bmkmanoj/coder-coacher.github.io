<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 5): User Login (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 5): User Login (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 5): User Login (Part 3)</b></h2><h5 class="post__date">2012-05-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JUk2e8oqOvI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so welcome back to the third part
of the login process of our login and
register system here we're going to pass
through the username and password and
actually start to log the user in so
let's go ahead and do this so we've got
this else block here that we had if all
of these have failed we come to this
last else block and what we do is we're
going to set the variable login equal to
the result of a login function and the
login function is going to pass user
name and it's also going to pass
password now if this if this username
and password combination work we're
going to return true i user is
successfully has successfully logged in
or provided the correct information if
they if this returns false we have an
error so we can build this start to
build this up before we even know sorry
before we've even created this login
function so I'm going to say if login is
equal to false then append something
else to this errors array so let's say
that username password is in correct or
this username password combination is in
correct because we know we've already
checked if the username exists now
otherwise we want to set the set the
user session and then we want to
redirect the user
oops just comment again redirect user to
hi so we need to create this login
function now and that's going to deal
with actually checking these login
credentials or credentials so let's go
ahead and and create this function so
over to our users PHP file let's go
ahead and create this down here when I
say function login record it login and
here remember we pass a username and we
pass a password and we want to sanitize
we want to sanitize both of these fields
or in fact we want to sanitize the
username field and we want
encrypt the password field now remember
we are storing our password in here as
an md5 hash so we need to encrypt the
password that the user provides in order
to match it to the already encrypted
password so I didn't actually mention
what I did mention by I miss mentioned
the fact that if this login is
successful we're actually going to go
ahead and pass a user ID back instead of
true we're going to pass false if the
login is failed and we're going to pass
the user's ID if the login is true now
the reason we're doing this is because
we're going to be storing the user ID
here in a session if if this password
and username combination is is
successful so we'll be storing that in a
session so we need to create a function
that gets the user ID from the username
so let's go ahead and do that now or
create a function called user ID from
user name and using passing through user
name we need to sanitize this so
username equals sanitize use the name
and then we need to return the user ID
so we can just say return my SQL result
and we want to pass a query here row
zero I the first row and then we want to
get the data so user ID there we go so
it's not as simple as that we need to
pass through a query which will just be
MySQL query select remember backticks
user ID from and which table users where
username is equal to in single quotes
username okay
so we're selecting the user ID which
we're picking up here and returning from
the users table where the username is
equal to the username we provided so now
we can use this function within our
login function so I'm going to say user
ID equal to user
ID from username and then pass in the
username okay so in actual fact now we
we've we need to think about this in
terms of where we're standardizing data
I'm passing through an unsanitary xur
name here which is being sanitized
within this function so now I'm going to
go ahead and I'm going to take the user
name and I'm going to sanitize that
again okay so I don't need to sanitize
it twice when I pass it through so San
it eyes use name and I'm also going to
reset the password because I need to
encrypt it to an md5 hash so password
okay so I've sanitize my username and
I've converted my password fine now we
need to actually return whether this
whether this password user name and
password combination of worked so we're
going to do exactly the same as the
thing we did up here and we're going to
return a result based on the query so
return MySQL oh sorry no we don't want
to do that we want to return your
operator and we want to return the user
ID or false so within here if this is
equal to or if this condition is true or
is true thee then we want to return the
users ID otherwise we want to return
false so within here what we what do we
want to do well we want to check the
MySQL result of account it's equal to
one so quite you know hard to explain
but let's go ahead and just do this so
if the mysql result is equal to 1 and
the mysql result will be the count of us
checking the username and the password
together so here is our query this will
be our row and that's it we just need to
go ahead and write a query so MySQL
query now this is select
again count user ID oops
from users in small or lowercase and
this is where now this is where it gets
or gets interesting so select the count
from user users where username is equal
to username and we'll just come over it
and password is equal to password so
essentially what's happening here is
this user name in this password need to
match if they do match and a record with
Alex and it and the correct password is
found this quit this result here will
return one so therefore if it's equal to
one we return the user ID by the user
successfully validated their credentials
otherwise we return false
so now we've created our login function
let's go ahead and test out so login
equals login username password we're
passing that through if it's equal to
false then we do something otherwise I'm
just going to literally just echo okay
just so we know so let's go ahead and
remember the password that I encrypted
in the first part of the tutorial or
yeah the first part the tutorial what we
actually did something with a database
we this this value basically represents
the string password okay so my password
is password so if I have been Alex and a
load of rubbish and I click login
nothing's happened so let's check out
what that might be ok so I'm going to go
back to init dot PHP and I'm just going
to comment this error reporting out so
we can get some errors output here in
fact we'll leave that on while we
develop anyway so for a call to
undefined function user ID from username
I appear to us about user name
incorrectly so let's go over to our
users dot PHP and there we go brilliant
so let's go ahead and refresh that and
resubmit the data okay so now getting
the error that username password
combination is incorrect which is good
because I did type in the wrong part
we're so again I'll type in the wrong
password you get that error so now I'm
going to go ahead and type in password
the the text password and click login
and you'll see it just says okay so I've
I've supplied this form with the correct
username in the correct password and
it's validated and we are able to log in
we haven't actually logged in yet but we
are going to set the user session and
redirect the user back home so go ahead
and get with this okay exclamation and
if we have logged in correctly we want
to in fact we'll leave that to just a
moment what we're going to do now is
we're going to print these errors out
properly we're going to in fact know
let's go ahead and and set the user
session it's a lot more interesting
so we've already set the or started the
session at the top here so we can use
sessions within it within any page that
we've included in it and in here we have
so we want to go ahead and and set this
user session so the user session that
we're going to call what we're going to
call the user session the user ID so I'm
going to say user a sorry a session user
ID and this is going to be equal to
login now why is it equal to login well
it's equal to login because log in
returns the user ID so now we have
logged and successfully returned the
user ID which in my case is one so if we
do here died login you'll see that when
we refresh it returns one because I've
logged in with the user one so we store
that in the session which we're doing
here and then we redirect the user to
wherever and then we can exit the script
underneath not required but it's just to
have it so we're going to redirect the
user back to index dot PHP so we're done
if we are logged in if we provide the
right details and then we login
successfully we set a session and that
session holds our user ID which uniquely
identifies us while we're browsing the
website then we redirect out
elves back to index dot PHP okay so now
we need to look at actually testing
whether this works and then we'll look
in this in another part the next part of
the tutorial about clearing up these
errors and things like that or
outputting them correctly on to the page
so how do we test if we we are
successfully logged in or not well let's
go over to index of PHP and let's just
create a bit of logic down here to check
whether this session has been set and
we'll be creating a logged in function
in just a moment and you'll see how much
easier is let's go ahead and do this so
I'm going to say if is set dollar
underscore session user ID echo logged
in else so if the user is not logged in
not logged in okay so this is just going
to appear on the index page so let's go
back you'll see the moment says not
logged in because the sessions not set
ie
we haven't registered sorry we haven't
successfully logged in if I go ahead and
say Alex and a load of rubbish and click
enter that username password combination
is incorrect and by the way if you
haven't if you've already wondered this
lot here will be output a lot nicely at
some point and we will include the
overall template as well so it will all
be included within our nice design so if
I now enter password as in my actual
password and click login you'll now see
that we've been transferred back to
index dot PHP and it now says logged in
so now what if we do on this page with
whether we were refresh or navigate away
and then back again we are still logged
in because the session is set however we
don't want to be writing this code out
here every time we want to check our
users logged in or not we want to create
a handy function that allows us to you
know visually see is the user logged in
so let's go ahead and create the
function that does that we'll get rid of
this code here so in users dot PHP let's
go ahead and write this at the top so
function logged in and essentially this
is just going to return true or false
whether or not the user is logged in I'm
going to say return either true or false
and the condition within here is is set
dollar underscore session user ID okay
so now what we can do is on any page we
can say if if the users logged in you
know do something otherwise do something
else so the perfect example would be in
our aside where we think we're including
logging login at the moment but we want
to include the login form only if the
user is not logged in so I'm going to
say if something else do this and this
is is if logged in is equal to true echo
logged in so when I now go ahead and
refresh you see that the sidebar has
changed we no longer have this login
form but obviously we want to test this
the other way around we want to test
whether well what's going to happen when
the users logged out so we need to
quickly create log out script and you
know this isn't pop the login but it
does tie in is very very straightforward
so we create a new file and I'm going to
call this a logout let's save it in our
root directory and I'm going to start
the session
so before we terminate a session we need
to actually start the session by the way
we're just going to be redirecting our
users users to this logout dot PHP file
to log them out so session start and
then we say the session destroy' and
it's that simple
and then we just redirect our user so we
can redirect them to
index dot PHP so to log our user out we
what we logged in at the moment we go or
we forward them and we'll create all the
links and the visuals later logout dot
PHP that redirects us back or it
terminates the session redirects us back
and here we see our our code again
because the if statement has decided
that well as seen that the session
hasn't been set and therefore it wants
to go ahead and display this here so
yeah that's basically it for logging the
user in there's a lot more to do here
and there's a lot more to tidy up
obviously we've done you know quite a
lot in this in this kind of thing the
next thing really is to output these
errors and I think actually what will
quickly do is we'll go ahead and we'll
include the header files so remember the
header files are included within
includes overall and then whatever it is
so it includes overall header dot PHP
and then down here we can go ahead and
include overall forward slash up sorry
includes overall footer up PHP and then
again when we refresh if I type in some
gobbledygook wrong we get all these
errors appear here obviously they're
still in sort of a visual representation
of an array which we don't want we want
to nicely output them to the user and
give them a nice friendly header to warn
them that their login has been
unsuccessful so we'll be doing that in
the in the next part and sorting out
these errors here but for now that's how
we have logged in a user and the very
basics of doing so</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>