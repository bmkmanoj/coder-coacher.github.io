<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Authentication with Slim 3: Authenticated middleware (28/29) | Coder Coacher - Coaching Coders</title><meta content="Authentication with Slim 3: Authenticated middleware (28/29) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Authentication with Slim 3: Authenticated middleware (28/29)</b></h2><h5 class="post__date">2016-04-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZLmCdbNYHAo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">at the moment regardless of whether we
are signed in or not signed in we can
access any of the routes that we've
created and that is a little bit of a
problem so let's just demonstrate this
and we will sign out of our account and
then we will head over to auth password
change now obviously we don't have to
change our password or we can't change
our password because we're not signed in
we should not be able to access this
route and of course when we do submit it
eventually things are gonna go wrong
so we want to protect our routes against
people being either signed in or if
they're a guest so by guest I mean if we
are signed in we don't want to be able
to access things like the sign up area
because obviously we're already signed
in and of course we don't need to access
the sign-in area either so we're going
to create two pieces of middleware and
we're going to group things here that we
want to be accessible by people who are
signed in or not signed in so
authenticated middleware and guest
middleware so let's start without
authentication middleware what we can
access when we are signed in like
changing our password or signing out so
we're gonna start by creating the
middleware then we'll create a group and
then we'll attach the middle west that
group so we'll start by just creating
our file so we'll call this off
middleware and of course to make things
simple we can just copy this over as
we've done before so we'll get rid of
everything in here because we don't need
this and we'll go ahead and change the
name of the middleware so we thought to
think about what we need to do in here
now of course we have our container on
our base middleware so we can access how
currently authenticated user or at least
we can access the authentication class
that we built so here we want to check
if the user is signed in or rather if
they're not signed in so not signed in
and if they're not we want to flash a
message and redirect them
simple as that so we'll start by
checking so we'll just use our container
so if not this container or check if
they are not signed in we'll be on a
flash a message so we can use our
container to add a message and of course
this will be an error could be info if
you want it to be friendlier but please
sign in before doing that and then we
want to redirect them so we could
redirect them to the home or the sign-in
page it makes sense to probably redirect
them to the sign in page so this return
response remember we have our response
inside of here with redirect and of
course we can now say this container
Rooter path for earth sign in and that
is it so now we need to do is create our
group which is a just a normal root
group and we add our middleware to that
so if the user is not signed in we don't
allow them to sign out it doesn't make
sense we also don't want them to change
their password so let's create our root
group here and then we will place these
inside of our root group so a root group
literally just looks like this it's app
group rather than app get we have a URI
here so you could even group things
under orth and then create your routes
under there we'll see how that works in
a minute and then we have a callback now
I'm leaving the URI empty because all
we're doing always kind of Kring this
root root group for is to just protect
against our unauthenticated users
accessing this so after this we say add
and we're actually now adding this
middleware only to this group of routes
so we say new auth middleware and we
pass in our container so we can just
import this at the top so we can say use
app middleware or middleware and now we
want to place these inside of here we
now have these routes
that will have this middleware run on
them it won't this middle way is only
attached to these routes simple as that
so now that we've done this we can take
a look at what happens so we are not
signed in and we're seeing an error and
this is because we don't have a pin
scope here now rather than do something
like use app what we can actually now do
is use this so we can just change these
over like that
and we're done let's refresh there we go
so we're currently not signed in so
let's try and access our password change
area and you can see that we're
redirected with that flash message and
we have to sign in so there's now no way
an unauthenticated user can attempt to
change their password and this goes the
same for if you add any other
password-protected areas or at least
areas that you need to be authenticated
for so really useful to know you can
enter all your routes or create all you
of your routes within here if the user
has to be signed in so now that we've
done that we'll jump over to the next
video and implement our guest middleware
but if you can try and do this before
you watch the next video just to see how
you get on</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>