<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unit testing with PHPUnit: Testing a Calculator: Division (9/10) | Coder Coacher - Coaching Coders</title><meta content="Unit testing with PHPUnit: Testing a Calculator: Division (9/10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unit testing with PHPUnit: Testing a Calculator: Division (9/10)</b></h2><h5 class="post__date">2017-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LDDnGnWupEE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we've got green at the moment
what we're now gonna do is implement our
division test start to write our
division class then we're going to be
doing a lot of refactoring and as long
as we still get green we know that
everything is fine so let's start by
just creating a new test in here we'll
do this first of all you already know
how this is roughly going to work so
we'll create a division test again go
ahead and just copy over our sample test
just so it's a little bit easier for us
and we'll start to go ahead and update
this so let's just change over the class
name here division test and we'll go
ahead and create our first test just in
here so the first thing we want to do is
a very similar thing to our addition
this is that it divides the given
operands so let's create our test in
here divides given operands like so and
then we'll go ahead and start to write
this out so we're going to create a new
app calculator division class we're
gonna sour France so this will just be
set or parens and let's just keep this
really simple and let's say 100 divided
by 2 so we know that that is going to be
50 and what you could do is in this case
the way that this is going to work is
provide to again what this will do it
will do 100 divided by 2 divided by 2 so
you know it's not an ideal thing but
obviously we're just playing around here
so now we want to just do a very simple
assertion what we've already seen before
so we're gonna assert that this equals
50 and again we're gonna say division
calculate now this is where when you are
writing tests for individual units of
things you start to notice common
functionality so we know that we've got
a calculate method on both of these
classes they're both very similar they
both allow us to set off rounds and they
both allow us to calculate now the
difference is that calculate work
differently obviously for division
multiplication addition but we have a
common set operator which sets an array
of things that we want to perform an
action on so in this case we know that
this is going to fail we'll go ahead and
implement our class and everything like
that and then we
bit of refactoring and as long as we
arrive back at green then that's the
whole point we know that everything is
still working
so let's sir go and create a similar
class to this what I'm just going to do
is copy over the whole structure of this
just to keep things a little bit simpler
so division dot PHP let's paste this in
and go ahead and start to change this
over so we know that this is the same so
we can keep this in here obviously the
class name is going to be different we
are gonna throw this exception so we can
leave this in here we'll write another
test that this does actually throw an
exception but overall we will be
refactoring this anyway so we have
everything in place calculate should
return that division operation and we
should get this you know working as
expected so what I'm gonna do is just go
ahead and say return 50 just for now so
we can actually get this passing and if
we go ahead and run our tests that
passes now we can go and actually
implement the division functionality so
I'm purposely going to again make this a
little bit more tricky than it needs to
be just so we can go back and refactor
it later so we're gonna go ahead and set
result to zero we're gonna come down I'm
gonna go and for each loop over each of
the operands so this operands as operand
like so and then what we're gonna do is
first of all check if the index and if
we just bring an index in here like so
we're gonna check if this equals zero so
if it's the first item like so we want
to set the result to that operand so we
can further do any division on it and
then we're just going to continue the
loop otherwise what we're going to do is
we're gonna set result equal to or we're
going assign result divided by operand
to that result so now this should give
us the division in sequential order so
let's just return the result here that
we've assigned to this and we should get
green and there we go
so obviously I'm not happy with this so
I'm gonna go ahead and refractor it the
first thing we're going to a factor
though is this here so what I would
typically do in this case if this was a
kind of sin
thing is I would create some kind of
operation abstract class so now that we
know our tests are passing we can go
ahead and refactor so only your a factor
when your tests are passing because then
you'll know that your a factor has
broken your tests so this will be an
abstract class and it will be operation
abstract and we know that as part of
this we're doing a similar thing on
division and addition which is setting
our operand so we can literally take all
of this get rid of it like so take all
of this from division and get rid of it
and basically put it into this abstract
class that we can then extend so that
makes sense an abstract if you weren't
aware it's just so we can't instantiate
this on its own there's no need to so
let's just add a namespace into here and
we'll start to run our tests again so
app calculator and we should be good to
go so let's go over to division and
extend this so we're going to extend
operation abstract and that implements
that still so that still implements that
and then we're going to go ahead and do
the same on here so extends this and
implements our operation interface so
let's go ahead and run our tests and we
get greens so we know that just by
refactoring this this has worked we
don't need to do anything else we get
the exact same result so we know that we
haven't broken anything so now that
we've done this we're gonna go back to
here I'm gonna refactor this and once
again as long as we get green we know
that this has worked now another way to
do this is to use array reduce so we're
going to go ahead and return array
reduce and the whole point of this is
even if you're not really sure what
you're doing you know that once you end
up with the result that you expect
you've done a successful refactor so
that's the whole point here so we're
going to do a reduce on the each of the
operands and as part of array reduce we
have the current and the carry value and
I'm just going to call these a and B and
what we can do now is first of all check
if a doesn't equal null which is the
default value that we can also define
here if we want to and we want to check
that B does not equal null well if
that's the case we're going to return
a / be otherwise we're gonna return be
so regardless of whether this makes
sense whatsoever
this will actually give us the result we
need a me should get a successful
refactor so that's just another way of
dividing numbers in a list of numbers
now what we want to do is think about
division by zero
now obviously over in our division test
if we were to say and just temporarily
change this to zero and then five we
know that we're going to get an error
because we are dividing by zero so we
get a division by zero error now what I
want to do is write a test specifically
that says well we're going to ignore any
off-brands that we give that are zero so
for this we might create a test that
says removes or ignores whatever you
want to say division by zero operands
and what we can then do is start to
write out how we would expect this to
work so let's go and new up division
let's use division set operands and
let's say something like 1000 5 0 or 50
0 whatever we want to say so we know
that the result of this should be 2
because it's essentially just 10 divided
by 5 so we should get the result - so
again we can assert here that this will
equal 2 and that is division calculate
like that so let's just bring in our dot
block there before we forget and let's
go ahead and run this test so we know
that we get division by zero we need to
know that these are being removed now we
can go ahead refactor this so it works
and then we should get green so in this
case it's pretty simple we have a
function in PHP called array filter
which will remove any false null or zero
values so what we can do in this case is
just use a rate filter on our off-brands
before we start to reduce and go ahead
and divide so just by doing that we go
ahead and run our test we get green we
know that nothing else is broken we know
that it works so that is as simple as it
is
if for example implementing this would
have broken this test here then
obviously we would have known about it
so finally we want a test just to say if
we don't have any operands set we want
to throw an exception so it's very
similar to the other one but we've
pretty much covered you know all of the
major refactoring of this and we know
that our tests are still working so
we're going to create another test in
here very very quickly we've already
seen this before but it's always a good
idea to go over know our plans given
throws and you know what actually I'm
just gonna pull the tests over from our
addition test so no operands given
threads exception when calculating so
let's pull this over to our division
test and go ahead and have our block
just in there and now obviously what
we're doing is catching the same
exception but we're just calling
division and we're calling calculate
without any operands so let's go ahead
and run our tests and we get green that
is because over in here we included this
so obviously if we weren't including
this or if something had gone wrong
somewhere like this we obviously get red
because we're expecting this so that is
now our division class built tested but
more importantly refactored along the
way both with that operation abstract
and using array reduced rather than a
for each loop we know just by writing
our tests first of all that when we
refactor everything continues to work as
we refactor</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>