<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Sign In With Google: Authenticating (3/5) | Coder Coacher - Coaching Coders</title><meta content="Sign In With Google: Authenticating (3/5) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Sign In With Google: Authenticating (3/5)</b></h2><h5 class="post__date">2014-05-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yBemQRtkqbY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">right so we're now going to add to this
page a little bit and we are going to
basically just define our page as you
might find it obviously you don't need
to do this but I'm going to go ahead and
create what you would normally find here
and we'll give this a title say just
website or something like that
okay so inside of the body of this
document what we need to do is check if
the users currently signed in or logged
in or what if you want to call it if
they are not we are going to provide
them with a sign-in link and that's
we've already seen that otherwise we're
just going to say you are logged in
we're going to give them a link to the
logout dot PHP page which will create
later so let's start to do this here we
are going to create an if statement so
we're going to say if not auth is logged
in and we don't have this method set up
at the moment so we will get an error
here so let's quickly do that now so
inside of Google auth let's create our
is logged in or is signed in and what I
call it is logged in so basically what
this is going to do is it's going to
check if the session is set with the
access token so all we need to do really
here is return the result of the is set
function and we just pass in the session
and we're going to call this access
token so this is where we're going to be
storing the Google access token when we
retrieve it from the API but for now
this will return false because it's not
set so if that's the case we know we can
just do an else here as well and we'll
do an ENDIF so if this is not set we're
going to say sign-in with Google so this
here is going to be the link to the
Google and basically the link to the
account verifcation so we need a method
to be able to actually retrieve this so
I'm going to echo
here or and we're going to call this get
or URL so this will get the URL that we
saw earlier so again this isn't defined
so let's do this here public function
get or URL so now we can actually start
to see whether our client is responding
and working we need to request a North
URL so here all we need to do is return
this client so we're now accessing the
stored client information or the stored
client link and we use the create or URL
method so let's check if this is working
okay I might have had a solution still
set from earlier so that's just head
over to here we'll get rid of a couple
of them cool okay so I had a session set
from earlier so now we have a link
saying sign in with Google we can
inspect this element and you can see
that that long link that sir we saw
earlier has been generated for us so we
can click this now and go through now if
we have the redirect URI set something
different this will give us an error at
this point so you know then what the
error is
and Google is quite explicit in telling
you what the problem is so it's quite
useful okay so now that we've done that
we'll just fill in what's going to
happen if we don't we're just going to
say sign out and here we'll say you are
signed in and the sign out we'll go to
logout dot PHP but we'll call this well
just call it a sign out okay so now what
we need to do is actually start to look
at bringing in some methods that are
going to check whether the redirect code
from Google has been provided so what we
can actually do is before we even start
to touch this is click sign-in with
Google we can accept this now you can
see that we have this code that's been
generated and passed back with the
request back to our redirect URI that
we've provided so what we can do is we
can use the superglobals to pick up
whether this code is set or not so let's
just get rid of this for now and we'll
start to build this method and we're
going to check for this
here it's important note we're checking
for this here on the index page if we're
checking for this anywhere else you will
have a different page name you may in
fact want to create a page separately
just to check this code that's been
passed back because really what we're
doing here is we're mixing all the logic
with the output it'd probably be better
just to have a separate file to do this
but we'll do it all here just for the
sake of being quick so we're going to
create an if statement here and this is
going to check if the redirect code is
available so or check redirect code this
is going to be our own method we'll
build this in a moment in here what I'm
going to do is just kill the page and
I'm going to say dollar underscore get
code and basically that will just
obviously show us the code so we can use
check redirect code to check it let's go
ahead and build this so public function
check redirect code so there's a little
bit more to do in this one it's still
not too much to do the first thing we
want to do is check if the code in the
get super global is available if it is
then we can authenticate using this code
so we say this clients are now accessing
the Google client and we're going to say
authenticate and then we're going to
pass that in so that's now said right
we've had a request back from Google
we're now passing this code that's been
generated on Google's end back through
to Google to verify so now what we can
do is we can actually set this token in
a session however we also want to return
true here and we want to return folks
outside of here in case this is not set
so now let's test this out so sign-in
with Google accept and there we go we've
killed the page and without put the
token so we now know we can actually use
this okay so now we are going to do a
couple more things we want to actually
set the token which we haven't looked at
yet the tokens not the same as the code
we need to use the get access token
method on the Google client to
trees the access token so we're going to
say this set token this is going to be
our own method so let's just set this up
quickly down here public function set
token so we're going to set token what
do we want to pass through what we want
to pass through a token where does this
token come from well it comes from the
client because that's generated we we
can't generate this ourselves so we get
the access token we pass it through to
set token now inside of set token we
want to go ahead and set access token
remember that thing we're checking for
here and we want to set that to the
token now we also want to set the access
token via the client as well so we're
going to say this client set access
token token done so we now effectively
just signed our user in because we've
got a token back and that's it
so let's check this whole thing out part
instead of just killing the page here we
want to do something a little bit more
useful we want to do a header redirect
so we're going to say location and just
back to the current page obviously if
this wasn't a separate file it would
just redirect your user back to the
front of your application so sign-in
with Google I'm going to click accept
that will redirect me back with the code
redirect me and I'm now signed in and
obviously the reason we get this is
because here we're checking is logged in
which is checking if that's if that
session set so that's pretty much it
actually authenticating with the user
we've checked whether the code has been
returned from Google after we've
generates the earth URL we've then
authenticated with that code we've
generated a token and we've stored it in
a session</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>