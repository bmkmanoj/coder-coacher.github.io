<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP OOP Login/Register System: Log in (Part 16/23) | Coder Coacher - Coaching Coders</title><meta content="PHP OOP Login/Register System: Log in (Part 16/23) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP OOP Login/Register System: Log in (Part 16/23)</b></h2><h5 class="post__date">2013-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/AtivJV-kx5c" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now what we are going to do is give the
user or a user the ability to sign in to
their account
we've already allowed a user to register
which generated a hash for their
password and salt value and we can now
utilize them to allow them to actually
sign in set a session to signify their
sign it signed in and then in another
part we're going to look at actually the
the Remember Me functionality so the
ability to remember this user so the
first thing that really we want to do is
is outline the form that we're going to
create which is going to allow them to
enter the credentials they need to sign
in so you have an action and a method
here the method is going to be post and
the action is just going to be blank so
we submit back to this page now we're
going to do similar we're going to
create similar markup tool that we did
with for the registration so going to
have a label for a particular field or a
particular ID and this is going to be a
user name and we'll just end that label
field and we'll say user name and we
will create an input field and we'll be
validating these as well
so so an ID of user name and we'll set
autocomplete so off as well so going to
get a long list of values so that's the
user name and we'll also obviously need
to give the ability to supply the
password so let's just go ahead and
change these field names or these
attribute values okay so all of us are
going to need a login button to just be
a submit button with the value of log in
and and additionally we've already
looked at token generation for
cross-site request forgery it's not
massively important to include it here
but let's go ahead and do this anyway
just set a token just makes it a lot a
lot more consistent so the value here is
basically just going to be echo token
generate so you can generate a token
there okay so now what we're going to do
is we'll open and close PHP tags at the
top so we can perform a variety of
checks obviously the first thing that we
need to do is require in the
initialization file that we've already
created and we already know and the
first thing to do then is check whether
input actually exists or not
so whether the fonts been submitted
let's just go ahead and test this out so
we know that it works so we'll go ahead
open the browser hit enter we've got
these two fields and we can click login
and we get the test message so we now
know that everything is working in that
sense we obviously need to go ahead and
check that the token is correct and has
been supplied as per the form so we'll
supply the token using the the input
helper okay so now we want to go and
validate again we don't really need to
go over this too much because we've
already we've already looked at this
functionality so it doesn't really
matter too much the validation is equal
to validate and we're checking oops
we're checking so we have an array of
values that we want to check simply
username which is going to be an array
of a sort of defined rules and the
password similarly now all we're going
to do here is just require both of them
and wintour set both of them to be
required we're not going to do too much
else here we could check the lengths and
things like that but for the purpose of
this let's just leave these to both be
required and to needs check if the
validation passes so validation passed
we need to log user in otherwise we want
to go ahead and for each of the errors
set for each validation
errors as error that's a method on
buckets we're just going to go ahead and
echo out the error and depend on a break
so little messy but doesn't really
matter too much
so in here now let's go ahead and get
hit login nothing's happening so let's
just double check what's happening
username and password oh yes of course
we didn't supply the set of data that we
want to check against so when we hit
login now use name is required if I was
to type in a username and a password and
hit login this would work now I've also
obviously noticed that the type here
needs to be password just to conceal
that entry on our form so now what we
actually need to do is lock the user in
so we've completed our validation all
the boring things now what we want to do
is yeah actually look the user in and
we're not going to include the ability
to remember the user just yet we'll go
back and retrofit that in a bit later
and but the first thing we want to do is
instantiate a new user object so we can
make use of the methods that we have
here and what we're going to do is we're
going to process a login by creating a
login variable utilizing the user object
and the login method and passing through
input get user name and input get
password so we're passing them through
what we then want to do is check if the
login was successful and then echo
success that's all we'll be doing for
now and then we can we can just do a
little investigation and see whether
we've actually logged in I guess
otherwise we would echo something like
sorry logging in failed just you know
anything mile a doesn't really matter so
at the moment we obviously don't have
the the method about the login method
available to us so this will error and
so we need to go ahead and build the
login method in our user
object so let's go ahead or use a class
rather so let's go and do that so public
function login we need a username and a
password to be passed to this and let's
take a look at what we act or have a
think about what we need to do so the
first thing we want to do is check
whether the username and passwords been
supplied to this method so let's go
ahead and set these to null by default
so if the let's just say we'll do this
and so what what we're basically going
to be doing is using this login
functionality to a bit later on and
check whether we haven't supplier to use
them in a password and in that case
we're going to automatically sign a user
in based on their the ID that's already
been stored in the session so I think I
guess let's leave this for now and just
focus on actually logging the user in so
what we're going to do is we're first of
all going to check if the user actually
exists or not
but if anything else happens we're going
to return false we don't really need to
well in that case our if statement will
just be be rendered false so if we
create a variable called user and say
equals this find username so by doing
that we've assumed now that we have a
method in our in our class called fine
so we need to create this so we're
breaking this up into functionality that
we can reuse elsewhere so in we're not
sort of tied down to you know every all
of the functionality inside of this
login so we obviously need a username
passed in here that we'll use I'm just
going to say null and the reason we're
doing this is saying use OBE is because
we're in this case we're going to say we
want to also use this method to find a
user by its ID or they their ID rather
not just their user
so what we can do here is just say if
user we're going to say field equals is
numeric user so if this is numeric we
are going to say that we want the field
to be ID otherwise we want the field to
be username now the only consideration
here is are we allowing users to
register with numeric usernames at the
moment we are so we you know if if you
want to sort of get around this then
you'd have to go back to your validation
class and define the ability to only
allow say alphanumeric usernames or
something like that so in this case this
would this would fail on users having
only numbers for usernames so that's
just something to think about as well
and perhaps a task just to go away and
retrofit change your validation class
just to make it a bit more bulletproof
so data is going to represent the data
that we get back from the table so we're
going to say this
DB yet and you probably guess we're
going to get from the users table and
we're going to say where the field so
the field that we've just selected
either ID or username is equal to user
so what we're now doing is we are
grabbing the data from the database so
we can use the methods that we're used
to from our database wrapper so we can
say data cap our data count and now what
we're going to do is this will mean that
the user does exist so we are going to
return true we're also going to store
the user data so we need somewhere to do
that let's create a new property equal
data and let's come down here and say
this data equals data first so we're
taking the first and only result in this
case so now the data the data property
it will contain all of the users data so
in this case what we could then do is
check if the user exists so user if we
print our own user this will now contain
all of the users information so when we
do when we when we perform a login now
we should see an array of data so if I
have an Alex and password click login
one we have here so let's check what's
happen of course and I think we have no
users in our database how do we do okay
let's just take a look here so we are
returning true this fine oh sorry of
course and we need to say this data
because this actually returns true
rather than actually returning that and
we can pull the return folks on that so
yet so now what's going to happen is
when we refresh we're printing our on
the data that's been returned and stored
in that property so we now have all of
the data relating to my user account
which is cool because then we can work
with it in here to check passwords and
things like that so now what we're going
to do is back to the actual login
function itself we're going to say if
user because of remember we're either
returning true or false so if user and
what we're now going to do is check the
password so we need another if statement
we're going to say if this data password
now hold on a minute where's this data
method come from well it doesn't exist
at the moment the only reason I have
decided to do this is because use
referencing this all the time is going
to be a bit of a hassle so I'm going to
do is I'm going to come down here and
create a private method called data
that's basically just going to return
this data lovely so if this data
password equals hash make remember we
already have our hash functionality
password and remember we pass in a salt
as well to this hash
method so hash makes string and salt and
that will return us with a hash so
basically reversing what we did when we
register the user and then we're
checking the hash against the one that's
been generated here too so we're going
to say this data salt so we're grabbing
the salt from the user account as well
then that basically means that the
passwords match so if we echo or let's
yeah that's just echo okay so this isn't
going to actually look I seen or
anything like that and we'll still get
an error here if I type in Alex and I'm
no password one login we get a login
failed we'll get that the next time but
don't let that throw you off when let's
type in password now which is my correct
password and then I get this okay
message back because the passwords match
so now that we know that this if
statement works for valid passwords we
can go ahead and set a user session so
inside the session class that we've
already created we can use this to set a
session and put a session for the user
the user session that we want now
because we've stored the session names
inside of our our initialization file in
the config what we want to do is grab
these and store these somewhere useful
so I'm going to say up here in the
property list or list of properties
we're going to have a session name here
session name so inside of constructs
what I want to do is I want to say this
session name equals config yet if we
just take a look at how this is
structured so we can remember so each
session and session name so session
forward slash session underscore name
and yes so that's it's we we take the
session place it here so we can use it
out throughout our application just
saves us having to do config yet every
time we need to do that it's entirely up
to you how this works so we can now say
define the session name and we then want
to put the specific data in and we're
just going to store the user's ID
in this case so we can use the data
method now to place the ID in so now
we've actually put the session inside
the ID users ID inside of this
particular session and that's it we've
done we've essentially logged the user
in so what we also might need to do well
in fact what we do need to do is return
true because we want to signify that
this has been a successful login so on
the login page now and this is going to
you know work better so what we're going
to do is we're going to open up a
console and we're going to keep an eye
on the localhost data here so basically
if I were to type in Alex and like test
or something login and this fails so
sorry logging in failed though so type
Alex and password which is my correct
password and click login and this it now
says success so what we've now done is
we've successfully logged in in fact
this won't actually show much to be
honest but we can go ahead and see how
this has worked we can we can prove that
this has worked so on on index dot PHP
let's go down here and we're going to
say echo session get now this is only
temporary config get session session
name so that will echo that out to us
and when i refresh on the index dot PHP
page we see four and that is in fact the
ID of myself so we now know that that
has been set by the login functionality
now what happens if we want to check if
a user is actually logged in well that's
an entirely different story because what
we need to do is in the constructor
every time when we construct or
instantiate a new object we want to go
ahead and check if the session exists
and then return whether we're logged in
or not and so we'll be looking at that
in the next part</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>