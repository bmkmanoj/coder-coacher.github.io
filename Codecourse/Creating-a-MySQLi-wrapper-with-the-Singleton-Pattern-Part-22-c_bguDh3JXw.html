<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating a MySQLi wrapper with the Singleton Pattern (Part 2/2) | Coder Coacher - Coaching Coders</title><meta content="Creating a MySQLi wrapper with the Singleton Pattern (Part 2/2) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating a MySQLi wrapper with the Singleton Pattern (Part 2/2)</b></h2><h5 class="post__date">2013-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c_bguDh3JXw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now once the fun part where we get to
query the database without or chained
method style so we're gonna perform the
query on our get instance or chain the
query on till I get instance which we've
already done and then we can chain can't
and results so we can query the database
get the count get the results but it all
together and we've got functionality
that we can sort of reuse throughout our
application so to query the database
we're going to be using obviously in
MySQL I we've already connected we're
going to muse in the query method the
fetch object method rather than fetch a
sock to fetch an associative array we're
gonna store the results we're gonna sort
of loop through store the results in our
results array here and then we'll have a
method to return the count and the
results as well so let's go ahead and do
this then so we pass in SQL which we've
already done
so we've got select star from users
we've already seen our database but
let's just remind ourselves of that so
here yeah we've got user name and name
so we've got some fields just in here so
let's go ahead and actually do this so
we'll create an if statement and within
this will actually set our query
property up here to be the result of a
query so we'll say if this underscore
query equals this MySQL I query I'm all
obviously go ahead and past and execute
the SQL string that we get from here and
just a brief note as well this
underscore is naming convention
basically for any private or protected
properties so it's not required and some
people don't like to do it but it's it's
a personal preference so if this
succeeds let's go ahead and just echo
okay just so we know that this is work
sort of check it at each stage so here
we've got okay so this query obviously
works we returned all the results that
we need all the results with no limit
from the user's table within the
database we've selected here
now what do we want to do in this case
well the first thing we want to do is
actually store these results and then
add them to this results property up
here which is an array so let's go ahead
and create a while loop traditional sort
of the way you do it procedurally but
for this for every loop we'll create a
variable row no need to store this up
here you know we don't need to read it
in any other methods this is just a sort
of in a while loop that we're creating
so we'll say this query so we'll grab
what's returned from the query and we
can use the fetch objects method here
and what this will do is it will fetch
an object rather than an array now this
is good because we can store each of
these objects in an array and then when
we iterate through them we can use them
on this side of the fence if you like to
actually return or actually output them
you know in the true sort of
object-oriented sense so we don't have
to use an array and mix an array with
the object-oriented style of writing
code so we just basically say this
results and then we append the row for
each loop of this so let's take a look
at how this is sort of works or pop over
to index dot PHP and let's just say
results and we'll go ahead and do a
print R on this and we might also want
to just add some pre formatted tags just
so we can see this a lot nicer so let's
go ahead and refresh that will query ah
okay oh right so yep so this is the
whole point of chaining and we've
basically received an error here called
a member function results on an on
object which is entirely true what's
happened here is I'm calling result some
sort of chaining results into this query
method but the query method isn't
actually returning anything so it's an
it's not an object what we actually need
to do is inside of here in fact outside
of here we need to return this so this
basically refers to the object we're
currently in which is the new database
instance we create when we instantiate
it using get into
and then do these checks that we've
already spoken out so we return this now
this then lets us access other proper
methods that we create and indeed public
properties if they exist so we're
basically returning everything here so
we can sort of reuse it so what that's
going to do is then it's gonna we're
gonna call this results method which we
haven't created so let's go ahead and do
that so we'll create a public function
called results and basically all this is
gonna do is return this results so
what's going to happen is we could get
instance it returns itself similar to
this but just you know using a static
property instead then we query we
basically query store our results and
return this then from query we can then
access results because we've returned
this object so we can now do this which
we previously couldn't before so let's
go ahead and refresh when we see a list
or an array of objects that we've got an
array of four objects
which is right because we've got four
records and we've got the user names and
the names here which we can then access
as we need to so let's make this a
little bit better and get rid of all
this we this is you know not going to
help us at all instead let's store the
query inside of this users variable what
will then do is create an if statement
and we want to say if users count then
users exist now we don't actually have a
count method yet so we need to create
that first of all so if we take a look
inside of our DVD PHP file in our DB
class we're gonna create another
function called count now all this is
going to do is return this underscore
count now we've got a problem here count
count equals zero but nothing's being
done about it here so all we need to do
is within our if statement we just need
to say this count
equals
this query I believe it's on yeah you'll
be on the query so this query num oops
num underscore rose and that's basically
it so we return basically will be put
the count in here return this if there's
no results we'll just return 0 basically
so what we can do is user exists here
let's go ahead and just refresh and we
should get a message user exists
brilliant or users exist rather so
within here what we can then do is say
for each user's results as user and what
will then do is just print our own user
just to sort of demonstrate this again
so for each iteration we're going to
print out an object which is happened so
we can now access ID username and name
within this so then all we need to do
from here on is just echo something out
which is going to be user looks like
user name and then we'll just append a
break on or concatenate a break onto
that so now we'll get this a list of
users so basically what we've done is
we've created a class that we can now
you know extend if we like but we've got
the core functionality of querying a
database so we can query a database for
something return some results if there
are results if results actually exist
and then we return account as well
obviously things like update things like
that you know if you're updating or
deleting from a database you won't have
any results
but this query method will still work
and the point is here that we using the
singleton pattern we can actually reuse
this functionality using get instance so
we'll always have to call get instance
and we can query as much or as little as
we like but the point here is that we're
not constantly going to be calling the
construct function because it would have
already been run when we did this here
so there's new DB part so we're not
connecting again and again and again and
again and in object-oriented program
this is a good way to actually avoid
having to connect to your database again
again again because most people would
just say yeah I'll just connect within
construct say you know DB equals new DB
and we'll do this all over the place but
here it provides a sort of clean tidy
way to quickly access you know your your
database class and not constantly
connects your database every time you
want to query something so that's the
the PHP singleton pattern and we've
created a database wrapper that allows
us to connect to a database query and
return results</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>