<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Social Network with PHP: Deleting friends (37/37) | Coder Coacher - Coaching Coders</title><meta content="Social Network with PHP: Deleting friends (37/37) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Social Network with PHP: Deleting friends (37/37)</b></h2><h5 class="post__date">2015-10-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QFqvD3Kzcm8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now I'm going to look at how we can
delete friends once we have them added
and the way that we have everything set
up makes this very very easy so the
first thing that we want to do is make
sure we have a friend added at the
moment I am signed in as myself and I'm
friends with Billy so let's get going
the first thing that we're gonna do is
we are going to place a button under the
under this just to say delete friend or
delete or whatever you want it to say so
under your views we want to go under
profile index that's where down here we
said well we have all this logic to
determine what kind of state we're in
and this part here is you and the other
user of friends now we're gonna do this
a little bit differently because we want
to protect against a cross-site request
forgery attack so we're actually going
to create a form here so create a form
with an action we'll leave that empty
just for now I'm gonna go ahead and add
a post method and then we're gonna have
an input button here which is a submit
button and we're just gonna say delete
friend and underneath this we need a
hidden input and the name of this is
token and the value here we can use the
cross-site request forgery token helper
so all this is going to do then is just
show a button we can style it in just a
moment but we can now see delete friend
so let's just add a little bit of
styling to this we can add bootstraps
button class and then the button primary
class and that will give us a
normal-looking button so when we submit
this then it will just work as a normal
root and it work within the friend
controller but this time we have that
token in there so when I click this now
obviously at the moment this isn't the
work but the token will be in there and
will be protected against cross-site
request forgery so let's go ahead and
create this route then so remember under
your HTTP folder with an app we had over
two routes I'm going to head down to the
friends section and we can just copy
this just to save a little bit of time
paste it down here and this time we're
gonna have a post method
and this is going to be delete rather
than add and we want this to work on the
friends controller but this time the
method name is post delete and then we
can change the name of this as well so
it's friends delete so we can actually
change this in our view now remember
it's friend delete for the route so we
need to do is update this action its
friend delete and now we can start to
build up the controller which will
handle this and we can just test it out
so again under HTTP and then under
controller's head over to your friend
controller scroll down I'm gonna create
a new method in here and that was called
post delete and we are still accepting a
username in here and we can go ahead and
do what we want here so for now what I'm
gonna do is just died dumping username
and we'll see that we have a little
problem here we're not actually sending
through the username within this root
helper so we can do that just by passing
in an array with username and then the
name of the user we want to delete in
this case it's just user username simple
as that so now when we hit delete friend
you'll see if we refresh you'll see that
we go through and we just output Billy
so we can use this to look this user up
and we can go ahead and delete them okay
so over it now friend controller then
let's pull that user in so they need to
say user equals user where username
equals that username and we'll pull back
the first record now really the only
condition we need to know in order to
delete a friend is if the current user
is friends we don't need to do a lot of
the checking that we've done like has a
pending friend request because there are
really no other conditions as long as
you use it is friends with someone that
means that they can delete them so we're
gonna go and copy this and just paste
this down here so it's using our is
friends with method on our user model we
can go ahead and open up our user model
as well just so we can see this too so
under models and user if we just scroll
down or find its friends with that just
takes a
use it in here its type hinted and then
it will just check if they're friends
it's really really simple so if they are
not friends with we're just going to
assume that they're doing something a
little bit wrong so we're just going to
redirect the user back and now we can go
ahead and delete that friend but we
don't have an easy way to do this just
yet
I'm gonna make that easy by adding it up
in our user model so remember when we
did add friend we have this relationship
here between between friends and what we
can do is we can attach on our friend of
relationships this is a belongs to many
relationship so we can attach a record
by ID and what that does is it creates
this record what we can also do though
is we can detach this so if we say
public function delete friends will
create a new method in here it's pretty
much exactly the same thing we type in
the mod the model being passed through
and then we just do exactly the same as
we do here so we say this friend of but
we say detach and then we pass in that
users ID so now we can use this method
here within our controller so we do is
say auth user delete friend we pass in
that user model and then we can redirect
the user so we just say return redirect
back and then we'll give some
information so say friend deleted so
that's pretty much it we should be ready
to go now let's go ahead and test this
out so remember I'm currently friends
with billion here it's been accepted
we're going to go ahead and click delete
friend and that's gone ahead and deleted
them and we have to read them back now
if we want to be friends with them again
and they have to re accept the firm
requests and let's just test this out a
little bit further so I'm going to add
them as a friend and I'm gonna manually
update this in the database so I'm going
to sit accept it to one and what I'm
gonna do is I'm going to actually now
set this back like that so we're waiting
for them to accept their friend requests
if we were to send a request through now
a post request through we need to know
if this is going to work so
let's just make it a little bit easier
for ourselves again I'm gonna change
that back again and you can see that
there what I'm gonna do though is I'm
going to change accept it to zero and
then I'm going to hit this form you can
see we're redirected back nothing's
happened we've not deleted that record
it's just stayed exactly the same we can
only delete friends when we have
accepted them and when that record is
actually there now there's one more
thing that we need to test let's go
ahead and open up another browser and I
am actually signed in as Billy here and
you can see that obviously because I'm
friends with Alex I can see the same
button what happens if I click on this
let's see it says friend deleted but
then we still see this button now the
problem here is if we take a look at the
relationships between the two users we
have this friend of and friends of mine
because one user adds another user and
therefore the relationships are
different that's why we have this
friends method which combines the two
collections and then returns it so
there's a quick way to deal with this if
we go under delete friend at the moment
we're only calling the friend of method
or the relationship but if we use
friends of mine what this will do is it
will delete it regardless of who added
who so let's go ahead and give this a
test if we go over to Alex and delete
friend now you can see that that deletes
the friend let's go ahead and add Billy
back as a friend again and let's accept
this and this time from Billy it didn't
work before but now when we hit delete
friend because we're taking into account
both sides of this it goes ahead and it
works</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>