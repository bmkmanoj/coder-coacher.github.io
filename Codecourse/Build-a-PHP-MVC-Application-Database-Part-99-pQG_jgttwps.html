<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a PHP MVC Application: Database (Part 9/9) | Coder Coacher - Coaching Coders</title><meta content="Build a PHP MVC Application: Database (Part 9/9) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build a PHP MVC Application: Database (Part 9/9)</b></h2><h5 class="post__date">2014-09-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/pQG_jgttwps" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we're not going to be adding database
support to our small MVC application and
to do this we're going to be using
laravel eloquent ORM which is an object
relational mapper now that sounds a
little bit more complicated than it is
but basically if you've used laravel
you'll completely understand how good
eloquent is but it's a really easy way
to work with your database including
things like relationships accessing
things creating records etc you can head
over to the laravel documentation to
actually read more about this and all of
the functionality here you'll be able to
use within your MVC application now
you're going to need composer because
we're going to be requiring in the
database module of illuminate which is
laravel x'
framework like the core of the framework
so you will need to compose it installed
so you can head over to your command
prompt or terminal and hit composer and
have all access to this so make sure
that's installed beforehand and you'll
be able to follow along the rest of this
video so let's just revisit what we've
got so far in our MVC application in
terms of the models at the moment we're
using the model method which is
available within our controller class
and this will basically just pull in and
instantiate basically a new instance of
that model now models are obviously
stored under here and at the moment all
we have is a user model with a public
property called name so at the moment
what's happening within our application
is on home and index we're just passing
in Alex into the URL and this is being
substituted here and the way that's
working is it's picking it up here it's
grabbing the model it's setting that to
what Ivor's passed through to the URL
and then it's loading the view and it's
passing in this name here which under
views home index is just saying hello
and then whatever the name is so this is
fairly straightforward but to add
database support you might be a little
bit stuck here now eloquence is really
easy to actually pull in because we use
something called a capsule which is
built specifically
to allow you to use this outside of your
application so what we need to do first
of all then is actually pulling this as
a dependency now we're going to be
pulling in for point to point star so
there's a couple of ways we can do this
we can either create a composer JSON
file within our root directory so we
could create it in here so we could say
new file save this out as composer dot
JSON and then we can add in the relevant
information but I'm going to be doing
this through the command-line just it's
a little bit easier so the first thing
if you run just composer on your command
line you'll you'll get a list of
different commands here you can see here
that we have a search for packages or
show information about packages we
already know that the package is called
illuminate database so all we need to do
here is say composer show illuminate
database and that will give us
information if we just go ahead and get
rid of our composer file there like so
and it's saying here that no composer
Jason found so it's showing them from
packages basically that's where we we
just on that website so we're going to
be pulling in 4.2 dot star so all we
need to do here is say composer require
you can do obviously required dev but
we're just going to require in
illuminate database and then it asks us
which version that we want to pull in so
we're going to say four point two point
star and that'll pull in that as well as
other dependencies it requires so we can
check which dependencies have also been
pulled in if I just close all this off
inside of the vendor folder which has
just been created for us this contains
everything we need you can see that
carbons been pulled in because when we
use dates so for example created our
updated date on our database that pulls
in and it's an instance of carbon it's
extends carbon so we can actually use
carbon which is a really good PHP date
manipulation class so now that we've got
this included in what do we actually
need to do we're inside in it dot PHP
we're currently loading in the core
files that we need that's app and PHP
app
controller dot php' but what we need to
do is require in composer autoloader and
let's do this now that's going to give
us the functionality of what we've just
pulled in with composer so this is the
auto load PHP file just pull it in all
your dependencies so all we need to do
here is go back one I'm going to say
vendor auto load up PHP like so so
nothing will change here all we're doing
is loading that in but we're not making
use of anything yet
now we could either use capsule and add
our connections and boot eloquent inside
of this in it dot PHP file or we could
do this within another file and then
require it in and that just helps two
separate things so inside of app let's
create a new folder you file here called
database PHP this is going to contain
without database related things
there probably better ways to structure
this in terms of pulling in config but
we're just going to put everything we
need in this file just to separate as
much as we can so down here I'm going to
require in database dot PHP like so so
inside of database now all of that
functionality will now work within our
application and we can do what we need
I'm actually going to do is inside of
composer JSON I'm going to pull in a
class map here sorry autoload I'm going
to pull in a class map all this means is
when we go to use things like the user
model or ID no a topic model whatever
you're creating within your models
directory we want these to be auto
loaded in so we can use them and that
means that we can use them globally we
can do what we want so in this case the
class map just contains the directory to
your classes in this case it's app
models so over in the terminal now we're
going to do a composer dump auto load
and that's going to go ahead and allow
us now to use this user class wherever
we want so we can do things like inside
of if we just tidy this up a bit we can
do things like inside of
for example we could do user find one or
something like that we can't actually do
this at the moment because we're not
pulling we're not setting up her
eloquent it's inside of database we need
to do that now now capture it's
obviously namespaced
so we're going to use that namespace
here it's illuminate database capsule
manager and we're going to call that
capsule so if you're not familiar with
this it's just basically saying well we
want to use this namespace as this and
that allows us to do something like the
following capsule equals the new capsule
otherwise what we'd have to do is we
would have to place this namespace just
before that like the following and you
can do that but it just makes it a
little bit easier especially if you are
namespacing the rest of your application
so now we have this capsule instance
here and this basically allow us to do
things like add connections and then
boot eloquent so we can actually start
to use it so to add our connections we
say capsule add connection and there are
other things you can do here as well but
we won't be covering these so we need to
do things like define the driver in this
case we want to use MySQL and I have a
database already I'll show you that in a
moment we need to choose the host so all
this should be familiar to you if you
work with databases before we also need
to select the username obviously in this
case my username is root tier and my
password is exactly the same and we also
need to define the database that we're
actually using in this case I'm just
going to have one called website I'll
just pull this up now there is we've got
all these records in here that I've been
creating delete them so we've got four
records in there at the moment and we
can set the character encoding so in
this case it will be utf-8 and we also
want to set the collation as well in
this case it's utf-8 unicode CI and what
you can also do is you can choose a
prefix for your tables when you create
them so
we could do something like code course
underscore but I'm not going to be doing
that so I want to just leave that blank
plug so so now what we want to do is we
want to say capsule OOP eloquent like so
so this won't change a thing we're still
accessing our plane model here it's
exactly the same we're not actually
using eloquent at all now if you work
with laravel you'll know that we can
extend eloquent and what this will do is
because we're extending eloquent this is
going to give us all of the
functionality that we need to do things
within our user model so for example
what we can actually do is if we head
back over to our own controller we can
then do things like user find one that
would find the user by the idea of one
and then we can access say their
username or you could do user create and
you can go ahead and choose which user
name you want to give them and for
example which email you want to give
them but we'll do that in a moment
so we've extended eloquent inside of
here but we're actually going to get an
error now you'll see why in a moment
when i refresh here we see class
eloquent not found now the reason it
can't be found is because there's no
class called eloquent it's named spaced
so again we need to say use illuminate
but this time we're going to say
database eloquent not capture we've used
capsule to pull in this and connect and
everything I'm going to be using the
model class and we'll use that as
eloquent like so so now we have this
eloquent model available and when we
refresh we get the same result but again
we're still not doing anything useful
for this with this because all we're
doing is inside of our home controller
we're just grabbing the model setting
the name on that public property and
rendering the view so I'm going to
create a new method here I'm going to
call this create and this is going to
take
a username which is going to be blank by
default and it's going to take an email
now this is not a great way to for
example create a user account we
wouldn't do home create Alex Alex at Co
course comm this is the username to be
inserted and this is the email to be
inserted we wouldn't do this but in this
case we'll leave this as an example and
what would do is inside of here we'll
use eloquent now to create that actual
record so we need to do a little bit of
tidying here because we've got this
model being loaded in here but I want to
load this in the constructor so we're
going to say public function construct
you don't have to do this I'll show you
the alternative way in a moment and up
here we'll create a protected user
property and all we're going to do
inside of construct is this user equals
this model user like so and we can in
this case get rid of this if we wanted
to or just say this user like that so
this is going to work exactly the same
when we gone to our home index and pass
a parameter through here ah now we're
going to test out the create here so
what we can actually do now is we can
say this user and then we can use the
methods that are available to us with
eloquent so create for example so in
here we can now do create and say
username is username and email is email
so now this is going to use whatever's
on the user model which in our case we
have accessed that eloquent stuff and
it's going to create it except it's not
because we need to adjust a few more
things so let's go to home create and
let's create a new record all together
so this remember is the username we're
passing into that method and this is the
email so when I hit enter we
unfortunately get an error and this is
because we have a mass assignment
exception now within eloquent this
basically forces you which is good to
provide which fields that you want to be
fillable so what we do here is we say in
fact let's keep that public name there
all we do is we say protected fillable
and then we give an array with the
fillable fields that we want to protect
ourselves against mass assignment so in
this case it's username and email so
we're inserting your username and any
now they are now allowed however we're
also going to get another error and this
is column not found updated at now if
you've not worked with eloquent before
you need to know that what it will do is
when you're creating a record it will
automatically assume the inside of your
database table here so this is the
structure you have a created
at which is a timestamp and an updated
at which is also a timestamp and the
reason for this is it's extremely useful
because when you create a record created
at will automatically be populated for
you when you edit a record and so for
example if I edited this the updated app
field will be created as well or updated
rather so we can either insert these if
we need them or if you don't need them
you can create timestamps property and
set that to an empty array otherwise you
could do things like created at and
updated at but in this case there's no
need to do this so we're just going to
get rid of these and say well we're not
including timestamps here so if we hit
enter on that now that should have
created that record for us so when we go
ahead to content and refresh we've now
got that record in there let's take a
quick look at what it looks like if we
do want the timestamps in there so let's
head over to our code or our database
we've already got these in here
so when we create this again now where
are we head over to our database over to
content you can see that that's
automatically created these so I
mentioned earlier that we have an easier
way of doing this if you don't want to
pull in all this constructor there's no
real need to do this with eloquent what
we can do is we can get rid of all of
this and instead we can access the user
model like this with a static method so
this means that we remove the need to
have to pull in this using our model
method so I'm just going to get rid of
let's get rid of this and there we go
we've created another record exactly the
same so we've just used the static
create method here with the user model
like so so that's how easy it is to use
eloquent with inside of another
application and if you've never used
eloquent you now know how to update your
small MVC application to use eloquent
database functionality and this is a lot
easier than say injecting in a PDO
instance because now you've got all of
the rich functionality the eloquent
provides and like I said if you've not
used eloquent you can head over to the
laravel documentation and read about
everything here just to make sure you
completely understand how to use it and
it is really straightforward so that's
how we add database support to our MVC
application</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>