<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Social Network with PHP: Searching for people (12/37) | Coder Coacher - Coaching Coders</title><meta content="Social Network with PHP: Searching for people (12/37) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Social Network with PHP: Searching for people (12/37)</b></h2><h5 class="post__date">2015-08-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NKC-ffWGDbM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">searching for users is actually going to
be pretty straightforward but there's a
couple of things we need to do include
building our partial for the use of
block and that will basically show a
user's profile image their username or
full-name and it will also show their
location if they have one and we can
reuse this throughout the site so we're
going to be creating a reusable template
okay so the first thing I'm going to do
is just go and sign up for a couple more
accounts so I'm gonna choose a couple of
names here and we'll just sign that user
up and let's keep an eye on our database
you can see we've got another user now
and I'm gonna sign up again with Billy
and then that's dick Billy code cost
comm and sign Billy up too okay so now
that we've got a couple of accounts here
make sure you do register these via the
form because we're going to be using
these accounts later to sign in with so
make sure you remember the password as
well and I'm gonna sign into my account
so I can search for these people from my
account so up here is our find people
form we're gonna be able to enter a name
like Billy Garrett or just Billy or just
Billy or even just the last name Guerra
it's going to be a very basic search but
it will be enough for now and you can
expand on it later you could use a
solution like elastic search if you
wanted to index the data that's being
stored whatever you want to do so the
first thing that we're gonna do then is
create our search controller so if we
come under HTTP controllers let's create
a new file in here and of course we'll
call this search controller dot PHP and
let's pull over our home controller just
so we have the structure in here
okay so for our search controller the
method name is going to be get results
and we are obviously going to return a
view here and that's going to be search
dot results and eventually we're going
to be passing the user data that we find
through in here and of course let's
change the name of this controller to
search controller okay so now let's
create this view it's pretty
straightforward for you so over in
resources V
let's categorize this under a search
folder and under here let's create a
file called results or PHP so search
results so in here then obviously this
will extend the default template so I'm
just gonna pull that over from home I'm
gonna get rid of this and in here are
gonna be my results so now we obviously
need to add a root for this so we're
gonna need to be able to attach that
form that we have in the navigation to a
root so when we submit any data through
to here that will go through so that's
open our roots file and let's come down
here create a new section called search
and here we're gonna have a get root to
search and we want to choose chatty HTTP
controllers and that's how search
controller remember our method name is
get results and we're gonna call this
search dot results because we might
later on add something else under the
kind of search namespace so now that we
know the name for this search results
let's hook this up in the navigation so
come over to templates navigation and
where we have our form just here we're
going to go and set the action to route
search dot results and while we're in
here actually I'm just going to hook up
the brand name here or the logo if you
have one to the home page okay so let's
try our search let's type in Billy and
hit search and okay so we've forwarded
through to this what we need to do here
is under search results I forgot to give
this a blade extension so that will now
give us the results that we need perfect
so for each user that we find we're
going to need to display them as a
little image so we're gonna need to
display their profile picture eventually
when we get around to doing that we're
also going to need to display their
username or full-name and of course we
can display their location if they have
one so we need to create a template here
that we can reuse throughout the site
because we're going to be reusing this
quite often it's on two views I'm going
to create a new folder called user and
under here I'm gonna create a new folder
called partials so as part of the course
downloads you'll have the partial
template for this so if you open this up
we can go ahead and create a new file in
here called user block dot lady PHP
paste this in and this is basically a
media object within bootstrap and it
gives you an image on the left here
which we don't have anything in just yet
and then we have a body in this case we
just have a heading here with a
hard-coded user name in but down here we
could also include some text as well
like the location so eventually when a
user has a location we can output it on
that so let's try and just include this
into the search results page just to see
what it looks like on the page and then
we'll get on with the actual search so
over on our results page let's mark this
up all we're gonna do here it's pretty
straightforward mark up your search for
now where do we get this search input
from well if we open the navigator again
under templates partials you can see
that we have a input type of text here
and the name is query so this is going
to be our our name that we pick up so
you can obviously change that but in
this case in the results here we're
gonna say your search before we're gonna
use the request facade use the input
method and then say query like that and
this will be automatically escaped
because blade now automatically escapes
with outputting so we're just gonna
surround that in quotes
and down here then let's create a row in
bootstrap so it's a div for the class of
row and let's create a column a column
that's twelve columns on large so in
here then I'm going to include this
partial that we just created just so you
can see what it looks like so use of
block and let's see what this looks like
now there we go so it doesn't look like
anything at the moment but we haven't
done profile pictures just yet so this
looks a little bit strange but if we
were to under the user block eventually
half the location you'll see that that
looks slightly better and then you'll
have the image just on the side here but
this will obviously be pushed in a
little bit so for now this will do
because we know that we have a list of
things that we've searched for and what
we can do is start to actually write the
query that we need for our search so
this is pretty straightforward what
we're going to do is we're going to
check if the query is there first of all
if it's not going to just return back
home so I'm gonna store the query in a
variable just here and we're gonna say
request input query in actual fact what
we could do is use the same request
method as we've done before to keep
consistency so if we head over to the
Earth controller again and we just grab
this request here type hinting that
request and then we head over to grab
the import for this like that and what
we can do is we can say query equals
request input query and if we just do a
die dump on query just to make sure
we're getting the right value so if I do
a query of Billy there we go
so if we don't have a query this will be
a null value if it doesn't exist then we
want to return redirect
back to the Home route obviously there's
no need to perform a search for it out
any query so we're going to be searching
on user model so I'm gonna import the
user facade just up there and we are now
going to start searching now this is
very very basic not as fast as you would
expect from a system with lots of users
so you know if there are millions of
users on the platform this is going to
perform very slowly you're better off
using a solution like elasticsearch but
for now this will do and it will give us
enough flexibility to find people so I'm
going to use a where clause here but I'm
going to have a raw DB statement in here
and that roar DB statement is where
concat so it can caseinate in the first
name a space and the last name and then
after this we say like and then the
query surrounded by percentage signs and
then what we're going to do is say or
where user name like
and then the query again so you can
obviously modify this if you want if you
are brilliant at SQL you could perform a
much better search than this but
generally all we're doing is we are
doing a normal eloquent where clause
where concatenation the first and last
name the space in the middle and we're
comparing that to the query then we're
doing the same with the username as well
so we can search on usernames so let's
go ahead and just kill the page and
output users get it obviously pulling
through a collection so if we refresh
now okay so we get class user not found
of course what we need to do here is
import chatty models user rather than
just user and of course again we have
this DB facade that doesn't exist under
this controllers namespace so we need to
import that too let's just make sure we
don't need anything else here now I
don't think we do and we have an
undefined variable user and that's just
my mistake there killing that so third
time lucky there we go so we've now got
a collection of one item which we would
expect because we do have a user called
Billy in the database here and if we
just pull open the attributes here we
know it's the right user let's just try
manually modifying the first and last
name of one of these users just so we
can see it working so we've got Dale
Garrett and Billy Garrett
so what I'm gonna do now is I'm going to
search for Billy Garrett
hit search and we get that one result
again which is that Billy result if we
were to just do Garrett we now have two
results because there are two people
with the surname Garrett or at least
stored and you kind of get the idea
again I can search just on user names
and that will bring me back the user so
we've now got the results based on that
fairly flexible search we now just need
to pass through the users that we've
found into our view so we can loop
through them and output them
so under our results then what we're
going to do in here is we can leave the
user block there but we're gonna put
this inside out loop in just a moment
and we're just going to say for each
users as user will end that for each
there no we're going to do is include
this inside of there like that but if we
don't have any results we obviously
don't want to do that so let's create an
if statement up here if no users count
otherwise and then if we do have a count
we can just loop through them so here
we're just gonna say no results found
sorry okay so let's go ahead and perform
a search let's go over to here and type
Billy and there we go so we've got one
result here we've obviously hard-coded
the value or change that in just a
moment if we type in Gera we get two
results which we expected so we can now
just modify our user block to actually
reflect this new user data so for the
user name in here we're going to say
user get name or user name and then down
here we're gonna say if user location
we're going to output the user's
location like so now there's quite a bit
we don't actually have in here we don't
have the profile link to the profile
page because we haven't built that yet
we also don't have the avatar URL either
but we can cover these in the next
couple of steps so let's just leave
these out for now the only thing that we
can really do is the alt text the alt
text could just be something like the
user's full name so we could just say
user get name or
user name you could say it was their
profile picture or something but anyway
when we refresh now okay so of course so
this will mean that I have not called
this as a method that's refresh and
there we go so we've got Dale Garrett
we've got this image with our alt text
in there that is now showing the kind of
outline of this image and eventually
we'll be able to click on these to go
through to the users profile eventually
add them as a friend and see what
they've posted on their wall</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>