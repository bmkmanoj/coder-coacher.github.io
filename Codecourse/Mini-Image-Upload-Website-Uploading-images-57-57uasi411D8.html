<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Mini Image Upload Website: Uploading images (5/7) | Coder Coacher - Coaching Coders</title><meta content="Mini Image Upload Website: Uploading images (5/7) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Mini Image Upload Website: Uploading images (5/7)</b></h2><h5 class="post__date">2016-06-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/57uasi411D8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now that we have very easily set up load
care up and we have our widget in place
we can start to process image uploads so
let's focus on that first and then we'll
go and style up the widget just to make
it look a little bit nicer so really
what we want then is to be able to
upload an image and then we want to see
an upload button to confirm so by
default the behavior that we'll see when
we upload an image with upload care we
can either drag a file in or click the
button and we'll see the following so
remember we set cropping to free
cropping so I can crop this however I
like I hit done and then I just see the
following so what we want is some kind
of upload button to allow us to then
click upload and actually process this
on the back end so to do this we will
first of all need to modify this so this
is wrapped in a form because obviously
we want to send this off to the back end
eventually so the form action then is
going to be just a hash for now we'll
leave this as a hash and then we'll hook
it up to a new route in just a moment
and of course we want this just within
our form now if you're not too sure what
this produces if we go ahead and inspect
this you can see that what we get is a
div with a class of upload care widget
this is how we're going to be able to
start the actual button we have an input
type just hear of hidden now if we just
view the page source you'll see that all
we get is an input type we have a role
here we have the name which we can pick
up on the back end and we obviously have
some data attributes just here as well
so it's pretty straightforward the way
that this works now what we want then as
part of this is a separate button which
will initially be hidden and then it
will be enabled when we actually upload
an image so let's create a button just
here and give this a type of submit so
this will go ahead and submit our form
and inside of here we will write upload
so we have now a button just here now we
only want this to display once we've
uploaded an image and this is where our
Styles start
in so we'll start to star this out i'm
going to create a single style sheet of
course if you're working with SAS or
less you can go ahead and compile into
this but for now we'll just create an
app dot CSS file and we write all of our
stars just out in here okay so to start
with them we want to style our button
just within our form so let's create an
upload form style and we'll go ahead and
set the text align to Center oh just
form part of our styling and what we're
going to do is create an upload form
button so if you're wondering what these
underscores are using the BEM
methodology of CSS where we have
basically a block here and then we have
an element within that block so our
block is out our load for so in here
then we want to set the display to none
on that button so if we head over to
home and we give this a class of upload
form so upload form and then this button
here will give a class of upload form
button and just want to map this I'm
going to set the method here to post
just so we don't forget so obviously we
need to pull out style sheet in so we
can go and do this over in our apt wig
file so if we come down to about here
and create a link element we have our
href in here now we need to set this as
an absolute path so what we can do is we
can say app dot request grab the base
URL and then in here we can say CSS app
dot CSS this will mean that will grab
the base URL and will definitely load in
our styles so you can see that they've
already taken effect and if you take a
look at the head of your document you
can see that we have that href just in
there okay so now that we've got this
done then once we have uploaded an image
EG we've either dragged it in or
selected one we want to be able to show
that button so how do we do this well we
have event handlers within upload care
that we can control so what we want to
do is just head over to our templates
here
and just down here we want to include a
new block and this will be specifically
for any scripts that we want to load in
individually on each page so all this
means is that now over on home what we
can do is create a new block down here
called script and we can specifically
write out any scripts we want just for
this page now what we want to do is say
widget is an upload care single widget
and in here we want to pass in the
selector and of course here we'll need
some script tags as well so let's just
add these in just here so for the
selector then this is literally just
going to be an element with a roll of
upload care uploader remember we saw
that earlier when we went ahead and view
the page source we have this input here
with the role of upload care uploader so
essentially this widget now represents
the widget that we have on our page so
to do this we can say something like
widget on upload complete and in here we
can pass in a call back to be run when
this is complete so to test this out we
can do a console log uploaded and we can
just test that this works so over here
then if we just correct this and block
over in here sep end block we can now
see that when we drag this over hit done
you can see that over here we now see
uploaded just in the console so pretty
cool and that means that when we do
upload an image we can show our button
so we can say document query selector
and in here we can say upload form
button and we can say dot style equals
display inline block so we're just
modifying the styles of this
pretty straightforward so now that we
have this done we can go and check this
out drag an image in hit done when
that's finished we now see that button
we can click this button and we go
through and obviously store our image
obviously at the moment we see an error
because we're not actually posting
anywhere useful so that's the basics of
our button let's tackle them the upload
process so we can get this into here and
then we'll make this look a little bit
prettier so what we need to do is head
over to index we need to set up a new
route so in this case it's going to be
something like app post upload we have
our cool back as usual and we can use a
pin here so it's in scope and we can do
anything we like with that and all we
need to do in here then is first of all
generate that hash and then actually
just upload the image so what we need to
do is be able to pull in a particular
request so or a request item and that is
the file ID if we go over to here we
know that this so-called file ID so we
need to pick this up somehow within here
so just at the top here i'm going to use
symphony component HTTP foundation
request and now with requests i can pull
this just in here and if we just test
this out we can do a VAR dump on request
and we need to somehow hook up to this
so we want to give this a name and to do
this we say bind image upload so this is
literally just the name of this route
and we can go ahead and add a forward
slash there everyone so now we need to
be able to over in home say this is
where I want to post this through to so
to do this we need to use another
service provider this is the URL
generator service provider and this will
allow us to generate a full URL to that
new route within
form so just over one index dot PHP and
this is the last provider that we are
going to register we just want to say
register new cylex provider and this is
the URL generator service provider and
what we should now be able to do is over
in here over in our home twig we should
be able to grab this so to do this we
just say URL and then we give the name
of the root that's image to upload so
down here so now when i refresh this of
course should be provider like so and we
see that we get an error here and that's
because we need another dependency
pulled in which is our twig bridge so
let's just quickly pull this in now and
then we should be good to go so it's
symphony and twig bridge if you want to
include this so we should now see that
that will generate a URL to that route
so you can see here public upload we
know that the method is post and because
we already have our route pretty much
set up ready to go if we just come down
to it we're just doing a VAR dump and
our request so we can see what this is
all about so now if we just choose an
image so let's just go and drop drop
this in here and hit upload you can see
that we get this request object back now
from this we can extract the data that
we get back from upload care so this is
pretty straightforward and now we're
just going to go through the process of
storing this and then we will start to
star this out so the first thing that we
want to do is check if the file add
exists or not now to actually grab the
file we can do request get file ID so
let's just take a look at this really
quickly now so let's pull an image in
hit done hit upload and you can see here
that we get this string just here so
don't worry about this too much at the
moment is because we
returned a response but this is
essentially what we're going to be
storing within the URL part of our
database okay so we want to check if
this is null so to do this we can just
create a basic if statement here and
we're going to say if request get file
ID is null then what do we want to do
where it really depends far we can go
and redirect because we really don't
want to process this so we just do a
return on app redirect and then we can
use app to grab our URL generator that
we have pulled in and we can generate a
link to the home page now of course we
haven't named this yet so we can go and
bind in home so basically if no file
exists and we're trying to submit this
form we want to go and redirect home now
to test this what we can do is just get
rid of this display of none refresh hit
upload and you can see that we're not
redirected so what it might need to
happen what we might need to happen is
we might need to check that this is an
empty string maybe in fact we can test
this by just grabbing this doing a VAR
dump on it and killing the page here and
let's try and submit this without
anything in so we can take our stars
back to showing this button hitting
upload and yet we just get an empty
string so we know that if we well we can
get this to display again we know that
we now want to check it for an empty
string and redirect otherwise so now
when we hit upload you can see that we
are just simply redirected back to this
page we're not actually processing
anything at all so it's really important
that we think about these kind of things
because we don't want to store and a
completely empty file ID will you know
end up getting into all sorts of trouble
so now that that's done then let's just
go and put back out display of none on
our buttons we don't want that to
display
and we can start to store this now so to
actually grab the file we want to say
app upload care get file now the widget
will have already uploaded this to
upload care so all we want to do is say
request get file ID now if you don't
have automatic uploads turned on and you
can find this over in your dashboard
over an awesome image and you can see
that we've already uploaded a few files
just hear what you can actually do is
disallow automatic far storing now if
you do want to disallow this for any
reason what you want to do is then say
file store but otherwise just doing this
to grab the file if we need to use it at
all is enough we don't need to do
anything else so now that we have this
done and what we can do is just store
this in the database so to store this
I'm just going to create a variable
called store and this is going to be app
DB and we want to create a prepared
statement obviously cuz we're inserting
data that's potentially from a user I'm
just going to pull this down and start
to create my query so I'm going to
insert into the images table I want to
insert the hash the URL and the created
at date and the values that I want to
insert and of course these are going to
be placeholders so it's going to be a
hash URL and the MySQL now function to
go ahead and store that and now I can
execute this query so I can just say
store execute now the hash we're going
to be generating using the random bytes
function within PHP 7 now if you're not
using PHP 7 you can go ahead and use any
other method here this loads of
different ways you can do this but of
course this is a needs to be converted
over so we're going to use the binary to
hex function to do that and that will
just generate us a 20 character
hash and now for the URL we use the file
that we've grabbed from upload care and
we say get URL like so so we don't
necessarily need to do this but if you
do want to do anything else with this
then it's nice to have this here so now
that we have created this record in our
database we want to redirect back to the
homepage so let's return app redirect we
want to redirect to app using our URL
generator and we want to generate a URL
to the home page so we check if we
actually have a file that has been
uploaded and selected we grab this far
from upload care we store it in our
database along with a hash and then we
go ahead and read a right back thigh own
page and that is it for the file upload
process as simple as that so let's test
this out then so I'm going to go ahead
and drag an image over I'm going to crop
this just a little bit just so you can
see how this looks I'm going to hit done
I'm going to hit upload and now we
redirected back over in the database you
can see that we've stored not only a
hash but out you're out to our image now
if you can see these properties just
here these are all of the cropping data
on the content delivery network for
upload care so if I were to go and say
duplicate this tab paste this URL in you
can see that that is the cropped image
now this is in fact an original image
just processed on their content delivery
network so if I were to get rid of that
you can see that I get the original
image now we'll look at how we can
manipulate this later when we actually
grab images back but for now we've
uploaded an image with upload care or
technically really just stored the URL
which we can use to display later on and
of course that's exactly what we're
going to be doing when we out put these
on the homepage so just to finish up
then we are going to style this up so
the first thing we want to do is head
over to app CSS and start to create some
more styles around this so what we can
first of all do is just set out
container to have a width of a hundred
percent so we'll do a little bit more
set up here and then we'll be ready to
go and I'm going to place this just at
the top now what you also want to do is
pull a fairly nice font in so this looks
a little bit better in terms of the
button so i'm going to be using google
fonts to do this and i'm going to be
using the railway font of course you can
choose whatever you want now we're going
to go ahead and use this so i'm going to
select normal 400 and i'm going to go
down and pull in this style sheet just
here so we can pull this into our
template pop this at the top just here
and I'm just going to tidy this up just
a little bit because the formatting is a
little bit odd so we're gonna change
these two double quotes and I'm going to
get rid of the type because we don't
need that in there so now we can set our
body font so the font family here is
going to be railway and the full-back is
going to be sans-serif because it's a
SAN serif font and if we automatically
see here this is looking a little bit
better so now of course what we need to
do is style up our widget here just to
look a little bit nicer and this
includes the drag and drop so we want to
improve the look of this as well based
on our application so we are going to
create a star for our upload care widget
and essentially if you just right-click
and go ahead and bring up your
inspection for this and your elements
part of your developer tools you can see
that we've got our upload widget class
here and we've got all of the other
classes and this is how we style and
upload care button so for the upload
care widget then we want this to be a
width of one hundred percent and we want
to change the margin we want 40 pixels
on the top we want 0 on the left and
right so we're going to say 20 pixels on
the bottom so it's 40 20 on the bottom
and then 0 on the left and
right and we also want to style up our
upload care widget button again this is
just the class at the upload care give
to their widget button and we want to
set the font weight to maybe 600 and
what we can actually do is we can modify
this and pull in another font weight as
well so what we do is we say 400 and 600
just at the end of this font star sheet
so we can do this over in app and we can
just say 400 and 600 and if we just head
over to our home page we can see that's
already looking a lot better so what we
also want to do is sort out a drag and
drop area so if I drag this in now you
can see it's looking a little bit odd so
to get around this what we can do is we
can add a class for upload care widget
drag-n-drop so drag and drop area and
all we want to do is change the padding
we're going to set this to 1m we're
going to set the margin top 2 minus 2.3
ms and we're going to set the border
radius which has a default border radius
on it back to 0 like so so now we should
see when we are over this looking a
little bit better perfect so that is our
actual upload widget button style but
when I go ahead and add an image and
maybe crop it and do whatever I want we
still have this horrible button just
down here so we want to create a general
button class which we can apply to any
buttons and for this we're going to set
a padding of 20 pixels on the top and
bottom and 40 pixels on the left and the
right we're going to create a border of
0 we're going to inherit the font size
so we're going to say inherit and we are
going to set the font weight here to say
600
we're going to set the background color
to a gray color like CCC we're going to
set the foreground color to a slightly
lighter color so 777 and we're going to
set the cursor to a pointer so it
actually looks like we can click on it
because by default we don't see that so
now when I upload an image hit done you
can see once we apply that style so if
we go to home and we give this a class
of button go ahead and drag an image on
hit done there we go so we've got much
nicer looking button we can click on
this we've uploaded the image and it
will eventually display here so we now
have two images that we can go ahead and
preview and notice this one I didn't
crop so we don't have these options for
the upload care content delivery network
so this is great we've got to the point
now that we can actually upload an image
but of course what we can't do is go
ahead and display our images on here
just yet now remember earlier we already
created the query to pull in all of our
images so really all we need to do is go
ahead and pass these through to our view
and pull these back and stall them how
we want so let's jump over and do that
in the next part</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>