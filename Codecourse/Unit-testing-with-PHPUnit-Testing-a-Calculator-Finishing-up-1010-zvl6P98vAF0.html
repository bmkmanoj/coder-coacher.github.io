<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unit testing with PHPUnit: Testing a Calculator: Finishing up (10/10) | Coder Coacher - Coaching Coders</title><meta content="Unit testing with PHPUnit: Testing a Calculator: Finishing up (10/10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unit testing with PHPUnit: Testing a Calculator: Finishing up (10/10)</b></h2><h5 class="post__date">2017-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zvl6P98vAF0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we're now going to build our
main calculator class which will take
any type of operation whether it's
additional division which we've built or
if you want to have a go at testing and
then building subtraction and
multiplication then you can go ahead and
do that as well
so obviously we want to first of all
create our tests let's start by just
creating our calculator test in here
like so and we'll again as always pull
over our sample test just so we have our
structure in there and let's go ahead
and start to write this out so let's
change over the class name to calculator
test and the first thing I want to test
is whether we can actually set
operations now we're going to give the
ability to set a single operation but
we're also going to give the ability to
set multiple operations in one go if we
want to and really when we're building
this claim thing we don't know how this
is gonna look this is the whole point of
writing tests to start with so let's
start with a single operation because
this is pretty straightforward and we
will say can set single operation like
so so let's go and first of all new up
an addition so we can just say new app
calculator addition and we will go ahead
and use this as normal so we're now
using things that we've already unit
tested so in here we're gonna say set
operands and we'll save again just 5 and
10 we'll just keep it really simple so
now we're gonna have our calculator
class so this is going to be a new app
and we can place it inside of calculator
so new app calculator calculator and for
this we're going to say that we want
from that calculator Bo to be able to
set an operation like so and this
operation is going to be addition now
how do we test that we have this
operation in there
well we could say something like this
assert count 1 calculator get operations
like so and you can even do an assertion
to check that what you get back from
this is an instance of a
so we could add that in in a minute
we'll see how we go on so let's go ahead
and run our tests we get a failure
because we don't have our calculator
class so let's go ahead and create this
first of all
so everyone calculator let's go and
create a new calculator PHP class and
let's make this pass so the name space
is obviously app calculator and our
class is calculator and let's just refer
back to our test once again we know that
we have set operation so let's create
this method set operation and I want to
type int this so I can type int now to
this interface because I know that any
operation needs to implement this
interface so let's go ahead and do that
and say operation and now we probably
want up here something like operations
to be an array like so and then we just
want to say this operations and we want
to append on the operation that we've
passed in like so so let's go ahead and
create this operations method to get all
of our operations and that's as simple
as just returning this operations like
so so let's go ahead and run our tests
and we get green so we know that we can
now set an operation okay so what we now
want to do is implement another test
because we want to be able to set
multiple operations and then later what
we'll do is we'll create another test to
check if these are ignored if they're
not instances of our operation interface
so if that doesn't make sense bear with
me we'll go ahead and create this test
first
so can set multiple operations and let's
go ahead and check this out so let's say
we had two additions that we wanted to
pass into our calculator
maybe addition one and then we had a
similar one here addition to it doesn't
really matter what we're adding up so
let's go ahead and just change this over
as well and we can change these as well
so that's say to add two okay so we have
a calculator here as normal now what
we're going to say something like
calculator and we would probably have
set operations and in to this we would
have an array
of separate operations so addition one
and then addition two so we want to do a
similar assertion check that the count
is now two obviously this is going to
fail initially let's go over and run
this and we get a failure brilliant so
set operations doesn't exist let's go
ahead and implement this and then we'll
look at a couple of the problems so
let's go ahead and write this out set
operations this will take an array in
like this which immediately says to me
well I can pass anything into here now
so later we're going to have a check in
here which will check if every item in
here is an instance of operation
interface so to set operations we would
just say this operations and we would
set this to a Rain merge using the
operations we already have in here
merging in the operations that we've
passed in so we go ahead and run this
and we get green so we know that that
now works so now let's go and create a
test to check if we pass in something
that isn't an operation so something we
can't call calculate on it will fail so
let's or at least it will ignore it so
let's go ahead and create this test so
create a test here okay so we're gonna
say operations are ignored if not
instance of operation interface so again
I'm making these really long and
descriptive so any one kind of glancing
at it or even yourself in future carts
again it knows exactly what this is
doing so let's go and grab over an
addition so we can use this to test it
out like so and let's go and create a
new calculator instance just here and
let's say calculator set operations and
we only need to test this for set
operations because we know that we will
get an error anyway if we try and pass
anything in to set operation the
singular if it's not an instance of
operation interface because we've type
in today so into this I'm going to pass
in addition which is an instance of
operation interface we know that we can
call the correct meth
on it and I'm gonna pass in something
silly so we are going to assert here
that the count is one because we want
cats to be ignored but we want to keep
this one so it should end up with one in
there you could pass him multiple here
as well if you wanted to like so so
let's go ahead and run our test you can
see here failed asserting the actual
size 3 which is addition then cats and
dogs matches size 1 or expected size 1
so this is a problem we need to fit fix
this up and then our testable parts so
over to calculator in here how might we
do this well we're going to look at a
pretty rough way of doing it first of
all and then we're gonna go back and
refactor it and just at this point again
as a side note it's important to note
that when you're building things you
don't need to implement some kind of
rough functionality for the sake of it
but later on you might then refactor it
and that's the whole point when we were
a factor it later on we know that after
we've refactored something as long as we
still get green then it was a successful
refactor so let's go ahead and do a for
each here and I'm just gonna use this as
a means of filtering out any operations
that I don't want so I'm gonna say as
index so we have that available and then
operation and I might say let's say if I
wasn't really too sure what I was doing
I might say well if the operation that
we have in this loop isn't an instance
of the operation interface then I might
just use unset to get rid of it now
that's not the best way of doing things
so we'll implement it now so it passes
and then we'll go ahead and refactor
this so this is just filtering out
anything that isn't an instance of
operation interface and we should now
get green brilliant okay so I'm going to
refactor this now and then as long as I
get green still I know that it's worked
in actual fact we're gonna refactor it a
couple of times so we're gonna get rid
of this and I'm gonna say well instead
it might be better to have something
like filtered operations using the array
filter function which is what it was
built for now into this we passed in
operations then we have our callback
just here like so and into this we get
an operation for each loop of this now
in here I could go ahead and say well
if the operation in here isn't an
instance of so let's go ahead and say
instance of operation interface and
we'll just say if it's not then we want
to return false otherwise down here we
want to return true so this is
effectively doing the same thing just
using a rate filter which is a little
bit cleaner let's run our tests and it
looks like we have got an error so this
is a kind of classic example what has
gone wrong here well when we're kind of
developing without tests we might think
right I'll build this in quickly and
then I'll go ahead and deploy it
everything breaks now in this case what
I've not done is I've not passed it in
the filtered operations to this so it's
not merging in the correct thing so I go
ahead and fix it up I run my tests and
we get green now I'm gonna further
refactor this I think because really
what we're doing here is a little bit
more work than we need to with a red
field so we return false if we want to
get rid of something out of an array
we've returned true if we want to keep
something now in this case I could get
rid of all of that and instead I could
clean this up even further and just say
return operation instance of and then
the interface I'm expecting which will
return a true or false
so now run the tests again and we get
green so we've successfully refactored
so from the original solution to that
other solution finding an error and then
going ahead and refactoring even more we
still get green and we know we're on
track so now that we've done all that
that might see in a lot of work but we
haven't actually done anything with
calculating yet so we want to check if
this is yeah this can actually calculate
the result of any operations that we've
passed in so let's create a test in here
again using our dot block style and
we're gonna create a can calculate
result test so just very very simple
test so let's go ahead and pull over
addition like so and let's go and pull
over our calculator like so and let's go
ahead and add a operand in so set or an
operator sorry so set operator addition
and we want to say
this assert equals 15 calculator
calculates so I'm going to implement a
new calculate method on to my calculator
so let's go ahead and run our tests and
we see a set operator that should be
operation like so we get calculate
method does not exist on our calculator
it makes sense so let's go ahead and
implement it so down here let's go ahead
and create this out so calculate and for
this how would we calculate the result
of our operations well in this case
we're really just interested in making
this pass so what we could do is we
could say well to make this test pass
let's say grab the first operation and
just calculate that so in this case I'm
gonna return this operations and getting
the first one and I'm gonna call the
calculate on that we know at this point
we're safe because we know that anything
we pass in is in the instance of
operation interphase which we know has a
calculate method so in this case when I
run my test I get green because we're
taking the first one we passed in and
it's working now that we have green we
want to talk about multiple results so
we want to return an array of results if
we've set multiple operations so again
we're just kind of following this
through and making sure that we get
green so let's create this last test and
this will be the last one but hopefully
you've got the hang of this by now and
we'll check that this works so calculate
method returns multiple results so this
is what we spoke about
initially we want an array of results if
we have multiple operations so again I'm
just going to pull over addition just to
keep think Wicker addition one in fact
let's just keep addition and then we'll
do a division as well so it's copy this
over cuz it's pretty similar syntax and
let's just change this over to division
change this over to division and we are
going to say 50 divided by - it should
be 25 obviously and this should be
fifteen we'll just add them there so we
remember so we are going to new upper
calculator so again we can pull this
over from here if we want we're gonna
say calculator set operations we want
our addition in there and we want our
division now what do we want returned
from this well we want an array returned
with 15 as the first result that's the
addition part of it and we want 25 and
then subsequently if we wanted to add
these results up we could then pass them
again into addition and it just kind of
works in a loop so that's why I built
this calculator in this way so the first
thing that we want to make sure is that
we actually get an array return from
this calculator method when we have
multiple operations so the first thing
I'm going to do is say assert internal
type we want to check that the result of
calculator calculate is an array and
then we want to check that the first
element of this so calculator calculate
like so is 15 so we want to check that
the first result is 15 and we want to
check that the second result is 25 like
so so just to recap we want an array
back and what we could actually do as
well is run a similar test here to make
sure that we're getting an integer and
him obviously might not be an integer
but we could add more checks in there
and we are checking if it's an array
we're checking that the first result
from that addition operation is 15 and
the second one from that division is 25
so let's go ahead and run our tests we
obviously get read because what has
happened is with our calculate method on
our calculator class this is just
grabbing the first operation so we're
getting 15 and that is not an array so
in here we need to now change this so we
actually go through all of our
operations if there are more than one
and then map them calculate each result
and return them in an array so let's go
ahead and in fact we'll implement this
first then we'll go ahead and lastly
just refactor it
so we're going to say if the count of
the operations so this operations is
greater than one then we want to say
something like and we could have some
kind of result up here which could be
null and then in here we're going to say
for each this operations as operation
we're going to say result like so and
we're going to append on to this array
operation calculate and then here we're
going to return result so we could in
fact place this inside of here if we
wanted to either way our goal is just to
make it pass so we get the following so
we know that that works now we know that
is not affected our original calculation
but now if we have multiple operands or
operations they are returning the
correct result on the correct type so
let's just refactor this just to finish
up and then we are good to go
so we can keep this check in here but
better than looping once again is to use
something like array map I think and in
here we have a callback like so we pass
in what we want to map through this
operations like so into this we get an
operation and all we can do in here is
return operation calculate and all that
will do is return an array with all of
these results in so last but not least
we run our tests and we get green and
then we go although a calculator doesn't
seem that interesting hopefully this has
given you an idea about what you should
be testing breaking these up into
separate units constantly refactoring
and most importantly making sure our
tests pass every time we refactor
something</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>