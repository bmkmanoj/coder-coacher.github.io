<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 15): User Settings (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 15): User Settings (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 15): User Settings (Part 3)</b></h2><h5 class="post__date">2012-05-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Izskucx55i0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so welcome back this is hopefully
going to be the last part of the video I
know it's over running for such a short
thing inside of a system but you know
it's best to explain everything as best
as possible
okay so now what we want to do is once
we have this successful form filled out
and the forms been submitted and there's
no errors we need to go ahead and we
need to construct an array much like we
did in register let me just scroll down
here called register data so in fact I'm
just going to go ahead and in fact I
won't copy it out I'll do I'll do this
as as it is but I'm going to call this
update data and this is going to be
equal to an array so the first key is
going to be equal to something and that
is first underscore name what's this
going to be equal to well dollar
underscore post first-name I can come
and separate this now come down to a new
line another new line just to save a bit
of time this is going to be last name
this is going to be last name this is
going to be email and this here is
obviously going to be email so let me
just tidy this up very slightly
okay so we're creating an array called
update data and this is going to be
passed through to an update function
it's going to send these field names so
like these must correspond to what's in
the database and this is the actual data
here so if I go ahead and print our
update data and I click update there's
no errors obviously so we're now
printing out this array so we've got
first name Billy last name Gera email
equals Billy at PHP academy' dog so that
data will be then sent through to the
database I know it's the same as what
we've already got but we're just going
to update everything when the user
clicks update there's not much of a
speed difference if we you know if we
were to go through and check whether
something had changed it's long and
tedious and actually slower process okay
so now that we've done that we need to
pass this data through to the update
user function
we haven't created Jets or have to do
that so we'll pass this update data
variable which is an array will then
redirect the user to a specific location
which is going to be this page so
settings dot php' with success on the
end we've already looked at this as well
and then we're just going to exit here
okay so now what we want to do is we
want to incorporate this success message
we don't want to update this just yet
we'll leave that to last it's slightly
more complicated so when the user
updates their details successfully now
watch this updates you'll see this
success is bobbed on the end here we
need to so catch this and then not show
this form and show a little error a
success message instead so here I'm
going to say if something do something
so if empty dollar underscore gets this
time so it puting this get variable
called success if that is equal to false
ie it exists and oh sorry now if is set
so if it's set is equal to true and
empty dollar underscore get success is
equal to true and if we look back out
register page we did this here what I
didn't say is equal to true or is equal
to false but these this isn't really
required because this will return true
or false this will return you know true
or false anyway if that's the case then
we want to go ahead and just output a
message so I'm going to say echo your
details have been updated and otherwise
what do we want to do well we want to do
all of this here all of the form and we
want to end the closing bracket there so
that means we can go ahead and we can
just nicely indent all of that there
okay so if this success message is set
all we want to do is that otherwise we
want to do all of this
and then we end that there and that's
the ending part that block you can see
it's highlighted red we go all the way
out this is the start of it here so
let's go ahead and test that I'm hit
enter where we've got this success thing
on the end of our URL and it says your
details have been updated
they haven't been updated this is just
our success page so when I click update
that updates out well it hasn't updated
yet but that says we've updated our
details otherwise if we don't include
the relevant relevant information we get
this error okay so now let's go ahead
and focus on this update user function
which I commented out there so it didn't
we didn't return an error we need to go
ahead and build this update user
function so let's go ahead and update
that sorry open our core functions users
file with all of our functions to do
with our user in and let's go ahead and
I'm literally going to take this
registration function here register user
and I'm going to paste it here get rid
of that space so the reason I pasted it
is because a lot of not a lot of this
actually a lot of it doesn't isn't
required but it's relatively similar so
it's just going to save a bit of time so
obviously this is called update user and
we're sending updates data we need to
walk through the array and sanitize each
value that's important so we need to
keep that in there we don't need to
encrypt any passwords we're not using
this method of grabbing fields and we
don't need to email the user the query
is going to remain here but it's going
to be a different query so here we are
you know pretty much dying from scratch
I don't really save that much time by
copying it okay so what do we want to do
here well I'm going to create a new
array called update and this is going to
hold the structure of the query that
we're going to use to update the user
now I'll just quickly go through how a
query looks when we want to update some
data so I'm going to hop over to my
database and I'm going to update this
user name now I'm going to update this
first name here to Billy or William or
something like that
so that's where the user ID is equal to
14 so I'm going to
click on my SQL tab and here I'm going
to say update this is the syntax for
updating values when I say update users
which is my table I'm going to say set
what does it first name is equal to
William in fact now what I'm going to do
is I'm going to show you how to update
more than one field because that's what
we're going to be doing in this case I
use a comma and then I don't say set
again but this time I use the field name
again so I'm going to say last name is
equal to and we'll just say something
like Smith okay and we're going to say
we're user ID is equal to 14 now this
might be confusing but let me just go
over it we're updating this field this
table here which is users contains all
my users we're setting this field to
this value and then we're setting this
field to this value but only where the
user ID is equal to 14 let's just click
go it says one were affected let's go
ahead and browse William Smith okay so
it's updated this data let's just go
ahead and change that back but that's
essentially just a sneak peek of what
we're going to be doing here so what we
need to do is we need to when this data
is passed in this update data array we
need to put it into a string that we can
pass through to a query so I'm going to
create a and array up here so update
equals array and then what we want to do
is we want to loop through this update
data that we've passed through so let's
just get rid of register we need to loop
through all of these so first name will
be live in the first loop last name than
email so for each update data as field
data oops the dollar sign so for every
item we want to loop through we want to
append something onto this update array
and what do we want to append on well we
obviously appending on field is equal to
data okay
I need to escape these two characters
here by the way so field equals data so
all we need to do is replace this in
here and I'm concatenated on here field
data okay so we're starting the string
here a little back tick the field and
then in the back tick is equal to single
quote data and single quote so now what
I'm going to do is print our update and
I'm going to kill the script so let's go
ahead and click update ah we're not
seeing it because we're not calling the
function let's go ahead and do that
update a very walk expects parameter 1
to be array null given okay so let's see
what might have gone wrong there ah
there we go we didn't change that to
update data fair enough refresh update
okay so now we've got a first name equal
to Billy so we've got this this looks
odd but we've got essentially field
equals Billy lastname equals Garrett so
we've with we're starting to bring
together the structure of our query now
how do I get this into a string form
well I can just go ahead and I can use
implode so I'm going to go ahead and do
that but I'll do that within my query so
let's go ahead and get rid of this bring
this MySQL query up here we don't need
any of this because we're not inserting
any data we're updating users and
usually we'd say set like was blob but
we don't need to do that we need to
implode this update
arrey to make into a string join
everything together and separate each
set thing by commas if that makes sense
in fact let me just go ahead and and
kill the script here and echo implode
update so this is our this is our array
that we're imploding by and what we're
imploding by the comma so now what's
going to happen is this is going to be
each each of these so this this and this
is going to be now separated by a comma
which is exactly what we want so when I
click update we've got first name it
calls Billy comma lastname equals
Garrett comma email equals Billy PHP
academy' to org perfect that's what we
want so we now know that when we can we
can do that within our query too so
reconstruct this format so I'm going to
say set I'm going to concatenate implode
updates I'm going to implode that by a
comma and a space where user ID is equal
to dollar underscore session user ID
unless we have a variable stored for
that already let me just go ahead and
check yeah we have session underscore
user ID so I can go ahead instead of
using the actual session paste that in
there perfect so now this query will be
executed we've already seen a result of
this this implode here and it will
update them specific fields where the
user ID is equal to the currently logged
in user so let's go ahead and try and
update some details and see what result
we get so I'm going to change the first
name here to William when I click update
your details have been updated well
let's go ahead and click home nothing's
happened this I would have expected to
have changed so let's just go over to
our database and again nothing's changed
so why isn't this changed well we need
to go ahead and debug you may have seen
the error but I haven't so or died on
the end of this and I'm going to be
using the MySQL error
now what this is going to do is if this
query fails to execute properly or it
fails to run my SQL will return an error
and this error can be picked up using
this MySQL error function and what we
can do with this is we can kill the
script if this fails and then all die
and then output the result of the error
so let's go ahead to settings I'm going
to change this again to William and
clicking update will now show us a an
error hmm
so the first thing is undefined variable
session user ID so that's session user
ID there system user ID is equal to
session user ID so this is given here
right you've got
okay so I think the best thing to do
here would be to I think this is because
of global yeah this will be because of
global variables if I go ahead here and
say global session user ID now go ahead
and refresh this
oh it's worked oh okay there we go
alright so okay the problem here was
then this variable is not being able to
be accessed within this function because
it's not global so we can't access this
variable within our function so we have
a couple of options we can do this which
is slightly slower well
not yeah very slightly slower or we can
just declare this as an actual session
so dollar underscore session user ID
like that now it's entirely up to you
doing it this way with the global will
mean that if you ever need to change
this for any reason here it'll make it a
lot easier so I'll go ahead and leave
that as it is now but just a couple of
words warning slightly slower anyway now
the data has been updated so perfect so
when I go ahead and type in say William
Smith and I go ahead and click update
everything's updated go back to settings
it's changed change this back to Billy
Garrett
click update this changes here and
settings have been details been updated
okay so a bit of debugging there I'm
going to go ahead and get rid of that or
die now because we don't need it but the
reason the query failed was because the
session user ID variable wasn't being
able to be picked up and therefore this
was obviously just blank okay so what
we've done now is we've successfully
allowed the user to update their
settings if you needed to add more
fields here it's extremely simple you
just go ahead you don't need to do
anything in here all you need to do is
you need to obviously add more fields
and you need to add this stuff in here
making sure obviously you do your
validation and you define which fields
you are
are actually requiring to be entered or
submitted by the user</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>