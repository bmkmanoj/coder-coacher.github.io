<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Getting User Location Information with PHP | Coder Coacher - Coaching Coders</title><meta content="Getting User Location Information with PHP - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Getting User Location Information with PHP</b></h2><h5 class="post__date">2014-11-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Rr36E8NAORI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to be
getting location information about a
user from their IP address and we're
going to build a small class to handle
doing this just so it's easily used
across your application now as you can
see I have a sentence that's been output
here this here is the town name that's
being returned from the IP address that
I'm using and you can access other
information about the user from their IP
address as well so for example things
like the timezone that they're using
this may not be accurate at the region
the country code even things like their
ISP and also their country as well as
well as a bunch of other things like the
longitude and latitude of their location
so what we're going to be doing here
then is using an API and we're using
this API here to access all of this
information you can use any API you want
the way that we structure the class will
be very similar so as long as you have
an API that you're using that provides
you this information it'll work in
roughly the same way and there are free
ones there are paid ones I'll leave it
up to you to decide which you use but in
this case I'm using this one so if you
do want to follow along with the video
head over here and you can start
building up this functionality so first
of all we're interested in ER IP and
we're getting the IP address location
back in a JSON format so a JavaScript
object notation format that makes it
easy for us to manipulate in PHP to be
able to output to the user so in this
case then this is how we're calling the
functionality we're building this class
called geo and I'm instantiating it here
I'm sending a request with this
particular IP address and then what we
can do from this geo object is pull in
things like city and the properties that
you access from this object will relate
to those you get back here so you can go
ahead and just use this as u1 for
example if we wanted to pull in the
longitude we could go ahead and do that
so we could just replace this in here
obviously the sentence won't make sense
now but once we refresh that will give
us that value back so it's really really
easy to work with let's go ahead and
build this
so the first thing that we want to do
then is start to build up this class
include it into this page and work out
which methods that we need to implement
so I'm going to create a file inside of
this directory just here obviously this
can sit anywhere and I'm going to call
this geo PHP and we're going to define
the class out here and obviously call it
geo so what kind of information do we
need to store inside of this class now
this of course could come form
configuration options but what I'm going
to do is I'm going to set a property at
the top which is going to be the full
URL to the API including the endpoint
that we're hitting so in this case this
is the site we're accessing you've got
this geo IP section and then we've got
the IP address that we want to replace
in so once you've come over to this site
or any other API that you're using we're
going to copy this and we're just going
to paste it into here and we're going to
replace this here with a placeholder
string placeholder that we can replace
later with the S print F function this
just keeps it nice and tidy and away
from your actual logic within your
methods so next then we want a
properties array stored up here and
we're going to be using the get magic
method to actually call items from
properties or from this properties array
a bit later on that doesn't make sense
it will make sense a little bit later so
we want to allow a request so we're
going to create a method in here called
request and this method is going to take
in an IP address so within here we want
to grab the URL that we want to make a
request to we want to replace this
string placeholder with this IP address
and then we want to send it off and make
a request to the server so let's build
up the URL first of all we're going to
assign this to a variable and like I
said we're going to be using s print F
and all this does is it takes a string
so in this case it's this API so
accessing this property here with this
API
and then what we want to replace within
the placeholders in this case we've only
got one so we just pass IP through so if
we just echo this out then and overrun
out in next page we require in that
class that we've just built and then we
instantiate it so I'm going to store
that in geo so I say new geo then we're
going to say geo request and then we're
going to choose the IP address that we
want to request in this case we'll just
grab this one that you might want to try
on your own IP address so now this is
going to just echo something out we're
not going to leave it like that but it
allows us to just see how the URL gets
built up in this case it looks good we
know that this is the correct format for
the API call so like I said rather than
echo this out we want to go ahead and
make a request so I'm going to say data
and that's going to be this send request
and we're going to send the URL through
now what we want to happen is this
method that we're going to implement
down here we want this to return all the
data that you can see over here and this
is JSON it's in JSON format I'm using a
extension in my browser to render this
in a nice way if you don't you'll see
something like the following so you'll
see something like this so don't worry
too much if you do and what we're going
to be doing later is we're actually
going to be decoding this and converting
it essentially into an array then we can
work with it easily in PHP so we're
going to create a protected method down
here and that's going to be called send
request and we'll use coal to do this
but you can use any anything else if you
want to so remember we pass in the URL
to this send request method and in this
case we are getting the URL here from
the arguments we want to go ahead and
initialize curl so we can send a request
through I'm going to set some options
here so we use curl set up to do that we
pass in the resource that we're working
with and that in this case it's the curl
initialization we just did here the
first one is going to be a curl up
and this is going to be returned
transfer its just make sure we get back
the data that we need in order to
process it we're going to set another
option here and that's essentially just
going to be the URL that we want to make
a request to so I'm going to say curl up
to URL and pass the URL in so nothing's
actually been executed there's been no
request to the this URL at this point
but what we want to do is return curl
execute on that curl resource let's get
rid of that dollar sign so all this is
doing then is it's going off to this URL
it's pulling back the data that's been
returned and we're returning it from
this method and it will now be contained
within this data variable just here and
if you want to go ahead down here and
handle errors so I think this API will
return a 400 yet so return a 400 HTTP
error if the input string is not a valid
IP address so you might want to just
catch that at some point if if you want
to handle them errors which is a good
idea so now then all we want to do is
inside of here just to test is do a var
dump on data and this will be the data
returned from the API so there you go so
you've got a string of three to four
characters and we've got our JSON string
just here and we can decode this using
JSON decode what that will do is it will
give us back an array so we're going to
store that in this properties room we
set that just up here so this properties
is going to be JSON decode we're going
to decode that data and the second
argument is true which means we want
this back as an array so we want this to
be decoded not to an object but to an
array it can be an object entirely up to
you so let's now instead do a var dump
on this properties and see what we get
instead of a string we should now see an
array with 16 items and you can see all
of the information here as normal so
we're going to do something a little bit
different here we're not going to return
anything from this request function
method because what we want to do is we
want to be able to say echo geo and then
choose one of the keys that's returned
so for example say we want to return the
city we want to say echo geo city but
how do we do this well there's a couple
of ways you could go about doing this
you could for example say protected City
you could duplicate this down a bunch of
times for each property but we're going
to be a little bit more clever here
we're going to implement a yet
magic method and again magic method is
not like a traditional method as all
magic methods are not yet will allow you
to access or return something for
properties that don't exist so every
time we access a property on this object
it's going to call this method here so
what we do is we pass the key in and
let's take a look at how this works
let's just echo key out so you'll now
see the waters actually going to happen
is we'll get back city so it's actually
just repeating any property that we try
and access and we can use this to our
advantage because we know that we've
stored properties up here we can
actually now check if this is set in
this properties array and return that
remember that's all come back from the
API so a little if statement here just
to say is it set so we say this
properties key so accessing the key that
we passed through to here checking if
that's set within the properties if it
is we can return this properties key
because we know it's set now otherwise
we want to just return null you can
again return anything you want here so
now that that's done what's going to
happen is when we access city that's
going to come through to here check if
it's within the properties that have
been returned from the API that we
stored here and then it's going to
return you that value so now you'll see
that the city here is derry when I go
ahead and refresh we get Derry back so
whatever method that you're using to
grab your users IP addresses all you now
need to do is
pass it into this request method and
then return any of the properties that
you want from the API call and again it
doesn't really matter what API you're
using as long as you specify the URL
here and it's returning it in somewhat
like this format you're good to go and
you can return location information
about your user via their IP address</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>