<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Authentication: Update User Profile (30/30) | Coder Coacher - Coaching Coders</title><meta content="PHP Authentication: Update User Profile (30/30) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Authentication: Update User Profile (30/30)</b></h2><h5 class="post__date">2015-05-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QsMT6n375-M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now we're currently storing details
about the user like the first and last
name but the user at the moment has no
way to update these so in this video
we're going to create the ability for a
user to update their account and that
includes their email as well so let's
add the option to the navigation just
here so we'll go over to views templates
navigation and we'll add this if the
user is authenticated so we're going to
call this update profile and here we're
gonna call this account dot profile so
we need to generate our routes or create
our routes so we're going to create an
account profile root and we'll have the
post one as well
so under routes let's create a new
folder called account this will just be
any account related routes not
authenticated but authentication routes
so this is going to be profile dot PHP
and in here we'll say app yet account
profile and we'll use app as always I'm
gonna call this account profile and
we'll render a view here and create that
just now so gonna render account profile
PHP so let's create this view just in
here so we'll create a new folder called
account and a new file in here called
profile PHP again we'll take the code
from the home template paste that in say
update profile
in the title and we'll say update
profile here and we'll add this to our
routes file so under we can just add it
down here under any account related
routes this is for our profile and now
we see update profile we can click that
and we see this here
so this is just going to be a forum we
have three fields we're gonna give the
user the ability to update their email
address and also update their first name
and last name as well so inside of this
form then this is going to be a form two
account profile a post the method is
obviously going to be post and we'll
turn autocomplete off as well you
obviously don't need to do this so let's
create our post routes now so in here
let's say app post account profile and
we'll use app and we'll call this
account profile dot post and then here
for now we'll just say echo posted so we
know that the form gets posted cool so
the form then like I said consider
consists of the email the first name in
the last name and we will come across a
bit of a problem with the email because
what we're gonna be doing is checking if
the email is a unique email we don't
want the user to change their email to
an email that exists for another user we
protect against that when we register
but we need to protect protect against
it here as well but when we do submit
the form we're actually going to need to
check if the email that the user
submitted is the same as their current
email and then ignore the validation so
we'll have a label for email here I'm
gonna have an input type of text or call
that email and we'll call this email as
well for the ID once again we'll
duplicate this down here
the first name it's gonna be first name
and then finally we'll have the last
name and of course you can add any other
fields here from your database table
that you want to store about the user so
down here we'll have a submit button and
we'll just call this update now we have
a couple of security considerations here
what we're not doing is protecting this
root against an authenticated user so if
I was logged out and I was to click on
update profile I would still see this if
I was logged out so again we need to use
our middleware filters and we need the
user to be authenticated so we can do
the same in here so that's really
important we don't want unauthenticated
users to be able to navigate this URL
because they're not going to be able to
update their profile that way so again
when we submit this form now we're gonna
get a cross-site request forgery token
mismatch so we need to add that to our
form so we have a hidden input we have
the cross-site request forgery key and
for the value we have the cross-site
request forgery token so now we can
submit this form and we see that posted
text we wrote in earlier so let's start
to fill this out and then we'll look at
something else we need to do in a minute
which is to pre populate the fields on
here if these values exist so we'll do
that after we've kind of sent this
request through and we'll we'll see how
we do that so we're gonna say request
cuz app requests we put in our request
object we need to pull in the email
which is request post email need to grab
the first name
it's first name the last name here which
is last name and we're going to need to
validate this as well so V equals
validation and we'll validate as normal
so the email is that email we submitted
through and the rules for this are that
it's required an email and it also needs
to be a unique email as well so a user
can't change it to an email that already
exists in our database and we'll be
having to add to this because we're
gonna see a problem with this a bit
later so the last name or the first name
rather we'll start with it's that first
name variable and this needs to be alpha
and a max of whatever he gave it in the
database which I think was 50 so let's
check this out yes we've got 50 for the
first and last name so he can 50 and we
could do the same for the last name here
like that so if the validation passes we
want to update the users account so if
he passes we're going to say user update
and passing them new values so the email
is going to be that email address the
first name is going to be that first
name variable and the last name again is
going to be that last name variable and
we can flash a message to say that we've
updated the users account your details
have been updated and I guess we can
keep them on the same page so we can
just say app response redirect and we'll
redirect them
it's the same page that's a count dot
profile now otherwise we want to render
the form with errors so app render
account profile dot PHP and we pass them
variables in as we've passed throughout
the whole series which are the errors
that have occurred which come from our
validation and the request so we don't
lose any of that form data like that so
when we submit this form now we get we
are seeing errors now because we don't
have any of these field but what we want
to do is we want to output the initial
data for the users email first name and
last name so I guess we could start with
the errors so let's just say if errors
dot has email and that if and when
output the error within here so it's dot
first email making duplicate this line
down to here for the first name and
again we can duplicate this down here
for the last name
like so so that will give us the errors
but it still doesn't give us the
pre-populated information by the way the
first name and last name are not
required so we don't need to worry about
them ok so here we want to output the
value of either the user's email or if
they've posted the form the data that
they posted so they can correct any data
if we have anything invalid so here
we're gonna say value equals and then
we're either gonna output the post email
value that they sent through or the
user's email so we're gonna say request
dot post email we're going to do a
ternary operation here so we're gonna
say we're basically saying if this
exists then we want to output request
post email otherwise we want to output
or email so what that will do is if we
don't have that available it out put my
email address just in there we'll do the
same for the first name and the last
name as well so we can just copy this
value attribute paste it into here we
can change this to first name this is
the first name and obviously we want to
put in or first name that property so
again the same for the last name we'll
paste that in there we'll change this to
last name we'll change this to last name
and that as well
so if we do have a first and last name
in here we see them in there as well we
can hit update
so at the moment we are seeing this
problem where we can't actually submit
the form because the unique email rule
is taking into account the fact that
this does already exist in the database
but it's our own email address so we
should be able to update this let's just
get rid of first-name and lastname so we
can see ourselves updating them in just
a minute but we need to tackle the
problem of this email address it's not
going to let us through
so what we need to do is we need to
modify
our validation rule so remember we have
this unique email validation rule we
need to put a check in here to see if
the use if the email that's being sent
through is actually the user's email
then we just return true and we just
passed this rule because if the users
ever submitting a unique email we never
really want to take into account their
email so we can put a check in here to
say if this off remember we have that
dependency sent through in here both so
if the user is authenticated and this
earth email is equal to the value that's
passed through to that validation then
we just want to return true from this
function for this method so now we can
hit update and we get an error here
we'll fix that in a minute but the for
the validation has passed so that's the
point so we've got an error on line 24
and profile dot PHP so let's just have a
look at what might have gone wrong here
so like 24 and yeah we have user update
we have an error just here so what we
can do then is just to remedy this you
say app auth update which is the current
authenticated user so now when I hit
update your details have been updated we
didn't actually see anything update
because obviously we're not entering
anything different remember this method
here that we used outputs the username
or the full name so we'll know that this
works when we enter the first name and
last name and hit update it says your
details have been updated and it hasn't
worked so we need to figure out what's
happening here so we're actually
updating this record just here but
nothing's happening I suspect it's
because you now use a model we haven't
added our first and last name properties
under our fillable so let's go ahead and
do that now so first name and last name
and there we go so if we
update this they there we go
so your details have been updated we see
our full name here because we're using
that method we have in our user model
that we created earlier and we now see
first and last name in this form we can
go ahead and update any details here so
really if you wanted to go ahead and add
more fields on here that relate to your
user you can just use the same method of
validating them and updating them and
that will be stored along with their
record which you can do what you want
with so you can output these way you
want so taking a look at all users now
we see the full name here for that user
remember we added that earlier and we
also see the full name when we are
viewing our profile page so there we go
that's how we update our user's profile
and we can extend this if we want to
include more fields</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>