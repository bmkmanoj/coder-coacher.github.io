<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 23): Profile Image Upload (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 23): Profile Image Upload (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 23): Profile Image Upload (Part 3)</b></h2><h5 class="post__date">2012-07-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WVWGf3HKSz4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we're now the final part of the
profile image upload and we're going to
be creating this change profile image
function and we're doing that in users
dot PHP so we need this function here
which we've already sort of mapped out
and you know we have we sort of
essentially run it but we haven't
created it so let's go ahead and just
create this at the top of the file so
it's function this and obviously our
block as well so we are passing in the
user's ID and the file temp so I'm just
going to change this to user ID we don't
need it as that full and file temp
remain as it is
so let's decide what we're doing in this
function the first thing we need to do
is upload this file the second thing we
need to do is once we've uploaded the
file we've generated the file name we
need to upload our update the users
database table row with this updated
path or this new path or you know
depending if it's the first time they've
uploaded this is a lot simpler than it
sounds the first reason is that
uploading a file is not complicated at
all we just need to be really careful
about you know how we're uploading we're
uploading too so we need to generate a
file name so I'm going to say file name
is equal to and this is going to be the
current time and I'm going to md5 this
I'm also going to substring it like that
so what we've done here is we've taken
the current time we've created an md5
hash from it and we've changed it to ten
character ten no we've changed it to
eleven no sorry we sorry ignore me we've
changed it to ten so it starts at
position zero and length of ten so we
now have a 10 character figure let's
just go ahead and echo file name so now
when we upload we'll get this back so if
we choose this and click Submit we've
got this back here okay and I'll choose
again
and it's the same one well I can do it
again it will be different that see so
that will change every time the other
thing we need to take into account of is
the file extension which I completely
forgot about so we need to pass in the
file extension here xtn and here we need
to go ahead and pass in file txt n
because the file that we're moving we
need to know what the file extension is
so we're passing the file extension as
well okay so this is going to be
something dot dot in a string and then
file ext n so this now looks like this
so we've got this random thing here and
then dot PNG and that's it I mean this
is for name but really we could have
this be called something like file path
and the path to this would be let's just
double check images profile and then
that's it so images profile and that's
it so one last time we choose the file
just probably choose that clicks up we
yep sorry we're not outputting file path
so we choose the file we click on here
and click Submit and there we go that's
where the image is going to be located
so we can move this temporary file to
that location we can then store that in
the database and it's connected that's
what we need we're done so the first
step is to move the uploaded file and
luckily we have an extremely useful
function move uploaded file and this
takes two parameters typically which is
a file temporary location and the
location you want to upload to which is
file path so that's done we now need to
update the database with this so let's
go ahead and just test this out first
because it's important that we actually
you know take this step by step and
actually upload the file then add this
to the database so when I go ahead and
click Choose
I'm going to click this I'm going to
click Submit done nothing's happened but
if we go ahead and we check our images
profile we've now got this file here
brilliant so this is a PNG extension
image you can see their item type PNG
image with this number here okay
so perfect we can go ahead and just
delete that quickly we know that move
uploaded files working it's moved it
from the temporary location to our
generated path our generated file name
now we need to insert to the database
that's relatively straightforward
we need to query the database and we're
going to say insert into users remember
users is the name of our table here now
what do we want to in sorry we don't
even want to insert so we'll go back and
modify that in a minute but I'll explain
we need to update where the ID is equal
to 15 because that's who I'm currently
logged in as user ID of 15 if it was
dial or Ashley would be 16 or 17 but
luckily we're passing this in anyway you
can change profile image as we call this
function we're passing that in here so
we want to not insert into we want to
update users we want to set profile
equal to so we're changing the value of
profile at the moment is blank
remembered by default so in here we want
to change it to something I'll just buy
X for now we want to say we're user ID
is equal to something so let's
concatenate on to the end and integer
cast user ID so it is just going to cast
this variable to an integer so it helps
prevent SQL injection so here let's go
ahead and concatenate on we'll use MySQL
real escape string and then here we want
to pass in the file path in fact we
don't even really need to use MySQL real
escape string the reason being is this
is generated as an md5 hash so it will
never really come out as
you know anything user-defined really I
suppose we've got the file extension on
here but that's being checked in the
last step it's really up to you I mean
we can leave it on just for the sake of
it but obviously it will slow down the
application somewhat not a significant
amount anyway so we're updating the
users table is setting the profile field
equal to this now you've probably
noticed I've not put single quotes
around this it's string data so it's
required where the user IDs equal to
this integer again string toys are not
required okay so let's go ahead and
check this out now you'll be pleasantly
surprised when we go ahead and upload a
picture because we've already got the
functionality in here to display a
profile picture if we have it uploaded
so let's go ahead and choose this
beginner image file click Submit and hit
enter and there we go
so we've got a bit of work to do here on
the CSS and we also need to refresh the
page for the user to be able to see
their uploaded picture but here we go
we've got this file uploaded brilliant
it's working if we go over to our
database now and we click users to
refresh you can see that we've got the
file location here as well perfect so
let's just go ahead and tidy this up for
those of you that you know are
uncomfortable doing this yourself the
first thing we want to do is go ahead
and redirect the user after we have
changed the profile image so I'm going
to say header location index dot PHP and
then I'm going to exit now bear in mind
that locating these two index if they're
on another page of the site they're
always going to be located to index dot
PHP I don't think as far as I remember
we have a current file oh yeah we do
current file yeah there we go okay so we
can use that I believe so let's just go
ahead and concatenate that on there so
location to current file let's just go
ahead and test this out in fact let's
modify the CSS as well
well rat it
so in the CSS screen let's go all the
way down to where we have this profile
so we're going to have a style rule in
here for any images within profile we're
just going to say wit for 100% and what
this will do is it will reduce this to
the width of the outer container it
should do at least let's just go ahead
and check we've got in here profile
image let's go back to the browser now
there we go okay so I think it was
cached or something like that but there
we go we've got a hundred-percent image
so it doesn't affect the height if this
height is massively long it will you
know stretch to accommodate but then it
will still keep its ratio so we can go
ahead and choose another file if we want
I'm not going to do so but there we go
we've got the image stored in there the
image is being shown to the user and we
can go ahead and use that in the users
profile page as well because we already
have the ability to output information
about a particular user so we can go
ahead and output the profile picture so
if you're visiting another users profile
you can go ahead and view their profile
image as well so that's how we upload a
profile image how we protect against
uploading or the user uploading images
that we don't want and how we display
this out refresh the page upload the
file and add that to the database so
that's it for the profile image upload
tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>