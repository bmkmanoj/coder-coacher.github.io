<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Shopping Cart with PHP: Braintree Drop-in UI (12/15) | Coder Coacher - Coaching Coders</title><meta content="Build A Shopping Cart with PHP: Braintree Drop-in UI (12/15) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Shopping Cart with PHP: Braintree Drop-in UI (12/15)</b></h2><h5 class="post__date">2016-05-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yEbZoi13qts" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now we're going to set up the
Braintree drop in UI so essentially this
will allow us to literally drop in the
payment form that we saw in the first
part of this series and will include the
validation and what's great is that when
we actually submit our form will then
get a token back which we can use to
charge that payment method and we'll be
looking at Li processing payments with
Braintree in the next part but for now
let's focus on the front end side of
this and if you head over to the
Braintree website you can go ahead and
find the documentation for this here I'm
currently just on the drop in UI landing
page so you can test this out here if
you want to but we're gonna head
straight over the to the documentation
and we're gonna look at how we do this
so obviously this is done with
JavaScript so we're going to need to
pull in the Braintree JavaScript file
for this we just want to make sure that
we're on jsv to sdk so let's just scroll
down I'd encourage you just to read this
through just to familiarize yourself
with how it works but essentially with
the client-side implementation this is
all we have to do so this might look a
little bit strange because there's not a
lot here but essentially we just have an
element here with an ID and then what we
do is we take the client token passing
it in to this method and then we just
give the container so you can see how
drop-in container dropping container and
then we literally just have our payment
form there from Braintree so there's a
little bit of setup we need to do in our
end just because we're going to be
injecting scripts and we only want this
on our order page we don't have to load
this for every single page it doesn't
make sense to do this so let's start out
by just heading over to our base
template so what we're gonna do is allow
scripts to be injected down here based
on blocks within Twigg so all we do here
is create a block called scripts and all
this means eventually is that we can
inject scripts in here from a particular
template so that template happens to be
the order index so down here we can
create a new block so let's just start
this block out and just kind of kick the
process off I'm gonna say block scripts
and then down here let's end that block
so this is where our Braintree drop in
code will go in order to place this on
the foot on on our form so where do we
actually place our payment well what we
can do is just before we finish
everything off here so all of our other
details let's create a header here for
payment let's create a HR here and then
down here let's just create a payment
div so div or the class of or an ID of
payment so this is where I'll drop in UI
will go so we need to do a little bit of
setup because we need our client token
from the backend to be able to actually
do this so that you can see how easy is
to actually integrate this but we need
to get this client token from our server
so to do this we need to pull in the
Braintree PHP client library this will
allow us to authenticate and also charge
your user so if we installed it now we
have it ready for the next part so let's
just pull this down and then we'll set
up our configuration we'll head back
over to our sandbox to get all of that
information so let's do a composer
require on Braintree Braintree PHP and
we will wait for that to download so now
that's done we have it available in our
product project but we have a little bit
of setup to do here so well not a lot at
all but if we go over to my user
remember this is where we have our
public our private keys so if we head
down to API keys we will find if we go
over to this key which is the one that
we're going to be using that we have
that code example we saw earlier so we
can literally just copy this and go
ahead and paste it into our bootstrap
file this will just allow us to
essentially just authenticate with the
API so let's pull this in
now although we're pulling our
credentials directly into our code for
this series what I'd recommend you do is
with in production actually set this up
so you can store your configuration in
environment variables so essentially
what this will entail is using a library
like PHP n and the instructions on this
repo are
really clear gives you a good idea as to
why you shouldn't store sensitive
credentials in your code this is pretty
obvious if you are pushing this up to
some kind of version control like github
then obviously these will be accessible
to everyone so go ahead and once you
have finished the series read this
through and with your brain tree and
your database connection credentials you
can store these in a separate env file
and what you're also going to want to
make sure is that if you are using
version control you want to use git
ignore to ignore this file now
essentially all that will happen here is
that within that file that you create
you will go ahead and load in all of
this configuration and rather than
hard-coded in the values just here
you'll access them from that
configuration file and this also means
that you can have different settings
across different servers maybe on local
development you want to use your sandbox
maybe in production well you would want
to use your production credentials and
that's the same for your database as
well as Braintree so go ahead and once
you have finished the series before you
push your code to production if you are
pushing it to production make sure that
you check this library out and is really
simple to use and go ahead and get this
set up so you're nice and secure but now
we actually have all of this set up the
only thing that we need to do is just at
the top here use this like so so we're
going to be using this PHP library to
actually make payments so now we have it
all set up and ready to go but what we
want to do to keep this nice and
structured is create a controller for
our client token so all we want to do is
create a new file in here you can do
this however you want but I find it
keeps a nice and tidy if we create a
controller for it so it's a Braintree
controller and let's just pull over our
home controller so we have the structure
there and we'll go and change this over
again so this will be Braintree
controller and we don't need these
we might need our response actually yeah
we do because we need to respond with
JSON we don't need our product obviously
and we don't need tweaks we're not
rendering any views so inside of our
brain tree control
we want to create a token method which
will go ahead and return our token so
into this we can inject our response
because we need to respond with JSON and
by the way we'll be picking this up with
an ajax request so it makes sense that
we grab our token when that's come
through then we can go ahead and render
out drop in UI form so now what we need
to do to actually grab this token is
braintree client token generate it's
that easy and that will give us back the
token that we need to put into that into
that drop in UI code so rather than do
this obviously that's not gonna work we
need to actually return with some
response so if we just return here and
we say responds with JSON inside of here
let's say token paste this in and we are
done so the only thing we need to do
here is just use this up there and
that's it so let's create the root for
this just so we can actually hit the URI
and we will go down to the bottom and
say app get Braintree token and then in
here we'll say cut controllers Braintree
controller and we're accessing the token
method and we can go and set a name for
this so this will be Braintree token so
this will be public but that's
absolutely fine because all we're doing
is replacing it on the page without
JavaScript so it's perfectly normal to
go ahead and output this on the page
obviously if we just head over to the
documentation and refer to that you can
see that we're just literally putting
out her client token in there satisfying
and get rid of so we can check the
dispatch let's go over to our Jaafar
let's get rid of that there we don't
need that so there we go
so if we head over then to Braintree
token we will get back a JSON response
with that token that we can place into
there so now that we have this what we
can do is make an AJAX request
and then once that's ready we can set up
our UI our drop in UI so inside of our
order form this is where we want to make
the Ajax requests to our server once we
have the token back we can then actually
go ahead and use it so we know that we
have jQuery pulled in so we can go and
say Ajax and then we need to choose the
URL which is in here path for Braintree
token so using that in there just so we
don't have to hard code the URL we have
a type here of get we have a data type
that we're expecting back which is JSON
jQuery is clever enough to pickle this
up but of course we can enter it anyway
and then on success we have a callback
here which will contain the data from
that response so in this case we can do
a console log on data just to see what
happens and obviously in here we will
wrap this in a script tag that makes a
lot more sense so let's wrap this in a
script tag okay so now let's just indent
this head over to the order form and
let's go and bring up how console just
to see if everything was fine so it
looks like this is fine we're getting an
object back with that token so we now
have our Braintree client token we need
to use it anywhere else that's
absolutely fine it will work in exactly
the same way and we have it there ready
now so now what we need to do is pull in
the JavaScript from Braintree so we can
actually use this and this is Braintree
je s if we just head over to this and we
come down to use the direct link you can
install this with Bower or MPN if you
are eventually going to do this with
this project but for now we'll go ahead
and pull this in with the direct link so
we can pull this in on this page because
we don't need it on any other page at
least not yet and we'll pull this in
there oh it's already got the script
text for us there we go so now when we
get to the success part all we need to
do is if we refer back to the
documentation over here we just have
this to do so we just define the
container the client token which we have
now and we just
than we want this to be a drop-in form
so we just say Braintree setup and then
in here we say data token that's back
from our request we say drop in and then
in here with the options object we have
container and that's just payment so
that's this here that we added to
remember so it is as simple as that and
we now have a form that we saw earlier
so if we just go down you can see that's
loading in there and there we go so
there is I'll drop in form remember like
I said we can go ahead and enter the
card number directly in here and
everything else and it's all nice and
validated for us or we can go and choose
to pay with paypal and then from this
what we can do is if we decide to change
our payment method so remember we're
working with the sandbox here so we can
just go ahead and proceed with this
otherwise what your customers will do is
just enter their paypal email address
and password and it'll all be done and
they'll see this with their email we can
go ahead and change that and we get this
lovely selection here for the payment
method we want to use so really
straightforward so we now have our drop
in UI on our page but how do we grab the
token that we're eventually going to use
well we're going to look at that in this
part and then in the next part we're
going to actually look at making a
charge on the back end with the
Braintree PHP client library so over in
our order form or at least our order
controller let's just close all of this
off when we actually create an order
here let's just put our validation back
by the way we'll actually go and just do
a what will kill the page and let's do a
var dump on request get around this will
give us an array of all of the
parameters so if we fill out this order
form so in it now we can we can ignore
these so we'll ignore this for now but
we'll just focus on this so let's go on
into a card number if you want to use a
test card number you can find them in
brainfreeze documentation i always just
use four - four - repeated but obviously
four different payment method testing
you have different card numbers and
let's just enter some information in
here and then let's go in and click
place order so that we'll go ahead and
submit everything through and as well as
of all the other details that we will
have remember we have these validated we
have a payment method nonce so this is
what's used to represent the payment
method that has just been entered and we
can use that to make a charge with a
specific amount and if you thought
integrating the drop in UI was easy
making a charge is equally as easy it's
just as the case of passing this through
with a a price so we're gonna handle
actual processing payments on the back
end in the next part and then we can go
on to finish up and our shopping cart
experience I want to give a shout out to
our friends at Braintree payments in
future there could be a whole new way to
pay Braintree school so that payment
platform is easily adaptable so with
just 10 lines of in-app code it's easy
to update to support a new payment
method when it arrives no staying up all
night with complicated recoding no
stressing about staying ahead with your
payments Braintree payments is here to
help you can find out more about a nurse
comm / Co course</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>