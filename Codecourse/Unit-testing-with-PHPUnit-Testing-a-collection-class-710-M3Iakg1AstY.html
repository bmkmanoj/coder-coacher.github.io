<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unit testing with PHPUnit: Testing a collection class (7/10) | Coder Coacher - Coaching Coders</title><meta content="Unit testing with PHPUnit: Testing a collection class (7/10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unit testing with PHPUnit: Testing a collection class (7/10)</b></h2><h5 class="post__date">2017-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/M3Iakg1AstY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now we're moving on to test and build
a collection class now if you're not
sure what this is I'm gonna give you a
kind of brief overview with a little bit
of code we're not actually going to be
building this first of all of course
because we are doing test-driven
development but I'm gonna give you an
idea just so you know what we're kind of
building if you're familiar with laravel
you'll know exactly what this is so a
collection class is just a kind of
convenient wrapper for objects or any
kind of data that you want to store in a
collection typically we would have a new
collection class and to this what we
could do is into the constructor maybe
pass a list of user objects we could
pass a list of strings anything really
into this so you could say something
like one two three like so what you
could also then do is use convenient
methods like collection count so this
would obviously give you back the value
three and what you could also do is make
this so you can iterate over it now
obviously we can normally only iterate
over things like arrays but in this case
we're going to make this iterable so we
can say something like for each
collection as or in this case maybe we
have a list of users we could say for
each users as user so we can iterate
over this class which would give us back
at the ability to go ahead and say some
of my echo user and then maybe get their
email address or something like that so
that's pretty much what we're gonna be
testing and then building so let's go
ahead and start - first of all before we
do anything write a test for this so
let's create a new file in here we're
gonna call this collection test dot PHP
and we still have our user tests in here
as well I'm just gonna be adding on to
these so feel free if you want to kind
of start afresh get rid of these tests
that we already have so once again let's
just bring over our sample test just so
we have the kind of structure in here
that we need and let's change this over
to collection test and of course get rid
of this assertion just in here okay so
the first thing we want to do is test
that this kind of just works by maybe
implementing a get method to grab back
all of the ice
that we've passed into our collection so
this just tends to be how I start things
I'm gonna start with my dog blocking
here for my test and here I'm going to
say that I want an empty instantiated
collection to return no items so returns
no items now this will just give us a
good idea as to how this is going to
work we can define out what kind of
methods we want in here and we can check
that when we instantiate collection and
get back some items there's nothing in
there so it's just kind of how it works
as we first use it so let's go ahead and
say that a collection here is a new app
and maybe this would go in some kind of
support directory I'm gonna instantiate
a new collection we're not gonna pass
anything through to here and we're gonna
test that using some kind of get method
is empty so we're gonna introduce a new
assertion which is assert empty this
will just check if an array or whatever
value you give here is empty and the
thing that we're checking is a get
method on our collection so this tells
us that we when we instantiate this and
we maybe add items to it later we are
going to implement a get method so as
always let's go ahead and run our test
so there we go
and of course we get a failure because
we don't have a collection class so
first thing to do is create the class so
let's create a support directory and
into here let's create our collection
dot PHP file so let's go ahead and give
this a name space so app support class
of collection and let's go ahead and
just run this test again so we now know
that we need to implement our get method
so let's go ahead and do this like so
and as part of this we would probably
have some items that we would set when
we do instantiate this so I'm just gonna
return this items and maybe by default
this property up here is just an empty
array so the idea is then that we have
items within our collection within an
array which we can then use to iterate
over when we later implement our
iterator
aggregate which were also
me testing for as well so we're gonna be
pretty much testing her everything of
this a very simple collection class so
let's run our tests again and we get
green so we know that this is working we
know that an empty collection returns no
items now we want to test that when we
do pass items in we get a correct count
back for the items that we use will that
we get back using the get method so we
pass in three items when we call get the
items that are returned or three or
whatever however many we pass in so
let's go ahead and to find out our test
again and this time let's go ahead and
describe this test as count is correct
four items passed in or whatever you
want to call it really it's entirely up
to you let's go ahead and instantiate a
new collection but this time let's pass
some items in and we would typically
pass these in as an array but we could
later on implement something like
collection add and then we could choose
to pass in a value or we could choose to
pass in some that have user model
whatever you wanted to do so we may not
do that we'll see how we go so into this
array then we're going to pass in three
items and I'm just going to say one two
and three so this collection should now
have three items and what we want to do
is assert that when we maybe call a
count method we get back three items now
we could count how many we get back from
yet but we could implement a separate
method for that as a separate test for
that as well so let's for now just say
collection and maybe we want to see a
count method in there so let's go ahead
and just run our tests we know that we
don't have a count method so we can go
ahead and implement this let's do that
very quickly now so count and just to
make this pass once again let's just
return three go ahead and run this we
get green now we can actually refactor
and to do this we would return count and
then this item so we know that that's an
array and we know that count will work
on an array now we run our tests again
and it looks like it's failed so failed
asserting that the zero match is
expected three
well of course it's gonna fail because
we are passing items in but we're not
actually setting them anywhere so of
course we need to bring in our
constructor so let's go ahead and do
that next bring in our constructor here
and into this we want an array of items
which we want to then set into that
property so this items set that two
items run our tests and it looks like
now construct must be the type of array
and none given so it looks like the test
that's failing is empty instantiated
collection returns no items so now we
have a previous test that's failing
because of that now what we wouldn't
really want to do in this case is I have
to always pass in an array if we were to
update our test to account for that then
obviously we get green but really what
we want to do is since we are kind of
looking at this in the way that we could
instantiate in an empty collection we
want to set this as a default to an
array run it again we get green so we've
refactored it and everything's working
so now what happens if we want to test
that an actual array that's returned has
a count of three items because at the
moment we've just implemented a new
count method well in this case we'll go
ahead and create a new test and let's
implement our block there if you are
doing that and let's say that items
returned match items passed in or
whatever you wanted to say and we're
going to do a similar thing here to this
and then we're gonna check that we have
a count three on here so what we could
do is say this assert count and we could
give the count three and then we could
say collection get so this will
automatically grab the count of whatever
we get back from this method is and
we're going to check the last three and
you can even just modify these if you
want to add a little bit of variety to
your test so we could say that the count
of this method which is an array should
return true go ahead and run this and we
know that this works we don't need to
write any additional code for this
because we've already implemented our
get method now because this test is
describing that the items returned
match the items passed in then this
really doesn't describe what we're doing
what we could do is either implement
another assertion to check that both of
these values equal the value that we've
passed in so we could say something like
assert equals and then we could say that
collection get and maybe the first item
equals one and then we could create
another test here
the second item returned there equals
two we know that this will pass if we
just run that again so we know now that
we're testing that each of these items
is equal now what you could do is and I
wouldn't necessarily recommend this if
you wanted to say you wanted to check
that a model was set properly you could
check that it was an instance of say a
user if you were testing that but since
we're unit testing we're kind of just
checking that the value that we've
passed in is the same whether that's a
user model or any other kind of model or
any other kind of item we're adding to
the collector and we know that this is
enough to satisfy the fact that whatever
we pass in we're getting back so you can
go ahead and include a slightly more
advanced test here but to be honest we
know that this pretty much works as it
should by this test so I'm happy to
leave this as it is now what we're going
to do now is check that the collection
can be iterated so we need to kind of
think about how this is going to work
the first thing I want to do is check
that the collection is an instance of
the iterator aggregate now if you're not
familiar with an iterator aggregate this
allows us to deal with a class as if it
was something that we could iterate on
so before we even touch this let's write
a test for it and then we'll go back and
actually check that we can iterate over
anything that we pass in so we're going
to write two tests the deal with the
iteration of a collection so the first
test then is going to check if a
collection is an instance of iterator
aggregate so we just go ahead and
describe this as collection is instance
of iterator aggregate and how do we do
this well we can go ahead and new up a
collection we don't need to add any
items to this so I can go ahead and get
rid of these items if I want to and now
I'm just going to say this assert
instance of and I'm gonna pass in what I
want this to be an instance of and this
is iterator aggregate and we just pull
in the full class name so it has to be
the full string to the class in this
case what you could do is do something
like the following if you prefer but I
just like to use class like this and
then we just pass in what we're checking
is an instance of so basically the
iterator aggregate is just a interface
that we implement which then allows us
to implement another method to then be
able to iterate over a class so let's go
ahead and run this we know that it's
going to fail and we can see here failed
asserting that our collection object is
an instance of iterator aggregate so we
know to make this test pass we go ahead
and we implement iterator aggregate go
ahead and run our tests and we get
another error this is because this can't
be found under this namespace we can
either do this with a backslash or at
the top we can use iterator a Gregorius
plis utley and it still looks like it's
a p' okay so this is another problem
what's happened is that the interface
that we've defined here iterator
aggregate requires that we implement a
method called get iterator which goes
ahead and then returns a something that
we can iterate on and this is just how
this works and how we can iterate over a
class so what we want to do is in the
true TDD fashion we want to make this
pass but we want to kind of mock this
out so let's go ahead and do this we
know that we need to implement a get
iterator method so let's go ahead and do
this get iterator and I'm just gonna
return an array and we get green so
we've made it past it doesn't do
anything useful yet but we've made it
past that is the main thing now what we
can do is refactor this so it does work
but what I'm going to do is implement
another test
to check that we can actually iterate
over this class and get back the result
we want so let's write out the test
hopefully this makes sense but if it
doesn't it will start to make sense
after we've started to write this test
let's create a test called collection
can be iterated and once again a good
side note is that we are on green so
once we're on green we can write more
tests which will potentially fail then
we can go back and refactor so it's
about writing your test making it fail
because you may not have implemented the
functionality if you're using
test-driven development then you make it
past and you just repeat that cycle
again and again and again before you
know it you build up what you need and
it's all tested this is why I love this
method of testing so let's go and create
a collection within this test and all we
really want to do is add some items to
this and then make sure that when we do
a for each loop on this collection
object we actually get the result we
want so let's build up the test we're
gonna say 1 2 3 and of course you can
pass anything you want in there and
let's create a temporary items variable
here let's do a for each over our
collection which we know is iterate
iterable because we've already created a
test for that made that pass so we're
gonna say for each collection as item
we're going to go ahead and add that to
an items temporary array and now down
here we can test that the count of this
is 3 because we should be able to
iterate over it so let's go ahead and
create two assertions here the first one
is assert count 3 and we're gonna say
items because that's now an array with
all of them iterated values in and let's
actually leave it at this for now go
ahead and run our tests and we should
see objects returned by get iterator
must be traversable or implement
interface iterator so what we are now
doing is because we kind of mocked this
out to make it work because our
interface required this now we can go
ahead and actually fix this up so what
we need to do is in to this we need
to return a new array iterator like so
and we need to pass in the items that we
want to be iterable in this case it's
this items now if we go ahead and run
our test we will get an error because we
see a class app support a rate iterator
not found go ahead and fix this up so
array iterator and we get green this
means that when we are iterating over
things we're adding one two three to
these items and we're asserting that
that equals three if I was to change
this over to two for example it says
failed asserting that actual size three
matches the expected size two so that is
done but what we could further do is if
we were always expecting this to be an
array iterator we could also check that
that was an instance of an array
iterator so let's go ahead and say this
assert instance of specifically checking
that this is an array iterator and what
we want to check is collection get
iterator and you might be thinking well
really is this observable functionality
because this is public maybe we could
have this as protected well
this interface defines out that this
should be public so I'm assuming that
someone could call get iterator if they
wanted to so you could specifically call
get iterator so it's observable
functionality it can be used so we are
testing that so we're checking that when
we call get iterator it definitely
returns an array iterator let's go ahead
and run our test and we get green
brilliant so why don't we just finish up
with one more test just before we move
on to the slightly more advanced
calculator functionality that we're
going to be looking at which does sound
boring but it's a little bit more
interesting than this and let's say well
maybe we want to from a collection
merging another collection so we maybe
have two collection classes that we want
to merge one into another so we can go
ahead and write this test out to see how
this might look and then go ahead and
implement it so let's say collection
can be merged with another collection
again very verbose output here or very
verbose naming here let's go and create
a collection so we can just take this
down from here and let's add say 1 &amp;amp; 2
like that and let's go ahead and create
another collection so I'm gonna call
this collection 1 and collection 2 and
this is going to be 3 and maybe you will
say 4 &amp;amp; 5 just so we have a difference
in numbers here so now we can think
about how we want this to look is really
as simple as that so I'm gonna say new
collection equals collection 1 merge
collection 2 so I'm kind of making up
what I want this to look like as I'm
writing my tests so I think this is nice
collection 1 merge collection 2 now we
need to assert that the new collection
contains 5 items so we can do go ahead
and do this
this assert count and we're going to say
that this must be 5 and new collection
get what we could also do is a similar
thing we could say assert equals 5 and
then we could use the count method if we
wanted to let's go ahead and run this we
know it's gonna fail because we don't
have a merge method so over in our
collection let's go ahead and implement
this now so we know that when we use
this we are expecting another collection
to be passed in maybe you were not but
we'll go ahead and say that we are so
we're going to say collection and what
we want to do is we want to return and
this is where it starts to get tricky
because really what we want here is the
ability to say something like return
collection that we've passed in add and
then adding on the items from this
collection so maybe maybe we'd say
return this add collection get so we're
taking the items that we are passing in
within that collection then adding them
onto the current one and then returning
that or we could do something might
return new collection and then we could
pass in array merge this get
with the collection that we've passed in
getting them items so let's go ahead and
run our test we see that we get green so
we know that this has worked but we
might later want to refactor this so we
might want to implement an ad method to
add to the current collection then go
ahead and return that so in this case
what we're saying is this will always
return a new collection but what we
might want is just being able to merge
like the following so we might want to
say that we want collection one we want
to merge collection two and then this
has a reference to collection one so I
think that would be better so I think
just doing that we would want to now say
that collection one has had them items
merged into it so I think this is a lot
better so I'm changing the test over
because I'm thinking about my test first
and I'm thinking about how I want this
to work first of all I want to say
collection one merging collection two
and collection one now has them merged
items in so let's go ahead and run the
test we know that we're gonna get a
failure here because it's not working in
the way that we specified it so let's go
ahead and refract this too so it makes
sense now in this case we kind of know
that we would want some kind of add
method in here because what we would
want to do is say return this add
collection get like so so what we can be
either do is create a separate test
forget or we could just add a test on
after that and there's no real hard and
fast rules to this so in this case what
I would do is I would say well it's
failing because we don't have an ADD
method so I'm gonna go ahead and I'm
gonna implement an ADD method now so
into this we would do pretty much what
we would do the constructor and we would
pass in a list of items and then we
would say that this items equals array
merge and then we would merge in this
items with the items we've passed in now
we get green so we know that that's
passed but after this I'm thinking
actually I want to create a separate
test for add just to make sure that this
does work we kind of know it works but
I'm a little bit
comfortable with the fact that we don't
have a specific test adding things on to
a collection so I can go ahead and
create a new test for this just to kind
of be have more safe than sorry and this
is just the way I like to do things so
we're gonna say can add to existing
collection or whatever you wanted to say
now in this case it's pretty simple we
could go ahead and grab a collection
here like so maybe have two items in
there and I'm gonna go and say
collection add and I'm going to add one
more item in so three and I'm going to
say this assert count three for
collection
count or rather we would say equals here
like so and then I could have another
assertion if I wanted to to say assert
count three and then collection yet so
we run this and we get green so we know
that that works as well so just a little
bit of food for thought when you are
test driving development and you're
testing beforehand this made or the
addition of this add myth had made this
pass but then I went back afterwards and
although I'd already built this add
method I added two tests in for anyway
so really you can do that there's
nothing wrong with doing that it's
really whatever you feel comfortable
with but generally we are kind of test
driving everything now that we've done
this though we've pretty much finished
up a simple collection class of course
you can continue this if you want to
carry on playing around go ahead and
write some more tests for any
functionality that you would like to add
to this maybe you want to add some kind
of to JSON method and actually I think
we could do this now I think this would
be quite fun so let's go ahead and write
a quick test I promise this will be the
last one I know these are really long
but we'll go ahead and do this anyway so
I'm gonna say returns JSON encoded items
whatever you want to say so what I want
to do is new upper collection with two
or three items in it really doesn't
matter and let's make this a little bit
more advanced actually let's just say
that we had in here a user with a
username of
Alex and the user with the username of
Billy we want to assert so we're gonna
say this assert equals we're gonna say
that this should be just a JSON output
so in this case it would be an array of
two objects and in here we would have a
username of Alex and we would have a
username of Billy so we're gonna assert
this will implement a to JSON method
which will look like collection to JSON
and we'll see what happens so let's go
ahead and run our tests we know that we
don't have a to JSON method so let's go
ahead and implement this now public
function to JSON and all we want to do
is return JSON encode this items so
that's pretty much what we're doing go
ahead and run our tests and we get
failure so let's just take a look at
this and it looks like there's a space
in between here so we're just basically
not formatting this properly so we'll go
ahead and get rid of that space and
again we don't get a pass so let's just
take a look here and yeah it looks like
there's no spaces whatsoever so we could
just get rid of all of these spaces just
to check that and there we go we get
green so now what we could also do is
apart from doing this we could check an
internal type now there's no real need
to do this but you can and just to
introduce another assertion we can
insert internal type string and then
collection to JSON so we know that that
must return a string and when we run
that we get green if for example we were
expecting an array
obviously that would fail and we see
return failing asserting that this is a
type array so we can add that in there
anyway I like to just add more
assertions and we probably need but that
is a good idea of what you could do so
what we could also do is say well when I
specifically encode this collection I
want also to return JSON so I promise
this will be the last one but it is
always good to kind of practice
this kind of stuff so let's go ahead and
say JSON encoding a collection object
returns JSON so hopefully that makes
sense
that's create an implement the test
essentially all this is is when I new up
a collection like this like so when I
encode it so I'm gonna say encoded
equals JSON encode passing in the
collection I expect to see the JSON back
now by default we can't do this with
objects so we're gonna look at another
interface that we're gonna add after
this test fails so I'm gonna say this
assert equals and in fact it's exactly
the same as this so we may as well just
go ahead and copy that down and we could
do the same for this as well we can
assert the internal type although it's
not entirely necessary let's go ahead
and check that encoded so the encoded
thing that we have just encoded passes
these assertions like so so let's go
ahead and run the test and we should see
a failure brilliant so we're expecting
this but we're actually getting back
just a kind of object here as a string
so the reason for this is that we don't
have the ability to Jason encode this
object now there's another interface for
this which I've just brought up here
it's JSON serializable so if we go ahead
and implement this let's go ahead and
run our tests now we get JSON
serializable not found okay fine we need
to go ahead and pull that in and now we
get it contained this particular
interface contains one abstract method
and that is json serialized so let's
create this method like so there we go
and for this we basically need to return
what we want to be returned when we call
JSON encode so in this case what we
could do is stop it out but it doesn't
really make too much sense because to
stub it out we would have to pass in an
array with all of these items in which
would eventually be encoded so in this
case I'm just gonna return this items
which are then returned and when we use
JSON encode this will now work so now we
should have made this passed and we know
that that now works brilliant
so this ran on a little bit long but
hopefully now that gives you a really
good idea of the kind of test that you
would write for even very simple
functionality and we're testing pretty
much everything here so we're being
really thorough about the test coverage
now we've done that though we're going
to move on because with the unit testing
we need to kind of think about what
happens when we have lots of different
classes that all interact with each
other how do we even begin to start
testing them and in the next part we're
gonna look at testing a calculator class
which has lots of different units which
we can all test but then we can bring
them units together and test them kind
of as a whole so let's go over and do
that one next</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>