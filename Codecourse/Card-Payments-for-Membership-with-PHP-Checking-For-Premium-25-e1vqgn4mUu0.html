<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Card Payments for Membership with PHP: Checking For Premium (2/5) | Coder Coacher - Coaching Coders</title><meta content="Card Payments for Membership with PHP: Checking For Premium (2/5) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Card Payments for Membership with PHP: Checking For Premium (2/5)</b></h2><h5 class="post__date">2014-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/e1vqgn4mUu0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we're starting pretty much from
scratch here we're going to be building
every single part of this mini
application up so really the first thing
that we want to do is on the home page
we're going to determine from a database
whether this user is premium or not the
user that's signed in we're not going to
be creating a registration and login
system because that's going to take too
long within this video what we are going
to do is we're going to set a session
based on which users signed in and you
can integrate this with your current
system so the first thing I want is a
table which contains user details you
might already have this but if you're
building this example up from scratch
then you might want to follow along with
creating these fields the first one is
just going to be an ID field the type is
obviously an integer the length you can
you can cut down if you want
it's obviously unsigned is a primary key
and it's also auto increment so for each
record we create this numbering
increment now I'm also going to have a
user name you can store an email if you
want it really doesn't matter so but an
email field in there and I'm also going
to have a premium field as well so the
user name then we'll just give this a
varchar say 20 and for the email let's
also make this varchar' and we'll make
this 255 and for the premium this is
going to be a boolean now that's going
to translate in here to a tiny int of 1
so we can either store the number 0 or
the number 1 in here so that they're the
fields set up that's pretty much it
let's go ahead and fill in these details
so I'll go ahead and type a few couple
of test accounts in here premium will
set to zero so in here we'll say an
email as well just so we have a couple
of accounts to test with and we'll say
zero here as well wooden top and change
these around if we want so inside of our
application then on the home page we
want to determine whether the user is
premium or not that's the first step so
we need to do a couple of things just to
set things up so I'm going to create a
new folder in my directory I'm in here
and I'm going to create a new file
within this app directory and I'm going
to call this init dot PHP this is just
where I'm going to set things up like
sessions and the database connection so
this is pretty straightforward we're on
a start session so we can store a
session ID and I'm going to actually
store that just up here now so I'm going
to say session user ID equals one so
we're just hard coding this value in
here but if you do have some kind of
authentication system this would
probably be stored maybe in a session
and then you might have other features
to it but either way as long as you have
access to somewhere that your users ID
is stored that's fine okay so the next
thing then is the database connection so
I'm going to be using PDO to connect so
I'm going to instantiate a new PDO
object and then inside of here I want to
use the MySQL driver we type in our host
that's localhost or 127.0.0.1 locally so
these are both grouped so now what we
want to do is we want to perform a query
to get to determine whether this user is
premium or not so I'm just going to say
user query oh and this is also going to
store other users details as well so it
will store it will give us things like
the username the email just so we can
use these along the way so I'm going to
say DB prepare so this is going to be a
prepared statement and a prepared
statement basically just allows us to
draft out a query if you like and then
inject variables into it to help of an
SQL injection so I'm going to select all
the fields from this table so ID
username email and premium which is
probably the one we're after in this
case and we need to choose where we're
selecting that from so that's from the
users table now this is going to be
where the ID in that table equals user
ID and this is a PDA placeholder with
the colon just here so down here what we
can do is we can use the user query
variable that we stored that up here and
then we can execute this and we need to
pass in an array here
to basically inject these variables in
so it's the same name as the name that
you called the placeholder here so this
could be called absolutely anything and
that is going to be session user ID so
now we have a query that we can fetch an
object from or something like that and
that's going to give us all of them
details so let's just have a look at how
this works so I'm going to store this in
a variable called user I'm going to say
user query fetch object so just to test
here let's do a print our on user and
let's head over to our browser oops we
need to include this on our home page
and this is important because then we
can have access to everything that we're
doing in here so here I'm going to go
ahead and require once app init dot PHP
so that will pull that file in so now
you'll see this so we've got an object
here we've got an ID of one user name of
Alex email and then premium is 0 if
premium was one then obviously that
would change so now what we can do is we
can use this on our home page to
determine whether the user is premium or
not by doing a quick if statement now I
have a basic document just laid out here
we're not using any style sheets or
anything like that if you're just
mucking around you don't necessarily
have to have a document layout like this
but I'd probably advise you do so now we
have access to that user variable I'm
going to do an if statement in here I'm
going to say if and then down here I'm
going to prepare the rest of my if
statement so else and then down here I'm
going to end that if so it's just some
basic PHP templating so what are we
checking well we're checking if the
premium property on this user object is
essentially true or false so I'm going
to say if user premium we access the
property like this so if that's the case
the users premium so we can say you are
premium now otherwise we want them to
sign up so we can say you are not
premium and then create a link through
to the pre
sign up page which we obviously haven't
looked up yet so I can just sit on the
night sign up or maybe go premium and
this is going to link through to premium
PHP again we've not created this yet so
now when i refresh we have this you are
not premium we know that because we've
seen inside of the database the premium
flag is set to zero if I change this to
one now it is your premium so we know
that we've got the functionality to
determine whether the user is premium on
our and you can use a similar if
statement on any pages that you don't
want users to access so for example
inside of your main directory you could
have a file called of no secret dot PHP
or whatever and then you could say if
not use a premium and you could go ahead
and redirect them off somewhere so
location index dot PHP so in this case
then if I try and access secret PHP oops
we need to include in app in it remember
because that still contains all of our
variables that we need that redirects me
back to index whereas if I change myself
to premium and I go over to secret or
PHP I'm allowed in so you get the gist
there are better ways to structure your
application obviously but in this case
you can use something like the following
to determine whether the users allowed
access somewhere so we now have got the
very basics of allowing or disallowing
users or checking if a user is premium
or not the next thing that we're going
to do is we're going to look at actually
creating this premium dot PHP page that
we're linking through to and we're going
to include the stripe pay button</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>