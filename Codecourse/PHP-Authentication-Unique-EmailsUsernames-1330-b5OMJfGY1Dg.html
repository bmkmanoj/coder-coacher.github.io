<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Authentication: Unique Emails/Usernames (13/30) | Coder Coacher - Coaching Coders</title><meta content="PHP Authentication: Unique Emails/Usernames (13/30) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Authentication: Unique Emails/Usernames (13/30)</b></h2><h5 class="post__date">2015-05-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/b5OMJfGY1Dg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now that we can register we want an easy
way to be able to check a unique email
news name so let's extend our validation
class or build on to our validation
class to allow us to do that so the
first thing we need to do is work out
what we're actually doing here again I
said in the last video if you want to go
over to the violent docs on github
you'll see how this works you'll see an
example of injecting your database into
violin and that's exactly what we need
to do but what we're going to be doing
is injecting our user model in so here
we're gonna create a constructor and
we're going to allow a user model to be
passed into this so you basically type
hinting this so the only thing that can
be passed into on this first argument is
a user object so we need to use code
course user user that's the user model
that we've already spoken about and then
we can just say this user equals user
and we can create a property up there to
hold that and then in any of the
validation rules that we create we can
use that user model so what do we need
to do let's first of all focus on
validating a unique email so we need to
specify a rule that we can add easily to
here like unique email in order to
validate that this is a unique email in
our database so to do this within violin
what we do is we create a new method and
we prepend it with validate underscore
and we say unique email like so and then
in here we either return true or false
depending on whether this failed or
passed so before we do that we need to
work out how we're actually getting the
value the input and the arguments for
this we're not using input previous
input and arguments we just need the
value but we need to define these anyway
so value input and args
so value will contain as long as we add
to this unique email it will contain
here the value that we pass
in here so that means that what we can
do is we can do something like if value
exists in database returned folks that's
obviously pseudocode but that's what we
want to do so to do this we need to
basically use the user model that we
passed in and only them to do is say
user equals this user where and this is
part of the query builder with eloquent
we just say we're email equals value so
all this is doing is it pulling a user
from the database so looking through all
of the records to find a user where the
email matches the value that's been
passed in when we validate so for
example if I go over to the form and
submit tab e at code course calm at the
moment it doesn't exist so the
validation here or this value would be
tabby at Koko's calm
it would look inside of the users to
find if there are any records with the
user with the email
Tavi at Cocos calm and then what we can
do is return true or false if one exists
we want to return false if one does
exist because that means this rule has
failed so we need to do is say return
and we can do this either within an if
statement so we could say if user and we
have a count method here which is going
to count how many records there are so
we can say if use account
return false and then down here we could
say return true like so so this would
work but we can shorten this to say
return false or user count and all this
means is say the user count is one
that's going to cast that to a bool so
that's true
and then we're checking if this is not
true so that's it we're just saying if
this is not true that there are users
with this email and that's it that's all
we need to do we will be adding to this
later because we have another use for
this when we up/down profile but this is
as we need it for now so let's actually
test this out and see what happens and
we will actually know we we will get an
error here because
what we haven't done is added a custom
error message for this so this will give
us a an error oh we've got another error
here so co+ usually ok of course so ok
let's go back to our start file inside
of our validator when we create a new
instance of it we actually now need to
pass in the user so we can do that by
saying app user remember we defined that
just here so let's go ahead and refresh
and hit register so we got email is
required as usual let's type in Tavi at
code of course calm and hit register it
all seems ok however if this wasn't the
case we'd have to output an error
message for our unique email so what we
want to do is we want to add messages so
we're gonna say this add filled messages
and again this is all in the violent
documentation so for any email field
where we have the unique email rule we
want to output a specific error message
here and that is that email is already
in use and that's it that's all we need
to do we'll be adding to this in a
moment when we did the user name that's
it for now so let's register a valid
user so I say table yet code post calm
so I can username a password like so hit
register and you have been registered so
that's all good we've now have a user
with the email tab yokota course com
let's register again with tabi act code
course comm will register with a
different username and we'll register
with a valid password register that
email is already in use so this might be
a little bit complicated but if you do
go ahead and read the violent docs this
will make total sense and it's just an
easy way to keep all of our rules in one
place and then all we're doing within
here is just saying we want this to be a
unique email so let's move on to the
username part of this now we want this
to be a unique username and it's pretty
much exactly the same thing really
so unique username and let's create that
role inside of our validator it's the
same thing validate underscore and then
the rule name unique user name we have
our value being passed in any previous
input and our arguments this rule
doesn't take any arguments
so to validate the unique user name we
can do this all in one line to be honest
all we need to do is say return if
something is false this user where
username is equal to the value that's
passed in so if there's already an Alex
or a Billy in there this will return a
count so we're checking that against
count so just running backwards we're
pulling the count for any users where
the username is the same as the one
passed into the validation we're casting
that to a boolean so let's say that Alex
did already exist this would be true and
we're checking if this is not true so
that's pretty much it
we are done with a unique username rule
but we need to add the message that's
going to be displayed to the user so
let's have a username and unique
username and we'll just do the same
thing that user name is already in use
simple as that
so let's check this out then we have one
record in with an email of tabut code
course comm and a username of Alex
so we define the username and the email
that's the same when I hit register that
email is already in use and that
username is already in use so by using
violin and creating our owning own class
which extends violin we can create these
two methods which will hook up to our
database via the user model validate as
we need and then it will return the
errors that we set by adding filled
messages and now we have a
registration form which allows us to
protect against duplicate email and
username and it also validates anything
else as well and you can add more rules
here if you want or remove them if you
don't need them so now that we've done
registration luckily logging in is a
little bit more simple so in the next
part we're going to look at how we can
log our users in check that they're
logged in and we can go ahead and remove
this register from the navigation once a
users logged in because they don't need
to register again</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>