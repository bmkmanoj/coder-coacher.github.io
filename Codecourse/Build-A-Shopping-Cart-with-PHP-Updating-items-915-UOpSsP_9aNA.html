<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Shopping Cart with PHP: Updating items (9/15) | Coder Coacher - Coaching Coders</title><meta content="Build A Shopping Cart with PHP: Updating items (9/15) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Shopping Cart with PHP: Updating items (9/15)</b></h2><h5 class="post__date">2016-05-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UOpSsP_9aNA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">of course at the moment we have a list
of our products we are showing the
quantity but there's no way for us to
easily update the quantity we can add
more items that's fine but we can't
reduce or delete items which is a bit of
a problem so we're going to create a
little form in here which is going to
allow us to select from a drop-down the
quantity we want or remove the item
altogether so let's start out by taking
a look our controller and what we need
to do here so let's close everything off
just to keep everything nice and tidy
and we will head over to our cart
controller now we have an ADD method
what we need to do is create an update
method responsible for updating the
quantity and everything else we need to
do so let's create our update method
this will pass in a slug now we're not
gonna pass in a quantity here because
this will be a form that posts a value
through to this route but we do need our
request just here and we need our
response just here as well and we will
need our Reuter as well so we can
redirect the magical factor we have this
up here no we we pulled these in here
satisfying so we inject these in and now
we need to do pretty much what we did
here by checking of the product exist
you can extract these out two methods if
you want within this class but I'll just
choose okay this down just for now so
now that we've got this in here let's
just kill and say update just so we can
focus on the form and then we'll
actually call the update method on our
basket which is all done so we don't
need to worry about that we've put in
the hard work to do that already if we
head over to our cart index then this is
where we need to output our form so
let's just pull this down a little bit
and start to look at how we might build
this out so the first thing we need to
do is create our form this is going to
have a specific action but we'll leave
that just for now we'll build out a form
design first and we're gonna have a
method here of post so for the form then
we want a select
basically just to drop down we're gonna
give the name quantity and we can get
rid of the ID for now and for this we're
gonna have a class of form control just
so we have some bootstrap styling and we
can change this to an input small just
so it's a little bit smaller so we now
have the following so this will be a
list of our quantities and the next to
this we want an input type of submit and
we want a value here of update and then
for the class of this we're gonna go for
a button and a bust and default and a
button small just so it's a little bit
smaller so as part of the actual form
then we can make this look a little bit
better by just saying form in line and
all that we'll do is well they'll pull
them together of course this is really
small the moment so it doesn't have
anything in but that's absolutely fine
so how do we work out what to display
within this select well obviously what
we can do is create a default here for
none so we know that we can always
choose none that's always going to be an
option regardless of the quantity that's
in stock we would just want to get rid
of it this will pass through when we
actually eventually submit this the
value 0 for quantity and then of course
what that will do is delete it so we
need to loop through the from 1 so
having one item within our quantity here
- the maximum amount of stock so
remember already looping through our
item so all we need to do here is just
create a for loop so here we can say for
num in 1 and then we do two dots item
dot stock what that will do is it will
count from 1 to the amount of stock we
can just end our for there now within
this will have an option and then in
here we will have that particular number
and then in here we'll have that number
2 so now we end up with this we have the
maximum amount of stock for this Indian
bbp berry and if we increase this
it should be this one here you can see
that we just end up with more selection
options here so you can obviously limit
this if you want it's entirely up to you
what you do you could maybe limit it to
like five or ten but either way that's
how we are rolling with this one so what
we also need to do is make sure that the
item that's they're currently selected
is the one that we have the quantity for
so for the selected we can just do this
select it and what we want to do is an
if statement here to check this so if we
just do an if statement here we're going
to say if the number that we're
currently looping through equals the
quantity of the item that we have then
in here we'll just end this if here we
want to output selected equals selected
we don't need to do that you can just do
selected but I'll go ahead and put that
in there so we know that we have to you
know in quantity if we add anymore this
will increase so we can test this by
adding to the car and we end up with
three selected here so now that we have
this and we hit update we're not
actually going anywhere so we need to
post this through to a particular route
so the action then we can't really fill
out yet because we don't have a route
for update so let's head over to our
routes file and we'll go and update this
now so to do this for good so we can
just duplicate this line down this is
going to be a post to cart it will be
update and it will be slug but we're not
passing the quantity in the URL and here
we can just say update and we can set
the name to cart to update great so now
we can just throw over and add this in
so this is path for cart dot update and
we need to pass the slug in here so slug
is going to be item dosed slug and now
when we go ahead and hit this this goes
through to our our correct route the
method ice power method wrong so that's
why it wasn't posting properly
but now you can see that post through
and we see update as we expected so now
we can actually update the item quantity
in here
pretty straightforward remember we have
that try-catch block so we can literally
just take this from here but this time
we're not adding an item we are updating
an item so we're updating the product
that we have here and the quantity is
going to be from the request I'm gonna
go get the quantity parameter that's the
promise that we pick up from our form
this is just called quantity and then
after this remember if this exception is
thrown you can go ahead and redirect off
to another page or you can flash a
message and then when they are
redirected back to the car index they'll
see that flash message and here we just
want to say response with redirect and
then in here will be Reuter and then we
are going to grab the path for the index
of the car just so we redirected when we
change the quantity so now as long as
our update method works which I assume
it will because we've used it quite a
few times what we can now do is press
two for example and hit update and you
can see that we now only have two if we
were to choose five that goes up and of
course all of our subtotals and totals
update as normal so now last thing we
want to test is whether none actually
work so we're passing through zero here
remember when we hit update this appears
not to work so it looks like it's not
working for some reason let's go over
and figure out why this is I have a
feeling that what we're not doing is we
go over to update what we're not doing
is hitting this just here so to test
this out what we could do is die here
and this should be removed so we can
just test that this works so if we go
over to here and maybe just add this
item back in so we now actually have one
item in our car and we go to none and
hair update you can see that we don't
see that dye happening there now what is
happening here well we're passing
through the quantity probably as a
string and we were using
to type-checking so what we're doing is
we're checking that it is an integer
there's a couple of ways around this we
could say if int quantity equals with
three equals or we can literally just
say double equals I don't think there's
anything wrong with necessarily doing
that so now what we can do is let's just
add in a couple more of these so in fact
we can do that here now so we cannot add
four in we're back to the state we were
in but now if we choose none and here
update that thing goes because now we're
not checking that it's actually an
integer it's just being passed through
as a string so there we go we now have
no items in our cart we can go shopping
again we can go ahead and add another
item we can increase the quantity of
course we can do this for multiple items
as well so if we want to go and add say
three of these we can do so if we decide
we don't want any of them we can go
ahead and get rid of that specific one
and we're done we're now updating items
and removing items from our car as we
need I want to give a huge shout out to
our friends at Braintree payments for
supporting code cause by next year maybe
even next week
there could be an entirely different way
to pay maybe it'll be the next Bitcoin
the next Apple pay or even both
fortunately brain trees full-stack
payment platform is easily adaptable to
whatever the future holds so you can
easily adapt to accept anything from
pounds to PayPal it's that next big
innovation from any device with a really
simple integration and when that new
payment method comes out all you have to
do is up there a few lines of code no
late nights no complicated recoding no
stress about staying ahead of the curve
Braintree payments is here to help learn
more Braintree payments calm /co course</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>