<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 1) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 1) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 1)</b></h2><h5 class="post__date">2012-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zHtnibmCv3s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we're now going to be adding
functionality to our system to allow an
administrator to send out emails so the
first thing we need to do is prepare for
this and allow the user to tick a box
and basically say whether they want to
receive these emails or not now
obviously this can be done by just you
know sending out a group of emails to
people but we it would be nice to give
people the option so we need a field in
our database table to you know store
whether the user said yes to this or no
and that's just going to be represented
by a 0 or a 1 so the first thing we want
to do let's just take a look at the
structure of our database table at the
moment for our users we need to add a
field at the end so let's go ahead and
add one column or field at the end of
the table and I'm going to call this
allow email to allow underscore email
it's obviously going to be an integer
and by default we will set it to one so
when a user registers I've saved that
now so when a user registers the allow
email field will automatically be set to
one so if I go and browse you can see
I've created two new accounts here and
that's just because we're going to be
sending emails out to a group you know
all of our registered users so we needed
to see this so we can test it so if I
scroll along here you can see that allow
email is now one for all of these users
so I'm going to use Billy as the account
example that doesn't though where we
don't want to send an email to so we're
going to send an email to Dale and
Ashley so Dale at PHP academy' dog and
Ashley at PHP academy' 2 org but we're
not going to be sending one to Billy
because he's going to have his email
preference unchecked so now what we need
to do well let's head over to our
settings dot PHP page you can see at the
moment that the settings that we have
available are first name last name and
email we need to update this with the
checkbox and the user can check this
or leave it unchecked so let's go ahead
and open up our settings stop PHP page
so if we scroll down and open settings
the way that we've built this we can
really easily we can really easily
change this so so we can pop this little
checkbox in so let's go ahead and pop
the checkbox in first and then we'll
update our PHP to take this change into
account so inside of our form we need to
go ahead and add another list item and
this is going to be a checkbox so let's
go ahead and just put the input field in
here so it's input type of checkbox and
the name of this is going to be allow
email remember we use these names the
same as our field names we don't have to
but it works a lot easier okay so that's
basically it after this I'm going to
write would you like to receive email
from us okay so let's take a look at how
that looks now okay so it looks alright
we can check or uncheck the first thing
we need to take into account is at the
moment this is unchecked
however logged in as Alex you'll notice
that allow you mouse it to one well it
is for all users so this surely should
what be checked so we need to go ahead
and we need to open now in it file and
remember I'll use a data function that
pulls in the data about our user we need
to add this as one of the fields that we
want to call in so allow underscore
email so now we're going to have access
to this via the user data variable which
is an array so in here what we can do is
we can determine whether this checkbox
is checked now to do that we have the
attribute checked and we set the value
to checked a bit odd but that's just
what we do so that will now check that
but obviously we don't it always checked
we don't always unsure we want to you
know compare this to the users value
so let's go ahead and break into PHP
tags and we want to use an if statement
and we want something to happen in here
if something is equal to something and
what we want to happen is we want to
echo checked equals checked and when do
we want that to happen well we want that
to happen when user data allow email is
equal to 1 because if allow emails equal
to 1 that means that they have chosen to
receive email so if I go ahead and hit
enter and refresh this page this remains
checked let me just go and uncheck this
and we'll notice the change just to make
sure that we have done everything
correctly so I'm going to change that to
0 go back here and refresh and that's
unchecked brilliant it works so now
let's go ahead and adjust the
functionality so this is actually taken
into account and stored so if we scroll
up you can see that we've got our update
data array here and we just pass in what
we want to update in the value we've
already covered this in the settings
part of the tutorial so if you need a
refresher go back to that ok so what do
we need to do well the the field in our
database is called allow email so we
want to set this to well what do we want
to set it to now we've got a problem
here in fact let me go go ahead and get
rid of that just for now I'm going to go
ahead and echo dollar underscore post
allow email now this is just to test the
value that we get given from submitting
this whether it's checked or unchecked
so at the moment nothing's happening but
when I check this and click update I
know we're passed through to success
aren't we so let's go ahead and just get
rid of that and we'll leave the exit in
there and that just stops us redirecting
so let's go back and click update and
you've seen it is on and that's because
it's checked when I uncheck it click
update nothing happens it says undefined
index allow email so essentially if this
value is equal to on
it means that we have a checked value
otherwise there's nothing so taking this
into account what we now need to do in
fact I'll keep that header part
unchecked we want to create a new
variable called allow email and this is
going to be equal to we're going to use
the ternary operator to perform an if
statement within here within these
parentheses and then assign a value to
this allow email variable so what we're
saying if dollar underscore post allow
email is equal to the string on okay
this is quite strange that doesn't the 0
and a 1 but this is just how we have to
deal with it so if it's equal to on we
want this allowing email value to be 1
remember we're storing 1 or 0 in our
database otherwise we want it to be 0 so
now if we go ahead and echo allow email
what happens well we click update here
you'll notice this error that's just
because the variable is not set but
because we're redirecting that doesn't
really matter too much you can see it's
0 if I check it and click update is now
1 so we can now either depending on how
quick or short we want to be we can say
allow email and we could set this to
allow email or we could grab this
without the ending single quote a
semicolon and we can pop that in there
so this will automatically set this this
value here within this array depending
on whether this is equal to on or not so
we'll do it like this and let's go ahead
and um comment the header function L and
let's go ahead and test this because
we've adjusted everything that we need
so over to settings at the moment alex
is 0 for allow email if I check it and
click update your details have been
updated let's go back over to settings
and is
so we can assume that when we go ahead
and refresh this that allow email is now
one and then we can go ahead and just
test it by unchecking it changing it
back so that's now unchecked browsers
again and just check perfect now why are
we doing this well well how well really
the question is what are we going to do
after this well when we loop through the
users in our database to send them an
email we're going to be a dripper
sending them an email to this email
address we need to only grab users where
the allow email is equal to one so
that's how that's why we're doing this
and that's how we're going to be using
that so we're going to be query our
database for users where the allow email
field is equal to one and then we can
just send an email to them so we've
successfully added this little checkbox
here and we've allowed the users to
choose their settings let's just quickly
go ahead and log in as Billy and go
ahead and change the settings to not
receive email and I guess I'll quickly
go and log in as myself here just to
update that so I do receive an email
perfect so now we have all set up to
test this we have Billy not wanting
email me and Dale and Ashley all wanting
email so I'll be in the next part of
this walking you through actually how we
can go ahead and send these emails</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>