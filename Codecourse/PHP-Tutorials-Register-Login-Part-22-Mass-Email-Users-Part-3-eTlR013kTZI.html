<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 3)</b></h2><h5 class="post__date">2013-10-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eTlR013kTZI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay welcome back we're now going to be
getting to the fun part of this and
actually registering our not registering
actually sending this email to our
registered users so we're gonna test
this as well
as I said at the start of the video we
have Dale and Ashley now with two valid
email addresses that I have registered
so we can go ahead and check that this
has been sent probably I'm also gonna
take into account greeting so within the
body let's just go over here within the
body we're not going to say hello
username we're actually going to just
write our body so of course you do with
the subject here and then the email will
automatically say hello X for their
username so we'll incorporate a kind of
personal factor into this as well so
let's go ahead and actually get on with
writing this mail users function so go
ahead and uncomment this out now mail
users it's going to take a subject and
it's going to take a body so I'm gonna
go ahead and open up my users dot PHP
file and I'm going to create a function
here called mail users and as I just
said this takes a subject and it takes a
body so what do we need to do here well
not a lot
we need to query our database select
specific data about each user where the
allow email field is equal to one so
let's go ahead and quickly write this
query out so the query is going to be
select now this is up to you which
fields you want to select the most
important is email because as we go
throughout all of our users we need
their email address but I'm also going
to I'm also going to select their first
name that's about it from users where
allow email is equal to one so with
basically selecting all of the users
where allow emails equal to one let's
just go ahead and test this in here
so select that email first name from
users where allow email is equal to one
so click go
we are returned with Alex Dale and
Ashley not Billy
so remember Billy has a zero okay so now
what we can actually go ahead and do is
loop through them and send the email so
we use a while loop because inside this
while loop we want to say one row is
equal to MySQL fetch associative array
pass in the query now while all of that
so you encase that in parentheses
doesn't equal false and this is just in
case that you don't have any users in
your table or no users have allowed
their email or what do we want to do or
we want to use our email function that
we created in general dot PHP to send an
email we need to pass in two so the
email address subject and body which we
already have so to where do we get this
data well we get it from row which we've
set here and row is now an array so we
can just pass an email an email here
corresponds to the email address that
we've selected here so email the subject
we've passed through to this function
from mail dot PHP here this posted
subject so we just type subject and then
body but we want to make an adjustment
to the body and we want to say oops we
want to say hello so-and-so so we want
to say body and we want to say is equal
to something and then append on the body
so we're basically resetting this
variable but we're adding something to
the start of it so what's the thing that
we're adding to the start of it well as
I said it's hello X a comma and then two
new lines and then we start the body so
here in X we're going to escape out of
PHP
and we're gonna pass through ro and
again the same as we did with the email
first name the first name corresponds to
the first name that we're selecting from
the database so for every user now this
is gonna loop through it's gonna set the
body to hello
Alex hello Billy hello nope not Billy is
not accepting email but Dale and Ashley
and it's going to email them to their
email address obviously with a subject
and our body which we now have hello on
so let's go ahead and test this out why
not so over to here I've got my mail
client open at the moment we are logged
in as who were logged in as does it tell
us
I think it's Billy in fact let's just go
ahead and log in and get out and there
we go so Billy at PHP academy' - org so
Billy at PHP academy' dorg is not going
to receive emails so that's actually
just you know we'll just go ahead and
test this out so once my PHP can me of
course you do okay so a bit of a spam
message but just for testing purposes so
let's go ahead and click send what's
going to happen now is it's gonna loop
through all of these users it takes a
while obviously cuz it's sending a few
emails out email has been sent and now
we can go and go ahead and check this so
let's open up our web mail Billy at PHP
academy' - org let's login and let's see
an email should not be there because
we've only selected users that have
email sets of one allow you mouse it to
one so no email that's good let's go
ahead and log in as someone else
so we'll say dial-up PHP academy' - org
let's check the email here now this
should have received an email because we
have that set to one allow you mouse it
to one brilliant so we have an
activation email from earlier and we
have an email want to where PHP academy'
double click hello dial hello Alex of
course you do ah now we have seen a
problem here so why is this happened
well this is actually good that this has
come up because now we can go in and
sort of assess why this might be
happening now the reason that this is
happening is because what we're doing is
we're actually looping through and we
are setting the body variable with this
hello something every time so we're not
making it unique we're just adding to
this overall variable now imagine if you
were to send this to a hundred people
you'd have a hundred lines of code here
of of hello of greetings here so we need
to modify this in some way so what we do
is instead of resetting this variable we
go ahead and we take the part that we
need so cut that out get rid of this
line here and use it just in here and
remember to concatenate that on with a
dot so we're not resetting this variable
now we're just placing it in every time
and body's remaining the same so let's
go ahead and resend this just so we know
that it's working so click send and
we'll wait for that just for a moment
while there me male send okay so the
emails have been sent let's go ahead and
check the email again now this is Dale's
account so we should just say hello Dale
brilliant so hello Dale of course you do
let's go ahead and log in as Ashley and
then we'll finally go ahead and log in
as Alex
and obviously this time this should say
hello Ashley and then it will give us
the the same message as well so there we
go want to buy PHP academy' that will be
the other one that didn't work so hello
Ashley Dale and hello Alex
so let's read the updated one up here
and this just says hello Ashley
brilliant and I'm not going to bother
looking as Alex because it'll be exactly
the same thing okay so yeah now we've
basically created this system that
allows us to email all of the users that
have set their preference to the fact
that they would actually like to receive
email if they do or don't want to
receive email so relatively
straightforward with what we've already
done here we're looping through our
users we're sending an email to everyone
with a specific field marked as yes or
no</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>