<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 19): Forgotten Password (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 19): Forgotten Password (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 19): Forgotten Password (Part 3)</b></h2><h5 class="post__date">2012-05-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ulumCmoLnCg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">oh yeah of course that's because I've
got my if statement here that's just
that that's a one equals one so it
doesn't return this error so we've got
in it dot PHP okay so that gives our oh
now of course sorry we can't do it this
way and the reason being is this will
return the current file and where this
is essentially defined and the problem
here is that we doing this is within
init dot PHP so we need to take a
slightly different approach there's no
problem at all we'll always come across
things like this so we're going to use
the server variable set instead and
we're going to say script underscore
name so make sure that's in capitals so
what's this going to look like well
let's go ahead and just preview this and
it's got LR forward slash recover dot
PHP so this is what we need recover dot
PHP which is the file that we're
currently on but we don't need this LR
bit here so how do we how do we sort
this out well we can use explode round
this which will essentially take the
first parameter will be the delimiter so
that'll be a forward slash because we
want to explode this turn it into an
array now you'll see that we echo out
the keyword array which is not what we
want but if I go ahead and down here say
print underscore our current file you'll
see that we've got two elements to this
sorry three elements this the first one
is blank and then we've got L R and then
we've got the last one is recover dot
PHP now this is the key bit of
information that we need so what we do
here is we use end there we go an end
will take the last element in an array
and it will return it in its strict in a
string form so now if we go ahead and
echo current file this is just recover
dot PHP and we've got this warning up
here let's just go ahead and find out
why that might be
hmmm I think this might be because we've
got this on two lines so let's just go
ahead and cut this and say current file
is equal to there and we'll say current
file equals end current file let's just
try that
there we go that's gone I that don't ask
me okay so we've got now the current
file name so in here or what do we want
to do we want to only redirect the user
to change password dot PHP if the
current file isn't changed password dot
PHP and the current file isn't logout
dot PHP so if current underscore file
doesn't equal or isn't equal to change
password dot PHP and current file
doesn't equal logout dot PHP and user
data so this user data thing here we
need to grab this field from our
database which is password under
underscore recover
so if you use a data password underscore
recover is equal to one so if the file
isn't changed password dot PHP isn't
logout dot PHP and the password recover
flag has been set to one forcely used it
to change the password so let's check
how this works out let me just go over
to my email make sure I've got this new
password copied I'm gonna go ahead and
now log in in fact let me log in as Alex
first just to show that it's working I
can navigate my way around blah blah
blah
so I'll log out on login as Billy log in
and we're automatically redirected to
the change password page now this isn't
very user friendly but it's
demonstrating this concept you can go
ahead and add in messages or anything
like that perhaps a little sort of force
or something at the end of that in fact
let's go ahead and do that cuz that's
quite interesting let's go ahead and add
on here force and then I'm going to open
up change password now let's scroll down
and we'll say here so here we're looking
for success thing on the end now I'm
going to say else if something do
something else do something else so else
if same as this in fact I want this to
be equal to true and this equal to true
that's just it's not required but just
to good practice to do this so here I'm
going to say force o in actual fact this
isn't going to bloody work is it okay
let's go ahead and get rid of this so
else I'm going to say if
this now the reason that wasn't going to
work is because then it wouldn't show
the form so basically we're just trying
to display a little message here so I'm
just going to go ahead and change this
to force and I'll change its force and
if you are completely lost here which I
can totally understand I'll go ahead and
explain this in a moment so if we have
this little force thing on the end this
little get value will get parameter or
whatever you want to call it and it's
empty then we can go ahead and say you
must change your password now that
you've requested whatever but I won't
waste time wording it so force in the
end is now giving us this when I click
around it's not letting the access any
other bloody page so that's good change
password I can access and so I've
clicked on that and that force things
gone now but that's irrelevant because
when we click around on so profile
settings we can't do anything but we can
log out okay so just to demonstrate let
me just go ahead and paste this password
back in again just to demonstrate if we
didn't have in in it dot PHP this bit
here so for example checking that the
current files logout and we click logout
oh it did work oh of course we're not
including in it dot PHP on logout are we
let's just go and check no we're not
perfect so we don't even need to do that
that's fine
that's absolutely fine anyway let's go
ahead and crack on with this so let's go
ahead and get rid of some pages that we
don't need we don't need change password
we don't need any dot PHP now in fact we
don't need these all we need is to open
the change password file because now
that we log in as say Billy
copy this and paste this in we need to
change our password
so once we've changed our password we
need to set this flag in our database
here from 1 to 0 so how do we do that
well easy what we need to do here is the
change password function we just need to
modify to always set this value to 0 so
let's go ahead and open up core
functions users and I promise this is
the last bit and we'll just have a
little summary after that so the change
password function if we scroll down it
says update user set password equals
password where user ID equals user ID
I'm going to say and keep forgetting
what the field names called that's
putting it up good thing password
underscore recover equals zero so now
when we go ahead and change our password
so current password is our remember our
generated password copy that in new
password I'm just going to set to
password new password again I'm just
going to say password change password
password has been changed
I can now oh I can't that's interesting
let's just go ahead and check here yeah
that's still set to one password under
risk password underscore recover oh
sorry
ok I've completely malformed the query
um so who update user set password
equals password comma part password
underscore recover equals zero that's it
I accidentally had the an keyword in
there so our password is still this
because that query failed so let's go
ahead and copy this and paste this in
here I'm going to change my password to
plain text string password click Change
Password current password is incorrect
okay so let's just go over to our users
here we go look at that password equals
zero okay so we've really messed this
one up haven't we okay so let's let's
just revert this
back to password and we'll start from
the beginning so I'm converting this to
md5 so it's now this so let's start from
being I'll go ahead and look out I'll
enter my email address recover okay so
now starting again we have changed the
password our temporary password and
we've set password recover to one when
we check our email we have our generated
password copy that we login with this
new password and we're forced to change
so now our current password is that
password password so my new password
change password done
now let's double check this has worked
so let's click browse so now this has
been changed back again to password you
see it matches this one which means that
what I know for a fact this one's
passwords this now must be password and
the password to recover flag is set to
zero so now I can go ahead and access
all of the bits and bobs that I might
need to okay so that's been really long
but it's we've gone through that process
if you're confused
essentially all we're doing is just
updating different values flagging
things and then checking them when we
log in but have a look at the code and
if you've written it down and you know
this this isn't too hard to understand</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>