<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create Your Own PHP Mail Wrapper | Coder Coacher - Coaching Coders</title><meta content="Create Your Own PHP Mail Wrapper - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create Your Own PHP Mail Wrapper</b></h2><h5 class="post__date">2015-04-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nXV1NlU24mY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we're going to be building a
male rapper in this video to allow you
to send email a lot easier throughout
your application and for this video
we're going to be working with PHP
mailer but of course you can use any
solution you want and you can customize
the classes that we're going to be
building to work with whichever solution
that you go with however in this case
like I said we're gonna be using PHP
mailer you can see here that we're
connecting via SMTP to a gmail server
and we're gonna be sending email that
way so down here then is basically what
we're going to be able to do once we
have done this so somewhere in our
application we're going to create a new
instance of this mailer class and what
we're doing in what we're doing here is
we're passing in the PHP mailer instance
to this as a dependency and then from
that anywhere in your application you
can then say mail send you can choose
the view which we'll take a look at in a
moment you can choose any variables that
you want to send through to that view
which is essentially just going to be
your email and then we have this closure
here which allows us to define things
like who the email is to the subject and
then you can go ahead and add anything
else in here if you wanted to add email
attachments you could build in this
functionality so this is what we're
going to be building we're gonna head
over to the code and start building this
up and you'll be able to use the syntax
like this to go ahead and send emails so
before we get started building our
wrapper you're going to need to make
sure that you are connecting to an SMTP
server or using local mail which I
probably wouldn't recommend and as long
as you have this setup we can go ahead
and pass this mailer instance into our
class that we're gonna build in a moment
and then you can send email so do the
standard PHP mailer stuff and then we
can go ahead and use this to build a
wrapper you can go ahead and copy this
if you want and then obviously make sure
that you are sending a test email you
can find all of the information about
PHP mailer on the on the documentation
if you get stuck so we're now at the
point where we are basically have the
ability to send email and we're gonna
build this wrapper but let's take a look
at a few other things before we get
started so first of all I am Pierre self
for Auto loading everything within this
app project directory which doesn't
exist at the moment because I've deleted
it if you don't want to PSL for auto
load if you don't know what this is we
do have a video on this so you can go
ahead and look it up however if you
don't want to do this it doesn't matter
it just means you're not going to be
able to namespace your application under
your root project name but don't worry
too much about that you can just omit
the namespaces if you want to the second
thing we're going to look at is the fact
that in this app folder within our root
directory we have this views for views
folder and then in here we have this
email folder and then in here we have
this workroom dot PHP file and this is
going to be the email that we're going
to send we're essentially dealing with
views here because where we're treating
this like it's a real application and
views are often stored in a separate
directory and you can categorize these
so in this case under app which is going
to be sort of the base for all of our
project we have this views folder which
contains email which obviously
everything in here is going to be emails
and you can obviously add these in
subdirectories if you want but this is
the file that we're going to be sending
as an email you can see here at the
moment it says welcome to the site and
then echo name so this is what we want
to replace using our new wrapper so once
we've got this all set up if you aren't
using psr-4 don't worry too much about
it we can start and and build this class
so what we want to do then is inside of
our app directory we're going to create
that project folder and again this can
be put anywhere in your application it
doesn't have to be in this structure but
I would highly recommend sort of using a
mini framework building this into it and
inside of here we're going to create a
new folder called mail and that's just
gonna hold our two classes that we're
going to be building in this video so
the first class is going to be called
mailer PHP so let's go ahead and
this and let's go ahead and start to
write the code out for this so the idea
of this is we instantiate it we pass in
our mailer that we have on our index
page obviously this would be at
somewhere else in your application we
passing that mailer to this as a
dependency and then we can use that to
build up a message and send that message
eventually so I'm going to namespace
this because I'm using psr-4 autoloading
so I'm going to name it under project
mail since this is project and then
under this mail directory and I'm going
to go ahead and create this mailer class
so the first thing we're going to deal
with is pulling in this this mailer this
PHP mail instance as a dependency so we
have a constructor within this class and
that's going to take in a mailer and you
can of course type in this as well if
you want so you could go ahead and type
in two I'm not going to because I'm
going to assume that this might be
something other than a PHP mailer of
course you could use things like
interfaces here which would make this a
lot easier but for now we'll just keep
things as as simple as possible
so what we want then is at the top of
here a mailer property and all we doing
here is we're just setting this mailer
to the mailer that we pass in that's it
so let's go ahead and instantiate mailer
so down here we're going to go ahead and
say mail so notice the difference
between mailer and mail and we're gonna
say new project mail mailer and then we
pass in our PHP mailer instance that's
it so we now have this instantiated we
can do whatever we want here so the
methods within this mailer class are
basically just going to be send well
that's going to be the only method and
to send an email we're going to be able
to give us the ability to pass in a
template any data we want to be sent to
that template and by template I mean the
view that we saw in here earlier so we
can just open up ready and we're also
going to
a callback and this callback is going to
head go ahead and deal with things like
who the email is to any attachments you
want to add and that's what we saw
initially when we were looking at the
index dot PHP file where you had that
closure in there which allowed you to do
that in a nice structured way so let's
go ahead and create this send method and
like I said we need to pass in a
template data and we have our callback
so the reason I've called this template
is because this works really well with
something like twig if you're working
with a templating language what we're
actually going to be doing in this video
is we're going to be requiring in our
template in a slightly ugly way we're
going to be using OB start requiring the
file the template file which is this
welcome dot PHP file and then we're
going to use method functions that only
get clean and I'd be end clean you might
not want to do this you might want to
also pass in some kind of templating
language as a dependency and then you
can pull in whichever view you want to
with that but we'll leave it as it is
now and you can go ahead and implement
that later if it makes sense so what we
want to do then is we want to go ahead
and just test how our view is going to
look when we when we pass it into this
send method so the first thing that I'm
going to do then is extract the data
that we pass in what we can do is of
course do something like mail send and
then we can start to build this up so
remember we have the first argument is
the path to the view or the template so
in this case it's going to be app views
email welcome dot PHP and then we have
an array of data we want to send in so
we're gonna say name Alex and of course
this could be elsewhere you could have
it as a variable up here and you could
just pass that variable in then lastly
we have our closure in here
and what we're gonna have here is an
argument here we're just gonna call it M
just for sure and this allow us to do
things like m2 and whatever we want to
do but this functionality is not going
to be defined within our mailer it's
going to be defined within another class
that we're gonna pull in when we want to
send data that might sound a little bit
confusing at first but don't worry too
much so we want to go ahead and extract
the data that we want to use now view
and this is only really necessary with
the method that we're using now to
require in the template using OB start
OB get clean an OB end clean but if you
were using a templating language like
twig you'd just be able to pass the data
straight through you wouldn't have to
extract it like this so it's worthwhile
looking into a solution using twig or
something so now we want to require in
our template and to do this we're going
to use OB start we're going to require
in the template this is basically just
pulling this template in and then what
we're going to do is we're going to have
a variable or redefine this variable
reset a value on this variable to OB get
clean and all this is doing once we've
done ovn clean is it's requiring this in
setting it to this variable here without
actually outputting it to the page if
you were to comment this out and comment
this out when we go ahead and look at
our page you can see it's actually
pulling in that template now you've
noticed already it's replacing that
variable that we have inside of that
welcome email so this name variable here
all extract is doing is taking this name
this this key here and it's extracting
it here and then we have that name
variable available so not an ideal
solution again I know I've said this
about three times but working with
something that twig would be a really
good solution here so when we have
Obie's start get clean and then clean
you can see that nothing is happening
here but if we were to say go ahead and
echo template we see the following so
that's why we're doing this
so we're not gonna echo template because
the template is to set in the body of
the email but what we haven't done now
is pull in our message class which we're
going to build next to actually handle
setting who the emails to the body etc
so let's go ahead and do this now so if
we go ahead and create a variable up
here called message and this is going to
be a new message and in to this we're
gonna pass in this mailer so we have all
of the functionality available from PHP
mailer within this message class which
is going to be useful for doing things
like setting who the emails to the any
attachments the body anything like that
so obviously this is now going to fail
because we don't have a message dot PHP
class so let's create this now inside of
this mail directory so let's save this
as message dot PHP and let's go ahead
and again give this a name space so the
name space is going to be project mail
and the class is message and again
remember we were passing in the mailer
as a dependency to this message so all
we need to do in here is create another
constructor and we pass in our mailer we
have our mailer property at the top and
we set that oops to the mailer that we
pass in so now we have control over what
we can do within this closure room but
that's everything we do in here so what
we're gonna do is we're gonna say
something like m2 and I'm gonna choose
an email address for example format code
course comm and we can do some things
like and add attachment if we really
wanted to we're not going to cover this
in this video because if you read up in
the PHP mailer Docs you'll find out how
to do that but this is how we do this
so let's now then finish off this method
with this too method so we have to and
then we have an address passed in of
course you can pass in the name as well
which PHP mailer lets you do but all
we're gonna do here is gonna say this
mailer add address which is PHP mailer
functionality and we just pass that
address in so now what's going to happen
is when we refresh we don't see any
errors because we've created this
message class which is being used here
and this functionality here because we
have this M argument in here we're
allowing ourselves to go ahead and use
this functionality so it does seem a
little bit complicated at first but if
you don't quite understand this you can
just go ahead and and go through in your
own time and look at how this is working
and I'm sure we'll become clear soon
enough so let's finish this off with any
other functionality we want to add to
this wrapper that comes from PHP mailer
so for example I might want to be able
to define a subject which is obviously
really important so in here we need to
pass in our subject and then all we do
is exactly the same thing using PHP
mailer which is a mailer instance here
we just say something like subject
equals subject that's it and last but
not least we'll say body so public
function body and we passed in the body
here which is eventually going to be our
template and then we say this mailer
body body so you can extend this clot
will not extend it but add to this class
to go ahead and add any more methods you
want to do to deal with that so body
we're not going to be using within this
closure just here but we are going to be
using subject so let's define a subject
just here and we'll just say welcome to
the site like that so let's go ahead and
have a look at this its refresh till we
get no errors so everything seems like
it's working art we need to set the body
and we know what the body is it's the
template so we can just do this down
here and we can directly do this for a
mess
so you can say message body template so
remember making use of this body we have
here and that is pretty much it the only
thing we haven't done is we haven't
called with our callback this message
object and what's going to happen is
this isn't actually going to go ahead
and tie in everything we've done within
our callback to this message class I
should have probably mentioned that
before but we only use call user func
we'll call user function we're going to
say from that callback we want to apply
this to message so what you'll see now
is when we refresh obviously we don't
see anything but you could go ahead and
just test this out if you were having
any problems see you could perhaps to a
var dump on the address here and you'll
see that you get the address out etc etc
so it's being called obviously without
this it's not going to go ahead and call
their method so we won't see that so
let's get rid of this far dump and we
are now ready to send the email
so because everything has been set
within message to our mailer instance
we've gone ahead and called this we've
obviously got our template we've set our
body here we can just go ahead and send
the message and to send a message with
PHP mailer all we do is we say this
mailer which is remember just PHP mailer
send okay and you can add some checks
here to see if there was a problem
sending the message you could throw an
exception from this you can do whatever
you want really
so now let's return back to index dot
PHP we've got everything set up remember
in our welcome email we're outputting
name here we already saw that when we
examined the contents of that template
we're specifying who this is - I happen
to have my mail client open just here
and we are setting a subject and you can
add any functionality one inside of here
and remember we are setting the body in
here from that template so let's go
ahead and refresh and we should see that
leyland and then there we go we have a
new email welcome to the site Alex you
can obviously include any variables you
want inside of the subject as well
you've got full flexibility here so that
was just a very basic look at creating
some kind of mail wrapper which makes it
really easy to send the email throughout
your application you've defined this
elsewhere in your application you have
this some kind of part of your
application maybe within a container and
then here you can just call this
whenever you want to send the emails
you've got all of your email contents
within views which is nice and tidy you
separated everything out and there we go
you've got a brand new way to send email</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>