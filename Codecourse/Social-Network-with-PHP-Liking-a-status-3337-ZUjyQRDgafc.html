<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Social Network with PHP: Liking a status (33/37) | Coder Coacher - Coaching Coders</title><meta content="Social Network with PHP: Liking a status (33/37) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Social Network with PHP: Liking a status (33/37)</b></h2><h5 class="post__date">2015-08-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZUjyQRDgafc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now we're going to implement the ability
to actually like a status so to start
with on our user model we are going to
implement a new method which is has
liked status because we're going to need
this later obviously one user can't like
a status more than once so we need to
determine if they've already liked it so
let's implement this now and the method
name is going to be has liked status and
in to this we're going to be able to
pass a status which we can use to
compare so if we haven't already
which we haven't up here we'll need to
go ahead and use chatty models status
and down here we can return status which
is the status we park past in likes and
then we can add a few we're courses just
in here and I'm going to pull this down
just to make things a little bit easier
from keep that one up there so the first
condition is where the likable ID equals
the status ID the second is where the
likable type equals the class name of
the the status that we pass in so we can
either hard code this in or we can use
the get class function and pass in
status in case the name of that changes
that will be the full namespace to that
and then we're going to say where the
user ID equals this ID I'm gonna grab
the camp from that and of course we're
going to cast this to a boolean so there
we go we've got our has light status
method which we can use later on the
next thing I want to do is obviously if
I'm on my timeline here I've written
this so we can't like our own statuses
so we want to get rid of that and we
also can't like statuses of people we're
not
friends with so for example if I search
for Dale's profile here I want this to
disappear so we're going to update to
templates here if we go to our resources
views and our timeline here click on
index let's go down to where these
lights are so we've got one here for the
actual status and then we've got one
here for the status replies so for this
we're just gonna wrap this in an if
statement just here and we're NDF just
there and this is going to basically
check if the status user ID doesn't
equal or user ID so on here you can see
that for my status down here and this
should be reply status or reply user ID
will do the same for the one up here as
well so let's just do that so if the
status user ID doesn't equal currently
authenticated user ID and there we go so
we can like this status here because
it's Billy we can like this one we can
like this one but we just can't like one
that is our own that's absolutely fine
and you can obviously change this around
if you want so the next one to look at
is our page here we need to do the same
on here again if you have cut these up
into partials this will be a lot easier
but in this case we need to manually
change these as well so this one
shouldn't be able to be liked and nor
should this one from my account so let's
head over to our profile index page and
we'll do the same check here and why
don't we just go and copy that over from
here just to save having to write it
again like that we'll copy this line and
free to reply
we want the same check-in here will
indent that and this is reply usual ID
so in here we see exactly the same thing
we can like Billy's status now so what
we can now do is we can create our
controller method and this is going to
be on our status controller so let's
open this up
status controller let's implement a new
method here to be able to like so this
is going to be called get like and in
here we're going to be able to pass
status ID so let's just die dump the
status ID for now and we will update our
routes so let's go over to our roots
here and down here we will create a new
route and this is going to be status
then the status ID and then like so it's
a get request because it will be a link
and then here we have our array I'm
gonna do the same thing we need to be
authenticated remember this is going to
use status controller get like and this
would be status like and again
middleware for authentication so now
that we've got this in place we can use
status dot like as a route and we can
use that on our both our timeline and
our profile pages so let's update these
now if we go down to this here first of
all this is on our timeline let's say
route status dot like then we need to
pass our status ID in and that is status
ID we can copy and paste this or just
make sure that's working first of all so
from our timeline if I like this you see
three because that's the status we're
about to like so we can do that for the
replies as well and this will be reply
ID so we can do the same thing here
we can like police reply okay so we'll
do the same thing on our timeline as
well of course if you haven't
implemented a timeline or if you've set
up your templates so they're reusable
you won't have to keep repeating
yourself like this we'll do the same
thing for status ID here and then we'll
do the same thing for our like just down
here that will be reply ID and we can
check this out as well on our profile so
we can like this one there we go
in Agra fact for the statuses here we
don't actually need this because this
will always be our own status so I can
actually get rid of that just a mistake
adding that in in the first place so
there we go
there is our roots to our like what I'm
gonna focus on the timeline here and I'm
gonna go ahead and try and like
something we'll be handing the account
of likes in the next in the next part so
now have anything in here at the moment
but we know that we're going now going
through to this status controller and
we're killing the page there I'm just
gonna get rid of some of these files
that we just don't need at the moment so
once we have a status ID we can
obviously pull through that status so
I'm going to say status I'm going to
find that by the status ID and we'll do
the normal checks so we'll check if it
doesn't exist so if no status we just
want to return redirects let's say
redirects to the home ruler so you
should never be in the situation where
we're trying to like something that
doesn't exist but you can obviously
handle this in your own way the next
thing we need to do is check that the
user making the like is friends with the
person they're liking the status
otherwise we're gonna allow anyone to
like any one status so if it's not the
case that the current authenticated user
is friends with and the status user we
pull from this status model and if that
isn't the case then we can go ahead and
return
it's the homepage because these
obviously trying to do this when they
shouldn't be and the next check is
whether they've already liked the status
if we go over to our user model again
and just remind ourselves we have this
has like status which we just pass a
status into so we can have another one
here so if the currently authenticated
user has already liked this status we
pass in that status then we return and
we redirect the user back so what we can
do now is we can create the like in the
database table and this is pretty
straightforward even though it's a
polymorphic relationship we can do this
quite simply by saying like equals
status so we're accessing the likes
method on or a relationship on our
status table so that's this here and
then we are creating one we don't need
to pass anything in so we can just pass
an empty array in there so now we want
to associate with this or save this to
the current users likes so we say auth
user likes save and we save that like
that'll associated with the user and
then we return and we redirect back so
now we can test this out if I wanted to
like this status here I click like and
is our case it is friends with let's go
back and try this again and undefined
method builder like so let's check this
out
so auth use it likes okay so if we go to
our user model we don't actually have a
likes relationship in here so we need to
implement that now so if we go here and
say public function likes because
remember a user owns alike because
they've obviously liked something and we
return
this as many and then we give the full
namespace of Chatty models like and that
qies user ID so now if we go back and
hopefully third time lucky there we go
so we've liked that we're not we're not
checking here if if this has already
been like we're gonna leave the link
I'll let you kind of decide how you want
to show that or keep it in there but now
we should see this in here so this was
the first one that failed so I'm going
to get rid of that and you can see here
we've got a user ID of one a likable ID
of eight a likable type of Chatty model
status we've liked that status this is
the status ID that we've liked and this
is the user who liked it so we now
actually have that like being stored and
this will be the same for everything now
so wherever we are we can always like
another status and when we refresh
that's just insert a new record but a
different like will ID so now that we've
actually given the ability to like
something we want to show how many likes
there currently are so we'll look about
in the next part</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>