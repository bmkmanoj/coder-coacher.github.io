<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unit testing with PHPUnit: Testing a User model (4/10) | Coder Coacher - Coaching Coders</title><meta content="Unit testing with PHPUnit: Testing a User model (4/10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unit testing with PHPUnit: Testing a User model (4/10)</b></h2><h5 class="post__date">2017-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/V3xrGsUIYis" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to the first thing that we
are going to test and this is going to
just nicely ease us into testing and
we're going to be testing a user model
so because we are following test-driven
development the first thing we're going
to do before we even start to create any
classes for what we're testing is
actually write the test first so this
might seem a little bit odd but this
means that what we can do is really
think about how we want what we're
building to work before we start to
actually build it and what we're going
to be doing is writing a test it will
fail obviously because maybe if we're
trying to use a user model we haven't
even created a user model yet it will
fail and then we go ahead and we
refactor or we build and then we make
our tests pass and this may take a
little while to get into but it's a
really nice way of testing and hopefully
you'll agree if you're following along
so let's start by creating and you test
this is going to be our user test or
user model test whatever you want to
call it I'm just going to call it user
test of PHP and we are going to
literally copy the structure from our
sample test over here now obviously we
don't need our sample test in here so
I'm going to go ahead and get rid of it
and we're going to think about the first
thing that we want our user model to do
we're going to write our test for it now
so let's say that we wanted to be able
to set and get a first and last name on
our user model well let's start with the
first test so we're going to call this
test that we can get the first name or
set and get the first name whatever you
want to say so we've defined out our
test we go ahead and we knew our user
model which is going to be an app and
this is where test-driven development
comes in handy we're going to say where
do we want this to even belong well
maybe we won it in a models directory so
we're going to go ahead and new up a new
class which doesn't exist yet which is
absolutely fine I'm going to go ahead
and start to write our test
so I'm going to say user and now I can
start to think about what kind of
functionality I want here and we're
going to say set first name I'm going to
go ahead and give a value so let's go
ahead and put that in there
and now let's test that we can get the
first name back so I'm going to use a
new assertion which we haven't looked at
yet we've seen assert true but in this
case we want to check that something
equals something and we want to check
that when we use a getter for our first
name it equals the value Billy so in
this case I can say a certain
equilibrium we're testing that we can
get the first name once it's been set
and of course you can change around the
test name if you feel it's a little bit
more appropriate to explain both of the
things that we're doing so let's just
switch over this to user test but you've
got to do that and let's go ahead and
run this with PHP unit so we see the
first failure here is that user is not
found so let's go ahead and create our
user model over in here in the models
directory we're going to create that
user dot PHP class so let's go ahead and
define all of this out give this a name
space of app and models and create a
user cloth so now that class exists we
shouldn't see that error within PHP unit
instead now we see called
undefined method set first-name so let's
go ahead and implement this simple as
that we just have a failing test and we
make it pass by building the
functionality that we first thought
about when we were writing our tests so
let's go ahead and say set first-name
we know that in to this we need to
accept in a name and we need to set it
to some kind of property so let's say
that this is a public property it could
even be a protected property so you may
not need a getter if it was public but
we're going to be just adding these
guesses and setters in just for the sake
of testing so this user and we're going
to set that to user so this name and
we're going to set this to name so this
will be our first name we're going to
set that to name and we can
you can call this first names this is
the kind of thing that we're doing with
thinking about how we want this to work
and we'll call this first name as well
but we'll call it first underscore name
and the reason I'm doing this is I'm
assuming that we could eventually pre
populate this from a database and
obviously within a database you'd
probably have an underscore in your
column name so this looks good I'll set
to uses PHP convention variable naming
here and our properties use kind of
database convention so let's go ahead
and run the test again and we know that
this time we have a call to undefined
method get first name so let's go ahead
and implement this method and what I'm
going to do is make this pass and then
refactor it so I'm going to go ahead and
say get first name and what I'm going to
do is return the value that I expect so
my test passes now this is quite a
common thing and I'd quite like to do
this with silly examples like this it
really doesn't matter too much but what
we're doing is we're making our test
pass first of all and then we're going
to go in and refactor it so we know that
nothing has broken so we're just kind of
mocking this out let's go ahead and run
PHP unit again and you can see that our
tests are now passing brilliant so now
that it's passed we can say well we know
that it's passed so we know that this
method works now we can refactor it so
it actually returns two value that we
expect so in this case we would just
return this first underscore name and we
still get green so we know that this was
successfully refactored obviously this
is such a simple example but later on
the line what we're going to be doing is
implementing more complex functionality
within this course and then going back
and doing a full refactor of a
particular method and checking that it
still passes so this will get a little
bit more interesting as we go so now
that we've done this we know that our
tests are passing we haven't even used
our user class yet but we know that this
works we know that we can set and get
the first name now I'm going to do a
similar thing for the last name so once
again I'm just going to copy this down
and really just as a kind of side know
it doesn't matter how messy these kind
of things get it really is just about
making sure that everything works so I'm
going to change this over to tests that
we can get the last name let's go
head and say set last name and we're
going to set this in here just as we did
before and then we'll go ahead and
implement the functionality so get last
name and we are going to make sure that
when we set and get these both work so
let's go ahead and run our tests we
obviously see a failure because we don't
have this set last name method so let's
implement both of these methods and
we'll see that our tests hopefully go
green so let's say set last name and
into this obviously I'm going to pass in
a last name and then in here we're going
to set this to this last name like so
that will just fix that up and then we
are in we can immediately go ahead and
create our get last name methods we want
these aren't particularly interesting
things to test so we're just going to
return this last underscore name and
let's go ahead and create a proxy for
this as well so last underscore name and
there we go we're at green we know that
we can get and set our last name now
okay so over in the user test let's look
at something a little bit more
interesting and then we'll look at
something even more interesting this is
going to be that testing the full name
is returned when we call a full name
method so let's write our test as usual
first of all so we're going to say test
full name is returned like so what do we
want to do here well the first thing we
want to do is new up the user model then
we want to set our first name so we can
go ahead and set the first name we want
to set our last name and then we want to
test another method returns the full
name so let's write the assertion first
of all so we're going to save this
assert equals and you'll probably find
again just as a side note that assert
equals is what you use most when you are
writing test because usually because
we're testing observable functionality
we're testing that things equal things
or that they're true or false or we have
array keys and we're going to cover
quite a few assertions in this course
but you'll mainly find yourself using
assert equals assert count assert true
and all that kind of stuff
so let's assert that you
user let's say get full name or we could
call it full name whatever you want to
do this is the kind of point of doing
this we kind of work out our own API
while we're writing and we're going to
assert that this is Billy space and then
Gera so let's go ahead and run this and
obviously we get a failure because we
don't have the full name method in there
let's go ahead and implement this so
public function get full name and let's
again just kind of stop this out so
we're going to say Billy Garrett will
make it pass its passed and now we can
go and effectively refactor it to make
it work so let's say let's return this
first name and let's concatenate on the
space and return this last name and we
know that we get greens this is
technically a successful refactor now
what happens if we say I don't really
like the look of this maybe I want to do
this
so this first name space this last name
now if we were to make a mistake here
maybe you do something like that
or put an additional few spaces in by
accident we know that this is going to
fail so you can see here failed
asserting that two strings are equal his
are expected this one and here's our
actual which is Billy and then load of
spaces gara so we know that this is
effectively failed we can go ahead and
fix that out run it and we know that
this now passes brilliant so now that
we've done this we're going to look at
slightly more interesting tests we're
going to look that when we do set our
first and last name that they are
trimmed so if for example we passed in a
name of a user who's registering and
they added a load of spaces we need to
make sure that these are trimmed when we
set them in to our model so again it's
just a sensible test that we would maybe
right so let's go ahead and do this now
so we're going to say test first and
last name are trimmed so again we are
making this plain language so we can
read exactly what's happening and later
we're going to look at way that we can
even further tidy this up so we're going
to go
and again new up a user model and then
we're going to go ahead and set our
first and last name like so but of
course what we're going to do in this
case is set the load of spaces so let's
do a few spaces that slide and then
we'll do a few that side so just
something that someone may enter and we
want to check if they are trimmed so we
know that when we assert these two equal
Billy Garrett or Billy and Garrett we
know that these are going to fail so we
know this is going to fail before we
even do this so let's say assert equals
and we want to check that user get first
name is equal to Billy the trimmed
version and we know that we want to
check get last name and sorry they
should be methods equals Garrett with no
spaces we know that this is going to
fail because we're not actually doing
any trimming whatsoever now we can
refactor to make sure that they are
trimmed so if we head over to our user
model when we use our setters we can go
ahead and trim these so we can say trim
like so so we're technically refactoring
code we've already written but obviously
we now have tests in place so we know
that for example if we did something
wrong here and that led to not being
able to get the last name we already
have a test for that so we will see any
failures of any refactoring so let's run
this again and we get green we know that
that has now passed brilliant all right
so let's go on to look at something
again even more interesting and this is
going to use slightly different
assertions so what we're going to do is
we're going to test that an email can be
set and grabbed back out using a getter
and then we're going to test building a
new method which grabs email variables
now email variables are just typically
an array of the users full name and
their email address which you can then
place into any kind of email sending
service which replaces variables within
email so for example you'd see something
like hi and then something like full
underscore name and then when you
actually send the email these are
replace so again it doesn't matter what
these are used for
we're just going to look at a slightly
more complex example so just to kind of
practice let's create a test email
address can be set and you can change
the name over to being able to get it as
well we're just going to say well we
need to be able to set and get an email
address so let's very quickly write a
test for this so we're going to say user
set email I'm going to pass in an email
address so for example Billy at Code
course comm and now we're going to
assert we're going to say assert equals
once again that the user getting the
email is equal to Billy app code course
comm and again just a side note if you
find you're repeating anything like this
of course just feel free to create a
variable for this it doesn't matter how
messy these really look to some extent
it does but generally you want to just
make it a little bit more convenient to
write things in this case it's
absolutely fine but if you were to have
lots of variables that we or you're
reusing for different assertions feel
free to just create local variables for
them it really doesn't matter that much
so we know that this is going to fail
because we have no set email method and
of course we have no get email method so
let's go ahead and implement these very
quickly just into here so public
function set email like so passing that
email address we set that to an email
property like that and then we go ahead
and implement our debtor as well so
we're going to say get email and we will
just return this email we're not going
to stub this out because it's very very
simple and of course up here we can go
ahead and use email now once again I
know there are a lot of side notes here
we know that these are public so
technically if you didn't have getters
and you did want these to be public you
could write tests just to literally
access the first and last name so you
could technically say user first name if
that was a public variable and if it was
intended to be a public variable or
public property sorry now if it was
never intended to be public and these
you wanted them to be protected and you
wanted sex
getters just so they couldn't be
modified or accessed individually then
there's no need to actually test these
properties are set
remember that testing here unit testing
is about observable behavior knowing
that what we have available to use works
we wouldn't want to maybe use PHP
reflection to actually try and test that
these protected properties were set
there's no need it's observable behavior
if these are protective is likely that
we're going to have getters anyway so
you're just going to test the getter you
don't need to test that these are
actually set so just use observable
behavior really really important now in
my case I want these public because this
is a kind of if you use a model that
maybe comes from our database so I'm
going to leave them as public and just
test the setters and getters anyway so
let's run this again we know that we get
green now because we have implemented
that get email and set email method so
now we want to think about these email
variables array that we're going to
return from our user model so once again
we're not going to write any code for
this we're going to write the test first
of all so we know that we get the result
that we expect and we can have a moment
just to think about how we want this
implemented and then we will go ahead
and fill in the functionality so we're
going to say test email variables
contain correct values and I kind of
want this to look like this when the
actual array comes back I want a full
underscore name and that will be the
full name of the use of returned by the
model and it will be their email address
and of course it may be anything else as
well that you want to return here so I'm
going to test that when I call this
particular method on user the user model
I get this kind of result back so I'm
thinking about how I want the
functionality to be built before I start
to go ahead and just build it so let's
once again you up a user model we're
going to take a look at how we can
improve this in the next part and we're
just going to go ahead and set our first
name so really just because we're
testing we can copy these over from here
just to speed things up a little bit
that's of course get rid of these you
could in fact include
basses there can do what you want and
we're just going to go ahead and say
user set email and we're going to set
this to Billy at code course comm okay
so what we now want to do is assert that
when we call say get email variables on
our user model we have an array with the
keys that we expect and and more
importantly then keys contain the
correct value so what we would do in
this case is or at least what I ever do
is create a local variable here to say
user get email variables and I want to
check that this method contains certain
keys so the keys that we just looked at
just a moment ago so let's do that first
so we're going to say this cert array
has key so this is another assertion
that we can use it's simply a key that
we want to be in there in this case we
want full name and we just pass in the
actual array we're looking in which is
email variables so let's duplicate this
down because we also want in there an
email and we again use the same array so
are asserting that the array returned by
this method has a full name key and an
email key now we want to assert that
these full name and email values
actually contain what we expect really
gara
and then the email address so again we
can just use assert equals passing in
what we're looking for so in this case
it will be email variables and then at
that key because we know that our
assertion here tells us if that key does
exist now we know that we can access it
and we know that this must be equal
Billy gara and then likewise and very
similarly we have that email in there
and we know that this must be Billy at
code course.com
so we've written out pretty much four
assertions here that we know must be
true but of course this is going to fail
because we haven't implemented get email
variables we haven't implemented
anything so let's go ahead and now build
the functionality to make this test pass
and this is very simple it's just a
simple method down here get email
variables
and this is going to return an array
with the full name that we expect like
so we've already written the test we
know how this will look or should look
we're going to call get full name and
then in here we're going to say this get
email like so and that should do it
we should now have this passing so we
know that the return value of this has
these two keys and we know that it
contains the correct value just to kind
of fail this test just so we can see you
can see here that we get the exact
assertion that failed so failed
asserting that two strings are equal we
expected to see Billy at Koko's combo
eagle-eye now this means that now if you
wanted to refactor this to maybe not use
a get full name method we know that we
are testing for this so we can say
something like this first name and we
can manually concatenate on this last
name like so and then we know that this
should pass as well we've refactored but
we know it passes because we have a test
for it so let's go ahead and revert this
back to here and as an introduction this
is pretty much done now this may seem a
little bit simple it might seem that you
know what's the point is very simple
functionality I can write code but I
know is going to work I don't need to
write these kind of tests of course for
this is very simple but now that you've
got the tests in place if anything about
this fails any point you are going to
instantly know just by running a simple
command okay so this is just the start
of a unit testing course so we're going
to go on to look at unit testing some
more complex things we're going to look
at some different assertions but in the
next video we're going to take a break
and look at how we can kind of tidy up
these method names because for me
personally I find it quite difficult to
read camelcase like this so now that
we've done this let's go over take a
quick break and take a look at a
slightly different way that we can
define these out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>