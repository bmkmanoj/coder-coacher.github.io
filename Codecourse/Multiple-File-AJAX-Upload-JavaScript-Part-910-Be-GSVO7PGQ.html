<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Multiple File AJAX Upload: JavaScript (Part 9/10) | Coder Coacher - Coaching Coders</title><meta content="Multiple File AJAX Upload: JavaScript (Part 9/10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Multiple File AJAX Upload: JavaScript (Part 9/10)</b></h2><h5 class="post__date">2014-04-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Be-GSVO7PGQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in the last part we hit the yet form
data method that we created passing in
the files that we've chosen via this
multiple file upload element here what
we're now going to do is actually
construct this as a form data object and
we're gonna return that from this get
form data method that we've created we
can then pass that along to our PHP file
so let's go ahead and fill in this get
form data method I'm gonna create a data
element or a data variable and this is
going to be a new form data object which
is going to store all of our form data
I'm also going to create a variable I is
an iterator for the for loop that I'm
about to create so the for loop is going
to look like this it's gonna say for I
equals 0 while I is less than the source
length so remember the source is what we
output here in this case it's 3 so we've
got this property here 3 this is going
to loop three times then and we're also
gonna then increment this so we're going
to say I equals I plus 1 within this
we're going to append onto the form data
element so we're going to use the append
method here and we're gonna append this
with file and the source at this
position so in this case it will be 0 1
2 which we saw here so 0 1 2 so 3 files
will be appended to this form beta what
we then want to do is also a pen data or
app enter data Ajax and we want this to
just be true now the reason that we're
doing this is castrum line back to when
we were doing the upload dot PHP file we
have this check here if post Ajax is
available then we output this and this
ensures that the data is coming from
this far here because we're adding this
Ajax piece of data onto the post request
so then we return data because we want
to use this down here or up here rather
in our Ajax request so we're now going
to fill in the rest of our Ajax method
in this case what we have is we want to
create a ready state change method so
this will basically allow us to check
the ready state the status and then go
ahead and parse the response from the
PHP file so let's add this event
listener to this HTTP request so we use
the HTML HTTP XML HTTP object we created
earlier and we use the add event
listener so now we're going to go ahead
and pass which event we want to listen
for and this is ready state change and
we have our callback here as usual
so what we're checking for is the ready
state to be for and the status to be 200
so we want to make sure the request was
okay so we say this dot ready state we
want to make sure that's for and then
inside of here we want to make sure that
the status it's 200 now if this is the
case we want to just console.log okay
now we already know that an ajax request
is being sent once we've chosen files
but let's just check this anyway so if
we hit upload we should get an okay this
we know that's been sent properly so
within here what do we want to do well
we want to say uploaded is remember we
stored that up here so we're not using
var here we're declaring everything at
the top here and we're gonna say json
dot parse we're parsing the result of
what's been returned from this ajax
request and in this case it's this dot
response it's a response is what we get
back from the actual request itself
let's console.log this and check that
this works so we choose a couple of
files we have load and we can see now
we've got object succeeded failed this
is the JSON response that we output from
our PHP far earlier we can check this by
clicking on upload dot PHP clicking the
preview or the response you can see this
is what we output early
the json response so we can see that's
being passed through we can now access
these objects with JavaScript so now
what we want to do is actually do a
couple of checks here or actually rather
instead of doing a couple of checks we
want to do an else and then within these
we want to basically call the callbacks
so inside of the success part if the
status is 200 we want to check the type
of owed the options dot finish now
remember this is the function that we
passed through earlier so we want to
make sure this is a function remember
that's this and this and then we want to
say oh the options dot finished so we
call this function passing in the
uploaded object that we got from JSON
dot parse now otherwise we want to do
pretty much the same check here so we
can I say if type of adoptions dot error
is a function we want to call adoptions
dot ever and that's just gonna call that
and if we do get an error will have this
console log not working we obviously
wouldn't do that in a production
environment so now if we return to this
we already console logging the data so
this shouldn't actually be any change
I removed the console log that was down
here but now we shouldn't see any change
because we're checking if the finished
option is a function and if it is we're
calling it passing in the uploaded data
which will then become this and then we
can console log that they tore out so if
we just check this choose a couple of
files hit upload oh and it says not
working so we get not working and the
object out so let's check what's
happened here oh of course
sorry we put this in the wrong part so
let's go ahead and get rid of this and
place that here
and we put this inside of there okay so
let's run through this once more we
check the ready state that's just
wrapped in everything if the status is
200 we set the uploaded to the parse
JSON that's been returned by the Ajax
response and then we check if the
finished function is a function then we
call it parsing and uploaded otherwise
if we don't have a 200 we have an error
so let's test this out once more there
we go if it's wrong so for example if we
passed up load up loads up PHP obviously
not gonna find that file so we won't get
a 200 we'll get a 404 and therefore it
just says not working so what's left to
do now is actually go ahead and add an
event listener for the progress of this
so we'll go ahead and add an event
listener down here so we say XML HTTP
dots upload and we're at now what we're
doing is accessing the actual upload
itself not the actual XML HTTP request
so we add an event listener to this and
the event this now it's progress so we
obviously have a callback so what's
gonna happen here is we're actually
gonna get progress sent back to us we're
gonna have an event here as well and we
want to go ahead and store a percentage
so that's creative a person up there now
we need to do a check here to check if
the length is computable so this is
going to actually check if we can
compute the length of the upload
progress so we create the if statement
here and we say if event dot length
computable and if that's true then we
can actually calculate the percentage
but for now what I want to do is I want
to do a console log on event dot loaded
so let's choose some large files and
we'll check what we see in the console
output so I'll choose quite a few
and hit upload so you can now see that
all this data we're gonna well ignore
this because we've uploaded too much for
our PHP installation but what we are now
seeing is we're seeing that that that
basically what's been loaded and what
has what's been loaded as it's being
uploaded but what we now want to do is
actually calculate the percentage of
this so we use the math math round
method of the math object and we pass in
the event loaded as we've just done a
console log on we divide that by the
event total and then we multiply that by
100 now when we do a console log on the
percent we see the following
let's choose files within our upload
limit there we go so that's the actual
percentage now being log to the console
when it is hundred that's when the files
have been uploaded and you may notice
we've got all these file uploads in here
because we've just been testing this as
we go along and they're all coming in
now so instead of logging the percentage
to the console we're gonna set the
progress which is the other method we
have passing in the percent there so the
set progress method down here there we
are
takes a value which is going to just be
the percentage and that's going to
change the value of the progress bar and
the progress text so we need to create
an if statement for each of these let's
focus on the progress bar itself first
we want to say if o options dot progress
bar doesn't equal undefined so is it
available then we want to set the width
of the VAT the progress bar in this case
we do have the progress bar selected by
get element by ID on this element here
this span element and we've passed this
through to our uploader so this is
available so this should work all we
want to do now is say o options dot
progress bar then we want to access the
width as part of the style and we want
to set this to
checking if the value you know actually
exists so we want to check if the value
exists if it does exist we want to set
this to the value and we want to append
on a percentage otherwise we want to set
this to zero so let's check that this
works so all this is doing is taking
what we can't so log but setting it as
the width of that element and we look to
this earlier when we styled it so when
we choose a few files here we hit open
hit upload and there we go so that's
just taking the console.log values but
instead applying it to the width of that
progress bar and that's done now we're
gonna go ahead and introduce the text so
we create an if statement which is the
same we say o the options dot progress
text and if this isn't undefined which
means has it not been passed in here
which in this case it has we select the
progress text which remembers this the
text within here and we passed that
through so this will return true and
then we can say o dot options dot
progress text but this time we want to
say dot inner text and we want to set
that to if the value exists the value
plus the percentage we could have even
stored this somewhere if we wanted up
here just to make life shorter but
otherwise we just want to do an empty
string so now as well as the width being
represented by the value of the uploaded
files or the progress of the uploaded
files we get the text as well so that's
the actual upload progress while we've
been doing this we already know that all
these files have been uploaded let's
just go ahead and delete them so we know
that all these file uploads are being
successful but now what we're going to
focus on or in the next video what we're
going to focus on is actually going
ahead and setting the data in this area
when we finished this is completely
optional because we've completed the
entire process of uploading files but if
you want to go ahead and represent this
down here we'll look at that in the next
video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>