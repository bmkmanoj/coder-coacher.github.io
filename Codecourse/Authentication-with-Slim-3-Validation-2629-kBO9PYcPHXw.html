<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Authentication with Slim 3: Validation (26/29) | Coder Coacher - Coaching Coders</title><meta content="Authentication with Slim 3: Validation (26/29) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Authentication with Slim 3: Validation (26/29)</b></h2><h5 class="post__date">2016-04-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kBO9PYcPHXw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we can submit this form but we don't
have any validation so let's go and set
this up now we know how to do this
already it's really straightforward so
to actually validate then we create a
validation variable so we can check that
we grab this from here so we save this
validator validate and then we want to
pass in our request so we can actually
get our data and then we have an array
of our validation rules so we have
password old and we have our new
password which we've just called
password so for the old password we will
say something like no whitespace now of
course I've been using no whitespace but
you might want to use her whitespace in
their password so feel free to miss this
one out
now what we also need is our matches
password rule but that's a custom rule
deal with that in just a moment so for
the new password again I'm gonna say no
whitespace just to keep these in sync
and we don't want this to be empty so we
now know that we can check if the
validation fails so if validation failed
then we want to redirect back to the
previous form so we return our response
with a redirect grabbing that from our
router the path for auth password dot
change and this looks good now otherwise
we'll just kill the page and say change
password great so let's refresh perfect
so remember I said earlier this just
works like magic because we put the work
in earlier to set this up now this just
works really nicely so now that we've
got this all set up what we want to do
is look at our custom validation rule
before we go and look at actually
updating the users passwords because
we're going to do this
any different way so how would this work
well of course like I said before if you
want to add any custom validation rules
we need to add a rule and we also need
to add an exception so for the rule this
is going to work slightly differently
we're gonna actually take in an argument
and by this I mean matches password and
we're gonna insert the user into here so
we're gonna do something like this or
user now why are we doing that why don't
we in our custom rule just grab the
currently authenticated user well what
we don't want to do is tie this rule
down to a particular user this you know
it's just a general rule there might not
be a use case for anyone else updating
this but if we do say well we can leave
this out and just here check the
currently authenticated user that makes
it really hard to for example if you you
know this wouldn't happen in real life
but if you had an admin panel and you
wanted an admin to change the users
password you might say ask them for
their current password to validate it in
which case the user won't be able to
because this rule would fail so we're
passing this in here because we know
that later on we can pass in any user we
want and it will not be will not be tied
down to the currently authenticated user
that's basically it so that's what we're
gonna be doing so let's get rid of this
for now build the role and then we'll
implement it in so for the rules then
let's create a new rule and this is
going to be matches password dot PHP and
we can copy over our email available raw
so let's go and change this to matches
passwords and in here of course we need
to do something eventually just return
true or false so to be able to pass
anything into our rules all we do is we
create a constructor so as simple as
that
so in here all we do is we take in
either the user object or the past
now actually it would make more sense to
take in the password here so let's just
grab that set that into a property up
here and now what we can do is take that
password and we can check it so rather
than doing what I said earlier this
we're going to do this instead so we're
going to save passwords we're going to
use the password property on the
currently authenticated user that makes
a lot more sense and then this is kind
of a general rule we can use it
elsewhere as well so how do we actually
verify this well of course we use the
password verify function which we use to
check for sign-in we take the input
which is the plaintext password and we
take the hashed password that we're
passing into this rule so now that we
have this we of course need to set up an
exception in case this fails so with the
naming convention this would be matches
password exception and of course we can
just copy this over from here as well
makes a lot more sense and here it will
be matches password exception so here
what we can do is just say password does
not match or anything you want to say
okay great so we've got our rule set up
we know that this will return true or
false now we can see if this works so
again we use matches password same name
as the class we grab the currently
authenticated user and then from that we
grab the password property so this
should now work so over here let's click
Change Password must not be empty that's
fine remember my current password is
just the plaintext password so I'm going
to type in something to be different and
then type in some other password hit
change password does not match great so
now I can enter my real password I
changed my password over to something
like cats hit change password and we get
that died with that message great so now
that we have set up not only our
validation but our custom validation
role
we can move over to actually changing
the users password</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>