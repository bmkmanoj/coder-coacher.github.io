<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating a MySQLi wrapper with the Singleton Pattern (Part 1/2) | Coder Coacher - Coaching Coders</title><meta content="Creating a MySQLi wrapper with the Singleton Pattern (Part 1/2) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating a MySQLi wrapper with the Singleton Pattern (Part 1/2)</b></h2><h5 class="post__date">2013-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TCqxOwzz8HQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this tutorial we're going to be
looking at the singleton pattern in PHP
and we're gonna be looking at creating a
database class which actually performs a
query returns the count of how many
results have been returned and then
actually allows us to iterate through
the results in a totally object-oriented
fashion so this tutorial is going to
cover a hopi concept so object-oriented
PHP concepts and it's also going to
cover the singleton pattern which is all
about reuse basically reusing our
database handler so it's a little
complicated if you're not used to
working with patterns but hopefully
you'll understand the use of this or and
actually why we use it so you can see at
the moment on on the screen we've got
the output of you know the code that
we're actually using so let's just take
a look at the code that we're using to
do this so we're requiring in our
database class which is just here we'll
be creating that in the tutorial McCrea
in a variable called users we're
accessing the database class statically
and this is a static method here get
instance and what that's doing is in
chaining on queries so we're chaining on
this query method we're performing a
query so we're selecting everything we
want from users the users table we're
checking if a count exists so again
we're sort of training on this count
here we're not chaining it on but we're
accessing this count in fact yeah we are
training on and then if that's the case
then we are using for each construct and
we're just saying for all of the results
as user output username so all of these
properties again accessing in an
object-oriented fashion so that's the
usage of this and the whole point of a
singleton pattern is that we can do this
as many times as we want but you know
and use the same database object if you
like but the class that we create but
we're not going to perform multiple
connections to a database now you might
be thinking you know why on earth are we
doing this well the reason I like using
this is the beauty of saying DB get
instance and we can call to get instance
anything we like we could even replace
this with a functionality of query but
you know that's up to you once you've
sort of learned why this happens and why
we use this
and then what we can do is we can change
things on so it's very natural to sort
of chain things on we could of course
you know do this it would be exactly the
same thing but yeah the reason I like
this is because we can we can reuse it
in this fashion it's a lot easier to
write it's easier than you know using
MySQL or PDO or anything like that
without a wrapper so we're essentially
creating a database wrapper which makes
it super easy to connect to our database
and to query our database return results
result counts and anything you want
really so what we'll do is we'll dive in
now and actually start creating this
class so I'll go ahead and blank this
and we'll get started okay so we are
starting from a completely clean slate
here I'm gonna be building up this class
and as we go along and build this up
we'll actually look at how we use it
along the way we'll also then look at
the benefit of the singleton class where
you singleton pass and we're using to do
this so the first thing we need to do is
inside of our DVD PHP is actually define
this class which is as easy as just
class DB and then our opening and
closing bracket now inside index dot PHP
we'll want to go ahead and require this
in so require once classes /d v dot PHP
you can see if I open my directory
structure I've got a folder here called
classes and and DB just here so once
we've done that we want to go ahead and
start looking at what kind of properties
we want to store or the main property
that we want to store that's actually
going to make this a singleton pattern
and so we say we want a public static
variable property called instance and
the reason it's static is because we're
going to be accessing this with a static
method so we need a static property here
so the static method is going to be get
instance as we saw in the last example
I'm not going to pass anything into this
because this will this will be accessed
just basically to do the checks within
it and what this is going to do is it's
going to check for an instance of this
class now this might be a little
confusing but please bear with me so
what we're gonna do is we're gonna say
if not is set so if the
particular things inset we're gonna use
self to reference this class itself
remember not instantiating anything so
we can't use this and we want say self
instance so if that's not set we want to
say self instance equals a new DV so we
are instantiating this here and then
applying it to this or storing it in
this property here then what we want to
do is finally return self instance now
this might look totally confusing but
I'll try and explain this as best I can
now what's happening is when we create a
new object so we want to say let's just
say we'll call it sort of on its own
will say get instance so if that's the
case what's going to happen is we'll go
ahead here and well echo we'll just cut
it if that's how you spell instantiate
it so we get this we get we get this
come up here now what happens is then if
we were to do this again so inside of
our index dot PHP if we were to do this
again put it three times just to to make
sure now we should only get this up once
so it only happens once and this is
because in our code we have already
we've already set this to here we've
already instantiate the object stored it
in this instance property and therefore
all we do is return the instance and
because we're returning the instance we
can then chain other methods on so
public function query within which we're
going to use to actually query at will
pass in a SQL string this will actually
be able to then be chained on so let's
just take this in as an example with
echo query so now what we can do is in
fact we'll echo
it's here as well so what happens now is
when we when we you know call query here
so let's do this here then what's gonna
happen is when we refresh Oh missing
arguments and let's just let's just pop
that in when we do that what's gonna
happen is we're gonna get inst and then
query so we instantiate and then we
won't then we query it now if we were to
do that again and again again and again
as we did in the previous example you'll
see three now what's gonna happen is
we're gonna get well let's have take a
look we're gonna get inst and then query
three times the reason buying is that we
only need to instantiate once and then
we query three times we can query our
database as much as we want it doesn't
matter to us so what we gonna do now is
we will get rid of this we'll get rid of
this here cuz we've seen that itself
works and then what we're gonna do is
we're gonna do something inside of here
we're gonna use the magic method
construct which is actually going to
connect to our database because that's
really really important so public
function construct I'm gonna do here is
we're going to connect to our database
and then we'll actually have the ability
to chain the query method on once we've
connected now bear in mind what's going
to happen is that this is only ever
going to be run once because we're only
ever going to instantiate if we've
already done this so if we for example
put an thing in here so let's say
connect to DB and then echo query and in
here we do this three times it's gonna
have exactly the same result as but when
we echoed out here so if I just go ahead
and refresh connect to DB so we only
need to ever do that once but we might
need to query three times so that's
where this the usefulness of the
singleton pattern comes in so now that
we've done that what we're gonna do is
actually you know connect to our
database so we want to store some other
things here so I'm gonna store some
private properties the first one is
going to be MySQL I
the second one we might as well set
these all up now is going to be the
query so when we actually perform the
query we want the the result from this
and we're also going to build up a set
of results so that's going to be an
array and we also want the count as well
so that's going to be 0 by default and
the reason I've set this to an array and
empty array by default in this account
of 0 by default is that we're gonna be
returning these so if we don't have any
results we want to just return this
anyway and that's going to return us 0
results the same with this will just
return an empty array if not and this
will avoid sort of problems on the on
the front end people that aren't or
they're just making use of this class
and that will just allow them to see oh
yeah it's an empty array maybe I should
check the count before I start looping
through results so in construct let's go
ahead and apply a new MySQL I object to
MySQL I property so we'll say this and
remember we can use this now because
we're in the wind sort of when we hit
the constructor in an instantiated
object so we instantiate it here so we
can then use the dis to refer to the
objects itself so MySQL I equals new
MySQL I same as MySQL stuff but we're
obviously object-oriented so we're going
to connect to localhost root is the
username no password and I have a
database set up called singleton so
let's just quickly take a peek at that
we've got a yep database here codes in
singleton
for records here and a table called
users so that's all we really need to
set up and there's the structure just
quickly set up before the purpose of
this tutorial so now what we want to do
is we want to actually check if there's
a connection error you don't need to do
this but I always like to do it and it
sort of kills the script and gives her a
little message this will automatically
give a message but this sort of is a
nice way to give a tidy message so a
basic gonna say if this MySQL I connect
error so if a connection error has been
stored you want to kill the script and
we just want to output this MySQL
I connect error perfect so let's go
ahead and give this a go and just test
if this works so yeah we connect to our
database we've not queried anything at
the moment well we've hit the query
method but we have an actually done new
thing let's just change this to
singleton a-and just check if that still
gives us the error or if it does give us
the error it should do there we go so
there's the warning generated by
instantiating the MySQL I object or
class and then here's our message that
we kill the script with so that's
obviously not ideal but it gives the
user that's using the class the right
message so in the next part of this of
this video we're gonna actually look at
building up this query and actually make
use of this of this you know this
database class that we're actually using
and actually make this usable and cool
to use</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>