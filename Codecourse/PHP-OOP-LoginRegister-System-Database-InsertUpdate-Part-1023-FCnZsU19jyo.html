<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP OOP Login/Register System: Database Insert/Update (Part 10/23) | Coder Coacher - Coaching Coders</title><meta content="PHP OOP Login/Register System: Database Insert/Update (Part 10/23) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP OOP Login/Register System: Database Insert/Update (Part 10/23)</b></h2><h5 class="post__date">2013-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FCnZsU19jyo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now the last thing that we need to do
within our database wrapper is the have
the ability to basically insert and
update records that already exist so the
first thing that we're going to be
looking at is the insert method that's
basically going to take the name of the
table and the list of the fields that
are required to be inserted by field
name and value what we're then going to
do is we're going to generate a list of
question marks which will go into our
query and we'll be able to sanitize them
using our query method so really we
don't need to actually query anything
here in terms of building up building up
the query functionality because we've
already got that in our database we have
all the functionality we need all we
need to do is to find the method and how
the data is handled and passed through
to the methods and it will be more or
less the same for the update method as
well now the insert and the update
methods are very similar in the way that
they work but the code does change
slightly so we're going to create two
different methods just not to confuse
things so the first thing that we'll
make is the insert method so public
function insert and what kind of data
we're going to want to pass to this
let's take a look at how we might want
to actually build this up so we're going
to want an array of data also going to
want to define which table we want to
insert into so let's pull this down make
this a little bit easier so I'm going to
say I want the user name to be Bale and
I want the password to be password I
want the salt to be salt and so on and
so forth I'm just going to leave it at
that for now and we will will not bother
you know defining all of the fields that
we need to insert in our database so
we're going to build up this
functionality run it and then check that
all of the relevant data was inserted
with our method so let's go ahead and
start to build this up we know now that
we want to define the table and the
fields that we want to insert and of
course that's going to be an array of
data so what we want to do is check if
Fields if Fields has actually any data
so count fields the last thing we want
to do is return false so if if we do
have data in our fields array what do we
want to do the first thing we'll do is
create a few variables at the top of
this just to define what you know things
we need the keys of the fit of the array
because the keys of the array here are
the fields that we want to update
remember so we want to say keys equals
array keys function and then pass in
that array we also want to set values to
null that's just a basically a variable
that's going to keep track of of the the
question marks that we want to put
inside of our inside of our query and
then we want X to be one that's just
going to be a counter that we're going
to use in a moment so now what we're
going to do is build up the query that
we're going to use to insert so let's
take a look at that first of all so when
we insert we use insert into a specific
table so let's just say users and then
here we define the list of the field
names so in this case this is going to
be the keys that we've defined in here
so this will be the keys so this will
ordinarily like username password salt
like that so that's what it would look
like but we don't want to do that
because we are defining the fields that
we want to update here so let's take a
look at how this might work let's
concatenate on something into here now
this can confuse so it's it's one of the
things that you just need to get your
head around what we're going to do is we
always know that there's going to be a
back tick here a backtick here because
we define the fields that we want to
insert - usually with back ticks you
don't need to ever let's do do this
anyway and then we want to implode the
keys of the array now what this will do
is it will take the keys of the array
and create it into a string with a
separator now this separator is going to
be a back tic a comma and a back tic so
what actually happens
well when we implode it we start off
with the back tick and we end with the
back tick we always know that this wall
is how the what will look inside of the
brackets will look like
we then implode by these with each value
in between so I think the best way to
sort of visualize this is just output
the SQL that we've we've created so now
that's what our data is going to look
like this is our first back tick that we
created before the implode function ran
and this is the last back tick that we
created just after our implode function
everything in between was the was the
value separated by this so backtick
comma back tick back to comma backtick
and then we have the last result and
then our final back tick so that's how
we build up this code now that's not all
we need to do we need to define the
values and in this case this is just
going to be the values here at the
moment they're null so what do we want
to do with the back the values well we
just want a list of question marks
so there are quicker ways to do this but
let's just look at this in a sort of a
simpler way since we're delving into
sort of tricky territory here we want to
say for each fields as field so we're
looping through the fields that we've
defined in our function or our method we
want to say values dot equals question
mark so basically adding a question mark
to each to this values which would
eventually be a string so I guess we
could just define that as a string there
what we're then going to do is we're
going to check if X is that going to be
the counter is greater than or equal to
the fields so we're going to increment X
down here and then we're going to create
an if statement here to check if X is
less than the count of fields now this
perhaps looks a bit complicated but all
we're saying is are we at the end of the
the fields that we've defined now if
we're not if we are not we want to add a
comma onto these values so values dot
equals comma and a space let's just find
these in single quotes just to make
things a bit more consistent so let's go
and just died values here so you'll see
that we get question mark question mark
question mark separated by comma
obviously if we didn't have this check
in place here we would end up with just
three question marks and if we had a
comma here and didn't have this we would
just end up with a comma on the end of
that that's why we did that and like I
said there are easier ways to do but not
easy ways but shorter ways to do this
but we'll leave it as this for now just
so it makes a little bit more sense so
we've now got our full query let's just
take a look at how that looks it looks
like this perfect this is a perfectly
valid query as long as we're binding
these question marks as vert as actual
values that we want to insert and that's
not hard because we already have the
functionality for that so we're going to
say if this query SQL we've already
built the SQL and then then just going
to pass in the fields and they all have
values so they'll be bound to the
question marks that we've already
created and we want to say if not error
so if that doesn't error we return true
otherwise we're returning false down
here anyway so we can just leave it as
is so now when we actually run this this
is going to insert the data that we
require hopefully so it will insert a
username a password and a salt so let's
give it a go there we go we obviously
don't get any signifying back whether
this didn't work or not because all
we're doing is returning true or false
but we can prove that it works or not by
looking inside of our database and you
can see here that in fact it has
actually worked we've inserted a record
at Dale a username with Dale password
and salt here no other information it's
not relevant just yet
and that's basically it that's how we
are going to insert data and we could of
course say if user insert change this to
insert then we'll assume that's a
success because this returns true or
false
so let's go ahead now and look on to
similar functionality and this is
basically deleting from our database so
we're just basically going to almost use
the same almost use the same
functionality oh sorry no update I mean
we're going to use the same
functionality but we're going to update
data and we're going to define an
additional field just here and that's
going to be the ID of the user that we
want to update so we're going to say
let's take a look in our database we're
going to delete this record we've just
created which is of ID 3 so we'll go
ahead and define this as 3 so we want to
update the user's table where the user
ID is 3 or the ID of the record is 3 and
we're going to set the password to new
password just as an example again this
is plain text we will we will hash this
but for now we'll just keep it as simple
as possible so we need a new method and
that is going to be update luckily we're
going to borrow a lot of the
functionality from this so we don't need
to do too much work here we know that we
want to update your table we know we
want to update a specific ID and we know
that we want to update a particular set
of fields so what we're also going to do
now is set a variable called set to an
empty string and in fact we've created a
count here of fields we're not really
taking into account whether a tables
been defined so I'm just going to remove
this here it doesn't it doesn't really
matter that much unless you are very
strict on how developers using this need
to be told what what's required or not
there are a variety of checks we can put
in place to make sure that these these
arguments or parameters are passed
through to the function let's try and
keep things a little bit more simple so
I'm going to say set equals an empty
string and X equals 1 again we're going
to be incrementing this X variable for
each of the fields that we have so let's
go ahead and begin without our query how
do we update
a user or a table in our database while
we update a certain certain table and we
set something so we set perhaps password
equal to new password and we do that
where the ID equals a certain ID so in
this case only three now we could of
course include some where Clause array
in here and increment of implement that
into here for now we're just going to
assume that our update function only
ever needs to work with an ID you can of
course make this more flexible but just
for the purpose of the tutorial just to
keep things simple we'll keep this as an
ID so now obviously this query is no
good because we don't just want our
update method to update where an ID
equals three we want to be able to
define this so the first thing that we
want to do is be able to update a
particular table that's very
straightforward let's just add what you
don't need don't need quotes for that
set is going to be the result of
building up the set string that we're
going to build up here in a moment and
where is going to be where ID equals ID
so the only thing we need to do now is
build up this set string based on the
fields that we've been passed through to
this function so again we just need a
for each loop and we're going to say for
each fields as name value and inside of
here we're going to say set dot equals
so a basically concatenated on a string
and this string is going to be named so
the name of the field so password equals
and I'm going to have question mark so
we're going to bind these still we
always want to bind because we don't
want this data so you know look at it
from this way if he uses updates and
their profile on the enter their
username enter a new email address or a
new full name for example their actual
name we this data is going to be passed
straight to this update method so we
don't want to use a
start SQL injecting here so we're always
going to include question marks and
we're going to include more or less the
same functionality as well we increment
X each time and we're going to say if X
is less than or equal to the count of
the fields array that we've passed in we
want to do set dot equals a comma so
let's go ahead again and died on this
set variable just to see all this string
just to see what this looks like
password equals zero we know that you
know that's what we expect to be updated
if we were to add for example another
thing here and say email or not email it
so name equals Dale carrots then when we
refresh its again says name equals in
fact we I'm missing a space there it
doesn't really matter but just to keep
things neat and tidy so these are the
fields that are going to be updated and
obviously as part of the overall query
these are going to look like the
following
so let's echo the query out just to make
sure it looks like a valid query so
we're updating the user's table we're
setting password equal to a particular
value that we're going to bind name
equal to a particular value that we're
going to bind and I where the ID is
equal to 3 perfectly valid query this
will work so now what we need to do is
probably you've already guessed actually
perform the query so we just say exactly
the same thing if this query so if the
query of the SQL with the bound values
of the fields remember they'll replace
the question marks so if that doesn't
work if well sorry if that doesn't
return an error we want to return true
basically what we've done here we're
basically duplicating that line
otherwise at the worst case we want to
return false so let's go ahead and check
this out and see if this actually works
let me just go ahead and change this to
something like Dale Barret so what we're
expecting now is Dale or password to be
updated to new password and name to be
updated to Dale Berra in actual Kate in
actual fact let's change this about to
Garrett
there's no name as it stands so let's go
and run our code see what happens there
we go
I'll assume that this works but I'll
check my database just to make sure and
there we go we've updated the password
fields new password and we've updated
the name to the name that we've just
defined so that is all we need to do in
our database wrapper there is a lot of
functionality in here but like we've
already looked at this now gives us the
flexibility to do everything we need to
do inside of our application</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>