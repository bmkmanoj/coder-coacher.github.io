<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Shopping Cart with PHP: Cart summary (8/15) | Coder Coacher - Coaching Coders</title><meta content="Build A Shopping Cart with PHP: Cart summary (8/15) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Shopping Cart with PHP: Cart summary (8/15)</b></h2><h5 class="post__date">2016-05-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/X9HBLxq2ivQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now we have items added to our basket or
a car or whatever we want to call it
what we now need to do is actually
create the cart page where we're
actually gonna see a list of what we
have in our car this is pretty
straightforward but what we're also
going to focus on is syncing up based on
changes in the database so for example
if we change your quantity over in the
data or stock in the database and it's
lower than the amount the user has in
their car what we want to do is update
that so obviously if someone else checks
out and reduces the stock level we want
to reflect that on our cart page and
that isn't difficult at all we'll see
how easy that is in a moment so we'll
start by creating our view for this in
fact we already have our view for this
so let's just head over to cart index
and get rid of this dump
we know that items being added properly
and we can now start to actually output
our cart page so inside of here then we
want to extend our base template so
let's say extends templates app Twigg
and down here we will set up our content
area so this is a block remember we're
calling this content and we'll just end
our block down there so inside of here
we're gonna have a row as usual and
we're actually going to have two columns
here so we're gonna have an eighth
column and we're gonna have a four
column this is going to be the kind of
summary with the checkout button
so we'll just write this in hid for now
so we don't forget and in this column
we're going to have just the list of
items now we only want to show our
basket if we actually have items so the
first thing that we can do here is an if
statement to say well if the basket has
items so we can just use the item count
method for that then we want to show our
basket so this will just be a list of
items so lists so we head over to this
now and we've got a little
problem here so this should be end if
not in block there we go
so we now have a list we obviously have
items in our cart we have two and over
here will be the summary so we can start
to output these items now this is
relatively straightforward so we're
gonna create a well for this this is
just bootstrap styling so it looks like
that and then inside of this we are
going to have a table and this will have
a class of table again this is just
bootstrap styling so for the head of
this then we want to include the product
the price and the quantity so let's just
create head cells so product price and
quantity we know we have all this
information available and down here for
the body of this we want to loop through
all of the items so we can start by
doing a for item in basket dot all we
know that our all method gives us a
collection of products we can end the
for there and inside of here we're
obviously going to have a row and then
we're going to have here a product or
the product the price and then the
quantity so for the product we will make
this an anchor because obviously we can
link through to the product so we'll
just say here product title and then for
the anchor we know that we already have
the product index page setup so we can
just say product get and here remember
we pass through the slug so we just say
slug and we say item dot slug and of
course this here should be item dot
title so we now have the following looks
good considering we've not done too much
work here already
so have these products we can click
through onto the mad more FB one but
we'll get later on to actually updating
the quantity from here so for the second
one then it is the price so to do this
we only have one currency now we're not
going to dive into multiple currencies
but here we just say item price and then
here we can use number format with two
to give us the formatted date with or
the
formatted price with two decimal points
and that's pretty much it so for the
quantity then if we just come down to
this one this is going to be slightly
different we're gonna cover this in the
next part because it will take a little
bit more work in terms of the form so
for now let's just put a hyphen there we
can always up output the item quantity
just temporarily I guess let's just put
temp here so we remember Anna we do
remember is we set item quantity and if
you're wondering again where this comes
from remember that when we do actually
grab all of our items from here we
actually set this quantity specifically
when we loop through all the products we
have so that comes directly from there
and it's just attached the model so here
we can see one and two now the reason I
put temp is because this is eventually
gonna be a drop-down with a quantity
that's selected we can update the
drop-down click update and we're done
so that is pretty much it what we're
also going to do here is add an else so
we're gonna say else and we're just
gonna have a little message so you have
no items in your cart why don't we put
an anchor here just to say start
shopping and this will just link through
to the home page because that's where
all of our items are listed now that we
have our list of items in here we want
to include on this side a summary with
the total price and some other
information as well so here we can again
have a little if statement to say basket
dot item count and basket dot sub total
now the reason we're doing that is
because technically we can have items in
our cart but no quantities now that's
only gonna happen if the if someone else
checks out let's say we add an item and
then someone else while we're browsing
the site checks out the quantities
reduced we're actually going to keep the
item in there but we're going to just
show it as it's kind of out of stock now
so and that's why we're doing checking
the subtitle we want
there to be some kind of money involved
before we start to allow anyone to check
out so again we're gonna have a well
just in here and here we can just say
cart summary now down here we're just
gonna put an ink chart really doesn't
matter in terms of design and we're
gonna require in a summary there and
then down here we're going to have a
checkout button so let's just add this
checkout button now we've not got this
point yet so we can just put a hash in
there and we will add a class to this as
well so we'll say button button default
and it currently looks like this well it
doesn't because we don't actually have
our subtotal method added just yet
so why don't we do this now over in
basket it's not too much trouble so
let's create this now so we have a sub
total method and only we want to do here
is set a default total and then down
here we want to go through each of our
items so this will be our items from the
database so we just say this all as item
now when don't we want to have this as a
subtotal well when it's out of stock so
within this loop if the current item is
out of stock we just want to continue
through and we don't want to add up that
value and then outside of this inside of
the loop we're gonna say total equals
total plus item price so the actual
price of the item multiplied by the
quantity of the item that we have in our
cart so that's just basically adding up
everything within our car and then
finally we just return that total so now
that we've done this we know that we
have a positive monetary value to our
cart so now this shows up so now what we
want to do is just in here include the
actual summary of the items and then
we're pretty much done with our cart
view so over in our cart index here we
want to require in a summary
so as part of car let's just create a
new folder called partials and we can
use this elsewhere then it means that we
can include it anywhere we need so let's
create a summary dot twig far and inside
of here we'll just be the summary this
again is going to be a table we can give
this a class out of table and in here
we're gonna have a row this is going to
have a sub total here and it's also then
going to have the subtotal of the basket
remember you have basket everywhere now
so we can just use the subtotal method
and of course we want to do a number
format on that for two decimal places
now down here for the second row we want
the shipping rate so in here we also
have a cell and we're going to be hard
coding the shipping rate throughout this
but of course you can ease the update
that later on just by you know allowing
a user to select it and here we're gonna
have a total so we'll give this a class
of success I guess that will just make
it look a little bit nicer and we have
an overall total of the cart so for this
one then let's add that as a success as
well and we're just going to output the
basket subtotal we're gonna add 5 to it
so that's the shipping rate so again if
you dynamic things leave the shipping
rate you can add that in there and then
we're going to number format this as
well with two decimal places so let's
conclude this in and see how it looks so
in here we just need to do an include on
cart partials summary twig and we now
have the following so we have a sub
total which is the items that we
actually have in here said two of these
and then one of these then we have the
shipping and then the total value so
that is our car index the more items we
add to this the better it's going to be
we're gonna have kind of fill this up so
let's add some of these let's add this
there we go and let's go ahead and add
another one there we go
so we just
incrementing this as we go and what's
actually happening here is we're getting
an exception because we've added the
maximum stock for this item now we're
going to be preventing this but this
should not happen because we did catch
that exception so what we can do is go
back and check that this is all working
so if we head over to our cart
controller and go down here we should be
catching this exception here it's a
quantity exceeded exception the reason
that's not being chords we haven't
imported it just up here so we can grab
this from basket we can go over to our
cart controller and paste this in and
now when we go and try and add one so
let's go and try and add another one you
can see that we've caught that exception
but remember what we're not doing is
actually doing anything with it so
here's the opportunity to add some kind
of flash message but really your users
should never get to the point where
they're actually adding more than they
should because we're going to be kind of
protecting that within the forum we're
not gonna allow to add more quantity
okay so now that we have our cart
summary and our actual list of items we
need to make sure that when for example
I change this so if we just pull this
down for a little bit we have a Bolivia
here we can go and reduce the stock to
zero what happens is nothing the only
thing that happens is we update our
subtotal because we're not including
items that aren't in stock so just to
end this part we want to make sure that
when this does change we want to sync
this up to remove items that no longer
exist in quantity so I guess what we can
do is to test this out set a fairly
large quantity let's say stock of five
and let's just add a few more of these
obviously we have to manually do this
now because we don't have the ability to
update yeah we now have five of these
items in here so when I reduce this to
say four what we want to do is reduce
this to four when we want to or when we
reduce this to zero we don't wanna get
rid of it we want to keep it in here but
we want to set the quantity to zero and
then maybe get rid of all of this stuff
here so the user knows that it's still
out of stock so to do this then
we need to return back to our basket and
down here we're gonna implement a method
that will kind of sync this up so we
want to well you can call this whatever
you want but I'm going to call it
refresh and inside of here we want to go
through each of our items so we're going
to say this all as item now the first
thing we want to do is check if the item
doesn't have any stock so we're gonna
say item doesn't have stock I'm gonna
pass in that item quantity so if it
doesn't have the stock based on the
quantity we already have what do we need
to do well we need to call our update
method which if I can find it is here to
actually update the quantity so in here
we just say this update the item and we
update it to the maximum stock available
for that item and now what we can do is
if the item has a stock of one and the
quantity is zero now what this means is
that if for example we put an item back
in stock what we do is we check if it
has at least one stock so we just say 1
and then if the quantities currently set
to 0 so if it's been previously removed
we want to update it and add stock in so
we always want to add stock back in if
that's the case so we're gonna set item
1 so we just update it with a single
item so now what we can do then is
making sure that this is set to 5 still
we just see 5 now if we change this to 4
you can see oh of course we haven't
called the method so let's go and just
return that stock to 5 and remember it's
called refresh so basically anywhere
that user kind of lands to start the
checkout process eg in the cart so over
on the index what we want to do is say
this basket
refresh like so so we don't need to call
it everywhere we just need to call it
kind of on our car and our order form so
at the moment nothing's happening but if
we change our stock to four and just
bring up our page here
and we go and refresh the page you can
see that that's reduced to four and
again if we reduce it to two goes down
to two and if we were to reduce it to
one again we get back one if there were
to be no stock what we do is we reduce
this and it goes from here which I guess
is fine actually okay let's leave it at
this we can update this later if you
want but either way we now have that now
if I return this back to stock five
let's say that that was previously
removed my refresh then it doesn't come
back let's just check if this is still
in our session and to do this we can
just go and again like we did before we
just did basket all we did a JSON encode
here so let's just change this over and
there we go so it looks like we don't
actually have that in there okay let's
leave it at that because I think that's
not too much of a deal at least we're
getting rid of it that's the main point
and what we can actually do is just as
simplify this is get rid of this here as
well and all this will do is and we can
try out with another item so let's say
we have blake espresso over here let's
say we just reduce this down to one in
stock that will reduce that down to one
and then if we reduce this to zero it
will get rid of it and then I guess if
we increase the stock that's fine we
don't need to really need to add it back
in but either way the most important
thing is that we don't allow a user to
check out if the stock is you know above
what we actually have all their
quantities above what we have so we'll
leave it that we'll come back to it
later if we think it would be a good
idea to update this it makes sense but
of course you can go ahead and do that
if you want as well so there we go we
have created our cart summary and we've
updated this to sync with the items that
we actually have in stock just to make
sure we are not
allowing users to check out with items
that are currently not in stock so
thanks to Braintree payments for
supporting Co course mobile development
can be really complex but integrating
your payments doesn't have to be with
Braintree your business will have simple
secure payments that you can integrate
in minutes with just ten lines of in-app
code Braintree simple flexible SDKs
elegant code and clear documentation
make your job and payments easier learn
more Braintree payments comm slash code
course</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>