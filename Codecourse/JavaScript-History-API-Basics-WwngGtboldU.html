<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JavaScript History API Basics | Coder Coacher - Coaching Coders</title><meta content="JavaScript History API Basics - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>JavaScript History API Basics</b></h2><h5 class="post__date">2014-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WwngGtboldU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to be
looking at the JavaScript history API
and this is really interesting because
it'll allow you to modify the browser
history in a way that you previously
wouldn't have been able to do now by
this I mean that you can control parts
of your page based on pushing a state to
the browser history so at the moment you
can see I've got my developer tools open
here I can just right click on inspect
element or you can access this from the
tab here and when I click on one of
these links what's actually happening
here is you can obviously see that the
URL is changing but this content here is
actually being loaded in via an ajax
request
now these pages cats dot PHP and dogs
dot PHP do actually exist when I land on
dog stop PHP for example it still loads
the same content and this is really
important because the history API should
not be a drop-in replacement for pages
that actually exist to do something like
that you'd use hash bangs at the end of
URLs which are commonly not advisable to
use in this video we can allow content
to be loaded in without an entire page
refresh unless the user clicks on the
page like that in which case the content
will be loaded in normally so what we're
going to be doing then is looking at
building up this very basic page
creating a very basic application
structure it's not been going to be
anything that you might use in a project
but it'll at least give you a good idea
of how you can implement the JavaScript
history API to loading content in this
way so let's jump right over to the code
and start building this so we're
actually starting out with a very basic
structure here and I'm going to explain
how this is set up then what we're going
to do is add in the JavaScript that we
need to make this work so first of all
if we just close off these folders here
you can see that in my main directory
I've got a cat stop PHP far and I've got
a dog stop PHP far this is just mocking
what you'd normally see within an
application where we separate the header
the footer and the content that we want
to load in so you can see that these
pages are identical except for the
content that we loaded in depending on
the structure of your application this
is obviously going to be different if
you're using a framework and actually
showing views and doing things in a
really clean way it doesn't make a
difference the concept here is exactly
the same so inside up valve just views
folder I've created we've got a header
here and this is just a basic document
layout with a header body now within the
body we have this navigation element
here so we have an html5 nav element
with an ID of main that's going to allow
us to target that with jQuery we're
going to be using jQuery which is a
JavaScript library just because this
makes teaching history API a little bit
simpler and then we've obviously got an
unordered list to list items and within
that we've got two anchor tags which are
linking through to them to pages within
our root directory here now on cats and
dogs PHP we're loading in from the
content folder which is over here and
that's just some basic content so this
is essentially just the part that you'd
be loading in here so at the moment this
page looks exactly the same as when I
showed you it a moment ago the only
thing is is we're loading the entire
page with each click of this and that's
fine
but what if we want to load in just this
part when we navigate to these items and
this is a good idea because it saves you
having to reload an entire page sending
another request to the server and it
also looks a little bit smoother and
quicker to your users as well that's I
guess the main benefit here so what
we're going to be doing then is in the
footer we're going to be building out
the code you would obviously link this
off to a separate JavaScript file but
for the sake of the video we'll keep it
all in one file so what I'm going to do
then is I'm going to
hélène jQuery so I've got some script
tags here with a source attribute if we
head over to Google hosted libraries
just Google for that and we want to pull
in jQuery this just provides us an easy
way to put in jQuery from Google's
content delivery network just so we
don't have to go through the process of
downloading ourselves so I'm going to
pop that in there and on the next line
then just an empty script tag again
you'd want to put this in a separate
javascript file in our case we'll write
all of the code that we need to just in
here so the first thing that we want to
do then is go ahead and make sure the
Dom's loaded so we're going to use
document within a jQuery selector and
we're going to use the ready method
inside of that is a closure and we can
start writing all of our code in here so
I'm going to create two variables one
called nav and one called content these
are going to hold the navigation
selector so we can actually detect when
a item is clicked and also a Content
selector so we can inject the content
from the Ajax request into that Content
area so the nav then is going to be nav
hash main so this is nav with an ID of
main and the content if you notice
before over in these files it's a
section element with an ID of content so
we can reference that either just the
hash on its own or you can explicitly
define section you obviously shouldn't
have IDs with the same matching on the
same page so you shouldn't have to of
main on two of content or two of more so
we've now got the nav and the content
selected so we've got the section with
an ID of content and the nav with an
idea of main so what we can do now then
is actually create an event handler when
a user clicks on one of these elements
inside of this unordered list so one of
these anchors here so to do that then
we're going to say nav dot find a so
we're finding an any anchor element
within that and we're using the on
method
to register an event handler in this
case when we click so now we're going to
run a callback here and inside of here
what do we want to do well we want to
get the H ref of that element so in here
it's got cat stop PHP and up stop PHP we
know that because we're linking through
to them pages that's pretty
self-explanatory so let's create a
variable up here and this is going to be
this which references the current
element we're clicking and then we're
going to say attribute this isn't a
method that grabs the value of an
attribute and the attribute of these is
href pretty straightforward so now what
we want to do is actually manipulate the
history so we're going to say man if
you're late history now we're going to
actually start to get to the history API
and this is so straightforward so what
we want to do is we want to use history
we want to use the push state method a
bear in mind I'm not checking for
history API support so in a browser
that's older and maybe doesn't support
history API you will get an error here
because obviously this method doesn't
exist or this global functionality
doesn't exist however you could go ahead
and use something like moderniser
if you just google for that to actually
detect whether this is available or not
so the arguments for this first of all
is an object which we're not going to
need and this just allows you to provide
additional details about this but we
don't need that all we're interested in
is pushing the actual file name onto the
end of the URL we can also provide a
title as well if you want to modify the
title of the page we don't necessarily
need that you you can do that if you
want and this just takes a string value
so that's an option but what we're
interested in is pushing this on to the
end of the URL which is the eight ref we
obtained from that anchor so what we can
actually do here then is have a look
when I click cats and dogs you can see
at the moment it is still reloading the
page so what do we need to do well
well obviously within this event handler
we want to prevent the default behavior
when a user clicks that link we don't
actually want that to go through to the
page we're loading it in via an ajax
request so up here as an argument for
the callback we can provide e which is
the event and then we can say
event.preventdefault and that prevents
the default behavior of that link and
that all that means is when I click on
these now you can see that nothing is
happening we're not reloading the page
however if you've noticed the URL is
actually changing so if I just remove
this a draft for now and just enter Larr
for example you'll actually see that
this will take effect so when I click
these you can see that's changed to blah
but obviously we don't need that we want
the href in there so now that we are
manipulating the browser history let's
just go back to a sensible page we
actually need to change this content
here that's really important because
that's the whole point of using the
history API so if we just go down here
we want to fetch and insert content what
we're going to do is extract this to a
function so we can actually reuse this
if we want to it just makes it a little
bit cleaner so fetch and insert that's
going to be the name of the function and
we want to define as a argument the
actual href that we want to obtain so
the file name basically now when you're
passing through the file name obviously
the far names here match the file names
within this content directory that might
not be the case so you might have to
come up with another creative solution
to handle this and you could do
something like an data attribute for
example so data attribute is basically
an attribute you can put onto an element
name it here how you want and then
provide some kind value in here so if
you had say an entirely different way of
fetching the files that you want to pull
in perhaps you want to actually go off
to some kind of URL and pull in content
that way that is an option and if you
did want to do that instead of using out
view you could use data and then
something like content so you can go
ahead and modify this obviously how you
need this isn't a sort of full scale
application so we need to build this
fetch and insert function now we can do
that just up here so if we say fetch and
insert we want that to be a function and
don't forget we need to end there with a
semicolon
and we want to define fetch and set up
here as a variable okay so what do we
need to do in here obviously we need to
pull in the atria from the arguments and
we want to make an AJAX request to a
file so we're going to use jQuery AJAX
functionality and we're going to pass
through an object we want to defined the
URL here so the URL is essentially going
to be if we just copy and paste this
into there and then we want to go into
content and then we want this to be X so
X we're going to replace with the href
that we've pulled in so we'll need to
update this a little bit later when we
look at the users using their back and
forward button so for now we'll put H
reference but like I said I'm going to
have to do something a little bit
different with this a bit later on it's
not too tricky so we're going to define
a method you don't need to do this the
ajax method on jQuery will automatically
default to get but it's always nice to
explicitly define it and we want to
change the cache to false just so we add
a timestamp onto the end of the request
so we don't get cached content and then
we have a success callback so this is
when that file here has been hit
successfully and that provides us with
the data of the content of the file you
might also wish to implement an error
callback as well and you can just do
whatever you want in there so what we
now want to do is we want to modify the
content in actual fact let's pull these
up here that makes sense and then we can
do something like content dot HTML data
and we're going to be considering secure
in just a moment I'm going to talk about
how users may be able to access other
files by modifying these within the
developer tools but we'll talk about
that a little bit at the end of the
video and then you can go ahead and
implement the security as you see fit so
now that we have our fetch and insert
method we'll just comment this out so
fetches and inserts content into the
container that's pretty obvious and
that's pretty much it for now let's just
check out what this does so if we just
refresh the page here I'm going to pull
up my network tab this is always useful
to keep an eye on you can use the filter
here to filter xhr requests so that
means that when I click here you can see
that content changing its changing
within our browser and we also see the
requests here with the timestamp and
other bits and pieces of information but
we now know that this is pulling content
environ Ajax requests the URL is
updating itself and it's working as
expected
what happens when a user presses back in
their browser well you can see that
although I'm pressing back and forward
and the URL is changing the content
isn't changing and this is pretty
frustrating because users do use the
back and forward button in their browser
so what we want to do then is we want to
handle this so down here we're going to
say user goes back forward and we need
to handle this in a slightly different
way so when the user presses back or
forward we have something called a pop
state event fired and we can target the
window in the jQuery selector and we can
use on much like we did with the links
and we can say on top state so we can
run a callback and then we can do
something within here so there's no way
within here to be able to reliably get
the name of this here unless we use the
path name of the location which is the
following so this is going to be a
little bit tricky if like I mentioned
earlier you wanted to use a data
attribute but once you know how to
implement this
you can go ahead and integrate it into
your application as you need and try and
work out what works best for you this
isn't a one-size-fits-all solution but
it will teach you the basics so we're
going to do fetch and insert but this
time we're going to do a fetch and
insert on location path name so location
path name is going to give us the full
path so let's just comment this out for
a moment and we'll do a console.log on
location dot path name and let's see
what happens when we refresh click a
couple of links here and then go back so
I've got my console open here I've done
that using this toggle here or you can
hit the console tab to see that
exclusively and you can see that what's
happening is is it's giving me the path
name here relative to the actual domain
and at the moment I'm working on
localhost so we need to actually grab
the last part of this so that's pretty
straightforward
let's uncomment out fetch an insert and
we'll get rid of this console log so for
the H ref then we actually want to split
this by a forward slash so all we do is
use the split method on this object and
we choose the character we want to split
it by in this case it's a forward slash
and then we use part to basically grab
the last element or hop the last element
off and return that so now what's going
to happen is if we were to for example
just take this snippet here and just
console.log it down here so do a console
log that and then just go ahead and
comment all that out we'll see when we
hit a few links we can see that
happening there but when we go back and
forward we get the same result so we now
know that we're ending up with a content
that we want to Ajax to so let's get rid
of this console log uncomment out the
Ajax and we know that this should work
now so now as well as hitting a dogs or
cats or PHP we can click
you pull in them ajax.request as we've
seen but when I hit the back and forward
button it keeps up to date with the
content so it knows when I'm navigating
through back and forward to actually
fire that event go and send an ajax
request to the relevant file and pull
back the content for us so that is
pretty much it there is a lot more to
the history API but this should be a
good introduction for you to go ahead
and implement this into your own
application and see what you can do with
it and see the difference it will make
to use your experience now the last
thing I mentioned I was going to talk
about was actually security so say for
example you had a file within content
dot PHP let's just save this as secret
dot PHP this can be anything so it could
be maybe a JSON file text file a log
file it could be absolutely anything in
actual fact let's set this to JSON so
let's say we had some kind of secret key
that we were storing in here that we
weren't protecting against now that's
obviously a silly idea anyway you
wouldn't store files within your public
directory without applying some kind of
rule to this to not allow it to be
accessed via a browser but in this case
what a user could do is if you have left
files unsecured like this is we could
inspect this anchor here so for example
cats we could take this and we can
change this to secret dot JSON and
obviously you'll imagine that because
we're taking this href explicitly and
then asking for an ajax request on this
file when we hit cats you can see ok so
perhaps using JSON as a bad example
let's just rename this to txt just so we
can play around with this and let's
change this to txt
oops let's go back here to cats
so we are going to modify the ATF here
so secret dot txt when we click on that
we get that content through so
regardless of whether it's JSON file a
text file anything please make sure
you're securing files in a way that
makes sense before you allow users to
specify which far they're going to Ajax
through to obviously an ajax request is
a front-end request to a file so you
should be securing files anyway but it's
just a little heads up to make sure
that's implemented within your
application so that's it there we go
we have taken a basic look at the
history API hopefully it's a little bit
more understandable now with this basic
functionality and you can go ahead and
start using it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>