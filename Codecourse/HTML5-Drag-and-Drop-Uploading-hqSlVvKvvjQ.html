<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>HTML5 Drag and Drop Uploading | Coder Coacher - Coaching Coders</title><meta content="HTML5 Drag and Drop Uploading - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>HTML5 Drag and Drop Uploading</b></h2><h5 class="post__date">2014-04-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hqSlVvKvvjQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we're going to look at
drag-and-drop uploading within the
browser so let's quickly demonstrate
this I've got two images here this
upload will work with multiple files as
well you can see that I've just styled a
container here with a dashed edge and
just some text to tell the user what to
do basically so if I drag these two
files here you can see the first of all
this style is changing this actually is
a CSS class but it's a class that is
basically added to this element when you
drag over so we're looking at them kind
of things as where there's actually the
functionality to upload so if I drop
them on there
they have mediately been uploaded and
you can see that in my uploads folder
now I've got these two files that have
been uploaded and in fact they have been
outputted here to the page so we can
just click on them if we want so that's
the demonstration we're going to be
doing this from scratch so going to be
building this drop area that won't take
a moment and then we'll be looking at
actually detecting the drop of these
files and then we're going to pass them
through each pfr script basically to be
uploaded this PHP file is going to be
really really small so if you're not a
PHP developer don't worry we're just
going to be demonstrating how we upload
these but you could probably skip past
that or just end the video at that point
so let's go ahead and start building
this okay so over in my text editor you
can see that I've got basic document
markup here I'm also linking in this
global dot CSS stylesheet and I've just
set the font body to Arial and a
sans-serif fallback but obviously
depending on where you're building this
this is going to be different for you so
let's build the markup that we're going
to need here the first thing we want to
create is the actual drop zone and this
is just going to be a div element here
we're going to give it a class which
we're going to use to style it so we'll
just call this drop zone and we'll also
give this an ID just so we can easily
target this with JavaScript we'll also
call this drop zone and let's add some
text in here drop files here to upload
okay so once files have been uploaded we
want a container to be able to output
these in so I'm just going to create a
div with just an ID we're going to
target this with JavaScript as well and
that's
loads that's a moment ago when you saw
me drop min the filenames that actually
appeared so let's style this in the
browser just to get the effect that
we're looking for very very quick and
then we'll go into the JavaScript side
of things so at the moment we can see
that we just have this in the browser so
it said isn't it very good so over in
global dot CSS let's actually
star this for the drop zone so we target
obviously the drop zone class we're
going to set a width of 300 pixels and a
height of 300 pixels as well we're also
going to set a border to 2 pixels dashed
as we've already seen and we'll do this
as a gray color I will set the color to
the same as the border and we will also
set the line height to 300 pixels this
will just mean that the text will sit in
the center and we'll also set the text
align to Center as well so this is sort
of vertically aligning if you like and
this is horizontally aligning it you may
choose to do this differently so that's
the basic drop zone and nothing really
special there what we also want those we
want to chain a class on here because
with JavaScript can be adding a class
which will change the border color and
the color that's when you saw me drag
over it so let's say drop zone and drag
over and let's set the border color to
black sorry black and let's set the
color of this to black as well so the
loops to black so the text goes black as
well okay so now let's go over to
index.html and let's start writing out
the code that we need here so the idea
behind drag and drop is we basically
need to target this drop zone and then
what we're going to do is we're going to
use a series of event handlers we're
going to use on drop on drag over and on
drag leave on drag over and on drag
leave are basically their job is just to
change the class when we drag over it
and on drop is actually going to send
the files that we've dropped over
and then it will send them via an ajax
request to our PHP far so let's look at
the basics of this first just so we can
ease our way into it so I'm going to
create a closure here so this is just
basically going to run when the page
does so let's just test this out and
we'll bring up our console anyway
because that's going to be really useful
when we're sort of outputting things to
well that we drop onto here so
everything's fine here let's start to
create our drop zone selector this is
going to be document get element by ID
because we obviously need to get this by
the ID that we've given the drop zone in
this case it's just drop zone so we now
have this selected so we can start
Advent handlers to this and whatever we
want to do so let's do that now for the
actual dragging over of this and we'll
change the class so we're just going to
say drop zone dot on drag over and this
is going to be a function fairly
straightforward now we're going to
return false here because later on we'll
see that if we don't return false what's
going to happen is this is actually not
it's actually going to not break but it
won't work as well as we hoped so after
you finish writing the code remove this
and see see the effect so all I'm going
to do here is I'm going to say this
which obviously refers to the drop zone
and I'm going to change the class name
to drop zone we've already got that
class on there but we're also then going
to add the drag over class that we
created in here so what that's now going
to do is when we drop some files over so
let's go to here you can see or when we
drag some files over this this class
basically changes so now that we've got
that we need to handle the opposite so
we just say drop zone dot on drag leave
and we do the same we return false here
and we want to say this class name so we
set the class name property just back to
drop zone so let's test this out there
we go so we've got
nice effect now just signifies the user
that something has been successfully
dragged on and it's of waiting for it to
be uploaded now we've also got on drop
so we're going to do the we're going to
create the on drop event handler and
then we'll see what we can extract from
this event so drop zone dot on drop and
this is going to be a function so in
fact let's just in these with semicolons
so the first thing we want to do is an
argument e this is the event and we want
to prevent the default behavior that the
browser would normally take so what we
can see here now is when we actually
drop something onto it nothing happens
now if we didn't have this functionality
here let's just get rid of that you can
see that just opens the file in the
browser that's not what we're after we
don't want that to happen so we need to
prevent the default behavior on this
event and that's really really important
now what we also want to do is we want
to set the class name back to just drop
zone because when we hovered over the
drop the class name will be dragged zone
at drop zone dragged over so now what's
going to happen is when we are files up
when we drop oops
let's just refresh that when we drop
this over then the class goes back to
normal so then we can just start doing
all the fun stuff like uploading so now
we want to call the upload function
which we haven't built yet we'll be
doing this in a moment but we need to
know how to pass the fast through to
this so let's first of all do some
console logging on the event now the
event has a data transfer object so
we'll see this in just a moment so
inside of here we've got this data
transfer or property here with this
clipboard objects inside of it so we
know that the data transfer basically
contains what we need to extract with
the files so let's do this so it will do
a beta transfer
so that's out putting that clipboard
object let's do the same again let's
refresh and drag a file over so now
we've got this clipboard object here and
we can start to see that we've got files
which is a file list object which is
perfect this is what we need to extract
from so let's do a console log on files
so it's got files now and we'll actually
now be able to see the files that we
tracks let's drag two over and you can
see that we've got a length of two which
we can use to check file a file count if
we wanted to we've got zero indexed
array here so we've got the first one
which is a file it gives us all the
information about the file css3 dot PNG
and this one is html5 dot PNG we've got
the type a size etc etc so we've got the
information here that we need and this
isn't quite enough to pass this along to
our upload dot PHP file and let's change
this console.log to the upload function
let's create this function up here so
this function is going to take some
files so if we do a console.log on files
just to check that this works that so it
basically does the same thing it just
passed it through to upload so we're
separating this now we need to here
create a form data object what this is
going to do is it's going to allow us to
append a list of files or an array of
files if you like through to this or to
this and then we pass this fire and Ajax
request to upload dot PHP now it sounds
more complicated than it is if you've
not dealt with Ajax before but if you
have this will be very very
straightforward to you so we're going to
create a new variable called form data
and this is going to be a new form data
object so we also want to if we just
come and separate these we also want to
store an xhr xmlhttprequest will just
store this in a variable called xhr so
we're going to say new XML HTTP request
this is what allows us to open a request
to upload dot PHP which we have here and
then actually send some data through to
it
and I also want store a variable X
because we're going to be looping here
so let's do a for loop and let's say for
X equals zero so we'll initiate this
then we'll do our comparison so while X
is less than files length remember
earlier in the browser we saw that we
had this length property so we can
actually loop on this now we won't say X
is X plus 1 so now this is this for loop
is going to loop for every file that
we've dragged on to that drop zone so we
can append to form data remember the
form data object we created up here so
we can use the append method here to
append on files now because we're
dealing with multiple files we need to
include these double square brackets
here and then we want to save files X so
remember files is what we passed through
for each loop we're appending each of
them files onto here
so there we there we go that's basically
it so let's do let's open this request
so we said xhr open we want open this as
a post request and we want to open to
upload dot PHP and we want to then send
this request and now we choose what data
we want to send along with the rest of
this request in this case it's form data
so let's check this out in our network
tab we will just open this here and we
will drag this over so you can see now
upload dot PHP has been hit we obviously
don't get a response because we've got
nothing in this page at all yet this
isn't actually handling our file uploads
but we know the Ajax request was
successful so we need to know when this
Ajax requests been successful so we use
the onload then handler so now what we
want to do is we want to parse the data
that comes through from this request
because what we're going to be doing is
and this is entirely dependent on how
your application is going to work upload
dot PHP in our case is going to output a
JSON string with the successfully
uploaded files and this can be done in
any language because any language will
support JSON part
and string of fiying so let's do this by
storing a variable called data and this
is going to be this dot response text so
this basically is whatever comes back
from our Ajax request
so let's console.log data and then we'll
look at doing an example output in here
so let's create some PHP tags and let's
just echo out hello so what we should
now see is from this request response
text should now contain the string hello
and we'll console.log that based on this
this request so let's do this now we
should see in the console if we just
bring this up here hello so we've now
got that we know that that works perfect
so now what we can do is start to
actually get serious about actually
uploading these files so let's handle
that before we do anything else out and
in fact we'll continue to console all
the data just so we can keep an eye on
this so passing a form data or passing
this form data through to our PHP file
basically means we can pick this up and
like I said we can output this is JSON
so let's change the header or the
content type with the header function
because we want to output this as
content type application JSON so now
let's store our uploaded files in an
array and the first thing we want to do
is check if files file we called it name
zero isn't empty so if that's the case
we can echo out ignoble just echo okay
so what's going to happen now is if we
go to upload dot PHP this won't say okay
so it's not allowing us to actually
process anything unless we actually send
form data now when I do that you can see
we get okay output in the console so
this checks working very very basic
let's just quickly loop through these so
this is essentially looping
through all of the files that we've
dragged onto this and those that have
been sent through via the Ajax request
now bear in mind here I'm not enforcing
any security at all this is really
important do not copy this music
production it's just an example we don't
want to spend too long doing this so as
a warning to anyone it is working with
PHP do not use this publicly please make
sure you review and check the security
so or add the security rather so we're
going to be looping through file I
should have really called this files
because technically we will have more
than one file at some point so I'm going
to loop through I'm going to take a
position this is the index of it and the
name of the file as well so now what
we're going to get here is for each one
we're going to get the file that's been
an output so let's or upload it so let's
echo the name here and put BR on the end
and we will see this so we've got css3
be our HTML injury and obeah so we know
that this is now looping through the
files that we've uploaded successfully
so within an if statement I'm going to
use the Move uploaded file function in
PHP which obviously takes the temporary
file name of a file and goes ahead and
hugs it in a destination so we use files
file then we need to access the TMP name
array and that's at the position that
we're currently at in this loop so it's
a little bit complicated just because
the way that PHP gives us this array but
err not to worry we want to put these
uploaded files in uploads /name so again
you wouldn't normally do this because
you know you're just uploading files
willy-nilly into the uploads directory
and they'll be overwritten if they
contain the same name so again with no
security we are now going to say upload
it and we're going to append to this
array so if the file upload was
successful we're going to create an
array with a name key and this is going
to be the name of the file and we're
also then going to pass a file key and
this is just going to be uploads forward
slash
name and that's just so that in
JavaScript we can link this to the file
that we upload so you may use this for
your purpose or or not so get rid of
these line breaks let's now echo JSON
encode which is basically going to
stringify this array this uploaded array
and will then get a JSON string of the
successfully uploaded files which we can
then easily parse in JavaScript and use
the output so let's refresh here and
let's copy these over and you can now
see we've got a JSON string of the
successfully uploaded files in this case
css3 dot PNG and html5 dot PNG and if we
take a look inside our uploads directory
they have indeed uploaded let's remove
them and we will start again
so let's now we don't need this anymore
we've done the sort of server-side
processing of this let's use the JSON or
global JSON object to parse this
response all this is going to do is it's
going to basically turn it into a
JavaScript object that we can use
iterate through whatever we want to do
so let's continue sorry to log consult
data and we will try this again in fact
we'll just keep uploading these so we've
now got an object or two objects so the
first object is file a name remember we
did this in PHP we output the file and
name and the second here as well so we
can now loop through these two actually
output what we need so let's do this now
quickly I suppose we can cut this off to
a separate function just so we can keep
things separate here so let's create a
function called display uploads and pass
the data through to it and we will
create this up here so again this
functionality and oops again this
functionality can be really whatever you
want it doesn't really matter this could
I know in a nice-looking list but in
this case we're not going to bother so
I'm going to create a selector for the
uploads area that we created up here
remember we can get that by the OP
loads ID so we say get element by ID
uploads' effect we also want to store
the sort of anchor variable which is
going to for each loop the our new
created a elements our anchor and also
an X because we're going to be using
this variable down here to loop so we
create another for loop and we want to
set X to 0 and we want X to be or while
X is equal to less than or sorry while X
is less than beta length and then we
obviously want to increment X so this
now is going to loop for each of the
pieces of data the objects that were
sent back via this response text so
we're just parting this off to do
different jobs basically so inside of
here we want to set the anchor variable
which remember we created up here this
is going to be document create elements
this time we're actually creating an
element and we want to give this a tag
name in this case it's just a now we
want to set the href to data X remember
within the object we inspected a moment
ago this has an object so it's a
position X so the position that we're
looping at dot file so this is
essentially accessing what we did inside
of upload dot PHP this so now that we've
done that we want to set the inner text
to beta X dot name so we're doing
exactly the same thing and bear in mind
just as a side note we're doing all of
this inside of this main file you would
have this in some kind of reusable
functionality in another external file
just worth pointing out so now for
uploads which we've already selected up
here we want to append a child element
and that child element is going to be
the anchor that we create for each of
these loops and that's it that's that's
it that's all the code so now what's
going to happen is we already know that
the upload works but when we drag these
over it should ok so I've just spotted
this let's just change that back ok so
now what we can do is head over to our
page
and actually try not load stuff so we
should now see the files upload into the
uploads directory as we've already seen
and we'll see the anchors created and
added to that uploads element and there
we are so we've got the two uploaded
we've got the HR FS in there and
obviously the inner text and when we
click on them we see the actual file so
that's how we do drag and drop uploading
now this won't work for all browsers so
it's a good idea to start checking for
support and providing suitable fallbacks
like just normal form elements so that's
just something to bear in mind</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>