<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP File Uploading | Coder Coacher - Coaching Coders</title><meta content="PHP File Uploading - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP File Uploading</b></h2><h5 class="post__date">2014-04-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PRCobMXhnyw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we'll be looking at basic
PHP upload taking some security and file
size checking into account so let's take
a look at how this works I'm going to
choose a file here in this case it's a
txt extension which I've allowed inside
of my upload dot PHP script so if I go
ahead and select this and hit upload you
see that uploads and all I've done is
just output the location of the upload I
happen to have this opening here so I
can refresh and see that that file has
been uploaded it's generated a unique
identifier for the file name and when I
hit it then you can see the contents of
the file so let's go ahead and build
this PHP upload script okay so we're
starting fresh here if we head over to
our text editor you can see that I've
got three files open these are the three
files that we're going to be working
with index is going to contain the form
that we're going to choose the file from
upload dot PHP is going to check and
process this file and actually upload it
and upload me dot txt is just the file
that we're going to be uploading now all
uploads are going to land in this
uploads directory which is currently
empty once we start to upload files will
see these appear in our uploaded
directory so let's create the form first
of all if we go ahead and create a basic
form element we need to give this an
action and a method and also an Inc type
to allow this to process file uploads so
the action is basically where this form
submits to in this case it's upload PHP
the method needs to be post there
obviously in post and get methods but
we'll be using post since this is
sending file data and the Inc type here
is going to be multi-part slash form
data now inside of this form we need to
create an element to allow a user to
select the file and then a button to
allow this form to be submitted so we
have an input type of file we're going
to call this file that's what we're
going to reference it as in PHP and
we're going to have a submit button as
well and we'll give this a value of up
good so let's take a look at that in a
browser it just looks like this we can
choose a file and hit that hit upload
and that goes through to upload up PHP
so now we can go to upload dot PHP and
start to write the code that'll allow
this file upload to happen the first
thing we want to do is check whether the
superglobal files contains file and that
is basically the name here that we gave
this file here
so whatever you choose to call the name
in your markup you're going to want to
change that here and then subsequently
in a minute when we say file equals and
again the superglobal file files and
file so file now contains all of the
information about the file we've
actually uploaded so if you use the
print our function here and part in file
we can actually see the information
about the file we choose so if we hit
upload me doc txt you can see here that
we've got a name which is upload media
txt we've got a type which is text plain
now we're not going to be using this to
determine the file type because it's
unreliable we've also got the temp name
which is where the file is currently
stored before we move it we've got
whether there was an error or not and
we've also got the size of the file so
we can use some of the properties of
this to actually check things like if
there was an error if the file is too
large etc etc so let's store some
properties about the file I'll just put
a comment here final properties we're
going to store the file name so we just
access the name key inside of that array
that we just output then we also want
the file temporary location so we can
use this later on to move the file and
that's TMP underscore name and we also
want to grab the file size and that's
just the size key so we've got all the
properties about the far but what we
want to do now is use a method of
extracting the file extension from the
file that's been uploaded and this
allows us to whitelist Oh
the files we want to accept it's always
better to whitelist and blacklist
because you can if you were to say I
only want txt and JPEG files to be
uploaded that would be a lot more would
be a lot safer than saying I don't want
this far I don't on that far etc etc so
let's now work out the file extension
and this is fairly straightforward let's
create a variable called file txt and
let's explode the value of file name by
a dot now what this means is we will
then end up if we do a print our on file
extension we'll end up with an array
this takes a string and it will explode
it by a specific character turning it
into an array so if we refresh here and
hit continue you can see we've got an
array with a key of 0 called upload me
that's the name of the file and this is
now the extension of the file because
we've exploded it by a dot so now what
we can do is we can say file ext is end
and end will basically take the end
element of an array which in this case
is always going to be the file extension
and we're also going to convert that to
lowercase because we're only going to
provide the white list do extensions as
a lower case so now let's define which
one which file extensions we want to
allow so we create an array I want to
allow txt and I also want to allow JPEG
files we'll be testing this with a txt
file so now we're going to do a series
of checks to make sure that there are no
errors in the file upload we're going to
make sure that the extension is actually
allowed I'm also going to check the file
size and then subsequently we're going
to check for the file that's actually
been uploaded so let's check if this is
allowed first of all I'm not going to
implement any error handling here you
might want to implement your favorites
of error handling method or system so
we're going to use the in array function
which will take a value and it will see
if it's in an array and in this case
it's checking whether the file extension
is inside this allowed array so let's
suppose our file extension is T
XT this will return true because txt is
inside this array the same with JPEG so
now what we want to do is check if the
file has returned an error or not so in
actual fact what we could do is store
this value up here we could say file
error is file error in case we wanted to
reuse it somewhere else so we're going
to say is file error equal to zero if it
is that means there are no errors so
we're good so I'm going to nest a bit
here which is probably bad practice but
this is just demonstrating how we can do
all these checks so I don't really mind
for now but I'm going to say is the file
size less than or equal to and I'm going
to say this is two megabytes so I need
this value in bytes which happens to be
this but you can go over head over to
Google and work this out so now I want
to generate a new file name because I
don't want to generate a file name and
as it was uploaded let's say one user
uploads a file called upload me txt if
the next user uploads a file called
upload me txt that will overwrite that
other file without warning so we need to
generate a unique ID or as unique as we
possibly can to name these files so I'm
going to create a variable called file
name new and this is going to use the
unique ID function now this takes an
optional two parameters the first is a
prefix and the second is increasing the
entropy of this and in this case I want
to do this this will just increase the
likelihood this is absolutely random so
I want to append on the file extension
before we go any further let's echo this
out just to see what this is done things
might get a little bit confusing here
when I hit continue this is our new
filename so we've got this as our new
file name which we can store so in this
case all of these checks are passed but
if I have uploaded a file that was
perhaps too large or wasn't allowed this
block wouldn't have run so we've now got
the new file name let's now define the
destination so the file destination is
going to be the uploads folder
/and then a pending on the file name new
so again just for example let's output
this and refresh so this is where our
new file is going to be uploaded to in
the uploads directory of the root
directory that we're currently working
in and with this file name so now we can
actually use the move uploaded file
function the move uploaded file function
will first of all check whether this
file has genuinely been uploaded via an
HTTP request and it will then also move
the file from the temporary location we
saw earlier into a location that you
define so in this case I'm going to say
if move uploaded file because what this
will also do is return false if this
fails we choose the name of the
temporary file where it currently is
we've already seen this output and we're
going to choose the destination which we
applied here we created this destination
here so if that's all worked then I'm
just going to output the file
destination you could redirect your user
perhaps or show a message or whatever
you want to do so now let's check that
this is working and we'll actually go
through the whole process to check that
a file that's been uploaded so I'm going
to choose choose a file here and click
upload meetup txt hit upload and that's
now giving me the file destination so I
can assume that this has been uploaded
and it has so if I click it we've got
the uploaded file</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>