<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Laravel Subscription with Card Payments (9/11) | Coder Coacher - Coaching Coders</title><meta content="Laravel Subscription with Card Payments (9/11) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Laravel Subscription with Card Payments (9/11)</b></h2><h5 class="post__date">2014-07-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iPaKX7aPczQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so updating a card isn't actually that
difficult because remember we already
have the form that we extracted to a
partial which is gonna allow us to reuse
most of the markup so let's just start
doing this in terms of creating links
and then we'll create all of our routes
and things like that so inside of here
we want to create another if statement
down here this is getting a little bit
messy but it doesn't really matter too
much bit just playing around I'm gonna
say if the user is subscribed I want to
provide a link to them for them to be
able to update their card details so
inside of here we want to say update
card and the link that we're going
through to let's just define what that
what we want this to be initially and
then we'll go ahead and create the route
for it I'm gonna say this is
subscription card so let's create the
route for this now we need to make sure
that we are subscribed before we
actually give the ability to update card
and we want to we could make sure this
was not cancelled but I'm not really too
bothered about this so we're gonna say
card as the name of the route we're
gonna say subscription card and I'm
gonna say get card cool so let's create
that method on here get card and we're
going to return a view so we will save
you make subscription card so let's
create that to view now son under
subscription and you file and we'll call
this card blade that PHP and it's just
write card in there to test that this
works so we should now have this link as
we asked out we are actually subscribed
and there we go so update card I'm going
to hit that and all we get a token
mismatch exception because we are asking
for cross-site request forgery
protection which we don't need for the
get view so update card and there we go
so let's start to build out the page
where we can update the card this is
super simple all we really need to do is
take the join page that we are
have and duplicate over here now we're
not really interested in a user
selecting another plan although you can
select other plans with laravel cache it
does let you swap plans but all we want
to do here is change the button name to
update card we want to keep the form
token we obviously want to keep the form
partial in here but we want to change
this to subscription card and I think
that is about it
so let's just check this out there we go
so we've now got all this juicy
information we can click update cards
and there we go
so we can now just enter our card
information and hit update card and then
we can go through to PHP to actually use
cash it's update our card not day.this
on stripe so let's do this now so inside
of the subscription controller we
obviously need a postcard method and
inside of our routes we need to define
this as well so we can just say host
card and before we want this to do a bit
of cross-site request forgery protection
we don't need that and we can change
this to postcard cool so let's just
check that the token is sent through
which is obviously the most important
part of this so inside of the
subscription controller that's just echo
input yet token remember we're reusing
the JavaScript functionality we don't
need to change a line of code there
because we made this so it's reusable so
let's just change this to say an
American Express paste that in and into
the expiry month in year and the CBC and
hit update card and there we go we're
taking through two subscription slash
card with the token of the card that we
can update remember this won't charge
your users again so you might want to
just add a message on here telling them
this won't charge them anything so
inside of here now we don't obviously
want to just echo that's Hogan that's
going to be useless for the user but
laravel caching
this extremely easy all we do is access
how it signed in user we say update card
and we pass in the token like so and
then we want to redirect so back to the
generic subscription page and we'll give
the user a notice just to let them know
that they've updated their card so your
card has been updated so we can keep an
eye on this remember inside of the
database it stores the last four digits
of the card which you can display to the
user if you want to we're not gonna be
doing that but let's just take a look if
this does actually work so let's enter
our card number our expiry month in year
and our CBC and let's see if this
updates our last four to three zeros and
a five okay so it looked like that did
work so let's head over to see Pro let's
refresh and you can see that we now get
triple zero five we can also confirm
this within here if we refresh we can
see the user's card information at the
moment it says Visa and now it is
changed to an American Express and
that's been set to the default card so
that's it we've now given the ability to
update the user's card</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>