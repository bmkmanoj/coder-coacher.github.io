<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 2) | Coder Coacher - Coaching Coders</title><meta content="PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 2) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Tutorials: Register &amp; Login (Part 22): Mass Email Users (Part 2)</b></h2><h5 class="post__date">2012-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/D4UgrzlxsAM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so what we're going to be doing now is
actually building this functionality to
email all of the users where they have
their setting
obviously as one so the first thing to
do is go ahead build up this page only
allow admin access the moment I believe
that let's just have a look we have Alex
as an admin so type one we looked at
this in the user types part of the video
if you haven't watched that yet
or if you want to refer back to it as a
reminder but we're going to be using the
protect page in the admin protect
functions in conjunction to protect this
page against normal users or anyone
isn't logged in accessing it because
obviously we don't want to give that you
know that that ability to anyone so
let's go ahead and start to build up the
page we'll build up the form will
validate the form very very simple this
time we haven't got a lot to validate
we've just got a subject and body and
then we'll go ahead and call this
function to email users and then go
ahead and build that function so not
really a lot to do considering you know
you're emailing all of your users
because we've already built most of the
functionality so let's go ahead and
create a new page I'm going to take some
I'm going to take a template here from
admin which is the page that we created
that only admins are allowed to access
so I'm going to go ahead and copy this
and paste it into here just to be lazy
and I'm going to save this as mail dot
PHP okay so let's go ahead and close
admin you'll see that I've got general
dot PHP and users PHP open these are two
of our function files that we're going
to need to add to and all of that stuff
so let's go ahead and just change this
to mail and or we'll say email all users
and we'll add our form down here in a
moment so let's go ahead and check this
page out first of all we log out and
we'll try and access it brilliant let's
try and log in as Billy and just try and
access that
okay its redirected us to the home page
well the index page which is good we
don't want to allow access and now let's
finally login as my account which is an
administrator account and we have this
email or users page so now that we've
got the page let's start to build the
form up so it's nothing really that you
haven't seen before we're going to
submit and validate this in exactly the
same way as we've already already been
doing so we need an unordered list in
here and some list items the first list
item is going to be the email subject
which is going to be required and this
is just going to be an input field with
the type text we're going to give this a
name of subject make sense
and let's proceed to the text area so
this is going to be the body of the
email again this is going to be required
and this is going to be a text area this
time so slightly different looks we want
a larger area I'm also going to go ahead
and give this a name as well what we'll
just call this body and lastly we want
to go ahead and obviously include our
submit button so it input and the type
here is submit and the value here is
just going to be send so let's go ahead
and refresh here you see we've got our
form this is slightly small so let's go
ahead and open up our CSS file and just
under here I'm going to go ahead and add
a new selector for all text areas and
I'm going to give all text areas a width
of 400 and let's say height of say 150
perfect that's that's a big enough space
so we can go ahead and close that now
okay so when we send this we need to
start validating so both are required
we're not going to bother creating a
required array because we're really not
going to need much more data here you
can go ahead and make it you know a lot
better if you want but let's go ahead
and just open up some PHP tags under the
header here
and let's go ahead and start to validate
this so what we want to do is we want to
say if empty dollar underscore post is
equal to false this is going to mean
that the form has been submitted and
we've got some data in our post array so
let's just go ahead and echo a or
something and click send a perfect so we
obviously don't want to echo a we want
to go ahead and start checking if things
are require or empty or not so we need
an if and we need to say if empty dollar
underscore post subject now if this is
equal to true we want to append to our
errors array and we'll just say subject
is required we want to do exactly the
same thing here so a bit of repetition
but it just means we don't have to use
that for each loop that we've used in
previous parts so for example in
settings we use this for each loop
really because we have more potential
for more fields here so here we're just
doing two if statements so we need to
check the body and if if result of empty
on body is true we want to say body is
required okay so now what we want to do
is check that's that they're all the
checks that we're going to do we're not
going to check for minimum length or
anything like that
now we want to check if the overall
errors array is empty so if empty errors
is equal to false that means we do have
errors so we're going to use our output
errors function and pass in this errors
array errors array otherwise we want to
send email and we'll just go ahead and
echo send just so we know that we've hit
that point okay so I'm going to click
send subjects required bodies required
I'll just type in anything here so want
to where PHP academy'
and I'll just say hello there just for
now so I'm going to go ahead and click
send send so if we were to just say this
and no body body is required okay and
obviously this is removed the subject so
it might be worth adding a little if
statement in here to an if statement in
here as well to check if that variable
set and then if it is echo then the
contents out I'm not going to do that
for now like that's just something that
you can do in your own time okay so now
that we know that we're validating we
need to go ahead and send this email to
the user so what do we do well we need a
function that's going to loop through
users and specify a subjects and a body
and send out these emails to these users
so I'm going to call this function mail
users and what I'm going to what am I
going to pass through here when I'm
going to pass a subject and a body so
dollar underscore post subject and
dollar underscore post body and when
we've done that we want to relocate to a
success message we've done this before
mail dot PHP and then a success query at
the end there and then I'm just going to
exit so we can now go ahead and test
this with our success variable at the
end here if I go ahead and type in this
and hello and I click send we get the
success at the end here now this is
going to prompt a confirmation message
so let's go ahead and do this if
something else is going to be all of
this form down to here let me just
explain this in a moment I'm just going
to go ahead and indent all of this here
now the reason this is is we're checking
if this success query is is met or it's
there and if it is we are going to say
you know your emails have been sent
otherwise we're going to show the form
and all of
stuff as well so if is set dollar
underscore get success that's equal to
true and this variable is empty which we
don't need to check but again probably
good practice if MT is equal to true
then I'm going to break out of PHP back
in there and in here I'm just going to
say the email has been sent
so we're validating we're giving a
confirmation message the only thing
we're not doing at the moment is
actually sending the email and
surprisingly that is the shortest part
of it because we already have everything
in place to do so so let's go ahead and
type in again something here in hello
send perfect so we have the visual and
the validation and all that stuff now we
need to go ahead and actually create
this mail users function so in the next
part of the tutorial we are going to be
creating this mail users function as I
said it's going to pass in a subject
it's going to pass in a body it's going
to loop through all of the users that
have that little digit so the allow
email in our database tables set to 1 if
they do have it set to 1 we're going to
go ahead and we're going to use the mail
function the email function we've
already created to go ahead and send
them an email</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>