<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Shopping Cart with PHP: Payments with Braintree (13/15) | Coder Coacher - Coaching Coders</title><meta content="Build A Shopping Cart with PHP: Payments with Braintree (13/15) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Shopping Cart with PHP: Payments with Braintree (13/15)</b></h2><h5 class="post__date">2016-05-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Z7Pb7k-fX3E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">once the user has filled in the order
form and they have selected their
payment method what we now want to do is
actually capture that payment on the
back end so this is really
straightforward to do as well so we have
all of our configuration set up remember
over in our bootstrap file we pulled in
our Braintree configuration here we're
currently using the sandbox obviously
and now what we want to is just update
our order controller now there's a
couple of checks we need to do or at
least one main check we need to do and
that's that we have that payment method
Nantes so we need to check that we have
that otherwise we obviously won't be
able to process a payment so we can do
that around about here so what we do is
create a little if statement here and
just say that if from the request
grabbing the payment method nonce which
remember is automatically attached to
our form with the drop in UI then we
want to redirect back or we can error or
do whatever what you want to do but this
should never be the case it's only
probably if the user is doing something
that they shouldn't be so we're just
gonna say redirect to path for order dot
index we're just going to redirect them
back so that's if the payment if method
nonce doesn't exist now that we've got
that out the way down here after we've
actually created the order we want to
make the charge so to do this we create
a variable called result and we can
actually refer to the documentation for
this so if you head over to the drop in
payment UI documentation and over here
just click transactions you'll see that
what we get is a example of how we
actually make a sale so in this case
what we do is we use Braintree
transaction we pass an array in with all
of the options so we've got a mount the
payment method nonce which we know we
already have this then we have some
options and we're going to submit this
for settlement there are loads of other
options so check out the documentation
if you have any specific needs and you
can switch this up depending on what you
need to do so let's go and add this in
then so we're going to say Braintree
transaction sale we're going to pass
through
the amount which we know comes from our
subtotal plus our shipping so again if
you want to include shipping into this
system you can go ahead and do that now
we want to pass in the payment method
Nantes like so and remember that this
comes from requests get per am and its
payment underscore method underscore
Nantes and then finally we just want to
pass in some options and we want to
submit this through for settlement so
submit for settlement true and we're
done that will make a charge on
Braintree released on the sandbox so
what we're gonna do is kill the page
here I'm gonna do a var dump on the
results so we can see what we get back
from this and what we can use so let's
go over to the page here the order form
and let's just go and fill out these
details just over here
and then let's go and enter our test
card number expiration date CVV and our
postal code so now we can click a place
order and of course what we didn't do is
it import the Braintree transaction
class so let's just do this at the top
here and we will be good to go like so
there we go so let's refresh this and
this will go through and now we see a
successful result back from Braintree so
we've got things like success true we
also have lots of other properties so we
have things like the transaction ID
which were eventually going to be
storing in our database but you can go
ahead and dump this out and have a look
through either way we pretty much have
everything here that we need if we want
to store it locally we have lots of
information about this so let's now go
over to our sandbox account and give
this a refresh and we should see a sale
made today so we have indeed and head
over to transactions and go ahead and
submit this search through and there we
go
so we've got that 6850 from our checkout
so that is pretty much it
for actually capturing a charge on the
backend using Braintree really
straightforward to do we have a little
bit more to do here next because what we
need to do is update our database to say
that this payment has gone through we
need to store the transaction ID so we
can refer back to it later and we're
gonna cover that in the next part so
thank you to Braintree payments for
supporting code course mobile app
development can be complex but with
Braintree integrating your payments
doesn't have to be with elegant code and
clear documentation to help you out your
business can integrate nearly any type
of payment from any device with just one
really simple integration Braintree
simple flexible SDKs makes your job and
payments easier
learn more at Braintree painless comm
slash code course</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>