<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP and MySQL with MySQLi: Getting results (Part 4/9) | Coder Coacher - Coaching Coders</title><meta content="PHP and MySQL with MySQLi: Getting results (Part 4/9) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP and MySQL with MySQLi: Getting results (Part 4/9)</b></h2><h5 class="post__date">2013-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/HQOS3V9nyEQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now that we've connected to our
database we're going to actually query
the database to retrieve records of our
choice now this we're not going to get
too far into SQL in this case but we are
going to do a couple of select
statements or queries just to retrieve
results that we're after what we're then
going to do is check the number of
results that we've been returned so we
can either output a number or just check
that we have actually retrieved some
results and then we're going to loop
through the results or examine the
results in certain ways so depending on
how you need to use the results and
output them to your page and then we'll
obviously just output some data to the
page as we go just making sure that we
can see that we're actually retrieving
the results that we required so let's go
ahead and just start to start to build
up how we might query the database so
I'm going to say results or result
equals now what we're going to do is
access the database object that we've
created here instantiate it here and
we're going to use the query method now
the query method takes a parameter which
is a an SQL query so in this case what
we're going to do is select data from
our database we're going to select
everything from our database now if we
do select asterisks from users
this basically means select everything
from the users table so we know that
this is our users table we've got two
records so what this is going to do is
it's going to select both records and
it's going to select every field from
the record from this record so it will
select ID first name last name bio and
created so we'll get all of that data
back if we wanted to limit it to a
certain amount of results we could do
something like limit one or we could
also limit it at a certain point in our
table by saying something like limit 1 1
which means limit from one and only
retrieve one so alternatively if we
don't need to retrieve all of the fields
from our database we can define which
records that we want to retrieve so we
can say
select first name and last name only if
we know that we don't need things like
the bio the created day or the ID but
generally if you're working with all of
your data and Astrix is absolutely fine
so selecting everything from users now
how do we know that this query has
worked or not we've got two ways of
doing so first is to turn off error
reporting and just refresh the page it
looks like everything has successfully
worked let's go ahead and just modify
this and see what happens nothing so it
looks as though this is a source
silently erroring we're not actually
getting any error back now the reason
being for this is that when we actually
when we actually retrieve our results we
can check things like the number of
results etc etc let's go ahead and use a
technique that's extremely useful and
that's to that's to basically print our
something and print a result here so
what we're going to do with print R is
this will print the sort of structure
and data structure if you like of what's
returned here it won't be the results
set but you'll see what we get back here
so let's just print our result of course
from people there we are so let's
refresh as you can see here that we
return with a mysqli result object and
it's got a few bits of information in
here that we can sort of look at and
work out the lettuce has completed
successfully we've got a field count
here which is 5 we already know that
there are five fields here and we also
have a number so a number of rows that
have been returned which we know are two
so if we were to say something like
limit one or limit one one we know that
that's retrieving the last result and
therefore we'll get a number of one so
let's ignore that for now but let's work
out how we might want to actually put
this into an if statement so we want to
say if result num rows so this is
basically saying is this a positive
number if it is
we'll just say yeah we've returned some
records or something like that so if we
refresh we get this now let's go ahead
and select star from users like I'm
mistaken you did before
and we don't get this appear so we know
now that we can check with this query
not was a success or not but we know we
can get a number of results if we wanted
to check actually check if this query
had failed or not we can also do so and
this is extremely important because it
allows us to debug a query if it's
failed at the moment if I was to type in
select star from users we don't get an
error back because we're not outputting
specifically asking to output an error
now there are a couple of ways of doing
this we can either put or die on the end
and then instead of accessing something
like the result error which would
probably make a little bit more sense
we're accessing a database error so it's
a date it's a database level so we're
going to say or Die which will kill the
page database error so we're outputting
a database error so if i refresh now it
says table app users so app is the
database name users as the table name
doesn't exist so it's giving us a
readable error that we can see and say
oh yeah that makes sense
let's go ahead and change this back to
people and it works again so whatever
error that you come across if you would
type in something that didn't exist so
just type silly there this doesn't make
sense this query doesn't make sense so
we'll get oh okay okay fair enough let's
just type in something like select like
this or something like that so now when
we refresh yeah we get this actual SQL
syntax error and it will tell us of
where the error has started you know
apps so we can we can sort of debug that
a little bit easier so a probably a
preferred way is not using or died
because it's not very user friendly in
terms of the process of your application
you want to actually do something if
this query isn't successful and so what
what I tend to do is if like this
what this is doing is it's encapsulating
this assignment to this result variable
but also checking it at the same time so
what we can then do is we can copy and
paste our if statement from here just
indent that little so what we're now
doing is we're saying if this result was
a success and by doing that already
assigning to result then we can check
the result numrows and then we can echo
whether it was a success or not so if I
go ahead and refresh it says yay
if this wasn't successful so if I remove
the asterisks there that's a syntax
error we now get nothing so what we
could do I guess is else and then output
our error so we could do this die DB
error and then we can go ahead and
refresh and then we get the error out
there or we could just silently and kill
the page or we could even just redirect
to user output an error message it's
entirely up to you but the structure of
this is where it makes sense is just
just makes it a lot easier to read so
now that we've done this we've
determined that the query was a success
and we've retrieved a certain amount of
rows so ie a positive number of rows we
can then start to actually loop through
our data so how do we go ahead about how
do we go ahead grabbing our data there's
a few methods that are available to us
from this MySQL a result object that's
returned so remember when we did a print
our on result we saw the following so
we've got a MySQL result objects we have
a like I said we have a few methods
available to us so let's go ahead and
just save rows equals result fetch a
sock
now this stands for associative array
which is an array with where it's keys
are associative to the data so basically
when we return this in fact let's just
have a look it makes a lot more sense so
a numeric array will be 0 indexed and be
0 1 2 3 and have the values but bind to
them numeric
new murky but this will be associative
so we'll have names basically or strings
in place so you can see here they've got
an array
we've got ID first name last name so
this is the associative array with the
data now let's just go ahead and output
this a little more a little more
friendly more friendly way and that's
just wrapping it in pre formatted tags
and this will basically give us a better
view of this so you'll probably notice
that although we're returning two
results and we can prove that by echoing
results in fact we could say echo count
and we can even assign this inside of
here if we wanted to so echoing the
count and let's just put that in a
paragraph tag this is very messy in
terms of markup but it doesn't really
matter at this stage because we're just
sort of experimenting so now it says
we've got two results however only one
is shown so that's a little odd when we
fetch the results as an associative
array yet we're only being returned with
one result now the reason for this is
that we have a fetch associate a sock or
associative array method but this should
now be used within a while loop or
whatever loop really doesn't really
matter and because as a pointer that
relates to each Records row now what we
could do is we could say fetch all
instead so now let's look have a look at
what that outputs you can now see that
we've got all of the results that have
been returned so we now can see that we
can work with this in terms of the two
results that have been returned however
you'll also notice that we're now not
dealing with an associative array but
what we can do is we can pass through
constant constant that defines what we
are returned with so this is going to be
MySQL I num which is the default so if
we leave that as it is and refresh it
stays the same what we can also pass is
a sock for an associative array and that
then change this to an associative array
so we can actually now work with this
data or we can return both which I
personally have never ever done but if
you do require there be a pointer as
well as an associative array or an index
like this that or keep like this run
then you can do so we just return double
the data now really that's the sort of
waste of resource so if we just wanted
it as an associative array we could do
so now that we've done that and we've
returned as an associative associative
array we've got a any record for each
one of these what we can do is then
perform a for each loop and we could say
for each rows as row echo row now what
what's happening here is we're looping
through each of the rows and they now
then for each loop equal or represented
by this row variable so we can then do
is access the key name or the field name
and then we could perhaps append a break
onto the end of this so what that's now
going to do is it's going to output
first-name and this so we could of
course do something like first name
comma append a space and then do row
last name and then when we refresh we
see the first and the last name so we're
extracting this data by looping through
using this fetch all method now there's
a there's another way to do this without
having to fetch all if you were to
basically this is a waste of resources
you don't need to work with all of the
data if you just wanted to loop through
the data and then break at some point or
or do something else at some point you
might not want to fetch all immediately
if you had hundreds of Records you might
not want to do this so what we can do is
we can take this we can place this just
here
we'll get rid of this and we'll use the
fetch a sock method again so now what
we're doing is for each for each L sorry
now we know we need to change this to a
while loop get rid of this it means to
say while row equals result fetch a sock
so it fetching an associative array but
we're moving the pointer at the same
time so now what's going to happen for
each loop row is then going to represent
the record that we're at and give us an
associative array back then we can
access first name and last name so when
we refresh now we get exactly the same
result back however you'll notice that
the rows obviously that's not printing
out anything it doesn't exist but yeah
that that's essentially what we're doing
so we're looping through data in that
way now because we're working with an
object-oriented extension MySQL I has
object-oriented capabilities which you
can see that we're using here it's
probably a lot better to work with
objects rather than associative arrays
so I'm going to say fetch object and
then instead of this kind of notation
this will if we have error reporting on
this will report an error so it's as
fatal error cannot use objects of type
standard class which is just a standard
class in PHP as an array because we're
trying to access array elements of an
object so what we now do is we can just
access these as properties so first name
and last name and indeed any other
record as well so that you know it
doesn't really matter when we refresh
now we just get this data back so this
looks a lot cleaner unfortunately we
can't fetch all results as an object we
have to loop through in this in this way
and but what we've done here is we've
achieved looping through result set and
outputting what we need now there's a
method called free in MySQL I which
basically frees up memory associated
with the result set that you've returned
back from your MySQL database and we
want to free this up so we sort of clear
up after our set
the reason being is that now that we've
stored the result we no longer need that
that results set in memory so what we do
is we just say result and we use the
free method so now when we refresh
you'll notice that nothing's changed all
we've done is we've freed up the memory
associated with the result that we've
returned so in this part we've looked at
querying the database we've looked at
counting the result set checking that
the result odd
first of all checking that the query was
successful and we've managed to output
how many results have been returned
we've looped through them with work with
associative arrays we've looked at new
murica rays and we're now working with
objects which is personal preference
myself and then we've cleared up after
ourselves by using MySQL the free method
on the MySQL result object</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>