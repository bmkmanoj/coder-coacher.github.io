<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Social Network with PHP: Sending friend requests (21/37) | Coder Coacher - Coaching Coders</title><meta content="Social Network with PHP: Sending friend requests (21/37) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Social Network with PHP: Sending friend requests (21/37)</b></h2><h5 class="post__date">2015-08-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/66M8whZievE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so to add a friend then we need a new
controller method on our friend
controller so I'm gonna implement that
we're gonna create a route and then
we're going to write out the logic in
the route and either redirect the user
or if they've done something silly or
will actually add their chosen fret user
as a friend so inside of here then let's
have a method called get add and this
will take a username because we need to
supply the use of the way requesting so
for now I'm just gonna kill that and
output the username in my roots here I
can just go ahead and copy and paste
this and for the URL we are going to
have friends add and then the username
and this is obviously get add this is
going to be friend add and we still want
our author middleware on there we need
to be authenticated to do this so now if
we head over to friends add Dale we just
get dial output so we've got that
username now
so let's hook up this add friend button
here so if we head over to our profile
index page and we have this add as
friend button we can implement this
route now and the route is obviously
going to be friends or friend or add and
of course we need to pass in the
username here which is the current users
profile this user username so from I'm
coming son Ian and Alex now hit this
friend we get adding Dale if I'm signed
in as Dale and I want to add Alex as a
friend we get Alex there so it's pretty
straightforward so now what we can do is
under the friend controller actually
start to add a friend so we first want
to pull out the user here that we've
requested in the URL
so it's user where username equals that
username grab the first record we need
to check if the user can be found
not so we can say if not user there we
want to return redirect off to maybe the
home page we might want to say that user
could not be found and I'm just gonna
pull this down just so it's a little bit
neater so that's the first check
checking if the user can be found or not
if I click on add as friend and I
tugging load of rubbish that takes us
back to the home page with that user
could not be found so the next check is
if we already have a friend request
pending and we implemented the method
for that in the user model so has a
friend request pending we pass in the
user and we get back a true or false
this is really simple to use within our
controller so we're checking if the
currently authenticated user has a
friend request pending so has friend
request pending and we're passing in the
user that we have that we're requesting
but we also want to check if the other
user has a friend request pending for us
because then we will see that on the
page ready to accept the friend request
so we're just going to reverse this and
say if a user has friend request pending
for or user you could make this shorter
by implementing just one method if you
wanted to on your user model but I'm
gonna do it explicitly here just so it's
a little bit easier to to kind of see so
if that's the case we want to redirect
back to a route we're not gonna redirect
back to the home page we're going to
redirect back to profile show and/or
profile of index rather and we pass in
the user name here that's the user name
there or the rather the user user name
you can use either and I'm gonna pull
this down again just it's a little bit
easier to read and we want to
flash some session information friend
requests already pending so we can
actually test this out if I click add as
friend now we see it goes through if we
insert a record into here so one and two
and we accept it 2-0 oh we get the add
we get the accept request button but if
we do friends dial manually we go back
from request already pending and then we
can accept it from there so we know that
that one works now let's just remove
this record great so the next thing is
checking if we are already friends so if
or user is friends with which is another
method on our user model passing in that
user then we know we're already friends
so we can return and redirect to our
profile page so that's profile index
again with that user name in there and
we'll pull this down once again and we
want to show some information saying you
are already friends so we can test this
out again so if we actually bring this
back and we accept the friend request
between user one and two and I go over
to here we can see that we're already
friends now but if I were to go and
manually say friends at Dale you're
already friends it doesn't let us do
anything so again let's delete this
because we now actually are going to
insert that record once we passed all
this checks we know that we can actually
add a friend and remember we use this
addfriend method when I use a model that
we created which just attaches the
current user to out to this to this
relationship so all we need to do to add
a friend is auth user add friend and we
pass in that user and then we redirect
off somewhere so we're going to return
back
redirecting to a root once again we'll
pull this down and we're going over to
the profile page again so again we pass
in our username and we want to say with
info friend request sent perfect so this
is now done and we can test this out so
remember we've got Dale and Alex both
looking at each other's profiles I'm
gonna go ahead and add Dale as a friend
you can see that from request sent
waiting for Dale Garrett to accept your
request and over on the other browser I
have opened when I'm viewing this it now
says accept friend requests
neither of these users can go ahead and
add themselves again from requests
already pending so we've got rid of all
them checks and now all we'll have to do
is the ability to accept a friend
request we can take a quick peek inside
of the database here you can see that
we've got the relationship all correctly
set up here and the record inserted so
next then we need to be able to accept a
friend request</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>