<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JavaScript Tutorials: AJAX File Upload with Progress Indicator (Part 3/5) | Coder Coacher - Coaching Coders</title><meta content="JavaScript Tutorials: AJAX File Upload with Progress Indicator (Part 3/5) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>JavaScript Tutorials: AJAX File Upload with Progress Indicator (Part 3/5)</b></h2><h5 class="post__date">2012-08-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GMUOAN60vHY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">right so now that we've determined well
now we've got our file input information
next thing to do is create a sort of
form object form data that can be sent
via our Ajax request yeah so let's go
back to our code and we'll just
basically carry on so instead of
printing out the number of files here
what I'm going to do is do a loop over
the number of files and add our files to
something so we'll create a for loop
here so for I is zero while I is less
than the length so I should remove to
leave that line but never mind like so
an increment I or pretty current I and
then here we're going to do something so
just to show you to be absolutely clear
how this works
let's just log the names of the files as
well so console.log
file input files I say the ice element
of input no i element for files array
and the name property so if we just log
that what we should get when we click
the upload button is all of our file
names being logged here which we do we
have the four files I selected if we
just select loads we should get a lot
more yeah there we go so that's how that
works but instead of printing out
randomly printing out the name of the
file what we want to do is sort of
creates something that we can have
JavaScript upload so let's go back to
our code what I'm going to do is just
above this loop so here I'm going to
create a new variable called data
this isn't be equal to a new form data
object form player object is something
that's kind of new in JavaScript ich is
not supported by Internet Explorer 9 it
will be by 10 but people still use 6
that's not really a problem yeah so
formed later objects something that's
quite new it's not massively widely
supported but it will be eventually
hopefully but it's absolutely the
easiest way to upload files with
JavaScript so that's why are we showing
you how to do so sort of logging the
name like I said what we do is append
file to our data object we just created
so do data append two parameters first
parameter is effectively the name so
it's essentially like the name name here
and the value is the second parameter so
we're actually gonna use the same name
so the name is going to be file with
square brackets so file or files you
must file okay
like so and the value is just gonna be
the actual file object itself so file
inputs files I not one I like so and
that will append our actual file to the
object and then also if done that that's
pretty much it all you do is worry about
uploading the actual you know making the
request and having it loaded which is
fairly standard JavaScript stuff so
let's go ahead and do that so what we'll
do is create another new variable called
it request this will be equal to a new
XML HTTP request Ajax request if you
prefer same thing and then we need to
attach a few event listeners they're
going to handle our progress and sort of
done messages so first one week no
attach is to the request upload you can
attach these events to either upload or
just the request itself if you do it's
the request itself it counts as the
download so the actual response view
it's the upload it's the stuff being
sent to the server not from it so for
the upload progress we want the upload
obviously so add and events listen and
the event we want to listen on is the
progress event and this is called every
few I don't know bytes well how did I
know how it works it's probably pet
varies per browser but essentially you
can get the progress from it so a
percentage I'm going to be adding a
function to this should take the event
as its parameter as always and we'll
leave that at that for now we also need
to listen on the load events for the
upload so request upload add event
listener hope that's right that's
obviously not right that might be right
load and this is the event that's called
when the upload is finished successfully
I think
yeah successfully so that's that that's
the progress so as to blows happening
once the upload is complete we're also
going to add an error listener just in
case you want to handle errors in some
way so request upload and events
listener error
function events
and so on okay there we go
alright oops tabs fixed okay so now that
we've we knit we could we've got a way
to know about our upload information
let's go ahead and well I guess create
the progress upload things so yeah that
makes sense
so all I want to do is essentially just
display a text field in our progress
event and in our load event we want to
just hide it again so what you to do is
get the elements which is this one here
the upload progress ID and in the load
event we'll go for that first it's the
simplest so document gets element nope
better by ID upload when you could do
all sorts of things that you could
create a progress bar and serve the text
that's quite awkward to do so I'm
leaving out for the sake of this upload
progress and we'll just set these style
display
to none which just hides the element
from a page
which is what we actually defaulted it
to originally as you can see here so
that's done next thing is the actual
progress I guess so this is the most
complicated thing
there are few problems one is that
sometimes the browser can't work out the
size of the file so what needs to do is
first do a check to see if the length is
computable which you do just like so and
if it is we'll create a new variable
called % which is going to be equal to
the total amount sent divided by the
total amount actually I shouldn't really
call it percent it's not percentage but
never mind
drive by the total size so this is
essentially event loaded which is the
amount that's been sent already divided
by events total which is the total size
of this request pretty simple I'm going
to create another variable which is
going to be our actual progress element
because we need to do a few things to it
we're not just gonna do it in one line
like we did here so progress and I'll
just copy this up for the sake of quick
quickness speed yeah okay so first thing
we need to do is remove any elements
that might still be inside them because
this function is called
multiple times so if we just add the
text and percentage to it it will keep
adding a new percentage you won't remove
the old one what we want it to appear to
be updating so the first thing we need
to do is remove all of the elements from
inside this progress element and the way
you do that not the easiest way you do
that is using a while loop so while
progress
has child nodes so these are this will
return true as long as there are
elements within this element and while
they is true you want to be removing one
of them so progress remove child and
then this can be any element that is
inside the element so the sake of it
let's just do first child which is just
the first element so we're going to keep
removing the first element until there
are none left
and that just hide any text that might
appear so next thing we need to do is
add our text to the elements the
progress element to actually show up on
the screen so the way we do that is by
adding something so we'll append
a new child
it's also quite a good idea just to do
this by the way say if you defined your
elements like that with just empty this
text here that I've just highlighted the
three tabs or effect the new line
between the two lines so it's all for
that just actually count as an element
that's a text node so you would be
getting errors if you just assumed it
was empty because it was like that if
it's like just like it is like that that
is actually empty but it's just going to
be aware of anyway so we're going to be
adding a new element and the element
that we're gonna be adding is going to
be a text node the way you create a text
node is by doing document create text
node and then you put the text that you
want to appear in here and the reason
we're using this method instead of just
setting the inner HTML property is that
well into a bit awkward to explain but
in to and what the main reason is
because this method is more of the
correct way in air quotes to do it but
also say if you were appending something
that had something that looked like HTML
so say if you a parent you want to
append some text that had a well less
than or greater than symbol in it that
would break the page because it looks a
bit like HTML tag and you didn't want to
happen if you do that if you use this
method those will just appear as what
they actually are so it's a little bit
safer if you especially if you're
loading text from a you know a URL
you're not sure of a content it's much
safer method but yeah that's the reason
hopefully I've go for back anyway
so instead of appending random text
we're going to do is dynamically
calculate our percentage which was
already done but we want to essentially
multiply this by 100 to get it into a
nice percentage format and then we want
to add on so we're going to append a
string to this so we're gonna put it in
brackets so it doesn't break the syntax
and we're gonna add a percentage symbol
like so and also we're going to round
this number because by default it's like
eight decimal places which just looks
ridiculous so we'll just call math round
on this and the brackets kind of make
sense so that's our percentage done and
I think you know we can't test this yet
because we haven't sent the request so
the leaf is put here because we've come
to a nice stopping point and in the next
part we'll deal with actually sending
our request and oh yeah that's pretty
much it have to get the response I guess
it's the next thing but we'll deals
uploading first okay thank you watching
and come back for the next part</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>