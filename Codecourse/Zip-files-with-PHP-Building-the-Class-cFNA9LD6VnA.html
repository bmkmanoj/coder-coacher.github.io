<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Zip files with PHP: Building the Class | Coder Coacher - Coaching Coders</title><meta content="Zip files with PHP: Building the Class - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Zip files with PHP: Building the Class</b></h2><h5 class="post__date">2014-03-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cFNA9LD6VnA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we're not going to go ahead and build
the entire functionality for zipping up
files like this we're going to go ahead
and create a class and then going going
to head and require it into this index
dot PHP page so we can see the
functionality and use the functionality
we saw in the last video so first of all
let's go ahead and create the class file
let's just go ahead and save this in a
folder called classes and we'll save
this as zipper PHP with a capital Z for
the class name we give class names
capital Zed's usually so apart from that
I've got this files folder with three
files and these could be any files at
all so go ahead and choose any files
from your PC and we'll go ahead and
start to write this class out so let's
define it first of all we just use the
class keyword and we call this class
zipper now we need two variables or
properties if you like here one is the
list of files that we want to store and
the other is the actual zip archive
instantiation so we have the zip archive
class we're going to create a new one of
them store it here and then make use of
it later on in other methods I don't
wait too much if you're not familiar
with this kind of working with PHP in
this object-oriented way it will become
clearer as we go along so let's go ahead
and create some private properties one's
going to be called files and this is an
array so restoring these details in an
array all these lists of files in an
array what we also want now is a zip
variable property that's going to hold
the zip archive class when I'm going to
do anything with that for now but what
we are going to do first of all is
concentrate on the functionality that
adds the files to this array that we've
created here so what we can now do is
actually go ahead and require once on
classes forward slash zero dot PHP so
let's go ahead and run this on our page
and nothing happens so we don't have any
errors which is a good sign what we can
now do is go ahead and create a variable
and we'll do this as we go along new
zipper you can go ahead and include the
bracket if you want but that's not
so here so when i refresh still no
errors so we're looking good
so what we're now going to do is go
ahead and create the add method which
allows us to add either an array or a
single string which will then add it to
this array of files so if we go ahead
and create a public function add we're
going to need to take input in here so
we'll just call this input because this
could either be one file or it could be
an array of files so now we go ahead and
we create an if statement now what we
need to check here is whether the input
variable or the input argument or
property or whatever is an array so I'm
going to go ahead and say if is array
input otherwise something else so here
let's just echo it is an array and here
let's echo it is a string let's go ahead
and test this out we can use this
functionality in here nothing's
happening at the moment but over to our
index dot PHP page we can go ahead and
say zipper add and go ahead and choose
the file names to add so in this case
it's files forward slash one two or
three txt so I can go ahead and say
files forward slash one txt so well that
now does is say it's a string because
it's just a string value but what I also
want to do is add multiple files and
this is the reason we've included this
functionality so it makes it more
convenient to add multiple files I go
ahead and create an array the first
being two dot txt and the third being
files forward slash three txt now the
argument that we've provided into this
method is an array and therefore we
should now see the text it is an array
two provided a string and an array now
we could of course as we've already seen
got rid of this put this here and then
go ahead and get get rid of this all
together so we want the same that we
want that to do the same thing basically
but let's leave it like this for now
just so we can prove that we can use
both a string and an array so we'll go
ahead and test this
we'll add the relevant code in here and
then we'll go ahead and do a print R on
this files just to see the contents of
this of this array so if it's not an
array all we need to do is append the
input to the files array so we can say
this files equals input and we use these
square brackets to break basically say
add an extra element on to this array so
now what we want to go ahead and do is
if it is an array we want to take a
slightly different approach so we say
this files and this files obviously
refers to this here so we say this files
equals and we use the array merge
function array merge arranged merge and
basically what this does is take two
parameters the first being the array
that you want to merge something onto so
in this case we know that this files is
an array and the second parameter is the
array that you want to merge with the
first array so it basically emerging
this array here which could already
contain values with this array here and
we know it's an array because we've done
the check up here so down here let's go
ahead and do a print R on this files and
we'll go ahead and refresh there we go
so we've now got oops let's go ahead and
just get rid of this let's create a new
method here which we can use because the
reason this happened is because we're
using the add method twice it's not
giving us the full where is looking a
bit messy so let's say we have this
create method we'll talk about how we're
going to fill this in a moment in fact
let's call this store so we're going to
go ahead now and echo out this files if
I were to print R on this file so let's
go ahead and add this method in and this
method will eventually actually store
this the files that we've added so we'll
just say store so now what we get is the
array combined with the one two and
three files they're all combined it
within one
right now so regardless of how we add
them we could go ahead and get rid of
this put this down here and it would do
exactly the same thing or what we could
do is go ahead and use ad like this
three times with two and three like that
let's go ahead and just revert that back
to how it was before so store what do we
want to do here well we want to provide
a location that we want to store this in
so I'm going to I'm going to say I want
this to be stored in files zipped zip so
you can choose any file name really but
this just sort of makes sense with a zip
extension and I'm storing within the
files directory so we need to go ahead
and add that argument in here so
location and we're gonna set this as a
default as null because we want to check
whether the user has actually provided
or the developer has actually provided
this string so let's go ahead and just
create a little if statement in here we
need to check the location but we also
need to check whether files have
actually been added because there's no
point creating the zip archive if no
files have been added already so let's
go ahead and create an if statement now
we use the count function to go ahead
and count this files and that will
return the actual count so if nothing's
been added via the add method this will
return zero and therefore this if
statement will fail and we want to check
the location is there as well by default
is null so if this is not there then
this if statement won't be too
successful so let's just go ahead and
echo all okay and let's go ahead and
just see what that does so refresh it
says all okay if we go ahead and we
provide nothing in here nothing happens
and if we go ahead and provide something
in there but haven't added any files
nothing happens again so that's perfect
we know that this now works so what we
now need to do let's think about this
well we need to go ahead and filter out
any files that have been added that
don't actually exist so what we want to
do is
want to loop through this these files
and go ahead and check if they don't
exist if they don't exist we want to
remove them from the array so we use the
for each loop and we go ahead and choose
what we want to loop through in this
case it's this underscore files and we
want to loop through them as file what
we also want to do is go ahead and grab
the index because we want to know where
to unset this file from or which
location we want to unset this file from
if it doesn't exist so basically if we
just echo index and maybe apply it just
a break on the end you can see that this
will give us 0 1 &amp;amp; 2 so this is for file
1 2 &amp;amp; 3 dot txt and that's the location
within the array so now we just need one
more if statement and we want to say if
not file exists and this will basically
just check with the file file exists you
pass in the file that you want to check
and it will return true or false if it
returns false well we want to remove
from array because we don't need it in
there it doesn't exist therefore we
can't add it to the zip file so we use
unset and we go ahead and choose which
index of the array we want to remove so
again it's this files then the square
brackets we choose the location this can
be 0 1 or 2 as we've already seen in
this case its index so for each file
this check will be run and then the
subsequent or the file that doesn't
exist will be removed so we can actually
go ahead and test this functionality by
doing a print our again on this files so
go ahead we'll go ahead and refresh and
you can see that we've got all the files
here now let's go ahead and try and add
a file that doesn't exist so I'm going
to say zipper add files forward slash 4
dot txt we know that that doesn't exist
within this folder so therefore that
should be removed from the array so when
we go and refresh it's still not there
so we're only now containing within that
array the
that do exist which is really important
because when it comes to adding them to
the archive it will fail if it can't
find the file so there's one thing we
need to do before we go on any further
and what we need to do down here let's
go ahead and open the zip file using the
zip archive class and that can be found
within sort of natively within PHP so
what we need to do is we need to
instantiate it when our zipper class is
instantiated so we need a public
function and this is the construct
function and this will be run when the
class is instantiated so when it's
instantiated we'll just go ahead and
echo okay or something like that when we
go and refresh you see that just as okay
so this is this is run at the point when
it's instantiated so what we want to do
now is go ahead and set this zip
property here so this zip e adds a new
zip archive so what that's going to do
is create a new zip archive with native
that this is all baked into PHP and that
will create a new zip archive that we
can then down here go ahead and add
files to and this is the actual
functionality that creates the zip file
so I've gone ahead and refreshed and
everything's still working so it's a
good sign so now down here after
filtering through all of this let's just
pull that up down here what we want to
do is the first thing is go ahead and
open the zip the second thing we want to
do is loop through files and add to zip
and the last thing we want to do is
close the zip so that's all we need to
do so let's go ahead and do the first
one open the zip and let's just pull
that down here so we're going to open
this but we're going to open this within
an if statement and that means that it
will check that this file has been
opened successfully and then go ahead
and within that do the functionality so
we'll go ahead and create an if
statement here and open this within it
so we refer to this underscores it this
zip which we've instituted up here and
there's a method in this called open so
we go ahead and open that as
at a specific location now where do we
get the location from what we already
know that it's been provided here like
this so all we do here is pass in the
location now there's also the ability to
choose whether you want to overwrite or
create an archive so if we want to if
the fight if the location that we've
provided already exists we want to
overwrite it otherwise we want to create
a zip archive so we're going to go ahead
and create a ternary operation here
which checks the file exists so file
exists again location two this time
we're checking whether the location this
that we've provided exists not these
files so we're not talking about these
at all it's just this here so if that
does exist what do we go ahead and do
well we want to go ahead and say zip
archive overwrite because that already
exists otherwise what do we want to do
well we want to go ahead and create it
so zip archive create so once that's
done we now can say echo all okay just
to say yet this this files been open
successfully refresh and all okay so we
know now that the zip archive has
actually been created successfully not
actually created but opened ready for
fast to be added this will only be
created once we close the file and we
say everything's ok so we sort of open
it up add what we need to it and then
finalize it by closing it so within this
if statement now this is everything we
need to do we've already opened the zips
the zip now what we need to do is loop
through the files and add each of these
files to that zip file so we go for each
again and we want to loop through the
filtered files that we've already
filtered through and we want to say this
underscore files and we want to loop
through these as file now within this
just single line very very simple we
just say this zip as we've already seen
we've opened up here add so ease the add
method sorry the add file method and we
go ahead and choose the file and the
name within the zip in this case I just
want it that the actual file that we add
so this
to the location and then the name of the
file in this case I'm just going to call
it exactly the same thing but you can
define a specific name and in the
example we saw previously this kept the
file location so we had zipping up for
example files one within the zip you'll
see a folder called files and then a
file called one so it maintains that
same structure so once we've done that
we come down here and we say this zip
closed so we've done both them steps now
so let's just run through what we've
done here because this sir is slightly
more complicated we've filtered out any
files that don't exist by just removing
them from the array that we added to
when we use the add method and then down
here we open up the actual zip file if
the zip file already exists we overwrite
it otherwise we create it which makes
sense and then we loop through each of
the files that we've already filtered we
add them to the zip archive and then we
close the zip archive so that's it this
now will should work so let's go ahead
and just refresh in fact let's check our
directory again first so in files with
zipping all of these into a folder in
here called zipped zip so let's go ahead
and refresh there we are so nothing's
sort of come up on the screen but that's
normal when are outputting anything but
now within files we have this zipped
folder here so let's go ahead and again
open this up and we'll just bring this
over here so within files now we have
this zipped folder or zip archive within
it we have files remember we maintain
the structure that we we add to when we
click on this we've got three files and
then when we go ahead and open these
they obviously contain what was in the
original files so that's how we create a
class that basically just wraps around
the initial or the original
functionality you get with PHP and
provides a really easy way to add files
to a zip archive and then go ahead and
store them in a particular location</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>