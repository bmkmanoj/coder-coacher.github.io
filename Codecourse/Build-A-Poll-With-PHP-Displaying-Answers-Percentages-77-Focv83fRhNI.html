<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Poll With PHP: Displaying Answers &amp; Percentages (7/7) | Coder Coacher - Coaching Coders</title><meta content="Build A Poll With PHP: Displaying Answers &amp; Percentages (7/7) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Codecourse/">Codecourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Poll With PHP: Displaying Answers &amp; Percentages (7/7)</b></h2><h5 class="post__date">2014-09-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Focv83fRhNI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the last thing to do is check if the
user has actually answered the poll and
by doing that we're also going to be
pulling in the users answer as well
we're not going to be displaying the
users answer I'll leave that to you to
decide where to display but what we're
then going to be doing is more
interestingly collaborating the results
of every vote for that particular pole
and then representing them as a
percentage so let's go ahead and start
to do this now but before I do that I'm
actually gonna switch over to a
different user and then I'm gonna cast a
couple of votes so let's call poll two
and let's say I love polls and on this
one let's say it's all right
and then let's choose an ID I use it
with an ID of three as well and let's go
ahead and just submit a couple here in
actual fact we'll do four as well just
speaking get a really good
representation of this so say this and
then we'll say this okay so we've got
quite a bit of data in here just to play
around with in terms of percentage we're
lucky that we can test these quite
easily because if three users vote all
on one separate item that's thirty
3.3333 so we know that that will be
represented anyway let's go ahead and
start to do this so we need to change a
few things around inside of our poll
data because as it stands we're just
automatically getting the polar choices
what we want to do down here is we want
to get the user answer answer for this
poll that may not exist we're going to
query for it and I'm going to check
whether the user has completed the poll
or not and then if the user has
completed the poll we're going to bring
back all of the answers
collaborative answers otherwise we're
then gonna get the poll choices so let's
just do this if statement now so we know
that it's there and we understand how it
works and then we'll create the query in
a moment so here we're going to say if
completed we want to do something
otherwise we want
the poll choices we don't need to get
the poll choices if the user has already
completed the poll there's no need
they've already completed the poll we
don't need the list of choices they'll
come through the stats anyway now the
user has completed in here we want to
get the get all answers or something ok
great
so let's go ahead and focus on this
query up here so get the user answer for
this poll so I'm going to call this
answer query so we're going to prepare
here and in here we're going to
basically select from the poll answers
where the user ID matches the current
signed in user and the data that we're
going to be selecting is polls choices
not ID because remember we want to pull
back the choice that the user has made
and again we're not gonna be displaying
this but Lee said we have it in the
query and we'll see this when we do a
print our and we're gonna alias this as
choice ID we're also going to select
from polls choices the name
I'm gonna call this choice names with
alias that as a choice name and that is
coming from polls answers which doesn't
make too much sense because we're using
the polls choices table but again we're
gonna join this data so we're going to
join polls choices and that's on the
polls answers choice where that matches
the choice ID we're linking these two
together so on polls answers that choice
where that equals polls choices doe ID
and we want to only pull in the answer
where the where the answers been
answered by the current logged in user
ID so here we want this to be the user
that's currently little
in in our case if we do this for but
let's change this to one just to
demonstrate so we're gonna say we're
poles answers dot user equals and we'll
add a user placeholder and poles answers
dot Paul equals polar which makes sense
because we only want the answer where
the user has answered that particular
pole makes sense so let's execute this
and then we'll examine what we'd get
back from this so answer query executes
we need to pass in the user here which
obviously comes from our session and
we're not checking the users logged in
by the way but that's sort of up to you
in your authentication the way that you
handle authentication if you have it and
then we pop in the poll as well which is
represented by the ID variable up here
so let's do some pre tags to preserve a
formatting there and let's do a print
our on answer query and we'll fetch an
object here so when we go through to
this we obviously have an undefined
variable here because we aren't setting
that at the moment but ignore that for
now this is now representing the choice
that I made as user one and we can we
can confirm this by saying well we're on
pole one up here so pole one where user
ID is one is choice one which we know is
there so that's giving me the choice I
made on here so we know that's working
well we don't really know it's working
to be not done enough testing either way
we you know in theory note works but now
what we want to do is determine has the
user completed the pole so we're gonna
create a completed variable here which
will allow us to make use of this
so we're gonna say completed and we're
gonna return a real freighter we're
gonna check the row count on this answer
query so row count will just basically
return the amount of rows in this case
if the user has completed the poll this
will return one row so if this is
returning one we say well it is it is
completed so we set this to true
otherwise we set this to false so now
have this completed variable we're going
to use this in two ways this way and
we're also going to use this down here
because we don't need to output the
choices to the user if they have
completed the poll obviously so what we
can do is down inside of our view if you
like we are going to say here if
completed and down here we can do an
else and then down here just after our
last if statement on here we do an ENDIF
and then we pull this in and if
completed I'm gonna say you have
completed this poll Thanks so we now get
the following you have completed the
poll Thanks we have completed
do you like polls poll this one doesn't
have any question any choices it's
pretty useless at the moment but there
we go you've completed the poll Thanks
we're not displaying the options let's
just for the sake of it get rid of this
row here that represents me completing
this poll number one just so we can see
the options here and see the difference
on poll number two where we have voted
so you've completed the poll Thanks we
don't stop there we want to actually
output down here the users choices so
basically as a percentage based on that
so up here when we say if completed yet
all answers this is useless to us bar we
want to get all of the
answers that have been made we want to
get them as a percentage so we're gonna
call this answers query and this is
going to be a prepared statement again
because we're gonna inject some
variables in here okay
so this is a little bit more complicated
we're going to be doing a sub query to
select the count of all of the answers
and then we're going to express that as
a percentage and then pull that back so
this would probably be better written
within sequel Pro I'm gonna do it within
here but then we'll paste it into sequel
prior and just see how it looks so we
obviously want to select the name of
each choice because we obviously want
each choice for this poll with a
percentage of how many people have
answered next to it so polls choices
don't name we know that we want that now
I'm just gonna pull this down just for
readability because what I'm going to do
is here I'm gonna select count hulls
answers the ID we're going to multiply
this by a hundred and then divide it by
the count of answers so we want to do a
sub query here I'm going to pull this
down to do the sub query so we're going
to select count on asterisks you can
count on any field say ideal something
like that but I'll leave its Asterix
from polls answers where polls answers
dot poll equals the specific poll
because what we're doing is we're
counting the answers and we'll do a
we're down here for this as well or this
here as well but then we obviously want
to make sure that we're pulling it only
in for that poll and what we're going to
do is we're going to alias this as
percentage so this comes from polls
voices ie this here but we obviously
need to join the answers to this because
we have choices mate we have choices
here what we need the answers that have
been made for this particular poll
otherwise it doesn't make sense so we're
gonna do a left join and the reason
we're doing a left join is because these
choices can exist even if an answer even
if a particular answer for that choice
doesn't exist so for example and to put
this simply you can have three choices
but it doesn't mean that a answer has
been made for each of these choices
there might be 10 for this 20 for this
and none for this so we still want to
display each of the choices regardless
of whether they have an answer or none
that's why we do a left join it's a left
join on pulse answers and we obviously
do our standard on so we want to say
polls choices to ID equals polls answers
dot choice and just to clear that up
holes choices the ID here obviously
relates back to this choice so choice
matches this ID we know that and let's
head back to here this is slightly
tricky Anna actually let's do the where
Clause here so we're polls choices poll
equals poll because for this we want to
make sure that we're pulling it in only
where the poll ID matches the one that
we're come really looking at and then we
want to group by polls choices to ID so
group by and I'll explain why we do this
in a moment
polls choices to ID we group by this
because we have choices here with a
unique ID if we group by them it means
that we know that we're pulling in these
items and then next to them will have
the choice otherwise things have a
little bit confusing so what I'm gonna
do is I'm going to take this and I'm
gonna place it into sequel Pro
inside of here I'll make this a little
bit bigger so it's a little bit easier
to see paste this in and then I'm going
to change this part of one and this here
to one so let's run this and you can see
here that we actually get our
representation of the name of the
particular option for poll one and then
the percentage of answers so at the
moment we've got I hate it at zero so
let's change that so under in it let's
say user idea five goes over to oh is
this poll - do you like polls I know
what do you think of the new website so
we're on polity of one remember I'm
going to select an option that is
currently a percentage of zero and then
submit that answer now when we run the
same query again we get this change so
we've got 25 percent here and then 50
percent here so we know this is working
if you're struggling with understanding
the query just go over it and sort of
understand that we're selecting the eat
the choices by name here the percentage
is all of this so within a sub query to
set all of the answers and then forming
a percentage from that and then we're
joining on the tables just simply
because we need to so it's fairly
straightforward but you know if you're
just getting started with this it can be
a little bit overwhelming anyway what we
want to do now is more importantly
actually execute this passing in the
poll as our for our placeholder then we
want to extract the answers and just
output them to the user so we're gonna
say answers query executes and then
inside of here we want poll to be ID and
then we want to extract the answers so
we just do a while loop here and we
assign row for each loop we say answers
query we fetch an object for this
and then we add that to this answers
array so we've now got this answers
array that we can actually output down
here once the users can be to the poll
so quite simply we can just do a for
each loop
so for each answers as answer we can end
that there and we can actually just to
test things now do a print our answer
just to make things a little bit clearer
so we voted on the s.coups we've got an
unexpected end if of course that's of in
for each non end if okay so let's head
up here obviously that needs to be sorry
here for some reason I rounded this as
double quotes there we go
it's finally sorted okay so we've now
got a few objects here we've got the
name of the option we've got the
percentage so this is to quite a few
decimal points but we can fix that with
the number format function within PHP so
now that we know that these are output
what we can actually do here is wrap
this an unordered list and within here
have our list item so I want to output
the choice name and then in brackets I
want the percentage so the choice name
is easy it's just answer name
like that so I love it it's alright I
hate it
we've got zero percent of the moments we
have Hut that hard-coded but let's down
put the percentage and then we'll look
at formatting it so echo answer
percentage like so then we just add the
percentage afterwards so we now get the
following but that's obviously it's
quite decimal places but we know the
data is correct so all we need to do is
wrap this in number format and what we
can then do is define how many decimal
places we want this to so it's entirely
up to you I'm just going to do it for to
to to demonstrate that this carry the
case you can obviously just do it to one
or or no decimal points so we've now got
the fact that we've completed the poll
we're outputting the all of the options
for this particular poll for example if
we were to add another option on to this
so polls choices content let's have a
new one for poll one and I'm just put
blah for an example there we go we've
got blah with zero percent and let's go
ahead and again change myself to use
idea of six and when i refresh obviously
have an answer this because I've just
changed the user ID so when I hit blah
and submit it then we go through to we
should have gone through two there let's
just check out why that might have been
head over to Pollard's of devote sorry
there we go we might need an exit just
after that so again let's alter the
whole let's all to the user ID and then
I'm gonna select blah yeah there we go
so you can see that this is changing you
can play around with it and you can
output whatever you want wherever you
want is fairly open essentially that's
it we've created the ability to vote on
a particular poll and then see the
answers for the users that have voted
for each of them polls</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>