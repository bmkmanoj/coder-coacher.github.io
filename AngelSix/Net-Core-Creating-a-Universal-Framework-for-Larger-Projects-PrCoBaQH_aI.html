<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>.Net Core - Creating a Universal Framework for Larger Projects | Coder Coacher - Coaching Coders</title><meta content=".Net Core - Creating a Universal Framework for Larger Projects - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/AngelSix/">AngelSix</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>.Net Core - Creating a Universal Framework for Larger Projects</b></h2><h5 class="post__date">2018-01-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PrCoBaQH_aI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're gonna start
linking them with the web server that
we've started to make so we've got the
four SATA word application open before
we start growing this now because we
need to then make a web host to start
talking to the web server that does the
HTTP requests we're gonna start getting
quite a lot of repetitive logic and not
just in this application the web
application but in general with you know
how we do things so what I really want
to start doing now is formatting a new
project this is going to be called DNA
framework and that's gonna be a
completely universal framework kind of a
helper kit of all the useful features we
make that we can share between all the
applications then and ultimately we'll
have it as a package and nougat package
that you just install so I'm gonna get
started on that on this video so it's
gonna be quite a long video I suspect
and it's gonna be basically shifting
over to dotnet core and dotnet standard
library and bacon and really first
making the whole structure and framework
and getting some dependency injection in
there which out of the box isn't in
dotnet call standardly dotnet standard
libraries so you get it in asp.net core
by default but you don't get it in just
a library so we're gonna have to do a
better work to effectively plumbing some
dependency injection that will remove
the need for n inject in this project
and then we'll also port over the lager
which is in receta would call them in it
and even though we've written our own
it's nice and easy
we'll move this into the DNA framework
just for you know the sake of doing that
of your world you'll see a different way
than doing this we'll make use of the
inbuilt console and debugger lockers
built into dotnet core and we'll add our
own file logger to mimic the file logger
we have so we'll do that but this is
gonna be a mostly a lot of kind of
building over a structure that we can
build them on top of as we go forward so
let's just get straight into it and
you'll see where we're going from here
so one of the first things we want to do
is actually make that project so we'll
just do file new project we want a
dotnet standard class library will Chuck
this in I'll put the link to this repo
in the video so this is on my github
sources and we'll just plunk it in here
we'll call it DNA I think we'll just
call it DNA it's gonna be the DNA
framework but we'll call these the main
project DNA then we name it - doc
framework because I want the the
namespace to default to DNA so we'll
just do that and I think create
directory for solution and go and let's
see if that does what I want I didn't
want to open that like that my nevermind
just take a look at the folder we have
DNA DNA okay that didn't exactly work we
don't on DNA there let's close that down
let's move this poor paste it into here
replace so now we have DNA and do dot in
fact if we now just open up this
solution it's in the right folder
and then we rename this to DNA dot
framework and that's the DNA DUP
framework and then let's take a look at
as that's close to so still not right
say close DNA framework maybe I should
have named it DNA dot framework then
done the opposite and just change the
name space that's been a bit less work
so we have DNA
doc brain work and that should be a
touch now be a new solution in the
structure that I like and we have one
class of the minute and properties we
have done net standards that's fine so
let's just now go ahead and open our for
Seto would is for such a word sources
set that word and we want to reference
this one thing we'll have to do or not
have to do necessarily but well yeah we
will have to do it we want to update
these two to that one's already a dotnet
core standard so just a faceted I would
upgrade this to a four point seven point
one framework and click yes if you don't
have four point seven point one then you
can just go to Microsoft com4 slash net
for a slash download scroll down and
you'll see there's four point seven
point one developer buck download
install that and we start Visual Studio
and that will get you this I just make
sure this is on the latest framework for
merging with dotnet caused off there's
one other little issue that there's an
outstanding github request for have you
unload the first of the word project and
edit and then in this main group here AC
in a root namespace assembly name so
inside the project group before it
closes you
to add his restore there's no
intellisense for it
restore project style and that is happy
draft because I think and it's basically
an outstanding book even in the latest
source right now in the latest visual
studio if you don't do that then when
you build them it'll build but when
you're wrong and you're referencing a
dotnet standard 2.0 with certain
packages which is ones we'll be making
yourself it complains that it can't find
references so with that done right-click
and add existing project and we'll now
go to the DNA framework and we will
reference this as I mentioned this will
become a nougat package so you won't
necessarily reference this in Fassett I
would shortly we will at the moment but
then we will just be instead doing
manage nougat packages and adding you
know a nougat package to this once we
publish into the package so we have that
I was trying to filled now that looks
like it's complaining I think you just
need to restore yes it's built earlier
so now we have DNA framework we want to
reference it and here so add reference
project and include and now we have a
reference to the DNA framework so we
didn't do what we like with that as
let's just make sure this application
runs as well still I didn't tell it to
stop debugging but okay yeah so that
still runs it's open going so all we
really done there is upgraded this
package made a new project called DNA
dope framework if we go to properties
assembly names DNA type frame with
default namespace change to DNA and
you'll see why as we go some we get a
nice short namespace to make yourself as
let's get started with this stuff we
have control our G to remove that I
guess we'll start with
the first thing we mentioned as we want
to kind of have a whole system so that
the core entry point to this framework
that your application needs to start and
in there we will hook up dependency
injection and provided through a static
class and then everything else from that
link and can go from there and it'd all
be dependency injected so I'm going to
rename this class I'm gonna make it
static as well and we'll just call this
framework and you'll see why I've called
the namespace DNA now so when we got the
framework we can do DNA dot frameworks
and with technically reference in a
class so we can access things nice and
short so for that the main entry point
into the DNA rainwork library we will
start with public methods and we'll have
a public static void startup let's do
that for the minute this will be where
our application so our application here
where we enter the application setup
this is where we'll mail call
DNA dot framework start off and we will
set up the DNA
framework and then you can actually
remove DNA and include the namespace
then you get framework dot start up now
in this as well you'll see we'll have
something else there but could be called
the very start of your application we
can figure and set up the DNA framework
so first part here we need dependency
injection so I mentioned instead of n n
inject we're going to use the built in
max off one so on the DNA framework
project right click manage new the
packages and then in browse will do
Microsoft DOS tensions
I look at that okay maybe need a bit
more than that dependency injection and
then we want to install this once make
sure the exact name marks off dock stage
dependency injection that's all I was to
then use the built-in dependency
injection system if you will also every
name this plus to DNA or a nameless to
framework for other formats of last name
so in here now we will have some
services and this might be familiar from
the peseta word website where we make
use of the service collection that gets
chopped into the configure method so a
service collection there's a bunch of
dependencies and this is you know the
collection of those so I'll have a new
collection create a new list of
tendencies and there we go then we will
want ultimately create environment
details which we will come to and then
we will want to add configuration which
will do again after will kind of do it
in a better order them you know this so
the first thing in the framework as we
mentioned as we're gonna add login I'm
gonna use the built in stuff so we will
add log easy as default so to inject a
dependency you do services dot and then
out and you can add it to a specific
scope to a single turn or to be created
every single time so for the logger we
don't need to add specifically one of
these we can make use of again the
built-in logger that will give us an
extension so if we jump back to here and
we do marks off the extension dot
logging
and we install the login this will give
is the basic framework for login that's
built into again dotnet core and now we
could have services that logging which
we do to that we want to configure it so
we do this then we will add install
lager so we have the console while there
like in our current application so again
to do that it's a package everything is
very segmented so marks off to
extensions login dot console and you can
see below debug so we'll go ahead and
install debug as well because we'll make
use of the debugging one right after
that so with those two installed we've
now got add or shut off haven't yet I
guess I've console I think it just
intelligence control dot yeah then we
want to debug logger button to add a
debug to do we want to add file Locker
because the visaphone built-in believe
it or not so that's where we'll make her
own which will be fun
we want to do setup loggers from
Federation will talk about configuration
in it and then we also want which will
see again after the way that the
built-in lover works in dotnet is to
expect always expect a tag to be passed
in when you creating an instance of a
logger as kind of a category name but
that can be quite annoying in the way
that we want to access the log if we're
in a static method or a static class for
example there's nothing to pass in so
we'll fix that when we see it happen
I'll show you happen first then we'll
fix it so that's all we're gonna add
right now create dependency injection
add console in debug loggers and now we
will build the service provider which is
you can think of it as the similar to
the kernel in and inject it's the thing
that well actually find dependencies and
provide them to you so for that we will
need public properties and then for the
public properties we will have public
static and I service provider two things
in yep and this will be the provider and
then that will in fact we will have
 fields for that first so this
will be protected members and will have
protected that article and not protected
private yes you can't override it
private I probably study I service
provider service provider this is the
pendency injection service provider and
then that will publicly be accessible as
I gather
so we'll just return the service
provider and then we can copy laughter
II I'm saying name so now we have a
provider we need to actually get that so
in order to get a provider you basically
use a bunch of services and then you
compile it into a provider so so this
provider will equal the services dot
build and this is all the stuff that's
the asp.net core website does
automatically so that's why it does
configure services and passes in a
collection and then in the configure we
we can then get the iSeries provider
through injection so that's kind of this
is what asp.net does behind the scenes
that we're now doing manually so that we
can
have this ability in any application
whether it's a it appeared on my website
to dotnet framework or a dotnet console
you know anywhere basically so we have
the provider made and built so now we
can that we might as well log something
out so log of a start-up complete so to
do that now we want to be able to access
the logger which is now in well I say
it's in there it will be the yeah we've
got the provider so at that point we can
use the provider to get the logger which
is how you'd get anything so I have one
more public property and this will be an
eye logger can pull this logger again
this will get a private vacuum field
that will be I in fact over I don't need
to store it it's in the dependency
injection that will be provided get
service and we ilogger so gets the
default logger or the framework so the
logger has been adding through I log in
this is where you will see the error I'm
talking about those so if we were to do
this manually first and do the logger
equals this will fail so I'll put it
second but it's expecting is a category
name but you can't pass in a name it's a
generic so you have to pass in a type
and because we've right now we'll just
got static everything we can't really
pass anything so we'd have to pass in
just simply a type of anything so let's
just make a public class test I know
like a passing test and that'll be the
name of the log
and then we'll get that lager and then
from there you could do lock it up
log and you could write a critical
message the app helpers though to pass
all that information in so you could say
log critical and then all you have to do
is put a message so test message and
I'll build and run this and show you
that this will work this will simply get
a logger and this isn't creating it's
creating a new logger from the logger
factory which basically says just create
you know a logger and then the name of
where the you know this log is
associated with us gonna simply be tasks
so if we logged critical you can see
down here now you've got critical DNA
web so you've got the console and the
debug output showing and all that using
is the name of that class as the output
which is open in some situations where
you you know you want to create a logger
and effectively pass in some details
about the logger so you know it's come
from a certain class but what if we
simply like we mentioned here in a
static I wouldn't trade the the actual
issue as well if you just in a static
class or you don't want to give any
details it's just generic that we'll get
no so you can't get a log or without the
generic because there is none bound to
that so to fix the issue so we can
simply get a logger from anywhere
without specifying a class which will
still specify classes book just so we
don't have to so this would have
returned nor it will also bind a default
logger so that's what this to do is
about so to add to the services so we
get similar effects to this like add
logging it's like a nice extension
method to the services we're gonna do
the same thing for our logger so what we
want to do is make a new plus and we'll
call this framework extensions we will
get rid of the unused stuff well
for with static extension methods for
the DNA framework and in here because
the service is as a service collection
we all want a public static and then we
will obviously want to return an eye
service collection so I service
collection control dot and then we'll
call us add default blogger
I don't need this I see reflection being
passed in and that with services that's
a default logger so that we can guess I
water a non-generic I lager that well
have a that's a given name or DNA so all
we need to do to fix this is add a
default e lager services and then the
locker should be created in destroyed
every time it requests it that's the
natural way of doing it you don't want
to keep it in memory so we just simply
other transients which means every
single time you create a transient it
will be a new instance of the class that
you created
so for that will have other transients
and we can use the provider don't get
service which is the dependency
injection as you did before so that's
where we can get now the I log factory
need to create a file I log a factory
roller and that's the factory added by
add logging in here and the factory is
responsible for creating loggers so you
can read all about this off of add a
link in the video on you know how its
but a factory you know creates loggers
and the loggers then log out messages so
we want the factory the default factory
that we've added and from now we can now
create a logger so we want to create a
logger and now we can provide a string
name instead of a time so in here we'll
just say DNA so now we've got a logger
for which we'll return just an ilogger
this is not a specific target passed in
a string and we will simply pass that
into the add transient so this is now
binding the type I lager because that's
what this is returning to this specific
lager that we've just created so by
doing that we can now just call provided
on get service I lager and it will
return a copy of this you know run that
exact thing over and over you will to
keep creating a lot of that type and
then we return these services so then we
should be able to do dot add default
logger now in PSO services dot ID
default logger so you can see now it
looks the same as how services get set
up in UML and dotnet core with the EU
extend your methods and and do add and
then something so it just looks clean
like services dot add default lager
just looks like a nice way it's not
without the default lager which now
means our lager which is des method here
so basically provided I'll get service
our lager which originally returned or
should not be nor so if we just run that
to check we should now get the lager
with the DNA as the category name so you
can see we now got a lager and DNA so we
have logger info DNA console logger and
debug logger so it's actually however
many logs you have you get them all
baked inside there so now we have a
default logger
as we mentioned let's finally log out
some output so
we will have the lager door and all do
log I wouldn't say it's trace its kind
of informative so it's not warming it's
not really info it's a bit much but like
as info for now you can always change
that DNA framework started and we do
that and run we should now actually
there with your DNA framework started
and DNA is the category name information
as the level as we don't log level of
information and then finally the message
so we'll get in there with that what
else does our mat to do so we have
something that'll be useful throughout
obviously any application is information
about the environment so to do that we
need to create a new class and we will
in fact that's making you a folder
environment and let's make a new plus
and we'll call this framework
environment and then in this class
ecology to remove public class framework
environment detail open defaults details
about the joint system and viral image
and we will have public properties one
of the first ones is are we in
development mode as a weak useful turn
out true if we are in development
environment and then we'll have a string
that's useful call configuration so I
don't think there's a way to directly
get these configuration pieces of
information because they're simply there
in Visual Studio they're not in your
compiled code so the trick to doing that
is we will rely upon this value which
will be set in your CIO in a minute but
from that we'll return if when
development will say development
otherwise we'll say production and I use
those two names because this is what
asp.net core seems to do in its hosting
environment so I'm going to simply
follow those two it plays nicely when
used in that environment as well as this
will be the figuration of the
environment either development or
production and then from that we will
have instructor default constructor
and in here now this is the way we're
going to simply tell which one we're in
just use a compile time directive so if
debug then this development is true and
that's it otherwise by default and
reading and if by default a boolean is
false so we don't need to set that we
simply say that we have a debug flag so
you can set a debug flag or you can do
the opposite which is a release which
again if you notice with the if you take
a look at our for set a word web server
it seems to do the opposite easy
presumes you're in debug and it will
only flag so we set that to true by
default and then we have a flag called
release we'll set it to false and again
this seems to be the natural way that
asp.net core does it it makes
presumption that were always in debug
environment development environment
unless we say were in release so how do
we get this to set to false well if we
change this to release you'll see is
still highlighted out so if you
right-click on such a word and do
properties and go to build and then in
this conditional compilation symbol so
we type release and save you'll now see
what you should do this would go to
showing that we're in release I think
that's just a visual studio not updating
it close and reopen ok we're in a minute
so I'm pretty sure that's gonna work I
think this is a bug in I presume it's a
book and visual studio I'm not showing
that so we'll we'll be able to prove
that if we carry on and I'll show you in
a minute the output so that would only
basically the code in here would only
run at compile time when we compile the
project it would only run if it gets a
release flag and just a double check oh
I know why it's not showing it's because
it we're not running this specific one
we're running for SATA would first
afterwards got the tag so until we
compile and run it through this that
directive I don't think will apply down
but it should apply down once it's
compiled as a whole so long story short
let's make use of that tag now with some
environment details so we also inject
the environment so first you want for
environment because only used to use
this environment will need to use this
in here and we're configuring loggers
and Jason things in a minute you'll see
it so I'll keep a reference to it here
make a new copy of framework environment
which must have had the wrong name space
yep
clean the name space make a new
environment and that should be all we
need to do because vehement rather on
meant to there we go
environmentally yeah
looks wrong now I'm staring at it so
that's the environment so if we were to
simply get the environment and in the
locker here say started in and then log
out and we log out our environment dot
is diva or environment or configuration
so it should say development or
production and again that we're not
using the provider to get the
environment here because we are in I
mean we could do were there
so in fact we could do but because I
want to use up here before we compile so
that the services themselves I want to
make use of that environment valuable we
need to keep a reference to it here so
you can see it says development and you
see outputs development so if we were to
change to release who am able to debug
but we should still see the output we
have like minimal debugging so we should
be able to see the output at least so
continually bug in and and there you can
see if we scroll back up framework
starts in production so it successfully
set that boolean value to the correct
value based on the fact that we went
into release there and that adds the
value here when you go to release so
that's what's then triggering there the
hash if in the constructor of here it's
a lot get set and that's all we're doing
to detective with development or
adoption and that's the only thing we do
so when you then compile to release
obviously it's baked into the codes
there's nothing else you have to do it's
it's the hard define that encode that
you in develop in a production
environment so we can now detect the
environment one thing we want to do is
as well as obviously was setting up our
services the whole point of dependency
injection is that somebody else can set
up services so in order to do that let's
allow an optional action to be passed in
a Charles I configuration
in fact we will need services under the
services can be added before it can be
added after rather it's more about
configuration so no let's do that one
after let's see so configuration there
so a configuration is in general just a
bunch of key value pairs ultimately but
again this configuration baked into
dotnet cool and you'll see it used a lot
like in the locker that the logger
itself's got baked in it can have a
configuration so we go to here and do
Microsoft extensions don't login doc
configuration and install this I think
that's install that was quick one
thought and then in now in options we
can do add configuration and you can see
it's expecting a configuration so this
configuration can come from anywhere it
can come from hold Cody classes it can
come from JSON files and come from the
environment so it's like a universal way
to configure anything in your
application any little class or any
setup so a configuration is simply the
when you do add configuration you can
pass in a configuration but these
configurations come from an actual a
configuration that you make so in order
to pass in a configuration here we need
to actually make it so in order to make
the configuration so we will now create
shall we say create our and Federation
sources I guess when this will be
figuration builder as a new
configuration builder and obviously I
haven't installed that oh I have oh I
think that in package got installed with
the fact that I've just installed there
hope I didn't just install our package
no no I installed the login
configuration package but that must have
been reliant on the configuration
package so it's because I've done it in
that order this has got installed so let
me install this explicitly
well just to be sure that if we are
installed login we still have the
configuration in general so there's
still a max of the extensions
configuration as well it's not a god of
configuration builder so you make a new
configuration builder and that we do got
add and this is where you start adding
your providers so this I'm going to do
two providers right now one simply going
to be the environment variables which is
the variables on your computer like the
path the home all of the things that are
in your environment variables on your
machine so again to do that
another package which will be
configuration dot right there
environment variables marks off the
extensions configuration environment
variables install that accept and again
all these packages come by default in
asp.net call that's why you don't need
to keep installed in them we're going
from a standard library with nothing and
making them off so that one here we have
what does it just install environment
variable as its and now with the
configuration option which you'll be
able to do add environment variables and
we'll leave it to that for a minute then
as I mentioned the caller might want to
add something to your configuration as
well so to do that we will pass in an
optional option and that will be
expecting the configuration builder so
you can make use of it and that can be
configure by default we won't ask for
you though and then they've got the
option to call and then in order to
invoke that we can say that's custom
configuration happen and we just say
configure question mark not invoke so
basically if they provide it then pass
in our configuration builder and that's
what would you eat we're just literally
passing in the Builder at this point in
our code so this caller can do whatever
he likes at this point with the Builder
before we move on to you know adding
services because they might want to
configure something and then when we add
our services once we're finished
there's no point tapping passing in the
services so because they can add well in
fact the risk I'm saying there isn't we
can add another function here for allow
custom service injection and this will
be again will have another function now
another action I service provider well
shall we say this is services no don't
really go call injection I guess then we
will need to comment on them the option
to add custom configuration to the
configuration builder the option to
inject services into the service
provider or service collection so that's
that then we'll do the same here so
injection question mark got invoke
services and we simply pass the services
and they can do what they like with the
services or not
so if collection helps if you pass in a
nice service collection not a provider
so we invoke custom services and again
we're not making you something right now
but you'll see them used in the future
so we've got the configuration and we do
the custom configuration and now once we
have a configuration we built well got
the builder here the application needs
to access that to you know do anything
with it so we can either inject the
configuration into the provider which I
guess we might as well do and then
provide it so we'll have a public static
I configuration and say configuration
and this will return provided I'll get
serviced by configuration gets the
configuration for the framework and
relevant so then we just need to add
that now so we have the configuration we
do the stuff there and then we do
services dot add and again we could do
you know I add logging in that but
because this is a direct one will show
you the other way by the singleton just
one instance and what pass in the actual
configuration so the configuration
builder dot build and that will return
as you see an eye configuration root
which is castable to an eye
configuration so now we will inject
configuration into the services we will
group this as well so I'll do a region
initialize environment we will also
inject did we inject the environment
well provided the environment yet oh
that I think that's what we're in the
middle off we also need to inject that
so that's really the setup this will be
environment we forget in the end then
quickly moment details inject into
services and this will just be again
services what's this keep complaining
about services got add singleton again
and this will be the instance of the
environment itself so that will be
accessible by doing services service
about don't get framework environment so
let's add that here public static
and work environment right get serviced
give it a name get service of brain
working man
yes the framework environment of this
I've this application alice us it's of
this framework of this class I could
probably do better with these comments
I'll do open up so all of these are
accessing the provider and then there's
the provider itself so these are like
shortcuts to effectively getting the
injected dependencies so that's all
we're doing here so you can do DNA train
work dot environment DNA type framework
logger shorthand ways to access the you
know the underlying things that we've
injected so we get their services we
made them the environment we create and
then inject as a singleton then we have
configuration so then we'll wrap that in
configuration we got the configuration
build it invoked it and inject it let's
let them know we then have login which
was the whole point of this initial
video if you will that kind of end there
so we add the default dotnet core logger
we're gonna do it a lot to do here
we have the console the debug so now in
fact we didn't finished in the
configuration we did a little bit but
I'll break point and show you the
environment actually at this point so
let's just run and I'll show you what
this configuration does that you can
then use the configuration to at least
see the environment variables as the
first step so we get to here if we now
hover over environment and of course
intelligence doesn't like doing that so
let's just at least call
I guess we've actually got to compile
the services though to get the services
so maybe if your break point here we can
hover over so you can't use dependency
injection until you've actually compiled
the services until that point they're
not accessible so we've got
configurations log in and that point
it's probably it's probably wise there
to pass in our configuration which is
the only other thing which then would
mean yeah because it's the order isn't
it
so actually we then have in that
configuration equals that is our
variable an injector here we should
provide that configuration just in case
our services want to make use of that in
their you know a bit of code so that
will be a configuration so that we're
going now they've at least got access
Tula so after that flat once it's
compiled and everything's up and ready
in the service providers there we should
be able to see the configuration through
injection or not are we interesting and
does our configuration have stuff yeah
so do why did that not work
whole configuration worked because we've
added the configuration just as directly
as a configuration so we need to specify
that some configuration
otherwise it'll get added as the native
type which is a configuration route so
let's try that again now the
configuration is now accessible through
dependency injection so in the
configuration you'll now see this one
provider and it is an environment
variables from figuration provider and
in there we have data and you can see
all of my
paths and information to my computer
hopefully there's nothing sensitive in
there but that's all you know all the
information you can now get that's come
from the environment so that's one of
the configuration options of your waking
get your information from the other
option is so add and by Ron meant
variables we also want to add app
settings JSON files and this is again
following in the asp.net cause
methodology if you will they are by
default an app settings JSON file that
you'll see in the the website and that
is then loaded into the configuration so
anywhere in the application you can make
use of it so we're just gonna again
implement that ourself while not
nationally implement just simply copy
the same behavior so to do that we want
something called adjacent
something-or-other so that's always
called but there we go
Microsoft extensions configuration doc
Jason so we install this package and
don't worry about installing all these
packages these are all baked into dotnet
course not that we're installing
external dependencies by any means
because I know and I'm sure you guys all
know I I like to have as little
dependencies as possible this is all
these are all baked into dotnet core
framework so it's kind of like you using
them anyway they simply not included by
default in a standard library just have
to add the ones you want so there's no
real issues here the dependencies these
are all baked into what we use in anyway
so it's if you're getting stuff that
isn't in the Microsoft you know the
dotnet supply of your well the dotnet
core so now with that package added
there you're adjacent file so the side
Jason files just after a path we can
make it relative so to make it relative
first outer path will say app settings
group app settings Jason
and we've got an overload optional so to
make it clear let's just say optional
we'll make this optional I don't really
care people provide it on our and we
want to reload on the reload on change
trip so we want that to if the physical
file changes for it to reload add
application settings JSON file on top of
that again asp.net core has another app
dot JSON file which makes use of and
this boils down to why I made my
environment say these exact words
because asp.net core does it so we're
following in suit again just for
compatibility mainly what they do is
have another file that's based on the
environment read so development or
production and it expects a file called
app settings dot and then the
environment name dot jason so app
settings dot development like jason
would only be settings for when you're
in debug mode of you will so for that we
can make yourself the environment doc
figuration which we've yeah that's fine
as a name so this will inject app
settings dot development jason in this
instance but in order for these to be
relative paths we need to do dot set
base path so we knows where we're coming
from and he'll do directory
don't forget current directory so
wherever the applications been executed
from so not necessarily set base path or
basement files as the traffic location
of the application now this isn't the
folder to necessarily this framework
because you can't run this framework
it's a it's a dll it's a library it
needs to be included and run by
obviously an application so the
application is going to be facetted
awkward so the gecko in directory will
be the output path of the facetted
awkward exe and then it's going to look
for app settings Jason to load in and
then once we do that it will have some
settings from there as well so once
we're down here we can do
the breakpoint again so right now
optional or we change options are false
we should then get it to crash because
it can't find this file and then we'll
go ahead and make a file and get it so
that we can you know prove that it's
found basically so if we get the
figuration file is not found you can see
where it's looking so that's correct
it's now looking for a file there so
let's go ahead and create that
so in the facetted word do add a new
item and then I think they've got a JSON
file do a JSON file and we'll call it
app settings Jason and where's my mouse
go come on up stereo so here's a blank
JSON file so let's add what would be the
configuration for the built-in logging
because that's what we're doing in this
video so we have a login and inside that
we have include scopes like this and
that put false and the log level so the
level at which we want to start
outputting a default level we don't want
to output warnings or above warning you
think is so this is a structure and I'll
provide a link in the video to where you
read up on the built-in logger so you
know you know what values go in here
what you can do with this configuration
browser says then we can add our own
configurations you know my settings and
then you can have whatever values in
here and then in your own projects and
own parts of this as we build at all you
can make use of the settings from a
settings file that the user can change
and you can also get it from any other
source you can pass it in through the
environment variables and then that's
where this configuration starts being
useful because you can provide the same
thing when you're saying services don't
get configuration and then you simply
get some details like you want to know
the
st. connection string to an SQL database
that could come from the app settings it
could come from hard-coded it could be
passed in through the environment
valuables and they're all merge together
and take presidents and you know merge
in so your your application the thing
doing the SQL connection doesn't need to
be concerned about where that
connections coming from it can come from
any one of a lease so again we'll make
use of this in future videos but in
essence you can see it's it's just
providing it's a configuration provider
that simply provides a bunch of values
so we have that file and it's not
optional so it'll have to find it so if
we run it now it should find that file
it shouldn't crash this time because the
file is there and exists and it still
crashes oh you Heine why because we're
not on a web application where content
automatically goes to the output folder
or can be found so we want to copy a
viewer basically in there and this means
that lehenga output it to the bin folder
so they would compile get that if we now
hover over configuration we should see
1/3 1/3 and now we have or rather two
more
you got the Jaison provider for the app
settings Jason and you've got one which
I presume should be app settings of
development that Jason so there you go
it's trying to find the two in there's a
file provider which is the JSON file
provider and so from this now you can
see this file has then included login
include scopes login log level default
so the values are in there to be
accessible if your application wants to
access the configurations directly
there's multiple ways one of them is
through configuration get section and we
can say get the section called login in
the configuration and then say let's do
get children I just get all the inner
parts just do like that so this is what
the code inside the logger will do if
there's a configuration it'll say try
and get me the login section and get the
children and then there we can see we
have include scopes and we've got the
log level and then there's no value
because you have to get the children
which is
got the default log level so it's just a
really quick overview of of what
configurations are and again but they'll
be used heavily going forward so you'll
you'll see how they use to make more use
of them so now we've got the environment
the configurations in there we can now
set up the logger to use the
configurations and again because we're
using the built-in logger it's already
supports it so we just do options dot
add configuration and that should be it
I think is actually after the
configuration though so we can just
provide it through either configuration
don't get section which is well in fact
that's what we'll have to do because
there's a configuration do yeah
figuration dot get section like we just
served logging and that's all it's after
it's after the specific section it
doesn't care about the internals because
it's expecting effectively at this in a
detail so you can technically call this
whatever you like but again asp.net
calls it login so we'll stick with that
name
so now we have a configuration for the
login so the logger should now start
listening to our settings so we've run
this and we step to here we should get a
log output which I don't see yet maybe
of a running it'll show up yeah there we
go so information no that's our other
logger we have oh I know why that's it
shows it's working we've said to log
only warnings or errors basically
anything above a warning and we're
logging information so we log critical
which is the most vital messages should
always get out port unless you're sane
to not output anything we should now get
the logout button say go log critical so
you can tell that that is now reading
the configuration correctly and then
just to really prove it have ult test it
so open up settings and do nan as the
value of a log level so now you
shouldn't even print out the critical
which you can see nothing's printed out
and then - I guess quickly test the app
settings development one if we do copy
and paste do app settings dot
development Jason these I don't think
can you drag that in no so you can't get
up behavior like you do on the web these
settings will accumulate and combine if
you will so they don't override each
other unless you've got the same value
then they will override so in the
development environment let's set it to
what let's leave it as warning I guess
or let's forcefully set it to which way
shall we do this now let's do do go
around let's do production so in the
production environment let's change it
to non so when we run now through our
break point we've run this in debug and
we should get the output critical we run
it through release and it should read
the app settings drop production Jason
where we told it to not output anything
and we should not see DNA framework
started output so nothing there and then
again to double check change that back
to warning say and change the default to
non so by default we wouldn't have put
anywhere but then in production we
output so we kind of flip the logic of
it and they can see now we get the
output of logging out and if we change
back to debug because it won't then read
production as warning the default will
be none so we shouldn't get an output
this time so you can use it as basically
loading there you have no output that's
loading the configuration so for now I
don't really care about custom you know
differences in debug versus standard and
I'll change this back to
warning I will in fact if we find the
fundamentals logging thespian a cool I
think this is it
so this is the page I'm on about that
I'll give you you can see he is the way
that asp.net core does it very similar
to what we've just done
apart from they require it's optional as
well so doing very similar like say to
the kind of setup that net the asp.net
does by default what I'm looking for and
here though is the log level so you can
read through this I'll put the list in
we get log level so here's the options
we can have some non is optionally
non-critical debug.trace I thinks
everything so I think that's the lowest
one we can in fact I don't know why I'm
doing that the the easiest way is to
just type log level so log level press
f12 tada
there's the you know so it's order of
priority so known as austere high so
it's anything with a higher number than
that which is nothing would get logged
so we do trace that means it will log
out for him so I'm gonna set the default
logger right now to log out with him
with trace and I'll provide the link to
that read up on the logger if you want
to read more about it so now we should
log everything by default in our
application we've got the configuration
set up the environment all done
initialized on login right file locker
we've got to do so it's just finish
wrapping this off custom injection so
region services or custom services
and building
I guess so they'll go that's all that
bit done so this is for the most part
don't if you will
we've got the the framework ready up and
running we have an environment we have
the basic setup and now we have a
provider that can replace an inject so
the last step I want to do in this video
and unfortunately move to the work
actually is is let's make a file logger
so where do we go to get that started
and let's start with a folder this would
be logging I guess and here we'll do
file right so the way the logger works
and have to think this through which is
a lot of classes we have a log provider
I think is the first stage or I'll have
a file logger provider clean up that get
rid of the surplus namespace we have
public class followed right after
overriding I log provider mmm no hi
logger provider people game everything's
a logger control dot to and from at the
interface right so we have to comment
this provides the ability to log to file
logger provider implementation
so we have creating lager so as I
mentioned this lager is responsible for
actually producing lagers of this
specific type so the you know a file log
longer provider so that's how we'll
generate our lager this thing spits out
you know whatever lager is freaking out
more than what you can be logged into
seven files so the responsibility of
this provider is to when the log system
itself the log factory wants to get a
log a file logger the factory ask the
provider to generate a logger so there's
the I log factory for I love a factory
the talk to the ilogger provide as the
islet providers generate the I'll August
so it's again you can read all this up
on that link so the first step is really
the provider for us a custom provider so
this will be protected members because
we'll need some and we'll start with a
protect deed read-only one thing you
want to do with all your loggers is have
a configuration so we will make another
file and over in the middle of this one
block this will be file logger
configuration let's get the simple stuff
out of the way first
RG to remove public class by OOP did not
name that file correctly for the class
followed inauguration the configuration
for a and we don't have it yet but it
will be cold file log to the power log
configuration will have public
properties that learning of our
properties but the still meter region
you never know public log level so don't
really need to configure much so I'll
just make a log level and yes and the
default one will do again this trace for
log everything out
the level of log should be for atm
well that should be processed lasse
let's do one more because our original
logger which is here we log the time so
that's also passing a long time so
rather if we want to lock the time just
well being it a long time again by
default will say trip whether to love
the time or not go in for a good time as
part of the message so that's just a set
of options for any file logger that we
want to create so the the log level and
then simply log time so that's made now
what's done we can get back to the
provider
so whenever the provider is created
because this needs to spit out a bunch
of log as it needs to have that
configuration in order to know what
configuration to use for the loggers so
we have a file lot of configuration and
this will be the configuration
configuration to use when creating
loggers and we will also have a
protected read-only we want to keep a
list of all the loggers we've already
created so that when in fact oh yeah
when we do create logger we don't want
to keep recreating the same logger if
the path is the same if you will or the
category names the same it depends on
how we you know we do this so if we do a
concurrent dictionary to keep it thread
safe and we'll have a string which will
be the path and we'll have
if I'm a massive change if you think so
people that'll do for now
you'll have the Apple file logger which
we also haven't got yet so jumping the
gun slightly let's make file logger
class clean off remove the additional
public class file logo will implement a
logger which is the final step a logger
that rocks the log file and implement
that interface might as well quickly
write as begins go we're not gonna scope
this it's right into file so we don't
need a scope as enabled we'll deal with
in a minute and yeah okay screw that
we'll come back to that so we have
loggers make a new list or to keep track
of a lot of the already created
keeps track of the loggers already
created okay so in dispose all's we need
to do is clear the list and in create
loggers we have Kathy we name for now
we'll just do based on category name but
I will likely change this to in fact now
it's probably right based on Kathy we
name we have a logger because the logger
can notify yeah that's actually fine so
do em loggers don't get or add as a
useful function here so it'll either
return the logger for that key if not
then it will create one which is that
way around so it always creates a new
one so that will be named you file
logger and then name and figuration so
yet we don't have a path here I will
figure that one out after and now we can
yeah we don't went past that in yet in
fact this way we want the path we're all
gonna get the path from I mean it's
gonna have to come through the
configuration for the logger yeah we're
gonna change this I'm not sure yet
we'll probably reverse backwards to
figure this one out but the the logger
will expect as you can see here it's
baked into the provider you meant to
provide a logger per category that's
kind of how this works it's hard baked
in
but the issue we have is the file logger
is login perv file we really want the
file logger if we can to be writing and
be the only thing right into a file at a
time so I think what we're gonna have to
do is they'll be multiple instances of a
file logger and each file logger will
log to the same file based on the
configuration because the configuration
is what will be passed in a fog logger
how about to fall August
Oh cuz that's the other file logger we
make called exactly the same it's
getting confused there yeah so we just
have a little think on this file
lockers scoped so this as always no
comment
the isn't able to come back to again
back to the provider so creates a file
vlogger based on the category name the
specific or the category name of this
logger get or create the logger tourist
category so that's gonna work file
logger
so the logger is going to need the
configuration passed in each time as a
variable the configuration then that's
gonna be added when we do add file we'll
need to have the path we know that much
now so this will be public string file
path a path - right - so we have the
logger let's also go ahead and add yet
another plus and this will be file
logger extensions and I start working
this backwards so we can kind of go from
what we wanted to do and want it to look
like to what it really does so
abstention methods for the file logger
and then this will have just like the
other ones public static and this time
it's gonna be I I things I login for
once builder yep
whom this will be a viable court will
want I logging builder builder and we
also expect a path with white a log to
as a new file logger to the specific
path the log builder to add to a path
where to write to
so this will want to add a file provider
which is what we should be adding file
log provider to builder that said in
fact is making a lot more sense doing
this way around now so I can visualize
it so we do add provider to add a new
logger
this isn't asking for a logger provider
so we'll pass in a new file logger
provider which now makes sense so now
what we clearly need here is to pass in
the path which is the only thing we
really care about so we know now that
finished that we turn the Builder the
file log of provider will want a
constructor so that will be here default
constructor the path the log - there we
are and now this wants to be in whether
the configuration gets set it doesn't so
the configuration can be passed in to
the add file I guess and if not then we
can use a default one and again we'll
take this probably not in this video but
we'll update this to pull in from the
configuration sources like we you know
from the file sources and things
above for now I'm not gonna bother for
the moment if I like refrigeration
Eurasian controls new and we'll just
make a default one can you do that
compile-time constant okay so instead of
that will do no pass then create default
in Federation if not provided and will
create a new configuration and if we
wanted to configure it with its set at
the log level and whether it's a long
time but we'll leave all that as default
so we'll just literally create one then
we'll add the provider will now update
the configuration path in fact do we
need to set the path in there because
we're passing it in to the provider so
no we don't the configuration doesn't
need the file path in and you can't even
make sense again if you configuring it
in the past there so the pastor and log
provider then wants to have the
configuration passed in I'd say so now
the file log of provider and have file
logger configuration and that will now
finally boil down to the configuration
beam set and we have the path so we need
to also store the path there we go
starting to come together now
the configuration to use sorry passing
the configuration the path from if we
jump back off we add a file you want it
to be the path you go to and set
configuration of the configuration is
null you set it then you pass the pup
and the configuration so that should be
our add file function done it's all
commented so let's step back up further
and let's get us actually added start
being the framework login now the final
to do in here add the file logger so now
if you love options got add file which
is our function which is now expecting a
path so let's do and this is the the
thing with until we have the
configuration we won't have the base
path that's in this configuration that
we set here so we'll make use that the
configuration but like I say probably
not in this video just because the time
will split that off and we'll we'll make
use of that in the next one so for now
we'll just say log txt and we'll get it
right locally anyway by default and just
ignore the base path and do that in the
next video so we've got that and then
it's expecting a configuration that we
leave as null so now it's as easy as
saying add a logger to log and we can
also add and we might as well just prove
that this is multiple you know to logs
so gets logged to the same place so
we've got this this is Dawne this is
fine so this boils down to the log
provider extensions which then basically
had to provide a file logger provider
which has now got the path in the
configuration that's that done the
provider gets the information and sets
it in there and when it's implemented it
will now be expected to create a logger
based on the category name and clear the
list when done
so that is now complaining because the
file logger so now when we make a file
logger it needs to know the category
name because that's specific to each
logger so that will be the category name
and always that was passed in oh yeah
that was passed in there so the
cafeteria lien will get passed in so
this is the category name here it's just
that when it gets created it'll be
passed through this expression and it
will need the configuration it will also
need the path so we'll need the name
path the configuration so now if we go
to the file logger the functions are
there we'll have constructor and it will
have string cuts go in a string file
path and file logger configuration will
name them category the configuration to
use a file path to write to store them
all in protected members
taxied string category name category to
write category for this logger kept each
string file path file tough to write to
each string john contacted a in a long
day the configuration to use there we go
settle those set properties or set
numbers nearly there come on right so
instructor gets the information needs
the loggernet gets created we don't use
a scope enable the day of the log level
is the same or greater than the
Federation the log level check against
so this is basically saying if we log a
critical message or if we log a warning
message using log warning then this will
come in as log warning and as we know
from here you can clearly see it's going
in order of president so if we say we
want to log warnings we'd expect to log
warnings errors critical and obviously
noms nothing so anything below that if
we say you want to log trace which is
like everything you'd expect everything
here so quite simply the check is to say
of the log level is you know they're all
greater than if you will so it's
anything above it so will be enabled if
the log level of the message that it's
checking against is equal to or greater
than the configurations log level wise
that not got it
I'll put them wrong here Oh on a string
I don't do a string and why did that not
complain unless he did and I wasn't
leaving looking so configuration log
level so there are hot you can play in
about now I'll go in lumber two boolean
returned blood levels great thinks it's
a Londoner that's not what I'm after has
not what I'm doing
oh yeah in doubt let's get a long day
I've done equals greater greater than or
equal to right so that will be enabled
enabled if the log level is greater or
equal so what we want to log and then
it's finally going to boil down to
actually log in the message of the
message file the details of the message
the log level a ID the of the t-state is
a type of state the type of the details
of the message state says the details of
the message any exception the log and
the former or matter or converting the
state exception to a message string
right then so from here first thing we
need to do is make sure we should lock
if we should not log so if not
is enabled the log level of this message
then we turn that's just making sure we
should log because we want to clone our
file logger in the behavior we can kind
of copy our log for the most part get
the current date time prepend the time
to the log of desired so here now the
law of time that come from configuration
dot if we should lock the time if we
want to lock the time then the string
that we prepend has the time so this is
the same as our other logger and now
this is the difference right the message
so the message equals and then it's
going to be the time log string the
message who don't have right now and
then a new line and then all Lister file
which you don't care about we also don't
need to do a new line in this case in
fact we will have to as we write into a
file so we'll get the message and then
we will do file dot write or append all
text the path is the N file path
contents is message and then we'll also
have to lock this because we could have
multiple so what we will have is a
static lock for the file logger so we
can do protected starts think I protect
you I keep again protected static and
current
dictionary of strings and jet but we do
we just do it an async a way to lock hmm
debatable because we don't actually need
any info and we're going to dispose off
so we'd actually couldn't dictionary it
up in current ice cream bag just a thing
yep so he use it in current bag sounds
awesome
this is just a thread safe list
basically then why they don't call it an
current list each got in current back
I presume that'll have all we need so
this will be file locks and less a
checker that is go before we comment and
let's try and actually lock so we will
do a I think the door locks there's no
async here she's good so it would be
lock and firelocks
let's see what we've got on here try
peek try take trend up that's no Oh what
don't want a concurrent bag and current
cue can come in stock I want to start
don't you I think maybe they don't do it
I will have to use user can current
dictionary just for the sake of trying
to do that or we just drop back down to
our list of Oh what am I saying
we've got anything - wait - already we
can make use of a neat single waiter
wide you know there's not that either
I don't know might know let me think so
I think we do need to ditch for me
because we need the object to lock so I
was right in the first place I think I'm
going to comment on face confident on
this a list of file
laughs based on path now the only thing
here is have you added a path which is
the same but ones relative ones absolute
or ones in a different format so we'd
have to fully normalize standardized and
gap solute path and blah blah blah so I
think we'll do that anyway as enable
this dawn message here for now just to
stop this moaning about message output
message equals nothing now to do right
so the where did that go
come on keyboard what's going up right
so what we need here then back to the
original one is file lock dot get or add
I think so that will safely get an
object so this will be brought by a lock
equals and then we call that we need to
normalize them absolute the path so to
normalize we'll just duplicate it and to
get the absolute path normalized path
equals the and file path dot to offer to
normalize it dot in fact never do it the
other way around
absolutely absolutely around the half
don't we get full path so that will
resolve based on the
well that the other will resolve it to
an absolute path based on the current
environment so because we're not making
use of that base path right now I will
make a note of to do make use of
Federation base path but for now Ambala
so that will resolve it to an absolute
zero and then we'll do to upper which is
fine for our normalization so finally we
have a normalized path that should be
the same for any single specific file we
want to lock based on that and if we
don't have it then we will expect to be
we don't really care just a new object
so there isn't one just create a new
object so I think get the I'll lock
based on the absolute path there's a lot
of thinking going on here whether it's
working or not so I finally get the lock
and I will just simply do a lock on the
file lock so I believe and I'm not even
gonna bother testing nothing Li but you
guys I think this will be let's see
presume in that nothing outside of our
applications got that far lot which I
don't really care about right now and
then finally write the message to the
file again we'll add some kind of rap
but I say well add some wrapping
unlocking this as the log of the log of
trashes I'm not sure where we'll throw
the message to but we will add that into
this system as we go anyway so we've got
the file so now it's the message so this
boils down to you might say here where
the hell's the message while the message
is actually in the state and that is
because you can pass in a number of
arguments and the formatters then
responsible for trying to format that
message so we cannot basically custom
formatted Massachusetts is what happens
so I'll kind of explain that afterwards
but for now the default way to get the
message is just to do formatter and then
pass in the state and pass in the
exception
provided and get the formatted message
string so by default that will come out
as the message then we're going to edit
that to add our our other thing that we
have in our existing logger that we also
want to maintain somewhere which is the
lovely ability of having this
information in so where the origin was
so we want to maintain that on ours
which we will so at first let's just get
this thing logging to file with time I
guess at least which is an option so we
have a file logger it all is roughly in
there should boil down to get into here
that passes through so I think we're in
a fairly good position now to maybe run
this thing dare we add debugger so add
logger let's start with one longer less
plate a bit safe and let's see here as
press f5 let's see what happens
and that's not a good start there's oh
so because we pulled out his file logger
but you need to keep the original file
logger in our application set to the old
one for now until we fully replace it oh
that's a very good start so we're at
least in the file log a log message
should we log apparently yes current
time is now logs
time string should be the same so it's
the time now the formatter which is the
funny thing where you'll say it's just
got this weird list will basically boil
back down to the message we set to log
so the output message which should stay
the same is now looking like what we
originally wanted to output with the
exception of we don't have the call of
information yet which will add back in
the file path is hopefully log so let's
see where this results do so this will
resolve to our output folder which is
good that's kind of where we want to be
at least for now
so we will be in bin-debug this
apparently already a log file has I
worked out because our logger it already
logs to a file we've called that exact
same things let me just stop this a
minute our existing file logger that we
made logs to log txt so the cool one is
old logger now or old log so we just
delete open folder then debug log let's
give it to that log so now the old
loggers is not called old log locate an
old log but this one now should create a
log that's gonna go to log ooh
that's a point we should actually use
normalized path for that as where I
don't stop it once more we get all the
way into here we know we do now and then
we should log to the file so we have
nothing right now and then we write and
we have log txt in capital letters so we
don't want to you want to have the log
in capital letters but there's the file
so that worked so let's just do the old
path first get absolute path a and file
path can we do that in fact we could do
that could do that when we construct it
because you get the path so
normalize it there or other absolute
Pathak there then said that and then in
here we can make use of the original and
only in here do we care about the
normalized path provide yeah there we go
so now that will have a lowercase name
and we unhook that don't care about that
now and we watch here we should end up
with a log txt file in the original name
that we didn't put a breakpoint in there
there we go so now we will log dot txt
that says it's starting now we need and
about where's the time there's notice
that didn't have the time and I swear
lots did have the time
oh I've loved the message not the output
which includes our extra stuff the
message as the original log message so
we should get up and run in and the log
now has that with no new line because
why did I forget something else no ok
that should have a new line why are we
not getting new lines that one did maybe
we delete start again
first message so there's a new line okay
second message maybe just when oh when
he originally did the first law I didn't
have that I am outputted the wrong
things there was no new line ready there
we go so that's the logger 90% done back
to effectively where we were or baked
into this core library so the last thing
here now is to add the caller member
info here so we can log that so this
will be not massive amount of work so
I'll show you how to do with a custom
formatter
so we'll start with a general plus in
the log in not inside the file and just
pull this logger extensions lyses
extensions in general remove all the
crap again public static class
distinctions for a logger expand a
namespace in the sanctions for ilogger
loggers in here or rather let's show you
what happens first framework so this log
critical a press f12 is filling up
they've got one called logger extensions
so are we and the in fact that we'll see
if it works I think it will think of
merging so all they've done is
overwritten
a bunch of things to pass in default
stuff I don't need to go this detail
again this is something you can go into
on the actual dotnet core logger
documentation but these are shortcuts to
log messages with critical debug.error
information trace on warning levels so
all you want to do I'll only do one in
this video then I'll do the rest offline
otherwise we'll be bored of me doing all
of these all over again but the thing we
need when you you need to get this call
of information at the point of right in
the
so when you call log we need this in so
we copy this this information has to
come at the point of login so it has to
come from here so we'll use an extension
method and we will protect I close that
class I'll need to copy that out again
if we go to here say let's do this
critical one and I will just copy all of
that and paste it into our extension and
then in here we can do the same thing
again which is blogger dr. Atticus of
course never no loop but off this not
going to be the case we'd pass in the
message and the arms so that would call
if we did a lot of critical and pulley
sauce I can't leave another name really
because we want to include the source of
weight from prom if we go to the I knew
it to close it down again for one member
so we're gonna copy these these need to
be included in this part so I'll have to
paste them before the params because
that's an infinitely long list will do
the logger the message then we want the
specifics that we run about and then
finally lacked include the compiler
services loved to a critical message
including the source of the log logger
the message the caller's remember
function name beep the source code file
path the line number Paula
and the additional arguments now because
we have all we want to what gonna do is
prepend
these three pieces of info into the
parameters that can also get passed in
as like an additional so what we want to
do with that is append to this list
because the the parameter simply means a
limited number of objects can be passed
in but if we then try to do the Paramus
here we need to pass it all in one
object or if we can't do origin we could
do origin file path line number and then
augs but what that will help result in
doing is actually in fact why's that
complaining the line number what that
will end up doing is actually passing an
array of four objects and the fourth one
is an inner array of objects so we have
to combine this list so we'll just make
a little helper for this and we'll give
a new folder called array extensions
which call array and the class can be
called array extensions clean or remove
public static class tension methods for
arrays in here I'll public static want
an array of anything and we want to
append say to one side so the array is
the source input and then we want a
bunch of params which is also an array
of anything and that's to add its Alex
kind of funky that will append the given
objects to the original source array
we tie up array the original array of
values the values to append to the
source and that will then do we'll so
you get a list so we can append to it
new list of T and because we want to
append which means bill at the end
create a list of the original items now
we want to append the new items so we
just do list dot I'd range its to add so
they go at the end of the array return
the new array and that will be the list
dot two array so that will basically
just simply take to object to raise or
in this case two of any array because
I've made it a generic so simply two of
any type of array and it will chuck
these at the end and return a new array
then we'll do the opposite as well case
we need it
prepend the given object to the original
source in fact that's one we will be
using anyway as this will be prepend
sauce to add so in this case you flip it
around you do the two at first and then
you add the sauce so creating a list of
the new items and append the source
items so that will then prepend so now
we should be able to do because it's an
extension method anything that's an
array we should be able to dot append or
prepend there's a theory so finally if
we call log critical source now all
we've done is copy and paste to the
original log critical but we've
prepended where the caller is stead of
doing these three things separately we
need to pass in the augs
and now it should be able to dock
prepend there we go and just pass in
them just like that so that should then
simply combine augs and chop these three
at the front
it's not step one accomplished so now if
we did long critical source we do
nothing different we just call it from
here they get passed in as arguments and
in the file logger I don't then we'll
see that because I don't with
intellisense will show that so can we
see state come on and as I can't really
see anything in this and this kind of
view here because of the fact that you
know we're passing it to a basic
formatter
so what we need to do now is actually
provide the formatter so to do that in
fact we can't then use this override
because this takes away the ability to
pass in I believe yeah so we can't pass
in a formatter to this log critical so
what we'll have to do is drop back to
log and just pull the original which
this log is basically our call like this
exact call and we're going to provide a
new formatter so that also means we need
to provide an event ID and an exception
and I think that's it so let's go to the
message role of an event ID which is
event ID and will allow them to pass it
in but by default we'll just make a new
one so just a generic event we don't use
it anyway
same with exception will allow them to
pass it but it's not required so it kind
of keeps you the same so now we can do
in the log and pass the message pass the
event ID pass the
dates it's state is these mmm yeah I can
pass them all in case we need more so
I'm pretty sure that the state then the
exception is the exception and finally
now we can provide a lager a formatter
so we'll make a formatter
so for that we will make a new class I
know there's lots of classes here and
for the sauce or lager sauce all matter
and that's then able to be you and
passed in so for this well public class
lager source format sir static or can we
yeah then pass it in as a method and it
probably static string because it needs
a string back home just call it format
we've got the state and we have
exception she gets passed in I believe
yeah state an exception returns a string
so we do that just return test for now
and we go is break point there as well
we can now pass in to our log message
the source format or formats the
function yeah cool so this has been very
long-winded congregants string to log
level oh yeah the log level we also
to provide because were overriding it so
critical then the message there oh
that's not the message be ha the message
needs to be part of that because that's
part of the state so event ID arguments
can have the original the file path for
line number then the message and then
whatever extra arguments were passed in
by default so we'll have this order of
priority we'll have when we come to use
the formatter you'll see the index 0
will be the origin and the file path and
the line number then the message so from
that we can then finally combine this
thing into it you know a message that we
want to display so now we call log
critical source it will call the logger
dot log directly passing all the values
and also tell it to use our formatter so
then when we do form after here it's
calling our formats because that's what
we've passed in so if all this goes to
plan we should end up with a message it
just says test for all the information
we need should be there that we can then
format a string so we've hit here
interestingly before we even hit here
I guess it's being formatted for us
somewhere else first you can see a lot
the four objects start up is the class
name there's the source code there's the
line number and there's the message
which is what we wanted and we have no
exception then we have same again so
that that must have been the internal
stuff getting called somewhere first or
otherwise it's the debugging console log
so you can use output you the message
test
so here the formatter we can see as our
formatter we'll hit that again and now
we've got message test and the output
would be time and test so the only thing
we need to do now is tweak our formatter
to actually format so all mattes the
message including the source information
pull out of the state
the state information about the log thus
that's the cool thing about doing this
kind of I know it seems like a hell of a
lot of work but doing this for master
means we can passing custom information
in logs of any amount of any kind of any
type and then format them specifically
and still have them output as a string
to a logger so it's really powerful some
people don't like that I really like it
so let's first get the get the values
from the state and that will be the
message is for the power gene it's the
first one the file path this is the
second one the line number is the third
one message fourth mistake fourth one so
get the values get any exception message
and that would be exception question
more and don't issues get message or two
string and then we will return if there
is an exception actually we will do yeah
you'll just want a new line and we're
doing exception message we don't meet at
the end but kinda want a new line so
we'll actually do set your message
equals string got empty or rather
exception as our new line if
section an exception and given all
message plus equals system gar
environment new line I think that's the
cleanest working thing you're doing it
so we have the message we are the
exception we have all the details we
want now we just want to format it just
the same as we did in our original
logger see if I can remember there we go
so we copy that info and we paste here
return the message then the I can't do
the message there we'll do we'll add it
to the exception message we have the
message then we have path doc that file
name of the file path what's wrong with
that oh these are all objects need to
cast them to the gnome types so I'll be
string that'll be an integer but we
actually don't care what convert them
anyway I think that's just interject all
along and yeah I do
so if you've got file source code file
it needs along then you're in trouble
that will be string messages stream so
that's what we're expecting we could do
asked to be Knowles but for its kind of
crash in a sense that if you caste drunk
or passed the wrong thing and you get an
exception instead of just a null value
format the message string so you'll have
the message you'll find out exactly what
we have before the file path the origin
the line number so
as ad formats a message when the tallest
source information is provided first in
the ultimates that's all done that's
passed in so now we should get an
exception message that's exactly the
same as our previous lager but now baked
into dotnet core so I've got critical
DNA filmic started and then you can see
it's called from framework CS start up
line 130 and that's perfect so now we
have the message which is there we have
the output which will then prepend the
time based on our configuration scene we
want the time which we added in AD by
default he went to the logger the
configuration got created new and that
by default we append the time so we
could disable that we wanted it logs to
the log file and we know that already
works so now when we run we finally have
a log file that would just like we did
two hours ago when I was baked into
dotnet so it's cool so there we go
that was a really useful to our video of
how to do what we already did but on a
serious note this is kind of the
building blocks for where we need to go
so this looks like a lot of what we've
done is let's also check with them
rights to logs this is now a framework
that I'm gonna awfully again make
open-source for everybody can make use
of it and see it and there we go to log
files I will also start using this
everywhere so this this DNA framework
will be using everything not just for
set of words this will start raining
imported into the DNA web be used in for
set a word or be used in the server so
this framework everything we start
moving into here will be get completely
universal like just used everywhere for
anything so that's kind of the point of
this because I make so many projects and
there's so much we end up we're redoing
and remaking and it's used like async I
use this async away to everywhere
absolutely everywhere so the
a waiter will end up in the framework
and then once we've got this a little
bit mature or maybe even straightaway
I'll make this a new package and show
you how to do that in a video and then
you can just right-click on any project
manage and just install DNA framework
and then in your main startup project
which in here is here you just call
framework dot startup and this will add
all the login all the file management
all the error exceptions you'll gain all
the dependency injection the async stuff
anything that's abuse you know IND I
always used and I know it's gonna be
useful everywhere it will now be in this
framework once we've done that this
facetted awkward core should then only
contain stuff that's specific to our
core for set a word and server
application so it starts to make this
much cleaner and easier to see so after
this now I will fully integrate this
framework into Fassett a word cleanup
would call move it all into framework
where we can and push it as a new bit
package and then from there we'll
finally make the the facetted word talk
to the facetted word server through a
web a web client and the reason i wanted
to do this is because that web client is
again something that's very useful for
any modern app that we can now talk to a
restful server or an api server or
anything through HTTP so I didn't want
to then do all the work and make HTTP in
this video info set a wood core and then
not have that ability and any other
application we make so I kind of want to
make this the focus of anything that's
universal so hopefully this video was
useful you might not understand what
we've done as such here but in essence
what we've just done is added the built
in net core dependency injection service
which is ultimately this provider now
made that into the universal platform
that we can consume in this and that
means we can get rid of any inject and
we're back down to one less reference if
your walnuts external non-microsoft
reference that we don't need plus now
all this dependency injection will work
anywhere
that dotnet core works on top of that
with emerged in the file logger and
instead of just having our completely
separate file login system we're
blending in with the built-in logger
which is more supported for you know
third-party applications or tools that
consumed on that core and they're going
to expect the login to be you know
they're gonna use the inbuilt logging so
now we've added a file logger into that
inbuilt logging so hopefully this was
useful again any comments questions let
me know and I'll see you soon</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>