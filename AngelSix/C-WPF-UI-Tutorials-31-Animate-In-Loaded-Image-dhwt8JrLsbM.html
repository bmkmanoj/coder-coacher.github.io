<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# WPF UI Tutorials: 31 - Animate In Loaded Image | Coder Coacher - Coaching Coders</title><meta content="C# WPF UI Tutorials: 31 - Animate In Loaded Image - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/AngelSix/">AngelSix</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# WPF UI Tutorials: 31 - Animate In Loaded Image</b></h2><h5 class="post__date">2017-09-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dhwt8JrLsbM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in the last video we made the sending
of an image in the chat app so we can
click and see an image load and now the
whole applications got nice you know
fading animations and loads and
animations and this image is just
appears you know so it's not great so it
ones where at least have some you know
animation in and then potentially some
loading symbols or something to indicate
when a pictures loading so right now you
click and after two seconds it just
appears so let's start by at least fade
in the image in when it gets loaded we
can do that fairly easily what we'll do
is we'll create a attach property to go
on to the image which is here and then
we'll simply hook into when the source
changes or when there you know the image
actual image changes on the control and
then fade in just like we do any other
animation so jump into the framework
element animation attached properties
class which we should start separating
su and putting into its own subclasses
but for now we'll we'll dump all in here
and so we want in here another class
I'll call this fade in image unload
property something like that and we want
the same base class the animation base
class with the correct name and the
Swale fades in an image once the source
changes and will override the in this
case we don't just want to do animation
because we need to also change what
happens when the value changes so by
default the value will change onload so
if we went to the animation base
property class by default we make it
over aidable but by default when
the it's even in the base of such
property on value changed so we only
update the on value updated here rather
so when it loads we do all the animation
so it's override the value update it's
not the value changed so on value
updated we won't do what we do in the
base because we don't want to animate in
this case when it loads so we're simply
ignoring all of that way we're redoing
the logic for when the value is updated
and instead we want to first get the
image which equals the sender ours image
on fact we can do a check here so if
send that as image or if sender is image
pull an image and then of it isn't we
just return make sure we have an image
so this attach property alone you work
on in them each basically and then once
we get here we'll have the image then we
want to see if the value passed in is
true so we want to animate in then we
just want to listen to the images target
updated now you've got two things you
got target updated and you got sauce
updated and we are updating the source
but the issue with the source updated as
its it literally means of this
dependency property changes now when you
bind a image with the source and you
specify the path it's either a bog in
WPF or simply expected behavior but when
you bind it in the code and you change
the source then it doesn't never face
the sort of dated and
the guessing that's because it's a Borg
or simply because WPF in the background
updates the target and the source encode
behind and never fires the event so I'm
suspicious it's a bug but other people
might you know say I don't know it works
but if you can get it working with sauce
that's great
for me I always use target updated on
images because that's when the actual
underlying the image itself changes
regardless of who changed it and how so
you always get that fired
so basically when the image changes will
fire this target updated and if the
specified false to the attached property
won't unhook and we'll talk about I
mention in the last video we'll start to
have to look at you know doing these
events in a night away maybe with some
weak references or something because
these will ultimately cause some memory
leaks that we'll have to fix later down
the line because of you know attaching a
property true hooking into event and
then never on attaching so we'll have to
deal with that in a later video but it's
not gonna do anything harmful right now
perfectly fine but we will we'll do some
videos on detecting memory leaks and
fixing you know do events and again it's
all new video but just bear that in mind
that if some of you notice that
oh wait a min this might cause a memory
leak it yeah you're technically correct
but we'll we'll fix that in future
videos it's not important it's not I'm
gonna stop the application working right
now but bear that in mind so we have the
animating and then we simply monitor for
the target updated so this is very
similar to the base property where we
it's a bit more complicated on the load
but we we went through that that really
on the first load we hide and then we on
hoop the load we wait a small delay and
then we do the animation whereas in this
case instead of doing all this logic on
load and simply ultimately just calling
do animation we are going to completely
ignore the the do animation and we're
simply on value updated who can
to the target and then here and we want
to just do an animation so we should we
know this is now going to be an image so
you just do sender the image and then we
just animate it in using our animation
helpers I always should be able to fade
in async there were young I'm first load
we just pass on false and we can await
that I guess and then or pop you have to
update a name so fade in image and then
we attach this now to our image in
theory I think that should and I'm a 10
or rather fade in or not so the other
thing actually saying that I think we
have to tell this to notify on target
update link is default to false so set
that to true and that should now tell it
that when the saw changes via the target
updated source as well trial it again
oh yes that fades in so if we open up
you'll see the image fades in so that's
alright that's a you know a nice
animation when an image loads the only
thing is it's kind of it's just there
and then appears that we still I think
need some kind of indication that is
there an image loading whereas there
kind of how do we know we're expecting
an image and where do we show if it's
failed or not you know there's no
indication at all so let's also add a I
think we'll do the spinner that I'm at
the login buttons when you're loading so
unless I just want to double-check on
value updated as the attach property yes
that's fine
right so I think we're would want to put
it I think we did
the spin-off is a called spinning
something spinning text it was called
and it was a textblock style so we want
a text block and we'll put it here
I'll have it sort of appearing when the
image is loading which will also have to
detect so let's start here we'll do a
check block for the style of spinning
text will want it aligned to the left
and aligned to the top that's a bleep at
the top left corner
in fact horizontal alignment will want
to be based on whether we sent or not in
the alignment which we've got somewhere
else it wouldn't reminds me actually I
know something else I saw you just cut
this one thing I noticed in the last
video is the bull ball seemed to stretch
like this one now you see stretches to
the width of the image so we need to
force that to realign so let's do that
and then at the same time we want this
text block to align the same as well and
so it was sent by me and horizontal I'm
in there so I'll Nick it off the chat
bubble anchor we'll go back to we want
this text or rather this whole bubble
thing here so I think this we either
want to I think want to align this one
the whole grid I see if that fixes the
chat bubble we'll also have a random
loading glyph at the minute I think now
so let's fix that alignment thing there
you can see we've got this little
animating glyph that's present on all of
them at the minute which we'll fix to
underline that one over to this side so
the same thing here we'll just do the
horizontal animation is the same left or
right
we'll also need to do foreground is
foreground light will add some padding
let's just take a quick look at how that
works at a minute oops so ignore the fat
that is on all of them now but that's
what we'd get now when an image is
loading for a specific message which i
think is subtle enough and a nice enough
you could also add you know loading
image or something but I think just
keeping it nice and simple just a little
spinner to show that something's loading
is fine so all's you have to do now is
make that only visible for one when
there's an image and two when the image
is still loading because right now this
the spinner will be underneath here
spinning behind the image so we need to
also make sure it only happens during an
image loading and only if there is an
image as well so to do the we'll need an
image loaded on the image itself so
let's go to the view model first which
is Charma these list view model and in
the image attachment we will have a
public boolean image loaded and this
will be basically if this has been set
so right now it's not so it'll be a
simple case of local file path it was
not otherwise we're going to say the
image is loaded and that's all we need
to do so indicate if I'm image as
allotted and now we combine two image
loaded on image attachment so in the
text block we want the visibility or
rather first because we're buying into a
property inside a property so the view
model is the chat message list I'm you
which has the image attachment and we
want to bind to the image loaded inside
of that so you never want to really bind
you don't want to do like visibility is
binding image attachment dot image
loaded I think we called it image loaded
so you don't really want to do that
because then this won't get
notifications when this changes I'm
pretty sure it when we can try that
first I'm pretty sure when you do a
double dot effectively hooks into the
parents on property value changed so
it'll hook into the chat message list
items on property value change and it
will simply be management of this whole
thing change is not the inner item so
we'll try it first to prove that and
then we'll fix it
so the visibility wants to be a
converter to convert from a boolean to
visibility gone converter and it wants
to do the opposite because we want it to
be visible when image loads is false so
we we invert the logic and also this is
one about a few questions not many but a
few of you of us well I don't understand
the fallback value of binding and this
is an absolutely perfect example of what
a fallback value is so we're going to
bind to an image attachment which might
be not this might be not one it isn't
all on all the other messages so this
binding will effectively throw a null
reference exception it won't throw
because that binding won't do that it'll
simply end up being no because it will
be caught and it'll resolve to no so in
this instance where this is not true or
false hence you can't pass it to a
converter and do things because it's
simply no it's not a valid binding the
binding mechanism falls back to you know
a specific well what do you do when it's
it doesn't know it'll either return null
or you can override that value and pass
in a valid value so this is where the
fallback value comes in so fallback
value will be set when this is incapable
of being set in this case this is not so
it will it's not a valid binding and
it's different from the masala one
called target null value so target null
value will happen if this is a perfectly
valid binding ie this isn't no but this
value exists as well it's a real value
in the view model but it's actual value
is not in that case target no it's
called and that's what a lot of people
think will happen when say this is
completely invalid like this is not all
so you can't get into this value people
think that well I've set the target I've
set the value null target null value and
it's not being set well it won't because
that this is only set when the binding
is valid but the value is no fallback
value is set when this binding is
incapable of being fulfilled ie you know
like this part is actually non-existent
it's not so you can't get into it and so
in that case if we basically have no
image it will cause a fallback value
which is perfect for us because then in
the instance that there is no image we
can tell this to be collapsed because it
won't pass into the converter it will
simply expect a value directly
visibility so we'll tell it in the
instance of effectively no image to be
invisible as well but then when there is
an image while this is false show the
loader so that the triple logic there
should work and I think this this will
show initially but then when the image
loads due to that binding issue it won't
update so you can see that's not updated
there so it's not even showing so let's
just fix that as I'm saying way you
don't bind like this you know change the
data context to the image attachment and
then you bind to the inner image loaded
and this should now work as expected so
we click this now or not I want it is
but we've got a big floaty spin them all
the way around and then in fact it's
obviously still wrong because it's
showing at the wrong time so that should
be let's have a look
I think let us first what can we do here
let's just set this okay ste to zero a
minute so we can see the loading you
know where we're loading and what's
going on here let's get this logic set
up correctly so there's nothing there
and then that appears there is there's
no height to this okay so let's just
make sure this isn't an issue I just set
this at the top left it's funny because
this was working and now we have so what
made this go wrong just step back and
cut that out tomato let's see yeah
something's going wrong with that
binding because that's working it's all
lined up correctly that's in the right
place so what happened between us
pasting this in oh I see when we change
the data context we also change the sent
by me alignment so this needs to be we
can do let's move this out and let us
place this in the border with horizontal
alignment so simply plunk it into it a
parent to align correctly before we
change the data context so is the only
problem with changing the data context
you've got to make sure you you only do
it on the item you want and we should be
able to move the vertical alignment as
well to the border and this text block
that hopefully store line if not then we
can force the text box to align top left
because ultimately the border is aligned
to the correct position so let's just
see if that works
so that works fine there so now let's
just put back in our binding and
hopefully that will work so we'd click
we've still got no load but then it's a
peer we just simply got the logic back
to frontier appeared once the image dead
so this I thought we inverted this logic
image loaded arrived on the wrong way
around here oh I did
Emmys loaded as loaded if it isn't equal
to no not happy tears equal to no that's
that mystery explained so finally with
cliff we got a little loading and then
the image fades in so loading image
fades in and now it isn't in the
background spinning and we can double
check late isn't in the background and
spinning which we should do by just
simply sateen up in fact that should
have prevented the image from and being
visible and it's still visible which is
interesting yeah how this funny well
because we've we've animated in so we
need to remove the fade and animation
for the moment because that resets the
opacity and let's just double check that
this does disappear when the image
appears so they go the image is now
loaded but invisible but the glyph is no
longer there spinning so it can place
that back in now and I think that gives
us a nice enough image loading kind of
setup so you're in a message and then
you can see something loading and then
you know animates in and if you scroll
up it will effectively load below so if
you're in part of a message already and
you're reading up here then it won't you
know interfere it'll just load below so
I think that's good enough for an
animation again if you've got any
feedback or you feel like you'd like to
see something different or anything
really just just let me know but I think
that's a that's a nice and often simple
enough
in animation for images and we can use
that for other kinds of you know content
being loaded into the message and that's
that</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>