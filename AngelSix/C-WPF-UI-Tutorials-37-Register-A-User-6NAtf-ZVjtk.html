<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# WPF UI Tutorials: 37 - Register A User | Coder Coacher - Coaching Coders</title><meta content="C# WPF UI Tutorials: 37 - Register A User - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/AngelSix/">AngelSix</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# WPF UI Tutorials: 37 - Register A User</b></h2><h5 class="post__date">2018-03-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6NAtf-ZVjtk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to carry on
with the server integration into the WPF
application so we're starting in the
peseta web server firstly I'm going to
make the register call now so user can
create an account so we'll start with
similar to the Lockean almost identical
to the login command we'll make the
public async task that returns an API
response like all of our API calls short
and this time we'll have a register
result API model and we will call it
register async and then we'll have run
body and we'll have a register
credentials and then we'll make this
call so there's the main function tries
to register or a new account on the
server the registration details and
returns sends the result of the register
request I can copy that paste that into
there and now we'll just make these
models so we've got login credentials
API model or copy and paste I'll just be
careful when we're doing that that we
make sure we update everything else to
the the correct names and things
so close that down this will become
register the credentials for an API
client to register on the server and
receive I just leave it at that
public user name so in this case we'll
have the user's username which what to
update the WPF to allow that or have the
users email and the user password and
then we might as well also include first
and last name but I think what I'll do
on the WPF application is to not ask the
user for all that information when the
signing off
we'll simply let them sign up with email
password and username and then once the
logged in will prompt them to enter the
you know film finish filling out their
account details of UL but we won't force
that on them that's the register details
so we really need for that so now we've
got the details past it now we need the
result so we'll have a register result
API model and again the result for a
successful register and file that's
wrong the result of a register request
it's not necessarily successful because
it come fail so the result of a register
request register result API model the
result if we successfully register then
yes we want to token well not as well
log them in at the same time first on
that survey slates the profile details
so it almost want to inherit from the
login result API model so we've got all
the same properties because event
there's anything that we wouldn't want
in there or those details and then to be
honest there's nothing custom right now
it like different you've got either
successful and it's logged in you got
the details
or it fails and you'll get you've
already got a message in the API
response option here so the login and
register results are technically going
to be the same at the minute but just to
keep it clear and allow us to expand in
future if we wanted I'm going to inherit
from that so we always keep same details
but I'm good
tweak it as we needed so that's what I'm
going to do for that so now we've got
the call itself to actually register so
for that we want to make a user first so
I'll have a new application user and
then we'll fill in the details there
great the desired user from the given
details so I'll set the username equals
register credentials username we'll set
the first name last name email and then
the password gets passed in when you
create the account so try and create a
user now we can also test this first
we'll make it create a user and then
we'll see how the actual user manager
handles this in the first place of the
user manager let's see if it gives us
any options about what it throws it
returns an identity result so I'm
guessing or throw an error if they
usually exist so I don't know and
there's no comments here specifically to
tell me there's any exceptions that are
gonna throw so I could look at the
source code or there's a couple of
options here so what I'm trying to get
out here is if we have a say we've got
user name angel six and then we could
try and create a user angel six
something's gonna go wrong because this
is gonna return an identity result which
is basically a user that cannot
successfully return that must vote some
kind of error and it doesn't tell us
what so I'm gonna do a an initial allow
it to throw and see what happens and
then we'll handle that will either
manually check ourselves first to do
some preemptive reassurance which is
what we should do really you know check
of a user exists'
with the same username and then if the
presumption that everything's okay we
then create a user then that's where you
know we should be okay
we should also potentially lock this
function because if two users try and
create the exact same user at the same
time ultimately one of the database
calls will fail so one wouldn't happen
anyway but we may want to consider
locking this but let's just start with
making the basics first and then we'll
well expand on it so it's just you just
enough to get this thing actually up and
running everywhere so we'll get the bar
user or created usual pull us try and
create the user so that's what we've
done we unpassed in the password which
is registering a lot password hey what
else now so if the registration was
successful so a created user dot L in
fact my mistake
this might refer me tunics is an
identity results rather not an identity
user however miss reading that so this
is actually the results so this might
not throw and are they expected not to
now so if we've got results we do
whatever we need to succeed otherwise it
failed then we'd want to return a new
API response with an error message of
and then do have anything in the result
to indicate the message for your errors
so we've got a bunch of identity errors
so we will want now a helper that's just
the object for want to help her to
extract every one of these which would
be my squashing there's one in there
okay you can't do anything with it oh
it's an enumerator so it up to like an
Adu to know I can do anything with this
object maybe it's just as inside there
doesn't like working with it
so we'd have to cast it - it's a list
and that in fact we do that all in mine
yeah so if it failed and we get an error
we can then get the result get the areas
of the r RN to list them then select a
specific thing or I think we can
aggregate it I can never remember how to
do an aggregate so it's returning an
arrow yeah no I can't do that
well can we aggregate to a different
type from the initial time no so we
might have to select first so let's get
the identity error and we'll just get
the description we don't care about the
code for now so we get those and we
should break this down now staying long
so the error message is a result dot to
list and now we're going to select a
specific thing which is the string then
we are going to aggregate which simply
means put them together it's expecting a
string return and you've got two objects
passed in so you've got a me and I think
a is the first one and B is your
resulting one but again we'll figure
this out as we go and double check it so
it's simply a great a we could do in
fact that's going to look worse than no
it would be fine like that environment
dot new line and B so we chopped them
together and that will return a single
string so that's basically going to
combine all a list of all of us or an
aggregated aggregated list of all errors
into one that will close the it doesn't
need the semicolon there we go
aggregate all errors into a single error
string return that failed response so
that's how we failed so all you've done
is called into the user manager the
built-in use manager to try and create
the user every fails we use the errors
if there are any to less than because
they're an enumerable then select the
string the description from each area
and then simply add every error together
so this aggregate will go the first want
to be a and B so that you know the first
day of the second error the result would
be the combination of both of them
separated by a newline the next one in
the list a then should be effectively
the result to the previous one so a plus
B and then this would be the third one
in the list so then you your pending the
two that Rudy appended to now the third
one so that's all this should do like a
little a list - you know chop all the
errors into one list nice and easily
this brings us to if it succeeds what we
want to do there so obviously what we
want to do the same as when we log in
and succeed so we have if the user logs
in we have an error invalid error make
sure we have a user name so we could
also just quickly copy this into here to
check some basics first so it could chop
this in and say if they're register
credentials dot username it was above
null which why did we do as null all
that that's actually a no need to check
just go back down a second we've done as
a log always on login credentials first
to make sure we have credentials that's
what we're doing there so make sure we
have that and if we do make sure it
doesn't know so the first that charity
do make sure we have a register
credentials and the stops all this null
checking being required everywhere so
that gets us to the
that will remove the requirement for
that so if register controls is not so
we have no credentials then we will
return and what kind of copy this layout
again from the login make the default
error message first invalid nice from be
please provide or required details
register and then basically a BAE if we
fail for a normal reason this error
response then we can just return error
response and then if we have no
credentials or some revenge balls are
missing and in this case here this is
where we can we don't have to do a check
here we can have the user manager when
we set it up in the app and start up a
believe we can configure the identity -
you know require certain things which we
might already do here so I've got like
options for identity so the password
requirements we could what we do also
have I think it's claims identity or is
it user allow using in characters
require unique email so for one we'll
set that to true make sure you have some
unique emails but you can set some logic
here for you know forcing restrictions
on users and that see if we're going
from the claims identity no there's
nothing there so right now those are
require unique email and there's
multiple ways of doing this checking you
don't have to do just a check here to be
honest on the the register and you also
can is shouldn't in some sense because
if the user wants to update the profile
then you've got the same kind of check
so you don't just want to put the checks
in here on say have they provided a
valley
or valid email or is the first name
required those kind of checks want to go
elsewhere so for now I'm just going to
actually leave those checks out and
we'll come back to that in a separate
video and we'll simply presume if
they've provided any credentials that so
long as this call to create the user
doesn't fail we're good
that should return the error response
what's wrong with the error response
that's because it's returning the wrong
response that way yeah so first make
sure we have no credentials or rather if
we have no good ads will return the
error and make sure we have a username
lots again it's a basic check we
obviously need a username so we will not
as well do that check because that's a
really obvious one that is the key thing
that ever used us to have so going back
to the login to check check and every
city that doesn't matter find by email
ill don't care about that is valid
password we don't care about that and
then they create a token so that we'd
have to move this token out token
generation so we'll come back to that in
a minute so let's register the account
first and then log them in using that
logic so if they've succeeded the next
thing is to generate an e-mail
verification code so for that we're
going to use the built-in user manager
to generate a code source a e-mail
verification code and user manager and
all this will do is generate the token
in the database that so let's generate a
unique code give it us and set the users
database fields the one that says email
verification token it'll set that value
in there and then when we come to verify
that code we've got the same thing user
manager dot verify email confirmation
token and that'll simply check that the
passing code matches and then flag their
users account as being validated so
nothing special going on there
so get the email verification code here
then we want to email the user the
verification code and after that then
we'll just return a successful response
so it's successful we know it's
successful so the response as a new
response and then this we now need the
details of the user so if we're
successful we want to get the user
details I guess if it's not already in
the result which it won't be because
that's just created the user so now we
can use our user account equals or user
identity find by name by email so I find
my username and register credential foot
username because that's what we signed
up for and there's no reason why that
would fail because we created it there
and we've got it here so we need to
actually await that them the user
identity then we can pass in and the
fact did we not make a helper extension
method for that so once we have the user
know we should though so we have here an
application user which we get where we
get in the application user
that's the application use I'm a looking
at the wrong thing user so they just
checked by their users that farm Venus
it's the same user but we want to extend
run turn an extension method so we don't
have to do this every time to make in
fact no we can't because this is a
different result now I'll just do
manually for now
ignore my babbling I'm just thinking
things through
copy and paste that for now
in fact yeah copy and paste that token
we'll set up in a minute so to do get
token and then we'll set that up so now
what we learn to do so we can share the
logic is we've done all this so here now
is our token so this is all to get a
token so we cut all that and just say
get delete token something keeps going
on with this tabbing something must be
wrong tabbed up here ignore that for now
so for this we'll just save our login
token equals and then we've got API
controller and the only way we want to
put this so it's going to be a claims
it's gonna need the username it's gonna
set
details up honestly don't know where to
put that code not that's super important
right now but it's obviously it's
specific to the web project
I guess authentication we need a new
class so we'll have add class and we'll
call it charity token and I'll try and
do this as an extension method
I don't like helpers anymore I could do
extension methods what's the namespace
were working in web server that's it
extension methods for working with a WT
there are tokens public static string
generate token passing some stuff in a
minute what is going on with this
tabbing there we go a new claim
claims imported their own namespace
what's going on here claim claim system
got screwed up claims it just just
doesn't got username yet so I mean
potentials just passing username for now
just to shut that up from complaining ah
got that getting killed in sources I
move this logic out right now the only
thing we add as a claim is a unique ID
and a username so for now that's okay I
guess and then we'll just return it so
can we can expand on this again we'll
keep it simple for now return the
generated token and of course you're
going to complain or rather let's return
the security token and then we put in no
actually let's do i stall we turn a
string we don't really care about the
token itself and then we'll write the
token so that is okay it's just comment
now generate a JWT bearer token
containing the user's username and
that's it
so we've segregated that and I want to
try MIT as a helper so because this is a
user name only and we have we might want
more information about the user so I
don't know whether use application user
yeah because we can make an application
user which is what we've done up here
so yeah let's extend the application
user instead so it's a nice extension
method
and although user and I will just say
use about username in do it that way and
this is now user the users details and I
think that's it so to now get the token
if you don't need to do it there how we
can you do token equals user dot gonna
make the token now go we name that
actually to generate jbt token so it's
nice mmm application return valid
response containing or users details
otherwise failed so all we got to here
is verify email what you don't care
about for now the login is all the same
but now where we would have got the
token we can now do you generate token
so it cleans that call up a bit or you
do the same thing again here we can just
do get user name and then add the token
straight to it so I think that's enough
to at least just get this thing building
and using that register any user
basically so let's just open up the
database and let's take a look in the
database first and then we'll monitor
what happens in the database so you can
see what goes on you know and what needs
to be done when we're edge 20 user so
databases for set are word tables and
then we have the new or not the new over
the asp net you just select all from asp
and that users
and can we zoom in on that I can never
zoom in on that bit but I mean ever
quick see if I can increase the size of
this results window thing text editor
that's gonna be obvious tapped results
size seven there we are size 10
the changes will restart okay so we've
got to just restart that window or the
whole application try restarting the
whole application a minute
okay that didn't work anyway you can see
an offshore down here so we've got the
current single user we've got my
username it's not been confirmed its own
the email address
you've got the user name so this is
already in the database I'm ready so now
if we have a register call and we copy
and paste this to register then we can
now we need to go make the WPF side of
things so this is not running let's
press f5 to get it running put a
breakpoint in - at least hit this once
already and we'll start on the peseta
words WPF application now so I just drag
this interview and we'll start working
on the WPF application so I'll spin up
first make sure it's still running so
rather make sure it still builds
basically to make sure it's you know
test your app before you start messing
with it so here's the app or sign out
and then this is now the page we need to
hook up so we need to awfully include
now a user name field and then we'll
offer the register we can have got to
call in the web server
so let's get started on adding that
field and then adding the call to the
server right so where do we start
it's that their word controls may be
obviously just the page been a while
since I've been on here register page so
here's where we are email password we
have email you wanted password or
username we want so probably always
start with username and it's focused
true we'll move to the user name tag
will be username so now the binding
behind which is register view model now
needs a username a user name of the user
user names there we go we can now bind
to user name and then when we come to
register we can oh I thought this was
just to login Oh takes the use of the
log and pictures can say that's just
that's going to the page I thought I was
literally logging in so yeah so this is
the call we need to do the register this
is where we actually want to do the
stuff we need to do everything else
should be already bound and work you
notice from doing that so now we've got
user name email password ID username to
our spell check file if we have one yet
and let's just copy from our core view
model whoops
application
yeah so it's copy from the login view
model and we will copy all of this code
for now just dump it in and go to here
paste it in and typical this is very
dangerous thing to do is copy and paste
big bunch of code like this but we're
going to be careful so call the server
to attempt to register with the
credentials move all yes that's still
going to move we're gonna make a web
request it's gonna now be a register
result request it's gonna go to API
register we still need to make these
into bills in the core so we can share
them what no major rush for that
register credentials API model username
as username email as email password is
the password and we got first and last
name which we don't bind yet we could
take a look at adding that to the page
because it's not overly we're not asking
for tons of information but mainly I'm
just I like to keep things simple to the
user so they don't look at the load of
things to to add well we've got a
literally good chalk in like two more
boxes and spin that up and let's just
see so let me just quickly cut that out
so I can build them run
and we go to logout register and you see
we're left with this kind of a bit too
much info on my eyes so we could do
different things but to be honest let's
keep it simple let's keep it small chalk
that back in there remove those extra
two and then one like say once the
signed in we'll have them add the extra
info if they want okay right so we did
up to here we validated that's correct
for the register side and then there was
no response but data also responds
that's still all valid input and again
we can start sharing this kind of logic
as we want to consolidate oh no no from
server that also happen if we got a
response from the server set the message
if we have no result to serialize
unexpected server file communication and
then message fail so to be honest all of
that is really shared logic for a just a
standard failure so we can make this
into a function and it would return so
well I say the returned this would be a
pop-up style error message which will do
for now which is good enough I'll
probably turn it into more of a when a
user name fails we'll highlight the user
or something as opposed to pop up dialog
saying something but for now pop-ups
fine it gets it going gets there you
know the main application working which
is more important so we cut all of that
logic out there
and this we can then say if check
results or it's just a name I'm thinking
so basically want it it wants to check
the results for failure and report the
error at the same time so result well
can do an extension method as well on
the result which is an API response
result so again we'll go to core we want
extension methods on the API result so
that is an API response we'll make a new
class
unless what we call a guy response
extensions I remove that
public static class extension methods
for the API response class public static
boolean and then this will be on the
response so a report or even though a
caller display error it failed
now that this API response T and that
should be ascertainable through calling
directly this will call them result to
match that and then change to response
for the controller are it such
complaining we haven't returned yet so
if the response dot server responds or
is it not response war ever requests
results rather typical after all that
every quest result extensions and then
so that's an extension for that display
it failed and then oh come on that's the
web request result a so I can go to
impact occurred modes that right into
the DNA no calm because of this so we're
gonna expand on web requests result
extensions in there which is not really
another place for it in an API model so
we will then have a new folder and I
always say this is at least 60 percent
of all developers time it's
naming things placing things and
thinking up you know names for stuff
that's the main confusion here I'm just
trying to think of good names
whoever requests requests drop it in
there so it'd be easier to find
hey writes no it's in that folder
there's no areas this is not the
original code server response is an
object so now we're gonna have to pass
in a type or are we so server response
is an object and unless we have a type
ah so it's got to be a web request
response of an API response of something
because it's the API response it's
important so it does really an API I'm
gonna go back to be named in something
again the minute there's an API response
what's wrong with intelligence here yes
okay just return false for now comment
all this out all right so can I get me
and tell us that back now no ask me and
tell us that it's completely died so can
I have an API response of nothing do we
have a generic class no so it's always
got to be something which I'm sure we
don't have to be I'm sure there's an API
response without a tea
No okay how surprising I'll make that in
core as well right this is Ted in
long-winded this wants to be an API
response of T and this can then be an
API response of T and of course it keeps
failing some being an idiot and pointing
this out totally wrong place it's on the
way and it doesn't begin there why is
this so difficult one my doing wrong web
requests result every response so what's
wrong good da missing the enough there
we go finally
that was very long-winded in confusion
should have paid more attention right so
it's a web request result extension
because we're making you to the web
request result for the most part but we
also want to make use of the inner
success of the API response so this nice
fancy confusing looking extension method
does exactly what we did or allows us to
you know call it directly just on an
extension to protest simply any every
regardless because all this logic just
gonna be shared regardless of the error
and then it's just this bit now we need
to fix right so this needs an await
so this allow beer async task that you
turn the boolean there we go and this
will now have to be named async and now
don't like this name display error have
failed
well this description yeah this is a
descriptive as it can be we ought to be
honest checks the web requests
missiles for any errors displaying them
if are any and to be honest that's X
because the returns value is returned is
true of was an error nor false EV calls
okay this thing will fix that the
generic passing into the API response by
making DNA framework have just an API
response generically because we don't
care about the information we just want
the successful so we should we don't
need this T but just because right now
my DNA framework doesn't have a standard
API response of objects at least I don't
think so
no maybe does no it doesn't so I'll fix
that so the T won't be required after
but for now you know we've got there I'm
gonna just do that so that's not really
an issue though response
check so does all that and then it
returns true that wasn't ever return
less we've had an error all it was okay
so return false for now ever and all
that will be localized as I mentioned
this is a title this will be the custom
bit so that will be the title to be
passed in the title of the Arab dialogue
if there is an error and okay I guess it
needs to be capitalized right so API
wants to go into the ignored words
so now we can make use of this finally
so we've really changed in the code
there I don't know it took me a while to
figure out within me brains on go slow
today but this is now just an extension
method of the results we get so
ultimately we can now instead of doing
all that check we did here for an error
we can instead just go every sort dot
display over and title would have been
login failed in this case so if it
failed if the response has an error we
are done because reward of displayed it
and this I don't know what's going on
with indentation I'm sure something's
out to line here there we go so this we
need to await substance the awaited one
so if we've got an error and we now just
do that and it will automatically
display for us so all that logic that we
have for all the customized check you
know that response the error that we
would have to do for every single
request call we're now good are just
doing it the once so there's the check
it also means in the where did we
original call us in the login you would
go again whereas the view model in the
login view model where we've got all
this checking all that can now go to the
same check so we've now kept II dragged
we're not repeating ourselves so in fact
that's the login call that we've cleaned
off this is the register of course this
would be register failed and so this is
now try to register post if the result
was successful we will also be logged in
and we'll also get the user data so
that's still true and it will be the
right type so now you can store the
credentials so against a blogging
credentials and we're making this data
model this really is shared logic
so saving the credentials loading the
settings of going to the chat page
really this whole thing is really there
on login
you know unlocking successful really is
what I'd say so now it's where you want
to store this logic because again this
is shared between the two so we've got
the exact same thing here once you've
had a response and also the user data as
a login result we make the decision to
save it to the database load the
settings and go to a page but it sits in
terms of now what's responsible for this
logic you know what's responsible for
effectively a successful login so I'd
personally say it should be this it's
either gonna be this login view model
because you know you can instant ate
this or we put it in the application
view model which I believe is static as
well this is the state of the whole
application because that's that's kind
of a decision I'd say like to go to
pages I'd say it's it's an application
level decision so I'd put in here as a
public void on successful login or again
the name has the most important thing
here so it's not a login because we have
logged in it's you know process login I
guess or handle login so handle
successful login so start with that and
then it will be handles what happens
when we have successfully logged in and
I would say that should be
or paste it into there so that is now
actually an async task so we can await
that that one that have to be called a
sink so we await the clients tour we
save the credentials so now we need the
user data so ultimately we need this so
we could make it again an extension
method but that's not the point we don't
want an extension method here we want
this to be this is a view models
decision of what to do so instead we're
going to pass in a login results API
model because it's a successful login so
you want the login result and then we do
everything we get already login go to
settings go to chat page and now it's on
one specific location we need to handle
or rather comment the logon results the
results from the successful login and
this is we're also sharing that cause
that owner sharing the register result
API model being a login result because
effectively it's the same thing anyway
allows us to also share this logic of I
disappear there's logic here to be able
to pass in that same object to do the
same thing so now we've got this handle
successful login result and here where
we were doing it which was there instead
now we can use ioc dot application which
is application view model yep handle
login successful user data we can now
renamed to plugin result then we can
await that let the application new model
handle what happens with the successful
login so now we can get rid of all of
that paste the same thing in this is
login result
successfully registered and logged in
now get you the data so in terms of the
difference now between a login and a
register you can see we have a different
call so register call them in different
details then we simply check generically
for the same error get the result in
handler login so we can even combine
this further we really want it to be a
single call
that's register or login which simply
passes in this object and a nil
you know those two variations and third
one but to be honest by the time you
passed in a nil
a credential specifically to something
else the type the string then you've
done just as much work as the four lines
of code it's taken so that's as much as
I think will be factored that so that's
kind of how I work there that's this was
a I'm sure you can tell from this video
sort of a very unstructured an unplanned
video after simply said right let's do
the register page and work through it so
this is kind of how it work when the
videos aren't prepared and I always say
this is good to see every now and then
me just fumbling around and figuring it
out and you get to see the thought
process involved of what I'm thinking so
we started by just copying and pasting
the login view dump into the register
and then working your way through
naturally to try and reduce the
duplication of code so we're now at the
point where we have the register page
hook top it'll call the right function
it should at our serve but we should get
a result and we should login just the
same and we should also handle the
errors so in theory now we just put a
breakpoint at least there and press f5
to run
and I perfume my service still running
that are made we log out in them because
right now our logout doesn't really
logout so where I can't remember I've
got a logout in the settings view model
I will log out right now just clears the
user date when we got it to do here to
remove it from the database that's why
every time we start the app we keep
staying logged in that's fine for now
so logout create an account enter
nothing first and we see we hit here
he'll try and create nothing and now we
hit our server which is good we get the
model because we are still passed a
model this with no data that's all valid
so we should hit our first check of no
user name and return the response and
then back in I'm presuming our app is
now popped up some kind of error message
or we've got back to yes so here we go
so we've got the result pops into here
the some kind of error it figures out
the server response isn't equal to null
so it's going to display the error
message which is that and we press f5
and there we go
please write all with quite details to
read for an account and click OK and I
presume that now it's back to here so
that's good so this is where like say we
can improve this in future and we will
it's just I don't want spend too much
time perfecting each little thing when
we want to really get this up working as
a proper chat app so in future we'll
make this so as you're attacking it will
have some kind of live validation going
on that simply checks if you should have
a user name first and have the emails
valley's maybe you've entered a password
and those validation rules will come
into the view models the register view
model all know that instantaneously and
that I'll share the core logic between
the server and the the app so it's the
same but for now kinda just a pop up for
if it worked or not so okay so first
thing I wanna try is let's make a user
with the exact same username it's not
even bother with the password for now so
this will hit that we know that we know
this now hits a result so we don't need
to break point there edge time because
we know that's kind of cool that send
the right info in
and then fail all get to here when we
finally succeed so this now goes off we
hit our server we have a username so
it's going to try and create a user with
the username angel six but no other
details so this is where now we should
fail which is good we do and this is
where the errors should now aggregates
this three which is good now test if
this will bundle them all up into a
single error and they are password must
be fired characters password must be
lowercase password blood loss is three
password errors so that's returned and
then we now our a nice accumulation of
three errors so that's a good bit of
feedback so if we now go back to here
and I just put just put a password once
a and register we then get to here again
and should be honest I think this should
burn and this should now fail sin is
already user so there should still fail
good and that's actually failed on two
counts the username H looks really
exists and the email has already taken
that's good so we're getting decent
feedback naturally from the user manager
of the server again we could display
this much nicer instead of a pop-up we
potentially have just a red box here or
a lot of pop-up that comes up here or
this is go red you know again all those
kinda little details will handle when we
get back to basic WPF stuff where we
want to clean up the standard WPF but
right now we want to just integrate this
in and get working so the sign up now
let's say angel six two and contact to
attain your six calm and password runs
our password this should now
successfully register so we click
register we get into here gets down
creates the user and apparently we still
oh yeah we did succeed now so now we've
succeeded we get the user we generate an
e-mail verification code which at this
point you'll see now is this big long
string here if we now look in the
database at the users we've got another
user so there's our new user the email
isn't confirmed but we should have
it's where they don't store in here then
asp.net user tokens maybe that's why the
straw in the token no where in fact
where are they storing these where are
they storing this key unless this is not
actually a demand I'll be strong it in
the database now this generation might
be using similar to the JWT tokens this
is probably just a privately signed
string that will get unsigned only by
the application so I'd have to do a bit
of research into this bit because I
haven't dug really deep into where this
code comes from but basically that's
just a unique a unique number have you a
unique code that now we need to email to
the user so this is the last little step
we've got a deal and then we'll probably
just jump in have a quick look at the
source code to this to to get an answer
to that but this is part of the baked in
user manager that handles it which is
you know parted our net core so I'm not
too worried about that that's that is
what it is but we will find out exactly
where this comes from but I'm pretty
sure that's just going to be assigned
key just like that JWT token so this now
is what we need to send to the user when
they click the verify email to allow
them to verify the email address
basically so if we keep hold of that we
can fact know we'll have another call to
regenerate this token for when the user
wants to resend the token button based
on that we should have out the username
that's going to return everything and it
whoops I've done the wrong thing there
have passed the user that we passed in
not the user identity so this is gonna
return successful but with the wrong in
folks let's just kill that first user
identity should be there and let me just
delete shouldn't really do this don't do
this in production delete asp net now
users where ID equals and then we'll
delete that on the top one
and there goes the user so like I say
don't do that that's just me being quick
to get that response so now we know at
least that's gonna register it's gonna
create the user and it would have come
back to our WPF up if it weren't for me
killing the application which is also
something here we still need to handle
the the web requests just crashing which
effectively crashes the application
right now I believe but that's like say
something we'll we'll work on next where
were we done that settings view model
close some of these client datastore
register view model right so we can
let's show you successfully logging in
again so now if we were to run the
server again and run the web app the BPF
and then we log out register end of 6 to
contact to the end of 6 calm password 1
and we're happy that that all works we
now get a result the login result or
rather the system register is all but we
call the lobby result we've got the
email we didn't pass you by pacify we
didn't specify a first or last name
we've got a token we need for the email
or rather the login sorry that's the the
login token the JWT token and then we've
got the username so all the same stuff
and now handle successful login just the
same so now it should take us here and
the settings page has the correct info
in the new info so we've now
successfully logged in with the new user
if we restart that then we should still
be logged in as that user if you will it
should still restart and have the new
info in because it's in our database but
the difference now is we have no
the email wasn't verified basically
which is something we want to do so
there's a lot of things for you to clean
off to add so we want to add like the
e-mail verification and verify that we
want to then inside the word application
have some kind of banner that says your
user isn't currently you know you
couldn't have verified your email please
verify and click and then we'd like to
potentially clean up the UI on the
register page I don't know what stage
would go back it depends on the time I
get to do it and I want to try and fit
that video in as an extra video but
basically I think the next next stage to
this is to do the e-mail verification
and actually send an email so there
should at least get us to now having we
have an active or working register call
where you can now create users which
also sign in so I think this is a good
stopping point if you like what I'm
doing you like to support me I do
mention I have a patreon page now so
everyone wants to you know donate to
what I'm doing as much appreciated if
you got any questions about anything I
doing the videos and the comments
improvements suggestions anything leave
them in the comments and I always get
back to every single comment that you
know pops up so you know do that if you
like and hopefully again this video is
useful and I'll catch you in the next
one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>