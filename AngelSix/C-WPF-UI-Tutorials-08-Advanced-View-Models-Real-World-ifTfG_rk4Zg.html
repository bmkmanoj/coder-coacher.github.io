<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# WPF UI Tutorials: 08 - Advanced View Models Real World | Coder Coacher - Coaching Coders</title><meta content="C# WPF UI Tutorials: 08 - Advanced View Models Real World - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/AngelSix/">AngelSix</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# WPF UI Tutorials: 08 - Advanced View Models Real World</b></h2><h5 class="post__date">2017-03-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ifTfG_rk4Zg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in the last video we finished up this
login screen for our processor would
just application we added this nice
slide in animation and then we also got
the email on the password box storm and
collecting this currently just slides
out as an example I was going to move on
to page navigation to go to different
pages but I think what we should first
do is actually stop and finish the view
model binding properly so everything
going forward will be bound with your
models so right now these are doing
nothing so the first thing we want to do
is need to update the space page because
every page is going to be bound to a
view model we are going to change this
base page to a generic class now I'm
jumping over a little bit here because
everybody wants the WPF videos so I'm
going to breeze over effectively generic
classes and expressions and a few things
and then go back and the next few videos
are going to explain in detail you know
what generic classes are and some of the
things that are more advanced that I'm
going to breeze over so a generic class
ensure we do these angle brackets we
give it a name of anything we want in
this case VM for view model we just made
that up and now inside this class we can
use that so we can now make a variable
of type VM which is completely unknown
it's just we haven't told it what it is
but we can now use it inside the class
and we can call this view model so we'll
make a profit Avilla view model
associated with this page and now in the
constructor we can set that up as our
data context automatically and we will
want to for now create an fatass enquiry
let's just change this to a private
member
3m called mu model same as that and then
here we want to change it from a get so
we turn the view model but on sex and
the first make sure it's changed their
hasn't and just do nothing
otherwise we want to update the value
let them play them out
well for one we want to define at least
tell this VM oversized that it's going
to be so we do where VM :
and it's going to be always be a base
view model because it's expected to be a
view model now we can compare them we
also want to once we've got a new view
model we want to set the data context to
the view model so effectively that's
what we're doing right now but manually
so this is now an automatic way of
whenever we just set the view model via
this generic import it becomes the data
context of that page so again I'll
explain more about generics in another
video I just don't want to waste this
video going over just generics and not
doing any WPF and then by default when
we construct a page we want to make a
new view model so just new the animals
going to complain as well we need to
tell it that we can new it so you'll see
I'm having to effectively tell the class
a little bit about VM so it can do
things like making you you know making
new VM because it might be a struct or
an int or something that can be nude so
we're telling it that it can be nude
we're also telling it it can be a base
view model well it has to be a base view
model or above so we've now made a
private member for it when we set the
public property it sets it and also set
the date data context and then in the
constructor by default we're going to
create we're going to set that's wrong
let's stop view model equals that and
then that'll do it create a default view
model so when you're just making your
page it's going to be like doing say new
login view model which we're going to
create and then you can always override
that and set it afterwards if you wanted
to do like restoring from you know
cached view models to remember their
username or things like that but for now
that's going to get us a view model in
the base view model
and now this page is going to break
husbands on the app but it will there we
go so now we've got to tell this base
page it's no longer just a base page we
do behind here first which is easier see
now our base page you can't just be a
base page we need to tell it about the
view model so to do that we need to
actually make the view model so let's
make a new file just copy and paste this
one login view model open this up
spanned everything if you want to expand
or collapse everything control a selects
everything control and then M for mother
mmm twice will collapse everything and
then mmm again will expand everything so
if I'm doing a new class and I'll copy
and pasted what I first do is select all
mmm to close mmm to open everything so
that now everything's expanded and
quickly we're through and delete what's
not needed and clean up things so just
delete that we name this to login view
model view model for a login screen and
then we'll delete these we'll come back
and add them in a moment basically get
rid of everything just keep the regions
keep one command cuz we know we're going
to need lot this is a login view model
don't want anything in there we want to
create one command which with a login
mom we'll come back to clean up canal so
and there's no private helpers so the
login view model is now blank lamar's
I'll just fill this out because it's
nice and easy
so the login view model we need to bind
to the login page so we need an email a
password and a login action in order to
you know do something on click so we'll
have public string email
email of the user now the password or
gaps on this will be a secure stringing
so you never want to store strings in
memory secure strings are okay
so let's read that represent the texture
should be confidential the text is
encrypted for privacy when being used
and deleted from computer memory when no
longer needed so we're okay to use a
secure string to store the password we
still want to be super careful with
anything to do with the password you
want to keep it in memory as as short as
possible but should secure stringers
encrypted to define you know it somebody
tries to inject into your applications
running memory and extract password this
is written by Microsoft so it's you know
it's secure it's going to keep that
password safe so what you'll find the
issue in a min is binding to this as we
already know with the password box
you can't bind to the password so I'll
show you how to get around that in a
minute there's the two properties we
want a command now called login commands
for when the buttons click the login
remember to log in and the constructor
we want to make that and in order to get
around this password issue that you
can't bind to so this won't be set what
we're going to do is when we click the
login button we're going to have a view
pass in the secure password at that
point in time in memory so this relay
command that we made even though when
you execute you can have a parameter we
don't pass it in to the action so we
just want to copy and paste the relay
command and just call it relay
parameterised command open that control
and a control a mm-mm the open applicant
change this to
dramatised command fit like everything
stays the same the action is now going
to have a drink nips and objects the
parameters custom that'll stead of
saying the instructor will match to
patent a parameter to the action and
then the execute or pass that parameter
along so all we've done is passed along
the parameter so that now when we go to
our login command we can change us to a
parameterised command and in here then
we'd have the parameter given to us and
here we want to call our function which
will be asynchronous as well so add
async there a wait here and I'll login
function here control dot to create the
method remove that out of there like it
there make it public we'll do a sync in
a moment attempts to largely use it in
and this will be the secure string pass
in from the view or the user's password
so this will make a lot more sense at
the moment when it opens together but
all we've done is created a command
which created before
so we're command is take just think of
as a function in a view model almost the
view models shouldn't just have the
functions called
this shouldn't just be called what we
should do is in the login page this
button where we've got this click we
don't want that but an old way of doing
things
instead you want to command and the
commands we can now bind to our login
command and that will then go to this
login command this login command will
effectively be a relay parameters
command which is nothing more than a
wrapper we made to call
actions so effectively it means that
when this logging command gets clicked
or run by the button all it does is run
this lambda which effectively just runs
this action so the whole thing just
boils down to you bind a button that you
bind this command to a buttons command
and then when that button gets clicked
it goes into here it gets to here
because this is my command and when it
runs execute we call the action which is
the thing we passed in in the
constructor which is this thing here
which just calls the login so the whole
thing you click the button and
effectively you hit this function that's
always doing it's just a the way you do
it in view models so any any action
anything you want to run as a function
if you will it's basically a command the
thing with commands is you're not meant
to pass anything into them so you can
see there's nothing a command is just a
command there's a one thing you can pass
in and that's a parameter and that's
like a workaround if you will you should
never really rely on passing parameters
but in this instance for getting around
like the password box issue this is
going to be the solution so as well as
the login command
we're expecting a parameter to be given
and that needs to be a secure string so
that we can then set this password up in
fact you wouldn't even technically need
this password on the view model because
you can't bite into it anyway so you can
get rid of that without no privates on
here and then in the login we will do
because I want to simulate the login
happening but now let's just do a way
task delay and you'll see again in a
moment just do half a second delay for
now we now need to pass that parameter
anyone we click so let's propose that so
we get here button command you also want
to now do command parameter and for that
we need this password box's secure
password so first we can name this
password box so we'll just call it
password text
then the command parameter can now bind
and what we'll do is bind to an element
name of password text which is found and
the property is secure password so with
the command parameter will become a
secure password with a password text
from a click log in command so I don't
know whether we can run this yet I don't
think it'll build but we'll run this a
moment and you'll see in here then we
could do of our password and it'll still
be secured if I we can just look at
parameters when we get to there so let's
just get this building and I'll show you
that happening basically model while
were we
we don't want that anymore much clicked
so the Lafayette so login page now we're
doing the login view model we've done
that now for the most part so another
base page of the login page we open up
these angle brackets and was passed in
the type login view model and that's now
the generic class so this base page now
is a base page of type login view model
so now we all have a public property
that's of type VM so effectively of time
login view model for this for this login
page so now we did here this top view
model you'll see it actually knows it's
a login view model it's not just a
random type because it's hard coded
there so you can resolve any knows so
now this login page we've got a view
model property that's of this type which
is you know one of the uses of generics
so we've done it there we don't need to
also specifies in the sam'l because you
also declare in your exam or what type
it is and right now just for this base
page it's not a base page it needs to
have the type so you do this X colon
type parameters local call one because
this local here is for setup word
namespace and our login view model is in
the fucecchio word namespace so we tell
an extent here and the name is this
login view model so it's login : that's
a local : login view model and that
should now resolve and I think should
build
yes it does now built so we've
effectively change this base page to a
generic base page which can now have a
view model past the end which then
automatically sets up the page for the
data binding to this view model so
before we go in and bind the rest
we've already bound the command which
was actually the hardest one to do but
we've done it already
we've just specified a button to have
over on this one
the button to have a command bound to
the login command
and we've also passed the parameter of
the password text box so let's run that
click the button and we should hit this
function here so there we go and you can
see the parameter should be yes the
secure string of the password box which
is nothing haven't typed anything type
something is seeds
nothing I'm guessing you just can't tell
for max it's actually a secure password
so now we need to decrypt let's password
you need to get it into you know well
yeah we do because when you pass it to
your server you need to know the actual
password attacked but also we want to
just make sure that is working right so
let's just create a new folder called
security
we'll do secure string CalPERS now let's
just be a static class purpose for it's
going to be using system dot security
purpose for the secure string plus and
this is going to be fun to try remember
we want a probably fluffy
string because you need the strings
we'll call it on secure that's what
we're doing we'll pass in this
secure string and this just means it's
an extension method so if we have a
secure string we can just do secure from
dot and then call unsecure so we'll call
this the secure password give it a
description unsecure a secure string to
plaintext secure string so first you
wanna check we've got one so click yeah
secure string is no return I guess
string dot empty this is you know they
don't know that it's there so make sure
we have a password why hey if your
string doesn't need to be a password it
can be anything probably we name that
and then we need a unmanaged shrink
because this is going to be allocated in
a special way so it needs to be an int
pointer in memory then we need to try
because we need to clean up regardless
so we're not going to actually catch any
address we're going to let crash if
there's an error but because we're now
going to be doing some memory allocation
here whatever happens even if it crashes
we need to make sure we clear up after
ourselves so to clear off you just do
marshal control dot to finally name
space marshal box zero free which one is
er it's the global Alex Unicode I think
let's just be off memory so you can
always Google this but I'm pretty sure
this is right on money string so clean
up any
commemorates allocation allocations one
hour thing is it next to else exactly is
up and then we want to get the done
manage ring I want to set your money
string to I think as a company a secure
string to a lonely global our Kuna code
I think so and I'll take the secure
string so this unsecured is the class
word and then we wanted to return the
effects of the pointer that string in
memory so that it returned as a string
it looks like a normal string in c-sharp
but it's really a pointer to a unit
while there's basically a string we just
allocated it in memory a different way
so it's a pointer to a string we made it
unicode and the pointer is the one
manage to string I think that's it so
again you don't really need to know like
understand this I wouldn't worry about
this this just takes the secure string
and then uses the marshalling to set the
actual password to a location of memory
and then we convert that location and
memory to a string which is what we
return so it's a bit more like C++ code
and lower level stuff you really don't
need to worry about this but there's
your unsecured function so now in here
we know the parameter is a secure string
and now on that secure string we can do
dot unsecured and it's found our helper
method which you can see this one
because we did this it allows us to do
the actual scoring dot and then unsecure
let's just first test that works put a
breakpoint there run and let's just type
a password
one two three don't okay that didn't
work so oh I know all I I think we bound
to yeah you can't do this you can't bind
to the secure password because then this
is like we mentioned this is the issue
we can't bind to the school password so
we're going to have to obfuscate that a
little more let's make a few model B
yeah add an interface call I have
password and this is going to be just a
interface so an interface for a class
and provide a secure password and this
will just have a secure string I'll call
it secure password it's just a gap so
you'll see why we do this in a minute so
now that we won this view let's page to
provide that password because eventually
our view model the login view model
should never reference the actual view
so they should never have a reference to
anything in WPF now we broke that in the
main view model the window view model by
passing in the actual window but this is
sort of a very unique view model this
was to make that custom window so
although it's 90% valid view model you
really shouldn't pass in any references
because now this is stuck to a WPF this
view model can no longer be used
anywhere but in WPF so it don't sort of
take this as gospel but in general when
this application grows we're going to
move these log and view models and all
view models into a core project that has
no reference to WPF so we can't pass in
say a password box here because then you
can't move this then becomes dependent
on WPF and the
whole point of view models as there's no
dependency to the view its it knows
information about how a view should be
but it doesn't know anything about
specific view so we should not reference
a password box we can reference secure
string because that's just in a dotnet
library so what we're going to do with
this will be in WPF because it's the
actual view and we want this to do the
work of passing in the secure strings
but we still want to do it in like a way
of binding so now instead of binding to
the password text to then after bind to
its property let's bind to this page so
it's called element name page and let's
just name the whole page so to extract
name and just colic page so now we've
bound the command parameter has bound to
the page and the page now we want to
implement I have password so that in the
view model we know what we've passed in
at least implement this I have password
I just press control + dot to then
generate this for me so please secure
password for this view or as the login
page and then here we want to return or
we don't need to return it so we just
need to say so we named the password box
password text so it's just class word
test dot secure password and that's then
this is like a new c-sharp 7 I believe
it is way of doing a the same as this
making it a public gasps a property
which would then be like a young return
something like that anyway but basically
it replaces this just need to do a guest
of at all the views do that it actually
turns into as you can see a public
property that's only a getter so now the
login page and how it's I have password
and that has this property here and then
when it's called we actually get the
secure password
so if we boil down to the view model
again the parameter now we're expecting
to be and I have password because we
passed in as you see here we passed in
the page which is this page which is
implemented in this interface so that
boils down to being and I have password
as the parameter it's better basically
the login page but we we shouldn't know
about the login page we only know about
the password and then on that we should
have the secure password property and
then we can unsecure it so that should
now work because now we're using the
login page at the point in clicking that
button to then ask for the password and
then there we go 1 2 3 so the reason it
didn't work when we bound to the secure
password is because binding happens at
the point when you do the binding so
when we bound to the password secure
password field at the point we bound on
we open the application
there was no password and because it's
not a view viewmodel bindable property
the secure string is just that doesn't
notify when it's changed when we tap the
new password in the secure password
never come back and told us it change so
we only ever had the first value now
we're binding to the actual page itself
that never changes so we're bound to the
pages and when we do this secure
password all that does is goes to the
iHub password of a login page and then
it runs this at that point in time to
then get the password at that moment in
time so you put a breakpoint on here and
a breakpoint on the action here and we
run you'll see nothing hits that get
password but when we click they get
password well we click the login button
with it then asked the login while the
login view model now wants to get the
parameter which as you can see is the
login page it's secure password so
you've run over and you can see then
it's now asking for the secure password
at this point in time and then once you
do that we decrypt it so that's now the
password field battle that with a hard
work
by the way you'd never do this either
you'd never just take the secure
password and unsecure week into it just
a bog-standard valuable this was just to
show you the password do not do this if
you're doing an unsecured make sure it's
always been passed into the function
that's then going to send it to the web
server so it's never stored in a
variable didn't just never store an
unsecured password and so let's leave
that in for now the other ones now
either you want to bind to the email so
go back to the login page we don't need
that now go to the email and just do
text binding and email and remember this
now we'll look for binding it will step
up the tree so this doesn't bind 2018
this doesn't mine 2010 this doesn't bind
this doesn't bind it gets to the very
top which is waves or stop and because
our base page which is this base page on
construction create the view model and
then the view model when getting set
sets the data context this is now the
the binding this is the binding for this
page so it's a login view model so then
here because nothing else going off
binds anything explicit to a new data
context then this binding is relating to
the login view model so then we want the
email that's on the login view model
which is this so again if we put a
breakpoint here move our email equals
they start email just for clarity and we
run this
and we'll tie some lovely real email
address and you can see that as the
email so we've now got the email on the
password and all that's left to do is
actually log in so we found to the email
we've bound to the password now we want
to run an action now you'll see that
this is an asynchronous touch because it
can take time then when you're logging
in it's not instant you've got a
specific weight and indefinite amount of
time and then you've got to actually you
know do something so what I tend to do
on view models is you want to flag so
like a public boolean called and really
for each command so we want to know say
this command is running if you if you're
logging in if you will of you in the
middle of trying to log in so of course
log in is running a flag indicating of
the login command is running because
there's a few reasons why if we open
this now and we click the next button
it's going to run this option now it's
not going to wait first action because
our command is basically going to call
our action it's not going to await the
action and doesn't know it's in a way
double action she's going to call the
option and then because we have made it
asynchronous here and we've awaited it
here that's fine but the actual button
click doesn't await this so we can click
the button this action could start
running and if we did a delay of 3 that
well as 2 5 so it's 5 seconds and we
just put a breakpoint and we run and
what I'm going to do is can click the
button say three times and you'll see I
can do that it's going to let me do that
it's going to run this action three
times so I'm going to go one two three
and then you'll see now we'll hit this
when that time has run out we hit once
we hit twice we hit three times so
that's not what you want if somebody's
logging in and you click this button you
expect it to to show like a spinner or
something and then when you click it
again nothing
you know the standard way of doing a
login so we need to do that so in order
to start doing it in view model binding
and in general what you'll find you need
this in a lot of cases you want really
this login command to have a at the
start say let's do it manually
you'd say check if it's running already
so it's login is running and just return
so don't do anything and then once
you're in see it you do login is running
equals true so now you're running the
option when you're finished you do login
is running equals false so that kind of
fixes the issue so if we run this and we
put a breakpoint here and then we click
the button three times you'll notice
effectively will only hit once because
it'll hit once this will get set to true
we'll wait and then the next two clicks
will hit this that's true and just
return so in click three times and
you'll only hit this once and there we
go now the issue with this is what if
something went wrong here so so new of
your man no exception
Alice well this might crash the
application something on the UI the red
spot will find out so if we now click
yes we're going to complain yep going to
crash so to stop that happening because
this you know you're probably going to
wrap these in exceptions and catch them
anyway so just basically ignore that the
failure for now so wait what's wrong oh
yes another hit so I'll click it it'll
crash but it's caught so nothing's
happened but now what you'll find is say
you've recovered from this one time
issue this was something like the web
server turned out you've never reset
this value so now when you click it's
always true you're stuck in this
permanent never being able to reset with
the only place where we set here say
this error happened once like say the
web server timed out
you're now never going to have the login
button working because it's permanently
stuck as a
you know it true so what you could do is
move this to outside the Tri or rather
all of this outside the Tri say and then
you could move this vlog and is running
to a finally statement and the finally
runs regardless of it crashing or not so
this will always always run even if we
crash so now you'll see if we run it'll
go into there it'll crash and then it
will hit Folsom reset it
Cinci reset so then every time we
collect it or carry on trying the basic
idea is that when you start doing an
action you start running this locking
command you want the flag that you run
in it that means that your UI like the
button could also show a spin at while
this is true and then whatever happens
whether it finishes or not you want to
make sure you'll know when the function
is finished but instead of doing it
manually like this which is a bit nasty
we want to do this as like a help
function so I'll use some expressions
here now to do this and this gets a
little bit a little bit complicated it's
easy but something you're like don't
think you'll have seen before
and again I'll explain in a separate
video so we want to start with the base
view model we're going to add this as a
function to the base view model
we're gonna put some command helpers
here and we're going to call this thing
that we want to do run command so we'll
make it protected because it's journeyed
to be used inside the view model
asynchronous going to be a task that you
can await we'll call it run commands now
we want to pass in something called an
expression an expression is sort of a
runtime thing that you can create an
ex-pro you can create a function of UL
almost in like this say and instead of
it evaluating at this point in time an
expression takes this and then at the
point in time you want to run that
expression it
it runs at that point in time so again
you'll see why in a moment and so it
wants to be an expression that just
means well you don't want to be running
right now you want to be running when we
do you know at the point in time we want
to run it out at run time must be a
function because we want to get some
value and we want to get a true a
boolean true or false and because we
want to and that'll be the updating
flood we want to get the everyt updating
owner and then we also want to set at
the same time so we'll have a function
so classical for action just get this
fleshed out of it this will be under
command of the updating flag as in you
know login is running if the updating
flag is not sir
so we're doing what we just didn't
manually but this is a better way of
doing it is not set remember command if
the flag is not sir as the flag is true
the function is already running on this
case indicating that then the action is
not run as the flag is false indicating
no running function then the action is
run
then once the action is finished every
run then the slide is reset false don't
have to decide that then so you know
what it's doing because we've showed you
this is the the boolean property slug
defining if the command is already
running and then the actions can run if
the and is not already running so we
want to check if the flag property is
true meaning the function is already
running it's a simple case of what
fairly temp opposites updating flag this
is an expression so you can do basically
it's a lambda expression because we will
pass in if I let me show you how I
intend to use it so what we'll end up
with here is we want to do a wait run
command which is started doing the
aerbook I'll show you what it looks like
we're going to do a lambda expression
like this and we want to pass in this
stop login as running so the thing we're
passing in the expression is this but if
we pass this in directly then we can't
edit this value as well so even though
we're passing in we're not passing in a
boolean here even though it looks like
we are we're passing in an expression
like the whole thing that will actually
allow us to extract this property and
set it there's a cool way of being able
to set and get properties because you
can't pass properties as reference you
can't do at ref so it's basically like
in a ref book this is how you can do it
on a property because the view model
needs a property so we pass in this
lambda expression so we know this
expression is a lambda expression we can
even change it to lambda expression
there if I could spell write lambda
yes we like to lambda
from the visual studio is just other
that's just not smart enough to detect
it a minute oh because it's there
yeah strands ever yeah liters expression
we want this we'd compiled the
expression so this is like a runtime
compiled to turn it into the function so
let's put in some time now we basically
just got a function that's going to be
Turner boolean and then you can invoke
that function to get the value so this
will take this compile it into just this
and then invoke it to effectively just
get the property so that's how you do
the getting the property as you know get
the property value instead of putting
this here I just move this into a helper
function so did we make an expressions
helper now okay let's make a new folder
and again they're worried too much about
fully understanding this because I'm
going your separate video on expressions
I'll try and at least explain it to it's
useful so you can at least follow what's
going on make a new helper class a
helper for expressions and we'll do a
slow study and we don't know the type
we're going to do a generic type of
guest prophecy value of that time this
is going to be the expression of a
function of whatever type which besides
so basically the same thing we're
passing them
and that is going to be the lambda and
then we just return the lambda and then
paste that so all that done is moved
we've got an expression of a function of
in this case a boolean we've turned it
into a generic prop denoted function
that's exactly the same but can be of
any type it can be a string and object
to class and we just compile and invoke
it so let's just simply some files an
expression and get the function return
value this is the type of return value
and the expression is compile so all
that all that does is takes this
expression of a function which is here
and get the value so it guess the login
is running value so the login is running
as we mentioned when we did it in here
if login was running we just return so
if the updating flag dot get property
value is true then do nothing that's
that there that's the first bit of the
logic and then if not we want to set the
login is running like we did so now this
is where it gets fun so now we want to
set the property flags for true to
indicate we are running in order to do
that a little bit more tricky
so we'll do updating with large offset
property value and we want stuck it to
true in this case we now need to go make
this property let's method rather so
it's a little bit longer than this one
going to be probably static void we
don't return anything set property value
Astarte this expression of a function of
t lambda set the underlying properties
value to the given value from an
expression that contains the property
and this is the type of value set and
the expression so first we need to get
the expression and this is going to be
and we know it's a lambda expression as
I mentioned because that's the only
thing we're passing in this is a lambda
expression because that's just weight as
so first you want to convert that to an
expression equals and basically going to
be the lambda we passed in called a
lambda even though it's currently just
expression as lambda hilarya lambda
expression so it's we know it's a lambda
expression so we cast it to that and
then we need the underline expression
here which is a member expression so
it's going to be the body of that
expression as a member expression so
this converts a lambda
summed up properly - summed up prophecy
so basically gets rid of the lambda and
and turned it into a map you know it
property about this member about summed
up property then from that expression we
need to get the information about the
property because anyway we can set this
property now is through reflection so
get the property information so we can
set it so profit info is property info
of the and the expression member so the
member of the expression is the property
itself so that's the number so we get
remember like that and then we need the
class that this member is on which
because we passed it in this here we can
get that we know what plus s is on so
we'll call up the target that is the the
Posten lunda we compile that and we
dynamic and vote that so we invoke it at
runtime that will be the target itself
and again I'll explain this a lot more
in depth in a separate video and now we
can use the property info to set the
value and it's absorbing so the classic
come from and then the value we want
which is reserved a value passed a or
the value and a whim pass the value in
yet the real physics have passed the
value of type T n so we know what we're
setting a value to set the property to
value that's a property value another
debug through this so you can see what's
happening that wasn't too bad it's
actually quite small bought we can now
pull the run command which has the
updating flag which we've passed in and
then the action to run so then we want
to actually run an action at once be
asynchronous before pass it in removal
right into there and it becomes now this
so what will happen if we run and we'll
step through this nice and slow and it's
fairly simple but like I say don't worry
I'll do a complete video on just
expressions so you understand it more
but you know what it's trying to do so
you click Next it hits this goes to run
command right now login is running as
false so we put a little flag on there
we go into here this is going to ask for
the property so it's going to compile
and you see it's trying to get the
property and as it's compiling it's
false so this will continue so now it's
going to set the property so we step
into that we can see the lamb that we
passed in you can see it there so you
can see it sir
do you see there see there's a lambda
open closed and then it's the value of
the login view model plug-in is running
that's how it's comes out that is a
lambda expression and the body of that
expression we can see here it's just the
value itself as I mentioned some
property so we're taking the lambda with
the outer quotes which you can see there
and we're stripping it out and gain the
body as a member expression and now it's
just the inner expression the value of
that property so that's what we've done
there we've removed the outer lambda
part here and got the expression then we
want that expressions member if now the
actual login is running boolean that's
the actual property itself as the member
so we want to get that we want to get it
catholic to property info which is what
that is so now we've got the information
about the property
from that we compile the lander itself
which is then going to run the whole
thing we've got the target honestly it's
not that it is the run the lambda
expression expression don't get the
expression dot slander so on the lambda
from the expression that expression so
it takes the despot and then converts
that to a lambda and then bokes it to be
like I say I'll explain why but that
will get the target so let's just start
that again click the button go into
there we know that now works tries to
guess it carries on now it wants to set
the property we got the property info we
now get the target which is the login
view model and now we've got the login
view model and we've got the info about
login is running and we can now simply
say prop the info the target is a login
view model which currently has login is
running false set it to true and now we
look at the targets again it's now been
set to true so all that's done is so far
gone is login running if it is don't
carry on because it's already running
otherwise set it to true so after that
we now want to do what we were doing
before want to try running the action
across them so try running the action
and we're going to wait it which it's a
function of a task so it's basically in
a way to bolt action and we don't want
to mask any of us you want to let them
bubble up so we just do a final and this
will just comment there run the task in
action and then finally set that
property
object slides back to false now it's
finished
so now we just do or taking flags on
step property value both there's doing
exactly what we did manually but now
it's wrapped up in this single run
command that we can now call without
having to constantly do this dot login
is running through this table it's false
try finally it basically wraps all this
up in a nice clean run command function
so we can just then tour we know do this
you can see we can now just do a weight
run command login is running and then do
this and now what this command will do
is every time you come in to log in it
will flag that is true run the command
and flag it as false if it's already
running then basically this just doesn't
even run so you'll see we'll hit that
well in fact we quit there yeah let's
just click down there let's run this and
you'll see I'll click the button once
will hit here and I'll have a click it
again you'll see just never runs until
this finishes so I'll click there we hit
that run and now just keep clicking you
see nothing happens and then when it
finishes he'll we reset false and I
click again and it will start again and
over the benefit here now as well as
while this login is running and doing
something you've got this permanent
login is running viewmodel bindable
proxy so now what we can do with that
login is running as we can bind it to
this button and have this button showing
like a spinner so by complete automation
of just the binding you can have it so
when you click this button and it's
bound to this command it will learn spin
and when it finishes it will then go
back to the normal text so let's go
ahead and do that first I notice there's
a sign up what keeps bugging me is
sign-in page next is also now going to
be
login
and so we've got that we've got the view
model let's think this through
we now need an attached property for
this button because we need to know if
the buttons busy or not let's say in
fact well will improve the style of that
all the buttons in terms of the standard
button so where is it regular born so in
here we want a new attached property
thanks to the previous video we can do
attached properties really easy so copy
and paste that button touch prophesy get
rid of that and then we'll just call it
is busy property I don't need the helper
that we added for the last one either
and this is busy and it's a boolean the
is busy attached property for anything
at once to flag if control is busy and
that's all the list to making an
attached property thanks to the space
attached property and then we want to
use that we already used it in text
somewhere so as text there we go let's
copy that paste it into here so just
keep remembering all the syntax is busy
property value by default it's not busy
so now all regular buttons will have a
yes it doesn't exist if you're something
compiled it's going to happen is busy
flag and then by default it's false so
what we'll do for now is let's get this
what we're going to do is add we're
going to add a little spinner over the
top so instead of just having the text
which is here
let's just for now make a grid plug this
inside the grid make another text block
and want the visibility which we've also
done again in the text thing this
visibility we make this text block
visible too is busy value boolean to
visibility convert so we need to edit
because right now
by default that the value is true we
make it hidden
otherwise it's visible so we want to
make use of the parameter if the
parameters no so we keep the standard
behavior for wherever else we use in it
otherwise if we pass any parameter end
we're going to return the opposite so
it's like a way of toggling whether the
boolean is true or false by invert in
the boolean because in this case if
we're busy we want it visible so
basically if it's true we want it to be
visible so that's what this is going to
do so we flip them around and then we
just pass in a converted parameter and
just it doesn't need to say true it can
be anything we've only checked every to
know or not so the text block here will
be visible when we're busy we'll set the
text too busy say how are you moaning
about now oh yes it's just need to
compile and I think and then this text
the main one we're going to do the
opposite so get rid of the converted
parameter we want that to be visible
when it's not busy invisible when it's
busy so I think that should compile I
use just complaining because it's not
compiled yet well I can play it about
can't resolve property is busy local yes
you can
okay maybe we need to compile before we
Asbury property yeah that's all fine
hey maybe we just need to compile before
this thing will allow us to use it
yes it does okay we just got clean
solution solution
it's busy about missing something here
it's busy out property yeah cause the
word property is busy property there we
go
so we just run mess I think I've done it
again mayor I need to is believe
properly and again so now when we're not
busy we should see the text and when we
click it didn't worry off it's busy
property
oh yeah we're not changing is busier we
need to actually bind is busy so now we
got the attached property there's a
federal judge couldn't I'll listen out
for this this value we go to the button
itself which is here and we now bind the
attached property as a binding to our
view model of login is running now the
button will be busy if the login is
running so now we should see the text
change from login to busy hopefully yeah
there we go another five seconds I'll go
back to login there we go now want to
change us all for looking text to a
spinner and that's our sort of we're
busy wait till we finish type appearance
so as busy we've done all that we now
want to make sure this is aligned the
same as these four one let's at least
fix that
the font-family now in order to the
spinner I'm going to use there's a lot
of ways of doing it again really easy
way of doing it go to font awesome
so in web design you tend to do fonts
for a lot of your icons and font awesome
is a very popular one so it's goes to
font awesome
click download get the regular one open
up the file go to the fonts folder get
the ttf extract it to anywhere else go
to desktop go back to your solution in
your fonts folder where we've got the
other fonts add the existing item and
then go to desktop or wherever you put
it
add the font awesome go to your styles
for the fonts copy and paste the other
one phones awesome this is going to be
font awesome now we can use that font we
can now set this or the font the busy
font to font awesome and we want to some
family template by an infographic now I
think we saw spawn - awesome I got the
fonts that's fine now we go back to the
fonts go to icons search for spinner
which is there right click and inspect
and then you can see in here you'll see
an eye if you expand the eye and click
the before you'll see their f1 10 is the
specific value so that's the one we need
to use and then we'll get this this nice
icon a vector icon so the textures that
have been busy quantity and hash so what
is it now and harsh x and then the
number f1 ten semicolon that's like
you're special we're doing the text so
we run this we should now see I think
the spinner icon and there you go so
already we've got a nice spinner which
what about spinning so let's go now make
that spin so we'll do that with a new
text style we want to make a new style
minimize everything target type is going
to be side text block ex-con key is
going to equal spinning text based on
and I'm just copying the this one here
I'm just looking at the standard what
I'm doing there static resource base
text block style third you base text we
want to storyboard to animate so style
dot resources or is it storyboard make
key for so can access it I'll call this
spin just want a simple double animation
for rotating storyboard dark target
property is the UI element
dot surrender transform because it's an
attached property dart and then another
attack property rotate transform angle I
get space of the angle of the render
transform that we're going to do want to
go from zero to 360 on to full spin will
make it take two seconds you can change
that to whatever you like and we want it
to repeat forever so and it's literally
as forever or something
wherever says the animation to spin a
row render transform indefinitely and
now we want to trigger that when it's
visible so it start the animation so in
triggers you want the data trigger on
binding as relative binding or relative
source rather is the relative source
self so bind yourself basically
cuz we're in a style trigger we need to
get back to the text block so we're a
relative source to ourself we want the
path to be divisible the frosty on that
is visible and the value to be triggered
when it's true so when we are visible
then we want to data trigger dot
interaction so when it is visible we
begin the storyboard the name will call
spin storyboard and the storyboards
itself that we want to begin is the spin
one we just made
and then we will copy and paste that
exit actions again and then remove
storyboard begin storyboard name as spin
storyboard so basically when it goes
visible we start spinning forever when
it goes invisible we stop the animation
just so it's not running oops we need to
apply that style as well so stop that so
while we're in here spinning text we
might as well apply the actual property
as well so let's do the property of the
property of font-family value of static
resource funds awesome
so on this property text and that value
will be the end hash ex-air form can
slap the spinner icon and then we want
in order to apply a vendor transform
like this we need to actually have a
render transform so we need to set one
here well we'll have to set that on the
prop the actual text box all we will do
anyway just for quickness but we need to
set the origin so it spins in the center
let's render transform origin value 0.5
0.5 basically X&amp;amp;Y and it's a from 0 to 1
so spin in the middle that'll be got
spinning text as a style we go to the
buttons we need to add the text to here
because
we need to rap and style for this box
here it's going to be statically to a
spinning text we've now defined the font
family we define the text the visibility
is specific to that so is this and let's
see if that works or things I might have
to define a render transform but let's
see of that now styles and animates when
it's visible now so we need to define a
render transform so render transform
rotate transforms that's what we're
doing and 0 I think see if that works
because obviously you need to actually
add the transform initially there we go
so now it spins and there's our loading
animation while we're busy and that's a
nice way that you can click in nothing
on half until it's done and then this
could be doing your login so let's move
this off to the style so didn't have to
do that for everyone and go back to the
text so we should be able to do set the
after property render transform method
up while you rotate transform I think
that'll still work
and there we go so now we've got like a
spinning textile that appears when we're
busy disappears when we're gone we've
got everything bound the email and the
password comes in through the parameter
through that function we're gonna SH
ending animation we've got the entire
login view model done ready to actually
just now do your your actual login to
the server here and then do what you
want after that again a note do not do
this just do not play so impressed
I'll put an important never saw on
secure after a variable like this so
you'll see this will get removed after
but now you've got a nice little run
command we can do on any any action any
method or command that we want to run
and effectively offset a flag that we
can then bind to do things like the
button showing and spinning you can do
whatever you want to do with that you
know is busy you could disable the
button as well so you could actually go
as enable bind to login is running and
that is that's the opposite way around
the pink obviously isn't active it's
running it's enabled so we need to just
do a an inverted boolean there which I
can't be bothered to do at the minute
but you get the example you just make a
value converter to flip that around and
then you could have a you know disabling
as well but I prefer just to stay the
cortes and just show that it's busy I
don't like so disabled buttons are like
them to stay functional they just clear
that you know it's busy doing something
so I think that's really it for this
video we've we've done some real world
view model binding so we bounce the
email we bound to the password you've
seen how to get around something a bit
out of the ordinary for view model
binding so we've never bound to this
directly yet we've still done it with
view model binding because we've used a
button with a command the next time
parameter which we've bound to the page
and then in the page we've added a
property that we implemented with an
interface there's like a I could say a
real-world example because view models
never just works the odds there's always
exceptions like you're seeing with the
password text it's the good way of
seeing how they actually come together
and really work so I'll try and do
another video soon but hopefully this
one was helpful the next one will
probably be on generics and expressions
and then we'll jump back into doing the
register page and then getting on to the
main application page showing there you
know start doing some chat bubbles and
things like that so hopefully enjoyed
this one any comments or requests or as
usual if you want to know something here
from the stand or something you want to
do in the next video or anything just
leave the comments and I'll get back to
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>