<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Full Stack Web App using Vue.js &amp; Express.js: Part 6 - Search | Coder Coacher - Coaching Coders</title><meta content="Full Stack Web App using Vue.js &amp; Express.js: Part 6 - Search - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/freeCodeCamp/">freeCodeCamp</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Full Stack Web App using Vue.js &amp; Express.js: Part 6 - Search</b></h2><h5 class="post__date">2017-09-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ipYlztBRpp0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone this is Cody and welcome to
part 6 of building a full stack web
application using view j s and express j
s so in this part what we want to do is
we want to add a panel up here which has
like an input box where we can search or
have a user search for artists by name
title genre or whatever they like
so let's go ahead and get started on
doing that so to start off we just go
ahead and go to that client and go to
that view so if you remember here we
have this song's file which is basically
responsible for rendering that view here
and I think this Val is gonna get kind
of large over time so let's go ahead and
make another folder called songs and we
can just click and drag that songs that
view into that and I'll rename that into
index so then we can go to our router
and we can go down here so wherever
we're calling songs before I think we
need to import it from song slash index
so refresh the page make sure that's
still working and it does so at this
point I would like to kind of pull the
two different panels so we're gonna have
a search panel and we're also going to
have a the display panel so I'm gonna
say songs panel W and that's going to
contain all of the information related
to the songs so in fact I could probably
just copy and paste that right so
basically what we want to do is have
this songs panel fetch the songs from
the database or from the back end and
display them instead of having and done
in the index so if we were to just go
over here and I'm going to kind of
refactor all this and remove stuff we
don't need so we just want it to be a
panel here which means we can get rid of
all that and unint
so just to kind of link this up let's go
ahead and go down here and import the
songs panel from the module relative
passes this time from songs panel and of
course I'm going to add that to our
components so then I should be able to
just delete the previous thing we had
there and say songs panel go ahead and
close off that panel there or that Dom
element and then should just render as
before so that should make sense as to
how and why we refactor that and the
second panel we need I'm going to add a
new file called song search panel view
go ahead and scaffold that up and this
panel is going to basically have again
we're gonna have a panel so oops and
this was going to say search and if I go
back to the index I want to go to song
search panel and include that one also
included as a component and make sure
that something renders for that I don't
think I actually added it yet so I'd say
songs search panel and then again close
off that Dom element so we're getting an
error saying panel did not register
correctly and what I'm starting to
notice is that almost in every single
view we have at the panel thing included
in the components so what we can do
instead is I think I said at the
beginning and it's not with that for
Global's but I think in this case we're
having a lot of Global's everywhere so
I'm going to go ahead and just make a
new file or folder called Global's and
I'm going to put that panel dot view
into that Global's file
and inside our app you are sorry are
mean we can just go ahead and say import
panel from and I'll say component size a
global slash panel and here if you
wanted to define a global module that
you can use in your entire application
you can save you dot component pass it
the name and then pass it the actual
component object so if I were to save
this I think a lot of stuff might crash
because I moved the location of panel so
while I'm at it I'm just going to go
ahead and find any instance where I have
panel in fact there is a lot of
instances so instead of do import panel
and basically anywhere I have import
panel I'm just going to go ahead and
remove and I'm going to just remove it
from the components too so bear with me
really quick as I do this really quick
refactoring task and then this will make
our code a little bit easier to manage
because obviously if you're using this
panel and every single component why
exactly are you importing it as a local
alright so there's like five more to go
almost done
bear with me sometimes it's fun to just
listen to music and do these boring
repetitive tasks when you're programming
but oftentimes it's also not fun to do
something like this so so at this point
I think it's been removed from
everything except for this main file
where we included it so if I were to go
back to our app and refresh the page
let's just kind of do a quick check to
make sure nothing broke yeah seems like
everything's working us fine so what we
just did there is we pulled out the
panel component and we made it global so
that now
new stuff we don't have to import a
panel every single time so going back to
what we were doing before if you go to
components and go to songs and go to the
index let me hook good and close some of
these other things first things first
I'm just going to add a little bit of
margin top to that panel so that it gets
pushed down from songs add a little bit
of space there so in a song search panel
what we want to do is if I go to
register I can just go ahead and grab an
existing text field and I'm going to go
ahead and just put it right into the
song search panel and call the label
search and the model will also be
searched which means that we need a data
which has some blank string for the
search model and basically this whole
search thing if I were to save this when
we search through this we want to do
something to filter the results by
artist album so in fact I'll say search
by artist album genre search by song
name whose song title is that's what
we're actually using in our data or
genre must make sure this looks good
all right so the first thing that I want
to do is as someone searching through
this we want to keep track of what they
actually typed in and how it's changing
so in view you have the ability to
create a watcher so I can say watch as
an attribute on the main view component
and then I can say watch as search
changes let's just go ahead and print
out the value of search so now if I were
to say Modest Mouse we see that it
prints out the modest mouse string down
here that's pretty cool so what we want
to do is as a user is typing inside this
search panel I want to go ahead and
create a query string such as like
search equals modest mouse and basically
I want to store this information in the
query string so that people can easily
bookmark and share their you know latest
searches with other friends or whatever
because if you were just try to store
this state and view X or just internally
inside the scope and pass it around with
props there's no way to like bookmark
that so that's why I'm taking the
approach to do the router link up here
so the first thing to do is as we type
in the search value changes we can
basically just keep on pushing a new
route so I'm gonna say cons to route is
equal to name of Songs and then I say
this dot search is not equal to an empty
string so basically we don't want to add
money sign or question mark search
equals if there's nothing to add
so if as long as this is not equal to an
empty string we can say route to not
query is equal to a search this search
which will basically put the key search
and the value that we're doing inside
that route that query and then finally
we can say this dot router that push and
then go ahead and push that route in so
if I were to save this search panel now
and say modest mouse you see how it's
changing the query string force
dynamically so that's pretty awesome now
the next step is if we were to let's say
refresh this so I say ctrl refresh
notice that it didn't set - Mouse here
in the sir
textbox even though it's up here in the
query string so we can kind of handle
that by going down here and we want to
go ahead and add a watcher to the search
query string and we want to say this is
immediate so basically when this value
is initialized whatever it may be if
it's undefined or an empty string or
whatever it's going to go ahead and call
whatever our handler is so in this case
I'll say hand alert value and then I can
say this top search equals value so I
were to save this now and change this to
hello world and hit enter see that it
changes our search in the vice-versa we
can type in and then if we don't have
anything in the text box the entire
query string search goes away all right
so now at this point what we wanted to
do is met it or we can edit this song's
panel down here and we want it to kind
of read that query string that we've
been creating to fetch these songs using
whatever the search parameters are so if
we were to go to in this case the songs
panel and let's see basically when we're
gonna do something similar so whenever
that query string changes remember we
can just do a watch and just say listen
to when that query string search value
changes we want to go ahead and do the
same same thing so again immediate so
right when this component has a value
defined in that we can just go ahead and
invoke a handler and we can say this dot
songs equals a weight song service index
we can just go ahead and pass a value
and of course do not forget the async
here so instead of mounted we don't need
that anymore because immediate should
kind of do justice it should do the same
thing and one thing you'll notice is I'm
passing a value to song service index
which we don't really
handle right now so if I were to go to
services and song service and go to
index I could go ahead and just do
search and then here I can say I'm
pretty sure I could just pass params
Search Search : search alright so
basically we're passing in some search
parameters and we're gonna put it on the
query string as we type so in fact if I
were to go over here and just do Network
tab and type an extra character like -
if you see here it did a query or it did
a um an ajax request to this end point
and it appended that query string of
search equals modest - and that's
because we defined it here so if I were
to say like some random key equals
search again as I change that value it's
going to say some random key is equal to
modest to three and then another thing I
should note is that if I were to change
this to an empty string I think actually
everything works fine it's just an empty
string right so now we have all that
logic set up to kind of like query the
back end based on what you type in and I
notice that all my songs over here kind
of its kind of vanished so let me go
back to my song panel and try to figure
out why that went away and of course the
same issue I keep on doing is this needs
to be dot data so go ahead and refresh
the page and I thought it needs to be
dot data hold on let's see what's going
on
there we go
all righty so now if we were to go to
our songs controller in the backend so
find our server and go to the songs
controller what we want to do is add a
little bit of new functionality so to
the index method basically we want to
check if that wreck dot query dot search
is set so if search is in the query
string we want to do a search a certain
way and otherwise we just want to do the
original search that we were doing which
is a limit of 10 so up here I'm going to
say let songs equal to null so that we
can assign it based on which path we
take and then here we're going to do
something a little bit complicated so we
can say songs is equal to a weight song
that fine all and we want to find all
the songs which match any of these
criteria so there's going to be an or
statement that we can do in sequel eyes
and basically we want to see if any of
these cases are true so in this case we
can say title artist genre or album dot
map and I'm going to go say key and just
map that to an object here and in we
could do this cool little feature where
we can just say that and inside here
house icon search is equal to rec top
query dot search and I'm gonna extract
that and do this and boom hopefully this
all works not sure why this is for some
reason this is white there might be
something wrong with the code here well
I guess I could save it see what happens
so now as I type
oh yeah there's definitely something
wrong I'm missing a mind missing let me
just end that with another parenthesis
that's I that was not colorized so again
let me just refresh the page so I can
kind of demonstrate what's going on so
as we type I'm gonna say D it's going to
do a request to the backend for mo D and
it's going to search for search equal
mod it's gonna do a responses in an
empty string right now and basically
this is an issue right now because I
actually forgot to do this I need to
search where like is so basically and
equalize you can do a a like search and
what we want to do is just find anything
actually let me change that I think I
have my like order backwards so for each
key so for title for artists for genre
for album we want to create a giant
array of objects which is why we're
doing this map put it into this money
sign or and then for each key we simply
want to search back key to see if
whatever we provided is existing so now
if I were to refresh the page you see
that it's returning - Mouse and so if I
wanted to search for a listing
alternative its returning only
alternative I go here our response only
has a single results which is
alternative I could search for an
exclamation mark which only returns that
float on with exclamation mark I can
search for modest where the server is
going to return two responses so awesome
at this point we can search on any of
these keywords and I don't know if this
is the most performant way to do it but
it works for now basically optimize it
later on if it's just too slow or
something
crashing your server but at this point
there's one thing I want to kind of
point out so basically if for whatever
reason your user were to type in
extremely fast let me just demonstrate
this you see that kind of like froze up
the page a little bit and is doing all
of these requests to the backend which
is not that great so what we can do is
if we go to the client and we do an MPM
install and go ahead and install a
library called lo - they have a lot of
helper methods which we can use for
looping over objects or arrays or
collections but the thing we're
interested in is called debounce so
inside the song search if I were to just
get rid of the server now inside the
song search panel I can simply just do
import underscore from lo - which will
bring in the load hash module and we
want to refactor this search method a
little bit so that instead of just
calling a method each time we want to
quell the debounce method some move
ahead and pass in an async function with
value and down here I can go ahead and
pass it something like that so very very
similar logic nothing much has changed
but now if I were to save this and type
in modest mouse is awesome notice that
only after 700 milliseconds after the
user is done typing well it would do
that server request so it just kind of a
little bit of optimization just so it's
not so like bad when you're doing
searches yeah look in the debounce or
look in the lo - if you want more cool
like live library function you can use
but cool I think that's pretty much all
set up we have the search panel it's
searching to the back end the back end
is doing queries against the database
and it's returning data that is filtered
based on what you're searching alright
so before we go on implement more
functionality there is one thing that I
have you know someone left a comment on
one of my videos about how to do routes
so basically if you remember if I were
to go to like one of my files where I'm
navigating so let's go to header and if
you remember that I'm doing this whole
navigate to method I actually don't need
to do this instead I could just simply
do let's say what's called navigation
whoops navigation link oh sorry it's
called a router link so I could do
router link and then instead of doing
this whole click thing I could just say
tag is equal to a span which will just
kind of replace whatever this is with a
span tag and then in that case I could
just do two equals and then pass it an
object instead of doing what I was doing
before so I were to save this now and go
up here notice that I can go to the
route by clicking that now so I don't
need to use this whole navigate to
throughout my entire application so if I
were to just go ahead and search so find
in folder I'm gonna search for navigate
to I just want to go ahead and remove
any instance of navigate to and do
something else with it so same thing
with V button in beautifying if you look
at the docks they give you the ability
to pass a again an object to it so I can
say do this and I can go to down here
same thing in this case I'm just going
to go ahead and copy and paste this here
and go to login
same idea with register so now at this
point I can just go ahead and get rid of
navigate to and the header all the links
in the header should work as they did
before so that was just kind of a little
workaround that I was doing with
navigate to inside the methods object
instead of just using some features that
I did not see in the documents but I was
I'm aware of them now so let's just go
ahead and go through anywhere we can and
just remove for that navigate to so like
in this case I can say 2 equals again
name is Songs create and get rid of the
day navigate to click go down here I
guess a 2 is equal to again that object
awesome and let's see where else I'm
doing it I don't need to use navigate to
here so I'll delete that here again I
could say 2 is equal to the string of
the navigate to object make sure that's
all working and then in methods I can
just remove that and I think if I were
to go to songs go to the console I get
this strange this warning our missing
params thing and basically I'm passing
down a props to this panel right here
and so and when the page first mounts or
when the the main view page or component
mounts song is undefined and it gets
passed down to edit which means that
song ID is also not defined so instead
of right here instead of doing params
equals an object we can have it equal a
method which returns an object so that
they will dynamically change the ID so
I'll go ahead and refresh the page just
to show that the error message no longer
comes up
so dynamically change the ID as we go
through our application it looks like
there might have been a bug on the edit
page but we can kind of figure that out
later on all right so a couple of other
things I want to kind of change up or
refactor is if I go ahead and just put
bogus data inside the login panel notice
how this has an ugly background color so
I'm going to go ahead and just try to
fix that up really quick so I can go to
the login page and instead of having
error I could do danger alert and just
remove error from that just make that
look a little better I think the same
thing is happening with register danger
alert and remember danger alert is kind
of defined as a a global CSS style so
and I think actually creates song edits
song maybe doing the same issue no we
have danger alert there what it song
have changer alert okay so now that's
all good to go
I don't think there's anything else that
maybe we could refactor in the spare
time I think actually when you register
in login it doesn't redirect you so just
to kind of demonstrate that I think
testing at gmail.com hmm actually I'm
not sure what we should use I'll say
hello at gmail.com I'll go ahead and
give it a password and hopefully this
should register me and it does but it
didn't redirect me to anything so on the
register page we want to go ahead and
say this dot router dot push name and
I'll say songs so after you login just
go ahead and just push the user to the
songs page and we want to do that same
functionality for the login view our
login component
so if I go back to sign up and say
something random register takes us to
the songs page log out and go back to
don't even remember what the username I
created was I think was hello yeah I'm
pretty sure as hell at gmail so I'll try
hello at the Gmail comm you know pass it
that password and again logging is now
taking us to that songs page and then
lastly there's there's this hello
component which takes us to this welcome
to your view j/s app page and I don't
even want that anymore so first I'm
gonna go ahead and delete the hello view
I'm gonna go to my router and I can go
here and just delete hello
I can't delete root we don't need a root
anymore
and down here we can just have a default
path so we can say I think it's path is
star and we can say redirect to songs so
basically if you try to hit a path that
doesn't exist let's just go ahead and
redirect that user to songs let's see no
trailing spaces with router index right
here's a trailing space so notice now if
I were to just go to some arbitrary
route takes us to that and then I think
we have a couple components that are
going to that route thing so name is
that a route let's just say songs so if
we long out log out it's going to go
ahead and take the user to the songs
section and make sure this goes to songs
so I'm gonna go to add song go back to
that taste this of they're gonna log in
with hello at gmail.com and make sure
that logout takes us back to songs
whoops
might help if I went to a different
route before I log out so I'm on the add
or create song click log out it takes us
back to songs awesome alright so at this
point the UI is looking a little bit
pretty good
I mean it's looking pretty good we got
some decent functionality going hitting
a couple of back in endpoints now I
think at this point I'm gonna try to add
a new piece of functionality where we
can bookmark songs so to start off
before I actually get into doing that I
kind of want to do some changes to the
backend so that when we add a new model
we don't have to clear the database and
keep adding that data to the database
manually so one thing we can do as if we
go into the server folder I'm going to
go ahead and create a seed folder and
create a new file called index is and
inside this file basically it's just
going to be a script which populates our
databases so if I were to first go into
let's see how we do it in our app we
bring in sequel eyes so we're gonna do
something very similar to that brings
sequel eyes and we're going to go ahead
and call sync and make sure we call
force it true and then once Inc is done
running I can go ahead and just bring in
some of those models so like in this
case I can bring in the song or I can
bring in the user model and what we want
to do is have some pre created JSON
files so I'll say like users a JSON
which has an array and I could do songs
I JSON which also has an array and
inside of those we could simply just say
songs is equal to require a relative
path to songs a JSON and then same thing
with users and I'm also going to include
Bluebird
which I think we have installed on the
back and already let me just ignore this
I don't want they'll enter the run
anymore I can kind of fix those lint
issues later on so we don't have to get
bogged down with that but basically
we're loading in those JSON files should
we should just have you know a
collection of users and whatnot and the
reason we brought in this promise
library because we want to make sure
that we finish inserting all the users
and all the songs before we do some
other stuff so what I can do is I can
say promise dot all and I could say wait
in fact I'm going to change this to a
sync function instead of that fat arrow
so wait
promise that all and I can do I simply
do let's say do the songs first or maybe
do the users first users dot map and
that's gonna take a user object and it's
going to return our second return
anything that's actually just gonna run
something so we can do user dot create
and let's go ahead and pass it that user
object so basically it's going to run
through that JSON array and for each one
create a new user object so wasn't not
that complicated and we want to do the
same thing for the songs so a song song
dot create awesome so if we were to
assume that we actually have some songs
in here and we can kind of populate
those so let's go ahead and go to the
songs request just get all the response
back go over here you can just format
this and just go ahead and put that data
into our songs Jason so we have
something that's ready to go and then as
far as user if I were to login with
testing Gmail com
one two three four five six seven eight
hopefully this lets me log in know what
was it again hello
all right so hello works so let's just
go ahead and snag that user and go ahead
and format it and we just want to grab
that user information there and put it
right there and we don't want to put the
ID because that's gonna be auto and
committed by the database and we don't
care about having a hash for the
password so I'll change that to a real
password there and I'll change out the
testing so that should create when we
run this seed function it should create
that user called testing engine well
calm with that password and then we
should also create all these songs and
again we don't want to include the IDS
so I'm going to remove the IDS and we do
not care to include either create it at
or updated at so at this point I think
this function should be pretty good to
go and before I run this I think one
thing we want to do is inside this
config file let's go ahead and change
where we're saving the storage path
because now we're having two different
files try to load in that configuration
so it may this is gonna be relative to
where I think of running your your
process so we want this to store into
the same location so in here we can do
cost path is equal to require path and
then here we can say path bout resolve
dur name so get the actual directory
that this config file is and then go up
to I think go up to let's see config go
up to yeah
I think that should work
so now I think if we were to run this
seed function hopefully everything is
good in fact let's not run it yet
because we want to make an impious crypt
to do it for us so let's make it a
script called seed and basically he's
just going to run node of slash seed
cool so at this point we can go make a
new tab to the server going to that C
project and simply run our seed
unexpected token hmm totally forgot to
add that so let's try it again
can I find models and that's because we
need to go up a level we need to go into
source and we need to go into models
I think model says index awesome
we're on mat cool we get all of our data
dropped and then re-add it as we need it
so now again whenever we want to run
that seed function we can do NPM we're
on the seed and it will just go ahead
and run that seed script drop everything
that's in our database and reinserted so
this is really good if someone for your
team's you just come in and you can make
this part your build now you're set up
to just spin up the database are cleared
out as needed all right so now we're
getting into the domain of building more
complicated models that have
associations between them so in order to
get our system set up to do that let's
go into our models index file and add a
little bit of logic to kind of run the
association's over our models if they
exist so basically we say object keys
DB for each function model name and then
for each model that we find check if it
has an associate method
if it does we can just go ahead and call
model name dot associate and then pass
it the DB object so as of right now this
doesn't really do anything because we
don't actually have any associate
methods declared so for instance what
can we do with this well if we wanted to
add that new feature which was
bookmarking songs we need to add a new
model called bookmark j/s I'm going to
rename this one to be song instead of
songs but basically if we have a model
called bookmark so bookmark and this one
is actually going to have nothing in it
just a default object and we're
basically using it for the association's
what we want to do is inside we can say
bookmark dot associate is going to be a
function which takes in a list of models
and then what we can do is start
associating that bookmark to some other
models so we can say bookmark belongs to
models user and bookmark belongs to
models dot saw because basically we're
building an association between the user
and the song as a bookmark so go ahead
and save this and I think that should be
all we need to do object dot keys I
think I need to do keys type that wrong
let's see if it works
all righty
so now since we made that new object
called the bookmark it makes sense to go
to our seeds let's create a book mark
saw JSON file let's go ahead and require
it and let's go ahead and make it no
wait a week promise
so the main takeaway here is make sure
that this a weight to promise all four
bookmarks comes after your songs and
users because you need them to exist
before you try to build up an
association so if we go to bookmarks and
make that an array we could do a song ID
is one and a user ID is one and that
needs to be wrapped alright so basically
we're associating user ID of one with
the song of ID of one so I'll go ahead
and run my seed function hopefully it
all works bookmark is not defined here
at the define is bookmark
okay so at this point there's not really
a good way to grab the bookmarks so I
think we need to start working on the
next piece of functionality which is an
endpoint to access the bookmarks for a
particular song so if I were to go on
the routes and I go into here I could
say book marks controller and I can say
F dot get bookmarks that's gonna be the
index method of that controller and we
can kind of refactor this routes method
in a little bit starting to get a little
bit too complicated
imagine this having like 5,400 routes
but anyway if we go to the controllers
now we can add a book marks controller
dot j s go ahead and copy songs we need
book mark here we need an index method
let's not worry about the other ones at
this moment all right so what we want to
do the first step is if you want the
ability for or we want the user the have
ability or the UI to search for a
particular bookmark based off of the
song ID so if we were to just allow the
user to do like something like this so
if I were to go to here and say do a get
requests on bookmarks and do a song ID
is equal to one so like if we wanted to
be able to do that let me save this
alright so obviously this is not gonna
return anything because we don't have
bookmarks yet but if we did we want to
be able to grab that song ID in the
query string
so I'll just say song ID here and say if
up here we can say song ID is reka query
dot song ID fact I'll just do that and
go ahead and just cut out some of this
stuff so we can do cost book mark is
equal to a weight book mark that find
one because you should only ever have
one book mark that correlates a user to
a song you can't bookmark a song a
thousand times you can only have one of
them so we're just gonna use fine one
here we're gonna do where we're gonna do
where song ID is equal to song ID which
is passing in the query string and I can
go ahead and just kind of delete all
this other stuff and return the book
mark there right so if the user has a
bookmark for a particular song this will
return that bookmark otherwise it'll
return and undefined so to test that out
we can go over here and say give us the
bookmarks for song ID one and this will
give us one bookmark back for that song
ID and we're gonna have to have the
functionality to also a query for the
user ID and I'll go ahead and just hack
in something for right now so if I did
like user ID is also required so user ID
user ID basically if we were to just
pass in that and use your ID is equal to
1 boom we get a result if we do too we
don't get anything back
but I think we probably should get at
least something back so what is bookmark
actually set to
set to null so I think maybe we want to
return an int I object instead makes a
little bit more sense than just
returning a null object
well maybe not we'll keep it as an all
maybe no makes more sense
all right so if the bookmark doesn't
exist we return it all and in the UI we
can kind of use this end point to say
hey I'm on song 6 have I already
bookmarked it and if I have let's go
ahead and display a bookmark in a
certain style and if I haven't displayed
in a different style and allow the user
to click on it to actually a bookmark or
unset that bookmark on the song all
right so now that we have an endpoint to
get back the bookmarks and we have a way
to easily spin up a database or refresh
it with some good fresh data let's go
and go back to the UI and let's try to
add a section to the song view page
which allows a user to bookmark a song
so if I were to go to a song metadata
which if you remember song metadata
looks like this panel right here
basically we want to be able to add a
bookmark link here so what we can do is
right next to this button we can just
create and yet another button and it
doesn't need it too but it does need a
click call back and we can say bookmark
in fact I'll just say set as a bookmark
and I'll say bookmark yeah so down here
I can go to methods and set as a
bookmark it's gonna be a method make
sure we have
clicked it so every time I click it it's
printing out bookmark and so first of
all we're gonna have we could just have
two buttons I guess we could have one
button which is used for bookmarking the
song and the other one for not
bookmarking so I'll say bookmark and on
bookmark let me just let me just change
these to bookmark another mark all right
so we have these two different functions
one of them should just simply unbook
marker song yet the one should do the
opposite in bookmark the song and first
of all we don't want to display this if
the user isn't logged in so I'll say
store and dot state is user logged in so
only display it these are logged in and
we can probably refactor this in a
little bit to do map state in fact I'll
just do that now so kind of jumping
around but we can import something
called map state from view X which
allows us to inside the computed if we
do compete computed is an object or we
can do map state of I think we can pass
it let's say is user logged in I might
have to look at the docs for this one
but I'm pretty sure what this does is if
you pass it whatever state variables you
want it'll just go ahead and put them
right on this computed function so
instead of having to do stored a state
that is user logged in we could just do
a shorthand to say that let's try this
out it doesn't work a look at the docs
all right so we're not logged in the
buttons do not show up so if I go here
and so hello gmail.com and go to that
Manchu let me just register something oh
it's called testing that hello whoops my
bad
all right so we're logged in now we go
to view boom the bookmarks and I'm
bookmarks show up so that's kind of just
showing you how you can do map state to
just grab something from the store and
put it as a computed method I might go
back through my other files and do that
as well I'm not sure this is better for
doing like a map state or maybe you can
do a mix in there's also something
called mixes mix ends in view we haven't
really covered that in this tutorial yet
but it might be nice to look that up and
see if we can find a use case for using
a mixin but in this what we're trying to
do now is we only want to show the
bookmark or the unbook mark if the user
doesn't already have it so basically
when this component is mounted we first
let's say we can import a book marks
service from services book marks service
and if I go to services and I go to copy
that and I go to rename this to book
marks service again we only have one
method so far in the book mark endpoint
bookmarks and I was go ahead and say
this requires a song ID and a user ID
I'll just say params right now keep it
simple
all right so what we have now is the
ability to call that bookmark service
pass it some programs so if I were to go
to mount it and say actually a sync
mounted and say Const bookmark is equal
to a wait bookmark service index and we
can pass it song ID of one and pass a
user ID of one just temporarily we can
see if it returns true or not so I'll
say a bookmark and go ahead and print
that out all right so now when the page
loads or is mounted we get this bookmark
back and be sure to wrap that and give
back data so I see here we got a
bookmark back for song ID 1 user ID 1 so
if that's the case because remember the
other case is let's say we were to do
like use your idea tin just going to
refresh the page that should we turn in
alright remember the back and returns
and all for that so if that's annoying
yet to read login huh if it returns null
we need to show which button we need to
show the bookmark button so I can say if
the user is logged in and if this
bookmark is actually defined or if it's
not defined actually
in fact I'll just go data up here I'll
go say data and just return a data
object and say is bookmarked is equal to
false and then I'm going to set it so
this dot is bookmarked is equal to
bookmark and just cast it to true or
false if it's defined so up here I could
say V if it is not bookmarked and then
over here I can say V if it is
bookmarked and I think that should work
let me uh where is that make sure to put
this there in the method alright so in
this case remember bookmark returned
false so we have the ability to click
bookmark to set it as a bookmark and
then if vice versa
if I were to change this back to user ID
of one save it we should get the unbook
mark button awesome so now at this point
we actually want to use some of the real
data that's returned so if you remember
back then a while back and like I don't
know which part of the tutorial was but
we have access to the user ID by doing
this dot store dot state dot user dot ID
so we can dynamically set the user ID
there and the song ID of course is
inside of the route so I should be able
to just copy and paste where did we do
that
view song
oh I just actually passed in I think we
pass it in as a prop right so what we
can do is just say song got ID listen
now we're gonna do a request for that
particular song that we're at using the
particular username that we have you can
save this and see what this does
okay so if you remember in that whole
seed stuff that we created we went ahead
and set that to true and that's why song
of ID one and the user I'm on is I a
user one this is already bookmarked for
us alright so now for the next part we
want to be able to click and unclick
this button and change the state of the
bookmark right so we're gonna need to
implement these so I can just go ahead
and get rid of this and let's go ahead
and change those to async methods and
the first thing we want to do is we
could say post to the bookmark service
with song ID and use your ID and I don't
think we care too well yeah I don't
think we need the information back so
I'm just gonna go and get rid of that
but one thing we do need is for whatever
reason let's say the end point returns
an error we want to go ahead and catch
that I'm gonna try catch and just go
ahead and print out in here for now
and then same ordeal with on bookmark
but instead of post let's just do a
delete and let's see I think would make
more sense to wrap this again in a
try-catch just in case our back in for
whatever reason decides to fail out and
it'll just point out the error all right
so now in bookmark service we don't have
a post and we don't have a delete so
let's go ahead and add those so add it
in at a post add a delete and here we
can do a post the bookmarks and delete
we can actually do a bookmark ID
bookmark slash bookmark ID we don't need
the past parameters
in fact instead of params I'm going to
say bookmark just so it makes a little
bit more sense okay so now we have these
extra methods but we don't actually have
endpoints to process them so if we go
back to the server now we can go back to
our bookmarks or should we go back the
routes first and of course let's just go
ahead and create two more outs so we
need a way to post a bookmark and we
need a way to delete a set bookmark so I
could say bookmark ID that's gonna be a
delete method so here if I go to
bookmarks controller now let's just go
ahead and create those endpoints so post
and delete so for post on the body we
should have the bookmark so we could
just do bookmark physical wreck dot body
and of course we can say Const buck mark
or let me say Wade bookmark create
bookmark and then send back the bookmark
when it's done creating
and these aren't final we're probably
gonna come back and change this a little
bit when we end put a passport and do
some more user authentication with the
JWT token but I think these are a good
start and then for the delete method if
we were to come down here and say book
mark ID and that's gonna be from the
params what we can actually do is we
simply want to find the book mark by an
ID so I can say find by ID let me say
bookmark ID constant bookmark is equal
to that and we simply want to call a
wait book mark destroy and that will go
ahead and delete the bookmark from our
database in for what we send back we
could just say sin back yeah I guess
just this send back the bookmark that
was destroyed if it was successful
all right so just a quick recap let's
just make sure this is work posting we
grab the bookmark from the body we
create that and then we send back the
exact same thing that they sent in and
then arrows we're trying to create the
bookmark and then for delete find the
bookmark by ID go ahead and destroy that
bookmark and then send it back to the
user if it was successful and then an
error has occurred trying to delete the
bookmark let me rename this one so
assuming all as well if we were to
refresh this page it's all an error
measure if that's every property ID of
null
mmm it's probably this is not all so I
can say hmm if the user isn't logged in
we don't even want to do this logic so
if this thought is user logged in if
they are not logged in let's just go
ahead and return for now so that we
don't get that error when they try to
mount that page mmm
cool so one thing that's really starting
to get on my nerves is that every time
this page refreshes we kind of lose our
state or login state so there is a view
localstorage view x-component that we
can use it's called view X persisted
data so if I were to just go ahead and
install this one and paim install save
boom oh wait there let's see
so install that persisted state and then
tell you how to use it till you just go
ahead and go to your main file and
import it and then go ahead and pass it
to your store so actually this needs to
be in my store not my main so I go to
the store file and then I go to where I
create the store which is a line 7 I go
ahead and pass in plugins create
persisted state so the great thing about
this is whenever the page refreshes or
whatever it's just gonna store or
refresh whatever state you had them you
X because that's all stored in local
storage so notice that I'm already
logged in and basically any states such
as the user token is user logged in
boolean and the user object it's going
to be grabbed from local storage and put
into my view store on initialisation so
now we can kind of start like debugging
and make sure this is working I think
there's a little bit more work we need
to do but so the first part if we were
to click bookmark we notice that it
makes a post request to bookmarks and
that returns a response back but what
they I'm noticing is that you can click
it multiple times which obviously
doesn't make sense and then secondly
this bookmark thing is not changing so
the first thing I want to do is go to
the database side or the server side and
make sure that we can't try to bookmark
the exact same song more than once so if
I go through the server down here and
just go ahead and dive down into that
bookmark service or bookmark controller
so again we're hitting the post method
and we need to add a little bit more
logic to this be able to support that so
if you were to think if we were to hit
the back end with a post endpoint we
need the first check if the user already
has a bookmark for that song and if they
do we can throw back some type of error
so first thing
do is I'm just going to factor this a
little bit to be song ID in book or user
ID so we're at those from the body
object and put them into song ID and
user ID and we want to first check if
that bookmark already exists in the
database so we can say cost bookmark
equals a weight book marked out fine one
and then of course we're and we just
passed those two criteria so song ID and
user ID and I don't know if I mentioned
this but in the model when you do
relationships or associations it's gonna
give it this type of format capital S
and then ID at the end so capital saw an
ID or capital user ID and you can
override that to be like camel case if
you wanted to but I'm just kind of going
with whatever the defaults are force
equal eyes it's not that big of a deal
so again we get the request information
we check if there's already one in the
database and if one exists so if
bookmark we can go ahead and just return
a 400 error and just give it a you know
useful message saying that like you
already have this set as a bookmark so
again sending back a 400 status to the
bookmark already exists and then
otherwise we're going to create a new
one here so let's go ahead and save this
and see how that works out so now when I
click bookmark it's getting back an
error now because that bookmark already
exists
before I go further I think I added like
before I added a bunch of bookmarks so
I'm just gonna go ahead and clear out
the database so that's remember we do
npm run seed just so you're rid of all
those extra bookmarks that we don't
really want so I'll refresh the page now
and then I can go ahead and just click
bookmark
and this one's already bookmarked cuz
remember in the seed code we told it to
bookmark song 1 for user ID 1 and I
think we're on user I do you one right
now ok so that should make sense the
second thing we want to do is when we
create this bookmark down here we're not
actually currently associated with any
song ID or user ID so we first need to
grab the song actually in fact I think I
could just do this so I could just say
set song ID is equal to song ID and the
user ID is equal to user ID so then when
we save it into the database it's going
to actually associate with the song ID
and user ID and then we'll have a
correct association setup so let's go
ahead and try that just to make sure
again this shouldn't work alright so I
think our post endpoint should be ok if
not we'll come back and fix any issues
our delete endpoint again just takes a
bookmark Rd it finds that so bookmark by
the ID and then destroys it and sends
back whatever so let's go back to our
song metadata view and I want to just go
ahead and kind of change some of the
logic so instead of saying is bookmarked
we're just gonna keep track of the
bookmark so we can have like an ID
reference and stuff so I'm gonna change
those to bookmark in bookmark and then
here I'm just gonna say unset as
bookmark or maybe just unset bookmark
and then set as bookmark and set as
bookmark for the click method and then
unset as as bookmark I'll just keep it
consistent
so let's go down here and rename those
methods so remember we had set as
bookmark and unset as bookmarked there
and then of course for the data instead
of having this boolean what we want to
do now is we can just keep track of the
Demark that's returned from the back end
so instead of saying cons pockmark and
then setting this I can just say this
dot bookmark and keep track of that
bookmark that's returned from the
database if there is one and then down
here set as bookmark of course would
just do the same thing set this top
bookmark equal to whatever the back in
returns go ahead and just wrap this and
return data there and an unsaid is going
to do a delete method or a delete
request to the back end we're gonna say
this top bookmark ID and then of course
when the delete method is done running
we'll just set the bookmark to null so
let's save this and see how this works
so now we have unset his bookmark we
click it we see that it makes a delete
request to bookmark ID of one seems like
it worked fine we click says bookmark
makes a request and that should be
updated so I can just keep on clicking
this to unset it or set it as a bookmark
to make sure it stays persistent when i
refresh
so I noticed that this one bug when the
page load loaded we actually got a
bookmark back from the service I think
let me see let me see fresh this one
more time hi so we actually are having
an issue when we try to post so if I
were to go back to our post endpoint
here let me doesn't make sure that we're
posting the right stuff so I think we
are see you click post setting song ID
and use your ID that's fine I think the
issue is here we're only doing a request
for user ID and we should be doing for
both so a little fix for that is instead
of having this on the mounted thing
because I believe we're passing in that
song ID reference in a prop if you
notice here we're passing in song as a
prop so winning this is mounted it might
not actually have that prop defined yet
so instead of doing this in the mounted
logic we could say put this in the wash
logic so I guess the async song and then
go ahead and just run this code inside
that watch logic instead okay I think
get rid of mounted go ahead save that
okay so now it's actually doing the
correct request for a song ID 1 and user
ID 1 and we should just be able to keep
on alternating at this point see unsub's
bookmark make sure that persists click
set his bookmark so when we refresh this
is a unset his bookmark all right so
everything is working for the book parks
now and I think at this point we can
kind of wrap up this part 6 and stay
tuned for part 7 where I'm probably
going to start displaying those
bookmarks on the main page and again
feel free to subscribe to my Twitter if
you want notifications when I make new
videos alright thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>