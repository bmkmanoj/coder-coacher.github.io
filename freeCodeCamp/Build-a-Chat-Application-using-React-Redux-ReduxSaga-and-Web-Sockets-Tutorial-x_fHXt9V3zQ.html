<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a Chat Application using React, Redux, Redux-Saga, and Web Sockets - Tutorial | Coder Coacher - Coaching Coders</title><meta content="Build a Chat Application using React, Redux, Redux-Saga, and Web Sockets - Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/freeCodeCamp/">freeCodeCamp</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Build a Chat Application using React, Redux, Redux-Saga, and Web Sockets - Tutorial</b></h2><h5 class="post__date">2018-01-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/x_fHXt9V3zQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this tutorial we're going to build a
chat app using react Redux Redux socket
and WebSockets this is actually based on
a tutorial by Flavio copse and I'm going
to link to that article in the
description so in this basic chatroom
program every user that connects to the
server is registered upon connection and
they get a username and then they can
write messages that are broadcast to
every connected client this is going to
be a distributed application built using
a node.js server and a browser client
written in react and then we're gonna
use redux to manage to manage the data
and then manage the side effects using
redux saga so it's good to have some
experience with react and redux but you
don't need to if if you need a refresher
on react or if you've never used react
before you should check out my my my
introduction to react video so check the
link in the description for the app
we're also going to handle the
client-server communication using
WebSockets also you can see the entire
source code on github in the link in the
description so first we're just going to
install create react app so I'm just
gonna do MPM install G create react app
okay after that we get that installed
we're just going to use the create react
app quick starter so create react app
chat okay now that's installed let me
just clear my screen I'm going to CD
into the app folder which is this chat
so it's CD chat and then I'm going to do
a yarn start so over my web browser we
can see on the localhost 3000 we have
the basic welcome to react screen so we
have created our basic template so our
quick starter has worked once we finish
our app we're going to have the basic
layout where we're going to have a users
list on the side we have the message
list up here then at the bottom we're
gonna have the the new message box to do
this we're gonna create a static version
of the chat using plain HTML and CSS so
the code for that is pretty simple I'm
in sublime text right now and you can
see all the files on the side that were
created with my create react app starter
okay I'm going to start with the CSS and
just gonna go to this source directory
and then this app dot CSS file this was
all just put here by default so I'm
gonna change this just for this section
I'm just gonna paste in the code all the
rest I'm actually going to type out on
this tutorial but this is not really
focused on CSS I do have a link to this
exact to CSS in the description of the
video so you can go and grab that and
then be able to paste it in so I'm going
to save that and then I'm going to go
into app j/s here so here's the default
stuff but we're gonna change this a
little bit specifically everything in
this return we are going to change when
I have an aside I the equal sidebar
and it's just going to have the users
over in that sidebar and then we're
going to have a section with an ID of
main let's give this here and inside
that section we're going to have another
section with an ID of messages list it's
just gonna say a messages list and then
one more section I'm just going to
duplicate that line and this is going to
be called the new message section
and then we just have to end this other
section oh one more thing we do need to
change this default up here so this is
going to be ID equals container that
will work with our CSS a little better
okay now back on our website I did zoom
in on this website three hundred percent
so everything was a little bigger but
you can see we have a user section a
messages list section and then the new
message section so this is what the
basic layout of our app is gonna look
like okay we're going to use Redux to
manage the state of our app so that's
how we're gonna manage all the data in
our app so we're first going to have to
install Redux so let's do yearn add
Redux react Redux
okay now that Redux is installed we're
just going to translate this basic HTML
layout we added and just prepare it to
fill and the components will create
later so right up here I'm going to
import some things I'm import a sidebar
now this is something that we haven't
created yet I'm going to create it
import it from containers so that
sidebar and we'll create that in a
little bit here when i duplicate those
two lines and now a sidebar will become
messages list so I see I'm
double-clicking the word to I select it
and then I just do command D to select
the next occurrence and then I can edit
both at the same time by the way to
duplicate a line I just did shift
command D to duplicate and now I'm going
to change this stuff down here instead
of having this aside we're actually
going to have the sidebar container so
I'm just gonna put a sidebar
and then we still have the section ID
main but for this section it's now going
to become messages list and then this
section is going to become the add
message now these three components are
all going to have a presentational
component which manages the user
interface and a container component
which manages its behavior and the data
that the presentational component will
show so let's go over to this index at
JS file and in this file we are going to
initialize Redux and then we're going to
import the chant reducer and then create
the store now reducers are just part of
Redux so this was all this code that was
already created by the create react app
we're just going to import a few more
things we're going to import the
provider from react Redux and then we're
going to import the create store from
redux now the create store is where
we're where we're going to store all the
data for the app the only other thing
we're going to import is chat from
reducers and then I'm just going to
create a Const here Const store equals
create store and like I said that's
going to be our our data that we're
going to be using we're going to use
this be stored all the data for our app
and we're going to import C we're going
to pass in our reducer which we're still
going to create this this chant reducer
we still have to create but that's what
is going to be able to really get in all
the are all of our data into our our
store it's just part of redux
and then down here where it's rendering
something we're gonna mix things change
things up a little bit okay I'm going to
add a provider I'm going to use the
provider and set what the store is it's
gonna equal store and then we have the
app inside it and then provider and now
we're gonna create the actions in redux
whenever you're going to change the
state you do it through an action
because the store the overall state for
our application is read-only we're never
going to write directly to the state and
when we're gonna do all through an
action so we're gonna create a new
folder in here I'm going to go to a new
folder and this is going to be called
actions and inside this folder I'm going
to do a new file index dot j SN types
now this is another file we're still
we're going to have to create we're
going to bring in the types from this
other file that we're gonna create a
second so I'm going to let next message
ID equal zero and Const next user ID
equals zero so I'm just going to set
some data we're going to use in here and
here's the first action we can do Const
add message equals message
author so if we're going to add a
message we're going to call this action
add message and we're going to pass in
the message and the author or who the
message is from so we're gonna send the
message it's going to have a type of
types add message actually let's go just
go and create the types right now so
that was in this file constant slash
action types so I'm going to create a
new directory here new folder constants
and in constants I'm gonna have a new
file called action types GS sometimes
you can do constants in the same file
but when you're gonna have a bigger
application it's going to be better to
break things up into different files so
I'm just gonna do X for Const edy
message and this would be pretty basic
it's just going to be add so the
constant add message is just a string
add message so I'm going to do do
command shift duplicate and we're going
to duplicate that four times and command
D select the next occurrence
message received
ooh I before E except after C okay so
now we're going to do this add user and
users list
actually for a small app like this we
don't even really need to have constants
like this we could actually put this as
a string right here instead of going to
this constant but it's just good
practice because when you get to a
bigger app you're gonna want to use
constants like this just in case you
want to change things later it makes
them a lot easier to change okay let's
continue adding our message so when you
add a message it's going to have the
type which is add message that's the
type of the action we're gonna have the
ID which is next message ID plus plus so
you can see up there that it starts at
zero and then for each I if for each
message this gets added it will just
increment the the message ID and then
we're going to include the message which
is what was passed into this action and
the author which was also passed into
the action and now we're going to create
another action export Const we're only
going to have four actions there's gonna
be an add message adduser message
received and populate users list so this
one is going to be add user and I'm
going to just pass in a name and the
type is going to be types edy user and
then the ID that's why we we started the
user ID at the top is zero so this is
just going to be next user ID increment
and then obviously we need the name that
was passed into this action because
that's gonna be the user's name and the
next action is going to be message
received and so we're gonna pass in the
message and the author
now it's gonna be type types dot
message received
and then we're so the idea is gonna be
just like the ad message where it's
going to be next message ID plus plus
now the reason why there's a special
lowercase the reason why we have the ad
message and the message received that
the and they both have the same type of
ID
the difference is AD message is when the
the current user like you are adding a
message messages received is when the
other user in the chat program is adding
a message
so you're receiving a message from
someone else is message received but the
message ID is still gonna increment both
ways okay I was looking at how that the
colors like this wasn't green up here I
think I need this um here here oh there
we go so I need that that more than
signed to make this into an arrow up
there
okay back to here we're gonna pass in
the message and the author and one more
action export Const populate users list
equals users and the type is going to be
types dot users list and then we're
gonna pass in the users
well those are our four actions you can
add a new message a new user can be add
to the chat a new message can be sent
and the server will send updates the
users list when a person joined or quits
the chat now these are the actions but
the actions don't actually change the
state so this right here is showing that
when you add a user it's basically
creating almost this JSON object here
but that's not actually changing
anything that's what the reducers are
for so the reducers take care of
creating a new state when an action is
dispatched so in particular when a
message is added by us we're going to
add it to the local list of messages
when we receive a message from the
server we add to our list of messages
when we add a user we put it in the
users list and when we get an updated
users list from the server we refresh so
let's start creating those reducers that
are actually going to change the state
of our app so let me save that file and
I'm going to create a new directory so
in the source file I'm going to go to a
new folder and it's going to be called
reducers and in here a new file and the
first one is index j s2 let's see let me
make sure everything saved and I close
some of this stuff for now okay so I'm
in the reducers index J s and we could
put all of our reducers into one file
but since we have both messages and
users we are going to create this one
file we're actually going to break it up
into two files of the messages reducer
and then the users reducer and then this
file index that J is going to combine
the messages and users reducer into one
reducer so it'll make more sense as we
go here but we're gonna do combined
reducers from
Redux and then we're going to import
messages from messages and we're going
to import users from users and then
these messages and users are something
we still have to create those but first
we're just going to finish off this file
constat equals combined reducers now as
you can see it but the combined reducers
just comes from redux and we're gonna
pass in messages and end users so this
is just combining two reducers into one
reducer and we're going to export
default chat oh I spoil export wrong
there we go and save that so we're done
with that file and I'm going to create
another file in the reducers directory
this one's going to be called messages
is that the reducer is what actually
changes the state of your application so
this is going to change the state of the
messages in our application so first
when do a constant message is equals
state in a reducer you always pass in
this the current state and an action and
you return the new state so when we call
messages you always pass in the state
and the action and if there is no state
it's gonna be set to an empty array but
if there already is a state it will pass
in whatever the state of the messages
are if there are already messages you'll
just pass it in the current list of
messages and the action and it's gonna
return a new state so let's figure out
what we're going to do now it so we have
switch we're going to create a switch
statement to figure out which which type
of action that's happening so we have
action dot type so they
the action that was passed in and just
to come make this more clear let's go
back to our our action file so so this
is an action that could be passed into
our reducer you can see there's a type
an ID a message and an author so we're
passing in that action and so is that
when the action right here is the action
we passed in so the action that type for
instance would be typed add message that
would be an example of one of the types
so let's finish this switch statement
so if under the case of add message so
if we pass in the type of at the action
of add message we are going to do
something but actually what we're going
to do the same thing whether the case is
add message or if the case is message
received so we're just going to put two
case statements together and we are
going to return state that concat so
state concat basically means we're going
to take the current state and we're
going to add this on to the end so we
are going to let's see here we go yeah
we're going to add a new message met the
message is action message that's all we
passing it with our action the author is
going to be actioned author and the ID
is going to be action that ID and change
things change the indentation a little
bit okay so now we're going to go back
to the default so the default is the
default just means if a second leaf is
typing the first okay so we have these
two cases if those cases were going to
add a message and return the state with
the new message which is just the state
with adding this
message on it if the action is not ad
message or message received we're just
going to return the state that with the
state that was already there so so we're
not going to change the state at all
we're just going to return the current
state and then down here we're just
going to put export default messages and
we're gonna actually I'm just going to
do some refactoring here see how I use a
string we did make this this those
constants over here these action type
constants so I'm going to change this to
use those action type constants so let's
see I'm going to import star as types
from constants action types and then
here I'm going to just change this to
types dot add message with without the
quotation marks types dot message
received okay it looks good I'm going to
copy this top line so I'm going to use
this in the next file I'm gonna create
I'm going to go to a new file and this
time is going to be users dot J s and in
this file like I said I'm going to start
with this importing the types cuz we're
gonna use those again and this is going
to be pretty similar to the last file
users equal we always pass in our state
which if there isn't a state at all yet
it'll become an empty array and we're
going to pass in our action and then
we're going to do something with that so
again we're gonna do a switch statement
to find out what action was passed in
action dot type now this time the
different cases will not be exactly the
same so if the case is types that add
user we're just going to return
state that concat is to be pretty
similar to the the messages one we're
going to concatenate or named action dot
name and the ID is going to equal action
that ID now we're gonna get the case of
types dot users list and then we're just
going to return action users basically
instead of adding a user to the list
when we call to action users list that
means we're getting in a entirely new
users list so we're just going to return
the so the state of the users just
becomes the entire users list that was
just passed in instead of adding one
user on to the current users list and
then the default is going to be returned
the default is always the same it's
always returned state if you didn't pass
end users add user or users list then
we're just gonna return the state and
then go down here export default users
and we're done with that file if we go
back into our original app dot J's file
and then remember we import the acai bar
message list add message these
containers now it's actually time to
create those containers now if we go
back into our original app.js file we
can see the components we're using a
side bar messages list add message now
we're actually gonna create those
components so let's start with the add
message components first I'm going to
create the folder called containers
because you can see we put them all into
a folder called containers and in here a
new file called add add message is so
this is going to be a functional
component that's pretty simple it's
gonna create an input
filled into the new message section of
the page and when the interest when the
Enter key is pressed we're going to
dispatch the ad message action passing
the value of the input field so let's
start that we're going to import react
from react import prop types from prop
types constant add message equals props
and we're gonna let input where I create
this input variable here and we're going
to just return the actual component here
section ID it's gonna equal new message
and input on key press so if someone
press the key into the input field we're
going to do something here if a dot key
equals equals equals enter so anytime
you press the Enter key we're gonna
props dot dispatch here we're going to
dispatch an action and we're gonna pass
in the value of the the input field and
then we are going to pass in the the
user's name so the value is the the
message that's being sent and then we
want to know the user of who is sending
that message for now we're just gonna
set it as me
me is sending the message and then we're
gonna set the the value to an empty
string so that that's the the value of
the input field so it was whatever you
typed in and now it's just gonna be
nothing because you've sent the message
to make this props that dispatch work
I'm going to go down to the bottom here
and put add message dot prop types
equals dispatch
drop types that funk that is required
okay now we're gonna go up here and
we're going to add some more information
to the input field here the type of this
input field is going to be text and for
the reference input equals node and then
I'm just going to end this section here
and I'm going to move this parenthesis
there there and the last thing is export
default add message so next up is gonna
be the message component which is going
to render a single chat message by using
the author message format so what I'm
gonna do is just duplicate this fot this
add message and this is just going to be
called message and I'm just going to
change some of this stuff so instead of
add messages message we're gonna return
something different here let's see we're
not gonna have the input we're gonna
pass in two things a message and the
author okay I'm going to take out this
whole section here and put parentheses
and inside the message we're just going
to have ap tag and we're gonna have the
author and the message
for the message prop types we're gonna
have message is a string author is also
a string and then export default message
okay I save that file so this message is
going to be rendered by the message list
component which iterates over the list
of messages so sort of duplicate I'm
just gonna copy this beginning thing
that I kind of reuse in my next file new
file and this is going to be called
messages list also in my containers
folder j/s and put in the beginning
thing here this is going to be called
constant messages list and and here it's
we're just going to have the messages
and we're gonna have a section of ID
it's going to equal messages list and
then this is just going to be an
unordered list and side is messages dot
map and for each message in the messages
list we're going to do the message that
key is going to equal message that ID
new dot dot dot message and then I'm
just gonna end the unordered list tag
and in the section tag and then I'm
going to declare the prop types here
messages rock-type stop array of so
let's see what's going to be in the
messages we're gonna do prop type dot
shape ID prop types dot number dot is
required and message prop types that
string that is required and let's go
comma here duplicate author so we're
gonna have an ID a message and an author
for for each message and just another is
required here and another is required
the final thing is just exporting this
okay now we finish the messages list so
we're going to create the sidebar
component which instead of iterating
over the messages is going to iterate
over each user so I'm just gonna do a
new file and let's try that again new
file and I'm going to do sidebar J s and
just like from the messages list where
some of these things start the same so
I'm just going to copy this first few
lines we're gonna import react and prop
types and so constant message list is
gonna be Const sidebar and instead of
messages so we're gonna put users we're
gonna have this aside here and with ID
equal sidebar and class name which is
the same as class it's going to equal
sidebar then we're actually just going
to make an unordered list of all the
users so let's do users map I'm gonna
pass in for each user I mean we're going
to do a list item Li the key is going to
equal the user ID and then we're gonna
have user name so it's going to just
show each user's name so that's the end
of the list item and then that's also
the end of the unordered list and that's
the end of the aside now let's see we
need a final parenthesis to end that and
then we just need to set up what our
prop types are so sidebar dot prop types
equals the the users which is prop types
dot array of new prop types shape so
we're going to find the shape of this
property we have the ID which is just
prop types dot it's gonna be a number
is required and then I'm just gonna copy
this line and this is going to be name
is prop types dot string is required and
this whole thing is going to be dot is
required and also this whoops what I do
here I'm going to put that to the next
line dot is required and then we just
have to export the default sidebar okay
we just finished that one now we're
going to make our containers and
actually we already have this containers
folder is because I actually missed name
this this was actually supposed to be
the components folder so I'm going to
rename this containers folder components
and now I'm gonna make a new folder
that's containers so it containers
basically we're gonna generate the
container components for the for the
presentational components so in this
components directory which I just
renamed these are the presentational
components and we have to make the
container components and then we're
going to use the connect function from
react redux so this is something that we
do for redux so I'm going to create a
new file here and this is just going to
be add message dot jf so all the names
are gonna be the same from the the
container can from these other
components like we have this add message
here now it's add message here and it's
gonna be a pretty simple file first
we're just going to import connect and
this will help us connect them together
from react redux and then i'm going to
import the add message component which
is the one that we created from and i
just have to put worst located
components slash add message and then
i'm going to import one of our actions
the add mess
the ad message action from our action
folder actions now we're gonna do a
Const dispatch to props it's going to
equal dispatch and and here we're just
going to find what dispatch is going to
be dispatch we're gonna pass in the
message and the author and dispatch so
this this dispatch right here is
actually right from redux so message
message and the author and I'm going to
fix this here now I just have to export
that Const add message and here's what
we use to connect so connect and we're
gonna pass in this empty object here oh
comma here map dispatch to props add
message component so this is basically
going to connect to the add message
component so I'm just going to save that
and I'm just going to re duplicate this
but this time it's going to be called
messages list but we do this for each of
our components that we created so in
messages list we're gonna have connect
we're gonna have this time we're going
to have messages component so I'm going
to change this to a messages component
and Oh actually it's message messages
list component and then for instead of
add message it's going to be messages
list
so messages list and we don't have to
import this action because we are not
going to do the action before we use
this add messages action but we're not
going to do that actually we're gonna
get rid of this whole thing here you
don't need any of that so Const in step
add message it's going to be messages
list equals connect and here you know
I'm just gonna start this from scratch
here so connect state I'm gonna pass in
the state and it's me messages state dot
messages and this here then the messages
list component and then one more this
one's this for the the side bear sidebar
can parts me very similar to this so
again I'm going to well let me save this
and then I'm going to duplicate this
just gonna be a sidebar and then here
this is going to be sidebar component
yeah I just did command D to select both
and I'm gonna put sidebar component and
then just change this to over the word
sidebar and we changed this to the word
sidebar to could have done this all at
once sidebar and here it's just gonna be
that sort of messages there's going to
be users and see I just did this both
these at once users and users and we're
done with that one so I'm going to save
them and at this point we've done enough
to actually do some tests here so let me
go back to my browser and fail to
compile you know maybe I should've been
checking this all along we're gonna
there's probably be a few things that
I've had a mistake on it looks like I'm
missing a closing tag let's wait what
file that was on sidebar at Jas so
school right here
and I need a closing tag there and I'm
just gonna restart my server here and
let's see what happens okay
messages j/s line 13 so let's try that
in that reducer so let me go back to
let's see the reducers messages das line
13 may not need this one okay can't
resolve constant / action types let's
see let's go back to that users dot j s
constant / action types okay how do I
did wrong I and this this folders
spelled wrong so let's rename this
constants done and let's now let's see
what we got going here
okay we're gonna restart the server
again okay can't resolve containers /
bed message app dot jsq containers / add
message
let's see what's wrong there okay we
have app that day s containers / add
message let's go to containers / add
message and oh here's the problem we
have the containers in the wrong spot so
this should actually be in the source
folder so I'm going to move this and
it's just me chat / s RC / containers
and now let's see what happens I'll save
that and it's compiling can't we have
another problem next user ideas
read-only so let's see what we have to
do go index SGS that wasn't it Oh
actions index idea so let's go
here oh listen abit can't this would be
a let so let's save that and now let's
see what happens
let's see unexpected token oh I forgot
the end thing again I think cuz I copy
and paste so components add messages
right here
finish that let's just check all these
while I'm here
all those seem right let's go see if it
compiled okay unexpected token add
message ok components add message line
17
ok my prom here they didn't have an
equal sign so let's save that and
compile again okay let's see it
components add message line 20
components add message line 20 right
here oh I didn't I didn't close my input
above there so let's do close the input
ok export message received in prototype
was not found any constants action types
let's see actions the index this is this
bei let's see what happens now message
list does not contain export name
messages list let's see containers
messages list ok the problem is I have a
s here own there shouldn't be an S let's
save that ok this is another one where
there's a singular plural issue so let's
see containers last message Liz lists ok
containers messages list Oh again this
should be singular and let's see if that
works
messages is not defined messages lists
line 8 let's see the components messages
list messages is not defined
I think we have to import import
messages from message and I'm gonna do
import message and let's see if that
works okay can't resolve component slash
sidebars containers you know I'm having
a hard time with these little things so
I this would just be sidebar now let's
check that oh I spelled users wrong oh
I'm in the wrong one line 7 users
compiled with warnings that means
actually compiled and it's actually
looking how it should look so let me put
something in the bottom here hello and
it appears hi so I put a message in
there and it's going to show it above
here so now you can see every time it
says me cereal is good so right now we
only have one user me and it appears
right up here it from the messages so
that's good we're getting somewhere now
we have to add ourselves in the user
list you can see there's no user on the
side here and it should show the list of
users since we're not actually talking
into it to anyone yet we should at least
see me in the sidebar
later on we'll add additional people
that join the chat we already have the
add user Redux action so it's a matter
of calling in our index at JS file after
initializing the store so we already
have the add user Redux
action if you go into the actions you
can see the add user here so it's a
matter of calling it in our index.js
file after initializing the store so
we're gonna go over to index J s here
and after we initialize the store here
I'm going to do is stored store dot
dispatch
and when a dispatch the add user action
and just gonna add the user meat and
this is just how we are gonna register
ourselves as present in the chat and
since we use this add user here I'm
gonna have to import that so import add
user from and we're just going to import
it from actions and I really should have
paid into these warnings before expected
to return a value in the arrow function
and expect an assignment function call
accepted so think the problem here is
that this should be a parenthesis
instead of a bracket so let's change
this to a bracket parentheses here and
say that now let's see if this works
good less warnings logo is defined but
never used I'm not gonna worry about
that and now it just show me there so
that's the the user there hey do you
want a marshmallow it's probably spelled
wrong that's okay cuz in chat you can
spell things wrong okay so let's go back
over we just have a few more things that
finished out okay I'm gonna just close
some of these files here we're about to
get started on the server-side part a
chat that is local and that does not
communicate with the network is just not
not super interesting so we need to be
able to talk with other people through a
server so we're gonna create a
centralized server where users will log
into and then they can lock they can
talk to each other so we're going to go
back to at the chat folder up here and
I'm going to create a new a new folder
so this should be this is just something
called server and it should be at the
same level as the SRC folder so inside
server I'm going to create a file and
this file is called app that
so we're going to use the the native
WebSocket object in the browser which is
pretty widely supported and use the WS
WebSocket library on the nodejs server
so so here's the server we're gonna do a
Const WebSocket equals require so that's
the the what WS WebSocket library we're
gonna create the web the WebSocket
server new WebSocket that server and
then we just have to put in the port
here when you use port 89 89 so that's
the port wouldn't connect to and we also
want to keep a list of users on the
server so we're just going to initialize
the variable users empty or as an empty
array and we're gonna finish creating
the the server here at constant
broadcast data and when I pass it or so
passing the data end of the web server
so for each client that's attached to
the web server
so if the the client is in if the
concentrated state is is in the
websocket that open and the client does
not equal the websocket we're just gonna
do client dot send this send the data
json stringify data okay let's go down
here now here's where we the web server
is gonna send different things depending
on what's going on so on connection pass
in the WebSocket the index
so the the WebSocket servers received
some data and it's received a message so
we're going to parse the the message
into our data variable dot parse and
then we're going to switch statement
because depending on what the data
actually is we're going to do something
different so data type if the the data
message is showing add user then index
dot users weight index index equals user
dot length and users dot push we're
going to actually just push the user
onto here and the name is going to equal
name or data name and the ID is index
plus 1 then WS end we just send the user
the user list here so dates on dot
stringify type users list and then we're
going to send users so the list of users
now for the next case which is oh wait
we forgot one thing
I go up here and broadcast type users
type is users list and then users so
it's a sin it way to do the WS that send
this and then we also have to broadcast
it and let's see and then also the the
WebSocket and then break it so now we
can go back to this case case add
message this time we're just going to
broadcast with type add method and then
the message data dot message and the
author data author and then also we have
to pass in the WebSocket instance so
then we break and the default is just
going to be to break because there's
only two things that the server does
adds user and adds a message now up here
we just showed what happens when there's
a connection to the WebSocket server but
now we have to show what happens when
when things close so let's go down here
so WS dot on closed
users dot splice index 1 broadcast so
when it says users that splice index 1
that's just removing that current user
from the users list so if someone closes
their browser it's just going to remove
their their user name from the users
list so I put users list users and WS
and and that's it that's it for this
file so I'm just gonna save that file so
basically in this file as soon as the
client connects we're gonna start
listening for the add users and the add
message events so as soon as a client
connects we start listening for the add
user and then the add message event and
when the client connects establishes a
connection to the server it will send
the add user event with the name and
then C we just add it to the server side
so here we're just going to add it to
the server side list of users and then
issue a broadcast to all the connected
clients so when we add a message when
that when the add message event is sent
to the server we broadcast it to all the
connected clients so everyone connected
to the server will get that message and
then on the connection closed we remove
the users name from the list and
broadcast a new users list so that's
that's what I was saying here and then
it broadcasts a new users list every one
so they know that there's no use that
users not on the list anymore and so on
the client side we now need to
initialize the WebSocket object and send
an add user event when we connect with a
client we're also I kind of have to set
up where the client is going to listen
for the add user and add message events
from that are broadcast to the client
and just one more thing you can see we
use the the strings here
instead of the constants it's because
the server can actually read this
constants anything for the constants
folder because the client and the server
are completely separated so in the in
the SRC folder that's the the client
side I'm going to create a new folder
just called sockets and then inside that
folder I'm going to create a new file
called index j s so this will have our
sockets information obviously so first
I'm just going to import the action
types so it types from constants so I
said action types and then I'm going to
import the the actions we're just going
to import the exact actions we need so
it's going to be a add user
message received populate users list and
that's gonna be from actions and then
Const set setup socket now put dispatch
and username C passing in dispatch
allows for dispatch events and now we're
gonna create a Const this socket this is
going to be their new WebSocket
WebSocket bragança
as localhost 8989
which obviously this would be different
depending on if you're running it
locally or on an actual web server
so now socket dot on open
okay once we open the WebSocket
connection let's we are going to send
some information all right as soon as
you use get on the server we're gonna
send you the username so socket dot send
JSON stringify
so as soon as you connect you broadcast
your username and then the server will
receive that username and then send out
to all the people that are connected to
the server that there's been a new user
added to that the chatroom basically and
socket dot on message okay and when we
send a message we're going to pass in an
event object and now we have to be able
to send this message to the server so
first when do con data equals json dot
parse and we're gonna get the event data
and now a switch statement to figure out
what we're what the data actually is so
data type if the case is types dot add
message we're going to dispatch message
received so on message is when were
we're receiving a message from the
server so if that message is so if we're
getting a message we're gonna dispatch
the message received and we're gonna do
data that message data author so we're
getting this information right from the
server the message
and the author and we're dispatching
this action so then we're going to break
and case types that add user put that
over there dispatch adds user data dot
name so we're receiving this new user
from the server and we're just adding
that user to our local copy of the users
and break and the last thing we can
receive type that users list so if we're
getting a whole list of users dispatch
populate users list and data that users
so all this information is coming
directly from the server and our default
is that we're gonna break we're not
gonna do anything if we're don't get one
of those types which really should never
happen so now we're going to return
socket and finally export default setup
socket and then I just have to go over
to the main index file and exit j/s and
I'm going to import this set up sockets
from from there so import set up socket
from sockets and now we need to
introduce a way to handle side-effects
into our code and to handle creating a
WebSocket event when the user types a
message so it can be broadcast to all
the connected clients so to perform this
operation in a clean way we're going to
make use of redux Lasogga which is a
library that provides a good way to
handle side-effects and redux react so
the reason why this is a side-effect is
because whenever you are getting and
information from the server you're not
sure exactly what's going to happen
there could be an error you could get
the the right information you could the
server if you're not actually creating
the server you may not know for sure
what the server it like if it changed or
something
so in redux you always want things that
happen right away but with redux saga it
allows things that happen more
asynchronously and account for for side
effects that could happen where where
your function is changing something
outside of the function so normally in
redux every function your functions
should be pure functions that don't
change anything outside of the function
but if you're dealing with a server just
by the very nature you're going to be
dealing with something outside of your
function so that's why it's good to use
redux saga which can handle these
side-effects so we're actually going to
have to install it so let me go over to
my my console Oh before I actually
install me but should deal with some of
these errors here so let's see
unexpected token oh I forgot the word as
import star as types after that not
contain that use it and export name
populate users lists let's look at the
actions here
Oh still the strong so popular users
list sip suck its define but never use
okay weird we are gonna use it in a
second so now we've dealt with all the
errors I'm gonna go to this other tab
here clear that screen ok yarn add Redux
saga okay now we just have to initialize
that so let's go back to our index dot
JSP round it's not important but
generally we're gonna put the things
that that don't start with a period
first so see how the word react there's
no period in front of it or no these
aren't these are coming from libraries
that they're not from a local file but
all these come from assistants it starts
with a period that means it's coming
from a local file so I'm going to
separate it like that put this together
and then we're going to import create
saga middleware from redux saga and then
down here we're going to import
something that we haven't created quite
yet import handle new message from sagas
we're gonna create that soon and another
thing we're going to create soon I'll
add now is import username from utils
slash name it's gonna be how we're going
to create the username for the user and
now I'm going to create a new Const
which is just called saga middleware
equals create saga middleware so I'll
call that function
now it says can't store we're going to
change this up a little bit so create
store
and said chat we're now gonna call
reducers or we're going to pass in
reducers and that's actually kind of
come right from here instead of import
chat we're gonna change this in a in a
second here but what I'm going to call
this reducers and so now we're going to
pass end reducers here and then also
apply middleware saga middleware comma
okay now I'm gonna get rid of this store
that dispatched you to add user me
because now we're going to create a user
in a different way through through the
sockets the start web sockets so here
I'm going to do Const equal socket or I
mean can't socket equals set up socket
store dot dispatch username so now I'm
going to send over the user name we're
going to do something with the saga
middleware saga middleware dot run
handle new message socket username and
at the very bottom after we register the
service worker from redux
I should have do apply middleware so
redux saga is a Redux middleware so we
need to initialize it during the store
creation so that's why we have the apply
middleware here and then the saga
middleware and once we've initialized
the redux agha middleware so then we're
gonna create the socket with the with
setup socket bright pit and passing the
dispatched function the user name and
then we're going to run the middleware
and pass the handle new message function
from the sagas and then the socket which
has our dispatch function our user name
and then
user name so after we initialize the the
middleware with that apply middleware in
the store creation we are going to
initialize the socket so we can
reference it inside the saga and then we
run the middleware and we have to pass
in the the handle new message saga and
then the socket which has the dispatch
and the dispatch function the user name
before the user was called me but we
want to actually have different names
and not just me for all the users just
for this example chat app we're just
going to use a dynamic username
generator we could make it so user has
to type in their username and that's
just gonna be a little more complicated
than what we want to do for the app
right now if you want to do that add
that functionality in your on your own
you can but we're just gonna create this
dynamic username generator using chance
J s so let's create this file this utils
that name so in the source I'm going to
create a new folder called utils and
then in utils I'm going to create a new
file called name dot J s and I'm going
to import chance from chance and Const
chance equals new chance export default
chance dot first and I should have
already installed this so we actually
have to do an NPM install for chance so
let's go back to here NPM install chance
okay we got that installed the chance is
just a random a random generator it can
regenerate RAM strings numbers for
instance this chance that first is just
the random first name chance that last
we ran on last name you could do chance
that phone to get a random phone number
so we're just gonna create a random name
for for this example
so now let's will create the sagas so do
a new folder in the SRC folder called
sagas and then inside sagas new file
index that j/s and then I'm gonna import
take every this is something directly
from redux saga from redux saga slash
effects I'm going to import star as
types from these are just our constants
slash action types so we're going to
define our saga which is going to be a
handle new message if you remember we
already use this in our other file if we
go back to our we use our handle new
message here with the saga middleware so
we're going to define that here so as
this is going to equal function now this
function star is a generator function
which basically means that whenever you
run the function it could return
something slightly different it's gonna
generate something new so that's what
we're gonna use that's for the this saga
handle new message params yield every
time you a generator function you always
have yield and it's gonna yield the good
do the next yield every time so I'm
going to take every
action action author equals params that
username so so we're handling a new
message from the server basically it can
do this
a synchronously and it can it can add
the message with the author and the
action so this saga is basically taking
all the actions of type add message take
every action of type add message and
when this action occurs we're going to
send a message to the WebSocket so here
we're seeing a message to the WebSocket
and when this occurs we send a message
to the WebSocket passing in the action
and some details and so the the chat
message sent by our user can be
dispatched to all connected clients by
the server okay and there are some
things we don't need up here we don't
need this import add user from actions
we're not gonna use that anymore and I
have a spelling error so this handle new
message there should be an e in here let
me just restart the server okay let me
try NPM install again
okay now let's try running the server
again ok Sokka says not contain an
export name such socket let's just try
taking these squirrely squiggly braces
off around here okay export default
imported as handling message was not
found in sagas okay so I'm in sagas I'm
in index where it's just handed a
message I'm just going to say export
default handle new message
ok module not found can't resolve util
slash name going back in this file and
you know I plenty this last year so
let's try that okay we don't we're not
gonna use a logo so what's this line sit
expecting the assignment function call
and said saw an expression let's see
index line six let's see what that is
you'll take every okay let's try taking
out this comma here okay it's compiled
with warnings so let's see it but maybe
I just take out that logo just to stop
being that warning so that was in at
that J s and I'm just gonna delete this
line here okay compiled successfully as
you know this app has a front end and
back end so we're going to have to be
running the back end server at the same
time that we're running the front end so
let's finish up setting up our server so
we can get that to run first we just
have to make the file runnable so way to
do the sudo chmod zero seven seven seven
dot server / fjs so we can add the
ability to run the server and also if
you remember this server uses the WS
library so I already did this I'm not
gonna do this again but you're gonna
have to put an NPM install - yes save WS
to install that that that web WebSocket
library okay now we just have to change
directories into our server directory
and we're gonna run this server by just
putting node fjs and it looks like we do
have an air so let's go back over to our
server file the app j s in the server
directory and down here I just need to
add a comma here and then also I've
spelled client wrong you're probably
getting kind of tired of my spelling
errors so we have to fix this again I
know I've got quite a few that you're
probably noticing as I'm doing it so
let's just run the server again no to
fjs and it's working so let's try
refreshing this and oh we have another
mistake so given the action users list
so let's go back over here again this is
have another spelling error we have two
ns
this should be plural users okay let's
run this again and the server is running
there's no error so we know that it's
actually working let's make sure our
front end is still running correctly so
in one tab in the terminal I have the
server running and in the other tab in
the terminal I have the front end of the
of it running so you both those running
for this to work
and let's test this out again and it's
working it's adding my randomly
generated name to the the users list and
I'm going to try putting in a message
hello
yep so whenever I put in a message it
lists me as the name but in the users
list my name is Clayton so let's try
getting some more users here so I have
another tab and I have a third tab I see
as soon as I go into the website you can
see the new user is added to the list so
now I have three users under three
different tabs at three different
windows hi everyone you can see it shows
up on every tab hi Clayton so now you
can see how the chat app works we have
we have all the features implemented I
hope you learned a lot and thanks for
watching my name is beau Carnes don't
forget to subscribe and remember use
your code for good</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>