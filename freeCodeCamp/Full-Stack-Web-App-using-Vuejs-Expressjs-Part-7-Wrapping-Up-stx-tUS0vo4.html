<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Full Stack Web App using Vue.js &amp; Express.js: Part 7 - Wrapping Up | Coder Coacher - Coaching Coders</title><meta content="Full Stack Web App using Vue.js &amp; Express.js: Part 7 - Wrapping Up - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/freeCodeCamp/">freeCodeCamp</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Full Stack Web App using Vue.js &amp; Express.js: Part 7 - Wrapping Up</b></h2><h5 class="post__date">2017-09-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/stx-tUS0vo4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone I'm Cody and welcome to
part 7 of building a full stack web
application using view GS and Express
Chasse
so if you remember on the other one part
6 we finished doing the bookmark logic
so we can unset it and set up bookmark
now what we want to do is when we go to
the Browse page if the user is logged in
we want to show a list of all the
bookmarks that the user has inside some
type of like table or whatnot
so the first thing we're going to try to
do is if you go to the view beautify
Docs so whenever this thing loads if I
go down to components and I go down to I
think there's one called data tables
this is what I kind of want to display
the bookmarks in so if you see here we
could just do a nice simple table and
they give you some example code of hell
to do that
it's basically a just doovy data table
passes some headers some items and then
you pass it something to the slot to
kind of tell it how to display the rows
so let's go ahead and try to do that so
going back to our UI we need to go to
our songs view component so I'm going to
go go ahead and just open up the songs
index and then on this song index
section it makes sense if we just go
ahead and add another flex area so I'll
just have the bookmarks be to the left
so let's say B flex then close that out
and then here let's just assume that we
have something called song book marks
maybe Q be consistent with song so song
is - bookmarks so of course that would
assume that we actually have a view
called songs bookmark so I'll say songs
book marks and make that go ahead and
scaffold that out so we have a blank
thing to start with and of course here
we need to say songs bookmarks and
include that and include that down as a
component
so this song's bookmark component is
basically going to do a request to the
back end and get all the bookmarks that
that user has and it also needs like the
songs that are kind of associated with
that bookmark so before we can start
with that let's just go ahead and kind
of work out what the view is going to be
so again I could probably do this in a
panel so I'll do a panel and I'll say
title is bookmarks go ahead and save
this and make sure that this is loading
up so let's see what I miss so going
back to our I don't know I have that one
loaded up going back to our songs index
with a v-flex I forgot to give it an
actual like amount so now it should show
up on the left over here unless I have
some type of constant log
oh I forgot to put the cake I did boob
marks instead of bookmarks so a little
typo there but okay so now the panel's
showing up it's not necessarily
necessarily aligned to the left so let's
kind of figure out why that's the case
and that's because I'm using a column
here so instead let's just do a V flex
row cool so that's working and then here
I think we should be able to do a class
of margin left of two all right so again
the plan is to have all the bookmarks on
the left and we have that left panel
called bookmarks and inside that songs
bookmarks component what we want to do
is first following the beautified dock
so we can say V data table and define a
V data table and then inside the beat a
data table you can pass a couple of
attributes so I can say headers is equal
to headers pagination dot sync is equal
to pagination and then items is equal to
bookmarks so then of course assuming
that you have those defined so I'll say
data is a function which returns headers
and it returns pagination and then it
also returns bookmarks
which is just gonna be an array of let's
just say two objects at this point I'm
just going to go ahead and hard-code
those and headers again is an array of
what you want the text to be for your
row or for your column and then the name
of the key that you want it to reference
it from your bookmarks data so in this
case I'm saying value is title so that
would assume that we have a title down
here and then we'll make another one
here and just say
texts will be artists and the value is
going to also be artists so which means
we could just go ahead and make one
called artist here input testing and
then I'm going to go ahead and just copy
this to have two example data rows that
we can use and if we're pagination
pagination is just an object which a
couple of options you can have so I'll
say sort by and then date and then I'm
gonna say sort by descending true so
that means it's going to sort all the
bookmarks by the last time I bookmark
them in a descending order so assuming I
did not forget anything in fact I think
I did the next step is you need to first
define a slot or pass in the slot of
what you want the table rows to look
like so if I say template slot is equal
to items so remember somewhere inside
this V data table they defined a slot
called items and we're kind of just
passing in this template to them and
then we need to define scope is equal to
props so what we wanted to do here is go
ahead and just define a TD and I want to
say the text is going to be on the right
and that class text excess right is
built in to beautify in case you weren't
aware of the docs and I'll make two
columns for now so I'll do first column
is going to have props that item title
and then the second column is going to
have props that item dot artist so I
should be able to save this and let's
see if there's any issues
okay so i refresh the page and look here
we have a data table with the title of
our song and the artist so at this point
if you notice that we kind of hard-coded
those header not the headers but the
bookmarks here so what we want to do now
is actually request from the backend the
bookmarks for this user
so as I'm gonna say a sink mounted and
I'm going to go ahead and just say if
the user is logged in so I think here I
can actually say like let me go ahead
and kind of modify or steal some code
that we used in the other one so
remember we use computed map State so
here I'm going to do the same thing make
sure we bring in the view X map state so
we can access it awesome and then here
we should just be able to say this that
is user logged in so if the user is
logged in we need to go ahead and make a
request to the backend for all the
bookmarks that the user has so here I'll
say user ID and I'm going to pass it
very similar to what we did here just
like that
so this should hit the back end and just
go ahead and return everything that's
for this user ID and down the road we're
going to be using JWT
so you don't even need the pass user ID
because this is going to be an
authorized endpoint but for right now
let's see we can also probably map the
user to our state and instead just say
this dot user ID and of course don't
forget to bring in the service that
we're trying to use so up here I'm going
to import it go ahead and save let's see
so it is actually making the response
but unfortunately it's returning null so
we need to make a little bit of changes
to the backend and I think that was kind
of an issue that we had with this index
method an index method should probably
return an array and right now I'm doing
find one so let's go ahead and try to
change that index method to instead of
doing fine one we're gonna do fine all
and then so if song ID is passed in I
think this will be set otherwise it
won't even try to search for it so by
making that change change that the
bookmarks and bookmarks remember that
this is gonna break our bookmarks
functionality earlier because I'm
changing the back end but we'll make a
mental note to go back and fix that but
for right now we should be able to hit
that back in and get empty array back so
here we get an empty array and then
notice that we don't have I don't think
we have all those errors in the console
at this point and I guess we do let's
see
so let's see why that could potentially
be throwing in here for us it might be
because let's see first of all this
could be an MTA right now because we're
fetching it from the back end and this
seems to be working fine with the map
State user because we're making the
request to users equal 1 or user ID is
equal to 1 all right so this error says
expected array got an object leads me
the believe that we're passing something
incorrect to items and again the you
know always make sure you read the
errors don't just see an error and kind
of ignore it sometimes I do that I
should just actually read what the error
is but of course this one's because I'm
not grabbing the data I think soon I'm
just gonna refactor this so that I don't
have to do dot data every time and just
have the service do that for me because
that's gotten that's the kind of like
bit me in the butt multiple times now
but yeah I think let's see go ahead and
just refresh that page and hopefully the
air is gone now and yep that was the
issue and we're hitting the end point or
getting back no bookmarks for that user
so I guess the first question is should
we be getting back
bookmarks and I'm pretty sure that we
have been setting bookmarks but I'm not
too sure so let me just go into one of
these songs and verify okay so there
this one is bookmarked or has user ID of
one in song idea of one so let me go
back to the back end and let's verify
what rec query is
because this one should be working just
fine unless this is actually trying to
search where this is equal to null or
something let me refresh the page here
so it's just user ID is equal to one so
instead of doing song ID let's just see
what happens if I were to comment this
out and see if it does return
information for us to make sure that
this is the issue or not okay so that
was the issue it did return the book
mark back to us and it's not running or
anything because we haven't actually
added some extra functionality so one
thing I'll do now is we'll fix this in a
second
I guess it's trying to search undefined
here so instead we should probably say
like where is equal to user ID user ID
and then just say if song ID where dot
song ID is equal to song ID then we
could say we're there so that it works
for both instances but the important
part is we want to get back the song
that's associated with the bookmark so
in sequel eyes something you can do is
if you pass in another option called
include you can pass it an array of
objects or models that you want to
include that are associated to the
bookmark so I can say include model song
and up here I have song included so it
should work and basically whenever this
returns it's going to be an array of all
the bookmarks and then nested inside it
will be the song information so here I'm
just going to say map everything to
bookmark to JSON
and then I'm going to map it again and
this time I'm basically just going to
make a new object with the bookmark ID
so a bookmark ID bookmark that ID so
extend that with the bookmark dot song
which was returned and again a product
to include lodash so that I can actually
use that extend method okay so let's
test this one out and if we were to go I
might want to indent this so we know
this kind of attached to that I made
more sense like that so if I were to go
here and just refresh the page I should
be getting back an array of okay so this
is all this is the bookmark with all the
song information related stat bookmark
and now it's actually displaying here so
that's kind of one way to do it I didn't
necessarily have to do this whole
mapping logic so instead if I wanted to
just leave it as is so I'll go ahead and
save that just to kind of show you what
gets returned so in this instance if I
were to make that request if you see
here in the JSON returned we have a
nested song object so we have the
bookmark information and then we have a
song object or attribute which has all
the song information and I kind of just
want the bookmark ID in the song which
is kind of why I added that whole like
mapping stuff I mean maybe we could just
change the front-end to use this data as
needed but instead I think it makes more
sense to have the API just returned the
song that was associated with it as a
flat object so again that's why I kind
of added this extra mapping logic to
kind of convert it
all right so again that little side note
that we added where our bookmarks are
probably broken now we need to go back
to the front-end and go to that song
metadata stuff where we have all that
bookmark and logic
so now instead when we do that request
to set as bookmark I think this is
actually going to be working just fine
but and now instead is going to return
it all right here so if we were to let's
see this should be an array it could be
blank so I'm just going to say cost
bookmarks is equal to that and then if
book marks that length I'm gonna say
this is a bookmark is equal to bookmarks
of index 0 and that's just so that we
can grab the actual bookmark because now
this should be returning kind of a
different object and then when we do the
post request instead of this bookmark
tidy I think we need to do bookmark ID
because that's what's being returned in
the backend now and a little bit of code
cleanup that I should probably do is
also in map state here since we're
trying to grab all that information we
could just do this dot user
cool so let's double check that we did
not break that functionality so again
the bookmarks are working fine we go in
here we click unset his bookmark and set
his bookmark
okay so we're having an issue again okay
I don't why so actually now when when we
post that's returning a bookmark back so
maybe it would make more sense to not or
to just overwrite that's the ID with
bookmark ID because wherever you have
song ID so
so here ID is one book Rd is 11 and I
think that's our issue instead we need
to have ID is equal to 11 so where am I
in my bookmarks controller let's see I
think I just need to swap this for this
order let's make a new object just end
it with bookmark dot song and then also
extend it with the bookmark
okay so let's try bookmarking and just
some a couple of different songs so I've
go here to this ABC one set is bookmark
go back to browse it shows up here go
back to the modest mouse one we can go
ahead and bookmark that one go back to
browse that shows up and then the test
that we can unhook market of course we
should go back to ABC unset is bookmark
go back to browse and that's also
disappearing alright so I think at this
point the bookmark logic or the bookmark
logic is completely done I'm not sure if
this is the best way to do it but it
works for now I think we can kind of
move on to implementing a recent view so
the last piece of functionality I'm
going to do it for this tutorial
is adding another panel that shows all
the recent songs that you viewed so
that's something nice I think could be
an app is eyes you're like viewing
different songs you kind of want to have
a history list of what you viewed so
let's go ahead and just make a new panel
here in the front end called
recently viewed songs view to songs that
view and then let me just make this a
little bit larger inside this we're
gonna do very similar logic that we did
to the bookmarks table so again maybe
makes more sense to just copy this and
paste it in here instead of bookmarks we
could say recently viewed songs change
bookmarks to songs and then I'm going to
say instead of a bookmark service I'm
going to say recent our song history
service
same thing displaying an artist in the
title display our sort by the date
let's see bookmarks we call that songs
and yes this stuff should probably stay
as it was before but instead of when we
mount we need to instead of hitting that
bookmark service we hit the song history
service and grab all this history for a
user ID save this go to my services and
the UI and just go ahead and copy
bookmark services and rename it to song
history service so when I inside inside
here we don't really need a delete I
don't think with the delete history but
in here we can make a index which is
just going to give us back all the
history for a user ID or something so
I'm just going to put params params and
for here we can do a post request to
history and point and pass to some
history data
so it's go ahead and finish working on
adding that to the front end so I go
here I can say recently viewed songs is
another component that we need to bring
in and of course we need to use that so
I'll say recently viewed songs here
save that that should work fine it's
okay we have a table now called recently
viewed songs and of course no data is
being displayed because we're making a
request to the history and that doesn't
exist on the back end and before I go
and implement that let's just go ahead
and add some matching margined top to
that so I'll say class is equal to 82
okay so again back in endpoint does not
exist so we should probably go and
create one and not only that the model
doesn't exist so we need to kind of keep
track of the history right so we're
going to need another table so we can
insert another row every time a user
were to go to a page so to kind of make
that make more sense maybe in the front
end if I were to go to the view song
page so if I go to the index here when
the user were to go into view we want to
make a request to the back end to keep
track of that song that they viewed so
whenever they load a page such as song /
1 we can just go ahead and make a
request to that history service so let's
say import recently actually affright
what it was called song history service
so grab and grab the song history
service and then here we can just go
ahead and say song history service dot
post and then we want to post the song
ID and of course the user ID that viewed
it
so if you notice here we're doing some
very similar logic with the state so I
need to go here and just bring that
stuff in okay so make sure you bring in
map state so that we can get the user
and then we can say this dot user to ID
and then we can also say only do this I
guess we didn't need that one right only
make this request if the user is logged
in the user isn't logged in we're not
even going to show that panel and we're
not going to have it send back that
information and then for song ID again
we just do a song ID here and actually
maybe it makes more sense to have a
outcome from there as well and all
someone left a comment saying it's bad
practice to access the the state
directly I don't know if that means map
state is bad practice but I mean if they
have a method called that map state is
bad practice why even use it but hey
this seems to make the code a little bit
cleaner so recap again the moment the
user were to hit this page so if i
refresh this page it's going to make a
request to that history service a post
request to be specific so that we can
keep track of the song that the user
tried to view so now we can actually
really go to the back in this time and
the first thing we want to do is copy
and paste bookmarks because history is
gonna be very similar so I'm just gonna
say a history and then rename all this
to history and then of course history
belongs to a user and it also belongs to
a song so if we save this we should be
okay we can go to our seed oops
go to our seed project and we can copy
bookmarks JSON and instead of bookmarks
we can name it
let's see rename history and of course
we'll just say that yes the user has
seen this one and it has also seen song
ID of two and then going here go ahead
and just rename that the history rename
this the history and of course you'd
have to run this only after both the
user end songs I've been ran so it's
gonna go ahead and just say history copy
and paste that I don't know if histories
is even like can be plural but I'm just
gonna do a history with an S at the end
even that's probably an improper English
or grammar or whatever but and this is
also turning green I'm not sure if
history is a key word in JavaScript I
hope it's not but let's just go with it
and see what happens so we have that
model created we have the C created at
this point we should be able to run the
scene that have the history stuff
injected oops let me spell that wrong
histories
that naming convention is this annoying
but okay so now that data should be
there that table should be created and
we should be able to access it sorry
this is just bothering me I'm just gonna
do histories with an S so if we were to
make a another controller actually first
I'll make a route so inside here I'll
say make a histories controller and do
an app dot get on histories go ahead and
call the index method on that and then
of course we want to have a post method
so that we can kind of create that
history record go ahead and save that
and then we don't actually have a
histories controller so I'm going to
rename this copied bookmarks controller
to history's controller instead of
bookmark goes to history all right so
again we need an index method and we
need a post method we don't really need
a delete method so I'll just go like and
blow that away and let's start kind of
refactoring this logic a little bit so
we probably don't need lodash so let's
go ahead and get rid of that to start
off the index method the user is going
to send it in a song ID and a user ID
again we need to request where user ID
is defined and I don't think actually we
need song ID so I'm just going to say
user ID which means that we don't really
need to do all this extra logic here and
we don't need to do an include actually
no sorry we do need to do include
because we're trying to display the song
information so I'll take that back we do
need lodash if you want to do this whole
like mapping goodness but
but for now see history's basically we
grab all the histories we map them and
we extend them with the song that we got
so very similar to the other logic and
then we send that back and then for post
we need to again yes take song ID in
take the user ID we need to not worry
about finding of whatever exists because
we're out this isn't like bookmark logic
so I can kind of remove that code and
here we can just say history equals a
wait history create and of course past
the song ID and the user ID and send it
back that object after it's created
we're trying to create the history
object cool
so probably have a bug somewhere in here
this could probably be cleaned up maybe
but let's test this out just make sure
that we did everything right we have
those endpoints we have the model we
have the controller and we have that
seed data that can be used to run it so
if we were to go back to the front-end
so let's go ahead and close out of all
this and go back to the index let's see
you go back to recently view songs if we
were to refresh the page so go here and
refresh the page
saying that the get request on history
is not found and that's because this
whole naming convention I probably
should name to something other than
history but like recent reasons I don't
know but anyway let's just add an S to
these just because to keep it consistent
in fact I'm wondering how sequel eyes
creates this table insert into histories
okay okay so they add sequel Isis adding
IES at the end for us automatically and
that's probably you know the correct way
we should be doing it because that's
proper English so I apologize for that
I'm just going to do a really quick code
cleanup here
make sure that's all good go here make
sure that's set correctly okay go back
to routes
okay so now it's named correctly in the
Sun bothering me more so let's see how
this works out
so in the app first loads it makes a
request to the histories endpoints what
you see here get requests on that user
ideal one the response is an array of
two objects back so that's working as
intended and then it's not being
displayed correctly here so let's double
check that we're setting that correctly
so if I go back to the front-end and go
to the recently viewed songs song
history service index it's probably
because her name is bookmarks and it is
expected to be called songs so again
I'll just call that history is to keep
it consistent save that see what happens
in this page now
hmm oops update that too cool so you see
here now we have recently viewed songs
down here which if I were to click
something new such as like Z Z Z you see
it made a request to histories with the
song ID and user ID and if I go back to
browse that also shows up down here and
then one thing to notice is that I think
it's not sorting in the correct order
and I think I just need to sort on the
created at date so let's go back to the
UI and sort by created at and see if
that fixes the order boom it does cool
so the same thing with the bookmarks
song bookmarks go back to the sort order
sort by created at and then I'm going to
go ahead and just bookmark because Ezz
go back to browse and again zzzt shows
up at the top
and then one thing that knows is that
it's doing this twice so it might make
sense to like run a unique call on the
history list or something I'm not sure
so again we can probably go back to the
history's controller and just do like
invoke unique on it so basically lodash
has a unique method which will just make
sure that whatever set you pass in or
whatever array or collection comes out
is just going to be a unique set so no
duplicate values so let's see if that
does what we're trying to do and it
doesn't I wonder why
oh I know why because there's two
different histories so I think we could
actually do like unique buying and make
sure we're unique yet buy something else
anyway I don't we get too caught up on
just fixing that little bug or feature I
guess so I think that's good for history
list and I'm gonna try to wrap up this
tutorial really quick here so I'm going
to implement the last part that I've
been kind of holding off on and that is
going to be the final part of the
security using GWT but okay so before we
do that let's just go ahead and just do
that whole unique thing just kind of
again something else that's gonna bother
me so if I do unique by which again is
another method I can pass it in a
collection and then lastly you pass it
in some type of function to tell it what
needs to be unique so I'll say history
and history dot song ID so basically
return us a unique collection where the
key is going to be the song ID so if I
were to save this
and refresh this okay so we only getting
back three even though we have like
viewed zze a couple of times now cool so
moving on to the very last part of this
whole series we want to bring in a
framework our library called passport
which is very useful for using like
Facebook with indication or Twitter
authentication github whatever and it
also has a lot of like of the default
authentications so first of all let's
just go ahead and go to the server and
do an NPM install save on Passport and
then we're also going to want to bring
in something called passport JWT
so with those two libraries we can
actually start going in here and we want
to set up the passport logic when the
app loads so I'm just gonna say require
passport which means that remember I'm
doing dot slash which means that there's
probably a file at that location so
we're going to assume that there's a
file called passport in the main app and
it's this isn't like necessarily have to
how you have to build up your app but
this is just how I wanted to do it
because there's actually a module called
passport we're going to include so it
might be kind of confusing but bear with
me so inside this passport j/s app what
we're gonna do is include that passport
library which is done installing and
we're also going to we're going to need
to include the user model from the
models and there's a couple of things
that you need with passports so the
first thing is the strategy that you're
going to be using so I'm going to
include a JWT strategy which is
basically going to be that other library
that we brought in like this and then
there's another strategy called extra
JWT equals C passports JDBC extract
jadibooti so this isn't actually a
strategy this is just kind of like a
helper function okay so we've included
those two things and now what we want to
do is we can say passport dot use just
gonna say module dot exports null just
to be kind of explicit that this isn't
really doing anything other than setting
up this passport mmm object so instead
when we say passport I use we need to
pass it the strategy that we want
passport to use and that strategy takes
in a couple of options so the first
option is JWT from request and we're
telling it to use the extract JWT from
off header as bearer token and what this
means is basically if someone makes a
request that has the bearer token and
the authorization it's going to go ahead
and use that and then secondly we need
to pass as some type of secret key so
I'm gonna say config authentication JWT
secret and I think I forgot to include
config so I'll just say constant config
is able to require config config and
make sure we have that secret defined
which we already do because we use it
for creating the JWT token so basically
this strategy is going to decode and
verify that the token that comes in on
this header is valid and during that
whole logic we can just go ahead and
pass the strategy yet another callback
where we can do some custom logic to
verify and return messages based on if
the payload is valid or not so in here
I'm just going to say try and then catch
error if there's any type of error we
can just go ahead and say
turn done new error false I'll explain
what exactly is going on here up here we
can say the first thing we need to do is
when we get a request we need to first
check that the user exists in the
database so I'll say user equals a
weight user not find one where ID is
equal to the date WT payload ID and jwp
or JWT payload is going to be whatever
we decide to encrypt or to sign so or if
you remember in the authentication
controller we sign the user and user has
a dot ID attribute so when it comes in
and if it's validated or verified we can
just go ahead and grab that ID and say
if the user does not exist for whatever
reason we can just return a new error
and false and then otherwise we could
just return that user object
Oh see why is this doing think I'm just
missing a close parentheses yep so this
may not make a whole % since right now
I'm gonna come back and kind of walk you
through this one more time but basically
if you pass back in the strategy and the
second parameter the user it's gonna set
it for you on wrecked out user for you
so basically this is the only instance
where wreck dot user will be set the
other ones are going to result in errors
but since we're gonna do some custom
logic we're going to add a folder called
policies in fact where we have a
controller called policies but I'm going
to make a file called is authenticated
j/s and inside here I'm going to go
ahead and just include passport and this
is going to export a function which
calls the passport dot authenticate jwd
strategy keep renessa on JWT
okay so again walking you through this
basically we're gonna be using this
policy is authenticated and putting it
in front of our routes and this is going
to call passport authenticate with the
JWT strategy which will make sure that
it will call whatever this strategy is
we created input here so again this
logic is going to it's going to try to
find a user if exist in the database if
it doesn't return an error if it does
return that user and notice that we're
doing error here and false and then all
end-user we can say error and user which
are just being passed to this function
here and of course we can say if there
was an error we need to go ahead and
just say rezzed
status of 403 authentication error
that's in error message' be you do not
have access to this resource or
something like that and otherwise the
user is probably logged in I'm not
probably they are logged in and their
user exists in the database and the
token that they used is validated
correctly against our secret that was
defined in our config file here so that
means that everything should be good you
know at that point if I can go back to
whatever file is in we just call next
so taking back what I said about
Passport
we are going to pass in user here and
our custom call back authentication
logic is going to set direct user for us
because - I didn't really like the way
passports default error was being sent
back they weren't sitting back a JSON
object they were sending back like HTML
code and if I want to purely arrest like
JSON API I kind of had to write this
custom logic but anyway going forward
how do we actually use this
authentication endpoint and hopefully
this doesn't have any issues with it but
first step is we can go to routes and
then some of the things that we want to
authenticate include
let's say the bookmarks right so if
someone's trying to access their
bookmarks so I guess it is authenticated
and of course I need to bring that in up
here so I'll say Const is authenticated
is equal to require policies is
authenticated so we want to authenticate
this get request on the bookmarks to say
hey the user has to be logged in they
has that they have to have a JWT token
that sentient it needs to be valid and
it needs to be connected to a proper
user ID so if you remember before in
that bookmark controller if I go to that
controller here we'll go to index method
we were assuming that user ID was passed
into the query string so at this point
it makes more sense to instead set user
ID equal direct user ID because that's
coming from the JWT token which has been
proven to be valid so we don't want to
accept it from the query string anymore
instead we just accept it from the user
ID and I think that should completely
change and make this endpoint
authenticated so if I were to save this
and if I were to go back to let's say
this let's see what happens if we try to
refresh this to bookmarks
let's see unknown authentication
strategy date JWT
alright so that's kind of like debugging
this a little bit and I've actually
forgot to do not user so basically this
could be set to false which if you
remember I think we were setting it to
false in a couple of these instances
so again if there's an error or if this
is not true or not defined we need to
send back in here otherwise set req dot
user is equal to the user and then call
next so now if I were to refresh this
page we get back in error
403 forbidden because we're not passing
in an authorization header so at this
point we need to add an authorization
header to the request headers which if
we were to go back to the client
and then go back to that API function
that I created we can go over here and I
think we can just do headers let's see
it stole ticks out of the way we say
headers and then we can say the type or
the name of the header so authorization
and then when of course we can just say
bearer and then the token
all right so but the token remember is
stored on the store and the Steep so I'm
gonna import the store up here so the
flash store slash store at least I think
that's I remember correctly yep
so I'm gonna import the store instead of
store or instead of token I'm gonna do
store dot state dot token so now
whenever that token is set it's just
going to add it to the header here and I
think if I were to go back here we see
that now it's passing bear and the whole
token there which means that now we get
a response back with all of the let's
say bookmarks related to that user and
just to show that we don't need the user
ID in this parameter let's just go back
to the UI so I think the back end is at
least done for adding the extra
authentication for JWT but in the front
end if we go to a song metadata which is
here instead of sending user ID we no
longer need to send that because that's
going to be extracted from the JWT token
on the back end so I'll go ahead and
save this and I think this is well
alright so for Senna's bookmark you can
unset his bookmark we no longer need to
pass an user ID either so let me just go
ahead and go to the routes for that and
say is authenticated for post and also
is authenticated for I think delete
so then if I go to bookmarks controller
for post setup user ID here we can say
cause to user ID is equal to r fw sort
out by d and then for delete Const at
user ID is equal to rec dot user ID and
then instead of doing fine by ID we only
want to find like this is a way to add
some type of security into our
controller we have the user ID so
instead we could say find one and then
where we could do ID is equal to
bookmark ID and then also we can check
where user ID is equal to user ID that
makes sense so basically this will only
return a bookmark if the user is trying
to access one that they already have
access to so I can say if not to
bookmark ok again return read status
that 403 send an error saying you do not
have access to this bookmark and
otherwise you could just do an await and
then destroy so let me go back here make
sure that seems like it's all ok so
unsaid
works as intended set is bookmark it's
also working as intended so those are
working if I go back to browse see go
here set is bookmark make sure that
still shows up cool
so bookmarks are still working and now
they're authenticated against the JWT
token instead of the user passing in
that user ID inside of the query string
in fact I think I still am doing that
here so let me just go ahead and do some
further clean-up try to find out where
that's being passed in
oh that's being passed in on the the
index page so if I were to go to hear
songs bookmark we do not need to pass in
user ID here anymore so go ahead and
save that and go back and let's just
refresh it so we have fresh states so
notice here we're not passing a query
string in in anymore but we are passing
in the authorization bear JWT token and
we're getting a response back and then
we should do the same thing for the
recently viewed songs we should probably
add some type of authentication over
that so I'm going to go over to the back
end to the routes same idea I'm just
going to say add is authenticated to
this end point and to this end point and
then go into the history's controller
and again we could just grab user ID
from wreck dot the user got an ID
because we know it should be defined
only if this user was valid I think
we're okay there and then same thing
with this instead of a grabbing it from
the body let's just grab it from that
rekt user ID and return the same stuff
so make sure that the server restarted
refresh the page
let's see it looks like history's is not
returning anything now so let's see why
so history's we are passing the token
still and we're also passing a user ID
in the query string so let's just go
ahead and get rid of that because it's
just extra stuff that we don't need to
pass so user ID get rid of that let's
see and then the same thing with view
and we go to view a song we don't need
to be posting the user ID anymore
just the song ideas should be sufficient
enough but okay so histories is
returning a blank array which is not
expected so let's go back to history's
controller and go to the index method
let's just go ahead and print out what
user ID is set to
so it's set to undefined for some reason
one of rec that user is just not even
defined either
let me make sure I'm actually see is
authenticated
Wow that's kind of weird so I'm printing
out the user and it's actually having
like data values this is so strange
let me print out to stream to Jason I
mean
I so rec dot user ID is equal to one but
when I print out user ID is undefined
which is very strange because I'm not oh
the let me get rid of that okay that
should fix it um make sure I didn't do
anything stupid with the other one use
your ID user ID yeah so the main issue
is I had this in curly braces so that
was my bed alright so refresh this page
now and we get back the recently viewed
song so the histories is now returning
something and if I were to try to view a
new song it's doing a post request and
that seems like it's saving correctly -
and if I were to log out we wanted
bookmarks and recently view songs to
disappear but they did not so again we
can go back to our UI go to the songs
page I'm just going through some of this
stuff and basically here in this Left
panel we want to say V if and then is
user logged in and then we could just go
ahead and grab that view X map state
logic so pull that in pull that computed
thing in
so now if the user isn't logged in those
two should disappear and I want this
thing to become a full twelve what's it
called like twelve columns I guess so if
I were to let's see all right so it's
not L so we can do here is if for
whatever reason the user is logged in or
isn't logged in we can go ahead and just
bind a dynamic class to this so instead
of saying XS six what do we actually
want to do let me add did this one is
say put XS 6 if the user is not logged
in actually put a 12 they're not logged
in and put a 6 if they are logged in so
that should make sense that should
expand to a 12 if the user isn't logged
in what you see here and then the moment
we log in over here testing at gmail.com
1 2 3 4 5 6 7 8
save that we now get to columns on the
left or we get a column on the left of
with 6 and then a column on the right of
with 6 make sure this is also working as
expected
all righty everyone I think that kind of
wraps up the remainder of everything I
wanted to work on I know I could
probably continuously add on new
features and functionalities his app but
the purpose of this series was just to
give you a really good overview or not a
good overview but a basic overview of
how to use view how you might want to
use Express an example way of how to
build up your project how to organize it
a couple of overviews about like you
know NPM sequel eyes passport
authentication JWT view beautify view X
for storing your state persisting your
state to local storage so I kind of just
hit all the different things that you
might have in a real world full stack
application but I didn't necessarily go
super in-depth onto all the different
things you could have so a couple of any
remarks I kind of started out this video
like kind of typing verbatim from a
pre-existing like app that I worked on
but then as I went further on with the
parts I kind of just started doing ad
lib so that's why we kind of ran into
more bugs and you got to watch me do
more debugging so I guess one question I
had was was watching me struggle with
debug game useful for you like was it
helpful to see me go in here and like
try to figure out okay why is this
returning this status you know figuring
out the console logs or what I've just
been better to just see the app created
with very little bugs or debugging so
let me know about that also let me know
if you have any feedback or any
suggestions of how I could have made my
code better there's different things in
view that I probably after this series
I'm actually gonna read the whole entire
view documentation I'm gonna read all
the view ups documentation probably read
all the beautify examples in
documentation because I didn't really do
that before making this so it's kind of
my bad but I didn't really have the time
to do that but yeah if you definitely
feel free to send me a tweet and give me
feedback on how I can make this video
how I could have made this video
better let's see other thing there's
anything else I want to mention yeah I
guess the last thing I mention is again
this project is hosted on my github repo
which is in the description below and
feel free if you wanted to keep adding
features onto this I will review the
code and I'll you know give you feedback
on like cool feature that you added or
whatnot and I'll merge it into the
actual branch so if you want to get
practice doing a fork off of the repo
and then submit a PR I'm not going to be
like a really strict like I'll just read
through it if it seems ok I'll just
merge it in why not
and maybe I'll grab it and just play
around with it so again totally feel
free to like try to add features onto
this I have no problem with you doing
that and also feel free to just grab
this project and do whatever you want
with it it's MIT so again I really hope
this tutorial was really useful for you
all I know there's a lot of places that
I messed up on and I probably could have
done better but again this is totally
free tutorial and I didn't really have
all the spare time in the world to make
sure it was perfect so I hope it was a
good overview I hope you learned a lot
and I hope you will continue to learn
how to program and build full stack
applications by yourself and make your
own progress and feel free to ask me
questions if you have any questions or
suggestions again my name is Cody
Seibert and feel free to follow me on
Twitter which is in the description
below and be sure to look out for more
videos on free code camp in the future
and good luck and have fun on your
latest programming endeavors alright
have a good one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>