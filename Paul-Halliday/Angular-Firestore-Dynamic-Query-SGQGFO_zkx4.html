<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angular Firestore Dynamic Query | Coder Coacher - Coaching Coders</title><meta content="Angular Firestore Dynamic Query - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Paul-Halliday/">Paul Halliday</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angular Firestore Dynamic Query</b></h2><h5 class="post__date">2017-12-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SGQGFO_zkx4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this lecture we'll be liking a
creating dynamic queries with
angularfire store so we have a
collection called lesson and a couple of
documents like content things like an
author a Content debt and debt and title
so these could be particular lectures
for a course we have this ended here of
the 24th of December and another end
date of the 31st of December so I want
to query for a specific week this is
where the end it is seven days after the
previous end it sort of start with let's
ensure that we have our angularfire set
up inside of the project I'm going to go
over to our module TS and import the
angularfire module and the angular
firestorm module and appropriately
initialize our application make sure
you've added this to our imports and
then inside of our app component dot t--
s we can add a constructor and eject
angularfire store and that comes from
angularfire to slash fire store next up
we need to create what's known as a
reference this is where our fire store
collection is and we can see a lesson
Ref and that's an angular fire store
collection and at this point it expects
it type so we can mainly create a models
folder and a lesson
don't Model Ts and export a new
interface called lesson and that lesson
has a date I've typed it it also has a
title of type string content of type
string author of string and end it of
dit this model is currently different to
the collection that we have on fire
store but I want to keep things super
simple so one hour then D is import the
lesson and add that to the fire store
collection type make sure we spell less
with a capital S and import that from
angularfire to slash fire store to start
with let's get some
on screen we can set the lesson
reference equal to this don't ifs
collection and it will be a collection
called lesson we can then create a new
lesson dollar of type observable lesson
areia and this will hold the lessons
that we get back from fire store and we
can set the lesson dollar equal to the
lesson ref dontoh of value changes at
this point we could head over to our app
component and we could make in you UL
with an li and for each li we can create
a new lesson using the async pipe and
simply display the lesson title so what
we currently have is a both the lesson
title and the lesson end it will pipe
that using the debt pipe and we can then
see that of course we have a lesson one
which ends at the 24th of December and
lesson two ending at the 31st of
December let's create our own end date
subject this will be what's known as a
behavior subject and a behavior subject
allows us to provide an initial value so
let's import behavior subject from rxjs
we can then give our behavior subject
the type of dead and if we wanted to we
could set the initial end it equal to a
new behavior subject with it be dead of
2017 1224 so we're essentially saying
that our initial end it that we want to
filter for should be the 24th of
december for now we'll want to remove
the lesson reference so let's remove
both the variable and the declaration
and instead of saying that our lesson
dollar will be equal to the value
changes event on our lesson reference
instead we want to take the end it and
we want to use the dot pipe methods this
is a new method that was added on the
litter versions of our x
yes and effectively it allows us to
control our imports our tree shaking and
a variety of other concepts with the
rxjs operators these are now simply pure
functions which we can import from rxjs
slash operators and we'll want to use
switch map we can use the switch map
function to get the current debt and
pipe this to this dot airfare stock
collection of lesson but we then want to
use the reference function we want to
reference where the end date is equal to
our debt but we also want the value
changes because we want this as an
observable we then need to type our
collection so let's type this as lesson
and already on screen you can now see
that we have lesson 51 but we don't have
less than 52 if I change this to instead
be the 31st of December we now get
lesson 52 but not in lesson 51 the great
thing about observables and behavior
subjects is that we can push in next
value so let's then create a next lesson
function and a previous lesson function
we can say that we want to push the
ended dollar dot next and we want to
next the current date and then we need a
way to add seven days to this date one
of the easiest and most consistent ways
to do this is to use moment we might be
using moment throughout our application
in other places if we're dealing with
dates quite often so let's open up our
terminal and we can use NPM install
moment we can then import a moment so
let's import all as moment from moment
and we can go back down and say actually
we want to get the current value and
surround this in the moment tag source a
moment get the current date
then we'll add seven days and we'll then
cast this toward there because our
behavior subject is expecting to have a
debt we can then copy this and add it
for our previous lesson but instead now
we want to minus seven days once we have
done that we can head back over to our
App component to HTML and we can add two
buttons one that says next and one that
says previous and for each one we can
add a click event called next lesson
and finally previous lesson if we then
click Next
we get the lesson 52 and previous will
give us lesson 51 so depending on an
observable inputs we can then of course
change the query from angularfire store
giving us the ability to truly filter
our data in a much more consistent
manner than the real time database</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>