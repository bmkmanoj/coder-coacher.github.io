<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Time Series Data - Analysis with the Aggregation Framework | Coder Coacher - Coaching Coders</title><meta content="Time Series Data - Analysis with the Aggregation Framework - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/MongoDB/">MongoDB</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Time Series Data - Analysis with the Aggregation Framework</b></h2><h5 class="post__date">2015-04-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fPCi34gAzQQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">MongoDB provides an application
framework which uses fundamentally a
pipeline type operation we're probably
familiar with those for example UNIX or
for that matter ms windows provides type
operations an example would be UNIX grep
which searches for text and files we can
pipe that using a passkey pipe character
into a sword operation which will sort
the lines coming out of grep and we can
further pipe that into a unique
operation which will remove recurrent
lines
all right that's at the operating system
level we have a similar approach in
MongoDB segregation framework with our
pipeline so we can for example begin
with a dollar match selecting out of our
entire database and producing a stream
of documents that stream we can then
pipeline into a dollar group operation
which will group them together producing
aggregates such as averages and we can
then for example take those and do a
dollar sort operation to sort them into
order this is going to emit a stream of
result documents these are not
necessarily one-to-one with a stream of
documents so for example in this case
the dollar group operation emits a
different set of results documents than
dollar masked edge selecting from the
database all right that's the principle
now let's take a look at how we would do
this choosing to create an average speed
over a period of time for a given road
segment we'll begin with the aggregate
command in MongoDB that's DB collection
name dot aggregate and this will work on
the current database which is elsewhere
been selected in the MongoDB API we now
begin with our selection this is at
regular expression selection that we
talked about so we're going to select
one primary ID for segment ID 2 0 4 8
409 7 this is going to bring back
everything for that segment ID will now
do a projection of the speed so
essentially here we are choosing based
upon the documents we've selected to
pull out the speed and the segment ID
this is creating still the same stream
of documents from the database but just
projecting the individual fields we want
the same
and returning any of the other fields we
may not want then an unwind operation
which loops over the data points these
individual minutes within our document
be it our minute or whatever and then
finally a group operation this is going
to create the output stream of documents
the primary ID of these being the
segment idea in which we selected in the
first place and the average being
produced then over these unwound data
fields so net of all this we are going
to produce a document like you see in
the very bottom after the semicolon with
primary ID equal to the segment and
average equal to the average speed for
that segment over the range for which
we've selected we can go quite a bit
further with the aggregation framework
I'm not going to delve into the
differences here but we could for
example return variants as well as
average in this case doing everything
that's needed in the aggregation
framework to compute the variance based
upon a mean of the differences squaring
that result so all of these advanced
features are available in the
aggregation framework because it is a
pipeline it would necessarily need to
just be the average</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>