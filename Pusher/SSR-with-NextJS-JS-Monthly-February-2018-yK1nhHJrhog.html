<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>SSR with Next.JS - JS Monthly - February 2018 | Coder Coacher - Coaching Coders</title><meta content="SSR with Next.JS - JS Monthly - February 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>SSR with Next.JS - JS Monthly - February 2018</b></h2><h5 class="post__date">2018-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yK1nhHJrhog" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah my name is endre Kokila and the
talk is SSR with next Jas this is my
first time at Jas monthly and I thought
a good icebreaker is to just kind of
kick off with a live demo so hopefully
if it all goes right you're gonna think
I'm a code ninja but realistically this
is what's going to happen so what I want
to show you guys is just how easy it is
to setup an XJS project give you guys a
bit of context and what I'm talking
about before I kind of delve into some
of its features so we have to do when
kicking off a next year's project is
installing three dependencies next react
and react on and next has some scripts
that you can use like a dev script a
build script in a production script but
for the purposes of the talk we're just
going to be using the dev script so what
we'll do I want to just run up my my dev
server and it's gonna throw an arrow
straight away because what we need in a
next year's project is eight pages
directory and the pages directory is
kind of the only thing that next yes is
opinionated on kind of helps with your M
it helps with the F server-side
rendering and helps with the routing as
well so I'm just going to make a couple
of pages in here we're gonna do an index
page an Accounts page and say we're a
ecommerce site gonna have some t-shirts
and a directory here and then we're just
gonna have a t-shirt file in here cool
and you'll see why nested a nested
things in that directory briefly and so
a little nifty feature with next is that
it assumes that your going to be using
reacts because it's built on top of
reacts you don't need to import react
every single time saving a little bit of
boilerplate so if we just kick off with
a little div here and write yeah for now
we'll just do an h1 tag this one's going
to be called index and now if we run our
dev environment again it should give us
the all clear cool so if I go localhost
3,000 straight away we're just gonna see
index hopefully yep that's our index
page
we can do our routing accounts it's
based on the name that we gave it and
then we can do kind of longer would I
call the t-shirts and I can give it a
what is it called just like pass it down
like a URL parameter I guess not really
but so yeah our directory was t-shirts
and the file inside of it was t-shirt
and that's just like a little nifty
feature in there and I'm gonna create a
components directory and in here I'm
gonna make a button and this is just
gonna be a one of next yes is built-in
functions next got link which just lets
us kind of link between pages so again
just going to export default a little
div actually not a div a link and it's
going to take two properties and so the
title is going to be props dot a name
and we're going to pass in an eight ref
props dot location I'm not exporting
that and we're gonna oh sorry man let me
just go over that again then for you is
that better
cool so yeah just imported link just
returned a link element and inside of
here I'm gonna be importing that I'm not
complaining button and cool button we're
going to pass in location and this one
is going to be our accounts and the name
is going to be called account and let's
just copy this over to my accounts page
Oh
and import that at the top - so put
button from Conant and button sweet so
hot reloading has done its job hopefully
and if I go back to my home page I've
got an account that links nicely
backwards and forwards off I gave it the
wrong name cool sweet and just quickly
before I move on next yes has styled JSX
built-in out-of-the-box which is a gray
which is a great CSS tool similar snap
style components where you just kind of
have styles that are scoped to that
component so if one have an F one with a
size of only 30 pixels that would work
hopefully I'm going on accounts and that
didn't work but let's just pretend it
dead so I can move on cool so next yes
it's really easy to set up I'm a big fan
of it
the guys at site they are an excellent
company that I'm not affiliated with I
was asked last time actually if I was
affiliate to a site because I just love
next yes so much but no I'm not
they do great products like Star gsx
even do now if you guys have used that
before a really easy deployment to web
and that also works really nicely with
next Jas but yeah like some of its great
features out of the box are transpiling
and bundling as you guys saw it kind of
had hot hot code reloading kind of
working really nicely it's easy to kind
of serve static files and your styles
with that too and another nice little
thing is a kind of graceful error
handling if I was to have made an error
which I could probably do now quickly
for you guys for instance if I kind of
left this out then it would probably
tell me here what I've done wrong and
that's really nice so let's just
clear my dev server and get back on here
cool so that's a brief introduction on
next J s so about me my name is Andrew
Co here's a picture of me playing the
accordion
humming in web development too long up
until about two years ago I worked from
the family business or fish and chips if
anyone from southeast London and
broccoli then you're familiar with our
family shop Rocky's rock which have won
quite a few awards were best chips in
London so if you're around in the area
feel free to pop down but then yeah I
kind of got into full stack web
development and got my first show
between technologies where I kind of
worked until recently and currently work
at Trent and I'm with a couple of guys
from Trent they're offering my offer in
their support but just like a quick
brief on what twin is we are a kind of
an automated transcript service that you
kind of like utilizes AI to generate
like generate transcripts in minutes be
part in an audio file we can handle like
a few different english accents and use
like twelve european languages so it's a
really fun product and I'm enjoying
working with them but aside from that
like some of my interest in music as you
saw from the accordion so if you guys
want to hit me up on Twitter then you
know talk code when you talk music I'd
absolutely love it and you can also find
me on Instagram both of my handlers or
injury Kokila cool so this is the meat
of the talk
what is SSR so SSR is server-side
rendering for those at the your honor
that are unaware it's where your your
HTML page is built on the server side
which means instead of making laser
requests every time you need an asset VM
server retrieves all those assets all in
one go and then sends you back a fully
built page with everything kind of all
nice and bundled feeling so like a
little nice analogy it's thinking a food
shopping if your guys client-side
rendering and be like going to the shop
every single time you need a meal you're
making that journey to the shop getting
like your lunch your scenes please mil
deal and then going back home and you're
doing that three times a day for every
single meal or a server-side rendering
and making one journey to the shop doing
your whole week shopping and then come
back the time to first byte in both
instances
is a little longer for server-side
rendering and your weekly feed job but
you won't have to keep making additional
requests to the server or the shop doing
that so yeah like I said time to first
byte is longer by using server-side
rendering so here is a much nicer kind
of explanation on that so the
server-side rendering at the top you're
making a single request and everything
gets built on your server and it sends a
response
the thicker arrow kind of indicates
there's more data involved with that and
then with client-side rendering you're
making requests getting back your
bare-bones index file and then every
time you need something else it just
kind of like goes backwards and forwards
if you've got loads of like images on
your page you can only do like a maximum
of four requests on HTTP one then that
might kind of cause a performance issue
down the line and so here is like
another visual representation of
client-side rendering so you click on a
modal that has a bunch of images and you
got lots of pop in and even though it
loads a little quicker than it might do
on server-side rendering it doesn't look
great and the kind of perceived loading
might feel a little slower where a
server-side rendering if you click your
about page the initial load might be a
little longer but because everything
comes back or kind of rendered for you
then you know it kind of displays well
at once
so what is SS are good for SEO is again
instance received low perceived loading
of the website and that kind of even
outside of an XJS it's really easy to
kind of integrate with angular 5 and
react 16 nowadays so even if you're
interested in SSR but don't want to use
next Jas you can go about you know kind
of utilizing it quite easily now now
there are a couple of caveats with using
SSR first one being is that there is a
link longer initial load time first bite
is a little longer because you're
getting back more data and the server
has to take a little longer building it
and there's also more work on the server
side you know if you have a large
website or you're using kind of AWS or
as your for scaling more work means
you're spending more money so that could
kind of like to tell you from using SSR
but I'm gonna like give a couple of
solutions as a way to kind of reduce
that impact so here is the yeah SSR with
next Jas so let's kind of get on to it
so SSR works out box you don't really
need to do anything there's no config
involved how it works is that the pages
directory I showed you earlier on the
first node of the website next yes index
is a so that means even though there's
SSR on the first load of the page it
uses client-side rendering on the
subsequent loads so the first ID will
feel a little longer but because
everything is already kind of indexed in
your web app everything can kind of like
be easily accessible from your from your
web app on the client side so close code
splitting another really good feature
then next has the great thing about it
is that it will only bundle the code
that you use in your particular
component so if you have an imported
Redux in your page you're not going to
get Redux bundled with your page this is
a great way of kind of Shaving little
precious milla bytes kilobytes rather
off your bundle size can make your site
feel a little faster because then only
nests only loads the necessary code for
each page and another thing is control
resource prioritization and that is
where the browser can kind of realize
what is the most important thing to
download first if you've got blocking
j/s or you've got blocking CSS your
browser will know to download that first
so then the rest of the site can start
leading cool prefetching another great
feature it downloads the JavaScript
bundle before the user actually even
navigates to that page we add the
attribute into your link element that
I've showed you guys earlier and what
this does is
it doesn't need to inject the code
before you load when when switching page
which means get initial props which is a
method I'll show you guys in a little
bit gets run on the client side not the
server side and this is just a way for
the next day as to kind of populate the
props before the site loads and this is
a nice little ahead of time feet will
kind of make sure make sure website feel
more like a native app because of this
ahead of time download feature and yep
this kind of solves the TT FB problem or
kind of at least reduces it so here's a
live demo of that in action so we're
going here and let me just kick off my
dev server again cool hopefully let me
just cool so again I'm only using free
I'm only using three packages react next
and react on but I'm also using
isomorphic comforts just for this fetch
method here but what's going on here
this is that I get initial props method
that was telling you about earlier so
that would normally run on the server
side it gets all the initial props and
then sends it back to you and then
populates the page whereas if we use
this prefetch if we use this prefetch
actual butan link as soon as you load
the site you kind of get the Java Script
bundle downloaded so that you don't need
to go back to the server to run this
method there are a few other ways you
can you can call prefetch imperatively
using the router which next also kind of
has for you to use so let me just kind
of show you how that works
so let's cool so behind the scenes we
kind of clicked this quick react app one
and oh I think my Internet's not working
that would normally have gotten some
things from github so that's not very
good but
what we can see is that if I hover over
this how about next we can see that this
method rooted op prefetch ran because
I'm console logging out prefetching home
so that javascript bundle would load
before I even click this how about next
and then it would load it and kind of
populate the props come in the client
side and my Internet's working out as
well cool that was a brief demo on that
so another one of next chases features
is SS are caching what SS are caching is
it kind of solves that issue of the kind
of X kind of increased server load so
like I mentioned earlier server-side
rendering can can use a lot of your
server power again that cost your money
down the line if you're using Azure
so what we can do is everytime we render
a page from the server side we can cache
that and there are a couple of great
plugins that work nicely with next that
you can use caching with LRU cache is
one of them LRU stands for least
recently used resource and it's a great
way of just kind of storing your most
recently used pages and just kind of
like pushing out the ones that aren't
getting used you know
since they're not being used so another
really quick demo of this in action so
let me make sure I've just cancelled
that suite and I'm on my dev server - oh
I think I've got the wrong one
here we are
cool so we've got this index page sorry
ass this server page and all it does is
just kind of users creates up an Express
server uses LRU cache and users next so
this kind of stuff is just kicking off
your server like normal this is how you
kind of beach trap next into your app
from the server side you pass in the
home directory and you also pass in
which which environment you're on dev
reduction or other so then we've got
this SSR cache where we kind of
initialize our cache objects we pass in
the options we want to have a hundred we
want to have a maximum of 100 pages
stored in this cache and we want them to
last an hour and then we just run
everything else like a normal Express
server so we get you know we get our
index page and instead of sending back
the index page we use this render and
cache method which I've written down
here so we create a cache key and what
we do is every time we look for a page
we see if the the page is stored in the
cache if it is you know we we
console.log a message cache hit and then
send back the the correct page otherwise
if it's not in there we just add the key
to the cache say that the cache was
missed and then just render that page
like we normally would in Express so
this is in action
so I load my page and let's go to the
blog first and if we go here because it
was the first time we went into that
page it says that the cache was missed
so if I go back and load it again
because it's been stored in the cache
you know it hit the cache and then you
know if it was a kind of a more bloated
site it you know you would notice a
performance difference so again if I go
to this other blog post it didn't go
inside you know it didn't hit
cash because it doesn't exist in the
cashier and one more time because it's
stored there now we can see it it's been
hurt cool
and finally just on kind of next feature
sir sorry a really good kind of
supporting their platforms not just next
but kind of every other every other
product they have and the memory acts
extinct came out they will you know as
react fiber they were loads of
performance increases next kind of
released an update to make sorry site
released an update to make next
compatible rack 16 almost immediately
and that counts for a lot when I look
for kind of like a plugin or a framework
to use is how well it is being
maintained
so recently next released their fifth
version in the I've done this talked
once before react meter and one of the
questions I got was what was my least
favorite aspect of next Jas and it was
their lack of support previously star
Jess X and a few other kind of inline
solutions were were kind of the easiest
way to go if you wanted to use sass in
your project you'd have to kind of bend
over backwards kind of configure your
web pack quite a bit and your next
config file whereas now they kind of
make it really really really easy to
just import a sass plug-in and it kind
of works from there another one just
general improvements there web pack but
a cool thing that I was really
interested in is they're kind of
implementing zones into a product now
and it is quite a em you know it's worth
talking its own but really briefly if
you're if you use a micro service
architecture and you've got three or
four different sites that will use an
XJS you can kind of connect them up
using next zones to kind of use that
prefetching prefetching and kind of the
SSR that next kind of has speed to use
between them so you're not so it kind of
feels like they're all connected even
though they're completely separate web
sites so that is something you know I'm
going to be using in the future
hopefully so this actually kind of
does come towards this is now the end of
my talk it kind of went by a lot quicker
than I expected it to but yeah like some
final words I do really like next is I
find it easy to use I haven't used it in
a production level even though even
though as I do use it on their main
website and they say it scales scales
really well but I haven't done that
person myself the examples online are
incredible they have like great
documentation and actually know what I'm
going to quickly on their site their
github and show you just how mint like
the sheer volume of examples they have
so let's go next j/s github and if we
just flick through the examples here
there is examples for every possible use
case you could ever one you got it with
a Palo you got it with reason mo and
some I mean like what is what is table
in CSS I've never heard of that like so
so many it's like very exotic almost how
many different examples they have so
back to I was I think Dan Abramoff of
Facebook he wants tweeted that his
friend uses next Jes and I his friend
likes it so I mean I take that as like a
glowing recommendation if if anything
that's anything to go by and yeah like
most of all it just makes your site for
really fast thanks again for watching
guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>