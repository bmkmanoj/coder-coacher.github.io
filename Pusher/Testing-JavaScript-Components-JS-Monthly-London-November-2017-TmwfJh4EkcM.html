<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Testing JavaScript Components - JS Monthly London - November 2017 | Coder Coacher - Coaching Coders</title><meta content="Testing JavaScript Components - JS Monthly London - November 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Testing JavaScript Components - JS Monthly London - November 2017</b></h2><h5 class="post__date">2018-04-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TmwfJh4EkcM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi guys so I'm going to talk about
testing component applications I'm gonna
go over why to test why tests in the
first place and then talk about
end-to-end tests at a high level some of
the benefits and some of the
disadvantages talk about testing style
because that's fundamentally new aspect
of testing and then talk about snapshot
tests and how you can use them to test
your style and finally talk about unit
tests and how to write unit tests for
components so my name's ed Yarbrough I'm
a software engineer at the BBC I'm on
the view core team and I'm the main
author review test utils which is the
official testing library purview
so before we start need to answer a
question why test to answer that I'd
like to take you back to my first
reaction about a year and a half ago I
was working on this large react
application and we were deploying weekly
part of that deployment process three of
us sat down and manually went through a
set of instructions and user journeys to
make sure that everything was working
correctly this was really time-consuming
right
so there were three developers spending
three to four hours just to check that
everything was working correctly and
quite often bugs would still slip
through anyway the problem was we didn't
have any tests we had to do everything
manually and it was just too big of an
application to make sure that everything
was working correctly by ourselves so
the solution was write tests we need
this write test for our application but
it's difficult to do after the fact
there are a lot of benefits to testing
firstly you can check that your
application works you make changes to
your code and then you run your tests
and you can know for certain that your
application is still working correctly
seconds if something does go wrong and
you've broken a test debugging it's a
lot easier it's quite easy to pick out
what test went wrong where it went wrong
and how to fix it also it provides
documentation so if you're a new
developer to a project and you need to
understand how a component or a unit
works
you can pick up the test file and see
exactly what the developer intended the
component to do and all of this leads to
less bugs a study by Microsoft has found
that anywhere from forty to eighty
percent less bugs result from projects
that have comprehensive test Suites so
testings good right everybody knows this
we knew this at my last place but we
didn't have any tests on the front end
and that was the main problem testing
component based applications is
fundamentally different from testing
server side and it's a mind switch that
we all have to make we need new ideas so
this is the front-end testing pyramid
it's a way that describes how you should
architect your test Suites at the top we
have end-to-end tests then we have
snapshot tests and the bulk of our our
test should be unit tests so end-to-end
tests are probably the easiest test to
understand they basically run through
user journeys they're similar to what me
and my colleagues were doing when we
were running through instructions to
test that everything was working
correctly so you might click on a button
and then make sure that a modal appeared
and that you can sign in correctly on
that modal the benefit of this is that
it's testing your whole application it
tests that all of your units work
together it's the closest thing you can
get to manual testing so you're
basically telling a browser to just to
to do a load of instructions and to make
sure that everything is working
correctly and finally they're easy to
understand so you can share your
end-to-end test with product owners and
your project manager to explain where
you are in the project but there's some
downsides best slow if you've got a
large set of end-to-end tests like we
have at the BBC they could take anywhere
from 20 to 40 minutes to run this leads
to a very slow iteration between your
development and your actual feedback
from the tests also if one does fail
it's difficult to debug it if it's
running on a server in the cloud and you
get a failed test back you're going to
have to
the browser yourself open up the test
and go through the user journey yourself
which takes several minutes and also
they didn't test style so testing style
is a tricky topic it's almost impossible
to test style with unit tests alone
you could have lenient test for every
single class in your component be then
that with like 3,000 unit tests for a
large application the way that you can
test style is by using snapshot tests so
hands up if you've heard of snapshot
test okay most of you right so back in
the old days we used to have snapshot
test where we'd spin up the whole
application take a picture of it and
compare it against the previously saved
picture but recently we've just we can
actually compare strings so we can
render our components into a string save
that as a snapshot and then compare it
each time we run our tests so what this
enables us to do is make sure that the
tests contain the same classes that it
had previously when you're styling a
component there's a manual element to it
you style the component then you check
that everything looks correct what a
snapshot test does is it's almost a
safeguard against anything being deleted
from your component that would change
how its styled so say you finish styling
a component you've added your classes
you forget about it and someone else
comes to the project and accidentally
deletes a class or a piece of markup
that would affect the styling of your
code if you have snapshot tests this
will fail in your when you run your test
suite and tell somebody that they need
to look at the component and check that
is still rendering the style in the
right way so snapshot tests check the
component hasn't changed since the last
time you check it and that's the main
benefit that they give they stop any
accidental style changes and they prompt
developers to make sure that everything
still looks as it should the benefits of
snapshot test is that they're easy to
setup
nowadays with Jess you just call the
function and Jess does all the rest of
the work for you it also covers a lot of
when you have large hundred line
components you don't want to be unit
testing every single line or you're
going to end up with brittle tests that
make development slow when you've got
snapshot tests you can cover a lot of
lines with minimal overhead and finally
the biggest benefit like I said is they
catch style changes the downsides of
snapshot test is that it's easy to add
incorrect snapshots so you need to check
that the original snapshot that you've
added is correct although you might be
testing against a buggy snapshot also if
you add too many snapshots if you have
six or seven snapshots per component
then your test output is going to get
really noisy you might end up with 30 or
40 failed snapshots when you run your
test suite and nobody's going to look
through each of those snapshots to check
that everything is correct so the key to
having a decent snapshot test suite is
certainly having maybe one to three
snapshot test per component to make sure
that you still are prompted to make sure
to look at the component when you make
any changes so finally you come to unit
tests which the meat of any component
based application the benefit of unit
tests is that they're granular they test
the small details of your project they
also run quickly so you can have a suite
to 5,000 unit tests running in 30 or 40
seconds and when they fail they're
really easy to debug this leads to a
quick iterative cycle when you're
developing your code but and the only
downside I can think of of unit tests is
that they don't test the integration of
units but if you supplement your unit
test with end-to-end tests you should
have this covered so how do you write
unit tests for components when you write
unit tests for modules you simply call
the function passing some parameters and
expect the return output we equal a
certain value you trigger an input and
you expect an output but components have
a different input and a different output
to regular functions
the input for components could be user
actions like a click on a button or the
change reform field or props that you
passed down to the component the output
of a component ultimately is the render
function that's the function that
generates the virtual Dom that generates
the actual Dom node that's added to your
application and some component
frameworks like view for example also
output events so you know that you need
to test the trigger and input and expect
an output but how do you know what to
test you don't want to write unit tests
for a hundred lines of markup to decide
what you should test you can use
something called a component contract a
component contract defines the expected
behavior or component and what
assumptions are reasonable to have about
its usage you can think of it as
agreement between your component and the
rest of the application that says if you
put me here and you give me this input
I'll render this output component
contracts help us avoid testing
implementation detail for example a lot
of tests that I see with react or view
applications my assert that a change say
so say we're testing a counter component
they might trigger a click and expect
that the state of the counter component
has changed but this is testing
implementation details you shouldn't
care what the state of a component is
you only care about is ultimate output
the mark-up that it renders when you
think about a component contract you
think that the ultimate agreement
between your component and the rest the
application its output which means that
you won't test any implementation
details because it's not part of the
output what this also means is that you
can use classes in your test so I see a
lot of people concerned with using
classes and they worry that they're
testing the implementation detail some
people even add attributes specifically
to enable them to test their components
without tying themselves to to any
details
but when you're testing the class when
you're testing the render tree you are
testing the output you're not testing
implementation details at all so I
always encourage people to use classes
or markup as selectors inside their unit
test for components finally I say in the
front end
you don't need integration tests
integration tests main benefits is that
they integrate units together but that's
in a world where testing units in
complete isolation in the front end it's
pretty difficult testing as in isolation
you're ultimately always using a Dom
when you render a components output
you're you're using the Dom API a lot of
components use browser AP eyes all the
time so using integration tests is a
pretty fruitless activity a better way
to think about it is to just lump all of
your integration tests in with your unit
tests a lot of people have different
ideas about what a unit test is and what
an integration test is and this can
cause arguments and development teams so
an easier way to go about it is just to
write unit tests that might sometimes be
integration tests but just make sure
they run quickly
so yeah before I finish the talk we just
go over this front-end testing pyramid
again which describes what percentage of
your test Suites should be made up by
certain tests like I said you want your
end-to-end tests as a small percentage
that run against your whole application
and check that everything works together
and then you can use snapshot tests to
make sure that no style changes happen
accidentally and finally you've got your
unit tests that might contain
integration tests the makeup the bulk of
your applications testing a suite so
that was it for my presentation I've
actually written a book about testing of
UJS applications and I write a lot about
these ideas in that so if anybody is
interested it's out now and there's a
link at the bottom I'll share my slides
around after the Meetup cool thanks guys
having me to</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>