<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>An Introduction to Service Workers - JS Monthly London | Coder Coacher - Coaching Coders</title><meta content="An Introduction to Service Workers - JS Monthly London - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>An Introduction to Service Workers - JS Monthly London</b></h2><h5 class="post__date">2016-05-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/EnaKD_EHG14" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good evening my name is Sol Nash and I'm
a developer evangelist
we called Twilio Twilio if you if you
don't know is a is a communications
platform for your applications to
communicate with your users via voice
video or messaging using the tools
languages or frameworks that you already
know I'm not really here to talk about
Thalia there might crop up in some
examples later but what I am here to
talk to you about today is service
workers and I'm going to go with the
quick introduction first service workers
are very muchly script that intercepts
network requests so web developers can
treat the network as an enhancement and
provide offline experiences for users of
web applications all make sense we can
go to the public fantastic just down
there what's actually cool what's the
pub call the grounds having a wonderful
place I used to drink there when I
worked at the previous company excellent
so we have a slightly longer an
introduction to service workers for
those of you who's still here I want to
start with with how can I delighted I
was the first time I saw a service
worker and what it does and kind of how
it works in a no idea why anybody called
it xmlhttprequest given that it's not
necessary about XML I don't have to use
HTTP and never attends a request to you
it's still a pretty cool thing that
we've managed to make quite a lot of out
in the in the like kind of interim 10 or
so years I guess that we had access to
it and we've made some amazing stuff on
the web and I think this next step
change the new thing we have for that is
service workers and I believe it in the
future we will wonder how we coped
without service workers how we ever
bothered making websites without these
things so I want to talk a little bit
about the birth of the Service Worker
we've talked alike at that brief
introduction to start it the service
worker provides an offline experience
for for users but we have this already a
few years back with the application
cache it would look something like this
you start with a cache manifest you have
some comments you talk about caching
certain URLs and you know you loaded
this in me as an attribute in the HTML
element of your site and boom your site
networked offline fantastic everything
was done you you could go home early or
off to the pub early if that was you
preference and everything was fine
except this is I mean this is a really
easy kind of declarative way of saying
this stuff should be available offline
and whenever I want it but it turned out
that when people try to use it for real
applications they found otherwise and it
was it was Jake Archibald of Google who
who was famously declared the
application cache a number of things in
his time but if you search for that
phrase you will get talks articles on a
list apart all sorts of varying reasons
why the application cache did not do the
job it was supposed to do I know I used
the application cache one or two times
perfectly reasonably but then that was a
single page application that didn't need
to go anywhere or do much particularly
difficult so that was that was where it
was difficult for applications to
actually use so in early 2013 February
2013 the spec for the serviceworker was
born in this is with Alex Russell on out
it's Russell's github and contributed
with by axe Russell and Jake Archibald
in order to build up a much better way
of making sites work offline and you can
use it today it then dropped into
browsers just over a year ago in chrome
40 in Opera 27 although I've been
telling people 24 for a while because
can I use tells me that and that's not
true as far as opera tells me so back in
back in January 2015 these two browsers
were released and the serviceworker was
unleashed on people um to the public and
then actually earlier this year January
this year
Firefox essentially caught up with
version 40 drawer and they're pretty
happy about how they they got their
serviceworker support out as well so
what does it really do like we saw that
nice easy application cache which worked
nicely for getting a simple site offline
what does the service what I could do it
so much it is a harder kind of
JavaScript API and here comes a little
bit of code first of all you need to
register a serviceworker this is on your
page and you know you can check for the
existence of the serviceworker object
on the navigator if you know if you're
working with browsers that aren't these
and you register it and you point it
another bit of JavaScript you can give
it a scope a path that the serviceworker
works underneath but the default is is
just to use the route and that's kind of
easy enough for demonstration and then
that returns a promise
promises another are nice things that
come along at the right time such that
you know if things work then we get a
response into then and if things don't
work we have to catch that and do
something about it
in this particular case cry about that
thing yeah and that's kind of all you
need to do on the front end to register
your first serviceworker and then as i
said that serviceworker intercepts
network requests actually them works on
behalf of any any tab any browser tab
that has that site that registered to
open so it works for everyone and you
can listen to events like the fetch
event and that's um so it's basically
like a proxy that you control inside
inside the application it's kind of cool
right although you might get a little
bit worried about that because if
somebody else were to load a jack a
serviceworker script for your page for a
user then suddenly you lose control of
your entire website for that user
terrifying but don't worry because
you're actually not allowed to use
service workers on sites that aren't
secure and so you actually service
workers will not work over anything less
than HTTPS so this is part of a whole
other push to get the web on to more
secure protocols and this is certainly
one of those things you can't use
without HTTPS interestingly enough I
think geolocation just knocked into a
chrome as now is trapped now has to be
done via HTTPS as well as do camera and
microphone from the getusermedia API
none of that can be done on a on a
insecure site anymore you might be
wondering how you test this but don't
worry localhost is also
as a secure domain in this particular
case it's okay to work when you have a
server on your own on your own laptop so
let's I can't want to show you how this
works and this is where we see whether
this microphone stand works maybe as
well I was fiddling about with it before
it doesn't quite fit the microphone but
I try good
let's go have a look I have less weird
this is a website it's it works I'm
actually going to be triggering offline
here because by canceling the the server
if I go back it's dead that's a shame so
let's fix that we'll bring it back to
life first and then let's write the code
for it you can read this at all this is
the bottom of that page it is the simple
kind of cover template for bootstrap I
thought it looked nice enough when we
were loops there yeah I feel it look
nice enough so I'm just going to got a
script down here which I'm going to
start work with and this is where I'm
going to use that now that Service
Worker and this is the kind of stuff we
saw just just in this lines there and
that's kind of what we need to do
although I can let's get the call back
just to make sure it did work
great that's that's how we're at our
center go easy this is the serviceworker
file that I've got and first of all I'm
actually going to listen to a different
event there's a few events but in the
life cycle of a serviceworker and the
first one is the install event which
gets called funnily enough when that
serviceworker gets installed and this is
the point where we can kind of do some
pre caching and some work to set this
site to work offline so I'm going to use
event wait until and this is a new thing
for events basically the serviceworker
itself can kind of get killed by the
browser at any time because it's runs in
the background of the tab but wait until
in the context of an event will keep the
serviceworker alive until the work
that's done in that wait until is
complete and so in here you pass either
you pass a promise and so what's that
promise resolves the event starts
waiting and the serviceworker can be
killed again and in this case we're
actually going to open up a cache and
caches is just a any PID you get from
within the serviceworker we're going to
open this one which i'm going to call is
monthly you can call that whatever you
like and it's quite useful to be able to
rotate through caches because these also
return promises so we can use that again
and we'll get the cash in that resolved
promise and then using that cache we can
add all our all our pages all our things
that we want to store offline so in
there I'm going to put in XHTML that's
just the home page there's maybe not
exactly how you do it but this is just
an example so we're going to happy index
and the CSS and that's all we should
need that's saved them and then we can
listen to that
fetch request a fetch event sorry and in
this case we actually want to do
something about it we can we're just
going to take this just wholly offline
right now so in this case we're going to
invent respond with because what we're
going to do is you cashy
the service workers come with a request
and a response api more kind of lower
down primitives that talk about actual
request response and you can you can
create a response out of nothing if you
want to but it happens that we put our
responses in that cache right now so
again event respond with either takes a
promise or a response object and
hopefully that promise resolves to the
response object and what we're going to
do is open up that cash again go chase
monthly and then you'll have to shout
out and make typos and when we got that
cash we are going to just return cash
match event request and that's pretty
much it so what we should be able to do
now is refresh this page and if we just
take a look at the console we have a yay
there so the serviceworker did install
correctly and then I'll get rid of that
I should just be able to kill the server
refresh the page and find out that it
still works so that is me refreshing the
page over and over and that is now
offline and that's the kind of simplest
application of a serviceworker it's
pretty cool like all within kind of 18
lines on the serviceworker side and
that's me
kind of making apparently kind of a
pyramid of hell that everybody hates
anyway but it doesn't matter that's
quite simple and and we can build pretty
much we can build an awful lot of this
on top of there so let's head back over
here that's
cool so why would you want to use a
service worker why would you undergo
offline and this for a lot of people I
think and I think definitely for the
browser vendors who have done a lot of
fighting for the web in recent years is
very much the argument of web versus
native and this is particular on mobile
because everybody wants a mobile app
these days nobody wants to use a mobile
website it's a real shame because we
have the ability to make excellent
experiences on the mobile web in fact we
have a whole bunch of interesting things
like we're online by default which means
you can get that vacation whenever you
need on the web you just you are L it's
fine and but native apps have that kind
of offline by default like they exist
because they get downloaded and you know
from the start you can open a native app
and it should work of course some things
you have to actually break that and
choose that they require a network
connection or to get things done and
that's always disappointing but they you
know have that ability to be offline by
default the web has web apps have that
discoverability that you know you Google
for something you search for something
you you just type in a URL and you have
the application that you wanted whereas
native apps always have to go through
that App Store installation and that
first usage is you know it's kind of a
difficult one really especially if
you've come from an app that you've made
me logged into because wouldn't you love
once you download the app you have to
real aughh into everything remember that
password probably forgotten it's
probably really long one have to go
through your email I don't know that
first kind of native version is pretty
bad and why do we why we have service
workers is very much down to the fact
that you know this online by default
thing needs to go away we need to be
able to change that to able to be able
to build websites that are flying first
the application cache promises but it
was wrong it couldn't do it the
serviceworker promises this and allows
us to do that and we can build
applications offline first that will
work using the network as an air
and for users so they get the benefit of
both you know an application that works
straightaway when you hear URL and then
works again you know if you're on the
tube if you're on a plane if you are you
know somewhere without data or with
spotty data with terrible data Jake
Archibald when he talks about this likes
to talk about life I which is the idea
that you're connected to some sort of
Wi-Fi and that looks like it's a
connection but the browser and you can't
tell what's on the other end of that in
fact I did see a talk in which he proved
that you know your your Rooter could be
plugged into a plant the the applicant
the website the browser the application
they all think you're online but at the
end of that cable there's a plant and
that's just it's not going to work so
this is what we need it for and even if
you don't care for offline and there's a
lot of other benefits available front
service worker performance is one of
them like we are actually in control of
the cache we are not fighting the
browser for whatever kind of caching
it's doing I'm fighting all other sites
on the internet for the browser's cache
we have control of this cache and and we
can keep things in it and get hold of
stuff I have a question go for it assets
you can actually go and inspect the
things that are in the serviceworker
cache via dev tools and I won't show
that right now because I'm actually like
that used to Chrome's dev tools but
they're in there and you can find them
under under the service work and workers
I'm not entirely sure exactly how it
keeps under the hood but you can go and
inspect them so it's it's possible to
get back at them but then of course
they're only ever the files that you
know you as a user has seen anyway and
of course that is sandboxed for any
other applications like there is no
access to this to that sandbox for any
other web applications anything outside
of the scope that you gave that that
serviceworker in the first place
can the browser remove it the idea in
this case is very much that you have the
control over it yes and it's not going
to just remove it at will I believe
there is something about the browser
itself will give up kind of 20% of
available disk space to caches like this
and there is a potential that you can
come and hit the actual limit of that at
some point but you will start to get
errors in the serviceworker when it's
trying to save stuff to the cache and at
that point you know this should very
much be an enhancement on an existing
application anyway because it's not
going to work in two browsers so if you
if you know you should be able to work
without the existence of this cache it
just responds with it in case and so you
can build stuff into yeah into this kind
of you can build stuff into this
response such that you know if you don't
match something in the cache and I knew
everything was going to match in this
particular case if you don't match
something you can go make a fetch
request that returns a response object
and you can return that so the fact that
the serviceworker then just acts as a
middleman back out to the actual network
and everything's going to be fine you
can also you know you can then use that
cache stuff that you've fetched for the
first time and and get back to it again
and that increases performance all round
the serviceworker will have access to
the indexdb that the site does and so
you can put stuff in from the page and
take it read it out in the serviceworker
or the other way around
the early versions of serviceworker did
not have a fully-formed
caches api however the polyfill then
used index TV to fill that in and yes so
that the things would actually hashed
into index TV but the serviceworker
cache itself these days is not index TV
but as I think they have access to each
side of it and index TV becomes very
useful if you're doing more and more
complicated
stuff with us you can cash all all
requests yes it's any request made by
your site and that includes external
requests can be cashed and can be looked
after there's some slightly difficult
things with kind of fetch API and cause
across origin stuff and if you're not
doing across Odin thing then you kind of
if you don't get a successful response
if you don't get 200 or 201 then you
just get a response as a zero and
doesn't give you any more information
about what happened to it I mean kind of
at that point you drop in go to the
network and hope things work out but you
can ya intercept all Network requests
made by your site so you can communicate
between the service worker and the site
using post messages the same as you
communicate with any other kind of web
worker and then and similarly the there
is also a life cycle event that is in
the service worker called activate which
is very good for me managing your cash
and taking things out of it that you've
deemed to be over with if you've
deployed the site and other stuff like
that but yeah you can either communicate
directly with it or as part of a new
Service Worker update flow cool I will
carry on because there's a bit more to
the story
fall backs full backs are pretty useful
on top of performance because you know
if you're not going to go offline the
whole way than just waiting some having
somebody sit and wait and watch a blank
white screen whilst you're thing loads
is awful as well so eventually the
Guardian tried this and I got a good
blog post about it on their dev blog
that if you try and hit the Guardian I
think they're just testing out the dev
blog but then it works across the rest
of the site if you if you load it up
that way but if you can't connect if
you're not online and reading the
Guardian they will offer your crossword
to do which is kind of nice
whilst you wait to get access back again
but there's more more than just this
kind of caching and offline stuff the
serviceworker also gives you access to
push notifications something that we've
never had on the web up until now and
something that native applications are
definitely held over the top of this and
I have a quick demo of that once
and so I actually have I've been
building this myself that isn't as a
offline sigh apparently this is my this
is my kind of inbox bike that I work for
Tulio and this is based on a Twilio
number just sucks down all the SMS
messages sent to that Tulio number and
from my number in this case and so what
I can do is send it a message and I send
that message then you should see a
notification appear that's really good I
got another notification we'll see that
one later I've got that but what's kind
of cool is I'm going to close that I've
got some other examples here but none of
them I don't have any other chrome tabs
open
I can send another message I'm no longer
on the website but I will still receive
the push notification which is kind of
cool we were able to do those
notifications when you're on the site
before but now we can do this kind of
ability to to do it when you're off the
site and that works particularly well on
mobile on Android and on chrome on
Android in which you can close the
browser entirely down close all
applications and a push notification
will wake up the serviceworker send a
notification to you and wake up the
browser when you when you hit it so
that's kind of cool and then we also
have also that actually that didn't come
in quite as quickly as service workers
did so it arrived in chrome 42 which was
two versions later and they're still
kind of working on it as it goes through
updates to how you can send data along
with those messages Chrome Firefox
releases in version 44 I do have to warn
people at this point when we talk about
push notifications that we've great
power comes great responsibility and we
shouldn't just be spamming our users
with with horrific kind of notifications
about everything that they don't care
about users need to be personable
actionable and you know useful to a user
or they will turn them off and you will
never see that user ever again another
kind of cool thing though is background
sync and this just arrived in chrome 49
and I have a quick demo of that as well
and this is a this is Jake Archibald
offline Wikipedia kind of example and
and if we go and hit multinational I
just I went downloaded and we can hit
corporation and it kind of you know it
loads of thing the background and then
and does that but what I'm going to do
is just turn off my internet which in
this case is taking on my phone I'm not
on the Wi-Fi is you can kind of seen
that's just turned off so if I hit
legally a person it's going to say okay
I'm offline but you know I know you
wanted map so let's load in the
background cool I got a notification
when it's ready I already accepted
notifications from this site so that's
another good use of notifications
something I want to hear about and so if
I plug that back in I should get back
online and the browser will then go all
right that's cool you know it's
registered to sync and there we go we
get that we get the notification and we
have the article and it's going to be
there straight away as well like instant
load pretty much so that I think is an
amazing amazing use and very new use of
service workers and like I said I think
that's India chrome 49 very new but very
exciting and something like I intend to
add to that SMS based application such
that if you send a message and you're
offline it's going to store that and
wait to send it when it comes back
online and then people always talked
about geofencing when they talked about
service workers in the first place
but I just I've only heard and in fact
the talk has kind of died down it's just
the Amigo oh maybe some time so possibly
not Inter's geofencing but it'll be kind
of cool to wake the service work or up
when you stumble into a into a
particular so radius of latitude
neurology maybe then finally this'll
brings us on to a kind of an exciting
thing that's being talked about a fair
amount this year which is progressive
web apps and progressive web apps are
pretty much the addition of
serviceworker and thus kind of being on
a secure origin manifest file for our
websites which allows you to kind of
talk about what the apps call set up
some
icons and splash screens and things like
that for it and such that with some user
engagement you get a downloadable web
app something that looks very much like
an app from the App Store and when I
talk about user engagement here I'm so I
mean it's not going to start asking to
be downloaded as an app the first time
somebody ever visits it but if if the
browser deems that the person is
interested in it and is coming back to
the to this application then it starts
offering itself as a download and so you
get app install banners and they look
pretty cool like this is an example I
stole off of addy osmani site like if
you've come to the site a few times
and that kind of criteria is changing
amongst Chrome in the moment as they try
and Whittle it down to something that
makes sense eventually you will get this
banner at the bottom saying hey you know
this this can be used as an as an
application you know do you want to add
it to your home screen it is a is an
improvement on the original add to home
screen from Apple and then the Wayne's
that chrome on Android went throughout
the home screen because it's more
discoverable it's more obvious for users
and so then you get a icon on the home
screen you get that same real estate
that any real application users and then
I guess after a while profit that I mean
that's why the marketing teams want you
to build apps write profits we can get
that just with our website it's fine but
that ability to like work offline have
all those kind of icons and things set
up and a short name set up means that
the chrome certainly the moment is will
trust your application to be you know
good enough to live there on the home
screen next to native applications and
so that I think kind of exciting and so
that service workers in general if
you're not convinced by all of that
right now and I forgot to plug the audio
in earlier if you're not convinced by
that how much of this works they are a
progressive enhancement they are
something you can add to a site's
something you can you know improve sites
in more than 50% of like used browsers
right now so chrome opera and Firefox
and I'm there
they're cool but and you know in the
future I think we will wonder how we
cope without service workers and
secondly in the future we also wonder
how we cooked without full-on videos for
browser features because I kind of want
to show you this one please audio work
for too long users have been left
staring at a white screen for too long
they've been let down by the cruel seas
of network connectivity and for too long
we've been powerless to help
we've been left
waiting
but no longer a new browser feature has
arrived
a total game changer
a feature that lets you control the
network
rather than letting the network control
you
who is this new feature
and what promises does it bring
introducing
the serviceworker
I mean if xmlhttprequest with her bat
that's an amazing thing that's actually
pretty much an advert for the Udacity
course on on offline web applications
which I I advise you take a look at if
you're interested in doing this and
having a look at anymore of it it is a
is an amazing video and yes all new
browser features are going to have to
come up with better than that in order
to win now I think that's me I'm excited
about the the application serviceworker
I just want to finish with one tiny
little plug if you don't mind in that
next month in fact just about a month
away it's quite amazing Twilio are
holding a conference out in San
Francisco called signal where we are
talking about all sorts of
communications and the future of
development and communications as well
as security and other stuff like that
I'd love if you have a look at it and
it's a toilet accomplished signal and if
you want to come along please use the
code peanuts twenty four twenty percent
off tickets one other thing this is the
first time I've given this talk and I
really would like to know if it helped
at all and so it'd be awesome if you
could send me a message which just
answered on a scale of zero to ten how
likely is that you'd recommend this talk
to a friend or colleague if you can send
a text message to that number that'd be
really amazing and that would really
help me out the numbers on next slide as
well so that's me for right now thank
you very much for listening to me this
evening yeah thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>