<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Dot Net Sheff, Headers and Cookies, February 2018 | Coder Coacher - Coaching Coders</title><meta content="Dot Net Sheff, Headers and Cookies, February 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Dot Net Sheff, Headers and Cookies, February 2018</b></h2><h5 class="post__date">2018-02-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2nvBGoyF7nQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello uh sir I start off talk on
security headers and cookies so I'm not
a.net developer I I've done a little bit
of Windows development but not much so
what I'm gonna be going over is concepts
stuff about the headers stuff about the
cookies what you need to set why you
should be setting it what I can't tell
you is how to do it I can give you hints
if you stop with something come and talk
to me
and I can probably put you in touch of
people who can help it but I can't give
you any specifics on this is how you set
it in your particular language
environment or whatever and just say I
bought this clicker seven years ago and
this is the second time I've remembered
to bring it to an event so and it's
working I'm impressed
all right so my name is Robin woods I
will recite did you got ninja and I'm a
fairly active on Twitter as did you
ninja so okay if you've got any
questions or whatever feel free to ask
get in touch I started my career as a
desktop kind of developer building to
Java wraps that kind of thing I've been
moved over to doing web stuff but it was
a mix of original VB ASP and then PHP so
I left the Microsoft environment before
the the.net stuff kicked in moved into
security testing in about 2009 the the
company I was working for the when their
websites got hacked I mean the boss
spent quite a long time sitting through
going through the whole app line-by-line
when was it that was it that was it that
really enjoyed it and slowly
transitioned across I'm freelance tester
I've tested everything from small local
companies up to multinationals I've done
a couple of jobs in actually in the Bank
of England testing their systems various
other banks all different color sectors
and things predominantly doing web app
testing but also bits of infrastructure
and all the things on side I've also
published a roundabout 50 maybe growing
up no excuse
tools and regularly blogging so that's
kind of my background on where I get
sort of the how I can talk about this
kind of stuff so we're going to start
with HTTP headers ICU everybody's aware
of what HTTP headers are coming back
from web servers there's an example come
back from my server for my site so I'm
not really PowerShell person but I like
this little command for this so you got
a full bunch of headers there security
strict security cache controls and
that's just an example of one set from
my site my mom's going to look at
tonight ooh the key security ones so
it's these eight that we're going to
look at and we're going to cover them in
that order starting with the the longest
name one the X content type options this
was brought in in a boat I think it was
ie 8 and when the brazos I ate it would
you sent down a file or webpage bros
would have a look at it and say oK
you've said as web server that this is a
content type text I'm looking well
actually I think it's a PDF or I think
it's executable so I'm going to serve it
to the user as a PDF or an executable
awesome like that which caused all sorts
of problems because if you had a site
where you could upload arbitrary content
and then have users download it but when
it was downloaded it was always forced
to be let's say an image or a text file
because the the browser would ignore
what it's forcing it to be you could
throw malicious content at a user
without them noticing it and without the
actual site being complicit so the site
says upload me an image you upload a PDF
it doesn't do its check-in properly when
it comes down the site says here this is
an image Bros looks in goes well that
looks more like a PDF or an executable
I'm gonna treat doesn't execute well and
run it and you get a lot of people were
getting so loaned and hacked and still
through or get malware delivered
through this mechanism whether Bros was
making it solar decisions and say no no
webserver you don't really know what he
talking about
so the this header was invented expect
content type options only got one option
or one parameter you can set on it's
called no sniff and that basically tells
the browser no shut up I know what I'm
talking about this is a image this is a
PDF don't try and be smart
don't look at my types just do what I'm
telling you to do with it so nice easy
one set shouldn't affect any of your
systems as long as you serve in the
correct content types when you push them
down and so all the sly only the things
I want to give a recommended option so
on this one it's set it set it to no
sniff forget about tea shouldn't affect
anything and that's just how it would
look if it came down to the header next
one x-frame options this specifies how
what is allowed to frame a website so it
can say yes it can be framed no it can't
frame this how it can frame it have
people heard of an attack called
clickjacking put your hand up if you've
heard of its some of you right I've got
a demo of it that I will run through
just because people haven't heard of it
it's a nice one and it it kind of it all
should hopefully give you an idea of how
it works and why why this head is a good
one so hopefully I'm online right
this is where I've got to cream on it
round see what I'm doing but I built
this a little thick jackin demo it's a
social media system where if you want to
close your account fairly simple do you
want slowed your account it's just yes I
want to close the account click it to
confirm you're gone
so it's two-step process close your
account fairly easy so with clickjacking
so i lure you to this page it's on my
site it's either win this prize look at
these pictures of kittens do something
that needs you to interact fairly simple
click the numbers in order so we'll
click 1 what click - or click 909 well
done you've won the prize all looks
fairly innocent if I change the up let's
just refresh this I've run it again
changing RAM and pasty so what this is
done this is the concept clickjacking
you have the site that you want to click
Jack goes on top you put it in an iframe
and then you set its transparency to
zero to zero so you can't see it
underneath you put your pretty stuff so
in this example on top this bit up here
this box is the iframe containing the
closed the account options underneath
that you've got the the game click to
win so what happens as a victim I come
to the site just turn that down a little
bit
click the numbers in order to do a prize
so I click one what do i click next so
as you can see slightly in the
background your accounts open closed
I click no no nine I get well done
now what you would normally do as part
of an attack is you would get rid of the
iframe you would clean it up you would
do some nice of tear dough so the users
never aware of what's actually happened
on this site but in the background
you've just float there just close their
account so this was originally used by
people to do kind of bank transfers when
it was a fairly simple system when they
didn't have all the to factor or reenter
your password here to do this where you
could simply go type in the money here
click this button and go and people were
using this system to basically steal
money out of accounts stick a nice frame
up on the top next written behind put
the bank on the top of it click a few
buttons by and you've got the money so
this is clickjacking and the reason it
works is because they frame the site
itself this one has is allowed to be
framed there is nothing to stop this
going in a frame so this is where the X
frame options comes in you can use this
to say the page is allowed to be framed
from particular sites so if you know
that your content is always going to be
framed by this one or the system great
you could say it could be framed by site
ABC you could say same-origin so you're
allowed to frame your own content but
nobody else can frame it or usually
you'd set deny very few sites no use I
framing for the majority desktop so you
would set extra options the bottom
option there deny I said same origin or
whatever you want deny say to see the
recommended one I just comment on this
first few options that are going through
the the options here are on a per page
basis so if I feed extreme options deny
down on login dot aspx and then I don't
feed it down on menu dot aspx aspx can
quite happily
around same with the no sniff if you put
it on the login page content can't won't
be sniffed if you don't put it on the
menu page content will be sniffed so
these are per page options normally what
you do is obviously you just set it in
the web server headers and that's it you
can forget about it but it's just
something to watch out for you can't
just simply set it on one stick one
particular page and then assume it will
be yeah they were pushed out to every
page in the system so the next one xox
XSS protection the the X prefix the X -
was set up when they had the initial set
of headers that would find and they were
fake so fix in the RFC's but years ago
people started having these extra
headers so access protections and frame
options and stuff they weren't official
RFC headers so they start to get the
stud the policy of putting the X - on
staff it so if you see anything sex - it
isn't an official it wasn't an official
at a time header it was something that
somebody had made up or group and made
up and then it started to get adopted
some got dropped some got kept but it's
not part of the original RFC's some of
them I have know been made into RFC's
and they are official and whatever but
just that does the history of the X -
and main thing about this one the XS
protection it's to enable or disable if
you wanted to
built-in cross-site scripting
protections in your browser at the
moment this only affects chrome and ie
stroke edge Mozilla Firefox doesn't have
any built in across that scripting
protections I keep hearing that they
might be getting it and at one point so
he said oh yeah it's fixed it's set for
a certain release then all that seemed
to disappear I talking across that
script into people understand cross-site
scripting yeah sure hands if you do do
we need a demo for that or not
yeah I'll give a quick demo of it since
I've got it here where's my browser gone
where's my cursor so if you ever want to
play about with web app vulnerabilities
really good product form to a better
word dvwa dumb vulnerable web app
originally written by mater mine Ryan
Dewhurst for it was part of his
university project
now there's two Orioles maintain it and
we add extra stuff every now and then
let's log in and have a look and
basically it's got a whole ton of
different we're web app vulnerabilities
so so you've got a fairly common sequel
injection and blind sequel injection
cross-site scripting I've recently added
JavaScript so that's attacking the
client side and server side password
brute forcing cross-site request forgery
all sorts of different different
vulnerabilities in there there's also
four different vulnerability levels low
medium hard and impossible theoretically
impossible should have all the text
inflation builds by plus 8 and low
should be the easiest but it does vary
and it's comical how often we get bug
reports going I just found a
vulnerability in it the help page is
vulnerable to file injection or file
inclusion yeah it's a vulnerable app but
but it's there no it's a vulnerable
application it's supposed to be so as
well as the publish ones and the list
there are also whole lot of other ones
Easter eggs are supposed to find but
yeah it's worth having to play with if
if you want to go with we're different
attacks right Oh Khaleesi cross-site
scripting reflected so a very basic
example actually no the first thing I
need to do that's set to low if you ever
come into this the default security
level is impossible not only attacks
will work you've gotta remember to
change this otherwise just sit there
banging your head against it quick I'm
trying this thing I've copied everything
it's exactly right why isn't it working
because you forgot to change that from
impossible I've done that many times so
basic idea of cross-site scripting is
what's your name Robin hello Robin yeah
it works basically it reflects back what
you put in what if I put in that it's a
bit hard to see but that's no in bold
what's another tag you is you underlined
yeah I can't spell my own name there we
go so it's not encoding the any HTML
characters so the attack from this is
Robin and then let's put some JavaScript
in so script and as its echoed back the
script tags been written into the page
alert box come up
most people demo XSS with fairly simple
alert box people said look like oh wow
you managed to pop up an alert box on
machine oh wow so what proper proof of
concepts for this one I really like
doing is rewriting the page to look like
your login form but to send the contents
off to to my server so it's very easy
once you've got script in there you can
do whatever you want
you've got full access to the Dom so it
would be I never am Allah stuff off the
top of my head
what about rights no but basically you
would do that kind of thing start
rewrite to the page you can drop
keyloggers on you can steal content you
can port scan internal networks if you
want to get into this stuff look a thing
called beef browser Exploitation
framework amazing what that will do with
cross-site scripting anyway but that's
cross-site scripting and that's that's
what the header that's what the excess
has protection header will protect you
against it basically it will force the
browser to enable the protections even
though they are all enabled by default
in in most browsers I've seen well
Firefox and sorry chrome and ie they are
disabled by default but this will force
it in case for some reason the next
release Microsoft go actually we're
going to disable it by default setting
this it's Belt embraces it makes sure
it's definitely set on options for this
one you've got zero to disable it I've
never seen this used but if you ever do
need to disable this for some reason
pass it zero one turns it on and
sanitizes the output so it will still
get written in but the browser will
attempt to tidy it up for you the common
one bottom 1 1 mode block will turn it
on and it will block any malicious
content it will say I've seen JavaScript
coming through that so it's coming from
a user I'm not going to let it run and
if you're looking a developer console
you'll see a line that says block
content so that's the most common one
the reporting URI report one there I'll
come on to what report URI is later but
it basically lets you send out reports
to say off bless the browser select
reports today hey I think I've been
attacked and that's a nice one if you've
got if you've got time to monitor it and
you've got somebody who will actually
look at the logs and you've got a site
that's not going to just fill your logs
because people are attacking it all the
time
there you go a couple of examples of
setting that referral policy they said
it's the newest header on the block it
was introduced I want to say back end of
last year kind of time it basically
specifies when browser can pass the
referrer with a single our header so for
those who don't know the way it works if
you browse to my site or postal page of
my site you click a link when you
browser sends the request to the next
site it will also send in that request a
referral header that says this request
came from and it will give my site and
its really good for tracking where your
people came from so you can look at the
photos and say ok onto my homepage I got
three clicks from the BBC website I've
got four clicks on my TV and I've got a
couple of clicks from Donetsk afield and
you can see where things come in the
problem comes if you've got a site
that's particularly heavy in query
string parameters that leaking ports
information so you should never have
things like session IDs on query strings
but people do I've tested for a bank
that query string
it's got session ID in it and if I can
get a copy of that that's a cell but for
access to your account developers are
going know no you'll never do that
you'll never be able to steal it
well what about proxy logs all these
logs will read that oh no no you've been
fine but that HTTP referer your on bank
site you click a link that goes off the
bank site onto another site to refer a
header I've got that full query string
in it so it's got the session ID if soon
as malicious on the external site they
pull out of their logs buying they've
got flex to your account
so this was realized and the referrer
head it was refer a policy headed was
created you know it's it's not got the X
in front of it it is the official one
that's created by w3c and Mozilla and do
you have a Google crew so yeah it
specifies where you could pass things
over so
I will try and remember these you've
basically got no referrer refer ahead
and never gets past nor the photo when
downgrade so if you're an HTTP site and
you're passing across to http one a
referral what past but if it's HTTP to
HTTPS then refer little bit past HTTP to
HTTPS
so it's basically on ask you to
downgrade origin is it will pass just
the domain part of it so this is where
if you've got vulnerable things in your
query strings origin is a good option
because it will only pass domain website
comm or whatever it won't pass i.com
slash really vulnerable page question
mark ID equals all your bad stuff so
origins are useful one or useful part of
it origin when cross our origin when
cross origin is if it's going from one
domain to another the it will pass the
origin but internally on your own site
it will pass everything so if you rely
on the query string of the refer for
some reason then then use that one and
when it goes outside then it's safe you
just get the domain a little story on
that I did test a system once where you
enter login page you logged in and it
did a full marking process it properly
checked you use known password it then
redirected you to the menu page the menu
page checked the referer header has said
did did I get referred from the login
page if I did then fine you can access
it otherwise no get matched login page
it didn't check the session it didn't
check whether you'd actually logged in
or not all it checked was did you get
here from the login page now obviously
it's very easy to spoof headers it's
very easy to put your own in islands all
I did yeah ok throw an extra referer
header request the menu page um yeah
that settles into the system so never
rely on these headers they can always be
spoofed useful for internal track and
useful stuff like that but please
certainly don't make security based on
it but
just don't rely on it always assume it's
tainted malicious the user can modify it
same origin is it will pass if it will
pass in the same origin bridge another
weather stations to be on HTTP so if you
refer from HTTP site calm down to HP
it's like the comet will pass strict
origin will be only if you're on HTTP
calm its to be s site calm
it will stay within that but it won't if
you don't grade strict origin when cross
origin are going to read this once I can
never and what it is this is the
recommended one it's basically an
amalgamation of everything making it
more secure it is if you go outside your
domain then it will only pass the domain
part of it and only if you're not
downgrading security so as long as you
stay in HTTPS you're fine long still
HTTP fine if you don't grow in HTTP HTTP
it won't pass it it won't pass any query
strings it basically it does everything
that you'd kind of want if you've
thought about all the rest of them so
that's the the recommending world final
one one sec URL I don't care
everybody can have my referrer just take
it don't care so a couple examples and
just be careful with that it can break
certain logging apps things like Google
Analytics but not Google a list because
they do it much better but some of the
cheaper end tracking systems will rely
on referrals to work out where things
are going around the system and
obviously if you're on referral programs
that rely on the referer header again
incorporate those so most apps don't
worry about it you can set it some some
apps you will know if you if you're
using referrers for anything specific if
you are then just think about what
you're passing and when you can pass it
when you need to pass it
right up till this point I say
everything has been per page this is the
first one that is for the site strict
strict Transport Security also known as
HSTs HTTP strict Transport Security what
this one does is it enforces HTTPS on
all your traffic a couple of different
options for it when you set it you can
persÃ©phone maximum age so you can say
for the next day for the next week
recommended options for the next year
and force all my traffic's come over
HTTP obviously a good thing because
we're wanting to encrypt traffic now
Google is giving better page rankings
for encrypt traffic power it well I
would say paranoid people a lot of
people are worried about security and
about their stuff going clear text over
the other networks this just basically
enforces everything on this website will
be encrypted and yeah it sets it middle
option you can specify maximum age and
you could include subdomains so this
will enforce it for site calm and test
site calm and whatever it's just a way
that you know your entire system all
your domains or your subdomains will be
covered if you set that again what chote
if you're setting up this important
watch out if you set to this make sure
you know what your environments like
make sure you haven't got a little part
of your site that relies on being HTTP
make sure you haven't got subdomains
rely on HTTP I've seen this with
marketing of spun up there little click
here to win a prize site but they've
just thrown up on a subdomain that
somehow they managed to sneak through IT
without you noticing and that's really
completely over HTTP security team have
set they set includes subdomains
obviously little marking site disappears
because the browser says you've got
Axial Age TPS
go to it over HTTP no it's not there I'm
gonna stick out you're not turning it on
for its GPS it's dead so really good
setting but you've got to be sure what
you're doing for it and I said this once
you've set this header that is it for
the browser it's not a per pacing it's
for the site or for all the subdomains
from the site as well so make sure you
know what you're doing with it and I'll
mention the preload option in a minute
so top ones an example of setting it
that's you set it for a year and all the
includes it through subdomains if you
want to turn this off you can do that's
the bottom option you set it to zero
that must be served over an HTTP
connection so if you realize you've
messed it up for some reason you can't
serve HT guess setting that won't really
help you because you can't serve HTTPS
to serve the thing to say I'm no longer
serving over HTTPS so yes you can use
this maybe if you if for some reason you
are downgrading your system you can use
this to to set it and to kill me HTTPS
but I get I've never seen that used this
is the still of vulnerability with this
and the problem comes on that first
click so most people if you sell them to
go to site com they won't type HTTP
colon slash slash site comm they'll type
site comm which for cert for now for the
foreseeable future
will default to HTTP so on that very
first browse before the headers have
been sent that first browse that first
connection will go over HTTP if an
attacker can get in the middle for that
first connection because strip that HT
HSTs header then they could stop you
ever seeing it if you know if your
browser never sees it your browser's
never forced to go over HTTP and at that
point you've got man in the middle
you've got all sorts of different
downgrade type attacks so that first one
click first browse it's always
potentially vulnerable to this 99.99% of
time it doesn't matter
you'll be doing at home
nobody's going to be intercepting a
traffic you've got it logged into your
browser then after that first one that's
that you secure wherever you go you
can't downgrade it I see the other thing
with this is if you browse to a site
that's got this and it has been
downgraded for some reason like some of
these man in the middling eats or
suddenly fiddles with the certificates
certainly chrome will pull up a warning
but can't live I passed
what can't easily be bypassed that will
say HSTs enabled tough look you're not
going to HTTP version site we are
stopping you so it it is within volleys
stiffness it's tough you can still got
the option to click through say no I
know what I'm doing advanced yes
accepted it just yes once that's all you
can't click through it and accept it so
to get around this first click thing
there's a system called pre loading what
that is is you go to this preload site
and you say I always want my site to
HTTPS I know what I'm doing I've set it
up properly and and that's it I want to
be and what will happen is the browser's
will bake into them that setting to say
this site is only HTTPS they're not even
on your first click it's built in it's
it's hard-coded you the browser will
take over and say ah you didn't type
HTTPS but that's where you're going to
sort of force HTTPS on even on your
first access only really a pic
applicable to hardcore sites that need
security so things like banks or
anywhere else that you really want to
force use into it if you get this wrong
that browser is know is forcing everyone
on switch to this there is no way to
undo it even if you set the zero it's
still baked into the browser it you can
have you tied in you then have to wait
to the next version of the browser to
come out let's remove your entry so
again HSTs only sex if you know what
you're doing only preload if you really
know what you're doing and really need
it I'm just going back a couple of
slides or was it gone that's what the
preload options for so you would set a
header
you say you're max age at I think it's
got to be a minimum of 12 months and you
would specify the preload flag and
you've got to press specify the preload
flag because that stops me going on and
telling telling chrome to preload your
website otherwise I just go on and say
yeah all these sites they look like
stick them into Google for pre loading
into Chrome for pre loading and then
they're there about it so you've got set
I think it's at least a minimum age of
twelve twelve months and you've got a
preload flag for it to work to be
accepted and once you're submitted
there's my cursor gonna work nope
once you've submitted through their
Chrome picks it up off the HSTs lists
and as they've baked sit-in if I can and
this is what it looks like so it's a
bunch of Google domains obviously
because this is Chrome's source so group
Google pins all it's actually Poland
there and various others and then we get
down to what users are submitted so a
Palo Alto calm whoever they are
they wanted to be pre-loaded IRC cloud
neo nice tea calm and these are all
people have just gone in and said yeah I
want to be pre-loaded and this is this
is hard-coded into the chrome source you
know these the ones with the include
subdomains as well and might be
interesting to go through a few of those
and just have a look why why they are
sort of paranoid about security they
need to be pre-loaded but Google build
this list Mozilla for Firefox then
scrape this list and use it in Firefox
so it should always be Firefox and
Chrome or in sync I left no idea what IE
do but but that's Chrome and Firefox it
just yes preload dog is where you go in
to just say you want to preload it right
content security policy this is the
hardest one to implement getting this
wrong completely kill your site's
getting right I think can make a site
and a system a lot easier to look after
a lot easier to maintain the idea is it
what resources could be pulled in for
where and how they can be used so it can
specify things like you can bring this
script in locally your non load any
inline CSS you can pull images from this
site you can be framed it does replace
to some degree the extreme options by
saying what can frame this site it also
says what sites this site can frame so
there's a lot of settings in it it's got
two modes enabled and report only
mentioned reports only again in a minute
top example there default source HTTP so
what that says is you can pull in any
Content you wanted to decide as long as
it's all rich to guess so
no non-secure traffic you could say I
don't care which yet with its HTTPS or
HTTP as long as it comes from sicom you
could say it's gonna come from HTTPS
sicom so you can sort of get granular
like that on it but it's not just that
simple you can start saying well I've
got no default policy so buddy folds
everything's blocked oh yeah but that's
one things list everything is blocked by
default unless you actually enable it so
everything's blocked by default you can
pull scripts from site comm so so HTTP
sicom so you can't pull me from your nod
secure version you can pull stylesheets
from your HTTPS site and from your
images site so you start building up
lists of west of can come from where it
can't come from and what this does is it
stops people injecting malicious content
into your site one of the big things it
stops is cross-site scripting because
most cross-site scripting is it will
drop the content into the page so
reflects you want I showed you before it
wrote in hello your name is and then my
and racket script tag whatever that was
written into the page by context kids
policy you could say you're not allowed
inline CSS inline scripting so that will
kill it completely simpler if you're not
stored cross-site scripting it will kill
that because that is also in line stuff
you can stop when I have not managed to
get cross-site scripting but I've got
managed to get HTML injection
rewritten pages using just style sheets
and pulling images from here and there
and rewritten stuff like that again it
would kill all it kills all that off
because you can't pull in third party
style sheets or third party images
without and be explicitly set in the
list these are the different things you
can set so you can say I don't know some
of what these do but you can guess most
of them ciao sauce is what you can frame
I think it is font awake for fonts
prompt forms where you can post forms
back to so if you're a login page you
want to set form the form action to all
the deals post back to the login page so
it's fairly obvious but if I can
intercept it and somehow and get that
login form post enough to my side I've
just still need credentials so you can
lock that down frame source images we
post from what media media types you can
have what plug-in types this site can
enable script style sheets report your I
again I've mentioned that in a minute
and these very complicated sheets that
you won't be able to read from where you
are
specifies which of these headers which
these and the whole load others are
available in which different browsers so
the beautiful ie doesn't support content
security policy opera from certain
versions onwards and you've got sort of
Chrome and Firefox sports things I think
that one there the second one in is edge
in which case edge does start support
things but ie never did and you've got
your mobile browsers as well which are
different they implement different
features from different versions they're
implementing this it's really good if
you can do it if you're going to do it
do it from the start of a project
because it forces you to put all your
JavaScript in libraries or your CSS in
libraries all your images are coming
from this image server it really forces
you to split everything up and think
about it and build sites properly
because they're all broken out it stops
that little hack where that stylesheet
is may or that thing you styled up
slightly different to everything else
Fred over here put a little tweaking to
fix that in IE because it didn't work
with this it stops all of that but at
the same time implementing it and
actually thinking about it he's a real
pain even putting it on my fairly static
sites
I killed quite a bit of stuff because I
had dropped in the odd little CSS tweak
or a little script to hide and show
dialogues so influencing on his this
insight yeah good luck on it from a new
site I would definitely consider it and
make sure you get it on all the
developers all the development servers
as well not just when you production one
because what you don't want is to for it
to work on development push it up to
production and then suddenly a CSP kick
in and why is that not quite working
where's that scroll bug on why is image
disappeared the good thing about if you
bring up your browser developer console
it will log exactly what's happening in
there so you can see why things aren't
working yeah the this is where we come
back to report URI bits of it you can
set called excuse policy if you're just
developing it to log stuff and back to
the other ones where I mention report
URI the XSS protection and I've come on
to another one in a minute uses it you
can say report your I and then a URL and
the browsers will send out this I just
have failure for this so I've just tried
to load an image from a source where I'm
not supposed to or I've just tried to
run inline script I'm not allowed to and
it will report it all out and if you
monitor those logs then you can see how
you're doing with it you can see where
you broken things you can see where
people trying to attack you oh yeah look
somebody's dropped in a thing to try and
pull javascript file off this server and
then maybe you look at it and see how
they were trying to attack you or why
they were thrown tacky yes that's
dropped in I would strongly recommend
setting up account with a company and
they are now report your I comm full
disclosure it's a mate of mine that runs
this but it's a really good service
particularly for your content security
policy it
the browser just sends off a whole ton
every time for some reason it's
triggered it sounds off an alert it is a
little bit overwhelming uh specifically
where to put it at start because you get
a lot of stuff particularly where things
like ad blockers have kicked in and ad
blockers have injected script into the
page to try and do things or various
extensions in inject stuff into the page
and you get a load reports for them
which are kind of false positives but
you still have to dig through them once
you get used to your site's same as any
logging you'll be able to sort of fill
throat on the kroff and you'll see they
the good stuffing that actually there I
have missed it and this is an example of
my site I took to a new font file on
there awhile ago I forgot to update my
policy and when it looks at report your
eye I got so the standard things date it
happened
I'm only forcing so I am saying it's
it's locked down it will enforce policy
your other option is just to report so
if you tell it to just report the
browser will allow it through but it
will log all this data so it's enforced
on that particular page the director is
a font source and this is the report and
you can scroll that out and it basically
tells you off my site I'd thrown a fonts
or seen and I hadn't told it it was low
twos that font so the site was never
shown the font worked fine on my
development machine I put it up forgot
to check it and and it starts reporting
it so even on little sites it it's quite
easy to get wrong and mess up but if you
if you turned reporting on and you
monitor 8 which is a really important
bit you've got a monitor 8 then you can
pick up all these issues as they're
happening I've fixed them and once
you've got things flowing you can kind
of forget about it because it's there
it's worked in the background public key
pinning Jeremy run off was he somewhere
in here Jamie asked me about this when
we came in short version of public key
pinning is that it's a way in a header
to say this website
can Oh back a second CSP is on a
per-page basis this is back to on a per
site basis so this is the browser these
are the signatures of the certificate
authorities allowed to sign certificates
for this site so on my site I would say
that almost if Achatz have to be signed
by let's encrypt comodo can't say i'm on
semantic carts I'm on can only be let's
encrypt the idea is that if CA goes
rogue or gets hacked like Symantec did
last year and they start issue and run
them certificate so they're not supposed
to it doesn't matter because they would
have to for me they'd have to pop let's
encrypt to get fake certificates put a
semantic one on it wouldn't work because
I've told them this is the signature of
let's encrypt it's good to do that long
version of it it is a bit more
complicated that you've got to have to
multiple redundancies and all sorts of
things but don't worry about it because
the general advice is don't do it don't
use public key pinning to the point that
Google who were possible team that
created it I've no dropped it or will
have dropped it from chrome 67 and the
big problem was what's been known as PK
p PK p suicide people set these
signatures they say the certificate can
only be signed by such body and this
header lasts for 12 months which is the
standard thing so the next 12 months my
stiff Achatz can only be signed by let's
encrypt and then they messed something
up and they ship their certificates
across to some semantic Okamoto and and
then all the browsers that are set that
had the headers suddenly contacts of
site and it goes a little bit more
in-depth than that but basically you
could really screw yourself up by
setting this wrong I lock everybody out
of your site
that's a link it was smash magazine I
think is the big public one where it
happened to and they did a good write-up
on they should what happened this is
where it went wrong this is how we
cocked it up certificate expired we
renewed it we forgot showing the headers
first because it's difficult expired
they couldn't put that one back on
because it was expired so that will be
ignored
whatever read the story there is also a
fairly local bank that also did this and
they're locked about 50% their users out
by by just messing up the pinning
anybody who come to site up to this
points have the signatures for the old
certificate in they suddenly contact
site anybody new we're fine because they
got the new keys and new signatures they
can access it
anybody older couldn't I'm generally
only way to fix this is for the
browser's to build in a patch for it or
you somehow go talk to all your users
and you have big nasty things try and
fix it but basically it's a browser fix
chrome you have to talk to chrome very
nicely or Google and Mozilla yeah all
that that's the link for it Smashing
Magazine so there is also the thing of
if I'm honest get control of your server
I pin keys to some Chinese post office
were allowed a dodgy CA and then I give
you your server like as suddenly I've
forced you to use Chinese post office to
issue all your stiff coats otherwise
again uses a locked out so there's also
that side which is more malicious attack
side but it's the it's the accidental
getting this wrong that was more
worrying for most people but it's been
replaced by I think I'll expect CT so
expect CT is short for expect
certificate transparency and what this
is is now any stiff achill thats issued
by cert of the major certificate vendors
will be logged in certificate
transparency logs are the various sites
out there that are doing this basically
it says have I got an example no it
gives a log of this difficut was issued
by this group at this time and this is a
bit of information about its difficut
signing request and the logs are
completely public and fully searchable
and the idea being that you set up
monitors for your domains and you
monitor them to say
who to look for any stiffness been
issued it's difficult issue this morning
IT departments who issue who request a
sticker yeah I did
okay valid stiff real issue this
afternoon didn't every request it no
right we've got a rogue stiff Achatz out
there we've got to deal with it
I knew exhorting put things in place it
gives you alerts that rogue things are
happening that people attacking
certificates but it doesn't kill you
users if you get it wrong so this is the
base of the replacement for it you know
a couple of options you've got and for
us so you can specify only accept the
certificate if it appears in a
transparency log so again if it's
somehow issued by internal and you
managed force internals see a stiff gets
onto a browser and you do all the sudden
the other is a corporate money in the
middle it will still get killed because
that certificate will never appear on an
official certificate Churchill Inspiron
see log so this can be used to kill
monitoring on companies that are doing
inspection at the border so they're
putting their own cas onto onto machines
so it will stop that well us about your
max age and you'll put your eye so again
this can get logged out to any server
port your eye comm being the better one
and you just sit and monitor that
another one to monitor it with is
Facebook for some reason Facebook have
built a brilliant little app I suppose
but you just go and say these my domains
monitor it and they will send you
updates whenever whenever certificates
issued for your domain and it seems so
weird that Facebook was doing it but
they've decided that it's really
important and they've gone with it there
you go there's a couple of options max
age zero and reports that's if you're
testing it out and then you can set your
ages the high end the 60 seconds is just
a basic one if you're just playing with
it but you push it up to a year or
whatever if you get real-world yeah top
one is a link to setting logs where you
can actually go and view the view the
logs and the bottom ones
Google's in notes on how to get it set
up and how to monitor it I'll make all
these slides available somewhere later
and obviously you've got the recordings
for it oh yeah there you go thought to
put sliding so that's an example this is
from me
for my site back in 2015 I was using
GoDaddy
for my stiff Achatz obviously back then
they'd started doing certificate
transparency in January 2016 I changed
let's encrypt if you have a look through
there on the same day that's when I was
experimenting with it setting it up then
I messed about with a bit more and then
you start getting your regular updates
so don't very much April July October
December and it goes through so you can
see let's encrypt the cific it's only
valid for 60 days on 90 days things 90
days so if you look through that you can
see the renewal every 90 days and you
will expect it so you're looking at go
yeah that's not a 90 day renewal don't
worry about it oh that's been coming in
at 30 days and it's by GoDaddy but we
normally have it by let's encrypt
something's going on here
check it out downside to this is this
leaks all your domains that you've got
certificates for so I was looking at
this last night and literally there are
domains being registered
like 10 20 second I asked for a list of
everything it just scrolled like mad you
couldn't read it so every domain every
subdomain to get a certificate issued
it's any up in these logs so if you've
got something really sensitive and
you've put a SSL certificate on it it
will get logged so if you if you need to
do that I would look at getting a
wildcard certificate as attackers we
like to look at that for spotting slope
new brands so if Cadbury's are coming
out with a new chocolate bar and we're
kind of trying to guess the name of it
and we suddenly see Anna Wonka roulette
Cadbury's calm well we've just got the
the name of the new bar and we will
access to the site potentially before
it's been launched so we can go on look
at it a couple
by shares or do whatever we want to do
on it sets power click jack click fraud
campaigns to steal stuff and get in with
Google and whatever so it's really good
from scoota point of view bad from a
kind of company privacy point of view
but you just got to know that it's there
and be aware that potentially you're
leaking out information through it right
that's the headers done smell the pizza
at the back I'm gonna go quickly through
cookies because you probably know about
the cookies already but I'll share along
it takes up through them in any way
again for a quick example hard to see on
the screen but there's a few cookies
being set and pulled back from first bit
of PowerShell three main flags you can
set up a cookie you got secure HTTP only
and same site secure very simple says
this cookie will all be passed back if
you're running over HTTP stops quick you
from being sniffed by going over HTTP
really good for session cookies stuff
like that particularly few users are on
hotspots at airports still if it stops
session hijacking stealing accounts I'm
session how Japanese real I have sat in
airports and watched sessions going back
and forwards and the guy next to me is
stolen all the sessions and watch
something she's not supposed to yes it
should be set on all session cookies and
yeah if you say oh we haven't gotten an
HTTP version of our site it's not port 8
to listening if I do HTTP calls like a
site look calm calm four four three
that's a use HTTP to connect support for
three rows will will make that
connection it will send the cookie yeah
you'll get rubbish back because a
website say hang on you're trying to
talk and crypt
no little encryption encrypts ID but
because you've specified HTTP the
browser will send the cookie over HTTP
so don't assume that you don't need it
if you don't run an HTTP version the
site HTTP only fairly simple cookie just
says Java scripts are not allowed to
touch the cookie really good stopping
session hijacking by cross-site
scripting so normal cross-site scripting
would pull the session that pull the
cookie out of the Dom and throw it out
to external side you think of access
HTTP only says JavaScript can't touch
that cookie it can't grab can't sent out
again and really should never be needing
session cookies accessible by by
JavaScript but be careful how they'll
think about your app first before you
set it just in case finally the new one
same sites this was introduced back in
the last year against not supporting ie
edge Safari I was told opera supported
it but then another site I looked at
said it didn't I don't know basically
what it does is it stops an attack or
cross-site request forgery across it
because the best way to describe it is I
can trick your browser into doing
requests on for me but without you
realizing what you're doing so if you
want a proper explanation at it of it
grab me later I will quite happily
explain it properly but basically it
killed the same site cookie says if I
send a request in that's the best way to
describe that if if I try and get your
browser to do a request because it's my
site that's initializing it it will see
the code the referrer model in the
browser and it won't send a cookie with
it if it's you that's doing it it will
it's a tricky one to understand once you
get header only it does work two options
for its strict and lacks lacks is the
better option because it's strict the
first time you visit a site you won't
get cookies so if you've logged into
Facebook and then you close your browser
bring it back up again put facebook.com/
in because it's not come from the same
site the referrer isn't facebook.com
it's nothing because you just open a new
tab in your browser they'll cook you
won't get sent to the first time you go
to Facebook if you're in strict mode you
won't be logged in pure refresh yeah
you've come from Facebook you've gone
back into Facebook the cooking will be
setting be logged in so it's lacs is
generally the better option unless you
know what you're doing unless you really
know your
I'll act we'll say it worked because the
way it sends stuff through and that's
about it so the cookies bit was a bit
rushed but Sir my pizza's probably bit
more important than cookies at the
moment anybody got any questions on it
it's a PHP app so no it doesn't there is
Acme Bank ACM e bank is I think that's
the dotnet one yeah something not in
there by a group called phone stone so
if you if you wanna have a look phone
stone do acne bank at the casino acme
all sorts of things they're all in
different languages I know there's PHP
there's net there's a ruby one you name
it they've got what they've gotten
Noah's play with me till a day and after
a wasp that there's set up it's that's
more in a kind of competition style do
they solve the problem get the result
that you're expecting well done you got
a tick in the box move on to the next
one executed txt for those who don't
know each where you are supposed to put
your contact information for security
issues so sort of finds vulnerability of
size also we want to get into it with
you that should have all your contact
details they and stuff like PGP key to
encrypt things they're good to have
because there's so many time to try and
report vulnerabilities and sites but the
companies just don't care they don't
have an email address there's no way to
report anything to them things just
disappear responsible disclosure it's
hard it all depends on the company I've
reported stuff to companies are they've
been brilliant we'll take it thank you
very much we'll fix it we care will work
with you we'll do the whole lot I've
reported all the stuff that's just gone
disappeared no I'm not reporting that
whoops luckily I know people who they've
tried it's gonna you do it in the right
way you look at the company first if
you're not sure there are agencies you
can go through people like bug crowd or
go on they say book Crone hacker one
duper bounty programs so they will act
in to mediate between you as a tester
hacker attack or whatever and accompany
and generally the the wedding normally
operators the company comes to them says
we'd like to do a book bounty
these are the rules of engagement
anybody could try and hack our site as
long as they abide by these these
conditions you as a tacher or tester
then go test it you submit your issues
and hopefully if you get one right there
payout to you that's the normal model of
it so it gives the company free each
testing until as an issues found and
then they pay out on the issue there's
constant constant testing because people
are playing bug bounties all the time
what you can do with them as well is if
you find a vulnerability on a site and
you don't want to talk direct to the the
end company you could generally talk to
bug crota cell phone this could you
mediate it for me I want my name kept
out of it I generally they will help you
with stuff like that just drop in
vulnerability straight on the web and
it's generally a bad thing to do but
there have been times where it's
happened because the research has been
so frustrating it's been twelve months
they've tried everything possible
they've talked to the company it's a
bloomin big open hole that anybody can
work for anybody could steal the data
and then just get so fed up like oh just
dump it online here's the vulnerability
and now you're embarrassed fix it or get
your date stolen and it's there so there
are times where just dropping zero-days
dropping vulnerabilities is kind of okay
usually I think it's worth going through
the right channels first to try and do
it anything else
No
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>