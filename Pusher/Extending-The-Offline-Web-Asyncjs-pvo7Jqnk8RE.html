<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Extending The Offline Web - Asyncjs | Coder Coacher - Coaching Coders</title><meta content="Extending The Offline Web - Asyncjs - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Extending The Offline Web - Asyncjs</b></h2><h5 class="post__date">2016-07-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/pvo7Jqnk8RE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so today I'm going to be talking about
the offline web and when i'm trying to
think about design problems i need to
start with some sort of conceptual model
so this is my conceptual model for the
offline web it basically the persistence
of experience for a distant sources of
context now like a lot of people i think
very three-dimensionally when i'm
thinking about problems so when i'm on
the web i consider content to have like
distance from me I feel like a little
Prasad like a surface it's in front of
me which is the devices i'm using either
a laptop or a or a mobile phone and then
this is bits of content that live in a
distance away from me I don't know where
but they are at distance from from me
and the offline experience is the
persistence of that that experience
close to me and I think the web
persistence is really interesting and
really sums it up to me when trying to
construct me offline because if you look
at the definition of persistence it's
the continuing in a course of action in
spite of the difficulty or opposition
and to hold something offline is
definitely needs some sort of force or
action continual force or action to
actually keep it there it degrades
otherwise you know that you have to keep
updating the information you have to
sync it and it should make sure it's up
to date all the time it's like a
persistent effort that's needed so that
that word is quite important so a lot of
what I'm going to be talking about is me
using this type of model and I
particularly chose these words because
it gives me a very wide scope as well I
didn't want to narrow down how I
perceive the offline web to some sort of
like single page application or some of
them other sort of mental model so this
really helps me to keep referring back
to it end of the philosophy bit okay so
from now on we'll just move into the
next bit which is to look at some of the
design patterns and some of the recent
design patterns although I was thinking
about this about 14 months ago when
actually built the library so this is
the Washington Post's new progressive
web n to the pw a directory it's only
been out a few weeks if you use the
mobile device
and you go to this URL you'll find that
they've built a completely separate you
I away from their main site and it's not
the sort of like desktop site it's
actually completely sort of the
Greenfield built site that's it's all
its own in this little directory will
come on to why I'm think that's not
particularly good idea um but it is
actually really fast and if you go on
there it persists it's offline they've
got like sub 100 millisecond page loads
for some of their articles which is just
unbelievable on the downside if you hit
it with a non mobile browser you get
this page on this side which is
basically like these the old sort of
splash screens used to get saying this
site doesn't work on line 6 or this site
doesn't work with this technology you
know it's a bit of a slight step
backwards in an actual fact um Andrew
Bates and if you don't know this name
this this was the person who led up the
Financial Times ft lab so they've got
like a lot of background in this area
they've been building sort of offline
experiences using slightly older
technology of the appcache technology
for quite a long time you know and have
done a lot of work in this area wrote
quite a passionate piece I have to be
quite careful here because both the
Washington Post I'm the ft of both
clients of my exes so my words be chosen
carefully he wasn't overly happy about
the Washington Post's piece and he wrote
this article it's well worth you having
a read of it I've got the URLs at the
end you can you can use the URLs that
I've listed for you and towards the end
of the piece after he talked about why
wasn't happy he then did sort of a more
positive thing and listed the whole
series of bullet points about what the
communicate community in general could
do to have improved the position and one
of the one of these bullet points was
this one here where he said basically we
should focus on adding these new sort of
offline features to mature sites and
this was definitely my thinking a while
back and I sort of knew this problem was
going to come and raise its ugly head at
some point and now is the time now is
the time we're having this debate
so for me when I was thinking about
offline experiences I moved back to some
of the websites that I helped design
well five years ago so I did the first
two iterations of the design work with
on the Guardian job site in conjunction
with the product team at Guardian and I
think it was flow interactive as well
who did a lot of the user research for
us and this to me represent and the
reason why I'm showing you this and I'm
going to show you a few examples of this
site it represents one of these mature
sites to me it's got some of the
features and you know it's been around
for a while you know it's got millions
of users it's United however hear the
news site and it's been through multiple
iterations to get to the point where
it's at at the moment unlike most modern
site it's got a responsive layout and
typical of most of those sort of
responsive layouts of today as the
screen real estate changes and there's
some reduction in in the features and
also some paring back in some of the
material it's on there but just
generally just reorganize itself to best
show those the features that are there
without actually degra gating the user
experience if possible I'm pretty
classic I think we're all very familiar
with that type of thing so there I was
thinking about this and thinking okay so
if i take my mature site my guardian
site what would it look like if i built
a off offline experience and
particularly what would it look like if
i built a progressive offline experience
one that was iterative and started with
like relatively small thing and built on
the site as it was not like the
washington post it like build a brand
new site and stick it in another domain
and before i show you this little
mock-up I've just got to say caveat big
caveat this is not what magics he's
doing for the guardian or what the
Guardian asked for this is purely just
my meet me mocking up to see what I
would think about and if I was doing
that type of thing I probably come up
with a design that's a bit like this now
the Guardian jobs has about at any one
time between 12 and 15 thousand jobs on
it those jobs rotate every 28 days that
means a job change is less than every
three minutes on it so it's actually a
very high data traffic in sight I don't
think we could dump
of that data from the main site into the
client because it is just not very
practical the amount of updates we'd
have to send to the phone would be
really substantial but there are lots of
things on that site that are really
useful to the user that we could
possibly translate over so I've just
picked a few of them out which I think
would be quite useful um so quite one of
the things that users do is to shortlist
jobs so they go on and I just basically
star the ones that they're interested in
so we could show that we could stall
that and show those that BB definitely
of interest to the user we could do
something like okay as a user visits the
site we could track them through and
keep the last 20 jobs that they looked
up so if in the morning there they're
like looking at some jobs and then they
go on the train and our way through the
classic you in your tunnel type
situation they could go there and
actually look at the offline version and
I'm just took reread that job that they
were interested in and maybe consider
the jobs are there I think that would be
very useful just to keep that little
tiny history for them maybe 20 jobs
maybe 30 i don't know whatever but like
a subset of the job that he looked up
and then obviously if they're applying
for a job we could keep that information
there because that's really useful you
know what state the applications are in
when they made the application all of
that type of information so i mocked
this up to show you what i think a small
step sort of into progression to offline
progressive web app would look like for
the Guardian but then I thought well
maybe you just think that's me and I
know these these particular sites very
well so I went that step further and
just took to other web experiences that
I've been involved in in the last few
weeks and for what might they look like
as well I'm just purely making up out on
my own so one I went over to tousled off
a little while ago flew on british
airways wouldn't be great if the british
airways mobile site offlined both the
boarding passes and my bookings so that
I have the perdon information just that
stuff I'm not expecting to be able to
search for flights I know I can't do
that when I'm offline but at least I
should have that I should have that
piece of information and really funny I
did actually do these mock-ups about
three weeks ago and then the progressive
web apps conference just this week an
airline from Berlin is actually done
actly this which is great so that proves
my point I'm really happy about that
because it was just a sort of rough idea
and then equally as well you know amazon
my coilovers i use amazon for doing
different storms these are the books
I've got an order at the moment you know
amazon could provide me just basically
my current order sir offline which ones
I've got and when they're going to be
delivered you know that would be really
useful again I don't respect to be able
to search amazon at this GP they have
hundreds of thousands of products I'm
not going to be able to do that but they
could provide me this so the end of that
point that and remade he actually said
this bit which i think is good statement
as well it is some of this stuff can be
done easily if not elegantly and we
don't have to like fork whole thing and
build a completely brand new a new UI
and sort of put that and go down that
route we can just enhance what we've
already got so those mock-ups were not
me adding new features to the site so
we're just pairing back the menu to
those features that I think should be
offline because they're already part of
those those sites okay so this is
there's also this debate that's going on
at the moment about a shell actually I
think this debate about app shell is
just another version of what I've just
taught about so if you haven't come
across the concept app shows people
heard our app shell okay so at the
moment I'm the chrome dev group are
doing a really good job of trying to
explain all the different steps that are
involved in trying to offline web site
and to do so they're trying to have like
come up with phraseology zand
terminologies to encapsulate the
different steps and one of these steps
is referred to as like building the app
shell what that means is when you want
to offline something you take all of the
what we would have called in old terms
the earth site furniture or the page
furniture the header the footer that
menu all of those types of things and
you build a specific cash that saves
them because actually you can quite
easily offline those you can build a
cache that just we wear pulls pulls
those pieces of items from within the
bread
memory basically and reuses them without
them having to go off and this is just
like one phase of how you would offline
there's lots of different phases or
different recipes as they referred to as
all others as well of doing offline in
but I think unfortunately the actual
thing also implies some other stuff it
implies that you should build what a
single page app or like a singular app
much like the Washington Post one by the
very word a pin it and also it's not
particularly helped by the fact that
most of the examples use the material
design which is very related to apps as
well so I think it's just another
version of the problem that i just
mentioned before everybody's really
aware of this discussion absolutely I
was very nice at the summit in a
beginning of the week and some of the
comments that were coming out and what
this one particularly from Jake
Archibald is the Pacific you know we
need to change the perception that
progressive web apps must be a single
page were rendered up they can be either
you can take and enhance a current site
and just use what rendered web pages
install them into memory or you can
build a single page app using something
like angular or ember but the choice is
yours the technology is not descriptive
it you know you can actually use both
both both methodologies and we need to
be careful that the terminology doesn't
force people down one way or another
which is a problem with the app cache
thing so the examples I showed you in my
little mock-ups I would refer to them as
more psych furniture caches than the app
shell and I know it's just a little bit
of tweaking on language but i think is a
very important to econ language so back
to the Guardian and 14 months ago when i
was looking at this as i've said I
thought regard this as a mature site
there's something also there's something
else that's also very different about
this site to some of the modern the
messaging sites that we see
I don't like Twitter or any of those
types of streaming navigations with
notification and I sort of class these
types of sites of using document search
I couldn't really find the phraseology
that really encapsulates it well but if
I try and explain what I mean by
document search if you look at the
interface here it's pretty much driven
by free text search so in the far side
there people type in and they type the
job their job title in behind the scenes
what we actually do is we store all of
our jobs in a big SQL cluster so a
classic relational database system but
to the side of that we use elastic
search which I think a lot of companies
do now you know like a proper free set
free text searching system as well and
that's what drives this box here it sort
of paired that the text search to geo
search as well so you can say I'm
looking for JavaScript jobs in Brighton
or JavaScript jobs in London and it
finds those things for you so here we
have classic free text search over the
over documents that are stored in in
this case in elastic search and then
secondary to that is a classic facet
navigation system so facet navigations
are you know best explained by what's on
Amazon when you go down the column on
the on the on the left hand side you
click on 11 item like I don't know if
want to look at books and then I then I
want to look at computer books and
slowly you work your way through your
navigation and it drops you down and
each time it tells you you know what the
subsections are for each of them so you
drill down through it and the facets are
generated automatically from the data
that's stored typically strangely we
find that some people like the this type
of search and some people like that
we've never never got to a point where
once dominated another and to be honest
they're often found together and that's
why something like so la which is
another sort of variant of elastic
search it's all but they're all based
off the same underlying technology which
is a leucine engine they also include
facets as part of the core of their
system so i was looking at since this
insane mature sites I'm interesting
offline in I can do the bit that I
showed you in my mock ups but
how could I extend that further what
could I do to move this type of
functionality into the offline world
because I'm really interested in this
sort of document type searching and I
want to bring that into my offline
experience so maybe not the first step
of like when I enhance a site but you
know i'd probably do what i showed you
the first step then what would the
second step would be and could i
produced a piece of technology that
would allow me to do that and that's
where this project came in that's that's
why i started this project not actually
to produce a library for people to use
but for me to experiment with that
concept so and find out where the limits
are so money is a document search tool
based in JavaScript it's actually up
online i have put it up online it's and
the github repo just as positive it has
a great big label at the top of it
saying unstable API because it is an
experiment and I don't want people to
think otherwise but have fully
documented it and so that people can
play with it and use it and you can play
with it as well and i'll show you it in
a second this tweet came out and i think
it's absolutely great um yes your
friends should stop friends from
building databases i think yes
absolutely databases are complex thing
so you need a lot of hardcore domain
knowledge to really build a proper one
and to get it performant and maybe i
shouldn't be trying to build my own
database that runs offline but i think
there's another thing that comes with
this statement as well but sometimes
it's really great to lift lift the
bonnet and twink it tinker with an
engine because in doing so you find the
limits of a technology and in doing that
it gives you ideas about maybe
possibilities that you wouldn't have
thought out otherwise you know i can I
and I often do this play with
technologists just to find out where the
borders are and this project is
definitely that so before I get into
doing the demo I'll just show you i'm
only going to show you a tiny bit of
code because I'm just then I'm going to
show you how it works but just so you
know how how easy it is to set something
like this up for for free text search
you need to create an index it's no it's
no real is there's no real value
in indexing everything there's certain
things like billion information that
wouldn't be good you really interested
in specific pieces of text so you need
to decide which pieces of text you want
to index and all the options does is say
this field in this case the title field
in the text field I'm interesting i want
you to index those and on the title
field can you give it a boost of 20 a
boost basically tells the index that
that's more important text so you know
if you find the term in there you know
that's more important and if you find it
in the main body of the discrete of the
of the article in this case once you've
created the options it's really simple
to set up money you basically
instantiate an instance of it giving it
the options and it then provides you
with an index are so you can produce
multiple indexes if you want to you know
you get but in this case we just
produced the warm and then once you've
got the index you add your your article
or your record your item to it and it's
added as a JSON object with a series of
properties for the demo that I'm about
to show you what I've done is I've gone
on to the async site and taken all of
the events that have ever happened to
async turn them all into JSON objects
and we're actually running in a browser
here so I've loaded up Manny and I've
loaded up there Jason so that we can
play with it just doing this here okay
and to do the search pretty simple as
well basically take the index dot search
and then I'm going to search for the
text and the text i'm searching for its
promises so the next few screens are
going to be set up like this and i'll
sit down and show you how they work on
this side are on on the left on left
hand side you've got basically a text
area we have some jason in it which is
going to be our search terms i'm going
to type in on this side it's just going
to print out whatever the results are
coming from our data set which is all of
the events for racing so at the moment
it's fired up promises and these are the
four events it's found that have their
word promises in if i change that to CSS
you can see pretty much straight away
changes over to
to CSS I can do css3 if I want to do 30
see just back again we can do things
like modules and you can see that it's
actually picking up all of the stuff
with modules I think at this time but if
I tell you what I've actually done is
use a whole series of underlying
libraries to create this obviously
create from scratch wouldn't be a bit of
a silly thing to do I just wanted to see
where the technology went so the
underlying library that runs this is
thing called loon rjs which you've
probably heard of before if though some
of you may have heard of before which is
basically a free text search engine it's
based on that same well originally it's
not based on the concept of solar which
is one of these leucine engines so what
it does very quickly is it takes a piece
of text it tokenizing it and by
tokenizing all I mean is it breaks it up
into words so you've got a lender load
words then does this thing called
stemming which sounds really heavy duty
but all that is is to take things like
the they like started and turn it to
start and anything starts and that would
go to start as well so basically
compresses it down to the smallest sort
of term you this particular one uses the
marketing porter stemmer if any of you
know are interested in that sort stuff
that's basically generally the one
that's used for English so it's pretty
good and its results when it when it
then searches through what it actually
does is provide a ranking so when the
results come back to me it injects a
score into the adjacent records the
scores just a number the bigger the
number the more it matches and then I
just order on the skull so you can see
I've got in there I can I've also then
on top of that added my own paging so I
can say okay page me down to just two
items and then if I want to start at
item two and that way i can create pages
through the whole thing literally by
just modifying a stark number and the
number of the limit is basically the
page limit I set money up so that
the results come back without paging
information if you don't give it a start
start out or a limit as soon as you give
it start at limit and also injects the
paging information so you can quickly
produce a UI for paging if you want
that's paging it also has a sort so as I
said it actually sought I don't think
this much practical use all I'm doing
here is actually hidden behind the scene
defaulted for for text is to sort by the
score and reverse the order so that is
at the top so that's basically the free
tech stuff so facets I didn't really use
a library for facets I just built it
myself it's about 89 s of code i think i
could even compress it more than that
but facets are actually quite powerful
so at the moment this is the tags so you
can see that we've got under dog tags
with that what else can we look at okay
so we can do then oops you have to
excuse my typing it's been used don't
name open you they go so there's a so
there so we're nearly at the point where
middle streets just about to take over
from the skipper's like the venue of
choice you can see history moving on a
bit like that or you can do we could do
more interesting maybe is speakers
that's actually an array so I've built
into this a whole sort of Jason Jason
path in thing so where I'm doing when
I'm doing the path there it's basically
just passing into the JSON and saying
give me the object speaker that's an
array so give me the first item of it
and then give me the name of the speaker
and there you can see you know you know
Dan's done the most talks that's quite
interesting i meant number i'm down
there though number three talks so but
we can start to add a few extra bits to
that so again i can put a limiting so if
I just want four of them i can facet
limit limit it one of the things that's
quite interesting when you're when
you're dealing with tags is that they
often come in mixed case so I just put
in quickly a case a lowercase in system
because I find that quite useful when
dealing with with there so we've got
those there and then but the next bit is
you can then combine the facets with the
free text search so if you see down the
bottom there it's got text equals CSS so
what we've got here is a facet structure
related to the speakers that have talked
about CSS and the counts that they've
done so it's starting to combine
together they're two different things
you have to remember this is all
operating in this browser none of this
is going back to the server so obviously
I've got then I've got I've got my my
free text search and I've got my facets
I'm probably still 1 i'm going to do
structured query so stretchered queries
of what you classically do with the
database so here there's lots of ways to
query at the time I was building this I
was doing a lot of MongoDB work so I've
basically used not a cut-down mongo DB
query in system so it's got like here
we've got sponsors equals null so it's
basically saying give me all of the
talks that have never been sponsored and
that's the list there we can do much
more complicated operators so this is
like give me everything from a certain
date so I can go ok from 15 so you can
see that's now cutting down in size I
can do into the month if I want to 30
and cut it down that way and then you
can start to add them together so you
can also do here you can see on date i
can do two bits into it as well as i can
do from from an to as a date range and
down the bottom i've got something like
this sponsors being no I could switch
that round if I wanted to and do
something like if I can remember the
syntax I think it's going to be not
equal
no yeah so those are the ones is it
which way is it he keep art equal that's
it there we go there we go I've got them
listed on the site and being dyslexic
doesn't help when you're trying to work
out which way round letter but anyway
yep you can see it does structured
queries it's not a full it's not a full
full list of what you can get on mongodb
but it it's you know it's a reasonable
list to allow you to do sort of
structured queries which you can also
join in so that's great and good the
next thing i want is geo and
specifically the one that I'm really
interested in because there's lots of
ways of searching on geo you can search
within a bounded area but the one that I
really like is the sort of nearby Type
searches so I took the gia lib library
and if if you've not used it before
fantastic library really great can do
stuff like finder what's nearest to you
it does calculations and longitude
latitude takes into account things like
the curvature of the earth and stuff
like that really clever so again if
you're going to do Geo stuff you need to
basically create an index because you
need to tell it where the geo
information is so I'm going to swap data
sets now I have like a list of like
places that I visit it's got about 190
in it at the moment I just thought keep
as part of some other work I'm doing so
I'm going to use that data set and
within their it's got a location dot
with the longitude and latitude in it so
you just add that to the options and it
will create the the Geo index I'm also
creating a text index at the same time
from the same data so the Geo going
again you can see here basically the
search is kicked off near you just say
nearby give it the longitudinal etude
that longitudinal attitude is for this
room I believe or somewhere near this
room and if I start to actually delete
out the specificity of it you can see
that it drops away and goes to slight
slightly wider position
you can do an offset so an offset is
basically if I'd set that to zero you
can see midlet the middle street comes
up first because that's the nearest so
it's like within one meter of where I am
which is about right and clear left is
14 meters I don't know why that's
probably because they're a bit further
over that way when I took the reading
but literally just the number that goes
in offset is basically deletes from the
top of the list and that's really useful
for if you're doing at where you want to
get nearest to where I am at the moment
and you don't want to include actually
where I am but also you can just keep
going if you want to so for a bit of a
laugh I've added if you notice look at
the distances I did the concept of
British distance which we don't have any
single measurement for so for me
anything that's nearby is measured in
meters so if we just keep knocking it
out after that it goes two minutes
warped so I basically part the geo
librarian which I've made available is a
conversion from meters to miles and
kilometers and stuff like that and all
I've done is divided the miles by 22
minutes and that gives me how far I go
and then obviously if you go out a
little bit further as soon as you get
over a mile I start talking about miles
that's they obviously British
measurements which I've managed to
include in there so but as with the
other stuff this becomes most powerful
when you start to add it together so you
can add nearby searches and then I can
do a structured query on the tags to
save pubs so very important for after we
finished we know where exactly the
nearest pubs are and of course the hot
polls is nearest at 52 meters so there
we go so I think that works quite well
ok so that's that's the end of those the
demos just to sort of explain a little
bit i'm not going to go into mass about
the architecture but just so you know
how it works basically there's a
document store that holds the adjacent
for the time being I'm actually holding
it in memory just because it was easy to
do while I was building it and you add
update and delete and removed from the
document store I then added an event
meters I built this actually
a as a node and project and then browser
fide date so it's using the node event
meter thing so every time a documents
changed in any way whether it's added
have removed updated it fires events the
two indexes on either side if you create
them listen for those events and then
they take that document and create what
they need so that they can do their own
searches for the text one that's a
really complex sort of B treat right
structure which stores how how to do the
searches for the Geo one it's really
simple it's just the ID and the
locations basically the linkages is a
single idea between them then when I
execute a search there's a top piece of
logic at the top and it just looks at
the Jason you passed in so you saw the
JSON as I built it and works out how to
fire each of these at differ in sequence
in the right types of sequence they
basically do their search and return
their IDs so that then creates a subset
of ID's that's then passed to the next
bit then does its work and either
filters or uses those IDs and that's how
I can integrate one type of search with
another type of search to provide sort
of like a unified output at the end and
that's how it was so I kaslo ng as your
document store supports events so if you
could do something with index DB or EXT
or some of the other sort of like
offline search things like pouch and
stuff as long as it's got a venting I
can swap that central bit out and make
this work which is what I would plan to
do if I moved it forward but for now it
was just done in memory there's a few
other extra bits to it which you you
really need if you're going to do this
type of thing which is to serialize your
data so basically you can see there when
I create an index and I add documents to
it there's two extra functions as one
which is indexed to Jason which
basically takes whole thing that so the
compressed indexes plus the document
store and builds a JSON file that's
important because building the index
especially the text index it can be
quite performant in texting like quite a
lot of CPU so it's good to actually off
lay it in
if you want to do that and that's often
done with the Loon rjs for static bills
so if you want to like use this type of
technology you can like use when you
build like say a blog and you each time
you do a post you build it statically
you can actually create an index and
just send the index and load it straight
up and do it that way build the end exon
node I'm actually deploy it and again
obviously I need a pass function to pull
it back in again once you've got that
then you've got the next stage because
of course as soon as you can see realize
something you can persist it so in this
case again I just did the simplest thing
because I just wanted to see how it
would work I took local forage forced it
to use the index DB as a store mainly
because it's bigger than using the any
of the other browser storage mechanisms
but it actually dumps the whole thing
just as a single file in which is like
literally just dumped it in I'm just
using that because i want the larger
storage bit the persistence library is
pretty small all it does is listen for
those events so as soon as the dot
anything changes in the document store
it asks for a new version of the jason
and persists it back into the thing so
it keeps you up to date all of the time
and i don't have to do any sort of any
other calls so once you put this piece
of code in it automatically persists the
browser and at startup will lift and
load from the as well so as i said it
was built on top of other people's
shoulders so I better give them the
kudos they deserve the free sex was done
on top of Luna the query engine I
pinched from from this DB I'm not quite
sure how to pronounce our geo lib was
the nearby search and local forage for
doing the persistence there's still
quite a lot missing from this to make it
into something that maybe i will use it
depends on what type of project you're
doing but the things you might want to
think about our sink how do you sync
between the server and the and your
device or your browser obviously things
like patch DB I've got sync built into
them and that's right one of the strong
bits there are things and things i could
use and maybe by using something else to
do the data store I'll
gets ink so I could maybe sit this on
top of something else like pouch or one
of the other ones real-time updates
until yet you know the types of stuff
that you get with pusher or with with
firebase those types of like when you're
building streaming type applications you
might want real-time updates it depends
on what the type of application you are
worried which of these types of ways of
passing data in I've got some examples
of web workers you definitely want to
use web workers to lay this type of work
money is fine I've run it through a web
worker absolutely works fine that way
there is a methodology for actually
baking it into the actual file so people
don't have to do it themselves I haven't
done that yet I could build it on to
index DB rather than memory storage want
to try that out the interface is really
simple at the moment I think I should
move it over to promises I think that's
a no-brainer and then the last thing
which is actually more difficult and I
sort of give a bit of sleight of hand is
that i'm not typing the data types at
the moment so you know that bit where I
was showing you about the dates and
stuff that was actually a text
comparison but because i'm using iso
dates it actually works but you start
moving to things like time zones and
stuff like that then you need to
actually type your information which
means that when we create in the index i
need to go through and say this is the
data you're going to get and these other
types it's going to be a number it's
going to be a you know string or a date
so the comparators will kick in actually
I have actually got the comparators
already built in the system that works
out from but I just haven't got the
schemer in place yet to do that sort of
date the date typing data typing it is
just an experiment there's loads of
other stuff out there um you know maybe
you don't need to reinvent the way it
will you should look at some of this
other stuff elastic Luna which is a
variant of the lunar 1 i'm using uses a
different scoring mechanism its act so
lunar is more akin to the scoring
mechanism that you will find on solar
and elastic that obviously that one's
more akin to the elastic search one
that's important if you want to use
server size search and
replicate it there because you'll get
different listings and that would be
like a bit uncanny valley for some
people index promises a great little
library by Jake Archibald which just
basically wraps some the nastiness of
indexdb hoping to a promise slide be
something about 3k doesn't completely
take away the nastiness of index DB if
you really want to take away all of that
stuff much higher level API is Dixie
really good again promises really does
abstract you away from all the mess that
is index DB DB obviously got sink
fantastic possibly used our hoodie which
builds on top of parity being couch TV
another project you should look at maybe
pusher and firebase basically for the
real-time messaging I think you know the
pens on your application design so wrap
it all up what did I learn because it
was an experiment so there must be some
learning out of it that was all point of
it I think the first thing from the
design side is that it is okay to build
a symmetric offline experiences it's a
valid design decision so what do I mean
by that well I mean probably the
opposite saying it's isomorphic that's
horrible word way it has to be exactly
the same on both the server and the
client and I hope I've shown you some
nice designs or I did some nice design
ideas which are not completely
isomorphic doesn't mean one way and over
it's a bit like the whole thing about
whether you build in a single page app
or you don't but I think you need to
think about it and make a positive
decision not just follow everybody else
follow the crowd you know and there is
some really good examples of that I
think the other thing to say is that you
should probably before other tenants
that have come with a responsive design
which is don't completely don't create a
completely different experience try and
pare down the one that you've got do
something that's very similar are the
same to what you've got is like a
pared-down version and then that's the
best way but occasionally that's not
possible so a good example of when it's
not possible is is the sort of Android
version of maps where they can't show
you they can't allow you to view the
whole of the world when you're offline
because that's just ridiculous that
database that after star on the phone
would be huge but they are allowing you
now to capture certain areas that then
go offline and that's provided as like a
separate piece of functionality you know
it's not you yeah I'm so that's quite
interesting I think that was one of the
big learnings for me okay the this type
of document search and they know the
free text search the Geo mixing that
with structured queries and facets and
stuff you can provide it I think I've
just demonstrated to you can provide it
the caveats are within very tight
constraints it's only certain sizes of
data that you can deal with you know I
mean you have to be sensible you know so
i often get i've shown this to a few
people the first question they asked me
is how big how big can idea and the
answer is it depends it depends on the
size of your indexes you know how much
text to you indexing you know if you
just indexing titles then you can do
quite a lot but if you want to take the
whole body text from blog articles and
do all of that you end up you'll end up
with a very big index so it does
dependent and appends on your design as
well and a lot of it goes to some of the
other constraints that we were talking
about it's not actually obvious straight
away but things like the frequency of
updates are really important if you have
a something like that's like a 10 meg
database that you've stored well that's
fine you can probably deal with that you
could probably upload that over time but
if that database has to refresh every
three or four days what's going to
happen someone's data plan is you can
continually keep pumping up and when do
you get to do that when do you get to
actually update that when they open up
their their web page you're going to
then start downing low downloading
straight away a few megabytes of data
you have there so it depends on the
profile of what you're trying to achieve
so within those profiles and you can
look at it you can get away with it so
the best ways is maybe by example one
example I've just used it for which I
found really useful was just for a
little app for me and my friends for the
Great Escape so you know the great scape
thing that's on here it's 450 or bands
30 venues they play twice each
effect it's too much for you to go
through and scroll through 400 or bands
try playing twice that's ridiculous and
all they've got they've all got things
like genre tags added to them so I can
go on Tuesday any afternoon wat bands
that are playing electronic music are
playing and better than that I can go if
I get to one of the venues which I often
did and they were full okay I'm here
what are the nearest venues to me so I
can go to another venue perfect small
data set too big to for you to scroll
through but just perfect for that type
of searching you could probably stretch
from hundreds to thousands but if you
get over the five thousand ten thousand
mark it will really start to melt there
and the issue will not be actually
performance in the in terms of searching
it will be about you uploading and
keeping the data up-to-date so I think
I've proved that are the the techniques
and approaches work but I will gain
emphasize that this is not production
code don't take it and try and use it as
it stands I just there to prove a point
if I'm brutally honest when I've got it
sort of ninety percent of the way there
and I'm not fixing up two hundred
percent because I know people start
using it and then I'll have to start
supporting it and I already spend a
month a year looking after the happy
swagger stuff and a lot of the happy
modules and that's quite enough as it is
so but maybe I might do it but I saw
purposely nobbled it if I'm honest
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>