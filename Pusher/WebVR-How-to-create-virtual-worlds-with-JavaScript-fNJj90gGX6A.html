<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>WebVR: How to create virtual worlds with JavaScript | Coder Coacher - Coaching Coders</title><meta content="WebVR: How to create virtual worlds with JavaScript - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>WebVR: How to create virtual worlds with JavaScript</b></h2><h5 class="post__date">2016-10-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fNJj90gGX6A" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">but I'd like to talk today about
creating virtual reality web
applications using web VR I think it's
quite an interesting and cool time for
this at the moment because we could be
just at the start of a new era as our
friend Mark Zuckerberg said virtual
reality is the next major computing
platform after mobile and and of course
2016 and we've had a lot of these
devices and reached consumers now so
from the top the HTC vive the oculus
rift our gear VR in the middle we've got
Google cardboard and Sony's virtual
reality headset as well coming soon
hopefully most of you tried virtual
reality now actually hit that she could
I just get show of hands who's tried one
of these devices out at least one pretty
much to be great that's good and so
you've seen this but the really
interesting thing is that it gives you
this sense of presence of being inside
this environment this virtual
environment that you can create and it's
quite a powerful feeling
as Josh Carpenter said who was
previously working on VR at Mozilla and
now at Google I've made a lot of desktop
and mobile applications but nothing he
ever created was going to make someone
laugh cry recoil or scream or or have
that kind of reaction that virtual
reality can now we're creating these 2d
these 2d planes effectively to now
branching out into full 3d virtual
worlds and when you think about the what
that offers to us as web designers and
web developers it's it's really powerful
and we can use this new API which is
it's now a w3c community group spec so
it's on the way to standardization and
it's been being worked on for a while
and
what it gives us is first of all the
ability to discover what headsets are
attached to either our desktop computer
or our mobile phone could be slotted in
something like the gear VR and with that
display we can say hey launch full
screen on that virtuality display and
launch our content in in virtual reality
he also gives us the integration into
the sensors on those virtual reality
devices so we can tap into the
orientation and the position in order to
render the next frame of the scene
appropriately for the user depending on
where they're looking and it lets us
handle rendering for the different kinds
of hardware the different kinds of
lenses and the different distortion that
we need to apply to get it looking right
on those devices so essentially it opens
up this world of all these different
devices we don't have to just code
natively for one we can use web for yarn
and tap into them all what we have to do
basically is just render our scene twice
one for each eye so we're making a
stereoscopic scene and using the values
that web VR can supply to us we can
apply the right distortion to those
images which means that when you put on
those lenses that blows it up in the
right way to fill your vision these are
the browsers that are known to be
working on on virtuality and either have
a virtual reality browser out there
already or have announced that they're
working on it and bringing us in Chrome
and Firefox have been working on this
work quite well we've got our browser
there on the right-hand side that's the
Samsung internet logo and also just
earlier this month Microsoft edge
announced that they were working on this
as well it's not yet available by
default in a stable versions of the
browsers but it's a simple process to
get one of these downloaded and set up
so with Chrome on the desktop there's a
special build that you can grab if you
go to
your info there's the link there and
then you just download that and you
switch on the flag in chrome flags and
then you have web B are enabled in
Firefox is similar but you can use the
nightly build and then there's a web VR
enabler add-on that you can install and
that will set up where we are for you on
Samsung Internet
on Android you can slot that in you'll
give you our headset and by default
whatever page you're looking at on your
phone will then launch in this window in
virtual reality and you can then I'll
show it in a minute you can then expand
that up to fill your whole view and you
do just need to one time go to internet
come on / - web we are enable and to
enable it and as mentioned Microsoft
edges in development this are hopefully
you can see the back I will read through
it but this is basically showing the
building blocks that we either need or
can use to build virtual reality web
applications so at the bottom on the
Left we have a virtual reality headset
with sensors so something like the
oculus rift the HTC vive the gear VR
comes under that category too in that
case we just need a web VR capable web
browser and and another thing I should
probably mention is you may need the
right operating system because with
Chrome and Firefox I think they were
still just windows only since oculus
rift moved away from the Mac a little
while ago so if you get a OPI browser
then you can use it with one of those VR
headsets if you have one of those simple
smartphone enclosures like a Google
cardboard where it doesn't have its own
sensors but it has its own lenses then
you can use a web 4 yard polyfill and
this is how it was created by Boris from
Google and you can use then it went with
another mobile web browser to stay just
the standard chrome on Android and then
you can
use the same demos and everything and it
will work on Google cardboard too so
those things is your minimum requirement
for virtual reality on the web and then
on top of that generally speaking you're
going to be probably rendering your
scene with WebGL which is 3d 3d API for
graphics on the web and then on top of
that you may well wish to use 3ds which
is a really popular 3d graphics library
which and a lot of people use for this
and certainly makes it a lot easier than
writing WebGL API code directly and then
also I'm going to talk about a frame as
well which sits on top of 3GS and uses
3GS underneath and makes things even
easier to develop and it includes the
WebP er polyfill for us and it sets up
all the web for your stuff for us so it
makes it really easy but first to just
give you a bit of an idea about the
actual web via our API itself just this
month we had a new version of it and
come out version 1.1 but I think
currently they're going to just call it
web VR and it had a few tweaks and
modifications the original version
version 0 I think was about 2013 now so
it's been going through a few iterations
and it's been updated a bit so as I
mentioned the API can give you the set
of headsets available which in reality
is probably going to be one and so you
can call navigator get VR displays and
then using that VR display object that
we can get back you can say request
present and this is a bit like the
fullscreen API and say present this and
we give it a source of your canvas
element where you're rendering your 3d
scene and that will launch it fullscreen
on the headset then you can also use
request animation frame on the VR
display this is like window dot
requestanimationframe
but it's using the right refresh rate
for the headset so this
typically as more than sixty Hertz which
we normally do in a normal web browser
and to have that high refresh rate for
virtual reality for making sure that the
lag is as minimal as possible from
people moving their heads around and
seeing the scene update as fast as
possible and so it could be ninety Hertz
could be 120 Hertz even and when we're
ready we can say submit frame and this
will say hey take what's on my canvas
and actually render it um but we would
also want to use get I parameters which
gives us data likely I offset which is
the distance between your pupil in the
center between your eyes and the
recommended render target width and
height to help us construct the scene in
the right way to create two viewports
one for each eye and and similarly using
get frame data we can get a VR pose and
from that we can take the position and
the orientation acceleration and
velocity which helps us then predict
what we should render as the next frame
and then as I mentioned so now we've
used whether you are to display things
properly we we doing actually need to
rent regenerate our 3d scene though so
that generally we'd use WebGL I won't go
into WebGL details in this talk because
I'm going to skip straight on to 3GS
which is a really good library that you
can use on top of WebGL and makes it
nice and easy I guess most of you've
seen 3GS demos by now this lots of
really cool stuff on the website but I
thought it was worth doing just a quick
3GS demo we're going to make a spinning
cube and we can create a renderer and
3ds doesn't just render to WebGL but and
that's generally what's useful on so we
create a WebGL renderer you can set the
size of that and then we can spit out
the Dom element that it gives us into
our document body
we have a Twiggy sceen object which
encompasses all of the objects that we
want to display in this 3d scene and we
create a camera which defines the
viewing angle for the user so it has a
field of view aspect ratio and you set
near and far clipping values and that
means that that things within that near
and far range will be displayed and you
can set the position of the camera so
Zed is coming out towards us coming
positive so if we set the camera
position we've said to 100 then we're
moving it out this way so we can see
things that are a precision z0 and then
we add our camera to the scene then we
can create our actual cube and in 3GS
our 3d objects are called meshes and
they encompass a geometry which defines
the actual shape so in this case is a
box geometry width height and depth of
50 and a material which defines what's
actually painted onto that 3d shape and
in this case we're just going with a
basic material which means it's going to
show up whether or not there's any
lighting and we just set it to color red
and then we can add that heap to the
scene too finally we just need to
animate our cube so we create an animate
function and in this we can update the
rotation value of the cube and that's in
radians and this animate function is the
one that's going to get cool every time
we're ready to render the next frame of
the scene so we use
requestanimationframe for this and that
says hey browser call this back whenever
you're ready for the next frame and then
we can say renderer hey rendered our
scene and using the from the perspective
of the camera and then we just call
animate once to kick that off and that
gives us this which may not seem that
much but hey we've got a 3d scene here
and we can go from there and build up to
our virtual reality wells if we want to
now take this end
into a virtual reality demo we can use a
couple of things that 3d s also as they
can provide it gives us a VR controls
which sets it up so that it's using the
orientation and automatically updates
the camera according to that and also a
VR effect so we don't need to worry
ourselves about defining two cameras for
one for each eye and and updating all
those appropriately we can just say a
render from our VR effect and then it
can take out one camera and it can ply
that to two eyes so it's pretty easy to
do virtuality web demos with 3ds but
it's all before I get onto that this is
now taking that idea of the cube but
just blowing up a little bit there's a
an example on the 3GS website web for
your cubes and this is probably a good
one to get started with so and the
source codes up there and you can see
here as I was describing if you put your
Samsung internet running phone into a
gear VR then it will pop up in this
window here and then you might be able
to see this a little button that says
enter VR and if you gaze at that and tap
to the side and that will launch it then
into your full virtuality display and
look like this but filling your whole
vision but it's even easier than using
3GS to use a new library or saying you
think it was first released last year a
library from Mozilla called a frame and
a frame as a briefly mentioned before
includes the WebGL polyfill for us it
handles all of the virtual reality set
up for us and so we really can just
concentrate on our 3d scenes and all we
have to do to start using it is import
the a frame JavaScript probably in the
head of the page and then in our body we
can define a scene like this
so it's using the custom element API and
so these are basically just HTML
elements we have a scene which as you
can imagine maps to a 3gs scene
underneath and that sets up various
things for us and it contains the rest
of our objects and then inside that we
can include things like us our sphere
and our box and our cylinder things that
make up this scene here as we have a
plane for the floor and on each of these
elements we can define attributes that
set its properties for things like the
position the radius the color the
rotation finally we just add a sky which
determines the background for the whole
of the 3d scene and that gives us this
and without anything else without having
to do anything else this is a 3d scene
that we can look around and here we're
just using the the trackpad but if we
had a virtual reality headset on you
could just move your head around and it
also by default has WASD control so it
gives you a keyboard controls absord to
move around and then if we had say a if
this was on a mobile browser and we had
a Google cardboard hand we could press
that little goggles icon and that would
then render with our two scenes for both
eyes and then we could just slot it in
the cardboard display but make a
slightly more interesting demo with a
frame I wanted to make a flicker
carousel to view llamas on a mountaintop
and because every day is made a better
day if you give you a few pictures of
llamas so we're going to use a couple of
different components so I mentioned that
you can set properties of elements by
just defining an attribute on those
elements those attributes comes through
from components so a frame has this
system of entities and components
components being the actual attribute on
those elements so if we include this one
called layout component which isn't in a
frame by default but it is a component
from one of the core contributors in
this just on github you can find it
there then we can actually then on any
entity we can define this layout
attribute and that means anything that
we put inside this entity will be laid
out in however which way we define for
us so in this case for making our
carousel our circle carousel we can say
make it a circle of radius three and
then anything we check inside it will
just be laid out in this circle for us
and now we actually want to generate our
images and put those inside that
container element so we can create
dynamically a set of a images which are
images in a frame world and these we can
apply our source attribute from the
Flickr API the URLs that it gives us
back and on this image we can set the
width and the height there's one other
component that we want to use as well
though there's a look at component again
from from the same guy Kevin who created
the layout component and this is the
easiest way to say I want these images
to face me at 0 0 0 in 3d space so we
can just define the look at attribute on
that and they will all be rotated around
us ok and then we can just append our
image element into our container and
just from this you can see that you can
you can interact with a frame just
through normal Dom elements and through
normal Dom manipulation which is pretty
neat and it also means that a frame
plays nicely with other UI frameworks
and libraries like react for example
are the other thing we just need to do
is if we want to register for clicks on
our elements because actually it would
be nice with our carousel if we could
just click that click could be from a
tap on the side of the give your headset
or there's the button on the new car
balls now that just press the I can show
it to everyone afterwards because I've
got them if you've got some time and you
can press a little button on the Google
car board and it just presses something
on the screen to simulate a click it'd
be nice if you can do that and then we
add some interactivity this carousel
updates this position so to do that in a
frame we want to have a cursor the
cursor is if I just go back you might
just be able to see that in the middle
there's a little black circle let's our
cursor and it's showing where we're
focusing on the scene and by default a
frame includes a camera for us so if we
don't define one they'll be there one
there ready and and it will be set up
with the WASD controls and the loop
controls as I mentioned and but we can
define our own camera and we can say we
can put whatever controls we want on it
so in this case I've taken off the WASD
controls because we don't want anyone
moving outside of their llama carousel
they can just look around and so it just
defines the look controls if we just had
a pre canned animation this would be
very easy in a frame because any element
that you want to animate you can define
an a animation just place it inside that
element and you can even say for example
beginning on click and then that would
mean that as soon as you click on that
element this animation will happen it
would be triggered and so if we just
want one animation to say rotate 360
degrees we could easily do that by
adding a animation and say change the
rotation of this element to 360 degrees
and one thing just to mention there so
where as underneath 3 vs uses radians
for angles keyframe uses degrees which
maybe is slightly friendlier and it
translates them into into radians floors
underneath and you can set a duration
and fill just means
when you finish the animation just stay
at the end point if you set it forwards
but in our case we can't just do a pre
camera because you want to increment the
robot rotation each time that you click
but thankfully we can hook into tween GS
which is another library and a frame
like hit depending on 3GS it also and
depending clues on tweak it includes 20s
and we can hook into that and then we
can take control of animations and do
what we want with JavaScript and make
them dynamic as well the other thing is
worth mentioning here is that just the
Dom element here which is e/l has our 3d
s object defined on it under object 3d
so if you are making if you're writing
some JavaScript and to make an a-frame
scene and you want to hook into the
underlying 3GS objects you can do that
using yield or object 3d and so in this
case we want to update the rotation of
that 3d s object and make hit whatever
our target rotation value is and you can
set durations which we're going to say a
second and then you can set that
tweening to start and that will start
the animation or one more thing which is
just slightly cut off but we don't
define our sky for the scene around us
because it would be a bit dull to just
be in some blank space with the alarmers
in front of us it would be much nice to
be honor and then I serene mountaintop
so we can just define an image and if we
put it inside a assets this will use a
frames asset management system which
will help it to perform well so it means
that things will be kicked off when
these assets that actually loaded up so
we can say define an image with an ID
Mouse's guy and then inside our a sky we
can reference that image from the assets
and say I'll use this this source image
and then we have something like this
which is our a frame seen not too many
llamas there but if I click you can see
it's spinning around on me we can see
some llamas here there's a good one
so so this is again just a scene that we
can use on the desktop by just using our
trackpad or Mouse and we can spin around
and we can click and so it works on
desktop but it works better still if you
have a virtual reality headset and you
can pop this in there and then you can
experience this filling up your whole
vision and feeling like you're on the
mountain top and you have llama images
flowing around to you and another demo
that I wanted to show you this one was
created by my colleague ADA and I just
need to click inside it I think that to
use it and this one is a racer demo
which Oh which I can't seem to do left
and right on because then it's
controlling the slide sorry but normally
you could spin it around left and right
and in fact when you have to head sit on
it uses the orientation so you can just
tilt your head and it turns one way or
the other and you can tap the button or
press the button to to accelerate
forwards and this was built using a
frame and I made it incredibly for what
it is it didn't take that much that much
code all that much time for ADA to do
and but it is a really cool scene so
we've got both of those demos and some
more on our github if anyone wants to
see all the all the source code for them
and these slides are up online as well
for you all afterwards we're next
you've been how to build some cool
virtual reality experiences already well
some of the things that I'm hoping to
try next are using the touch pad of the
gear VR so we should be able to hook
into swipes as well so it'd be nice to
be able to swipe forwards and backwards
and things and control things
if you've got an HTC vive you can use a
frame with that and you can use the the
controllers that come with the HTC vive
and a frame have just released a really
cool demo is like a version of tilt
brush which you might have seen and that
uses a frame so that we really need to
try and do some things with that and I
haven't gone into adding in things like
physics and gaming engines which of
course you can get into to build up some
really nice experiences and web audio
adding some sweetie audio so that you
can hear things in the scene coming from
the right place is something you could
do and that would be really neat too so
what will will you create I hope that if
you get any ideas and you create
something cool please share them with us
thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>