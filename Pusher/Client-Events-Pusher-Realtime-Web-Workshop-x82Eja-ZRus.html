<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Client Events - Pusher Realtime Web Workshop | Coder Coacher - Coaching Coders</title><meta content="Client Events - Pusher Realtime Web Workshop - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Client Events - Pusher Realtime Web Workshop</b></h2><h5 class="post__date">2012-09-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/x82Eja-ZRus" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is Phil negative from pusher in
this video we're going to cover client
events client events use the
bi-directional communication powerful
WebSockets this means that you bypass
publishing events from your server and
publish an event from the client to
pusher which is then distributed to all
other clients listening on that channel
if we look at the diagram on the
homepage of our Doc's you'll see that we
have your application server pusher and
browsers now the standard way that we
recommend people distribute events are
by making a call to your server and your
server acts as the authority checks that
an event should be triggered and the
Mexica pusher but obviously we do
support the bi-directional functionality
of WebSockets and you can send an event
directly to push it from the browser or
another client any of the client
technology and then push it will
instantly distribute that to all of the
browsers as I said subscribe to the same
channel the channel that you're
publishing the event on one of the main
reasons you might want to use client
events is to reduce latency in terms of
event distribution because in this case
instead of there being a call to your
server then a call to pusher then a call
to any of the listening clients you can
publish the pusher and then straight to
other browsers or other connected
clients and therefore there's one less
component for the message to be
distributed through so there's just
pusher and then other connected clients
because we were aware of the security
aspects of developing real-time web
applications you can only trigger client
events on channels that have been
authenticated this means that you can
only trigger client events on private or
presence channels will cover presence
channels in a later video so as we saw
in the last video the authentication
mechanism gives your server an
opportunity to say whether or not the
current user and client has permission
to subscribe to the channel and
therefore if client events are enabled
whether they can trigger events on that
channel too as I just mentioned client
events need to be enabled
for an application in order to be
triggered to do that you need to go to
the pusher dashboard of your application
so if we go to a pusher app calm and
we've already logged in I go to the
real-time web workshop I'll go into
settings you'll see here I need to
enable client events so once that's
enabled it was already enabled but I'll
just do it anyway
then you can send client events if
they're not enabled you'll receive a
message an error message when you try
and trigger a client offence well I'll
disable them for now and we'll jump into
the code into the real-time web workshop
I'll maximize that so we're going in
client events and we're going to start
so the first thing we'll do is we'll get
this the config information that we need
I've got this from before somewhere
there we go I'll save that we are using
a private channel again we've got our
authentication in place from the
previous video so if we load our app so
I said we're in we're doing client
events now and start so do we connect
yet we're connected no problem just got
another window open
okay so what should happen here is if we
look at the console I've got a 403
because we're not oft again the worst
oath in the world and I'll just take
that again make sure we can log on the
other side okay I go hello from the left
okay we're good to go
so in order to trigger client events we
can I can actually just cheat down here
I can access the instance that we've got
running take that I am I get access to
the channel which we know is called
private message or isn't call this
private messages and then we call
trigger on it now trigger takes the name
of the event you want to trigger hello
now that's an invalid name actually to
start off with so we'll cover that in a
minute but I'll just demonstrate this
so here we've got unsupported event okay
so this error is actually because we're
trying to trigger an event that doesn't
have a client prefix so the name of a
client event needs to have a client -
prefix again this is kind of a security
aspect it's so that when it's really
when you receive an event a client event
you know when you're coding you kind of
go over at this is a client event I
can't necessarily trust this event
because as you can see I can type this
code into the console so any user of
your application can potentially type
this into a console and trigger events
so this time if I send it it's not the
same error it's actually saying to send
client events you must enable this
feature so if we jump into our settings
we enable the feature cool and then we
jump in here again and this time we try
and trigger it
there we go we've got a true over here
you'll also see on the right hand side
we've received a client event so that
has been sent so we've actually seen how
to send client events
so how do you want to use client events
within our application I don't actually
want to use client events to send
messages I like to send messages in
these sorts of applications via the
server because it gives you an
opportunity to check the users logged in
to authenticate to sanitize and validate
the messages that are being sent as I
said earlier client events are really
good for applications where the latency
key needs to be kept to an absolute
minimum things such as games but also
the good for adding extra value to
applications so in this case I'd like to
send information about when a user is
typing or when a get or when text is
been entered so in order to display
information like Phil is typing we
obviously need a username so let's add
the ability to have a user name to the
application what we'll do is in the same
way as the authentication we're just
grabbing the information from the URL
we'll just use a get parameter again if
it was a normal application you wouldn't
do that you'd have it stored in a
session potentially retrieving it for
the database so we'll we'll have a user
name I'll just go with user we'll make
sure that's applied so everyone hasn't
been supplied will default to creating
one and we'll give it a prefix of guest
we've never got a function that lets us
retrieve a username we want to make that
available to JavaScript because we're
triggering from the client so what we'll
do is we'll include our functions file
and we'll also create a user variable
here and we'll have a name property
which we fetch from PHP so obviously
when this index of PHP is rendered
we'll call the get username function
okay that's good so if we now reload the
page looks like we've got an error I
should really turn our reporting on but
I can see not
I've included function dot php' rotten
functions I know that because I do that
quite a lot so when I reload that okay
we are loading or subscribing let's make
sure that there's a user object and it
has a value of guests now if I add a
user fill when we load the page type
user okay so we now have a user name
available to the client so we can now
start triggering events when the user
types so if we jump into our JavaScript
and we've got the jQuery callback here
what we want to do is we want to bind to
the key up event
we'll call user typing let's find out
the ID of the element that we want to
bind to so yeah we've got user message
here so whenever the key op occurs there
we've got user typing function you can't
use it typing and let's just Bob for now
see how that works out okay so we can
see that that's being called now if you
think about it if we send the client
event every time the user presses it or
the key comes up then that could be a
lot of clients being triggered now we
restrict client events to ten per second
for a client we believe that ten is
enough we have the ability to increase
that for certain customers if required
but in this case we obviously only
really want to send when the user starts
typing when the use of stopped typing so
what we need to do is in the code we now
know when the users typing so what we
want to do is the user presses our key
we send an event to say the users typing
if user presses a key again we don't
know send another event so we need
something to say the user is still
typing we also want to go the use of
stop typing so if the user hasn't
pressed the key for a number of seconds
then we want to trigger event to say the
user hasn't isn't typing anymore so what
we'll do is we use a timeout we'll have
typing timeout and
so if the timeout isn't in operation we
can then trigger an event which is
client typing saying
typing true and we'll also send the
username say who's typing between those
user name okay so we haven't triggered
the time out yet so we've also got ously
gun else the the user is still typing
then we want to clear the time out
because the user is still typing and we
also do typing time out equals null and
then obviously we really do need the
window dot set time out
and in there we want to do is if this is
triggered it means the user isn't typing
anymore we'll do say three seconds we'll
do channel trigger kind typing it's
obvious this the same user I'll do
typing true sorry false cuz he isn't
typing okay and then we also want to
know down that tapping timeout because
we check it above okay so let's jump
into here where you load the page to get
the new script so we can see down there
we're getting client typing typing it
was true we waited for three seconds we
have typing it's now false so over here
you'll see where we received the
messages the next thing to do is
obviously display that information so we
want somewhere to display some activity
so we'll add that just under here
now you could obviously have multiple
users typing but for the moment we'll
just have this activity element so we've
seen triggering the events the next
thing is you want to see handling those
client events so we know it's typing
will will handle the typing and they
could do this online again I like to do
it so that they're available you can
potentially write some functions it
could expose that function and test them
some data now what we want to do is
update that activity to say
just typing so data typing now the
obvious problem here is I'm assuming
there's just one user you'd probably
have a look up if user names to say
who's typing here isn't but for the
moment I'm just going to I'm just going
to clear it and we'll look at changing
that a bit later so let's refresh on
both sides and they both get updated
well I guess I'm felt so you'll say for
this typing there we're getting the
event there that when I stop typing
and it disappears this user will make
this user mr. right
that needs to be user so mr. right is
typing okay so we've got this user is
typing functionality so there's other
things you can do here I'm not gonna
demonstrate doing everything but the
other things you can do is you could
send information about the user has
entered text so when they stop typing
you can check whether there's a value
and send send yes the users errant it
has entered text but they're no longer
typing you also could do things about
lookups for users that are present and
and whether they're typing or not so in
the next video we're going to use
presence presence provides a way of
knowing who is subscribed so who is
online and that's obviously really
useful in kind of chat scenarios or in
social applications where you want to
know which of your friends are online so
that's the video covering client events
client events are good for really low
latency messaging between clients
there's obviously a security aspect to
think about can you trust the the event
that's been sent to you the client
events having to have a client - prefix
which means that when you receive them
in your code you're aware you need to
make sure that the data is allowable and
you're going to actually use it within
your application because that
information especially from JavaScript
some can open a JavaScript console and
trigger it so I hope that was useful and
in the next video we'll cover user
presence using presence channels</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>