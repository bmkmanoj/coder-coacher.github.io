<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Dot Net Sheff, A Piece of Cake: C Sharp Powered Cross Platform Build Automation, February 2018 | Coder Coacher - Coaching Coders</title><meta content="Dot Net Sheff, A Piece of Cake: C Sharp Powered Cross Platform Build Automation, February 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Dot Net Sheff, A Piece of Cake: C Sharp Powered Cross Platform Build Automation, February 2018</b></h2><h5 class="post__date">2018-02-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bOQLC2HXCzE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so let's get started the way I want to
start tonight is with a couple of quick
why are you referred to as disclaimers
the first one is I'm not from around
here
I'm from north of the border up in
Scotland and up and Scotland we tend to
speak a little bit differently for
example if I was to say you how were you
today I would probably say something
like fit like a day I point that out
because I've got a tendency to start
speaking like that under nervous
situations in front of people so if I
start speaking in any way that's not the
Queen's English feel free to put your
hand up and tell me to wine my neck and
as we might say up the road as well the
second what disclaimer I want to make is
that for anyone it knows me I'm a
windows guy through and through I've
always had a Windows PC I started a new
job last Monday which involves me
working for the chocolaty open-source
project for anyone is familiar with that
and I got given a new Mac to do that
development work on so last night when I
gave this presentation the London net
user group there was a couple of hitches
and it was down to me not really knowing
how to use the Mac so if anything
happens tonight where things brick I
would ask you to give me a little bit of
leniency and we'll move on after that
okay so what we are here to talk about
tonight is the open source project
called kick butt
what I want to do first of all is make
sure that we are all talking about the
same thing when it comes to what I refer
to as a build everyone kind of has their
own interpretation of what a build is
what steps are included within a build
and for the purposes of this talk I just
want to make sure that we're all talking
about the same thing so I talked about
this thing called the typical build
workflow the typical build workflow
starts in my mind I mean we're all net
developers here I'm assuming we have a
compilation step we need to take our
source code and we need to compile that
down into something whether it's an exe
whether it's a DLL whether it's of
whatever but we have that compilation
step that
that were happening within Visual Studio
and because we're working in Visual
Studio and we're working in and.net
ecosystem we're probably pulling in some
third-party dependencies from everyone's
favorite tool new get so we in in this
typical build workflow we have a package
restore step now again within Visual
Studio that kind of thing happens
implicitly for you if you open up a
solution you're going to get that you
get package restore is going to happen
in the background and then you're gonna
be able to do your build step without
any problems because we're all good
citizens and we know that we need unit
tests everyone's got unit tests in their
applications and as part of our typical
build workflow we want to run those unit
tests in order for those unit tests to
run in a repeatable way so that we get
the same consistent build results and
unit test results every time our typical
build workflow might include a clean
step so a clean step is literally
cleaning up your bin directory is
cleaning up any build artifact folders
you might create as part of the build so
every time you run the build you're
getting the same result again and again
and again okay because we want to look
at our application from a tire level and
we want to know how it's progressing our
thing is getting bare we might want to
incorporate things like test coverage so
you might use tools like ncover or open
cover to take the unit test results from
whatever unit test framework that you're
using pass them through a test coverage
utility and then you'll get a pretty
HTML report out that says my test
coverage is getting better it's getting
worse if you're anything like me and you
like to run your code through lots of
static analysis tools because you really
worried that there's an extra space at
the end of a line or the curly brackets
are in the wrong place you might use
tools like what are up there so you've
got style cop do you find our FX cop
inspect code there's some of the main
ones but again it's just this concept of
what is your typical build workflow and
this is the kind of exterior things you
might add in to your build workflow to
make sure that it's
doing what you wanted to do now having
done all of those things I've just
spoken about we don't actually get
anything back from from it until we
start packaging up we need to get to the
point where we are packaging up that
application we're starting to push it
out to our customers
once you what that's when you start
getting revenue in used to actually
start making money so the packaging step
and a typical build workflow might be to
generate an MSI for installation
purposes or it might be to wrap your
application into a new get package so
that you can push it out to you get org
whatever it is and then naturally from
that there's a publish step and that
publish tab is literally just taking
what you packaged up which you built and
you've unit tested and you've package
stored and pushing it somewhere putting
it onto an FTP server or whatever your
workflow is so hopefully there's nothing
too surprising in that typical build
workflow obviously your situation is
going to be different you're gonna have
slightly different steps but that's this
is what I'm kind of gonna refer to as
part of this talk and I'll be referring
back to it so hopefully that all makes
sense so the aim of this talk first of
all is to answer a couple of questions
and after I hopefully answer those
questions I'll move on to a demo of how
we can piece it all together so the
first obvious question is well what is
kick so I like to show that it's not
this so anyone who came here expecting
to actual kick should have come to the
Oxford net user group because they
actually did have kick and you got to
eat it but there's none here so you're
not getting any kick that was pizza so
that's an next close second what we are
going to talk about instead is this cake
so cake is an open source project it's
on github comm under an MIT license so
it'd encourage you to go and check out
the source code it was started by a
Swedish guy called Patrik Svendsen back
in 2014
Patrick was and still kind of is a build
engineer he sat in raw msbuild scripts
all day long and he got bored of it so
he didn't want to write a mess build
anymore
like XML anymore so he created this tool
called cake project was there shortly
joined after that by another Swedish guy
called Matthias Carlson and then I
joined the project in a tail in 2015 and
since then we've had two other
maintainer x' joined the team we've had
martin i always forget how to pronounce
a second name he's finished he's got
like we are like thing in his name I
don't have an answer so it's just Martin
and then there's our sir Chapman who's
from Australia so they've got a cork and
a contribution team and we like to think
that the project is in quite a good
place we've got hydro were like 900 pool
requests we fight over a million and
half downloads when you get to org so
we're in a reasonably good position we
know that a lot of people are using it
and we like to think that we're kind of
doing what people want in terms of their
build systems so I have an actually
answer what is cake yet really but from
our website cake is cross-platform build
automation system with a c-sharp DSL to
do things likewise walk about within
that typical build workflow moving on
from that what I want to talk about is
well how does cake actually work so for
the purposes of this talk cake is either
an exe or a DLL I'm not really going to
get into the the technical details of
what's going on there it's literally to
do with whether we're running on full
frame where it fold on that framework or
whether we're running or net core and
for the purposes of what we're going to
discuss today cake is essentially just
an executable that will be executed
somehow ok so that executable we can get
from lots of places we can get that
executable from you get from my get from
homebrew from chocolate from github
we've almost got some docker images
where you can run kik directly from a
docker image we're not quite there yet
but having got that cake cake executable
onto your machine what you can then do
is then you can pass in a series of
arguments or configuration parameters to
make cake execute in the way that you
want to do so what you're going to do
once you've got that set up and on your
machine
you're gonna create this thing we refer
to as a build up cake file that as a
file as long as it ends in dot cake you
can call wherever you want but into that
build up cake file you're going to write
C sharp and you're going to write C
sharp that takes all of those things I
spoke about in that typical build
workflow think of each of those blue
boxes as a task you're going to write
create your tasks and what cake is going
to do is it's going to look at all the
dependencies that you define with on
each of those tasks and it's going to
create this thing called directed a
cyclical graph which is just a really
fancy term for saying that for all the
tasks and all the dependencies make sure
that you run it in the order that was
dependency define it for and make sure
that you run that task only once so by
building up this directed a cyclical
graph you can control how the build
actually starts to begin to get
orchestrated okay on top of the c-sharp
that you're going to write into that
file which the the task definitions
we've got these things called
preprocessor directives I'm not really
going to go into these in too much
detail because we've often tangent and I
want to kind of keep the talk
constrained but what I will point out is
if we go back to that typical build
workflow where I said you might want to
run unit tests in order to run a unit
test you have to have an external tool
so let's say that you're using X you
know in order to run the X unit test
that you've got within your project you
need to use the X unit console runner so
within if you're doing if you're doing
that within Visual Studio you probably
got the X unit extension installed so
that we can just click a menu option and
run those unit tests when you're running
a build outside the visual studio you
have a requirement to go and grab that
tool so what cake provides is something
called we call their tools preprocessor
directive it's a mechanism to say a cake
I need this tool and where am I going to
get that from so the example of the X
you know console Runner that's available
and you get the org so you would just
create a tool preprocessor directive and
say go and grab me that X unit
controller and put it onto my machine
once cakes done that it's in a
well-known location and then you can use
that tool within your cake script and
we'll come onto that a little bit later
so what we're then going to do once
we've got those command-line arguments
we've got the build script we've got the
mayor tool people our shows directive
we're essentially going to hand that
over to Roslyn so Rosalyn is Microsoft's
compilation engine and it's going to
compile that script it's going to
compile it into something then be
executed that execution will then then
happen so I'll run through all the tasks
in order and if for whatever reason
there's a syntax error within your cake
script you're actually going to get a
compilation error so it's actually not
going to compile that script so you're
going to get just similar results that
you get in Visual Studio if you had a
syntax error within your code that
you're writing so once that executions
happened the IP of that execution can
literally be whatever you want
it can be the creation of a new get
package it can be the creation of an exe
or an MSI it can be handing over to
octopus deploy to do a release it can be
pushing up to Azure it can literally be
anything it is at the end of the day
cake is just really just an
orchestration tool that's written in
c-sharp
so anything that you can do in c-sharp
you can do with a neck ache script and
if you need to there are examples of
people deploying and running things on
Arduino and all sorts of weird and
wonderful things so it's literally
whatever you can run c-sharp you can do
whatever you want with cake okay I
normally like to stop there and just ask
if all that makes sense before we move
forward anybody got any questions on
what I've said so far
if not we'll play one okay so I spoke
earlier that cake has this concept of
tools so one of the common questions is
well what tools can I use the kick so I
like to show this it's slightly out we
date now but the ones that are in black
are all the tools that come out with a
box within cake so as soon as you get
that kick executable straight away
you're going to be able to run things
like get linked you're going to read and
run get version msbuild xunit and
you know all the ones that are in blue
and there's actually more of them now
those are ones that have been
contributed by our community members
within within cake so with there's quite
a lot of contributors to the cake
project I with the core team and they've
looked at tools that they utilize within
their build system and they've created
these things that we refer to as add-ins
that bring those tools into the cake
ecosystem that's actually what I started
with a cake project I am also a
contributor well I worked for
chocolately but I was a contributor to a
chocolate prior to that and I know if
that chocolate it wasn't part of cake so
I couldn't create a chocolaty package as
part of my cake execution so I first of
all created as a third party I then and
then it would pulled into cake proper so
what we like to say is that if there's
not a tool that you use in cake already
it's quite a simple process to go ahead
and get that added in and there's now
over 200 third-party tools for cake so
pretty much everything is covered now we
get the odd one here and they're
cropping up but typically the main ones
that you want to run as part of your
build are already within cake so the
other question that I like to address is
okay I get what you're saying but why do
I actually need cake what do i what
what's the benefit that I get from cake
so the scenario right the describe here
is that if you are a standalone
developer or you're you're in a team but
there's one guy who always does the
build and he does it on his machine he
does it on his copy of Visual Studio he
does the right-click build he does the
right-click unit tests he does the right
click publish to web site whatever
you've you've got your in your adding
and what we refer to as the bus factor
into there if there's one guy who does
that build that he knows how we do it if
that proverbial bus comes along and
knocks him over then your build process
is shot so what we need to strive for is
mechanism whatever however it is we need
our mechanism to make that build
repeatable maintainable and reliable
across the entire team and better
yeah if we can take that build and move
off onto a continuous integration server
then all the better because we're then
in a position where we can run that
build whatever we need to without
relying on that one person or that one
machine that's got the right version of
the SDK or the right tools installed if
you bring that all into a cake script
and that cake script becomes a version
control artifact within your repository
then you can look at the history you can
see what's changed and so on so what
we're going to move towards that end
goal so what I like to show there is we
can a dog food cake we build kick with
kick obviously and we build it on nine
different CI servers on three different
platforms so you might think that that's
a little bit excessive and it probably
is but I would encourage you to go and
meet Matthias Matthias loves continuous
integration and he loves to have it all
set up so he went ahead and created our
system that we have building or every
commit and every pull request goes
through all of these servers now there
is actually a good reason for it and the
reason that I like I normally speak
about here is that tools like X unit
actually behave differently if they're
running on a CI server X unit will
actually detect that it's running on say
team say and it will use team city
service messaging to write the unit test
results out to a different location than
it would otherwise it was running on
another CI server so because we tap into
team city as part of cake we need to
make sure that we're not doing anything
that would inadvertently break things
like X unit so we do like to run it on
multiple CI servers just to make sure
that we haven't introduced any
regressions or any backward
incompatibilities the eagle-eyed amongst
you will probably notice that we had a
couple of build errors I'm happy to say
it wasn't really our fault but it does
highlight that no one's infallible
Travis was just having a really really
bad day where it didn't like new get Exe
and the
package restore was essentially feeling
as part of the build but the takeaway
from this is that in order to build kick
with kick we have a single build kick
file and we just put that into all of
those CI systems as a single step within
each of those CI systems and we can run
that build on another environment we
don't have to go through the the
configuration that you need to do within
say a team city to create multiple build
steps and have multiple build
configurations it's one build one build
task within that CI system and it's just
running that cake file okay so the other
question that normally comes up is well
this is great but there are other build
systems out there so why can't I just
use fake or why can't I just use make or
why can't I just use seam ik you see
where the names are coming from why we
chose cake yeah
or why can't we just use msbuild or why
can't we just use Nant or sake or bio or
some other in-house built build system
so what I say that is go for it right
the main takeaway from this is that you
want a repeatable build that is
maintainable and reliable whatever you
want to create it in you go for it right
I'm not going to stand here and tell you
you have to use cake I would prefer that
you use cake because it's the project I
work on obviously but if you want to use
fake or make then go for it well I do
say though in this is the reason I
started using cake I used to be the
maintainer of the sake project which for
the those you don't know sake is the
PowerShell build automation framework so
it allows you to do exactly what I've
just arrived with cake but you write it
in PowerShell the problem with that was
that I was the one person on the team
who knew how to write PowerShell
therefore I was the one person on the
team who knew how to rate the build
script and therefore when the build
failed it was me that had to fix it so
that's not a great position to be in
because that is the bus factor all over
again
so the argument that I use is that if
I'm developing in c-sharp all day long
for writing a web app for right now
windows form application
whatever it is you're doing - I can then
avoid the mental mind switch to having
to go to another language to write the
belt and to maintain the build so what I
do like to say is if you're writing
f-sharp then you fake to do your build
script if you're you writing a
PowerShell application then use Sachi
because then you avoid that mental mind
switch I have heard people say that
using I'll pick on fake a little bit I
don't mean - could I do like fake a good
way of learning f-sharp is to use it to
write the build script and that's fine
until the builds broken and you really
really need to fix it that's not when
you need to be learning f-sharp in my
opinion but I know there are those in
the audience like John that might argue
with me but that's ok let's all just be
friends and I would I say use what you
want ok so what we're going to try to do
is we're gonna try and create a build
script in kick and we're going to take
that typical build workflow that I spoke
of it before we're not going to do
everything we're gonna have time for do
everything but what we are going to try
and do is take four of those tasks and
we're going to write them into a cake
script have that cakes with executed to
see how it's all piecing together and
have something that's built at the end
of the day if you are interested and
fall in the long afterwards you can find
all the source code and the slides on
that link there it's just a github repo
like the previous presenter I will send
this out or calf consent it links to
everything later on so what's that I'm
going to switch to the demos I've got my
machine set up in a and offline mode so
rather than calling out to new ghetto or
to resolve the packages that I'm going
to be using I've got a nexus repository
which is just a local version of Newgate
essentially and I've modified some of
the cake files to allow that to function
in an offline capacity when you are
falling along at home if you are
interested in following along the
commands I'm going to run in the things
I'm going to do
exactly the same as you were gonna do
them it's just that I've tinkered with
them a little bit but I just want to
point that out just so there's no
concept of smoking mirrors going on the
other part of the demo that I'm gonna do
is all of the demos are done in Visual
Studio code we as the cake team ship a
couple of extensions one for Visual
Studio code and one for visual studio to
make cake or bring some of the cake
concepts the cake functionality into
those IDE s the reason I show in Visual
Studio code is because Visual Studio
code is just easier to write an
extension for if anyone's had the
privilege of writing a Visual Studio
extension it's a little bit hard so some
of the functionality that we create for
Visual Studio code doesn't yet exist in
Visual Studio
therefore I show everything in Visual
Studio code so most of the things I'm
going to show you can do in the visit
way to kind of do in Visual Studio but
the kind of the best way it works it
would be in Visual Studio code okay so
with that in mind we need to start
somewhere so what we've got here is the
literally the most amazing website that
you've ever seen
it's the output of dotnet new at the
command line so it's there very little
actually in the website itself it's just
the raw template that comes from that
starter project that Microsoft provides
the what we're building isn't actually
really the important part obviously we
just want to build it and see how that
cake syrup can be created so what we
need to start with is we've got the
source code here we need to get cake
downloaded onto this machine in order
for cake to execute okay
now the way that we do that is we do
that through a concept we refer to as a
bootstrapper file so we have a
bootstrapper file for both windows and
for mac and linux there's some
controversy with regard to the
bootstrappers and whether they do too
much or they do too little or whether
they should be done differently and
that's a big discussion that we're not
going to get into
today but bottom line is that bootstrap
or file is there to serve one purpose
which is really to set to get the cake
executable downloaded onto your machine
and make it ready for execution what we
do like to say is that those bootstrap
profiles can be modified so if you need
to do something specifically with your
environment to do something in addition
to what we provide go ahead and do it
we're not going to try and make the
bootstrap or kit for every single
eventualities we're going to give you
something that works in there
90% of the time and if you need to
modify it go ahead and modify them okay
so the way that we can get that
bootstrap or file into our system is
through some of the functionality that
we provide into visual studio code so we
provide a number of commands that are
available to us from the command power
one of which is to install a
bootstrapper so if I select the to
install a bootstrapper I'm gonna get the
option to either download the powershell
bootstrapper or the the bash one so
because I'm gonna I'm gonna Mac I'm
going to go ahead and build or grab the
bash dog SH file so in there you're
gonna see lots and lots of stuff again
we're not that's not really important so
we're gonna spend time looking at it but
the end result of that script is cake
dough eh C is going to be downloaded
onto the filesystem and it's ready for
execution there's a few other things if
you're interested I would encourage you
one look at okay so now that we've got a
bootstrapper which is going to grab the
cake door executable we need a build
script so if we go ahead and create a
build cake file here and obviously the
most important part of any extension is
that we've got the icon in there so
that's the cake icon so that was the
first thing that the extension did now
that we've got a build up cake file in
there if we actually try and run our
build so we go ahead down here that's
other thing I'm using the built in
terminal then Visual Studio code it's
just because easier to show everything
together obviously you could do this
from wherever shell you want to use if I
go ahead and run that build or Sh file
and I show over here in the tools folder
currently there's nothing in there apart
from this thing that we call the
packages dot convict file the packages
dog company file is a way to pinned to a
specific version of cake so
we as the cake team try really really
hard not to introduce any backward
breaking changes when we release a new
version of cake but it does happen from
time to time what we say is if you
create that package that config file and
add that into your source control
repository and you will always get the
same version of cake when you run the
build so if we do introduce a backward
and a non backward compatible breaking
change that your bills are still going
to work so they're still gonna be
reliable they're still gonna be
repeatable
because you pin to a specific version so
if I run that build or SH file and we
look at that tools folder what we'll see
is it's gone off the bootstrappers gone
off its grabbed all those things that we
needed and it's put them into that tool
folder so the tools folder is where cake
puts everything by default but because
we've got nothing in our build cake file
it hasn't actually done anything we
haven't actually achieved anything
because we're in anything into our cake
script so what we can do instead and
this is the other thing I need to admit
I type really really badly when I'm
trying to talk and there's a bunch of
people watching me so I've got some
snippets within Visual Studio code that
saves me having to type everything out
so I apologize if that annoys anybody
but it's better than watching me try and
do it live so what we need in by in the
first instance is we need kind of the
the main things in the cake file so if
you refer back to that directed a
cyclical graph that I spoke about before
we need an entry point for our build we
need to say where we want that bill to
start and where what what's the default
task that needs to happen so that's
typically done by passing in on line 11
here and the name of a target that you
want an Atari or a task that you want to
execute so on line 11 I'm saying there
run me the target that is contained
within the available called target and
in there I'm accepting a command line
argument called target and we would give
it a name so by if we don't pass in a
command line argument called target it
will default to default
so what's going to happen within here is
the default task is going to be executed
the default task has a dependency ie is
dependent on dotnet core package restore
and the dotnet package restore step up
here in a minute does nothing so again
we haven't really progressed that much
further I go ahead and save that so but
if I do run that build that Sh file what
we're going to see in the output down at
the bottom here is that it's actually
gone ahead and it's run that dotnet core
package restore step there's nothing in
that task so again it doesn't do
anything but we're starting to see how
that directed acyclic or graph is
starting to be built up and during the
execution okay but if we go up to this
task and we see actually let put
something in there so that something is
going to be this so that dotnet core
restore is what we refer to as an alias
within cake all of the tools and add-ons
that we have create these things called
aliases and that's really the c-sharp
DSL that I spoke about in one of the
earlier slides we're adding methods that
can be executed or put into your cake
script that are then typesafe in a way
so rather than you having to know that
the tool that you're calling in this
case which is the dotnet CLI rather than
having to know that it's dotnet restore
passing in the path to the solution file
and then some arbitrary command line
parameters for that function that you're
trying to call you don't worry about
that because it's all available in that
class that you can get access to and it
has properties and you can set those
properties so what I'm saying here is go
ahead and run the dotnet core restore
alias which is running dotnet CLI with
the restore command pass in the location
of the project that I want to restore in
this case it's the one that's in my
source folder and so that I can ensure
something happening let's use local
packages folder as the packages
directory rather than the global one
that would be used by default so if I go
ahead
and save that and if I expand this
source folder we'll see just now that
there's not a packages for their local
to that source water if I go ahead and
run that build what we should see is
that a packages folder will be created
and into that packages folder we will
have all of the new get dependencies
that my project my web application
requires okay so there's no real smoke
and mirrors going on here what we've
done here at the command line
essentially is what would happen for you
automatically if you open this project
in Visual Studio code or visual studio
that you get pack of the Store step it's
going to happen in the background for
you automatically but because we said we
were trying to move away from it working
on one person's machine or within one
person IDE and we wanted to run anywhere
we have to take ownership of all on all
those things that happen automatically
and we need to bring that into our build
ok so where the repeatable essence comes
into it if I go ahead and for some
reason I delete that packages folder and
I run my build again it's gonna do the
same thing again and again again so I'm
kind of laboring the point a little bit
but the important part is that we're
creating something that is repeatable
and it will happen the same each and
every time we run the build ok the other
part of that is obviously with that
packages folder there if I do run the
build again it will attempt the restore
but because those packages are already
there it'll just zip through it doesn't
even do it again ok making sense so far
beautiful ok so if you cash your minds
back to what we're trying to achieve
we've now done a new get package to
store essentially so what we need to do
now is we need to do a compilation step
so we need to take that asp.net MVC
website and we need to actually compile
it we need to get some output so if we
look and if we look just now in the bin
folder there is actually something there
and something during the man you get
package the store actually creates that
folder I'm not actually sure what to
doing on there but I'm just going to
delete it just to prove out so if we go
down here
and we go a second demo so this second
demo is using another alias that comes
in with cake which is just the dotnet
core build so again all we're doing here
is we are orchestrating the dotnet CLI
and this time around we're running the
build command and it really only needs
one parameter which is the location of
the project file that we actually want
to build so if we go ahead and make one
other slight change so right now what I
said before was that the default task
which is the default entry point it
currently has a dependency on the.net
core package restore step so we need to
change that slightly because what we
want now is we want the build task to be
the one that's run first because it has
a dependency on the new get back at the
store so what I need to do if I go down
to this one and change this to be build
and what will happen is it'll go to that
default entry point it will run the
build or I'll run then you get packaged
the store first then it'll run the build
so over here now we've got the debug
output which is the compiled DLL they're
all the things that need to be built as
that the artifacts of that project okay
so just to labor the point slightly just
to show how that works
if I were down here and I specify target
equals well that's gonna be a long line
typo let's do it thought their core
package type that right so if I do that
and what's going to happen at this point
is I've changed that entry point so I'm
only going to run then you get packages
stored at this point rather than the
build and then you get packaged the
store so depending on how you're
creating the build script or what area
of the build you're actually working on
at any point in time you might want to
change the entry point so the build can
actually do different things at
different times so that's just the way
that you would do that
okay however if we cast our minds back
to when we're in Visual Studio and we're
doing a build then one of the drop-down
lists you have at the top is to specify
whether you do
bug build or whether you're doing a
release build so again we need we want
the ability to control what
configuration our build we're running at
any given time so if I take that dotnet
core build alias over there and I put in
a slightly more complicated one it
includes some additional settings so
again this is the settings class that we
use before within our new a package of
store I can pass in a configuration
value to that saying so I can control
what kind of build them actually
executing so if I go and go up to the
top here
and add in another parameter what we're
now saying is I'm gonna put I'm going to
potentially create a configuration
parameter that allows me to control what
kind of build them and I'm doing any
point in time so just to prove that out
I'm gonna go ahead and delete that bit
and fold it again and if I come down
here mmm
it's not actually why what to do so well
let finish so if I go down here delete
that and say configuration equals debug
then that's going to be the same as what
we're doing before because the default
configuration is debug but what we'll
see here in the output in the bin folder
is that we've now got a debug release
and if we go over here and we change
that to be release then in addition to
the debug folder with vengo our release
folder so again it's just a way to
control the orchestration of the build
and see how those things are piecing
together ok now now that we've got the
new get back to the store happening
we've got to build happening what we
spoke about is the concept of doing a
publish so we need to take the thing
that we've created we need to put it
somewhere so in your environments that
might be to deploy to a sure it might be
the local website that's hosted
somewhere in this scenario I'm just
going to publish to a another folder on
my file system so we're going to take
that thing I'm going to publish it into
another folder and that's the easy
option but it's the one it
demos quite well so if I go down here
and add in another task that says the
publish step so in the publish step
again we're just using another alias for
dotnet core which is the dominant or
publish step it also accepts a set of
settings again we're passing in that
configuration option and the other thing
that I'm setting here is the output
directory so where do you want that
output of that publish to go to so in
here I'm just adding it into the build
artifacts folder so I save that and I
remember that I actually want to change
my default tasket in to be published and
save that then what we should go back to
the default there we go over here at the
top we should then get a build artifact
folder and that build artifacts folder
once it gets created it's between to
publish step now now we get he says
there we go
now we've got a build artifact folder so
that build artifact folder has the
compiled dll it has the CSS files it has
the HTML file all the things that are
that website meaning I could take the
contents of that file put them onto an
eye a server somewhere and it that
website would run and that's that's
really that demo completed however the
thing I like to point out here is that
we've spoken before about having a
maintainable repeatable and reliable
build it was sort of happenstance that
that out poof although that build
artifact folder got created for us it
got created for us because they don't
net CLI based on the parameter that we
passed then happen to create for us that
doesn't always happen I pick on X you
know a little bit here but if you
specify to the X unit console runner
that you want that output report file
generated and you wanted to put into
this location X unit console runner
doesn't actually create that folder for
you so the build will actually fail so
again in terms of taking ownership of
the build and making sure that
everything's working correctly the way
you want it to what you should do is
part your
is to create that folder so it's a
little bit of the duplicity I was gonna
say in this particular scenario because
it's not a requirement it happens to
work but again in terms of being a good
citizen you should create that so the
way that we can good do that is with
another alias that cups with kik so we
go here at demo 4 so what we're gonna
use here is the clean directory alias so
what it's going to do is it's going to
make sure of two things it's going to
make sure that the directory that you
specified or multiple directories if you
use one of the other releases it's going
to make sure that that file folder
exists and it's also going to make sure
that that folder is empty so again in
terms of being repeatable it's going to
make sure that all the artifacts is that
previous build are cleared out and it's
only the output of this new build that
we're running let's get in to an end
there so to make that work rid of that
what I need to do is I need to chain
another dependency on to this publish
step because I've said that this publish
step now has two dependencies as a
dependency on the build and it has a
dependency on the clean task so if I
save that and I'm gonna expand that
folder and I'm gonna run it again what
we should see happen is part of the
build is that that build artifacts
folder is going to get cleared out and
there's going to be a tree populated by
the publish step so again it's not real
there's no magic happening here it's
literally all the things that you would
either need to do manually or is kind of
done implicitly for you you're taking a
explicit decision to make that happen as
part of your build okay all of that
making sense so far good okay so in
terms of what we said we're going to
show I said I was going to show then you
get package restore I'm gonna show the
bill then it's going to show the
publishing and the cleaning so in terms
of demo content for my build up cake
file it's now doing everything that I
hope to do so the demo gods were
polite and that load that to work
correctly what I'm going to show now is
two of the most requested features for
kick that are now available within the
current version of kick the first one is
the ability to debug your cake script so
one of the advantages of cake is that
you're running on it so you're running
on a CI server you can run the same
build locally as you would in your CI
server so that means that you can run
the build locally and then if that build
feels locally then there's a strong
chance it's not going to build on the CI
server that's one of the benefits of
doing using something like cake um
however when you're when you are
building that cake file and you're
you're adding new steps to or you're
trying to figure out why something isn't
working it's it's useful to be able to
debug the script and because it is just
C sharp it is possible to debug that
script and I do say that with a small
caveat and that if you are wholly
reliant on the debugging functionality
then you're sort of doing something
wrong because you can't debug it once it
goes on your CI server so you need to
make sure that you've got an adequate
level of logging and metrics so that you
can debug a failing build on the CI
server and what that looks like in cake
for example is we have the information
alias that allows you to write out
random pieces of information into the
log so you can see what's going on and
obviously the tools that you're
executing are actually gonna add stuff
into the log as well so debugging is
great but I say I want to make sure that
we're using it wisely but what that
looks like if I set a breakpoint down
here
so then Visual Studio code I can
literally I'll put it down here and
actually I can set a break point so that
break point is there and as soon as I
hit f5 which is the standard keyboard
shortcut in Visual Studio code to
actually initiate a debugging session
what's going to happen is that that
break point is going to be hit he says
there we go right so we've got a break
point we've had that rate point so what
that allows us to do now is within that
settings class
that settings class we can now see what
the configuration value is anisette do
it's been set to release because what
the default value is but now that we're
in this debugging window we have access
to the watch window we have access to
breakpoints we can do all the things
that we can do normally but in the
context of our build script so if we
want to step through our build it isn't
working we can do that just with the
standard keyboard shortcuts of f10 and
what you'll see at the bottom and the
terminal window it's actually the build
is still progressing but it allows you
to debug it okay now the reason that
that just worked on my machine was
because I've got this thing called the
launch dot JSON file the launch thought
JSON file controls how you orchestrate
some of the functions within Visual
Studio code in this example what I'm
doing is I am using mono
to be the runtime for the 4k qxe so when
I start the debug session it started up
mono executed kicked or exe and then it
did all the standard stuff that I spoke
about in that workflow the reason I'm
using mono is obviously I'm on a Mac so
I don't have done that framework there
but the other way that you can run cake
is with the.net core runtime rather than
with mono so the way that that looks is
in the kick extension there's a second
entry that you can add into the launch
legit on file which is this debug script
core CLR so if I click on that and get
rid of the first one which was up here
we can now do the same debugging feature
but this time we're going to use dotnet
core now if I run if I go ahead and back
to my build up kick file I've still got
my breakpoint if I hit f5 and debug it's
not going to work very well and it's got
an error and it's going to say well yeah
launch program yada yada yada doesn't
work and the reason that that happens is
because I don't have the cake core CLR
available
my machine just now so I refer back to
our life type when I said that cake
dough yes you can either the cake
executable can either be a cake exe or
it can be a cake DLL so the cake that
DLL is our dotnet core version of cake
so we compiled twice we compiled cake
twice we've got a full 5 full fat
framework cake and we have a dotnet core
version of cake so I don't have that
locally on my machine so within my
launch dot JSON file I'm specifying that
I want to run that cake Doyle DLL I
don't have it so the way that you can
get that is if you go back to some of
the commands that we provide within
Visual Studio code then there's this one
it says install debug dependencies if I
go ahead and click on that one what
we'll get in our tools folder is the
cake core CLR NuGet package restored in
the tools folder so now if I go ahead
and run f5 we should initiate the dotnet
core runtime they'll pass off the cake
cake will be executed I'll compile the
script and what we'll get is that
breakpoint being hit so depending on
what environment you're running in you
need to control that entry point and how
you're running cake and the reason
that's important is because some of the
third-party add-ons that we have some of
the that 230 items that we have they
don't compile that add-in for both full
framework and for dotnet core so
depending on what add-ins you are
pulling in from a debug point of view
you might have to use one or the other
but you have the option of using both ok
so again under the donut core runtime
we've got that same debug functionality
that you'd normally expect
ok so that was really a that was one of
the bigger features that was always been
requested I gave this I gave a similar
talk to that a couple years ago in DC
and everyone was asking well why can't I
just do bug it so we finally got around
to adding that in the other one that was
a common request was ok it's just
c-sharp and I'm in an IDE why can't I
get intellisense why can't I have
the same intellisense I get when I'm
writing my web application because it's
just too sharp there are some
complexities around that because it is
just c-sharp but obviously during the
compilation step that we do we are
adding in or we're allowing the addition
of those higher-level DSL aliases that I
spoke about so it's not just a straight
it's not just a straight and direct
implementation of c-sharp so there's
some caveats to them but what we do have
now if I go and just start writing
something like information then Visual
Studio code at the minute is telling me
or is it's making a suggestion it's just
something that I can add in there it's
doing that because I've got an
information elsewhere in this file so
there's no there's not any smarts just
now all it's saying is you've written
information before is this what you
would yes so that's not intellisense
however if I go ahead and run another of
those cake commands and the cake command
I'm going to point out here is the one
that says install intellisense support
what that's going to bring down into our
tools folder is this thing that we
lovingly call the cake bakery because
why not right
yes we've got a bit of a pun going on
there but it's great so we've got the
cake of bakery so what cake your bakery
is going to do is it's going to be the
interface between cake and this thing
called omni sharp so you might be
familiar with so on the sharp is a
service that is installed on lots of the
text editors so sublime and Visual
Studio code and it sits there and allows
understanding and it's the thing that
adds the intellisense but what k-dog
Bakery is doing is it's it's handling
the smarts and handing off between the
DSL that we create and c-sharp so the
one caveat that you have to watch is
that as of right now having installed
cake bakery into this project I actually
need to force a restart of the only
starch on the chart server so I'm gonna
do is just restart that on the sharp
server
so now what I'll get it's a very good
into this line again and start breaking
information and I spell it correctly
then well now gay is now I've got
intellisense now I've got information
about the alias that's available with
that name so if I go ahead and finish
taping that out well get of obviously
then other overlords are available for
it it's the standard functionality that
you expect from intellisense so for the
information
alias that's not doesn't give me a lot
because I'm not a lot to it but what it
does give me now is that right now I've
got a compilation error
I'm missing my semi-cool and the
important semicolon end of that line I'm
now getting that regs quote red
squiggles with an IDE to tell me that
that scripts broken so I can see it
straight away rather than trying to
execute the build and having an error
come up when I actually try and run cake
so you're getting that functionality now
through on the sharp so something like
in information alias it doesn't man
really prove that much out but down here
if I were to bring up intellisense then
I can see all of that information that's
available to me to say what parameters I
can pass into that alias now what I do
say and what I do encourage is I can
find it on the cake website there is
documentation we do have documentation
so I would encourage you to use that
documentation and not just rely on
intellisense but obviously now that
we've got intellisense there is
something is very useful to have in the
IDE to make writing of that cake scripts
that not that easier okay so with that
that is kind of everything that I wanted
to show so are there any questions about
anything related with cake no okay
anyone using cake already a few I know
at least one okay hopefully I've shown
you some stuff that I've interest and
I'll encourage you to go and look at it
if you are interested then there's a
bunch of resources available we've done
some podcasts we've done some videos so
on they're all available really just off
the cake website but there's some direct
links there and with that I'm done so
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>