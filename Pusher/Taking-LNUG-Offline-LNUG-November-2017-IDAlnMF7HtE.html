<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Taking LNUG Offline - LNUG - November 2017 | Coder Coacher - Coaching Coders</title><meta content="Taking LNUG Offline - LNUG - November 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Pusher/">Pusher</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Taking LNUG Offline - LNUG - November 2017</b></h2><h5 class="post__date">2018-03-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IDAlnMF7HtE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">they'll nog website and how we got it
working offline if you want to find me
on get or if on github or if you want to
find me on Twitter it's it's live in
McManus and the Ellen OGG website can be
found at HTTP org how many people have
used the owner website before that's
good we've got a few users that's good
to see
how many used it this month to find out
about this event a few a few a few so
we've got some users the works not going
to waste that's good tonight
so just to cover a few of the basics
around how the the ellen OGG web sites
works to start off with in fact what
I'll do before that is I'll show you the
owner website just for those that
haven't seen it before so it's quite a
simple site static I can move that if
you want we're not actually sharing
screen on talking in I was close it okay
right we'll just pretend that didn't
happen
um okay so here's the website quite
simple we've got the the next event date
the venue for the next event link to the
free tickets map on the background and
the link of the list of talks that are
happening at this event
now those talks get managed through
github so we've got a repo and it's not
yeah is this one he'll knock slash
speakers and if you want to submit a
talk you create an issue one here
there's a there's a template and things
like that we submit the issue someone
for me on our team will be in contact
with you talk about the idea to try and
help you improve it things like that but
often it well it'll become accepted and
scheduled and it will get this we've got
these labels and tags so when it's
accepting than scheduled and it's got a
date that it's going to be that you've
agreed to do the talk on that will get
pulled into the website from there so
that's just to cover where the data come
from really and when I first started
doing the own our website there was
various different markdown files all
over the place and we kind of wanted to
bring them all together so they were
seeing in a website so one thing it does
is it fetches various different markdown
files and brings them into the site it
used to do a lot more it's only doing
two now so the contact page for example
is in a separate repo and that just
means people can make pull request to
that as and when they need to so it's
just aggregating the content essentially
in terms of the actual site probably
gets updated a couple of times
month where this interest becomes
interesting is when you think about
cache invalidation and the fact that you
you want to invalidate the cache quite
often but we'll talk about that as we go
on I wouldn't be mobile friendly and
fast just performant as everything we
build should be performing in fast
there's no reason not to make it that
way
slightly so officially I wanted it to be
reusable so the things that I'm doing
for the Ellen oxide I also wanted to use
them on the enhance comp and enhance
comm site and on my own personal ami
McManus comm site and some other sites
that I've been thinking about doing so
there was a reusable element that I
wanted to bring in there and this last
one is mostly a preference but it kind
of falls under the performance stuff as
well so always try and do things at
Build time you can do a build time you
can do a run time or you can do it in
the browser if you can do a build time
you do it once and it's the quickest way
because you're generating static files
you don't have to do anything at run
time it's just static files you're
serving and in the browser you're not
giving any extra work so wherever
possible trying to do things at build
time we are doing client-side rendering
there is things happening client-side as
well that we always try and put all the
work at build time so if you want to
have a look at the website if you want
to run it locally if you want to try
make changes to it just need to clone
the repository CD into the folder we've
got a build command so it's a static
site it's currently hosted on github
pages the build command what that does
is it takes all the source which is in
the root of the directory and put it
into a Doc's folder and github pages
serves it from there
the thing that I don't like about the
current set up is that you're putting
your source code into github but you're
also putting the what's generated from
that source code so they're generated
output is also getting committed to get
this is one of the main things that
makes me tempted to move off github
pages and use something like neckla fly
because you can you can run the build
command on the in this CI effectively so
you just pitch the source the github
hooks will pick up that run the build
and then then the slightly comes alive
so you're never committing the generated
output with an XY set up but we're not
doing that yet that's not good lots to
do in the future once you've run the
build commands you to run start so this
is just a local development environment
it's not really for production as
is using github pages for that we've got
watch command as well which will just
tell you if anything is changing there's
a general rule when I look at any new
node project I try not get a package
like JSON file it's a nice place to
understand what you can see the
dependencies for one but the script
object is a nice way to see what
functions you've got available what
commands you have that you can use so
I'm not going to talk to you order them
now you can go and have a look at them
yourself if you're interested if there's
any command you want to know more about
you can you can look at the JavaScript
code and you can see how it works but
the point here is if you if you're
wondering how something works this is a
really good starting point so if you
want to see the how the service worker
works you can see there's a command
there if you want to see how we generate
the maps is a generate map commands
interesting love I've write I made it so
that it's completely configurable where
the venue is so that map can change to
any place it just points at files which
have got a long and latitude ever since
I made that functionality we've been in
this one venue so I've never got to use
it so is it yes I'm kind of hoping that
we change venue at some point just so he
gets used but yeah we've got photos we
got a gallery on there as well but I'll
let you I'll let you have a look at that
in your own time the other the other
useful thing to know here is if you want
to know what scripts are available and
you don't want to look at the
package.json file you can just type NPM
run it applies to any any file the
package.json file in there any folder
sorry you type NPM run it will list the
scripts scripts that you've got
available to
so the very first talk that I did at own
ugh
I checked the date today with 2012
sounds a little while ago and it was
about Sicily so at the time I was a
client-side developer I was working on
the the Volkswagen car configurator just
to give it in perspective of things we
had back Bo and then but it was quite a
new thing so we were building our own
custom MVC framework from scratch
effectively at the time then we were
doing some nice patterns at the time
jQuery was the thing you had jQuery in
your in your apps at the time and using
the sizzle selector engine we were doing
some interesting patterns client-side
none of this was server-side because
Java on the back end it was just
client-side and as always experimenting
with node I wanted to see if we could
take those same patterns and use them
server-side and what I ended up with was
this so again this is all happening just
server-side you've got a render function
you pass it some markup and an object in
this particular object we're saying find
H to update the inner HTML with this
string which is this late example and
then this example find a div and then
change the class name to have bacon so
the output but you can see here so it
was it was quite simple but it was a
nice experiment one of the nice things
was when I turned up to be my talk
Andrew Nesbitt had actually rewritten
the Onaga site using his late so it was
it was already using it that was at
runtime so runtime it was doing the
rendering now I was keen to carry on
with this and try and make it do a
little bit more time work out how it
might work on the client side and bring
it over to to do that but when I started
looking at doing it in site so I
realized I needed a little bit more
structure than just templating passing
an object into things and I looked at
the things that across all the sites
that I've worked on the common things is
this there's some pretty common patterns
across all of them now I don't know if
you realize I've actually been showing
you this in the Onaga website and the
previous slides I've been hiding the
header and footer and things but this is
just that one website where we're
looking at the site in at the moment and
so what I wanted to show you here was
how the layout works so every single
page has exactly the same layout
it's the header and the footer some
sites have got more of a visual and
obvious header and footer some of them
they're less visible some of them have
just got meta crap and stuff like that
in there but
but my all sites have got the same
common thing so in the route of the
project
so we've got this pages folder but in
there there's a layout to HTML this is
the bit which is shared across every
single page on the site and again it can
be kind of anything in here the
interesting bit is this this container
so there's a div with an ID of container
in there and that's where the actual
page content goes that's where we're
going to insert the page so if we just
go back to that example actually look
here first so in the pages folder we
also got to speak folder and then a
speak tour HTML file and that's just the
what's going to sit inside that
container so we just go back to here
what we're saying is take that page
speak add it into the container in the
layouts and that gives us a pretty
generic page but then we want to do a
little bit more so that's when
Wednesdays late comes into things so we
can also provide this spec and again
we're going to update using the the
selectors so find a novel item and now
item a linked with a class of speak and
give it the active class name and then
on the title set the title to speak it
or not so now I want to show you going
on to that page what you're going to see
is the client side rendering bear in
mind we're just talking about
server-side rendering at the moment so
generating that markup on the
server-side but as you see here the
active class means that that's got the
slightly subdued States the contents
there and the title has been updated
let's go back to the slides
okay so that's a very generic example
now I'm going to show you the actual
spec file for the 7f website so in the
same way that the package that JSON file
provides a nice starting point where you
can look at how an application fits
together and what scripts you've got
available to it the idea of the spec
file is our saying it tells you how the
application is going to fit together and
it's got your routing in there it's got
all the components and the pages so you
can see the basic structure to it at the
top we're just defining some options
that's the docs folder I mentioned there
earlier worth noting here there's two
different arrays here the first one is
files that we want available on the app
cache the second is just files that we
want available to everything so we use
these to load up the serviceworker so
they're available offline but we also
use this list to copy them into the docs
folder thinking there is that if we copy
them into the docs folder it won't work
online or offline but by using this as a
single source of truth we know that it's
always going to work because it's it's
very easy to make it so that it'll work
online and you don't know it's it's
broken offline but making this always
the source of truth makes it a little
bit harder to do that and then we come
down to the actual route so index dot
HTML then the page at the home page
update the title I don't know what
that's doing that doesn't need to be in
there there's no bouncing in and then
here's an example of a component so the
ticket that we see there we're doing
various different things to get the
venue we can look at that code again and
then setting the link and then the
speaker's here on this component up here
it's just an object so we get one ticket
on the speakers and the speaker's select
a method is actually returning an array
so it clones that object multiple times
so if you give it three items in the
array it creates three lists of speakers
again I'm not gonna go into too much
detail in here but but this is what
makes up the site if you want to see how
a page works you can go in here and have
a look at it if you want to add one you
add that page here and and this is kind
of this is used in various different
places in the site and you'll hopefully
I'll be able to explain where
okay so up to this point we've got just
static HTML files we're just generating
static HTML files at Build time
completely plain HTML but there is a
client side to it as well so I've put
here this as a reminder classy Rooter
it's not it's not really a classy brutal
it does things with data attributes as
opposed to classes but what we wanted to
do here is make it so you could through
CSS and things like that you could
address these pages in these routes if
you wanted to so at the very top level
against the HTML attribute what we're
doing is we're sitting speculate data
speculate page two home which is the
page that we're using and they're also
setting the URL the reason being that
you could use a page across multiple
URLs but it lets us put this information
into the into the HTML and we can do
quite powerful things with CSS then
addressing pages and various different
things like that the other thing it does
is well it adds a nice loading class
while it's going fetching data yes so
let's look at some of the client-side
code now that we that actually makes the
client-side fit together
okay so another thing I'm not too keen
on is we actually compile index into all
the clients live stuff sits in the
client side folder when we build it we
build into this folder as index compiled
then it gets copied into Docs as part of
a separate thing it's it's not ideal
okay so this is in no way perfect code
and it's kind of been not together Adam
did ask me to draw attention to things
that need doing and issues where you can
help out so this is a really good
example of one at some point the
analytics code just stopped working and
the way that we fixed it was we just
copied and pasted this block of code up
to the top of the file which really ugly
it shouldn't be there it can either just
go into an internal require or it could
be come from an external required module
all we need is the analytics to work and
it not to look quite so ugly
so if anyone wants a nice of
contribution opportunity that's a good
one so first of all we load the the
routes our speculates the kind of what
I've been calling the tools that I've
built around this this spec format we
load app cache nanny so we're loading
app cache nanny for every single every
single user and again not many people
actually make use of app cache nanny
we'll talk about the different times in
which we load the different ones shortly
but then we get into the router so we've
got this before event before you load a
new page we just look for a nav with a
active and we remove the class active so
that's what means that you don't have
multiple pages because bear in mind
we're doing the routine client side now
server side it's been rendered with or
without the active class but if we do it
client side we're not changing the
header and footer the header and footer
never gets rear-ended because it's
already been rendered once and all we're
changing is the container div so we use
this just to remove the class and then
when we after we've finished changing
the page we need to scroll to the top
because if you imagine the header and
the footer haven't changed all you've
done is changed the content here in part
of the expectation is you'll be at the
top of the page that you've that you've
loaded so we need to force a scroll to
the top of the page there we also have
some error handling but this is where it
gets a bit more interesting for the
offline stuff
so if services work is available which
one load the serviceworker we register
this serviceworker file we catch the
errors we don't do much if there is but
if they haven't got serviceworker
available we start app cache nanny
so who's who he's familiar with the
difference between application cash and
service workers and the different
different bits okay a few of you alright
I'm just going to cover this last bit
and we're going to talk about those
slightly so at the end there for every
single person we do an on update ready
location reload again where we're
loading the app cache and any code for
people with service workers even though
we don't need to so which one I support
both application cache and service
workers but that comes at a cost the
fact that we're increasing the page load
times just to support both of them
because there's more code that we need
to load up ok cover those so the
application caches is quite a simple
mechanism for making things work offline
you essentially need to point to a
manifest or app cache file so this is
the this is the file that we use for the
Ellen Ock website this is a slightly
this actually has the idea of components
and it has the idea of pages at first it
was just the complete static markup was
being saved in the app cache this can do
the client-side rendering with
application cache as well but it's
pretty simple we basically say all these
files we want available offline at the
bottom there there's a hash a version
number whatever you wanna call it and
that's what we used to bust the cache so
if we want to if it's even if those
things have changed and we need you to
download them again we can change that
version number now that does work but
it's not ideal so a lot of the site
doesn't change at all where the CSS the
JavaScript the page is the components
they very rarely change the only thing
that really changes is what the venue
doesn't change either we've established
that the speaker's there who's speaking
and what they're speaking about that's
the thing which changes so to invalidate
all of these files invalidate the entire
cache just for that small bit of
information is very inefficient isn't
it's not very respectful of user data in
very mind you don't want to browser on a
on a mobile phone on a data planet and
it can cost you every time you
invalidate this cache so what we want to
try minimize that what are the other
disadvantages of app cache is just that
it doesn't necessarily give you the
updated page straightaway so imagine we
load up the site and we're loading it
from the the cache and in the background
it says oh okay there's a new version
available it goes and downloads that
version it finishes downloading that
version and nothing happens you're still
looking at the old version of the site
so you're kind of constantly in this is
where were you looking at the previous
cache version or never looking at the
latest version from the server so that's
kind of where app cache nanny comes in
and helps us with the application cache
as you saw at the bottom of open as we
saw at the bottom of the client side j/s
it does that update so for a long time
the experience on the olynyk website it
would load something from the cache what
you would be seeing was the out-of-date
information from the cache in the
background it would update that cache
cache nanny would file an update event
and we'd reload the page so for a long
time you kind of saw outdated data in a
second later you'd see this month the
latest data it provided a better
experience offline but the online
experience still wasn't very good
service workers allow us to do things
slightly differently this is not a talk
in that's going to go into detail about
service workers is there's a whole
family of different functions that you
can use that that come together to
really give you the performance in there
and the power of service workers but for
the time being I'll describe it is this
you have a fetch method so imagine just
when you make HTTP requests in the
browser you use a fetch function there's
a function that used called fetch if you
use that to make the fetcher requests
you can use service workers to intercept
those fetch requests so instead of going
straight out to the network you can
write JavaScript which decides what to
do you can have different strategies so
you can say go to the network first and
if it's not there then go to the cache
you can say go to the cache first and
then go to the network there's lots of
different strategies that you can build
up and you can have different strategies
for different types of files so you can
say for this type of file go to the
network first whereas this type of file
go to the cache first
so yeah what we end up with is different
caching strategies
so for the L&amp;amp;L website let's talk about
the caching strategies that we've got in
place so there's this architectural
model that you might call it I'm not
sure it's a Google term and the
application shell is a way of building
progressive web apps the idea is that
every applications got this this layout
that we were using anyway coincidentally
it's the head of the foot of the stuff
that's always there the stuff that never
really changes that much and that stuff
it doesn't change right so why would you
go to the network to get it so the idea
is that as soon as the service that any
requests going to something via the
serviceworker that's just a route just
so from the app the application sales
straightaway an empty app shell but that
gives the user instant feedback that
they're a on the right site if they've
gone to the wrong page they've got
access to the nav so they can still
navigate to change things and it's it's
almost a perceived performance thing but
it's if getting stuff to the user as
quickly as possible so that they can
start interacting so we use an
application shell model on this every
single route that was listed in that
spec the layout HTML file is the thing
that gets served straightaway once that
layout kicks in it's empty the
containers empty at that point in the
Rueter kicks in looks at the route sees
what spec it's got to try and get now
earlier I showed you the specs being
exported so it's a JavaScript file and
we could use JavaScript functions we
could generate the content quite easy
you remember what I said about having a
preference to build time execution to
run time or anything else at Build time
we take that spec and we we create a
file which is just the minimal amount of
data that we need to render the page so
in this case we're saying the page is
the home page and then the spec this is
all the things you saw earlier except
that you've got the strings there's no
JavaScript to execute here you've just
got the raw data then you've got the
speakers and then there's the list of
speakers and what they're going to talk
about so this is the only single request
which goes out network first we show you
the app shell we go and request this
straightaway if it fails we'll go back
to the cache its network first we're
still what the cache version there but
if we can't get it from the network
we'll get it from the
work so what that means is we're always
showing you the very latest version it's
always coming from from the server if it
can but if you're offline we can still
provide a fully functioning experience
because you've got the cache version
these slides have also got respect but I
don't think we need to see that so one
of the things I want to make a bit
clearer is just how to how cache
invalidation works on the website
because it's not immediately clear and
it could be improved so as we saw there
anything in the spec you don't need to
do anything clever to update it it's
always going to try and get that from
the network so you if you're making
changes to the list of speakers if
you're making changes to the venue or
anything like that you can just push it
and and those changes will be consumed
on the front end other things so pages
component CSS files JavaScript files
potentially do need you to to bump the
service work up so I just wanted to show
you so in the client directory as I say
so we're all the client-side code is
kept as a Service Worker J's file and
all we've got is a version number there
now it's that version numbers kind of
pointless and irrelevant all it actually
does is see if this file has changed so
you could add a bit of white space at
the bottom then it would effectively
bump the version number but we keep it
in there just so you can see that your
your intention is to bump the version
number things worse through in generally
developing with service workers that's
wrong that's Menace a test with Chrome
Canary and don't don't don't test
without Chrome Canary that will make it
less than difficult so yeah a test with
Chrome Canary there's just some nice
development tools in there understand
your tools look at the application tab
see what things have got in there
there's some nice ways of it's it's
still not perfect developing with
service workers is quite hard saw
someone sweet saying with with with
single page applications we broke the
back button with service workers we
broke the refresh bar and it's quite
often the case it can be really hard to
see your content and the updated content
coming true but yeah use Chrome Canary
use one's habit time
because the service worker could be in
the other tab as well incognito
emotional friend to make sure that
you're not using an existing service
worker but we created a ticket 147 which
is basically to disable the service
worker entirely on local development if
anyone's done this already I'll be
interested to hear how you've done it
I've got a few ideas but I'm not quite
sure how it's going to work so there's
an interesting job there if anyone wants
to do some investigation there's a nice
tool called lighthouse no I don't have
it there but it can work in it basically
it's from I think it's from Google it
gives you a score about it's got various
factors it considers that make a good
progressive web app and it gives you a
score on that so it it comes down to a
performance a lot of the time how fast
can you load are you responsive to your
oppressive enhancement all these
different things at one point we had a
hundred percent on lighthouse that's
slowly slowly gone down but it's good to
check tools like that to see what score
we're getting and that we can provide a
good experience to the to the widest
possible audience
so hopefully that little whirlwind some
of that stuff made sense I'd like to
think that then there's some
opportunities there where if you're
interested in getting involved in our
website there's things that you can do
just to go over a few of those 1:43 move
Google Analytics code out of the client
is that were the one we saw we shouldn't
be too tricky
1:03 show multiple events on the
homepage at the moment we only ever show
one month but there's no reason it
shouldn't show the next month or the
month after that just so you know what
events are coming up and you can put
them in your calendar one four six set
up speed track or an L NOC website
there's there's an open-source bit of
software called speed curve and what
that does is it monitors over time what
the performance of your site does so
it's looking at first render all the key
metrics in both actual actual
performance and perceived performance it
kind of monitors them over time it also
does the the lighthouse score that we
mentioned earlier so it'd be nice to
have something like that running on a
regular basis that we can see when we
introduce performance issues onto the
site and they could have mode that
disables service workers that one we've
already mentioned one four nine columns
adjusted two or three talks I can show
you
actually so we're kind of indecisive
about whether we're going to have to
talks a month or three and at the moment
I'm changing the CSS every single time
just to facilitate that and yeah if we
go to the homepage you'll see so this is
what happens when it's set to the CSS is
set to two but you're just Pro free
columns at it so but for someone that
knows CSS this is a really small thing
to change I kinda know CSS by trying to
avoid it this is my map so this is this
is what happens when we don't know what
the venue's going to be so this is just
a big zoom out in London this is the
unknown one and look we can it's
actually slightly nicer this one it's
shrinks down apparently I can't shrink
it down oh there we go
you get a slightly nicer if you have
London on the responsive a smaller
version yeah let's just check if
anyone's interested I can show you how
this presentation got put together using
the website I don't think is that
interesting when the other ones handing
lightning talks we haven't we haven't
got a proper mechanism for handling
lightning talks yeah Adam you should
just submit to talk himself any mangly
copy and paste it there's absolutely no
reason we couldn't just add a label or a
tag that says lightning talk and then
that gets brought into one particular
column but I haven't grade the ticket
but if anyone's interested give me a
shout and as we've any of this stuff
really if there's anything you're
interested in if there's something
you're wondering how it works please
feel free to reach out to me I'm not
always here but I'm always available on
internet it's honest calm my email
address is McManus thought so I'm at
gmail if you have any questions and even
if you don't want to contribute even if
you're just using it and you notice that
there's a problem on the website just
let us know create an issue it's nice to
know that people that are using the
website and if there's problems we like
to get them fixed so I think that's all
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>