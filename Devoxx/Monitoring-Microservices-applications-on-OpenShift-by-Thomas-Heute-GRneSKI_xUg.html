<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Monitoring Microservices applications on OpenShift by Thomas Heute | Coder Coacher - Coaching Coders</title><meta content="Monitoring Microservices applications on OpenShift by Thomas Heute - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Monitoring Microservices applications on OpenShift by Thomas Heute</b></h2><h5 class="post__date">2017-03-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GRneSKI_xUg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right so I don't see anything
so I suppose the room is full how to
compete with the food so I'll try to
make it short on the slides and do more
entertaining demos I'm pretty sure the
demos at some point will fail so on
because it's a well first it's remote
over 3G and of VPN so crossing my
fingers there and also it's it's really
from Gita master so so should really
work but and just put more excitement
into this demo so so just before I start
um yeah maybe introduce myself i'm
thomas i'm walking forward that as its
new engineering manager i used to be a
developer I worked for Jay Bruce and
John Jay was in 2004 and then we Wed
were bought by reddit in 2006 so it's
been quite a while now
at this time I'm I'm working on
solutions to do management and
monitoring originally more on the
midwestside but now it's uh it's also
like about everything because since we
we worked a lot with open shift as a
platform as a service it's a way beyond
just Java and middleware so there's a
main project that we develop is school
hockey law with develop ocular for needs
we need something with long term storage
for matrix and that can resume terascale
so you need more power you'd put more
nodes it's a Java it's optimized we have
an arat engine in it so this eret engine
not only can take input from matrix but
we all know input from other inputs
basically any input so far now we are
walking like with the the people one
charge of login creating or logging
so that you can take actions where I
don't know there are arrows and logs and
matrix is some threshold or whatever or
more complex and I use like that there
is an inventory I won't talk about it
and there's a bit of a side project
about application performance management
which implements the open tracing a
standard so I'll go right to the stage
of what I want to demo so basically in
this demo everything is running inside
on openshift instance so it's a basic
developer instance is if you familiar
with openshift
you may know the OC cluster up awesome
come on it does a lot of of stuff for
you in the background and then it works
that's quite awesome so in there I have
obviously it comes with the open chief
developer console and since I enabled
matrix so if you do OC cluster up - -
matrix it goes true you get the matrix
and with the matrix we get our the
ocular matrix another server and it was
installed hipster which is the piece of
code that collects matrix about the
containers like the CPU they use the
memory they use and network usage for
all the containers for all the cluster
all the kubernetes cluster and Indian so
that will be very quick to show after
that I wanted to show you an ad John
that we developed which is deployed
automatically on I mean if you once you
install it it will depend to matically
on each node of your cluster to collect
custom metrics so if you deploy webster
allows you to do monitoring of the
container but if you want to mean mint
or something inside the container then
that's when the ocular up and shift
agent plays a role and what happens is
that you application would expose an
endpoint for the agent to collect so we
suppose your locale promoters and points
we could support more there were more
but those are really the two most common
ones that we've seen so far
social an example where we have a wild
fly the Jebus application server that
has daruka in it so basically I can
access any of my jmx endpoints and
collect that and also an example with a
very basic Python script that expose a
promoter standpoint and something will
correct that with a jocular OpenShift
agent and everything is going to be
stored in oculometrics along with the
container matrix I will very very very
very official you graph on R so it's
something that working is a plugin to
see those metrics and I'll show you how
to I p.m. which is the most awesome
thing I think in this in this demo is
very visual so we have four
micro-services vertex applications that
are talking to each other some way and
reporting thanks to the open tracing API
to a server I want to move that but we
have operators doing custom matrix and
custom might have definitions through
the REST API directly but they also
stole their matrix there so they have
the option to use like grandiose or ways
to consume the data and what we are
walking we are waiting on the new HP
actually where that paas or reddit
employees are working on it once we have
the new horizontal pilato's Kara will be
able to expose any metric that is
collected so let's say you have a
promoters endpoint exposing the number
of potato you sold and you want to scale
based on the number of potato you sold
you could do that let's work in progress
but you can still obviously do auto auto
scanning based on the CPU usage of the
container itself not inside the
container so here's a demo here is a
demo so this is um small this is a pill
abuse of
be a bit better for you to see so this
is openshift if your family always opens
if you know this console very well I
have multiple projects some created by
myself
and I want to show you directly like the
application matrix project where I've
deployed a few applications the one of
the top I won't really show you here it
was four different demo but here you
already see some matrix so those are
metrics credited by hipster stolen
oculometrics exposed in here they are
also exposing on the sub product cloud
forms which is used for operators of
open G for cloud in general so you have
the matrix here and here you also have
some other matrix as I said this I have
this example where a JBoss application
server could whitefly exposing a Deluca
endpoint and here i have one with pro
motives so let's have a look at the wild
fly with daruka one so I'll go straight
to the metrics tab here and so here
again memory and CPU usage that we've
seen as a summary enough in the screen
before and also the network usage which
is also corrected by hipster and there's
an additional metric which is the custom
application metric and near the point
was to get the heap memory usage for
that container how does that work
configuration wise once the pageant is
deployed is pretty basic it's a it's a
feature of in in OpenShift called the
traffic map where you have a container
you define a config map it actually
tells the agent the data will know that
this container is asking to be monitored
basically
so and the configuration here says what
you want to collect so this one expose
Jolokia on slash Jolokia in the
container and we ask for correction
interval of 60 seconds and we want we
don't want all the metrics from this
Jurek endpoint we just want one the heap
memory usage that's the one I just
showed before good thing is that you can
with the this feature you can actually
edit it all online and if you say from
60 second to 10 seconds you save it and
now you're telling the agent okay you
want to collect the agent the metric
every 10 seconds and that's it that's
all you need to do you can share those
configuration for the continuous at the
point right you should just use the same
coughing map for multiple containers and
you're good to go so you change once for
many containers so on that screen here
we may not see the new change in sorry
it's not the right one not on the not on
the pod we may not see the change in we
won't really see the change in in the in
the collection interval but I can where
I can show you is I can show you direct
in in graph Anna so we have this driver
for graph Anna that allows you to read
from hockey row matrix and here this is
what's happening on the top that for me
to know what you see what you don't see
that on the top here it's one metric
that is collected by hipster for one of
the container I mean for a tree all the
containers in that namespace so my three
containers you saw in a project you have
like three lines and some may be hard to
see here but trust me they aren't there
and here I have my metrics that I
collected with the agent and here so
maybe trust me if you don't see it but
you see you should see that the
correction interval has changed to 10
seconds and yeah maybe you see it's a
bit more maybe precise because here
actually there are multiple Peaks but
our hidden hernia you see the the matrix
the custom metrics from promo to send
points on right python script so here
there were a lot more number of eaten
beers on drinkin beers and eatin apples
and some stuff like that so really
custom metrics and again the idea is
that as soon as we can expose those
metrics to the horizontal polo to scale
so that you can scale up or scale down
based on one of those metrics but you
can already use those and with the
Elliott engine that we ship is not yet
ik
there's no your wife weight yet but we
have operators using the REST API to
define their labs you can you could do
that I won't go into all the details of
a hipster the next thing I want to show
you is this thing called ocular APM I
have a different project called order
manager where as I told you I have my
for continuous it's a shop I mean yeah
missing some contrast for you to see a
guess but it's like a shop where someone
wants to buy something right and it's
much in multiple services very common in
examples at least where you have an
account manager we just check that the
user exists and there is an inventory
manager making sure the item that the
user wants to buy exists and that it's
in stock and there is an auto log to
actually just well keep a log of the
order so it's very basic
example four containers the magic here
is that developer gave you four
containers that throw the four
containers of the wall to the operators
it just has that and now it doesn't
really know how it works doesn't renew
it manager if she kills it what
happens or whatever
so with Hawker IPM the good thing is you
be able to see some of that so the first
thing I would do is make don't see the
last line
it's a Cal command there's no UI for
this example but you see the details
here Fred account ID fred is trying to
buy quantity two laptops right and just
make a post operation rascal on slash
orders of my vertex application of one
micro service of the vertex application
so the this has worked and few seconds I
should get yes my one cool so I have one
call on one slash on slash shoulders my
post colon slash orders and a bunch of
operation that were actually that
actually happened that's how I insurance
instrumented my code I also get stuff
for free for values famous frameworks or
at jax-rs and stuff like that or
automatically instrumented and it start
to tell you a story when you see the
time spent in the producer database on
consumer part and I will now make a lot
more cool
so here I'm generating random codes and
so far the person exists so here we have
an order with an item that didn't exist
or one that just so that we are out of
stock the account didn't exist so Sara
doesn't exist try to to buy something
for doesn't exist on our name does not
exist and so on so now I will get more
and more data I will just maybe change
this a little bit you see my number of
khonsu slash post is being it will
increase regularly like 37 counts and
and so on so here you see which of the
like services or mostly cold and how
long it took for those cold so if you
don't optimize up all your application
that's a good idea in the distributed
distributed tracing view there's a
little bit little bug when you okay okay
there's a little bug sorry for that but
here you get an ID
it's an aggregated view of the course so
you get an idea of how the services are
related and you have the name of the
services in order manager called
inventory manager inventory manager for
object quantity to get item auto load to
store the order and icon manager to get
the other there's no real maybe not in
that exact order but here if you look at
the specific instance of your business
transaction you have the full story you
did
slash orders post it called get account
it it called the daikon manager docker
container get account call the database
since it was successful try to get the
item and so on and then all their logs
and so on and so on this piece I'll get
back to that if I have the time
transactions is allows you to put more
business
information to your traces okay so here
I had like 122 transactions and I see
that I see the time it took for those
transactions and I see how many calls
were made in a in a one-minute interval
and for the past 10 minutes and how many
were a fault the fault could be I tell
not found out of stock not fun account
and a property can look at the item ID
and you know what has been bought so
again the application was instrumented
and then you get a lot of information
for free in the services what I wanted
to show you not sure I would have the
time but I want to show you a cannery
deployment so so I will create a new
build called Account Manager blue it's a
new local container it's actually the
exact same image that I'm doing here but
I'm cheating a little bit hope I'd be
lucky with the internet so I'm I'm
really just deploying a new container
beside the other and I want to see if
that new container behaves the same way
or not and if it be as well I get no
return from the users I will want to
transfer my my calls to this new
container so this tool will help you to
figure out if that's if it's a same
performance as as before or not it's
really the last right item to identify a
problem but yes you get on your certain
percentage of the calls to those new to
this new container that's the word ID if
I get lucky enough that it doesn't take
forever
so we'd already put my account manager
my current version here and I see again
the grunts meantime it was cold and I
mean time it felt
I won't have the time to show you but
the step after will be like to create a
new version of the same service and you
will see the you will see the new matrix
so so I'm running out of time but just
show you that so here I will have a new
and a new container deployed what I will
do that decrease the number of pores of
the old one and then look up grading
objecting the the new one and then I
will see a load balancing and then so
1/5 for 1/4 of the course will go to the
new one and then I transfer everything
so unfortunately took more time than I
was hoping for so don't think well we
have done time for question for sure
just wanted to remember that where that
is hiring and not only in Switzerland
the tours in Suzanne consultants
middleware solutions architects also
have developers we have an efficient
nurse at their an office in Zurich and
this is my email if you need if you have
more questions I've put my Twitter I
don't know why because I barely use it
but just in case you prefer to send me
like a direct message on Twitter I will
be notified so but yeah so thanks thanks
everyone if you want to see the end of
the demo here feel free to see with mere
outside thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>