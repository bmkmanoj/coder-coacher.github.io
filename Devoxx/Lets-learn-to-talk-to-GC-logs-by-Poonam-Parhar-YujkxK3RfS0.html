<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lets learn to talk to GC logs by Poonam Parhar | Coder Coacher - Coaching Coders</title><meta content="Lets learn to talk to GC logs by Poonam Parhar - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lets learn to talk to GC logs by Poonam Parhar</b></h2><h5 class="post__date">2017-04-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YujkxK3RfS0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right hello everyone thanks for
coming to attend this session I'm Poonam
I work in the JVM sustaining engineering
group at Oracle and in this session we
are going to you know talk a bit about
the new GC logging for Mac that's coming
up in Java 9 the mandatories slide that
I have to include so new GC logging in
Java 9 it's it's a big change massive
change that's coming in Java 9 and
actually it follows another major change
which is being introduced in JDK 9 which
is unified JVM logging framework so the
GC logging would be using this framework
new framework in JDK 9 to log its
messages and in this session we are
going to talk about you know a bit about
unified JVM framework GC logging the new
command line option that we need to use
to you know to see equivalent
information that we will like to use to
see with earlier JDK versions with the
GC logging options here's what I'm going
to talk about unified JVM logging
framework new in Java 9 how GC code is
DC logging code is reimplemented to use
that framework new command line option -
X log which is actually added by the
framework and GC code has introduced new
tags to be used along with this command
line option you know and what
considerations are we need to use with
this command line option to get the
equivalent information in the GC logs
what happens to the old GC logging flags
we'll see and then take a look at some
of the examples
unified jvn logging framework JEP 1:58
who was the proposal to add this new
enhancement to add this new framework
into JDK 9 it adds a new command-line
option minus X log and with this there
are you know some tags added up into
various parts of the JVM you know
representing different parts of the JVM
that can be used along with this command
line option to fine tune the information
we want to see in the in the logging for
example GC class JFR modules etc and
these logging messages coming from the
framework you know whichever all the
systems using this framework of we can
use tags to categorize these logging
messages it's possible to use a
combination of tags with minus X log you
know a set of combinations of tags to
really select the messages which we want
to see in our logging and all the logins
can be you know done at different levels
there are certain levels defined error
warning info debug.trace and develop
develop is for non product bills the
other levels are available in the
product bills and the messages can be
decorated which means that there are
certain decorators available which can
be used to you know enhance the message
you can add additional information to
the logging message and the the default
decorators are uptime level and types
but you can of course change the
decorators that you want to see with
your logging messages it's possible to
redirect logging to a file so all this
is
under the unified JVM logging framework
the help option can be used with minus X
log and it provides you no information
couple on the complete syntax of the
command how you can use it what are the
options that can be used along with - X
logs
- the most important thing to note here
is the what what which you know is it
comes after - X log : what is the
combination of tags and the levels for
which we want to see information coming
from different you know components of
the JVM and note the the the star or the
asterisks which follows d tag sets it
denotes a wild-card which means that I I
want to see the logging messages which
are associated with these you know super
set of the tags that I am specifying on
the command along with - X lock command
so I would like to see messages that are
tagged with at least these tag sets but
they may have you know other types as
well associated with them let's take a
quick look at the other options that can
be used with the - X log you can change
the output you know using the output
option whether you want it to be
redirected to STD out all you want to
redirect it to a file the decorators
time uptime time malaise so these
decorators enhance or add the
information to the logging messages as I
said uptime level and tags are by
default enabled but you can remove them
or change them and the output options
are basically - you know - to enable or
disable the log file rotation or to
specify how many log files you
to be rotated and what is the size of
each file log file you would be
interested in now unified DC logging so
with Jeff 271 GC logging has also been
read has also been reimplemented to use
the new framework so GC uses - X log
command and GC is the main tag to be
used with - X log and there are other
tags as well you know available for fine
tuning the GC logging that we are
interested in and the old GC logging
options might come as a shock will be
removed in JDK 9 so you know we if you
are launch scripts or your command line
options are using the old GC logging
option they will have to be removed when
you move to using Java 9 8 1 4 5 0 9 -
was the bug ID under which you know the
this enhancement was integrated into the
repository so if you are interested in
looking at specific changes that were
done for you know de belem ending GC
logging you can see the changes done
under this bug
let's take a look at the example output
that you would see with the - X log GC
so here I am specifying that I want to
see messages logs messages that are
tagged with GC tag and are logged at a
level trace and and if we specify a
particular level the messages below that
level are also you know slots so in this
case messages logged with trace debug
info error and warning would get log so
in the output we can see that all the
messages that are tagged with GC are
printed out
the first three columns come from the
logging framework and they are uptime
level and tags and the rest of the
message is coming from the GC code do
you see you know code in the JVM what
happens to the old GC logging flags as I
said they will be removed they are
actually they have been removed in the
repository but we still retain three
most popular flags up in GC pin GC
details and X log GC they won't be
showing you the old output but they have
been internally mapped to the
corresponding the X log configuration so
that you know at least for these flags
you don't have to update your launch
scripts and the command line options
they will show the new output but they
are still honored you won't get a you
know error message and that the JVM
itself doesn't launch these flags are
deprecated and will be removed in a
future Java release so all in all 43 GC
logging flags are removed with this
change
here's an example of for GC logging code
change that Renton as part of the free
implementation so if you see earlier we
had underpinned GC details we had GC log
or TTY and
it invoked function print to send be
logging message either to our console or
to a logging file it has been replaced
with log underscore level macro and that
macro is implemented in the logging
framework so this macro what does it do
it you know there are different macros
for for each level and here you are
telling that I want to log this message
which is heap usage transition details
at which tag associated with tags GC and
heap and I want to log this message at
info level so if someone on the command
line uses X log : GC plus heat is equal
to info or you don't have to say info
because that's the default level then
this message would get printed another
example we used to have a flag pink
adaptive size policy so that has been
removed and a logging message at trace
level is logged using tags G C and L go
and the message remains the same some
examples so I have tried to use since
the g1 garbage collector is the default
in JDK 9 so my examples are using G 1
with JDK 8 and you know the default
collector in JDK 9 so this example using
the old flag is with the JDK 9 and the
next slide I will show you the example
of the output with JDK 9 using G 1
collector so here we can see this is the
usual output you know with print GC
option to get the equivalent information
with the new logging framework in Java 9
we would be using minus X log colon GC
so print GC if you are using print GC it
will be replaced with the minus X log :
GC it gives the same kind of same level
of information and you know the
additional information comes from the
framework that these are the tags and
this is the time at which this event
occurred then GC details again with the
g1 collector with JDK 8 this is the
information that we used to get within
GC details in Java 9 we need to use a
minus X log : GC star so G's by GC star
or asterisk we are saying
please log messages that include at
least GC tag in them and they may have
other tags associated with them so if
you notice in width in GC details with
g1 you are you can see the failed level
information here you know D logging
messages are giving us information about
the about the different phases of g1
garbage collector but with X log : GC
star that information is missing so with
other collectors you would get the same
level of information with the - X log :
GC star but with g1
we need to use GC plus phases is equal
to debug to get the phases level
information because that information is
logged under GC and phases tiles and
that's logged at a debug level so as to
you know keep the detail level separated
from GC star and you need to specify
additional tags to get more detailed
level information print heap add GC
which you know using which we can get
the heap usage details before or after a
GC for that in Java 9 we would be using
- X log : GC + heap is equal to debug
which means logs you know print the log
messages tagged with the GC and heap and
you know at debug levels being printed
at debug levels we have options print GC
application concurrent time print GC
applications stop time in JDK 8 which
are used to print the application
runtime and application stop time
in JDK 9 we would be using - xlab : safe
point so with this tag the application
run time and application stop time the
same kind of information same level of
information would be available with the
safe point tag print adaptive size
policy which you know prints the heap
sizing and the collection set
construction decisions are being made by
the collector in Java 9 we use GC + algo
star is equal to trace so GC and I'll go
take a go plus some other tags you know
messages at the trace levels continuing
distribution which used to print the the
survivor size are the age distribution
of surviving objects in the survivor
spaces so for that option we would be
replacing it with minus X log GC + h is
equal to trace so it gives the you know
even the text remains the same it gives
the same information so we had minus X
log GC option we have we still have
minus X log GC option up until JDK 9 and
that's used to you know redirect the the
logging output to a file and we could
use options UGC log file rotation to
enable the logging file rotation and
this is little how those options could
be used to enable rotation a file
logging file rotation and to redirect
the output to a file even though this
option would still be there in JDK 9
minus x log GC but the rest of the
options will be removed
and X log VC would be mapped to minus X
log G C you know : file is equal to the
name of the file so this is how we can
redirect the output to a file and we
could enable file rotation and specify
the number of files we want and use and
what should be the size of each file so
other useful types to get more you know
information and details about minus X
log command if we use minus X log : GC
star is equal to trace so that prints
the lowest level of information you know
of GC logging information so trace as we
the most detailed level to be specified
and GC star means include all the GC
related options all the GC related tags
in the output so this provides we you
know all of GC logging at the lowest
level and minus X log all is equal to
trace which means I want to see GC logs
from all the subsystems of the JVM at
the lowest level and it is possible to
disable the logging all together using
the disable options with minus X log and
as I said help provides a you know the
sense in techs and examples for minus X
log command and minus x log logging is
equal to trace actually gives you know
enables tracing for the logging
framework itself so it provides
information about the available types
implemented by the system what are the
available tag sets what are the
available levels and decorators and
what's the active configuration of you
know available taxes is it possible to
dynamically configure minus X log yes it
is we can use J command or and beans
- you know dynamically change the
options of minus X log if we use a VM
dot log with J command a diagnostic
command it shows you know what are the
options that can be used to configure
the the parameters of - X log and for
here in this example I am using what is
equal to GC star which means I am
changing the tags that can be used with
- X log - G C star so I put together
you know these stables mapping the old
GC Flags - the new X log configurations
that can give us the equivalent of GC
logging information which we use to get
with the old Flags so for example print
the g1 print heap regions which is
available in JDK 8 in JDK 9 we can use X
logs : GC + region is equal to trace so
you know by looking at the code by
running some tests I prepared these
tables mapping the old options to the
new configurations so maybe you know you
can refer to these tables later on when
you are migrating your applications to
Java 9 and updating your launch scripts
so with that I come to an end of you
know this presentation thank you so much
this I will be uploading it somewhere so
this will be publicly available yes I am
not aware of that yeah
yes I I guess that that we did with the
three popular flag sir but it would have
been you know having so much redundant
code and maintaining it in the codebase
would have been difficult so and they
don't do anything at least JVM bub up
but once that you know let the users
have garbage in their in their launch
scripts it they would never remove it
you know
yeah but you know being in being in
sustaining I have seen that the you
think that lunch the people are not in
control of their launch scripts if you
take a look at you know some of the
launch scripts they are full of trash
you know people don't know where those
options are coming from and if this is
allowed you will have all the junk
accumulated in the launch file so that
this will force them to remove it which
is garbage should be removed anywhere in
future if we duplicate it now and remove
it in future anyway at some point you
have to remove it right all right and
anyway these options we say that these
are unsupported and we don't care you
know we can remove them anytime we want
and coming back to your question that
don't do anything just let them be there
if we just let them be there you would
expect the output when some failure
occurs you will say oh I had these
options on why don't I see my log file
and why don't I see something in my log
file you won't you know because then why
didn't you tell me that I had to remove
it nobody reads warnings they are just
you know the processor started you you
never read what I what is being printed
on the console
decoding change
yep
so this is a macro you know we have log
underscore info log and the score trace
these are encapsulated macros and that
the macro is defined as log underscore
level which actually then blows into
these different macros for each level
right so so this macro is accepting the
tags and then it calls a function
passing it you know the specific
function for that level and
encapsulating this message
yeah yeah so this this macro would
actually check you know if this level is
enabled or not and then it logs the
message so yes so this macro log
underscore trace will actually check so
this actually expands to the code and
which is a check
I don't know right right okay
okay yeah okay all right yeah I'll get
in touch with you regarding yeah sure
so yes get ready be prepared to you know
for this new logging format in Java 9
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>