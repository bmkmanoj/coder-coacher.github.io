<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The road to Node Package Manager Hell by Paul Watson | Coder Coacher - Coaching Coders</title><meta content="The road to Node Package Manager Hell by Paul Watson - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The road to Node Package Manager Hell by Paul Watson</b></h2><h5 class="post__date">2016-11-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6qibcuTeaG4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to this quickie session entitled
the road to mpm hell my name is Paul
Watson I'm a freelance job developer
from the UK based in London and what I
want to talk to you today about today is
developing projects with more than just
a little bit of JavaScript in them any
time you have anything more than a
trivial bit of JavaScript might me and
my team have found a bunch of simple
strategies that will help you building
your software to be a bit more robust
deterministic and secure so earlier in
the air I was at the t-point with my
fellow developers this is where group
therapy happens for us we share stories
swap anecdotes and this one particular
time I was telling a tale of what about
our build the build server was not in a
healthy state we couldn't do the NPM
install it wasn't behaving the same on
the build server as it wasn't our
developer machines we were in a bad
place pressure was mounting the project
manager was on our backs eventually when
we did get it working the build added a
full 15 minutes to the total time of it
that this was the inspiration for this
talk today so
unless you've been living under a rock
for the last five years you will have
noticed the rise of JavaScript why am I
talking about JavaScript a Java
conference because we can't get away
from this stuff it's in the back end
it's in the front end we've got our es6
pipelines react webpack linters concat
many fires you name it you want all that
exciting stuff in your project you're
going to need a library for that the
main game in town from Apple inner
javascript library is mpm the nord
package manager if you have a Java
background which I'm sure a lot of you
do know of modules behave in some
surprising ways for instance they depend
on install order and if you needed any
reassurance that mpm is the only game in
town put this classic slide in fear for
your information the purple line they're
going all the way up to 350,000 is the
is the MPN line we can see see the
where's the mirror one there the mavens
the green guy going up to about just
over 100,000 so when i when i was
writing this talk i looked at the
problems we were having and I broke them
down into three key areas availability
security and determinism in 1994 Peter
douche and his colleagues at Sun
Microsystems drew up a list of
assumption false assumptions about in
distributed computing that we as
developers invariably make the first of
which is the network is reliable we need
to remember the network is not reliable
packets get dropped and switches feel
which leads me nicely onto security so
more than eighty percent of software's
third party libraries and the JavaScript
micro package approach means that we get
a larger attack surface plus i'm sure a
lot of you are aware that back in March
there was the left pad issue here
one guy unpublished a bunch of his
projects that including one of them
which was called left part and 11 line
view either disappeared from the
globally names based MP mgs dog this
left a gaping hole for someone else to
to put in another left pod which
thankfully wasn't malicious way but a
lot of guys were blogging about the
security concerns around this including
one I read a package called rim rafal
which is an attempt to demonstrate how
you don't even these things don't even
need to be running in production so
something maybe where when you run an
NPM install it execute arbitrary skips
or you have the option to execute
arbitrary skip scripts at the end of the
install and this guy demonstrated the
classic RM minus RF / star which I
highly recommend you do not install
deterministic builds so as I mentioned
earlier mpm free and the same with the
latest release and p.m. for depends on
actually on install order so to
developers with exactly the same package
may not be a fearfully those package
digest and sorry may not be able to
faithfully reproduce the dependencies in
the same node modules directory
depending on when they join the project
so I picked a pretty grim picture at
this point and what I wanted to go
through is some of the practical tips
that my team and I employed the other
Java developers when we were in those
group therapy sessions run the t-point
those guys are saying hey I've got
problems with my build server as well it
seemed like it wasn't just us and and
some of the suggestions that we came up
with we use one of those guys maybe
you're already doing some of these maybe
you can find find some use in them
strategy number one is run your NPM just
or gosh essentially you can use a sauna
type Nexus or artifactory they both
provides really cool features
that quite easily allow you to proxy MP
MP MJS dog this several advantages will
have listed up there so this means the
urine p.m. in stores are quicker and it
can protect you from outages it's a big
one so as I mentioned earlier mpm just
dog isn't always going T to be there and
and frequently it isn't and you
guarantee that when it isn't there your
your boss will be wanting you to do that
friday release that is absolutely
critical it's a little bit safer so if
for example if you're if you're in a
bank in your working offline you've got
that you've got that extra bit of safety
there that that you're not pulling in
transitive dependencies and potentially
some malicious left pad script and
finally kind of the main reason to do it
is that you're in control you get to you
get to see what what comes into your
project so my team won a sauna type
Nexus cash and I of one ruling on this
complete here it just works strategy
number two for all you griddle guys out
there is standardized your no Jess
install so a lot of our web services are
built using spring boot and with a
griddle wrapper and we found the
excellent NORs plug-in which I've put a
little a little sniff up there of how to
include what this does for us it allows
us to standardize no Jess installed so
we find end developers saying coming
along to us and saying I know of modules
are not working help me and it found
that they're running an old version Lord
or you know something wasn't quite right
there on a Windows machine it's
computable and links to change so we got
to standardize this stuff as much as
possible what the noid plugin for
griddle allows us to do is to specify a
version in this case 5 30 and a
disk-based URL so we can pull it down
from our enterprise server doesn't need
to go out to the web that then it can
install on the build server and you
never have to manually install that on
your development machine
this has the advantage that a developer
can walk onto the project and
straightaway do a Gradle build and it
will install node and it was it the
advantage of that as well as there's a
plug and built on top of that which is
the gold plug-in and then you can get
that to delegate to your gob GS and in
that way you can run your unit test your
integration tests and your griddle test
will then wrap the gorgeous build and
run all your javascript in your tests so
it's really nice like kind of
win-win-win strategy 3 is fixed
dependencies this is a bit of a personal
one for me so semantic versioning and
it's employed in the package.json which
kind of means that your minor and patch
versions shouldn't brick backwards
compatibility but inevitably things do
so what you can do is run npm shrimp
wrap which is built into an p.m. and the
idea is it will lock in a snapshot in
time of your dependencies and write
those urls in there and then shrink park
the problem with that is it then mrs.
the cash or the shrink park which can
then zip up your your modules and put
them on disc these things are quite like
I've suggested these things here that's
how would you would shrink that would
say sorry you'd fix your transitive
dependencies I'm at least suggesting
that on our team we we didn't use
loosely versions or nor carrots and no
Tilda's that were version ranges because
I don't know about you guys but in it we
have enough problem with our own books
without bringing in some stuff we need
we need to lock down this stuff as much
as possible that's my personal opinion
Venkat was here a couple years ago and I
remember a thing that he'd said which
was you're doomed if you do and you're
doomed if you don't and this is just
choosing which way we're doomed so if we
if we fix our our versions we kind of
were at risk of restoring up that risk
that we cannot bring in more API changes
whereas if we loosely type our versions
we run the risk of introducing new books
and we cannot isolate our problems
moving swiftly on stretching before
which is get yourself a guard dog so our
team and I hunted round with the
security concerns that we had hunted
around and we found the excellent
dependency check tool by or wasp there's
actually a talk in room for later on
today by Martin the block called
building secure software i highly
recommend you check that out the
dependency check till i can quickly show
you here so what I've got in this
directory is a simple no problemo how
about now
desktop for one second
talk amongst yourselves
a personal life time I laughter ditch
that so demo over so what you would have
seen there is we run the dependency
check till there is an incubating
feature in that it's a simple
command-line utility which will
recursively look if you point let you
know much else directly well cursive
look over it we wash any those
package.json against the National
vulnerable vulnerability database in the
US what you would have seen and that
amazing demo was it takes roughly about
five seconds to go through the node
modules directory and it shows it
produces a little HTML report that you
can have a look at and it it will say we
found this critical vulnerability in a
in a maybe a transitive dependency that
you didn't even know you had some also
runs from like mention balls in this
category where we looked around in this
the snick I or and security to I or the
reason these actually look really good
for a few dollars a month they will
provide the same kind of
software-as-a-service you just point
your your tools I think actually they'll
give you a command line thing as well
that you can run your build server we
ended up going with or was because it
was free and it just worked so right
yarn so my tour kind of I could've added
a few extra things in here maybe some
darker stuff only just because it's dev
ox and you need to you've got offer a
token docker slide but one month ago the
kind of Hollywood twist in all is this
is that the guys at Facebook and Google
and a few others had a well obviously
suffering the same problems that the
people at the T point that I was talking
with and me and my team are having so
what is yarn yarn is an alternate to the
MPN client it is it youth it uses MP mgs
dogs or nothing changes there it uses
same package as soon as you've already
got even sir install stuff in nord
modules so all it basically is as an
alternative to the to the MPN client
that you that you know and hit sorry
love
how is it different it's fast I would
show you in a demo but obviously that's
nuked so it's really fast so the it's
it's different from mpm it in so much
that it it pulls down it does resolution
first and then it pulls down those those
packages puts them into a global cache
on disk and then copy them over it's got
separate steps and because it does that
it can paralyze it so it's much quicker
it's deterministic as well which is the
which is the biggie so if you're in it
on the build server your guarantee well
as much as it can be guaranteed that
it's going to be the same on your
development machines it all locks
dependencies for you so the problem with
NPM shrink-wrap a bit apart from other
stuff was that you have to remember to
get your developers to win it which it
is as we know like we're forgetful bunch
just offline installs which is really
cool as well so with NPM that was a real
struggle if you're on a train or a plane
and people are getting excited because
it does check some verification but I
just can't understand why it wouldn't do
that anyway so to wrap up some of the
things I'm going to talk about we're
going to run a cash when a proxy using
nexus or art factory or the two of your
choice we have seen how you can
standardize the version of nodes that
your developers install using the
griddle gulp flush node plugin we can
hope hunt for vulnerabilities in our in
our software using the OWASP dependency
check tool and yarn for the win yay
thank you up in pas Watson cheers</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>