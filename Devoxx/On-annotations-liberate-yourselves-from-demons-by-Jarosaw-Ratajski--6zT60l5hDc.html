<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>On @annotations - liberate yourselves from demons by Jarosław Ratajski | Coder Coacher - Coaching Coders</title><meta content="On @annotations - liberate yourselves from demons by Jarosław Ratajski - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>On @annotations - liberate yourselves from demons by Jarosław Ratajski</b></h2><h5 class="post__date">2017-03-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-6zT60l5hDc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to my talk on annotations I make
it a little bit bigger what do you see
so it's about liberating yourself from
the demons that you've created and so
who things the annotations in Java or
demons okay so you don't need to attend
this talk it's for other people but okay
so let me first introduce myself
so I'm Yara critize key yeah I live in
lucerne under this mountain and I am
developer wizard and an architect so
yeah I'm most of my life professional
life I spend with JVM since year 2000
before I programmed in C++ and my
collection of pokemons are things like
this like JVM Java EE spring of course
OSGi even a Java then JavaScript types
with scholars ecology so a lot of them
and I'm working for a very great company
CSS insurance that's in a ok it's in
Switzerland so if we do health insurance
can name suggests this but we don't
really insure your style sheets maybe in
the future ok this story so maybe I will
introduce you something that I really
like we have now Stack Overflow yeah you
know of course we because you are
developers without this you can't
program I know this so we in Poland have
polished Stack Overflow at the moment
I'm dyskinetic from Network moment let
me fix it very quickly I hope I will fix
it turn on I hope I'll be and there is a
Polish Stack Overflow
that's called called for programmers net
and that's how it's just the Polish
forum for developers so unfortunately I
can't
show you that but maybe later and there
is a like style file in Polish language
so we are sure that you know every magic
knowledge that we put there is only yea
encrypted for Polish people it's not
publicly available that's the way we
built the great polish force of
developers okay and on this forum I'm
quite active and I am discussing with
people a lot of technologies and
problems and things yeah I am known for
criticizing annotation spraying Java and
things like that and so I get from time
to time a question how come and how can
you be no and seriously with that and
one day came a question how can you so
that was for very from a very good
developer in fact that I know that oh
come on how can you do something like
that so it's a magic service that does
this here is like transfer something
from data collector to with data
extractor you see that code okay you see
the code yeah with then filters the date
and uses some generator etcetera so we
have a magic service and of course we
sometimes need to parameterize it so we
have to use different data extractor or
this different data transformer so you
know if annotation is pretty easy you
put inject everywhere you know why I use
inject not out of wire or EJB or
whatever who knows what they inject is
yes it from common dependency injection
so you can use it both in jb stock java
ee and in in spring stock so this way I
can if I'm using injecting I mean I want
to offend both part it's not that I
because sometimes I'm misunderstood and
criticizing something and people see
that they're criticizing EJB and how
spring is much better now it's the same
so okay I want to be me I don't want to
be misunderstood and trying to offend
both parties so the question was how to
do that who thinks it's possible to do
that without annotation easily okay
because for me I said oh yes it's
possible but that's that's the wrong
answer the question is not how to write
it without annotations
how to use it without annotation the
question is how have you created such a
mess because come on a class has sex
dependences who has heard about a single
responsibility principle there is such
thing you know single versus sex it's a
little bit far okay so so now right now
I will tell you a little bit how can
what can happen because that's one of
the outcomes that may you may see and
how to avoid that okay moment just have
a technical issue you know I'm not using
annotations so everything can happen
okay
so contain ear based dependency
injections problem I'm facing I am by
the way I'm working on my daily basis
basis with containers with spring and
with Java that's the way I hate both so
that's the typical thing we have okay
not that common in code but there is a
user activity logger where for a given
user ID we we have some user repository
and from time to time maybe because it's
some kind of the business lock you want
to store activity what was user doing
for instance maybe he was bull buying
something on the page he was I don't
know creating a policy for insurance
whatever so we have this code here and
then some unlucky developer uses it like
that user activity logger with my user
perfect that's the constructor store
activity and you know what's what
happens there what happens not waiting
of course we why not put nine per litter
because the developer used a new keyword
because the first thing once you start
with injections container-based
injections you learn that new is kind of
forbidden because all the classes must
have been otherwise they won't work
that's all so that that's the magic the
the the young developers learned and
they preserve it later yeah so no new
keyword and even goes father may let's
let's say we fixed it
typical fix maybe that was a request who
knows request code beans
so though beans that really only for the
because you know the typical beam in
this in a spring version is just a
global singlet on o who likes global so
we can be smarter you use local singlet
knows there are those are scoped
requests so we put something in a
request scope like a user repositories
it's the same this time it is a bin I
don't discuss how it was injected but of
course it wasn't created with Venu and
then we realize maybe we will start this
activity but it's not that crucial so
maybe we can do it in the background
task with executor service there are
such things or maybe we used parallel
streams whatever
who knows what what happens here if I do
it like that
what yeah so that's a problem because
request sculpt are really tied to the
threat of the request if you do
something outside of this threat like
here on the other then you get typically
nullpointerexception again so the lesson
tool if you use container base
dependency injections is typically that
you know okay
threat we don't touch them let's are
forbidden so great no new no threat no
threats okay then the real problem that
i really face is sometimes what is
lifecycle of a beam because in in java
it's very simple object is created with
a constructor then i can use it what can
happen with this stuff it is created
somehow and maybe I can use it maybe the
something wasn't injected yet you know
this method like post constructor in
Java is very simple life cycle you have
a constructor after that you use object
in this stuff you have a constructor
which may be construct mostly not
because then after construction can come
come the injections of the fields and
etc etc so it's really great for
debugging and that's the the thing I
wanted to show with this magical service
because it's so easy oh it's so easy
like in basic in I've started
programming with basic in 1990 it was
really great language because I could
really be very
just because all the variables were
global that makes you fast so people
from this technologies that are selling
you this stuff learned if you make
everything go by it's very fast so you
are very fast and you can create bins
with 15 dependents is cool because
everything is global is no problem so
great great job and then the the the
thing that I'm really working every day
so run time problem detection system
compiled goes through all the tests and
then null pointer exceptions or detached
object what whatever happens on
production once in a month cool
that's exactly and the problem is if you
have not winter exception in Java in a
normal Java without this stuff what you
do either you read it directly where it
is and you know how it happens or you
put a debug line and you can analyze how
do you debug that the column that the
container didn't inject something where
do you put those breakpoint I don't know
it's really it's really challenging the
other thing is that if you write this
way that's what the that's the thing I
learned in a company and then in fact I
work for a few companies already even
Capgemini whatever that the java program
is typically composed of getters and
setters and on top of that mappers from
Gators to setters so once we took a part
in some kind of workshop where we were
trying to fix some just random code from
the console we adjust mmm running some
metrics selecting which code looks bad
but maybe fix able and then you know
from 10 teams doing that nine of them
selected mapper then I rest the whole
logic that we have in the company is
just mappers cool that's that's what we
wanted to write ok it's not really that
bad but it's really the code that we see
as bad that's those are mappers ok let's
go further
encapsulation problem so you know
sometimes you want to hide some stuff
but with with if injections work so
easily you can inject anything to
whatever so where is the encapsulation
it's gone ok cool because that makes you
faster encapsulation really slows you
down that's what we learn so all those
that I select you five years ago my
answer will be learned mo more
annotations because if you read I don't
know 15 books about EJB and spring you
learn for every of this problem
background tasks whatever there is a
specific annotation that fixes the
problem and then you will have even
better hull of annotations that all that
will be very very consistent and will be
working but I have a conclusion to that
it's just not Java anymore it's some you
know what's this because I was
programming in 2000 with Java I was
doing this big system with Britax annals
well who who has programmed really XML
in the past so that was officially a
Java developer but reality does what is
XML writer so I was XML writer and
realized this stuff is simply this the
same external but just embedded in Java
sources it's just like this is it really
that better actually it is a little
better to have it in Java sources but
it's really not the change that I wanted
so solution there is a solution posted
from the guy I wouldn't expect to help
me so you probably felt who has seen
this topic before why field injection is
evil yeah so it's from Oliver geek so
from spring guy really great and he
posted this there is a page on that in
Internet you can read it that with this
example that this field injection is
generally broken because okay that's
exactly what I was trying to say that's
just begging for a nullpointerexception
I totally agree and he proposed a
solution that's already working
perfectly in spring you can use
constructor well annotated with inject
but generally constructor and then if
you put it here your dependency and it
works and you have like in normal Java
you have constructor you can't use it
directly because it's injected here but
it's a step to better well so and he
stated there which I totally agree
this approach means better testability
you can test this thing without the
container and without morphing which I
then talk about later dependencies
access so if you have six of them
you will already see the problem because
you will be writing six parameters
constructor so it's better to see the
problem earlier great is ex-exactly
because if it's ten or sixteen it's
already too late to fix it it's just
horrible so if you see that you are
adding fourth dependency then you might
think about refactoring or whatever so
maybe it's better encapsulation really
constructor constructs an object that
really is finished and like it's
supposed to be an object-oriented
programming okay so there is this post
and I think it's a really step to the
better world it's not the final step
because what is what was mixed missing
there is my point of view dependency
injection is great in the moment from
this Oliver Gurkha example you remove
this one last inject so you'll stay with
just constructor because command
dependency injection doesn't really mean
you have to use container it's just the
way that you combine your object that
you compose your object in a way that
you you don't nest some abstraction in
unwanted transaction in your code so the
ants were in fact I took time and I
refactor a refurbished completely the
original code of the poster with this
magic service with this six annotations
it took me really lot of step steps to
do that and moment I just do some magic
with my presentation and gene took me a
lot of steps to do that but the outcome
was I was I good I got some really nice
coat the this story is posted on the
internet but I can send send you link
later so the magic service after few
iterations of channels became this class
magic servers with magic services with
two two dependencies and those both two
data producers a data processor
processor have some others and became
more testable and I could use it with
new keyword like normal human beings and
it was just a Java by the way I also
removed for instance exceptions and
change them to either who knows either
from java slang it's great you should
stop using checked exception and try to
convert to try
or to either it's really way better okay
let's go further and by the way if you
are thinking it's probably not that
sophisticated
in fact indeed people use some patterns
that help with this dependency injection
done well with Java so for instance
there is a cake pattern I don't have
enough time to discuss its detail but
the cake pattern comes from in whatever
I've seen it is from Scala word so how
can you compose objects and how can you
disjoin this Despard when you decide
which are the final implementations that
that's the value we want to so we want
to write clean logic but we don't want
to embed their exact implementation for
instance if it was MongoDB or we use for
instance in memory DB or whatever we
don't want to put it in directly in the
code because it would make code less
testable so there is a solution for that
it's very funny with like right now
default metal interfaces so exactly the
usage we will see at the end like for
instance we can now right now have local
user repository component that is used
in creating repository from I don't know
maybe in memory whatever repository and
manga user repository that's all that's
not an example that comes from the Stack
Overflow in fact and then I can create a
class local app that uses with with
implements user service component and
local user repository component that's
the java approach for the cake pattern
this is a little bit verbose not that's
that elegant as the scala one but it's
solves problem and there are another
problem sometimes you have this I don't
really like this but maybe you are lost
what's the first I have a couple of
objects and I just lost the idea I would
have have to create first what later in
Scala there is a great construct called
lazy Val so it means the value that will
be evaluated when it's needed and if so
for instance this service needs another
service to be constructed it all will be
automatically created by the way of
course spring does it for you pretty
well but
you don't need a spring for that whole
you don't need a B you can do for
instance lazy that's from with lazy
that's a class from Java slang again the
same place where either comes and then I
for instance I can create a lazy service
one lazy service too and in by creating
implementation service r1 I am using
service too and it will be automatically
lazy evaluated with the correct order
quite honestly I'm not using those
patterns too often because in reality I
use it make it very simple so that's my
that comes from that sample project I
posted on a github that's where I had a
user service that was using two kind two
types of repository user repository may
be a database with users and session
repositories are mostly in memory
storage for sessions like typically
somebody logs into the game in this case
and all you register user to the game so
this is how the class looks like I don't
come to the data's but we see two
repositories so one solution would be
maybe to say that there is a default
default constructor and then I decide
well let's use new I don't know MySQL
repository and in memory session
repository so I could use default
constructor here and that would work
that it's quite okay solution but it
makes you makes your user service right
now really knowing something about the
details so it makes this let's abstract
that's the breaking of abstraction
that's mixing of abstraction
so exactly dependency injection in the
core means that I can remove this I can
remove this part of code when I decide
to some other class in this case quite
often I I name those classes like that
user model so user model is simply in my
module of users a special class that's
quite honestly that's the XML you don't
see the XML because in the Java it's
exactly the decides which are my default
repositories yeah which are for sessions
for users and I put this code there all
the stuff that I need to create objects
to really inject
I use this classroom test I use this
class for for white constructing other
services
that's very simple and that's natural
object-oriented way of just doing
dependency injection no container here
no magic simple like that but of course
sometimes you when you try to do this
you find an obstacle really who is using
Tomcat on a daily basis who is using
some kind of other application server
like I don't know WebSphere whatever so
who is using something completely
different so who is reading jetty who is
using Rat Pack one guy so exactly the
that's the thing we've used this
classical servlet based application
servers your your choices are quite
limited this won't be really funny
because the real fun is the real you can
really use the dependency injection in
the right way one while you in the
moment you make yourself free from this
yeah ugly stuff and I will show you this
solution is exactly for instance the Rat
Pack so that's the how can you write
rest service in Java
without containers without application
servers so you know program should be
like a story and I learned something
about the stories they if you want a
cool story in Java it must start with
what the only good stories in Java they
start with public static void main
something that is long forgotten in
history but the only way to really make
it well so by the way this is not a nice
part of the Rat Pack I have to declare
this no exception but then I write now
I'll create the server for you it's
really easy create server that's my
class by my method I will just define it
right here so it's like static Rat Pack
server that's a class from Rat Pack
create server that's my method troves
exception that's not really nice I know
but for simplicity I use it here I will
return a Rat Pack server of such
definition that for Rat Pack service
specification I will fill with this
specification say the sub the sir
config is done this way Wow
by the way it's not really needed I
wanted to show you how to configure
server I hope you configure the server
with one thread by the way it's great
because it's non-blocking server so it
means even one thread can handle I don't
know thousands of connections concurrent
that's not a problem if you don't
believe me you can try it and it's even
quite often it's more performance that
lot done a lot of threads in Tomcat
there is a reason technical reason for
that you can read about mechanical
sympathy and stuff like this so that's I
would like to create a server with
Fibonacci counting Fibonacci so I decide
that there is a one hander that after
prefix football will with parameter n
will just count me Fibonacci number so
it should be easy by the way I I put it
to some other class ok moment so it's
like this other hand this I can put put
here and then I can I just just at the
moment moment I make it a little bit
better
that's what how I created the server
really right now at the only thing
missing is I have to create this method
Fibonacci and it'll be okay with the
handler for a moment handler looks like
this and then the method Fibonacci sorry
just just just couple of seconds before
creating real server as you see I'm
using lot of lambdas because the in fact
the Java 8 lambdas made writing such
server was really easy
it was possible before but wasn't really
looking nice right now it looks for me
quite ok if you get used to syntax
you're very very performant with us this
approach so and right now I will call
Fibonacci and yeah that's it and then
method Fibonacci okay let's let me let
me do this so Fibonacci I'm doing it
with this slow to show you how the how
it really takes to create a server and
it would be Fibonacci you know very very
easy we can create it like that
Fibonacci and minus
one that's the best best approach to
fibonacci ever the fastest of course you
know that it's great so that's the
server and maybe in let me let me try
this server I will prepare for myself
here the code sorry you don't see this
but I will see the server is not yet
started I don't have a great engine to
start it here so it will be not not
perfect but if I right now call this I
should see the Fibonacci 50 numbers of
Fibonacci it's eight how cool
so it work yeah great so eight number of
people that she is 34 super so I had a
server so what was this this for if you
do write server this public static void
mind is all dependency injections manual
poor-man's di with Java it works so much
easier for you so the server doesn't
break you by the way the great thing
about this is how you test that so I
won't click the code I will just show
you that's how you test the server and
it's the best test the black box testing
inside of the test I start the server
exactly the way I've written it and then
I'm using the HTTP client I assert that
the server is giving me Kyle the exact
response so a lot of you would would
think that's kind of testing is stupid
because starting a server Wow that every
test that costs a lot you know how much
time the rat pack starts even it's not
this configuration the real one with
couple of services who knows this 100
millisecond 16 so I measured really in
the project where I had some something
more complicated than hello world that
was 16 milliseconds for each server
start in the tests come on this means I
can make over 50 such tests in a second
that's already good enough okay and I
think that's the way you should test
risks rest services if you like if you
prepare them okay but what if you have
containers so inside of CSS insurance
physician we use a lot of Java EE we
have containers so how we'll do we deal
with them we've created in fact quite
quite nice part
because when you are in doubt that's the
lesson from last year you should build a
wall so we've built a wall that's
typical we have some bin and that's the
problem because some inside of our
server gives us entitymanager gives us
connection to other beans and all this
good stuff so how can we keep being
clean so we in fact use objects that
exactly have this name delegate and then
inside of the business method at the bin
method we call create this delegate
which is my way cleaner that's not a bin
that's a Java class real one and then we
have their entity manager and maybe some
logic the calculator and by the way here
is the final class that we test sorry
just that's I don't write here but it's
typically in this class we don't use
database that's our logic so we're
writing this way in our business and we
are agile it changes the rules every
time then you want they are allowed to
so with this method we have quite clean
trial calculator which we can adapt
every day and we'll see what what tests
are broken and we can discuss with the
business once we are ready with a clean
business logic we can check it with a
real database because really come on I
will hope I will have time to talk about
it you have to test with the real
database mostly because you can have
errors in sqs whatever so we are right
now this is a little bit more dirty
class service service delegate and it
tests this logic against the real
database okay most in memory it's fast
enough and at the end we don't really
test those beans because it means we
would have to start the server what we
do is really do a smoke test has the
server started it means that mostly
beans were constructed is okay so by the
way it's just the who has heard clean
architecture from Uncle Bob so it's not
the way Uncle Bob proposed but this
alternative approach how to stay clean
so the approach from Uncle Bob I find
not that comfortable about okay it's we
can discuss that but it's alternative
but this is kind of clean architecture
keep your code clean color code clean
okay
does it mean that there are no sensible
uses from for this the
Injection like inject HIV out of art
whatever I think there are if you are
building a project that is composed of
some kind of plugins you have different
jars you have three jars you for one
customers you deploy to four other
customers we just maybe then the
solution would be to use auto wires it's
cool it's great for that but if the
whole code is mostly that's mostly what
we do back-end systems that is exactly
have one customer all the times are
deployed the same then it's just misuse
you don't need a container for that so
every time you inject something that
it's not known and compiled time you may
think about using this things but
otherwise I don't think so okay so
that's one topic probably the biggest
one but right now I have to address
other things so this is really for me
connected in fact ah yeah if you do it
with suffer I found this in the
Wikipedia this text and it really
describes this turbines of stomach
digests lots of Appetit if you do it
will suffer this you know what I am
talking about lack of libido buy of pain
what a finally suicide even I even found
in a very old book it was friends so I'm
not really sure if they were describing
that what I think what I think it is
that that's more than 100 years old book
so I didn't know there are so we're so
technical enhance is that the picture of
the guy doing that you know all I am
talking about locusts more kists that's
the sorry for me it's just TDD
masturbation sorry like and it's
typically comes with this kind of
dependency injection you have six
injections so you'll mock them and then
you test so this code comes from the
real post somebody was asking for a
review of code that's one was on this
polish Stack Overflow for programmers
page so if this test this test it's okay
so we have flashcard service does uses
flash card repository this way and then
we test it great test
so when flashcard service find all the
unreturned get flashcards does the
mocked response and then we assert that
what is this test testing do you know
it's testing mojito it's great job for
open source project so some people may
say ah that's a mistake here because the
guy shouldn't have mocked the flashcard
service yourself
mocked flashcard repository this way
would it be better well kind of but come
on I've seen the code that hit here like
the 906 calls of something bla called
something called something and at the
end mocked response so no matter how bad
was the system all this goal code here
was not really working
but the final response was mocked and
the test works were green cool you can
go to production rather than a problem
so okay I don't cover this topic but
that's what I typically see it's more
often that I would even expect so it's
cold even a London School of TDD it's
people use it they think it's ok but
it's a great danger of testing only
marks and by the way this is a great way
to help open source to help exactly the
outer of mockito step on February he has
the rubber he has the best tested
framework in the world and I felt
another ants man if you will use Maki to
verified that you then you will test
everything exactly
if this implementation is exactly
working like that ok
I could tell agree but then what happens
you have tests that exactly make repeats
everything that you have in
implementation has a great help while do
while you are doing rapid refactoring
because every time you do refactoring
you have to completely change the test
make sense don't you think so ok so and
by the way I don't say mocking is
totally bad if you have some external
resources io whatever then walking is
just necessary in such as very ok mojito
is great then the question is is
database external kuving's database is
external system and you should mock
database who thinks it's internal
so both parties are right even those
undecided it depends if somebody comes
to you to your team and says that's a
record database on this course with this
passwords whatever you have these tables
use them this is way this way and this
card that's a pro describes the protocol
how you cooperate with database that's
external system that's your API in fact
poor database driven but API you have to
use if somebody says you have to persist
this dis and information and then use
the sighs maybe I will use Oracle or
MySQL and we will use those tables
whatever that's an internal thing if
it's internal you have to test it
because of that for instance we test
with entity manager our things so we are
sure if we are doing them right so final
demo topic I want to discuss is let's
talk about aspects so not all the
annotations are about injecting think
there are aspect very very important for
instance on this picture you see aspect
that's that's really I think it's from
spring tutorial pre-authorized house
permission has parameters spring
security is great you can use all this
annotation and then transactional
concepts and whatever then you have you
can mark with does that unnecessary
stuff your method and concentrate on
your job you can even write your own who
has written and how it's called in
Interceptor and a time or aspect great
that's a great way of doing code because
then you have to face with real
object-oriented programming because
every time you whatever you take it's an
object it's cool it's really absolutely
there is no reason you could make error
here it's perfect
okay that's but but people like to write
those aspects it's really the the
masterpiece of the technology right
another aspect cool so there is such
aspect transaction cache validation
whatever security and yeah we have
annotations for that of course what what
else yeah and people say you see this is
really this is declarative now that is
not the clarity that is absolutely not
declarative does is this is pathetic
stuff and what I call it it's strangely
type so you have strongly type languages
this is
strongly typed system you have the real
logic in the strings cool okay so can we
do something about it so yes we can of
course does this there's in so that's a
that's of something that comes from my
code do the X so do transactional that
takes a function from a session that's
hibernate session to T that's my result
and takes a DB comment that's command
just the function and this is how I use
it
the do transaction maybe this a static
method sorry I didn't mention that
public static so it's written once for a
system and then you can use it with a
session I just using hibernate session
at the end it's committed here and even
in this system I needed something like
that sometimes was appearing constraint
violation exception but if the
transaction was retry it it would just
disappear so here some very crazy stuff
with recursion we can retry the
transaction of course mostly you don't
need things like that maybe we'll end
with Stack Overflow here in the other
cases in this case that was a real
solution so you can this is high order
concept function that's think you can do
without any problems right now and by
the way doesn't it doesn't mean you have
to write this do to X method by way I
typically need that rid of them they
already written there is a great project
jlq from Lucas leather Lucas other and
exactly they it provides you those
methods so exactly here I have created
transaction and they I have transaction
configuration it is exactly the object
that has all these sessions and things
that you need and at the end you insert
two database with the fancy way
functional way that Lucas provides this
is the way you can do it without any
annotation just functional way with all
other functions this is so much easier
to test to debug whatever yeah so that's
a great thing the same thing you can do
with a secure for instance here is the
case where I do do secure method and
then for every request
if a person has permission right I can
use this so of course right now this
mission things is embedded in code is it
bad no it's not really bad because you
can debug it if it doesn't work you
don't have just nullpointerexception or
everything works you can debug it it's
great great you can provide your own
implementation that's cool okay so good
annotations all our notations are bad
not really we have a couple of
annotations that I consider quite ok
couple of them who knows all subs opps
sorry
something has just obscured my system
overwrite and functional interface both
of them are for compiler it's great
because you can use them to for instance
check if the functional interface is
really functional interface or or
something really happen who knows
immutable
that's a new thing you can mark your
classes and it's immutable and by the
way there is a project Internet the
whole game point game that I've written
only using immutable code it was
possible not using annotations just
immutable at right now you can do it in
Java so writing fully functional code in
Java will think real stuff no label
that's ok by the way you shouldn't use
null at all but there are moments when
you cooperate with some API and then you
say ok this API needs null so maybe I
will mark that this thing is not able ok
I can angry sometimes you need it but
then in there is not know who thinks
that not know is ok annotation a couple
of people I think it's horrible because
on the first place you should never use
null and if you should never use null
does it mean you have to put not null
everywhere not not not not not not now
that would be great so I should say not
being not null
not now darling it's just mandatory so
this thing should be just skipped it
just should be assumption so only in
this rare cases where you have now you
could use nullable that's the point
there are some other useful for instance
test dynamics as you know from J you
need that help you the build system to
find out what's the test so compile
build time checks with annotations are
ok
I can't completely agree that's exactly
for instance color uses the same so
that's that's ok think so what we have
now
maybe there's some other civilization on
Taoiseach Jason sterilized Jason created
examine route a lot of them are there
okay I say they are efficient I would
but it's not perfect solutions for
instance call what they already migrated
those those things to macro oriented
solutions macro macro sound bad I think
for you macro but really in Scala they
did this macros not that bad and quite
away seeing the problem seeing the
problem at compile time with macros is
far better than seeing a problem with
reflection at runtime which happens with
you have these annotations but for a
moment in Java world that's the only
solution that I would say is efficient
so yeah we we can accept them I can
accept them I can live but right now
another topic very similar I like the
history I read a lot of books and I even
read some papers from the past from
medieval so that's what I find you know
that what is this
that's quite famous paper paper Magna
Carta John by the grace god of King of
Aragon Lola
that's preamble so every medieval tract
starts with preamble and then you think
that becomes the real part no no that
before that's a second part you know and
it goes farther when you check it bla
first no it not not real start and then
I marked it yellow starts the real
sentence they wanted truth but lot of
preamble before because you know writing
in the medieval time was like a bit a
little bit of magic so you have to put
some incantation and you know that's
this Magna Carta think and I realize I
see this pattern in Java sorry there's a
real code I so I can not show you what's
there but preamble is with annotations
like to this moment it's 2/3 part of
these codes are is preamble what kind of
I'm talking about sterilization to
database so it's it's JPA really we have
dis monsters with JPA that's the real
thing named query 9th query 9th query
and then call um I don't know table yeah
and
a lot of other stuff I don't know cashed
be good entity blah blah please true a
lot of done and then at the end this
poor little entity really really far
away that's what I see and okay I don't
cover this topic but I don't think it's
really normal something wrong has
happened here so writing for instance
this SQL with some regular library not
that magic would be probably more
sensible so it's just JPA it's too
verbose but there is a second problem I
don't have to discuss I don't have time
to discuss this but really there are a
lot of plaques of JPA
especially I would say people know SQL
developers I work with no SQL they know
how to solve the problem with SQL and
they they spend week trying to for
instance do be bi-directional our
association with JPA and convert the
queries to JP a query language how cool
is that yeah and they for instance
that's especially like managed data
object so I have object so I assume I
can call a method not in JP a because
maybe there is a lazy fetch and the
object is detached so how can I know
know that that the object is dead touch
how do you know that the object is
detached from the session that you you
don't you can't call the method on that
it's very easy you just have to track
all the code down after a week you will
know super so great so generally I would
say JP a from my point of view ten years
ago I thought it was a perfect thing but
right now I right now I might experience
that people only waste time with that
and if you have a problem productive
problem with JP a like with manage data
why I fixed the this kind of problem
last week for instance it took two days
two days fighting with JP because
exactly one of the bins there wasn't a
real bin
it was CDI being noticed even though
marked with stateless and because if
those CDI bean it wasn't starting a
transaction so I have detached object
summer how cool it was really funny so
in jlq or mybatis you write something
that looks like sql's directly you have
very easy lifecycle if you update it's
updated how cool is that
with JPA where is the update in JPA it's
missing so because there is a delta
checking everything is automatically
flashed to the database it is very very
smart but developers don't understand
that so I even worked with a very smart
architect that has seen this problem and
he provides for them update methods so
you could called update with an object
you know this method was empty but it
was okay to make developers satisfied
they will have this feeling that okay
there is save to database in fact they
were okay so I propose you don't use
this magic JP is not the best solution
you have easier so I am going to to end
this talk so resources for that great
resource is this field base injection is
evil
Mario fusca created so rewritten Ganga
for two lambda so how can you do do this
stuff better because previously this all
these aspects and things like that we
had to do we had to do with now object
oriented wave wave with patterns it's so
much easier right now to use just high
order functions nothing more there's a
great video of that I think that this
talk will be made today so use this use
this power dependency injection invasion
from Uncle Bob he exactly says the same
it's great dependency injections you
don't need any container for that and
notation mania it's really great page
that shows you what what what others
think about annotations so and
technology rather about application
service if you don't believe it nobody
should right now use application servers
yeah you start you know project and and
there is a one project I made to show
that with a rat pack how do you create a
clean out of notation free architecture
it's called rat Punk okay so maybe just
last words annotations were great but
solve some limitations Java one point
four and five but relies on magic and
this magic really hurts after a moment
in the year 2017 use lambdas
don't use application
service your motto should be compiler
first in switzerland ii now test ii and
reflection magic last and let's make
java great again and ok one question
there is a time for wrong question well
from mario that's gonna be I didn't try
that but I could try maybe yeah
so CSS like style sheets and things like
that no no in company so at the moment
in company we have mostly web speed and
we have other servers like Adobe
whatever and but we are exactly in this
moment we are building first servers for
servers based on docker when you just
start fat jar and you do what you it's
all not the moment not in production yet
it will come later
we'll see yeah that's okay I am in a
company that has some limitations
because of that we use this wall pattern
we don't we are not really adapting
everything we are trying we're showing
but not that it goes to production that
next month of course it's insurances but
I think it will come that's the goal
okay so thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>