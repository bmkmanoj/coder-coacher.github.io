<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Java EE Microservices - the Payara way by Mike Croft | Coder Coacher - Coaching Coders</title><meta content="Java EE Microservices - the Payara way by Mike Croft - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Java EE Microservices - the Payara way by Mike Croft</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fn444op9gW8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone so thanks for coming this is
going to be a yeah just a quick talk on
Joffrey microservices using pyara you
know what features have we got in pyara
that enable you to take your java ee
applications break them up into micro
services in the easiest way possible so
let's get started we haven't got along
so Who am I I'm a java middleware
consultant I've been working with lost
different sorts of java middleware for
quite some years now most recently with
pyara which for those of you who don't
know I expect that some of you at least
do already pyara is a build of glassfish
so that's been out since last year it
was released in Java one last year yes a
pie our support is my my main job at the
moment and what that means really is
that I'm not a developer and that should
reassure most of you here so I don't
write the code that goes into pyara
that's done by people that are far more
competent than me that's always
reassuring some on Twitter that's my
handle on twitter and you can you can
find me on there so we've got a few
different hashtags as well if you want
to ask questions I'll be checking those
at the end and yeah at any point of the
day any point of the year I would always
rather be snowboarding so who you I can
just about see some people so just a
show of hands have you got some
developers in pretty much every one
that's what I expected Ops guys anyone
whose operations no okay just me how
about DevOps so you've taken on a bit of
yep okay got a few cool how about
everything you know you manage you just
finds a job to do with IT and just gives
it to you anyone like that no that's
good no one's that unfortunate so just a
bit about what this talks actually going
to be about because
it's got a title that may not be obvious
to everyone buzz words and opinions
tends to be what comes along with java
ee microservices micra searches in
general things like cloud things like
DevOps it's almost as though every other
talk at conferences like this has got to
include one of those keywords but it's a
tools an action talk so it's going to be
about pyara and it's you're going to see
a little bit about how to use it so what
is pyara I've already said that it's
built from glassfish which is the java
ee reference implementation and what
that means is that when a new spec of
Java EE is released by Oracle they
release it with glassfish and as pyara
we will support that right from day one
it's entirely open source under the same
licenses glassfish forever you can
download the source code do whatever you
want with it you can download the build
version as do whatever you want with
them you don't have to pay a penny it's
all free if you want to just have a go
and get stuck in with it absolutely go
ahead and do that it's very active
that's one of the key things I always
look at with these kind of projects I
was like that if it's something new that
I've not really heard about I always
look on github see is it active a lot of
people working on it and i think is
pretty active there's a lot of issues
get raised and more importantly a lot of
issues get solved on github we've also
got our own kind of internal customers
that we support on that as well and
you'll see all of the fixes that we do
for them go into pyara it's also
released quarterly so we get those to
you as fast as possible and if that's
still not fast enough for you we also
make available snapshot bills which go
through the same testing as the rest so
PI R a micro then I'm trying to whisk
through this because this is this pi our
micro is really the meet at the talk so
PI R my very first thing is that it is
actually micro it's quite easy to see
Joffrey and think how on earth can you
have Java EE and microscopes is in even
in the same sentence but modern java ee
really does not have to be as heavy
weight as it has been in the past and
that's evidenced by the fact that jump i
arm
is just 58 megabytes it's a complete web
profile implementation with one or two
of the specifications so it's elastic
we've got hazel cast integration with
with pyara micro which has a really cool
feature of auto-discovery so you spin up
hazel cast nodes they automatically
discover each other enjoying the same
cluster you can do exactly the same
thing with PR micro because that's
what's underpinning it and also for free
you get a nice je cache compatible
implementation which is great it's fully
embeddable if you want if you want to
include in your maven project you can do
that again this the sum of the key ap is
that we support so they're all taken
from a blog post that we've done you can
see this pretty much web profile we've
also got j batch and j cash for lee some
of the extras they're the most key one
thing that i haven't put up there is
that you can see we support CDI a
relatively new aspect of pyara micro is
that we have got an interface for
clustered CDI events so you you run a
CDI event on one cluster member it can
propagate amongst the rest of your
cluster and it's on maven central and
there are the maven coordinates for you
if you are interested in those so that's
enough talking so I'm going to straight
into the demo the scenario took me a
little while to kind of disk pin down on
what exactly I wanted to show you guys
generally people seem to be going
towards or certainly on the mailing list
I follow a lot of people really keen on
this idea of fat jars for microservices
I'm not entirely sure why doesn't seem
like the easiest thing to work with as
far as i'm concerned i can understand as
a developer it's easy to just you know
build and package and then that's that's
it you just do surround jar file but in
terms of managing and integrating this
into a production
level build process I would much rather
build a skinny war rather than rather
than a fat jar I don't want to have to
rebuild the application server each time
I just want to build a minor aspect of
my of my application so in this demo
I've gone for a skinny war restful api
it tends to be what everyone wants from
a micro service it's a really common
pattern if you're going to do a micro
service it's probably one that you
should really support data center or
cloud couldn't really decide between
this one so I'm going to hopefully Wi-Fi
depending demo both so firstly i'm going
to look at traditional hosts and the way
you might do things with with just a
local deployment on my laptop so the
environment mate maybe you're at you're
developing yourself and you just want to
run it locally we'll show that then
we'll look at a traditional just ec2
instance it's just infrastructure as a
service rather than platform as a
service and i'll be using vagrant as my
tool to interact with that next we'll
have a look at containers specifically
darker darker seems to be having a lot
of focus so far this this devoxx I've
seen an awful lot of darker talks and
then possibly if this time depending on
how quickly I get through all this we'll
have a look at actually something that i
use personally when I'm working back in
the office which is a couple of docker
containers that I've configured to boot
up from scratch a complete Java II full
profile pyara cluster with two nodes and
four server instances so first bit of
the demo hope this works so to start
pyara micro it's just
very simple one command Java minus jar
pile micro jar so let's see if my
virtual machine works okay that's a bit
small isn't it annoyingly this terminal
doesn't have an easy way to change the
font size so let's
okay is that it can everyone read that
do want to make it bit bigger and sir
okay so there's my pie our micro jar if
you wanted to get this yourself you
would open up your web browser go to the
payara home page front and center we've
got downloads link the latest version is
for 1115 for now just a quick note on
the naming convention we've got 15 for
at the end that means year 2015 quarter
for so it's the final quarters release
of pyara you can see we also got pie our
blue is using IBM JDK and there are
lists of links it so we've got the full
complete full profile web profile
minimal which is literally just an osgi
container that scott jax-rs in it and
pay our micro which is what we're going
to use just now what you can also do as
well just up here you can see we've got
pre release builds now these are our
snapshot bills so that it points to a
location on on our Amazon storage
service and every time we build a new
snapshot that gets updated so if you
really want to be bleeding edge and
that's where you'll do it so just said
to start pirate micra just do dark java
minus jar pi our micro jar and we can
see they're starting up now that this is
the same kind of logs that you if you've
used glassfish before you'll see and you
can see that's it done so the bottom
we've got it's what mask on here it is
we've got deployed 0 was which isn't
massively helpful so we're not really
doing much further up we've got a little
cluster information so we've got one
member that's the hazel cast port there
so and any other cluster members whether
it's a payara or just a normal hazel
cast node would need to
detect I are on that port so excellent
it actually worked which is the biggest
relief the demo didn't fail okay so
let's let's start another because it is
all about clustering isn't it so let's
put that into the background and
continue it okay let's run that again so
now as we can see that starting up what
we should see is there we go so it's
clustered this is good and oh we've got
some errors we've got some errors
further up we've got I just kill that
right at the top you can see that this
is probably something that you may well
have come up against before shutting
down due to start of exception bind
exception so what is saying is try to
bind to port 8080 and and I can't so
what we really need is a nice magic way
for us to not have to care about that
and what we've got to do that is minus
minus auto bind HTTP so let's try it
with that
so now that should start up and what
that basically does is it starts up it
starts at port 8080 so that's in you
still just incremented he'll just add
one what we've also got is auto bind a
autoban ssl which is if you wanted to do
the same thing with the HTTPS port we've
also got Auto bind range there was
someone who asked me on the on the stand
downstairs can you limit it and the
answer is yes I didn't know at the time
but i double-checked and yes we've got
auto behind range so you can say okay I
only do it for the next ten port numbers
and we can see that's started correctly
which is excellent so yeah what about
actually doing something useful because
all we've done at the moment is just
start up an app server that's not it's
not really that impressive is it so the
next stage what I'm going to do is show
you this je cache example so this is one
of our sort of pyara samples which I can
show you it's on github so if we go to
the github / github.com / piatra you can
see down here we've got this pie are
examples project and there's quite a few
in there and what I've got here is the
rest je cache war from rest examples and
it's the only one that's in there the
rest je cache example a few instructions
on there as to how to run it and this is
basically just what we're going to do so
we deploy with this minus minus deploy
command because we just deploying a
single wire file so let's do that now
and what I'll actually do is put that
into the background by default and okay
so that's Stein up let's let's do
another one actually and another one and
let's let's start one in the foreground
excellent so so that's going to start up
what we've also got I've got I get that
Sh and a put dice H now what that does
is basically just encapsulates these two
curl commands and while everything's
starting up it's probably already
started to be honest but explain
everything a little bit here so this is
basically all the all the demo is we've
gotta get and a put for our jax-rs
restful web service it uses the cash
result in the app cache put annotations
for which is a je cache API standard
cash name being the rest minus J cash
and you can see that we've got a path /
M key and cache key oh it does return no
value but that is actually just a
default return so if it finds that the
key already exists in the cache it will
return the value of that key if it
doesn't it will just return no value so
the SH that I just showed you it's just
this just IP port and a default message
which is different to the no value just
so we can see working sensible defaults
and we've got yet just to put command
accessing where resources / cash k
equals test
and the gate command again the same take
a few variables but we've got defaults
as well to use there so what I'm going
to do is put a value and then get a
value and what I'm going to do just to
make sure that you believe me that it
does work is put and get from different
let's move that look the way put and get
from different application service so
let's call put that Sh with well we'll
just call put ice age that's not worked
so what happens there is that it's given
me a 403 forbidden and I would guess the
reason for that is because I've got the
endpoint wrong I think it's deployed it
in in the wrong way that's quite
irritating this is something that does
happen with live demos unfortunately so
what i will do is I'll try once more
before I move on because it's we haven't
got a huge amount of time
it's just double check that we are
listening so yeah we have got a port
open on 8080 ok so that's not worked at
all what I will do is let's go and get
the put command and let's just do this
so now what you'll notice is that
actually because the the way that I
built this I've changed it to just
remove the the version number that
should give me an uncertain oh it
doesn't ok let's just try last time no
excellent that's a good start so let's
just hope that my next demo actually
does work I reissue that it has word all
day many many times today but I can't
this is just what happens so what would
have happened is that I could have given
you the put I could have just applied a
different IP address a different port
number and you would have seen the same
thing it's not a thrilling demo but at
least when it does work you can see that
putting something in to one cluster
member will also get propagated to
another if you kill the original one
it's still existent in the other one
we've got like a separate layer of a
cache which we've got in built for pyara
to use a place where you can offload
your your HTTP session data so the next
thing because I'm pressed for time we'll
have a look at AWS so now this is where
we need to configure hazel cast a little
bit so hazel cast provides a couple of
different discovery methods one is what
we did see the the bit that did work it
was that it clustered all together and
it just automatically discovered other
cluster members on the same machine and
that's fine that's
early trivially easy to do in AWS we've
got two options one is to use the hazel
cast a doll us joiner which uses some
knowledge of AWS and the API there or a
TTP joiner where you give it a range of
IP addresses and just say just scan all
of these now the reason why I've gone
for the TCP joiner not the AWS joiner is
that I would have had to share my AWS
access key ID and secret key ID to show
you things and I'm not that stupid just
my demos don't work so here we go this
is the vagrant AWS plug-in it's
available on github these are the
instructions there's also the env
plug-in which is a way that I've used to
make my AWS secret key ID private this
is the vagrant file so you can see
there's just a little bit of
configuration for AWS you can see
they're just on that top line we've got
the access key and secret key nicely
hidden away which is really useful if
you'd publishing things on github so you
can just set your env file to be ignored
that's really handy and down here I just
configured for virtual machines to start
up so what we'll do is just do vagrant
up
and while that's coming up we'll just
have a look at the this is the hazel
cast XML file so we've got AWS enabled
equals false there was a bug that I
found when I originally did this in that
if you left the access key in secret ID
blank it would just throw an error so
that's just dummy data for that what
we've also got here is the that this is
the TCP joiner configuration so we've
got the IP range from 0 to 16 so it's
going to scan 16 IPs and an initial
member there okay extra fail so this
should have I still got right
okay so that's not going to work either
this is really going well for me so I've
only got three minutes left I'll do the
one that I know is going to work because
this is the one that I tested most
recently and I really hope it does work
because it's got have something to show
what i will do actually i'll get all
this on the slides will be on SlideShare
i'll put everything upon on github i'll
double check it to make sure it does
work and hopefully explain it there so
this is the darker example let's make
sure that this one works so you can see
we've got from n craft / micro java this
is a really small image of Alpine Linux
which is just a 5 megabyte OS with Java
on it and all I've done is just
downloaded pyara with W get into /
chopped and hopefully with the extra
commands that I've got I've got this
Rhonda SH to just run it for you know
spin up as many as this is I tell it to
do this should should work and we've got
just a couple of minutes left so we'll
let's hope it's a positive thoughts
please guys uneven the way this has gone
so let's do run five and then we can see
the container IDs that's a good sign
let's make that full screen so if we do
docker PS there we go we can see all the
doctor containers you see we've got py
micro one two three four five so what we
should be able to do is use the docket
inspect command and then path that's it
through to a grep for IP address and
that's going to give us the end point
that we need to do which is 117 2017 121
just put in one other one it's not 43
still I've done okay so we've got two
two URLs there so let's do put that Sh
1727 team o dot 121 8080 and it's but
something that we can see and hopefully
this is going to succeed okay excellent
so something has gone right 17 dot dot
one two three it worked one out of three
okay thank you thank you your your your
pity is is well received super so yeah
my time is actually up now identify they
did start a little bit late so if anyone
has got any questions you might need to
wave at me a little bit so are there any
questions on you know I can't answer why
my demos ruin but you know okay so if
anyone does think of anything or if
there's anything else that you want to
ask about pie are in general maybe i'll
get my demos working at the stand
downstairs but yeah we're in the corner
by in between the IBM and liferay so
come and speak speak to us all I'll show
you the demos again and hopefully it'll
work downstairs thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>