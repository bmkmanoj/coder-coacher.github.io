<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Android reactive programming with RxJava by Ivan Morgillo | Coder Coacher - Coaching Coders</title><meta content="Android reactive programming with RxJava by Ivan Morgillo - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Android reactive programming with RxJava by Ivan Morgillo</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Jnca7o4f-1k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm even more Jill oh and I'm the
author of our X essentials for packet
publishing my most popular app is a
personal project is a greatest ebook for
Kindle and it's a companion app for your
Kindle it's pretty popular the next half
hour we are going to talk about I'm
talking you're listening and learning
Android reactive programming with Erics
Java we have a few issue on Android and
Eric's Java solves a lot of them we will
see perfectly working examples so just a
little introduction reactive programming
is and I was an idea or by Eric Mayer he
created Eric's dotnet when he was in
Microsoft and a couple of years later
brain Kristensen formerly at Netflix
released Eric's Java and he saved us all
Eric's job actually is targeting the
Vista machine so is Eric's
closure Alex Scala Eric Scotland Alex
whatever right now we have rxjs or
expert on everything is going to
reactive because it's cool
and that's most of the reason because
it's reactive extensions and not just
Eric's Java the main the main point is
the data is a flow so we are not asking
we are receiving the data it enforces
the concept of push versus pull because
we are subscribing to data and the data
will come to us when they are available
it's based on the observer pattern the
one from gang go for observer pattern
it's all thing but we never used it
because it's kind of tricky in Java and
now we we have it
where our life is based on the observer
pattern because we expect things that
works will work in a specific way we
don't check the email we get a
notification we don't check what's up we
get a notification data that data is
coming to us the the easiest example
that you can you can say to your mother
it's the spreadsheet we have a total
cell and we update a few data and the
total cell update itself we are not
updating the cell manually we are we are
not checking that everything is in place
we just decided what will happen when
the data changed and our ex observer
pattern it's based on four let's say
four most important players the
observable that's the the emitting one
it's the entity that generates the data
and the observer and subscriber are the
receiving ends they are waiting for the
for the data and they know what to do
when the data comes in if you want to go
deeper there is a new adult for last
week by Jake Wharton about subscriber
because turns out that everything is a
subscriber in our ex Java and we have
all just a bunch of rapper that makes
things easier the subject it's the the
fancy one of the group because it can be
at the same time an observable and AdMob
server it can subscribe and you can
subscribe to it it's handy in a few
scenarios and when you start using it at
some point you realize that most of the
things that you do with subject could be
done with a proper observable observer
paid so you grow up as a professional
the observer the observable and the
observer communicate with an interface
we have three methods basically on next
on error and on complete when we
generates the the data the observable
pushed the data to the next and the
observer received the data and uses it
basically we got the data in your next
the uncompleted is fired if the sequence
is over and we are not receiving any
more items if something goes out we
receive an error call going practical we
are going to create a standard Android
app it's a material design F with a
recycled view and a list of installed
apps piece of cake so first thing first
how we do create an observable we create
a standard Java function that returns on
observable of some type of object some
kind we use the observable dot create
function to create the SUBSCRIBE the the
unsubscribe the observer Sciver to we
generate the data in a for loop for for
this example and when we have a new item
to propagate we call the on next and we
push the data when when the sequence is
completed we use on complete so we are
creating an observable from from a list
ID rating on the list that's not the
proper way I our extra eyes medals for
everything so there is a proper method
to create an observable list from a list
from you just pass the list and you have
an observable sequence of the kind of
the type of the list what if I only have
three object and I want to emit just the
those three object guess what just so we
have an observable just and we pass as
arguments the object we want to emit to
the sequence what if we want something
that an observable that doesn't emit
anything and just complete empty what if
for any reason we want something that
never completes it's just looping never
what if we want something that just goes
out because for testing purpose we won't
we are computer scientists we we like
stuff that blows blows up proves there
is a method for everything so now we
know how to create an observable
what now how we subscribe the example we
have the recycle view we create an
adapter we have the fancy swipe refresh
layout and we create an observable from
our apps list we subscribe with an
observer the observer looks like this
one it's just an observable observer of
app info it implements an interface so
we have our next and we received the
object when we receive the object we add
it to the list and we refresh the
adapter when the sequence is over we
just show a toast and when something
goes south we stop the recycle the the
progress bar and we show a toast message
piece of cake but the point is why why
should I learn Eric's Java if I have
they just need to show a list because
there is much more because we are
working on really we are working on a
real job where things goes not always as
we expected we
work with what we have most of the time
so we have this new boss that doesn't
like apps that start with a name
different with the sea
we just want apps that starts with see
how we want to write as less code as
possible so we don't want to change much
how do we do we add filter it's one line
it's a lambda because I'm using the
Reiter lambda most of you probably are
using Java 8 or 8 or lambda so it's the
syntax is fine we are filtering the
sequence with a condition filter just
evaluate the conditional returns a
boolean actually propagates the items
that satisfy the condition so in this
case start with C and here is our new C
named list piece of cake what if we have
a lazy boss that doesn't like long lists
take three and we just have a new list
with three elements what if we want the
last three object oh by the way the
observer is always the same so from now
on it Jones no because it knows nothing
because it just reacts to is waiting for
app info object so why bother him our
boss comes in and he is the kind of guy
that jumps to the end of the thing so we
have to take just the last three element
of the list take last surprise and here
is the new app John Snow is always there
I have duplicates so we have a list and
we want to get rid of the duplicates how
can we do it we can try to sum
I trade or comparator or something no we
have a rx Java but in my absence a
stalled apps list we don't have
duplicates because you can't install the
same app with the same name more than
once so we created the list we take
three elements we repeat the observable
three times so now we have a sequence of
nine items full of duplicates so how do
we get rid of duplicates we have
distinct distinct we'd simply mirror the
previous observable and gives us only
the value that comes that come in once
so no duplicates just know is always
there
I add duplicates but I'm leaving and a
dynamic environment because this thing
works on a complete sequence because he
has to pick the right elements we have a
current temperature sensor is the
easiest example we have this sensor that
is emitting the say the the current
temperature every second but we are
updating a display so we are we don't
want to over update the display because
it's just not effective how do we do it
we use this tintal until changed why not
it will mirror the previous observable
and we'll create an observable just with
elements that are new and we have just
known okay we have it the sensor and we
have a new or at least we have an item
every second but the temperature is not
changing so quickly so we have to slow
down we want to slow down the rate we
use sample sample takes an amount and a
time unit just know is always there so
basically we create a new observable
from the previous observable
and in a window or 30 seconds we take
the last item emitted if we won't the
first item in the window we use throttle
first because Eric's Java has emitted
for everything there is an operator for
everything and there are endless
operators because you can create your
own operator if you need transforming
our sorry our OCD boss has a new
requirement he wants everything to be
lowercase so we want a new we want the
same absolutes but we want it lower case
we want to change not that much code and
we want to apply a function to every
emitted item to make it lowercase
surprised map map is just applying a
function to an object to the emitted
object and returning something in this
case we are returning the object itself
but we cool for instance return on the
bitmap what if we we have the whole list
of app but we want just the bitmaps we
could use map to extract map and return
and instead of an app info object we
will return a bitmap object object at
that point just know won't be able to
understand anything because the observer
will be different it will be waiting for
an a different kind of object rx Java is
a huge amount of transformers for
instance we have flat map that it's the
observable brother of the map basically
when you start using rx Java you realize
that you are going to create a lot of
small observable function how do you
chain them you use flat map or conquered
map if you need to cast for every reason
the
limited item you can use cast if you are
dealing with
sorry the lunch was interesting if you
want to deal with the list instead of
single object you can buffer them and
buffer will emit a list instead of the
single object combining we are going to
use more than one observable we have our
list and we have the same list reversed
how do we merge those sequences
March you know rocket science the
observer is always the same what if we
are going to work with two different
observables we have our list and we have
a new observable that we create with the
interval operator that is just a meeting
and a long every second we have a
function update title that it's
basically chaining the number and and
and app info object data title actually
how do we merge all together we use zip
zip takes a certain amount of observable
up to ten and a function to manipulate
the objects and read that's the main
issue the main thread issue probably
it's it's this you have on in a Java
board with Java affects the same problem
with the UI thread it's a common issue
for this example I'm going to read from
from the SD card it's a it's a common
scenario we are just retrieving
something from from a memory or a
database or whatever and we are creating
a list of JSON and we are omitting it we
are creating the data we are creating
the observable we are getting the string
with shared preferences we are omitting
the the list when it's
and we complete the sequence everything
is fine we are using erectus Java we are
happy then we enable strict mode second
mode is a is a useful tool on Android
that gives you a kind of reality check
about how you suck being a programmer
because it reports strict mode
violations in this case this grid
violation basically we are reading from
the SD card on a in a blocking
synchronous way and we are wasting two
hundred and something milliseconds every
time so we are doing work on the UI
thread that means that the UI is stucked
when we are reading try to imagine a
network all it will it be even worse how
do we do it we we do we don't want to
change much we need to do the work on a
different thread probably we could use
asynctask know we have schedulers
relieve in our ex Java world we just
subscribe on a different schedule
schedule Sao basically use so you tell
Eric's Java to execute everything that
is above above the subscribe on on a
different schedule a scheduler Co
basically provides you a thread pool for
i/o operation so we are cool we are
doing the job on a different thread we
are not getting the risk read violation
anymore we try again and the app
explodes because because only the
original thread that created the view
hierarchy can touch its view that makes
sense because we are working away from
the main thread but we are updating the
list so we are doing the job on a
different thread but we need to be on
the main thread when the data comes in
how do we do that probably the async
task stop we we are working with directs
Java so we
Oscar X Java to observe on the Android
main thread and basically we to line
call code we are stepping off the main
thread doing the job and going back to
the main thread when the data comes in
peace okay concurrency with two lines of
code you can use it for everything that
I or related Network database whatever
this is just an example what if I'm not
doing our related stuff we have this
fancy fancy create function that
basically it's just wasting time at some
point we launched the app and the method
executes and we get app is not
responding we got skipped frames message
so how we do this it's not our related
we have other schedulers there are a
bunch of them in this case we can use
computation scheduler because we are
doing CPU bound operations we can use
immediate if you need to do the the job
on this very trade as soon as possible
trampoline if you want to be queued at
the end of the queue a new thread if we
are going to use a new thread two lines
of code so this is the real-world
example we are going to create a real
app using these tools it's the the
classic I'm asking stuff to REST API and
I'm populating a list in my Android app
basically 90% of the app on Play Store
we are using greater lambda because we
are stuck to Java 6 on Android but we
like the little arrow so I'm using
rather lambda I'm using butter knife
because there is just one man that can
create an Android app without a library
by Jake Wharton and that man is Chuck
Norris and
I'm not Chuck Norris so we are using
butter knife by Jake Wharton Lombok
because I'm too old to write manually
getters and setters I mean really rather
fit because it's the only proper way to
deal with the REST API on Android it's
by square they-they-they Paycheck
Wharton so still we use an Universal
image loader you can use because so
glide fresco whatever it's just a
library that retrieves images and it's
it's cool to use it's easy and it's work
it works here is the app it's basically
a list with an image a couple images
actually we are retrieving data from
Stack Exchange these are the most
popular users on Stack Overflow and for
every user we are retrieving the small
icon for the weather
from open weather map so we have two
interfaces that map that map the REST
API this is a retrofit 1.9 by the way
they have a new 2.0 version I didn't
have time to update the slides but yes
you should try it because it's really
cool solves a few issue that the stable
one the stable version has so we just
map the REST API it's really it's just
that easy I'm lazy and I'm creating the
JSON to power whatever with JSON schema
to Pasha I'm not you know come on really
I can create models manually I'm too old
I'm creating Stack Exchange API manager
because it's cool I like to think to
have things are sorted out so we are
creating a rest adapter we have a get
most popular as all users method because
naming is everything
it's returning and observable because
Eric's Java is supported out of box by
retrofit because you know smart people
but the result that we got from the the
Stack Exchange API it's not the perfect
match with what you what we want we want
a list of users so we apply a map we got
the result we apply an app to extract
the users we do the job on the
schedulers with the scheduler say oh and
we got the result on the main thread
piece of cake
here is the Android part it's basically
I'm not using a dependency injection you
should use dagger I'm not using MVP you
should use a representer because it's
the only way to properly test your
Android apps but it's for the sake of
the presentation so we have our adapter
recycle view we API manager and we have
this refresh list function that
basically starts the progress bar ask
for the 10 most popular users and when
the data comes in stop the progress bar
and populate the list if something goes
wrong stop the progress bar and print an
error on the log cut that's at 10 lines
of code we want the same drill for the
forecasts so we create an API manager
for open weather API we do the same for
the it's haunting the timer thing we we
create this get forecast by city method
we filter out the response that are null
or that are not quite what we want and
we conquered mapped a new observable
that's the one that is retrieving the
the app the icon because we are using
another function
that returns an observable of bitmap to
do the the fetching of the image it's a
network operation so we use scanner a
dot IO and when the bitmap comes in we
are on Android main thread so we can
change the UI and we can use the icon to
set the image view and we got the new
version of the app in how many lines of
code we are dealing with networking
concurrency we are firing up a
synchronous tasks like was no tomorrow
we don't deal with threads we don't deal
with whenever we are too old and it's
2015 we can do threading manually
anymore
so it was very quick and it's a huge
topic I could talk about rx Java for
days you will kill me probably but I
hope you get the idea
you have to stop to rely on getting the
things when you want them because it
doesn't work anymore
because we are living in a fast word the
user can't wait for you or your network
all to comes in it has to be able to do
something else
so we subscribe we subscribe and we
decide what will happen when the data
come in we use a different approach it's
a mindset switch it's hard to get at the
beginning but the moment you get it it's
it's done you could do anything else
because the moment you think about I'm
going to read from the database and they
are getting you they are giving you a
list you know that you are doing it
synchronously you are blocking
everything so why are not getting I'm
not getting an observable of list
and I can do other stuff in the meantime
it's a flow data it's a it's a it's a
flow it's a sequence
it's like rivers they flow you can
filter a river you can transform a river
you can combine two rivers into one
river and Whittle it still flow in the
end it will be the river you want it to
be because you work with what you have
but you need specific things so you have
to change the flow and you can do it
with a few lines of code be water thank
you thank you for attending and if you
have a question you can use one minute
or you can use Twitter or you can use
the app anybody has a question about
reactive programming so Evan bus it's
even bus gives you the opportunity to
the coupling rx at some point you have
the two object if you start using the Rx
the proper way you have you can have
interfaces you can have single
responsibility principle you know you
have object that do stuff and you just
ask for an observable and you just ask
for the data when they come in
you are not bounding everything together
because you're like in the example I was
using the the API manager but I should
use you should use
a presenter that do the stuff and
somehow you have the coupling because
you're using a proper architecture it's
not the technology itself that gives you
the power
it's how you to use the it's a tool it's
just a library it's not a framework for
instance that you don't look satisfied I
will I will make the source code
available on on my it's the source code
comes from my book so it's available I
will be available in on github in a few
days so we'll you will have a a real
example but it's it's just this one you
know because it Daisy this is the real
world actually you just ask for data and
you subscribe politely and when the data
comes in you got it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>