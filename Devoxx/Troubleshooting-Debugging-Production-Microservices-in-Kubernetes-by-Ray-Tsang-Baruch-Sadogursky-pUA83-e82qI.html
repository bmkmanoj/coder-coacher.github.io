<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Troubleshooting &amp; Debugging Production Microservices in Kubernetes by Ray Tsang, Baruch Sadogursky | Coder Coacher - Coaching Coders</title><meta content="Troubleshooting &amp; Debugging Production Microservices in Kubernetes by Ray Tsang, Baruch Sadogursky - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Troubleshooting &amp; Debugging Production Microservices in Kubernetes by Ray Tsang, Baruch Sadogursky</b></h2><h5 class="post__date">2017-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/pUA83-e82qI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah sure good yeah
here you go all right thank you for
coming on the Friday Friday yeah yeah we
understand that is this or going home so
we really appreciate you being here
instead of going home
yeah and hope you'll be happy down you
hear my name is Ray I'm a developer
advocate for the Google cloud platform
what that means is I like to bring some
of our best technologies to developers
over the world and also love to get your
feedback and so that we can make our
products better so you have any
questions please talk to me and they'll
or find me on Twitter I started is it
yeah and here's a very interesting guy
you should follow him thank you and of
course mercury yeah I'm Baro developer
advocate with Jeff robb so by doing
what's right doing for Google for a Jeff
fobb as well and I'm at a bar on Twitter
you can and also are very nice person so
you should definitely follow him I
wouldn't sure you still think it after
today's talk yeah Oh see we've repaired
the real page for you with all the
interesting information about this talk
and this animation doesn't work oh here
we go
Jerome slash show notes is the URL and
the slides are already there we'll put
the video by tomorrow as their box sound
very fast with releasing the videos all
the links about all the tools that we
are going to mention today are already
there there's a place to leave a
feedback and the small raffle begin to
thank you for being here and then coming
to this page okay so what are we going
to do today is to show you a you know
architecture where you can deploy and
manage your micro services and so we
make a little demo application here it's
intended like this is probably the
best-looking application I can ever
write it's black and white this mattress
that's heavy CSS investment here yeah
yeah yeah but but look it's got two of
the best application put together it's
got hello world and the guest book yeah
Sam do you have horizontal line here
yeah yeah yes however even though it
looks very simple it's actually got
micro storage services behind the scenes
right so what
you click on the one of these buttons it
was taught to two microservices behind
the scenes and it's going to say hello
back to you and also store the data so
you know at how about this is the
architecture we have the front end I
sent container we got two packets here
also containerized and then we got my
sequel and Redis so this is like micro
services at their best to write like
three lines from a screen you have like
5 micro sisters yeah yeah good job
yeah but hopefully because we didn't
half of all time so it's very simple
yeah but hopefully you can demonstrate
quite a few things about micro service
services but we're now going to talk
about why you should be doing this using
micro services but it's not say if you
do use it here I'll few things so you
can do so let's go ahead and let's let's
show do that yeah so here I have
deployed everything into communities I'm
running this on Google cloud in
container engine
well that means since I just click a
button like a five nose criminales
cluster because for such a loaded up you
need at least five notes yeah there's
gonna be a very very popular app you
know in a second and I have deployed all
of these things using kubernetes by just
writing out these declaration files in
with the yellow file and I deployed
everything in one shot
and once I Porter you can clearly see I
have my 2 ins this is Apollo or UI
because you know we need yeah we need
bunks and you know a high redundancy
right we have the front end with the
load balancer here and I deploy Zipkin
for tracing I have guestbook service for
that touch to my C going on that and
then of course here I have the the
front-end UI and let's just go take a
look okay and I just need to do is say
external load balancer and that's going
to route the request to to all the back
hands out a hat fear that's running on
different service and let's take a look
no no I think it doesn't work well that
way in best of you know you already got
the idea that we do a very modern
application here so we have what we have
white label error page with status 500
and then status 404 and then now as a
message
okay we thought the worst error message
everything um good news you have the
video backup of this of this demo right
I know I thought you're supposed to have
the video so ray you have failing demos
in each and every talk you do and you
still didn't learn the lesson that you
need to back up I live on the edge I
never have back up but you're supposed
to you have the back no well I guess I
said okay let's go
alright so sorry everyone I guess forget
it oh no come back no wait wait so so
you're right I think you're right um I
have failed just many many demos delphox
especially it's a bad bad bad experience
so two years ago I had a demo here and
at 1401 I think yeah I don't know if you
can see it yeah there we go
and I tried to run something by
connection yeah you're trying to connect
yeah yeah just yesterday yes yeah
just yesterday I also had a demo here
and also failed at thirty one you know
one thirty one hundred here yeah
somewhere around here I don't know it is
yeah I was I think I was trying I was
like : let's see it hey that's the same
slide yeah yeah you reuse the slide
that's why you're demonstrating yeah you
know what let's do something different
let's this time let's fix it how are
then that's nice okay fine let's see
what we can do to figure what's wrong
yeah all right
so so we'll be like a detectives in a
crime investigation in which you are the
murderer well we don't know who that
person is yet all right we'll figure it
out but but I know for a fact that this
is returning or we're running a job
optic yes and it's a journal don't open
the exception bet that's this is our
report assist when we see now in an
error it means not open the exception
Java okay so let's see what are you
running it's a soccer star vodka
branches right yes so let's try and see
how this image is built and what do we
have inside okay we would you make sure
you using what version so yeah let's see
here a in my deployment file I
can actually see which inmate right
deployed right so this is very very good
tip is that you always always need to
write a deployment file a llamo file to
capture of what you want to deploy so
you can actually go back and see quite
image that you use right so the imager
I'm using here is this wonder the latest
one of course hello world UI latest
yeah nice which version is it latest the
latest one we're doing continuous
delivery here of course it deployed the
latest all the time and is it the latest
that you run in staging or the latest
you run in production are they the same
staging at all I think I do I think I do
it's that's checked right so let me see
intranet ease you can actually carve up
the cluster into different namespaces
and within each namespace you can deploy
exactly the same application even though
we didn't have the video of which you
should but at least I have the staging
environment right so let me see here get
pods
let me see yes erasing see what scene
there we have a staging in point I let
you see if that works right and huh
interesting
the station works but that one does it
on the production doesn't yeah but but I
think that running is that because I
didn't get a lot of people have a
feeling of dystrophy now the staging
works the production doesn't sounds
familiar
yeah of course staging works you
wouldn't deploy something to deploy into
production unless if the staging works
okay so back to my question about him is
the latest on staging the same latest
let's take a look let's take a look so
to do that what we can do is to do you a
scribe oh sorry not getting described we
do it describe the instance that we want
to look at so for example the how long
were you like yeah and we're gonna look
at in staging first and here we can
actually see all the different settings
that you have for your container you can
also see some of the configurations are
you set but more importantly of course
it's like this yeah it's lettuce here
lasers there make sense this is the same
latest let's see so for that you have to
check the image righty
oh here we go let's compare the image
yeah so it's 473 II yeah at the end and
let's see what we see this aging the
production one so we take a pause we see
which instance you remember the last
four digits
right seven of them swim to the manger I
will check all right alright so
describe describe pod and let's see if
the UI has the same image here and if I
screw up yeah Evan seven eight seven
seven eight okay that's far away from
last four three on the previous slide
fair enough
that's good enough right alright so now
let's see how you build it and you have
the register right and inside the
factory yes and let's let's take a look
what do we know about this image so we
can go to this you're all the factory
right sweetie for every one factor in
the world is mine so it's you who broke
my favourite it's me that provided you
with this awesome registry okay that's
true so what do you do here yeah we can
search by checksum we have a checksum in
hand so we can go and check write checks
okay let's go take a look ah here we go
now we know that this latest is actually
bill number 50 so we make it progress
let's go and browse it okay so okay um
doctor info oh hey yep wait who's that
mark gee you're not mark no do we have a
drumroll and suspense music who is Mark
G any no I don't know but that but
that's not neither of us no no okay okay
okay well told you mysteries and okay
okay so here's your endpoint
yeah and then European point is running
Java obviously yeah we were right about
that here you go yeah and you run a file
that is called AB dodge are you very
copied in the previous step right yeah
so let's take a look at that and here we
go we copy file that is called a bar
which is again good job in versioning
any idea what is AB dejar it's it's my
application every every every one of
these containers has update yourself
much as they are the same you are my
other survey said they are they are this
did different of course very convenient
yeah we have to be different otherwise
this thing wouldn't work in staging
right right yes yeah ok ok let's look
again in the 50 M let's try and see but
but can we see can we check some right
that looks familiar
ok go ahead and try and let me go find
them so you taught me about checksum let
me find can we find it one more thing
what no no it's for donuts it didn't
work why oh why because this is a
checksum of a dog hair layer we choose a
read-only snapshot of the file not the
checksum of the file anyhow oh I see so
let's go back to the build and see if we
can add to the image and see if we can
find anything another in array all right
fair enough
so we can dive in your in guest book
service you are in the wrong image oh
yeah hello or do I 50 is our victim and
if we look at the manifest inside 15
here we go interesting we can actually
find a blue tab right here yeah all
right so bill view is actually how this
image was built
ok so we can inspect it we can go to the
build ad to the 15 okay or we can go to
the CI server ok so let's see
information about this we'll take it to
Jenkins that actually built it
which have all the info about the build
huh what happened to the CI server no I
will Junkins it sometimes go down and
then never recovers never recovers oh
yeah I don't think this is covering her
we have to favor yes ok how many of you
lost there Jenkins more than once in the
last I don't know how are you oh it's
really seriously now the good news the
bad news are this is what it is the good
news are it's not a big deal because we
captured all the information about the
build of the image inside of the factory
with the image itself ok so you can go
to the build ad yeah where so we can go
to the beaut did Marcus any more
information who built it mark bill yes
ok are deployed a mark be late I don't
know what
okay we can see the publish modules okay
and see what's going on here ah look at
that this is all your Java for you okay
right here is all the snapshots and then
all the docker images as well so we
captured all the artifacts yeah
in in artifactory and now we can see
that I'm in Java right so let's see
which version of Java did Jenkins used
the lake Jenkins the Deb Jenkins used to
compile it so environment variables you
click into it we can just see which Java
was an effect okay in the system in the
system variables I see here let's just
try Java let's see what happens
okay okay so uh here you go this is why
is Java 8 of course it won't work what
why
because you should use Java 9 no I think
if you use that then that wouldn't work
for sure
no I write nothing worse than Java night
all right okay um you're right
we can do one more thing we can compare
this bill to a previous build ah yep you
go to the diff a table yeah right here
okay and then you select which build you
want to compare the build number 50 okay
and you say wow this is nice in this one
okay okay so bunch of artifacts were
updated obviously we build new artifact
yeah and dependencies none of them were
changed all of them are unchanged and
unchanged column right and let's see
what's going on with environment
variables maybe something changed there
okay further down yep here we go
well some of them changed obviously the
job URL change the build number changed
and all make sense and and that's all
well nothing suspicious here
can I see a fine mark here mmm yeah no
mark is not here so it's not it's not
that all right it's something else but
but how did this information getting
here in the first place well so what do
we actually do we used the Jenkins
factor plugin when we build it okay and
it captured all the information about
the build together and then just attach
JSON file to the deploy artifacts you
can actually see it here if you go to
the
to the building for Jenkins and Jason
this is the same file which has all this
information that you saw in UI and it's
open it's accessible by REST API so you
can process it and maybe you can find
mark there or or any other clue on what
happened got it got it but I suspect
it's not the build I suspected something
else okay yeah I agree I mean it seems
like they're exactly the same image it
working environment but it doesn't work
in the other so I guess we really have
to troubleshoot it first let's go into
the logs yeah that's probably the next
thing that we want to do so in
communities there's a really easy way to
get to the logs if you if your
application I'll push the law to you STD
out basically Center out or send our
arrow and then we can actually capture
the logs and we can stream it for you we
can actually you can actually access it
directly with the law commands here and
it won't need to excitation in any
machines you can just give it one of
these instance names and we can't you
see the logs now broke we have two
instances here what are the odds for us
to find the log in the right instance
50% 50% alright what if I do something
like that now I have Kingston seized
what are the odds now still 50% you even
find it or not that's very good math
there yeah I guess that's true I guess
that's true but let's see if we can have
some luck here so I'm going to view a
lot at F right and I can tell I don't
have to SSH into the right machine but
this we just give it to me oh this is
bad luck today I didn't see my arrow
yeah yeah you didn't find it no no
lottery today alright so let me try the
other one launce test right but you see
the problem here if you have a lot that
not one either yep
what happened here does it work now no
no no yeah okay well log acrobatics are
always fun yeah so I think I think there
are other logs right so as you can see
you may not actually be able to find the
right logs okay now we have ten of them
good luck yeah yes probably something I
used to do these kind of troubleshooting
in production environment for a hotel
company and
you know 12:00 a.m. 1 a.m. in the
morning rather than being able to find
out the issue I'm actually spending a
lot of time for the very first time
trying to copy the logs together write a
cessation SCP of the logs they are large
and they are separately you have to you
know divide them up by hours you can't
grab everything got grab them it was
just a very difficult thing to do in
kubernetes or you can do because you
output other logs to SD out I see the
arrow we can actually advocate a log for
you automatically you can install
centralized loggers so if you're using
say I'm priming solution you can use
something like audacity search and log
stash and Cabala then you can tie this
whole thing up then you can go into your
log to search now we are actually
running on Google cloud right now so
what we can do is because we're using
our manage kubernetes what that means is
we install a sense rise logger for you
automatically so you have your choice on
which centralized augur you want to use
but by default we can give you something
here for start Scots I'll start driver
logging and what that means is I can
just go in and potentially find my
cluster here you may have multiple
kubernetes cluster and you can also
navigate into your namespace and we just
want to see the default namespace right
which is our production in which you saw
production yeah running alongside
staging of course and then we have we
can drill into the application we wanna
look at and of course there will be many
many Lots entries what we can actually
do is to just do a search right so we
can see hopefully the type of arrows
that we got so here we got the 404
Newell and we can't actually see the
exception that I should occur so yeah
and and surprise surprise it's not a
null pointer exception no but it's a for
for nor at a HTTP client error
so I've no idea what that means either
that's not very useful I mean ok so we
probably should have added more logs
yeah we yeah but before before we do
that though can you correlate can you
check do we have more exceptions on one
now than in other occasion some
investigation on the logs yeah so that's
all
of things that you may actually want to
ask yourself well the first thing I do
when I was in this company
troubleshooting you know 2 a.m. in the
morning is is this error happening
everywhere or one instance or just
Wednesday's right because you know it's
3:00 in the morning if it's everywhere I
think I know I cannot go back to sleep
if it's one instance no this is you kill
this instance and go to sleep
yeah he's killed no you can't just do
that one well it's like people that
would tell me that they reboot their JVM
every week because well because I need
that's a legit way to stop from now
perform out of memory hours
you just rebooted before it explodes and
you're all done no no that's that's a
way to cheat that day yeah you can do
that but nobody works yeah so and so you
don't get caught up at 3:00 in the
morning I know yeah if you restart
during the day you don't need to restart
doing tonight I think about trouble if
you start doing the day depends on which
time zone you're in of course now let's
find out if this is the issue first so
what we can do is we need we can extract
we need to be epics right more from the
log we need to be able to ask questions
so we think this centralized logging
tool that we have with star driver you
could potentially you know send the log
instances log messages stream them into
other sinks so you can use messaging
which pops up to cannot do a real-time
near real-time enough I don't like a
firehose of events yeah yeah and you
can't get like real not very good alerts
here or you can use a storage for long
term storage but my favorites actually
peak hurry
yeah because we want to ask questions
about the logs yeah so what we can do is
we can export the logs to bigquery and
what that means is let me close up one
of these tabs I forgot which one oh no
not that one
let me reopen all the tabs again right
this is kind of nice in enemy closed
still not working all right fine so we
can go to bigquery
where is it no doer what happened -
there we go
so one mark one of my visualization tool
has a really bad food echoic memory leak
so it's up oh my
oh my resources on my project all the
other yeah
okay so so here we go
and hopefully I'm back on the line here
and let me go to be query for example if
I can search it yeah
so there's speaker II come on open up oh
my goodness
speaker II let me do that instead I
think my browser is dying all right so
with Vickery what happened is that we
can export other locks if you want into
the table so these are structured tables
and with all of these fields we can
actually query them yeah you can run
queries now when it's in the table yeah
and this is actually something that we
use internally as well this is based on
internal Google technology called dremel
we can curry terabytes or petabytes of
data without any indices so if you have
large amount of logs you can ask
questions like this so this yeah so we
have two instances let's see if the
error happens on both of them or none of
them yeah so what we can do is we can
count their currencies and know which
instance is having the issue we're going
to find things with you know in
container Kahala where you I have an
exception yeah yep group by naming
occurrences in the mid to a thousand you
know even though we only have two yes
that make sense yeah so we can run this
query I mean see oh I have the result
here but that's okay okay okay so what
do we have is one of the instances have
77 exceptions and the others have four
two and one which we can discard it
actually Java so it means like
everything's fine only four exceptions
right yeah yeah that's okay
so so what do we do so 77 is is is our
is our a suspect so now we know on which
pod the error occurs and as I mentioned
we can just kill it
no yeah no
Noboru okay but because if you curate
you don't know what happened there you
can now troubleshoot any more right
right comes back it's like we need to
interrogate the prisoner before we shoot
him I don't I don't want to come on that
but for a convict a convicted person
sure yeah but yes well no but anyway so
we're not cleaning anything today I just
wanna be clear so what we can do
incriminating is rather than removing
this instance we can actually keep it
running but preventing from serving oh
it's like putting him in the solitary
confinement no I don't think that's good
but sure and then what that means is we
can ask this instance more questions in
turn get him in the end not killing
anyone today so so we found this
instance that's having issue in ink
ribbon that is what we have is called
labels so every one of these instances
has to label what that means is I can
say get pause I can see the labels app
in serving and added a label Co serving
what that means is I only want to in my
load balancer I when I'm routing these
cell traffic I routed by the name of the
labels what that means is currently my
load balancer only rush traffic to hallo
or UI with the label that is true what
that also means is I can change this
label dynamically and so I can say
rather than doing the no it's greater
than having to serve this instance I can
actually just change the serving to
false
oh just and and all this is actually in
App Store names those are strings it can
be anything and it just happens by name
convention that your load balancer
looking at this particular tag or label
to know what is in service and what is
not exactly and now this is seeing its
own solitary confinement nobody will be
able to get you it except for the people
who has access and the cameras are off
so we can interrogate him peacefully
yeah well and the way you do it well
first of all before I go into this this
to see this in actual issue notice that
even though I removed one instance from
my ten senses if you count the number of
hello or UI we have a total of 11 and
only one that's false the reason for
that is because kubernetes withhold
kubernetes that we needed ten senses and
we remove one of them and so it
automatically restart another one for
you to take over which that is the one
with six seconds left span that's right
this is Iranian there's anyone yeah so
with this o isolated now you can do
really interesting things and
you can if you want you can go to
exactly if you're using talker you can
do talker exact in company so you can
look into it yeah so I can do that
and we started you know where are we
starting anything but but you can't do a
Keo with a three I think that that would
send a single to do that I don't know
I'm killin honest I mean all right fair
enough but but or you can you know if
you if you have something I'll put it to
the file system which you shouldn't buy
few big you can't interrogate that the
file system is well
oh no I'm using your terminology now
this is bad this is bad
alright so the other thing is the other
thing you can do is this is really neat
if you just want to see if this
particular instance is having the issue
for example oh I took it out of service
but they still bad but like if I if I
want to see if this particular instance
is bad what we can do is to do a pull
forward so we can actually do keep CTO
port forward I can give it the name of
this instance and then I can say I want
a four for my local port 1992 the remote
port 8080 right oh good night miss bill
this port forward here we go
yeah so now I'm in start establishing a
secure tunnel directly from my laptop
through the VMS to the RIVM to the right
container and so if I go back here and
go to my 9090 actually works it did you
forget something is working for this
right in this instance it's obvious good
but but we can also do more things right
so if you're exposing something on the
GM export if you want to do some
additional management that yeah so this
message didn't you forget something from
whom come from the maxim oh god yeah we
didn't made our sacrifices to the
difficulty yeah yeah that's true that's
true
yeah now it's too late now we'll just
have to make it work without the secret
well kill we can kill this spot for the
garden really for we can we you could do
that and it will actually fit them on
yes or no works well no but we took care
of the service you know not working
it's not a real sacrifice thinking well
here you go you put it back okay so he
cheated so you can decide you too you
know kiyo a bike you leaving the pod or
you can put it back right by putting it
back it's not guaranteed that it watched
me go back but you can change the label
again and it should be serving again
however because we tell communities who
only want ten instances what that means
is it will actually go and remove one of
the instances which one usually the ones
that that's the newest or the ones
that's unhealthy
okay so instead of killing the one that
doesn't work you actually just murdered
is six seconds old baby good job right
good job instance these are these are
these are just applications but but the
reason for that is because potentially
you know the lower running instances are
more warmed up they are more optimized
already in memory and the newer one is
still warming up and so they there is a
heuristic you can study on how they
chose that one of my favorite analogies
in the java world is the infant
mortality in garbage collection this is
very solid I don't know which talk about
is but I'll have to see it yeah okay so
I don't know we got now nowhere we have
not much time left and the logs get ger
that's not nowhere and I would just wish
we had more logs yeah but I guess that
too it's kind of how much oh yeah so so
they're two things that we should have
well first I think because it is micro
service right yes it's something could
have gone wrong in between the call
everything could go wrong but yes it's
my ger service yeah and Booker yeah and
to actually see what's going on I think
we we should actually look at what could
actually break in between right so in
this case this is nice
yeah so in this case I know you know I
know that they're all talking to each
other isn't it is it like this thing I
mean when you change stuff does it
change yeah we know what you in now
there are time this is nice yeah but but
you're right though these these lines
are in our life these lines are actually
documentation so you actually draw it in
yes yes no no it's actually written in
my in my deployments so for example if I
go here and I go to my my annotation
here I'm entertaining to see a who is
talking to what but easy actually
enforcing the connections through the
ports it is now no it's just just for
the nice lines in the UI is that you
have any way to actually see what's
going on live yes actually they are
there are a few tools that you can use
and one of the thing is called weave and
weave has a little little aging you
Kings though it's called weave scope and
let me see if I have the Ronny yeah so I
can run weave scope um I can connect use
for for now go forward I can go to my
port
40 40 locally to see what's running my
cluster and from here I can actually see
all the live connections also are actual
on your life come yeah so you can see
these five foundations because how many
times have you guys you know ever tried
to troubleshoot something with
documentation and then you know after
like two hours somebody tap on your
shoulder and say oh by the way uh
fermentation is not up to date yeah
right so number without the rapid never
have price so you really need a
real-time look to observe and see what's
running your concert this is one of the
ways for you to see what's running there
and what network connections are being
opened but for your micro services is
what you really want is a you know with
you should be tracing because you need
to see the life time of the request and
see who actually call what and you know
which the race is slower or in this case
maybe some services failed and so for
that we are actually running Zipkin
behind the scenes and we're using spring
butoh is in spring cloud smooth so all
of the trace information and the headers
are automatically created and spoiled it
to Zipkin now you can run your own zip
in and you can see all the traces or if
you don't want to manage your own
instance we have a special Zipkin proxy
that can also forward data from Zipkin
to a managed service in google cloud as
well so may go back to the console to
show you what that looks like that the
idea is the same it is different
backends right so I can go in and I
should be able to see traces so I can go
to start Robert - only as well and we
can see a trace and not only can we see
see we can actually some people are
trying to beat us my service here yeah
yeah request here right but that's ok
but we're popular we have but we have
class of ten instances to stand alone
yeah that's right yeah and you can
actually see like this is a successful
request from women right we say hello to
you we hello William
yeah and then you know the messages went
through and now if I can find some of
these things that has issues right maybe
we can find the trace that has issues
you know hello grid yeah but there but
easily enough but you know maybe we can
find the ones that yeah so we have those
450 500 which one the one is due for
four phrases all right there's this one
uh-huh uh-huh this thing Wow look at
that yeah I think oh there's the final
drea found it yes and then they said
hello to someone and you see the problem
it's right there
well you remember how you had the
username in the end of it
hello vilem yeah maybe that could be it
and you can see the 404 here as well
yeah so but but how can we be sure I
think that's where we probably need more
log messages right alright so this is
easy we know how to find the code
because we have the revision of the gate
in one of the variables in artifactory
yeah so we go to gate we find this
revision we check it out we add more
code and we build it then we deploy it
and we run it we hope the error will
occur again and then we it will kick in
yet in minutes well if you paste on your
environment if you're in a company which
the appointment takes you know four five
hours or next week to do that's not
gonna hope is it so we all hope is lost
how can we add logs without actually
deploying it and also what if and what
if you you after you do that you find
the logs to be unuseful you repeat yeah
but luckily enough if we go back to that
other factory thing is this the open
notes now in the commune line I don't
know if anyone noticed that we don't
only say Java - start start right with
the jar file we also attached a debugger
and this debugger is actually quite nice
this is actually a debugger from from
Google that we actually have a similar
debugger that we use
you know how to get here yeah yeah yeah
yeah it is your factory up there as I
mentioned as every other factory in the
world yes and 50 is ours easy and now we
have to publish modules this will be
winning the doctor stuff yeah so yeah
this guy and here is our money fast yeah
I want to see that they start up yet
nice yeah and we were going here we're
going to the doctor info so so right
here yeah right here in addition to just
Java jar right we actually have attached
an agent and this agent is Fred
practically this a major in that Google
uses internally for our applications as
well so what this agent can do is to
actually allow you to dynamically add
log messages to your application so what
that means is if you want to get more
logs let me go and go back to my console
there you go I can go to debugging so
there is a little thing here called
debug right and if you have your
repository made available to you to this
tool or if you have a public repo we can
actually go ahead and find it so here I
can find my application and I should
have my source checking that's
accessible it automatically switches to
the right revision that's actually
deployed in the containers right now so
you can actually see the source of what
it is deployed yeah what you would find
the source with the same reveal number
and the way that the revision number is
in being caressed by using the kid
property file and from here what we can
do is now we can add potentially more
lock messages so I'm gonna remove a few
one of these right and that's from the
previous training Journal
yeah potentially because I need always
needs to troubleshoot this right and I
can zoom in a little bit and we have
here right the few lines in this is how
we do troubleshooting for Java
developers right now you just add more
logs yeah as you say one and
here and and this is actually quite
sophisticated because usually send it to
this yesterday out yeah so if he is
login that's like that's a senior Java
developer yeah yeah or if you're using
javascript cannot need to use STD out
right now then you use alert yeah but
but now we can actually say the name is
weak actually put in the variable for
name so we can actually see what's
actually being printed and then maybe
the last one I'm going to put this I
mean I'm here yeah this is classic yeah
as soon as we do this the log entries
will be these instructions will be
propagated to all update instances that
we have and what I means is if I go back
here into a refresh oh now that why I
think that stays in it here we go
right so that one is still failing right
so now we theoretically what we should
be able to do is to go back to the
console and let's go find the logs where
are the logs here we go go to logging
yeah and um let's see if it works
let's see if it works if we manage to
add logs without redeploying anything
yeah so we saw the arrow and check this
out number one
um here you know I'm here nice nice
very good number two the name is
dropping base who is this person
nice right yeah well happily happily
house really good but now I can I see
you see this in the log base nice try
this is very good nice right you want to
break it for real
but now I can't you that's why I pay
there's a script alert an infinite time
as well we have we we have it now you
know what that was a fraud detection you
actually told it at them to do an SQL
injection yeah another what so what if I
can say is the Odin emcs right so if I
were to your to refresh again name is to
the name is yeah there you go that came
through pretty quickly I'm here in the
name is ray is that runs ray oh yeah
that's your name yeah that is me yeah
yeah and you can see all of these things
go
yeah now they just won't let us stuff
I'm looking for is there one yes the
name is empty but they you see the
problem here if there are so many about
messages you it doesn't really help you
either
so what you need to do potentially it's
not just output what you're looking for
but you can also restrict the conditions
so if I want to add a new log message
this is really nice I can actually add a
condition here right so with the
condition what that means is if you know
the request ID that you want to send you
if we know your session ID that's in
scope you can add the condition here so
you can narrow down the logs are you
going to produce and ignore all the SQL
injections yeah exactly that's right but
but sometimes logging is just not enough
either right I mean you know what yeah
logging is kind of kind of lame right we
just saw how hard it is I wish we could
debug this thing like attachment vo oh
yeah like a touch like it that should be
buggin J yeah yeah no but that would
stop the world that's a little wait wait
don't you know me or you step through
every every come in sorry that's that's
a nice job security it will take a sword
all day okay just do otherwise that week
and whenever something is not responding
like we get to keep our jobs and here we
go we see in flick through all the all
the all the breakpoints yeah suppose I
do this continuously but we can do
better with the same T bugger we can
also attach what we call a snapshot
point so these are points where we don't
stop the world but we can actually see
what's going on so for example if I want
to see my hollow or service here and you
know I know the codes probably going
through here I can attach a snapshot now
anybody including the person who tries
to drop the database right now try to
drop it again I will see this flowing
through and we should be able to see a
response right so for example if I do a
refresh right again it goes through one
of the instances I come back it says
that we have called the KO stack right
ah here you go and now I can clearly see
that the name is amazing so this is user
error yes that's the user error
someone didn't enter a name which is you
know valid you know you handle little
exceptions well you check yeah the name
is not empty and everything yeah yeah
good good job yeah yeah if you have five
you have five micro-services and ten
instances so yeah you know I think I'm
also the person who who I started this
demo wasn't it so yeah so as I said as
hostage you are it's not mark yeah yeah
so this is my fault all right
so hopefully you actually see that the
different tools that you can use to
identify the first of all let's let's
restrict it open up a new browser window
let's do that so I'm gonna go to case
book I'm really scared to see what
everybody put into this yeah well also I
know everything yeah that'll be a lot of
fun don't do that this comment needs to
be means your another rating told them
love you have them and they actually
have the same message in mind yeah yes
yes oh this is good this is good thank
you thank you for participating yeah
yeah thanks this is always fine I don't
know what the question marks are but I
know I don't deal with utf-8 let me
guess this is Russian but yeah I know
so we be through a lot we got seven
minutes left right so let's do a quick
recap right so we sell other tools and
things that you can view you can use
labels to play around with how you want
a low balance you can use you know the
thing for for potentially taking
instances out you need to have a
centralized logger to help you to
understand what's happening hopefully
you can actually curry it but more
importantly you do need some kind of
this should be the tracing so you can
identify the real issues behind your
micro services calls right in case some
of the services slow in case that the
service is actually slow what we can't
actually do is because we record the
latency that you give to the service
week actually build a report we can give
you you know the 99 percentile or
eighties percentile of the
the latency distribution but we cannot
do actually even better because we have
data from the past internal current what
we can do is we can compare the Linton
see distributions between your versions
so for example if we deployed a new
version this week you can compare the
latest in between the previous week so
you can actually identify performance
regressions if you want to and we can
generate this report automatically for
you I have a have one question for you
so we saw this debugger which is which
is very nice yeah but I'm not a big fan
of those idea in the cloud I prefer to
use their ID that I know and familiar
ways like IntelliJ is there any way to
attach this magic non-stop the world
debugger actually from a from
intelligent actually that's a great
question I should have we still have
time we should show it so with the yes
you actually can so if I can find my
demo I don't know what that is to be
honest get spooked demo I tell you what
this what I'm going to do yes you can if
I can't find my demo I can open this up
be my IntelliJ just like a frog
kubernetes right I can't open it not
that one where did he go
example Java there we go I can open my
you know so I can actually open system
project I can actually have my debugger
IDE plugging instead of IntelliJ no this
is amazing
and you don't actually have to upload
the source code you can just
troubleshoot it directly from
intelligent like that and these are like
more because most of the people won't
have their code publicly on github and
I'm not sure how many of us to upload it
to Google with everything in it that's
fine
yep so you can actually attach it to
your local debugger you can find the
version and what this is going to do is
also check out the revision that you're
supposed to be debugging and again here
we go new snapshot received yeah let's
take a look
yeah-hoo-hoo is still using my app
everybody everybody
somebody still trying to hit it with the
name with the vision empty now yeah no
it won't work we checked yeah yeah no
empty name one more good yeah so so
there you go
it's
it's right there bases now we're talking
this is awesome exactly
okay so without that said um let's go
back to you where this lies again
there you go yeah so remember if you
want to be able to really identify your
issues I mean it was hard enough which
is one like monolith application across
multiple server it was really hard with
so on with micro services you just
really need the right tooling to be able
to observe and also get insight into
your cluster you need to be able to
trace to have log and debug and
potentially there are tools out there
you can use and that's how although all
the stock drivers are tools are amazing
don't forget we have all the logs all
the other notes and all the links and in
Java to come to the show notes a both
stackdriver and all the rest that we
show today yeah so yeah this is it thank
you very much for being here on their
last day okay thank you
I don't have three minutes for questions
yeah any questions there's one over
there
I see yeah yeah go ahead yep
right so the question was with IntelliJ
here how do we attended Kate with the
debugger stack right so each of the
application instance runs the debugger
agent and that agent will need to have
credential to connect to a central
server which is us you can actually run
this debugger in any environment this
debugger is not limited to Google Cloud
right so if you run the debugger agent
on your localhost you just need to give
it the right credential and it's gonna
be able to connect to the central server
once it's connected from IntelliJ you
can show the plugging that also
authenticates you to the same project
and from that same project when you
click on p-bog right you can see what
projects I can debug and I can also see
the applications that have privileges
you know your username was right there
in the list of the project yes exactly
exactly right so this is mediated
through a central server yeah yeah
question
yeah go ahead okay oh can you have
conditions on snapshots yes you can
actually so there you go so once you set
this snapshot you can also give you the
boolean condition here so you can have
an expression it supports everything the
cloud version now it's actually a quite
dangerous sometimes if you put an
expression to say I don't know like
request that you know generate ID or
something or if you call like new ID
right you could evidently introduce new
variabilities into your code by doing
this right that is why this debugger is
very smart if the things you are trying
to call will modify this state it will
actually not execute so this will
prevent you from accidentally changing
the state of your running environment
this is really really cool yeah yeah now
I I remember I used a lot of hands by
changing stuff while running in the
debugger so big bummer with what
language with the condition and then you
change it and then all you need to do is
keep the debugger plugged in without any
points and it changed the behavior of
application and production right how we
used to do it so interesting yeah
yeah yeah sure sure and then you Keely
afterwards yeah because it actually
wasn't so great okay fair enough
okay 30 seconds any other questions yeah
here we go yep
oh the overhead question yeah this is a
we always get yeah yeah yeah so um very
minimal like single digit like one
person or something like that it's very
very minimal for the amount of things
you get they sold me the mode out we
actually run this in production
environment within Google eyes file so
when Google is slow that's why know what
Google slow is somebody like Baruch
they're trying to debug something with a
real device and stepping through the
code well jokes aside it's really worth
it it's the stuff that you can do in 3m
in production is definitely worthwhile
this 1% of overhead yes okay I think yep
thank you very much guys thank you huh
thanks Mia good job</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>