<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Android Architecture Blueprints by David González | Coder Coacher - Coaching Coders</title><meta content="Android Architecture Blueprints by David González - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Android Architecture Blueprints by David González</b></h2><h5 class="post__date">2016-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zHiaOYFk0iI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello thanks for thanks for joining me
thanks for coming to the talk and I was
a long day so giving a talk at like 3
p.m. is always more difficult and do it
first thing in the morning but I hope I
hope you enjoy it here to talk about the
under like a textured blueprints project
I hate to ask questions whenever I
started up but I have to ask does
anybody know this project already
yes good you don't come guys I talked
about it this morning so that wasn't
cancer my name is David Gonzales I am an
I'm an engineer at help Scouts and the
Google developer expert for Android
hisself Erica is the project lead he
couldn't be here today but I wanted to
keep his face he's happy about it and
I'll talk a little bit about what help
Scott is and our mission I'll help Scott
is to help companies build businesses
that their customers love and we have a
set of tools to help them do that and to
make every interaction with customer
support more more helpful and also more
more human the project that we want to
talk today is the blueprints project so
this has been an effort with people from
Google and from the community and the
main reason for this is if you're under
developer login following the Android
news you've known that for the last year
year and a half there's a lot of
discussions around architecture and how
to architect how to build the
architecture for an Android app so many
people go model-view-presenter other
ones who go model view viewmodel there's
java there's different even coadley now
have different languages and there's a
lot of introductory introduction post to
MVP and vvm or any other architecture
but it was very difficult to be able to
compare
all of those architectures there are
always different samples and they're
always in different repositories so it's
not always trivial to understand the
differences or the key differences
between all those different
architectures the main idea behind this
project was to have a collection of the
same sample the same app but having
different approaches to solve the same
problems and having a different
collection of architectures so we can
then compare them and if you don't know
one of those then you can learn how it's
done and you can compare to something
which is more familiar to you and we'll
talk about that in a little bit the
sample lives in the Google samples
repository if you know who's this guy
okay take his advice we want you to
start the project I think it's a small
internal battle between Jose and Nick
butcher about Stars and Jose horses
salary depends on how much stars we have
in this project so he's a nice guy so
please start the project we can he can
get his final pay but the main point is
this is the this sample is an official
Google product and it's not just made
like Googlers it's also made by part of
the community but it is a reference then
when I did start a few years ago to to
learn Android I would go to find what
Google did and until now there was not
an opinion
how about how to build how to build an
Android app and this is what we've done
with the architecture project this is a
small list of everybody who's been
collaborating so now the left side at
the left side you have people from
Google and X Googlers and then people
who are more actively involved with the
project and on the other layers you have
people who's been either commenting
adding issues meeting poll requests or
having giving their own opinions and
they are there so there's somebody from
here in the room and if you wanna
contribute it's it's a great place to do
some open source so that's that's very
interesting the the main idea behind the
is why why should we care about this
this is a posting Google+ from the young
hardball for if you know her she's main
engineer behind the android framework
and head opinion was well I don't know
if you have to use MVC or MVC or
anything it's we they build a framework
and the framework is built to run
performance and to run in all those
devices we have and I think it shouldn't
be their job to tell us how to build all
the different apps thing is a great
advantage that we have that we can
decide which architects to do we want to
follow so we want to use MVP MVP em or
any of the other different architecture
that exist and it's up to us to decide
and essential is up to us and the team
we were working with to decide which our
key chart we want to follow and can you
imagine that by default you would have
the observables from our example coming
from an under ductility or you will have
to extend or implement by default a
presenter in all your activities they'll
be limiting a lot the way that we can do
our job which is being engineers and
trying to do things the right way so I
think it's great that they don't give us
how to do it exactly and it's up to us
to interpret and and decide how how we
want to do it the in terms of who is
this project for if you're in the middle
of that range that's perfect for you if
you're starting on Android now and
there's a lot of things that you should
learn before looking into how to build
the app using a clean architecture or RH
Java before all that you should learn
about the activity lifecycle
you should learn about broadcast
receivers and services and content
providers and SQLite that's all that
knowledge you should have before you and
you start dying yourself into building a
a project if you've been doing Android
for five six years and you've done
a lot of different apps those problems
that we gonna you're gonna discuss in
the sample you face them already so
probably is not the right project for
you because this you're not gonna learn
much it's going to be useful if you fall
into this middle category where you've
been doin Andrew for a few years you've
made it on few production apps but you
want to improve the quality of all your
shipping and you want to improve make it
easier for you in the future to add new
features to change the way you're doing
or even just to learn and experiment
with different technologies then this is
the perfect project for you because
you're gonna be able to learn a lot of
new things and it's gonna be very easy
to for you to understand how how those
things work in terms of the product
itself is not just an architectural
project it's a testing project in these
guys many of the discussions I would
have when I go to conferences or events
about Android many of those questions
are asking about architecture and how to
do it but in reality many of those
questions are about testing how can I
test that the data is being stored in my
database how can I test that my
different different components between
my application how they interact
together how can I test that this little
button here works the way it's supposed
to be and many of the answers end up
being related to how the app is built
and if you don't have a proper structure
in your code it's going to be extremely
difficult to test anything so in this in
this project you're gonna find three
different types of of tests and I'm not
gonna use the the pyramid because that's
I think we discuss a lot about it and
think yes there was a great talk with a
new version of that pyramid was
interesting but the main testing part of
this project is a UI testing so that is
the most important because we are
reliable or we try to make them reliable
and want to be hermetic and we go into
this area more detail left after that
there's decent unit test coverage
and by this end means not every unit in
the project is tested we are not testing
that the objects are created as they are
supposed to be
well it's asking is that the actual
implementation his work as he's supposed
to so if you're looking at the MPP range
we're testing that the presenter is
talking to the video in the way it's
supposed to be and then we took the
repositories with data are talking to
the presenter the way they are supposed
to do it and that's what we mean with
this end unit test coverage and then we
have the non UI tests that are obviously
there's lower the random JVM and we want
them to be us 100% working all the time
but those are tests are you running
you're built on machine and upon words
we don't have rubber lectric or we are
using power mark so we're not mocking
from our classes we are not using the
electric not because we think it's a bad
idea it's simply there's no need for it
when you test the project in enable bits
on it here and that would be that with
the three types of tests that we are
that we are running this is the the the
app we spend months thinking on the
design and thinking of the different
implementations essentially is a very
simple app that has two main points
three main points one is to able to list
a series of tasks you can edit them or
delete them and then as a second screen
with statistics that shows you how many
tasks you've completed or how many tasks
you have active this is complicated
enough for us to be able to experiment
with different versions but is also easy
enough to be able to switch between
different branches and not having a very
extreme large list of differences
between all those different
implementations as of now we have all
the different branches active as today
everything is branched out from the
MV model-view-presenter model and all
the other branches are branching out
from that one so we have one with
loaders where all those samples are very
opinionated samples and the main point
is that anyone can come and contribute
and we encourage them to do so so
there's a version with loaders where and
there's a bit of a discussion within the
community whether your presenter should
know about the android framework should
have dependencies on the annular film or
not in this case the loader sample they
do have dependencies so they'll have the
fragment Matt the loader manager will be
inside of presenters from that is
another branch for content providers and
as interesting if you're trying to share
data from Europe to the rest of the apps
on your system then there's a very good
sample that shows you how to do that
there is an example with data binding
one following the clean architectural
pattern and then one with the pendency
injection using dagger two and then
there's one also stable with a version
of Arak Java that was were from Florina
Montanez canary common in development we
have a tablet version and we'll talk
about it a bit later but those samples
they all have fragments as the main
video component the main reason behind I
was to be able to get tablet working and
be able to show that sample and then
what I found more interesting from the
whole project is the external
contributions we have one fragment less
which is same thing with MVP but using
views and are using fragments and then
there's one using conductor which is a
library that allows you to you know
compose views and do the navigation
between them in a VDS way and this was
an external sample from somebody else
wanted to do it and they presented it
and we'll go a bit later how to if
you're interested in contributing and
helping out we also talked about how how
to do that recently and we'll be talking
about the testing part we 3di testing as
a con
and basically if you're creating a new
sample and you're branching out from any
of the actual branches that exist you do
some changes and you run all the UI
tests with espresso as we'll see later
if those stairs are green and they're
working chances are they're everything
that you've done is correct because the
implementation of a UI test is going to
be the same whether you're using rx Java
you're using MVP clean or any other
different architecture this is one of
the tests that we that we have this is
simply rotating the device and ensuring
that the icon of the task is still
selected we simply load a task we're
just going to click I want to check that
the Delete icon is displayed we're gonna
change the orientation of the device and
then we're going to change check that
the title the description and the icon
they are all in the in the correct
position are saying what they are
supposed to say and then we just say
that the lead icon is displayed this
test is the same whatever type of
architecture you're running there's no
difference I think that's the strongest
part of this because it doesn't matter
which formula you you want to follow
this is going to be the same test and
having the same test for all the
different samples and all the different
types is is very helpful for when we
started to discuss how how to build the
project and how what decisions it
wouldn't make best ever that we took and
we're gonna go a bit further into detail
here there's two flavors and the part of
the UI test you saw before they are all
running in the mock flavor the reason
for that is that we are simply passing
in block implementation of your data
model so in the reality we don't have a
REST API there's no server we are
talking to to retrieve a list of data
which is faking it but in the market
of it is a direct call the reason being
is your UI test if you're testing UI and
not testing user flows for the UI test
there's no need for you to go to the
internet and grab data you shouldn't
have to wait for it we're just passing
in a mock implementation of it that
returns a list of stars that we want to
test and we say which start we're going
to retrieve we say which stars we want
to click to a surgeons against and it's
easy to the UI test and in this way
these work with dagger and with any
other architectural pattern as well by
default it's using the mini fire and the
shrinker simply because it's good to
have it this project is not going to go
above the 65,000 method limit but as a
sample to explain how it goes it's it's
a very good example this is a very
controversial decision although samples
by default they are using fragments the
main reason is it is a good practice and
having tablets as an opinion as well as
an idea to having that version
implemented it was very easy to just
simply use those two fragments at the
same time not saying that you have to do
everything with fragments there's also a
version with views and it's up to you to
decide and the beautiful thing is you
can simply go on and compare it and then
there's no as I said there's no REST API
that we are using to talk I'm grabbing
the data from which is a simulated
Network call and essentially the remote
data source are just waiting two seconds
before returning the just clicking on a
pattern thread and clicking hunger so we
have this bacon background a
synchronicity to return the data from
we'll talk about how we want to improve
that when we go to the feature version
of the of the other project but this is
not just a collection of samples we want
this to be a framework where everybody
can discuss and they can learn from it
in terms of you never used our agava and
you've read a lot of blog posts about it
and you wanna see how we are
to the works you can come to the project
and check you're familiar with one of
the branches already so you can simply
go and compare and learn how one example
works in this sample just a grid for
discussion and we have very good
discussions about how to implement
different data repository so how to
implement different a presenter for
different views and that's also good to
have fun like a healthy discussion it's
can be used as a sample in my case when
I started help Scout seven months ago I
took the clean architecture as a
template and I've been evolving the app
from that template having things that I
needed for from my app so it's a good
example as a good sample - - based on
you want to test a new app you can take
that one and you can start building from
and you don't need to do all the first
steps it's all gonna be there and then
if you are active in github when you
care about different often having more
or less stars in your repos then this
also this project of today has 12,000
stars so be part of a project which is
active development has people working on
it so nice so that's also all the thing
you can do with it the I think the most
important part of the whole talk is how
to take them how to make the most out of
the of the project on how to use
blueprints in a way that is gonna be
useful as well for any of you fault
first thing you can do is simply browse
on on github all the the project is
separated in different branches so you
can simply change branches and try to do
like hosted tries to do always clicking
I always end up clicking on the class
name every time he never snappy gets
thinking his Android studio is going to
navigate to the class it never happens
but you can check out different classes
and get help and that's the first thing
that you can do the ball powerful way of
doing it is just comparing locally and
essentially having two branches and
comparing them if you have a Kotov tool
when i show you the sample of using melt
how to this is MVP clean on one side and
MVP
on the other side this gives you a nice
tree view of what files have changed for
both branches and if you go more into
detail it will show you the actual lines
that have changed so in a comparison
between MVP and mep clean - simply the
only thing that changes in this part is
the way you create at the center all the
rest of the code is the same so it's
very easy to compare how do you do this
if you using dagger or how do you do
this if you using our excel and it's a
very simple way to compare all the
different branches and the main point is
to keep the difference between all those
branches of the minimum so it's easy to
navigate to and to compare in terms of
different branches that we have I'm
gonna be talk a little bit about how
what the opinionated samples and with
develop now and and how they work if
you're familiar with MVP this is the
sample version when on the right side
you will have your presentation layer we
have now using fragments and that yellow
box is the is the activity so the
activity is the one that creates
presenters and obviously the one that
creates the fragments and that that
presenter talks to repository and
without following naming conventions
that we've in discuss for a long time
the only thing that repository is doing
is deciding whether grabbing data from a
remote data source or grabbing it from a
local data source and it's gonna be the
one in charge of when I grab data from
remote I store it in local and then I
can bring it back to to the presentation
layer the data source local storage
using SQLite but it's built in a way
that if you wanted to have realm or ORM
or whatever other data local data source
you could also go and change it easily
comparing with clean there's a new box
has appear now that is the domain layer
and that domain layer is the one that
has use cases and has all the business
logic
the approach for MVP that we follow was
the passive view which means that the
views have no business logic whatsoever
they don't know anything they don't hold
any state that is related to the
business the presenter is telling hey V
you show this message or show this list
of tasks that's all it does and clean is
the evolution of that part and where all
the domain and business logic is holding
these use cases and they can be unit
tested they can be tested in interaction
with the different with the presentation
layer so gonna be very anything which is
related to the business is holding that
in the domain layer and the data layer
doesn't change it's exactly the same as
it was before this sample is a bit more
more complex because we have content
providers and what we killing in this
side is the repository has an in-memory
cache that we that we used to mimic
having an HTTP cache order I look a
little LRU cache this case the loader is
the one that works as a cache so the
loader knows where they have to require
the data from the data source or can
just simply bring it back to the to the
presentation layer and the difficult
part to test here is that the present
the presenters have a dependency from
the framework which means that if you're
mocking you will have to mock those
classes and using the mock up a language
are we don't need to go through
robolectric we simply mock loaders and
fragments so we can infer mcmanager so
we can do that too but the other part is
the same we just added content provider
that is the one that sends in charge of
provides the information to the to the
loader but all the other classes are
exactly the same as as it were before
data binding now these are bit of an
experiment because there are different
versions of all those presenters the
some of them using view model and not
talking a bit of the logic is in the
view model there is a version with view
models and presenters have more logic
it's all in the same branch so it's nice
to have a Linux
brilliance but we should work a little
bit more in this sample in terms of from
the educational perspective there are
five we were interested in understanding
what findings we could have from
comparing all these different all the
different approaches the first one that
comes to mind is how what is the method
counts very different between all those
samples or is the apk size very
different and the realities it's almost
the same and I know it's not a huge
project with twenty five developers
committing code every day but numbers
show that there's basically no
difference between between these samples
this is the version without the mini
fire so you can see in the data binding
one has this third bar you see is the
one with the external dependencies so it
is the data binding dependencies and the
methods are coming when when we import
the library but all the rest is just a
thousand methods difference between all
the all those all those different
samples it's even less and sorry the
brand the brown one is the diversion
when the minifiers enable so in terms of
methods
it's basically irrelevant the difference
between it in the web bigger size is the
same Eric Java was they similar to data
binding because it brings all the
original dependencies but end of apk
size is 1.2 to 1.3 max so it's basically
the same thing it's um it's it's a bit
difficult to to show at a glance how was
the difference between all these
different samples so the main the main
idea was to show we have a table in the
wiki that you can refer to and it gives
you at a glance
Namor's are interesting to discuss we
show the different between the Dex
counts and also an opinion of how
difficult would it be how adjustable one
sample is for example if we will go to
the content providers one tester it is
me
because it's harder to go and that new
test taking into account all the Android
frame of dependencies that we have but
then if we go to the clean to the clean
sample the testability is very high it
is very simple to test any new features
that you would add there's a complexity
and learning cost and that's in terms of
some Balearic Java is not just you have
to learn a few things there's a few
things that you have to learn before you
understand it so the learning cost is
going to be a bit higher but then maybe
in the long term is the easier approach
here and it's a bit of a use case and
advantages about how why would you use
this approach or one sample or another
and now we try to explain that there -
this is kind of a cry for help
we've been working for this I think
around seven or eight months and we've
seen some traction from from from the
community but I would like to get this
to to a higher level where this is
inspiring a version called taste MVC to
do MVC which is done for fun ideas and
it has a huge community of supporters
and you can browse a lot of different
sample the same plumper in this way a
lot of different ways for for for the
web so we would like to be kind of a
reference in that sense for for the
under part it's very easy to just chip
in and answer questions that somebody
can have and there's a lot of them in in
the in the issue list help with wiki's
and help with articles it's very easy to
go and create samples there are
guidelines as opposed to how to create a
new sample how to contribute we have
some people in the past having oh I've
done a sample loading images from 500
pixels or things like that but that's
that's not what this is about we want to
have the same sample with different with
different approaches and if you don't
long enough it's easy to just go and
become a core maintainer and be able to
merge into master and do like a release
of the branch as an example of how
contribution works
Greg here he was does some
for conductor and it was very
interesting how he approached it he
would say hey I've done this sample I'm
using conductor this is a library this
isn't my repo of forth your repo so you
can go and check it out what do you guys
think so I went into it I looked at it I
had no idea what he was saying so I just
said yep thumbs up you converted that's
the level that we have how to merge
things into the repo but essentially he
was asking I've done this what do you
guys think the the proposal for for the
RX our sample another you can have
emojis in the comment in the comments
and give him he was that easy somebody
would say hey I wanna do I would like to
see this what do you guys think and then
people went on voted and saying yes
we're interesting in see MVP with
without a Java we would like somebody to
do it and Eric and throw another
volunteered so you just simply assign
the issue to them and they went and
started working on working on it and
this is from HTN is another GD from
Montreal and he said I want to do this
and it's an extremely long discussion
about post about what he would like to
do based on link that he's read on the
internet based on Larry's as he seen
it's a very long pause that explains
very slowly this is what I would like to
do what do you think and that's another
way you can continue it as well saying I
would like to do sample with cuddling
and redox architecture simply post it
there explain what you want to do and
then people would react and say yes we
want to see it please go ahead and go
ahead and do it but forgot to say from
before there are people who's been
opening pull requests changing the
version of the Gradle plugin or changing
a version of the support libraries that
is not very helpful because the the dip
words the main disadvantage that we have
with having different branches is that
we have to keep all those branches
up-to-date so if you open a pull request
against one branch changing a Gradle
plugin we will need to go manually and
change all the
and be able to ensure that your name is
gonna be in the list oh it's gonna be a
bit more complicated so you can simply
open an issue saying hey this is
obligates would you like to can you
please update it and then we will all
take care of that in terms of you two
and this is the the interesting part
moving forward it's only experience with
MVP as the main as I mean sample and
it's only one to do up the future is who
have different apps and how different
architectures evolve in in those samples
as well so we would like to see a chat
client I would like to see or whatever
you folks want to see and explore more
things that just a to the work because I
know that we've seen all all thing to do
apps and are very boring so we like to
have something different in terms of
different patterns
there's no Embassy for now or there's no
redirects or flux it'd be amazing to
have comparisons between redox and clean
or real eggs and our eggs so that's
that's also gonna be in the it is in the
roadmap and we like to work on that we
would like to work on the platform for
discussion because one of the main
advantages from these projects that we
can have a disk healthy discussion about
different architectures and we tried
dieter for awhile and that didn't work
very well because it was hard to keep
track of everything that was going on we
have issues and github and I still okay
but maybe we find a way or week if you
know any way that will prove that
discussion more than happy to to hear
that as well and then we have now
running all the UI tests and continuous
integration so somebody open up ER Adam
circles here so we had Travis the Travis
hadiza with all the flakiness of the
emulator so we have now circle CI and I
was working so whenever you open a pull
request circle say will build it and I
will run on the other UI test and that's
it have a lot of time left so like
discussions and opinions about the
project or different architectures you
can reach us out Twitter and or simply
in the in the repo
and you have any questions go ahead I'm
fall asleep just yet
well thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>