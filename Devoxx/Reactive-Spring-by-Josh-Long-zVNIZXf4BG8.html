<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Reactive Spring by Josh Long | Coder Coacher - Coaching Coders</title><meta content="Reactive Spring by Josh Long - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Reactive Spring by Josh Long</b></h2><h5 class="post__date">2017-04-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zVNIZXf4BG8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right everybody well thank you very
much for coming I appreciate it we're
going to get underway here knowing that
at some point they may bring me a proper
table on which to perch by laptop right
now it's kind of hanging office off the
side of the podium a little bit and as I
do type when I do my presentations it's
a little it's an odd angle to so I'm
hoping they're going to come
swap out the podium for me at some point
okay so very good thank you very much
for coming I appreciate that you could
be at any of the other excellent talks
I'm grateful to have you here today
we're going to go through a fair amount
of stuff today until I put the recipe to
put the coordinates for the for the code
up there online now I should mention
that this talk was originally something
that my my friend in this team colleague
mark heckler and I co-developed and he
got routed to New York temporarily so he
couldn't be here with us today proper
but I think he's gonna be here tomorrow
is that said about right so you should
definitely find him and tell him if you
liked the talk then you should tell them
it was a great good job with good talk
and if you don't like to talk then you
should definitely tell me instead of him
because that poor guy doesn't doesn't
deserve that right so so so thank you
thanks to mark heckler this is all you
know if once you see some of the
ridiculousness in this talk and if you
know mark heckler sent the humor you'll
appreciate that that was a lot a lot of
it was his his brilliance and beauty so
there's that I'm going to go through a
lot of stuff today I'm at Starbucks man
on twitter marked hecklers MK heck MK h
e ck on twitter as well if you have
questions comments feedback good better
otherwise send it to me if you have bad
if you have only good feedback then send
it to him but otherwise I'm happy to
answer questions I'm on Twitter how many
of you on Twitter its 2017 twitter
twitter twitter okay very good the rest
of you get on twitter it's the new IRC
it's a great place to be as well
developers that power the open source
that drives the projects on which you
work live and list who's that so things
are going weird so so there's that what
about email how many of you have email
email e-mail anybody anybody no okay
well if you do have email map answer
questions there as well don't hesitate
to reach out to me I'll about me my name
is Josh long I'm a spring developing
developer advocate on the spring team
I've been an open source contributor and
an engineer on the different projects in
the spring ecosystem not the least of
which are things like spring boot and
spring cloud spring batch and spring
integration and as well as other sort of
ecosystem projects things like a timely
effect in Baden and so on I have the
distinction the dubious distinction and
honor of being the number one most
widely recognized and most visible and
most highly rated contributor of of bugs
but still number one contributor of bugs
to those projects more bugs per commit
than any other contributor that's
something right it's not a great thing
but it is something so there's that i'm
on i'm also a java champion and that
dovetails very nicely with what i do hi
dovetails very nicely what do I do with
the spring devourer bag you want help Oh
almost lost you okay here he comes to
save the day oh so good thank you
we're almost there my friend
we needed to weave it longer okay anyway
it dovetails very nicely what did I do
as a spring to spring develop advocate I
spend my time trying to help the job a
community level up and build bigger
better things on top of the JVM used in
terms of spring as part of that I've
done training videos I've just finished
the latest and greatest edition of this
training second edition of this training
video that I did with my friend the one
the only the amazing the inimitable Phil
Webb the the co-founder of spring boot
and by the way I wonder I think he might
maybe be here in the conference summer
he might be at the booth I don't know if
he's here this week but if he is you
should tell you to say hi and tell him
thanks for spring boot and then I'm
working on working on the come on yeah
good and then I'm working on the the
working up on me wrapping up the first
edition of cloud native Java which is a
book about how to build applications
that survive thank you by the way so
much thank you so much it's a book about
how to build applications that survive
and thrive in the cloud at scale and the
book is in terms of spring boot and
spring cloud and cloud foundry now for
those of you wondering and I can imagine
most of you are I can see in your eyes I
can see the curiosity welling up on your
eyes like a pond for those of you
wondering that bird is a a blue eared
Kingfisher it's a bird that is
indigenous to the Java islands in
Indonesia it's a bird that is in English
we'd say native to the Java Island in
Indonesia
now birds you see they they do from time
to time fly now birds fly often when is
you know when it's appropriate in the
clouds so this is a bird that is native
to Java if it flies in the clouds it's a
cloud native java bird it's a their mind
fine it'll come give it time
anyway moving on and I work at pivotal
and pivotal we have a lot of good
open-source technology I care about the
open source but let's be very clear
that's not the reason that I or anybody
else on the team is here Oh
we serve our goals and we serve a a goal
a vision we want to help customers and
community members move safely and
quickly to productions as part of that
we've seen a lot of organizations moving
to this idea of micro services so this
architecture of micro services and there
are a lot of concerns that become
obvious once you introduce and
redundancy in you know distribution into
a system things that aren't obvious in
the single node single instance case
micro services has a lot of benefits
that gives your organization the ability
to scale to go faster to evolve software
faster and to decompose larger things
into smaller batches of work but one
thing that becomes interesting is that
you have now the complexity of
distributed systems and for most of
those use cases you can use things like
spring clouds sort of address them one
sort of key use case that isn't well
served by the traditional existing stack
of of Micra services support are is
things like things that have to do with
lots of data lot long-lived sort of data
processing anything that has to do a lot
of i/o write input and output and so for
this we've seen a sort of revolution on
the JVM in the last five years a lot of
great technology to support reactive
file reactive or asynchronous i/o on top
of the JVM and this support builds upon
foundations that were introduced in the
JDK and 1.4 which in turn builds upon
primitives in the kernels and in Windows
that have been there for last 20 years
right the basis of this is that IO
ultimately is asynchronous in the kernel
right when you when you go down to the
very lowest levels of the operating
system input now put on the end the and
the neighboring is asynchronous it's
only on the JDK and in these platforms
that we force input an output to feel
synchronous but if you can embrace the
fact that things are asynchronous
ultimately essentially asynchronous and
you build your systems accordingly you
get a lot of benefits so we'll talk
about what that means today but it's
important to sort of understand where we
are with what the context in which all
these things live is in the in the Java
Java community in the Java ecosystem
there have been several different
projects that I think have gotten very
very popular
starting with rx Java rx Java was a
technology for supporting reactive
applications and workloads
and that was in turn inspired by the
work that was being done by the folks at
Microsoft in something called the Rx
extension that in turn led to a bunch of
other sort of approaches to solving
similar problems which in turn led to a
sort of de facto standard that was
forged by the folks at pivotal that's us
the folks at red had on the vertex
project the folks that are at Netflix's
rx Java project the folks at who else I
mean light Bend or nay
you know typesafe aquas project all
these all these fine engineering teams
got together and decided okay we need to
describe in the simplest way possible
the essence of what it means to work
with a system that is essentially
asynchronous that produces results time
scale that we cannot predict and so they
created the reactive streams initiative
and their active streams initiative is
the basis of what we're going to look at
today so before we get too far down the
path and look at the technology in terms
of spring let's talk about reactive
streams and what that looks like for the
for the average consumer okay so we're
going to build a very simple application
here today I'm going to do as I always
do I'm going to go to startup Spring
today oh this is my my second favorite
place on the Internet anybody who knows
me knows that I love start to spring the
rail but the only place I love more than
to start out spring today is production
and if I'm not in production I begin my
journey here at start that spring dot
i/o so what we're going to do is going
to build a brand new application I'm
going to use perilously I'm going to use
the snapshot of spring boot to toe which
is due at the end of the year right so
I'm living on the edge here what I'm
going to do is I may use spring to that
Oh which Auto configures spring five the
reactive support in spring spring five
and particular spring five is itself not
gah spring five will be released in the
summer of this year so we're looking at
snapshots of snapshots right in order to
build my application I'm going to build
an application I'm going to we're going
to build a little demo here and I'm just
going to bring in the reactive web
support I'm going to talk about you know
the basics of the reactive streams API
before we can go too far because I don't
want to make sure one the same page so
we're going to build an application
what's important to understand is that
in the jail you know in in our indoor
interactions with data we are used to
think about things synchronously if you
have a
single value in return a single value
from a method right that's let's call it
P you say it's T you know do something
parenthesis parenthesis if you want to
return multiple values synchronously you
can call it a collection of T right
you're saying I have a collection of T
values that may be there if you have a
value that may be returned
asynchronously right a single value that
may be returned asynchronously we call
that a computable future of T right it's
a future but you can get a notification
when the value is there but in the JVM
itself there's no real sort of good
story for how we answer the question of
multiple values that may be returned
asynchronously so that's the that's one
of the problems that the reactive
streams initiative is aiming to solve
and that's that's solved in terms of
something called the publisher right in
the reactive schemes initiative so if
you look at this we're going to create a
very simple example here I've got a
spring buta shell around this just
because I'm using the initializer but
you don't need anything you don't need
to bring boot to use the lowest levels
of reactor right so reactors a separate
project reactor is our implementation of
the reactive streams initiative and it
gives us the ability to talk about
values that may be delivered a single e
in terms of something called the
publisher the publisher is a base type
in the reactive streams API alright so
here's a publisher of stream right the
publisher has one method subscribe and
passing in a subscriber now this is a
very very basic you know type it doesn't
give you the ability to do any kind of
interesting things with the data you
just get notified when there's a value
what you need is higher level operators
things that you can use to talk about
the incoming data and manipulate them
process them transform them map them you
know do all the things that you might be
accustomed to doing in the lower-level
JDK collections or indeed in Java 8
stream so in the in the reactor world we
have two sub types of publishers one is
called a mano of a mano or whatever a
mano is a publisher that will only ever
produce one value a flux is a publisher
that will produce multiple values
potentially unlimited values it could
present it could produce values until
eternity
right there's no it's not going to load
all the data memory you know just
produce value as long as there's I use
to be it could be entropy it could be
stock Coast it could be you know
heartbeat events from services it could
be whatever you want I think the point
is there's no nest of note understood
bound on just on this type here now you
can get you can use these types pretty
easily it let's say I want to create a
flux of values and I can say a flux
taught from array right and here I'm
just going to say one two three four
right split that into a bunch of strings
and I've got a very simple flux that has
those values in them and I can do things
with it I can say okay let's turn those
those values into into integers so I'm
going to call integer dot cars int all
right I can also filter them just like
it was a Java 8 I could say okay for
each I I want to take only the I that
when divided by two is equal to zero
that's the prime right so I'm going to
now collect that and then what I wanna
do is I want to take the result right
and and then use them so I can turn it
into a screen right
I can also subscribe and here I have a
few options here right but I want to do
I want to subscribe to the results and
there's my favorite my favorite way to
call this method is to use the version
that takes three consumers one for the
values themselves one in case something
is an exception is thrown and then one
for a runnable that to get run at the
very end of the processing so the value
for the consumer itself is this we say
system dot out print mine okay and I
don't know about you but let's see do I
have that integer yep I don't know about
to you but I never make mistakes oh I'll
never I won't put it an error handler in
there oh this is print mind I made a
mistake and then we need a consumer
right and this is the last parameter to
runnable that you can run when all the
processing is done
right in this case I don't really need
it so there we go okay so lambda so that
should work let's see if that does what
we expect and a boot chunks
oh well first of all peak kill Java
thank you
second of all this is going to start a
web application because I've got the
auto configuration running so let's see
what that looks like
there we go right so on the console
there says 2 &amp;amp; 4 so very very simple you
and the benefit here is that by working
in terms of publishers right this is
actually at the end of the day this is
just a publisher so if I say publisher
publisher of string P and you can say
you know here we have a P equal to X
they are the same thing right again you
can work with they publish a type we can
use with you can use the specializations
flux and mono and the reactor project
okay with that basic understanding out
of the out of the way let's turn to how
this applies to us as developers
building applications in terms of spring
so what we're going to do today is I'm
going to build a new application a
service to manage you know fix fix
justice a fictional movies you know
let's just create a service to manage
movies and we're going to use the the
flux and the mono and reactive API is in
our application so I'm going to call
this the the flux flicks service which
is abbreviated as ffs alright so there's
that in order to do our work we're going
to use reactive Mongo there as well
because I like losing my data randomly
for no reason and also I'll use that as
well and we're gonna use Lombok ok now
again I could elect to switch to the
full version and thereupon I'll be given
a veritable
ocean of checkboxes but for our purposes
it suffice is to leave things as they
are
ok so here we go this is a service that
works with movies and it's going to be
based on the internet and movies are all
alternatively called a flick or flicks
we could call this the Netflix API no no
it's not even a mercy laugh okay
looks like service application ok so
let's see we're going to build a POJO
can you all see that the screen is that
big enough in the back ok yeah thank you
very much so we're going to be and
create a POJO is going to be a document
bring that a MongoDB document it's going
to have a primary key as a type ID I'm a
pizza at ID and then I'm going to create
a field here private string title and we
have another field called genre and I
want to create some getters and setters
so I could an all are given constructor
using Lombok which is a compile time
magnification processor that'll look at
the class and automatically add getters
and setters I'll add a two string method
if I give it the the two string
annotation that will add a no argument
constructor Ladd data add getters and
setters as well so these are all to do
things that other languages do for free
this is tutele spring that a Mongo about
the about the POJO about the entity
itself so I don't have to worry about
you know writing all that code myself
and then in order to be able to work
with this data this entity I want to
create a repository and again this
should seem very familiar to anybody
who's used spring data how many of
you've used a spring data ok so
ultimately today's bring that is a an
umbrella project that supports a lot of
different technologies a reactive Mongo
repository reactive Mongo repository and
we cannot make all the different
technologies out there reactive right we
want to support reactivity wherever it's
appropriate but some things are
intrinsically synchronous JDBC for the
moment although oracle spoke about
perhaps introducing a reactive api at
the last java one so that's you know
knock on wood but the meantime there are
some api's that are that support very
capably a full reactive experience
including MongoDB and that's already
auto configured for us here spring data
at the moment has preliminary support
for reactive Couchbase for MongoDB for
Cassandra I think I may be missing
something but you know as is possible
we're supporting that in the in the
projects so now I've got a reactive
Mongo repository and what I want to do
my friends is I want to write some
records to the database so that we have
some sample records with which to work
so let me design we create a being of
type command line runner and now the
command line winner is just a callback
interface in spring boot when spring
boot starts up it's going to call this
command line runner and pass in or
rather it's going to call this are the
void run method which the command on
what runner provides and it's going to
pass in the public static void main
string argument array here in
to do the work I'm going to inject my
repository there we go and create some
sample records here and so here my
friends I encourage audience
participation because I can't have all
the fun
what I want to do is I'm going to write
some records to the database that have
written titles movie titles to the
database and we're going to just riff on
the theme of reactivity and fluxes and
and monos and and so on so let's think
about this um Aeon Flux huh no no
anybody that's a real movie enter the
mono void get it okay the flux inator
silence of the Lamb does that's my
friend silhouette that's my favorite yes
sir yeah reactive mongos on a plane mark
had a great one e tu mano tambien
there's a movie called he tu mama
tambien but mono and Spanish things
monkey so that's kind of fun any others
yes pack of the flexes the fluxes I
don't I don't know the plural of fluxes
but if if a single dev ox is just the
Evo X source maybe it's three X's I
don't know um so anyway anything else no
back to what yeah back to the future
right back to the future thank you sir
and what we're gonna do is I'm going to
visit each one of those I'm going to
create from those names I'm going to
create a movie and the movie expects as
this parameter a UUID so we give it an
ID there you can expect the title
there's the name and it's going to
expect a genre and so I'm just going to
give it a random genre because it's just
fun to see what gets matched up to what
and though we're going to create a
little method here you know I'll have a
string array of genres okay and I'll say
horror rom-com drama action documentary
and we'll split that up okay and I'm
going to say new random thought
inte using the inclusive bounds of that
array there is the parameter there so
genre indexing into that very good
that'll give us our genre and then for
each one of those I just want to write
the records to the database actually
I'll just do a map again and so here I'm
going to say movie movie repository dot
save movie okay and that in turn should
do it we want we want there one more
thing don't we for each flat map could
be good where do we get there so we have
a mono we have a map now whatever let's
just call subscribe or for you even
better there we go just print out the
results okay this can be a lambda
okay Oh port binding conflict again
naturally so kill the existing Java app
P kill Java that's your friend we start
there we are oops
okay you want to do that
okay print out something more meaningful
here we want to get the cruciform we
just did this
what do we do there James yes we just
did this it was a subscribe in there my
friend okay
well whatever we can do it the hard way
with AM movie repository dot save
passing an m dot subscribe maybe that
one we just did that that's the one that
was o after this
okay
for each okay we start now we're cooking
so there we go so we've got the records
written to the database and I've gotten
the results coming back this is a
database that's already you know it's
already existing so we need to make sure
that we clear everything so I'm going to
go ahead and say delete all and what I
can do then is I can subscribe to the
results and what I want to do is when
when the M the result comes back I want
to call this method and write the
records to the database so I only want
to write data after everything is done
right so after the deletion has happened
and I don't need the I don't need the
other parameters here so the other
parameter would be for the throwable
don't need that don't need the runnable
I'm just going to do everything at the
very end of the of the line they're
complete oh yeah
on the okay we'll do that in the very
under runnable okay so we want better
than nulls put that in the runnable that
didn't work so runnable okay
there we go so we've written everything
down and now when the when the results
are all betwen this is asynchronously
confirmed that everything has been
deleted we then write data to the
database so we're all ready we're
demonstrating how to do react sort of do
a dependent call using the reactive API
right so now we've got something very
simple I want to build a service to work
with our our data set here right so I
can imagine a couple useful methods
let's say we want to have a one I have a
class called the flux flick service and
our flux flick service will have a
method to return a single movie by its
ID so we'll say by ID passing in the
string ID that sounds reasonable we
might want to have an in point that
returned all of the movies right so
movie
all that's fine as well and I want to
have another endpoint that returns all
of the instances when people stream the
the what then when they stream a video
and they watch a video right and I don't
actually have a giant catalog of users
logging into videos watching things on
my website to work with here so I'm
going to have to sort of fake it a
little bit here I'm gonna create an
endpoint that returns a flux of movie
events showing me whenever somebody's
watched the video alright so I'm going
to stream basically I want to stream a
potentially unlimited amount of data
relating to the streaming of data so I'm
going to stream the streams or in as in
essence I'm going to cross the streams
right so stream streams and create a
little POJO here just to wrap my movie
and the the port is going to carry the
movie itself it's going to have the date
when this happened and it'll have the
user that's watching it so there we go
all right there we are
and I'll use Lombok to make short work
of creating the the getters and the
setters and all this stuff and I'll
create a two string method there we are
so we have and an all args constructor
and no argument constructor very good so
there's our simple detail or a little
POJO we can implement the you know most
of these pretty simply right so I can
say movie repository dot find all thank
you very much that worked as we expected
movie repository does find one right
again this works as we expect so there's
this but the this one is going to be a
little bit more interesting a little bit
more involved we need to create
to fluxes we want to actually synthesize
data that comes back at you know at a
trickle as things are happening
asynchronously so I want to use some
operators here we're going to we're
going to create two fluxes and then I'm
going to combine them we're going to
compose them and that's when you are the
benefits of this programming model here
by using by using the reactive streams
API and by working in terms of the
reactor projects primitives mono influx
you can write code that is easy to
compose as you can write code that can
be made parallelizable alright you get
that for free just by writing code if
you think about the the flux my friend
james here on the front james track he
gave me a very good way to think about
it he says it's a a it's sort of like an
iterator but it's inside out instead of
asking for new results you get a new
result if you think about if you write
all of your code in that way doesn't
matter if right now everything is
synchronous later on you can switch it
to become asynchronous and the code
doesn't have to change because it's in
the right it's in the right approach
anyway so what I want to do is here's I
want to say let's create a flux that
generates a new value it produces a
publisher publishes a new value every
one second okay so we'll say that that's
a flux of Long's that's going to publish
a new value every one second there's a
scheduler behind the scenes here and
then since I don't actually have actual
people watching movies I'm going to just
create some movie events right so I'll
say event equals and I'm going to create
a new flux from a Java eight stream so
I'm going to say scheme that generate
and it's asking me for a supplier and
then the supplier I'm just going to
return a new movie event passing in the
movie itself right this is the movie
itself and then I want to return when so
I'll just say right now sure and then we
need a random user right so I'll create
a new method that returned to the user
for me there we are
and same ideas before I want to say
string users equals and let's see m'kay
heck that's him Jase Trek can still it
web is it
I always forget his Twitter handle Phil
web maybe yeah whatever um I'm Starbucks
fan there you go this is a bunch of
users okay oh and um Java half expert
okay split go through that and we're
going to say new random and next int and
users dot length we're going to say
we're going to index it by that random
there we go so we'll now have some
random users I associated with that
those events and what we want to do is
combine them so we want to actually emit
a new movie event for every one second
or every second every time there's a new
duration in value emitted we want to
also emit a movie event so we're going
to use some of the operators in the flux
API flux that zip in this case and here
I'm going to say zip the intervals and
zip the events and then map them I want
to take the value which is coming back
as a tuple of q2 right two values I want
to take it and tuple two x equals ya get
T 2
all right thank you Tibo to of that time
so what I'm doing I'm saying create a
new flux that contains only this new
value but produce this new value the
second value in the tuple only when the
first value produce when the first flux
produces the value so it's a zip it's
just like a zipper takes one from left
one from the right takes one from left
in and it produces a result so there we
go we have a very very simple API let's
actually build a REST API for this ok
and this is where you know this is I
think where a lot of people get a lot of
value here's when you talk about
reactive programming and you talk about
it as an end to end thing right from the
right from the web tier all the way down
to the data tier and this is the this is
building built in inside of spring 5 we
have a new web runtime called this
called spring web flux it's another
module that sits next to spring MVC it's
not sit bring mu C but it should be very
familiar for those who are already using
spring MVC it works on top of the sermon
today API if you want it to but for me
and for my money the most valuable part
of that API is something called
something that's based on the nitty
sort of asynchronous or IO runtime it's
a completely separate runtime it doesn't
have anything to do with the servlet API
and that's what we have by default
configured here so let's build a movie
rest controller I'll say at rest
controller this is the sort of
traditional way that we're used to
thinking about building these endpoints
right oops here we are got that and what
I want to do is own it inject that flux
flick service okay create a constructor
and I'm going to create a few endpoints
here that you know are going to be
served up as in web invoice so mano of
movie by ID taking a string ID okay
we'll come back to this implementation a
second we're gonna have public flux of
movie all the movies okay return null
for now and we're gonna create a public
flux of movie event events string you
know the movie ID okay now let's get rid
of these first two they should be fairly
straightforward right so get mappings
let's map the whole controller to four
slash movies so request mapping four
slash movies and then down here we're
going to say that we want to get a new
movie by its ID should be fairly
straightforward if you know about string
the spring MVC right so this dot by D
code writes itself
okay and then same thing for here except
that we're just going to get all of them
don't need to specify the ID
flick-flick service dot all voila
okay now this one is a little bit more
involved think about we're trying to do
here we're going to return all of the
records all the events relating to a
particular movie that data may come back
at different times so there's a few ways
in the web tier to handle this kind of
kind of sort of directionality we're
sending data to the client at unknown
intervals it's not a it's not something
that we expect the client to load all at
once it's something that the client
should know to constantly to be on the
lookout for shouldn't try and close the
sock or anything like that there's a
couple ways to do this if you want
bi-directional communication WebSockets
are a great fit here all right
WebSockets give you the ability to
asynchronously deliver values to the
client to push values down to the client
in our case we don't really need
bidirectionality we want to push data
down to the client and just have the
client you know read it when it's
available and so in this case we can use
server sent events okay so I'm going to
say value equals and we're going to
produce an endpoint that is of type text
event stream value and I'll map this to
an ID so what I'm going to do is I'm
going to say return or I'm going to say
Flex flick service by ID passing in the
ID then I'm going to take the results
from that alright I'm going to take that
result and I'm going to flat map that
ship all right so I'm going to take that
result and we turn it that's a what the
cool kids say is that true thank you
James so flex look service dot by ID
passing in movie get ID and we want to
stream rather okay there we are and
there we go so that can be a lambda
however what that's going to do is I've
done a demonstrate here a dependent call
we're going to asynchronously call the
get by ID method and then on the results
when the results come back we're going
to call the stream screen vetted on that
and in return the result of that to the
to the client on this now this should
give us a very simple endpoint here okay
let's try this curl HTTP localhost 84
8,000 events and you can see you've got
a bunch of idea so you just just try
event first of all movies rather Oh 8080
okay a little hard to read so we'll pass
that the JSON PP and it is an ID so
let's now curl HTTP localhost 8080
forward slash movies get that good so
that seems to be working now let's see
if we can get the service and event
stream that should produce a new value
there it is every second we get a new
value automatically being produced for
us now if you're using spring MVC proper
that sort of classic approach to doing
this the traditional way of doing this
what you get back they what you would do
is you return an sse emitter and then
whenever you have a new value have to
publish the value into the sse emitter
so we're basically doing all the
domestics that you have to do when using
a publisher you know you're doing the
same thing it's just a lot more
convoluted it's more natural than
reactive api to do that now okay so this
is the traditional way of building web
endpoints in spring and I think this is
going to be very familiar to a lot of
people but there's a new approach called
functional reactive endpoints that you
consider our support and spring five as
well so let's try that again let's
revisit our same code we're gonna create
a new beam here router function right
route good and we're gonna say router
function dot route and as expecting a
that of course can be a static import so
I'm going to say route and it's
expecting it router requests predicate
so we can say request predicate dot get
and the the first thing that we need to
do is to say I want to get all the
movies and then it's expecting a handler
and the handler is a callback to lambda
so we can put the code here we can say
when a request comes in dot body to flux
right movie that class and that should
see oh movie that class is that right we
want to call sorry I want to call the
flick flick service passing that in
service dot all of them passing that
okay and this is what it is okay
request Oh service all sorry server sent
server response that ok dot body service
all equals that okay there we go so I'm
saying create let's see a little cleaner
so I'm saying when the request comes in
I'm going to use the server response
static import methods to create a
response I'm going to create the body
I'm going to map them to type of to type
of a moat movie right that's the first
route I'm going to create another route
I'm going to say that I want to support
to not do that static method good I want
to say use get movies ID okay
and when this comes when this happens
we're going to return another lambda
okay give it another lambda saying
request comes in okay body and here want
to say by ID so we want to do the same
kind of thing as we did before where we
take the results and asynchronously
respond to them we actively you know
return the result so server service dot
by ID I'm going to say request dot path
variable ID then a flap flatmap that
send it to the response and the response
will be service dots stream streams
movie my ID okay movie by ID dot get ID
and I'm going to send more movies back
right I don't know this is the or just
moving outside moving by it moving just
about one by its ID there we go
so there's this okay
service by ID dot body and that should
be path variable looks fine to me
and one more route we need to say movies
ID events where events is spelled
correctly in some alternate world and
then we say that when a request comes in
request I want to say ok dot content
type again specifying the content type
here text event stream ok dot body and
here we're going to do the same thing as
we did before would actually do what I
was trying to do very clumsily above
which is to get the result and then turn
that into a something we can use a
request path variable ID flat map we're
gonna get a movie and then return the
service dot stream streams passing an M
ok so I'll pass that into movie event
class I'll turn it into a movie event
class this of course can be a lambda and
there we are okay there's a reactive
code got the extra call there so that's
a little it takes a few seconds for the
eyes to parcel that I think you can
extract these you can extract all these
callbacks to methods that return request
Handler and as long as you know those
can just be method references right I
don't have to do them in mind but I
think with that we can go ahead and
start it up and see what happens
okay so curl movies oops
okay json PP good silence of lambdas is
appropriately a horror so get that
localhost:8080
movies that one events fingers crossed
hey there we go good stuff so now two
different ways of solving the same
problem you can choose the post that you
want I think that the functional
reactive end points are really nice a
sort of maps with this functional style
that we're trying to get when we go to
reactive programming to into you know
using the dub age and job eight streams
and so on now this wouldn't be much of a
service if I didn't have a client so
let's build a client to talk to it I'll
go back to spring an air sizer here I'm
going to use spring boot Toledo and I'll
use the reactive web support and I'll
call this the flux clicks client okay
and we'll use Lombok as well because I'm
going to no doubt copy those types and
all I want to do in this example is just
to grab the results and then write them
out to the console and again we've got a
we've got service and event based thing
coming back from the client one thing
that the what we're going to do is want
to use the analog to the Spring
Framework Resta template in the new
reactive world it's called the web
client in the spring MVC world it's not
super easy to use the rest template to
do service and events right because a
lot of they convert a lot of the things
that we do and the rest template are to
call an endpoint wait for the whole
thing and then turn that whole thing
into a result and send it back to you
the process well imagine how that works
if you've got a JSON structure that is
never-ending you're sending back a
million rows or billion rows seemingly
endless amount of data you can't wait
for the whole document to load before
you can convert it you have to convert a
piece mail so a lot of the thing a lot
of the plumbing that we've had to do
underneath the hood to make this work
for you is to to handle that kind of use
case how do we you know how do we do
training for documents are like that
okay so let's see here's our client
we're going to start this up at a
separate port 8080 10 whatever and what
I want to do is want to create a beam of
type web client this is our our web
client that want to use you can specify
a route prefix a root URL if you want to
localhost 8080
for example movies to make things easier
and what we do is want to create a
simple client to call that end point
that we just created so or inject this
here the web client rather turn args
okay very good now the client end point
the client method allows us to say
client get passing in the URI in this
case we don't need to pass anything
that's just quote quote because we're
calling the movies endpoint we're going
to get the results by calling the
exchange method and then it's our job to
take the result that comes back what we
had is a client response we need to turn
that client response into something that
we can use so when I say body to flux
and I'm going to take the types the
detail the the movie detail from our
service here I'll put that in my code
base and I want to do the same thing for
the movie event here is this paste that
in here as well we don't have to bring
that anymore this is just the
client-side representation so I'll be
the same little annotations okay there's
that and now movie dot class that should
give us the results that we can use once
we have the response as a is a flux of
movie what I want to do is I want to
find the first one that has the right
that has a title and this title could be
what what's a good title silence of the
lambdas sure to lowercase just to make
sure I didn't screw up anything here
contains again just to be sure okay so
that'll be the we're going to find that
movie by its title and then we want to
say once we have sorry dope thank you
kind stranger so once we've done that
what do I do when I'm map that all right
we have a movie actually we don't need
it we want to map it why not yeah movie
let me say client response dot sorry as
a client dot get dot URI /id
forward slash events passing in the ID
in this case movie debt get ID and we're
going to say exchange dot subscribe
system.out.print line all by that
curiouser and curiouser
okay I think that'll work takes a second
to parse
not quite huh what do we have here
client I get that your iid events
passing in that I got it there yeah
so I subscribed 32 then oh all right
exchange map CR to see our body to flux
of movie event that class and then I
want to call subscribe again this time
passing in print mine okay
Wow
filter
for each and times like this it's
there's no shame in copying your own
code so what we do is going to go here
grab the client source main source mean
Java calm okay I'm doing something silly
that should have worked with doesn't
let's see what we did wrong here friends
so
here is the new one there's the old one
this assumes that configuration so we're
saying is called en pointe movies get
there we make the request map the
request the response to a collection of
movies filter the movies based on the
presence of the name flux which should
get us several results I think I just
did something with the equals there then
we said subscribe to the movie then for
the movie that we get back we call this
endpoint so what I did differently here
was I should have called subscribe
filter
doesn't really matter we have this here
okay there we go ah so with that my
friends we have very briefly looked at
some of the things you can do in the
spring five stacks to support sort of
asynchronous i/o both on the server side
as well as on a client we looked at how
to connect data to your endpoints again
the nice the benefit here is that
through the whole request change it's
all reactive the client takes a request
it puts it on a on the it takes the
request there frees up the front-end web
web web third pool so that the web
server can actually respond to more
requests the result is then sent down to
the database driver the database driver
itself you know keeps a file descriptor
ultimately that sends an event when
there is data available and no sooner
and no point do we have threads sitting
around waiting for responses then the
nice thing about this is that it's all
the ways to write the request all the
way down to the to the kernel you get
the ability to scale here you can use
less threads in your in your code in
your application right you get to scare
your services more readily so there's a
there's a lot of power here but you
don't have to give up all that you know
and in order to be able to make this
move you have the full power of the
screen ecosystem now what we have here
is preliminary this spring 5 was
released this summer along with the
complement of other features and then
you'll see spring boot late follow-on
later this year with the sort of auto
configured version this in order to make
this work of course we're doing or
supporting an integrating reactivity
inside of spring security you can see it
instead of other technologies where it
makes sense as well so with that my
friends thank you very much for your
time if you have questions I'm happy to
take them thank you very much Cheers
questions yes sir yes so the question is
how do I do
JDBC asynchronously and answer right now
is you can because it's not it's
intrinsically not synchronous it's not
it's not reactive either you can do
asynchronous JDBC but that's not what
you want here
Oracle again so their credit in the last
Java one in 2016 several months ago they
actually talked about in theory you know
supporting JDBC really reactive JBC I
don't know what that means in terms of
concrete plans but if if if OCO gets it
and that makes me think it's probably a
established enough concern that it's
going to happen you know so sorry will
support it when it's real at the JBC
level right now there are certain
databases like post grades which have a
pseudo react api that's different from
the main one that's not JDBC it's just
you know it's not quite there yet other
questions
thick so that yeah we can use we can
support HTTP 2 on the service I'm pretty
sure we can support web 2 htv-2 on the
client as well yeah I know that the
server side does write server send event
this is separate from HTV - yeah oh yeah
sorry yeah I'm blind - up here my friend
I'm sorry yes so the the question is
does the support back pressure the
reactor project which provides the
publisher specialisations mono influx
provide all both operators supports
things like back pressure to have the
ability to say instead of consuming the
next message I want to I want to stop
consuming until I'm able to handle it
right so one of the benefits of moving
to reactive IO is that it's very similar
to working with messaging messaging
technologies like RabbitMQ or active
active and cure ever with our message
queue you can never overwhelm the
message queue you can send as many
messages as you want
whether you can never overwhelmed the
consumer you know the message is the
message consumer same thing here I can
send as many messages as I want but
unless them unless the consumer is
asking for new messages it's not going
to be overwhelmed right you can't it's a
can overwhelm itself it'll handle
whatever it can and then not not taking
delivery of any new messages so that's
an that's an operator on the on the flux
or the mono or the public you know
there's those types there yes sir Oh
transactions so trends so when we talk
about transactions in the Java world
specifically we're talking about JTA
when talk about distribute transactions
right is that we talk about if there's
about resource resource local
transactions and that is a discussion to
have with each of the technologies
involved in the pipeline here we talk
about distribute transactions there's no
great answer distributive transactions
are supported by the X open protocol the
equipment protocol there's client-side
middleware binding for that called JTA
and the Java platform the JTA support
also transactions and JTA ultimately
rely on all sorts of thread locals and
and magic and stuff so that that's not
going to be a great fit in your reactive
world right yeah there's actually an
error of callback there's actually in
the SUBSCRIBE method for example there's
an error consumer that will take any
exceptions there so as I said subscribe
and it says a consumer for the item in
the stream or the in the item in the
publisher there's another lambda that it
expects for the error so it'll throw
back it'll give you any exceptions in
that lambda and then the third one was
the runnable for the on termination when
the when it's done subscribing to record
yes sir not yet the question is does
flux does spring 5 support fluxes for
JMS and I know we have work being done
in spring integration spring integration
is going to support reactive directive
consumption wherever possible so but not
yet other questions
I can barely see so if you're out there
and I'm not really in that selecting you
throw it up alright well thank you very
much I'm around feel free to ping me if
you can
Cheers</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>