<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Apache Sling as an OSGi-powered REST middleware by Robert Munteanu | Coder Coacher - Coaching Coders</title><meta content="Apache Sling as an OSGi-powered REST middleware by Robert Munteanu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Apache Sling as an OSGi-powered REST middleware by Robert Munteanu</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/vll9wezY1bs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hello everyone welcome back I hope
you had a nice jolt of energy in the
coffee break it's time to get started as
a reminder this is a tools in action
talk a bit shorter than the other talks
about 30 minutes so I'll be a little bit
more alert than the previous talks so
I'm Robert this is a batches link as a
noise Jeff power dressed middleware
let's start by finding out a bit more
about each other I work with Adobe
Systems in Romania part of Adobe's
digital marketing cloud but a lot of my
work is based on some open source
projects that you see there apache
slaying is not coincidentally the one
that i'm going to be talking about today
and when i'm done with working doing
stuff at work with open source then well
i go back in the evenings and do some
other over some stuff
it's developer related tools bug
trackers code review tools Eclipse
plugins I'd like to find out a bit more
about you so I can sort of estimate how
technical should I go into some areas so
who in here is familiar with OSGi okay
way more than I expected that's great
how about no SQL database is ready is
Cassandra Mongo Couchbase okay way more
time for other stuff so today's agenda
is the following we're going to find out
exactly what about displaying is some
quick facts and figures we're going to
have a special guest Barry you'll see
more about him later then we're gonna
have the first demo which will show at a
high level house link works with noise
Kuehl app databases then we'll try and
draw some conclusions out of that demo
and see why Apache sling is such a good
fit for no SQL databases a second demo
just for fun and we're going to touch a
little about why what else is there to
attach is linked besides what we've seen
the demo so as some history Apache sling
is well obviously an Apache project
we've entered in
about 2007 we joined the Apache Software
Foundation this year we had released
number eight and given the history that
we had before that we're about 10 years
old as a software project okay so what
about linkage okay a battery project
where you can see the evolution of our
code base in time we have a lot of Java
so basically a Java project and
apparently a lot of maven build files 9%
I think that's a bit too much but anyway
that's what you get through using maven
we had a steadily increasing level of
activity and this is what I call the
lucky screenshot it's a graph of Apache
projects using subversion and how many
commits Bellator have the single day
that I visit this page slink is at the
top so I took this screenshot these nice
representations joke aside slink is a
pretty active project amongst the Apache
ones ok so what makes link interesting
for us as web developers well there are
five pillars we call them of Apaches
link so it's rest-based we're going to
see a lot of that today it's part ball
SGI and we're going to see throughout
the talk why that is important I'm not
going to touch on content driven and
script scripting inside because there
isn't really enough time and it's an
Apache project ok let's start with the
simple one why is it important that's
linked is an Apache project well the
Apache Software Foundation is a very
neutral home for open-source project
it's where the big companies come to
collaborate so you can be assured that
no there is no very strong influence
from any company on such a project that
it's all balanced and community-based
and by opens by definition the code is
open source a license under the Apache
2-0 license which is a very friendly
open source business friendly let's call
it open source license risk base so it's
everybody talks about
I think that seven or eight years ago
everybody was talking about edge well
and if you're not doing agile seven or
eight years ago or if you're not doing
grass today there's something awfully
wrong with you so everybody says they're
doing breast but let's see how a typical
approach to doing breast would be in a
java application so there's this nice
cloud diagram if you have some roots or
parts in your application you would
typically define them somewhere and then
have some controllers which work with
them so for instance if you would have a
root path which is the entry point to
the application you would go for the
with the home controller and then the
blogs you would have a blog list
controller and then you would have some
sort of placeholder which serves or your
application oh sorry or your blog posts
and you would have a blog view
controller with that and well I would
argue that that's not necessarily the
basis for good rest design and well the
reason is that in rest is very important
to have all the resources identified
exposed in a consistent manner through
HTTP step base sorry through a URL space
and well in here you're just doing some
sort of manual pickup you're
constructing your routes without having
a really strong link to your content
model behind and this is where I think
slink can bring a lot of value now in
slink you have the central concept of
repository now a repository simply put
is a tree you have all your data stored
in a hierarchical manner and that is
composed of resources so you have a
route and then you have children of that
of the route and children and so on and
so forth and they are all mapped through
a single controller but the most
important part is that you when you
control you you create your application
you already design your URL space so
just like you are not by coincidence by
design the
resources are perfectly created to be
exposed through URLs so all you need to
do is append dot HTML and you already
have your URL space designed next up so
we saw we have this repository and
string offers lots of abstractions to
help you expose of resources over HTTP
so by default you have servlet switch
expose them using JSON XML HTML and so
on and so forth and many applications
use them the JSON and XML renders
out-of-the-box because they're quite
flexible and 99% of the time they do
what they have to do well on the other
hand for HTML that doesn't always fit
you probably need very customized
rendering for each component type that
you have so sling offers an additional
abstraction which is called a resource
ID so you can see that on the right its
disruption your repository and then on
the left the resource types so the
resource types actually are special
instructions for sling and say hey you
need to handle this in a different way
this link will direct one well
unsurprisingly sends a redirect to the
client typically you do this at the root
so you would send the client to the page
where it should end up and then if you
want to differentiate between the blog
list page and the plot details page you
just have different resource types ok
it's time for our special guest it's
time to meet Barry one two three yes
well this is Barry in case it's not very
clear he's not a real person and any
resemblance to technical architects are
for living or there is purely
coincidental
so Barry has two main qualities first of
all his buzzword driven he knows all the
latest no SQL databases the latest Java
Swift framers is on top of hacker news
and well that's a good thing but he's
informed now the second thing is that he
has a very short attention span
these two things put together aren't so
nice and it just happened that we are
co-workers at Acme software company I
develop technical software blog and
there is sort of a technical architect
so one kills a vacation I took a little
time rewrote the blog in Apache sling
because I know what a great tool it is
and how productive I am with it what
when Barry came back he had a shock
obviously and said no we can't have this
we need some solid storage and said
let's use couch base and I said how much
makes couch Ares and I said okay that's
a fine persistent project let's use that
and then the next morning he became
concerned that we are not able to cope
with the humongous number of comments so
he said use Mongo okay Mongo Marco next
morning he had another concern obviously
he said well the the static resources
from our application should be served
much faster let's pull them straight to
the disk and so I did and the next
morning he had another concern but this
time I was ready I had a laser pointer
and he's here he's chasing it as we
speak and I have a little breathing time
so I'd like to go through a little demo
of the the blog that I wrote as you can
see I'm not that great on design but
here's the blog it has a list of posts
you have some excerpts some snippets and
you can access the blog details and
there are some comments and is that well
you don't have to read exact details
and you see the comments nothing
extremely complicated well unless you
consider that you have freed even for
persistent systems which come into play
a fair remark is that you can do that
without the framework you can do that
probably with any framework but what
would be really interesting to see is
how Apache sling allows you to structure
your data in a transparent way so you
don't really have to care where it comes
from
let's go one level under the hood and
look at how the the JSON output from
sling appears so I don't want accent no
I want the Chasen and well that's a
large lump of text sorry I meant this
one now this is just asking for the
Jason rendering of the content block
page and going five levels deep okay
that's better so scrolling up a bit you
see we have the comments for the hello
world post and then we have a number of
comments with some properties and then
come the images which come from a
different source they come from the
fascism but they appeared to be the they
appear just like the the other resources
just like the comments we have bootstrap
and some phones and so on and so forth
and we actually have the posts which
well I have a large chunk of chunk of
text so I've tried to show how this
hierarchical nature of Sling comes into
play and now you see that these
resources appear to be the same - to the
client application let's see how these
are stored so I mentioned blog posts are
certain Couchbase here's a little
queries go straight to the Couchbase API
through view
and you can see these are the rules
returned and they have some culture
based technical fields the idea and the
key and then there's a value object
which contains two things one is data a
nested object which has the actual data
which goes to slang and then for for
lookup we have the path of the object
and the path of its parent and the ones
below are the same so Mongo these are
the comments that we sorted Mongo more
or less look the same there's this ID
which is the mangodi the MongoDB primary
key and if we want to look in more
detail to an object it has the same
turns path and data pattern and that's
the filesystem view okay so what it just
happened
we in sling we have this reporter
abstraction that I mentioned which
allows sort of like like you if you have
a UNIX operating system or something
similar you have a concept of mounts
there is a root and then in various
places in the hierarchy you can have
different mounts sling is pretty similar
so we have a root mount let's call it
which is a JCR mount we'll get to that a
bit later and then that various points
in this in this demo we have something
else we have the images we had a
filesystem the blasting Couchbase and
the comments in Mongo so how does link
internally manage this well the the SPI
the service provider interface of sling
is a resource provider it's an interface
it has two methods basically to
implement how to get the resource how to
list its children these are produced by
by a factory now the factory is no
J component it gets pushed into a
service registry and it gets picked up a
bit later and these are some of the
production ready provider factories that
you are in slaying the North QL once you
saw the file system and the JCR is also
there so once you get from you have the
spi defined then it all gets wrapped
into an API which the clients can
actually use and that's the resource
resolver which is sort of the bread and
butter of Sling if you're working with
whistling applications you get a hold of
a resource resolver so how do I get from
an HTTP request to my resource resolver
first it all started with an HTTP
request right so you have this get
request to a resource and then you have
to find out which resource this is
because sling is pretty flexible about
what its source you can't be sure about
whether this is the content blog post
hello world resource or a JSON file and
that is at their same location so you
have the resource resolver coming into
play and it picks the resource in a
similar manner you need to find out
which servlet or which script handles
your your request which is what the
server 3 sold or does and then finally
your customs orbiter script is involved
so how do I use a resource resolver well
I mentioned that we have a sort of a
path based access in sling so there are
no numerical IDs no uu IDs we have paths
so instead of doing a select for a
primary key you would get resource from
all paths something that may be of
interest is that while typically IDs in
databases are scoped per table we have
the power source code per repository
obviously if you'd like to read
resources that are tied to assured
parent
and that's something pretty common in
web applications you do a select which
does some sort of filter now this is
optimized for the single let's say
single child generation scenario there
are if you want to do arbitrary number
of children that's fill it gets
interesting pretty soon and in sling you
just get the children of the resource
and process how many you feel like
processing and what's worth putting out
here is that this is not just a Java API
which nicely wraps some sort of
arbitrary storage as you saw earlier the
DS store these resources are stored in a
way which is really optimized for path
based access looking at the parent
looking at the children and of course
people always ask well can we do queries
because they were so used to them and
yes you can do queries so that's another
simple SQL query where we have a search
criteria and ordering criteria and below
is an example of what the query can look
like in slayn this is an XPath query it
works against a specific resource
provider that's something worth
mentioning that queries our resource
provider specific there isn't yet a way
of querying the whole repository using a
unified query language there are cause
has been flown around but nothing yet
productized so writing resources looks
just as you would expect them to look if
you're using a data access object you
have some create delayed calls it's all
fine as long as you can as you call
commit editing resources is something
slightly different because you can
actually change the resource itself as
we'll see later so we know the whole
sling jargon we know how to use the
resource resolver how do we actually get
to writing some code
and that's the way request looks sorry a
servlet rather looks like you annotate
it there's a special sling servlet
annotation you extend one of the
top-level servlets and then implement
the method that you would want to be
invoked the request and response are
there you can see that it's getting cold
for post methods and that it handles
certain kinds of resource types coming
back to the idea that you handle sort of
resource types you have special handlers
for each resource ID and reading data is
pretty transparent you have the request
which already has the resource that you
care about and typically sling has made
sure that that resource exists that you
have the right to access it and all of
these sort of side constraints that you
don't want to handle in your script you
just want to handle what you have to do
in your script or servlet so there are
two ways the first one is getting a
value map a value map is basically a
hash map of string to object and for
most application this works fine you
have this sort of non structured
evolving schema and you don't need to
have let's say very typed way of
accessing it and there's a hash map you
can get stuff from it you see here a
property so a method invocation which
comes with a default so if that property
is missing you get the missing value
because it's convenient many times when
you display that on the other hand
sometimes you want to have your own
objects in here so you sling offers you
the possibility of adapting objects
unrelated objects one into another a
resource is unadaptable
which means that you can transform it to
know something else in in our case the
boss class is a custom class from the
application domain which slink has no
knowledge of but still we can transform
into it let's take a closer look
so in this schema the blue objects are
from slinks domain the silver one is
from the Java libraries and the yellow
one is from our own application domain
so there is no way these this post could
be linked to sling what sling does is
allow you to register some components
some osj components which know how
transform from object a into object B if
you register such an adapter adapter
factory which knows how to transform a
resource into a post then you can get
your your object from from a resource
writing data pretty much similar if you
want to write using a value map you call
put if you want to write using your own
custom post object you have that you
write using sellers on it all is fine as
long as it's ethical commit as long as
you call commit at the end and since
we're here at how do you handle requests
and maybe some of you saw the what
components talked from earlier I'd like
to tell you a little bit about how we do
templating in sling you have the
possibility of using lots of template
engines you can use JSP if you like that
but there's also options for groovy for
Scala Ruby server-side JavaScript but
the one that I think is most useful for
string applications one called sightly
which if you look at the syntax it's
based purely on HTML with data
attributes and custom not well an
expression language that should be
familiar to most of you and the way this
looks is if you take a look at the first
line there's a resource value map access
looks for the property GTR title if it
doesn't find anything then it it outputs
blog the second one is including
different resources
so you typically want your templates to
be sort of composed you don't want
everything in one big template file so
that's what you do with data sly
resource iteration is something which
you do pretty often as well so you have
this data stylist call which takes the
parameter list children which are the
children of the current resource and
finally you have the possibility of
using server-side helpers this in
JavaScript or Java and you have this
data slice helper call which invokes a
server-side jobs with helper which is
then called below I think that's pretty
simple and readable code and one extra
advantage is that slightly being built
purposefully for HTML is context aware
that means that when you output a side
expression it knows in which part of the
HTML template it is and escapes it
automatically so for instance in this
helper excerpt call I had to specify a
content of HTML because I would like to
say it's safe to output HTML for this
goal okay second demo time there is back
he is concerned again that we do not
have statistics for our blog before I
could say anything he told me about this
crazy new thing called Redis which is a
key value data store which has powerful
primitives for no getting data instead
sorting accounting and stuff like that
so I set out and implemented the
statistics using Redis now I'm going to
try to be a little bit brave here and
show you how so this is the web console
that comes with sling it comes for
another project from Apache felix and
basically lists all the components that
you have in your application I already
have deployed my component I'll take the
defaults this is where I want
my statistics to appear this is where I
want to my Redis server to be found once
that is done I will go back and we have
a lot of guest appearance from the block
statistics now the implementation is
rather simple we have we have the
factory for the resource provider these
are always really configuration
properties no rocket science here we
configure the component this is the way
to connect to jetties to read this sorry
J this is the library and then we
produce a resource provider now I forgot
to show you the data that I have in
Redis so these are the the posts the the
the odd ones are the blog posts and the
even ones are the the number of hits so
we have basically the same invocation
with with the Java API and we get we
convert this into a map keyed by path to
score and wrap them in a resource
now that resource doesn't do anything
very special either it takes the entries
and when asked for a value map it
returns them wrapped and that will just
like to be a bit more brave since
everything went fine so far we have some
nice tooling for eclipse so I I have a
meeting with top management I give out I
would like to show 10 times more blog
posts and there you have it
instant redeploy in Eclipse and just to
be sure these statistics are output in
the same consistent format when coming
from Redis as well so there's much more
just linked than this it's
it's full of features I'm not going to
stand the rid them all
suffice to say it it happens that by
good design and through the fact that it
uses also internally that we found out
that it's such a good fit for no SQL
data source actually we we built it long
beyond sorry way before that for
something called a GC our content
repository for for Java API which is
described by a couple of GS ours and
it's basically a persistence engine for
content driven applications which has
lots of the features that you would
expect that you saw earlier but also
versioning observation in memory
notifications of what happens in your
application folds X clearing
access control so native access control
so user repository and applying access
control entries to your repository and
if you think that working is linked with
these no SQL data stores would be nice
it would be great for you to have to
work with flinging the default set up
with Apache jackrabbit oak we have just
a little time to go for the buzz words
rest while we surest sling consistently
exposes resources over HTTP in JSON or
XML format middleware we saw how it
works with various data sources exposes
them transparently no SQL we had three
no sql's oh it's GI it's in there these
are some resources I will upload them
hopefully today and I am ready to take
two questions maybe if there are any ok
that was it then
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>