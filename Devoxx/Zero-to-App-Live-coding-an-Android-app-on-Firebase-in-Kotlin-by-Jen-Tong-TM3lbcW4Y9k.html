<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Zero to App   Live coding an Android app on Firebase in Kotlin by Jen Tong | Coder Coacher - Coaching Coders</title><meta content="Zero to App   Live coding an Android app on Firebase in Kotlin by Jen Tong - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Zero to App   Live coding an Android app on Firebase in Kotlin by Jen Tong</b></h2><h5 class="post__date">2017-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TM3lbcW4Y9k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everybody how's it going happy Friday
have you had a good week yeah who feel
excited
lots of excitement it's been fun yeah
it's been a great week and I'm glad to
help you in one of the last few sessions
to tell you a fun story so today we are
going to do a talk that's a part of a
series called the zero to apt ox and in
this talk we're going to build an
application we're going to build a
universal translator with firebase and
this is a talk I love to do on the road
because I'm I'm a monolingual person I
only speak American English which can be
challenging at times but this can make
it easier but before I get into that let
me tell you a little bit about myself
hi I'm Jen I am a developer advocate at
Google focusing on cloud platform and I
spend a lot of time playing with
firebase stuff as well and I'm in this
role on what I do is I come and I get to
tell you all of you great stories about
stuff involving Google Cloud and
firebase products and I also get to go
back home with stories that I hear from
all of you about what we what we're
doing great what we could be doing
better what you're interested in to help
us figure out what we should be working
on to improve our platforms so I always
love hearing from all of you whether
it's a story about something awesome you
created or a challenge you're facing
with a Google platform or API so please
do reach out to me if I can ever help
you can find me on Twitter is a pretty
easy place to find find me just drop me
a DM I'm mimic codes and if you'd like
to I don't have my website you're out
there but if you'd like to ping me via
other channels I'm also mimic comm you
can find other ways of contacting me
there so we're gonna be doing some code
but before code let's do story time
who here like science fiction what few
hands on okay everybody's hands went up
yeah I figured that might be you know
some selection bias that with that I
love sci-fi too and it's actually been a
big influence on me growing up I watched
a lot of science fiction and it's one of
the things that helped guide me towards
engineering
to see all the cool stuff people were
able to accomplish with with technology
and one of my favorite stuff science
fiction series growing up was Star Trek
and Star Trek was really cool partially
because they had lots of really cool
technology that allowed them to
accomplish tasks or I suppose to make
the writing easier for example one of
these technologies was this magic
handheld device that allow them to talk
to anyone far away which seemed really
impressive and it's kind of neat because
we already have those today another
technology that they had was they could
just ask a computer they could just with
words talk to a computer and then he
would appear and that was really cool
and we've gotten part of the way towards
that like you can talk to computers but
T does not always appear unless you
count it arriving by you know rideshare
eats or something like that
but one of my favorite technologies of
Star Trek was the universal translator
which I think was just there to is a
plot device to make it easier to write
and make it easier for us to relate to
aliens but it was still really cool
because no matter what planet they
landed on and no matter who they were
talking to even though they had never
had any contact with the species on
another planet after a couple words they
were already completely understanding
each other with fully functional two-way
communication and that seemed like such
an amazing thing seemed so cool and this
is the kind of thing that I would love
to have because part of my job does
involve traveling around the world and
coming to developer events like this and
meeting other people in other contexts
that are using our stuff and I would
love to have something to make it easier
for me to communicate with them in their
chosen time so I decided to solve this
problem in the way I solve all of my
problems in my life with code
specifically writing a mobile
application so that's exactly what we're
going to do today I in a guide you
through the creation of the app to solve
the kind of like universal translation
problem and you can kind of see the I
guess you can to see the app where our
vision for it is it's an app you select
your preferred language to both
communicate out in and also to
language in so you choose your chosen
language for that you hit a record
button which is either big or small
depending on the platform of your choice
and you will speak into it and what it
will do is it will translate it to many
different languages simultaneously and
then anyone else with a copy of the same
app will hear it translated to the
language that they selected so that is
the app I envisioned to solve this
problem and I'm going to solve it using
firebase because firebase is a great way
to prototype mobile and web applications
so spend a couple minutes talking about
firebase and the components we're going
to use to build this application so
let's talk a little bit about like
traditional mobile application
development if I wanted to write this
app like a few years ago the first thing
I would probably do is start sketching
out the app like I just described and
then trying to pick some back-end
components to solve my problems
I'd pick relational databases I picked
some you know cache infrastructure I
figure out how going to be sharding my
data potentially or starting at the
database layer I'd probably have some
third party API is I'm going to use and
ID broker them through some some VMs or
processes running on those servers and
this is a great approach it definitely
gives me a lot of flexibility on how to
scale and how to do solve all the
problems my Apple solve efficiently but
it can take some time to get started
but there's other options because you
know we're kind of in the future now we
have lots of different options for
solving these problems and firebase
gives us some interesting approaches to
this
what firebase does is it it's kind of
like a big bag of goodies that takes a
lot of kind of the common tasks of
mobile and web application development
and gives you really good pre-built
backends to solve some problems and a
whole bunch of stuff in client libraries
to take care of the heavy lifting of
communicating with those backends for
example do storing state and storing
blobs which are two of the features
we're going to be using but there's a
whole bunch of other goodies in the
goodie bag everything from like static
file hosting to what else I have on the
slide remote configuration pushing
authentication all sorts of other
goodies which are not always fun to keep
reimplemented over and over again
and you might just want to use just one
of these for an application and in which
case it will work great but they also
connect really well and like I guess I
guess the word is synergize I never
thought I would use that in a
presentation they have lot of synergy
with each other so they're even more
useful when you use more than one
together for this application we're
going to use three specific things from
that goodie bag we're going to use cloud
storage for firebase which is a tool for
storing a big blobs of data particularly
we're going to use this specifically
we're going to use this to store the
recorded audio of the user speaking into
the app so that we can work with it in
the cloud we're going to use attenti
keishon partially so we can just
identify the users to our application so
they have access to their specific data
and also so I can um prevent anyone on
the live stream from jumping in on my
app in real time because that would that
would not be very fun or might be fun
but not for me and we're going to use my
favorite goodie from the firebase goodie
bag which is the real time database
which is actually the first to go D from
the firebase platform was one of the
original products and it is a back-end
that has is built around transferring
real time data so let's dig into a few
of these in a little more detail so
cloud storage for firebase so dealing
with like cloud storage and just general
blob stores from a mobile app can be a
little bit tricky at times because you
have to figure out how you're gonna
handle the key brokering and how you're
going to for example set limits on
individual users uploading certain
amounts of binary data getting all that
access control can be kind of tricky so
what cloud storage for firebase does is
it gives you a nice default
configuration so that you can just call
the client library store your binary
data it does a good thing by default
it'll send it up to a cloud storage
bucket which will then make it globally
available for any other client anywhere
around being served up through all the
different points of presents the cloud
storage provides and it also has all the
client library components for
automatically syncing to clients that
care about it so you don't have to spend
as much time moving around those bits
and stuff like that so
problem that it's deceptively
complicated and it makes it a little bit
easier authentication is another very
important thing especially if you want
to restrict access to an application or
you have data that is user specific for
example like user profiles where you
only want users to be able to edit their
own profiles security is important and
firebase authentication is the kind of
first step in building out that security
framework for your apps because you have
to be able to identify users before you
can figure out what they will have
access to and the way firebase
authentication works is it gives you
pre-rolled implementations for a bunch
of different authentication schemes for
example we have pre roles like backends
for OAuth like social login providers
like Facebook github twitter and google
has anyone ever rolled their own
authentic platform authentication
provider with OAuth a few people was it
fun
No Oh someone said that's the first time
anybody's ever nodded I think
authentication is pretty cool too but I
did not enjoy building both a Twitter
and Google authentication broker at one
point they use different interpretations
of OS but anyway we've already done this
with the firebase authentication stuff
and we also have like username and path
our email and password authentication
for users that don't want to do a social
login we added phone number
authentication a few months ago which is
pretty cool and there's a client
libraries for integrating with existing
authentication systems you can mint the
JWT tokens to integrate with your SSO or
an existing authentication system which
is which works pretty well
and one of the neat things about
firebase authentication if each one of
these log and providers boils down to a
unique identifier for that user across
all firebase services and you can if the
user comes in via a different
authentication flow on the future you
can you know give them access to the
same data because they're still
identified as the same user to firebase
and then finally my favorite part the
real time database so the way the real
time database works is it's kind of like
a big old bowl of JSON in the sky cuz we
all love JSON right mostly nods a few
few shaking heads I guess it's an
infinity crowd about data storage
formats violate JSON it's convenient
it's pretty easily human readable and so
the way it works is you imagine all of
your back-end data is one big old ball
of JSON
your applications can write to certain
nodes or sub trees anything you could
put in JSON so like boolean strings
numbers stuff like that and then your
clients will tell the real-time database
what subtrees or what queries against
sub trees they are interested in and
then the client libraries will work with
the server to make sure that any client
will always get push updates for the
parts of that big ole JSON tree that
they care about so will handle all of
the synchronization all of the
background threads for the network
transport cache invalidation which is
never fun to work on yourself
we give you good sensible defaults or
all that stuff we also have a P is for
handling both short duration offline
like driving through a tunnel as well as
long duration offline like going for a
mega hike across Appalachia or something
like that so you can configure like
pinning and all that stuff for handling
those offline cases too which is also
not very fun to roll your own so enough
talk about the firebase stuff let's show
it to you in action let's do some code
sound good yay okay so let me show you
the someone was especially vocal I like
code so this is the starting application
we have up here let me make it bigger so
it's even bigger on the big screen mmm
soothing adviser to cooperate there it
goes that's pretty big and it doesn't
really do much right now so it's just
kind of a shell of an android app which
of course means it's quite a bit of code
because it's an Android app and Android
apps often have lots of code inside but
you see the controls I described earlier
where we have a check a spinner a
drop-down box for picking the language
we want to speak and understand we have
a record button for recording an audio
clip and then any translated text to the
the global chat room essentially will be
will be put here so we've already done
ahead of time as I've already written
the code that does like um the the
recording like taking taking the bits
out of the the media recorder and bring
them down to a local file on the Android
device and all that kind of stuff I've
also gone ahead and set up all the
Gradle dependencies for
fire base because that's not terribly
fun to watch and some of those it can
take a while to download so when you're
gonna get started by adding fire base
actually taking a step back this is a
kind of a general flow I'll use for
building applications if I'm going to be
using firebase is I'll kind of wireframe
out just the front end I'll get the
front end I'll get looking the way I
want and then I kind of get it working
locally like without much real behavior
and then I kind of add firebase into it
wire the UI components directly into the
real time database and then before I
know it the apps just kind of already
working which is pretty cool
so if I'm going to be doing that if I'm
gonna be starting from this like UI
wireframe the first thing I'm going to
be doing is pasting in some code that
will go and get an instance of the
different firebase components i'm going
to use so i'm going to be using storage
for the binary files i'm going to be
using authentication for doing all the
authentication handling and of course
the real time database removing all that
fancy fun state around then i need to be
able to handle the first thing i want to
do is i want to write to all the data to
the different firebase services i'm
going to use so i'm going to be
uploading a file to firebase so what i'm
going to be doing here is i'm going to
be using the references that I've
initialized in the oncreate and i'm
going to come down to this upload file
method which it's called when the button
gets pressed and the recording finishes
and i'm going to set up the references
so that i'm doing here that i'm getting
a couple different references first I'm
asking that storage instance for a
reference kind of a handle on a
directory to a directory in cloud
storage called
uploads so just give me a handle on the
uploads folder and this is going to
establish the sessions and get
everything ready to start moving data
back and forth and I'm also going to ask
for a reference to the real time
database and what I'm going to do here
is you can give it a path to any subtree
within that database I'm just going to
refer to the root uploads node and then
I'm going to call push and what push
does is it gives you a monotonically
increasing globally unique identifier it
gives you a database
and this one is appending it to that
path so that everything I write will
write to that location and what this
allows me to do is have many clients
that are writing at once and have all
the stuff go in ceará Li and the client
library will take care of like
correcting for clock skew and all that
other not fun stuff
so with those database references in
hand I'm going to upload the file to
storage I'm going to take and I'm going
to upload it I'm going to name it
well first okay so I'm getting an upload
draft and I'm naming it based on that
monotonically increasing identifier that
I got from the real-time database I'm
also going to configure some metadata on
that file then I'm actually going to
push the bits up to the cloud I'm going
to get that recording from the local
filesystem
I'm going to associate that metadata
that I defined saying like the content
type and that kind of stuff so that I
can I know how to transcode it later and
the first thing I'm going to do is add a
handler that will respond to failures so
if for some reason I am unable to upload
this method will get caught up so this
could be because of like something that
happened a network could be because of
an authentication failure anything that
caused it to fail well it will trigger
this and it passes in an error object
that I'm not actually using I'm just
toasting a message that says I'm sad
then it can add another handler and what
this handler is going to do is this
going to respond to a successful case so
in the case that I'm successful in
uploading the binary of the recording
then I'm going to create an object just
a POJO which I should probably convert
this to a one of those wonderful
cognitive classes but I haven't yet so
I'm going to create a recording object
it's just a POJO that I'm going to put a
bunch of the metadata about that
recording into then I'm going to take
that and I'm going to write that photo
to the real-time database so it's going
to get sent up there and it's just going
to get broken down into an you know an
associative array of stuff in the
real-time database and I can use that
for downstream signaling so let's go
ahead and run this application and see
what it looks like so we're going to run
pixal and let me bring up the database
viewer for the real time database and
let's see what happens when we try and
use this application so the Gradle build
is running so it'll do the dance while
that happens so in my fight with my
co-workers and film swords like that
comic once upon a time said and now
we're installing the apk this will
happen a few times during this talk okay
so our application is running now so and
we hit record it should be able to
upload something to the storage and then
it should be able to we should see it
appear in the real time database if
that's successful and map crashed does
it keep stopping oh I think I forgot to
log out after I rehearsed so let's go
see why I crashed and it says it illegal
State exception on the recorder oh I
think Android forgot about some
permissions I had said ahead of time so
I'm gonna take just a moment
troubleshooting this before I go in and
move on to the next step and then we'll
fix this after the fact so this is under
so it's asking for an application week
app permission because I was lazy and
didn't actually add the code that does
the permissions the way you would expect
so it's up there and it has the
permissions for recording so why are you
grunt the app you were fine this morning
give it one more kick okay so we're just
gonna we're gonna pretend that worked
and we're gonna keep on moving because
the thing that would happen if it was
cooperating is it would pop up the
message that said it's sad so we go back
down here it would say where did that
month ago so we're below on create we're
down here in the upload file method so
what I hadn't done ahead of time is my
back end was already configured to use
firebase authentication I was requiring
clients to be authenticated as a user to
be able to upload data to storage as
well as to be able to write stuff to the
real-time database so because those were
set up on the backend and I hadn't
actually authenticated on the front-end
it blew up in a little fireball and
should have just still toasted and said
I failed to upload the
so the next step for that is to go up
ahead and add authentication handlers to
our app so we're going to go up and
we're going to add that and we'll see if
this fixes my application which I don't
think it will but we'll find out so
we're gonna go back up onto the on
create method on our Android app and
we're going to set up authentication and
the way firebase authentication works is
just the regular firebase authentication
libraries provide kind of low-level
handlers for doing like all of the
different passing of chunks of data
around and keys and all that stuff to do
the authentication but they don't have a
strong opinion about what the UI flow
should be so you don't you would have to
kind of like which makes it great for
integrating into a UI flow you already
have are styling it like the app the way
you want to style it but that's not
always the case especially if you're
just hacking out an app quickly so if we
in addition to that we have something
called firebase UI which is a set of
kind of default implementations for the
UI flows for a bunch of different
firebase things and I use this a lot for
the authentication stuff so the way they
work is they will for Android apps they
will if you are not authenticated you
can start an activity that will handle
the authentication flow for you so what
you do is you use the authentication
handler to determine if the user is
currently authenticated and if the user
is not authenticated it's going to be
equal to null off so old-timey and if
the user it is authenticated then we can
have our app with behave as it would in
this case we can have it listen for
translations but if it the user is not
authenticated we want to authenticate
them first so we're going to put in a
code snippet that takes care of that for
us so this code snippet does is it's a
wide sin but anyway so what it does is
it goes and it calls a method on
firebase UI to start an activity for
result and then it will create the
activity I would rather create the
intents to create the activity that does
the authentication flow for us and what
you do here is you set the different
providers that you want to support so in
our application I want to support email
and password login
and Google um again but I couldn't put
all the runs there for Facebook or for
my own SSO provider that kind of stuff
so let's see if it just magically starts
working again when I hit the Run button
otherwise I'm gonna go to the other app
which I've pre-prepared on another
package name just in case this kind of
thing might happen funny how that
happens isn't it Haley starts hey it
actually started like can we show you
the authentication flow so I was not
authenticated with this application so
it immediately took me over to the login
flow and this is this is the default
thing I can actually put some other
metadata on that dedication flow to give
the user some hints on the screen but I
didn't bother doing that so we can
authenticate I can authenticate as my
user removing codes at Gmail back down
and it's gonna take me back to the
application and then we will see if it
lets me record now if it's magically
started working now it's up to work
already
hopefully the other one works anyway um
so now I'm authentic ated so I should
theoretically be able to write objects
to the real time database and to storage
so let's actually see that in action on
the other prepared application so this
one's still recording hmm Oh cuz the
microphone someone just told me that I
had another application that was had
been recording for hours apparently
which lacked out that resource and then
triggered a case that I did not
anticipate in my application cuz mobile
development can be hard sometimes let's
see if that fixes it hello world so it
won't actually translate anything yet
but we see there was successfully
uploaded and we see that it appeared
here and this is the metadata about the
file I uploaded and if we go over to
storage we can see that there's an
uploads folder with a bunch of files in
it because I forgot to clear them out
but you can see that there's one from
right about now it's about 4.7 kilobytes
of me saying hello world but our
application has not actually responded
to it so I've sent data up to the cloud
so I can do stuff up there but my
applications not reacting to events in
the cloud yet I'm only writing data I'm
not reading it so symbol meant that part
next
so what we're going to do is we're gonna
go down to this listen for translations
method which is the method I call when
like my application is set up and it's
ready to start receiving data from
firebase so listen for translations what
we're going to do here is grab another
snippet of code and we're going to do
something we do a lot more using the
real time database we're going to get
another reference to a location on
firebase this time we're going to listen
to the path translations which is where
all the translations are going to end up
and then the next step it what we're
doing is we are adding an event listener
see if we can make this little wider
fighting visor here it does not want to
today it is a silly thing anyway okay so
here it is you can actually see all the
code so this one is doing is we're doing
a query against that tree specifically
we don't care about the stuff that was
uploaded an hour ago or a day ago
because it's all going to be up there we
only care about the stuff that people
are currently doing so we're going to
add a query a very simple query to the
limit to the most recent one object
that's been uploaded to translations
it's been written to translations so
what this will do is when we first
connect we'll get the one most recent
one and then as people continue to use
the application we're going to continue
to get callbacks called whenever another
one of those things appears every time
one appears is going to send us one down
and it is a child event listener which
is which means that we're going to give
the path just above where we want and
it's going to give us whenever a new
child is written up there we're going to
get callbacks for a variety of events so
there's a bunch of events that I didn't
bother implementing but in production I
actually would like for cases where the
children get deleted what should i do
should i you know display an X on the
screen as a child has changed but we're
just doing the child added so we're only
handing the case where a new one is
written and what we're going to do is in
this method which just gets called
whenever a new object appears the first
thing we're going to do is take on the
snapshot the snapshot comes in whenever
you get a
read event from the real-time database
and it's a it's an immutable snapshot of
the data at the time the callback is
called at the time the event occurred
essentially so if things change while
your callback is running it's still
going to stay the same because otherwise
that would be crazy and it has a bunch
of metadata in there one of the pieces
of metadata is the key which is going to
be the same key that we defined way
above on that push method as to rip
propagated through the system and then
once we have that key we're going to
listen for the language that we have
picked on the spinner so let's go down
into here and let's implement that so
where this one's doing this it's an all
checking the translation key if it
somehow gets called by an all one it
won't do sad things and then what we're
doing is we are creating another
listener so we're taking the language
that our application has selected and
the key that we got from the previous
method the previous listener and we are
listening for translated text to the
language we have configured and this is
a model you will do a lot as you as you
build out this kind of stuff with the
real-time database the subtrees that you
care about will change a lot will move
around based on events in your
application and the the listeners
themselves are actually very cheap to
construct so it's not unusual for a more
feature-rich application to have
hundreds or even thousands of listeners
that sometimes they'll be changing every
you know changing on the second or
minute they're very cheap as part of
that the way the client library is
constructed so don't worry about
creating a bunch of listeners but try
not to leak them if you leak them out
you end up sinking data you might not
want and you might be sad then so then
what we are doing with our listeners
we're adding a value event listener and
the value of that listener will on so
the previous one listen for when any
children got added to the node just
below this one is listening to changes
in the state of anything in that subtree
and whenever anything in that sub tree
changes we're going to get the whole a
snapshot of the whole subtree sent back
to our method and what we do here is a
pretty simple thing we get the data out
of the snapshot we as a string and then
we pass it to the platform the Android
native Texas
echh so let's go ahead and see if this
runs at the apk install it's getting
faster it's funny how that happens
so now what we can do is we don't
actually have any of our like
translation stuff written yet but I can
totally pretend to be it so I'm using
this database viewer to add it and we
need a fake key then under that we are
listening for I was currently selected
is English and then every hi everybody
it hey it appeared right there which is
pretty cool and there's a value listener
so it'll chitta it'll respond the
changes automatically so I can even
change this and it'll change pretty fast
on the client which is a pretty cool
because this one's going over why are
you Senate that one's going over
conference Wi-Fi so it moves pretty fast
as fast as round-trip to the firebase
servers which is pretty neat okay so now
we have our client which which works and
can both read data from firebase as well
as write it or can write data to
firebase the the metadata about the
upload and the binary data itself and it
can also respond to changes in the
real-time database so like we're done
right not really
I typed the translation myself and as I
mentioned at the beginning of the talk
I'm sadly very monolingual I'm ashamed
so I can't actually implement this by
typing myself that and I would get
pretty tired after a while so this is
where we can pull in other cloud
platform services and other fancy
serverless stuff new shiny fun things to
make this work better to actually
implement the the translation features
and we're going to do that and of course
the trendiest way possible today we're
gonna be adding machine learning but I
don't have time to train my own mouth or
anything and I don't really I'm not
really knowledgeable in that area anyway
so I'm gonna take advantage of some of
those pre trained machine learning api's
which are really just kind of a REST API
that you can send requests to and they
will do some work for you with magic and
then you get back some slightly
different data that is magically more
useful to you specifically we are going
to be using the cloud speech API and the
cloud speech API will take our audio
recording from the app and then
transcribe it into text and it supports
a whole bunch of languages which is
great then we're going to take that
transcribe text and we're going to send
it over to the translation api's which
will translate it into all of the
languages that our platform supports and
then we're going to pass that back to
the client so it can speak the language
that the user has selected at which
point it seems like we're kind of the
problem is already solved we can just
wire up those cloudy pies to the client
and like everything will be great kind
of as it turns out that if you put
something into a mobile application or
on client side especially something as
valuable as an API key or if you're
writing like a game like the cheat
detection code or something like that
someone is going to reverse-engineer
your mobile application get that stuff
out release it to the world on some form
somewhere and then you will be sad
because you will run out of quota on the
speech API and your app will stop
working and you'll have to pay for
someone else's use of your speech API
and that's sad so like mobile
applications have a lot of Secrets is
what I'm saying and something you need a
way to keep that secret away from the
prying hands of prying eyes of a would
be not nice application users we also
have to deal with the case of CPU load
so mobile devices are great they've
become faster than ever the CPUs are
ridiculously fast now but the batteries
are not much bigger than they were
several years ago so I could put the
models on the device directly and do a
lot of this heavy lifting on the mobile
device but then my phone might be hot
while I'm using it and then the battery
will die fast and my users will be sad
and they won't use my app so we also
want to be conscious of the amount of
CPU time and also like I'm building an
Android app and Kotlin today but we
might want to support multiple platforms
you might want to write an iOS app which
has you know a very different
development model and rather than hire
two teams to write
app in parallel and try to somehow keep
everyone in sync and get feature parity
and some kind of design parity I'd like
to be able to do as much of the stuff
with a single chunk of code as possible
and there are different solutions for
this there are frameworks for taking
code and putting it on multiple
platforms but there's another way to
what we can do is well tradition what we
might do for this is spin up some
servers and push all of this work to the
cloud you know spin up some backends
that do the heavy lifting that broke our
communications with the API is and keep
the API keys secret and away from our
users but if our application is
successful we're going to end up exactly
where we didn't want to end up managing
a whole bunch of servers and you know
I'm working for hips for start-up
company I want to continue moving fast
and focusing on the front-end and the
user experience for my application and
at Google we've been doing server lists
for quite a while way back in 2008 we
launched App Engine and we've been doing
a lot of several stuff for very long
time and we've been doing a lot of
serverless stuff basically internally
for even longer and over the years we've
learned a lot about different server
list technologies and you know that's
where new stuff becomes available
everyone specifically one of the newer
things I've been using I guess it's not
that new anymore it's getting close to a
year old now but it's really fun for
dealing with problems just like these is
cloud functions so because we're just
doing a small amount of brokering and a
small amount of secret data and not
really that much complexity in the cloud
but potentially big spikes of scale
cloud functions are they great implement
a great way to solve our problems so
let's switch over to another language
away from Catwoman away from Android
studio and let's bring up IntelliJ and
let's write some cloud functions so this
is kind of where you would start if you
were writing a cloud function that used
this stuff we have a bunch of
dependencies were pulling in yay cloud
speech API cloud translate API all of
our different API keys for doing making
those calls and one one little
boilerplate method for handling the
different representation of language
codes between iOS and Android
but we get started we have very little
very little boilerplate code which is
kind of cool it's a neat place to start
because you can basically start with an
empty file which is something you don't
see a lot on platforms these days so the
first thing we're going to be doing is
we are going to be creating a JavaScript
function because it is cloud functions
right and this function is going to be
we have a use cloud form to the firebase
there are a bunch of different events
you can respond to and the cloud
function will be called whenever those
events occur these could be like webhook
events like you have a URL when it gets
hit the function runs but there's also
some that tie into different parts of
firebase directly so for this one I am
writing something that was triggered
when there's an event on the real-time
database so it's a database trigger and
then I give it a path a sub tree that I
care about so whenever something happens
on a path that matches this query with a
wild-card the functions going to get
called specifically whenever something
happens on the uploads node with any
identifier it's going to call this
function this is really when it sees a
write event and writes will include
changes as well as new creation then
it's going to give me an event payload
that contains a bunch of goodies the
first thing I'm going to do is unpack
that event payload and put it into more
convenient to use things so the payload
is going to come with for example the
language and the sample rate and all the
other stuff that's within that note so
what I'm doing is I'm reading the object
that got passed into the function from
the database the next thing I'm going to
do is take that data and remount it into
a slightly different format so I'm going
to take it from my mobile application
format that I push to the real time
database I'm going to change it to a
format that I can send to the speech API
so I'm unpacking bits from one format
packing them into another and then I'm
going to point the function at the
recording where it lives in cloud
storage so I don't have to actually
download the data like I don't have to
pass it through or anything like that I
can just point it to the location I've
already uploaded it then I'm going to
run my recognizer event and that's going
to give me a promise so when that
returns then I will have the recognized
transcribed text I'll take that and I
will get another reference to a location
in the firebase real-time database and
I'm actually interacting with it through
the admin SDK because I'm running in a
trusted environment which allows me to
bypass a lot of the security rules and
stuff like that because this function is
in a trusted environment I'm a why I'm
giving it access to all of my real-time
database which is not a pattern you have
to do but it's something that can
certainly be convenient so that's why
I'm using admin ref here just as cut out
of convention and then I'm going to
write the transcribed text as well as a
language so with that written it's going
to write the transcription to the
real-time database and I can signal the
next thing so this is where the pattern
I use a lot when I'm using cloud
functions to solve these problems
I can chain them together so I've just
written a transcript down which is not
yet translated to still in the original
source language but what I want to do is
I want to hear it I want to like have an
event that I can trigger it to send it
to the translation API but I want I
don't have one big monolithic code I
want to break it into pieces
so you can do is you can have cloud
functions that kind of chained together
either they will send an event to the
next one directly or in this case I'm
sending an event through something that
changes in the real-time database so
this is another write event handler on
the transcripts node C Burroughs I cc6
pasting in another snippet of code so
what this one's doing is doing the same
thing we did above I'm going through and
I am unpacking the data and I've hard
coded the languages that my application
supports and then what I'm going to do
is I'm going to do the basically the
same thing I did before except kind of
like a promise if I de loop what I'm
doing is I'm mapping through all the
languages I support and then in parallel
I'm sending a request to the translation
API for all the languages I support
simultaneously because why I do them see
early why wait there might be some
client currently using that and
then if they for each one of those that
the translation is successful I'm going
to write the successful translation to
firebase real-time database and I
currently I drop the promise on the
ground if it fails but I could put a an
air handler here like a catch that would
write an air event to the real-time
database so at the end of the function
because I just forked off a whole bunch
of promises I have to add promise that
all to wait for all of them to finish
running so I can finally exit the method
if I don't do this the functional exit
immediately or maybe it'll never exit
it'll examine a times out after like 60
seconds so you want to make sure that
you clean up all your promises when you
do this and return an individual promise
that it terminates that you know that
reaches the state transition at the end
of your actual work otherwise you can
end up with with unusual behavior
because thomas's is crazy like that it's
still wrong it was still language
construct that I'm like kind of I kind
of be using effectively but it is it is
powerful so it's going back onto the
slides OOP so this point I would deploy
that cloud function I've already
deployed it ahead of time to save a
couple minutes so we can spend more time
on the fun demo but this is basically
look like you use the command line
interface to deploy the function it's
going to push up by functions to
platform and they will be there ready to
serve requests if it has a web hook
it'll also tell you what the address of
the web hook you know the web trigger is
so with that done let's all play with
the app together so I'd like all of you
whether you're home on the live stream
are here in person if you have a laptop
handy or a mobile device
get it out go to this URL and turn the
volume up all the way to the max that'll
make it more fun I promise and in the
meantime what I'm going to do is pull up
well I'm going to go to it myself too to
show you what's there you can pick a
language on this web interface a
language you would like to hear me try
to translate text into and then I am
going to write data to it
from the mobile application so let's see
if this actually works I'm going to
attend oh wow that's happening I'm also
going to show you the real-time database
as it happens so we'll watch the
real-time database so we can see the
function executions occur while this
stuff happens so going to say something
hello world I say that a lot during this
talk and hey we saw the upload get
written you can see all the metadata
there the cloud functions are now
running translate transcribing it it is
transcribed hey transcribed into text
and now it is translating in wind ooh I
hear a bunch of languages picked and we
see that's translated in all the
different supported languages I can
select a different language up here I
can even try and speak a language I
don't speak I'm gonna try that so I'm
gonna pick Japanese let's see how
successful this is a Hayek Ajay mas so
we went in it uploaded again we'll see
if it successfully transcribed it good
morning
Hey I actually said something in another
language yeah I did sometimes it
translates to something else so did
anybody pick a language other than the
ones I've shown on stage a few hands or
not they did fitted actually
successfully translated into those
languages it kind of makes sense
thumbs up everywhere wow I guess I gave
it very simple phrases sometimes I'll
try and speak something more complex in
and craziness will come out which is
pretty fun but it definitely does stuff
so what have we accomplished in the last
40 or so minutes we solved a problem
that I encounter in my daily life in the
way I solve all of the problems of my
life by writing a mobile application we
wrote it in Andhra
with Catelyn which is pretty cool I love
I love using Kotlin on Android it's so
much nice so much nicer than Java I love
Java too but Collins a good fit for
Android development and previously I
might have done something like this
where I had to spin up a bunch of
compute nodes and this may be where if I
had taken this application and moved it
further along in its lifecycle I'm
probably going to end up spinning up
compute nodes to do more development on
certain parts of the back end but it's
certainly more fun to have an existing
application that's working to start from
before I start optimizing different
components using different training sets
maybe writing my own translation models
or actually doing the translation from
audio instead of from text which loses
some of the resolution and this you know
I presented a different way of
accomplishing that fact and getting that
prototype out the door we use B took
firebase we took the select few of the
back-end components and a few of the
client libraries and hacked up an
Android app pretty quickly and not that
much code and then we wired it up to
cloud functions so that we could use a
couple pre-trained machine learning
api's so we could move quickly so now
this is where I kind of all encourage
all of you I showed you my favorite
recipe for hacking out mobile apps to
solve problems in my life I encourage
all of you to give it a spin there's a
free tier for all the firebase stuff and
you can build a lot of these things I
think all the translation api's and
stuff like that's the cost for those
there's free tiers for those as well so
you could you can get this working
pretty quickly so go build cool stuff so
we have a little time left if anyone has
questions in the next four minutes also
if you're interested in running this
yourself or giving it a poke or seeing
the web application or an iOS version of
the same app they're all up there on on
github or rather oh that goes back to my
web page so go back to a web page mimic
comm /z to a their slides all the
goodies are up there so any questions
none well if you have any questions I'll
be hanging out just come poke me in the
hallway and we can chat about server
lists mobile application development and
cloud api's and stuff so thanks so much
for
spending part of your Friday with me
have a great rest of your conference</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>