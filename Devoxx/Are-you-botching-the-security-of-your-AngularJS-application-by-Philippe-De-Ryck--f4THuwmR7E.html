<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Are you botching the security of your AngularJS application? by Philippe De Ryck | Coder Coacher - Coaching Coders</title><meta content="Are you botching the security of your AngularJS application? by Philippe De Ryck - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Are you botching the security of your AngularJS application? by Philippe De Ryck</b></h2><h5 class="post__date">2016-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-f4THuwmR7E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome I'm here to talk about
angular security but before we start I
want to talk about the world without
security problems a world that would
arguably be a lot better than what we
have today and so if you envision that
world and that's supposedly awesome
right you have a world where you don't
have security issues or you don't have
late-night calls where you don't have
incidents don't have data breaches
things like also a world where I
wouldn't have a job but that's that's
another story I'm not sure right the bar
is there but let's ignore it for the
rest of the talk so we're here to talk
about security and security is something
that is often overlooked and we often
have a lot of security issues and the
cause is ambiguous some people I've
heard earlier this week people talk
about the fact that the cause of
security issues our users I then do not
agree with that tend to think that we
push users towards making bad decisions
and that we can actually avoid that from
happening the real problem according to
me is that security is a problem because
of a lack of knowledge a lack of
knowledge amongst you developers about
security and I could not about people
how to use application securely and I
think the best thing we can do is
actually try to fix that and actually if
you think about why this is such a
problem it's it's fairly obvious right
then go out back back to the first time
you built your first angular application
which is probably a few years ago maybe
a few weeks ago if you're really new to
the scene in that case welcome to my
talk you're going to take a lot of
advantage of that I can tell you right
now back when you built your first
application essentially you didn't know
angular you had to start looking at what
what is angular what does it do you have
to start learning about angular building
the first thing and then from there take
it to towards bigger and bigger
applications and we have people today
running massive angular applications
which is cool to do that you need
knowledge and once you got the basics
you went further and further you went
into the digest
OOP databinding services factories all
of those things and you learn a lot
about that and then when you're done
with that you continue to dollar things
like testing and cucumber juice and all
of these new technologies and security
is often very low on the list security
that is often overlooked and that is one
of the main reasons that we have these
security problems today at least
according to me I may be biased because
I'm a trainer by profession so I train
people about security so I tend to think
that that's a very big aspect that you
need to take into account what is really
important is that to build secure
applications you don't really need to be
security expert you need to be aware of
security fundamentals you need to know
how to think about security in as a
developer and how to actually build
secure applications and many of these
frameworks actually help you doing so an
angular will also help you build more
secure applications a final note on what
you need to be you need to know when you
need to call a security expert you need
to know when you're building something
extremely complex or you have a very
complex threat model a very broad threat
model and you need someone that has the
expertise and has the skills to think
about these things if you do these
things you will be able to build a
fairly secure applications and we will
do a lot better than most of the stuff
we have today my goal here today is to
give you the knowledge about securities
very concretely i'm going to give you
four actionable pieces of advice that
you can take home and start building
into your applications tomorrow or next
week if you are from belgium because
tomorrow is a holiday here i'm also
going to give you one piece of advice
you can start practicing immediately
after this talk during lunch so
definitely stay tuned for that outside
of this talk i like i said i give
trainings on web security and I give
courses I write articles online I give
talks at meetups plenty of hosting so I
try to do my best to spread the
knowledge about web security and I hope
that you the people actually built the
applications that we use from day to day
pick up on that and actually start
building more secure applications the
final note about myself I'm also a chef
I did evening school I learned how to
cook like a pro
um so I combine those things into my
demos so essentially when you look at a
demo you will start to get hungry don't
run out yet and there will be plenty of
food after my talk and let's first talk
about angular security so whenever you
see this guy popping up and that means
I'm going to give you a demo and I'm
going to show you some security flaws or
features or whatever and we're going to
have essentially a good time I'm going
to talk about three major topics today
I'm going to talk about cross-site
scripting I'm going to talk about
content security policy and cross-site
request forgery so we have a lot on our
plate so let's dive right in let's start
with cross-site scripting cross-site
scripting you may have heard of the term
and very broadly described it's a
cross-site scripting attack and what
happens is that malicious content is
injected to New York page a malicious
content and let's look at an example if
you have for example search
functionality and somebody enters this
and that happens then you're in trouble
not necessarily because the alert is
evil it's simply an alert but because it
opens the door to a whole lot a whole
other group of attacks important to know
here is that cross-site scripting
started out as scripting it was coined
by microsoft in 2005 actually had to do
with frames and including script into
the URL which got processed and today
it's a lot more it has become a broad
term to identify content injection
attacks in web pages this means that
today you can inject CSS you can inject
HTML you can inject SVG you can even
inject simple strings static text which
will eventually lead to scripting class
script execution as I will show you in a
bit the real danger of cross-site
scripting the reason why across the
scripting is considered to be so bad is
because I'm whenever somebody manages to
execute a piece of code that code runs
in your context meaning that it runs in
the user's browser so if you are i'm
using your application it runs in my
browser and it can do whatever it wants
within that context in my browser so if
i have granted the permission to read
get my location for example that
injected code will be able to use it
permission to get my location
information you'll be able to read your
cookies to be able to access your local
storage data to be able to execute
requests send them to your back end
and impersonate the user these things
are the reason that cross-site scripting
is considered to be so dangerous and so
powerful it's if you look at this list
of the major security problems you have
the hospital tent for example I'm pretty
sure it got mentioned in the last buck
yesterday xss is ranked third there a
cross-site scripting is definitely a big
bro also two sons top-25 another list of
programming errors or problems this
excess is in there as well and to
convince you that cross-site scripting
is actually dangerous I have included a
screenshot from from beef and beef is
doesn't have anything to do with cooking
and not yet it's called the browser
exploitation framework project and
essentially what it is is in an
attackers toolbox so what happens with
devious you inject this very small
script into a page a user visits that
page and the script calls back to this
command centers of you see so you get an
online browser in the list on the left
and from there you can simply start
launching comments and they will be
executed in the hooked browser so the
the payload you see are they recommend
you see here is to gather images from a
webcam so simply by clicking and saying
get an image and it will contact the
browser use the permission to access the
webcam and actually transfer that image
as a data URL back to to the beef
framework here this thing is absolutely
amazing if you have some time take a
look at it if you need to convince your
boss that security is important show
them this it will work other things you
can do for example you can simply pop up
a fake adobe flash update dialogue and
provide your own executable there a
simple social engineering attack which
is very likely to work on a normal user
just last week they added and the virus
addiction so from within the browser
they can detect which kind of antivirus
is running on a certain user's machine
and the worst attack that's in there
actually is you can combine this with
another framework to launch attacks and
you can start attacking the browser so
if there's vulnerability in Firefox for
example you can launch an attack against
the users browser break out of the
process and actually access the user's
machine directly which is very
problematic and
things like this not the tool but the
problems the underlying problems is why
cross-site scripting is considered so
dangerous and final piece of convincing
if you think that cross-site scripting
vulnerabilities will not happen to you
it's for people that have absolutely no
idea what they're doing I have two
examples the first one is from the banks
in the Netherlands this is from the
journalist who wrote an article at the
end of last year and they showed that
all of the major banks in the
Netherlands had these vulnerabilities if
these people are here my apologies to be
straight they are they have been fixed
and they're not there anymore but
actually did is they injected some code
to make the page dance to the song of
the Harlem shake I'm going to spare you
the music so you get just a picture here
this is to show you um these banks are
vulnerable to this I would argue that a
bank fairly as some security knowledge
in house they know fairly what they're
doing and they should at least so even
they are vulnerable to these kinds of
things and it can be worse in a sense
that the Tor project people that
definitely know what they're doing
security-wise even they had a cross-site
scripting vulnerability in their website
so the argument yeah but I know what I'm
doing I'm probably don't have cross-site
scripting in my web pages is probably
false i'm pretty sure that all of the
web applications as you build have a
vulnerability here or there just look at
bug bounty lists even websites as
Facebook Google whatever they all issue
have bug bounty programs and they all
have paid thousands of dollars for
people finding cross-site scripting
mistakes in their applications and again
these are big operations that know what
they're doing Google knows their
security and they still have these
problems so how do you protect against
cross-site scripting that's maybe the
more important than to convince you that
it's actually real problem so what can
you do against it the root cause of
cross-site scripting is essentially
something that we we've been doing for
years so this is a snippet of code that
you will typically see on the web server
if you have a TSP server CSP server or a
PHP server you have some HTML code and
you inject some data in there and you
get an HTML page
and this the bottom part is what you
send back to the browser the browser
gets this huge HTML page which is
essentially data and code mixed together
and he has no idea what's supposed to be
there and what might be injected by the
user so you see that there's a script
tag in the beginning it's the search
example from earlier the server knows
what he has put in there but the browser
doesn't know any more to browser loses
all that contact information and that
essentially brings us to the root cause
of cross-site scripting it's a confusion
between data in code the server knows
what is data what is code but the server
doesn't parse the page and runs the
JavaScript the browser does and that's
why we have these problems you may
recall that this is a very similar
problem as we have with sequel injection
or command injection you have a
confusion between data in code and
actually the solution here is very
similar to solutions in in other fields
you need to make sure that the data you
put inside the piece of code is becomes
harmless and the server can do that by
encoding in this case the data and for
an HTML context so essentially you
escape the dangerous parts in the data
in this case the dangerous parts are the
open script tag and the clothes script
tag so you encode them with HTML
characters so the browser will not
misinterpret this as goat and we'll
simply consider this to be data fairly
soup a trivial solution and of course
you can imagine if you need to do this
in a web application of some size you
need to cover a hell of a lot of outputs
where you need to apply this mechanism
and to make it even more fun on the web
we don't only have HTML context we have
a whole different a whole set of context
you need to take into account so we put
data in between HTML tags there a script
block is potentially dangerous of course
you can trigger XSS hours script code in
other ways as well what if you put data
in an HTML attribute you might want to
protect against as someone breaking out
of that attribute and adding a non error
handler for example similar story for
style sheets and scripts and so on and
this is why cross-site scripting
protection is complicated because of the
different contexts the different ways to
do this
and all of the place is very neat please
you need to miss one place somebody will
find it and you're in trouble by the way
if you need to do this in a traditional
applications there are libraries that
offer all of these these escaping
function so you don't need to write them
in yourself so I've been talking about
applications like this or a bit more
modern than yahoo from 1999 essentially
we're I've been talking about
traditional applications applications
where code is processed on the server
and HTML is delivered to the browser
you're hopefully here to talk about
angular this is an example of an angular
application angular applications not
only look a lot cooler they also work a
lot different and essentially the
paradigm you have in an angler
application is that we have an
application delivered to the browser it
runs in the browser and it uses an API
to fetch data from and that's something
entirely different than what I've talked
about here so how about cross-site
scripting in angular is angular
vulnerable to cross the scripting what
you need to do to protect yourself and
this is where I want to go back to the
introduction and cross site scripting
back to the confusion about data in code
so i told you that this is a very stupid
problem to have and if you really think
about what it means in an angular world
it means that your templates in your
JavaScript code are essentially goat and
the data you get from api is essentially
data so this sounds like like good news
and it's time for the little chef icon
there so let's show you what happens in
an angular world when you inject scripts
so I have a demo application where you
can gather some recipes it's fairly
simple and but I want to show you is you
can actually okay I have no idea what's
going on
the course of demos of course let's
let's try again yeah you see this okay
you don't need it yet so in my profile I
can add some specific string so let's
let's go here and let's say I want to
introduce myself to the user of the
application including a script block
which is potentially dangerous if that
succeeds let me enlarge Elizabeth if
that succeeds em we would have a certain
attack vector as you can see here this
is the angular application at work and
as you can see here on the top the code
is shown here which means that the
browser doesn't execute this code
essentially the browser simply put the
data I put into the input box there puts
it directly into the page and because
you see all of this this means that the
browser has encoded this data for the
HTML context and this allows me to bring
the first piece of positive news angular
actually knows the difference between
data in code so this is pretty cool
about the fact that you have a
client-side application angular protects
you out of the box against this kind of
attacks angular knows well a part of
angular called strict contextual
escaping msee knows you are putting data
into the page and applies this escaping
function automatically you don't need to
do anything for it at least since
version 1 not do this is enabled by
default this applies to do all things
you bind with ng bind or the double
double curly braces and that's
essentially pretty damn cool so by
default um nothing bad will happen like
that but of course there are situations
where you actually want some HTML in
users data what if I want to allow my
users to customize their head or a bit
and see what happens there well again
let me show you what that would mean
so let's say we want to allow them to
put this in there of course not this
surprisingly doesn't work and of course
this is Street contextual escaping at
work so angular allows you to do
something which is called an HTML output
and you have ng bind but you also have
ng bind HTML and as the word of the
directive says this allows you to bind
HTML into your web page so if we reload
this page we see nothing anymore and if
we go here you actually see a big nasty
error of angular complaining about
something that we did wrong and I can
assure you the code is it's not wrong
this is angular at work so apparently
this doesn't work which is a problem
because you actually need it to
implement such a feature your boss
wanted you to enable this so that's
angular getting in the way which is a
good thing but also a betting session so
what do you do you start looking what
does it mean what is this error where
where does this come from and you find
stack overflow of course Stack Overflow
has helpful answers for all your
programming problems copy paste answers
something like this essentially if you
read the problem here is the problem was
that guy wanted to output some HTML and
this helpful response says well you can
you have to sanitize this data so you
need whatever needs to be sanitized
sanitize it and you can output it into
angular all right let's try that I have
copied that code to the project here so
we have this sanitized filter this is
essentially the snippet from stack
overflow and what we need to do here is
um sanitizes by the way if you're not
familiar with the term sanitization
means that you will take out the
dangerous
arts and leave the other parts untouched
so let's see what happens great we have
the ball tag that's essentially what we
were aiming for so we can take off this
issue in our bug tracking software and
we can move on to the next ask so this
is essentially how you output HTML in
angular create until of course one
evening you get something like this and
people in this case exploited your web
application so what happened they used
all evil tricks they had and they loaded
amber the Emerald library in your
application which is kind of evil in
that sense by the way if you're a number
developer in a room tell me angry I use
the same joke when I talk to amber
people but of course with angular as the
subject there so let's let's go in a bit
more detail what what really happened
here and this was a piece of advice we
got and on first sight it looks looks
okay you even use this SCE service here
so essentially am what actually went
wrong if you would have taken a time to
read the documentation and documentation
doesn't include big red scary warning
signs but maybe it should it says that
you get this error because you're trying
to put untrusted data in a trusted
context so angular knows what's
happening angular nodes like you're
taking something very definite idea what
the content is and you're putting it
directly into the page which might lead
to script execution okay that that's
definitely am a problem and they even
give you a hint on how to solve it and
they point you towards an NG sanitized
module which sanitization sounds good so
maybe that's the thing you need if you
look at this piece of advice in more
detail and you find this trust s
function and the documentation there
says that this function is used to mark
a specific string as trust the data and
this means that once you do that angular
will know line will complain when you
put it in to a certain context even
though it might be interested so let me
show you what this actually means in
practice so let's go back here and let's
take the attack vector
let's put it into our application so we
edit if you do it like that you already
get this alert this alert is simply
being executed because we have marked
this piece of text essentially as
trusted allowing it to be injected into
the page you also see whatever else we
put in there because of course this is
simply being bound to this element what
I should have done is not use this
sanitized but we should have actually
used the sanitized module which is a
part of part of the core of angular so
we can enable that here simply like that
so we load the module in our application
em v em run this again you see that we
get exactly the same result except for
the alert box we'd get no alert because
if you would inspect this code you would
see that there is no script look there
anymore why because ng sanitize is
actually taking this out and left the
harmless parts the ball tag with my name
in there everything else is is taken out
and the same works for attributes and
other context so this energy sanitized
module essentially takes care of that
for you this is very good to know so you
need to enable this by default and then
you can safely output HTML I'm using the
energy band HTML feature not to stack
overflow e of course so let me quickly
recap that for an angular 1 context so
in angular 1 if you output data and it
will be escaped automatically with SE so
essentially if you use simple data
binding you will never ever ever get
executable script code true there unless
there's a vulnerability in angular and
which is of course why you should always
match to the latest version if you want
to use untrusted data directly angular
simply says no and cleaner says bad
developer don't do it and it prevents
you from shooting yourself in the foot
essentially you can sanitize it using
the energy sanitize module that's the
default way of doing that
and if you really really really want to
use static HTML snippets and mark them
is safe then and only then can you use
the trust this HTML this is meant to be
used if you want to inject a dynamic
part in your template if you want simply
want to inject a link for example or
something like that into a template
you've written HTML code for the link
yourself then you can mark it as safe
otherwise you shouldn't be using this at
all very important for angular 2 and
four people already looking or using
angular 2 and it's even better by
default all data is sanitized you don't
need to do anything for that simply
building an angular 2 app already uses
sanitization so it will never see that
error again and you will not see the
problems that we had before allowing us
to do stupid things if you really want
to do stupid things you still can and
you can still mark HTML s safe but
they've renamed the function to bypass
security trust as HTML so if bypass
secure if you type bypass security and
don't get a bell like what am i doing
well maybe you deserve to be to be to be
compromised then so this is essentially
a stupid fix but they're very simple and
effective fix so people will see what
they're doing and maybe we'll get a
trigger to read a bit more about this
function actually does instead of
thinking that it simply sanitizes data
to be completely fair I've been using
this example for quite a while for about
two years now since about two months
somebody actually fixed the response and
stack overflow so it took two years I
don't have enough credits to do so I
don't have enough karma or whatever to
do so so I cannot fix it but somebody
else did and they actually am renamed
the sanitized to trust which is
hopefully a bit more clear so hopefully
you won't fall for this piece but there
are plenty of other examples out there
and the same holds for other frameworks
like Amber chess and things like that so
this is a big problem but simply because
people look to do a certain action like
including HTML and that fails and they
look for a solution brings me to a piece
of advice or a rule number one don't
mark untrusted data they simply don't do
it use the built-in features essentially
angular is
pretty damn awesome at protecting you
angular does a very good job at
protecting you so let it do this allow
it to do so and you should be fine and
it brings me to the second topic or the
same topic but in a different context
remember when I talked about the old
yahoo application in a new angular
application there's actually two very
extremes and there's actually a middle
road something in between and that's
when you have a traditional application
a big-ass PHP or DSP application that
you will not simply rewrite in a week or
two but you still want to start using
angular and that's when you people start
using these in a mixed environment so
essentially what you have is you have a
page which is processed on the server
and the server includes angular so you
can do some client-side stuff as well
very easy for building new ice for
example in this setting this means that
angular will still be able to protect
you against cross-site scripting
whenever you bind theta angular which is
good but it also means that since server
will still bind or put certain variables
into the HTML being sent to the client
that a server will also need to do
process scripting protections you need
to cover two bases and if you look at
that a bit closer you will start to
notice a problem and a problem is
actually angular in this case so let me
show you if you add a server side you
have a div you have angular enabled and
you put some data into the diff in this
case it's simply a string looks right
looks harmless right same thing here you
have an element where you have some
dynamic class attribute which is
generated by angular looks pretty
harmless however if I put it like this
and like this you might start a thing
that's not as harmless as you thought
before because if you put this in
angular this will trigger the alert
function which is problematic again
however from the server side us as a
perspective if you look at this at a
server side nothing has changed this
string
the constructor constructor string is
essentially the same as this for the
server this is simply static data he
doesn't know that this will eventually
lead to the script execution there's no
reason for the server to think that text
inside a div will be executed a script
it simply doesn't exist before angular
but it exists when you have angular
enabled and there's now I have to bring
you some a piece of bad news there's
actually not much you can do against
this angular tried angular try to
protect against these kind of things by
implementing a sandbox it's called the
expression sandbox and essentially they
try to prevent you from breaking out of
the angular environment and reaching
into the global javascript function so
you would not be able to access the
alert function this was implemented in
one or two after a german researcher
mile-high Drake and found some found
these problems and alerted the angular
team and they fixed it then the german
guy kept breaking their fix and they
fixed it again and he broke it again and
they fix it again and this went on for
about a year or a year too and then they
said yeah sorry this we simply cannot
get this get this fixed anymore there
will always be bypasses and the code
that we need to write or the goat for
this expression sandbox is so complex
that so hard to maintain that we're
simply going to take it out you can
bypass it anyway in every version
there's a bypass attack so let's don't
bother anymore and we take it out this
means that from one not six and there's
no protection left so this attack like I
showed you before will still be possible
and the only thing you actually can do
against this is simply don't use angular
in that way that's part of the bad news
I have to bring in angular 2 you have
something called offline template
compilation which allows you to deal
with these situations a bit better but
I'm not going to go into detail too much
there even in the security guy Tranmere
to they say don't do this simply use
angular the way angular is internet
abuse so if you want to do this give a
client-side application or include
angular in the response to the browser
and then fetch your data using an API
and include it directly into the angular
application and that's the only way you
actually
deal with this in an in a graceful way
without being vulnerable to these kinds
of attacks let's external advice and
number two okay and also bad news number
two cross-site scripting will happen
sometime it may take a bit longer if you
do everything right but eventually there
will be problems that really a bug in
angular for example allowing someone to
smuggle something true I seriously look
at these cross-site scripting attacks
that people come up with and they're
absolutely crazy so yes there will be a
vulnerability someday someday you will
get a junior developer which uses this
trust as HTML anyway and you maybe don't
catch it in time actually I've had I've
had this with customers that attended
the training and they actually got some
of their developers using this process
HTML exactly like I described and they
stopped it before it was too late
because they knew what it did otherwise
they wouldn't have got it so what if
this happens anyway um well you can be
sad about it of course but there's
actually something better you can do and
that's what I want to talk about if you
want to deploy a second layer of Defense
you can use content security policy in
content security policy essentially am
gives you control over what happens in
your client site context it's intended
as a second level of defense against
cross-site scripting it's been there for
about four years now it's very rarely
used because not many people know about
it that's one reason second reason is
that it looks absolutely scary but it's
not as scary as you might think when you
get a bit closer what does CSP do CSP
locks down what happens in the web page
so essentially they disable certain
dangerous features by default and they
require you to specify a whitelist from
where you want to load resources and if
you load anything else than what's in
the whitelist and CSP will simply block
it and it will not happen like I said
seems really scary but it's actually
pretty awesome once you know what it
does and how powerful it is so let me
show you
me disable this so first we're gonna
disable our sanitized model otherwise
nothing bad will happen in our
application and if we loaded we should
have our cross site scripting attack
vector back okay sorry I also need to
sanitize it of course sanitize yeah
there we go so this is let's say that
something like this happens you never
know who makes a mistake if a bad day so
let me show you how you can leverage CSP
to protect yourself I'm going to disable
a CSP policy don't need to worry about
the axial contents I will talk about
that in a bit and if we reload this page
you'll see that we still see our our
text but we also get an error in a
console and error here shows and now
like this says that the browser
essentially refused to execute inline
scripts because of CSP this is full
explanation don't need to worry about
the details here essentially what
happened is CSP was enabled CSP disables
script hidden inside HTML throughout the
page and essentially said no way I'm not
going to execute it because in this case
it was actually an attack which is
really really powerful so few details
about CSP before we dig into this policy
so CSP is what we call a server driven
browser and force policy that's a
mouthful for saying this is a policy you
configure on your server you send it to
the browser and the browser will
actually enforce it on the page that's
is currently being loaded CSP is a
resource policy so you can if you really
want specify the difference is people
see four different pages of course in an
angular application you have one page
and everything
happens with an angler so you have one
GSP policy yes Anthony you can specify
this as a header this is the default
choice if you really want you can also
use a meta tag which is what i did in
the demo and allows you to set the CSB
even if you don't control the web server
if you use a hosted a shared hosting
environment for example browser enforces
a policy and that's essentially it let
me show you this is a policy that I
enabled and let me show you in a bit
more detail how I got there and what
this essentially means i'm also going to
show you why people are scared of CSP so
if we go back here and I'll disable
bossy and let's start with a very simple
policy this csv policy essentially says
that by default so for all resource
types they can only come from myself so
from my own origin essentially which is
a same default to use if we use it like
that and reload the page you get
something like this and if you see this
on your production application of course
this is tory example if you are a
production application and it certainly
looks like this the first thing you do
is you disable the cs beating you run
and you never touch it again and if you
look at the reason that we have this you
see all of these errors we have seven
errors by now and it says that it
refused a load bootstrap and it refused
to load jquery and some other stuff and
essentially everything breaks in very
bad ways so allow me to unscary you of
CSP essentially the steps you need to
take is you need to go through all of
these resources that you include and you
need to whitelist them I told you about
this white list feature essentially
that's what you need to do to make CSP
work and in a traditional application
this is a lot of work because you have
all of this stuff hidden everywhere
throughout your application in an
angular application is actually pretty
straightforward depends of course how
many dependencies you have but typically
you include some scripts somewhere you
have this in your build process
somewhere anyway so you can easily
whitelist them what we do here is for
example we have the same default which
applies to anything for which I don't
set a specific directive and then you
include very specific things like square
so if I know the script it can come from
the jQuery CDN and from the bootstrap
CDN for example nowhere else if somebody
injects is P framework from an evil
server on the web CSP hope locket it's
not in a whitelist it will not work for
images and I use data URIs because I
didn't want to deal with file uploads so
essentially i write lists the data
scheme that's it no other images will be
able to include it in this page and the
same goes on for styles and phones and
objects and the whole the whole story
and that's essentially a very quick
overview of how you should build a CSP
policy and it seems like a bit of work
but essentially once you start doing
this step by step this is not that hard
and this actually brings you to a policy
like this if you want real life examples
Dropbox has deployed CSP they have
documented the whole process and their
policies a bit larger than mine but they
actually manage to do that and quite
efficiently same thing for github they
also deployed CSP successfully and they
also document their document their whole
journey of how they did this a quick
overview of CSP directive so you have
this default as RC applies to anything
that doesn't have anything more specific
and then you have all of these subsets
of resources valid values self we
already saw that that's your own origin
star which is not really recommended
maybe for images but definitely not for
scripts for example that renders the
whole thing kind of pointless also know
if you specify known then no thing we'll
ever be loaded for that directive so
where do you use this if you have object
SRC which is for flash flash and java
applets essentially if you don't use
them simply set it to none and no flash
file will ever be loaded on your web
page it is great because someone injects
those to exploit a vulnerability in them
it will not be loaded you can also have
host expressions and in various formats
so not too much detail about that here
very important this middle one the full
baths expression is actually the
recommended one if you use less strict
expressions for example whitelist the
whole CDN you open yourself up to a
whole
new class of ulnar ability says I've
recently been discovered so again I'm
not going to give you too much detail
about that but be aware that you need to
use full pots then like I said in an
angler application is actually fairly
straightforward and the same goes for
the other single page up gave frameworks
for example ember enabled a version of
CSP by default for some time but they
scared too many people it had sorted
disabled it again browser support for
what I talked about from CSPs is awesome
every burst sports it even a Microsoft
ones which is very great to be fair
there is a follow up version of CSP
level two and which makes an effort to
be more compatible with older
applications not non angular
applications so essentially what happens
there is they introduce new features
support there is a bit more limited and
there's even a third version which is
currently in development which is only
supported well some features are
supported by chrome a bit more on that
in a minute another super nice feature
of CSP is reporting so when such a
violation occurs you can imagine that
having the error in the console is
useful if you're developing but not very
useful if a user gets that on his
machine somewhere in ennis in its living
room at home that's why CSP allows you
to specify a reporting endpoint I mean
you have a reporting endpoints ESP will
the browser will essentially send you a
report of a violation and a report
contains all the information you need
well know all the known unknown private
private information that you need to
analyze this problem in your web
application for example this is a
violation report from my website where
the discuss component which is to leave
comments on blog post for example uses
eval so you see that for example blocked
you are i evil this is one of the
features that CSP constitutes dangerous
it's often used to look for exploits so
they say please don't use eval I'm going
to disable it by default discuss knows
about this problem they said it's not
the functionality is not not really
relevant so you can safely ignore it and
you don't need to re-enable the use of
evil so in this case
you get these reports when when you
visit my webpage and they're being sent
to reporting endpoint another awesome
feature about reporting a CSP has a CSP
has a report only mode meaning that you
can deploy a policy it will not block
anything from being loaded but will
simply send violation reports to your
endpoint why is it so useful let's say
you built your first CSP policy chances
are you are going to miss something
somewhere that happens so what you do
typically is you build your CSP policy
you deploy it in report only mode and
you monitor what happens and you see
reports coming in and you can
investigate is this something I missed
do I need to update a policy is it an
attack is something else going wrong
there how can I deal with it so once
you've run this in report only mode for
about a month or two or three or a year
if you really want to and you're pretty
confident that policies is good is
secure it doesn't break anything then
you can enable blocking mode and you get
the benefits of CSP at that point if
you're thinking about Rico reporting you
can get started with report your I
thought I oh this is a free service that
collects the CSP reports and gives you
some statistics on graphs if you want to
build it yourself it's actually
straightforward simply an endpoint that
accepts JSON data that's the easy part
the hard part is filtering through the
noise I can ensure you you get some
noise from that Dropbox did this in
themselves and they documented this and
they saw plenty of page modifications by
ISPs when the page was being loaded all
these kinds of things lots of
applications running on users machines
that also modify pages modify CSP
policies even so this can become a bit
tricky if you wanna know more know more
about that definitely come talk to me
after after presentation few pointers if
you want to get started CSP how do you
write a saints yes people see what you
need to keep in mind and for
completeness reasons of course it gives
you some extra knowledge first of all
deploy it with a header that's the
easiest way you can simply configure
your engine X or whatever you're running
to deliver this policy and that's all
you need to do you can also use the meta
tag and if a header is problematic avoid
the use of unsafe
in line and unsafe eval these two
directives re-enable these unsafe
behaviors because some libraries
required to do so we shouldn't be need
to do this for scripts sometimes style
gets in the way of CSP so you can enable
unsafe in line for CSS if absolutely
necessary but don't do this for scripts
like I said you need to specify things
up to the file level very important for
bypass ethics and also specify all
important directives to avoid someone
from injecting a second CSP policy in
your page using a meta tag and then
overriding certain behaviors that you
don't want to of course if you do all
this you need to know about this there's
a handy tool you can use for that this
is brand-new from google it's about a
month old I think oh no it's a lot older
they use it internally they release it
about a month ago and it allows you to
evaluate your CSP policy so this is a
policy I used in my demo application you
can simply copy paste it in there or
copy paste your eye and it will fetch
the policy itself you can get some
feedback on is my policy good or not
what do I need to improve and get
something like this and you see okay
default check image everything is fine
object that are see is red why I didn't
specify it which means that it could be
overridden by an attacker if he injects
a meta tag into my page so what you
should do there is simply specify object
as Arsene on and you should be fine then
a final remark is the script SRC in a
script SRC the evaluator suggests the
use of a new behavior it's a very brand
new feature that's available in chrome
since about a month or two and where you
don't need to specify a white list
anymore you simply need to mark specific
scripts as trusted and drone we'll take
it from there I don't have time to go
into detail on this here today but again
if you want to know more about this come
talk to me and I'll give you an
explanation and some useful pointers or
you can find more information very handy
tool to evaluate a CSP policy and brings
me to point number three I think it's
time to start levering leveraging the
power of CSP why first of all because of
what I've told you here second of all
because
if you're not compatible with GSP you
need to start becoming compatible
because ESP is the policy of the future
new security features are being added to
CSP every time over and over again so
whenever somebody things like okay this
is a very cool security feature can we
have that in a browser and they say yes
we wanted chances are they will
implement it as a CSP directive so it's
definitely a good time to start gaining
some experience with CSP and preparing
yourself for that in the future so we're
done right we've ticked all of these
boxes we have a secure web application
by now well it's not that simple so far
we only talked about cross-site
scripting the main reason I did that is
because this is talk about angular
security and not a general web security
talk where I can cover more topics also
the reason is this is some very specific
angular device advice and the other
things are applied to other applications
as well so for example the web has
evolved a lot there are plenty of new
security technologies you can use and
the landscape has changed so much in the
past few years for example today
everybody browses wirelessly which has
certain security implications today we
have browsers running peer-to-peer
connections with other browsers which
has certain security implications a few
guidelines and few fundamental things
you should need to take into account if
you build or want to build secure
applications in this case your angular
applications need to deploy these things
over HTTP that's a treaty PS apologies
and there's no doubt about it it doesn't
kill performance it doesn't cost you
anything anymore if you use let's
encrypt so definitely go for it it's a
default way of doing things use strong
authentication and allow users to your
strong authentication support
multi-factor mechanisms I have for
example i have this USB token for
two-factor authentication unfortunately
not many websites use it or any
supported which is I find that
problematic list I want to use it but
people stop me from being more secure of
course get your access control right
few talks about that's already in the
conference so I'm not gonna go into
detail on that and then finally protect
against common threats in session
management systems and that's where i
wanna spend the last part of my talk
session management is very very critical
session management is a part of your
application where you remember the
authentication state of a user and which
will you will which you will use later
on for authorization decisions a very
quick overview of two common systems
that we have today and the threads that
we see there are that you need to
protect against if you have a browser on
the left and a server on right what
typically happens is you visit the
webpage the server creates this session
for you you get a session identifier and
some state on the server and the session
identifier is stored in a cookie sent to
the browser in a cookie the page is
loaded and the cookies stored
vulnerability one you shouldn't use a
session identifier that's one two three
four use something long and random very
important and what happens then is that
the browser will include this cookie
automatically on every request through
the same domain that's essentially how
session management works the server
looks up my session updates my data and
sends me a response in return this is
old applications this is a session
management from 10 years ago this is not
very compatible with rest applications
so essentially we move to client-side
sessions and client-side sessions work
like this instead of storing an
identifier you simply store a session
object you can store it in a cookie if
you want to send that object to the
client page is loaded cookies stored and
the same behavior applies here so
browser attaches this cookie to outgoing
requests the server processes the cookie
gets the session information see Sam not
logged in checks my credentials and
updates estate and then sends that back
to the browser which updates the cookie
you can imagine in the second mechanism
all the data lives on the client side
regardless of which technology use to
actually encode a session object you can
use JWT token like a tour covered
yesterday you can use something else
plenty of libraries are to that for you
but you need to provide integrity you
need to check that what
get back here from the client is
actually what you gave it in the first
place and it hasn't been tempered with
these are basic threats obsession
management's I want to talk about
cross-site request forgery which is
essentially a mouthful in short it C
serve and see surf is an underestimated
threat because C surf is actually pretty
damn dangerous and not many people
really understand what happens behind
the sea surface neck so give me a chance
to allow you to understand that and see
if I succeed in it so in a sea server
tech we have and authenticate a session
with a certain website this is the
website that will be attacked by the way
so we have the same scenarios before we
get a cookie this browser stores this
cookie and we can use it to get a list
of messages for example in a sea surface
tech the attack is actually cross-site
request forgery so it's lounge from
another side this means that you visit
another site in your browser of course
you get some cat pictures from somewhere
as we all know get big websites would
get pictures are the most secure so
nothing will ever go wrong there but
let's say in this case something does go
wrong this page tries to load or make a
call to website will be to post a
message this is a call leaving the
browser to a domain where the browser
has a cookie for so the cookie will be
attached to that request this can be
triggered by a form submission for
example you can submit forms from
javascript easy can load an image plenty
of ways to do that am very good design
decision in the web and of course if
this server doesn't know that this can
happen he thinks it is legitimate call
from here with my credentials and you
will process that under my account and
this is essentially see surf and this is
the textbook example of see surf so let
me show you how see surf is exploited in
a real role so let me show you an actual
see surf attack that we saw a couple of
years ago see server tech was against
ebay what did they do let's say I have
an authenticated session with ebay and I
visit another web page our malicious
kittens web page what this does is this
makes a call to ebay to change some
account details and it
change the telephone number okay ebay
wasn't aware or didn't protect this
against Caesar they were actually aware
because other stuff was protected but
they forgot one place to do this of
course the browser touches my cookie and
the server happily changes the telephone
number this is a request being made from
a site loaded in my browser in my
credentials to ebay why is this a
problem because ebay had a forgot
password functionality where they called
you when you said i forgot my password
they said okay let's be realistic or we
will give you a call to the telephone
number you set in your account I will
verify that it's really you of course in
this case it's not really me so when
attacker can simply reset the password
ebay says fine we'll give you a call but
he changed telephone number so he gets
the secret code they give you with a
call and you can simply take over your
account and they actually this you can
read full article if you are interested
in that is actually a problem that
happens here in reality and resulted in
a lot of accounts being hijacked because
of this seesaw runner ability I'm coming
to the angular part so why is this a
problem our hardware protect against
this typically use forum tokens so how
does a forum talk at work when you log
in you get an HTML page back in that
HTML page the server hides a forum talk
at CC surf token and a/c surf token is
simply and randomly generated token that
a server will remember when he sees it
again so when you post a message for
example this hidden form field it's
simply a form field like this will be
included here and the server will see ok
this is a token I gave you before I know
that this is a legitimate request if
somebody else tries to do this they will
be able to make the request the cookie
will be there but there's no way for
them to get this token this is isolated
in browser these two contexts cannot
communicate with each other they cannot
inspect each other's data they cannot
get a token from me or so they will not
be a token there and a server will know
that this is a sea surface tech in
progress of course in an angular
application we don't have forms and we
don't have hit in form fields doesn't
work like that anymore which is why
there's something called transparency
surf tokens
and transparency sort of tokens work a
bit differently but they achieve the
same goal so essentially what happens is
when you get your session cookie
regardless whether it's a session ID or
session object doesn't matter what you
get is um you actually get a second
cookie which contains the sea surf token
when you make a submission the browser
will submit both cookies to the server
but the client-side code will also read
the blue cookie and transform that into
a token attached in the header so when a
request goes out it looks like this you
have a post request you have the cookies
which are attached by the browser and
you have this header which is done by
the client side code here so this is an
exact I request imagine this coming from
the HTTP service and angular this token
can be attached manually by the script
running in the context again this works
because these guys will they get the
cookies from the browser but there's no
way to get this cookie value and
actually read it from JavaScript and
attach it as a header there's simply no
way to do that in a browser that's one
of the default protection mechanisms
that we have there so again the server
knows what's going on in angular it
works exactly like this um and it works
like this by default so by default
angular protects you against these
against see surf but the real thing
about sea service this was a server-side
attack this one's not a client-side
attack and this means that your server
will need to enable this protection
mechanism and needs needs to check the
token and only then will you ever really
have protection so this is enabled by
default if you submit or if you send a
see surf token to the client if you
never enable this on your server if you
don't think about this don't know what
this means then you will not be able to
benefit from this mechanism in angularjs
which is again very important so this
brings me to the fourth fourth point I
want to make if you have a back-end you
should use C serve defenses and to
prevent these unintentional requests
there's one corner case I didn't discuss
in detail and that's if you use tokens
and you stop
in a specific header if you do that and
let me quickly show you how that works
if you use your tokens like that you are
automatically protected against eserve
because the root cause of c surf the
fact that the browser automatically
attaches cookies to requests it's no
longer there so what happens in this
token-based session management using a
header you get this token it's stored in
JavaScript somewhere and JavaScript
attaches these two out governor requests
this context this has no way to get that
token has no way to exit actually read
the token fabricated token and cannot
attach it to request avoiding you from
suffering from c server tix so see surf
happens because the automatic behavior
of browsers attaching cookies to
requests like i said okay this is what
such a header look like with a job token
for example and this brings me to the
point I made in beginning and a point I
made in meaning is that the key to
building secure applications is
knowledge and we saw a few items here
that will actually help you build more
secure angular applications that will
actually prevent you from doing
dangerous things and actually enable you
from or allow you to enable security
features so let's go over them one by
one again so you need to enable the sea
serve defense in your back-end and their
libraries to do that for you it's as
simple as submitting a cookie and
checking that with the header value you
receive upon my request very important
you should work towards levering CSP CSP
is very powerful will become more
powerful and more important in the
future so start doing that right now
don't combine templates with users
flight data we saw that there was a bad
idea and that will always remain a bad
idea so simply don't and do it the right
way and we do it the right way use the
features that angular gives you use the
protection mechanisms from angular to
build secure applications and to avoid
shooting yourself in the foot then the
final thing you need to do is you need
to share this information like I said
other people need to know about this and
you can start doing that right now
during
lunch share this with your colleagues
share this next week and when you visit
go back to work and make people aware of
these things and build better and secure
applications thanks for listening thanks
for staying till the end and not
grabbing early lunch if you want to know
more all information is on the website
if you want to invite me for a talk or
talk about training my contact
information is here as well the slides
will be put online are actually already
online so you can grab up from there and
share them with as many people as you
can find thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>