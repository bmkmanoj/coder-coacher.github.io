<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Offline first apps with WebComponents by AMahdy Abdelaziz | Coder Coacher - Coaching Coders</title><meta content="Offline first apps with WebComponents by AMahdy Abdelaziz - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Offline first apps with WebComponents by AMahdy Abdelaziz</b></h2><h5 class="post__date">2017-08-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qBuqcp8PTec" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I used to like to take a selfie with
also modules before starting so would
you mind to take a selfie with me okay
let's try to get as many people as
possible maybe this side yes
No all right yeah this work all right
Cheers
okay that's going on Twitter right now
under de Vaux pl hashtag all right so
offline first apps with web components
approximately ten years ago we show an
emerge in the aura hype in the so-called
cloud people were advocating about
clouds that we need to move our desktop
applications to the cloud
everyone who was developing an
executable application or an exe or a
desktop application was told that cloud
is going to take over and it's a good
time to migrate to a browser-based
application even though it was a hype
but it proved that it is effective and
nowadays it's no longer a question to
ask if we should develop for cloud or
not whenever we start a new application
by default we make it on the cloud
available on all browsers on all devices
tablets mobiles and everything but
that's from the old old time nowadays we
are talking about mobile taking over so
nowadays a lot of people are telling
that you should develop for mobile
devices you should consider mobile
service design and so on and if you are
really following what big companies like
Microsoft and Google are doing right now
you're going to figure out that
removal is taking over they are robots
who are taking over isn't it
so in the near future we're going to see
robots doing most of our jobs
communicating with us we have seen a
huge emerge in the AI system developed
by many companies especially Microsoft
and Google but at the end of the day
unless robots take over
we still need to configure those robots
and we need some kind of interface to be
able to communicate with them configure
them program them and so on so hello
everyone my name is Maddie I work as a
developer advocate and I'm not from
Texas I live in Finland which is a
really beautiful Nordic country I
welcome you all to visit and I will
provide an so how many of you heard
about value before interesting so for
the two of you who didn't raise their
hand
Rawdon is a UI framework for building
web application in java but nowadays
Vallon is taking a completely different
curve so what and for those who hear
about voting for used to be a framework
now we are expanding our platform
completely to incorporate new web
standards and new web technologies
outside the Java ecosystem outside the
browser ecosystem I'm not going to talk
today much about Wadden but I'm going to
today focus on my intro which is why
cloud was a hype and what's going to
happen now what about Mobile's so to
start I will tell you a small story that
happened with me two months ago I
visited this little interesting country
called America and when I arrived at the
airport it was in Austin it was very
lovely
but as an EU citizen I didn't have any
US cash with me and I wanted to go to my
hotel but without going to currency
exchange or without having to hold any
money in my hand
and I thought that we are in a very
advanced era now and I should be able to
do everything with my mobile device
there definitely should be a way to go
to my hotel room using public
transportation without having to
exchange money and get cash and those
kind of things
I googled and I found that yes that's
true there is a nice app called capmetro
not advertising about it or anything
it's a government app or something and
that started at 5:23 p.m. not the time I
decided that okay no problem
the next bus is leaving in 7 minutes and
in 7 minutes I should definitely be able
to buy a bus ticket I mean think about 7
minutes 7 minutes I is not a small
number 7 minutes you can do plenty of
things you can do fold laundry scan a
magazine you do you can do a lot of
things in 7 minutes so definitely I
should be able to buy a bus ticket in 7
minutes
the thing is the thing is buses are
coming every half an hour and the next
bus is coming at 5:30 so that makes
sense I started by downloading my app I
noticed that the app is 18 megabyte I
was on an airport Wi-Fi so it was a bit
slow but still I said ok 80 megabytes to
buy a bus ticket doesn't make much sense
but still I will just try to go with it
I waited till the app got downloaded
that's a true story by the way and then
after that when I opened the app after
asking me for permissions and that he's
going to read my secret pictures and
everything it asked me to sign up based
on my experience signing up on a mobile
device is not really easy writing my
first name last name address email
confirm password password first time and
so on
Laser app developers provided me with an
alternative way of signing up which is
Facebook or Google+ so I decided to sign
up with Facebook that's going to be a
little bit easier isn't it
no because I didn't have facebook up and
stool I'm these kind of guys that don't
have facebook app sold on his device and
that means that I need to fill my
Facebook data manually and to my
surprise I didn't remember my password
for Facebook because usually it's
automatically filled on my browser but
here I have a native app so I don't know
the password after struggling with this
a little bit and finally figure out the
password it asking me for two-way
authentication to confirm my password I
had to wait for a sentence and come yeah
it happened and after that I finally
managed to sign up everything went great
everything was perfect till I came at
the point of purchase because it asked
me again for my credit card information
I started to type my 16 digit credit
card information expiration date my
shipping address all those kind of
things it didn't took a lot of math a
lot of time because after seven minutes
I looked at the clock and I found that
it's 601 p.m. yes which means that I
didn't only miss the first bus
I missed also the second bus the second
bus was at 6 p.m. and I missed two buses
and that means that to be able to move
from the airport with the next bus I
need to take the bus at 6:30
I didn't only West almost 38 minutes I
was stood one hour and seven minutes
just waiting for the bus noting that the
bus system in Austin is bad or anything
actually that's a advanced system that
they have order they have an app for
managing the bus system they have very
advanced bus connections and so on
I'm just saying that this app is not for
me not for a casual visitor to the city
this app is designed for local people
living there that are going to sign up
once and then live with it for their
their entire life or years but for a
casual visitor that just need to come
there take a bus ticket and then leave
after a few days from the right choice
the 30-story didn't finish yet so later
on I went to the hotel and up and
check-out check-in I need they told me
hey if you download our app you will be
able to open your hotel room with your
mobile device you don't need to have a
key anymore and you will be able to
collect perks and rewards you will be
able to also get your receipt and
check-in information and some
notification all those kind of things I
told them I'm actually in need of some
sleep and choosing between all those
perks that you just told me and just
sleeping before one hour more one of one
one more hour of wasted time I would go
for sleeping so I'm not really a tech
guy I'm not a technology guy anymore
and I would love to have these
old-school keys that just open the door
whenever I want I don't want to install
any apps anymore yeah that was exactly
my experience when I reach the hustle
so I transform myself I'm no longer a
technology guy and actually this applies
in many other apps that we are seeing
around us so for example I'm here not
from Krakov and when I visited if I want
to for example
order pizza and then the website tells
me to order pizza you need to download
our app to be able to order and then I
will go over these steps again sign up
it's got information and so on that's
not really practical same applies to
many many applications I'm not saying
that native apps are going anywhere but
native apps sometimes don't make sense
sometimes you need to progressively
understand your user before moving the
user to a native app this is an old
screenshot taken from link attend
website when you open the website from
browser and it tells you download the
app whenever you open link at the end
calm it tells you download the app and
from user experience perspective this is
fail because it's taking one quarter of
my screen size just to tell me about
something that most probably I don't
want to do I'm also not this kind of
guys that have a native language an app
on my mobile device because of basic
reasons I don't use LinkedIn that much
probably I check again in once or twice
per month you think about it how many
times you use linker then do you really
need a native app installed on your
device keeping asking you for updates
keeping memory and size maybe sending
you unneeded notifications all those
kind of things some of you will agree
with me that we don't need a native link
at an app I just need to casually visit
Lincoln M on a browser whenever needed
and this applies to many much more apps
there are many many many statistics
statistics related to this so some
statistics are related to for example
how many apps are we using on daily
basis so it says that out of your 200 or
300 native apps that you have on your
mobile device 80 percent of your time
you are using only three apps think
about it you will find only three app
that you are they are dominating your
usage of the mobile only and also think
about it let me ask you this direct
question if you think about one last
months ago how many apps did you in
stool okay so a raise your hand if it's
five okay lots of them raise your hand
if it's three okay
let your hand if it's one yeah most
probably one raise your hand if you
didn't install any app last month okay
okay like mostly 40%
that's that's the point statistics shows
that unless it's a new mobile phone that
you just bought and you are installing
all the apps in the world then your
install rate per month is zero you don't
need new native apps you have three apps
occupying 80% of your usage of that
mobile and you don't really need native
apps again I'm not saying that native
apps are going anywhere I'm saying that
sometimes they don't need make sense and
the alternative thing is called progress
of web apps so progressive web apps is
the new hype how many of you hear about
progress web apps ok good so progressive
web apps is the new hype it's it's not
made up by a small company or something
it's accumulation of research done by
big players in the market and big
vendors including Microsoft Google
Facebook Twitter and so on Apple is not
yet Apple I still didn't decide yet what
they want to do about it but in brief I
would say this is the new move from
native apps to the cloud but for mobile
devices it's a progressive of apps means
building mobile web applications that
are fast engaging the youth service
worker notifications they use native
capabilities of the device but today I
selected out of the many topics that are
available for practical app the offline
first design because it's the only way
to guarantee 100% always-on user
experience when you open a web
application such as Twitter for example
and you start to use it and then you
lose signal you don't want to lose your
user you don't you want your application
to keep working and keep interacting
with your user right and then if you get
back to communication like if you get
the signal again then you want to make
sure
that you can your user can continue
using what he started so if he wrote a
tweet for example if he saved
modifications if he did something then
you want those modifications to keep
going on so yeah as I was saying
progressive web apps is is not a new
framework it's not a new programming
language or anything if you are a web
developer then most probably you are
using some of web progressive Web Apps
capabilities already but it's it's like
a big topic that consists of many things
but what I'm going to focus on today
that or my motivation for today is the
offline first design now if we take one
step back and think about technology in
general so all the time has been
mentioning mobile devices mobile devices
it seems that people are using mobile
devices more and more and we have many
statistics showing that people who are
using mobile devices exceeded those are
using laptops number of websites visited
by mobile devices is way more now than
laptops and this makes me wonder because
as a developer or a Content producer in
my office 8 hours per day I need to use
a laptop
I cannot develop on a mobile device so
how come the number of users moving to
mobile device increased that doesn't
make much sense for me I need screen big
screen I am using heavy applications
I need heavy processor for them like you
are using an IDE or maybe photo editing
tools or movie editing and so on and
moreover you have high speed broadband
in your office
so what's going on why people are using
more mobile devices actually the answer
to this is we are content producers and
content producer here I don't mean a
person who is
writing a blog post or writing a content
but I mean a person who is producing web
applications mobile applications or any
kind of content even if it's a video
even if it's slides and so on so a
Content producer is a person who need
this kind of device for his daily
productivity but we the content
producers are very small tiny bit of the
whole population of people out there
that are using Internet and if you want
to target another content producer like
us we are we are the framework people we
are targeting developers so our audience
is very very small but if you want to
target more users that open world or
billions at Google says then you need to
think differently because users
generally don't really care about
technology they are not like us there
are different species right they don't
care about having the latest processor
they don't care about having the latest
updates they don't care to have
broadband internet connected all the
time they want something that just work
something intuitive something that
appealing that well that is well
designed and just work so to put
everything all together I am going to
show you today demo on how to develop a
client first application but to do that
since all the time I'm talking about
latest web standards and latest
technology I decided to do this demo
using web components so first of all who
hears about web components before
interesting so web components is the new
standard it's not a hype anymore maybe
one year I go it was a hype but nowadays
it started to be a standard and it
consists of four major topics so it
consists of templates shadow Dom HTML
imports and custom elements just in
brief for those who didn't hear about
the components before it's a way of
redefining the way we are construct
our HTML in such a way that we can
include some of the object-oriented
capabilities inside your browser like
entire bility like inheritance like
other things in OPP so how it works
basically you define your own custom tag
so in HTML we used to have this tag
called give input span and so on those
are the standard tags but we etched it
with web components you can define your
own tag and start to use it and this tag
is going to produce you some kind of
template I'm not going to go over web
components in much detail except that
I'd love to show you one example like
VAT and date picker so this is one of
web components that we have developed
it's available freely open source and
when you put this HTML tag inside your
HTML page what you will get is this
thing on the left side previously what
you will get is this blue bar on the top
and this icon and when you click on this
icon the date field will drop and you
can start to select date so having a
fully-fledged
date component is now possible with one
line of HTML and this is because of web
components as I said it's now standard
it's now available in all browsers more
or less Safari is now copying up with
this but we believe that the next
version of Safari at least the beta
version now supports a lot of things of
web components so we are seeing this
even possible on iPhone devices and
talking about those with components we
have also developed many of other web
components they are all freely available
open source and this is what I was
trying to explain so we are now moving
from Java ecosystem to web ecosystem and
make it making it reachable for more
developers so not only Java developers
but even if you are developing with
angular
react any framework GS or even dotnet or
any other programming language you can
basically use this and this is not
because of a magic that we are doing
this is because the magic of web
components so web component is now an
open standard that allows you to use
this web component just like any HTML
tag that you used to use so that makes
me wonder how many of you are using
angular by the way yes angular 3 none
angular 3 ok yeah so how many of you are
Java developers as well ok yeah so
that's clearly the majority here are
java developers luckily i'm going to
show you probably use a java part but
let's see how how well the demo will go
today
but yeah so to put everything together i
talked about web components i talked
about offline first and now we need to
use I forgot to mention one more thing
why would components why web components
in an offline first design topic and the
main reason is because of web components
are going to help me achieve this a
little bit easier so they are supporting
the advanced caching mechanism they are
supporting the advanced web technologies
that we can use in offline first design
and this is what I'm going to show you
in the demo so offline first web
components what is the solution that we
can do to make our application work
offline
the first solution that can come to most
of you is caching caching as in browser
caching so can we just cache the website
and that's it whenever you open a web
page just cash it in the browser cache
and problem solve isn't it actually even
in web components in polymer elements
there is a platinum elements now called
well the Platinum elements in general
they allow you to cache the web page and
cash the
components easily without doing much of
work and many of web components based on
polymer library are already cacheable by
default without doing any extra code so
problem solved would anyone see a
problem with caching no problem sorry
invalidation yes what will happen if the
cache disappear the browser control the
cash anymore problem with caching sorry
being up to date I think I think you can
get over this you can forcefully update
the cache define the new cache path and
so on so there is a workaround for this
actually there is another problem with
caching which is probably caching is
suitable for static web page if you have
a static website just five pages you
catch them in the browser problem solved
but what if your web page is dynamic I
believe most of you are developing
dynamic web pages and for example I open
a forum and when I click on a list item
then the forum gets populated with some
values so how can I do that with just
caching this is an offline mechanism and
offline code that need to be executed
some offline interactivity that need to
be done so caching is not suitable for
enterprise level and most of dynamic web
application that's why we came up with
the so-called offline storage offline
storage is or maybe you can call it
index dB
yes index DB is still I think and it's
it makes a lot of sense now because now
there is a lot of API is supported and a
lot of platforms are supported so having
an index DB isn't it like a good
solution instead of just cashing your
website forcefully save your data in a
form of a database or something like
that inside your browser and the browser
will do the rest of the work will keep
the data will persist the data and then
you can retrieve
later even though this is an ideal
solution and it has been used for many
years now it has a big drawback anyone
know what is the drawback of offline
storage yes
synchronization why sorry I can't hear
that it's difficult well kind of
difficult actually the biggest problem
is data replication as you said
synchronization so what if I modified
the data how can i push it back to the
server it's very easy to take a copy of
the data available on the server and
download it inside the browser and then
make it available offline that's very
easy but that so-called read-only mode
what if I modified the data how can i
push it back to the server that's going
to be tricky and as he said it's
difficult as well so data replication is
the next topic and that has been
discussed and that has been like the
research topic for many many vendors and
there are a lot of solutions and one of
the famous solution is firebase so
firebase used to be an independent
company that was solely focusing on this
topic data replication but now it has
been acquired by Google and now when I
say firebase probably it means many much
more things like the firebase platform
and the cloud platform and so on but
let's just focus on the firebase data
replication topic or libraries that are
responsible out basically solving this
problem so what's firebase offers it
tells you if you buy server from us and
by subscription or like perpetual
license and implement on the backend
firebase database then on the front end
you're going to get this offline storage
and data replication out of the box this
sound like a very nice solution and it
has been
by many enterprises but it also still
have some drawbacks so the biggest
drawback is the restriction you have to
implement a firebase back-end what if
you are using an Oracle database what if
you have to use an Oracle database or my
sequel or mariadb or pasta Gers or
something like that and the second
drawback is the limitation of the server
so you have to use a Google server what
if you for some reason don't trust
Google server
some people don't so firebase sometimes
doesn't satisfy people of course also
because of the cost so some startups
don't like the cost of firebase but I
will not discuss the cost at this point
I'm just going to discuss a little bit
more interesting topic which is the
freedom of firebase is it open source
it's not luckily there are many other
alternative open source libraries and
one of them the most the ones that I
most love which is power DB it's an open
source Apache 2.0 available solution for
doing exactly the same thing and even
more so again what is the biggest
problem about pushing the data back from
from browser to the server if you have
one specific database let's let's call
it for a firebase for example then you
know the protocol of how to insert the
data inside the database you know you
have a unified platform and data
replication is easy but in the case of
powers dB it's a little bit tricky
because dealing with Oracle is different
than dealing with my sequel is different
than dealing with posture grace is
different than dealing with my DB and so
on you have a big wide range of
databases and dealing with all of them
generally depending on your application
is quite challenging that's why we came
up with a middle solution called CouchDB
so going to be of course existed before
pouch DB and couch DB is just a document
DB layer that you can implement on top
of your database and then they said that
we are going to deal with towers to be a
our DB is for
open-source as well so you all to have
to do is implement couchdb layer on top
of your database and then pouch DB will
do the rest of the magic for you this
chart shows how it works so basically we
see that our mobile device does not deal
with the server at all
there is no single connection between
the server and the mobile device you're
going to implement the pouch DB library
in the middle between the mobile device
and couchdb and then couchdb is your
layer in front of the server so now you
can make bi-directionally data
replication between the mobile device
and power to be what will happen if the
connection is lost the connection is
lost means that pouch DB is no longer
connected with CouchDB what will happen
will be like that your still mobile
device is dealing with pouch DB not
couch DB so things will still work your
application will still be working fully
even though you are offline and then
when you go back online then we can go
back to this state again and any
modifications that you have done offline
will be pushed back to the server so
this is the whole thing about Taj DB and
in my demo I'm going to use parsley B
because we're going to see that it has
some magic and this magic is going to
make a lot or take away a lot of hassle
of managing offline storage manually and
synchronization manually as well sounds
good let's start so in my demo you need
to switch screen I think
those are the valiant elements by the
way if you want to check them there are
many more other elements now available
but yeah let's so in my demo today
instead of coding live because it's
going to be boring I know I'm going to
show you the steps that I've done on a
git diff basis and see you and show you
what the difference is I have
implemented between every step so
instead of coding I'm going to just show
you the code difference between H step
and of course the application is
available open source over here should
increase the font a bit so this is
application it's my handle underscore
back slash offline - first - app if you
want to check it out and if you want to
monitor future updates of this app and
see what I'm going to do next with it
probably you would like to also watch
this application this is how the final
application should look like and those
are the steps so as I said they are
divided into ten clear steps you can go
over them and check them out and I have
them here opened already and this is
also something that I want to show you
this is the couchdb so I have a local
installation of CouchDB I'm like making
a demo of having a local CouchDB
installed local server install and
CouchDB protocol on top of it so this is
my CouchDB that is running locally so
step number one since I decided to use
web components I decided to also use
polymer CLI command line interface and
this port polymer CLI is allowing me to
initiate web component based application
quite quickly it's very nice and
interesting so nothing here interesting
in this code except that I used the
polymer CLI and said in it and within it
I start
an empty application that's it nothing
interesting at this point it created all
the needed files and structure folders
for my application and this is how it
looks like
hello offline first up that's a
beginning nothing fancy at this point
now the second step is I decided in this
demo to show you how to migrate an
existing application from being non
offline to be offline first so if you
are starting over from the beginning
then that's the ideal time start
thinking of line first design from the
beginning but if you already have an
application which is most of the cases
then this demo is going to a little bit
help you on showing you what are the
steps and what you need to do to migrate
from an application that is relying on
the server all the time to an
application that works with supposed to
be so to do that I started by a demo
application that has a grid that load
data literally at this point I used a
voting grid because it's easy for me to
develop nothing fancy except that I
added this voting grid so you can see
that I used with components again rather
than - grid I give it an ID called lazy
grid and then here I define the column -
for the grid I define that the first
column should be automatically rendered
by the index so 0 1 2 3 and so on and
then I have a good JSON function here
this is the function responsible about
communicating with the server to get the
data so at this point are not
implementing in your flying first or
anything yeah Jason makes an exact
request to request the data and push it
inside the grid and then this is the
grid items this is the lazy loading part
that is whenever I scroll is going to
lazily load more items from the server
so kind of infinite loading of data and
just some tiles and CSS and so on so
nothing except this and this is how it
looks like so this is a grid
whenever I scroll and to prove that this
grid is actually working the Pentagon de
on the internet I'm going to turn off my
Wi-Fi and if I reload this page you're
going to see the problem so now it's
stuck in an affine ice loading state why
because I lost connectivity and it
doesn't work anymore and this is the
problem that I want to solve now so I
want to make this application still work
even if I don't have Wi-Fi just to keep
track of what I did I will close those
ok so this doesn't work so the next step
that I decided to do is to implement
couchdb protocol and instead of getting
the data from the server I want to get
it from my pouch DB so to do that I
define an object of Pi pouch DB and this
object can you see the font or do I need
to increase the font of it is it good
on the backside okay so the power should
be here when I define the pouch DB
object I added a protocol and when you
add a protocol pouch DB will
automatically understand that this is an
existing server and it's going to try to
connect to our CouchDB server so I
didn't specify any extra parameters or
anything everything will happen
automatically and I called this variable
the remote VB so this is a pointer to my
remote database and then instead of
loading the data this way great dot
items instead of j-jason
I got rid of get JSON function and I
replaced it with an instance of remote
database so now my data is coming from
many more DB so what happens now my
server is connected with CouchDB and my
couchdb is connected with powers DB and
now I'm going to connect with power
to be exactly the graphs that I shot
just showed to you in my slides now I'm
going to fetch the data all the time
from powers TV now let's see the results
so if I reload this page still works so
that was easy
I implemented offline first in just one
step instead of loading the data from
the server replace all instances from
referring to the server to an instance
of a remote DB but that's not everything
isn't it so now I just did the first
step which is relying on an offline
storage and that's a read-only mode
probably we need to do more I want to
make sure that I will load the data from
local storage even if I lose
connectivity at all so the previous step
I had CouchDB up and running here and
that's why the data was loading but what
if I lost the connectivity to couchdb so
CouchDB is my server right now so right
so what I if I lost connectivity to
CouchDB for doing these steps
let's go lit oh I don't have internet so
I cannot go up but what I did here is I
defined another variable called local DB
and here local DB is an object of pouch
DB that points to a variable name that
doesn't have any protocol called local
underscore positive it can be anything
and here another magic of pouch DB it
will automatically understand that I
need to create a local storage of my
database so up there I cannot show it
here because it's cut but up there that
was the previous variable it's called
remote DB that was pointing to a
protocol localhost port and so on and
this one is a bit different it's local
to be variable and here I decided to
tell power DB replicate make a replica
creation between remote database and
local database look at the debate exist
inside my browser remote database is a
couch DB database and replaced all
remote DB instances with local DB
instances so now I'm making sure that
the application is all the time pointing
to the database inside my browser not
the couch DB database at all and this is
exactly what I'm going to show here so
even though if I remove or reload now
you will not see much differences but
the big difference is if I turn off
couch DB then this application should
still work so I'm going to kill couch DB
just to make sure now it doesn't work
anymore and now if I reload I reload
this still work why because the database
is stored locally we can see this in the
inspector so if I open this inspector
and go to application you can see that I
have local storage and I have the index
DB here showing my item and the object
stores inside my item and so on
so now I have the database inside the
browser as you can see even though I
don't have the server running at all I
don't have internet running at all the
applications that work but as I said
that's cell read-only
we need to move forward and make more
interaction with the applications of
course to be honest with you this is not
going to be that easy going over all
your instances communicating with the
backend to replace them with remove DB
and then remove DB to local DB and so on
because probably your application is way
bigger than mine but I'm just trying to
make a demo a proof of concept and then
probably you can iterate over this by
time
you mean even couchdb is is down like an
error or something that's still for
pouch to be light no connectivity so
pouch to be doesn't check if you have
internet or not pouch DB check if
CouchDB is available or not okay so the
next step is I decided to add an editor
to show you what will happen if I start
to modify the detail so at this point
this editor again doesn't show much
except that I decided to add valence
plate layouts to split the the page into
two pages and then I added some editor
with some first name last name email
data like that and it looks like this so
whenever I select an item it gets loaded
here first name last name email and
update button if I scroll down Danielle
and so on nothing fancy at this point
except that whenever I select item it
gets populated inside the editor and
this is the splitter that can split the
page the second step is I want whenever
I click on update to persist the
modification locally so to do that I
defined inside the update button
whenever you click on update it goes to
local DB and call API called put and put
takes the variable selected and then
store it inside my local database we can
see that now so I will reload this page
for example let's select Logan modify
his first name let's call it de Vaux and
lastname Poland and then update got
modified and it got persisted inside my
browser so that's the second step I
modified the data inside the browser and
whenever I load the page it's going to
be persisted isn't it
No yeah here we go so this guy now his
first name is des Voges and last name
Poland lovely name so now the data is
inside the browser but I am missing one
thing how to push this data back to the
server that's still easy with pouch DB
so synchronize local storage with remote
database is done with a very simple API
again magic word called sync you give it
instead of replicate you call sync and
that's everything you don't need to
worry about anything else so our friend
here said that it's going to be
complicated yes I agree luckily this
library take away all this complete
complexity and take away is the
redundant implementation of such code by
just telling you hey just cool think and
we're going to do the rest of the work
and as we agreed it's going to be
CouchDB on the other side that's why
synchronization is unified you don't
need to worry about many implementations
and later on from CouchDB to you're
implemented implemented server whatever
what database you are using is going to
be you have a question over there yeah
I'm going gonna mention this in one
minute
good question here I added some
parameters like live and keep retrying
but those parameters you can check them
out inside the documentation again this
demo doesn't have anything different at
this point of course you see that the
data is not persisted here because I
didn't save to the couchdb but let's
reopen CouchDB now and then
change his first name again
and then check so he was item number
nine four five six seven eight nine I
think he this one yeah you can see that
his first name is de Vaux and last name
rocks so it get it got replicated back
to the server sounds good now now I have
performed probably everything that I
told you about like making sure that the
data is pushed back to the server as
promised but I also wanted to show you
one extra thing which is also how to use
plugins so probably you don't just want
to get the data read the data and push
back the data you also want to query the
data and perform the operation with a
kind of this kind of project with the
natural of open-source you get to see a
lot of plugins developed by the
community and one of the biggest plugin
developed by community is the find
plugin that allows you to query the data
like select all and so on so start I
added a search box at this point not
nothing fancy again except just a search
box that looks like this a little bit
hidden down there I need to fix this I
know so this is the search box that when
I search here it should show me items
and finally here I added the search
functionality itself so I added the
pouch DB find plugin and I indexed my
local database using the field first
name so now I can search using first
name and this is very very basic way of
searching I'm not checking of case
sensitivity
I'm not indexing other fields and so on
I'm just making the most very basic
search functionality and finally
performing the query itself so this is
how I am making search calling local DB
dot fine so dot fine
is going to query and then I specified
that the query is on
name and in the response I'm populating
my page in our HTML just for the sake of
demo making it very simple so let's
reload this page we see that this guy
has his first name modified let's change
couple other people so Madison de Vaux
and then maybe Mila let's call her de
Vaux as well and then if I search for de
Vaux we're going to see that those are
the results query I know this demo part
is not very very interesting looking
nice but at least this is how the search
query works so yeah if we go over the
whole application I started with a
simple application that loads and relies
on the server then migrated this to rely
on pouch DB instead instead of the
server and then so ok since I'm using
pouch DB then it makes sense to have my
data stored locally so I used local DB
instead of remote DB then I made
synchronization to make sure that the
data is replicated from local storage to
the server if you are interested as I
said this application is available open
source here this is how I have developed
it and all the steps that I have
mentioned are available here I have also
this application called Java PWA since
most of you are Java developers this is
my second effort of trying to integrate
this all inside Java so trying to make
this all work within Java
at this point I'm just implementing the
basic projects Web Apps features so this
is an application how it looked before
implementing many of progressive web
apps tools and this is after being
implicated the biggest the biggest
difference that you can see is for
example the theme I have modified the
theme of the mobile and you can see that
I'm not using the browser the browser
bar or the chrome of the browser anymore
and those are some extra steps so now
the application is also available on the
home screen you can click on it and you
see
/ screen and it works independently than
the browser so this is a browser running
in a different process than my
application my application is complete
independent native-like application this
is again not complete it has many steps
you can check them out on my github and
if you are interested you can follow
this project as well to see how I'm
going to integrate offline first
functionalities inside Java to be able
to do everything from Java perspective
now just to go back to my presentation
and summarize what I have showed showed
you so far
probably it's also worth mentioning some
challenges before we leave so during my
demo I actually kind of cheated a bit
because I kind of downloaded the whole
data inside the browser and that's
something that you probably don't want
to do so if in your enterprise
application maybe your data is 500
megabytes or 1 Giga or maybe more and
you don't really want your user to wait
till 1 gigabyte or one terabyte of data
being downloaded inside his device
assuming that his device has one
terabyte of free space available so
initial load of B that need to be very
well architected and one more thing you
don't want to download all your database
your database is so complex it contains
a lot of private things it contains a
lot of different things and it probably
not very interesting for the user so
this is probably the top issue on how to
architect an offline first application
you need to really define what is the
user session from the database
prospective what is the snapshot of the
data that should be downloaded and what
should not so this is the first thing in
my application luckily I had flat data
just one table with some I think 400
records only so downloading 400
didn't take that much time and it was
not occupying my memory but when you
have a bigger number of Records millions
for example you don't really want to
download million record inside the
browser database second thing is the
security so in the middle of the demo I
showed you that I can read the database
from the browser inspector and that's
probably anyone who is going to use my
computer and here I want to
differentiate between two things if I
have Facebook opened inside my computer
and someone came and started to use my
computer at the same time then he would
be able to use my Facebook that's fine I
allowed him but if I signed out from
Facebook I don't want him to come and be
able to use my Facebook isn't it
so you want also to make sure to either
encrypt or wipe the data whenever the
user is not logged in luckily there are
some plugins that allows you to
authenticate and encrypt the data and
authenticate based on which user and
which session the data stored inside the
browser so you don't need to really wipe
the data every time you log out but you
just need to make sure that it's not
possible to read the data if another
user user is using the same website
browser guarantees that this data is not
going to be able to it's not going to be
disponible for other domains
so if facebook.com store then
twitter.com can not read this data
that's security of a browser that's
something that you don't need to worry
about but what you need to worry about
is if I open facebook.com/ and Facebook
download the data on my browser and then
I sign out and then somebody else come
on my computer and open facebook.com I
don't want them to be able to read the
data that I had saved previously that's
you responsibility not the browser
responsibility and finally one of the
most obvious problem is the race
condition as our friend order I
mentioned what will happen with data
replication
so just to explain that is the problem a
little bit more let's assume that I
started to use my offline first app and
started to make some modification and
stuff like that and he also started to
use exactly the same app and both of us
opened the same person at the same time
but what happened with me is that I went
offline
I lost connectivity but he is still
online and we are still modifying the
same form and then he clicked save and I
click Save when I'm offline he is online
so his modification went to the server
but when I came back and become online
my data is also tries to be pushed back
to the server that's a conflict how to
solve this poverty be promises that is
going to make something called the best
guess the best guess on how to merge the
data if there won't be conflict for
example he modified the first name and I
modified the last name that won't be a
conflict maybe there is a possibility to
merge otherwise let's take this one more
time this example one more time
we both are online and we both open the
same form and we both are modifying the
same form and both of us are still
online he clicked save and I clicked
save which of our data is going to be
saved that's still a problem even if you
are online the only difference between
offline first design and this kind of
thing is that in offline first the
possibility of occurrence is higher you
might get this problem a little bit more
than normal and that's why you probably
need to architect and take care of this
problem more often than with online
application but let's give back to the
online application that worked online
only you probably have a solution for
this that is condition what will happen
you probably will show a pop-up screen
that this data cannot be saved anymore
because somebody else modified the data
or you going to probably have a fallback
screen or something like that
so you need to implement something like
this as well
when I go back online and my data is on
the queue offline and try to go back to
the server then check if it's possible
to murder or not if it's not possible to
merge returned back to the user and tell
him that it's no longer possible to
modify this data here is your previous
modification and this is the new data
take a decision on how to merge or any
other kind of user experience that you
can figure out inside your application
you need to figure this out as well so
it's again your responsibility but what
I'm trying to explain here is that it's
not something new it's something that we
have seen in many other applications as
well so yeah a question good question
so again because of the nature of this
open source application a lot of
community contribution has happened and
I have seen personally a plugin that
allows you to connect pouch DB directly
to my sequel and you can imagine why my
sequel because it's the most popular
database out there I don't talk about
other databases but I believe that there
are plenty of ways of getting rid of
CouchDB layer but that's not the
official supported one yeah sure so yeah
to summarize everything I have one more
extra edition for you which is a
practical test so at the end of the day
how to make sure that your application
is really designed for offline first and
designed for mobile first the second the
first the first test is to make sure
that all the time you are doing mobile
first design mobile first design means
that you are not testing on your laptop
please stop doing that test on your
mobile so usually what we are doing is
when whenever we are developing a web
application we have our browser open
here and we test on our browser please
stop doing that test on your mobile and
forget that you have a browser that's
the best way to achieve best experience
on mobile devices again we said that we
want to target biggest number of users
second thing is also think about touch
first design touch first design means
that your user when he's using his
mobile device doesn't have a cursor
doesn't have a mouse so he cannot just
go to the up corner and click on this
small tiny link that you have he's using
his amp so you need to provide big
buttons that are clickable from distance
without going to corner and edges and
finally a some design that I came up
with called
of coffee first design so basically you
give your sister cup of coffee this is a
yellow coffee a cup of coffee and a
mobile device and see if your tester
will be able to utilize everything
inside the application without dropping
the coffee on the mobile so he doesn't
need to use his other hand at all all
the time everything is accessible with
one bump just one bump to use everything
inside the application no need to use
the other hand at all need to squeeze
and zoom and hold the other end as well
another way of testing this is mobile
probably a little bit dangerous ask your
sister to go on a speed drive and test
so it will be able to manage or you will
need to squeeze but yeah that's
unofficial test don't do that please
yeah that was everything I think I am
running a little bit out of time but if
you have any question I'll be here
around please come talk to me ask me any
question I have the demo app available
inside this link I have the Java with
progressive web app available on the
second link and of course my github
you're going to find all the updates
that I'm doing on those projects thank
you so much for listening and enjoy the
rest of the day
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>