<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Serverless Kotlin with App Engine by Ludovic Champenois and  Éamonn McManus | Coder Coacher - Coaching Coders</title><meta content="Serverless Kotlin with App Engine by Ludovic Champenois and  Éamonn McManus - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Serverless Kotlin with App Engine by Ludovic Champenois and  Éamonn McManus</b></h2><h5 class="post__date">2017-11-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bHKQ_o3vwK4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good evening
can you hear me well yes so thank you
for being attending this session about
running Kathleen in the Google App
Engine server so my name is Lydia Chopin
wah I'm I've been working on Google App
Engine since 2011 and before that I was
working for Sun Microsystems
doing various Java technology including
tools NetBeans Eclipse and then
aggressive Java EE Enterprise and I'm
Aiman McManus I work on the same team
the Google App Engine Java team I'm also
a member of Google's internal Java style
committee I've been using Java since the
dawn of time I used to work at Sun on
JMX and Java effects I mention all of
that because it shows that I'm kind of
as a Java zealot and I'm going to be
talking about Kotlin as it compares to
Java because I know a lot of a Java so
this is the outline of the talk we're
going to talk about kauflin what it is
why it matters then we're going to talk
a little bit about App Engine it is in
in distinction from Kotlin then we're
going to talk about cult on on App
Engine and then finally we're going to
talk a talk about Kotlin on Android
talking to App Engine so let's get
started so cotton it's a project from
jet bring JetBrains
they're the makers of the IntelliJ IDE
that's kind of important because it
means that they've designed the language
and the tooling at the same time so the
language has always had really good
tooling which is something that often
handicaps new languages the ideas will
be familiar from other languages so
we'll be looking at number of them and
you probably even if you're not familiar
with Kotlin you would say well that's
the same as in groovy or Python or
something like that it's been around
since 2010 but it's wonder release was
in February of last year it compiles it
as a number of different targets it
compiles to the JVM which means that you
can run it in server-side Java but also
on Android it also compiles to
JavaScript for
web pages and it compiles to LLVM so
there's some support for for example
making iowa iOS binaries i interrupt
writes well with java so that's
important
if you already have java you can add
Kotlin alongside it and the two can
interoperate well and finally as of
quite recently it's an official language
on android so you can develop Android
apps in Java of course as always but you
can also develop them in Catalan or in a
mix of the two
so cotton versus Java what are the
things the Kotlin adds to Java so the
first thing apparently every new
language has to have this it is an
important thing that every language has
to have and that is there cannot be
semicolons right this is this is Faye
Dunaway being Joan Joan Crawford having
discovered that her daughter has wire
hangers in the closet so semicolons are
the wire hangers of programming
languages and they must be banished I
don't personally understand this
semicolons already bothered me very much
but apparently they must be banished
okay second thing this would be kind of
familiar from for example c-sharp it's
the idea of explicit knowability so it's
what optional gives you but with a
cleaner and simpler syntax it means that
you as a developer can force other
developers which might be yourself to
think about whether an object can be
known before you use it so you will
never get a nullpointerexception that
you didn't think about so if we look at
this example it's a function that has
two parameters the second parameter has
type string and that means it's
definitely a string it can't be no and
the first parameter has type string
which means that it might be a string
but it might be no and you have to think
about whether it can be no so if we look
at the lines of code that call this
function the first two are unsurprising
the third one doesn't compile because
you're trying to pass a null to a
parameter that you have to declare it as
being of type string so it's not string
its string therefore cannot be null and
the compiler will reject the attempt to
make it you know then if we look at the
four
line point there is you can call not
null dot length and you don't have to
worry about the fact that that could be
no because the declared type is string
meaning it can't be no the next line
then maybe no you can't call dot length
on it because it's a type string which
means it could be no which what you can
do there are two things you can do one
that I've written there is you can use
the question mark dot operator which
gives you the length if the object is
not no and gives you know if the object
is no so the type of that is int meaning
it can be an int or it can be no and you
have to continue thinking about what
whether that could be null when you deal
with it later and then the second thing
that you can do is you can put in an if
you can say if maybe no is not equal to
no and then within that if the compiler
does flow control analysis so it knows
that within the block the thing can't be
no and therefore you are allowed to say
maybe no lotlinx
okay next feature data classes so this
is something somewhere where Java really
falls down quite badly if you have a
class that it's just basically a
collection of properties and you want to
be able to compare instances of that
class and convert it to strings and so
on then you have to write an awful lot
of code you have to write fields and
constructors that assign to the fields
and you have to write to string and
equals and hashcode it's typically like
a class like this that is just two
properties it's typically 30 lines of
code no I'm just going to plug my pet
project here Auto value which is a way
that to reduce that to a mirror I guess
eight lines of code but it's still a lot
of boilerplate when you all you want to
see say is this is an object that has a
string field called name and an int
field called number of legs so Kotlin
basically gives you a way to do that in
pretty much as little code as you could
possibly imagine so that's very very
useful that that thing has to string and
hashcode and equals defined for you and
it's just there okay next thing named in
default parameters so this is really
very convenient compared to Java there
are
so the named parameters solve in
particular a problem that you often have
when you have many parameters or more
than one parameter of the same type like
for example you have two boolean
parameters that's the the example there
at the bottom we're calling adjust size
and if we didn't have named parameters
we'd say adjust size true comma false
and the reader would really have no idea
what that meant is is the true parameter
horizontal or vertical you might have to
put in a comment that says oh the first
parameter is actually horizontal but
nothing is checking that right maybe you
were wrong so it's really good that you
can you in Kotlin you can use named
parameters to validate that so the
compiler will check that the compiler
that the parameter is called that and
also of course you don't have to supply
the parameters in the same order that
they were declared in and then the
second thing is default parameters and
where that helps you is it gets rid of
the the Java
I guess anti-pattern where you often
have like a parameter a function with
one parameter that calls the same
overloaded function with two parameters
and that calls a thing with three
parameters and so on which is a complete
mess you don't need that at all because
you simply provide default values for
the parameters okay
extension function so this is this is
kind of fun I guess it says fun in the
name so the point here is that you can
basically take classes that have already
been written including system classes
and you can add methods to them so in
the scope of your extension function you
can call the method that you have
declared as being in that function that
in that class as if it really did exist
in the class so the example that I'm
giving here also shows operator
overloading so the idea is that Kotlin
unlike Java the compiler doesn't have
special treatment of the plus operator
on strings all that it has is that the
wrong time as an extension function that
adds to string a function that's called
plus and that means that you can call
well what it does too is that it says
that function is an operator function
which means that you can call it as plus
PL us but you can also call it using the
plus operator so each operator like plus
minus
equals and so on has a corresponding
spelling and when you say an operator
function without spelling you are saying
I can also use the symbol for this so
that means for example they've also
added an extension function that is plus
two big integer and big integer you can
use big integer dot value of something
plus begin digital value something else
with the plus operator versus the
horrible thing that you have to write in
Java where you have a whole chain of
method calls that are trying to say that
I'm adding one thing to another okay
next thing is role strings and
interpretation so this Java code is very
typical Java code I end up writing code
like this quite a lot and it's very very
frustrating the point is you've got
several lines of what are going to be
generated code which you have to write
like this because you can't split a
string in Java therefore you have to
concatenate a whole bunch of things that
have explicit path let backslash n in
them for the new for the new lines and
anytime you want to put anything
variable inside that string you have to
end the string plus the thing plus back
to strings again so that's that's very
messy and what Coughlin's gives you is
two things one is raw string constants
so if you do this triple quote thing
that'll be familiar from other languages
like Python then everything on the
following lines until the corresponding
closing triple quote is a string so that
gets rid of the problem of new lines and
concatenation and the other thing that
it gives you is interpolation so dollar
within a string means so if it's dollar
just immediately followed by an
identifier it means that it takes that
identifier and gives you the string
equivalent of it and dollar with braces
means that you can have an expression in
there and will interpolate the value of
that expression okay so those are all
things that Coughlin's adds to Java I'd
also like to mention a few things that
it fixes from Java so Java like it's an
ancient language it's more than twenty
years old a lot of design decisions were
made at the start that made sense at the
time but that really don't haven't held
held up very well they haven't stood the
test of time so here's a few of them
that caught
and fixes and that Java programs will be
really well I certainly I'm relieved to
not have to deal with these things
anymore when I program programming and
cotton so the first thing is assignment
should not be an expression and of
course it is in Java so there are a few
idioms in Java or you use this T and
it's an assignment expression but most
of the time when you write the equals
operator as an as an expression it's
because you meant to write equals equals
so that's not helpful and by making it
not be an expression coughin frees up
the equals operator to be used for the
syntax of named parameters right because
in Java you can't write this syntax name
equals Fido because that's just an
assignment to something called name but
in cotton you can write that and that is
the natural syntax for named parameters
okay next thing if primitive types
Kotlin more or less doesn't have
primitive types so it has Java has an
inter type and an integer type Caltrain
has int + int meaning it's ain't that
cannot be null or into that can be no
and that's the only distinction that it
makes and it turns out that the thing
that can't be null is the same as a
primitive but there isn't some notion of
a primitive type that is completely
different from everything else in the x
pipe system the next thing is that Java
made the mistake and I think this really
was a mistake from the outset of using
the double equals to mean identity right
so if you so if you have write this code
here in Java you are making mistake
usually you are making you're comparing
animal dot name against your asking
whether animals up name is the same
object as the string Fido where what you
want is is camel dot name the string
animal got name equal to the string
fighter so it does mean that in Kotlin
if you really want identity which you
almost never do then you just use the
triple equals okay Java I think in
reaction against C++ made it very easy
to over eye things I would say too easy
to over eye things so you can put your
class out there and if you haven't
remembered to make the class final or
all of its methods final then anybody
can come along and override them and in
general if you haven't thought very
carefully about what that means
going to be a disaster right you haven't
designed your class with this overriding
in mind somebody ends up depending on
the internals of your class that you
haven't documented it you didn't think
they'd be overriding it you change the
class you break everything so Cochran
you have to explicitly say that a class
is open meaning it can be subdued at
then its final and you have to say for
each method that this method is it's
open meaning that I have thought about
the possibility or that this method
could be overridden and then when you
override a method like the add override
annotation in Java but mandatory you
must write the override keyword okay
this is something that really frustrates
me which other when you are writing a
method the variables the local variables
in the method nearly always you assign
them once and then never again so the
kind of variable that you are actually
going to modify while the the method
executes is a special kind of variable
that you would really like to call
attention to where is the kind that you
assigned to and then never touch again
if it should be like something that's
easy to express so you can express that
in Java but then you have to use Final
which it's the wrong way around you have
to use final for the usual case and
nothing for the unusual case so what
Coughlin's gives you is that there's two
different keywords Val and ver and you
use so it just as easy to declare
something as will only be used what will
only be assigned once versus will be
will be reassigned and even the IntelliJ
IDE underlines variables that are
modifiable to call attention to the fact
that these are strange variables these
are in an earlier presentation I saw
very being referred to as the keyword of
shame so yes
you should not be declaring variables as
very very often okay so
Coughlin's doesn't have fields are not
really it certainly doesn't have fields
that are visible from outside the class
so this is a problem with Java you can
declare all refused as private and
nearly always should but there's nothing
stopping you from and programmers
regularly do this especially
inexperienced programmers having classes
with visible fields and then reading and
even assigning to those fields from
outside the class so you cannot do that
at all
in Kotlin what you can do is you have
properties so it looks as if you're
assigning to a field but what's actually
happening is this is a property you are
going through the a method that you can
declare within the class so a sort of
special Gator or setter method that will
control access to that property so by
default it will just give you the the
value of the other thing and write to
the value but you can change it at any
time so the situation here is in Java if
somebody assigns to the field dot bar
for example you are stuck with that API
right you cannot then change bar to not
be a field anymore because you would
break that code whereas in cotton maybe
it started off as just a plain value
that people can assign to but you can
come along later and add a set method to
it which means that now when they
assigned to it your method will be
called even though their code hasn't
changed at all okay now this one really
it's quite understandable from Java by
twenty years ago
HTML was a really good choice for rich
text and they did polluted it a bit with
these brace things which tends to make
it a bit unreadable but it made sense
nevertheless for a modern language it's
really much much better to use markdown
and that's what Carleton does so you can
see here it uses the back quotes for
text for computer for font yeah for
literal text that would be rendered in
in a special font and it uses square
braces square brackets for links so this
for example is a link to a method in the
same class okay so having said that and
everybody has been singing the praises
of Catalan throughout this conference I
will mention that I think there are a
few areas where Catalan does have its
drawbacks
just three so the first one and this I
find this kind of shocking is that
everything is public by default so if
you want a thing not to be public you'd
like module private or even class
private you explicitly have to write the
private key word and I think the reason
for this is that cotton was kind of
partly a scripting language and that is
a default that does make sense for
scripting languages but when you have
when you're building big systems you
really want things to be as locked down
as possible you really want to have to
make the effort of saying this and this
are exactly the things that are public
in my API and nothing else and cotton
that makes that unnecessarily hard the
second thing and this is easy to lose
sight of when you look at all these
shiny new features is that when you
start with a language that is basically
equivalent in power with Java and you
add things to it then you got to end up
with a language that is bigger than Java
and Java is already quite a big language
so we've added all this stuff and we end
up with an even bigger language so
coffin is it's been pretty tasteful if
they've chosen with care the things they
were put in it it's not huge not a big
sprawling language like some I could
mention but it is nevertheless big and
that means that somebody who's learning
to use Carleton has to learn all this
stuff potentially somebody who's
modifying your Catalan code that you
wrote has to potentially know all of the
features of courtland's so they have to
learn Kartli from a tea set and then the
final thing and this is a little bit I'm
not sure about this one but it kind of
assumes that you're using an IDE so it
works really really well when you're in
IntelliJ which I guess is its home but
there are a few things that you know
sometimes you're not
sometimes you're reading code on G's
help github or something like that and
then things are a little bit difficult
first of all it's not like Java where
the class comm example foo for example
is going to be in calm slash example
slash food of Java there's no necessary
relationship between the package name
and file name so that means that if
you're looking for that thing Yury don't
know where it might be unless somebody
has carefully followed those conventions
the second thing is and this is guess
the criticism of type inference in
general it is annoying in Java to have
to write the explicit type of
everything but the fact the idea of type
inference which cotton has and Java will
apparently sue soon has means that you
have to potentially follow a chain of
references to see what the type of an
object is so just looking at this code
here on the second line to know what URL
that read text might return you have to
know what URL is and to know what URL is
you have to look at its own declaration
the second thing is extension functions
are nice but the thing is there is they
can be confusing too right and this in
this example we're calling on an object
of type Java net URL a method read text
which is actually a cotton extension
method so if you go and look at the
online documentation for Java net URL
you will not see that so that's a little
bit confusing okay that's that's it for
me about cotton and I'll hand over it
for now yes for now so yeah we're going
to switch now to the Google App Engine
the new runtime that we we launched
recently so if you don't know App Engine
has been there forever almost in fact I
think it was announced in this
conference in 2009 and it was I mean
Java was still early access but it was
available already eight years ago so the
the principle of App Engine is you do
not care about what is running in the
cloud you run you you care only about
your application so you write it using
for the Java Runtime web apps we serve
less or J's P's and frameworks then you
may use cloud api's that are very very
robust then you deploy it to App Engine
and we run it from zero so if you have
no customers you pay nothing and if you
have a few million customers like big
customers then we passed you go
so initially we started with Java five
upgraded to Java six Java 7 and finally
this year we launched Java 8 so these
are typical workload of apps you cannot
predict upfront what what would be the
usage of your app sometimes you may you
may predict it you know sometimes at
night
it's lower lower QPS and during the day
but sometimes it's also random events
that attract people to your site and you
have to be reactive enough and put new
jvm as the number of customers increase
and ask for services to your ad so once
you I mean once when you deploy develop
your application you can use the what I
call the original App Engine API that
were only specific with the appengine
product so App Engine arrest or very
mean the no SQL database which is based
on BigTable so scales to infinity test
you which is a appengine messaging
system
the memcache which is mandatory if you
do the left or you have to put the
memcache layer on top of your data store
queries app identity user ID and user
API is true to do logins and know who is
accessing your web app and recently we
also developed API that you can use
anywhere from your laptop from compute
engine from kubernetes machines like
cloud datastore which is based on the
App Engine datastore but that you can
use from anywhere including from App
Engine but from other other clouds as
well third sequel cloud pub/sub which is
also a replacement Fortescue still in
beta and cloud memcache as well that you
will be able to access from from
anywhere we have more than one other
sorry API so if you go to the console
and you can enable or disable for your
app specific API so it's growing every
every month we provide a new API so all
those existing app engine API that you
could use in 2009 they are still
compatible with the one that we provide
today and the nuclear API is are
accessible in the new Java runtime so we
launched it end of September so it's
very recent
you could ask why it took Google you
know so many years to to catch up with
the Java stone that because Java 7 I
think was a well I don't know maybe a
year or more ago there is a reason for
that
ok but there's a goal for this new
runtime was very strict backward
compatible compatibility because we have
many customers I mean in terms of
millions of customer of them obviously
we cannot break them it's a platform as
a service once you deploy your app UX
technique to work that forever but for a
long time we wanted to remove all the
previous limitations that was there to
to implement the security rule that we
have at Google and we wanted to support
all the api's and the good news is we
already have a very very large customer
of serving millions of query per second
million QPS on this new runtime so just
almost two months ago it's based on the
open JDK 8 that we build ourselves
inside Google but it's from the open JDK
project and the GT 9 web server so as a
side effect using servlets 3.1 so the
reason why it took us so long to deliver
the Java is because we wanted to remove
all the produce restrictions that we had
to have for the Java 7 runtime because
Google imposes to run I mean to run
untrusted code so your your code we need
more than one security layer so one of
them in the previous version of App
Engine was using the JVM security
manager with permission so the this
force with this force does not mean to
develop some classes for any for AWT
which is implemented using that native
code we could not run native code
otherwise we would have broken the first
layer of security so no DNA no insecure
classes like 5 threads etc the new
security layer that we have now
initengine eight is already covering
those those two layers of security
therefore we can remove the Java
security layer from the runtime running
your application and we can allow you as
a Java programmer to use the entire
capabilities of the JVM so this brand
new engine security layer works
I mean sandbox is used in App Engine and
also used in thread functions or cloud
ml or new products that are built on top
of the App Engine platform so it's a
virtualization based sandbox providing
strong isolation between where it's
running and your application it's not
based on VMs so this is not a compute
engine VM it's not and it's allowing
more than 250 Linux its course so this
is where we are we are doing all the
magic very lightweight and fast and the
good news is because it doesn't require
any change to the Java platform we can
give you whatever you want
so frameworks running on this new
sandbox or the previous frameworks
equality in App Engine
groovy tracks arise I mean everything
you could do since 2009 is still running
in in App Engine and the new runtimes is
based on servlets free one spring boot
is working so we're going to demo a
spring with applications on on App
Engine jape ster is also working but we
are still working on adding a plugin for
it to generate the extra configuration
for App Engine spark Java so we
obviously want to upgrade to Java 9 very
soon well it will not be it's already
almost deprecated so we we wanted to
target Java 18 but Knights rename shall
attend but I think we might be able to
catch up with Java 10 early next year
and obviously cotton which is the
subject of this talk so we're gonna do
quick demos I mean I have slides so that
you can see the back up the first slide
before we switch to the demo is the
yellow world servlets oh no no
frameworks you just use what a pen
really gives you by a fault
so you inherit from the servlet API you
annotate your servlet with servlet free
one annotation you have a ride the HTTP
service class you implement it using cut
in class so it's a new column in loop in
rate inheritance and your you override
the function do get and you use cut lean
constructs to to create strings with
more than one night so we're gonna
switch to the IDE IntelliJ and I have
two thousand assets so the yellow solid
is here
okay so it's a web app so I used maven
you could also use a grade or to
configure both the App Engine API is
plus the pet lien plug-in to compile
code clean code the project has to be a
war file I'm in a war directory so
basically it's a packaging war in your
melon or red or plugin so here again is
the full demo and I can locally run so
we have obviously a local SDK where you
can we emulate all the App Engine API s
and you can test locally debug your your
application so here I'm running locally
so let's click on here and we can make
it bigger okay bang so ladies running
inside App Engine so so let 3.1 as well
as cutting you can deploy this you can
deploy this application to the cloud so
let's do that
deploy run and we go here so here I have
the version of my application I have two
thousand us on the project cut in Java
if i refresh it very soon i should see
that i have been deployed so it's still
being deployed in the background if it
doesn't work
we wait okay successful i refresh the
deployed version is new here servlet
version if I click on it we boot we
built a new instance for you because we
scale to zero initially so we have to
boot and then same servlet running in
the cloud very easy so we're going to
switch to a second demo let me kill my
previous instance here second demo is a
much more complicated application
because it's using the spring framework
spring good framework the data store API
so the last or entity where we can
create an SQL entity either or locally
for the beginning and in the cloud so I
have my application here which is
typically a sprayer annotated with
spring with an application and again
here it's written in Catalan so you have
the fun main method to utilize your
application so it said this is a spring
application and let's look at the simple
greeting
endler again using spring with epic
annotations you can annotate a cosine
function and said for the greeting URL
with possibly name name parameter with
the default value i will return the
string so this training is that object
so this is a greeting that object that
is here as a man mentioned you know it
gives you gather for VARs and settle for
VAR and then all the plumbing like the
two string method which is used in this
handler because we just returned this
value okay so very simple we can again
run it locally or before we run it let's
look at a second at the second endler
which is the data store counter
controller okay so here it's another
handler where we first of all get the
data store service object and we try to
see if given key is there and if the key
is not there we created with the
property count initialized to zero so
the interesting thing here is we create
a new entity object from data store and
instead of calling the default set
properly or get probably in data store
we can use we can override the access
the setter and getter parameters because
there is another curtain class here
which is redefining the operator entity
that yet to be an operator so that the
bracket will do a get and same for the
set where we we can either read or write
on an entity object using the bracket
operator so very easy way of using
cutline and existing Java IP is and
exchange extending them so that they can
be accessible so let's locally run this
I don't think will deploy because we we
are running out of time already
no we're okay okay so let's first do a
local run here so I'm recompiling
everything running the cloud SDK which
is burning the App Engine runtime
locally and here I can again I did not
define the URL for slash but if I do
great thing yeah that might work better
okay so here I have the two string
method on the data the data class that
we defined in the in the project okay
and the other URL we want to see is
increment counter so I tried ten times
you know here I tried ten times to call
this and lower if I call it again it
would be 11 etc I guess you see this
number increasing here I put the code
snippet but the formatting is corrupted
so don't don't worry about that okay the
important thing is this counter here
which is incrementing every time you you
call the the anger so we can let's
deploy yeah we can deploy I mean let's
go wild I don't know if it will work you
know
let's deploy so the deployment will take
a bit longer because Springwood
framework is a little bit bigger but
meanwhile I wanted to go back to the
cloud console and see some some
interesting graphics so I deployed well
now we see three version of my
application let's go back to the first
Springwood Katrine
where
let's look request and the last 12 hours
okay so here I've done something I've
done something where let's see instances
yes so I used a meter or locally on my
mag to put some load on the application
to see how many instances it would boot
for me automatically okay and this graph
let's make it bigger maybe I was able to
to create one ordered 79 Springwood JVMs
serving my Tracey so I can scale from
zero to you know 200 instances in almost
no time I mean the just the time to boot
a JVM
the Springwood framework which takes you
know a few seconds on our instances and
then after my test was done I stopped
and then all the instances got killed so
let's go back to versions to see if my
application has been deployed that's me
so yeah
9:27 am I'm still in California time
sorry
so we deployed a minute ago here we can
now go to this endler which is running
on appspot cam so let me bigger because
and now it's still waiting but if it
works you should see 128 ok so if I
reload you will see 129 so basically I
was able to locally run and potentially
debug and deploy my Springwood
application in you know less than a few
I mean a few minutes in fact 58 second
because the network is slow before it
was 40 seconds so this is basically a
demo of showing to applications very
simple one we saw LED and a much more
complicated one with spring good because
spring would add some hard time to work
with the previous Java 7 runtime because
we had so many limitations in in terms
of threading and access to API that our
sandbox did not hello now it's possible
so this is very very interesting let's
you want to talk about the transaction
thing the transaction thing so yeah we
have a few more minutes let's go back to
the increment counter here so here you
can see that we are basically calling
data data stored from the transaction
method on a lambda
which is calling put on the variable it
okay so it's if you see the tooltip in
spring in until it reads automatically
declare based on the expected type so
basically this method food is really a
method on the data store object that if
you see here is is passed as as as a as
a method parameter so that you can avoid
typing transaction or data store quit in
this lambda here so it's one you know
it's another way of using cut lean to
minimize the amount of code you need to
type in your application if you go here
this is where we define those those
capabilities so I put them in the same
project but we will want one day to have
somebody from the community providing
extensions to the appengine api's and
make them available on maven so that you
can add them at the dependency to your
project so I think this is the end of
this part and before I move to the next
part just want you to look at this I
look up and they're very simple again it
takes a name and return hello name you
executed the Ruka pendler on cutscene so
this is the one we're going to try to
call from an Android app and Emin we'll
we'll try to do that now so let me I
killed this wall okay so where is now
androids - you hear that looks like it
yes okay alright so I've written it like
a really simple toy Android app using
cotton and using Android studio and and
so the last time I wrote an Android app
was quite some time ago I don't usually
I usually work on server side rather
than client side and I was astonished at
how easy it is now to use Android studio
to develop and especially in cotton so
coffin is now supported language for
Android studio
I personally if I were writing an
application I think I would write it in
cotton but you are perfectly free of
course to you continue to use Java so
about this application what I wanted to
do I actually wrote the application
twice I wrote it once in Java and once
in cotton just to see how that that
compared so let's look at the Java
version so this is the Java version
call your attention to the line that the
cursor is on so what this is doing and
this is very common in in Android apps
is for basically every element of the UI
that the code has to interact with you
have to call this really ugly code that
says fine view by ID and then you have
to cast that to what you know you know
the that particular UI element is so you
have to say well I want to get this and
I know it's an edit text and if you make
a mistake I was still going to get a
class cast exception so that's kind of
ugly and the cotton tooling does away
with that so it arranges for every UI
element that has an ID to have a
variable of this with the same ID so if
we look at the line the cursor is on
here it is showing that we just have a
variable called name input which is the
ID of the object in question now we
haven't had to do anything for that to
be there and it has the right type this
is the key thing as a right type if I
hover over well it doesn't show me that
but if I click on it then it takes me
directly to the design XML where that
that type is declared this is the text
view of the design and then if I switch
to the design of view I can see this is
the object here and over on the right
there and the attributes I see that this
is the ID that I gave it so because I
gave it that ID if that's what it's
called in the code and of course this is
a general UI editor that I can use to
fiddle with you know the dis sizes and
how things are relative to each other
and so on so if we go back and look at
the code this here is
object and it's simply so the tooling
arranges for this special package Kotlin
X dot Android synthetic to contain
basically the declarations for all of
the objects that are in the design view
so you can try to run it first yes
Berman's okay so yes that's a look at
the emulator so I am going to run the
application from the IDE that's gonna
chug away for a little while not for
very long because I didn't make any
changes and then if I switch switch the
emulator here is the application so I
can interact with the emulated keyboards
so I'm going to type my name in here I'm
gonna shift it let go to all the trouble
of getting my accented letter no detect
the other letters on the keyboard is a
pain to do all of these things every
time I do this exercise is very peculiar
every time I do this exercise I get
different proposed completions there so
instead of aimin I could be 22nd or f150
I don't know why that is and it's
different every time I do this but I am
apparently either aimin or 22nd or f150
anyway so if I hit return here which is
equivalent to typing digital checkmark
there I should get an answer again this
should be interacting with the
application as we speak okay well it
might just be very very slow I'm not
sure exactly what's going oh yes except
probably some kind of network glitch
well maybe the Vincent's was closed and
then oh yeah it might may have just
restarted in Russian yes okay good point
so yeah that was why little bit so that
first time but then if I change that to
something else and use it again right
it's immediate now okay so so that was
what was going on okay so anyway this
emulator here and it could just as well
be a real phone of course is interacting
with a web service which happens to be
implemented by app by app engine it
doesn't it doesn't have to know that so
usually don't do that okay I mean don't
call HTTP URL this way and use as if a
web framework or West web frameworks
this is just a demo and so let's just
see this is
just to show off some of the nice things
of Android studio let's just see what
happens if we change the string that
gets printed so I'm just going to little
thing on there and now so this is a new
thing a relatively new thing in Android
studio that lightning flash there is the
kind of updated quick re quick run when
you haven't made very many changes to
the code so you click that rep it does
some building executing tasks by blah
there we go and it has finished and if I
look at the app it has actually
redeployed it and if I hit return here
but why is that slow okay oh you do that
first okay if I do that I would have
expected that for yes okay so for some
reason that is I I think there must be
some combination of slow Network and
instances being restarted
but anyway that has redeployed and it is
showing the the modified text and now I
think we are more or less done do you
want to wrap up I think we we are done
so we we covered yeah let's move back to
the fermentation stories this one okay
so first of all we we put the demos of
those three the source code for those
three demos I mean the servlet spring
bootcut lean and then the Android app on
this github location will the slides but
basically in less than 15 minutes we are
about to cover a quick introduction to
cut in compared to Java as one of the
Java guru here I mean Google stylist
it's a pretty pretty important mission
at Google to to to review internal codes
then we looked at the new Java 8 runtime
for App Engine stand up and we were able
to demos and to an application rising
running from your Android phone to the
Java Runtime running in the cloud for
App Engine
so thank you we have two minutes left
there may be some questions or if not we
can also take questions outside so thank
you yes we're so the question is how
would you define an android studio that
you want to use Kotlin on the app so
let's go and look at it up this is the
one oh yeah this one okay so let's say
I'm making a new project new project
okay so it doesn't yeah so you have to
check check the thing there that says
include Kotlin support and then every
time you make an you task like I want to
make a new truss in here so I got to do
this yeah new so as well as new Java
class you have cotton classes and this
is where as I add each class I'm gonna
say it's a cotton toss and or the yeah
or the build I mean to the tooling is
pretty pretty baked in this project
yellow very work it's wonderfully I've
really had a sampling very impressed by
this okay
how does cotton behave as at the
boundaries of the interaction with the
JVM how does it interact with Java do
you mean yeah okay so I kind of so the
question is how what happens when you
for example with the with the no special
treatment of notes that I talked about
what happens when you're interacting
which other which doesn't have any
treatment like that so I did well so
over some details there is a special
type that uses an exclamation mark
instead of a question mark and that
represents an object that might be no
because it comes from the platform and
there the compiler isn't allowed it
can't forbid you from interacting with
that and you can get a null pointer
exception so there's there's kind of a
slightly strange thing that happens at
that boundary sure okay I guess we're
done</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>