<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The end of polling : why and how to transform a REST API into a Data Streaming API? by Audrey Neveu | Coder Coacher - Coaching Coders</title><meta content="The end of polling : why and how to transform a REST API into a Data Streaming API? by Audrey Neveu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The end of polling : why and how to transform a REST API into a Data Streaming API? by Audrey Neveu</b></h2><h5 class="post__date">2017-05-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xclRxDb75l0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">forget it make it do it make sure thanks
for coming to this session so we're
going to stick together why and how you
should consider transforming your REST
API into a data streaming API so quickly
to introduce myself I'm developer
relations that stream data at i/o we got
a booth
we got nerves for comments yes and I'm
also the co-leader in Friends of devoxx
for kids which is as you probably know
the coolest initiative in the world so
let's step into a topic modern times we
know that for the last few years
Internet has been more and more consumed
on mobile devices
finally exciting desktop conceptions to
use in a house ago something like that
so we also know that applications that
we develop now have to be mobile ready
even businesses want you to bring your
own device movement the problem with
mobile application is that the mobile
market is completely packed it becomes
very very hard when you launch in your
applications to acquire users especially
activities and even more to retain them
so we get to make them addictive and we
know that to keep our users interest
alive animation is the key so that the
reason why I will be using gif instead
of bullet points I know you're all
completely made of bullet points I'm
sorry but do you know why animation is
so important
actually it's coming from evolution but
when I say evolution it's a little bit
older than this it's coming from this
with a guide there was understood one
really important thing if it moves it
can be two things foot or bender so in
those case it might work worrying a
little bit about and this has created
some kind of reflex in our brain which
make that if it doesn't move our brain
ii think that it's dead it has no
interest just move away so on the user
interface part of our application we
already know that animation is very
important we already know how to do it
we get css3 every mobile framework as
its animated component and even material
motion a very interesting thing to know
Jesus that material motion obviously as
a dedicated part animation they explain
you how to make animation probably and
one of the reason why they recommend to
any major application is hiding from the
user what's going on behind the scene
because the program comes with data when
it comes to data usually we're using a
refresh button which is not the best way
to start and happy relationship with our
user that's typically me in front of a
refresh button
we know the less interactions the users
to make to retrieve the data is
interesting and the best it is and the
problem with refresh button is that
usually it never comes alone it always
comes with that other screen of the Dead
and if the screen is staying for too
long the user will be very upset
probably leave the application and in
worst case never come back so repeat
after me refresh button is evil we stop
using it really that's not me we're
saying it's bad man so if it's bad man
it's true you know
and in fact what you need is a real-time
user experience in your application so
if you're looking on most popular
applications on markets both in terms of
active users or in terms of dwell time
which is the time you spent on your
applications you will notice that it's
mostly application which are based on
your own real time experience from the
beginning all which has integrated very
quickly so I took here as example
Ueberroth Twitter and what's up but I
could've mentioned slack or Google Drive
because it's also the case in our
business applications because yes real
time is create some kind of new reflect
you know you're in reflux narrow brain
now we get so mu this fear of missing
out so those three little dots don't
sing around are telling me that
something is going to happen you know
something is coming and I really want to
know what
so I'm saying I'm saying looking at
social three little dots dumb thing - I
don't know why I mean I mean absolutely
I have no idea what is coming but
is coming and I want to do I know it
doesn't sound really smart after that
I'm sorry
so basically it's not really complicated
to get real-time you just need to take
your city KPI and turn them into a
stream of data usually talking about
solutions for real time some are
mentions that you probably know some
perhaps not so I will just check quickly
with you and the first one is pulling
and uncoiling
windows bad yeah
web works who have heard about ok not
that much people pretty great that's
going to be interesting tap said mm huh
WebSockets
so here obviously everybody is raising
their hand and citizen Svensson is about
service insurance ok great so we're
going to give a little bit different to
each of those technologies but before
picking one of them we have to keep in
mind that the solution will depend on
two very important things the first one
is your update frequency if your that
I've dated every second every minute
every hour are you even able to predict
when it will be refreshed or not is it
completely random and the second one is
the usage of this data is it going to be
consumed as it comes and if you're
missing one it's not really important or
is it the beginning of a workflow so
let's hunter the subjects for real
we'll start with putting and long
polling so polling is this basically I'm
making a request waiting for the answer
send the same request again making
waiting for the answer and so on and so
forth that's in the syntactic world of
theory you know where everything is
shiny and there is unique all everywhere
and that kind of things because in real
words polling quickly turns into polling
madness you will make a lot of useless
calls and you will retrieve the same
that are a lot of times and I don't know
if you're familiar with that here who
don't know about that peer okay so the
quickly is that peer is an application
which purposes you to create your own
workflow so basically you can say for
example each time I received an email in
my G Bell Bell inbox with attachment
save the attachment in my Dropbox
account and so those guys have used
polling at first they've made a lot of
bench and notice that 98.5 percent of
polls were just wasted and one of the
problem with polls is that in case the
connection is rubbed for any reason you
have absolutely no way to know what
you've been missing so that's the reason
why some people have tried to find a
solution and they switch to what we call
long polling which is basically the same
instead unless that we are going to keep
the connection open until the server you
have to send to the client so yeah it
could work the problem is if you're an
apply provider very popular with a lot
of course on your PI's you will probably
not be able iving hold that connections
opened until you have no data to send so
polling is not a solution wrong polling
neither it's much more a hack than a
real solution and we should stop using
them too so now let's talk about web
hooks way books which you can find
although under the user-defined HTTP
call back name or user post define as to
be called back name it's a concept a
method there is no specification so
don't forget it you get a website which
is very useful that's probably the place
where you will find the most more
information and there is a Google Group
I think and they got a very nice logo
and from this point that's all that we
can say four way books because from this
point is yellow everybody is doing it
the way they want so in theory again web
books work this way
so first as a consumer I'm going to send
a post request on an API provider saying
okay I want to subscribe and this is my
callback URL so you get to provide a new
well then the apt a provider will answer
and say okay subscription created
and each time there is new notifications
to send to the client the server will
simply make a post request on your
callback URL with data in the payload ok
very nice but as you can guess it
doesn't work just like that there is a
small to-do list to implement on this
side before using web books so on the
consumer side it means defining callback
URL and this URL has to be accessible
from outside so it means no localist
not via in the proxy not going to
firewall keep that in mind
phone apply provider first you get to
create a subscription endpoint so it
will be two resources the first one
slash way book will be used so the get
method is going to retrieve all way
books available the post method is going
to be used for creating a new
subscription and the slash way book / ID
resources the get is basically the
equivalent the equivalent of classic
polling the boot will be used to update
the words description because perhaps
want to change our callback URL and the
delete method will be there to consult
the subscription and then comes the very
important part for the aperi provider
because from this point you get to
choose how you implement your web occur
cue the first edition I will not
recommend it but some people are using
it the what we call in night GP requests
basically it means that every time you
get a new subscription so you're going
to register it in your database for
example and then every time you get a
new notification term you're going to
run a chrome task for example which is
going to see every subscription for this
notification and which is going to send
them manually so you will have to annul
retry failure or everything that can go
wrong that the reason why it's not
really recommended it will delay your
insert too much but could be I mean it
could work so test for example if you
are the beginning of your implementation
the second solution is SQL based queue
so basically you're going to store the
notifications you have to send in your
database and then having the same comes
up which is going to take care of
sending notifications
Khyber's so it will not scale a lot but
that's a good solution if you can't add
another piece of technology in your
stack
that's something happen and the best
solution to me is aim 2p broker so if
you already have rabbitmq or ready for
something like that in the sack you can
reuse it and let in send notifications
the last solution is batch so batch is
more likely to be used when you know
that your API will send a lot of
notifications Facebook for example
they're using a batch
they're sending notifications every 5
seconds and or if there is more than
1,000 participation and sent so now just
to show you a quick example of the setup
so I took your example detail and so
it's a repository of mine you can create
web books on repository and
organizations so you're going in the in
the settings part and then you get a web
books part and you can have so payload
URL is your callback URL then you're
going to change
choose your curtain type so in theory
web book support both XML and JSON but
remember you know so and then you will
have to choose which notifications who
are interesting so by default who will
be registered to the push event you can
choose to register to every event that
happens on your repository which is not
something I will recommend obviously
more specially if you're on a very
popular repository of course or you can
select individual events and then you
will receive something like that so this
one is really nice to me because you get
a experiment which tell you tell you
exactly what has happened if it's an
issues if it's pull requests or that
kind of things and in the payload you
get all informations about the event
so now talking about pros and cons of
way books so when we books arrive you
know everybody was like well real-time
updates yeah it's almost real-time
updates because as you as well seen
previously
if we really depends on the
implementation your tooth for your web
queue and if it's a batch for example
size again in the world of your time
it's a very important delay so it's not
real-time updates
it's almost real-time updates which is
very nice
without dedicated resources because
obviously when we are making polling and
even more long polling we were having
often we were having dedicated resources
just to take care of this part we don't
need that anymore that the good point
easily consumed it's a post request so
it's something we already know how to
handle and easily integrated have
everything you need is a is a server you
probably already already got one so it's
fine but looking at comes so the user
experience is very is a real problem I
took last example Geetha which is
obviously one of the best user
experience you can expect but that will
obviously not be the case for every
applied provider and the fact that you
have to register created way books and
give your callback URL and other kind of
things it's it's not a really smooth
user experience debiting is a nightmare
it's completely asynchronous so just to
be clear there is company which have
based their business on the beginning
web books ok does not work with all
clients my snapvault for example is not
really someone receiving post requests
you know you just don't care about so
you can see the use web books with every
types of application and the manual
setup could be a problem because if you
RPI provider is not propelling you to
create way back through API you will not
be able to automatically create a new
web book that could be something
blocking for your use case and there is
also some known issues
the first one is DDoS attack so the
thing is on both side as a consumer as
an API provider you will expose
resources which are accessible by on
everyone on the consumer side it could
be used if your URL callback URL has
been cast it could be used to register
you to wear books you never want it to
subscribe to and the other case is if
the API provider is sending too much
notifications that you can undo you will
end it with a DDoS attack on the API
provides outside that the same problem
because you're also exploding exposing a
resource and we can imagine for example
especially if there is an apple I
provided to create way books
subscription which will create a new
subscription every time the notification
is received and that will obviously end
it with a DDoS attack to the second
program on the consumer side is Miss
notification so not every provider are
going to look at what's going on once
the notification has been sent some of
them will just send it and okay it's
your problem if you received it fine if
you didn't receive I don't care some
cares about and in this case they will
expect the response from you and if you
are not providing the good response then
you enter in the other issue the
duplication problem the thing is for
example if let's imagine that you
received a notification and for any
reasons you didn't respond with the
expected code but you still get the
notification Facebook for example they
will try to send the data again
immediately and then they will continue
on until on a decreasing frequency for
24 hours and at the end of the 24 hours
if your server has not come back to
normal and send the expected answer the
streaming session will just be closed
but on your side you already get the
data and so you will receive the same
data again and again and again until
your server sent the correct answer so
you will probably end all with the
duplication issues that the reason why I
quickly wrote this checklist so on the
consumer side that some perhaps a little
bit obvious but keep one could call back
to Weber
and if possible make this callback URL
as human unreadable as possible do not
reuse the traditional scheme path of
your RTI just make something which is
only understand understable by computer
check if there is an expected answer if
you're a hypervisor is expecting you to
answer with a 200 or other code for when
when in send notification and be sure
that you can end all the request number
obviously money toward the better side
this one can sounds a little bit strange
but for example github
notifications are kept to five Meg which
means that if you the notification
github has to send you is more than five
Meg it just will not be sent and you
will not be notified so that very
important and obviously and all
duplicates on the API provides outside
so it's not obviously mandatory as there
is no specification etc but implemented
on suffocation that will vary that will
be very the best solution for everyone
so looking at these issues some people
are proposed to just make labels a
little bit better and move to what we
call dynamic subscriptions on the
dynamic subscription you will find
restful web works so to be honest I
found these terms a few times and I've
never been able to find more information
about this technology so I think it's
just this as he was born something like
that
rest hooks is a search engine
implemented by the pier so if you plan
for example to propose your rpi to be
integrated with double you're going to
use rest hooks and one that is more
known is pubsubhubbub which is very nice
to say so that the one we are going to
focus on at that subtype have which you
will also find under the name pepcid or
under the name push so first of all it's
an open protocol it's based on the
publish/subscribe pattern and on topics
basically a topic is just a resource
but it's a term you will find very often
when talking about that sub so I think
it's quite important to know that it
just wrestles it's it was usually it was
originally designed to enter every
session item fit but now we can use it
for almost everything we want and you
have this github repository which is
really nice because we will find an
example in several languages so that
that pops up basically it's an ecosystem
of publishers from one side so most
popular and probably medium WordPress
and blogger but CNN is using two and so
we are both looking for real user
information side but I only find seg
news then you get head the most popular
is probably super sitter which has been
acquired by medium but Google App Engine
also purposes a hub online which works
very nice and on the other side of the
scope you will find subscribers and
probably the most well-known are Philly
and the sleep board Philly which we are
probably uses using if you were using
Google Reader a long time ago now so how
does it works to publish content from
the publishers side it starts with the
discovery step so in this step yeah it's
not the right code sorry it's like I'm
gonna no it's not the right one so
basically on the on the header of the
application are on the head of the main
request or on the main page the
publisher is going to provide two links
the first one is the self link which
basically is okay that's me that's my
resource and the second one is hub which
is the hub the publisher is going to
push data to once the publisher has done
this step subscribers will be able to
subscribe to the seed so that it will
make a post request to the hub so giving
two parameters I'm in mode subscribe
the topic I'm interesting in is this one
and this is my callback URL and
obviously if it's supported you can pass
a secret then the hub is going to make
something very important it's going to
check verify the intent of subscribers
it's going to check that you're the one
you pretend to be and that you really
want to subscribe to this dis to be sure
and it's going to send a get request on
your callback URL passing some
parameters so too we have already seen
previously not subscribe topic and the
resource I'm interesting in and the very
important thing here is the challenge
parameter so it's a random stream and
another parameter which is optional this
one litigants
if it's provided the time the session
the streaming session will be opened
alive and then from this point the
subscribers as as to answer the
verification request by providing
they're challenging the payload and only
the challenge if there is also permit
parameters it will be invalidated so
that is a step I took here as example
Facebook because officially failures
will provide a web box API in fact when
you're looking at implementation that's
the best example I found of web service
so for example here we want to create
our subscription and we have to choose
between several topics user page
permissions application one with we've
done that we check with select fields we
are interesting in and then comes a very
important part when we want to publish
so first the publisher is going to ping
the hub saying ok I'm now in that
publish that the URL of my ability
resource and then the hub will proceed
to the content distribution so it will
make a post request to your callback by
giving back to link the link harbor
which is okay basically him the hub and
then the link updated resource
as self and if you previously provided a
token it will be an authenticated
content distribution with a signature in
form of Chuang so it's not very secure
but and then the subscribers has to pull
the updated resource to retrieve the
content and for example for Facebook
when you receive the notification you
receive something like that so you are
informed of which field are stamped but
you are not informed of the content if
you are interesting in the content it's
up to you to make a get request and
retrieve it
retrieve it sorry and then that's the
third big difference with web books we
get an unsubscribe process which is very
clear so the subscribers is going to
send an on subscription request to the
hub it's basically the same as the
subscription request we've seen
previously except that the mode is
unsubscribe the hub will make will check
that the intent that's your intent to
unsubscribe and that everybody is not
trying to unsubscribe you on your behalf
by giving a hug challenge - and then you
will still make the same answer
verification request and you're done so
if we are looking back at WebEx pros and
cons okay we fixed the producer
experience and we fixed the manual setup
as now everything is doing is done
programmatically but now we get to make
another call to retrieve the data and if
we are looking back back at known issues
so obviously we fixed the DDoS attack
which is very nice thing but you will
still can you can still have miss
notification and deduplication issues
except that this time it will be the hub
which will try to send again and again
and again instead of being the two
wishes so in terms of applications to me
web books are really really nice if you
want to create a workflow because
basically in both for both technologies
it's not really the data itself which
interesting you
it's the event something has happened
and you want to react to it and so is
the definitely what you what you expect
in case of a workflow so it's time for
example a new issue is a ban I would
like to create a gr etiquette or each
time a pull request has been merged
I would like to trigger a Jenkins job so
in this case where books are just
perfect the other case we can think
which really fits where books me is IOT
because with IOT you have absolutely no
Heidi at which we can see or that I will
be refreshed you can't predict when your
sensor will detect something but you
want to react immediately when something
is received so in this case where books
are very nice pops up to be honest
except in case of fiddly and Facebook I
don't really see other use cases it's
very nice because you okay you want to
know that something happens if you don't
know it immediately but inside seconds
completely okay and perhaps you're not
even interesting by the news I mean
perhaps you will receive the
notification and don't care about about
it so will you will not retrieve it so
it's a it's a really good work so for
this one so now let's talk about push
technologies so push technology is
basically two technologies exists
WebSockets and $0.07 events both are
under w3c specification and as you can
see they are tied around the same period
even if everybody knows about WebSockets
and nobody about seven cents events as
you can guess if they both existed
because they are quite different the
main difference is that WebSockets is
bi-directional so both the server and
the client will be able to send that out
to each other whereas in seven sense
events it's unidirectional so only the
server can send data to the client the
second big difference is that WebSocket
is handling both text and binary server
sent events on the end all text looking
at protocols
web circuit has its own TCP based
protocol so basically the handshake will
be interpreted
by the server and upgrade request the
server will switch to a binary be
directional protocol which does not rely
an HTTP anymore but will which will the
server will be able this way to handle
both HCP and WebSocket requests on the
same port 70 vents on each side it's a
normal SCP you just have to add this
little header your thing there except
text event stream and it's going to work
as you can guess having a different
protocols means that there is some work
to do in configuration so that the
reason why hops are not really sound of
WebSocket and it's not to bother you
there is a good reason why so first of
all all proxy don't Endel WebSocket and
for those who who knows how to handle
what to get there is not that much more
handle them properly it's a real
nightmare to configure into maintained
and that the reason why I hubs are
reading that sound of WebSockets server
sent events on inside its HTTP so as
long as your proxy accept long live
session it's fine it's fine
looking at messages format in WebSockets
nothing is defined so it's up to you to
define what your message will look like
to define fills in it in $0.07 events a
message is every line out of text
beginning with the data prefix so it
could be a single line message it could
be two lines it can be a decent object
everything would work and the very nice
thing is that we get three of the field
we can use in service and events so the
first one is ID second one is event and
the third one is retry we're going to
talk about them just after so keep them
in mind looking at implementation I took
your example JavaScript implementation
on the customer side but it's very it
will be almost the same thing for every
languages you would like to use what
circuits and service and events with so
in WebSockets were going to create a
WebSocket object and pass the URL the
URL of the API we would like to scream
with WS or WS s prophets as parameter in
seven sent events we're going to create
an event so subject
then you can register to several
cutbacks the first one you're probably
interesting in is on open especially in
WebSockets because opening the streaming
station is made us and currently it's
prone to ERL so you probably want to be
sure that the connection is really
established before trying to send data
from the client to the server for
example then we get the on message
callback so I think this one is pretty
clear as we've seen previously as there
is nothing defined in on the WebSocket
side it's up to you to unpause it
properly on server sent events you just
have to call the data field on your
object and then you get the unhearable
fortune with which I will not talk about
because I think this one is particularly
the very nice thing here is that $0.07
events does not only allow us to listen
to messages we can also listen to
arbitrary events so if you remember this
even filled with using your thing there
by adding an event type on your message
you will be able to add specific event
business perhaps you are not interesting
by interested by every type of message
the server is going to send perhaps you
want to make different treatments that
will be very easy to make by giving a
type to your message so we are talking
about streaming so we have to see health
what will going on if the connection is
rub funny reason and unfortunately for
WebSockets nothing is included there is
nothing written in specification so it's
up to you to retrieve to end all those
case on $0.07 events we get a very nice
mechanism you can combine the first one
is the reconnection timeout so if the
connection is wrapped for any reason the
client will automatically try to
reconnect at the three second is if this
delay doesn't fit on it for any reason
you can change it by adding a retry
field that we've seen previously and
once this is done if you add the good
idea to put an ID field on your message
the client will be able to add an header
to it
request saying that's my last ID
received and the seller will be able to
resend every messages from this ID so
now talking about Brazil support which
is always the pain point
WebSockets are natively supported by
every browsers and that's probably one
of the reason why the so popular seller
sent events on its side is supported by
native by modern web browsers so
obviously not by Internet Explorer
actually it's not really a problem
because we can use polyfills so it means
that we are able to handle both a
connection with Internet Explorer but
also older versions of other browsers
and for edge it's under consideration so
on mobile multi browser support so it's
the same problem for both technologies
only opera does not support neither
WebSockets also with sentiments so
looking at performances side so this
number are coming from matches Nelson
block pass so Madison Sun is the
developer of an application called
blood watch which basically allows you
to navigate in streams of tweets in real
time and so this blog post date from
2013 but I haven't been able to find
other resources comparing both
technologies and I was looking for lots
of external resources so I'm impartial
so matches this case was to preload 500
tweets at the launch of the Office
application the only technology nose to
make real-time was what forget so is
maker first in made a first
implementation with WebSockets
and quickly it was having so many issues
opened by users because of WebSockets
that he decided to give a try to another
technology service and events so it
makes the implementation and then make
this benchmark to be sure there were no
personals gap and since volley was quite
surprised to notice that there was such
a difference between the implementation
of the same technology in several
browsers and then in quickly noticed
that
server sent events was way more useful
way more efficient in easiest case which
is normal because it was only text
messages so has often in programmation
it's not that there is a good or bad
technology it just there is a technology
for its use case if you are telling me
that you're going to develop a video
game or a chat application obviously go
home for word circuits that will be the
better choice but in most cases in our
applications we are going to interesting
to have real times only from the server
to the customer and we are probably only
sending text data so in this case you
will be able to undo data coming from
the client by traditional post request
as we already making for a lot of time
and service and events will be way more
efficient so the reason why we will
assume that our Taiyo which is a proxy
available as a SAS so it works with any
gene API basically you're opening a
streaming session and the opponent the
proxy is going to make the polling for
you at the moment for any support
polling because it's completely
transparent for the API provider that we
are working on push connectors and we
will undal everything that can goes
wrong
so your your covered on this spot you're
going to give us any parameters you have
for example the polling frequency if
you're using query parameters or HTTP
and then we will use a lot several
feature to reduce the amount of data
sent so first of all obviously we are
going to send to you server sent events
to send you data where is the dynamic
catchy so it means that if you get
customers joining decision between two
polls they don't have to wait until the
next poll they simply can retrieve data
from the last one and the most important
probably is incremental updates which
allows us to reduce the amount of data
exchange so let's imagine that on the
first poll we see the word snapshot a
big document with 30 field on the second
coil poll nothing has changed so in this
case we will not send you any
notification if on the third call only
two fields of your document has changed
we will use even patch to send you only
those two
so to see it more clearly the decent
patch is a specification which defines a
set of operation that could be applied
as JSON document so yet had we move move
etcetera and so if we imagine that it is
our initial document and that on the
third call we have seen only two field F
change you will receive this which
clearly clearly not telling you what has
change and then from this point you can
use Jesus patch library to apply those
changes to your initial document so it's
way more much more efficient okay so now
let's move to a demo so I get drawn
there which I would like to make fly on
the Bitcoin value so this is the
developer pole you can create an account
for free and we are going to call it
Bitcoin obviously I've been disconnected
so I'm going to create my new
application going to zoom a little bit
so here a second has been generated so
I'm pretty sure nobody I'm sure nobody
will see the data if is that I don't
know it doesn't have the token and I can
copy/paste any apply I would like to
stay to test their here I'm going to
keep this one which is one of our
internal API it emulates the stock
market VI and I'm going to copy paste
this command to see what it looks like
so it's simply the URL of the proxy then
the URL of the API and my token at the
end and here so I've received my first
snapshot of data and then I receive
patch for it's an event of type patch
and in the design touch format the
really nice thing there is I can go back
to my apply section so my API has been
automatically provided by the Cal
command but you can provide created
manually or you can create it by API you
can duplicate it to a I'm just going to
change the configuration change the
break frequency to one and if I go
back to the terminal so the pulling
seconds has been automatically updated
without closing and reopening the screen
okay nice so now let's see how it works
in real life in code so here it's quite
simple application just another petition
I got three library I get Evan sauce G's
in patch and I are drawn to pilot the
drone so first of all we are going to
create a drone client and I'm going to
pass options to him because I had to
pick a little bit the configurations of
the drone to be able to do that okay
once I've got that I'm going to create
an event source object by calling the
new event sauce with the UL the URL of
the API I'm interesting in so I first
copy/paste Michael Kamen I'm a real
developer I'm lazy as much as possible
okay so and now I'm going to take this
API which give me the value and Bitcoin
has been sold so here we are in USD but
we can pressure we get GBP great and the
value which interests us here is the
last value so it's the last value a
Bitcoin has been sells in British Pound
so I'm going to replace the stock market
API by this one I'm going to need a data
object and a last object and here I'm
going to create I'm going to hand my
callback so my event is no sorry the
first one I'm going to create is on the
data event so that's my first nap shop
ok
so the data object will be snapshot that
data I'm just calling my data field the
last subject will be data test and I'm
going to log so that we can have a view
of what's going on so it will be my
first batch okay okay so now I can add
another event listener to the patch even
see only what a change so this function
is going to send me patches okay so here
I'm going to create an another object
just make the code more readable how are
you sorry I'm forward something I get to
G's in pulse this one ok so G's in pause
fetches that data and here I'm going to
use the gym space library to apply the
patch to my initial document so didn't
touch that apply on the data object the
patch okay we're going to log and so
it's our batch left
and from this point we can start the
comparison so if the last value I
received at first is under the data
that's our value it means that the
Bitcoin is going to help so I'm going to
log HAP and I'm going to ask the drone
to go up at a speed of uttered five if
it's not the case it means that the
Bitcoin has gone down and I'm going to
ask the drone to go down to at a speed
of added five then I will sign my last
value now I'm going to listen to the
error event that could be interesting
you know so in the case something is
going wrong first of all I would like
the drone to lend I would like to close
my events or session and I'm going to
log Guerra okay and then I would like
the drone to stop after thirty seconds
so I'm going to say after thirty
function it's going to be almost the
same except that I'm going to say
control the slug time's up
okay fine so first of all I'm going to
check that I didn't screw up with my
good
okay so I get the first batch get my
bachelor's okay so from this point it
should be nice so let's stop the drone
so I hope the Bitcoin will not goes too
much happen up because the cells will be
her to insist
okay so we have to wait for it to be
ready
nice okay so I'm going to share my
connection with the drone just want to
check something
another one will be better
okay stop now I'm gonna I'm waiting for
okay that's fine
okay great
so first batch okay so what has gone
wrong
yes obviously options that IP works
better now scale up okay I'm just going
to check no that's a good one so you're
supposed to fly especially because
you're answering on the 10 that yep
hmm so that's funny first time it
happens yeah obviously something is
missing there don't that take us could
be useful no not in it here we are so
here we received our first batch we're
waiting for okay so up down now please
not the project
okay if you can stop buying bitcoins
okay so half an turns up and here we are
so I hope I convinced you that server
sent events is a really nice technology
if it's the case you can vote for its
support in in age and I will be and I
will thank you forever for that and I
think we got two minutes left if you get
questions if you don't have question we
can make it again no questions no one
okay do you want another two of the
drawn oh yeah one question can you just
pick a little bit louder please
yeah but you can you can use it between
two server that's absolutely not a
problem for example in Java you get
service ently at library you get also a
decent patch library same in Python so
you can definitely use it for service to
server connection yeah yeah but so for
example in the browser we have wrote a
JavaScript SDK which has a bully feel
included
so you can use it with every front
applications I'm going to make a demo
tomorrow where I'm like creating an
ionic application by using the proxy so
it's a it really work it works really
well with front application I've also
created a polymer element you if you're
using if you're making applications with
polymer it works perfectly
there is no cost really it's very very
simple to integrate you just have to use
your two libraries the first decent
patch and the server sent events
libraries all to use our SDK and it
really works like that it's really you
think I just like credit in two minutes
something like that so
okay yes the pricing so the pricing is
free from one - from zero to 1 million
messages and ten connections in parallel
then it's 10 euros per million messages
and then we got an optimization for
business customers that's it time's up
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>