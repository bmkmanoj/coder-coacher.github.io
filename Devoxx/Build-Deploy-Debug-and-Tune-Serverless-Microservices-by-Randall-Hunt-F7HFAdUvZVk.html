<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build, Deploy, Debug and Tune Serverless Microservices by Randall Hunt | Coder Coacher - Coaching Coders</title><meta content="Build, Deploy, Debug and Tune Serverless Microservices by Randall Hunt - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build, Deploy, Debug and Tune Serverless Microservices by Randall Hunt</b></h2><h5 class="post__date">2017-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/F7HFAdUvZVk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right hi everybody I'm planning to
use pretty much all 50 minutes so I'm
gonna get started right away I know that
there are a lot of really exciting talks
happening at devoxx today and if you
have already seen the serverless deep
dive a lot of what I'm going to cover is
fairly similar to that so I will not be
offended if you get up and leave right
now and go to something else that you
would like to see and then you can watch
the recording of this later if you'd
like to stay I promise I will make you
laugh even if you are finished and I'm
told that finish people don't laugh
also Belgian people apparently so I'm
American sorry about that
nothing I can do my name is Randall I am
a software engineer and Technical
Evangelist today ws I don't really know
what a Technical Evangelist does but I
do know what a software engineer does
and somehow I get paid to like write
code and like travel around the world
it's a great job strongly recommend it
we are hiring you can tweet at me at Jay
or hunt definitely do that unless you
think this presentation sucks and then
don't do that but if you think it's
awesome tweet because my boss will see
those tweets and then I'll probably get
paid more
maybe so what are we gonna cover today
today we are going to cover what
serverless is we're going to cover what
micro services are we're gonna do a very
quick vocab and service overview these
are sort of like your Legos your
building blocks for the service
applications and micro services that
you're planning to build am i speaking
too quickly
okay I just had a ton of caffeine and I
don't drink caffeine normally that jet
lag is real and I just whoo
so then we're gonna talk about
continuous integration and continuous
deployment delivery that kind of things
with serverless micro services and then
bonus section is going to be debugging
and instrumenting production micro
services and there's a demo or two in
between there for a quick kind of like
level checking who here has used eight
of us lamda great so for the purposes of
a video that was one hundred percent of
the audience everybody here is an expert
there's no reason for me to do this talk
so just gonna go alright so it seems
like some people have some general
familiarity with lamda how about other
functions to service platforms like any
any kind of functions as a service from
any cloud provider or even like a local
one like open Wisc yeah so some general
familiarity what about some of the other
services like API gateway have people
use that okay and I realize this is a
Java conference so how many people use
Python okay great I'm gonna not talk too
much about Java I might talk a little
bit so let's take a step back here and
look at the evolution of computing and
I'm sorry if you've seen these slides
before but they're really pretty and
well animated so I'm gonna use them
again first we start out we have these
physical servers and data centers low
utilization every company's building
their own data center it cost a lot of
money not the greatest in the world then
we start deploying virtual servers on
hypervisors in various data centers and
hypervisors like Zen or
or q mu or KVM or VirtualBox or virtual
VMware whatever they're called they're
great AWS partner probably gonna get
fired for that
and we get higher utilization we are
able to deploy a little bit better
things get better and then we have
virtual servers in the cloud so each
stage of this evolution provided like a
key improvement virtual virtualization
improve utilization introduced
separation from the physical Hardware
making applications more resilient and
more Hardware independent it give us
more availability
and resistance and resilience against
failure it improved our of time our
disaster recovery all that good stuff
and then we move to the cloud we start
trading our capital expenditure for
operational expenditure which allows
vaster scales of operations for peak
loads this is the elastic argument like
we start moving into this realm where
our services can can move up and down
with the curve of the demand Amazon's
pretty darn good at this we've been
doing it for a while
and we wanted to kind of like bring that
model to everybody else so that's the
way it works out but you still have to
manage a lot yourself to administer
everything from the server up so the
virtual server up so you're still
responsible for patching the OS for
Identity and Access Management and SSH
keys or whatever on those servers you
have to make sure you're controlling
that access your stuff to plan capacity
in some way and you're also kind of
dealing with availability availability
within various regions and stuff like
that so not an ideal situation but much
better than it was before
but we thought we could solve a lot of
these problems and this is where
serverless comes in aren't these
animations pretty yeah I didn't make
them these are from Tim Wagner who's
kind of our our general manager of
service Amazon Web Services so there's
there's no server that's easier to
manage than no server and the term
server list is kind of frequently
derided for being not that great because
there are servers obviously running your
code somewhere it's just that they're
not your servers they're ours and so
we're covering that idle time for you
all these responsibilities go away you
don't have to worry about provisioning
and utilization you'll have to worry
about fault tolerance and availability
or region availability and availability
zone so you don't have to worry about
scaling and you know the operations and
management side of things where you make
that argument whether or not that goes
away I've heard it on both sides I'm of
the opinion that you still have to worry
about ops to a certain degree but it's a
different kind of ops it's a different
set of things that you're building and
thinking about and I'll talk a little
bit about that later it's also more
secure so you don't have to deal with OS
level patches you don't have to deal
with SSH
into your lambda functions although you
could if you want to do don't do that
every request is authorized with
temporary ax I am an identity and access
management credentials and your
functions are typically ephemeral
short-lived meaning they don't need to
be given like this permanent access to
very you know secure resources so this
brings us to this like spectrum of
compute options that are available to us
today and even though this access is
increasing to the right just imagine
it's actually getting smaller I'm bad at
slides so the size of the deployables
we're dealing with within a virtual
machine you know that's like an
infrastructure as a service when we get
to a container that's like docker or
hyper-v or something and then we have an
application which is like a platform as
a service and we have functions as a
service on the far side where the gross
majority of the responsibility for
running that infrastructure is on the
cloud provider and the the code like the
business unit that you were trying to
execute it's the only thing that you're
responsible for is everybody bored to
tears yet should I skip to the demo okay
that was a resounding yes from the
audience everybody's falling asleep so
in a typical AWS environment this looks
like Amazon ec2 for the virtual machine
ECS for kind of the the containerization
something like elastic Beanstalk for
deploying your apps and then for
functions as a service you have lambda
and it's kind of like this best of all
worlds the size of the deployables you
note is quite small the provider the
cloud provider is responsible for the
gross majority of the management so it
changes how you deliver it it's all of
this operational complexity that you're
used to dealing with it increases your
developer productivity because you're
now focusing on a very small unit of
execution typically like a couple
hundred lines of code that's doing one
thing like most micro services are
actually composed of mini nano services
I'm not gonna start the term nano
services please don't start that term
because we already have micro services
there's no reason to go in nano services
you know you have these lambda functions
that are composing themselves into these
larger micro services and because
they're only focusing on this one sort
of execution you have
one developer who is now like hyper
productive because they're able to go in
and manipulate things without worrying
too much about downstream maintenance
and it speeds up your ability to get
stuff working and it's kind of this
virtuous cycle everything's running
everything's making your business run
faster
so that's serverless let's kind of pivot
now to talk more about micro services so
I realize how many people here would
consider themselves job developers
surprisingly for the live streaming
audience no one raised their hand it was
just completely empty nobody hears the
job developer at all so do you guys
remember back in the day before he had
Spring before he had all this like just
in time to dependency injection stuff we
basically had these giant jar files or
these giant class objects that we were
deploying and this was like the
monoliths idea and then over time I
think Java was probably the first kind
of language that started breaking things
out into micro services back when we had
soap like XML and then we kind of move
into this functions as a service realm
so if we look at this splitting
monolithic applications into micro
services 10 years ago was basically
transferring these XML blocks between
different services typically on the same
network not normally across different
businesses it was mostly within our
network we are gonna have this soap API
that we use to call stuff and there's
this very famous memo that went around
Amazon I think it was Jeff Bezos had
sent it out and it's like by Friday
every service can only communicate over
an API and if you don't do this you will
be fired something along those lines and
people think that that you'll be fired
part is a joke but that just means you
didn't work at Amazon also a joke
definitely gonna get fired for this talk
so five years ago we started moving into
this idea of JSON as our transport
medium but it wasn't just JSON right we
started enabling remote procedure calls
we Google came out with a protobuf so we
started enabling all of these like
really fast binary encoding so we could
transfer things over the network and it
basically built this distributed micro
services architecture which is what
we're looking at now and that grew in
complexity and all of these data started
flying around
and maybe when you look into the cloud
section of things these individual nodes
may not actually be lambda functions
they could be individual services
individual sets of services within your
application infrastructure and in lambda
is what's gluing them together Amanda is
kind of holding everything together and
it's the it's like it's like the force
you know anybody watch Star Wars okay
so if we think about what our standard
building blocks are like our Legos for
building our services we have API
gateway we have sqs dynamodb and I
highlight DynamoDB here but it's not
like that's the only datastore you can
use you there's a lot of like stuff out
there that you can communicate to over
lambda
if Kinesis you have SNS you have s3 and
i'll talk a little bit more about each
of these in a moment but you have all of
this business logic that you have to use
to glue your stuff together and that
business logic is essentially just
lambda functions and what will happen is
these ephemeral functions will only be
invoked when they need to be so they're
not sitting around idle all the time
like your old servers would they're only
in being invoked when some event is
triggering them this is a very powerful
concept it allows you to start thinking
about infrastructure in a completely
different paradigm and it costs nothing
to run these things when they're not
running so this is just what our our
building blocks are for our service
applications and in typically Amazon
fashion we have put our name in front of
literally literally everything so I'm
gonna read this off so we have AWS
lambda that's kind of your core
execution medium you can think about
that is like copying and pasting some
code into a function you have s3 that's
kind of like your key blob storage some
people call it a key value but it's
really just key blob and blob is like a
real thing while it's like a binary
object then you have dynamodb but you
don't just have dynamodb within your
data tier you could also have RDS you
could communicate with Postgres my
sequel oracle if you really wanted to
you do you api gateway is kind of our
means of invoking things over HTTP
we have sqs we have
SNS for our messaging and notifications
we have Kinesis for like our clickstream
data or any other kind of streaming data
that we want to ingest and perform
events or perform actions on and in step
functions does anybody use step
functions again 100% of the audience
there's like one person that raised
their hand thank you
so step functions are really really
powerful and I encourage you all to
check them out if you haven't already
because they allow you to orchestrate
complex state machines using lambda
functions and it's just a JSON document
that specifies a state machine and you
can say hey retry this every one second
or I want you to wait for manual input
on this step it's very cool stuff and
then I'm really excited if we have time
I'm going to launch into a discussion
about AWS x-ray excuse me again do not
down 20 litres of coffee right before
talking protip we're gonna have AWS
x-ray which allows you to instrument and
visualize that service map that I was
showing you earlier and then really
really cool I won't have time to talk
about it a date today but it's something
that you should research this idea of
edge computing and this is the idea that
you can have a lambda function that runs
the same in a data center the same on an
IOT device or the same at a pop location
like a point of presence like a cloud
front point of presence like in Antwerp
or Brussels or Paris it doesn't
necessarily need to be running in in AWS
region so here's kind of the common use
cases for AWS lambda you have web
applications and backends and that's
what I spend the gross majority of my
time on is working with customers to
build those but that's actually not
where most lambda functions get deployed
a huge number of data data processing
pipelines end up using lambda chat BOTS
use lambda Amazon Alexa skills they use
lambda does anybody use Alexa I mainly
use it to prank my parents but it's also
good for other things and these are all
powered by lambda functions and then on
the other side you have IT automation
which is Joe Schmoe launches a new
instance and he opens all the ports and
that instance also has the ability to
communicate with some of my other
instances
I want lambda to come in with a
configural and shut that down because
that's violating my policy of security
controls and you can do all of this very
easily with lambda functions and I see a
ton of stuff around that are you guys
ready for a demo no you want me to keep
talking I saw various shrugs and the
audience okay so I'm sure many of you
have seen this before we're gonna launch
right into it though hopefully I'm not
going to show any secret stuff let me
log out really fast because I'm not sure
I'm in the right account
I really hope the internet is fast Oh No
so this is called one-and-a-half factors
of authentication that's the subject of
my rejected PyCon talk if anybody's
interested in it so what I'm going to do
is I'm going to go into lambda and I
have created a function already
that's called where am I oops
way too much coffee and this is a very
simple function does anybody use
Foursquare
okay that was 100% of the audience I
really hope they go public one day so
Foursquare is this application that you
use to check into venues you could also
use like Facebook to check into an venue
and you're saying hey I'm here I'm gonna
write a little review about it and you
get points and the best thing about it
is if you travel around the world those
points you can get on a leaderboard and
you can beat your friends and there's no
actual value to that it just makes you
feel vastly superior for no reason at
all
which describes a lot of computer
science so I have this function and all
it does is it calls out to the
Foursquare API and it gets my current
location now I can invoke this function
either USA I'm to invoke everybody can
see that sort of right and I'll just go
then output and it says I was last at
the Radisson Blu Astrid hotel which is
not where I am right now so all I'm
gonna do is I'm just gonna check in on
Foursquare to a different place so very
quickly
DevOps Belgium 2017 and then if I invoke
it again should say okay okay DevOps
Belgium 2017 but the main reason that I
built this was actually because I travel
a lot and my mother asks a lot of
questions about where I am and I thought
it would be great to like automate those
responses no I'm sure many of you have
parents as well most humans do and I
realized we have ox who's not
necessarily human but we could say that
he or she has parents as well so what
you can do with that lambda function
that I created right here is I confront
this with an entire API so I can go to
API gateway and I can build
I don't have a ton of time so I might
move pretty quickly here so I can build
an API and I can create an endpoint here
and I'll just say create method get' and
this get method is going to invoke a
lambda function in u.s. ceased one and
that lambda function is going to be
where randall at do and then we're going
to deploy and like any real developer we
deployed a prod and this is the little
thing that I get so I can take this and
I can do like curl that it uh oops and
it works so I get my location all this
other stuff however you know my mom
she's a pretty clever lady I'm very
confident that she could master curl and
be able to get those locations and
things but my grandmother not so great
at curl like she could craft a TCP
packet from scratch right like she'd sit
there and she'd write it and then she'd
send it in the mail and I'd get it and
then I'd send it to API gateway
transcoded but as far as like getting on
the computer and typing it out she's not
into that so what we do to enable her to
get that information that same
information it's taking the same lambda
function but with another transform
another lambda function in front of it
it's gonna transform that data we can go
in and we can say hey I have this Lex
robot and this Lex robot is going to
enable somebody to Lex by the way as a
chatbot service it's gonna be it's gonna
be like where the hell are you
and it will say Randall is last at
devoxx Belgium two minutes ago which is
really interesting is like the same
lambda function I'm just putting another
lambda function in front of it to
transform it so that's kind of like our
microservices architectures we have one
m2 function that's being the glue
another lambda function that's fetching
the data is storing it in dynamo that
all that good stuff but that's not very
useful so my grandmother being on
Facebook I created a Facebook bot that
pretends to be me and then it's just
like where are you aunt
Allison Tokyo apparently that's like
Randall was there and I didn't have to
do anything to enable this right like
it's just I go in and I set up like
Twilio I set up slack I set up Facebook
and I'm not having to like write any
code or authentication stuff to get this
working I'm just like here my API keys
please work what's really really cool is
you can go further because Lex is not
just for for text it's also for voice so
I have a we have the service called
Amazon connect and it's for building
call centers virtual call centers and
it's typically used by Airlines to or
like credit card companies to make you
wait on hold forever but it can also be
used to filter calls from your family
and then respond to them if they press
certain buttons so if we look at one of
these contacts flows here have a very
simple flow and it's just like hey set
the voice we should probably make this a
different voice so that it sounds like
me there we go so well save this we'll
publish and I can invoke the same Lex
bot that I already had the same lambda
function all the same stuff I'm not
having to change anything and it'll work
so we could test this by calling
theoretically
Haidee Vox I can tell you where someone
is from their last Foursquare check-in
if you ask me where is Randall Randall
was last at devoxx Belgium 2017 four
minutes ago yeah so it works pretty well
that's about the time that I got here
judging from the excited people in the
audience and this keep in mind this is
all one lambda function that's just
going and storing some state and dynamo
running on some cron job or running on
some events like there could be a web
hook that's listening on the Foursquare
side that's going and updating the
location and you could do this from
multiple users it's not like it's
limited to just me for instance I could
track my father who is basically always
at home so that's kind of to inspire you
that you're not limited to like these
these still boring crud apps although
you can build that very easily with
lambda you can also do tons of other
stuff and if you guys are building
something really cool or if you have
questions later I can throw these little
socks at you and I'll talk about these
socks in just a second that's not a
proxy joke okay so I want to talk a
little bit about understand
understanding how you can continuously
integrate and deliver these lambda
functions and also these whole
applications like the ones that I was
just describing so continuous
integration basically covers I've
committed some patch I want it to be
pulled down I want it to be built and
then continuous delivery covers
everything after that the testing the
deployment maybe the the rollout in a
weighted way stuff like that and that
little gate there is like imagine a
human is sitting there being the final
arbiter don't do that in real life so if
you think about amazon.com the retail
site and all the various web services
that we use at amazon.com we actually
deploy like multiple times per minute
every day so we are constantly deploying
new stuff across all of our web services
and this is enabled through these kind
of pipelines so when you talk about
service applications lambda functions
are your typical unit of deployment but
most micro services are comprised of or
composed of I actually don't know which
word
supposed to use their English is really
hard they're comprised of multiple
lambda functions in also API gateways
and typically other AWS services as well
so the the typical way that you deploy
large swaths of infrastructure like that
is through cloud formation cloud
formation is a service that we have
where you specify in a yeah mol or JSON
doc hey I want this stuff please give me
this stuff and Amazon says okay
please blindly swipe your credit card
and we will give you that stuff that you
asked for it again laughing is allowed
so when you're building all this stuff
you can bring your own ID oh this is a
great thing
who here uses Emacs Wow nobody okay
watch this watch this
who here uses a vim whoo there's a
hundred percent of the audience
what about eclipse ok and IntelliJ whoa
ok IntelliJ is the like I love that
stuff I use it like every day vim is
kind of like where my head's at most of
the time but IntelliJ is pretty good so
you can bring your own IDE and Eclipse
and IntelliJ and even Visual Studio code
anybody using that yeah it's a good
editor I like it I don't know how they
made an electron apps fast because it's
JavaScript JavaScript is just terrible
honestly I think JavaScript is basically
mass psychosis at this point like it we
have like Stockholm Syndrome so that's a
rant that I can get on on another time
if you guys are interested these
photographs are making me so nervous
oh good
so you can you can bring your own IDE to
the situation and we have plugins for
most of these IDs where you can go in
and say hey start building my stuff I've
saved this I want you to run some local
tests all that good stuff in Java this
is way more developed than it is in
other languages just because you guys
are good at things whereas most other
languages are like lol I can program and
then we have whatever version control we
want we could have github we could have
code commit wait a bit bucket whatever
we can have hooks on this whenever we
submit a patch with
we want to start doing stuff and we have
building tools testing tools deploy
tools infrastructure management tools we
don't need quite as much then we have
lifecycle automation tools and code
build is kind of at the center of this
code build is what's going to take some
docker container that you have for
building your information and go and
create an artifact that you can deploy
and I'll talk a little bit about what
those artifacts could be but it also
integrates with code pipeline which is
another service I'm gonna stop seeing
Amazon in front of every service name
cuz I'm pretty sure you guys have
figured out at this point that I'm
basically a corporate shill who just
says Amazon like every five minutes yeah
I'm glad you're laughing just keep it up
so this is an example of a build spec so
a built back EML the best part about
this file by the way if you if you lend
me your ears for a moment is saying
stammel yeah Mille just say that ten
times fast see what happens sam'l die ml
Sam will not amell's camel Donny yeah
you can build all these different phases
so let's say we start with our like
let's install some prerequisite phases
then let's like lint everything let's
build in test stuff and then let's
package everything up into some sort of
artifact which is this like post Hamel
that yamo file and deploy it and that's
all we need to do to start deploying
things with code build what a deployment
packages look like we'll ignore no js'
and only talk about Python Java and real
languages so within Java you basically
post a zip or a jar you can use Gradle
you can use maven you can use whatever
you want to kind of compose these these
functions these services very easily
it's really really straightforward I'm
sure you guys have done stuff like this
before all your libraries they go and
live everything else kind of goes at the
root with whatever package name very
straightforward you can also use c-sharp
no comments on that and then we have
code pipeline and cocoa pipeline enables
is just kind of good stuff where you can
say I have my application I'm getting a
commit and then I want to
I should do it this way I have my
application I've got to commit coming in
I want to build and then I want to do
some testing I want to run like various
integration tests race unit tests then I
want to deploy to one environment do
some stuff then I have a manual improve
Allah NER where I'm saying okay I want
you oh and we can do some like
performance regression testing with runs
go and then I want to do a human has to
sign off on this and then we deployed a
prod what most of mine look like is
everything from testing and staging is
gone and it's just this section like
immediately deployed a prod I don't
recommend that in real life though if
you don't feel like setting all of this
stuff up by default we have a service
called code star which will
automatically provision all this stuff
for you
it's very pretty it uses a lot of s3
buckets though and I keep hitting my s3
bucket limit and I keep having to call
my boss and be like hey can you
fast-track this ticket so that I can get
more s3 buckets for a demo today or you
can you'll notice that this is not my
account this is Chris month account and
I'll talk a little bit about him in just
a second so the server list application
model is kind of what you use to package
all this stuff and aside from having a
really cute mascot it's also a super
useful paradigm for thinking about
serverless applications that's why it's
called the serverless application model
and it's essentially a transform on
cloud formation and it allows you to
very quickly specify complex
applications with just a little bit of
yema and this is what it looks like so I
have a in API and this is a function and
I want it to pull that function from
here I wanted to use nodejs because I
hate myself
and then I have this IM policy that
it'll use which is dynamodb read-only
access and it's gonna go and basically
read everything coming in and I'll take
get method I'll take post whatever I
just want it to work and then I have a
table that I'm creating which is just a
simple dynamodb table so these these
sam'l files can basically be parsed into
this kind of cool infrastructure set up
here
this is generated by the cloud formation
console it's very pretty and you can add
little annotations to put
everything right on top of each other to
make it like a video game for the people
who are trying to spend your stuff up
and if you want to test all the same
stuff locally it's really easy to take
an existing Sam file and just run it
locally because we have this tool called
Sam local which will build a bunch of
docker containers and stuff that'll run
everything for you
this is Visual Studio code which I am
following more and more in love with the
more I use it which is not something I
thought I would say about a Microsoft
product but it is really good so very
easy we can add something on here I
don't have a ton of time so I'm going to
skip the rest of it but you can imagine
how this works like we're basically
deploying good stuff very few of those
slides were mine they're actually from
somebody called Chris Muntz who also
works at AWS and he's kind of the the
head honcho for service there and what
he's gonna do later today in this exact
room at 4:40 is he's going to explain
things in vastly more detail and vastly
better than what I have done and he will
do less insane demos there are a ton of
community frameworks that you can use to
do all of this stuff so you're not
limited to Sam I think Sam is like a
really good way of deploying things but
there are other ways so if you write
Python there's Zappa
there's Challis if you write anything
else there's serverless
there's Apex there all kinds of
different community frameworks and
there's actually a github page called
awesome - serverless that kind of
collects all of this stuff and you can
go look and see what best suits your
needs
ok jumping around for a moment here
everybody caught up feeling good this is
my favorite part so we have this really
cool service called x-ray and what x-ray
it does is it allows you to dive deep on
exactly what is happening in your code
at any point in time exactly what is
happening across multiple services at
any point in time so have any of you
guys dealt with distributed tracing
before in the audience
no one raising it just do you think a
lot of people raise their hand and what
kind of tools were available to you at
the time did you have to build something
yourself mostly grep okay so SSH cluster
SSH graph across all my log files and
then typically people would probably use
like log stash and elastic search for
that but grep works too
Oh Java developers I forgot you guys
have been around for a while I see I
don't remember those days because I was
really busy playing runescape and that
was my introduction to Java was hacking
runescape which is a Java video game
anybody wants to talk about that I can
talk about I think the statute of
limitations on the Jagex lawsuit has
like finally run out so I can finally
talk about how to hacker inscape that
was my first exposure to Java somebody
tweeted about that so I should stop
talking so let's talk about X ray what X
ray allows you to do is I can just add a
very simple library into my application
and I can start tracing every request to
every AWS SDK I can start tracing all of
the requests to various endpoints within
my microservices and there's a company
called sky scanner that is based in
London does anybody use sky scanner to
look for flights there's 100% of the
audience you guys are doing great sky
scanner keep it up and what you can do
is you can actually see what your code
is doing across data at any point in
time and I'll show you kind of how that
works and we have SDK is available for
Java net Python go no js' and you can
add all kinds of filters that will
capture various data for kind of
querying and figuring out what went
wrong so let's say you have a user
that's reporting a 500 error right and
that 500 error you know you can see it
in your logs but the logs are not enough
to determine what exactly is going wrong
so you dive deep into the
instrumentation you go and you can look
up by that user's name when they when
they invoke that call
you can't race using that the
information they've submitted the
payload that's emitted all the way
through through your various
micro-services through your load
balancers through everything and find
what actually went wrong where and this
is enabled through a daemon that runs on
your instances or on the lambda function
that you're invoking if it's running on
a lambda function full disclosure it
does take a very modest amount of your
memory so let's say you have 128 mega
though this is Java let's say you have a
512 megabyte function that you've
deployed and you have x-ray active
tracing turned on on that function it
will take like 2% of that memory so
something to keep in mind performance
wise I have not I I have deployed this
to like multiple production services
again not in Java though and I have not
experienced any performance impact at
all so I have been told that there is a
performance impact but I have yet to
like see it so keep that in mind and
what it does this daemon is it runs it
receives information about what's
happening over UDP offers it then sends
it off to the x-ray service so we have
these kind of core concepts with an
x-ray a trace is this end end kind of
ability to see where everything is
running and it's got a trace ID we have
segments and segments are portions of
the trace ID they can either be defined
by you or they can be defined by the
services that you're invoking we have
sub segments and those are typically
defined by you within your code you're
saying okay now I'm you know setting a
cache key or I'm removing a cache key or
I'm in validating some state annotations
are kind of data that you can put into
traces that allow you to filter on them
later
they're like things that you can be
indexed on whereas metadata is just you
know useful business information but you
can't actually query or search by it
then we have errors and errors are sort
of this this stack trace that's kind of
normalized across all languages and
across all kind of invocations of
services so you can dive deep on the
individual stack traces this is what a
service graph looks like
I forget what orange means but red is an
air
I think orange is like a 400 and red is
like a 500 and then purple is like a
throttled purple is hey back off for a
second so we have this kind of front-end
ec2 instance that's calling out to
another ec2 instance that's calling out
to SNS that's calling out to DynamoDB
and you can see we're getting throttle a
little bit here so the first thing that
comes to mind is oh hey maybe I should
up my capacity in my dynamodb and since
it's not really a problem anymore now
that we have auto scaling on DynamoDB
but something to keep in mind and then
we can look at individual traces we can
dive deep and we can say okay these are
the traces that I have it's 4.9 seconds
ago I got a 409 and I'm not sure what
went wrong so let me dive deep on that
409 that work I have the same slide
twice I guess sorry and I can also query
I can say okay I want to only look at
services like DynamoDB or I only want to
look at services like lambda and you
know I can see okay I'm getting a couple
404 otherwise I'm getting you know good
stuff I can continue to dive deep I can
add filters so this URL this remote
signup URL is the one that I want to
look at I have this latency and then I
can kind of look at one of these
individual traces and it says okay this
took 13 seconds there was some error
somewhere and when I look at this error
this is what I see the conditional
request failed so that means if I can
parse the JavaScript here which I'm
sorry
I wouldn't make anybody do that but
we'll do it for the purposes of this
presentation essentially I was trying to
set something that was already there and
so my condition preventing that from
happening was invalid so that's
everything that I have I can show you
x-ray if you want or we can move on to
QA this is me Randall you can treat me
any question you want you can email me
I'll put my email now but definitely
rate this session and give it like all
five stars
or or like one star and leave like a
comment what a corporate shill I'd be
okay with that so this is my email you
can email me and I will give you an AWS
credit code if you want that offer is
valid for 24 hours it's not a ton of
credit but if you tell me like I want to
build something and I don't want to pay
for it I will happily give you that
stuff and we have exactly ten minutes
left so I will answer questions anybody
who asks a question I will throw you a
pair of these really cute socks so bring
it there everybody's raising their hand
right now so for those of you on the
live stream err or watching this later
I'm really sorry I just won't be able to
take your questions but tweet at me any
questions yes which language is the best
for lambda functions definitely Python
but everyone else will disagree with me
on that the reason I say Python is
because Python is the best language
period and I realize I just made a ton
of enemies I'm sorry but honestly you
can run any language pretty easily
you're not limited with c-sharp or Java
or anything like that it's really
straightforward to like build a
deployment package and go and test
things the gross majority of the things
that I write are written in Python but
I've also got a bunch of Java functions
deployed I'm a millennial so I take a
lot of selfies and I have a Java
function that calls out to recognition
and renders all my selfies so I can show
you really fast and the question was
which language is best in case of Java
what you deploy so I will show you if we
look back at this slide with Java what
you deploy is a zip file or a jar file
but you're really the same thing with
very mild differences and you can deploy
things with just maven so you can do
like maven
and it'll go out to lamda it'll talk to
the API it'll do all the stuffs that you
needed to do we have all of that stuff
in our documentation it's really easy to
pull down or you can deploy the the the
stuff through just like uploading it or
just through the command line like
however you want you can deploy it and
there's a question over here
the vendor lock-in so the question is
what about vendor lock-in and
so the question is with regards to
vendor lock-in how can I export all of
my stuff to to move to like another
cloud provider and move to like open
with score something local with regard
to lambda functions you you you are
mildly limited in that way but it's
still keep in mind just code it's just
like I have this event that I'm getting
and then I'm parsing this event and then
I'm doing something but with regard to
the API gateway we actually support
swagger and swagger is like this open
API specification that you can move
around to wherever you wanted you could
even run it locally it'll auto generate
Doc's it'll auto generate a mobile sdk
for you so on the API gateway side I
don't really see any vendor lock-in at
all but I do see some like key
differentiating factors in API gateway
that are simply not available elsewhere
like built-in credential management
built-in throttling all that good stuff
and if you find somewhere else that has
that I'd be happy to hear about it then
what is it what is that dot xxx mean
does I mean like I'm super out of time
or Oh half a minute oh there we go I did
not never seen that format before so
with that in mind
yeah there's vendor lock-in if you're
really worried about vendor lock-in
you're worrying about the wrong thing
and obviously I work creatively best so
I would say that but you're gonna have
some form of vendor lock-in no matter
what you do and the question is is that
vendor lock-in preventing you from
getting your business done like what is
your fear with Interlaken you have
vendor lock-in with the tools that you
choose if you choose Eclipse like you
have mild vendor lock-in with like the
the style checking that you use if you
choose like a big table you have meldman
to lock in with like moving your data
around the different places you're gonna
have some form of that no matter what
tools you go with and it's up to you to
kind of decide if this amount of vendor
lock-in is tolerable for your
application or if it's not and I'm happy
to help you with that decision because
the decision is always try to use more
aid of best services again corporate
shell you had a question yes sir
how long does a specific instance that's
so the question is yeah so if you guys
were in the server list deep dive
yesterday you would have heard about the
the static initializers so in Java for
instance you have a static initializer
you'd create your database pool there or
your connection pool there and it would
reuse it across multiple invitations we
make no guarantees about when a
container is warmer or when that's that
state will be reused so you have to
design around the fact that it could be
created anew every time but it in
production will not be like I'll go
ahead and say in 99% of cases it's not
going to be new every time like
subsequent invitations will reuse an
existing container but we don't really
provide any insight into when that's
happening or when that's not happening
so yes behind you say I'm trying to go
in order
for a function
yes
faster so we've recently made some
pretty significant improvements in terms
of like the cold start time for Java the
cold start time for every other language
is negligible in my opinion even if
you're setting up some like complex
connections and stuff the the pricing is
is the same like across each you know
invocation it's not like it changes day
to day or anything we have done you know
price reductions over the years and you
can expect that we will continue that
trend of price reductions as we can able
to pass on savings to customers one
thing I will say is we just launched a
pricing API so you can now query the API
and see what all of the different things
are if you want to subscribe to like
price change notifications there's an
SMS topic that you can subscribe to and
I'm gonna start throwing these out
because I forgot that I was going to
give these to people who asked a
question first
you didn't and then it was you and then
do you want socks yeah oh I'm sorry
they don't fly very well they're not
aerodynamic three
temporarily did you want socks okay did
I miss anybody that I asked a question
you did did you already ask a question
oh sorry I don't are you okay again the
caffeine and then there was a question
up in the top there yes I will actually
say checkout Chrisman's talk for more
information on that I only have two
minutes left but that's Chris Mons over
there you can either talk to him after
this or you can shoot me an email and
I'll answer I'm gonna see if I can do
this or not
nope not even close my baseball career
is over
any other questions I have like one
minute left
quick question yeah
integrating the way the versioning
system
subversion CVS perforce yeah if you're
still using CVS please consider moving
off of it when I worked at SpaceX we
actually still use subversion so I feel
your pain but there's a there's I would
say it is the future and you can easily
easily create like SVN subversion for
instance has web hooks so you could have
a web hook trigger something you could
even invoke locally on the SVN server
you could do the same on CBS with
perforce there are also web hooks the
only time you're using / forces if you
work at Google right so you know they
probably have their own thing yeah and
you can also use s3 as a source for code
pipeline and Chris will talk more about
that all right thank you guys so much
for coming to my talk remember you
should definitely tweet and give me like
all fives or or just you know punch me
in the face thanks guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>