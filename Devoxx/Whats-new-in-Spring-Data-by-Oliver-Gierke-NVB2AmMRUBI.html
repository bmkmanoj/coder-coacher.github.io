<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What's new in Spring Data? by Oliver Gierke | Coder Coacher - Coaching Coders</title><meta content="What's new in Spring Data? by Oliver Gierke - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>What's new in Spring Data? by Oliver Gierke</b></h2><h5 class="post__date">2015-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NVB2AmMRUBI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">uh yeah welcome again to the session on
what's new in spring data my name is
Oliver gyuki I work for a company called
pivotal who is heard of pivotal before
ok don't need to explain anything I'm
leading the spring data projects there
which means basically that everything
data related that's not inside the core
spring spring framework itself is
landing on my desk at one point or
another and I have to deal with it and
then work with the team of four other
engineers on building a few data access
abstractions and libraries for you and
what I wanted to want to do in the next
60 minutes is basically take you through
a whirlwind tour around the latest
releases I we usually do like the
consider the last two releases because
this talk has happened to be an annual
one at our company conference spring one
and we usually do to two major releases
a year roughly and just want to give you
an overview about what's new in them so
what is spring data in the first place
who's using spring data already ok so
why are you here then just just a yeah
funny em anyway let's ring data just for
the ones that are not familiar and maybe
the people that are watching the
recording later on we have the data
access space roughly divided into like
relational and non-relational space
where I think it's still remarkable that
a group of Technology defines itself by
what it's not right it basically means
everything that's not relational is in
that other group so there's a on the
different abstraction levels you have
jdbc on the relational side so with the
spring framework that's why I put the
asterisk there you already get a bit
more than just jdbc support much
improved jdbc support I'd argue with
jdbc template which takes a lot of the
pain out of jdbc that that's in there
and on top of that that's basically
still like you do the mappings on your
own there's object relational mapping
with the JPA specification right also
already in the spring framework there's
a lot of additional support for things
that jpa itself doesn't really define
two to be possible like we do entity
scanning for you so that you don't have
to list the entities in your
persistence.xml and provide quite a lot
of other convenience things around jpa
infrastructure set up basically in the
non-relational world you as a Java
developer you usually get a lot of Java
drivers from the from a variety of
vendors basically I just listed a few
here couchbase Cassandra solar Mongo
what have you and a lot of others but
the drivers usually end up and that
seems to be changing in the in the in
the recent days end up providing you in
a JDBC like API so you access the data
store you get some data structure back
for for example in MongoDB you get DB
objects back and they don't provide any
means to to map your your data onto
objects I think the Cassandra driver has
has some stuff in there already so
that's slightly changing but that's been
at least the landscape that we that
we've entered a couple of years ago and
what spring data basically does is it
puts a bit of glue on top of it on top
of the non-relational AP is exactly what
I just mentioned like the object to
document mapping object to graph mapping
or have you and then like a thin layer
on top of that to provide your
repositories API that makes it easy to
work with the individual stores right
that's something we add on on top of jpa
which is what most of the users actually
have started with because it's so just
kind of a no-brainer to use it and
benefit from the from the abstractions
there but we don't have to implement the
object relational mapping for you
because that's done by the jpa provider
what does the the spring data landscape
look like so we have a couple of
foundational modules like the spring
data core or spring at the comments as
it's called and there's a new player on
the field here the key value module
which you probably might not have seen
yet I show you a bit of that in the in a
second but they act as a foundational
modules
for others to like the actual store
implementations like the next ones right
so the store modules basically use
spring data Commons or the key value
module to to implement the functionality
that basically allows us to easily
change or add new functionality in the
core module which then automatically
bubbles up into into the other systems
and during the talk today I'm actually
going to show you a few changes that we
did to the core that like support for
Java 8 types that then nicely make it
into into the store modules right on the
on the horizontal scale basically the
modules you see here all modules that
are maintained by the spring data team
so that's that's the the modules that we
are actively working on they are
basically topped by a very special
module called spring that arrest which
builds on top of the repositories
abstraction and allows you to easily
expose HTTP or rest resources to the web
considering your domain model right so
we're not like taking a database and
inverting or circulating the tables by
90 degrees and then dump them into
adjacent but we actually inspect your
domain model take some more derive some
some knowledge that we that we can
actually buy the fact that you exposed
some repositories and turn that into
HTTP resources so that's the stuff that
we basically do um like what is it like
eight modules there should be there's a
few like to build modules in there but
that's not listed here but we also have
a lot of community modules in the
meantime so basically companies or
people in projects that realize they we
like the spring data stuff that we saw
maybe with jpa but we now have to use
elastic search maybe not have to we want
to and we build some yes bring that
elastic search we need a Cassandra
module to be front or fronting the the
store and yeah basically allowing you or
giving you the same abstractions and
programming model for other stores dead
that space is growing there's like even
there's a comp our data store called
aerospike which is sort of Redis like
and they are just building a new module
and the couch base guys are busy doing a
tu lado version of of their one and new
4j guys had folded all released recently
like a major revamp of it so there's
very that's a very active community
around around the these modules they all
use the comments module of course and
they also they all can be used by the
rest or using the rest the rest module
so what does the data module look like
usually Jesus what's going on let me
just quickly repair that I was expecting
Apple to turn it off for me anyway so
what does this bring data module look
like the very foundation basically is an
object mapping module or subsystem
basically where needed as I said for JP
a that's already done for us we add a
templates API on top of that if you're
familiar with the spring framework at
least then you probably know
jdbctemplate JMS template and what have
you so you probably agree that JMS
template and jdbctemplate are buried or
JMS and jdbc are very different
technologies so it's not like a unifying
API but the templates both do exception
translation and resource management and
that's what they basically do in all
these areas right so we provide some
general programming model which is
consistent in different technologies so
you get that for mongodb for radius for
new what have you not with jpa because
you have the entity manager there and on
top of that we actually add the
repositories programming model which is
like probably the most direct
programming model that your interact
with if it comes to the to the
functionality here the templates
basically do the object mapping for you
so you don't really necessarily need to
work with with the API directly except
you might be using our mapping
annotations but that's that's basically
it so that's having that said we have of
course deep spring container integration
with it but and that's what I want to
actually want that slide to communicate
the
functionality is not really depending on
spring as a container it relies on
spring as some as a library of course
but that that doesn't mean it's it's
it's really couple to it which allows us
to also provide CDI extensions for most
of the modules basically so that even if
you're running in a Java EE 6 web server
application server with no Springs
whatsoever you can just use the or take
the disparate data libraries dump them
into your classpath and use them with it
which is actually done by quite a few
people and yeah that's that's basically
it all right so that's just like the the
for the introduction basically I wanted
to the code that i'm going to show you
is in the first repo i have the links in
the in the collected in the in the very
end actually there's also a spring data
examples repo that has more exhaustive
temple examples that you can check out
and which i really encourage you to do
because sometimes we even get good ideas
by people playing with the with the
examples and then just reporting or or
asking for new features here so just to
give you a rough introduction it's
really supposed to be short here what
you do with spring data is you create an
an entity class i'm using lombok here
just to replace an arbitrary amount of
getters and setters with an arbitrary
amount of annotations and assuming you
have your jpa domain type you create an
interface and let that extend the base
interface so that the spring container
can basically find it by component
scanning and then you can declare
so-called curry methods which i'm doing
here and we or spring data will go ahead
and unless you declare anything more
special it will try to derive a query
from that from that method name right so
it will in this case i'm using jpa so it
will go ahead and derive the query
select what is it see from customer c
where c dot email equals ? one in this
case right you have special key words
here that you can that you can use with
the
with the property expressions that you
have in the in the in the in the current
method and you can of course or you can
also go ahead and like you get api for
pagination through your results set
which in case of jpa is quite important
because jpa is list based in every query
like you if you execute the query get
back a result a result list which in
case you're retrieving like 100,000
customers then you might want to order
some memory right you see this like
already a bit of support for for java 8
types so we we support them out of the
box with still jdk six compatible but if
you are in Java 8 we recognize the
optional optional type here to not
return null if we don't find anyone with
that particular email return an optional
air what is it empty instead I always
mix up to the methods between the guava
one in the JDK one but anyway that's
basically it you just bootstrap that
thing in this case i'm using a boot app
and inject actually inject the
repository and then call the method here
i'm calling a safe method and then just
try to obtain it again right to find one
method for those of you don't know is
coming from the crowd repository here
from cut repository that which is the
the method that i fix or the type that
I've extended here alright so so much
for that probably not too much news for
the people that already work with it
just what I've explained as a summary
here what's new in spring data the
Gosling and the Fowler release you could
ask what's Gosling is halle I mean I
know Gosling I know Fowler but what
that's what's that got to do with with
spring data at all and we organize our
releases in so-called release trains as
you've seen we have to release quite a
lot of modules which actually develop
because they are like built by different
teams right that evolved at a very
different pace so especially the
community modules which are of course
usually led by people that are not for
which them the open-source develop
it is not a full-time job they are
moving at a much slower pace than maybe
the JPA and mongodb modules that we work
on a day-to-day basis so we came up with
this concept called release train
actually we didn't really come up with
it the Eclipse the Eclipse team is doing
has doing that I've been doing it for
years actually but we basically say okay
let's group the releases of all these
modules like you know what is it like
two or three months cadence and
basically have milestones release
candidates and whatnot editor at a
predefined cadence and give them names
because the the the modules evolving at
a different pace actually also means
that like in the Gosling release train
the spring that a comments version is
that what is 111 the spring data jpa
version is 19 the MongoDB version is 18
right and that confuses people because
they seem to assume or of course as soon
not really of course but reasonably
assume that you might want to see okay
if I use sprint later jpa 19 I need
spring to the comments 19 but that's not
the case by the very nature of the
modules evolving independently so the
the release train name is basically give
us a like a handle way say okay you want
to you want to use the Gosling release
train so you get all these modules in
all these versions right so we had a
spring data Dykstra release training in
2014 I was on spring 302 and evans
released train that bump the required
spring version on 40 Fowler was on 402
and guzzling in September 2015 moved to
spring the spring for one as a baseline
you might ask and that's what I got
asked this week for quite a quite often
actually is why don't we like the
current spring version is for to write
for to 24 23 to be next week and we get
asked okay why are we like on on the
current version we've Rio we basically
got the feedback that especially the
people that are using the JPA module are
often working in quite conservative
environments that can't really operate
to a new spring version
at regularly so we the the guideline
that we have for ourselves is that we
always stay one spring generation behind
the the current one and stay with with
four dot one in this case or we just
upgrade it to 41 which basically means
we require the latest spring for one
version to run that thing on you of
course and that's the case for Dykstra
Evans Fowler and guzzling can run all of
these modules on the most recent spring
version right it's basically just the
the minimum required version here that
actually leads to a question because
it's always good to get to get feedback
a bit is that like for for you if you
imagine you were we were releasing the
hopper release train today on 42 would
that be a problem like Hulu could as of
today upgrade to hapa debts on spring
for to move you quite a lot who have you
could not that's probably even okay
quite a few hands even more so requiring
Java 8 who of you is like could work
could run this code on Java can run this
code on java ate already so it who is
not able to do that quite a few and by
the end of q4 q4 who things who you
cannot be on Java 8 by next year still
quite a few okay because that we're
currently planning like as you probably
heard from from Jurgen if you've been to
his talk there's a spring five plan for
for the end of next year based on Java 8
and we're planning to do a spring data
to load Oh basically or dot next like a
major revision of it and we plan to
upgrade to Java 8 as well which will
probably mean that the the version
before whatever that is the I release
train then will be maintained for for
quite a quite a while based on spring
for three I guess in that then all right
that was helpful so what happened in the
Gosling release train is as I said that
we upgraded the spring framework
dependency we usually take the release
trains or the opportunity with the
release trains to
great or all our dependencies to the
latest versions right so in this case
guava 18 I mentioned go otherwise
explicitly because it's usually causing
headaches because it just breaks like
API so very often Jackson 26 hasn't been
a to great experience either to be
honest there's a few shaky things in 26
but we align to that mostly because
there's a this kind of spring oil
platform project coming out a in a after
boot 13 is released and that's referring
to Jackson 2006 we in terms of or or M
providers in the jpa space we still
support hype the hibernate three
generation who of you is still on the
hibernate three generation no one I'm
sorry yeah but I guess we might want to
cut this for the upcoming releases said
that be still means you can use the
current version with hibernate 3 and it
probably even means that you can use the
next version with hibernate three we
just might drop or move or build two to
hibernate for which which then basically
just runs the test against that but
anyway MongoDB three dodo support has
been quite a significant one in in the
plat for the in the Fowler release
already we've extended that and with
Gosling by quite a bit so if you're
running a feeder or server or want to
use the MongoDB to our driver three
double then that's support with with
Fowler and Gosling one thing that i want
to show you and basically not spend too
much time talking about in the slides is
the release train bomb has anyone ever
used the spring data released train bomb
yeah do you even know what we mean by
referring to a bomb um it's something
that that we actually got from the or I
spoke about the release trains and the
the diversion problematic basically
right and spring boot is basically
solving that by providing you starter
pumps and like predefined predefined
versions but not everyone is really
lucky enough to be able to use boot
already
so the spring framework and the spring
data team and I think spring security
does that by now and spring batch and
spring integration they ship so-called
bomb poems which not only sounds funny
but it's quite useful they are basically
listing all of the modules included in
the spring framework and define the
dependency versions for that using a
dependency management section and in
maven terms and by using the in this
case the spring later released train
bomb you can then go ahead and just
define the dependencies to spring data
modules without even stating any
versions and you can easily switch
between the release trains without
having to bother with the versions so if
you say we have the I just externalize
that here spring data version to set to
Fowler as r2 and you see here you get
the spring data MongoDB one dot 72 like
this thing and the hmong spring that the
comments 1 dot 10 dot right we don't
really have to know about this you don't
really have to bother if you now change
these that that version number to the
Gosling one right like this to Gosling
release you see it automatically
upgrades to spring that among go to be
18 and 32 the comments 1 11 so you can
basically refer to the very same notion
that we use when we talk about the
spring later released rain which really
makes it easy to to avoid the like
version conflicts and and stuff like
that because we actually take take the
liberty to sometimes change things or
change ap is and spring data Commons
because we know that they are they are
only implemented with the with the other
store modules and take the freedom to
move a bit quicker here because it's not
directly affecting you or the user code
but that still requires us to take this
or to use the modules and in matching
versions there alright so what have we
changed in or one of the most
significant things that we've introduced
in spring data Commons is the
enhance support for Java 8 and that
actually I can show you an example of
that we've always not always but have
had support for optionals for quite a
while so if you if you know about the
crowd repository like basically the
repository interface that gives you like
crud operations like find one save and
what have you it traditionally returned
a null object if it couldn't find a an
entity with a particular ID right so if
that doesn't exist it just gives you a
null by default incorrect repository in
spring that if our we we added the
support for returning optional here so
you can just like declare the method
with the weather with it with optional
as return type and that will that will
give you an optional empty if if if no
no customer with that ID exists that of
course also works with curries that
would return just one result and that's
probably like it's probably more people
with it with that with a particular last
name but you can you can just use that
to basically wrap the null value or
replace the null value we also have
support for default methods which is
kind of handy if you want to let's say
you have that method here's by last name
and you also want to be able to just
like hand in the customer into the
method then you can just like have a
default method that's forwarding the
call to the to the actual curry method
that's also kind of handy if you have a
curry method that takes three parameters
that I would like in this case all come
from the customer object you can then
have an additional one that just takes
the customer and basically unfold the
customer into the enter the method human
just convenience basically the more
interesting thing actually is or the
most interesting thing thing about the
advanced JDK 8 support is the support
for streams as return types a naive
implementation could just like go ahead
and like with jpa execute the query take
the results take the list and then call
stream on it right
that might I mean what's a view that
additional call but it's not really
really like a sophisticated solution to
the problem because like the stream
streaming approach in the first place
indicates that you rather want to
consume the elements as a stream right
so you want to read while you're
handling them and we actually
implemented the support for that kind of
method signature for JPA and Mongo
already we're mongos actually could
simpler because you get basically get a
cursor from the database and then you
can just wrap the cursor into a stream
and like why you're iterating over the
stream like pull data from the database
with jpa it's a bit more tricky because
as I said JP Hayes list based so we fall
back we detect basically detect the jpa
persistence provider that you're using
and then if you're using let's say
hibernate we don't use the jpa api is
under the covers but hibernate specific
API to actually traverse the result and
actually you have a stream string the
data from the from the database on the
client that basically looks something
like this a stream is something you have
to close that's why you have to
basically work with it in a in a in a
try with resources clause and that's
basically that's basically it here is it
is it the MongoDB variant let me check
that I know it's the jpa one yeah so in
the MongoDB variant like the difference
basically is we're not reading
everything upfront creating the objects
and then hand it out to the client but
just return the stream and while the
client is iterating over it we read the
data for mongodb we convert the data
while the iteration happens so that's
that's just in there all right like a
big warning sign for the JPA the
scenario here that streaming the data
doesn't necessarily mean you can now get
rid of paging because you're still like
populating the the entity manager or the
persistence context and it will if you
read too much data will basically like
read all the data into into memory it's
just like okay
be a bit more efficient to just be able
to work on data already while the other
stuff is getting repped right the final
Java 8 specific edition here is the
support for complete able complete of
the complete able future Jesus that's
basically built on on the support that
we have with that spring framework
introduced for complete able future
which basically asynchronously invokes
the method and just just expect that
expects the code that's returning the
final result to create a complete able
future so there's a bit of bit of
special handling in there but it allows
you to let me go there again to write
code something like this so you execute
the the read and basically define with
using a closure or a lambda in this case
what is supposed to happen out with the
result right so it's a synchronously
executing the the curry here on the on
the on the cold level basically you saw
that it is add a sink and that's
basically the query execution is
happening on on another threat here in
this case and then you get the complete
able future a return type which is kind
of nice to handle like what's supposed
to happen if things fail what's supposed
to happen with the result and you could
just like basically chain the the
asynchronous invocations units that's
kind of neat all right um so much for
the for the Java 8 support there's also
a bit of additional support for the Jays
off 310 types especially in jp-a case I
think that has changed in the recent
times to not the JPA providers basically
didn't really support jdk local daytime
local date and what have you in the out
of the box right because the there's no
no renew jpa spec so far and but if the
the non timezone daytime types can be
safely converted into legacy date
objects which the JPA toward one
providers can of course properly handle
and we're using a the JPA two dot one
attribute converter interface to
basically register the additional
attribute converters so that you in your
domain code can use local datetime local
date directly and then yeah just persist
them or make them persist able by
hibernate out of the box there's also
support for that for the 310 backport
types so in case you're writing code
that's still on Java six or seven and
but wants to use the the jdk 7 types
already so that once you move to Java 8
you only have to switch package names
the we have attribute converters for the
O's as well alright um something that
was kind of kind of cumbersome was the
the problem of trying to extend your
base repositories so assume you just
have a repository there's nothing in
here really that that's to be shown but
the crowd repository that we are
extending in the JPA world is
implemented by a thing called simple JP
a repository right and that for example
implements defined one method so it's
doing a bit of like in this case like
just like locking checks and hint checks
and then just execute the query fine but
some users or we had always had support
for customizing that right like that
functionality by simply providing an
extension of a simple JP a repository in
the JP a case or like for all the other
stores as well and then having some
means to hook that implementation class
into the spring data infrastructure to
let that use your implementation class
and that's always been kind of a bit of
a like a hassle because you had to
implement a factory and the fact we beam
to let that work in spring and then the
one calling the other and it's been
quite a bit of boilerplate that we that
we required you to write and we actually
got or was we're able to dump that down
quite a bit so you see here
what I'm doing is I want to customize
the find one method logging is probably
not the best example here because you
could just use the use a o P or
something to actually call our ad log
into that but let's say I want you want
to do something special to to define one
call here you just create a class that's
extending is the the original base class
of your store and then is mimicking and
that's an important bit here is
basically mimicking the the superclass
constructor so it has to be a
constructor that just called super with
DJ p entity information entitymanager
for jpa of course for mongodb we'll just
go extend simple MongoDB repository and
do the very same thing and what you can
then do is just in d where is it in the
jpa configuration like in this case I'm
again using spring boot but explicitly
activating spring data with a custom
repository base class right so that will
basically trigger spring data to take or
to create instances of custom based
repository and not simple JP a
repository to back your your class now
it's it's a bit weird to demo because it
it just looks kind of neat now it and if
you if you've never been exposed to that
and never seen the mess that it was
before then it's kind of ok what's that
well if you if you just compare the the
the reference documentation from what
you had to do before and what you have
to do now and people that really did
need to do that were quite happy about
that that's basically the summary here
that's it here ok um web projections ah
there is a or their spin some code in
the spring the rest module that I show
you in a bit that had or had some API
where you could create easily create
projections onto objects what does that
mean like in the spring the rest well we
we take your domain object and create
some HTTP resources for it like /
customers
customers left one and they by default
see realize most of the properties as
like into Jason fields right and that's
the nested objects and what have you and
sometimes you don't want to expose all
of the fields of them but only some or
sometimes you want to add a few fields
with calculated data or what have you
and the means that we provided in spring
addressed originally is that we have API
to just create an interface we love
interfaces with swing data you probably
should know that by now you create an
interface let's say you have your where
is the user class the user class look
something like that it has a username it
has a password it has an ID and we want
to create a view on the data that
consists only of the user name right so
you can go ahead and declare an
interface and say get user name in this
case I I'm not really like letting deed
if I remove the value annotation it
would just forward the call to the
target later on but what i'm doing here
is I inspect the target take the user
name property and call to string on
right so the question is how do i create
an instance of that of that thing here
like how do i create the projection and
there's a projection factory interface
that we prove that we provided in spring
at arrest in the first place but now
move that to spring at the comments
because it's kind of kind of helpful
even if you're if you're like just
writing rest api is with the spring MVC
you sometimes have the need to like
create these projections and it seems
generally useful so we just added it
here so you can basically say okay
create me a projection here's the
projection type and that's the source
object right so that's kind of helpful
in this in in case of the combination
with another thing that we did to spring
data Commons we extended the page in the
face right the the page interface is
basically the result of a pagination
request and it it's got a map it's got a
map
method that takes a spring converter and
the converter spring converter interface
is a kind of a neat thing on Java 8
because it's a single it just has a
single method so that it can be used
with a with a lambda so what this piece
of code here is is basically saying give
me all the users in this case like
strictly saying page 1 by a page size of
10 and then for every user in their map
this thing to a projection right to the
user name projection and then give me
the content of that all right so it's
it's basically creating in this case
proxies for the interface that will
route all the calls to its accessor
methods to the back in class or in this
case here evaluate the add value that's
the springville add value annotation and
and basically expose that so if we hand
that list to Jackson it will just see
realize it as as a plain as a plane java
object and will and will return where we
turn the the just the user names in this
case right so that's the the the reading
side of things sort of another thing
that we realize is that oftentimes like
four forms you need to create a spring
spring bean base or just a javabean when
you bind request values to right and
it's kind of a pain in the ass to you
have create all the properties and then
have getters and setters and just like
basically it's it's a dto basically
right to buy perform too and I know you
can use lombok to get rid of that but we
wondered okay doesn't it like why would
I actually need to provide these setters
and these fields because on the
controller side of things I just want to
express which data I want to get from a
web request and I can do that using an
interface providing access and methods
right so i can say use a form get
username i want to read the username
property from the request i want to read
the password the repeated password and
what have you and what we did is we edit
basically edit support to spring MVC
that
allows you to just take the interface
here in this case take a parameter of
that interface type and because it's an
interface and not like actually a class
we hook into spring MVC to then use the
proxy the proxy projection factory in
this case to create a map and bind the
request parameters to a map which then
will allow you to to access them via the
these methods here right and that's
quite neatly combining belief with some
validation right interfaces have a
default method in here and call the
methods and do like in this case a multi
multi field validation so check whether
that the passwords match or not the end
even call like a in this case a spring
being here where am i calling that
method right so I just like I manually
invoke invoke the validation here
because I need to pass some some spring
beam into into the validation but that's
I think it's very very very like what is
it requirement oriented so I want to I
want to use that or pull that data out
of the request and I want to validate it
and then I just create my domain object
eventually and persist that all right so
we're projections got that okay so yeah
I said they put the projections can be
backed by an actual object or just a map
that would just like naturally be nested
and stuff that's that's in here if we
ran in there in the web space a very
recent addition has been the Croix de
sel web support who of you has been
exposed to Kroy dsl before so who knows
what crazy sauce oh that's more than the
last time I've been here that's good
Kroy dsl is basically an improved
version over the criteria API it also
creates a metamodel from your domain
classes and allows you to write let me
check whether I have I don't have any
test cases here I guess
it allows you to write expressions like
in this case let me go here Q user
chatter work user that's basically the
the metamodel at the metamodel type that
I've generated using an apt generator in
during the build but it allows you to
say user door first name dot contains
full and that's like assignable to a
boolean type wake and then say contains
and yada yada yada so you could go ahead
and say use a last name what have you
you see that's that's kind of fluent
it's kind of easy to combine and it's
very easy to execute by just in our case
if you know the spring data repositories
they can extend the curry dsl predicate
executor welcome to the world of spring
class names to take a predicate and then
and then basically execute that that
predicate definition that you've just
just applied so something we've been
wondering quite a long is whether it it
might be possible to just bring that to
the web right so basically take request
parameters something like in this case
user dot address or address dot zip code
and then bind that to something and
actually let me run this thing for you
and actually provide you a predefined
predicate and that's actually what
you've seen in the user controller
already yay yeah that's already a tomcat
running there's not there probably is
somewhere here I just ran one when I
tested two demos there we go anyway I
just show you the APS that's fine the
there's the the MVC integration
basically is allowing you to take a
square dsl predicate that defines ok i
want to to bind any any parameters that
could be applied to the user basically
and provide a predicate for that and the
question is how do you bind an
expression like in this case address the
zip code right is it like the default
binding in this case
is using an equals predicate right so
when you provide address zip code
something like this address the zip code
equals 4711 we will just create a
predicate for that that just reflects
exactly that right so and especially for
string parameters that's usually not the
thing that you naturally expect because
like if you have a web form or something
and you type in some like you want to
search by last name or something you
usually rather expect it contains
mapping and there is a there's an
interface called and what is it cariddi
SL binder customizer here which we
implement in the in using the default
method here that you can provide or
impure just implement with your with
your repository actually and then
customize the binding so what I'm here
expressing here is that all parameters
that are string parameters or of type
string I want to take the first
parameter and I want to bind it using
that lambda here which is a path dot
contains it contains ignore case right
so whenever I just type like lowercase
new then it would like for City find new
york and stuff like that you can also
exclude properties from binding you can
define bindings dot bind and then use
the root thing that you just got here
root dot last name should be bound to
like first and yada yada yada right so
you can define explicit bindings for
explicit properties that's fine and you
could just say ok for all the ones that
I didn't define an explicit binding for
I don't want to bind it all that's
something that we actually recommend if
you're if you're not providing any in
the first place so you customize the
binding using that callback interface
that uses lambdas heavily and then just
get the predicate injected into the
controller method run this and all you
need to do is is basically execute that
right that's kind of kind of helpful
that is available to spring MVC out of
the box it's also shipped with spring
that arrests so when's your
or your repository already implements a
courteous ll predicates executor you can
just like query the data using using
that mechanism and filter there the
collection resources all right in the
spring data space I probably just skip
this demo just because of the lack of
time we have added support for ad hoc
entity graphs if you're familiar with
with jpa then JP a tutor won't introduce
the the notion of so-called fetch graphs
that define which parts of the domain
tree you have or the domain object riu
have you wanna load it's a bit
cumbersome to use and there's been some
some feedback to improve that that's why
I linked the ticket from the jpa to the
two bug tracker and we provided some of
you provide some workaround for that on
the on the repository level so that you
basically just whitelist the properties
you wanna load and then and get that get
that loaded spider jpa and its current
form should be ready for for hibernate
five usage so there are examples that
run on hibernate five we work with the
with the hibernate guys to during their
better face to eliminate some some
issues that that occurred there but that
just works and as I already mentioned
the way we edit the the attribute
converses and attribute converters for
the JDK datetime types improved support
for stored procedures anyone executing
stored procedures through spring data
repositories alright fine splendid a
MongoDB there has been that kind of
functionality here that the spring
security integration into MongoDB has
been in springdale jpa for quite a while
we basically took that forward to the to
the MongoDB module which basically means
that in this in a manually defined
spring data MongoDB curry you can now
use spell expressions and within those
spell expressions use security
expressions basically well not security
expressions only but basically any kind
of expression or you can actually an SPI
for that which Springs
the users to register its security
functions for the usage with spring data
query expressions right there's an spi
what is it evaluation context provider
that you can just implement and even if
you want to make some function some code
execution available to your mongo DB
queries you can just write your own one
and then a register a spell function or
something that you can evaluate in your
in your in your career definition in
this case what what it's basically doing
is it just says okay whenever this this
method is executed by an admin I just
want to want to return what is it like
the the dep dep or i want to use the
want to look up the current user or when
it's in when it's an admin i just want
to check that the that the ID has exists
at all right which basically means gimme
all alright so let's just see the
security declaration here that just
works in in manual define define crazy
of course the other thing which i
basically already mentioned is the JDK 8
support for for mongodb which basically
means stream AP is in that case it's a
bit it's a it's a bit less problematic
than with the JPA case because we get a
get a cursor anyway from MongoDB and the
cursor or has already all the data ready
that we want to read and then we can
just like where is that sample that's
actually kind of neat because it shows
you the difference between the two
execution models let me just run that so
you see in in one case it's a it's
reading the data and it's where is it
before convert on after load so you see
the the the events on after load on
after convert are triggered first right
so we load the data we convert the data
into objects and then we hand it back to
print it print it out so that's
basically the client then getting the
already converted data
with the streaming approach it's
interleaf so we hand back the stream and
while the client iterates over the data
we load the data and convert it to
objects basically that's let's see
that's the thing that you get out of
this like calling find all with the list
and for itching over it versus using a
string it's basically the difference
okay can that um you can hand in
JavaScript functions into the MongoDB so
either executed on the fly or just like
store it into MongoDB and execute that
as in here free double driver
compatibility I've already mentioned and
there's also a support for Gil Gil Jason
basically so a dedicated format for for
expressing geospatial objects like
points or shapes or what have you in
both persisting and using them to query
data like bounded box queries and stuff
like that that's that's that's supported
here all right spring that arrest as I
said strainer the rest is basically
taking your repositories executing or
yeah creating HTTP resources for it for
each of the repositories and then yeah
allowing just HTTP clients to consume
them something that we've been asked for
quite a while is or what that we had is
the support for you could of course go
ahead and create etags for your for your
HTTP resources which means you basically
create a a check some of the state of
your object and put that as an e-tag
header into your into your into the
responses and that allows the client to
basically asked for two things it could
ask for give me the resource only if
it's different than the thing I already
got right so with an if non-match header
basically say give me the the customer
if it's not matching that checksum
anymore or you can say own put or update
that customer but only if it still
matters right to avoid that you override
the
that has changed on the back end and and
that's what we work what we're now doing
or the checksum approach has the
drawback that you actually have the load
the object from the database and then
have to turn it into some JSON and then
basically hash the representation and
return that hash as the e-tag with
optimistic locking in place like using
an ad version attribute in your domain
object we can basically skip the latter
part and just check the the actual
version and use the version at the as
the e-tag right and that's what that's
what we're doing here so just the pop of
our let me go here so what spring that
arrest is now doing where is it that's
the customer the customer has a version
attribute that's that's something you
should that's important to notice here
it also has a local or last modified
date which is that some something spring
data specific so it gets the
modification date set on every
persistence operation and in the test
what I'm doing is I get the first
customer and I do a get request on it
and then make sure an e-tag is set like
that's the diversion here and the last
modified header and in this test case we
then say okay only give me the customer
if it does not match the e-tag that
we've just got and that should yield a
not modified not modified response in
this case right because we didn't change
it so far and the the head are still
present the very same thing here is that
we could ask for I'll give me the
customer only if it's not been modified
since since that very day here alrighty
so that's the that's the eTech header
stuff and conditional requests he'll
browser and metadata let me check what
we actually if there's a tomcat running
I should be able to see what what I have
running there
yay it's not running but it said it was
running how does that work I could be
the I think i was using MongoDB wasn't
it that could be just my bloody mongodb
server anyway let's try to run this one
so what we what we are what we're
talking about here is that when we
expose rest resources from our
repositories we actually like the the
springdale arrest look something like
this localhost 8080 that's just the
website let me just try that again yes
sorry for that /ap I so is that readable
in the back I hope so so I have a in
this case that the example is basically
a giant CSV file of all the starbucks
shops in Northern America alongside
their geo geo spatial data and I've
created a justice store class here that
has an address with the very location
and I have a repository that has this
single method here that's saying find by
address location near and it takes a
reference location and distance so
basically give me all the shops in like
50 kilometers distance from that very
point and that's basically everything
that you need to really curry a MongoDB
for Gail data which is kind of fun I
think and that's exposed as an API using
spring day to rest so you just put
spring there the rest on the classpath
and it will allow you to just like
create the stores it's doing pagination
as you can see here with the first link
at the next link and what have you and
it's it's also so you get basically in
API HTTP API to manipulate stores and
add them and it's also exposing metadata
about the stores like because we we have
to we have to analyze the the domain
object anyway for like relations to
other objects and whatnot so you can go
ahead and say I want in that profile
resource we basically store in from
because that's what the profile link
relation is all about but schema plus
Jason and we expose adjacent schema
right so some metadata about the actual
structure of the object and what we've
added in spring that a Gosling is that
there's a thing called the hell browser
which is just a general JavaScript
application that you can point to any
rest endpoint that supports hell and it
will put some nice kind of UI on top of
the the rest service to explore it right
so you see there's this stores link
coming back so it shows up here because
it basically understands hell and makes
you use that so you can follow that link
and get like all the stores back that
are in here and stuff so you get get a
bit of nice UI and the interesting bit
is that or we've customized the hell
browser to use the metadata to not just
give you a let me just go here again
follow that and say stores like take
that take the self link here and if I do
a non get request you usually get
whenever you want to post something or
put something you just get a Jason like
an input field where you have to put the
Jason that you want to send to the
server with the we've customized the
hell browser that for a non get requests
for the stores resource we actually
inspect this JSON schema and then give
you a like a like a form that just takes
the schema turns it into an HTML form
and then basically allows you to submit
post requests and stuff like for your
even maybe complex domain object then
you just get that out of the box by
putting where is it that thing on the
classpath that's basically the hell
browser and consumer perform that's it
all right so I actually that's the
summary of what I've what I've just told
there is a spring data key value module
I'd probably just skip the demo we've
extracted some some functionality into a
new key value module that all of the
the modules that basically abstract key
value stores like reddish or coming up a
hazel cast and whatnot are going to use
to build repositories on top of key
value stores let's skip the demo here it
basically assumes that all of the data
that you have in here is or can be
stored in some map implementation by
default and for testing purposes we just
provided one an implementation that's
using a concurrent hash map and that
does still does croix derivation using
the spring expression language which
means that you can still query your data
and lick like you've used you're used to
with with jpa or what none so what's
coming in the in the next release is
we're still working on something called
curry augmentation with which basically
what allow you to implement things like
soft elites in repositories or basically
sit as secure your entire repository
with with with say okay you want to want
to have a CLS or something on on your
repositories we're working with the
spring security team there Christoph
like my colleague is working on on Redis
object mapping basically and there will
also be included yourself or upgrade
like a major upgrade in the indic radius
all ib plus some major revamp sandy in
the store implementations all right what
I'd like you to do is or if you want to
play with the samples free free to do so
it's always helpful to get like tickets
with suggestions and stuff and I ran
across a funny thing and on the
internets recently which is like the
most credible Tech Authority you can
imagine named jessica alba she was she
was in a YouTube interview and she was
asked are you a tech person and that's
what she answered I do not know how to
code but I can put in a jira ticket and
I thought if she can do that you
probably can too right so because I
meant just mentioning that because
there's a lot of people that come to me
and Sam that doesn't work right like
what I like I expected and they say did
you fight a ticket and said know why I
didn't really go ahead to so five
tickets and provide feedback you want to
check out the video
does that even work you would tech
person or you tech proficient I do not
know how to code ok but I can put in a
jira ticket leave it I light there
that's kind of cool alright so the
resources for for all of the stuff I've
shown you we are quite new not really
new on guitar so if you want to get in
touch with us feel free to just get
there there's the links behind behind
all of that and then just go there and
i'll be around until I for today only I
have to fly out by tomorrow morning but
if you have question just come by and
yeah that's it thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>