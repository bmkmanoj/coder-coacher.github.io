<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Binge-streaming your Web API by Guillaume Laforge and Audrey Neveu | Coder Coacher - Coaching Coders</title><meta content="Binge-streaming your Web API by Guillaume Laforge and Audrey Neveu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Binge-streaming your Web API by Guillaume Laforge and Audrey Neveu</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VT4xsDCeDxE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">evening everyone thanks for having us
here so I'm given a false i'm working
for google in the Google cloud platform
team and here is already booked thanks
for you working for trim that at @ao and
we are going to be speaking about Web
API and how to make those web api is
more scalable and more real-time yeah
all right and who's who's been up sorry
more I'm a bit tired who is being
streaming like Netflix for example are
there some netflix that kill them
because I I thought about a another joke
to make like the binge you know the
potato nevermind okay so two parts in
this presentation the first presentation
is going to be introducing you to Google
Cloud endpoints on the Google cloud
platform which is how i'm going to
develop and deploy and monitor and
manage my web api and then we'll add
another layer they're the real time
layer thanks to the stream data i/o
technology so Google Cloud endpoints
there was a first version of endpoints
years ago but there's a new version
called the steel called Cloud endpoints
but the first version was really just
about at Google App Engine and using
Java and Python but what's interesting
with this new version of Google Cloud
endpoints is that you can use any long
way Jenny framework any tech stack or
even any cloud although I'm going I'm
going to use Google cloud platform you
could also use Google Cloud endpoints to
manage an existing API on-prem in
another cloud etc so here I'm going to
use Cloud endpoints and the
implementation of my API is going to be
running inside App Engine flex there are
two flavors of App Engine and i'm going
to show you the code a little bit later
on but it's a rat pack application
anyone
about the Rat Pack framework or library
yeah a few few hands and i'm using
groovy because i were sometimes my
groovy hats because you have to yeah I
have to meet ya ok so in terms of
compute options on the cloud platform
there are mainly three options so
there's app engine which is here so two
fibers done that and flexed on that
that's the usual Java and Python version
but flex it's more or less you can even
create your own docker containers and so
if you want to use any tech any
framework any language you you can
easily do that what's nice with App
Engine is that in terms of scaling it
scales for you so you don't have you
really just focus on your code you focus
on your application you don't have to
focus on the DevOps aspects of scaling
so it's really a pretty much free but
you've got the knobs that you can tweak
if you want to customize the the scaling
the other option is container engine so
it's based on Coburn eighties there was
a great talk earlier University about
that where you basically cluster
containers whether it's doctor or other
technologies rocket etc and the last one
that's compute engine where you have
full control so you've got your VMs you
can customize your VMs even at the OS
level so it's up to you but for this
presentation I'm going to focus on using
App Engine instead so API management a
quick definition of API management taken
from you know if you type API management
on google search you're going to see or
something like this so API management
that's really the process of publishing
documenting overseeing api's in a secure
and scalable environment so those points
are interesting and basically Cloud
endpoints is Google's own solution for
API management
and if you're developing and publishing
and scaling an API on google cloud
endpoint and the the cloud
infrastructure it's actually the very
same architecture which serves I mean
all the VAP is that you know from google
so lately I don't know Google Maps or
any other API that you might have been
using it's really using the same
underlying architecture what's
interesting with this new version of
Cloud endpoints is the fact that it's
using open API specs of its formerly
known as swagger perhaps whose family on
with swagger yeah great and so often
people still speak that swagger but the
new name is an open API spec under the
Linux initiative which is standardizing
the squatter fonts so here I'm going to
show an API built with REST API using
JSON over HTTP but it works as well with
grp see what's interesting with swagger
or IP open API specs so you usually you
tend to work with it's not mandatory but
you usually work that way in a contract
first approach so you design the
contract and then different stakeholders
so perhaps those who are designing the
contract of the API it may be different
from those who are actually implementing
the API and you are able to base all
your discussions team collaboration etc
on this contract often in the Java world
you would use code generation
annotations and sing like that to
generate a contract after the fact but
here the good practice would be to use a
contract first approach what's also
interesting with the fact of basing your
API is on a name on an API definition
format is that since it's already a
standard which is quite well known and
used by many develop
is that it's great for tooling so you've
got one particular standard and format
which has been used by tools to do
things like generating client kids so
API is too well walk let's say programs
to call your API server skeleton if you
want to implement an empty API then you
fill in the gaps to add the business
logic but you can also generate marks or
stubs create some playground where you
can interact with the API that's the
swagger UI is a good example of that and
also generate documentation sorry in
terms of API management there are three
key important aspects regardless of how
you're going to deploy or develop as a
developer API if it's for public API an
internal API etc three key aspects
security so you want to authenticate
your users so n points provides
different hooks for authentication like
the Google authentication or JSON web
tokens and other authentication
mechanisms what you're going to be
interested in as well as monitoring you
want to see ok who called my API how
many calls did I get on that particular
method and point etc and gather some key
metrics and potentially set up some
alerts so if you see ok they are quite a
bunch of errors being reported for when
users are calling the consumers are
calling my API and the last aspect the
scalability which is brought I would say
by the where you actually deploy your
API and here I'm going to deploy that on
the Google club but you can with Cloud
endpoints deploy elsewhere as well in
terms of speed in particular yeah that's
the architecture but yeah I'm going to
explain that here so you've got a
customer consumers calling your API but
they are actually rooted
through the ESP the extensible so this
proxy so it's a container that runs
along your API and if you're in an
environment like on App Engine for
example where automatically the auto
scaling might spin off additional
versions of not versions but instances
of your API then you're going to have a
proxy / instance so the the proxy is
always as close as possible to the code
of your API so there's basically no
latency because otherwise sometimes when
you use a third-party API management
solution you have to go I mean go
through the proxy and then go back to
the app or you might have a big central
proxy that delegates to tons of
different AP is so here you actually
have one small lightweight proxy for
your API and / let a instance of your
API so very low latency this proxies
based on engine X it will actually be
open source so it's very fairly thin and
the latency aspect is pretty important
so let's have a look at the demo so here
we are at devoxx and deadlox provides an
API so we were inspired by this API and
we use the content of the API for our
demo so it's an API that's going to
allow you to look up the schedule the
speakers the talks etc and for that some
of our lives it's certainly a bit small
upwards to have to be too big now can
find the middle ground ok mashallah so
this is just the build scripts it's not
very interesting but here I'm using rat
pack so it's a nice tool kit for
developing
synchronous apps not just as soon Cronus
but I synchronous apps it works pretty
well for that use case you define
handlers for the different paths of your
API are so for example I've got a an API
/ talk napi prefix will get method or
perhaps I should show you actually first
the swagger file or you can see the path
more easily so i define the contract of
my API so I've got / import to import
the dump of the available talks you've
got API to get the list of all the talks
available you can have a look at the
details of one particular talk you can
vote for a talk as well as we shall see
and you can also see the the schedule
per day and so this is a swagger
definition so you see the different
paths you see for example let's have a
look let's say nor or this one the
import I am in input I consume some JSON
content because i exported the the
content of the API as JSON files I'm
consuming the this payload and in return
I'm returning some kind of result which
is here and there as well depending on
the K and the case if it works I get a
status code to Android if it doesn't
work I get a 400 status card and this is
yeah basically what the this water file
looks like so I've cut it the
application there but it doesn't really
matter the technology I've used you can
use whichever you want then because i'm
using App Engine flex i can define my
own custom docker container so it's
based on OpenJDK 8 that's a requirement
for red pack which is based on JDK 8
and as a bill to distribution of my
application and then my entry point that
the the startup script basically for
from my app and here I'm going to
increase the font size as well ok and
then I've deployed that on the command
line and then I can call my API so it's
not very beautiful i'm going to use a
little tool i don't know if you know
about it it's called JQ and it's gonna
format things nicely so that's the least
of all the talks okay i can show you
like all the talks just on monday and
you'll see yeah there's one there right
there you can see one particular talk
which is where's my curse or it's there
so here i can see a talk and I can also
vote for a top with a post request so
let's say I'm going to vote give a
positive vote on that one and I'm going
to see that there's an additional
positive vote right here and just one
last minute to show you what it looks
like in the in the console on the Google
cloud platform consoles I'm going to
increase the font size as well so this
is my app engine application I've got
just one instance because there's not
much traffic there but there's a new tab
here for the endpoints so this is my API
some graphs and I can also see did I
click I think so i can see some
additional details so i can share the
API through the API catalog and it
should be showing up here so is the
traffic the errors i get the total
latency you can see the various methods
which have been called the various
endpoints which have been called on your
api and I could scale this API because
it's scaling well Google cloud platform
but in order to make things more
real-time there are some additional
benefits to using stream that I 0 which
allows you to scale an API quite nicely
so now this is Audrey Stern
so now that we've got those shiny new IP
is we'd like to consume then in Paris
mobile application or web application so
i decide to cut it mine which I've made
with polymer which is a component
oriented framework so it looks like this
as you can see I'm a very very good CSS
developer actually perhaps I should have
been attending the other talk on flex to
it so this occasion is very fine the
only problem is at the moment if I want
to have the last number of reactions on
a talk I have to hit the refresh button
that's not very cool that's not what use
are expecting from us because they
expect to have real time is our
experience if you have a look at
successful apps at the moment they are
completely based on real time some of
them are completely in the experience is
entirely based on real-time dead the
case for example of uber I mean when you
say in your driver arriving and so I
take it as example Twitter and what's up
but records i have mentioned ways of
slack or google drive so really it's
something user expect from us they don't
want to read the refresh button anymore
so talking about solutions for real-time
application usually pulling his mansion
i guess a lot of you knows pulling I
don't really see you yeah love okay so I
bet you will probably not very happy
Guillaume if I'm I mean three thousand
five hundred percent start pulling happy
I yeah because currently my API is just
using in memory one instance on an
in-memory structure so if there's a new
instance coming up I won't have the same
enemy scale although I have a platform
that scale that is
and it will have a big ghost on the old
going traffic because polling is making
a request waiting for the answer making
the same request waiting for the answer
and so on so forth so the thing is you
will probably make a lot of useless
calls you really try perhaps empty
responses we retrieve the same response
a few times and obviously how are we
going to deal with connection lust
because when we are talking about
swimming we have to take care of what's
happened if the connection is dropped
for any reason so pulling and long
polling is not the solution obviously we
can make web sockets that works pretty
fine it's bi-directional it supports
binary it means that it's a little bit
of engineering for our use case because
the only request we are going to make
from the client to the server can be
easily handled by a post request to
classic one and well we are not going to
send binary I don't think so so what if
I'm asking you to reconfigure your proxy
what because the funny thing with web
socket is that it as is own protocol tcp
based protocol which does not rely on
HTTP anymore which means that you have
to reconfigure your proxy and load
balancer and usually it's quite tricky
to make probably so it's definitely not
solution for our use case the solutions
we are going to keep is service entrance
I don't know if a lot of you knows about
service Indians yeah it's attending
maltose oil you're cheating if you want
to know more deeply about servicing
events I'm metals in action tomorrow to
see the difference between WebSocket
centers and several sentiments so
service intervals basically allows to
start a streaming connection between the
server and the client so that the server
can push that are out there burns to the
client it only on Delta X but for our
use case it's absolutely perfect and the
good thing is it completely relies on
HTTPS you don't
to make any changes nice but I'm pretty
sure you don't want to change your cut
why would I yeah you're right because
it's not your business real time so it's
also from working on the back end okay
great take care of the flow so that's
the reason why we've created stream data
data you so Stern Doroteo is a proxy
available in SAS mode which completely
relies on service and events so
basically we are going to make the
pulling for you we are going to deal
with empty responses and all that kind
of stuff and connection lost and we are
read a few features to make it still
better and more efficient so for example
where did the dynamic catchy which means
that if the applications became very
popular and some persons are joining the
sessions that don't have to wait until
the next pole to retrieve data they can
just have it from the kashi and we are
reading criminal updates with the help
of ginseng patch so it means that let's
imagine that on the first part we press
we retrieve some data and on the second
pull request nothing has changed we will
not push you any other there's no sense
but I found the third pull request only
a few changes a few field of change we
will use season patch so Jason patch
defines a set of perfection which can be
applied to JSON document so we get for
example replace move delete the guy
stuff so if we imagine that this is the
staff shot we received on the first goal
and that's only two fields have changed
on the third cove you will retrieve this
instead of the whole document again and
then you can simply use a GN patch
library to apply dispatch to your
document and so not reloaded it again so
you significantly reduce the amount of
that I exchanged between the server and
the client so now let's see it works
so basically to start a streaming
session I just need to go to the proxy
well it's them a little bit perhaps so
much and i'm going to create a new app
let's call it demo for example so once
my application is created token has been
generated which is related to my
application and i can copy paste the API
I want to stream there to taste it so
here I'm going to keep this API which is
one of ours it simulates a stock up an
API so i can copy paste the curcumin
there to see what it looks like in the
terminal i'm going to make it hope
that's not that ok so here i received my
first snapshot of data it's steven
called data and then i received a second
snapshot so once this is done i can go
back to the my api sections which would
be there and then i can change appalling
frequency so let's say for example that
i would like to to pull this API every
second because its stock values so it
has sense to political seconds and
although if you get hcp errors or query
parameters obviously you can add them
there and if I'm going back on the
terminal I can see that the update
frequency has been updated the playing
frequency has been updating without
closing and reopening the street which
is pretty cool so fine let's see how it
looks like in the curb so that's the
application so you didn't mention it but
quite important in snot to avert a pie
not linked to it just our own and I met
a few tests on the first one as you can
see so if I click there at the moment
it's making in a jack request to load
the list of thought for Tuesday's
and then I can go on the talk and it's
the same it's all it's completely bind
on AJAX request and if I'm voting there
for example so to request Ahmed 14 volt
and want to update the contents so
that's not really good especially
because if you at the same amount we're
looking at the same of the list of dogs
you will not have this tablet so we're
going to see how we can turn it into a
stream DPI so here I've created a stream
data at i/o component which I will
release on open source after the box
just time for me to make a few
documentation with and so this component
relies on an hour javascript is DK which
you can use in any front end
applications and it's available on NPM
and here is my top datura subject so
here I got few CSS well I've done I've
done my best I know it's not that great
but I've done my best and a few HTML
component I'm not granting the details
here my paper I can beat antivert and
there you can see my list of requests so
the request which is called when I vote
is this one Tom detects request so I'm
just going to delete it and replaced it
with my string that other day or
component and worst yeah I know I know
and as you can see so i am giving the
token which has been given to me by the
portal I'm giving the URL I'm giving the
api's the best so the pass is separated
from the URL so that the streaming
session is able to end all path changes
if for example I change I don't want to
see talks on Monday anymore but Tuesday
it can update and I can handle both
subject and arrays in this component so
you just have to press it it there and
an is active component to close the
streaming session if you
giving the page and then I will have to
unlearn to add to this component on
snapshot and on patch and so we are
going to delete the useless code this
one too and we are going to add our
under diameter which will give us the
first snapshot of data so here I'm just
calling it's an event which is fired so
I'm going snapshot that detailed data
and I'm retrieving my snapshot and make
few treatment like I saying gay icon etc
and then I can simply add an under
endler so here it's quite ugly but it's
not my fault fair to say polymer in this
first version is making dirty checking
which means that it will not look in the
object properties to see changes it will
only look at the reference and so it
will not be able you know to deal with
the changes so that the reason why we
have to make this district oh I have
pasted on snap shot two times that's not
what I was looking for okay I don't
haven't that anymore that interesting
what if I'm doing that ok so I'm going
to see if I can just pick it from there
yeah it's on patch so here it is so
basically we are just saving the values
I singing singing and empty values and
then reassigned the videos again that's
quite oddly but that will be fixed in
version 2 that's the good news and so if
we are going back there and I think we
can so here I received my first snapshot
for just worrying there that i received
a patch event and
my flock has been updated and so that's
it for the demo we got still one minute
left forget questions thanks a lot for
our attention first who dares asking one
question at this very late time of the
day this very first intense devoxx day
you know it's the limit last minute
between beers and there's no recession
of the rules I'm not sure that's time
for this well Rogers we have been
cleaners if what I don't know but I
don't know you but I get stickers pretty
cool stickers like this home so go to
the feel free to come and ask us go to
the Google booth get a boost I mean
you're cheating cold okay thank you very
much thanks a lot</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>