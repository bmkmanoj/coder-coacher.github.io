<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The end of polling : why and how to transform a REST API into a Data Streaming API? by Audrey Neveu | Coder Coacher - Coaching Coders</title><meta content="The end of polling : why and how to transform a REST API into a Data Streaming API? by Audrey Neveu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The end of polling : why and how to transform a REST API into a Data Streaming API? by Audrey Neveu</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NDDp7BiSad4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you we're gonna make it
hello everyone sorry for the little
delay we got some network issues so
thanks for coming we are going to see
together why and how you should consider
transforming your basic REST API into a
data streaming API so quickly to
introduce myself my name is Andre I'm a
developer adventurous at stream data at
i/o and I'm also the co-leader inference
of devoxx for kids I bet a lot of you
have heard about devoxx for kids if you
haven't heard about coming we will talk
about it it's a great initiative to
teach kids programming so modern times
for the last few years Internet has been
more and more consumed on mobile devices
finally exciting desktop conceptions two
years ago so we know applications that
we develop have to be mobile ready even
businesses want you to bring your own
device movement the problem is the
market application is not completely
full so it's became more and more rather
too hard to for new applications to
acquire user and even more to retain
them so we really need to make our users
addict and we know that to keep our
usual interests alive animation is the
key that the reason why I'm using gif
instead of button points even if I know
you are all completely made of bad
points sorry but do you know why
actually it came from evolution but when
I say evolutions I means older than this
this this guy here has learned a very
important thing we still know if it
moves it can be two things food or
danger so in but in both case it might
worse worrying a little bit about and if
it doesn't move it's dead no interest
your brain just move to something else
sorry kitty so considering user
interface it's pretty fine we know how
to animate our URL we had css3
every mobile application framework get
animated components even material motion
as a dedicated part on animation it's
quite interesting to read and one of the
reason why they recommend to animate our
UI is hiding from the user what's going
on behind the scenes because yes the
problem is when it comes to animator
what data so usually it begins with a
lovely refresh button which is not the
best way to start a relationship with
our user because the user needs to
interact as less as possible and the
problem with the refresh button is that
usually it came with the lot of screen
of the Dead and if this screen stays for
too long your user will probably felt
upset perhaps leaving the applications
and perhaps never come back so we really
need to stop using refresh button
refresh button this evil forget about it
so in fact how you need is turning your
static VI into a stream of real-time
data because real-time is user
experience is what we expect from
applications now if you take a look at
the successful successful applications
on the market a lot of them are using
real-time experience some of them I'm
completely build upon it so I take care
of the example ways and Twitter and
what's up but I could say I mention ways
of slack or Google Drive it's already
present in our day to day life and it's
already what you are expecting so now
talking about solutions for real-time
applications when we are talking about
real time usually three versions are
mentioned the first one is pulling and
non pulling who knows a bad pulling yeah
the second one is WebSockets who knows
bad WebSockets a lot of you - and the
third one is service sentiments who
knows about service sentiments yes a few
people which is great we will talk about
it so pulling is this making a request
waiting for the answer
making the same requests waiting for the
answer and so on and so forth
it works yeah for sure but he will
probably make a lot of useless calls you
will with trav empty response you will
retrieve the same data a few times so
okay you can make long polling and block
the connection and feel something new
happen on server but still how are you
going to deal if the connection is
dropped are you going to retrieve data
you have been missing so polling is not
solution neither reason pulling it's
much more like a hack and we should
forget about it too but true solutions
exist they are called push technologies
both are under w3c specifications and
there are under the appeared around the
same period so as I guess if bus exists
it's because there are little bit
difference we are going to see why so
probably the main differences the main
difference between web sockets and some
sense events is that web socket is
bi-directional so it allows both the
client and the server to send data to
each other whereas sever sent events is
unidirectional so basically Service and
Stephens open a channel where the data
can be pushed from the server to the
client the second big difference is that
web sockets can handle both text and
binary where our server sent events only
and all text looking at protocols so web
socket is using its own protocol which
is a TCP based protocol so it's only
relationship with HTTP is that its end
check is interpreted by the servers and
upgrade requests so the server will
basically resembles HTTP connections and
WebSocket connections on the same port
and switch to a bit original binary
protocol which has nothing to see with
with HTTP the good thing is service and
events completely relies on it so
basically you just need to add these
text even stream header content type to
your header and it will works as yes
talking about configuration it means
that when using works
WebSockets get to reconfigure proxies
and load balancer which is something ups
are not really found of you
and there's a reason why it's because a
lot of proxy don't under WebSockets very
well it could be a real nightmare to
configure it properly $0.07 events on
its side well in Sochi please nothing to
do
looking at messages format so for
WebSocket not if nothing is defined in
the specification so it's up to you to
define your message format it's up to
you to pass it both side in server sent
events a message is every line of text
beginning with the data prefix so it can
be a single line message fuel a multiple
line message or and choose an object all
work the very nice thing there is that
server sent events also defined three on
stipes of field so the first one is ID
second one is even cell one is retry
keep that in mind we will talk about
them a little bit later
looking at implementations they are
quite similar so to make to open a web
socket we are going to create a web
socket object and pass the URL of the
API we want to stream with what the
weather WMA files as parameter to open
the server sent events connection we are
going to create an event source object
and pass the apply as parameter to then
you can register to a few callback so
for the first one you could register to
is on open which could be very useful
especially for web sockets because
opening a connection is made as
synchronously which means that it's
prone to error and you probably want to
be sure that the connection is
effectively opened before trying to send
data to the server then you can register
to the on message go back so as we have
seen previously
nothing is defined on what socket side
so it's up to you to pass it and for
service and events you are just calling
the data field on the objective field
and then you can register on the on
arrow so captain of yours are not going
to explain it but the very nice thing is
that server sent events does not only
allow to listen to messages it's also
allowed to listen to arbitrary event so
if you remember the even field with in
previous
by putting it on your message you're
defining a type for your events which
means that you are able then to add an
event listener on that specific type
whereas you don't want to listen to all
incoming messages or perhaps you want to
make a different treatment you can make
it easier this way
so talking about streaming we have to
take care of what's going on if the
connection is dropped for any reason
sadly in what circuits nothing is
defined it's up to you to deal with all
that can happen and all that will
obviously happen in several sentiments
we can combine two very cool feature so
the first one is the reconnection
timeout it means that if the connection
you've dropped for any reason your
browser will try to reconnect to the
server after three seconds so if this
delays doesn't fit your needs you can
just modify it with the retry field
we've seen previously
so you add it on your message and that's
it and then if you for example on a
message if you have added an ID field so
giving an ID a specific ID to each of
your message the server the browser
sorry will be able to add this ID in its
request as the last event ID it received
and so you will be able to retrieve
everything from this point so now
talking about browser supports
WebSockets are natively supported by all
browsers for a very long time where our
server sent events is only supported by
modern browsers yet actually it's no
problem because we got polyfill and so
we can easily support both older
versions of older browser and Internet
Explorer and looking at edge it's under
consideration at the moment looking at
mobile browser support so the same for
everyone only opera does not support
both technologies so now talking about
performances though these numbers are
coming from matches notes and blog posts
so metas is the developer of an
application called build watch which a
lot of it I visualize dream of twits in
real time and so he first implement his
application with WebSockets because he
needed to retrieve 500 twits
as fast as possible in his play
application and quickly he had so many
issues that he decided to give tried to
server sent events so it make the
implementation and then make this bench
to check if performances were not worst
so first only was a little bit surprised
to see that for some technology there
was a such big difference between
implementation on different browsers and
then he noticed that server sent events
was very much efficient the funny thing
is it took him more time to write the
blog post than to write the
implementation so as often in
programming it's not that there is a bad
technology and a good one it says that
you have to choose the technology which
will fit you'll need the best so yes if
you're going to make a chart for example
or a video game probably WebSockets will
be better but if you just want to send
data from the server to your customer
and if this data is text and if the
request I mean if the only data sent by
the client will be can be entered by a
post request probably it's better to
just use server sent events so that the
reason why we've created stream data at
i/o which is a proxy available in SAS
mode it's completely free you can
register create your account and make
your choice it's free until ten millions
calls per month so thank you I think it
will be fine so it's based on server
sent events we are going to make the
pouring request for you we are going to
involve all errors that could happen and
we added a few features to make it more
efficient so first of all we I did the
dynamic CACI which means that if your
applications will become very popular
and the new users don't have to wait
until the next poll to retrieve data
they will be able to retrieve data from
the last call and then we are added
incremental of these updates to reduce
again
in the size of data which is sent so to
make this we are using decent touch so
first of all just have a look at the
schema so basically we are making first
request and if on the second request for
example nothing has change we're not
sending it data just in sense to send
something you have already received and
the first the third call for example
only two two fields of your document
have changed there we will make
incremental updates so we are using
decent patch which basically defines a
set of variation which can be applied to
adjacent documents so it can be replaced
remove etc and so let's imagine as we
have seen in our schema previously that
on the first snap shot we receive this
document but on the third call only two
fields of change you will receive this
instead of the whole document again then
you just have to apply to usages and
patch library if you exist to apply
those changes to your document great so
now we are going to make a demo so I got
this drawn there which I would like to
make fly on the Bitcoin value so I'm
going to use this API which give me the
average blood the average of the Bitcoin
in Europe meaning that the field here
which will be entered interesting for us
is the last field it's the last value of
this Bitcoin has been sold in Europe and
ok so I'm going to connect to the portal
and I'm going to remove this one and
create a new application that we will
call demo ok once I've created this
application I can just take my API and
paste it there
okay so as you can see here a token has
been generated and to stop streaming
this API I got to call the portal then
my API and give my token so I can just
copy paste the Cal common which is
they're going to paste it in the
terminal so that you can see what it
looks like so here we retrieve a first
event called data so that's my first
snapshot and then we retrieve patch
events with the jizan part format fine
so once this is done I can go back to
the my API section and I did the playing
frequency so here is the place you're
going to give all parameters you need
HCP orders query parameters etcetera so
let's say I would like to pull every
second save and if I'm coming back the
new pulling frequency has already been
taking in consideration without closing
and reopening the string so fine now
let's go to the code so here it's a very
basic node.js application I'm just going
to use three library 11 source library
create event sauce jizan parts library
to apply my patch and the ar.drone
library to pilot the drone so first of
all I'm going to need an option subject
to define my IP and pass it to the drum
and then we are going to create patron
client by calling our drone create
client with this option object then we
are going to work we are going to create
an event source object by calling the
new event source with an aerial okay so
I am just copy paste my calculon as I
already got the URL I need
okay fine then I will need the data
object and a last object to store the
last value we are going to check so once
this is done I'm going to add an event
listener on first on my data event so
here I'm going to received a snapshot so
my data object will be jeezum that pass
snapshot the data collect the data field
my last value will be the rudder trust
once I received value I will add the
drone to take off and I'm going to log
what's going on so that we can have an
outcome so its first last fine so now I
can add another event listener on the
patch event here I'm going to retrieve a
patch so I'm going to store it in a
local variable to just make the pass
then I'm going to use my cheese InTouch
library to apply my patch to my data
object so it's my budget
object yeah not necessary and then I got
a so my data object as it has been
updated at this point so first of all we
are going to log its new value so let's
say it's a patch test we're going to
take that at last and then we're going
to make the comparison so if for example
last is under data at last it means that
the Bitcoin has gone up so we're going
to say up and drawn that up
at a spinet of ordered size and if if
it's not the case it means that it's
going down at a speed of so let's make
the drunk going down at sprint speed of
four that size so then we reassign our
last value and then we can register to
could be useful to register to the arrow
event and get something went wrong
so um so here we are beginning to begin
by looking then we are going to say the
drone to land and we are going to close
our event source and while we don't want
to the drawn to continue flying after
the session so we are going to say after
thirty second it's almost the same land
close and just a little log to see
what's going on okay so first of all I'm
going to try in my code just to be sure
I didn't screw up okay yeah thank you
okay should work better
mm-hmm
so you retrieve the data and did you
receive that yeah fine okay so now the
tricky part so mad one was broken has
some of your perhaps in nice guys I've
fixed it this morning by making a batch
so I hope it will work properly so we
have to wait for it to start so now I'm
going to try to connect to it
so here it's about well you just cross
your fingers so that it's there is no
network connections and it looks like
there is network connections so sorry
thank you yes so now okay so let's go
back to the codes so that the first time
it make this you know the connection is
fine you are still on Oh perhaps that
was that that was that
okay so starting taking us then we have
to do so I hope the Bitcoin will go up
since it will be yeah fine so if you got
bitcoins it's time to bug them and not
to us just well okay you get place just
yeah thank you
goodbye thank you so I had to say big
thanks to this guy this morning of my
life so I hope I convinced you that
service entrance is a great technology
if it's the case you can support but for
its support image by clicking click on
the link with this code thank you very
much we get 2 minutes and 30 seconds
left for questions we get some thank you
do you want the drone again perhaps you
can make something fun we can just for
example so two ended up let's say drawn
dot animate flip ahead for let's say
three second
I like you very much but not just at my
head
oh I think yeah it's a little bit
sensible
it doesn't appreciate to be moved
thank you fine
okay let's say let's hope it's going up
let's play something kinds at the moment
you're quite ridiculous something of
doing that yeah
no no no come on that's real time no
 thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>