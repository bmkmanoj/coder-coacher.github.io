<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>From Spring Boot 1 in Java to Spring Boot 2 in Kotlin by Mark Heckler, Sébastien Deleuze | Coder Coacher - Coaching Coders</title><meta content="From Spring Boot 1 in Java to Spring Boot 2 in Kotlin by Mark Heckler, Sébastien Deleuze - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>From Spring Boot 1 in Java to Spring Boot 2 in Kotlin by Mark Heckler, Sébastien Deleuze</b></h2><h5 class="post__date">2017-11-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MUa_Yp2KbBI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everybody today we are going to
talk about how to immigrate a spring
Goodwyn application developed with java
to spring wood - with the cutting
language so I'm Sebastien de Roos I'm
working as a spring formal committee at
pivotal I'm many working on the web for
active and cutting stuff and I'm Marc
heckler I'm a spring developer advocate
I kind of travel everywhere and talk to
you and he'll listen about the wonders
of spring so so that starts current
session will be mainly a left coding but
we are going to start with a little bit
of context so spring rough cutting and
officially supports it's that means that
we support the continuing wedge in
various parts of the Catena consist of
the spring ecosystem spring from our
I've officially support Scotland I
announced that at the beginning of the
year with a lot of nice feedback from
the community so it seems to raise some
attention but there is also Kirkland's
report in rectal coffee that one spring
that ok and spring wood - which we will
be released at the end of the year so
today we are going to provide you some
demo with Middle Stone and snapshot of
spring boot - but it's it's reaching
it's not very far from the release so
the first one the first step will be
migrated from Java to cut clean so in
this step we are going to start with
already developed spring good
application in Java and we are just
going to change the language we take new
advantage of the special cutting support
feature that's ready to show you how you
develop an application with cut in with
no special features in spring for ads
then mark will show you how to migrate
from speak would spring would one which
has no specific support from cotton to
spring boot 2 which is based on spring
for Mach 5 and wish which integrates
some specific cartoon feature then we
are going to use a new web web flex
remark which is a nonworking reactive
amok
which is available in spring car Mach
five so we are going to migrate from
spring MVC to spring with flex while
keeping the same annotation based
programming model and with the last step
we are going to show how to use the new
spring waveflex function at API which
may be more dramatic in Kirkland and we
will show some specific cut in DSL to
develop your web application so let's
switch to the code okay so this is the
application I'm going to show I can show
you it's a blog it's a blog application
so that's a simple blog post application
where I displays on blog post we did
with blog post and users we display the
dates you can watch specific articles so
that's a very simple application and we
are going to use this application to
demonstrate how we can migrate from a
java application to a curtain
application so you can see that we have
we have domain model so we have posts
with values fields two constructors
getter setters eCourse ash code to
string the same for user we have two
repository that are using a spring boot
spring attack MongoDB we have a regular
spring good Java code okay and some
controls one is for HTML views and the
two others are for the rests controllers
okay
so seems like it's a regular spring good
application and we are going to migrate
it to to cotton so the first thing to
change so here is a grader build okay
quite simple
so I am going to switch to another
branch that will just provide me the the
right thing for ya so what is the
difference against a regular job
application we have the cotton gutter
plugin okay which is a plugin which
enables the cotton compilation we have
also two other plugins the cutscene auto
pan and the curtain no ever again I will
talk about this to later you see that I
have here some computation because by
default code in compiler generate Java 6
byte code so since we are I guess we can
use Java 8 byte code so we can we
configure that be careful you have to
configure that for both compile and
compile tests okay so don't forget to
add these two to completion options and
then we have the curtain as the dilip
GRE 8 so if we have a look to the
dependencies let me just update it okay
so if we are
to the dependencies so you see that we
have you just show you that so we have
free STD dependencies the first one is
the library that is command to Java 6
Java 7 and Java 8 so it will contain
most of the code in standard library
okay then we have this other dependency
which contain only Java 7 specific API
and extensions and then we have the
Jerry 8 which contain Java 8 specific
case and when you import steadily be8 it
will positively import the two other
ones so in practice when you are using
this dependency the ester delivery 8 it
will import the 3 others and you don't
have to care when you use cotton and
spring you have to use the Kathleen -
reflects dependency and also since we
are not providing any cuddliness report
in Springwood 1 you have to use the
jackson module 13 which is known that
are-- - cellulite and SI Allies data
classes for example in Kali everything
of this configuration is available in
stat that spring that I owe so if you go
to start the spring data you and select
cut in cut in project that will generate
this configuration already ready for you
so you don't have to care about
we provide native supports focusing in
stat that spring data you now we have
that and we are going to migrate
progressive is this application from
Java to Cochin so I'm going to start so
it's codeine
we are using the cut-in directory
instead of the Jarrah one I'm going to
ablate a greater configuration
okay and I'm going to convert manually
the first file so the extension encoding
is katie instead of java okay so you can
see this the little cone that specified
that we are here in a in a contained
class so what are the differences in
coding classes and methods are by
default public so I remove the public
keyword which is not useful I'm using to
create a data class so a data class in
cochin will automatically generate
equals as code to string and provide
values of the facilities like a copy
method that we will use later and then
you will see that such class is much
more shorter in Kirkland that in Java
so we are going to keep our fields but
we are going to put directly properties
in Kirkland so I can use val val val is
for mutable properties val is for
immutable properties in my java version
I'm using mutable properties because
that's what usually people do because if
you don't do that you have some issues
with Jackson and other thing like that
in Kirkland I am not using going to use
Val I'm going to use Val immutable
properties because that's millennia
magic and because the Jackson code since
you bought for example allows to do that
so I'm going to use immutable classes
everywhere for my domain model so let me
continue to convert the type is fixed so
instead of putting the type here in
Kirkland I put it here and I'm going to
do the same for each properties so I get
the type notice that the semicolon in
Kirkland is optional and it's more
dramatic to not have any semicolon so at
the end I will do a big search and
replace to remove every semicolon but
yeah you can use it or not use it I
advise you to not use any semicolon in
Kirkland that's not needed and you cuz
will look more beautiful without it I'm
changing every properties okay so
this syntax is a short one similar to
what series in Scala which provides the
ability to declare the same time the
properties and the constructor so by by
writing that and occurring the various
properties but I also declare a primary
constructor which will be used to create
the values instances of my post as a
user and usually forget that one not
sure why okay and now I'm going to
remove all the Java source code so who's
bye-bye
so obviously that's that's shorter our
IDE allow us to to write the direct
class code quite fast because we have a
lot of auto-generating
options the big difference you know is
where you read the code when you
maintain it when you have to debug it
it's just another world so in terms of
speed of writing that's a little bit
better but really in the big difference
the system of the beginning reading the
code etc so that's it
notice that I can provide some defaults
optional parameter with default values
so here for example we can think that we
would like to set the default to local
that I know when we don't specify this
this properties and in Java I would have
to write an overloaded constructor with
different parameters here I can use the
same one and just write locale that time
that now and that means that when I will
not specify the last parameter it will
automatically get the no value and we
can see that in terms of semantics the
code reads pretty well so that's
optional parameters will with default
values for user I could do the same
thing I will just show you that in ID
there is some Java to cut in conversion
thing so that's not perfect you will
have to
modify the car after that but I will use
that several time today so you can see
that it does a part of the job but when
you compare both obviously I still have
some works to make it more dramatic so
I'm using the tag class you can totally
write that I mean if you don't care
about generating equals ash code and to
string you can totally do that but here
we will use that later so that access
user so notice that I will continue to
use the same short notation so ID where
again you see that here I have a
question mark so a key point of cotton
is that it deal in native this report
new safety in this type system that
means that in in Java when you work with
Java when you have a parameter a field
or something like that you don't know
what is the new ability so you have to
read the Java doc maybe you framework or
library I specified it in the Java doc
maybe not if not you have to guess if
that's new label or not and that's why
we have new pointer exceptions and
that's why in Java the new safety is
checked at runtime encoding new safety
is still a thing but it is checked at
compile time so you don't have to wait
to have you application in production to
get this nice exception at the worst
time usually it's you have to deal with
no safety but during the compilation and
when which we try to do when we build
some caffeine application we try to so
null fields and properties and
parameters are not a bad thing but when
we can avoid new properties we will we
will do so here login is not that early
so I will use so that means that that's
a non usable string and with the
question mark that means that login
could be no so here login will be always
specified I said that I'm
in new liberal immutable values plan
here I'm also using non variable first
name non-believer last name and the
description we could think that the
description is not mandatory so I will
keep the new label string for
description and I will have a default
value which is new and I remove move of
this code okay so when you come from
Java world and myself when I begin to
walk whisk up in two years ago it sounds
not super important to me even if I I
care about new pointer exception but
when you you develop some time with
wiskirchen you really you really see the
added value of that and we will we will
see that later but that's nice to be
able to check that at compile time
rather than at one time for the
interfaces that's almost the same so I
change extension I remove the public key
word instead of extends I'm using : okay
and I don't have to provide the body if
there is notes and I think that's it I
can obviously also use conversion
facilities to do that I think it's
pretty great
now now we are going to migrate our
application class to Kathleen so later
Mac will show version that will use the
native support of Kathleen in spring
boot - so now be aware that I'm just
using spring good one which provide no
specific code in extensions and the code
will be more dramatic when we will use
spring boot - something that there is in
encoding which is not present in Java is
top level functions so in Kathleen you
don't have to wrap new functions
in class if you don't need to that means
here's the main method we are going to
be able to move it as a top level
function outside the application class
so I take this code I move it here in
cutting the functions are declared with
the fan keyword okay
maybe that means something we don't need
public we don't mean we don't need
static void so oh let me change that to
cuddling okay so so thank you word I
declare the net the name of the function
I still have a string array but it is
declared as an array of string okay but
that's not the same here we keep for the
moment spring application that ran here
when we write first in cutscene to get
the class you are using this notation to
get sometta information of the class and
application a - - semi colon colon class
is the cutting class so you know in
order to be able to access to the the
real Java class I'm using that I'm using
the spread operator to change the args
parameter which is an array - to the
hogs because my here I'm taking average
of string I'm removing the public key
word because I don't need that
and in terms of imports you don't have
to specify the static keyword when you
are using static imports here I'm
declaring a mustache compiler beam
because I want to customize the
configuration of the mustache support
not escape the HTML in the in the
template system so I'm going to move the
return type at the end okay I do the
same for the parameter okay
I'm going to change that into a function
so I still use fan and the semicolon is
optional so that's that works but I can
provide a better syntax in in encoding
in addition to the new safety which is a
super important feature you have type
inference so codeine is much more clever
than Java to guess the type of your
classes and your methods unimportant
things to understand is that codeine is
a statically typed a Java so that's very
even if the syntax looks concise like
groovy
it's a statically typed as Java and I
would say curtain is even more
statically typed than Java because it
has new safety and new safety is a kind
of step additional step toward the new
safety of your code so instead of
writing that I can directly use a short
notation which is useful for one-liners
function which is equals and I return
directly that's and you see that the
type is automatically inferred by
Kathleen if a new IDE you don't see this
if anti because I'm not sure what is the
default but maybe in some version of IDE
is not displayed by default and that's
super useful to have this type in third
displayed either even if you don't have
to write it if you don't have that in
your IDE you go to settings you go to
editor you go to general appearance
that's a very long journey show
parameter name ins configure cut in and
then you check this these free ones
parameter and argument means I usually
don't don't check that but you do what
you want and this will show you the info
types even if you don't have to write it
that is that it's optional so I can
totally write mustache that compiler
okay that's that's perfectly fine but
I'm not first to notice the exclamation
mark at the end
that's because cut in interpret that as
a platform type so platform type a type
which new liability is unknown because
it's coming is it coming from a Java API
and codeine can't knows you need new
safety of these elements so when you see
this exomesh exclamation mark that means
that Kathleen don't know if it's new
label or not I think we are okay with
that one I'm going to emigrate to
emigrate that one so I can use the
conversion facilities so everything is
not perfect I'm going to fix that so I
remove that thing encoding instead of
erase that as lists we usually write
lists off okay at the same shot oh here
you can see that there is the reason
ever do you know why do you see why
there is this arrow it's not super
obvious is because there is a difference
of no safety between with between what
is do here here and here because if I
have not the same new safety between
between both it's interpreted like
different types basically so I take a
new label string as input and I return
an honorable string okay to remove that
one so this class is okay but I can make
it a little bit more dramatic
when I say dramatic it's to make it look
like ya better curtain if statements in
cotton are expressions that means they
return a value that's also applied to
try or to other kind of expression so
what I can do is to use my well liner
syntax to write directly that's okay if
will return will return a value so I can
write short code like that because in in
in cotton if we return a value and
that's also super nice with try to be
able to have try that return something
or so now let's start talk a little bit
about the functional support in in
cotton so in Java to use lambdas we have
to basically use functional interfaces
which declare a single integral method a
single non default method in cotton I
can continue to use that and there is a
good interoperability with Havana I
think that's a very key point cotton has
a very very good interoperability with
Java and that's one of the key reason
why we support that in spring because
really Kathleen make it it's best to
support Java and the JVM ecosystems the
best that it can
so yeah redevelop is fine but if I want
to write that in a more cartoonish way
notice that I don't have to use this
functional interfaces which are kind of
wrapper or additional noise I can
directly define pure functions based on
their input and the output so this is
the cartoon equivalent to what I write
and previously I'm going to use invoke
because that's the default
default name for such such a function so
you see both I equivalent and but that's
more knock cutting ish to write that
like that okay I think that's when it's
great
maybe a little bit more detail about you
remember I had to declare the coupling
spring plugin so code in spring plug-in
is a specialized version of the code
clean all open plug-in okay and this
will automatically so by default occurs
in every class and method is final
okay that's different than in Java where
everything is open and we need to put
the final keyword to make it a final in
encoding that's the opposite thing you
have everything final by default that's
a choice that could be discussed that
may be the choice I will discuss the
most in Kirtland but that's things are
like they are and there is some good
reason for that and I have to put the
open key word to make this class of this
method open and in spring in some part
of spring we need to have open classes
and up add methods because for example
here for Java config we need to extend
these classes and this method at runtime
to be with sherab to be able to do yeah
Jerry config is based on this mechanism
basically the same for transactional for
example when you have transactional
methods you have to spring extend these
methods with CG lib or with delicate
endemic proxy - - under the
transactional thing and with Kathleen
without the plug-in you have to put open
keyword on these classes and these
methods that could be a pain so we have
discussed with dread burn gas and
what they have done is that with the
cutting spring plug in every methods or
classes annotated with a spring
annotation or meta notated with the
spring annotation will be open by
default that means that when I say meta
notated that means that every annotation
meta annotated with AD component for
example will be automatically opened
that means that in your company you have
some custom annotations annotated with
AD component for example they will be
automatically opened because we go
through the annotation inertia and we
notify that it's annotated with AD
component for example dot so that's
quite flexible you can obviously also
configure the plug-in to do that on
other kind of annotation but in practice
that make it work like in Java and you
don't have to care so now we are going
to start the hard stuff and we are going
to migrate the butyl class so in
Kathleen that's not super dramatic to
have Patil classes in Java that's a
usual thing in Kathleen we are going to
try to use instead so you can use that I
mean this code if I convert this code to
Colleen that will work and you will be
able to use all you util classes but I'm
going to convert to extensions so
extension functions are another key
feature of coaching and that allow you
to basically add additional methods to
existing types I'm going to show you
just now so I'm going to convert it like
that instead of UT's I'm going to call
it extensions and I'm going to
change everything so like I said you
don't have to use class wrappers you can
write directly top level function so
before writing some extension function
that just so writes top level functions
so that's that I'm going to use my usual
funky word okay to the class this is
method here the type could be here for n
that's an int that will translate to an
int capitalized in cutting and here you
see I have this this if statement I'm
going to use in Kathleen a when
expression and I'm going to translate
this code C Java code to idiomatic
cutting so and in I can use this
interval syntax okay
another cartoon feature that is was to
use the string interpolation so instead
of concatenate strings you usually write
directly with the dollar that and that's
allow you to write I mean the code is
more readable it does not have to
generate intermediate strings so that's
more more efficient I'm going to I don't
go as fast as just long so sorry for
waiting but I'm just a human okay
I remove the optional semicolon I'm
using string interpolation because it's
fun
forget it okay one thing which is nice
with Wayne is that I need to check all
the values cases so if I forget a case
which is which happened here I need to
check everything so if I do that okay
when expression must be exhaustive so I
will be exhaustive with an else with
zero
and that's it so I have written a top
level function in a more cooking
idiomatic way so you can see that it's
much more readable from D'Angela
now what is an extension function an
extension function is something that so
to use this function I used I will just
have to write for example get ordinal of
- okay if I want to transfer that to an
extension function I will write that
like that that means that I am adding a
guitar dinner function to the in Stipe
even if I don't own the in source code
so I have to modify it a lot a little
bit to write this instead of n so both
are equivalents in term of bytecode it's
almost the same but extension function
adjusts yeah syntactic sugar that make
your code readable more easily and
that's a pretty nice syntactic sugar I
would say so we are going to see what
how we use that so we are going to make
this code much shorter so we keep this
as private so when I write private Val
that means that this value will be
private to the phylum okay I don't have
to encapsulate that in a class but that
will be provided to the file now I'm
going to simplify this code because we
can just in using the wrench syntax in
Kathleen and I'm going to generate from
from this range of integer I'm going to
generate a map with with days as a key
and with ordinal string as value so I'm
going to use so you can see that I have
values values values method I can use
directly map ok I don't have to write
that stream that correct etc I just
juda not because that's what I expect
here I'm going to associate to transform
this this list to an app and I'm going
to use so here I am the the value and
then I'm going to create a pair with n
dot two longer because I will not I will
need so long type later and I will just
use two ordinal that will be better
okay turn off naming and you can see
that my two ordinal extension function
is available right here on a regular
integer type so it's look like nicer
encoding there is also a default
parameter for lambdas so instead of
writing that I can write it so it's when
you have a longer that take a single
parameter
you have its default parameter and you
don't have to right to declare
explicitly you learn the parameter it
will be available like that and if I
still want to make that code a little
bit more dramatic so pair is okay like
an entry but I can use this syntax
that's that's
two pair okay that's a that's a good
clean syntax to declare a pair with that
way so you use a way that you prefer
obviously Kalinin still young so best
practice could change from value streams
and practices currently and going
process to be able to define that but
yeah I think that look look like an
idiomatic code and you see that's a type
map long string is inferred and display
with the option that I have shown at the
beginning we will do a pose after the
step one which is the longest one okay
we will do a pose when I will have
finished that part so okay we'll remove
that later let's turn that to a private
Val so same thing I don't have to repeat
I mean in Java you see that this
information are this information are
duplicated so that seems quite logical
to just have that guest okay in code
seen you still have constructors like in
Java you just have to remove the new
keyword okay let the same citizen in
Java but without the new keyword I
remove the optional semicolon
we have this sluggy file function that
looked like a nice candidate for our
extension methods so I'm going to
declare fun I'm going to yeah to cook so
slag if I will be an extension of string
that will I will be able to write my
string that's like if I say keifa is to
transform any kind of string with
special characters and spaces to
something that fit better in URL with
dashes and everything lowercase etc I
will do the join at the end
let's remove a lot of code this so when
I write an extension function the type I
am extending will be available in this
okay
replace soul would be replaced and here
I have an extension function and string
to transform that to reg X with a nice
syntax editing and then I will join to
string okay and I can see that
as expected the return value is a string
let's modify that as well so I'm going
to right and top our access so that
format to English equals and here I'm
using this okay we remove the news
imports and we are now going to use this
extension functions in our code so here
I have a database initializer database
initializer is something that will add
some data in my in my database MongoDB
database at startup I'm going now I'm
going to translate it with that because
otherwise that will be super long okay
so now we see that the automatic
conversion has done most of the job and
we just need to polish it so in caffeine
you don't have any checked exception H
and remove that and you can see here
instead of writing UTS that's like if I
wrecked or title I will write so more
nice looking at least from my taste
okay and this
we just called that so that's
technically in terms of bytecode that
just like YouTube's function but that's
your code read read better or so notice
that here I am in the same package so
that works without anything but you need
to import extension functions that means
that if you have an extension function
in one package and you are using in your
code you have to import that that's a
little bit like the static imports that
way everything if you have a library
that provides a huge number of extension
function you will not have you
autocompletes bloated by a lot of
additional properties you have to import
them and usually I did does a pretty
good job to highlight I think Matthew
will show that later that will highlight
that okay maybe let's import let's
import that extension function a little
bit like it is done with static imports
okay wrecked rotator struggie files main
title slug if I do the same or so here
okay I could let the code as that but I
prefer to use some more nice-looking
stuff I think he also list of okay I
think we are great
mm okay so now we have converging most
of our application and we are we have
remaining work to do at controller level
and for the test so let's start by the
controller level and then we will run
the unit test the integration test I
hope that will work
so HTML controller yeah we can Kemah
great that one so I'm a lazy man so I
will use that okay yeah yeah troop I'd
like in other languages like in scale I
guess by default like I showed in the
domain model faces the properties that
you declare with this syntax are public
by default okay so when you are using
that in in the constructor of a bin
usually you would you want to specify
private because you don't want that
accessible from the outside that just
this syntax is an implied auto biotin
instructor in question we try to favor
constructor injection in Java also if
you have a fan of Olivia for example II
usually push for that and generally in
the spring team we push for a
constructor based injection for your
regular controller service bins and in
encoding that's even more important
because of the little safety because if
you you don't do that and you will see
that later with the tests you will have
to use late in advance or new label
properties or thing like that so really
instruct instructor based injection is
even even more important in Killeen and
you could write that but that will
expose post repository as public
property with the Gator and we don't
need that so we just do that okay and
this will be automatically auto wire
because there is a single console table
okay so we can maybe make this code more
nice you see past is an interval and in
Java to create stream for an iterable
you have this ceremony so here I'm just
going to write map and you just moon it
correct so you can see that even for
simple things coding code is more
concise you remove a lot of noise and
you just get a pragmatic code that do
what you expect without too much
ceremony mark will show later think of
shorter syntax to to do that okay so now
let's have a look to this past digital
thing so we are using mustache mustache
is originally a JavaScript based Tom
played engine and here we are using the
mustache
I think that's Dave sire that wrote a
nice blog post about that and I also
like very much mustache for doing simple
things it's less powerful that then
Timmy for example that's but that's
pretty nice and it's a load to write
this kind of code okay
which which is logic class template so
basically you you only iterate other
data classes and this place is kind of
feel but you don't integrate some
complex logic in you new templates in
order to achieve clears clean separation
between you templates and your code so
watch what we are going to do here
because you see our posts for example
our post domain model object here we
have a look at that time and if we just
render it with a mustache
it will deeply display a local that time
to string which will display we don't
really control the format of the date so
what
going to do is to transform the past
objects to a positive object where we
will control how dates are serialized
where we will compile so this you see a
line and the contents they are they are
knocked down you see that this is
knocked down and to display it we want
to have HTML so basically we are going
to transform the knock down to HTML code
when we are going to transform a path to
a path detail and what we are going to
render here is a path DG object okay so
what we are going to do is to transform
this this code to a Kirkland data class
okay
but according data class contain only
data okay we only get data so we have to
to do something because what we want to
do is to get to data class I'm going to
move that I'm going to use the shot
syntax slug which is used for the URL
title we don't change anything
headlines contents will contain the HTML
version of the magadhan compiler which
they're the same and here edit add will
be a string because we will we will
format the string before and here is
another nice use case for other
extension methods let's let's say that
this is my domain model and I don't want
to pollute it with things that are
related to the front end okay and what I
can do here is to add an extension
function unpassed
which will be called to detail
and which will return a purse detail
object so to GT Oh we'll take a mac down
converter and here I'm going to there is
name parameter in cutting can show that
later
so I initialize it with slag with title
with Edline so we for the airline we
need to transform that with an argon
converter like that
I think continue invoke because we
change to native cut in syntax Giotto
and we are going to use our nice
extension method so I'm going to write
added adds that's so not to English you
see that I have to import the extension
meter to be able to use it so I write
alt enter it is imported and and that's
it so that pretty nice because I don't
have to pollute my post domain model
class with some front-end thing I just
ride my GTO class and then I adding it
here that means that in my HTML
controller I will just write posts that
to dto and that's it
to detail and that's it
crappy import okay hmm I don't like red
okay that works
notice that I can also use name
parameter in in Kirkland so I will maybe
show that if you are writing for example
you can okay you can specify the
parameter by names I will show you that
later with the copy method so I think we
are good here yeah we convert we can get
that controller too
so here it's better to so that works but
I can use you begin to be used to that
so type in friends to be able to use
just adds and that's worse so here you
see that submitted a fine one meter that
is using an optional equals param and
mark is also going to show a bit of a
new functionality about that but that
will be later so here I'm going to use
equals when when converter and I will
use various cases so if my converter is
equals to knock down I'm going to do
both repository that find all that let's
that's a kind of map operation that will
allow me to transform that and I'm going
to write
it's that so here I'm using the copy
method which is pretty interesting
because here what I want to do
it's I will continue to use a neck force
of HTML controller and we still use my
past classes but I won't just to when
the McDon converter is specified to
transform the headline and contents from
Mac down to HTML and here is the case
where we just want to modify two fields
of an immutable data classes so what is
nice with that a classes is that we have
this copy method automatically generated
and what I'm going to do is that with
with name name parameters I'm going to
specify that
I think that's okay so it is default
under parameters which is the Z element
return by fine one and here
Kapil give me the opportunity to modify
it just a selected subset of properties
and that's it which is a regular program
when you deal with immutable classes so
here we don't have to do anything if
there is no no converter specified I
just return the one from the repository
and else I will throw an exception okay
so you see I'm not using the new keyword
because I mean cut in but it's the same
syntax and that's it so yeah let's look
nice look like a bit better code listen
to me and I will finish by converting
that to clean with the lazy option
that'll will just improve with mo
geometric code okay
okay I think I think we are done so I'm
going to run the integration tests okay
let's pray for some green bow because I
have changed a lot of things okay nice
so we have so we still have our code in
Java in tests I'm going to change that
and after that you will be able to drink
a coffee or tea anything else but you
see that when we ever look to our code
the first thing to note is that you can
totally write code in code like Java
code and just yeah you don't have to use
all these codes in a dramatic thing from
the first time it takes some time to be
used to but you can just begin to
convert it and have a kind of beta Java
and after that you begin to use more
advanced feature and you ended up with I
think alpha less code for the same
application something that is easier to
debug to read and you you know you can
use this kind of nice tricks to have a
normal enable application even if we are
using the same framework I mean that
spring good one it contains no support
for cutting and we just take advantage
of the language
so now let's quickly migrate the tests
so still use the metric conversion thing
so here notice that we are using the
current color notation to get the class
okay
that remains the same I will keep my
abstract integration tests so here here
is an example where we are going to do a
field injection maybe with the unit 5 we
may be able to inject some value
directly to the functions but I'm not
sure it works so today we are going to
keep using this kind of thing and here
I'm going to use late in it
Wow
why the issue here is that Kirtland deal
with no safety natively and when when a
class is initialized but not yet
injected with just a field basically you
need to defy the value and it's if you
don't use if you just want to use that
property must be initialized ok a
curtain has no knowledge that we are
going to inject something later with
spring so you ended up by doing that and
that's bad because you have new label
fields everywhere and when you use them
you have to write extension math
exclamation mark and that's a pain so in
order to avoid that the Kirkland guys
have added late in it var that allow us
to basically provide a non new label
field that will be injected later and
codeine will throw a new batch of
exception if if it is not under maybe
not a new point exception button not
initialize exception or something like
that
so here that's in tests so we will say
that's ok and we will use this legend in
Val
Leyton it well and here so exhibition
mark exclamation mark is when you are
using something that is a new label to
be able to to use it without any
additional checks we are going to use
that or we are very super at us to deal
with no safety here since we are using
non durable thing that's okay we are
going to take advantage of the string
interpolation so if I am in this case I
don't have to put the curly braces
address right the report and that's okay
I'm going to me greatest tests
okay so again mark will show later how
we can get a better a better syntax like
that here we are using no content report
and we provide something to improve that
I think this one is it's just okay we
are going to call your dad's okay so
this one is yeah I guess Mac you will
also talk about that later so we will
have better code here and let me fix
that
okay and also the last one okay so we
are going to try to run them again okay
nice something that I would like to show
you also lets me do it here you can
write expressive test names with
backticks so backticks allow you to use
any Unicode character into your function
names in your regular production code I
would not advise to use a fancy name
with strange characters even if you are
free to do that but in tests that's
pretty nice because if you are used to
specification like test framework you
can write this kind of sentence okay
just plain sentence in order to avoid
not so much readable camelcase notation
okay and when you run this test you will
have a regular sentence printed here and
in your test report and thing like that
so I think that's a pretty nice feature
to be able to write more specific test
names and in my cotton application I use
backticks
everywhere in in the function names in
tests to be able to have this kind of
expressive name I think we are mostly
done so we can maybe just have a look
that our application is is running as
expected even if we have migrated
everything so yeah I fixed a fancy but
my application is working and I have
modified a lot of things and that's okay
maybe if some of you have questions I
could answer them if you have any that's
somebody asked a question about that
part which was mainly about converting
Java to cut lean without taking
advantage about specific feature yeah so
performance is yeah so Cochin is as you
know may-maybe is super popular in in on
the wide world and in fact it's it all
started the success that's it mostly on
the on the right side at the beginning
so kirtan is really designed to provide
super efficient bytecode so unlike other
languages that produce a very different
bytecode the battle produce is very
close to the Java one even when you use
some fancy feature like extension
functions the bytecode is almost the
same so some people I think somebody
wrote a blog post about the the cost of
cotton for example which detail
what is the cost in term of performances
in term of bytecode when you generate
such application with cotton and that's
bear is the same annoyed which is super
yeah when you you really need to have
the same Avella performance so in in
server-side I would say that's yeah
that's there is the same there is some
tools to be able to check that so you
can you can take any clean code ok you
go to tools cut clean show cut in
bytecode
they compile because I'm just a human oh
and I have a nice error okay so in in a
regular world outside when the demo gods
are here it shows it's it shows or Java
bytecode and you will see that that's
mainly the same then let's try another
thing ok so here that works and you can
see that from this from this code in
code so the first thing is that coding
is adding some metadata because as us in
Kirkland is dealing with other notion
that are not supported on Java so for
example new safety information and other
thing so it's add metadata like that
there is this is where we leverage the
cuddly no reflection to be able to get
this information without passing this
super low level stuff but except that
okay you see that my non-liberal fields
translate to regular Java methods and
fields annotated with at not near so I
mean the translation it's it's not like
dynamic languages that generate super
different bytecode it's almost the same
and and really yeah they did a pretty
good job too
you see my my copy you know there is
some components methods but I generated
you remember my copy method that I'm
using to just specify a few ones I'm
using that
so yeah that's I mean even the Java code
generated from the bed code is super
readable and yeah so the performance
impact is almost near oh I have
forgotten to remove all this crappy
semicolon so researching path Katie
accept come on and string literals okay
so I don't so maybe
yeah you you quickly get used to to not
have some around anymore so the goal is
may need to have yeah less less less
noise and distraction when you read code
another question yeah generate the code
in code from the bytecode I'm not sure
but what is done usually is just to
generate that from the Java code which
contain more information and you will
surely do I mean you can generate Java
code from byte code so you can do banker
to Java and revert to cutscene but
that's if you have the source code
that's better to to generate that from
the Java source code which contain more
information no it seems not super
convinced okay we can maybe discuss just
a total torque ordering them as opposed
to to go deeper in that yeah
what is exactly the question okay
yeah difference between groovy and
cotton it's true that the syntax looks
could look like barely the same in fact
Kathleen has taken a lot of inspiration
from groovy but also from other
languages
I mean jetbrains is a company that built
initially a lot of development tools and
they know where we were each language
because they have to build an IDE for
dotnet for Scala for Java for other
languages and when we discussed with
with them a lot of inspiration is the
experience of the various languages and
they have tried to to create a mix of
values features or so to to not
integrate a lot of other features
because along edge is the feature that
you support but also the ones that you
don't report and so clearly Kathleen get
a lot of inspiration of groovy for some
syntax but in fact they are super
different when when you develop with
both even if groovy through posted
static compilation with at compile
static annotation groovy from its root
is the dynamic languages it's a dynamic
language and all the ecosystem is mainly
leveraging this dynamic nature and when
you see the bytecode generated for
example it's it's quite different the
level of when Kathleen is more
statically typed than Java because of
the new safety thing but except this
topic it's really the same you have
exactly the same level of type in France
where in groovy even if the walk on
composite it is has been super great and
a great addition to the language
basically static groovy and regular
groovy are two different languages and
the development experience is super
different so really yeah so the static
nature of Katrine
practice when you developed with it and
with audio system make a huge difference
in terms of see how you feel that that's
really a statically typed language from
the root so that's quite different in
practice okay so maybe let's let's do a
pose I don't know when we will start but
yeah maybe 20 minutes or 30 minutes
maybe 30 minutes that takes the time and
we will continue with step two step
three and step four which will be
shorter but that will show you all the
various feature that we support in
Springwood - to leverage cogent values
video Thanks okay oh we're on
excellent the the second part of this is
a bit shorter it's also a bit more
exciting when we got here we had to make
a few adjustments I we are in regional
intention is Sebastian was going to
present with his Linux machine and I was
going to present with my Mac and I think
Sebastian and my colleague Josh have
been talking because Josh and I
trade-off presenting and making each
other and comfortable with alternating
or dueling laptops
well the Mac didn't cooperate this
morning so now I'm going to be using the
Linux laptop and just to complicate
things even further because it wasn't
complicated enough this is is not the
American keyboard so I I'm a touch
typist so this is this is going to be a
bit challenging I will appreciate any
good thoughts you send my way to make
sure my fingers find at least close to
the right keys and if it really gets bad
I'll pull Sebastian in to rescue me at
some point but this this could be fun
right
demo gods are not being kind this
morning but hopefully this will all work
out and we won't wind up blowing this up
and smoking it so anyway so where do we
go from here Sebastian did an excellent
job kind of laying the groundwork in
terms of we have a starting java project
we're going to convert it to cotton with
boot 1.0 still and now we're going the
next step is is to kind of take that
into spring boot 2.0 and to make some
minor changes and adjustments as that
implies so let's start I'd like to start
with just looking at the build file here
let's see there we go so so the build
file as you can see here we're still
running with boot version 1 5 7 release
there are a few other things that will
change as we go through the Kotlin Norg
plugin becomes not required because with
boot 2.0 it supports spring data k ka Y
which with spring data it's alphabetical
releases and spring data k was the first
version which brings in some of the
niceties it allows you to fully fully
supports immutable classes in Kotlin you
no longer have to have no arg plug-in
and accommodate that that way and also
with B 2.0 supports will will I don't
want to say this let's see we no longer
have to bring in or specify the Jackson
data type GS n 310 and the other Jackson
module for Kotlin to get the java 8 data
types because we're baselining for
spring boot 2.0 spring framework 5.0 on
java 8 so let me go back here and yeh
he's I'm actually hitting the right keys
this is a good start so let's do a check
out of - a yes - hey that's a good idea
yep
where's the - - oh thank you
and there the a is up got it okay so now
we're good so shift yay it's it feels so
tentative it's like I'm just learning to
type all over which is going to be
really fun when I go back you know later
on that it is what it is so anyway so
let's let's go back and take a look at
the build file again just to zoom in a
little bit
oops let's see I need to refresh here
there's my I don't get to migrate a
window here so I can refresh we just
want to refresh okay yeah
ah there we go perfect
and we're still not
we're still not refreshed what happened
here let me check
yeah maybe I did a mistake in the
intermediate branch so maybe let's
okay okay all right
yeah sure might happen there okay so
let's yeah we're good shape so the first
thing you noticed probably at the top if
I can get back to the top the scroll is
even backward we shouldn't say backward
my skull is backward or his depending on
perspective that's uh so it is quite an
exciting time the spring view version is
at 2.00 built snapshot and as you can
see the no arc dependencies are gone and
specifications here we're also adding
the the jsr 305 strict flags so that we
can do null safety if we go in here and
we'll check out this scroll while you go
to the to the dependencies so we have
added a new safety annotation in the
wall spring from a code base and also in
spring the decade to be able to provide
with the free compiler add option that
Stefan mucke has shown new safety from a
cutting point of view right so this
allows us to add the package level
define that it is a nominal API and then
override at the parameter and the field
and the return type level when return
types are or when those values are
knowable specifically so it tightens
everything happened and gives you that
no safety at throughout all of the
spring functionality let's see what else
I guess let's start a baby shows can you
go to the know to show that itself it's
control with there we go yeah so you can
see that the non-nude api which is a
spring annotation is meet annotated with
GS f u5 meta annotations which allow
tooling to take that in account in a
generic way so the tuning as not so
tuning the triple dots mini currently
Aegean codeine and I hope sonar another
things will catch up the idea is that
they don't have to provide any specific
spring support for that they just have
to leverage the reflection or other
where is this annotation even when they
are not in the class pass with Wrentham
retention that works and that sorrow see
studying too - yeah - to understand the
new 50 semantics without any specific
support for spring ok so let's see if I
can there we go ok so yes let's start by
something Sebastian I kind of did that
earlier we're going to make this a bit
more idiomatic I'm gonna make it very
few small code changes to accommodate
some of the features that we've added in
for spring boot 2.0 as well as the newer
niceties with the Kotlin modules so for
starters this is a very you know Java
look obviously we're doing Experion have
a patient on we're passing in the
application class the Java class so we
can actually make this a bit more
idiomatic with our run application
application always helps hit the right
keys and then application and then this
allows us to take this down to here and
actually we could do one other thing
since we're in the neighborhood right if
I can get the keys down
yeah that's a dish yeah that's one
that's the French people yeah yeah this
was so easy earlier okay so what we what
we can do is what we may not be able to
do is go ahead and provide the lambda
for our method here so I'm just going to
set the banner mode assuming I can keep
my fingers on the right keys and let's
see even the period yes okay all right
and yeah this is gonna be painful so any
way that it's a very very long way to
demonstrate a very short thing so this
just makes your your way of kicking off
your application a little more idiomatic
Kotlin versus the the way that we were
doing it before certainly
interchangeable it's just a little bit
more familiar in terms of formatting
let's see some other things we wanted to
cover so if we do a look for
that won't work okay so this is one
thing that's it's kind of nice again
this is certainly not anything you're
required to do but it's it's kind of
nice that you can as you can see here in
our in our method here that we're
actually pulling in a request grammar or
accepting a request parameter and we've
got it annotated as as required equals
false but as you can see here that we've
actually specified a nullable type in
Kotlin so this allows us to just remove
this entirely and everything still
continues to work as we would expect it
to let's see is there anything else here
that I really want to show maybe we
could add that that's also supported for
Ottawa Yard
so when we are injecting like here we
are injecting post repository or thing
like that we can also if you have past
repository question mark that means
that's a new level inaudible property
and if there is no been available
basically spring will interpret that as
Auto by other aquatic Air Force which is
also available in inject so new safety
is also taken in account to infer if a
beam is mandatory or optional on a pair
parameter or field basis okay so let me
let's go and check this out this is a
kind of a nice little extra feature as
well the things that we have to do in in
Java because of type you're a sure so if
you can see here there we go that we we
do a little bit of gymnastics here so we
can hang on to our types with
parameterize type reference so we have
to use a I really wish I knew the key
combination but we have to couture LC
yes okay
you know what I may be able to undo this
and speed this up just a little bit so
instead of having to use a rest in plutt
exchange method we can use the much
shorter syntax for get for object right
except you have to hit the enter key
there we go
and I'm able to provide thank you and
same thing okay brilliant oh it's
already closed because me nope actually
I know there we go okay which allows us
to do a lot of really nice things here
because then we can clean a lot of this
up just by default
yes okay so so that makes that a lot
more readable I'm going to go ahead and
look for the other exchange and do the
same thing here let's see and that's the
list of user okay and once again we'll
pull this out and replace whoops replace
with AD
and that improves that dramatically
there we go okay you need to import so
with alt enter you like I was saying you
import repeat it to click on it yeah at
enter should do the trick
import there we go and rel previous one
I think it need to be imported or so so
like I was saying you need to import
extension to be able to use them and ID
will do a pretty good job to propose
there we go okay let's see anything else
one thing that we could point out if I
can find the M there we go okay so we
have a little bit nicer syntax for
accessing our model attributes instead
of doing a model dot add attribute which
is Java syntactically the the idiom that
you would employ we're able to access
model as more of an array type of access
which is kind of nice
again not anything that's have to switch
over but it's kind of nice to be able to
do that let's see so the other thing is
so if we take a look at our abstract
integration tests class let's see so we
do have a before all which is a nice
nice bit of a unit five keeping in here
that allows us to provide a set up
method or a set up function that can
execute before each test or ever I
should say before all tests in this case
so it doesn't have to run before each J
unit I'm actually you know what I need
to do that and the fact that we have
this set up to default to per
class means that's run once for each or
for all of the tests in that class
versus rep executing for each one which
is kind of nice
let's see what else I guess that's
pretty much it at after all because unit
for onions reports a static in unit for
its ad before class and after class and
in Kathleen translate to companion
object which is not super nice looking
so we're joining supporting this new pet
class life cycle which instantiate a
class a single time the class when you
run multiple tests because by default
unit instances the class for each test
it's allowed to like intestine G to use
non-static before class or before all
and after class or after all methods and
that's a better fit with with between
not requiring any static method for that
and one thing that I live on a show
before we kind of launch into the next
phase because so far we're still in the
imperative model so it's with Spring
Framework five spring boot - it's a very
gentle transition to go to a reactive
model so if you for instance as
Sebastian had created earlier the
repositories that we use for the user
repository and the post repository they
actually extend the credit repository
which is defined in spring data and as
you can see it's is as you might expect
it to be it returns actual types you
know so you return type T interval of T
and what have you so that's just
something to keep in mind is something
you're probably very well acquainted
with if you're used to spring MVC I'm
actually going to check out the next
let's see oops
so maybe reset again yeah produce
where's the - again up here
no it's underscore huh here it is six
all right you don't have that was the
pre okay sorry that's just a moment I
did the I did an actual get yet like yet
so does anybody remember the time that
they actually learned to type for the
first time that's not a fun fun
revisiting but it is certainly
entertaining so let's say you get check
out last what was it three yep
where's the shifts yeah alpha I believe
so
nope no it's Dupree just step just okay
but all right so one thing that we do
want to go back to you click on yeah
click here don't get it
all right you know go through so yeah
yeah wrong key combination oh let's see
so did I do that
see let's propose it to reveal so now
dear let's see here we go
yeah okay work you've cut up a story
okay so as you can see we're actually
extending the reactive credit repository
now since we're going with Spring web
blocks instead of spring MVC not a lot
different you've got the same same
general things happening at least at the
higher level when we go in and take a
look at it though you can see that
spring data is providing a lot of the
heavy lifting for you a lot of the
operations in fact the operations are
the same or similar the thing that is
really stands out is the return types
and the return types are publishers
reactive streams publishers so you'll
see things like a flux of s or a mono of
s so it it kind of handles all these
things largely behind the scenes in
terms of the the interface the API is
very much the same as what you're
already used to be dealing with it just
gives you the reactive capabilities
throughout maybe I can present it a bit
with a few slides directive stack oh
sure yeah yeah that's fine
so give give my chair my 10 thumbs a
chance to rest here yeah so to present
sure it's a little bit of context spring
family 5 comes with two web stack spring
MVC and three map rack so spring MVC is
what you already know I guess from
spring boots and regular spring
application it's a blocking web homework
and docking is not a bad word I mean
it's perfectly fine for wide range of
use cases it's based on separates on the
servlet API and in spring for Mach 5 we
added spring web flat which is a non
working webcam work based on reactive
streams the use cases are improving the
scalability so regular web homework like
spring MVC use one thread for each
request response processing and with the
new one we are using a nonworking
processing that means we can deal with
more requests in parallel so it's
improved scalability it's more suitable
for streams like when you do server sent
events you are dealing with streaming
API like Twitter or you some swimming
API that you have on your companion
and it's also more suitable for latency
when you are building some macro
services thing or even just I mean for a
very long time we request remote rest
web services some of them are not in our
companies are sometimes low implies some
latency so that's a low basically to
continue to scale even if you are you
have some latency in you request
processing and so in addition to this
spring MVC stack based on service API
leveraging servlet containers and using
the regular annotation based forming
model this spring web flux new stack
make it possible to use tons of
led-based runtimes for example servlet
food so sorry for that one but that just
you see lower in the stack and it can
directly run with embedded nettie or
undertow and joins and I guess new ones
will will come later so reactive streams
is a kind of specification for
asynchronous and non blocking that I
exchanged between a publisher and a
subscriber
we have worked on that with other
companies like LED Ben Netflix and
others and that basically introduced an
interesting mechanism which is back
pressure so when there is a publisher
and a subscriber subscribe subscribe to
a publisher and then know that I sent by
the publisher the subscriber has to
request some data so it's an request of
one to three more elements and then the
publisher will send this element so
that's a kind of fine-tuning of the
amount of in-flight data that is between
a publisher and a subscriber and that's
a load - for example imagine that you
have a very fast publisher and a very
slow subscriber without back pressure
the subscriber will be overwhelmed by
too much data and basically it can crash
or go out of memory here instead of
putting a lot of that a lot of data in a
buffer and thing like that basically the
subscriber and the publisher will go to
the same speed and that's that's this
kind of mechanism
the exchange between the publisher and
the subscriber can be an infinite stream
that never completes or a Phoenix stream
which is a kind of a synchronous
Corrections an n-by-n AHA which is like
exceptions or a complete signal the
difference also is that you can begin
processing the first element that you
receive while with the regular list you
need to wait all the elements before
beginning processing it so that's that's
a key difference so web flux is
internally based on rocky streams and on
reactor because we use that reactive
implementation receive API
implementation internally but you can
use every reactive API or asynchronous
API that who you with reports we include
support for computer burst through
future flow publisher which is reactive
strips integrated in Java 9 every Java
one Eric Java to react oh and any other
reactive stream based API like akka
streams or watching which ones so rector
contains two main active types flags and
mono fluxes for is a record swing
publisher for 0 to n elements that
similar to throw a ball in Eric Java to
world observable if you you observer
with backpressure would say if you know
everyone it provides the different
operators and when you you develop with
such a PI you are using a functional
style of programming not imperative and
mono is a publisher for 0 to 1 element
and so that's a kind of reactive promise
Reggie future so we can switch back to
them to the code
yeah all right
so let's see anything that we L so we
want to do probably want to point out
the web client because in a if anyone's
covered from a spring MVC world they're
probably used to the workhorse known as
rest template for issuing your requests
getting responses you know dealing with
that which is very good in a blocking
fashion but it certainly doesn't lend
itself well to a non-blocking api so
we've created a reactive web client we
see that's actually here we're setting
that up to use in our various tests and
so just as an example here this actually
gives us a chance to showcase a couple
of things it's a very fluent API so you
typically will do a get specify a URI if
you need to if you don't already have a
base URI you're referencing and retrieve
that and this allows us to show this
because you can convert the body that
you're receiving back to a publisher so
a flux body a flux or body tamaño by
specifying the type here and then again
as you see on down through a very fluent
that we can go ahead and issue
additional operations against that
stream coming through so let's see
anything we probably should just go
ahead and kick this off right okay so
and no wrong way there we go
and obviously I'm not hitting the right
keystroke you want to run it yes yeah
no perfect yeah and that fact that you
know you need to write than so yeah it's
it's just command or control are on me I
don't know you think they'd standardize
this stuff at some point but it is what
it is okay so probably what we should do
now is go back here and that's probably
just the safest thing to do here is
refresh so we have current current site
being shown and let's go and let's do a
post because this gives us a chance to
show off some of the server sent events
capabilities because when you need to
publish you need to publish a stream of
values across to a web client the the
easy it well you have different options
with react project reactor you can
leverage server sent events you can
leverage WebSocket obviously server sent
events lends itself extremely well to
this because you're pushing values so
just a potential a small set of values
or an infinite stream of values over an
indeterminate amount of time in this
case we're actually using this to feed
notifications back out to our client so
when we do a post for instance we should
get a nice notification here so that's
kind of nice that we can use that
integration from back to front and have
a publisher that is just passed along
that way so thank you for your
indulgence in terms of the coding and
the awkwardness with the keyboard
Sebastian and I we're actually talking
about you know where to or how to
proceed with the next step I think just
because I want to make sure you all are
out of here by 3:30 this afternoon I'm
going to let him code the next next
section so that we can go ahead and make
that happen in a more expedient manner
but thanks Meg yeah so maybe just to
show you it was so what we have seen is
leveraging
a feature that is in in in spring that
are active which is exposing the
terrible curse also tuberculosis is a
future from MongoDB when you can get an
infinite stream from a collection of
documents and then when there is a new
document in the in the in the collection
basically it will send the event for
Java flags or flags of post events and
we just transform it to server sent
events here so we natively expose that
as a flags here and and that's how that
works so let's go to the step
fresh
and presentiments okay
so here we are going to talk about an
alternative way to specify you your
front end so you are now the regular ad
controller at request mapping homing
model from spring MVC and web flux
report that's so you can continue to use
the same annotation best for me model
using reactive type so that will be
controllers like we have seen previously
but using flux and mono are observable
flowable from Eric Java this kind of
thing but you can also use a more
functional API with web flex so in
addition to the annotation based poly
model we add the support for a
functional based API which is composed
by a router and unreal so unless
basically are just function that take as
input
it takes a server request and the answer
the response is a mono server response
so kind of future of server response and
here you see there is no ad request
mapping annotation so we just specify
the only logic but without any mapping
thing so defining the mapping will be
done here in inner water so you can add
one two three more Rooter in this
example simple one I will just use one
this API is available in Java and we
have introduced a cut-in DSL to make it
more readable so let's start by a simple
thing I will add a full route okay so
four routes that will
so let's import it several responses
okay and I will just print ad hocs okay
so took to church let's run it
okay
okay so here what I what I did
so this foo is in fact a shortcut for
request predicates so this one ting API
is composed you specify your request
predicates okay that takes the server
request as input and return a boolean
who are forced to know if that match and
then here I'm not using the Unruh for
now I'm just writing the Unruh in nine
directly here okay so this is a shortcut
so internally if you are curious that
just using I'm overloading the invoke
operator on string to do this kind of
trick and you can see that I'm just
using internally a path predicate there
is values various predicates you have
the predicate all that or when we return
true
you have method request predicates path
or the path predicate it arose content
type except so you can look at you have
various predicates and you can compose
them that means that I can write for
example
media-type so here I'm using the regular
media type API from spring we are we are
just reusing our usual stuff I import it
accepts is the request predicates that I
have shown previously and this n thing
is an infix function what is an intrigue
function so you can see in fix it's in
fact exactly the same than that but in
fix allow me to specify to invoke this
function without parentheses in order to
provide a more functional and readable
syntax so really this is exactly the
same this is not cool in keyword that's
something that they are added we have
added support for all and for nuts
so with that you can compose with values
requests predicates to add a custom
logic that will provide the route based
on the path and the accept and the
leaders in any kind of project like that
so hearin that should be maybe hand okay
and I can so I can write directly my
roots and my under so let me show you
something ok I can also obviously use
other routes so I can specify for
example the submitted so I can use power
okay
so I can do that kind of thing okay that
works for simple use case but usually
for real application I tend to separate
my route over from my own layer and you
see here I'm injecting references I'm
injecting my HTML on the user under and
post on ribbon so if I want to call them
I will do that to prove jokes so if I
want to build the same application that
I had previously we ingest let's let's
start from that so I will forget okay
that's a get method with a slash and
then we want to call
I think that's passed under and here I'm
using a metal reference to say okay
let's call my post on define all under
and here in my own well what I'm doing
no that's an to use the HTML under
that's for the web service that's not
the right one okay and then should be
better so here and I'm going to the HTML
under and then you see that I'm using
the functional API to render this page
so this is the equivalent of the view
report from spring MVC but provided in a
more functional way here I'm using the
syntax I have shown previously to
provide the model attributes as a map
and you can see that I'm also here I'm
specifying so I'm rendering the best
thing so I'm using that gets
so here um I think I'm using the slag
HTML posts in my post implementation you
see that I'm using requests that path by
available with the slack parameter
that's why here I am providing the slug
parameter here okay so let's let's test
if that works
Oh amazing
if I go there I'm using my second on
there okay
but our rest web services are not here
yet for example if I write post nothing
so let's let's add that so the another
nice feature of the functional Rooter is
that it's report nested routes that mean
if I won't make that only for HTML and
we write that that nest and then every
request predicate specified here will
apply to here okay so let's use that for
doing the same for our JSON web services
okay
application design then this time this
is the right time to use my post and
user under so for example I will write
get slash post and I will call my post
under that final with a metal reference
okay
and if you want to write that without a
metal reference you write
to to to choke excuse me okay you write
that and that will be the same okay if
you want more detail I can specify
explicitly that's that's a rack
parameter that may not a parameter okay
that's the same since we can use the
default parameter I can do the short
version which is that so here in this
lambda the parameter I get is a request
the server request and since I think
that's a better syntax to use metal
reference in just the equivalent of that
okay let's add our so this should be the
slug I think again here I'm using fine
one I can check fine one is the HMDA
okay it seems I'm using strokes which
would work you see that here I'm using
both past and past so maybe we could
continue to use this fancy a nested root
thing to write post okay that nest then
I put that inside then I remove
basically I put everything in come on
there and that should work I can do the
same for my users
so user here I'm using my juicer on the
same here so this is not a slug this is
it may be a login
let's check ok all again final user
should be good ok so so I think we are
going to check that that works obviously
because ok amazing if I take the slug I
can check that it works you can check
the users that's work and if that work
so I think the interesting thing is that
with that syntax it's maybe more
readable for coding developers that's
that seems to be from the field I can
add more idiomatic way to to develop web
application whether that putting
annotations everywhere
you have the choice so I have really no
recommendation for that you can use the
annotation based programming model
because you are used to annotation from
swinging will see or you are just fine
with that you can use that new feature
that allow you to have a slightly
different API that allowed to basically
have all your routes in one place you
can also split it the difference is that
with annotations you are forced to split
all your mapping in all you add
controller request mapping classes where
here I have the possibility if I want to
put all my routes in a centralized
routing thing that is also compiled it's
a bit kind of declarative API and I have
the choice to put everything in the
rotor split the rotor and on wheels like
I did in this example and I can also
obviously specify so this is a post
request
okay and if I want to do save and here
and this model is is so you you don't
provide any fancy method parameter like
with spring MVC so that's maybe more
yeah different ways to specify that and
that's up to you - Joe can I show you
can also delay it's okay to let
specifying the slug and providing first
under title it if I go back to if I get
the full version because so and check
out step 4
okay so in this version you see that I
have also added the service and even
thing so get a slash API slash post /
notifications I add my other condition
request predicates about the text event
stream and then I invoke so the
notification so this one is and here I'm
using just okay dot body to service 20
events and that's that's all you can see
that here we are leveraging or so we are
averaging 15 extensions so if I go to
the detail so this is cutting extensions
and and maybe something interesting to
show let me show you that if I go to the
source code
okay you can see that this several
requests extensions which is specific to
Kathleen is directly provided in the
spring from exhaust so we don't add
cutting support with an additional
spring cut in JA it directly provided in
the regular spring hummock dependencies
if you are doing a java project is just
not used but if you are doing a cutting
project this extension will be available
by default in your class path and you
will be able to import import them if
I'm back to the source code you can see
that's like the extensions I built in my
previous example but here provided to
provide the coaching API cut in specific
API in addition to the regular buy one
so when you are using spring in a cotton
project you have all the regular Java
regular API and most of the Java API is
the same that you use for cooking but we
also provide additional staff that will
ask for example here to leverage the
rail fight type parameters that's an
horrible expression to say that codeine
is avail
in cutting it's possible via inline
function to retrieve the generic types
of at word time and then get the get the
class out of it so in practice that
allow us to to overcome type a residual
and in the in this kind of code instead
of having to write okay so instead of
having to write post class dot Java okay
this colon colon class the Java is not
super nice so it's I think it's better
to this kind of notation leveraging the
general type parameters is quite usual
in Kirkland lesson in in Java but you
can see that it's it's read it read
better
I think we are ok you can see here the
nuts
this is also an extensions you see that
in the in the Kirkland SL what I do is
that I am adding a nut operator to
request predicates to be able to negate
that with that kind of syntax DSL in
Katrine are less powerful that in scaler
and that's on purpose because I don't
want to that's a certain level of fancy
stuff and maybe when you come from the
wall say who let strange but we can't do
anything and we we are limited and we
can't do super strange GSL like in Skara
so there is less less power less
flexibility here but that's on purpose
we want to keep that in control and
that's the most fancy stuff that you can
do I think with this kind of dsl I will
so I have a torque Wednesday little bit
of advertising when I I will go more in
detail about all the feature that we
support in spring that like a spring
boot - and spring framework and I will
show funk bean decoration DSL that
allowed to declare beans with an
additional DSL we provide two DSL in in
spring for Mach five this one for the
routing and the other one for the beam
decoration and I will also talk about
corrosion support with a row - basically
so this is a community project but it
allows to leverage the web flex stack
while keeping an imperative programming
so basically when it can allow you to
migrate to spring MVC application to the
non-working framework we with just
keeping the same programming model and
we will show that Wednesday so you are
free to come to see the talk and I think
we are done do you see another thing we
could show okay so do you have any
question we have a little bit so some
time left is there any question about
this second thoughts
yeah
to the Rooter
yeah maybe here we have tried to to keep
the same logic that in spring MVC at
request mapping and indeed maybe week we
could we could provide that and in even
more type safe way so there is maybe
improvement possible an interesting
thing is that this DSL you can extend it
yourself
I mean if for example for example for
the future it's not done yet but we are
discussing with Rob winch about adding
security a featuring that that way we
specify directly security in the DSL to
say okay this part with a nested block
this part will be protected by basic
odds
this one is protected by odd for example
it's kinda thing she's not done not done
yet but you can also extend it for you
propose it's it's possible but yeah good
good idea maybe either with something to
do them another question yeah with the
reactive stuff yeah so debugging is
definitively other because with the
reactive with the reactive stack
basically you we are using reactive
applies in a nonworking way and the
stack that we have for example are much
harder to debug so reactive stack is not
providing a non-blocking reactives
web stack is not a free lunch what we
provide to make that easier is that by
default the stack trace mode of rector
is neighbor the stack trace mode is a
feature of reactor which is enabled by
default in local with the spring boot
dead extensions which allowed to
basically when you have an exemption
thrown it allow you to go to the source
that produces this exception because by
default with reactive and networking
runtimes
you basically just have a synchronous
schedules and you can't see when there
is an exception
what causes that with the stack trace
mode available
only in the mud that's that's possible
it has a cost in terms of performance
that why we only enable that on
developments we are thinking with
different margins among best way from
the Elector team to provide even more
stacktrace cleanup to have more
nice-looking nice-looking stack also we
need to I think finally Tunes when there
is an uncatchable in web flags I guess
we can do also some stacked wise clean
up on that we are also have in mind it's
not developed yet but basically
retroflex and mono expose some metadata
in jizan for example if you want and we
have some prototype of reactive
dashboard that's a load to debug you
streams in life that we can build for
example a react application or angular
dashboard that allowed to see that there
is too much data on a part which is
blocked on a stream and the risk too
much data in a buffer and debug that
visually so that's things that we are
that are expected in the future not here
already but yeah currently with the
stack trace mode and yeah we will try to
work with ID also provide some kind of
helpers to debug streams for example
there is some ongoing work to improve
debugging experience but that's that's a
good point
when you are using a reactive directive
stack so the beginning is is harder yeah
yeah
yeah so a scholarship odd question yeah
good one
so in spring the attack a we provide
native Radcliffe support networking
support for every database that provides
us such low level driver that means that
we provide reactive support for MongoDB
for readies for Cassandra and for
codebase we currently do not provide
specific support for other non reactive
drivers and a big part of that is SQL
databases you can you can use that I
have not shown that but you can
basically create a thread pools and use
regular JDBC booking drivers and by
doing that trick you can use a regular
API with the new web flex remark that's
not something we promote as a
first-class use case for now because
yeah we already add a lot of things to
do with a new reactive stuff and since
there is an ongoing discussion about
assessing JDBC which is a very long-term
topic but recently at JavaOne it seems
to there is a revival of that question
so there is currently discussion and
mailing list with a record guys which
are working on acing JDBC which could be
a nice basis to provide a reactive
access to SQL databases and that's
basically ongoing experimentation and
process and evil for Oracle that's the
very early days of that so we prefer to
say ok there is some open question how
do you support transaction with a
rectory in the interactive world
for example we need to to change our
current thread local based transaction
and support to something that will be
based on
reactive API so be aware that reactors
report a context context could be used
as a replacement Jerry Kelly to deal
with transaction with security and we
are working on that but that's not ready
yet so we prefer to to weigh the risks
report for loader instead of providing
some kind of trick with this thread
Locker which will still consume radish
shreds we prefer to walk
and to work in this case about a single
DBC support C alpha that goes and even
where you have to leverage that rather
than providing some super holy earth
base SQL support no question yeah
yeah so that's a good question in spring
MVC we can write that with mocking BC in
spring web flags we have something
called web test client which is
equivalent sadly this is the only and
single API we can choose for now in
Catalan because there is an issue a type
inference issue in curtain one
even 1.2 I push very hard to get that
fixed in Kirkland 1.3 so have a look in
the Spring Framework documentation there
is a dedicated section to web test
client which is an even more powerful
and easy to use alternative to mock MVC
it's currently super nice to use that in
in Java and in curtain it will be I
guess when cutting 1.3 will be released
I guess next next year but for now so
that that's why a web web test coyote's
induce labor in in mock or non man
contexts you see that migrated to web
the sky on when this horrible bug we
will be fixed so if when cutting 1.3
will be here and if they fix that and we
do my best to get that fixed you can use
web tests ions which provide you
basically very close API
it's like web science but you have some
you can assert that body as some JSON
content you are high level features to
check back there is ITER's and thing
like that so you have assertions you are
high level assertions to test that and
when you use the mock mode it directly
tests the functional or non-functional
so the web flag Sandra's without going
through the network and you can also use
that too for your regular integration
tests so that's basically the clay since
we have built the client and the server
together
we have made a special mode where
basically we can mock easily the clients
to not go through the network and
provide some elevator sessions okay I
think we are done so you can go to my
talk when nest Day Afternoon if you want
more details about the rest of this
report about coroutines about values
other stuff and thanks for being here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>