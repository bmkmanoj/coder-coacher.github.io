<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Reactive Spring by Juergen Hoeller and Josh Long | Coder Coacher - Coaching Coders</title><meta content="Reactive Spring by Juergen Hoeller and Josh Long - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Reactive Spring by Juergen Hoeller and Josh Long</b></h2><h5 class="post__date">2017-08-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TZUZgU6rsNY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's get started because we get quite
some ground to cover
a well warm welcome from my side from
our side yeah this is me Jurgen and my
dear friend Josh here up on stage for
you
hi so we are here today to take a selfie
now to think yeah at the mandatory right
just one selfie sorry
so has to be what we're going to do huh
there's a lot of you we're going to take
a selfie and I want you to all get into
a group huddle or not fine okay don't do
that don't know just keep shooting we're
just in Salem
just pretending you're happy yeah wait
okay coming your little ice friend
lights camera audience OH
AV people whatever okay Jerry Koosman
well first off you all in there's a
thousand people don't look around is a
million people cuz I like a happy one
two three open source open source one
more huh that's it has to be good enough
thanks for the lecture yeah anyway okay
so for today's session we are going to
introduce you to our reactive
programming story not only in spring
five itself in springtime AK 5 which may
be your most immediate reference we're
doing it more from the ground up are you
going to see a little bit of a reactive
non core repository you're going to see
quite a bit of reactor API usage and a
little bit of spring wet flux in in
Spring Framework 5 itself the motivation
for well reactive programming in general
is worth the talk on its own but I'm
going to give you a brief introduction
we decided a number of years ago to
focus on a spring style reactive
programming model and it's been a long
time coming finally released now out of
the R&amp;amp;D stages right into spring from
excited Oh proper so the spring time at
5 is already
gee a plan for late July is going to
include the entire reactive programming
story however we are not just starting
from scratch we're actually building
we're actually building on a a project
called reactor and currently approaching
its 3.1 release project reactor is a key
piece in the puzzle it's our our core
reactive engine it's a separate project
not spring branded because it's broader
in terms of its field of views but it is
the foundation of everything we are
doing in the reactive space in in Spring
land so project reactor essentially is a
reactive kernel along the lines of our X
Java so just maybe a quick quick
opportunity who's familiar with our
Ixtapa at least a little bit familiar
with it all right
well it's great because you're going to
find yourself comfortable yourselves
comfortable with reactors API as well
reactor and arc Java are very much
aligned in terms of their their
terminology in terms of their operators
their signatures however reactor is a
more more focused tighter arrangement
it's Java 8 based can make use of Java
util function interfaces out of the box
it's more server oriented and it's
distilled down to two entry level types
called flux and mono so just in case
you're wondering mono means it's going
to reappear many times in this talk
those are the two essential reactor API
types comparable to our Chavez
observable and single or flowable maybe
there they basically represent a entry
point into composing a reactive
processing pipeline with many
convenience operators and certain
semantics attached flux representing a
hot stream of elements and mono
representing a single element or non
both three actively enabled both
implemented as reactive streams
publishers
so what's react extremes this reactive
streams is a an industry initiative
several collaborators both from from
light bands akka arch Java and project
reactor on typical send where there is a
consensus on the underlying mechanism
your your choice of infrastructure
interacting with each other at the
lowest level through their reactive
strings mechanism reactive streams is a
very straightforward specification it's
basically just a bunch of interfaces a
publisher type a subscriber site
agreeing on a subscription with a very
straightforward minimal mechanism for
implementing a degree of flow control at
runtime reactive streams is essentially
something you're not working with
directly really but the pieces of
infrastructure that you're using when
composing a reactive stack agree on the
reactive streams mechanism underneath
the covers so rxjava 2 is reactive
streams enabled project reactor is
designed for reactive streams out of the
box many modern-day reactive streams are
reactive data store drivers are reactive
stream space and it is a mechanism of
flow control we're going to get back to
that it's called back pressure and we're
going to elaborate a little bit on what
that really means a little bit later on
alright this is essentially the what we
started with but in the end we are
building an entire stack for modern-day
reactive applications reactive web
applications in particular so let's get
right into it with a little bit of code
a little bit right on so I think we
should you know building upon that we
should build a sample application
something that we can use to demonstrate
the different pieces in the stack and
we'll start with reactor as the baseline
you'll see reactor throughout the code
that we're going to look at today but
remember at the end of the day that is
just the foundation right we can't build
a modern application without stuff above
that right so this is where Spring has
the opportunity to really come into its
own and shine that end to end sort of
experience so we're gonna build a sample
application let's build an application
that manages oh I don't know let's say
we had a service some
sort of service on the Internet some
sort of service that allowed us to
manage or interact with Oh movies right
in and in colloquial English you could
say you could call a movie a flick right
in the plural of flick is slinks right
so if we had some sort of service over
the net that allowed us to interact with
flicks some sort of net service that
allowed us to work with clicks and we
want to have it in the spirit of what
we're talking about here as you can just
explain the the reactor API provides it
two specializations of the publisher
interface in new acts extremes
initiative one is called a flux and then
there's kind of mono so maybe we could
call our service net flux right so we'll
build a very simple application we're
going to build a very simple application
to manage movies on the Internet right
we're going to just a simple demo
application we don't care all that much
about it
I'm going to call this the flicks flux
service and in order to build this
application we're going to use spring
boot to that oh now mind you this is
still milestones right this is not a ga
release yet that's do end of the year
before spring one hopefully and so we're
going to take advantage of early early
days technology here yet but even so
there's a lot to play with right lots of
to work with so we're going to build an
application that takes advantage of
spring support for building web
applications reactive web services we
use Lombok which is a annotation a
compile-time annotation processor and
then we have to choose the data access
technologies and you notice that if I do
that if I go to the data access here I
can see there's a lot of different
options here there's reactive red
attractive Cassandra and reactive
MongoDB and there's there are even other
options that are even further still
supported by Spring data but the spring
boot project doesn't yet offer Auto
configurations for those yet that will
come in time so we're left with these
three choices and we can choose any one
of these for now but I like to use
MongoDB because it's very familiar how
many of you are using MongoDB just
curious very curious okay see MongoDB is
a fine choice for our demo because when
you want when you want to lose all your
data for no apparent reason at random
times and you want to lose it reactively
there's no better technology than
reactive MongoDB so we use a reactive
MongoDB there we go and we're gonna hit
generate lettle give us a zip file right
hopefully Wi-Fi permitting that we can
open up or not IDE so here we are
downloads unzip flex flick service go to
the directory here and I'm just going to
open this up in my ID and it doesn't
really matter what IDR using there are
very few of us who can do expert things
and text editors like dr. Subramanyam my
hero and friend but I'm going to use an
idea that a IntelliJ JetBrains that's
one fine choice Eclipse is fine you know
let me define how many of using Eclipse
I'm just curious just curious good stuff
right on what about IntelliJ
okay that Mouse whoa what about NetBeans
what about NetBeans anybody okay very
good right on so while we're at it who's
been using stock up spring that IO
before just curious right on cool very
cool
and what about Emacs are you here sir is
is the Emacs guy here that's always one
guy every single girl game every single
city continent and country that I go to
I asked that question and it's the same
human being the same object identity I
say who uses Emacs and he says I do
and then he leave presumably just roll
again at any rate we've got an
application right we've got a very
simple application and what we're going
to do is going to build an application
that manages movie so the first order of
business is to build just that a movie
POJO an entity that we can persist in
the database using spring data MongoDB
so I've got the document annotation here
that signals that this is going to be
persisted as a document in the MongoDB
database and I've got running on my
machine
I'm going to give it a primary key you
know a surrogate your unique IP there
and I'll give it a field string title
okay title okay there we are now this is
Java and if we were using Kotlin this
would be far more concise but could be
using coupling Ryan great choices out
there they in Java 8 and Lombok right
right so I'll use a Lombok which is a
compile-time annotation processor to
make short work of creating
getter setters constructors to string
methods etc right and with that in place
I want to be able to you know read and
write and persistent manage entities in
the database so I'm going to create a
repository in here we come to our first
bit of familiar
we're going to create a movie repository
using spring data but we're not gonna
use the familiar Mongo repository we're
going to use the reactive Mongo
repository right this is very similar to
the regular Mongo repository except that
the return guides are publishers and the
input parameters are also publishers
right so this is a mono it'll return 0
or one value this is a flux that'll
produce 0 to end values right and we
have that now we can actually save data
into the database I want to have some
sample records with which to work so
we're going to provide an object that
implements command line Runner now
command line runner is a a component in
spring boot it's an interface in spring
boot that when spring boot starts up
it's going to call the run method as a
callback you know allowing us to do kind
of any kind of initialization work that
we want to do before the traditionals in
our request response flow of the
application this is your public static
void main args array for example right
so what I want to do is I want to create
a bunch of movies and I want to use the
theme of reactivity of a functional
program I want to use this theme to
generate some name so I'm going to say
flux just and let's go ahead and you
know come up with some movie names again
inspired by this theme so one of my
favorite options one of my favorite
titles is inspired by my friend Phil
Webb the co-founder spring but-- Silence
of the lambdas right very good very good
and there's there's a there's a popular
anime Aeon Flux right or enter the mono
void right what's that movie what's that
movie I'm sure some of you can tell me
there's a movie that's a popular sci-fi
movie where they have a flux capacitor
who can yell that out thank you back to
the future I always forget that one
right back to the future and you know
I'm sure that you will think of others
and if you do think of them
you should stop us right away that is
the most important part of this talk
there's nothing else so let us know if
you find them or better yet maybe don't
do that but just tweet it we'll make
sure to include them in future talks
let's see the flux inator right there we
are
uh meet the fluxes right lots of
different names there right so we've got
a we've got a a flux of names movie
names right what I want to do is I want
to take each movie name and I want to
map it I want to say that I have the
title I want to turn it into a movie ok
there we are
come on computer do the thing very good
and I'm going to quit passing the title
the title is title okay and we're going
to create a unique ID random UID there
we are and then I want to take that
movie I want to persist it so I'm going
to say flatmap movie or just a my guess
M and I'll save it to the repository and
save M now this is interesting it gives
us a response it gives us aside gives us
a a flux right am I done has this
actually worked right is this what's
going to happen when it's almost almost
right there we we specified what needs
to happen but we are not actually
triggering it yet because they a
reactive type I reactive streams
publisher doesn't actually do anything
at all until a subscriber is being
registered and the subscriber is
actually asking for elements of data to
be published to be produced so in order
to put this into action we need to
subscribe right so I'll call the
SUBSCRIBE method and there's there's the
obvious the usual suspect as a consumer
that takes a movie that's certainly one
option but I'm not really you know I'm
gonna I'm gonna run this code after
everything has been written out right so
they subscribed method will cause
everything to be written out if I'm
interested in the emitted values the
values that are produced by the
publisher I can provide a consumer but I
don't care about those values I just
want them to be written so that's that's
irrelevant
I can also provide a consumer in the
overloaded version that handles the
exception if there's an e a throwable
but I don't care about that what I
really want is a runnable that when the
code is done I can call and it'll just
list everything that we have here all
right I'm going to say subscribe to all
of the data so I'm going to say print
out every single record that comes back
and then confirm that we've got it in
the database so here we go that should
be something right
let's just run that code and see what we
get now it looks like it worked but
something is afoul right something the
name okay we've got duplicated data you
see it's already persisted some earlier
records from earlier incarnations of
this code of this talk you know the
expression a broken clock strikes true
twice a day even MongoDB will save data
occasionally right so so we've got to
make sure that when we run this
application we clean up MongoDB so this
is a good chance to demonstrate a
dependent call what I want to do is to
run this code run this functionality
after we've deleted all the data so
let's just streamline this just a bit
here okay so I'm going to say movie
repository dot deletes all and then I'm
going to say that I want to do a then
mini and I'm going to pass into
publisher the publisher in this case is
just all of this alright so here we go
that code gets run after the code you
know after the the the publishers run so
now we have the same basic setup as we
did before but it's just a little
cleaner so let's try that okay and we
didn't we didn't do the thing we didn't
do the wrong way I the first cut of this
code was the first cut of this code I
did like this I did delete all and then
block and I showed that to my girlfriend
and she looked at me like I wasn't very
she looked at me like she was
disappointed like she had made a
terrible mistakes and she was
reconsidering the things so that wasn't
the right way this you know the code is
no more complex as we've done it here
but now we've benefit from the fact that
behind the scenes there's something
that's going to call that at the
appropriate time right anything else to
add my friend no looks like a
fine-tuning to me okay very good so now
is that data in the database and what I
want to do is own able to talk to that
database right so I want to build us to
interact with that data in some way and
I could use a repository but if I have
any kind of course or business logic
then I'm going to have a service or
build of service here I'll say this is
going to be my movie service and this is
just a spring bean it's annotated at
service and we'll annotate with that
service and I can imagine at least three
useful end points or three useful
services one is a
service that returns a single movie by
its ID right so string movie ID and we
are okay whoa okay and I can imagine
wanting to get all of the movies right
in the flux so flux movie all and
there's this and I can imagine wanting
to show information about who's watching
videos right imagine if we did actually
have a bazillion people logged into our
service logged into the system streaming
videos they're watching videos and we
had the opportunity to tail the logs in
essence we're streaming their streams
right so I want some endpoint that gives
us that information so we could look at
all of the movie events in order to do
that I need a new entity a new POJO a
new thing called a movie event and
that's just going to contain a movie and
a date right when it happened so what
movie is being watched and when it's
happening and we can use Lombok to make
short work of you know creating the
constructor and all that stuff so
there's this and we'll say public a flux
of movie events events and this is of
course for a given movie right so here
we are return no now I think the first
two of these are pretty straightforward
this is pretty straightforward we can
inject and work with the movie
repository as we've done before and then
just delegate to that right so add
constructor parameter and we say movie
repository dot find all very good not
bad movie repository dot find by ID now
sorry we were positing find by ID
passing in the movie ID and then for
this one this one you know we don't
actually have a bazillion people logged
into the system so I want to fake it
until we can make it you know we want to
have an endpoint that just returns new
data in perpetuity forever and ever and
ever right so we're going to generate
two fluxes we can have a flux dot
interval and the interval is going to
say you know it's going to generate a
call every second one every second
duration of seconds right so there's our
first insert or foot or first flux it's
going to be generating a new value every
single interval and the second flux is
going to generate a new movie event
whenever it's asked whenever it's you
know expected right so a movie event and
we're going to do this by saying flux
from stream and I'll use the convenience
method stream that generate and just
provide a new supplier object and that
supplier is going to provide it's going
to provide a movie event when asked and
then to create the movie event I need to
pass it a movie and we haven't gotten
that reference yet so let's worry about
that in a second right we're going to
we're going to look it up by using this
movie ID in a second here and we need to
provide the date so let's just imagine
if the movie is coming in and we've got
a new date every second right every
second now what I want to do is I want
to grab a new record from the first flux
every time a rather a new a new value
from the second flux every time there's
a new value from the first one I want to
move in lockstep I want to gate the
production of movies movie events to the
cadence at which I get new intervals
right so of course this is going to be
limited to one flux at one value every
second and we can gate them by ipping
them together right this is an operator
in the reactor library so I'm going to
say zip interval and zip the movie flux
and what that gives me is a a flux of
tuples and the flux of tuples has you
know each value that gets produced is
both a long from the first one and a
movie event from the second one and I
don't really care about that you know
really the composite value I just care
about the the second value right so I'm
going to say tuple to get t2 right here
we are so there's that and I can return
that code now that's fairly
straightforward three fluxes but I still
haven't talked about how I get this
right we this is a dependent value I
can't execute this code until we've
arrived at this value so what we're
going to do is going to just call the
other thing there and I'm going to say
when I get the mono that comes back from
this the thing that has a single value
when I get that mono I want to return I
want to transform the matte matte the
mono into a flux so I'm going to say
flat map mini and just return all this
code here we are okay there we go
there's our events endpoint and we're
just you know it's a synthetic thing but
this gives us the ability to now build a
REST API right and there's a few ways by
which we can do this do you want to is
anything when it adds to this people
remove on my friend is this
of course these events and point is sort
of a little bit artificial resonating
generate artificial events but it does
showcase a few nice things in terms of
what reactor can do it also this is a
clear hint that there's some some
scheduling going on in the background
because we are instructing our pipeline
to produce in a signal every second and
to correlate every every time we get a
signal we generate and remove event so
in the background here even if nothing's
actually happening until the subscriber
is registered it is all prepared to be
scheduled on reactors scheduling
mechanism and they need to covers at
runtime a reactors runtime library a
record kernel has a very specifically
tailored scheduling mechanism underneath
the covers usually configured along the
powers of the underlying hardware so
basically the number of threads matches
with the number of CPU cores and it has
some really smart scheduling of the
individual callbacks that we build into
our processing pipelines here and we
leave it up totally up to the runtime
environment to make the scheduling
choices for us so we are kind of
declaratively saying what we want at
runtime what we want to happen we leave
it up to the reactive kernel to make the
scheduling decisions for us and to defer
execution to the best possible degree so
once a subscriber comes in and once the
subscribe is actually capable of
processing it then and only then the
reactive engine will start scheduling
our actual tasks right on and that we're
going to pass this which these return
values to the next level up anyway so we
don't want them to start processing
until that is ready to do it and that
next level up in this case is going to
be a web tier right and so there's a
there's a couple of options that we're
going to look at I think we should ever
so briefly take a look at the rest
controller style maybe just an illusion
version so yeah we have a nice
repository we decided to do a service
layer we would not have to have hyper
service layer in necessarily but it's
fits our purposes here we need a web
endpoint now a web controller and we can
we can as a first cut we can look at
something that should seem all together
very familiar if you've ever used spring
MVC this is a net
new runtime inside of spring 5 it's
called spring web flux and it looks very
familiar very familiar it's very firm
ground for anybody's coming from spring
MVC
but there are some concessions to the
fact that ultimately this is a reactive
runtime not a traditional a servlet API
is the design is intentionally analogous
to spring MVC provides a degree of
familiarity reuses the general handler
method models lexical arguments
signatures flexibility types it reuses
the actual annotations so what we're
seeing here is rest controller the
mappings those are all the same they
literally same identically same
annotation set also being used in spring
embassy but ultimately we're building
web endpoints for their reactive web
framework that we call spring web flags
in Spring Framework files this is its
own web framework with its own
limitations and its own semantics
it runs on a reactive engine underneath
the covers on our reactive HTTP
abstraction can run on nettie which it
does here underneath the covers it can
also be adapted to a server through that
one container we actually have dedicated
support for tomcat for charity 400 so
not only for their asynchronous i/o
mechanisms but also for their data
buffer capabilities so we can actually
build a reactive web stack not only with
net C but also for example with Tomcat
and Chetty but we're not even dealing
with this right now let's just assume
this is running in a reactive web stack
at runtime the main difference here so
spring MVC is the purpose of the handler
method what is the handler method
required to do here it doesn't it isn't
being invoked within a servlet request
thread and it doesn't own the servlet
request and doesn't generate the service
response it has a different purpose
it gets invoked dispatched to at runtime
if a corresponding request comes in that
matches its mapping and then the
runtimes going to ask for erected
strings publisher
basically being able to produce a
response for the given request and
that's literally what the handler
methods return area clip streams
publisher a flux or a mono
once the runtime environment decides and
figures out
can actually write response elements out
to the HTTP response string back to the
client then it registers a subscriber
and the subscribers going to start
taking elements from our publisher
that's a very lazy mechanism if for any
reason the response dream gets cancelled
when your recent there's congestion in
the network the publisher is not
actually going to produce anything
that's our flow control coming in again
so the we have all the powers of a
reactive round time processing stack
with a familiar programming model right
that's a feature so let's take a look at
that in action I've taken a Liberty to
code this up I think that'll work we've
got an end point for the IDE and for the
event and for the all method now there's
a mistake in this code but I want you to
buy a way of illustrations see what it
is but there's my my movies endpoint
I've just called and we get back to
let's just pick any particular ID there
and we can say now paste and that gives
me that one record and now let's call
the event endpoint right that that
events point is just that events in
point is supposed to just give me
everything forever right
well curl isn't expecting that curl is a
pretty simple client it doesn't expect
to load you know JSON that'll last for
till the end of time don't eat that
right it's expecting to be able to get
to the end of the buffer and then we
turn it to the client representing the
console here it's expecting that because
we're calling an HTTP application JSON
encoded sort of endpoint instead we need
to give it a clue that the data that
we're sending back is of a type that may
never set fate right so we're going to
use the server send event
protocol here right this is a different
kind of way of sending data back to the
client and you know the clients are
going to be they're not expecting to be
able just wait for the response it's a
server sent push basically so I can say
given the movies and I can ask for an ID
here so here's my ID okay copy we paste
that in good no problem get the events
hey there you go very good so we've now
got the data framing this is going to go
on and on and on forever and ever and
ever and ever so long as there
stars in the sky movies being watched
movies being on when in the world bugs
in your code just forever and ever and
ever so we've got that right we got the
service and event thing that's working
just fine and this is certainly nice
it's a nice approach but let's take a
look at a different approach right one
that's inspired by some of the other
programming models in the ecosystem if
you've ever used Sinatra in the rails
world or in the Ruby world rather than
metal feel very familiar spark Java and
Rat Pack and the JVM ecosystem have a
similar programming model basically this
is called the functional reactive
approach and it's a you know if you
haven't used this before it'll it'll
it'll feel a little unfamiliar but it's
very very cool the way it works is we
create a route function and we describe
in that route function the request
predicate either eg that we want to
accept requests that come into movies
and we give it a handler function a if
function is supposed to handle the
request and of course you can see that
perhaps you can see that yes it's great
just about grade you can see that this
is amenable to being converted into a
functional interface or to a lambda
because it is a functional interface so
I can actually extract this
functionality out into a separate
component into a separate method and
then do the work at there so I could you
know for convenience I like to create a
handler right movie handler and this is
just a component that'll have methods
that can be coerced into this lambda
type so here's a movie handler for all
methods here's another one for our all
movies rather here's another one for by
ID and here's another one for the event
and we're just going to use this handler
instead of doing the code in line you
could do it in line but it might get a
little hairy if you have a too much code
one place and we have a small screen
real estate here on the stage so we'll
make it a little easier for us to focus
okay so there's all of them right we're
just going to use a method reference
there and we can say and route request
predicate dot get movies movie ID and
pass into by ID and then do it again for
the events yeah so events movies movie
ID events handler events very good so
there's our route configuration and of
course this is a little tedious but you
can get rid of that by using static
imports to add on-demand static imports
for that and for this one or not come on
computer we'll leave that alone
so anyway now let's implement this code
and this handler requires us to use the
service which we created earlier that
that service is what makes it so easy
for us to switch out implementations
normally you might just get that step
right because it's not all that much
business logic you could just go
directly to the handling in the code
itself or the handler so well our
purposes we're reusing the exact same
reactively enabled movie service that we
built before that our annotation based
controller was using but we're now
building a different styled web endpoint
tapping into the same the same reactive
service operation so you'll notice that
we're creating a response dynamically
here and we're sending back as a result
the publisher and the publisher of
course is expecting in this case a movie
ID which is part of the mapping
definition so we can say I want the path
variable for the variable called movie
ID and we can pass that in here movie ID
and here again we tell the publisher
what kind of data we're sending back
again in the spring MVC style handler
methods the runtime the framework can
infer that by looking at the return
value it's a flux of type movie but we
need to give our our one time an
opportunity to send data back and to
figure out when to sort of close a frame
packet and our payload basically we're
doing data framing we're given a clue
about when to do that right if we had
ratified generics and we would need that
you used the Copeland's variant of this
routing DSL it's actually streamlined in
that respect because the coupling
language has rewired generics so for
everything we're doing here we also ship
copying extensions in particular for the
routing DSL that make up for a really
idiomatic configuration style endpoint
definition style in coupling but for our
purposes
let's stay with with Java ATM go with
what we know here we go so we re
implemented the same endpoints now with
the aberrant implementation style so we
just double checking
is it still doing I forgot your content
type again so oh yes
events I was I on our standard mistake
and type via type text edit stream
otherwise curl doesn't once again
doesn't know the streams no bending okay
movies and grab this ID paste grab it
have the event please good very good so
there is a we've got our you've got our
gutter events we didn't using spring MVC
style controller methods as well as the
function reactive endpoints maybe a few
words on the design application can we
go back to the source code yes somewhere
so we literally re implemented the same
end points with the end points with the
same behavior in in a different style
but where's the trade-off here and there
are quite a few the annotation based
model has it's it's clear strength it
has declarative mappings it has flexible
argument signatures flexible return
types none of this is present here this
is essentially a programmatic
functionally styled routing DSL with
router functions and pointing to handler
functions making the best possible use
of Java 8 language features and there
are coupling language which is if you're
using coupling but Java 8 language which
is here so you could use enzyme lambda
expressions for the handler function or
you can point to a vexed at out delegate
method as we're doing here
which we actually recommend but you can
still use Java 8 language features and
method reference in the Java 8 method
reference model of course there is a
target functional interface that we're
binding to so all of our endpoint
signatures have to comply with the
signature of that functional interface
and that's handler function handler
function has a server request going in
and mono of server response going out so
we are tied to that all of our methods
have to programmatically interact with a
server request and they have to build a
server response so it
it comes with a different set of
trade-offs but it is entirely
programmatic there's no reflective
dispatching there's no annotation
resolution here so it is extremely
efficient in in in that sense it is also
of course a styled very familiar from
functional composition models out there
in the wild right so it's not a it's a
style where we've been inspired by
certain industry trends towards
functional compositional api's
absolutely it's a it's a kind of nice
balance it's two choices that we're
offering for implementing reactive web
endpoints your choice or whatever
appeals most to you right for a smaller
set maybe a Microsoft model three four
or five endpoints the routing DSL is
super sweet super nice fits on a single
page even with inline handler functions
maybe with lambda expressions in line
whereas for a larger web surface with a
decomposed model decomposed endpoints
the annotation based model of course has
has its strengths very clearly right so
it's a it's a choice that we're offering
between those two but as we see here you
can implement the exact same behavior in
both models and you're using the same
runtime infrastructure underneath it's
the same waveflex framework the same
reactive HTTP abstraction the same our
same handling of the netting engine the
same use of the reactor kernel it's all
the same infrastructure the same codex
port leg in this case the JSON
translation so the same reactively
enabled codex all of this is the same
common infrastructure underneath just
two different ways of tapping into that
stack right on exactly so two great
choices choose the one that you prefer
they're great they're the work fine
either way now we've got an application
we built a HTTP service that's talking
to a database and everything so far has
been reactive right we're not blocking
at any level in the application so the
next logical step at this point usually
for me is I think I start thinking about
security right this is going to be an
application that I want to deploy
hopefully and in that world you know
security is an important factor so I
want to introduce security into this
application and this is an important
consideration because the last thing
that we want having gone to all these
lengths
to introduce reactive activity at every
layer from the web tier other than that
it is database tier and in fact in the
programming model it's been block or in
a bottleneck at some sort of
thread-local in this you know holding
your security context or your
authenticated principle so thankfully
spring security 5 is on the horizon and
it has built upon spring 5 and all of
the reactor reactive API that we have
therein and we can use that in our
application here so let's go ahead and
just secure this service very very
quickly now there well there is no right
now there will be soon but right now at
the moment I have to manually bring in
dependencies for spring security and I
have to admit that wasn't easy it took
me a long time to remember how to do
that you know the hard way like this I'm
used to just clicking checkboxes at this
point so config and it looks web selects
exactly this is a spring security web
flex integration and though there are
three dependencies that we need to build
a way to make this work and all we want
to do is just for our simple example is
we want to have a security configuration
so this is a configuration class that
describes this configurate II
configuration for this application and
it's going to activate the web slug
security by saying at naval web plug
security which I think you know pretty
straightforward we can define it we need
to tell spring security how to do
authentication right it needs to enter
the question given a request who is
making the request and so we can define
a being of type user details repository
right and this is just an object that
it's going to talk to to ask the
question to answer the question who's
making the request in this case we'll
just give it a hard-coded list of users
right and in a map it's an in-memory map
you can use whatever you want and more
sophisticated spring security
application but for our purposes this
will be fine so we're going to say user
dot with user name J long dot rolls will
just be user password will be password
and dot build right there's this and
we'll do the same thing again for for
Josh and then this is year again ok whoa
ok
Josh uragan J color and then of course
he's also an admin because he's the bomb
really want to be in any advice okay
yeah so there we go there's Josh and
here again and these are you know for
authentication purposes we can we could
do authorization we could make a
decision based on the role you know
whether this person should be allowed to
make a request or not but for now the
default behavior is that when you have a
user details repository and nothing else
configured it'll let authenticated
request through and it'll reject the
rest so let's go ahead and give that a
go once we've got that started running
now I'll say movies and that didn't work
right that's by difficult if we look at
the Alvin or on also run forwards 401
unauthorized so now we say you j-roller
password okay there we are there's our
room
there's our response that worked as we
expected now let's try let's prove the
negative let's a get rid of the tamper
with a password here just to make sure
we're not seeing a fluke there we are
401 with the unauthorized again so
that's certainly very useful now we've
got a service we've got a service that's
talking to database it's reactively
secured there's a web tier and there's a
data access layer we should build a
client yeah what what if we had a micro
service architecture and some other
service of ours are also implemented in
Java with spring boots wants to call our
flex Luxor's imagine so that's what we
want right so let's go ahead and build a
flex flex client Wi-Fi permitting good
stuff okay CD downloads unzip flux
flicks client zip cg flex licks client
and we'll open up this is a project in
our in our IDE and the work here is
fairly simple all we need to do is to
define a build a an application that
talks to the HTTP service using a web
client using a client the speak HTTP and
at first flow at first blush this might
seem like a use case for the rest
template and the rest template in Spring
has definitely served as well but it is
a blocking client by default right rest
Tempest is a pretty traditional
restructures blocking location API like
JDBC templates like
like gtb/c itself inch APA itself
relatives we could be using it for a
simply structured client it talks to a
targeted CDP service obviously that can
be modeled with any HTTP client but for
our purposes may be a larger micro
service-oriented architecture it really
is brings a lot of benefits into the
entire architecture to reactively
interact between the services as well in
particular for HTTP going over the
network there's a high chance that is
actually walking at some point and we
might be processing the data further on
afterwards we might build a larger
indirection chain a larger processing
chain but for our purposes we keep it
rather straightforward right right so
now we've got the web client the web
client here has been configured to have
a base URL HTTP localhost 8080 movies
and we've taken it into account the fact
that we've got authentication to care
for here so I've configured a HTTP basic
aware filter authentication filter
exchange filter and now I'm going to use
that newly configured web client in my
command line one right here so what I
want to do is I want to make a call to
the root URL so you know quote quote and
get the response back and then say body
to fluxed and I'm going to do something
that you should never ever do and I want
you to just keep this in mind we should
never ever do this not even when you're
all by yourself all alone at home and no
one is looking I'm going to copy and
paste code you should not do that right
I'm going to get rid of that item
official you leave unity right and I
don't need the interface and there we go
there's my two Jason details sort of
entities they're things and I can use
those just to coerce the JSON that would
get back into objects that we can work
with so we're going to say give me back
a it give me back to JSON that comes
back as a flux of movie and then what I
want to do is I want to filter when I
say for each movie that I see if the
title equals ignore case Aeon Flux then
let's subscribe to it or actually it's
embedder let's say flat map flatmap and
what we're going to do is going to turn
that into a another collection right so
I'm going to say for this movie that we
found the one that implements what
let's say clients get URI movie ID
movies passing in the movie ID so n dot
get ID and then we're going to say
retrieve body to flex movie event I'm
sorry this is a event thank you we're
talking self-service incident endpoint
there all right trying to get the movie
Vince again and then that I think we'll
do it right so now here we can return
this and dot subscribe it's all I'm
going to do is I'm going to print out
what comes back as we know the lens is a
glove where you want to see what we are
turning here get rid of that don't need
this don't need that there we are a
little bit cleaner there we are so
there's our code and we're just going to
print out everything that comes back and
time and I can clean the hotel the cows
complete to change the application
properties oh thank you yes we really we
have two services running on the on the
on to say my machine here so we both of
them have an HTTP server by default so
they need to run them on different ports
okay go back here let's see if that
works
hey there we go look at that happen and
coming so there's our secured
interactions with the HTTP service
wheezing certain service and events this
is just one kind of protocol some people
ask me is this a replacement for
messaging or something like that no no
I'm not trying to you know that's
definitely out the intent here I just
want it appreciate that there's other
options here for talking to services um
okay so what if we looked at anything my
fam this has been a little bit of a well
a lighter into what we're providing here
there's much more to discover of course
but just to reiterate what what we've
been showing here in in the spring boot
to step where springtime box five in
spring security five and all those
pieces come in here we we are providing
a basically complete reactive story both
for the modeling of services HTTP
endpoints the modeling of client-side
endpoints
we have first-class support for several
reactive data stores in the spring day
the K initiative all of those pieces are
part of a larger story and form a really
nice comprehensive overall stack so I'm
going to elaborate a little bit more on
springtime at five - though the road map
and other things other than the reactive
story tomorrow in my spring framework
five themes and trends talk tomorrow
afternoon and and we have a boss at
19:30 I think in room to where we can
also have any discussion you guys or one
I'm going to have with us it can be so
fun
yeah so just a few point a few key
points summarized the reactive web stack
that we're building is based on project
reactor project reactors kind of our
choice for a reactive kernel project
reactors is of course very much aligned
with functional API styles out there so
if this feels familiar to you if the
operations feel familiar from from the
Java 8 collection streaming API or from
Eric's java that's no coincidence
there's a strong inspiration on the
close collaboration there in particular
between rx Java 2 and reactor there's
been a really fine collaboration David
Carmack the arch Java - Project Lead is
a is a committer a contributor to
project reactor 3 so there has been
really tight alignment between those two
because in the end project reactors a
more focused arrangement directs Java is
used on on Android a lot that Java 6
compatible still in project reactor we
could really take the opportunity to
build a modern 2017 Java 8 based server
oriented reactive kernel so this is the
foundation and the D API with flux and
mono that you've been seeing here those
are the two essential entry points into
the reactor API that are showing very
strongly also in Spring Framework 5 so
if you're looking at our API design
flux and mono are really key pieces in
modeling the directed processing
pipelines that we're exposing and that
you're building and providing to our
frame
alright and in terms of the the
decisions between you wanna builds this
kind of web stack over a servlet based
web stack that's a topic for another
progress this is we are providing
choices here so we are not actually
saying that the reactive web stack is
very clearly the only way to go about
certain things it has clear strengths
maybe the server sent event and point is
a great example it's so natural to
implement a service an event end point
in the reactive model it's a little more
awkward to do this in the circuit model
where you have to get out of the server
thread and kind of so some things are
more natural to model in the reactive
world for sure but there may be strong
reasons why the servlet base endpoint
model is your preferred choice number
one reason blocking datastore API is if
you want to keep using JDBC JP a
three-pound transactions by all means
you're going to have a easier write in
the inefficient servlet based stack with
spring MVC the spring the rest endpoint
model on top so they and the way I'm
seeing this is from the data store up
really so to put this sweetly and to
wrap this up for this session if you
have a datastore if you are able to
choose a data so or have already chosen
a little bit a datastore with reactive
capabilities and a nice modern reactive
driver by all means try to expose this
reactive interaction power through to
the web framework so if you have a
reactive datastore like MongoDB Redis
Cassandra HBase all of them have
reactive drivers it really suggests
itself to build a reactive web endpoint
model a web flex based web stack on top
all right well on that note there is
some encouraging news last year at
JavaOne oracle alluded to the idea that
they want a JDBC reactive JDBC story
right and I have full confidence with
their you know crack team of engineers
this will be done in the next decade so
it'll be ready for you if you need it
right that will be there eventually
there's the reason they synchronous
Postgres driver
right it works I'm not actually sure
what the status there really is right
there are initiatives are going to be
more reactive Lee enable data source in
the near future for sure but this is a
critical piece a reactive interaction
model a reactive processing model makes
most sense if it's reactive from the
bottom of the top right if you if you
expose the reactive power from the data
store at the bottom to the web endpoints
on top and this is the primary purpose
of our web flux framework of our
reactive web endpoint model is to be
able to expose that power if you can
alright alright so much for the purposes
of this stop we're happy to take
questions here if you if you come up we
have the boss in an hour yeah so by all
means if you want to have a more
extensive conversation come to the boss
please bring the drinks if you find any
out there at the party and if you're
interested in more of the strategic
positioning of Spring karmic 5 in other
themes other than reactors in springtime
at 5:00 and in the road map in
particular please come to my spring
comic 5 instant rain stop tomorrow thank
you thanks for your attention jin kariya
thank you so much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>