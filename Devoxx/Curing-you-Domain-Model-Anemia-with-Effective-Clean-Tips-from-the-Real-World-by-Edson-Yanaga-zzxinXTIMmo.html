<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Curing you Domain Model Anemia with Effective &amp; Clean Tips from the Real World by Edson Yanaga | Coder Coacher - Coaching Coders</title><meta content="Curing you Domain Model Anemia with Effective &amp; Clean Tips from the Real World by Edson Yanaga - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Curing you Domain Model Anemia with Effective &amp; Clean Tips from the Real World by Edson Yanaga</b></h2><h5 class="post__date">2017-06-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zzxinXTIMmo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">it's a great pleasure for me to be here
at for the first very first time in
Singapore I never traveled so is so far
in my life and just in case you're
wondering Brazilian not the typical
Brazilian you would expect by
grandparents are Japanese so I am a
Brazilian Japanese never been to Japan
many people ask that but here I am at
Singapore so I'm very happy to be here
talking to you today I got a try to
share some tips from the main driven
design clean code effect Java and lots
of other different tips on how you can
craft better code and how can better
model your business domain model in your
enterprise applications my name is ed
Sonia Naga I'm a rector of developer
experience at Red Hat and my twitter
handle is that he anagram just in case
you want to follow me I share a lot of
content about DevOps microservices
domain driven design best coding
practices career and anything related I
also have to happen to be a Java
champion and a Microsoft MVP as far as
google can tell me I think I can
consider myself the only one which is
kind of weird combination I know and
well I'm a Java champion am i MVP and I
work for Red Hat
how cool is that yeah but you know it
just means that the word has changed a
lot and I've been an open source
advocating user since my entire career
so I think it's in the end it all means
that open source has won I always
believed that open source of software
development was the best way to develop
software and when the largest
proprietary companies a software company
in the world
decided to do open source - it means
that in the end we won and by the way
I'm a Microsoft Azure MVP mainly because
I helped with the guys from Redmond tube
to add the Java support on their
platform so today we have another option
for a Java deployment in a cloud
computing environment thanks to
Microsoft and thanks for them for for
accepting my feedback so currently I'm
also a major technical advisor for Java
platform so they are always trying to
improve the way that we can deploy Java
software in the clouds
and since I've been talking a lot about
DevOps and microservices in the pet and
micro services in particular in the past
like three to four years a lot of people
discuss with me how do i proper model my
micro services how do I decide which
piece of my monolith should buy
distracting
hard wipe proper implements low coupling
high cohesion in micro software and
later this is question number one
question number two is but I still work
with a legacy monolithic relational
database how do I split the data because
the code part should be easier I'm not
saying it's easier and but data is
always harder how do I split that so I
wanted to have an answer for that and
after doing a lot of research I decided
to write a book and so I've just
released a new book from O'Reilly
migrated to Microsoft databases if you
want to get if you've got the free a
free copy of the ebook it's available on
these URL if you type the fewer i/o or
if you just go to our website developers
not read the headcount slash book you'll
be able to have a list of the books so
Red Hat the bubble developers bought the
royalties of the book so they made it
available online for free but just for
as well Singapore if you happen to of
course be here
O'Reilly sent me a box of of the books
and I'll be doing a book signing just
after the session at three forty three
forty so if you happen to get there to
the booth I would be more than happy to
sign some copies for you and I hope
you'll be able to enjoy that and I
always like to start my sessions with
this quote from Forbes now every company
is a software company you don't work for
a bank
you work for a software company you
don't work for an industry you work when
you work for a software company you
don't work for in university you work
for a software company because software
is changing the word that we leave and I
believe that if we call all of this that
is happening today this new digital
transformation is because software is
behind everything that is happening in
this world right now some of the great
examples of this new digital economy are
the largest car transportation company
in the world all those cars which is
uber but but I
yesterday maybe except in Singapore
because cars are so expensive so they
told me that uber now has a car rental
company too or at least some associated
company so maybe there is an exception
for that but they own very few cars only
things were at least as I know and the
largest lodging company in the word owns
no.3 state which is Airbnb
but the largest online retailer in the
world owns no stock which is Alibaba and
the largest content network in the world
produces no content which is Facebook
all of these companies they have
something in common is that they only
exist and they are only enabled thanks
to software so software is changing the
world that we live and how we've
interacted with different people
worldwide and when we say economy I'm
one of the those people that thought
that economy had everything to do about
money but after reading some books about
behavior economic economy and behavioral
psychology - I just learned that the
economy has nothing to do with money but
has everything to do about people so
that economy just studies how people
interact with other people and they try
to get a state from one point to the
other state and people shall have some
motivations from changing a system from
one state to the other some of these
interesting motivations can be love-hate
power and also money
so basically when we're when we're
developing software we as people we're
developing software for people we're
just trying to change the way that
people interact with each other and we
can do all of that through software I
also like to introduce myself as a
software craftsman and we have many
different definitions of what is a
software craftsman on the internet and
books the best definition that I that I
have for myself is that a software
question is somebody who cares about his
jaw his or her job because we as
craftsmen's we believe that truly the
software can change people's lives for
the better and also can make people
miserable so some years ago I made a
decision I knew that I could create
crappy software and make people feel
miserable I have to confess that I've
did this before I made people feel
miserable with the
the work that I was doing my job but and
then I realized that if if I'm going to
do something I better do it
the best I can so even though sometimes
we fail I'm always trying to improve the
software that I deliver and some years
ago too I decided that what I was doing
wasn't enough because even if I could be
a good programmer if am I am maybe a
good programmer the job of one single
programmer is not enough to change the
world that we live so I decide that I
would like to help to the sense of my
possibilities try to to help developers
all around the world to try to deliver
better software faster and I'm very
happy that we win within Red Hat and
he'll also have the opportunity to be
from the other side of the world to try
to share some knowledge review so I hope
that it's also useful for you what a
what a mob share in physical bob
software as a craft not an engineer or
something that I know there are many
different views of what software users
of what a software can be so I can agree
in this agree with most of them but one
of one nice bill what is a software what
is the software process well what is the
the craft or the art of creating
software is from from Donald Knuth if
you happen to be at the Museum of
computer history in palo alto california
there is this beautiful quote from
donald camuto on the wall and that just
took a picture for that and i just just
written here in this slide that computer
programming is an art because it applies
accumulated knowledge to the word
because it requires the skills and
ingenuity and especially because it
produces objects of beauty if you
believe you that yourself is software
craftsman if you believe that software
can change the world and many very few
things in our world can be more
beautiful than useful software that is
carefully crafted to help people
worldwide so that's why I think that
software is very beautiful especially if
you care about the software that you're
doing if you think about how can we
change the word with the sort of gloom
the word one of the best definitions
that have
in the past few years I was talking to a
professor in the Federal University of
Berlin gia which is a city in the
countryside of Brazil and he gave me a
definition what is competence but before
that I would like to give you another
code for georgeanna pillow which is the
author of management 3.0 no matter what
other methods you apply to achieve
competence in a social system in the end
it all depends on whether people
actually care so if you're all here
today trying to learn better ways to
deliver software to production faster
more reliably and quick trying to craft
better software I believe is that we all
care about we do and if you think about
what is competence how can you achieve
competence I used to think that
competence was something that was equal
to proficiency but then I realized that
there are two completely different
different words and different meanings
competence comes from the leading
competitor and I thought that well
competence has must have something to do
with competition but then realize that
competitor originally lady had nothing
to do with competition competitor in
letting used to mean that we are
improving together ok so if you think
about competitive or competence
competence means that you're fighting a
battle against yourself each one of your
days and at the end of the day if you're
able to win if you're able to be a
better person than where you were
yesterday
then you're a competent person right so
competence has everything to do about
improvement and not about proficiency so
for you to be a proficient person you
have to be before that a competent
person because but you acquire your
proficiency through competence and
that's why we're here we want to learn
better ways and suppress better ways of
creating software one of the great
techniques that I think is there are
under edit our domain driven design
because it has been more than ten years
that this book was written and we still
not applying the great techniques that
domain driven design has brought to the
world of software development and
particularly software business modeling
so I think I'll be able to share a bit
of the tips so but domain-driven design
is one of that books I read this book
like almost 10 years ago and when I
finished reading that was oh my god this
is awesome but when I went to my
notebook and try to code something I
realized that I had absolutely no idea
how to apply the domain-driven design
principles into into my code and that's
one of the bad things of the diminutive
design initially it was too abstract for
you to apply in Prats one one beautiful
day and really it happened like this way
because I was like digesting the ideas
for a long time for many years one of
these days just woke up saying oh my god
it seems so obvious now I'm just I'll
try to apply these things and I try to
improve the way that I apply these
techniques so the main durham design is
a very big subject and I'll barely
scratch the surface of this during this
session because I only have 50 minutes
but I decided to also to write a book
about the subject so expect something
more for me until the end of the year I
hope to have to finish it
how about how can you apply all of these
beautiful concepts of the manual design
into code especially which in my case
I'm a Java developer into Java II
enterprise applications so some of the
code smells that I want to tackle today
with you are like first of them
primitive obsession because we
traditionally we in the java word and I
believe it in the other words too we
think about how we model software we use
with we have a code small called
primitive obsession which is the fact
that in our domain model we're just
using primitive primitive types from the
language so we're used to having if we
model a person if we model a car or
model book in our domain model we used
to have properties as strings properties
as integers properties as dates
properties as big decimal which means
that we create classes but all of our
properties on these classes which
President will represent real word
entities are simply primitive values and
that's a typical anti-pattern we should
be enriching our model so we should be
creating more classes more types to give
meaning to the
model that we have and these
anti-pattern is people documented that a
long time ago so one of the greatest
Arctic goes by marketing folder was
written in 2003 which is when to make a
type which basically if you read the
Dirk with a very nice article but it
states that if you're thinking about
should I create a new type in my domain
model and if you have this doubt then
you probably shoot because like in most
of the case you really shoot me creating
a new type and one of the reasons for
doing that is that if you created a
custom type in your business model it's
very easy for you if you later realize
that you didn't need that it's very easy
for you to remove the custom type but if
you realize later if you use a primitive
type and later realize I should have
created a custom type it's very hard for
you to later add a custom type so you
should we should be yeah have in mind
that we should be creating custom types
first instead of later
other nice abstractions or problems that
we could solve the most popular
exception in the Java world is the null
pointer exception okay we have that like
every day we see in our stack traces and
maybe we shouldn't need to be handling
new pointer exceptions I know there's
not a single solution for that I thought
there is no consensus which is the best
solution for a new pointer exception but
we when we're trying to model a business
model we can try to avoid new pointer
exceptions up to some extent we have
some good solutions for that some
languages provide like things like Elvis
operator it's debatable I think it's a
good solution for some use cases and a
very bad one for others we can have an
implement new object which i think is a
very good solution some use case and
again a very bad solution for others a
java waiting for word we have like
optionals
which again can be a good and a bad
solution depending on how and when you
apply all that and I'm going to discuss
some of this some of possibilities on
how can you solve and improve your code
and trying to tackle some of these anti
patterns or code smells that you have
your code but instead of just talking
well let's try to show you a cool life
code Nemo how can we apply this
techniques so now I'm going to get to
the risky part of this presentation
because you know demos can always fail
especially when you're live coding
things and let me open here okay I have
my IDE I'm going to enter my
presentation mode here I just created
away the project because I have many
other stuff but I'm going to start with
the basics for you
so first I'm creating a class also get a
very simple use case I'll create an
order and usually are in order I want to
model that as an entity in the JPA word
and just for you to know I don't know
how many of you have heard about
domain-driven design before but some of
the basic concepts that we have in the
manual design and one of the most
important ones in fact is that in our
business model we have different types
of classes and objects that we can be
created in our business domain model one
of these types are entities and the
other ones are value objects if you
think about the difference value objects
are things that are equal to the other
ones depending on their value so if I
create a class a value object code phone
if I have a full an object we found
value five five five and I have another
object with value five five five I
consider them equal so they can be
replaceable one by the other it doesn't
change the meaning of them in my
business domain mode okay so if I have a
model like a phone book that if I create
a phone class if I have two instance
five five five and five five they are
equal they are replaceable they are
interchangeable it doesn't change it
doesn't matter for me which object I'm
using it represents the same idea in my
business domain model but I can have
also entities and entities are the
things that are equal to the other by
their identity so I could create a
person class in my business domain model
this person I can change the name of the
person I can change the address I can
change the sex I can change the date of
birth it is still the same person so
okay so all of the property
values of the person class can change
over time but for me it still represents
the same person case because somebody
might have missed I paid somebody can do
can perform a sex changing surgery and
can change the sex but it's still the
same personal person so it has an
identity so entities have identities we
also have another concept which is an
aggregate which is the root of our
abstraction as a bounded context but I
won't be able to cover that today so -
for now we just learn the difference
between entities and value objects
energy is very useful for us ok so order
is something we could discuss order is
it a value object or is it an entity you
think about an order the state of the
order changes over time you means are
created and order maybe I can add an
item to the order maybe the order can be
fulfilled maybe the order can be sent
maybe the order can be canceled so the
the properties of the order can change
and evolve over time but it's always the
same order right so apparently order
seems to be an entity so we will model
that as a JP entity - so it must
implement sterilizable it must be an
entity what else an order should have an
ID because it has an identity for now
I'll just keep using primitive types
even though I know it's a bad breath it
must be a generated value may be an
order must have a number private integer
integer number and maybe I should be
creating getters and setters that's one
of the things that I like to discuss if
you think about how do you model
traditionally what do we do with the
business code that we craft traditional
Java development when you have like you
create classes with lots of properties
primitive properties you create the
getters and setters for everything then
if you want to manipulate business
logically what do we do we create a
service class which is usually used to
be an EJB or a transactional being
spring then we create businessmen
thoughts on this service class and each
one of these methods like are very very
huge because what do we do we extract
the information from inside the beam get
get get get everything perform some
calculations then when we have the
result we get our class back and set set
set as set everything else that's the
typical use case of dynamic domain model
and that's what we're trying to avoid
with domain driven design because you
think about it most of the problems that
we have most of the bugs that we have
with system reproduction is that you
think about something your system the
data evolve evolve over time and usually
when you have blogs is that is because
the states of your data went to a
certain state which was unpredictable it
was never supposed to have the state you
add that variable should never have that
value but it happened to have that value
and you have absolutely no idea of how
your system reaches that state because
because since all of your properties are
exposed any code in your entire system
can get and set a value inside your
class and change the stage to an
unmeaning foe or unpredictable value and
you have absolutely no idea of how that
property received that value so it
should be depend the defending our
domain model from these kind of changes
so the most powerful aspect of any
object-oriented language is the power of
of encapsulation and that's one of the
things I used to be a professor also for
more than 15 years in the past and I
used to teach graduate and undergraduate
courses in different universities so the
one of the very first things that people
learn when trying to learn like Java as
any object-oriented programming language
if you think about what are the
characteristics of object-oriented
programming languages are that you have
inheritance polymorphism and later they
learn all you can encapsulate to when in
fact you the most important aspect of
any object oriented programming language
is that you can perform encapsulation
you can insulate your data from
unexpected change of state
but we don't do that we should be doing
more so I like another coat which is
mutability isn't a new go-to so the last
mutable you make your codes the more
protected it becomes so how can we
reduce this mutability the first thing
is that you don't have automatically
generate your getters and setters you
have to think very carefully about if
should you be creating a getter and
setter
some people are duplicate that you
shouldn't even be creating these kind of
things but another great tip from the
menu InDesign is that Java has one
specification called javabeans
specification and most of the frameworks
that interact with java objects they
expect you to have Gerizim saturn's so
depending on your user code you think
well maybe I really need a getter for
that then I should be creating but most
of the times you should be creating a
setter because if when you create a
setter any piece of code in any part of
the system can just get there and change
the property of your value
sometimes you need a setter because the
framework imposes you to do so but most
of the time you shouldn't okay so with
this in mind let's try to minimize the
mutability so first I have a number an
order number anything can it be any
integer okay can it be a very big can be
negative can it be zero so that's one of
the implications and the traditional way
of trying to solve this problem
I still use an integer then I'll keep
using like properties like not new and
many other different constraints that I
can add to my business model this is not
the proper way to handle because I am
allowing my business model to have like
an invalid value if it's supposed to be
positive I could add a minus 1 value
here and I would only this class would
only be validated by an external
framework like using bean validation or
maybe we would only be validated when I
when I committed this class to my
database and I had a restriction on my
database I had a constraint they no
trigger in your face and exception
saying well you had some invalid data on
the database we shouldn't be doing that
and so one of the principles of domain
driven design
is that you never allow any valid object
to be created right how can we do that
we're going to create a custom side so
it's not an integer I need to create
what an order number because this
property only allows ordering proper
order numbers to be set it then I'm
going to create another number let's
create a class or the number it's a
surly label does it matter if I have
another number five and another order
number five do they have different
meaning I don't think so in this case so
it could be replaceable so order number
clearly is a value object so how do I
create an immutable values because value
objects are immutable by default so
maybe here or the number internally
should have an integer value I could
Inked value because internally is stored
of that it must be mutable so I'm going
to add the final here so I'm adding
final I need to add a constructor if I
have a constructor I don't like
constructors I think there are very bad
threads in the java programming language
but luckily we have parents for that
fellow instead of a constructor i want
to refactor this code to use a sector
method so I'll create a vector method
you might be wondering why do you want
to use a factor method just because you
don't like the new keyword well - but
one of the good things about the sector
method is you can perform some very cool
optimizations inside this method first
when you create a sector method you're
not constrained to returning an object
that is an order number if I later I
decide that well maybe order numbers
below a thousand should be printed
different from the other numbers which
are above a thousand maybe I should have
a different color for them okay maybe
then I can create another class which is
a subclass of order number and return
different objects as long as they have
the same interface okay so if I have
here a sector method I'm not since Java
has covariation
I'm not constrained to returning just or
the number instance I can return any
other object which is a child of our
number two I could even later change
order number four in for an interface or
something like that
it would be very easy to refactor my
code for here so maybe order number
creation is a very expensive computation
process so maybe I don't want to be
creating a new order number every time I
receive a new value maybe I should be
creating a cache maybe I should be
implementing the flyweight design
pattern to create for some kind of
special num order numbers which I know
that are commonly used I don't want to
create a new object I just want to
return always the same object so I could
create an internal cache and I wouldn't
have to change a single line of code
outside order number because the
responsibility for creating order
numbers are further from the order
number class so everything is hidden and
capsulated and also I never allow an
order number to be created incorrectly
so if I say that order numbers must
always be positive I could say here I
want to check their arguments which by
the way I'm using Google guava which is
a very nice library has some very nice
collections and some very nice utility
methods like check argument I have to
say the value must be more than 0 ok and
when I try to create an on the number
which we call this love fail-fast so if
you want if you receive the wrong value
and if you want to validate if it's a
proper value or not you should be
receiving an error when you try to
create a new object not when you try to
use the object because that's the
traditional Namek domain model way you
just set a property and when you check
that when you're using that if it's
different than null if it's greater than
0 you should be doing all of this kind
of validations when you try to create
the object so you can never have any
valid object in your system right so
here I'm checking the argument if it
could be new in this case it can't be
new I could check it in another way and
throw another kind of exception just by
the way check argument just verifies
this boolean expression and if it's not
properly if it's false then it frozen a
legal argument exception so the
exceptions become to become even more
clear in our object so what else I want
to do that a proper value object must
implement eCos because I want to
called the equals so this is one of the
possible ways of implementing equals in
Java or the number or the number other
receives object so we also have from
guava initially and now in Java 8 we
have some whose methods objects dot
equals I can do that using Java you chew
like a DS dot value order dot value okay
return if I want to create a hash code
method I can call that using two can you
see that okay I can return objects hash
this dot value and if I want maybe to
string to string is another cool thing
to string many people think that the
string method is supposed to be used to
present information to the user no it's
not to string is something that you use
for yourself if you want to log a
statement if you want to debug him
something to string methods provide you
the value that you need to check if your
system is behaving properly so for to
string I have guava has like this more
object class to string helper this maybe
I can add like value equals value and to
string that's a very nice way for me to
be creating to string method but if I
really want because if you think about
who it has the responsibility of
presenting the order number to the user
maybe it's the order number by itself I
want to create a new class just to put
the to format information that I want to
present to the user and there is one not
widely known interface in Java which was
created just for that which is
formattable so formattable should be
preferred way for you to to present
information to your user because here
you have a lot of informations here if
you want to internationalize the string
that you present to the users you can do
that if you want to present like for
internationalization purposes different
number format because you know like in
the US you can you kill you use comma
and then dot but in the rest world uses
dot and then comma maybe these kind of
things you have this information here
you know which language are supposed to
be using you can have like information
like flags with and proceed
then you can check the Javadoc which
kind of information do you have
but I could just do that for matter dot
format to then it uses like the printf
syntax which in just in case is also a
formatter and I can say that I can it I
want to print like this if I want to
have decimal separators if I or anything
else I could be using all of this
information inside this method that's
what the formatter tube method was
created and I think that's it that's a
valid value object it's immutable
it has a nice factor method it should be
properly use it so here I have them if I
want to that then maybe I can create it
if I need to store the information on
interface maybe I can create a getter
for number do I need to create a getter
for ID I don't think I did should be
exposed to the user because it should be
an internal property of your database
and then maybe initially you shouldn't
be exposing order ID maybe later when
we're discussing I won't be able to
discuss with you today when we're
discussing specifications and qyz or how
can you cue it the data from your
database maybe you could use the ID but
for today we don't need that so what
else order I need a way to be
constructing orders so I don't allow
invalid the orbiters to be created and
if the order number is a recommended
Tory property then maybe I need a
constructor for that I only allow these
to be used I also again I don't like
really don't like playing constructors
I want to refactor that as a factor
method and I want to check here no order
can be created with a proper order
number I don't need to check the order
number more because if I receive a value
of object of order number I know that
it's correct I just need to check that
it's not no ok receive here check not no
number I can never receive a no order
number but you might be thinking this is
not a valid JPA entity because valid JP
entity's requires a default constructor
but you're never going to use the
default constructor you're just going to
use that for the JPA purposes so I'm
going to create here default constructor
and never use that okay not order number
order okay or their oops yeah this
discussion requires that it should be
protected but if you think at least on
hibernate it doesn't need to be
protected it can have like default
visibility okay so this is a valid order
number that order which has an order
number it's mandatory I'm checking that
on the constructor but orders are not
that useful if you don't have items for
that right and we could be adding items
another discussion should be an order
item an entity or a value object that's
another valid discussion it really
depends on your business on my model
that I'm asking to you I'll create here
order should have a list of order item
which are called items so here I have a
new list which could be exploded order
Island let's create this class because
should be a Northern Ireland also must
be serializable and maybe I should have
a product as a string and an integer
amount and a big decimal value I'm using
primitive properties today because I
don't have enough time to model all of
them but product clearly should be
another custom type amount should
clearly could be another question time
the same for big decimal should be a
custom type okay and if you think well
isn't big decimal already a custom type
is not the primitive value no okay you
should be considered because it's just
plain old Java would you'd be creating
your own class for money for example
because if you want to have some
rounding calculations you don't want to
expose the rounding calculation all over
your code you want your own class money
to know how to perform the rounding
calculations and it really should be
encapsulated right so you should be
creating properties for that I want to
do this for this class because of lack
of time but if let's think if I have one
ordered item with a product and amount
and a value and I have another object of
that which has the same product amount
of
are they equal or not I think that for
most business use case I should be able
to replace one with the other it
wouldn't change the meaning of the
system so in this use case I think that
order item should be also a value object
or else if it was an entity I would have
to mark that as an entity but I don't
think it is because an entity needs an
ID and if he has an IDE has a different
lifestyle or anything else since the
order item should be replaceable I don't
think that's an entity and how do i
model that with JPA I can call that
order Nitin is an embeddable but didn't
say that order had many different order
items how do i model a list of a
compatible object luckily from j-p-la
2.0 forward I guess we have this new
kind of mapping element collection which
you can use it's very useful because you
don't need to map an ID to your
collection so you can just interchange
the object and the the state of
information is my tainted by the list
instead of being maintained by by the
foreign key of your of your order item
okay so that's a valid way for you to be
creating a value object here also value
object should be immutable but it's very
hard to manipulate filled with final
values using JPA so another way for you
to create immutable object instead of
making all properties final is that you
through your code you guarantee that the
state cannot be changed at all so how
can you do that you don't provide
setters and you could provide a
beautiful constructor with all of the
values and again I don't like
constructors so I'm going to create a
vector method and I should be checking
again a code implemented check not no
product just check not no okay I could
check the amount check the value and
everything else not no but I wanted that
for because of the time I should be
implementing equals hash code to string
all of this method they must be
implemented for all of your entities and
value objects I just shown you one I'll
save the time of this one here
so but sometimes order item you need to
expose the properties of the or the
items in your interface so in this case
or create getters but of course since
it's immutable I can have the setters
right so it's almost a value object if I
finish the implementation of the proper
things with the product amount value
I created other value object zoom then
it would be a valid value but for the
purpose of this demo yeah I think it's
okay so I have an order item I'm saying
here and that's it I go back to the
order class then you might be thinking
how do you expose information or their
item so maybe I need to sometimes expose
the list to the interface I should have
a get items so many people just do that
let's create a getter for items and get
items but the problem is the by default
Java collections are immutable so if I
allow my item needs to be exposed this
way any piece of code in my system can
get to here and change the item list
which is a leak
that's a leaky abstraction I don't want
to do that maybe I should returning only
in an immutable copy of items okay so
I'm returning that's another guava class
and immutable list I'm returning a list
that cannot be changed outside of that
but I need a way to be any items to my
order I need a way to be removing items
from order how do I do I need to create
methods for that because the only way
for me to change the state of the order
is through the order class so maybe I
want to create here and an adder I can
create a public order add item and I
pass that an order item okay and I just
say items
I then again I can't do that with a no
check not no item I can receive a no
value for valid reasons 15 okay 50
minutes it's very hard to see anything
with the spot in here and return this so
I'm checking maybe add item okay it's
valid for now but then I realized that I
got a new business requirement and the
people told me oh if you're adding like
products with the same value and you
check that you are adding another item
with the same product and some value
you shouldn't have duplicates products
on your list you should be instead
adding up the amount of things that you
do well if I didn't have a proper
encapsulation I will have to search for
all my business code to check who is
manipulating the iron lives but if I did
using immutability the only place in my
system that I have to change to add this
new business capability is the add item
so maybe I could be checking like if
items contains item then I should be
implemented the code well islands dot
remove and maybe I should add or the
item of then I should be creating
another object with the same copy the
product and copy the value and just add
up the amount I want to be implementing
this but I think it I hope it's pretty
obvious that you should be coding this
here right this is the proper way for
you to add this new business capability
but I won't be implementing that in
terment because of time and as is
another question
I just before that I consider two items
to be equal if they had the same product
the same amount and the same value right
but then the new business requirement
changes the meaning of what is an equal
item so the guys the guys told me now
that while two items are equal if they
have the same product and the same value
so it really depends on the capability
so equality on the equals and hashcode
method really depends on your business
meaning not on your object meaning okay
so that's why you should be modeling
your identities that's how proper code
works so I'll just remove that because
that's another exercise that we can do
later with our code another thing that
is interesting you see some people think
about we could have something called we
have some some law which is not really
law but the property of some systems
lauda meters long which means don't talk
to strangers nob jerk should never talk
to the dependencies of those other
objects just with direct references it's
a very debatable and questionable law
because sometimes I'm one of the that
pragmatic persons I believe that having
a better API is much better than
following the mirrors law but again it's
very much debatable you have some people
with some very strong opinions sometimes
I prefer to be pragmatic suppose now
that if I was following the mirrors long
I wouldn't be able to know the amount of
items that I have here in my list ok
would never call like get items got the
dots get size it's not allowed by the
mirrors law then it will have well I
want to know them the number of items
that I have in the order I will have to
get integer get order counts then return
items dot size okay I should be
implementing a method by that but then I
got a new business requirements somebody
told me that now you all do you not you
have not only the items by itself you
need a new capability I need a list of
discounted items
okay four new element collections then
what do you do I need again I need a get
discounted items copy of discount items
maybe now I need to get or the count I
need to get a discounted items or the
counts so let's not get ordered yet item
count then I will need like public
integer get discounted items count
return discount a night dot size then
somebody oh I need another proper that
maybe I need the total amount of the
product the amount of values then I
would like public bigdecimal get total
value get item total value then people
would say well you need to get items
stream dot collect collectors doors
grouping by and I have map a get the
item order item
I'll get get value start with big this
model 0 and what we do big this ad
that's correct
no no I
well I think I forgot how to do that
okay let's get a simple one get well
I forgot the stream left turns it
suppose I would have to interact with
the list and sum all of the items so I
would return here or I could use a four
yeah I want it to be fancy and I just
forgot the syntax now so maybe you
should be adding but then you need the
total value of the item then you will
need the discount ensue you'll be
copying and pasting code everywhere you
had it discounted Island then what you
have here boo-ki api okay your class
starts to be big you're not really
adding some Val to that and maybe
instead of just having to follow the
mirrors law we could create another
class for this behavior so who told the
maybe instead of just returning a plain
old list of items I could create create
we created another class so instead of
just using that I want to create an
order items class and let's create this
class which luckily while we have
another class it extension and
forwarding lists or what order item okay
I can have a private
value or okay I can create a constructor
I can implement the method so it starts
stops complaining delegate return value
again it should immutable I can do that
differently I can could use like you
return a mutable copy here or I can just
really read the value because I'm
checking I don't want these I want a
sector a method to and what can I do can
be new and when I'm gonna find in here
I want to value instead of passing just
a plain odd value I want it to be an
immutable list copy of value okay so I
just check it here I have any for the
list then maybe instead of just having
to multiply off the methods that I had
inside my class here I could just say
that in fact here projecting reasons to
have to be order item but since I have
encapsulation this method doesn't need
to return this list anymore it can be an
order items list okay since it extends
least I didn't break any piece of my
code I just had a new behavior for that
and I could add that with discount - -
and see some I don't have the just to
return just a plain immutable list copy
off I can return order items off items
and I can return here
or their items dots off discounted items
so now I can remove these methods that I
created here and add them to wear to the
order item class so I can create here a
method public integer get size and
return value dot size okay so my API is
that'll have the multiple different
method somebody could just create a
client methods for words to create like
order off or the number of five I could
just be calling get items get size and I
could doing the same with getting
discarded items doc sighs okay should
you be doing this kind of collection of
modifying and extending the your list
etc for all of your occasions it really
depends on your business models but I've
did that some times in the past
depending on how your business model
behaved this is a very neat solution for
a lot of different problems because when
you have many behaviors being added on
the list when you have to cut to to add
a lot of calculation and computation
inside your and manipulate your list
with a lot of different methods this
becomes a very useful use case of how
should you be encapsulating your
behavior okay another way for me to
change the state of mordor class maybe I
want to apply here I want to add some
special price tag on some ideas or some
of that maybe I could need to apply an
operation maybe I could add and now I
have discounted items maybe I would need
to apply a public void discount and set
like a big decimal value or discount
okay I would create maybe a discount
class media will need to perform
operation maybe I would need to instead
of just applying a discount motor to add
shipping costs
and maybe they told me that well the
shipping cost can't be by the item or
can be by the to the order you know this
kind of behavior should be added inside
the order here but if you see if for any
business method that you have for order
if you just start adding methods here
your class will be simply huge the first
option for you I'm adding a new
capability for my class is to always add
a business method here in my order class
but as time passes and your business
model revolvers and your class starts to
be too big you start to have a lot of
business methods inside of the class
maybe then you need to sterilize the
operations and how can I do that used to
be harder in the past but now since Java
8 for example if I want to apply lots of
different operations inside a list or a
collection of elements I can use some
pretty neat like functional interface of
Java 8 to be applying these things so
instead of adding multiple methods for a
discount or shipping costs here I can
just add one so maybe I want to apply an
operation public void apply and I say I
want to apply an order operation
operation here so my items would be a
clerk a items receives items string dot
map operation let's collect
collectors to list okay it's complaining
because operation he doesn't know what
is operation let's trying to implement
that some upgrades maybe I want to
create an interface maybe I want to
create mmm really depends on your user
case I'm just going to create to show
you a very simple use case suppose that
I want to limit the kind of operations
that can be applied to my order for now
layer of my system increases I might
change this the thing my since I'm
creating a custom type it would be very
easy for me to change later
so just created a none because my system
currently I only have two operations
shipping cost and discount and operation
is going to implement a function which
maps or another item to another line
okay and I need to implement so I'm
going to have an operation called
discounts and I'm going to have another
operation called shipping costs which is
one of the cool things that only Java
can do for you if you show that to a
sous-chef developer a hit yeah just
crazy okay then what do I do
I just have to implement the apply
methods which means that order item or
when I give a discount to something
maybe I should be performing some
behavior but if it only depends on the
order item a to say well I'm just giving
a 10% council return water or return a
new order item which uses the same
product the same amount but now with the
value I'll get value dot multiply new
bigdecimal
0.9 okay I'm applying a 10% discount on
all of the items and maybe for the
shipping cost
I could be adding some specific behavior
okay maybe maybe the shipping cost is
just like 20% of the other price I would
be implementing right here and for me to
be using this kind of operation here I
would just create like for that I would
be creating order of or the number of
five if I want to apply something I just
say apply
order operation dot discount then all of
the items I have to know all of the
items we receive a 10% discount okay
this is just one some of the tricks that
you can apply when you're trying to to
use this kind of domain redesign
techniques one of just to finish because
I think how many times I have okay so
maybe I want to you see this code
wouldn't work with default API I need
some way for me to integrate my business
domain model with a framework with like
GPA or if I want to expose the
information to the interface maybe I
have a JSF maybe I have a spring MVC
application that I want to expose
information to maybe I have a rest
endpoint but the rest endpoints or the
JSF application also don't know how to
interpret and manipulate order numbers
or order items or something like this
maybe I need like some point water that
we call an anti-corruption layer which
prevents me from integrating framework
stuff inside my business domain model
then for some if I want my order number
to be method correctly into the JPA
luckily for the number I can say I can
create an order number attribute
converting an attribute converter where
added to the JPA specification version
two which is one way for you to map
custom types to your database types
before that if you use it in hibernate
you needed to implement an user type
class 'banahna can just create an
attribute converter and it just in case
you have two methods convert to database
column and convert to entity attributes
you just say well I have an order number
how do I convert to a database type like
integer if I have an integer from the
database how do I convert that to an
order number thing and basically I'm
just doing this but you see I have no
way of extracting an integer for my ax
from my order number class so the
basically people would do like attribute
dot gets value because if you go to
their number order number class the
internal property isn't that value but
if I just supposed to get value it
implicitly means to anybody using my
class that in
generally I'm using an integer
implementation that's why I choose to
expose these kind of things instead I'll
get value and say well convert this
order number to an integer value okay
and I say I want to create a method
called two integer because later could
add a too long or too big decimal it
just means that I haven't valid or the
number objects and I want to convert
that if they has meaning to another type
of average I'm not exposing the internal
get value information so in the in Prats
the methods are implemented this same
but in semantics it has a different
meaning but to the clients of my my
class so it could be just return value
and the same way if I want to spoil the
information to the JSF application or to
a spring MVC I will also need to create
a connect spring converter or if I want
to expose that as JJ's application I
would be using our faces converter okay
I just have implemented here for other
business model class if I have a name
class which is another if a person I
have a name name is also a value object
if I want to spoil the information I
would use this a facial converter class
and of course it's exposed here and
that's just some of the tips that I want
to show you of how can you proper create
business model using domain Java designs
entities and value object and then be
meaningful behavior to your business
domain classes instead of doing
everything inside your service classes
but again I'm barely scratching the
surface we're just touching a bit of
domain of design because some important
questions that you might be having in
your mind is that well how do I perform
validation if the user typed the wrong
or the number or a wrong name or wrong
surname how do I tell my user on the
interface that it was an invalid value
can I do that because I don't have bean
validation anymore yes of course and in
fact I have to tell you it's much better
than using bean validation because you
can add this business logic to your code
and another important thing I'm saying
that I'm a fan of like sector methods
but sector methods are very easy if I
have like one parameter one internal
property but if I get the order item
it's a very simplistic model and it just
has free free properties but if I had
more to properties I would have five is
it builders who have a method with five
parameters it starts become very hard to
write and read your code so that's
important questions so maybe I if I have
more than three I think three is
bearable if I have more than three
properties maybe I shouldn't be using a
factor method maybe I should be using a
beauty class that's one of the ways for
me to be exposing maybe not all of my
properties can be mutable like person or
for example or like order maybe I want
to change the address of the order for
the person class to maybe I want to
change the name of the person not
because I'm changing the property but
because the first time I create the
object I accepted the wrong name I miss
typing the name clearly it's something
that I want to change that how do I
change internal properties that should
be encapsulated but if you have to use
frameworks a rest frame of course you
have to use a view framework like JSF or
something like that these are very
important questions maybe sometimes some
of the possible solutions I can create
mutable wrapper classes just to
encapsulate the change or domain-driven
design also has another opportunities
for you maybe if I want to change the
address of my order maybe I need to
receive some external information that's
when things start to get even more
interesting like I can create what we
call in the manual design terminology I
can create a domain event so my class
would be here public void receive would
create and would see the norther event
an order event could have many different
implementations for example shipping
address change order events ok so then
the order event would know how to change
the internal behavior internal state of
my order that's when things start to get
interesting and you think why am I
talking about all of this I think this
it's a benefit by itself to be coding
like this but then you'd realize that
well if I'm starting to create business
domain events
in my model well who told me that this
business domain vents need to be local
okay maybe they can distribute it maybe
you can add a message broker so
everybody can listen to these business
domain events so maybe now I can start
they don't need to everything to be
local maybe I can start to distribute
the things maybe I could even start to
use micro service for that right so
that's when things start to get
interesting in fact that's why I truly
believe that the best way for you to
split your old model is into micro
services is to first model your business
domain logic with proper bounded context
to maneuver design bounded context
domain events if you did that properly
you have like a very cohesion lock up
lead implementation you can extract that
separate fragmentation and you start to
broadcast your events through a message
broker that's very interesting
questions but again we're just starting
to give you some tips of how can we do
that and that's all that I could present
for you in the time that I had today I
hope you have all enjoyed and I think
I'm over time already but you have any
questions later I'm available and again
we'll have the book signing right now on
the redhead pouf and thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>