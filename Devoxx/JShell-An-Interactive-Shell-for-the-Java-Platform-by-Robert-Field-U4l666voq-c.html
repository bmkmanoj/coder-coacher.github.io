<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JShell: An Interactive Shell for the Java Platform by Robert Field | Coder Coacher - Coaching Coders</title><meta content="JShell: An Interactive Shell for the Java Platform by Robert Field - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>JShell: An Interactive Shell for the Java Platform by Robert Field</b></h2><h5 class="post__date">2017-04-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/U4l666voq-c" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">ok welcome I'm be talking about Jay
shell which is a new tool in the jdk
platform for interactively using Java
code I'm Robert field I'm the architect
of Jay shell and the lead engineer
hasn't shipped yet so who knows that's
what that's the meanest so we'll talk
about first of all what is K shell why
would you be interested in using gel and
how do you use to your show what's
involved in using it I'll do a demo and
then I'll talk about the architecture of
Jay shell and really very briefly the
JSON API and they don't have time for
questions but I'm open to questions at
any time time permitting okay first of
all what is wait Jay shell but before
that who's heard of Jay shell before
this deadlocks okay but that's shifted
okay a like your and have a gut devoxx
and belgium like almost no one raised
their hand who hasn't heard of jail
before this devoxx two people okay and
who's actually used Jay shell I know but
there's one a little bit of it ok ok
what is your show it's a tool for
dynamically interacting with Java it's
one of the class of things of read
evaluate print loops so that means it
takes a snippet of Java code declares it
runs it and you immediately see the
results so rebels are something you see
in JavaScript
a pearl and a bunch of other languages
and now we have it as part of the JDK
platform and in fact is deeply
integrated in the JDK platform not only
is it inside the JDK but it's built on
top of the JDK infrastructure is built
on top of the Java Virtual Machine on
top of the Java compiler ok so what I'll
be showing you in this is the the J
shell tool which is a lot easy easier to
show than an API and it's probably what
most people will use but that tool is
built on top of an api api is actually
where all the all the good stuff is but
the tool is just kind of a shell on top
of that and that's because really feel
this this functionality is useful in all
kinds of applications and in other
incarnations of a rebel so what she
shall not this is not a new language
this is snippets of pure java code
there's no new syntax nothing was added
except for the ability to just use
snippets and nothing was removed except
for things that don't make sense at all
i would slide on the details of that
later this is not a replacement for the
compiler an ID this is for exploring
code and if you're going to write a
program you're still writing a program
with the tools you're familiar with
so wyd racial there's three kind of
overlapping audiences that are in you
know that a shell is useful for one is
people that are new to java programming
or new to programming period and that's
because you it's it's really good
because you can start with expressions
of statements rather than jumping into
whole programs with classes and main
methods and so forth and it's also
immediate feedback which of course is
also good for the learning I and we're
all newbies it at one time or another
still because we encounter new AP is
that we're dealing with or new language
features and we get to experiment and
instantly see results it's also useful
day to day like okay how am I going to
do this exactly and you can kind of do
micro testing the pieces and make sure
that you've got your code right before
you add a to your program okay so
currently everybody knows how you go
that programming in Java you have to
write a class with imports and a main
method and you use either an editor or
ide to to write that and you compile it
and then you execute it something's
wrong you repeat that cycle so in white
is what you have to let's say we just
want to know about a little experiment
what's the difference between signed and
unsigned shift on a negative number so
we need to write a class and main
message in print statements and then we
contested we compile it run it and we
see whoops the format of that result
isn't very interesting so probably want
to go back in and change it to an octal
output so cycle through again
what about NJ shell you just type in a
snippet of code and immediately see its
behavior so now in white is what you
type in this case in jail you just type
the expressions and the result is what
you see on the right over there so it's
minus 2 on the left is a temporary
variable that's created so that you can
basically access that result later same
is true of course in the other case
there's another temporary variable and
then we see that we want to put in octal
and we can just print it okay how do you
go about using a shell so if you have
jdk nine installed you have j she'll
just type 2 shell with the command line
I the dish shell tool takes two kinds of
input one is the snippets talked about
which are little consistent pieces of
Java code declarations and so forth and
execute and then it executes them and it
also takes commands which give you
information about your what you've done
allows you to control things either
those can be tabbed completed you can
tab complete a command command argument
or a snippet
okay snippets they can be a variable
declaration method declaration class
declaration interface import if you can
declare them in Java Java you can hear
it there is significant in jay chou
excusing help okay expressions anything
from a constant to method call or a
complex stream expression they're all
valid again if they're a job expression
with appropriate context they're valid
in jay shaw same with statements for
well if the only things that aren't
allowed is jay shell code is self
contained in j shell so package is used
for making things accessible elsewhere
the package command doesn't make any
sense in Jay shell and you can't use in
Java you can't use static as a top-level
modifier and you can't you're either and
everything is dynamic in Jay shell so
final doesn't make sense then there's an
constructs that have to be inside of a
for loop or or switch method of course
they don't make sense just looks so the
only things you can't do
commands so there's list that shows you
the snippets you defined you've entered
there's bars would show you the
variables and their values there's
methods which shows you methods and
their types and there's types for
classes interfaces critic and imports so
there's built-in like line editing in
the J shell tool but sometimes you want
to edit things as a whole and there's an
edit command which is can configurable
to use different editors you can say I
don't want that a particular snippet as
part of my world and you can drop it you
can save your set of snippets or your
history you can reopen them and have
them reevaluated accession things well
you can exit it's all good and then
other three commands or four kind of
resetting the state with potentially
with reloading so environment allows you
to change things like your classpath or
module path and then reload things in
that context reset just kind of scrubs
your world and you can access your
history there's an extent there's an
extensive ability to configure your
environment basically what kind of
feedback you get your prompt everything
and that's all in set and then there's
help for all of these things so for
example if you do help anh Li everything
all the commands can be abbreviated to
the point they are unique so what Li is
unique for list command and you can say
help Li and it shows you the various
kinds of lists you can get
and just this is the set commands fairly
deep sub just going to give you a basic
idea of the kind of things we can do so
you there's a built-in editor so first
it tries to use any your if you have an
editor setting it uses that otherwise
use your built-in editor unless you've
set the editor command you can use any
operating system editor you more when
Jay shell starts by default it gives you
a set of kind of really common imports
okay so you don't have to to do some
simple thing you don't have to do an
import you can change what that startup
file to is to anything you want and
there's also pre-existing things like I
use printf in in that first example
there's a startup file that has all the
print line print deaths or fourth
defined next there's predefined feedback
mode like verbose or concise and or you
can define your own and that allows you
to set what feedback level you want and
then the next for basically for
constructing your own feedback modes
finding creating the mode saying the
prompt setting truncation and all the
complexities in format which is
basically what kind of feedback you want
for different things and finally all the
commands without an argument including
just that show you the current settings
okay this is what it is now but in a
couple weeks we'll be changing it to
this so that's what I'll show you these
are so people well
these are Jay shell specific keystrokes
so if you're in the middle of typing an
identifier in a snippet and you hit tab
it will do it will do command completion
for you completing it too if it's unique
or show you the options if it's not if
you are at the beginning of a method
called parentheses and you hit tab at
that point it will show you method
parameters will show you all the
possible signatures for that method and
if you hit it again at that point you'll
get the Javadoc now people and then
before we're getting feedback well why
don't you out of our command a lot of
rebels have that well so once again
we're not change anything here but this
is this is probably as good so basically
if you've written an expression and you
type shift tab v it will turn that
expression into a variable declaration
will compute the type of the expression
use that and put you in a place to enter
the name of the variable and if you are
at the end of an identifier needs to be
imported you can do shift tab I and it
will give you a menu of possible imports
that match
control c you can control see a running
process or borderline control V you can
exit so underlying all this the JCL tool
is built on jail I'm to which is a red
line implementation in Java so it gives
you all the kind of common editing
things you might be used to from Emacs
or something you can navigate with the
arrow keys through the line or through
the history of what you've entered if
you hit return I don't run in one of
those lines including a history that
enters the line you're on so I won't go
through all these in detail but you can
do Emacs type editing like control a or
control k to kill or even define
keyboard macros okay I'm demo
powerpoint crash that's we know what
okay so to start JCL you just type
official okay um and so we can we can
define a variable once a string asses
hello so again it shows you the the
value on the right and the variable
attend on the left in this case we've
already said what variable it is so it
doesn't create a temporary variable for
us anytime we have a variable or
anything else we could want to know its
value we can just enter it and it'll
show us so we can use tab completion
here let's say what operations can I do
on string again I can hit tab and I'll
show me all the things I can do with
tabs so let's say we want to convert it
to uppercase so i can i can go i can
only type t up it makes that unique and
hit tab again and will complete it to
uppercase but notice some of these have
close friends also that means there's
the only definition is one with no
arguments but this has an open paren so
there's clearly potential arguments to
uppercase I hit tab this would be after
a print of a method call so i can hit
tab and it'll show me the signatures
available so if i wanted to pass in a
locale i could i'm not interesting that
and there's my value again it creates
the temporary variable three with hello
the
just to give an idea of what you know so
you can use that in any pointing okay so
how do how do you edit things in line
here let's say we want to create a
method that does shows you half of a of
an entrance string we can so I know its
sub something oh there it is substring
and it can complete it and length
divided by two
okay and it says we've created a method
half that argument that string well
let's try calling that method see if it
works well we got half of the string but
I wanted the first half not the second
half what do I do so I just go up to the
death pero twice and it takes me back to
the method i was in and I want to start
from zero go to the halfway point try it
again again go up twice hit return okay
there we go I got happen to my tray any
questions so far yeah what version of
the JDK I this is the latest 11 161 but
it hasn't changed much I mean we're
we're in a stabilization part of gin
canine and you know there's been a few
bug fixes but it's been in there for a
while none of this would be any
different the the tab when I'm saying
tab for at the end of a parenthesis for
example that's not in even our
development stuff yet blur but will be
changing that so I'm telling you what it
will be in three weeks rather than what
it is now because that's not very
interesting okay so when you're
programming sometimes you have to
forward reference things but also if
you're just kind of doing things on the
fly you may want to reference for
reference things just because you're
figuring out as you go and it certainly
helps me so let's say we want a method
for the volume of a sphere okay let's
call it vol
and we'll have it take radius and I know
the formula is four thirds of pi times
the cube of the radius we haven't
actually defined pyar ki you be epic
we're going to head anyhow and and it
actually allows us to define this method
so yes I've created this method and it
says it can't be invoked until you
define pie and a cube mething well one
way i can define something is by
importing it so what's important static
so lame osim using tabs a lot and I'm a
really lazy typer I know not math star
okay there's something else about
everything I've typed here is I haven't
put a closed Santa Claus so the terminal
seminole can be admitted in within the
tool internal semicolons like inside
that method definition are still
required okay well now let's try calling
ball we define and put whoops no you
can't do that you're still trying to
call it even though you haven't defined
cube
now bear up arrow a couple times active
vol hall is try it again well this time
I let it run anybody see anything wrong
with that supposed to be four thirds pi
and that's pie so something's wrong and
and what happened was we're doing
integer division and so 4/3 is one let's
make that floating-point division and do
up there a couple more times and try
again and we've got a result okay this
point I'm going to head back to the
slides skinny it lets me do that come on
it's right papillae crash so now i have
to restart powerpoint
take me back to the annual yeah all
right so excuse me help me to get us to
the right place
okay now let's talk about the
architecture of gel and the API so going
into creating J shell we do have been
some attempts to juice before the based
on interpreters and so forth we wanted
something that was going to stay current
and and we didn't want to be in some
situation of chasing corner cases of
going well our says this discussion says
that we wanted to be and the way to do
both of those things was to be based on
top of proven technology and so that's
we've done we built it on top of a
compiler and on top of the virtual
machine and then how you interact with
it we wanted to be easy and natural we
did a lot of work to try to do that and
we're still open open to feedback and
for the tool we decided our in a
withered tools and libraries group but
we're you know we're not a UI group so
we're going to stick with a command-line
tool I personally prefer a you know GUI
tool right so so we want to do that it
could be easily done with the API let's
look at the architecture
okay the big orange box is the core
implementation of JSON so as I mentioned
the parsing compilation stuff is built
on top of the job java c compiler using
the compiler ap is the execution part
will its prescriptive it punch line is
is built on a JV it uses JVM using the
JVM in a remote process which means if
you do something that crashes your jvm
it doesn't crash your tool so to control
that we use the Java platform debugger
architecture through the Javed debug
interface and some wrong control
mechanisms but that's actually just one
way to do execution we have the J shell
service provider interface which is
allows you to choose execution but
execution engine you want to use now
most people wouldn't be interested in
that but for specific applications for
IDs and so forth they can you can plug
in the execution engine you want okay so
what the J shell implementation provides
is the J shell API a way to evaluate
snippets of code and the J shell tool is
built on top of that and for user and
interaction uses the J line to library
and there's a small little API for
launching which basically allows you to
configure a tool and start it so there's
so you see kind of well me go to the
next slide all right so these are the
packages within the J shell module
educating the modules called JDK j shell
so the jdk j shell is the API that's
what if you're going to use a tool
that's you're going to build a tool on
top of the API that's what you don't
want to use then three down is that
service provider interface we're
changing out execution engines and went
above it is basically a library of
components for execution engines and
then finally the bottom is Kincaid a
shell tool is for launching the JCL tool
and the the command line launch goes
through that API to okay a really twenty
thousand foot view of the AP shell API
so you get a Jay shell instance and once
you have a JCL instance you ask it to
evaluate a string which is a snippet of
code and that produces basically
actually a list of events of snippet
events and they hold snippets which are
a representation of a java snippet and
you can make all kinds of queries on
that including its data off on the far
side there's this source code analysis
trunk which allows you to do basically
completion analysis and things like that
that's you saw the tool using that when
you hit tab it's basically calling that
completion analysis so all the kind of
interesting pieces in j shell are built
on the api so other tools could you
well actually at this point i guess that
plenty of telling room
yep all right I'm going to switch back
cooperate so I can do a meta example of
using the J shell ap I kind of just you
know exploring it and creating a mini
jesh el tule from within the JCL tool so
let's say so we but before we do that so
I use that printing thing before I'll
show you a little piece of upset so so
this here's the set command and we want
to set start and if you use retain on it
on a set command it will retain that
setting for future invitations of the
tool so what the default default imports
that we typically get plus printing
support and then we're going to
accidents
and then we'll just do deja again and to
see that we got what we want once again
if you do is set command with no
argument shows you're setting it says
your spike setting is set start retain
default printing and then it shows what
default is which is those imports and
when printing is which is just finding
all those print and print lining printf
kind of gratuitous we're only going to
use print once in this study just want
to show you how set was ok so we saw on
the slide that you have to have a JCL
objects to use J shell so let's just
start we know we need a JCL but we don't
know I forgot where where that comes
from so i can use shift tab and I and it
will show me where I can import it from
its allows 0 to do nothing or one to
import from JD KJ shell facial now we're
back to where we are but Jay shells
imported ok what can I do with the J
shell
tamil fact I have sinned system
I don't know where it is
there's some keyboard thing happening
here
works now okay as never happened to me
before but of course happens now so
amongst those options could we want to
create a Jay shell object will probably
want to put it in a variable to use so i
can do shift tab v so it knows the type
of object being created is K shell that
puts me in a position to name it i'll
call it SH and so what can I do with
educational object all kinds of things I
can do all kinds of queries and so forth
them basically lot of things of
correspond to the commands we saw but
what I want to do is evaluate and let's
say we want to evaluate this declaration
of variable X so this has a semicolon
because this this requires complete
valid snippets of the tool using the
source code analysis to decide when it
doesn't really when it can add a
semicolon for us okay that created a
snippet of a list of snippet events that
look like it only has one snippet in it
and it put that in temporary vailable
three and we're going to just like even
get that first one out and that's going
to be our snippet event so here it gives
me three about three choices for
creating the variable I can do nothing
create the variable or import snippet
event for me
and create the variable that sounds like
what i like and called a DVT okay I've
got this event what can I do with it is
the queries on event and let's look at
it status so it's a valid snippet that's
that's good to know oh how about getting
its value yep it's five notice the value
is a string the values returned are our
strengths have more of this I'm not sure
that's that interesting um so I'm going
to go back to the slides okay
oops No
so Jay Chou is part of the jinn canine
so it will simple and JDK nine ships
which I look up on the web is july
twenty seventeen its access you can get
early access builds through java net the
source code is available as part of the
source code of course of JD canine it's
in the lang tools i'm sub repo and in
the dat KJ shell module there's a jet
that corresponds to j shell it's two to
two and i am this is very much a work in
progress and i'm going to find a better
place for it to live but i'm working on
a tutorial for jay shell which currently
resides here the official oracle docs
team is kind of just started so i'm not
sure what they're going to create so the
team the engineering team is self robert
field non l'ho de and jdk nine
committers which currently there's only
one Shania scheana and we're definitely
very into the open source thing so if
you want to be a contributor on this
we'd be happy we're probably talking
about the leases after JD canine at this
point lots of people very involved in
the process certainly
ryan gets and rest of the lang tools
team and lots of good reviewers and
cheerleaders and so forth and I'm open
for questions of course yes is it
possible what yes yes so you can on the
/em command or on the command line use
class path or module path so that's
that's one one approach to do that yeah
of course that makes a lot more
interesting when you can interact with
an existing library of of code what do
you mean
right so there's there's currently no
way to do that it's it's potentially
possible and actually you know so I said
that thing about the SPI with an SPI
implementation you could do that and at
least one ide vendors we've talked a bit
a little bit about that happening
persons guide you have to have a
production implementation any other
questions where do we want to go from
here one thing is want to make the tool
more configurable so be able to kind of
define the ability to add functionality
to the tool which means the ability to
push things down into the execution side
so for example you want to instead of
displaying results as strings you can
pop up a graph or something that's just
one example just an accessibility
mechanism the question
all right thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>