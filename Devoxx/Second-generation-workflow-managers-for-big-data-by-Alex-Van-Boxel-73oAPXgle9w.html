<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Second generation &quot;workflow managers&quot; for big data by Alex Van Boxel | Coder Coacher - Coaching Coders</title><meta content="Second generation &quot;workflow managers&quot; for big data by Alex Van Boxel - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Second generation &quot;workflow managers&quot; for big data by Alex Van Boxel</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/73oAPXgle9w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello welcome to
second-generation workflow managers the
second-generation
workflow manager already out for a few
years but they're now coming up first of
all a disclaimer this is not really a
Java Tobit more vital talk
why because you see a lot of things in
the second generation the glue in big
data is not like Java like the first
generation like Ozzie and Azkaban
the second generation is all imp item
and one out for longest is Luigi but now
there are this year two new ones that
came out and imp item so it's becoming
the glue between everything in Big Data
so it will run everything in your big
data stack so I'm Alex unboxing I'm part
of the stealing of deaf folks you'd
probably see that but I my day job I
work at a flash shell shop and for
exclusive and they're the big data
architect and we're a very small team
there
what kind of shop are we we're like
flashing this shop so we have like sales
of five days and every day we have five
sales that go out so in that timeframe
we try to sell as much as possible so we
have a lot of data of customers of
visitors we have lots of peaks and most
of lows so a very interesting data so
what is workflow managers a lot of
people gather they work with spark with
Hadoop answer but still you need things
to glue together so it's best to explain
a bit with an example of define what our
workflow manages of what you need so
where or when do you need it so if you
have like 100 or even less jobs you need
something to glue that together and that
will be a
a workflow manager you will define
complex dependency graph one job needs
to run before the other or one job needs
input of five other ones so you have to
define those dependencies are you doing
don't do that in inspire color tube
itself you do it at the outside without
workflow our manager - that pure in the
script so you need visualization because
yeah you're not going to define your
complete stack of jobs not gonna do that
in Visio or keep busy
drawing the lines everything you want
something to do that for you and there's
also part of the rough floor managers
tasks to do and the ability to monitor
stuff also part of that one and in your
things like your scripts you want to
parameterize stuff so you can reuse your
scripts for other days that's all the
responsibilities of the workflow manager
so it's certainly not a data processing
tool that's just the glue that
everything duct tapes together
that's your workflow manager so we are
quite new in the Big Data space as a
single company so like a year and a half
so if you start new what do you do
you're just write your things in a dupe
by the time we started spark was quite
new so probably if we started new now we
would start to its part but then it was
a big that created MapReduce jobs on a
to but you have to start something how
do you do that you just do it in a batch
file very simple and it was quite
sequential so we had a cron job starting
stuff so this is really an example of
what we know what we are learning now
daily because once it's written you
don't touch it anymore that part anyway
so you're right all this new new stuff
we want to replace those batches but
yeah you know it how it goes in a
company so but yeah after that that come
come new new requirements you really see
that there know the things you can't go
further with with batch sure you need to
start with scripting and all those
things so I'm going to do an example
workflow what we started in Luigi one of
the new workflow managers a very simple
example where you have several stop sub
jobs aggregate light purchases of the
day the cars of the day it's not the
same as a purchase but because every
cart doesn't create a purchase and the
visits we aggregate all those things and
then we segment people and we do that
daily because people can move daily from
segment to segment how you you how can
you do that native in a naive Lee you've
yeah you start something in chrome do it
one day one hour hope that it runs in an
hour then the next thing next thing or
you can script things together but let's
hypothetically say that we do it in a
cron job so create some code around it
you put some stuff in the code that you
have more control over what happens
instead of delegating all the
responsibility to chrome this is already
a bit better then we load our aggregates
do a job you know to inspire quorum
whatever and then export it to bigquery
we're have a user of the Google products
so we push everything to be query where
we can easily query stuff but yeah then
you can start that one script and you're
off but yeah what about failure what or
the battery tries after that failure
because certainly failure happens what
about using the streets for four other
days what what do you have to do so
Naoki starts adding boilerplate it
occurred it's very much fun for this
example it's quite okay so you can you
can do a try-catch rant you're on your
calculation of the segment because
that's the heavy heavy engine of your if
your task or pipeline so you try get so
and that fails that you at least remove
your code that's been partially
generated because if you don't do it it
can generate much further in the in the
pipeline problems without you knowing it
so at least to try catch so that's the
first thing where you you have add a
boilerplate but yeah then you recover or
your export fails but yeah then if you
want to retried and you don't want to
calculate a segment and again because it
takes like three hours to calculate for
example so you add something that those
files already exists extra boilerplate
boilerplate and what if you want to
parameterize everything extra
boilerplate so in Python is quite okay
to parse your arguments and do stuff
with it but at least it's extra power
plate so and then comes even more more
fun parts it's like adding the
dependencies between everything this one
is quite a simple one but if you have
like hundreds of jobs linked together
you see really see that that's the
problem being a small company we didn't
have the time to to create all those
things so we were looking around at the
time the most popular thing was Uzi
do to get started that's one of the
first generation ones so so but if you
if you look at all those problems yeah
you will see you'll see a pattern and it
very much looks like make so we needed
to let the that's what's like make so I
guess I mentioned it's like Susie didn't
like that why so all defining in XML so
we're not going to do that the other one
was Azkaban it's a java-based one but no
we had some troubles with that so I
looked at another one that was like a
year and a half ago it was probably not
new but it gained some traction like a
half year and a half ago so it's game on
the radar so we said let's write an
example of little Luigi was not quite
comfortable in buttons but at least I'm
going to try it and quite happy with
which was we managed and why it's also
very simple it's just two components one
is the server and when is the work if
you don't don't have a lot of setup to
do
I think our configuration file for the
whole stuff is like three lines of code
you know like configuration lines and
that's all also it's also open source
you just need to install it tip is the
dependency manager of Python you have it
on your machine started up and you can
start building your your workflow what
is the main feature sets with a promise
so instead of writing everything in a
DSL or or in XML it's all in Python the
promise is also to make the least amount
of code so it's very readable and
although it's code it's still readable
so it is command line based
for starting stuff up I'm comfortable
with that but maybe other part for a lot
of people it's maybe that's not so okay
but it's then easy to do integrating
other tools because it doesn't have its
own it has a schedule for getting a jobs
done but starting the workflow in its
whole you still have to start it
externally so we still run it as scrum
but from there on everything goes and it
also has the work flow visualization for
looking at all the of all the workflows
so here's an example of two of our
workflows that we will run see a lot of
different notes having to like that also
makes it easier to split things up so
otherwise you can have like a big spark
or floor or Hadoop workflow to having
one go but it makes it easier to split
it up around it separately and reuse
some stuff so it had this hand emphasis
on Hadoop and HDFS at the time but it's
very easy to extend I said we are very
big user of the Hadoop to add Google
tools like bigquery and so on and search
and it was very easy to extend so but by
now all those things are supported
natively but not when we started and
this is one of the the Spotify graph
that I found
it's probably an old one and probably
much bigger and there's somebody from
Spotify so again you can say that it's
probably much bigger by now but if for
the scale we work at we will never reach
the the the scale of Spotify that's good
enough so we use it for for starting our
Hadoop MapReduce jobs
start a spark shop no sparkly runners
now he will be not there in productions
the stage but we're probably going to
start those things as well and have the
interaction with a big query loading and
loading jobs loading them back and also
interaction with the database so
whatever main building block is there so
you're the next slice where we will have
some code the main thing is the tasks so
the task is the real base class and that
impact on where everything is built
around so you have you have a task very
basic it defines its output its inputs
so what does it require in the run yeah
there you you run some code or define
parameters of what you have to delegate
to your bake your sparked jobs built-in
is then an external towers that monitor
certain space on your file system or had
to fast or whatever no wait for input
and also has some very good templates or
toast in place I recall it for for
Hadoop spark and so on so we did
internally because it was so easy to
extend it for bigquery data flow as well
and that approach the new new manager
system from whom it was easy to extend
like I said so in the requires dare you
defy your inputs being a programming
language you can there use like for
loops to you have to define data ranges
for example get em every buckets for
that date it generates a lot of subtasks
you can go even a recursive in this
example although it's not the best
button to use because it's very it
doesn't paralyze
but it's possible make sure you have an
end and end date otherwise your workflow
will never end and then you define your
output that I put is actually a promise
of my output will be dead and Luigi will
make sure that your stuff is there in
this example it will it will look at a
mark of success on file system or a
virtual file system if it's there and
then it will define ok it succeeded or
not or if you run it again it will look
that that market is there if it's there
and said ok we are already a run then
the other thing what we defined what we
need it is actually reused and
parameterizing your jobs and it's very
easy just define one line so the second
line on the slide you say day and then
it's a date parameter and it makes that
directly available in the command line
at the bottom you see see the line how
how that they will be made available so
you can magically add parameters that
way the target is like a virtual file
system you Luigi has a few few ones
building so of course a local one an
HDFS system and are also built in
support for Amazon less trees and now
also again it has a real cloud storage
support and bigquery target support as
well so bigquery is like query engine
and data set and you would doesn't work
with files but still you can extend it's
that that data set is available or not
you can always layer layer of a virtual
file system on top of that and that's
what available now
so being tools in action I've prepared
of a bit of a demo obviously lifetime
this is linked everything is available
so you it's very small example the only
thing you need is a pip install Luigi it
will download Luigi on your local
machine start to daemon up and learn
examples they all run locally on the
file system so you don't do not need
anything else the demo will be centered
around the examples one not a simple
it's too simple it's a bit the example
that I showed in the slides so we have
like we have so we have imports of card
information and invoice information
maybe with dump our web loss history
visit visit buckets bucketz are
aggregated data birthday that we do and
and all those things that was like the
graph for the segmentation and to make
it even more interesting I made like a
report that he uses the data and all
those things we run those things nightly
it's centered around a nightly task at
the bottom you see we have liking this
example to exam two things that run good
to run in parallel or not Luigi will
define on what will run when so the
monthly reports and the customer
segments so she ran its command line so
it's like Python file simple one file
you saw at all
whatever was if you do nothing define
nothing there's no task specified so
every class will be exported as a tasks
you can start a visit buckets just by
saying the visit buckets around
before the presentation by default you
can give default parameters in the
default is yesterday so it's it did run
working on the local file system its I
dumped everything in a temp so the
orders and so on has its own directory
and it will generate its output there it
sees the file is there so it doesn't run
again and if you do help you will see oh
that's fun I did I did go back to 4 so
if you see a lot of other parameters in
the file but the day at the bottom one
is the one that's exposed by a single
line in the file and let's go back do
the visit buckets right by doing this
it's better if by doing this it's
available external and here its outputs
here if you will look at this directory
we will see that the file will be there
ok that's boring this very low in the
graph let's run our nightly job task ok
and like I said they have a built-in
visualizer demo gods are not with me
it's running would like to show you the
visual is it that's not cool all right
that's a pity ah let's train crafting
runs localized here resolving hosts so
we don't not have internet it should not
get stuff from external that's a pity
anyway without having to visualize it
yeah it's localhost
okay that's a pity because the main part
of course let's hope the internet will
be back in the next five minutes so it's
running now locally which went threats
so Luigi has two parts one is the the
demon that is visualizer and also that
demon make sure that let's not do to ask
around at the same time so we are on
everything on one node but if you have
liked to work and nerds where you want
to balance your stuff you will have to
talk to one node to make sure that that
task doesn't run at the same time so now
we turn to my core but if you define
like workers like six it runs six at the
same time you also saw I could just stop
it and it will stop it tasks tasks but I
can just rerun it with more worker and
it will look at what it done did already
or not and it will just resume where it
left off so that's that's cool see if
it's bad it's back so here you have your
list of tasks or nightly tasks has has
built a graph so here's the the the
graph of what we generated in those few
lines of code like maybe what is it like
30 lines of codes it generates a
complete graph look at it at the top
nightly tasks then the customer segments
monthly reports monthly report to reuses
stuff that's also needed by the customer
segment so that's why everything
converges at the same point get it from
down to button and the green things are
things it already run the blue dots are
the ones that are currently running and
the red ones are the ones that failed so
I've added a failure in a one so every
prime number day to a fail so just to
show the recovery
second ISM so they are just yeah right
so let's let's let's fix data so in the
code is probably something that says
let's fill when it's Brian
yeah ochite where did I use it yet if
it's prime let's fail let's remove this
and just do our stuff again so we can
stop and run with the new code voila
again with with six now six notes six
six course will refresh this because
it's not outer refreshing that's a bit
of pity but it's still okay it's still
usable for for for this it's still slow
but okay this whole thing host very
annoying there's probably something that
brings back to Google Analytics or
something you never know yes it's coming
back alright so I am in there they're
already resolved so it was just a random
sleep so yeah it goes quite fast so it
just continues and that you really
imagine that this is of course a very
simple demo but if you have like a long
running tasks in your attic cover you
don't want to to look at the
dependencies or
there and whatever have to delete or
where you have to restart again you just
fix your problem normally it will be
nothing you're Luigi code but it's
somewhere on the job that you are
running you fix that job again rerun
your complete graph again it will see it
isn't isn't is already built and it will
pick up where it left off so for us it
was a real help it's certainly better
when you're still
writing bad scripts or when you're
working with Busey or something
certainly have a look at this too it
will probably help you a lot more than
just working with a batch I have some
still some time for for some Q&amp;amp;A I
promised in the description to have a
quick look at the the new other one kids
on the block and that is add air flow
and pinball
I'm personally will will have a look at
air flow that's also workflow manager
from from Airbnb it it is gaining a lot
of traction
the other one is Pinterest they came
around with separation of a few months I
think but if you look at those boats
they are not complex it because they
have like like four four components like
a work or a database a separate schedule
and sound so it's harder to start but
still we are now being more mature so
well we'll certainly have a look if you
if you look at those both work airflow
will have as more direction in the
community because you see more tall
request while pinball I didn't see a lot
of activity outside of Pinterest but
certainly if you want to start simple
certainly have a look at Luigi so we've
still some time for the questions does
any wouldn't have questions no see
nothing
all right then thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>