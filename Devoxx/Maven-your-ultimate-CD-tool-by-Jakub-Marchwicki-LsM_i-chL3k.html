<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Maven - your ultimate CD tool by Jakub Marchwicki | Coder Coacher - Coaching Coders</title><meta content="Maven - your ultimate CD tool by Jakub Marchwicki - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Maven - your ultimate CD tool by Jakub Marchwicki</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LsM_i-chL3k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to this very last session of
today and I think what we are left only
after that is the birds of the feather
talk I'm glad you made it
for the Maven talk on the Java
conference
hardly anybody speaks about maven
especially from context that it can be
in any way ultimate or whatsoever I hope
you noticed from the title that this is
a kind of troll talk what I do on daily
basis is I work with legacy teams and I
work a lot of legacy code and this talk
is coming from a perspective that very
often we are on a project that we have
no power to change anything around the
build so we are stuck in a certain
environment and we don't have much space
to replace maven with something else
or to introduce yet another tool to our
infrastructure that will do the thing we
are aiming for so we are left with maven
and yeah how we can make it do things we
would like to do so yes this is this is
pretty much the premise for the talk
this is one D&amp;amp;D on the slide I will jump
back to IDE as it is kind of a tools an
action I will cover a few things if you
would like to see and get the code I
will be showing or as well as the as
well as the examples that this all hears
and it's on github so yeah I've spoken a
few words Who am I I came from Poland
and yes I work a lot of legacy teams
working with legacy software they said
that the thing I see is that they
gradually try to recover from legacy
trauma by introducing micro services
which is out of the frying pan into the
fire and some in certain cases but yes
that's my and that's that's where the
inspiration for this talk came from so
in general why not my van
well maven is not exactly very often
tools to tool for the job it is
it has the preferred easy path that's
how they refer it so if you do thinks
maven way you are alright but if you
think of doing things different way or
very different way than the maven way
then then you have certain problems and
configuration issue and you have to do
things on your own you can do your own
plugins but unfortunately writing the
plug-in for maven it's not a minute or
extending the your build pipeline with
maven it's not a manner matter of
minutes
it's rather matter of hours or days
because you have to build something and
there is a steep learning curve and
building building the plugin so why we
are talking about many years because
it's all deep but Goldy and everyone
everybody uses it so getting back to
anything related to smart code I can
feel that there is a kind of an ideal
built pipeline or not maybe not an ideal
but certain steps that repeat from the
project to project in terms of getting
the continuous integration or continuous
delivery delivery right so we have
multiple dependencies on our project
sometimes sometimes it's just the single
single binary that we are building then
we are trying to assemble it in any way
and then build it in a kind of binary
form I call it release where they put it
into our our local local maven
repository and then do some next steps
like testing at UAT testing it's
releasing to all the staging and
environment and so on and so forth and
as soon as we are happy with the result
of the tasks we are ready to promote it
and we said yes this is a stable build
and yes we you can you can go it on on
on the production so the thing is that
we would like to have only the green
step happen remotely and all the other
steps all the other previous steps
happen locally either locally on our
machine or locally on the integrate
continuous integration server or locally
wherever so we don't want to prematurely
release our our artifact whether when we
are not sure that that's the one that we
are we are happy with we don't want to
target anything on the remote repository
or we don't want to push
into the and to like a remote source
control we don't want to push anything
into remote repository and this Lee
still asked to some anti patterns like
we can still deploy it manually or we
can have production like environments
and so on but it exposes I think a
certain patterns and I will focus on on
them we would like to have binary build
only ones as soon as we build the binary
the the war file the Java file whatever
we are releasing we want to have it and
we don't want kind of rebuild it we
don't we want half we would like to have
the whole process covered with this
single binary file that we just prepared
so that that we are sure that if we get
out of do it with to the production
environment it will still behave in
exactly the same way so we would like to
deploy the same binary to enter every
environment and smoke like smoke test
the dependency and as soon as this
that's right and as soon as we are sure
that it's the right right well we we are
happy to really this is pretty much the
how in most of the cases we are we are
looking it so I will focus today on
three things on releasing process on
preparing I'm preparing the docker image
but preparing any other image that can
go directly to a production environment
if you are looking for any
virtualization or containerization think
and how to assemble applications from
multiple parts I call it micro service
architecture because it's micro service
but not micro service but not two but
not exactly so the thing is that we have
separate teams working because separate
things from a monolithic deployment and
you would like to assemble them
sometimes the teams are working on a
totally different environment half of
working Java on the backend side and the
other half is working JavaScript on the
front end and we have to combine it
somehow and yes I may even still can
help help us you might say that why
bother because we have maven respawning
that should do the job
yeah the problem is that it doesn't
exactly do the job or it does the job in
a very opinionated way and it's
always that this opinionated way is our
way let me let me show it by by example
earlier on because the internet
connection was a little flunky I created
a new new maven project with the
architect generate I won't do it now it
was it takes a while so it's in the
sample and my sample folder it doesn't
have Mars but it kind of compiles
just to show you that yes there is
something inside this is just this is
just an just an archetype what I would
like to do is I will initialize the git
repository do the gates do the other git
ignore think and and have a have a
baseline and now what I would like to do
is I will jump to to an editor which is
which is just enough um editor and to
have the release thing to have to be
able to release this I will define two
things I will define the SCM so my
software my software repository and I
will add one more thing so I will that
yeah I will head the release plugin I to
certain extent I can just use the one
that is out of the box but it's not the
lightest version so this is this is at
least the latest version and now to
certain extent my my project is ready to
be released so I can enter this whole
continuous integration thing I add
everything in here each ant
now and try to do and push it hmm now I
have to push it if there's this sample
repository that I haven't defined have
fused I can do it through maven through
SEM plugin like do the chicken and and
and everything or just do it standard
that's an easy part
remote onto region of live coding are
not with me today so now I have to code
somewhere and the in the in the
repository outside so if I do the maven
release maven release plug-in goes from
two steps first I've prepared the
release which you do which dance all the
changes with our webinar upon within my
palm files and talks the current version
with with a release version and then I
have a second common release platform
which actually do the release so if I do
the release prepare what will happen it
will ask me for certain for certain
values that I would like to put into my
my application that it will rebuild it
and and will start fiddling around with
my remote fiddling around with my remote
repository it will do tagging it was do
certain tagging it will commit the new
version for so called ready for
development and it will push everything
remotely if I look at my get log at the
moment I have two new comets that are
made by maven release maven release
plug-in and the thing about maven
release plug-in that it has been
prepared for releasing certain things
maven plugins and that's their workflow
and that's work for them and in many
cases and many teams that I've been
working with they were trying to adopt -
adopt for example git flow or other ways
of working with weave code that's those
two commit messages and that it was
doing everything remotely and on the
master branch for example that wasn't
something that they were really really
looking after so what we can do now we
can either hug the maven release plug-in
and its configuration at will will be
exactly what we will be doing or we can
write our own plugin that will do the
releases in a way that that we would
like to do and most of the cases we end
up hacking and fiddling with it with the
configuration it's never ideal but it
pretty much can get you to the point
that you might be more or less satisfied
with the results so let me jump back to
the back to IDE get to the point I'll
rewind my project before I had to do so
so there are multiple things that we'll
focus on and I will just show you one by
one what we can do to make it now to
make it better
first of all this is a Multi multi
module project the way you organize a
certain convention that you might build
within your team and this is the
convention in convention that we've been
using on some projects we have a proud
father called up or whatever which is
the application which is the the code
that we are aiming to push out to the
production and we have a second project
that it's more or less for deployment
purposes at for example builds our
images orbit builds our docker it can
actually push the artifacts out to the
remote repository we just keep them we
just keep them separated still having a
single single origin as kind of a single
a root of over parent of a parent
project and we will start with this with
this parent parent project within here
there is not much
besides the definition of the SCM
connection and then multiple multiple
plugins as I've shown you on the graph
what we will be looking after is not
just releasing it but what I would like
to do is I would like to first branch my
code into a potential release branch
then do everything I would like to do on
the release branch so not to fiddle with
the master or what not to fiddle with
the develop branch do everything on the
release branch so around the tasks do
they do the changes to the preparation
for the next development cycle to
certain extend deploy remotely or
whatever I would like to do and and the
moment then I will be happy with that
then jumped onto jumped back onto onto
master and and and continue the
development and merge with whatever
whatever happens on the release branch
the one of the ideas of doing it purely
with maven because you can do it exactly
with for example Jenkins build pipeline
is that besides it's not always at least
the teams I've been working with we're
not always able to be to get exactly the
Jenkins that they wanted to is that if
you do it and for example maven then you
can pretty much step-by-step reproduce
everything you you were doing without a
need of a separate separate
infrastructure and the other problem
with maven and with the other problem
with Jenkins which at the moment is
pretty much solved but with the other
continuous integration tools like bamboo
is that whenever you build your
continuous integration pipeline or
continuous delivery pipeline within such
tool you pretty much vendor locked in
and there was no easy way to get it out
for quite a long time apache bamboo
didn't even have a backup option so if
you would like to backup your scripts or
keep your configuration of continuous or
continuous delivery pipeline some were
not in the tool there was no easy way to
no easy way to do it on the other hand
maven with all this overhead it has Duty
XML it's still understood by most of the
developers it's and it's kind of their
first kind their first take in terms of
we will be we will build something so
that's that's why we can try it with
maven so what we'd like to do is we
would like to create a branch check out
from check out the branch do everything
locally so build that build a project do
the testing and then if we are happy
start the release the releasing the
releasing pipeline so I'm using here to
to to plugins why is my even SCM plug-in
just to do the branch that's that's easy
push changes Falls means I will not push
it further to remote repository but on
the other hand if I would like to use
the same plug-in to check out my source
code that's not very easy because it
will ultimately try to clone the remote
repository and to check out the single
branch so I'm just doing the exact maven
plug-in to check out with the local git
comment they the branch that I'll be
using for forward releases and now I
would like to fiddle a bit with the
release plug-in so that's kind of a
standard configuration for release
plugging nono very fancy execution I
talked the the name with a format I
would like by default is I think project
9 - project version we will do the
project version and yes we will version
all sub modules down downstream of our
parent form so now what we would like to
do is yes we don't want to push the
changes we don't want to push the
changes outside of our local a local
repository so there is this there is
this push changes talk which I will be
push which I'll be which shall be
starting to false by default it's true
and I will force it to use
to do the local check out like this
the problem with configuration is that
not every target not every configuration
options works both for preparation of
the release and for the actually
performing the release so so yeah that's
a little bit a little bit tricky and
then there is an option on the release
plugin that actually let me choose which
steps we go on I would like to execute
before actually doing the release so
there is this preparation gold stocks
and I can space separate all the goals I
would like to do before I actually run
the the starts preparing the release so
I would like to do the clean I would
like to do the trash thing by default
it's clean verify which for me maven
means clean the projects and run
everything up to integration integration
testing if I don't want for example to
do the integration testing now I will
focus with just testing I can do tests
then I would like to branch there then I
would like to branch the thing then then
I call a cm branch and then I would like
to check it out which I do through exit
plug-in with the gate house it called
get to check out more or less like this
mmm okay so that's my preparation and
last but not least during the doing
performing the the release so so I will
actually try to release the code there
is another there is another there's
another option which means goals and
these are the goals I would like to run
when I'll be actually doing the the
release by default its deploy so we will
be running all the steps of maven
lifecycle until we do the deploy which
installation on the remote server
however obviously I can tune it and I
would like to just install it in my
local repository because I will run
everything locally so no matter whether
I'll be doing on my local developers
machine on some any other machine on or
this will be tasks run by Jenkins it
will pretty much work in exactly the
same way the small trick might be making
it environment independent so running
the same on Linux box and on McCoy's box
and on Windows box but that's not
something that most of the developers
haven't done already the other the other
thing is that if we start preparing our
our tooling like this
what Jenkins or any other into
continuous integration tool it becomes a
simple of scheduler so we drop if we try
to encapsulate all the steps for the
continuous delivery pipeline within
maven then we can use any any continuous
integration tool just to do next next
next next next which to certain extent
it's tempting by very divided by a few
teams because I I've seen situations
where the continuous delivery pipeline
was built by operations guy who didn't
have much knowledge about programming
per se and build the pipeline as code
and the best post with the best possible
intention but still not being a perfect
programmer so it kind of gets a little
bit a little bit messy and with this
approach I've seen the same people
simply collaborated with developers and
the overall effect was better so it's
very contextual depending on what you
are trying to achieve and how how things
work work for you I will now do the
trick I will I will not I'll just check
out the talk where I was doing exactly
the same sort just formatting different
just to make sure that I haven't made
made any typos and I can run it with
maven release
it will take a while so more than I will
skip to to another part this B and the
beginning if you haven't come across
it's exactly the same as maven batch
mode the maven has this feature that if
it was interactive so if it was to ask
me certain questions during the during
the build process like what should be
the next version number and so ever and
whatsoever with buttering I can I can
suppress it and it will take either
defaults that it that by conventions are
suitable or will take the arguments that
I'll supply that I'll provide externally
so just run it and we'll get back to
that enough in a second unless it fails
okay so that was pretty much the release
plugin and we were here the other so
what we will be trying to get is to have
the release on the not on the current
branch but on the separate branch then
check it down do all the stuff and and
and go go from that and yes then if we
are happy with what we are releasing if
we are happy with what we have built
then we explicitly merge it back to
develop or master and then go on from
that mmm like minimize the amount of
artificial intelligence coming from your
XML script so while it's your hats
finished walls building so as you can
see we are on the separate branch or
already if I do get status I can see all
the backup release files and the release
properties that that are prepared by
maven I will do the release platform and
and let it let it run for a while while
it's performing the release maven is
actually forking itself and and the
second threat is rebuilding the whole
application then checking it out from
scratch and running all the tests
which sometimes are very huge because
actually that one involves the
application server and let me jump back
to while it runs to how I actually
prepare the the assembly if if we get if
we see once again at this point we have
multiple dependencies that altogether
come into our monolithic war file or a
your file depending on your environment
so I have multiple jars for example I
have a war file that I have a web
application which I overlay and few
other things that I would like to to
work with so as long as it's the Java
project that maven is natural and we can
combine it all the problem is when we
see non Java project like JavaScript
project you have a Java Script team or
Java Script guys on your team who are
really keen on building the front and
with the new shiny things like like
JavaScript and there they're built to
link looks slightly different it's a
package.json with some build scripts and
PM script or even like gulp things and
whatsoever integrating it to our like
web application might be a little bit
problematic but again we can we can do
it with to certain extent with maven
what I usually do in such situation and
that pretty much work quite efficiently
I agree with the team that I will kind
of drop in a certain think a single file
into there into the repository and I
will care of it
so what I do is I put a upon file and to
their end to their project so they can
work independently and there is a
promise symbol which I maintain as a
part of the of their project meaning I a
separate team or somebody who owns the
build the way it works the way it looks
like it's a very simple it's a very
simple prompt file which is using two
plugins
one is one of many front-end plug-ins
for maven which what they do is actually
download the nodejs download npm and run
from maven would
as in the entire project so I'm kind of
unique using Nathan as a runner where I
define these are the these are the
nodejs version nodejs version then you
execute installation and then you do the
the actual the actual build which has
some ID like build and have a goal also
NPM and some configuration arguments
which are run build so what is what it
actually does it will run the underlying
NPM package JSON with the appropriate
parameters and what will what will what
will happen is the outcome of the belt
will be placed in a directory that I am
I'm configuring so for example I will
put it into a target either into app
folder or into target whatsoever and
then I'm using a second very simple
maven plugin which is well-known maven
resource plug-in to take whatever was
the result of the previous build and
that code by convent to a certain
convention it was dist folder and
repackage it to target clusters meta in
resources folder what why I'm doing that
with Java servlet 3.0 which is few years
old already there was this idea of web
resources so if you ever come across a
web jar dot org you can take whatever
JavaScript library wrap it in a jar file
put it in your class path and if the
static wrestles the resources meaning
JavaScript of HTML or whatever are in
the matter and resources folder they are
automatically exposed to your through
browser as a static resources of your
web application as long as it's a it's a
it's a it's a servlet
server-based application so that why
that that that that way I took all these
Taft JavaScript guys written and put it
and dumped into into a web web
application in the way I would I would
like to do it and that way I combined
all the libraries all the dependencies
into a single into a single single war
war file which I then take through my
built pipeline so speaking about the
build yes it's successful it's as you
can see it's released everything build
locally I'm still on the release branch
I can see yeah that the jars are moved
to my local repositories all the
dependencies that I've been I've been
looking after so now I can move on with
the with the releases in the way I would
like to like what I would like to do so
what I'll do is just the show I'll show
you what I'll do is I'll run in my
docker and my deployment docker I will
run maven mmm
docker build so I'll prepare the the
docker image this thing I'm using so I'm
adding here is I explicitly can
externally define the version that I
would like to use so this mean it's an
artifact already in my repository and
then my doctor might even plug in rough
it's all together and install it locally
so the way I do it just final final
sentence is that in my script I define
properties that are easily over rideable
from from external external externally
and then I use the dependency of my the
dependency of my move yeah the maven
dependency to put inject it into
whatever further build I need so if I
would like to use this dependency as an
artifact which I would like to deploy to
any application server I can do it in
exactly the same a way because most of
the plugins
support that the feature so getting back
to the United in Silesia that's that's
pretty much the three tricks that you
can use and that can help you with the
with pretty much organizing you build
around continuous delivery pipeline half
an hour is not much so you can go
further and explore it the project is up
and running you can pick me up on
Twitter if you feel that maven is
killing you and not you're killing
yourself so thank you very much hope
you'll find it usable in certain extent
to sir the next time thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>