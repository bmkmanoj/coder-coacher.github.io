<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Deploying Spring Boot apps on Kubernetes by Thomas Risberg | Coder Coacher - Coaching Coders</title><meta content="Deploying Spring Boot apps on Kubernetes by Thomas Risberg - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Deploying Spring Boot apps on Kubernetes by Thomas Risberg</b></h2><h5 class="post__date">2017-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/EerHub6PoEA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay hope you can hear me sounds pretty
good welcome to this talk on spring
build apps on kubernetes I'm not sure
how many of you actually spring boot
developers on my nerve you are
kubernetes developers maybe raise your
hands how many of you actually develop
spring build apps alright that's a lot
of you
how about kubernetes how many of you
have actually used kubernetes alright
that's a few so it's actually Miller
developers and kubernetes developers but
that's good that's what they're kind of
what I expected so what about me I am my
name is Thomas whispered number this
spring team pivotal and I've been
contributing to Spring Framework since
about 2003 and I just realized that it's
actually 15 years since rod Johnson
published his first book where the code
that's learner became first base from
the Spring Framework project that's
truly amazing is still alive and kicking
and spring take spring framework to
another level and I just looked at the
Google search steps for spring built in
kubernetes and I knew they were both hot
technologies I didn't realize how well
they tracked each other from a
character's holiday season where they
took together so it's pretty interesting
so radius actually spring boots so
filbert takes an opinionated
you were building Spring Framework
project with Java projects and Joslyn
said it's basically pair programming
with a spring engineering team and I
think that's pretty good quote so
kubernetes on the other hand is the
system for managing containers and it's
based on code that's been developed over
10 15 years at Google and to me that
it's the same thing as speedy despairing
when the spring team then kubernetes
will be basically the same thing as
pairing weather Google's engineering
team and so let's just quickly talk a
little bit about containers how they fit
into our development and their different
layers abstractions that we record and
basically containers kind of fit in the
middle just above the virtual machines
when if you make that about there come
when you're just managing your apps and
even further more abstracted from
everything is when you start working
with functions of functions as a service
in the server that's programming style
another way of looking at it what do you
worry about as a developer today worry
about a container do worry about an
application and we're worried about the
function so these are basically three
very different abstractions that are
getting very kind of the three most
popular abstractions out there right now
and the higher the chain you're growing
the functions in there you expect the
platform to do for you the lower you go
in terms of the containers the more you
have to do as a developer to configure
the containers making them run or that
and scale them and all that stuff so I
just want to start with a very quick
demo
how do I get going with a spring boot
app running on kubernetes say have a
very basic app so it's basically one
class to have application Java
I created this using the spring starter
initializer and let me go back to the
slide there's a link here to the demo
document that actually outlines exactly
what steps you have to do now there's a
lot of stuff to cover in 30 minutes
that boot and kubernetes so I don't
think I'll have time to go through all
of that so that's why I took the time to
put together step by step instructions
how to get this up and running is a
little more involved examples as well so
the first thing you would do is to
install a mini cube which is the way you
can run kubernetes on your laptop that's
great for development once you start
deploying things you probably wanna run
it you and a host of kubernetes server
or something you set up yourself to run
on one of the cloud providers but for
just plain development I think mini
Cubert very well and there's a
command-line utility that you use
controller or cute cuddle or cube CT all
people of all different things but a
typical cube control and that's
basically a command line to control how
you deploy your applications so you
start up your mini cube and after that
gets going I just created a very simple
Buddha
this current command to specify the boot
lotion and I went the web and I want an
actuator and once I've done that I added
one rest controller method into this app
that was generated for me by the spring
initializer and I used a call version of
that you can go to start that string I
real
and you get this familiar hopefully most
of you haven't already seen this one we
actually set up just starting in the
spring application so I added the rest
controller mapping and just to say hello
and I just enabled an endpoint so I can
see the actual environment that we're
running in which is interesting when you
start up something in kubernetes because
you get a lot of environment variables
populated and I set up a docker file
because everything you deploy to
kubernetes has to be a docker container
and there's a trick like if you run mini
cube on your laptop and you want to
build your docker images right into the
same environment that mini cube is
running in you can just run an eval and
grab the darker environment for mini
cube that way whenever you do darker
commands they will actually use the same
talker environment that mini cube is
running
and then I just thought playing doctor
build and to the players
let me just make sure I do the doctor
build here can you see the font make it
a little bigger so we're at a darker
image next step is to actually run this
in mini cube so cute control run the
name of my app the image just a little
bit in backer and report the app is
using and you see the cube controller I
can see what pods are running like
kubernetes uses this pod motion which is
one or more containers grouped together
and for this example there's one
container running in my pod so that's
what I'm seeing that's why I'm seeing
one out of one there's only one
container in there if you have multiple
containers you see two three whatever
number of containers you have and it's
running so now I should be able to
expose deployment which I've just
created and I want to be able to access
it from outside kubernetes so I need to
expose the pods and this crate will
declare the service so now I have a
service where I can actually ask access
and I can use a mini cube command
and look find about the you are endless
and that's the actual URL on the port
then it's accessible through
so now I can actually just call the
hello endpoint using the same mini cube
command and it actually did work hello
Cooper knots now I said we exposed the
environment Jail endpoint so let's take
a look at what kubernetes is exposing so
a lot of my my valuables you see here
some of them I interesting some of them
maybe not so but the airport's exposed
and service names and that's interesting
because if you start up a database
service you'll see that service name in
here and you can actually access it from
these environment variables you'll see
that example later on but they probably
are not going to use this cube control
run command to run every app we're gonna
have more of a declarative state for our
application and that's when you use
these deployment files called the IANA
files so you can actually take a look at
what it's actually running what the
deployment looks like in the Yama file
so it shows you all the different things
you have to specify to get this running
and different it's actually more than
you have to specify but you need to get
labels so you can tell Combinator's what
parts you want to access there are so
different namespaces we're using the
default namespace you can have multiple
apps running in separate namespaces and
they don't actually collide with each
other
and here we see the container
specification so when you start
deploying more serious apps you
definitely want to create your own
deployment descriptors and the same
thing for the service and they're a
kubernetes as a blueprint for what state
you want you have to be in and it will
try to keep that state or just close to
that States as possible
and once you are done with this little
demo app we can delete it and their
labels assigned to all these resources
running in Cuban Aries so we can say
show labels and we see that the run
command added a run label with the name
of the app I'm running so now I can
access that when I want to delete things
I can say delete all and the label where
it's Romney Qin Solo and it should get
rid of the pod the service to deployment
and everything
so this is all well and good but what
about some more complex examples how do
you build apps for kubernetes to take
advantage of not just getting one hello
world app up and running you want to
manage a lot more about your app like
who has to talk to how do you find the
database to talk to how do you expose
your ports we saw a little bit of that
and that is how do you configure your
app and kubernetes does not really have
a strong opinion on how your app is
going to be architected but it does
provide a number of things that that's
provider the environment value of us we
looked at little earlier it does provide
a way for you to specify configuration
files NSS I think what secrets with
sebacean the basically configuration
file but the secrets are hidden or
they're encoded so you can't see them on
you you can control the access to these
secrets and they can later on be exposed
as environment variables for your app
there are so health checks where
kubernetes will call with app every so
often and make sure it's up and running
and if it's not it will kill it and be
started that's how it tries to keep your
up consistently up and running as money
instances that you require and it also
has dns-based discovery of services so
if you started my sequel database
depending on how you name the service
but if you name it my secret then there
will be my secret the NSM true that you
can use for configuring your apps
so quickly when we looked at we have the
deployment resources they use config
maps and secrets and the deployment
create for the replica set which will
keep track of how many parts you asked
for if you ask for three then it will
keep three pods running for each app for
each deployment and there is a service
that lets you access these pods from the
outside and depending on where you run
it you can it might provide you an
external load balancing which is not
available in mini cube but in mini cube
you can get to the service through the
mini cube command and find out what port
is actually running on so if you look at
externalized configuration was important
for any kind of serious app the
environment variables are important
they're easy to set when you deploy your
app you've specified what them I
remember it as you want if you have
complex bling boot properties you might
have to use the spring application jason
trick for getting the map based
properties to actually get picked up and
like I said sig maps and secrets are
provided by kubernetes and the way you
can use them you can either put in a
config file or secret then have that
exposed us an environment variable or
you can actually mount the config map
which is I'll show you an example of
what it looks like and then have that be
part as a mounted as a file in your
application so then boots starts up it
will see this config file
that like it would config files right
out of your jar as well and of course
you can also use any of the other spring
cloud features like get confuse over and
there's a trick where you can actually
use a this is something of an it
container so instead of just your main
containers that's probably you can
specify for your pod to have one
container when it your app is
initialized and you can actually write
something right your property files
using an init container that could come
in handy every now and then so have a
step by step down off a little more
complex app same thing start with a coil
command to create and this time we have
a few more dependence is specified so to
read bits a JP a has the actuator it's a
data rest
that's my sequel and hsql database
drivers and it's basically a simple rest
step to manage actor class entries so
just create a name in an age and create
a repository spring data repository for
that I don't like to code too much so I
use these convenient paging and
certainly the passwords were impossible
and then I create some properties for
this file to get it running and these
are all 30 minutes it's not terribly
long to go through weathers in detail
but if you're interested this I have
links to all these demo apps and you can
run this standalone or you can run it
using in my secret database declared on
kubernetes so have the deployment
configuration file for my sequel here
it's basically shows you the container
you're on r1 the root password is an
environment valuable here which is
filled in from a secret in when I run
the app and then I create a service for
my sequence of the APIs something to
connect to and the thing if you multiple
pods running behind the service there's
underground service so it kind of does
no balancing across the different pods
and then you do want to persist your
data so you we have a persistent valium
claim which is another good bananas
resource that creates a persistent store
for your data and Erik rate the secret
with the password which to say encoded I
deploy it and then I in my Java file I
added a darker plugin because I like to
have that built in the maven build are
using the spider if I plug in for that
works pretty well
I had to downgrade hibernate because it
was didn't like some of the options I
picked and then I created the
configuration files and I let me look at
them more important ones here so the
volume mounts I was talking about here
and on the config file and I call it
application kubernetes ya know I start
all these up in the profile Kerberos and
by naming it application -
profile name there will be higher
precedence than anything I threatened
the drawer file so I can overwrite
pretty much any value I have in there so
when it's a config file look like
whether it's basically a config map and
give it a name I gave it the data and
here I just have a happy basically an
application the Amaral file and this is
just you gotta find out like you would
do an application ya know if you put it
on the classpath it's just the intent to
do a little bit to make it fit the
config my animal so you deploy it all
and then you can play play around and
test it out I have one more advanced
micro services example and it looks like
we're not going to have time to go
through that too much but this is
actually three different apps talking to
each other and maybe welcome back to
that at the end of your time so this is
just example of the config Maps we just
looked at that in the code and the
secrets similar it's encoded there once
I put it into an environment valuable
using the secret key ref it will be
decoded in my app will actually get the
actual value
there were a lot of other options for
spring cloud netflix projects and this
cloud configuration the service
discovery load balancing
circuit-breakers some of these come in
handy if you if you're running even when
running in kubernetes as well as if you
run on other clouds so I used to use
them that little balancing no actually
use the circuit breakers mystics and I
also use the tracing with smooth in the
sample app so kubernetes helps us with
the externalized configuration and the
service discovery you through using the
dns lookups circuit breaker distributed
tracing network slog recreation it's
basically it's on you to figure out how
you want to do that some of the spring
cloud products help out and definitely
the distributed tracing is very
interesting once you start running a lot
of micro services together you want to
find out the trace and there's also
another project you want to keep an eye
on this close sto which is with the kind
of service mesh balancing evolving
enforcing policies what micro service
can talk to another micro service it's
definitely an interesting project and
it's it's developing very rapidly and I
would expect it to be in more popular
over the next year or two
so for log aggregation there's nothing
specific in spring the spring cloud
smooth
that's film at the logs in a format
that's works well with some of the log
aggregation frameworks out there and
basically you just have to look at what
your platform is using and try to use
that just when you mentioned another
this packaging project called hem but
once you have three four five different
micro services that you deploy together
and a database and a sip in and a few
other perhaps it gets kind of hard to
manage so Helen lets you develop a
package which so you can just say helm
install and the name of the package that
you develop and it basically is
templates and a value file that you that
you can provide overrides for and you
can publish these rate charts as
something them which defines all your
apps I have a serial fine
so this is where the chart looks like
it's a deployment this example and then
you have all these placeholders that
when you deploy it they get filled in
either from the name of your template or
some template code or through values you
set in a values file so then that
various file here says actors and
replicas count the one so when you're
deployed you can override that and you
specify what docker image you want them
version and again you can override that
when you deploy it and it will keep
track of the deployment of something
they call releases and their abortion so
you can go back and you can go forward
again so it's a it's coming a way to
manage a larger system
and there's no more parties are gonna
mention it spent springtime for
kubernetes and it's part of the
sprinkler incubator the only issue with
it now is that less in support - well
yet so if you're on a boot one-five
project YouTube uses men and they works
well for reading config maps and secrets
instead of mounting them like I talked
to earlier about you read you let the
spring cloud kubernetes library actually
read them and you just specify the name
of the config map or secret that you
want and they would read it in that's a
property source and provide that to us
being boot that and it was originally
developed by the fabricate team but it's
not part of the spring cloud NQ
incubator
so summary config Maps Montanez
application kubernetes llamo and provide
the kubernetes profile when you deploy
your app you can access secret
environment variables you can use spring
cloud sleuth for tracing and sifting and
I use me micrometer since I have
explained to the for my samples here and
you can then pull up the metrics and
Prometheus or your family and keep an
eye on this deal because that's where
things seem to be moving and use home
for packaging to simplify installation
of your app and the last night has some
links if you have any questions you know
ping me on Twitter open a tickets on the
issue and one of the demo apps are
supposed to have their poll and github I
hope you found this useful and
think uptime is up here thank you so not
to cover there but hopefully you got
something out of it and you can look at
all that demo code out there having
links to all of that
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>