<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Comparing DBs with Golang in the cloud by Vincent Serpoul | Coder Coacher - Coaching Coders</title><meta content="Comparing DBs with Golang in the cloud by Vincent Serpoul - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Comparing DBs with Golang in the cloud by Vincent Serpoul</b></h2><h5 class="post__date">2017-06-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/phCZwgwCryM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so these quickie is about revealing the
cloud more precisely our relation into
today's in the cloud
it's a work in progress it's one of my
side project I started like probably six
months ago and obviously has every type
project it takes a little bit of time
it's basically how I was able to play
with relational databases and how was
able to optimize my my different
projects
thanks to containers because with
containers like everybody know you can
really start up could start up database
very easily without any problems so I
used to I'm very used to container eyes
everything all my services are
containers I've been using docker for
quite a long time now
I would say something like four years
I'm heavily using swarm Humanitas and
also Cloud Foundry actually and
basically I pretend I can get all what I
developed at least everything running
high availability with the any cloud
provider within minutes
let's pretty much what allows containers
and the kubernetes swarm and PCF but I
realize it's not really completely true
because databases are not there yes they
are
it's very difficult to that to actually
get rid of this part that is today
hosted in the cloud provider like for
example over for AWS or the Google cloud
also gives you access to my sequel
hosted they take care of it they take
care of the high availability and so I
wanted to know can I go beyond what I'm
doing today and can I actually try to
implement these databases within
containers what will be the performance
and that's where that's why it all
started so I was trying to I'm still
trying to answer this
for questions is it easy to to cluster
containerize relational database there's
a database that came up recently which
is called cockroach DB which was the v
1.0 i think her last month so i'm not
wrong
has anybody heard of cockroaches VV four
one two three
so basically it's a cloud native
database relational database a seed
compliance that is a horizontally
scalable and that is really easy to run
it in the cloud on top of that it's a
maiden golang and I love going so I
thought how does it compare to what I'm
using usually which is a my sequel then
I wonder which which one of the
relational databases should I use for my
again my usual work so when I say my
usual work
it means most of the time gulang as a
language and my sequel most most of the
time and relational databases are used
for very normal use case nothing fancy
so most of the time we can take the
example and I will take the example in
this in this benchmark is one entity and
an entity that is updated created
updated like ready crud and we want to
keep the history of the of the entity
within the lifetime and the last
question is can I be hosted Google
Google database of price performance so
they are sponsors so maybe I should not
answer that question so I decided to
create a no to native setup to do all
this to do all these tests and
benchmarks actually to see a what was
the best price performance I could get
with a golang and our DNS so I started
with Google Cloud the sponsor again
golang 1.83
I use the simple VM with a one CPU four
gigs of RAM and that is about $30 per
month
I use the one 1 million request with 50
concurrent goroutines when I say 1
million requests it means 1 million
requests for creation 1 million requests
for updates and 1 million requests for
select as well it doesn't mean that
there's only one query when I do a
create for example so it gives you a an
idea of how many how many requests you
have per second and the last thing I
want you to do is a pluggable schemas
and clickable databases so plug image
schemas I want if you have the setup
reproducible and if I want to test for
example a new schema has been thinking
about I would just have to create a
folder and do the schema in in the
different SQL and launch my bench
automatically in the cloud so I not
touch anything and pluggable DDS I can
also choose which database I'm I'm
benchmarking against automatically
automated that's the last thing so what
I tested is a my sequel of course which
was a might equal 8:01 and I decided to
include as well because they are
available or Dokken on my DV which was
which are my scale binary compatible
Percona was 5.7 and maya DB was 10.3
there's not three equivalents in terms
of Russian but it's ok
cockroach to be of course because that
was the good of it and then I was while
I was looking into docker hub a I
realized like well there is a lot of
other DVS I can also try at the same
time and I went crazy on that so still
the relational databases so progress
because I never tried it but it's like
it has quite a lot of hype recently and
it's open source or I call because
I think a guy an organizer actually of
work days to me yeah you should do
Oracle thank you thank him it's not very
nice it was very very very painful
sequel server from Microsoft just was
available for Linux so I decided to
include it they also have a official
docker hub report SQLite because it's a
good reference after all
and of course hosted my sequel on Google
clouds and they just also released in
beta hosted plus guests on Google out
and because it was not enough and was
not complicated enough I decided to also
do it automated on swarm or kubernetes
because I like both and I want you to
know if one is really worse than the
other I remind you that it's still
working correctly I didn't have time to
compare everything and these bench take
actually quite some time so I'm going to
show you what I actually tested so
that's the DB schema
I took who are probably not the best
ones but they are just I started with
something so that I could really go for
it and test the result and that was the
first one I took so as I said very
simple one entity and it status and we
keep the history of the of the status
they are constraint and indexes probably
the best I could do and there is a
second one that I did which is a bit
more complex probably even more stupid
but I wanted really to compare the to
see if my GB my seem a twirly easily
pluggable and I can just play with it
like I want add the new one and remove
any one and so gulang is great because
it allows you to actually do testing of
course natively and also benchmarks
natively so to my test here and Denmark
were run on my local machine so core i7
5 5 0 u @ + 16 digital from and it
already can show you what will be
obvious later
I won't go through all the details but
basically you can see that cockroach is
around 500 and in certain updates read
all the others are around 2011 3000
sometimes we can see also quite quickly
that they are pretty much all in the
same range there's no like exceptional
outlaw except maybe a SQLite it's not
the same equal it's local it doesn't go
through the network when it talks to a
to the golang so that was so the
benchmark Galang are running parallel
but for each test it's run sequentially
so it doesn't take into account like the
different locks that can happen when you
update or insert in the same table so
the next step was to actually create
live benchmark on kubernetes on Google
Cloud or the column which was on my
local machine for the two different
schemas I I showed you so this one and
the other one and see the results in
terms of throughput average time and a
number of errors and stuff like that so
I will just go through the I just go
through the throughput to see a domain
result so you can see everybody is white
and par to that docker swarm so I will
show sorry the accumulators one so that
we can include also DCP I don't send
under 6012 maybe zoom I will direct this
so there's all the DBMS for this schema
so insert
I mean create sorry so which is here
created as one insert to insert and
that's it the update does a one insert
and one update and select by status and
by primary key so as you can see
obviously as you like to the
with before 4 select all the rest are
pretty much similar around the 801 K for
the inserts and updates update a little
less and for the selects around for 5k
and you can see still the outliers
okay our Oracle I won't talk about that
no need I think and confer DB was
actually quite bad so that was the
result so now let's go back to the first
question I had at the beginning before
it's too late
thanks wearing short so is it easy to
cluster containerized arrays I started I
wanted to do that for this too and
wanted to have a cluster of let's say
galaxy coaster for my sequel or even a
cockroach but I realized that really
it's today not there
it's a requires a lot a lot of
complexity of multiple steps to actually
set up chocolate sir so I decided to say
no it's not easy and I stopped there
maybe in the future it will grow
probably cockroach will grow a lot
easier this cockroach did they ready for
primetime unfortunately no the good
thing is that thanks to this bench and I
actually report it to them and they are
working on it so they are probably gonna
either reply to me saying what I did is
complete or optimize it according
to what has ventured so hopefully very
soon I can use cultural GB instead of
everything amused have you been using
before which are EVMs we could see that
they are pretty much all the same the
i-word would have hoped that there were
some that were a lot better than the
others but that said these are all
default configs and I'm sure that you
can tune everything so that
you can actually make things a lot
faster for rockhole for example and
excuse ever as well and mighty : etc can
I beat hosted Google TV's for the same
price performance they are sponsors so
no but I think it's about the same price
this is for $24 you can have a state
database with the same n1 standard
machine which is a 1g cpu and 4 gigs of
ram so as I said to work in progress so
in the future
I hope I can have increased stability
and maybe an easier way to do bench
because it takes a lot of time to do
this bench it takes around 6 hours so
when something is not right it's like
the end of it more benchmarks of course
may be a better scheme ads that are
children ski mask as I said close to
Dedes and also probably see the
influence of storage drivers for
equivalent SM swarm and as well as a
physical storage as SSD will have better
improvements over standard responder
disk and that's pretty much it
15 minutes is quite short so do you have
any questions did you understand
everything anything yes
yeah it's starting to be solved with a
stateful set for Keanu tests and swam
also at the drivers so that if you're
for example you have a your database in
your cluster and it sells then the
underlying storage will stay there and
your container will restart on any
machine on the cluster and the device
system will be remounted at the same
place so it's a resilience but it's not
highly available because of course when
your database goes down you don't have
any fair stress system
yeah yeah so it's a I don't remember
where coke first did the compromise but
it's pretty it's pretty nice it's like a
it would really be if it works like as
advertised which will be something so
easy to use and a breakthrough for for
the whole cloud industry which I even
though it sounds a bit too much better
for this one I decided to make it on par
with the other ones so it was a single
entity but the problem is that so I
would think that you can scale with
multiple nodes which would that what
they advertise but the problem is that
not only it was slow but like 1 times
out of 3 it would be locking completely
and stopping accepting a request so this
is not possible because if it's slow
it's ok you just add nodes and more
machines but if it doesn't reply it's
like that's a big problem ok I think
that's it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>