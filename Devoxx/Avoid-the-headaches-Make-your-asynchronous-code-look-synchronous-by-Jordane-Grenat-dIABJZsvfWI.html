<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Avoid the headaches – Make your asynchronous code look synchronous! by Jordane Grenat | Coder Coacher - Coaching Coders</title><meta content="Avoid the headaches – Make your asynchronous code look synchronous! by Jordane Grenat - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Avoid the headaches – Make your asynchronous code look synchronous! by Jordane Grenat</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dIABJZsvfWI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everybody my name is Joel n'gana
today we'll talk to you about JavaScript
I'm not specifically oh you deal with
your ass accordance code in JavaScript
since the new features brought by es6 s7
and later on so a quick presentation my
name is jordan gonna I'm a French web
developer so I'm a French cliché I love
wine cheese and snails I work at a great
company video and I'm I'm walking with
no GS JavaScript generally and Java ok
another thing about me is that I love TV
shows i watch so many TV show I can't
even keep track of everything i need to
to watch so i have a website called beta
series that add me to to keep track of
the episode I need to see and I've
ripped a small dashboard with the API of
this website for this talk so let's have
a look right here on the upper left you
can see my profile with some statistics
just below you have a list of my friends
some stats also and on the right path
you have a randomly picked TV show
amongst the 1 i'm watching so please is
there something shameful that pop up
just don't tell my friends so let's have
a look at the source code ok so we are
basically to file this one is a file
that contains some utility function to
to cosi api so you can see the the
function used to get on to put on ticket
to the API first thing we can see is
that we have a call back traditionally
in JavaScript we are using call back to
endure asanka newest curve once the data
we trip is retrieved right here where we
are calling the callback with the data
and if there is a narrow we're pulling
the car back with an hour
awesome positive the function to
retrieve my user information the
character of the show and my friends
okay so the other phase at the end of
algae type of the five you have some
utility function only to display as a
dead world right here you have an
increasing function I used to display my
friend we'll come back to that later and
at the end of the fire we are also good
that authenticate the user get my
information so show characters and the
friends first thing we can notice is
right at the end we have a lot of
closing bracket it is a symptom of what
is code in JavaScript code back he'll
watch is cover called back he'll when
you're dealing with a synchronous
operation with JavaScript with call Beth
usually you will find yourself nesting
more and more dependent course and you
we have a lot of a Finland it's not
really readable it's you can't
understand what this code does at at
website so that not really nice will try
to to make it better another thing we
can notice right here is that we have a
lot of Allah management and we're
basically doing always the same thing
just displaying the 0 and then stopping
the execution it would be Nash it we
could under everything at the same place
so that's what we will try to do as a
first tool we will use was brought to us
in es6 it's called promise what is a
promise a promise is an essential news
value rap hut into an object as the
subject can have 33 states a pending
state waiting for resolution it can be
resolved with success or resolved with a
never right here myosin call returns a
promise and we can consume the data once
it's retrieved with the Zen method so
your basket function that takes one
argument so that our retreat
and if there is an hour you can get it
and consume it with the couch mitted
I'll do you declare promise simply with
the promisor global object you're using
as a constructor you pass it a function
that take two two arguments a result
function and a reject function so right
here as you can see after making a Sanka
new score with a call back we can either
reject or resolve the off remise so
let's try that entry into a good days
right here we go to the authenticate
user and know what we want is returning
a promise just before that I will keep
the callback just make it optional to be
sure oh god continue working while we
are transforming it so the callback is
optional now we need to reach on a
promise pay attention sometimes I'll cut
very fast right here so we will nest all
that card inside and now we need to
reserve the provide when it needs to be
resolved so right here we will reserve
the promise with the same data than
before and right below we want to reject
it because there was another okay let's
just check we haven't broken anything
okay perfect we won't transform those
omitted because I've already done the
work to gain a little bit of time as you
can see we are already returning some
from it so now let's go back to us to
other file I know what we want to do is
begin to consume this provide so first
we don't need that car back anymore so
let's put it aside now what we have
right here is a next question then
return the promise so we can consume it
directly
so let's use the Zen meter we're taking
a friend's array as argument and we can
do the same thing than before displaying
the frame don't forget to render zeros
and we can remove all these lines okay
first thing we can notice is that what
God is a little bit more compact that's
nice let's continue with that car so
once again we don't need the car back
anymore let's consume the promisor
taking a character array as an element
and just displaying them and enduring 0
okay more compact nice let's continue we
have another call right here let's
consume that taking user info using okay
now we will put all that code inside
okay don't forget to under any potential
over nice let's go quickly
ok
and we don't leave that and to sketch
zero so let's just shake everything is
working yeah perfect so now we are using
promises as you can see the cut is a lot
more concise but we still have a lot of
Indians that not really nice maybe we
can do something about that something a
few people seems to know about from eyes
is that when you're using the Zen method
what you get in return is another
promise always the same for the catch
method so you can change your code you
can chain several then to to transform
your data what is so special about that
is that for example here we were tuning
only a few part of your data the user
and at the SOCOM's encode we are
expecting to get only the user this is
exactly what happens when you chain from
it the data you return is then a
argument of the next car that what
happens if you return a promise instead
of a row value for example yeah we're
returning the get use as a gate user I
think call that returns a promise what
happened is that the card wait for that
promise to be reserved and once it's
result it will call your next next curve
with the result value here's the user so
you can chain asantra new skirt without
using more intense than before okay
let's use that right here we have this
code we can just return it instead of
consuming it right here so let's just
close that and we can reduce the indent
right here another thing we can notice
is that we have two consecutive catch
it's a useless it's redundant so we can
just remove that one side better now we
have lessened and let's
look to the other function I told you
about earlier the displacement function
what does she do it takes friends array
as argument and for each of these
friends it will make an ascent when you
score right here each time a response
comes we will push that friend into an
array declare at the top of the function
and we recall the done functional what
is the den function it's a little trick
when you have like here many parallel
course and you want to do something once
your retreat everything it's a function
that after a certain amount of course
will call your chocolate he also ran the
friend function it's not it's not pretty
at all it's really dirty and the cat is
not readable you can't understand what
it does directly so maybe the promise
with a wheel helpers again exactly we
have a mmmm another method inside the
promisor object the promise that all
that takes on a raft from eyes as
argument and then returns up from is
that is result when also promotes into
the way our are reserved so for example
here's the data variable I will contain
at index 0 the result result the result
value of from eyes one and at index 1
you will have the result value of
promise you this is perfect so we don't
need this callback anymore now we need
some promise that's perfect because this
call returns are premised so we just
need to map your friends into some
promise let's stop it okay now we can
use from a stroll with this array of
promise and directly get the friends and
cut off function directly with those
friend
don't forget render any potential hello
so the render friend function not takes
one argument here and we don't need the
friends info array so this card is use
less as a fringe infrared and the done
function also so no it's really more
concealed concise more readable we can
still do better right here as you can
see the display friends function is
called right here and just after that
whether we are already enduring any
potential error so here we don't even
need to catch zero because if you return
that from eyes it will be managed right
here in fact if these two parallel
course we decide to use promise that all
with them right here
and right here
we can remove one of these lines and if
you reach on that promise we can even
remove that one because it's already
under right here okay nice now you have
only one place where we underling with
our side perfect but I told you Oh God
will look synchronous does it look
synchronous for you not for me so let's
let's see another thing I think we've
done whether everything we hold with the
promise so let's see another feature of
es6 which is called the generators what
is a unilateral generator is a function
declared with an asterisk it's a
function that can stop its execution in
the middle of it and resume in the
reason later so for example you have
access to new keyword the y lq world
that means basically okay i'm done with
my execution for no I written you a
value for example air its value one and
call me later if you want me to continue
if you hold the generators a long time
it will execute this statement which one
the value to and be unstoppable Egyptian
so other I'll do you consume it you call
a first time my generator to create an
iterator and then you have accessed
inside it each other to the next method
that will stand the execution get in
return the value at the first field here
it's one and then if you call it again
it will return you to the value to what
happens if you call it a third time
right here it will reach on you this
subject with the done boolean to true
and the value and if I ok it's not very
useful to this to deal with in
synchronous operation but one thing we
know is that we can communicate with the
generator the same way it can return as
a value
we can give it some value at the first
line of the general tone you can see we
are yielding the very one are and we
seems to to wait for something in return
after that we yield the value to and
then we yield value we will suppose to
have received so let's see how it works
so at the first next it will execute the
first kill and then the second next we
will give it a value here's the string
ello that will be transmitted inside or
generator as the result of the the yield
statement so after that display or value
what it also works with Eva's you can
send exception inside a generator so
right here will yielding the value 1 and
maybe that will be an exception so we
have surrounded this by a try catch and
if you want to throw an exception into a
generator you just use it later that's
permitted with whatever you want to
throw inside the generator so we'll just
do something like that okay what happens
if instead of returning a row value you
decide to yield a promise like here if
we decide to to yield a promise and
we're expecting the consumer to only
call us back when the the promisor
wizard with a result value we will get
something that looks very synchronous if
you if you work so does it work we are
creating a new tata then we are
receiving from eyes from the first
execution then we are just waiting for
that remains to be resolved or for it to
a venir o to cursor each other that next
with the return value this is exactly
what we will do to have a cut that look
synchronous this is so useful that in
fact you don't have to call your
generator yourself that a lot of
library reason npm that does the work
for example we will be using code so you
just give your generator as a parameter
to co and it will execute the e it will
start to iterate over your generator
each time it will receive promise it
will wait for it to be resolved and then
it will call back your generator with
the result value or throw an exception
if there was an exception so let's use
code inside our project I've already
instead it's all addressed involved
that's okay now we need to pass an
animove generator to the code function
and we can just put our offer code
inside okay it's been a long time since
early this time we check oh yeah
something I've forgotten right here okay
something is missing okay I forgot to
return that from a little okay better we
still have another the user data is not
defined if you just have a look right
here we are expecting to have the user
data but now it's not the same Scott so
we need a little trick just here instead
of returning just the user info will
return an object with both so user the
top and user info and here we are
getting both of them so it's working
okay so now basically what a strange it
underneath that occurred is called by a
bicycle library but nothing has very
transient now we can start yielding some
compromise right here just hear that
from eyes expect user data in return and
we can reduce some indent right here and
now we are what seems to be a
synchronous car and it's perfectly
working so we don't even need the this
little trick because the user data is in
the same scrap so let's remove that okay
still working and now we can yield
another one this one for example expect
user info in return okay and everything
is working nice we haven't managed zeros
so true way of doing that either you're
doing a try-catch block right here it
will work because cool as for you annual
when when there is a nova or you can
just know that cool returns a promise
and just catch zero at the end of your
code it seems better okay and this is so
useful in fact that some people wanted
it to be added to the specification the
GS specification and it's now done since
since a few weeks I did call a sine
function basically it's exactly what I
just showed you instead of declaring a
generator you're declaring a nesting
function we
I think you would and then instead of
fielding you your values you will use a
keyword oh wait but it's the same same
behavior behind the position okay let's
use that so it's now done completely
safe to use it will be in the es 2017
specification next year so you can use
it with bevelled very safe okay let's
remove this generator create an
assumption Allison function instead the
only thing that will change is that we
need to call that function right here oh
yeah i need to replace yield by a wet
key wall right here okay so now we have
a cut that looks very synchronous while
do performing everything else and
honestly one thing you can be tempted to
to do right here is doing some bad
things very bad things instead of using
from a third hole right here to make
your parallel course you can be tempted
to use a weight on the two curve but
just be aware that here you are doing
two consecutive codes instead of half to
para el curso you're losing sometimes so
everything can look like you're an age
when you have a meal but just be careful
and okay thank you I have a few links
the slide I available answered at this
URL you have some links about promise
and generators and one subject I
couldn't cover because it's very
two-shot is a rectifier I mean in fact
with promise you only deal with the use
case well you have
one cor to your call back if you're
waiting many curves like when you're
listening some some event you will need
something else it could be observable so
just have a look to reactive programming
by under medals it will in just
introduce you to observables in a in
JavaScript thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>