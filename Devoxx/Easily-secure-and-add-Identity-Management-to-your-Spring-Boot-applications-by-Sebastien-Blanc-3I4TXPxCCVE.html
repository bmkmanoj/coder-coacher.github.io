<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Easily secure and add Identity Management to your Spring Boot applications by Sebastien Blanc | Coder Coacher - Coaching Coders</title><meta content="Easily secure and add Identity Management to your Spring Boot applications by Sebastien Blanc - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Easily secure and add Identity Management to your Spring Boot applications by Sebastien Blanc</b></h2><h5 class="post__date">2017-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3I4TXPxCCVE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay let's go then
welcome everyone
it's always amazing here being at devoxx
I have only 30 minutes so too much
things to to say I want to show you so
many things just one thing because I
know this year is there's a live stream
on YouTube and I just send the link to
my wife and kids there's just a little
message for my kids so they're already
fish I've been away for a long time and
they will be really happy with it
so that's calories Matilda's olive okay
oh sorry that was too fast
quickly I'm Sebastian blow that's my
Twitter handle if you want to follow me
I'm going to speak you about security
how oh yeah that sounds boring right
but I've good news I will show you in 30
minutes well 29 minutes that security
can be easy especially with spring boot
apps and that's because what about
delegating your security you know Kim
does that she does that really well she
has some impressive bodyguards are take
care of their security well you can do
exactly the same and that is what key
cloak is okay so key cloak it's a server
it's a file you unzip it you started
it's a server and it will take care of
your identification managing your users
everything I just copy paste here the
pitch line from our website but to give
you a more concrete view of what we
cloak is before we start live coding
stuff let's imagine this an island
that's what Key Club does you give key
cloak an island a well a territory to
protect
and on this island you ask different
cities different application in the
north
GTL and once wants to go there anymore I
have no idea why on the country you have
angular land wow that's the place to go
everyone's wants to go there you have
micro-services land we not sure what is
happening there and of course in the
middle we have no GS land king of the
world
okay and you arrive with your little
boat you navigate to angular land just
you navigate on your browser and you go
to an web app application and you were
out there and they say hey guy you are
not authenticated sorry sir you have to
go back to the small island their key
cloak to get authenticated okay and you
get a redirect that's really what
happened you get an HTTP redirect you
are redirected to the cloak server and
the key clock server will present you a
login screen and there you just enter
your credentials and everything and if
everything is okay just like at the
customs you get a stamp and you can get
back to the island and visit all these
awesome cities and this time that you
get it's not just a random stand or
random number you get a drop token that
is for GWT JWT token JSON web token that
is a token that contains in fact some
payload and with this token you can well
go through all the islands and if we go
quickly how this token looks like there
are some header we don't care too much
about that there's a claim that's the
payload of your token there you put all
the interesting stuff your username or
walls until when you're connected stuff
like that key cloak will sign the Stoke
for you with his private key though
you're sure that any app that needs to
use this token and back-end app front an
app will be able to verify your token so
they receive this token they take the
public key they really find your token
and if it's okay
then you're allowed to go further with
your request so I go really quickly here
in the slides because I want she the the
the topic of these tools in action is
how to secure Springwood application so
in one minute I will show you how to
secure and Springwood application just
quickly key clock so Keiko he's
out-of-the-box solution you will see it
you just unzip it and you can use it of
course it's an reddit product so it's
open source so anything that I will show
you is open source you can contribute
you can you can submit a pull request we
if your prayer request is nice we will
just integrate it in the next release so
please do it we support of course open
ID connect this our preference but we
support also Sam or Kerberos we have
some nice stuff to do some social login
brokering if you end want to add
Facebook Twitter get up identity
providers user Federation if you want to
connect your LDAP server to kick lock we
can do that out of the back box single
sign-on SSO that means if you are logged
in in one app and you open a tap in an
other app in the other tab you will just
be connected but 24 minutes let's I'm
not really sorry that's my wife's and
then yeah some stuff on Facebook I just
want you to show you from scratch how
you can secure a spring boot app so what
I have here is
sorry it's a really really really simple
app it's called the product app and in
fact let's start from the landing page
we have a landing page public accessible
for everyone my awesome page and there's
just one link to my products and this
page in the end we want to product this
page what is on the product page well
it's the templates here we just iterate
through products and we show these
products if we look at the code itself
it's really not that complicated sorry
here I just get a gap mapping on
products and here we just return the
service get products that you can see
here it's a really exciting service that
just returned a hard-coded list of
products okay so if I run this app and
oh it's already winning sorry let's take
a look at it and I just go there we'll
see that we have here we have our
awesome landing page you can already see
my CSS skills here and if I go to my
products okay we get a list of my
products excellent okay so let's secure
this application and let's start from
the really beginning so you want to use
key clock where did you start you go to
t clock dot org and you just have a tab
here called download and you just
download the key clock server that is
what I did and then you have your key
clock servers zip here and we just unzip
it let's unzip it to let's see I
prepared evokes stuff so we just unzip
it there
and let's go this to this folder so we
get it here key cloak let's go to the
bin folder and here I will have a
command standalone that Sh
that will start my server and here I
just give some extra parameters to have
a port offset because my spring boot app
is already running on port 8080 though I
don't want any conflict okay here we go
I just so you saw I just unzip it and I
just lunch it ok my key cloak server is
running so first thing that you can do
is access your key log server that have
been deployed my sorry it's a bit too
big exactly that's good ok because it's
a really first time I have to define
admin user so let's make a really secure
admin admin user as usual here we go and
let's now access my key cloak web
console so this is a place here on the
web console where I define my Wilms my
users my walls my clients what is a
client for killakee cloak
well client is any app that key cloak
secure could be a front-end app a
back-end app no matter for key cloak
it's it's a client oh yeah and before
that here we are on the master room
let's create our own room for this demo
and let's call it D box I call it D box
so now I'm in my own room and I want to
protect
I want to secure my product app my
product app application ok so I create a
new client here I can keep all the
defaults I want to use open ID connect
okay it's in public client and the only
way of paying a help to fill in
here if the redirect we were well
because when my app will redirect me to
key clock it has to redirect me back to
my application and that's the only field
I have to enter here though it's really
easy my app will be running on port on
localhost port 8080 and that's it okay
and then I want to create a wall for my
users so I would just a really simple
wall quote user here we go
now I got my wall user and last part I
need a user so let's go to user and here
I can do at user so the only mandatory
field here is the user name let's call
it CB we just save it and two things to
do I have to affect some credentials to
it so here I just give it a password
savvy as well I wish that password okay
last thing I want him to have the wall
user as well here we go we're done we're
done on the key o'clock side now we go
back to our spoon boot app what needs to
happen here now to secure to make the
connection between tick log and my
string good app first thing I need to
add the key clock starter so if you know
spring boot swing boot has a lot of
starters that helps you setting up stuff
we have a key clock started which is
available on startup screen at i/o I
will show you that later depending on
the time but the only thing you need to
add here if this part this dependency if
you add that you can start playing with
key clock in your screen boot app and
then the nice thing is you don't have to
touch you
Haute at all the only thing you have to
do is to provide some configuration so
let's go to the configuration page in
our application that properties and so
here just I was disabling key cloak so
there are some stuff we need to tell our
Springwood app the first thing is where
does our key cloak server is running so
this one is easy
it's running at local host 8080 one
slash off okay the other one is in which
will if my application declared well
it's easy we create one called devoxx
and then we have to say well what is the
name of my resource my clients well we
said it's product app ok and then there
is nothing wrong called it's public and
yes it's perfectly ok that there are the
mandatory fields now my screen boot app
can make the connection with my cheek
lock server to verify the signatures of
the tokens and stuff like that but I
still miss my security constraints I
need to tell my application which parts
of my app should be secured ok so that
is pretty easy if you know a bit about
the old times of Java EE and security
constraints where you can specify
security constraints in the web dot XML
it's just the same here except it's not
in the same format here is just using
the spring boot application of
properties format ok so it's ok here I
just use the template because it's
really boring to type let me just
explain you what happens here
so here actuate a new key cloak security
constraints I can have several ones
that's why it's an array and here I say
I create a new one and that is for users
that has the wall user yeah I could have
chosen another name but that means that
and the second line is important that
every week at request that comes to
products slash star needs to be
authenticated and the user needs to have
the raw user ok and I'm done that's all
I have to do let me just save this and
let me we launch the app and let's see
if now ok let me just open an incognito
window and let me go back to the landing
page and if the demo gods are nice with
me if now I press here you see I'm
redirected to kick lock so that is now
chico presenting me a login form because
products is protected so here i can just
try out with my cbcb username and if i
go there you see i'm just logged in i
can easily log out and i come back to
this screen i can show you just the
logout
how does it looks like in my controller
because it's really simple
yeah look at my logout I just do a
logout mapping and I just injected HTTP
request and I just do a request that
logout ok so it's that easy to protect
your F let's just spend some time on
this screen here and go back to the key
cloak console so here as I said you can
control anything and if we go to we own
settings and on the login tab we can
fine-tune our login screen so let's
imagine yeah I won't user registration
yeah my user will probably forget the
passwords
I need to be able to send them back an
email mmm remember me yeah I don't want
to log over over over and again and you
just save that and if you go back to
your app here and that you just refresh
you will see here you can see it you can
register now as a new user you can have
the remember be you have the forgot
password something else like well I
would like my users to be able to use
your Facebook account or get to account
can we do that sure if we go here to
identity providers you can easily add an
identity provider to your realm and well
we are demyx you all have a gator camp
account
I imagine so you just click here and
here
well let me just put here dummy dummy
numbers some things like that but in
fact you should create a real app on the
github site you just save that and again
if we go back here here here you see you
will be able just to log in using your
github account okay so that's the first
thing that you can do with key cloak and
Springwood apps so what I show you now
was using the servlet container security
stuff in fact what happens under the
hood the teto adapter will secure your
tomcat or your undertow or your jetty
servlet container but if you are a
spring fan and you want to do security
you probably want to do spring security
so let's see if key cloak also plays
well with spring security well good news
is we have support for spring security
so it's pretty easy we have one thing to
do here in our pom
we just have to add one starter it's not
a starter from kilo it's a started from
fun spring boots itself it's the
security it's the security starter okay
if we add the starter as well bringing
the spring security jars and everything
and now we can try to integrate spring
security whiskey cloak so for those that
knows a bit spring security you probably
know that the first thing you have to do
when you do Springs an application with
spring security is to implement in class
that extends security conflict class
provided by spring security which keeps
log is exactly the same the only thing
is that we provided our own class that
already extended that spring security
class and it's just like you will do
with any other security config less so
let me show you how it looks like so
here again I'm using a template because
I don't want spend time on that but it's
pretty easy you create a new class you
annotated that with Keats log
configuration you call it as you want
I just have to instant extense this
class okay close that and here we have
some pretty basic stuff like you will do
with any string security stuff but what
is important here is death part is to
configure method that you have to
overwrite and here just like I did with
my security constraints I just specify
which path should be protected or not
and here you can recognize that I just
want to protect products with the wall
user and that's all so that's all I need
to do really and what I can do here is
just remove this stuff because I don't
need it anymore
because it's not a servlet that will be
secured servlet container but it's
spring security taking care of that so I
just remove that and I just we run it
and if I go back to my landing page and
I just log in here we go you see nothing
really impressive here but now it's
using spring security but it's still
doing the redirect with key clock and
all that that means stuff like that
means that for instance in my product
here I could also do play with injection
I can just inject my principle and let's
stay my principle just for that security
my principle and I can add it to my
model here okay it's called let's say
username and here I say I want to inject
my username from the principal so it's
just principal guest named by default as
well pull out my ID of my username I can
easily change that here in my properties
I can I have something called principal
attribute preferred username that means
I want to use my username and I just
need to change here my template and here
it says my products we can say instead
say hello and we do just user name here
we go
and that should be good let me just
double check that I put user name okay I
just rerun my app here okay here we go
and if i refresh this you see it says
hello city that just injected my
principal I could do the same with walls
and everything you are used to do with
spring security you can just keep doing
the same things
just that key clock is now handling a
whole authentication and user management
management stuff so I have six minutes
that's that's not too much though really
quickly that is pretty awful you know
returning hard code assist will be nice
if I have a rest service that provides
me a list of products let's see how we
can change that and make this
application calling an other application
in a secured way so I was I I really
wanted to do that in life coding but I'm
I don't have any time that's so I got it
here
it's an outer spring good app really
simple this one if you take it look at
the controller here I just have a rest
controller here and it just returns my
products I just changed products so
you're sure it's not the same and I'm
just securing that like I told you I
just changed port though there's no port
conflic and we can just run that okay
and now I need so let's make sure this
app is running here so if I go here to
localhost 8080 one flash products
awesome it's exactly what I want my rest
service is protected
I got an unauthorized status because I
didn't provide any token so let's see
what we can do on our product app so
it's make a request to this rest service
and it passed the token to it so it can
get a result if you are used to build
spring boot apps you probably know the
rest template western plate is a class
that is provided that is make it really
easy to make rest requests to other
services unless the fly
that what we did we provided a key cloak
raft template that means that you can
just make a request as you will do and
it will just add the token to the
request okay and that is called okay
that was pretty easy here I got a key
Clos client request factory and now with
this factory I can just inject into my
service this template here and which is
really really nice is that if you go to
the documentation I should have this at
three minutes
okay security I'm doing live coding
based on our documentation that's really
funny okay here we go
spring security and I just want to get
products yeah that's what I want okay I
just grabbed that and I just can paste
it here and I just have to change the
endpoint here my endpoint is well the
new rest services that we created
without localhost port 8080 81 slash
products okay here we go and that's all
I need to do and I have some errors here
I don't know what it is let's just
assume it's nothing I think it's just
IntelliJ playing with me okay and now if
I go back to my app I log out and I log
in again you see now my app is calling
my rest service that was protected you
see
here this web service was not too wise
here but using my key clock template now
I can use this red service and that was
just to show you how you can do service
to service security and I have one
minute left to show you how to secure a
web app because now we have a rest app
so we can see we can create a web app an
angular app and then this app will just
call our rest service so really simple
really quickly
mmm dude important points here we have a
key cloak JavaScript library you just
instantiate it here and it will do the
redirect and everything that you need
and the nice thing is with angular you
can add an interceptor so here what we
say is each time that our web app will
do a request to any service it will add
the authorization bearer to it okay and
30 seconds come on okay let me run this
app it's it's okay let me just render
the app
and I also need to add it here my client
I didn't its product now I'm working
stress mode for web okay here we go
and I want to redirected to localhost -
whoo yes thank you local local local
host
this isn't that exist I thought so and I
have to specify my web origin okay let
me think if I didn't make any mistakes
and if I go here to localhost 8080 -
this time this is my web app so just
running on a browser and I will load and
you see my products and you notice that
I didn't have to login again you know
why because I was already logging on
this app and this is the single sign-on
so that is what I wanted to show you how
do you secure a spring boot app then
adding spring security then how if you
have a micro service rest service how to
secure that as well and how to make the
communication and if you have a web app
how you secure that and that's it for me
and I'm here until tomorrow evening and
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>