<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building Cloud Native Progressive Web Apps  by Matt Raible and Josh Long | Coder Coacher - Coaching Coders</title><meta content="Building Cloud Native Progressive Web Apps  by Matt Raible and Josh Long - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building Cloud Native Progressive Web Apps  by Matt Raible and Josh Long</b></h2><h5 class="post__date">2017-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tCyLDzhz_mg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">oh oh look at that we're live there we
are
Oh howdy hi that is just pitiful hi oh
you can do better
ready
I think that's okay hey um so just a at
the offset I just want to thank you for
for not going to venkat stalk that was a
that was a bad choice on your part but
I'm glad you're here anyway thank you
thanks for coming we are stuck in a
small room together for three hours it's
gonna be fine
Wow all right shall we get underway yeah
um do it let's see so to find out about
you a bit first how many people like
spring wait almost everyone or is it two
guys that aren't raising your hands
there they go they put them up who likes
JavaScript not me you need really what
about typescript anyone use an angular
what about angular 5 come on out for a
week
[Laughter]
what about react any react users not
very many
just a few anyone doing progressive web
apps one two okay oh we got one in the
back three
does anyone here for a particular reason
you guys sat in the front so we get to
pick on you are you just here for the
entertainment you come to learn
something in particular well just to
watch us
spring cloud spring cloud spring cloud
who's here for a reactive spring who's
here for dis Kotlin who's here for beer
I knew it I knew it that's just an
Antwerp in general though who's already
at Devon I'm just curious a spammer for
like a month
Java nine one seven nine
okay what about Java 8 oh that's good
wait better yet okay who's not on Java
900 Java 8 hey that's Java 7 yeah
that's not a scary number at all that's
like it's like 4 I can visit all of you
and help you upgrade and you'd be ok
it's such a small number at that point
yeah it's very heartening okay well good
stuff that makes me feel better
shall we mm-hmm okay so my name is mater
Abel I'm a hick from the sticks I grew
up in the backwoods of Montana with no
electricity and no running water and I
did have to walk two miles to the bus
stop every day it was not a fun
childhood but only once I realized my
friends had toilets and stuff and then I
was like probably nice in the winter you
know the guy I work for a company called
octa and we basically do there's the
cabin I grew up in I was born in one
corner my sister was born in the other
it's still still up there in Montana I
work for octa basically we do user
authentication in the cloud or users as
a software service which is UASs which
isn't a very good acronym a user
management service and we basically
support all kinds of standards OAuth
open ID Connect in sam'l so it's very
easy to integrate authentication into
your apps sam'l sam'l don't recommend it
what's the first go to the S stand for
simple or something I'll bet it is
simple I don't attend ocation markup
language okay they avoided the soap
problem
well they got XML lots of okay anyway
and my name is Josh
Joff long and nice to meet you I'm the
no spring developer advocate on the
spring team I'm an open source engineer
and contributor and I had the dubious
distinction of having been the number
one most widely lauded most prolific
most visible most highly acclaimed
contributor of of bugs but number one
number one contributor of bugs to
projects like spring boot spring cloud
spring integrations bring bad rotten
time leaf activity etc more bugs per
commit than any other engineer on the
spring team so that's something right
I'm gonna open throws in dear java
champion and a spring developer advocate
as part of that I spend my time in front
of groups of people like yourselves hi
doing training videos and books and I
just finished a couple of videos applied
continuous delivery client 400 live
lessons and spring boot building might
be services of spring boot live lessons
and I just finished my fifth book which
by the way is out there on the at the
Irani table and when did you start that
book just forever ago and in today's
write what is that well what is
happening oh you've got the actual thing
on live stream I was hearing that we
were here ourselves on the live stream
on his laptop in delay so now I know how
far back we are okay
all right we're like 10 minutes yeah did
you start forever like a like years ago
two or three years ago two years ago
we've gotta hand that it's long but and
it took a long tell you what took a long
time right
the book is all about how to build
applications that survive and thrive in
the cloud and we do it we talk about in
terms of spring mood and Cloud Foundry
and and spring cloud but the reason we
were so so delayed in getting this book
out was because of the deliberation that
went into deciding what animal to put on
the cover so anybody who knows anything
about writing books knows that nobody
cares what you write in the book itself
it's it's it's completely immaterial
it all lives or dies based on the choice
of the animal so we we'd fought long and
hard to figure out the right animal for
that and we settled upon a blue eared
Kingfisher
that bird is a blue eared Kingfisher a a
bird that is indigenous to the
Indonesian Java Islands is it is a bird
that is indigenous or an English would
say native to the Java islands in
Indonesia and birds fly they fly through
the clouds so it's a cloud native java
bird it's a bird that flies through the
clouds in doubt in their mind their mind
it'll come it'll come give it time
uh and and of course that work at
pivotal and a pivotal would have a lot
of great open-source software and we
care about it we care about the software
just like octaves and so many other
great organizations we care about this
officer but that's not the thing that
drives us so we care about most at
pivotal is helping people build better
software faster and delivering it into a
production environment and so as part of
that you know we along with a lot of
other folks of course talk to
organizations about micro services and
and how to build these cloud native
applications and the idea behind this is
that you decompose your architecture
into small batches of work and that you
do so so that you can some more support
small teams and in in so doing you allow
yourself organizational agility you have
small teams working on small code bases
that are independently deployed they're
unblocked from each other and so you get
agility because the cost of change is
smaller you reduce the scope of change
to reduce the impact of change and so
the you know each each team has the
ability to go faster and when you move
to this architecture you get a lot of
benefits agility of course being
principal and chief among them but you
also introduce complexity and that
complexities but it can be very
problematic for a lot of organizations
because they're struggling to sort of
address the complexity and they're
ill-prepared they build these
distributed systems that are not talking
to each other over the network
everything becomes a client-server sort
of model you know
and so the complexity is problematic now
yeah not yet no no what are we gonna
build today oh right so the complexity
is problematic and you need to be able
to address that so I'll tell you of
course we're gonna talk about that right
right see I did that but but we want
before we get underway we need to
actually talk about what kind
thing we want to build right so what
basically we want to do is not only show
you how you build resilient systems on
the back end but also on the front end
so josh is going to be live coding on
the back end using you know spring
booting spring cloud and then I'll be
doing that on the front end with angular
and we'd like to build something that we
feel is useful for you and for us and so
what should we do well we did wait if we
wanted a domain that would be easy
enough to kind of like just accept and
then take for granted and then move on
and we want to have a domain that is
relevant right - beautiful Belgium and
so we thought well wouldn't it be great
if we could have some sort of service to
manage beer beer exactly right beer so
we thought about it we need something to
manage an inventory of beer because if
we can't if we can't put it in our
bellies we can at least put it in the
code you know with the hopes of getting
there so we thought about beer in why
beer it's pretty much the cause and
solution of all life's problems right so
did you know that at any given time
point seven percent of the world is
drunk so right now there are 50 million
people in the world or a drunk at this
moment writing PHP code it's a fact
it's on the internet they don't lie in
their net they can that's because it's
easy there's a difference how many of
you have seen this not enough so we'll
let you read it
this small font on the screen is huge on
this slide and hopefully this will give
the amazing dead box organisers time to
bring us a chair is that gonna happen
we could roll that box over any chairs
coming
well everybody ready
journey in the corners if they read it
oh are you eating with chairs all right
Cheers thank you
we could really use them thank you okay
good so somebody here I'm glad people
remember windows of me and that maybe
they just repressed it okay so we're
gonna we're gonna write some code today
to manage beers and I think I think I'll
just you know well we can survey the
audience a bit more before we get into
it how many people are actively using
spring booth how many people are using
it with Java how many people doing
groovy I'll get a few on Colin Colin I'm
using Kotlin how many of you are
interested in Kotlin good stuff hot
sauce Gradle tan maven everyone else you
guys like the color logging don't you
like just in time like the compiler
thank you so cool Wow awesome never
works that well usually all right I'm
gonna turn this oh wait before I get too
far away should we do the thing we go
Stan yeah proved our bosses that we're
working yeah air quotes okay everybody
pretend like you're happy okay sweet
nectar thanks okay so so we're gonna
we're gonna um this talk we've done
before but we've done it in Java because
you know why not but Stefan just our
friend asked us to do it in common which
is fine because I'm
you know we've done talks in Kotlin
before and we did it for the what is
that the V jug alright didn't wait we
did that yeah we did the presentation
for the video get honest and it was in
Colin and seems people seem to like that
so we wouldn't do this
talking Kotlin and we'll use that as an
excuse to juice features in you know
continent itself and in spring right but
if you have questions about cotton we
understand that that might be the thing
that isn't gonna be you know if you have
questions I don't hesitate to like throw
them out there right we're happy to
answer I'm gonna we're also gonna do it
in terms of spring boot to that oh and
the reactive support and so there's a
lot of bits that you're gonna see today
that aren't gonna be sort of your sort
of normal demo I guess I don't know and
we have lots of time so if you have
questions along the way raise your hands
and hopefully we'll we'll see you're
just something like that and we'll hear
you exactly all right so we're gonna
build an application here it starts out
spring today how many of you start that
spring the mail all right so this is my
second favorite place on the internet
anybody who knows me knows that this is
my second favorite place in the Internet
my first favorite place on the Internet
of course is production
I love production you should love
production production is the happiest
place on earth it's better than
Disneyland you she goes early and often
as possible bring the kids bring the
family the weather's amazing but if
you're not already in production you can
begin your journey here and start that
spring that i/o if you want for
inspiration in the early morning before
a cup of tea or coffee start that spring
that I own if your children or Restless
and can't sleep start that spring that I
oh and if you suffer from an indigestion
after a long night of alcohol abuse and
PHP
start that spring that I own so we're
gonna do is gonna build a new
application here when you use the spring
analyzer here and we're gonna use these
support for building continent
applications we're gonna use two that oh
right so two Dino spring Mbutu that I
was due in December of this year but
right now we're a milestone six are we
gonna use that we're gonna build a new
service called the beer catalog catalog
service and we're gonna bring in some
support that we need we're gonna bring
in the actuator for operational concerns
we're gonna bring in the reactive web
support right so we're gonna bring in
the support for building reactive
applications and we'll talk about
reactive in a bit here we're gonna bring
in reactive MongoDB now again we could
we need a data access layer that's why
we're bringing this in there's a number
of different choices here for reactive
you can bring in reactive MongoDB you
can bring in reactive Cassandra reactive
Redis there's ring data itself there's
couch base there's a number of different
reaction reactive drivers that we're
gonna take advantage of here all of them
are fine choices but I happen to have a
MongoDB on my local machine and it's a
great choice right if you if you want to
lose your data and you want to lose it
reactively there is no better choice
than reactive MongoDB so here we go
right I'm kidding it's a nice database
it's just fine just kidding anyway um
there's that what else do we need we
need the the Gateway support know now
that we don't need that here do we I
think this is fine a catalog that's for
the camera no that's for the edge
service right right yeah we did do a
rest in the past but I don't think you
did it
this one I got reactive web right we
need you recover for that for Service
registration discovery I don't think we
need the config server I think that's
probably in it okay so that's the
service okay so I'm gonna build that
service and of course we could switch to
the full version and if we were so
inclined we can add all these different
check boxes as a number of different
check boxes that encourage you to peruse
it'll measure later on there's a number
of different technologies here that had
we more time
a lot more time we could cover them but
for our purposes it suffices
these things as they are here now so
with that I'm gonna go ahead and
build a new project by clicking the big
button at the top or at the bottom but I
do want to spend a brief moment here
just a brief moment looking at these
other options here the artifact that
group the name the description all that
stuff the package all that stuff you
could you could plug in and then of
course we have the choice of packaging
right and that the packaging is where
people like get confused other people
get they struggle with this they don't
know when and where to choose which so
I'm gonna do my level-headed best here
now to explain if by some freak fluke of
physics some terrible terrible tragedy
of time-space you find yourself somehow
transported to the distant distant
distant past far far far beyond modern
help then choose not war but if you were
here with us in 2017 nay almost 2018 can
you believe it then then choose dot jar
this is a big part of our overarching
and guiding personal philosophy of make
jar not war and again you have a lot of
options you could do a lot of different
things but I encourage you to stick with
the defaults because they're gonna work
just fine so we're gonna hit generate
that'll give us a new project I'll open
up this project here hey Josh yes sir
did you know the world's long is
hangover lasted for weeks after a
Scotsman consumes 60 pints of beer I did
not know that that's amazing it's a good
beer fact that's an inspired hangover at
that point that's just inspiration
you're out you're going to fly or
purpose you know for weeks
well alright so I got my zip file right
I cleaned out the directory and I
downloaded it again opening this up in
my IDE doesn't matter what I do you use
anything's fine I'm just curious how
many of using IntelliJ okay how many of
using some sort of eclipse good stuff as
well rock on what about knit beans okay
right on all them good choices right on
good solid choices you don't need a
particular support and these ideas to
use spring boot it is just public static
void main and maven or Gradle anything
will work just fine we're using
the methane Ultimate Edition you can use
the spring tool suite for eclipse you
could use the NetBeans the spring boot
plugin for NetBeans all in our fine
choices but you don't need them right it
is just maven and/or Gradle and Java 8
in this case or common how about Emacs
are you here sir where's the Emacs guy
Emacs guy where are you I can't see my I
can't see oh there he is every single
city country and content then I go to I
ask who uses Emacs and invariably it's
the same guy the same human being I use
Emacs and then he leaves presumably to
troll again the next place oh well so we
have got it we've got a spring good
application
I'm gonna comment out some of the bits
in it I don't need just yet right I'm
gonna comment out the the Netflix
support goodbye to this and I think
otherwise we'll leave it as is you can
see that the spring initializer has been
nice enough to give us the Kotlin you
know compiler and the reflection
librarian all this stuff and we've got
plugins there in here configured first
at Cotton's Kotlin JetBrains Kotlin
maven plugin it has been specified first
as well as a spring compiler plugin
right and this works in conjunction with
the Kotlin maven all open dependency
here you see by default types in Kotlin
are final you know in terms of the in
terms of Java right there final meta
falls but a lot of frameworks in the JVM
including spring rely on having the
ability to subclasses your types at
runtime right that's what the basis of a
proxy is is dynamic sub classing and so
we need those types to be open and so it
gets very tedious to constantly have to
go against the grain and say to call it
please don't lock this down by default
you have to prefix everything with the
open keyword right by default their
final you have to open them whereas in
Java but it phones are open and you have
to lock them down with final so this may
even all open plugin allows you to say
given a certain condition which in this
case is a condition that we and this we
have provided with the the spring
compiler plugin give it a certain
condition we want these types to be open
by default in this case the condition is
that if there's a an annotation present
namely one-day annotations of spring
relies on then those types will be open
by default
you get that you get that benefit by
using the the new sponsor all that's
just pretty provided for you and now we
can focus on the code itself now we have
a Springwood application and today we're
going to talk about building an
application using sort of the react the
reactive support in spring boot to a toe
and spring framework five so spring
framework five was just released last
month actually but a month ago and
spring frame of five has you know number
of other nice features but the the big
feature the big thing that i will hope
to impress upon you today is that there
is support for building reactive
applications and now this use case isn't
new or controversial it's not like we're
the only ones that have solved this
problem or even thought about it and
that's exactly why it's so interesting
right the what we're trying to do here
is we're trying to model large amount of
data and again the theme of our talk
today is progressive web applications
applications that do the right thing in
the case of failure or possible theater
conditions and what are the big things
that people run into and they start
building distributed systems is they are
now moving data across the network right
they're not moving intra process they're
moving data across the network and this
means that data is flowing over sockets
their input and output right this
communication can become very very
overwhelming eventually and the question
starts to become how do I manage an
overwhelming amount of data right if I'm
doing a machine learning they're big
data or anything anything like this the
movement of data from one node to
another across the network can be very
very very very expensive and our
services up until recently up until you
know for the longest time weren't
designed to be as efficient as possible
in the face of that data because most of
our work wasn't done in terms of i/o it
was done in terms of computation and
everything was kept in the same process
so the conduction of data from one node
to another becomes expensive and we have
this inefficiency right they do by the
default mo the default behavior for a
typical servlet application not all
serval applications have this problem
but by default unless you go out of your
way and use the async support the
default behavior for a typical service
application was to block write as a
request came in a thread was opened a
fare was kept open to
hold the server socket and then accepted
the incoming requests that ultimately
got you know processed usually in terms
of a spring MVC controller and then
their response was sent back all in the
same request cycle the thread is being
kept open the whole time well if the
time between when you got a request and
the time between when you sent a
response was long as might be the case
for a large amount of data or large
batches of data or even just things that
have latency or that are not necessarily
gonna be a continuous stream of data
maybe you're doing a server-side push or
you got a chat system or something like
that if that duration between getting
the request and sending your response
was more than just a few milliseconds
you ended up blocking you kept that
thread open right on the JVM threads are
expensive so this is an anti-pattern
right you don't want to keep you don't
want to keep that thread monopolize
you've only got a fixed thread pool size
for your web server your average web
server and so if you have more if you
have one more request then you have
threads available on that web server
you're in a bad situation
hopefully that request will get what
will finish and then you can return the
thread back to the thread pool but if
that isn't the case you're gonna be in
trouble so reactive programming gives us
an answer to that it does that because
it allows us to rely on primitives that
have been available in the operating
system for a long time by default your
network stack in most operating systems
is asynchronous you don't say I'm gonna
wait for the next byte and then block
you say here's a file descriptor or a
descriptor I want you to tell me when
there's data available notify me and in
the meantime I'll go on and do something
else I can store the file descriptor
elsewhere and ask for a callback right
the benefit is that now I can respond to
new requests as they're coming in and
only when I have an event over there do
I then bother to activate a thread and
then send back the response so that's
one thing that we need to address and
the other thing is when you move to this
world we have lots of clients and
services and they're distributed across
networks now you have the problem of
flow control right there's there's the
possibility that one service will
produce faster than the other can
consume and this is something that we
have to address we have to think about
when you build custom protocols but we
seem to think it's okay to kind of
ignore it in the in the web tier and
it's just not right we have to think
about that so we need some mechanism
some way of describing
first of all that there is this
potential data that will come to us
eventually right not here now but it may
be may you come eventually and it may be
an overwhelming amount of data you know
and just me it may be data that will not
never stop you know that's the first
thing is we need some way to model that
in our code base the other thing is that
we need to have a way with that whatever
with whatever metaphor we choose we need
to have a way of saying I'm not able to
handle any more than this right now
don't send me any more data because I
can't process it right that that ability
we call that back pressure and we need
support for that we need support from
both this ability is saying to model an
unlimited amount of data potentially
unlimited amount of data that may happen
now or may happen you know next week who
knows right it's asynchronous and we
need support for back pressure now we we
are not the only ones who have thought
about this of course right there's been
a number of other players in the Java
space that have been trying to solve
this right we've we've had support for
asynchronous i/o since Java 1.4 more
than you know what is it now 15 years I
mean a long time right Tom one floor has
it asynchronous i/o and yet most of us
don't write our code in terms of
channels and asynchronous i/o and Java
1.4 we write it in terms of higher level
abstractions higher order metaphors so
what we've needed is a common metaphor
to describe this this kind of
interaction with a with a computer with
the data that was higher than just the
low-level channels and low-level
concepts for input and output in our in
our basic jdk so a lot of us a lot of
different teams from you know I think
the the original sort of 800-pound
gorilla of the spaces
Netflix's RX java which of course was
inspired by RX extensions for dotnet
from from microsoft research there's a
then light band which is a company that
used to be called typesafe they had a
technology called akka now akka streams
there's a vertex from Red Hat which is a
you know started by a VMware and this
spring team there and we have a on the
spring team we have a project called
reactor so there's a number of different
projects that have solved or sought to
solve this particular use case to
describe this metaphor and eventually
these teams converge they created a
specification called the reactive stream
specification that provides four basic
types
this for there is four basic types are
super simple they're deceptively simple
but I want to stress for here now you
should not go out and try and build an
implementation for these types yourself
this is a bad idea you'll spend a year
and a half trying to do it and you'll
never get it right anyway so don't
bother just use one of these
implementations these four types are as
follows you have a publisher a publisher
is a thing that produces 0 to n values
an unlimited amount of data or just one
record who knows the point is it
produces data and it only produces it to
something called a subscriber a
subscriber listens for data the
subscriber gets a call back when the
subscription is made and it gets a
pointer to that subscription with that
subscription the subscriber can say I
want to request you know any records I
want ten more records or 100 records see
if that subscriber you've got a
publisher you've got a subscription and
if you have a component that both
produces data and reads data we call
this a processor right that's it those
are the four types is that enough
I say no right there's a there's still
higher order things I want to do I build
a filter I build a map I want to be able
to transform I want to do all sorts of
interesting things to my streams of data
I want to be able to have the same
efficiencies at least that I have when I
work with basic collections and the JDK
right so higher order processing is
required there some different
implementations like a reactor from from
pivotal support these operations but
even there that's not enough right we
need to be able to have we need to have
support for that at higher levels of the
stack so for example our web tier our
data access layer etc so you saw earlier
we created a brand-new Springwood
application and that Springwood
application has reactive web and
reactive MongoDB we chose these
technologies because they're they're
built to work with the reactive stream
specification and with reactor reactor
implements of course the reactive stream
specification so with that in mind we're
going to build in application we're
gonna build an application here that
manages data well of course we're gonna
build a class of type a data class in
common and we're gonna call this what
beer and beer what do we think we can
eat an ID of course so far ID string
question mark equals know what this
means in common is I'm gonna create a
javabean property var means that the
property is mutable so I can say set or
get it's gonna be named ID the type is
string question mark string means that
it's a string question mark means that
it's nullable so I can I can I can give
this I can set null on this field and
the default value equals null so you get
a lot of bang for the buck here right
there's a lot of a lot implied by those
few characters there um here I want to
have what the name sure yeah just the
name is that the actual property that
we're gonna use okay good so name stream
question mark equals null there we are
there we go there's my my data class now
this is a very convenient thing in
Kotlin when Kotlin sees data class it
knows to create getters and setters and
to string methods and equals and
hashcode and all of that stuff for us by
default so this is a full-fledged
Java Bean with all the things that we'd
expect to to have to build a work with
that right so I'm gonna make this a
spring data document there we are right
good and we're gonna say at ID there we
go okay so we have a number of different
fields whatever our you know our key or
auto incrementing value there and we
want to build to manipulate instances of
this data so I'll create a spring data
repository so again fairly
straightforward we say beer repository
and we're gonna create a reactive Mongo
repository and again if you've used
spring data then you know that we had
this repository mechanism a repository
is patterned after the domain driven
design pattern of the you know the same
name the idea is that we want to have
something that handles the tedious
boilerplate soul annihilating lis boring
read and write and sort of data
management lifecycle of building
applications or talking to databases
sorry why should the ID be mutable
because by default it's no and then
you're gonna set it it could be not
mutable I guess
in theory yeah we could try I'm not even
sure if that would work
let's see what happens actually and we
know it this one let's just see well try
okay I'm not even sure I'm just assumed
that the framework is going to try and
set that with here with a value after
the objects have been created or ends
you know but hey happy to try so we've
got a repository and the repository I'm
by the way the question for those who
are watching on the stream I'm sorry the
question was why should the ID be
mutable and the answer was what it is
gave all right so we've got a repository
this is gonna handle the tedious solar
lighting the boring soul annihilating
the boring data management operations
things like inserting records into the
database inserting them finding them all
etc but here you can see that the
reactive repository instead of just
returning void or the entity in question
returns an object of type mano-a-mano is
a publisher that produces either 0
values or 1 value so it's a reactive
streams publisher just like we talked
about earlier but it's a specialization
right there's mono is a very common
thing in reactor it is based on
publishers you can talk about it and
treat it as a publisher but it has a the
extra documentation eval you of being a
specific type of publisher have arranged
or bounded publisher and then we have
Dan here other methods that given
multiple entities return something
called a flux a flux is a reactive
stream is is a reactor type that implies
0 to n values so either 0 or you know as
many values as you can imagine or
infinite it could be just on and on
forever a flux is an unbounded publisher
whereas Amano's is bad it to one right
there both publishers you can talk about
them both in the same way you can treat
them as publishers if you want but it is
very useful to know what type of data it
is right if you have a client that's
gonna just display user interface do you
display a single text field or do you
splay it do you display a scrolling grid
right how do you know and see how that
that's some type there ok so we've got a
we've got a beer repository now I want
to create some data and save it to the
database so i'm gonna say sample
beer
repository and we're going to extend the
application runner and this is going to
be a callback object in spring this
callback object is an object that we're
going to run when the application starts
up it's going to be invoked by the by
the framework and they run the arguments
are gonna be passed into the application
for us to work with these are the
wrappers around public static void main
you can see here we've got the arguments
the name comes first in Kotlin and then
the type it's an array of strings
well the applicant this spring one
application may be launched into the
contexts where the arguments don't just
come from public static void main so we
have wrappers application argument
wrappers but basically it's just a
public static void main method and
because it's in a spring manners
component you can inject things so for
example I want to inject the beer
repository and make it or rather assign
it to a private field this syntax here
again it says I have a constructor this
is my primary constructor I'm injecting
the beer repository by its type and I
want the resulting field to be or the
property to be private so I can use that
I can now I want to write data to the
database and so what I'm gonna do is I'm
gonna say I want to create some sample
names and we'll write them to the
database so that we have something to
work with so let's say beers whoops
bough beers equals flux dot just and
here is where we need
audience-participation this is the
hardest part of the talk for us because
we have to talk about and think about
all these beers without beer so let's
get it over with then we need some names
some beers that you like and we'll take
some you don't like as well mm-hmm
otherwise that's in they don't like I
assume right all right
but what is that right yep okay we
started from the start from the bottom
now we here right so what what hi TR IP
like that now the last one is sure
[Laughter]
ka ka come on
what a time is that right or no
what like that oh dear okay so we just
got into 20 more of those it won't be so
bad now I'm just getting other like I do
valve yes I can spell that one there
like that yeah okay yeah
next that one
okay wek okay okay okay like is that
right yeah all right good next I heard a
Heineken I just hie like that
right okay well we need some bad ones
and good ones right um Sapporo that's a
Japanese that's Chinese what's the one
from Brazil
San Miguel that's interesting good
where's that from France I think maybe I
don't know yeah
next what is it hey spell that one yes
exactly
okay wait KR l SB ERG like that and it's
gonna see let's kind of see yeah sound
of again sorry yeah yeah we can end the
pain if you want
it's keep going we gotta have some so do
you see a significant list about so
here's one of our beer facts here I'm
like to question the crowd since I
assume a lot of you are from Belgium
until the 1970s in Belgium table beer
was served in school refectory that's
true I mean you guys are preparing a lot
older than that but do you know what
kind of beer was maybe we could get buff
like hi is it
how do you spell it te t GI t what GI t
no oh is that right so cow foot or bull
foot or something okay I can relay one
to Russia have a Baltic reporter Baltic
be a TI ka and then space porter by
saying that one goes with the fact that
beer was not considered an alcoholic
beverage in Russia until 2013 did not
know that I didn't know that okay so
we've got some beers open source as in
beer or free as a beer there we go so
we'll write some beers to the day miss
oh well I just want to turn to each one
of these beers into a object I'm gonna
write it to the database I'm going to
turn it into a beer object so I'm using
the map method here on the publisher
right what I have here is a publisher of
course I'm gonna say map each element in
that stream and that publisher into a
beer so I'm going to say beer name
equals it's right it is an implicit
parameter I could have used a name
lambdap Fragger I could say name and
then just map it's the name but by
default like groovy by default in Kotlin
if you don't specify the lambda argument
and you have one parameter it's given
the name it and it of course in this
case is a string right because that's
what we mapped so now what I want to map
it to a beer and then I want to save
that into
based on a flat map that I'm gonna
unpack the previous publisher full of
publishers I'm gonna unpack it and write
it to the day base I'm gonna say be a
repository dot save passing in again it
alright so what I want to do now is I
want to run this code but the problem
with this of course is that nothing is
gonna happen right by default in pub by
default the publisher needs to be
activated you need to have a terminal
function something that invokes it and
causes it to run so we need to subscribe
to that but before we do that I would
actually first of all want to say to the
mirror poster I would say delete
everything in the database first then I
want to chain that together then I want
to say you know activate the the
pipeline there this you know the
pipeline that we've built there then use
the beer repository to find all the
records and then finally I want to
subscribe and subscribe is the call back
here where I can listen to the incoming
responses that come back so I'm here I'm
gonna say let's print out all the
records that come back ok
so I'm using using this as an excuse to
introduce both Kotlin and the reactive
streams API we're gonna write some data
to the database let's see if that's
worked run this code this method should
look fairly familiar if you've ever used
if you've done Java you know basically
what's happening here we're extending
the application runner we're implement
in the application writer interface or
if we're extending it it's the same
symbol just like in in c-sharp or a C++
right now we are specifying override
right this is actually part of language
you have to explicitly say I'm
overriding a method very much like
c-sharp but otherwise it works as we
expect there's the data written on the
console everything is as we expect and
if we run this ten more times because
I'm deleting everything then you know
we'll stop the same results in the
database now this code works just fine
this is very Java esque this is a very
Java esque way of creating this class of
creating this this callback interface
but we have a nice DSL in spring five
Spring Framework five you see Spring
Framework five also ships with native
Cottenham support there's cotton DSL in
spring five and in other technologies
that are in the spring ecosystem that
build on spring five
so what we're gonna do is going to use
the spring application builder and we're
going to build we're going to tell it
that we want to run the spring wood
application using this beer catalog
application right we want to tell it to
run and using the arguments that are
passed in here and want to tell it to
configure beans using an initializer
we're gonna use a custom detailing here
called the beans DSL see that that's a
typesafe element that I'm I'm bringing
in from a cotton extension of cotton DSL
in spring framework itself I didn't have
to add anything to the class path to get
that support it's just in spring itself
the other thing you should appreciate or
see your register is that this is a
class but it is independent of this
function there are no we don't in Kotlin
are called member functions or just
functions you have a global function or
you know a high top level function and
if you have a function inside of a
inside of a class it's not a method it's
called a member function so if you have
no members in the class then you don't
need to have the curly brackets but
because I haven't specified the curly
brackets don't misunderstand me this is
not actually a member of that class
right I it doesn't need to be so I've
got a class and then I've got a
top-level function and that is a spring
boot sort of I'm initializing my spring
good application now I'm gonna use this
DSL here I'm gonna use this beans DSL to
register a being programmatically in the
benefit of doing that in this case is
that I don't have to have this high
level type called the sample B
repository polluting my namespace I can
just have this little sort of thing in
the configuration and I don't have to
worry about it so I'm gonna say
application writer and then I'm going to
write the same basic code as a bean that
I'll register here but III need the beer
repository just as before I need to be
repository to do my work and we can see
that the beer repository is a being that
we had you know inject it for us I need
to look up that bean in this new DSL I
need to look up that being like this I
can say Val be repository and I'll say
Val be repository equals and here I may
use a type safe DSL in the cotton world
for spring to look up a bean by its type
in the application context now you see
that I'm saying ref B repository but I'm
not specifying a class literal you see
we have we have the
amazing ability in Kotlin to sort of
cheat a little bit with type reification
you know that by default the JVM forgets
its generic parameters for instance
variables but we have this facility in
Kotlin called a macro or not a macro in
the inline function which is basically a
macro basically when you see in line in
front of a and in front of in front of a
function in Kotlin the the language
copies and pastes the compiler copies
and pastes that code into the call site
alright and the benefits that we can
actually capture in a token at the call
site the generic parameter so I can
write code saying I mean I have a type I
have an array if I type T and then I can
actually call T get class right you
can't do that with regular class
literals with regular generic types in
Java that's not not I think you can do
but we can do that because of the sort
of this this this effect here right so
here we can say ref beer repository and
that's it I don't have to do anything
more that'll give me a reference to a
beer repository in the application
context and now I can get rid of this oh
yeah good stuff
so we have an application writer yeah
yes it's all that style this is a this
is a DSL that you can use it's the
typesafe Kotlin DSL if using Kotlin this
may be more natural this is called
functional beam definitions you can do
the same thing in java we have a
functional beam definition API but it's
not as clean as this because it's not
well Kotlin gives us is very nice to
yourself the other thing is that by
doing this here by registering it as a
as a being using the beam did the
functional beam definition I make very
clear that this is not actually
interesting code it's not something I
it's not a domain type it's not a class
at the top level that I want to pollute
my namespace it's just a thing that I
need to happen as a side-effect
no it's a it's more it's you're
registering a beam you're telling the
spring this is a beam and I want you to
invoke this object you know to read it
to manage this object for me this
application winner I'm creating an
instance of the application runner
interface this is a functional lambda
you know and so inside that
implementation I have this code it's
just a beam but it's not a top-level
type I don't I can move it to the side
it's kind of like if I had a
configuration class at configuration
class my config I could do the same kind
of thing I could say fun in it I equals
application writer but again here I'm
creating a whole class I'm creating a
method and I have a return value the
application runner this is a Java
configuration style thing you can still
do that in Kotlin you may very well do
that but what I wanted to make you aware
of is that there's also this alternative
called functional beam definition
registration that is very common task
it's very very concise ok and all that
works and nothing is nothing that you
knew before doesn't work it's just that
there's alternatives ok so we've got
this mean we've got this beam definition
registration and we've got these two
types so now I have data in the database
let's build an API write build something
to actually serve up that data and again
here we could say class beer rest
controller at risk controller and we'll
create a get mapping so I'm gonna say
beers fun beers and here I'm going to
inject to be a repository private Val
beer repository and I could say this not
be repository dot find all and that
would be that would work right actually
what I would get a spring web flux rest
controller it's a control that looks
like spring MVC but actually even though
this is a spring MVC annotation what
we're actually having is a reactive
endpoint here enemy M specify a single
instance only here
very good let's test it again
so I have now a faculty application
local host beers so there's my beers
right that's a it looks very similar to
what we've done before and that's by
design but make no mistake this is very
different we're actually returning a
publisher so there's a lot of things
that have to happen here for this to
work there what web runtime has to know
to send data back as it gets it right it
can't wait for the end of the file there
is no end of file buffer there's no end
of file marker basically this is a
potentially unlimited amount of data
it's a publisher so that runtime has to
be able to support that but you can run
spring web flex on traditional servlet
environments and it will adapt using the
asynchronous support in those servlet
environments aware of it where
appropriate but by default in spring
boot as we've seen today we're actually
using Neddie this is a brand-new
reactive web runtime in Spring Framework
five right that is using that we that we
built in ship with Spring Framework so
this is not a servlet implicit
application at all now this is certainly
like I say you can do this that
certainly works and that was that's a
natural thing but again we have these
nice functional reactive DSL
inside of them inside of Spring
Framework five so let's take advantage
of a new DSL here called the router this
is a functional reactive approach to
registering web endpoints so I'm gonna
create a web endpoint here called beers
and that endpoint is going to return a
payload I'm gonna use the repository
here I'll say rip repository equals ref
beer repository and I'll tell the
endpoint here to return all the data and
you can see here that we have this uh I
should put that here at least I think we
have here in the B repository we have
here in the beer repository this this
call called body and it's taking a
payload of type publisher it's taking
that value in the Java DSL there's a
second parameter here of type class we
need to tell the web runtime web flux we
need to tell it that it needs to do Dana
framing it's going to get a publisher
that produces a you know trillion values
so it cannot wait until the
over the last JSON object and then send
the response back to the client so we
need to tell it what a single record
looks like and we give it a class
literal so that knows that each record
is of shape of the shape of a beer right
it knows to try and encode one beer send
it on a code another one send it on etc
we need to tell it that so that it can
you know efficiently send the data back
we don't need to tell that over here
with this right because you can look at
the return value of the method itself
right there the method in this case is
actually something like publisher
publish or of beer right so we can look
at that and go oh the generic signature
is a type beer I'll know to encode one
beer at a time like that but in this
case we don't have that right so we need
to explicitly tell it that it's a beer
and we have to tell like that that is
what you have to do in Java but again
thanks to the rain if I'd type you know
mechanism in common we don't have to we
can just say body of this and thanks for
that in line function
that'll get encoded for you and used to
figure out the result so now let's try
this in point do you know slugs like
beer did they yeah well who doesn't
sure good to know okay so curl HTTP
localhost 8080 four slash beers whoops
JSON PPE all right very good so we've
got our beers in point and we're using
two different DSL here who are using one
DSL rather raising the beam DSL and then
we're using the spring web flux
functional reactive Copland DSL which is
a bit of a mouthful all right so that's
our service all right we should build a
client well it's also a very resilient
this point did you want to do the spring
cloud stuff oh yeah but I'm saying if
we're gonna build a client we need to be
able to make it easy for it to find the
service all right so one thing that
becomes problematic when you start to
move to this market architecture of of
micro services is you need to make it
easy for one service to find and work
with another and by the way before I
continue actually I may just take a
moment to if we didn't have this data
here we didn't have this you know
certainly not something you do in a real
production application you'd see that
the whole application is very very
trivial right it's a very you know small
bit of code to make this work which I am
I can't believe we are able to do that
nowadays you know with a nice aesthetic
type language so anyway we are we need
to make it easy for one service to find
and work with another and things come
and go in a dynamic cloud-based
environment as things come and go they
lose their their IP address right as an
IP address disappears other clients are
expecting to be able to talk to that
service are gonna be disappointed if
they make a call to that same service at
that same IP address so we need to have
some sort of indirection between the
client and the service we could use DNS
but DNS suffers from a number of
limitations in it that have a
cloud-based environment the prints you
know the first one which is that DNS is
a very simple protocol it can tell us
where something lives not if it lives
and that distinguish that that
distinction is very important you may
know where I live but you don't know if
I'm actually at home for example you
know my address but that's not the same
as knowing if I'm gonna respond if
you're knock on the door the same thing
is true for my distribute system I need
more than just the knowledge of where
the thing is supposed to be I need to
know if it actually is there
additionally I wanna be able to control
routing and load bouncing and so I need
control of that in order to do that I
need to be able to ask the question what
services are out there if there are 10
services I want to control load
balancing I want to control how I pick a
particular note oh it's a very common
thing to have more nuanced load
balancing discussions or needs then just
basically LRU at least recently used or
round-robin load balancing so I want
bill to control that and if there are no
instances out there of course then I
wouldn't build it
I want to be able to say oh never mind
I'll degrade gracefully instead of
making a call that's not gonna ever
respond I'll just do something else
right this the support here for reactive
programming is very good if you have a
lot of data and you have a service able
to respond you can manage the the
contention there but if you have no
services well then you know you can't
you can't reactive your way out of that
you need to be able to just degrade
gracefully so in order to give us that
visibility of the system to get to give
us the ability to ask questions of the
system we're gonna use a service
registry and there's a number of service
registries out there but we're gonna use
Netflix is Eureka spring cloud has an
abstraction called the discovery Cline
abstraction you can use it with a number
of different service registries we're
gonna use them the eureka service so you
Iike - service i'll say you week a
server we're gonna bring in the that's
it actually we're just gonna use eureka
server i'm gonna go ahead and do it in
Java because why not
it's an annotation let's see
so you a Oh Eureka - service well we're
doing we're low on time my friend no
you're like 15 minutes okay so we'll go
to the Eureka service and and then I'll
write some Java code for you don't say I
didn't write Java code there so we do
need to configure some stuff so so
report 87-61 unique register something
with week false clients what else doing
fetch registry equals false very good so
we'll spin that up that'll spin up on
port 80 761 this is a demo you'll
probably have a load balanced you know a
clustered version of of eureka ring
somewhere otherwise or you can use a
platform like Cloud Foundry and cloud
for me has it for you you need you need
some sort of recipe that you can just
reuse but for our purposes we'll use
that one because it's easy to get
working and now we can build a client
and that's what we'll do build a client
to talk to that service again using
Coplin and I'm gonna use the I'm gonna
call this the where's it's the edge
service mm-hmm edge service just edge
service and we're gonna use reactive
just bring good to that Oh reactive web
when you spring cloud gateway I'm gonna
use actuator hystrix you week that's it
okay okay we're good alright good stuff
look at that
do you know what the way if can
World Championships in Finland first
prize is the wife's weight and beer what
did you hear
wife-carrying world champion that's a
thing okay
I'm proud to be finished yeah a little
bit here we go
I like this one Norway's first aircraft
hijacking was resolved after the
hijacker surrendered his weapon in
exchange for more beer solves the
terrorism problem oh yeah okay so we've
got a client we're gonna build a client
that will talk to the service via the
service registry so we'll say at a naval
Discovery client and we need to make our
service that we built over here able to
talk to the service registry and so
we'll go back I'll reinstate the spring
cloud start on Netflix Eureka client and
I will say at enable discovery client or
not at naval discovery there we are now
I think but I'm not sure that in the
latest release this discovery client
annotations actually we've done it you
don't need it but just so we're sure
we'll leave that there and we also need
to give it application name I'll say
springing application name equals beer
catalog - service and all we start one
more time I don't know if you guys get
this kind of performance when you're
doing spring boot development but we've
done comparisons between Josh's Linux
laptop and my Mac and he's about three
times faster so if you're doing a lot of
job development look in the Linux
there's my beer Kenalog service ok and
there's a service that's available at
this IP the service ID in this port etc
now we can build a client that will talk
to it like I say so we're gonna go back
to our edge service here and the edge
service will be a spring application
name equals edge - service and we want
the application to start up and register
itself there so I think that's gonna be
ok now we're not building just a service
for the sake of building a service we're
not building a client for the sake of
building a client what we're doing is
- building a edge service something
that's gonna be the first port of call
for requests coming in from the client
from the outside world from things like
our iPhone or a Playstation or Xbox or
Roku or Android device or iPad or the
web the web which is a thing still so
today we're gonna have a html5 angular
progressive web application that's gonna
need to talk to our back-end service and
it has its own particular requirements
it may have security it may have
authentication you know sorry it may
have a requirement to be able to talk to
different endpoints that it can't get
you know I can't get out of out of the
sandbox and so we need to be able to
address those client specific concerns
somewhere rather than retrofitting every
single downstream micro service to
accommodate the instruction a new client
where instead of just going to
centralize those concerns here in this
edge service you'll have one edge
service Pro client for outside client
right right I think that's that okay so
we're gonna build an html5 edge service
if you will so what what is a you know
when you're building html5 application
you want to make it easy for that
application to be able to talk to all of
our services html5 applications live in
a sandbox so one way to get around that
of course is to add access control
origin headers to every single deployed
service in the architecture but of
course that's a non-starter right we're
trying to keep the agility that were
that you know that we hope to gain by
moving to micro services and if we have
to deploy every single downstream
service just to accommodate the
introduction of a new client we'd lose
that agility so instead of doing that we
can centralize we can you know either
proxy the data from the client to the
downstream services through the edge
service that's one way to do it and
spring cloud has a a new project called
spring cloud gateway which is built-in
built on top of Spring Framework five it
requires Spring Framework five a Spring
Framework five by the way requires Java
eight as a minimum and it requires you
know recording sort of eight is minimum
so as a result spring cloud gateway also
requires that it requires the reactive
support in spring cloud instance are in
Spring Framework as well so we can use
spring con gateway and we can create
custom routes so let's actually proxy
the data from the downstream service
using spring cloud gateway now how many
use dual Netflix Zul so this is kind of
like an alternative to that Netflix dual
certainly works and we still support
that of course but spring click gateway
is a reactive first API it's it supports
other protocols besides HTTP it also
supports reactive streams initiative and
it is ongoing the development is gonna
be you know it's active right now so it
has a lot of it's an alternative
approach then using Zuul
so I'm gonna say run args we're gonna
say it well you know the sources are
gonna be here dot sources I'm gonna say
edge service application and I'm gonna
pass in some initializers news alright
so the first end point first thing that
we're gonna do here is we're going to
register the support for for we want to
create a route that actually routes to
our downstream service that's one way to
get around the fact that we have this
cost origin restrictions a single origin
so what I'm going to do that is to
create a a router a spring cloud gateway
around that actually proxies request
from the outside to the downstream
service so we can say Gateway I also
need the cotton extensions I forgot to
bring that in that's not at the moment
in the current release in the default
jar that we brought in for spring
collect gateway so I say spring plan
common cloud gateway cotton extensions
bring in on that and then ok so gateway
is a bean that I'm gonna register and
Gateway requires it route and inside
that route we give it an ID and so here
we're going to proxy the downstream
service beer catalog - service when I
say that the predicate is that when
somebody makes a request to our local
edge service that matches beer catalog -
service or you know beers you know
original beers what's wrong with this
predicate
to have their own import oh thank you
use the second one at the third or the
first okay so I you can see here that
I'm using a in fix function in common
this is actually a part of the DSL I'm
saying path dot or parentheses right
that's what it's actually happening
behind the scenes but because that that
or function is annotated with the the
token called in fix I can use it like
this I can use it without parenthesis
and so it creates it's very clean to
sell and so when I do that I want to
create a I want to say when something
matches this predicate and I can do all
sorts of interesting things there I can
also specify custom filters filters
their gateway filters and there are
filters out of the box for things like
rate limiting and load balancing and all
that stuff and so on but for our
purposes all I'm gonna do is say when it
matches that filter then send it to
something else in this case I'm gonna
send it to a load balance to URL and the
URL will be to the beer catalog I know
don't use the next day for hunt
stability I guess so I'm gonna send it
to the load balanced beer catalog
service which is gonna resolve by
talking to the registry so that's our
that's a first way to get one let's see
if that works right so we should be able
to go to either one of these these URLs
here single instance only and why ditto
port okay what do we say this port runs
on 80 81 81 suite thanks man you know an
Argentine political parties have their
own brands of beer ready Oh anyone from
Argentina is it true well we do have
Carlsberg in the list when scientists
niels bohr won the nobel prize in 1922
the Carlsberg brewery gave him a
perpetual supply of beer piped into his
house that's so cool
that'd be nice
especially from a brewery right you'd
never really run out yeah well that's a
good business that'd be sad
let's see what did I do wrong palm you
make a client that seems like it should
be okay
lb : beer catalogue service your
catalogue service that's the right name
they're both talking the same thing
sorry I don't think so but yeah that's
deprecated computer say no let's say I
mean I can I can always just look at the
code
I guess that's an option mm but I don't
wanna okay fine oh well so here we go so
edge service application did I do
anything special web client no right
there
load bounce Oh set up a gun of course
the ears I knew it so thanks just drinks
see strings like gets in the way type
then you wouldn't have that problem type
DNS okay so um what did I say beer
catalogue service or not I don't want
beers well I don't approve gateway beans
beer catalogue service one more time
gateway route needs to be in a bean
isn't it it is not good catch there
buddy all right
it's like Lisp gotta count your
parentheses
all right
hooray all right very good thank you so
yes applause is absolutely not necessary
that would not that would not have been
miraculous if I were just a little bit
smarter so there we go we proxy the
request of the downstream service that's
only one option but I actually want to
have a I don't want to send all those
beers back to the client right our
clients aren't good that's you know we
owe our clients more than that they
don't pay us for all those terrible
beers they want the good ones only and
we want to filter out the bad ones
so rather than just proxying the data
back and forth we want to create a
custom endpoint that returns a subset of
those beers and this is one of those
things where we're gonna go beyond just
proxying data we can actually do some
sort of transformation so let's create a
router here you know using the same DSL
we saw earlier and I'm going to create a
new endpoint called good beers like so
and the good beers endpoint is going to
say server response dot okay thought
what I'm going to send back data but
before we can do that we're gonna make
calls to the downstream service right
would actually make a load balance call
to the downstream service and get their
beers back and then we'd have to process
them before they come back so here we're
gonna need a way to call the rest
service we could use the rest template
how many of you use the rest template
before the the HTTP workhorse and spring
itself the rest of it is certainly one
option but in Spring Framework five we
have a new bean on the block called the
web client and the web client is a
reactive HTTP client you can use it for
for not just the normal things but you
can also use it for things like service
and events right because this is
actually not gonna it's not gonna it's
able to handle potentially unlimited
amount of data whereas the rest template
you know wants to wait for the end of
the file then then process it and
translate it so when we do the web
client here and we're going to say that
we want to configure a filter and the
filter that we're going to configure is
a load balancing one so a RRIF load
bouncer there you go
so I'm gonna say lb filter equals
ref load-balanced okay did you hear that
you heard that right it's getting close
to beer 30 yeah all right no okay so
we're gonna build that there we go so
I'm building it I'm registering a new
web client this is actually just don't
you know WC it's it's a type web client
as you can imagine like that right so
I'm just gonna return that back to the
beam definition and I'm gonna use that
bill client in this rest in point so I'm
going to say Wow client equals ref web
client all right very good
and I'll say client dot get and I'm
gonna call all the downstream service
and the downstream service is gonna be
HTTP colon forward slash forward slash
and I'm using the load balancing filter
here in the creation of my web client
because I want to actually I need to
call the service but I need to do so
through the service registry I don't
wanna use DNS right that's the whole
point I'm trying to go I'm gonna get the
benefits of the service registry so here
I'm gonna say call the service in the
registry called the beer catalog service
and what's gonna happen is this gonna
pre process this request it's gonna go
the service registry it's gonna get back
all of the service instances 110 or a
thousand of them whatever and it's gonna
load balance and by default it's gonna
use a library called ribbon which is the
client-side load balancer from Netflix
it's gonna do that for us all on the
blink of an eye so I'm gonna say call
that service get the beers data coming
back and when we treat the response I'm
gonna turn the response it comes back
into an object of a certain type so I
want to say give it give me back the
JSON and turn it in to a publisher
containing elements of type beer all
right so we need to tell it what kind of
data we want back here and of course in
order for us to do that we need to do
something terrible it's something that
you should never ever do not even when
you're all by yourself at home all alone
no one is looking we're gonna copy and
paste some code we'll take this beer
line
and goodbye to you okay turn that here
beer class Java and then we're gonna
filter and we're gonna do is we're gonna
filter the the good beers right so Val
good beers equals and then we're gonna
return that so let me see we're gonna
say super response dot okay dot buddy
good beers there we are okay so now how
do we filter which one should we get me
to obviously Budweiser yeah so we're
gonna say beer I'm gonna say if if I
want bad beers right so I have a bad
beer list now bad beers equals list of
convenient thing cotton in their list of
and then what is the what are the beers
here that we want to yep so I'm gonna
get rid of Winnick we don't want
Budweiser okay so we'll get rid of that
do we want to is that a good one
good davell good yeah good how many want
to keep Heineken no matter what not oh
dear okay sapporo okay Tsingtao okay
Sunmi good
there's more than one car number huh
that a good buy but we're making a list
of bad beers oh yeah wait yeah that's
right so is this good bad so we should
we don't know we want to get rid of it
yeah Kornberg Carl's Brooke hmm so we
want to keep it in the list keep it in
the list okay good I'm talking to you
leave it even lists yeah
this one yeah it's pretty good you can
leave you can take that on that we're
saving it alright we've got a list of
beers and what I want to do is wanna say
if beer in bad beers does that work
no sorry if bad beers dot contains
there's a dsl here bad beers dot
contains beer if sorry what Oh beer
Thank You brain not working okay so if
bad beer contains beer named if not then
we want to keep it so true so actually
just just there okay so there's our
custom filter we're gonna get back a
list of beers and let's see if that
works first of all let's see if that
gives us what we expect okay single in a
sense good so we should be able to go to
localhost 8080 one eighty eighty one
good beers it's not working
yep so we've only got the good ones
here's the full list here's the subset
now the last wrinkle of course is that
this downstream service may not be
available right at that service right
now it'll load bounced if there's one or
more instances it's gonna work just fine
but I want to I want to have a graceful
degradation I wanna make sure that if
there are zero instances that I don't
throw a 500 error or an exception
someone use a circuit breaker so again
here I can just use this circuit breaker
mechanism here I'm gonna use hystrix so
I'm doing here is I'm saying create a
history command from the good beers
variable there and if there are no if
there if the if the call to the
downstream service should fail when
trying to call this then return an empty
list right it's better than nothing and
so on so we'll send that back that's a
circuit breaker around or a call to the
now term service but otherwise should
work
okay one more time okay good all right
so we have a robust service that'll kill
it to show them that happen kill the
actual service eureka service it's pure
catalog service goodbye empty our list
not a 500 error not a stack trace right
which is better what this is what this
is a much better user experience than a
big fat ass carrot middle finger for
example okay well so we did it we built
a a Kotlin reactive application that
does the right thing in the face of
service outages and topology changes
it'll load balance across the available
instances and we did it with nice type
save Cartland ESL's guiding us along the
way we looked at spring 5 and did a
whole bunch of stuff now for the you
know the main event let's build a client
so what do I do now my friend I think
we'll give you all a break two minutes
to know you could all go pee in two
minutes right no okay fine
15 15 yeah we got a hundred minutes left
I'm 1450 yeah
I'll then yeah I need like 80 minutes so
okay 20 minutes no see you back here at
10 after and if we have questions we're
happy to take them so far yeah thank you
I'm so glad one of the things that I
like to do in my presentations mostly
because my company actually will send me
with a bunch of stuff as I have a bunch
of schwag so I'm going to encourage you
to ask questions and you'll receive swag
as part of that for instance this is a
bunch of J hipster stickers and I have a
couple books J hipster books and I had a
bunch of t-shirts that look like this
one so if you're curious I want any of
those let me know and ask questions
so the first thing we want to talk about
is the client what happens if you know
Josh builds this great spring cloud
based service and there's no client and
you can't actually view it then you've
got a problem it doesn't really mean
much unless you use curl or HTTP ie who
thinks that the client is easy to
develop it's so hard who thinks it used
to be easy to develop back in like 2005
six struts
spring MVC well you don't have the same
expectations now before right now it's
got it you know have a spinner and stuff
like that and yeah
also work offline so we're going to
build a beer client for what Josh just
built and this is what a beer client can
look like sometimes yep so what are you
going to develop a client with today
would you like to develop it with
something like JSF maybe not we're going
to use angular today mostly because I
know angular really well there's other
JavaScript frameworks and other actual
ways of developing progressive web apps
angular just one of those so I like it
because on their website they basically
say one framework it kind of sounds like
one framework to rule them all right and
everyone I think that builds some sort
of UI framework usually wants us to
happen where it's usable on TVs and
phones and everywhere and a lots changed
you know since we were building
applications back with JSF or even with
struts or a spring MVC back in 2004 or
2005
I mean in 2007 Apple released the iPhone
with no native apps there's only web
apps and in 2007 Chrome wasn't even
released right and then ie7 it just come
out and I don't know if you remember but
ie7 was pretty cool when it first came
out just like ie6 was cool when it first
came out they both ended up being the
bane of our existence as web developers
but you know they were great when they
first came out so
a lots changed since then document that
all over document done there's a big
difference for me nowadays you can
actually run Linux in your browser with
JavaScript so this is a this is a sample
project here you can navigate to that
URL and you can actually open up you
know with the I on there a C file and
edit it and then compile it all in the
browser so we're able to do a lot better
things which off-script nowadays boot
Linux so you can compile in your browser
yeah it's funny happened but one of the
biggest problems that we've had as web
developers is we've had a very where
we've given users a very bad user
experience and so there was a study done
in about a year ago and this was part of
a talk that Alex Russell did at the
chrome developer summit where he cited a
double-click report and that report said
that basically three seconds to page
interaction on a 3G connection is what
people want and they found that 53% of
sites are abandoned if a mobile site
takes longer than three seconds to load
and the same report said the average
mobile site loads in 19 seconds and so
we failed on mobile largely because
we're using laptops like Josh's razing
laptops like mine even though mine's not
as fast as his it's still pretty fast
it's way faster than phones right so
we're testing when you're building these
apps and they're happening fast but our
laptop of this filthy liar so the way to
get around that is to actually buy a
200-dollar unlocked Android device so if
you're doing mobile first development
and you're developing for mobile phones
first or even you know iPads or anything
like that
make sure and test on those devices as
you're building you can also use the
purple pattern that's a great way and
I'll explain that a bit more you can
also use Chrome's developer tools to be
do throttling on the network on the CPU
and you can make you
or screaming fast laptop into more of a
slow phone that you're developing for
this is very important and maybe not
important for you if you're developing
for a company and you're developing apps
for their customers and everyone's on a
fast connection or an office not as big
a deal but if you're if you're Facebook
or if you're Google and you're just
trying to get more people into your
network so you can advertise to them you
want to target everyone in the world
right you don't just want people on a
fast connection so that's why it's very
important to them and so the purple
pattern is the way basically you push
critical resources for the initial route
you render the initial route you
precache remaining routes and you lazy
load and create your remaining routes on
demand so this is a lot of what the
Google engineers came up with and then
that basically got renamed to
progressive web apps so progressive web
apps are basically a way for you to do
similar to Josh's doing but in a browser
in the sense of your app will work
offline you can also install the app so
these are just the three things that
Google tests for when use its lighthouse
tool to actually see if you have a
progressive web app and make sure it's
on HTTPS and make sure it loads while
it's offline and that it has web app
manifest which allows you to install
that app and so if you have the flags
properly turned out in chrome they'll
actually prompt you to download and
install it and if you're on an Android
device I believe it's enabled by default
and for the longest time progressive web
apps
weren't supported by Safari and they
weren't working on an iPhone so
everyone's like whatever you know a lot
of hate but just a summer they've
changed that and so now I believe in
WebKit nightly it might even be a
release service workers are supported
and you get these features under in
progressive web app so Apple is no
longer blocking progress in that sense
so let's get to coding and write an app
where's your beer emoji I forgot to put
on my ah I got the laptop in front of me
I guess it'd be sitting on the table
yeah right there cool okay so what I did
for um and I will forget to unmarred
mirror my monitor every once in a while
so please let me know and when you're
not seeing what I'm talking about
mirror those and then should be able to
see it all and it's big enough right you
don't need a bigger do you need a bigger
in the back thumbs up thumbs up alright
I think I can make it a little smaller
okay so I have all the services running
Josh and I have this project in github
under my username so we'll have a link
at the end but basically come on raivo
cloud native pwace so that's where
everything's at that's Kotlin reactive
is what he just did he also did a Kotlin
basic one that's in there and it uses a
regular spring blue stuff with the
outdoor reactive stuff and then we did a
talk of e jug and harvest and that one's
archived in that folder that has java
groovy and colin right again but
basically i i have everything running
here those three services and so i can
go to localhost 81 81 8080 good beers
and i updated the list so it should
match PBR in there go fix that PBR here
Pabst Blue Ribbon it's just beer in the
US that a regular wins Awards but we
don't know why let's see it in there
maybe not so this is a beer catalogue
service all right we already start down
okay and another window here exit that
I've got say hard to look at so here is
me just creating an angular app using
angular CLI so angular CLI you can
see the date there on November 7th right
before we went on break and then you
just run the ng new client if you don't
have angular CLI installed it's just npm
install' - g angular CLI like that don't
do it now or it'll do now well that's
part of the reason I did it before this
is because just in case you can see this
only took 2 minutes and 14 seconds there
I've had it take up to 15 minutes before
on a slow connection so NPM like you
think mavens bad like may even downloads
internet right NPM is like hey Internet
bring your friends let's party so that's
that's our client and we can run ng
serve is the the command to basically do
the you know spring boot run and get
everything up and running and it did
already install everything so that
shouldn't be too painful but it does
have to compile everything from you know
typescript to JavaScript by default so
it takes a little bit but I'm you can go
back here and we're gonna make sure PBR
is out okay oh yeah that looks good now
call off the down the dogs so Oklahoma's
4200 I'm just gonna switch to a cleaner
client a little bit bigger so you can
see it just has welcome it's got an
image it's got a few things so what we
want to do is we want to get that beer
list and display it in here so we'll
start I can actually leave that running
and bump that phone up a little going to
client and then yeah did you know
there's a brewery in Germany that's
almost a thousand years old it's been in
continuous operation since the year 1040
that's awesome I gotta go to Germany
Purim Oriole so you can generate code
with angular CLI there's this ng command
that we saw earlier with ng serve but
you can also do generate service beer
alright and that'll generate a beer
service for us you can also do n GG s
beer so they're shortcuts for that stuff
we'll open this up in IntelliJ
or try hasn't been opening everything
for me as much as I like recently open
did you know that a hundred and
sixty-two thousand seven hundred
nineteen pints of Guinness beer are
wasted each year due to mustaches so
make the font a bit bigger so we have
this beer service that I just generated
and by default I don't like it in that
directory I'd like to create a shared
directory and then put my services in
there so there we are and with angular 5
there's a new HTTP client so if you've
been to an angular before you might used
like HTTP but now there's HTTP client
which causes confusion because there's
one from selenium as well so make sure
you choose angular 1 when you're doing
your imports and then we can write a
method like get all which returns an
observable so similar to reactive
programming here that josh is showing
and this you just do this or you do
return this HTTP GET and then we'll
point to our service you actually don't
need the HTTP you can do localhost 8080
one good beers this looks really similar
to Colin right you're not funny the
constructor they you know the method
name before the type that didn't like to
see parenthesis at all
yep yeah reactive programming I mean
hopefully there's the this should look
familiar
both producer and write made it is very
interesting how typescript and Colin
looks so similar
even down to the types right where it's
you know setting a local variable in
this and you can set a private or public
and yeah very similar so now we need a
way to display that so I'm going to do
engi generate component will call it
beer list and that does put in the
proper directory so that's a little
nicer and we'll go ahead and I don't
know why it doesn't import that by
default but just found that bug today
they import it everything goes away so
now we need private beer service and
just to let you know there are going to
be mistakes made on purpose so you see
errors that happen when you're
developing with angular I want to show
you that so when you see them after this
you're like okay I understand that not
just Wow Matt made everything work
that's awesome so this beer service get
all and then you subscribe to that and
you can the hard part is doing Java and
and typescript fat arrow versus a versus
thin arrow so you have to remember that
equals vs - but basically here you can
do this beers equals Dana and then close
that out you can also do you know error
equals console error so you at least see
something happening and then you got to
figure out how many curly braces it has
after that I think that one doesn't go
there and that one does and then you
need like another one and it all works
gears and then you can say it's an array
if you want but we didn't actually we
don't have to create like a beers class
you can if you want if you want it to be
more typed but we're not in this example
so we're getting a mall or setting them
to local variable and then we got to
read them here so we'll just do beer
list and then we'll do a div like that
there's some shortcuts I have beer of
beers and then we'll just show the name
all right and that should all work all
right who thinks it's gonna work I only
know why it's not gonna work
okay I'll show you since you asked since
you asked all right we gotta get the
console going because you'll be like why
isn't it showing up there so first of
all hmm nothing happened right well we
have this component here
fearless component that's its name we
haven't told it anywhere were to render
right so you have to go into your app
component you can say well let's get rid
of this stuff let's get rid of that
image and then let's just put it right
here
and tells you smart enough to already
know about it so if you just start
typing it'll do it and then it'll try to
render that component so you go back and
you're like welcome to it got closed but
you got to make sure this is open so you
see the real error is no I mean it's no
provider for peer service that's kind of
intuitive once you get to know this
stuff so and the app module you can add
the beer service there you can also do
it in the component level but then you
have to do it for every component that
you want to use that beer service in so
you got it there and you're a little
closer and then httpclient no provider
for HTTP client so you gotta go out of
that one too but that's an import that's
part of angular so you can do HTTP
client module so you're basically making
beans you're making objects available
for injection right I mean right this
should also look very familiar and now
we're getting closer right but cores
cross-origin resource sharing a lot of
people don't see this when they do
javascript in java projects because they
bundle them all together in the same war
and they don't have to worry about it
but I think for the most part a lot of
JavaScript developers and UI developers
are developing the project separately
talking to API is in some other place so
those api's have to say hey this client
can talk to me so back here we have this
edge service and and I told Josh about
this just a few days ago hey corns
doesn't work with live flux and he was
like whatever kind of ignored me until a
half-hour before this talk and he
figured it out in about 15 minutes so I
have that code right here it was
it's like 45 minutes before the talk so
you can see here all you have to do is
register it beam right with with course
configuration and course Web Filter and
then you can apply the default values
which is basically wide open so if you
want to change that then I have this
comment out here it shows you that you
can set the allowed or origins and and
you know specific headers and stuff like
that so if we do that and then restart
you just hope we restart the right one
yeah edge service the whole talk really
rides on this working this doesn't work
then we're gonna just bail and throw
t-shirts get some beer well you're right
and in fact and that's my backup plan so
let's see if this works first okay so
we're getting a list of names but he's
right so we have that in this cloud
native pwace project let's see if you
can just google that looks good so if
you go in here I just did it in this
column basic one but if you go into
client then basically there's this proxy
kinase on that you could define and so
the difference is in that beer service
we wouldn't say localhost 8080 one we
just say it slash good beers and then it
would handle proxying that for us and
then for that to work
what I did is in package JSON I just
changed the start so you get our on NPM
start and it would pass in that proxy
configuration so that's one way to do it
but it only really makes sense if you're
gonna actually bundle your applications
together in the end if you're gonna put
it on the gateway service instead of
having it you know separate so thanks
for figuring that out Josh big help but
this isn't that much fun because it's
just a list of beers right so this is
where it gets risky because I'm going to
add a giffy service where we take that
name of the beer and we go out to giffy
and we see what animated gif matches
that all pretty names this is this is
risky
so do a new look every service sure and
I already have it here to make things a
bit simpler so you can see this giffy
api has an api key on there and and that
isn't a github project and they say hey
you use this for demo so that's what I'm
doing if you for some reason plan on
using giffy in your production app I
would not recommend using this API key
like stuffs gonna stop working it's
probably at rate limiting but I hit it
yeah so I'm basically there's a get
method in here where we take that API
and we add a search term on to the end
you can see Q equals we append that and
then we go and get it and it gives us
back a whole bunch of images so we just
grabbed the first one and if there isn't
any images to come back then we give you
the dancing cat image which is always
fun dancing Canada right so there might
be a few of those with these beer names
who knows so once you have that you can
go into that module and we'll need to
register it again because it's another
provider and then we can go into our
beer list component here and dependency
injection I don't know if you saw on the
Kippy service it's got this injectable
at the top so similar to inject in jhana
a little bit different it's got you know
the parentheses on the end but that's
how you make services injectable and
then in here you can say for each beer
go ahead and call that gippy service and
take and grab the URL and set it to a
local property so you know JavaScript
and typescript is pretty cool in that
way where you don't actually have to
have properties on your objects you can
just create new ones and then we can say
image source equals beer giffy kind of
scared you got a do an alt tag to be a
good developer
you make the screenshot appear over
there so that I'm out of frame okay
there's a triple camera wanna do those
coming in one fight is not great
d4 oh we musta spelled it wrong yeah
Tsingtao okay yeah what yeah Porter
magazine okay no real bad ones right I
think our time is up
this one actually does that like animate
so yeah I don't know what quack is no
Anne doesn't come in yet but the problem
with this is if you went in here and
went to network and clicked offline and
refreshed it doesn't work right so we
want to make this into a progressive web
app so it works and these steps aren't
as convenient as other ones so I got a
couple notes here on how to do it but
one of the things I like to do is make
it just look a little better I think one
of the things and benefits that you get
out of being a front-end the UI
developer if you get to make things look
good even if someone else designed it a
lot of times you'll be implementing it
and when there's demos it's fun to be
like yeah I did that
even though Josh did all the hard work
and got us all the data right as a UI
developer like you do the demos and
people are like that guy yeah he really
did a good job
you control the pixels right so so the
first thing is I'm just gonna add
angular material so yarn add angular
material and there's a new requirement
the component development kit is part of
that now so if you just install angular
material and you don't install the
component developer kit then things fail
so we'll do that hey Matt yeah did you
know that Joan Emmons is the only person
on earth capable of balancing two
hundred and thirty seven pints of beer
atop
that's almost as many typescript classes
we need a picture in modules here's
something fun we can do we'll just
remember this window CD client and
you're on count lines of code let that
go for a week so once this finishes
installing basically you have to import
material design modules into your
project to use material design
components I think it's very interesting
because if you've been using angular
material for the last year they've
changed the name of their components and
how they import stuff on almost every
release they haven't had a release
candidate yet so they're not as bad as
angular was last year because angular
was breaking stuff between release
candidates these guys are at least still
saying hey we're beta all right we
haven't released it yet so I think if we
look in let's see package.json hasn't
made it there yet still working on it
any questions you know this is this
isn't a fact for most people here but
for those of us who are from the state
this is awesome it's it's novel in
France Germany Austria and Spain and the
Netherlands they serve beer and
McDonald's you know I guess for you did
you know that they don't do that in the
West or further west nothing
also note yeah go from Norway thank you
NPM install so can somebody tell me if
this is true cuz it's cold here and I
want to know if this is real because
maybe I'll make it a quick trip you can
swim in pools of beer in Austria is that
a thing anyone know maybe like
bathhouses be your houses
you drink and get clean at the same time
it's a-you know this pools would have a
barb right in the pool right just Magus
yeah and usually a bathroom in the pool
too all right so I didn't think this was
gonna take so long so we can we can
write some code while that's finishing
so for the app component I'm just gonna
give it a toolbar so I got this little
shortcut here so Matt toolbar for
material design makes it look a little
better but to make that work you have to
use styles so they come with a number of
pre-built themes if you clicked in this
directory you can see that there's deep
purple amber and to go pink pink blue
grey and purple green so if you got a
material that angular comm or angular
dot IO you can see the different colors
and the different themes they actually
have this little trigger up here where
you can say I want to see it you know
those different ones so and then all the
components here are laid out so for
instance the the toolbar you can see
matt toolbar and then the examples they
show it looks like and then for the API
they'll tell you that you actually need
to import that specific toolbar so how
are we doing oh we're done finally
oh that only took three minutes seemed
like longer so importing components will
do matte toolbar not matte me module and
then there's a matte list module and
then maybe a map button module make sure
all those are named right so now if we
go back to our app we'll see if it's
still run looks like it is oh we're
still offline oh yeah
okay so we're getting somewhere all
right we got a tool bar we want to make
things look a little better in our beer
list so we can go into our HTML there
and we'll say we'll use their mat list
and so I'm not gonna do edit I don't
think love time for that so now it looks
like it would on a mobile phone a little
bit better we don't have the names in
there though so let me put that back
okay
so now we got the names like with a
little dancing guys but still it doesn't
work offline right we haven't really
done much there so we need to go and add
Service Worker support and the way you
do that with angular CLI 1.5 dot 0
differs from the way you do with 16.0
but one dot 6.0 hasn't been released yet
so we don't have to worry about that
today this is how you do it with 1.5 so
angular Service Worker is now a built-in
thing that you can use in service
workers how they work is they basically
allow you to intercept network requests
and they operate on a background thread
so that allows you to do the caching and
the high-flying abilities without that
there really wasn't any way to do that
before except for like app cache but it
really wasn't doing like Network
requests and stuff like that so what
I've learned is that if you do it just
like that the Latian release of Service
Worker is v dot 0 dot 0 but when they
released angular CLA 1.5.0 they forgot
to upgrade from 1.0.0 - beta dot 16 so
if you just install that one with with
angular CLI 1-5 it's not gonna work so
that's why you gotta do this specific
one here and then angular CLI actually
supports service workers out of the box
so all you have to do with it is run ng
set Apps 0 dot Service Worker
equals true the reason you have to have
to zero in there is they do to support
multiple apps in a configuration and
that configuration is an angular CLI dot
JSON so it has where all the paths are
and you can change those and it also has
Service Worker false so whatever you
wrote it didn't work
Angie said apt true not zero now I'll
make sure it worked there we go and so
now all you have to do is end you serve
- prot so the cool thing is it only
works in production mode which is great
because if you think where they call
them single page apps s pas are bad
because SPH broke the back button pwh
break the refresh button right and so as
a web developer you're like oh man oh
sorry in news hey man yeah did you know
that beer was illegal until March 1st
1989 in Iceland now the date is
celebrated every year in Reykjavik as
and I apologize for butchering the
native word here but your dagger or
beard a beer day in Iceland does have a
date yeah March 1st 1980 hey hey there
your conference in the Iceland space so
when you do do the production build it
does do a lot more optimizations for you
you'll notice I didn't do ahead of time
compiling that's another flag Ã¤Ã´t and
that's actually going to be the default
as soon as they can make the compiler
fast enough in angular but this is
something that that you could struggle
with if you actually enabled service
workers on your project and then ran and
you serve and nothing worked out fine
it's because you're not doing the
production build so you need to make
sure and do that and as a developer it's
great because I struggle all the time
with even practicing this demo before I
do it in the talk because half the time
I forget that it's stuck in my browser
and I pulled my browser to do the talk
and there's the finished app right and
it's like oh I forgot to delete it
because it does it does get stuck in
your browser so we have it here and what
you can do is there's this application
tab in chrome that you can go to and you
can see the Service Worker information
so you can see the most important thing
I think they do this by default now is
they update on reload so that did not
used to be the default which meant you
could update your page and refresh as
much as you wanted and it would never
pick up any changes so now it updates on
reload and the other part of the
manifest which is you can see we don't
have there and so at this point we
should be able to do no way that's still
running
let's try should be able to do Network
offline refresh and it comes back so
it's it's caching all that information
the reason it brought those images back
to so we're working offline now it's not
going to work if you haven't cashed that
information before right you have to
have made those requests in the
beginning and then and then come back to
it so it all works offline now but it's
still not a great web app and the reason
we can test that is with light-bot or
lighthouse and this comes with chrome
it's actually under chrome developer
tools in the audit tab now but it's a
little harder to read that report that's
why I like having this little plugin up
in the corner but it basically evaluates
whether you're a good progressive web
app and it also evaluates accessibility
as well as performance of your app so to
let you know if you have things that you
can improve there and sometimes it does
get stuck so you notice if if that stops
like moving then it's probably not
working anymore cancel try again and if
you have your your actual developer
tools open it'll warn you and it doesn't
work then either but it basically runs a
bunch of tests usually it's quick people
ignore it for a while hey Matt yeah what
happened to the c-loc
you can't land a code oh yeah let's look
at that bad boy here your fans going
I blew up on deaf sighs it made it to
29,000 text files uh that was in the
nodes we could charge em directory maybe
it was like installing something at the
same time broke okay so we're not doing
very good on our progressive web app
right we only got a 45 out of 100
performance isn't greedy that I blamed a
lighthouse because it wasn't actually
working half that time but there's no
fallback when JavaScript isn't available
it's not on HTTP it doesn't redirect to
HTTPS page load is fast enough on 3G but
it could be better all kinds of stuff
like that so one of the things we need
to do is actually install a manifest so
there's a site I like to use for that
real fav icon generator babe icon
yeah net and then you can basically
upload one and so how did I find one
free beer icons that's how I found it
and there's like a bunch of them I think
I have one on my hard drive here beer
and so then it gives you shows you what
it's going to look like on different
devices right here is iOS we can say
actually make that a white background
Android looks okay you can give it a
name if you want to change the name
looks ok in Windows Mac OS sorry not
great you can turn your picture into a
monochrome icon so that's kind of cool
and then and then I like to put in a
path here because I don't like to put in
my root directory so I do assets fav
icon and then you generate it and it
basically gives you a whole bunch of you
know fave icons I'll render on different
devices so once it's in IRS's we can
download the package and another reason
to put it in assets is because in
angular CLI anything you put in assets
will automatically copied over into your
production build if you don't put it in
assets and you just put it in source
you'll actually have to go into that
angular CLI JSON file and list the files
that you want to copy so this makes it a
bit easier so we have all these favor
icons here now we can go into our
project app asset fav icons and paste
them in there so it gives you all the
icons but it also gives you this
manifest JSON which is you know what you
actually want to install your stuff ya
fav icon no icons yeah I think it's
right it'll tell us if it's not ok but I
want to show you some things that don't
work so it gives you a name we want to
call this PW a beers but it doesn't give
you a short name which is one of the
things that's required so call that
beers because on some screens it just
doesn't register it render that big
there's also a background of color it
has that in there and you need to start
URL so they don't have that by default
start URL is a
HTML I think that so we need so now we
should be able to go back to our browser
and it'll prompt us to install but it
doesn't well that's because you got to
turn on some flags to do it so enable
head to shelf as one of them actually
they rename that one so it's now app
banners so enable that and then the
other one is bypass user engagement
checks doesn't sound like something you
should enable right so the last time
Josh and I did this talk it was great
because we're on hangouts or on virtual
jug and and I do this step and then I go
relaunch now and since my virtual jug
and it's all in hangouts and chrome like
it killed the whole thing luckily we had
been we had it hooked up to his laptop
and I was demoing on mine for the sound
and so we could hear everyone on the
other side going what did you guys just
do we lost you oops
so now refresh that guy should be able
to go into application no way that
didn't work we'll try a new one if all
those fails always you incognito
especially when you're I did a lot of
security work and it's important for
that so you can't do in the ink on me no
don't mine probably good for progressive
web app so if we look at our manifest
now you can see that something's wrong
with it
so the site can I be installed the page
there's no manifest link URL so that's
why I have a shortcut for this one maybe
I was there well that's the CF manifest
so close that one looks closer
so what was missing let's see oh you
know what it's uh it's because in this
index we didn't copy that
so where's my real oh I killed
everything real Save icon generator so
it gives you all that HTML that you're
supposed to put in your head and I
ignored that because I downloaded
everything and and didn't do that we
don't have to actually select anything
we can just but we still want to do this
fave icons slash assets or no assets
slash
fave icons and then we're gonna need
that HTML
they said the Wi-Fi was great this
morning yeah you guys all around the NPM
told you not to do it now so you put
this in your head section of your page
and you can see this is what it was
missing right
the path to assets favor icons
manifest.json so when it says it doesn't
have a link to it that's when it means
and now refresh mm-hmm say Chrome's mad
at me I haven't experienced this one
before hey man yeah in the 13th century
some people in Norway would baptize
their children with beer the true okay
so now you see that add this site to
your shelf at any time but you can see
it's not always that intuitive to get
this stuff working but once you do you
can click that and then you actually end
up with nice under your chrome apps so
depending on your device this might
actually end up on your home screen on
an Android device it looks just like a
regular app and it opens up without the
chrome you know around it and everything
like that so there's some other ones I
have in here from the Weather Channel
for postman for hacker news so it was
just a you know some examples and the
last thing we need to do is so if we
were to run my house it would tell us
that we were actually missing a manifest
in here so there's not one for 512 which
they recommend you have so oh no there
is last time I did this there wasn't so
there's one this time and and then you
need a no script alright so in here you
can say no script big h1 you must enable
JavaScript to view this page
the blink tag still works you got a
backwards compatible web component those
we get that it looks like it's not
unknown web do you point oh man I wonder
if we bring blink back well now we can
we can run our test again we were like a
45 last time let's see if we do better
amen in 1956 the u.s. exploded atomic
bombs and here a few beers to see if
they are safe to drink they are indeed
[Laughter]
so usually what happens around this
point is it gets up to about and not an
80 and and then if you want to get it to
hotter did you have to deploy so we do
have some scripts to deploy so I'll run
those and hopefully those will work and
then I'll move on to the next demo did
they work last night we've never done
live oh yes true but I can show you I
mean I will know so Colin reactive
everything saved so we have it under
this cloud native PW raised I put it
under this one it's just manifest and
then build that's all I think we need so
we got a 64 right mostly due to HTTP so
look count lines of code 2.6 million
we've got some bourne shell and there
are some yeah more CoffeeScript even
some Lisp yeah never heard of this one
yeah that's all in node modules right so
well let me show you just how did it
play real quick I won't actually do it
but you can do ng build then you do -
IOT and - prod like that and so that's
going to build a
project in the disk directories and then
you see the into dist
and you basically do touch static file
for Cloud Foundry and that's all you
don't need anything in that file if you
want to push state enabled so it's using
html5 history push date you can pipe it
into that file and that's what our
deployment script does so let me try
that so a CD in the Colin but you wanted
reactive right this is this is the first
test here Oh God oh I didn't know oh
dear
I didn't paste them in there get them
from here build and manifest Josh wrote
him so if it doesn't work it's his fault
okay build nope
I need that we need the applicate that
one and reactive and so I'll show you
the script because it's not fun that
would just watch it fail over and over
and over and showing you anything
so we copied that application cloud
properties to the edge service and the
beer catalog service and that has
information about Eureka and then it
goes through and builds all the projects
and then it basically goes and deploys
it and see how it goes into the client
here replaces that 8081
with PWA edge which is that edge service
on the back end and then as long as that
files in the right spot it should work
and then it does this dist static file
and then it does push state enabled so
go ahead and add those and then we'll
run them what was that about maven so so
josh gives us to me a few days ago and
he's like yeah I made this Colin stuff
worked great right it's using Bongo and
everything and I try to start it up and
it doesn't work at all well because he's
got this kick-ass laptop he's got Mongo
running at all times and just happens to
work when every you know creates a new
app they use this Mongo so I went ahead
and added a couple dependencies that
allow you to embedded Mongo so that's in
this project now so you won't fail like
I did but I'm not sure
we should probably start the regular one
or fine Mungo I didn't work anyway see
it's failing well I wanted to do a demo
it doesn't actually work with with the
reactive stuff anyway so my company does
does authentication I just want to show
you how to do like open ID connect with
angular and how you do that with the
spring boot in the backend so I'm going
to close this one and close that one
I gotta stop everything kill all Java
usually that works what an exit that one
and so I'm gonna the the basic ones we
just found out it doesn't work with the
reactive stuff but actually spring
security 5 does support the reactive
stuff so I don't think it'll be too hard
for us to get our stuff working with it
but that's why we have this Kotlin basic
in there as well and to be fair spring
security 5 and the reactive support is
even released yet so right rc1 yeah like
supposed to be released like Monday
though I'm keeping track of that yeah
that was the supposed to be date so
Colin basic and then we'll start up the
eureka service first then we'll go into
the beer catalog service
and then I'll just use IntelliJ for this
last one did you you had do you mean you
talked about well I mentioned this is
the had this one before but did you know
that table beer of 1.5 percent alcohol
who has served in Belgian schools until
the late 1980s I think you mentioned I
didn't have the alcohol cock yeah right
so low that why not yeah Yolo Yolo so I
should start the client to make sure
y'all see that this stuff works and this
if it's not checked in it will be but we
did check in this Colin basic stuff I'm
sure that's working the reactive stuff
for Korres we just fixed so if you try
that out might not be quite working can
be easy to get here commands confused
okay open dev at that one this one
so many it's like Microsoft all over
okay so in this one this is I mean it's
interesting look at because it's the
basic way of doing it right you might be
more familiar with this and the reactive
way but basically this is still using
Colin we have a fain client and it does
the reach for the beer catalog service
and then here's the risk controller
adapter that has that fall back using
hysterics and it filters out Coors Light
PVR by the ways and Heineken just
something that we had in there so to add
our support for octa it's just octa
maven boo oh and seeing that just
reminded me so that the first time we
did work with the vowel for the ID in
the name right right that was awesome he
asked about yep yeah he'll now you can
use that from now on right oh yeah so
basically to wire up a spring boot app
to use octaves authentication service
you just basically use OAuth properties
issue or client ID and secret which I
did from creating an app on octa you
could also create a key cloak app and
this would work the difference would be
instead of using like octa properties
and our starter you can actually just
use OAuth from spring security and their
properties are spring secure I think
it's security the oauth2 security oauth2
and then similar so if you're familiar
with a hipster a hipster actually
doesn't use anything from octo or key
clock all it uses a spring security and
it's a while support and it has Open ID
Connect support as of like two releases
ago so once you have this in there then
you can start the application and we're
basically locked down so we can't talk
to it tell J's like yeah you're locked
fine
hey man yeah
did you know that beer cans in Japan
have Braille on them so blind people
don't have don't confuse alcoholic
drinks or soft drinks mm-hmm Oh cuz they
have all those vending machines I yeah
you can buy everything in vending
machines that you can get beer out of
vending machines all right so 64 there
for 200 that's not gonna work anymore if
we got a little close to 80 81 good
beers full authentication is required
right we can't communicate with that
anymore so to make it work in our client
open cloud native PW is common basic
client open new window and so we'll
install what's what's a new SDK that we
just came out with so there's a number
of ones that I want to make you aware of
this one if you're doing an angular it's
probably one of the best ones a lot - oh
I DC and I've done several example apps
with this it works great it's sort of
this guy manfred steyr and it's open ID
certified but basically you can install
it in your project you have to configure
the OAuth module for route and then you
just have to set a few properties and
it'll basically redirect to your
provider and come back with an iru token
so that works pretty nice and I'd
recommend that but we also have octa
angular which is on 0:08
so you can tell it's a it's pretty new
and I've only found a couple bugs in it
so far so yarn a dr. angular always the
hardest part look at that was beta 12 so
once that's and then you can go into
your app module
and you can basically do configuration
so how to configure is a shortcut that I
have and it basically sets up the issue
where the redirect you are and the
client ID one of the things that we've
done in some of our examples is we
actually pull in that issuer and
everything from Spring Boot since it
does have that information already
there's no reason to copy them in both
places so we just have those an
unprotected endpoint on the server and
then this 4200 plus a callback goes to
this that we provide as a component soon
as you import it well it might not be
aware yet but we'll go down here and do
router module for route so this is just
standard routing with with angular app
routes
oh it's updating the indices it's the
only reason that I don't like IntelliJ
it doesn't really affect you home that
much right cuz you're just like I'll go
get another cup of coffee here or the
restroom button demos it updates those
indices and man you're just like stuck
at least if you have life templates if
only we had some sort of thing we could
do it wait hey Matt yeah did you know
that Carlsberg was special brew beer was
created for Winston Churchill in 1950 on
the behest of the Danish government
those berries in there a couple of times
right yeah lots of places are there's a
number of German and Scandinavian
tidbits in this list so import all those
and now it should be good to go
but we still need what's called an
Arctic authentication interceptor so in
in in angular 5 and actually angular 4.3
bans the ability to do interceptors very
easily on HTTP client so we're just
going to call this one Hoth earth
interceptor and what this allows us to
do is it allows us to add a bearer token
so if you're familiar with
and how that works you'll get an ID
token or an access token that's called
on the client and then you'll send that
to the server and you'll do it in the
header so this is how you do that with
with angular 4.3 and implements HTTP
interceptor and what I found is the
reason I have this request URL index of
localhost is because if I send a bearer
token to giffy that it fails it's like
hey you're trying to authenticate I
don't know what you mean so this is just
how you do it you basically set it on
the request and we get it from the
octave access token and then we need a
couple buttons so in here we can
basically say so this was the number one
thing that you need when you do anything
with routing and angular if you don't
have that router outlet you're just
going to sit there and stare at your
screen and wonder why nothing's
happening because nothing will actually
go into that and you won't get any
errors but basically this this button
will allow you to login this button will
allow you to log out and then if they're
authenticated will show them the beer
list and so we do need to add that as a
constructor
now that that one every our so and
that'll be available those things should
go away as long as I named it correctly
yep
would maybe never had a run and in part
of the reason I don't like to add this
until the end is because if you add
authentication then you test for
progressive whether actually just in
login screen over and over right and so
that's not really that good of a test
and I don't know if we gave up on
deploying right well the reactive one
right the main ones are they deployed
right so now you can see you log in
button there and you'll notice that in
this app component I had Matt raised
button right that's one of the material
design things but the reason that
doesn't work is because I never imported
it so Matt button module and down here
so if you see that with material it's
just because you haven't actually
imported it properly takes a little bit
to compile now it looks more like a
material design button so you click on
that I'll redirect octa I don't know my
password I know that one's wrong which
is a good security TURN RIGHT logs man
comes back to the app Oh missing the
access control darn it
so this is interesting and I did want to
show this so you see we have cross
origin on the good beer service here in
our spring boot app right and once you
add most types of authentication or any
security stuff it doesn't work anymore
and so what you have to do is you have
to add a cours filter as well it looks
like in Kotlin and as long as you don't
name a course filter to work and if
you're doing a spring boot 15.8 or below
you
actually delete this part and then it
works so this is a 2.0 and above you
import everything and restart that so
corazon is going to be an issue even if
you're doing security or not especially
when you have things running on
different ports and the proxying doesn't
work if you actually bundle everything
together in the end
it's not available yet
it's gonna be a 401 now Danya that's
like you failed Matt nice try and
doesn't really tell me anything back
here so let me check my properties
before I give up mm-hm
head service that looks fine yeah we got
that guy and we're doing 2.0 so uh-hmm
Oh we'll try it oh it's there it's just
not the login works
14 minutes then I got like five minutes
left so mm-hmm console he needs a hug
can't resolve all probably sharply
started we understood the wrong one
like it's got simple course there's a
good oh it's active one isn't that like
it can't be in this can that can you see
that what kind of beam is that what kind
of they it's a coarse filter which
package is that of course you think it's
wrong one you put let's enable version
control and you compare it to your
working branch
mm-maybe that is working right the try
and it'll move on but I did want to let
you know that if you go to and we have
we don't have links for these but
basically everything that Josh and I
have done today I've plagiarized but
he's done I've written him up his blog
post so if you went to the octa blog
developer blog and you search for micro
services you wait there's a build of
micro services architecture for micro
brews with spring boot and so that one
doesn't have anything to do with with
authentication or anything it just shows
you how to build basically with Josh
built but with the older stuff right not
with Colin or not the newer stuff and
then if you do beautiful
that's just spring boot and angular and
then if you do progressive web apps
there's an ultimate guide and then
there's also build your first
progressive web apps which is just
basically the demo that we did today
so try it one more time okay it's
logging in but it doesn't like good
beers for 100 work yesterday it works on
the branch too so in our cloud native
pwace and that Colin basic there's an
octa branch and pretty sure everything
works there so it's not it's not that
easy but it's not that hard you do
struggle with your browser a bit and I
think it depends on which browser you're
using you know in Safari it's not going
to work very well but in chrome it will
and I invite you to check out Jake
hipster to hipsters a project that
actually brings spring boot in and it
has angular on the front end we'll be
talking a bit about that on Thursday
when deeper the cooling of J hipster and
I do a react versus angular smackdown
there was also Americas services talked
on yesterday but it's a yeoman generator
generates the project and after that
it's just regular typescript in you know
Java code I wrote a book I have a couple
copies up here if anyone wants it you
can also download it for free for
enfoque you
so I kind of wish I didn't make it free
because I think it's more popular when
they aren't free but it is free and I
wrote a real world app for called 21
points and how 21 points works as I
found that spring boot does a great job
of monitoring its own health right it
tells you when things are down via
actuator and so I wanted to do something
similar for myself so I'd I'd went on
this 21-day sugar detox where my wife
basically talked me into it and and her
friend let her know about it only a few
days before and so that Monday when we
started it we found out that you know
there's no alcohol allowed because it's
got sugar in it so that was like a rough
start so three weeks
no booze you know no sugar and we
weren't even eating dairy or cheese or
milk or anything like that so in other
words it was great for my health right
three weeks later I had low blood
pressure you know I felt great I had
lost like 15 pounds and and so I
realized for me at least that you know
not eating sugar is a big deal and so I
want to optimize my health I'm getting
older and I was like I should start
exercising more and I should stop
drinking as much and so what I made 21
points is it into is this an app where
you can get three points a day so you
can get 21 points in a week and you get
a point if you if you drink responsibly
so for me that's like two glasses of
wine or less you get a point if you
exercise so maybe an hour walk or half
hour jog or something like that and you
get a point if you eat no sugar at least
for me it may be different for other
people that have you know different food
symptoms or whatever so I use it to
track my health in it and I keep notes
in it and the cool thing is I've been
doing it now for about three years and I
can go back and look on any day like
what I did because I made a notes column
that's like 140 characters right you
can't write too much but it's funny
because I can't really take screenshots
and show it to people either because
it's like boy that was a real bender on
Friday night you know but otherwise it's
it's been a fun app to develop the
latest version is out there you can use
it I don't know if registration is fixed
it was broken last week but you can also
download it from github and run it
yourself and it's it's the example app
for the book so it's a production app
and it's a sample app and you can follow
on J hipster book on Twitter if you want
but like I said there's all these blog
posts if you download this presentation
I'll put it up on
speaker deck at the end I'm sure DevOps
will have a copy as well all those links
are clickable or you could just copy and
paste them type them into Google and
you'll end up or you want to be so we
got nine minutes left
yeah time for questions yep
thank you by the way right you guys sat
here the whole time that's awesome</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>