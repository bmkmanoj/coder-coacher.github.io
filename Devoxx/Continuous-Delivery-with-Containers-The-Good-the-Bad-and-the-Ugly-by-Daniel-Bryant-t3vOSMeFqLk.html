<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Continuous Delivery with Containers: The Good, the Bad, and the Ugly by Daniel Bryant | Coder Coacher - Coaching Coders</title><meta content="Continuous Delivery with Containers: The Good, the Bad, and the Ugly by Daniel Bryant - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Continuous Delivery with Containers: The Good, the Bad, and the Ugly by Daniel Bryant</b></h2><h5 class="post__date">2017-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/t3vOSMeFqLk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello can everyone hear me it sounds
pretty good I think
welcome is everyone having a good devoxx
so far it's been Skippy back I haven't
been here for a couple of years now did
devoxx us this year Devil's London my
kind of hometown it's awesome to be back
so you're welcome the title hopefully
speaks for itself
continuous delivery with containers the
good the bad and the ugly this is what
we're going to be looking at in the next
50 or so minutes to kind of set the
scene the expectation around containers
is pretty big yeah I love some docker
love some kubernetes but the expectation
is pretty big the idea being you kind of
package up your app you put it in these
nice shiny containers and you ship it
and we're good to go
yeah the reality that many of us are
dealing with is our apps are a little
bit of a tire fire yeah
we've all got kind of problem apps yeah
and trying to carve them up and chuck
them in containers can be quite
challenging it actually leads to tire
fire in a container yeah quite often and
you'll see these people here the
firefighters this is what we commonly
refer to as DevOps in the industry yeah
so I make my money as a consultant but
all jokes aside I believe that
continuous delivery is a strong way to
codify and kind of enforce for want of a
better word certain properties within
our our process of developing software
we create a build pipeline where you
know put functional requirements in we
put non-functional requirements in and
we avoid the tire fire or migrate away
from the tire fire and continuous
delivery is the catalyst the fact we're
using Java in containers is almost
implementation details but obviously
we're all here because we love the JVM
nav Java and we love containers as well
so we're going to be talking about that
saying the same continuous delivery is a
large topic I've recently started
writing a book on it I've got a small
mini book out already but a bigger books
coming along and I'm loving the writing
the book kind of stuff it's allowing me
to put my thoughts together but it's
made me realise that continuous delivery
is a big big topic I'm not going to be
focusing on things like value stream
today these things in my mind are super
super important always understand the
why of what you are doing and value
stream mapping the understanding
business flow is super critical to
you getting the most out of developing
software but we're not going to talk
about that today due to time I'm not
going to talk about much about paths and
serverless like why foundry I think
super interesting and a chris is doing a
talk directly after me about our lambda
it's a great talk I've seen already so
stay in here for that talk if you want
to learn more about service I think
they're super interesting but this talk
assumes you're all in on containers
something like docker something like
rocket something like kubernetes
something like a CCS or make sauce
whatever I'm not going to live code cuz
to be honest I'm rubbish I leave it to
the experts like Josh along Josh can
like type faster than I can like type in
general when he's on stage he's amazing
at these things I'm going to cover more
the high level kind of stuff today and
the mini book goes into more detail I'm
doing a book signing like directly after
this so you can get a free copy of the
book there after it's if you follow me
down to the O'Reilly booth outside of
the EM the main area at just after this
talk so that what I would like you I
can't try to prime you I'd like to do
this at the beginning of talks what
would I like you to take away from this
talk as my kind of three level three M
high-level bullet points and one is that
the container image now becomes the
single artifact in a bill pipeline no
longer is it the jar the war the ear
we're putting those in a container yeah
we're putting our app server maybe in a
container that is becoming the single
thing that flows down the pipeline we
put it in early we test it all the way
down through that container image adding
metadata is super super important
metadata is useful for many things but
in particular for things like provenance
governance and the software supply chain
and we'll only just find see some of the
ramifications of this now with things
like the Equifax breach yeah we need to
get I think we as an industry needs to
get better at metadata annotating our
software you know it helps us understand
what we're deploying into production and
what's there and kind of gives us more
control over the software supply chain
and helps avoid issues if we can like
Equifax we must also validate container
constraints on system quality attributes
or non-functional requirements as people
often call them containers do alter the
way the JVM behaves and the way M kind
of our apps behave
so does cloud I did a talk at JavaOne
about five years ago when I talked about
cloud and a lot of the things I talked
about in that talk are very similar and
I'm gonna talk about today in containers
we as developers need to know kind of
one level up on one level down at least
the kind of core details and well I mean
one level down we need to understand the
fabrics we are deploying our
applications on yeah
I'm mainly gonna be talking java today
my expertise is mainly in Java do a bit
ago these days but a Java Script I've
been doing that the time actually I
works an independent consultant over in
London also working the u.s. bit around
Europe as well I'm doing a consulting
CTO gig for a company that's
specializing in micro service testing
frameworks so if any of you've heard
hoverfly Spector Labs produced hoverfly
I'm CTO or consulting CTO there so I can
talk more about hoverfly and after the
talk or so but primarily I'm really
getting into continuous delivery over
the last sort of em three years and I'm
realizing a continuous delivery can be a
catalyst to drive change in technology
and in the teams and in the organization
stuff so you can check out a bunch of my
other talks online and I talked about
the sort of more softer skills as well
sometimes today it's more focused on on
the tech I do love getting involved in
Twitter's app Daniel Bryant UK you've
got 280 characters now to spam me that
kind of stuff pretties pretty obvious
but I am NOT a wrestler yeah definitely
not a wrestler
that's Daniel Bryan not Daniel Bryant
yeah and I started getting tweets
recently like people are thinking that
own the wrestler and that's a bit weird
yeah but some of the stuff they say is
even weirder
yeah people tweet weird stuff to
celebrities I am NOT a celebrity but
pleasing please tweet at Daniel Bryan UK
yeah that's my handle one I'm not a
wrestler maybe a future career or
something but what you're here for today
is continuous delivery it's not me
talking about Restless it's everyone
pretty comfortable with continuous
delivery as a topic yeah everyone pretty
happy with sort of continuous delivery
focusing on fast feedback and short
cycles of delivery at optimizing for
that feedback optimizing for that
learning people read J's in Dave's book
for example awesome book if you haven't
at Saudi recommend we're talking a lot
about continuous delivery of late but
many people I bump into in my consulting
journeys haven't necessarily read the
book and understood the foundations and
it becomes a bit of a telephone game
there
some people think continuous delivery is
different maybe they think it's
continuous deployment every code that we
do is a debate we do as developers must
go into production straightaway that's
not what continuous delivery is about
it's about proving that every change we
make is not going to break stuff and
it's gonna add value speed and stability
is key to continuous delivery we as
developers and I'm assuming most of us
in the room are developers or QA or ops
or those kind of engineering disciplines
and if we can meet the speed and the
stability requirements of our business
job done that is continuous delivery
yeah hopefully not controversial to the
DevOps audience creation of a bill
pipeline is mandatory for continuous
delivery this should be pretty good in
this awesome size screen this is kind of
a standard Java pipeline that I've been
working on over there many years
hopefully you recognize it walk through
you know you're coding on your local
machine you hopefully do three amigos
sit down developers QA business people
come up with requirements hopefully come
up with some system quality attributes
this is the scalability we need this is
a security we need for example we code
away we push up to github bitbucket that
kind of thing we do some CI we do maybe
jenkins called Travis take your pick and
what you want to use we then maybe do
some code quality analysis like sonar
cube find bugs checks tile PMD that kind
of stuff and then we push it into an
artifact repo J frog our factory Nexus
setup Nexus and then we push it into QA
and we start doing testing yeah testing
gets more realistic as we work through
the pipeline staging you're probably
using safes and boxes of third parties
rather than mocks perhaps in QA and when
you get through to production it's the
real deal yeah
now this all can be automated we're
talking about this more as we go on but
what are people often forget with this
continuous delivery pipeline is you need
to close the loop yeah we need to get
that feedback going and we need to
automate that as well so things that
automated canarian log analysis and
metric analysis that kind of stuff all
good thing bottom line we need to get
our feedback to prove our initial
hypothesis when the business gives you a
kind of right no requirement they're
proving out there or they want us to
prove I paw Phasis yeah well as a team I
should say we want to prove hypothesis
does this improve conversion does this
new tweak
get us more money that kind of thing we
also need to get that feedback going on
for the architecture in the ops as well
I'm assuming many people in this room
are looking at micro services I won't
send the m-word too much here here but
Mike services it's all about the kind of
feedback and so forth definitely from a
business angle but also from an
operation of an architectural point of
view I've seen some people do micro
service migrations and then the micro
services themselves have become mini
monoliths yeah
so you need some kind of analysis some
kind of complexity analysis on your
micro services as it's going along to
make sure they're not getting bigger and
bigger and out of control for example so
that's the kind of hope the
uncontroversial up to that point the
kind of scenes set of what continuous
delivery is particular jvm space
containers
you know I'm pursuing most people are
familiar with docker people familiar
with akka Oh awesome it's like a Mexican
wave brilliant aspirant so it's worth
bearing in mind yet that we I'm again
I'm assuming most of the DevOps audience
like myself is primarily in the jvm
space it's Turtles all the way down for
us as Java developers JVM developers
with the JVM itself is a virtual machine
we're now deploying into operating
system virtualization which is
containers yeah and we're typically
running on Zen or KVM in the cloud so
there's multiple levels of
virtualization and we've got to respect
that as developers it does alter the
properties of the fabric we're deploying
on two primary technologies Linux
technologies and based in containers
I'll mention them a few times so just on
a prime so we're all on the same page
things like control groups see groups
give you resource control at a Linux
process level main spaces give you sort
of name spacing of the network stack of
the process stack that kind of thing and
a route FS is a different file system
different route then is actually on your
machine so if you trash the route of s
of a container you're not trashing your
root filesystem docker have done a
fantastic job
I'll you'll hear me probably conflate
accidentally docker and containers along
along the way of this talk but because
docker are kind of the face of them or
face or containers at the moment they've
done a fantastic job with the marketing
fantastic job with the developer
experience they're doing fantastic work
in the enterprise now so doc has made
the kind of container thing popular I
sort of was using containers a little
bit for docker and and pre 1o love
docker stuff also played around with
rocket with LX
from canonical and increasingly looking
at windows containers these days which
is super interesting as well but this is
what containers are this is kind of how
they change the pipeline in my mind this
is just a model again every model wrong
every model is wrong sorry some are
useful I think it changes from this to
this
yeah so from kind of this pipeline to
this pipeline and it's fundamentally not
massively different number one there on
the left changes kind of how we develop
locally a little bit number two is how
we package our artifacts our jars our
Wars and number three is kind of how we
now do testing both functional and
non-functional and four is how we
actually deploy our containers
fundamentally now I think most of us are
agreed that when we're deploying
containers we need something like
kubernetes something like Amazon ECS
something like Mesa sauce something to
schedule and orchestrate the containers
for us and this is kind of partly out of
complexity often more moving parts but
it also gives us a lot of advantages
because we as humans can't work as fast
or as efficiently as machines in terms
of scheduling this is why I believe
kubernetes is and frameworks like it
platforms like you are really
advantageous to run containers you can
get away with running containers on them
on like say Amazon boxes with them
systemd but after a few containers you
don't want to be doing that you want to
be using some kind of and deployment
fabric or platform minimal aside
micro-services do multiply the
challenges yes so here example we've got
three pipelines going on and one pattern
is to fan in so we've got about three
micro services we fan we gate on that
and we release that as version one the
second pattern which is kind of the you
know well accepted pattern is that we're
deploying micro services independently
this is kind of separate from container
stuff but just bear in mind if you're
doing this kind of pattern you need to
ensure the contracts are met between the
micro services you're pushing
independently if it hasn't been
mentioned this conference already I
haven't been to all the talks today but
things like packed super interested a
super interesting from a kind of rest
point of view of asserting in an
automated way in your build pipeline
whether you're breaking contracts rest
contracts pact a sprinkler contract Ram
all that kind of stuff you're in the
messaging space a calf gar doing or
confluent who are the stewards of Kafka
are doing super interests
work around using something called Avro
to define message formats because
message formats message payloads are
your schema effectively your contract
between two services they're exchanging
messages if they're using Kafka you can
use this open source schema registry
from confluent so just think about these
things slight aside from the container
stuff you if you are looking to deploy
micro services in containers
independently think about the the way
they work together and things like
packed things like am confluent open
schema registry are super interesting to
assert contract validations in the bill
pipeline it can all be automated through
maven that kind of stuff great stuff
let's now step through our pipeline and
look at the four key points of what I've
mentioned so we'll start in development
yeah and hopefully not a controversial
and statement but you need to make your
local development environment as much
like production as possible yeah and
obviously you're not going to be running
Amazon on your laptop but you need to
make it as close to production as
possible yeah and for me ideal offspring
boot work at the moment as well and so I
often don't really change much the way I
work locally I'll develop in just you
know spring boots got an awesome
workflow dev tools but plugins brilliant
on maven that's my stuff a code away and
then I'll put that spring boot artifact
the fat jar typically and I'll put that
in a container and run happy path tests
locally before pushing my code up to
github yeah I like to get that kind of
testing I like to get the feel for how
things are gonna work in a container
locally definitely perform this the
happy path test is my strong
recommendation install docker it's super
easy or another container technology on
your laptop run the happy path test
because if you start pushing stuff up
and that is totally a valid patent but
there's more of a past like pattern
things like quiet foundry allow you to
do CF push where you're developing
locally and CF push pushes it runs
through a pipeline and gets deployed
that's more of a prop up as like
experience and that's great I'm loving
the past stuff but in containers it's a
bit more raw you need to be running
containers locally to kind of get a feel
for them one thing I see quite a bit is
I'd highly recommend using identical
base images from production so I've seen
some developers say coding on Ubuntu
locally like packaging docker containers
with Ubuntu in them because there
the boys Ubuntu and I like up into yeah
but they're running say CentOS in
production and send us an Ubuntu you
have different kind of dynamics around
security and a bunch of other things so
what you get working locally and then
they repackage into CentOS later on they
starts behaving differently yeah so do
check these things out basically the
docker file which is effectively your
manifest of what is going in the
container is the content is super
important
yeah and again probably a biased
audience with the fact you're at devoxx
you're kind of a self-selecting audience
you're keen to learn you're probably
reading your blocks you probably ahead
of the curve compared to say 95% of
developers out there but docker files
this kind of stuff is super important in
terms of being operationally aware I
work with many large enterprises where
people are not operationally aware
they're not comfortable with a
command-line they're not comfortable
with um you know looking at processes
and using them to hack around the stuff
toady I'm sorry cool with that but I
have to we have to be empathize with
them so we need to say in a bit of
education piece when you're now
deploying something in a container it's
not just the jar it's not just the war
we're bringing in an OS or bringing in
config we're bringing in build artifacts
and we're exposing ports and all this
stuff from a security point of view you
know it's a bigger attack surface now
yeah and we we didn't really think about
these things I'll talk about security
more later even I've had a few companies
trip over whether they use the JDK
versus the JRE in in production while
I'm always like JRE obviously the GRE is
a smaller attack surface smaller runtime
and you don't need the JDK when you're
running stuff in production but these
kind of things if you're not
operationally aware you've never perhaps
thought about this stuff
do you use Oracle open or open JDK and
obviously the two are blending now
that's pretty not an issue going forward
there's a whole bunch of questions but
what I like to kind of wrap up and say
in this space is please talk to your sis
at minting yeah even developers need
heroes as they say yeah and I'm not an
operator no sir I'm very firmly in
developer camp bit about skills but this
kind of stuff is super super valuable
one of the biggest things I biggest
impacts I often make on projects if I
get there early enough and is to get
InfoSec involved early to get the ops
team involved early otherwise when like
my team and I we arrive late in a
project and people are building
containers and shipping their Java apps
and info ii ops have got no idea what's
going on as an individual like
politically they get a bit
and it like I haven't been consulted but
even from a technical point of view they
get offended and quite rightly so
because they've got no idea how the run
time is going to be changing so guess
this admins get the ops folks in its
early to the process as you can if
you're looking at microcircuit at
containers I see some people pitching
around having different test and
production containers some a test
container is maybe Ubuntu full-fat maybe
I've got some test tools in there maybe
what some databases and they're
pre-canned data I think it's easy to see
drift between these test containers and
the kind of production containers yeah
so there's a couple of interesting
patterns one is the test sidecar pattern
anyone who's familiar with things like
sto and kubernetes you're familiar with
the sidecar concept but sidecars are
effectively something at six next to
your main container so you build your
container like it's going to be in
production you know JRE super
stripped-down
fat jar running in there and you build a
sidecar container with all your dev and
test tools and everything you want and
you can link them together in your
chosen platform docker linking or cuba
Nettie's pods or whatever you want yeah
and use that there is a couple of
imaging proposals on tests as an
interesting one by alexey the nisshin
blog post there talks about some
patterns around how to test things in
the container
I had to build and test in the container
which i think is super interesting this
is perhaps less relevant now since the
announcement earlier in the year at
docker con not sure what O'Connor was
but I think was the European one of
these multistage bill so people sort of
been exposed to the multistage builds
now it's super cool if you haven't
you'll notice there's actually like two
from statements here and this is a
golang example but your this is a kind
of build container effectively and this
is the runtime but we're defining it all
in one docker file and that for me is
less chance of those things drifting I
do my building and my testing here and
then I do a packaging here yeah and
again insanely this is go but it could
equally be Java we could be building in
Oracle Oracle container Oracle Java
container and we could be shipping in
Alpine for example and this kind of
ticks the box for me as in because we're
going to push this version of the
container all the way through the
pipeline this is a transient container
effectively
so it kind of doesn't violate my single
kind of binary thing I think this is
really useful pattern and check it out I
do this talk on many different languages
to be honest but this is a Java specific
course Java focused one people often ask
me in the talk is there such thing as an
Oracle Java container the answer is yes
Oracle from thinking since the last Java
one a year and a bit ago and they've
released kind of a whole bunch of
interesting stuff on github so go to
Oracle's github they maintain a whole
bunch of yeah Oracle Java on docker for
example I don't know if Java 9 is there
yet I checked a couple of weeks ago and
it wasn't but check this out what is
super cool in the Java 9 space is this
now at the support to alpine so many of
us had a hard time running and the JDK
in Alpine and Alpine is a nice OS
because it's a really stripped-down OS
much more lower attack surface lower
resource footprint than say something
like Ubuntu or Debian Jesse so we like
using Alpine as our route as our base
container image and but it usually a
pain to get Java working with that
sometimes that is no longer an issue it
is early access heads-up but kudos to
the Oracle folk for and putting this
together you can now get a Java 9 Alpine
kind of very small OS very small
container which is nice there so and
Santa and Paul's book is awesome but
we're gonna hear lots that modules in
this conference
I haven't played around with it enough
yet but this for me kind of go it blends
nicely with the the idea of containers
the idea of unit kernels this kind of
thing single responsibility tightly
packed containers low footprint low
security attack surface and Jane link is
very interesting for creating very
minimal conserve runtimes of Java you
can define your module modules and your
modules of your and stuff you're pulling
in and you can basically ship it as a
kind of binary which is really
attractive rather than shipping say a
container with a JRE and you know some
config and some other stuff going on
your and your fat jar for example the
benefits are reduced footprint
performance and security this is good
stuff yeah so this is again pretty a new
emerging but I strongly recommend you
check out Sandown Paul's book it's a
really good read ants on Safari I've got
it through there and this stuff I think
is gonna we're going to see more and
more the kind of the combination of
modular programming microservices the
way we build containers and unit
and Java itself now is embracing
modularity so I think this is really
cool
moving on point two in the pipeline this
is the kind of creating our image I'm
not going to talk a lot about this is
it's quite techie and quite boring to
some degrees my report goes into the
details there's a github codebase you
can clone locally and play around with
this stuff I use the cloud beast docker
build and publish plug-in it's open
source super useful and so yeah if
you're interested in actually how you
build images check out the mini book and
grab a copy at the end of the talk it is
essentially now you need to build your
ass packs put it in a container and and
push it into a registry I use docker hub
quite a bit to be honest and so I store
like images for example the images in in
the book I talked about are stored on my
docker hub account but there's many
other kind of registries we'll talk a
bit more about that in a second a Korres
Quay even things like J frog artifact
tree and sounds like Nexus support
containers a long tie alongside typical
Java packaging formats now as well which
is super cool I'll mention them a bit
more later
one thing that is moving more into the
metadata so it consider we've kind of
built our container metadata super super
important a bit of a red flag up front
be aware of the latest tag in docker
yeah it's a bit of a misnomer latest
simply means the last build tag that ran
without a or last build story that ran
without a specific tag over scene
I've seen people new docker getting
tripped over this they're tagging things
with a version someone else is not
tagging and then pushing kind of up the
registry and overwriting these things
and what you're deploying into
production as latest is actually not
what you're thinking it is so I'm not
going to do justice as much as this blog
post can check it out if you want the
details of why you should not use latest
I highly recommend using semantic
versioning instead and end tag your
stuff like this Daniel run UK test do
you 14.1 that kind of thing metadata in
general and this is not you know sickly
around containers but I think the
containers are drug making it more more
making me more aware of these things but
metadata around the stuff we build as
engineers is really important like and
as we're pushing more stuff more more
fast now we perhaps can't always rely on
semantic versioning instead perhaps we
want a get char of what we're pushing up
we want build metadata like who did the
build in
the vendor involved these kind of things
and we probably want to add some way
into that image we're building that
artifact we're building things like have
we done QA control doc were doing some
cool stuff with the ability to sign
images to say hey yes QA have looked at
this it is good to go we've we've
cryptographically signed that image and
we can only deploy into production if
the signature is valid for example we
want to put press security policies on
things like app armor and seconds and
things like that we want to package them
very close to our artifact because the
artifact the container needs to be run
with that second profile too to minimize
the attack surface for example here
there's a bunch of ways we can add
metadata and this is containers it gets
a bit more tricky you can use in docker
you can use docker labels it's well
documented on their website kind of
key-value style stuff you can see down
the bottom here and you can create like
a DNS kind of thing like we do in the
packages in Java and you can add
metadata all good stuff that's it -
micro scaling systems they've got a
really cool make file that kind of
automates a lot of this stuff so it when
you run make make file it builds to a
container looks at the system date looks
at you get char and a bunch of other
stuff and weaves that into your docker
manifest your dock file and then kind of
ships that so that's this is a really
nice way to automate scraping a lot of
relevant data from your your build
whether you're running it locally or in
a CI system a few more inserting things
label schema they're trying to come up
with an idea sort of around and
standardizing the name spacing of labels
and so if you want if you should in that
space I think it's super interesting as
well because docker have for example
reserved a few namespaces in labels that
kind of thing so worth checking out
you can add labels at runtime you do
basically like docker run dusty at the
label or ideas just running a daemon
mode but as you can add the label at
runtime
this doesn't add it to the dock file
because you're adding it to a running
container so first off that new label
you're adding is not going into the
manifest but more importantly soon as
the container is stocked that label goes
away so you need to docker commit to add
the label into the metadata but by doing
that you effectively creating a new
updated version of the container and
that kind of violates my single
container idea there is a talk about
adding the ability to update more
dynamically there's a proposal on github
if
interested you can check out the github
issue on the mobi project now I guess
not docker probably the movie project
and if you want to get more info in the
meantime what a lot of I've been doing
with clients we've kind of we've worked
around this my team and I we kind of got
together a couple of intern proposals
one is Liz and actually works at aqua
aqua doing a lot of really cool stuff
around security and the container space
so if you're really you know running a
high performance or you know highly
valuable containers I should saying in
production definitely check out aqua
I've got an affiliation with them but
they are super cool and this is got with
a prototype to allow us to put metadata
into a docker registry so docker
registry stores the containers as blobs
binary objects but liz has got this a
prototype where you can now store
metadata alongside in the same registry
it is proof of concept but it's super
interesting because you keep the
metadata very close to the container
images there's less chance of stuff
getting lost there's only one thing to
look after super interesting but in the
meantime suppose most time what I do now
is I use things like J for gosh factory
and and Nexus yeah next you can store
your images as well as your your actual
jars and ears and Wars if you want to I
typically generally recommend just
throwing the jars and as devoxx is a
family-friendly audience I will work a
point out the Frog is merely hugging the
whale yeah yeah
Jeb Erik I should told me that one a
while ago I looked at it and I was like
oh yeah that's maybe not pg-13 that one
is it but it's purely hugging the whale
yeah but good bit of branding on on J
Fox part so looking at this sorry
looking at they can sort of the testing
space yeah these are just a few brain
dump ideas around you know testing
containers how I've done it in the past
in the book I've got a super trivialized
service-based and shop like it's super
simple but it's just the ghost couple of
spring blue apps a drop Wizard app just
to give you some sort of stuff to work
with if you were doing stuff real like
testing a real thing you'd obviously
have maybe like a API gateway nginx API
gateway you'd obviously have data stores
in the mix yeah but the book simplifies
it down to share kind of key concepts
and if you would just say testing the
product catalog just testing the single
service I often use things like Jenkins
pipeline as code
I love Jenkins I've been a long time
supporter of Jenkins but Jenkins too I
think is super cool Jenkins pipe latest
code is really interesting you can
basically create arbiter
complex pipelines and you can use groovy
kind of dsl to build these pipelines and
do cool things so one project we we
worked on really well that's part of
year we go now to be fair we were just
spinning up individual containers we're
basically you know building and
packaging our product catalog java java
archive jar file and we're just using a
describe ease plugin we're doing docker
we're saying the image we're running it
you will notice i've not put a version
there shame on me there should be always
a version there my bad but then with
symbols groovy script that's basically
setting a timeout and waiting until the
health end checkpoint returns a certain
kind of m value back so i can grip and
up on the health check again the actual
mechanism here this is just some groovy
syntax to make it work and this is
trivial but you can kind of put anything
you like there you can run say and
gatling to do performance testing you
can run security stuff there you can run
a whole bunch of stuff this is the power
of the kind of pipeline is code and why
i really like a pipeline is code is you
can store everything you do here as code
alongside your application code so
you've got an application code you've
got your docker file you've got your
jenkins file that for me is awesome yeah
i like to capture everything I do in
code yeah because that way it kind of
speaks for itself
it doesn't drift from me I've got a word
document over here saying stuff or
whatever capture as much as we can
encode I've learned that from someone
meant my mentors over the years is much
you can capture keep it close through
the application code it's running and
this stuff is really good for and for
longevity of the service I I feel
integration point of view say we're
doing some load testing maybe at the
front door we've got you know we want to
exercise all the services like maybe
just an area maybe not the whole system
but we want to do an area of the system
for example I often use things like and
docker compose or kubernetes for example
yeah and we've done a bunch stuff for
like Amazon you spin up and Jenkins
nodes and you basically have like a node
is a single kind of workspace and you
use docker compose to spin up and all
your applications and you run something
like Gatling or jmeter on those services
that have been composed with a
description file so this is something
like the code we've done in the past
you'd have like sort of build and then
we're getting you recognize the pattern
with the timeouts just we're spinning up
da composing daemon mode that's firing
up all our services
we're waiting until we get a health
check confirm from the main service and
then again this is a trivial euro
shelling and grep but you can run
security testing you can run Gatling you
know the world is your oyster basically
yeah once you've got this one no spun up
there's a kind of mock production you
can just hammer that node and do
whatever you like with it and feed the
results back into your build pipeline
and fail the build if something goes
wrong what I've been playing I'm a
little AC I've been doing some work with
dead a wire so hat it's dead a wire
these really cool stuff you haven't
heard a telepresence and you're working
with kubernetes don't go in google
telepresence because it enables you to
proxy into kubernetes clusters and you
can develop locally as if you're in the
cluster which is super awesome all
open-source tools really good and this
one is really nice it's called cuba
noughts and it's basically a way to
manage a pool I think it's gke or the
only in the moment Google cloud and you
manage a pool of clusters and you can
basically sort of pull in things when
you're doing tests and then release it
when you've done your tests so you
maintain three or four kubernetes
clusters and gke and then your pipeline
pulls them in and uses them when it's
doing a when you're doing a test run and
use helm to manage dependencies like my
sequel or whatever super cool stuff so
just chucking that one out there it's
got I find this useful testing what we
call non-functional requirements in the
bill pipeline is super super important
now I don't like the term non-functional
requirements because I've seen quite a
few systems that were not functional
due to non-functional requirements yeah
you know we've we've rolled in and
someone's gone oh it's it's gonna be you
know a million users we've only designed
it for 10,000 users or you know oh it's
kind of them we didn't realize it would
be deployed on a internet-facing site we
thought it was a private app that kind
of thing yeah a lot of these things we
need to think about and now we can kind
of test them in the pipeline there's
still a bit of glue needed sometimes but
things like um Gatling and jmeter really
cool fitting for poor performance
why use Gatling a lot because it's a
very simple Scala based DSL
it's really descriptive you can do
testing as well as kind of all the stuff
you can do in jmeter and kind of more
but the cool thing is you can actually
spin it up into flood io flood io is a
commercial service you can pay them some
money and they'll run your Gatling
scripts as is at scale which is really
cool so you write some scripts you run
them on your local machine you run them
in your pipeline and when you want to do
load testing you can actually spin up
like a
Thrun say Amazon or something or India
and you can pay for they owe to hammer
that service the hammer those are
services which is really nice security
testing these days is table stakes yes
security testing is table stakes we as
developers must get more responsible and
looking at myself when I say this as
well otherwise we're going to be
regulated and I think it's inevitable
that we are going to be regulated now
it's gonna take some more disasters
unfortunately but even things like
Equifax but no one lost their life but
there's a lot of bad things happened
around the Equifax fall act we as
developers need to make efforts to
ensure security testing is baked in yeah
from the word go
and things like fine sec bugs is a
version of fine bugs that's focus on
security oh wasps if you haven't heard
of us
go to their website they've got amazing
resources for running automated security
testing things like bdd security it's a
behavior driven design framework very
readable that automates something called
the OWASP z attack proxy and it does
automated penetration testing on your
services doesn't replace penetration
testing as a proper discipline but
there's nice kind of you know basic
stuff you can get in there things like
go on that and serve a spec check if
your and boxes you're deploying onto
your instances are hardened same with
docker bench you know is this kind of
box we're deploying on two configured
correctly for running docker things like
core execute em course claire and doc of
our own version of it as well our
container static scanners container
image static scanners so you can do
static scanning of your code fine bugs
find sec bugs but things like korres
claire scan the container image because
don't forget where the container we're
bringing in our jar we're putting in
ubuntu alpine debian whatever we need to
scan that make sure no heartbleed is
snuck in there as well yeah now it used
to be quite tricky to run claire locally
you can pay core s to run it might
highly recommend that pay docker to run
it highly recommend that to if you
really want to DIY it and wash you
before I mention the do I think one
final thing very interesting gentled
Aaron Greta Fiore
did the talk at dock work on a couple of
years ago and he's written a white paper
for the sea is around and it's container
security goes right from like syscalls
all the way up to principles of least
privilege covers the whole security
stack if you're serious about security
in containers Aaron Greta fury stuff
read the info cue blog post a check out
his video from dr. Cole
I just was gold gold mine of information
I didn't understand all of it but it was
a goldmine of information and it's given
me pointers to know when I'm at my depth
I go and chat to the ops folk and say
hey is this an issue for us that kind of
thing
sorry the core resting allowing you to
statically validate the container
security and it's actually another slice
oh I messed I'm in this presentation
sorry so before that one you need to
verify what you're putting into the
container this new Java app is secure
and people have heard of a wasp
dependency check at all
so Oh excellent ah that's that's great
I'd like more hands next year that's
cool and totally worth doing if you're
in the spring boot well it's actually in
the Java world journalist it's a simple
code ten line maven plugin and what that
does is it phones out to the National
vulnerability there today database and
says hey I've got all these dependencies
with Broin all these you know artifacts
we put in a maven log4j you know Peggy
pick and it says is there any critical
vulnerabilities or exploits in the
versions I've got in this maven file and
it reports back you can run it like I
ran this on a very old oldish spring
boot app in the day this is local build
but it reports back I think I got here
these are all the CVEs found in my very
simple bill it's like you know six
months old and my year old or whatever a
very simple spring boot app not picking
on spring boot every java wraps got
their issues but it made me think some
of these known vulnerabilities are old
and we kind of accept them are the ones
we need to press up there are
dependencies we need to keep an eye on
this stuff in general you get a nice
report out of it as well so you can show
em like say you know the rest of that
your team show your leadership this
stuff is really really important we need
to make sure what we're putting into our
jar is good yeah that's that's them
that's number one kind of thing make
sure the security like of our jar is a
java application is solid then we go on
to the static scanning quality sim from
moving around there but I did and this
version the talk container shared I
think it was a couple of months ago in
London really awesome gent at the end of
the talk Armen came up to me and said
hey love your stuff but have you heard
of like these this other stuff he's been
working on and I hadn't and it was
awesome freaking awesome so he's
basically created a docker image with
all the clear stuff set up inside it so
now it's like a real simple download you
do have to build some
nothing go at the moment which anything
working with go you know it can be a
pain in the ass to get go working
sometimes but and once you've got this
the simple bill working and you can run
it in your CI PI Ben you can run it
locally it's really cool this is an
example of the kind of Y to fiddle
around with the package structures and
go and there was it uses a make file
with go Depp's and stuff and it's a
little bit fiddly but armand has been
super super helpful hat it to arm and
helped me a bunch on twitter and DM z--
and stuff managed to get it working so
now i'm actually looking forward to
using this rather than perhaps paying
chorus or paying dhaka as much i love
them as well and i might use this for
some projects to get it I can put this
docker image in my and pipeline right so
just the heads up yeah I the other day
pulled down at docker pool open JDK 8
Jerry around the test and these are the
sea V's it found these are the critical
vulnerabilities yeah don't be shocked on
some of this stuff like it's been there
for a long time and you know do you do
diligence some of this stuff is
important to organisations some may not
be but the first point is get awareness
of this stuff yeah and so yeah well
worth checking out this stuff this is of
me security is pretty much table stakes
these days I think we is you know really
anyone who comes to the conference
whether your leadership is in your title
your job title or not you're kind of an
aspiring leader you we're the kind of
Vanguard you're the Vanguard pretty much
of the development industry so we need
to start thinking about these things
before other people do for us like
politicians for example yeah I won't get
on my high horse to too much here but
really think about this stuff yeah it's
really critical we as an interested much
rather we self-regulate than have a
someone else regulator for us but at the
moment were being a bit slack I think
yeah so I work with launch companies and
who are agile I'm sure many of us in the
audience identify as being agile and and
they often push back when we all start
talking around non-functional
requirements and building them into the
pipeline they push back and they say no
no we're add shell so we build stuff we
defer our decisions we wait until the
last responsible moment this concept of
a last responsible moment I think is
awesome when it comes to functionality
we start a project we don't know too
much we learn a bunch of stuff we make a
decision before it's the last we make a
decision so at the last responsible
moment we've you know we know nothing
here we've learned stuff if we don't
make a decision here it's either made
for us or it'll be a bad decision yeah
last responsible moment is really a damn
North talks a lot about this
laughs Daniel talks on these things
Kevin talks a lot about this as well
this is all good stuff but the kind of
newsflash with some of this stuff in
relation to NF ours is sometimes the
last responsible moment is upfront yeah
with security with architecture with
performance sometimes we've got about
think about these things upfront and I
find it really hard to sell this to my
business colleagues sometimes they I say
you know they give me some great list of
functional requirements and I say how
many developer how many seller uses it
for they're like well they can make it
scalable yeah I get yeah so how how
secure should it be I'll make it secure
it's like you know this stuff is really
woolly yes so we need to think about
these things and modern platforms and
architecture things like kubernetes
docker containers you know these kind of
things and micro services don't
necessarily make this easier worked on
some projects where we had polyglot
stack and we suddenly had to retrofit
security into it because for various
reasons it made it really hard where 20
things 20 services three languages
trying to retrofit security and and so
yeah micro services are amazing in terms
of velocity but they can be more tricky
and to to fit things like yeah NFR Zim
if we don't think about these things
upfront it leads to this culture or
fixing fast I call it yeah and the
choice here is I can fix this right or I
send fix it fast and show me what fast
looks like and once you've got this kind
of you know fast it's broken windows all
the way down through and a pipeline will
not help you then need to kind of
instill our culture this kind of you
know architecture and so forth
mechanical sympathy people heard the
term mechanical sympathy I'm a big fan
of martin thompson yeah awesome so Matt
Munns blog is actually called mechanical
sympathy but it's a great concept and
and I'm at f1 fan love Formula One and
that's where Martin explained it really
resonated with me one of the great
British drivers Scottish lead driver
said Jackie Stewart was very
mechanically it was for a sort of aware
in terms of mechanical sympathy
he was a great racing driver but he
understood enough about the car engine
to get the most out of it yeah he
couldn't build an engine he wasn't an
engineer whatever but he was mechanic
the earth and sympathy with the
mechanics and speaking of not the
mechanics the people sympathy with the
actual engine yeah and this is really
good and I think we know the best
engineers I've worked with I've been
very lucky to work some amazing people
they have this notion of mechanical
simple
they they've already couldn't build a
CPU but they know how one works they
know about branch and miss predicts they
know about cache misses that kind of
stuff yeah so I think we as developers
should build our mechanical sympathy and
when containers come into play is a
whole new bunch of things coming in so
Emily a pre Java 9 so Java 8 and the JVM
was not fully C group or task set aware
and this meant that if you and I
actually the project with this we span
up a think it was a 64 core box and we
put like you know and 64 containers on
the box pinning one CPU to each
container you can say in control groups
pinnacle you know pin a container pin a
Linux resource one container to one CPU
primates the JVM not being C group aware
it thinks it's got access to the whole
box and back twenty years ago in Java
was created this made total sense you
spin up a box Java gets all the box yeah
these days it's not so much that
mechanism that that mindset
so are those C groups do constrain the
JVM it can never access more than what
you give it it will base calculations
like fork drawing pool and GC based on
the number of CPUs it believes it has
access to and this is caused confusion
in some of the applications I've run in
the past JDK 9 as far as I'm aware fixes
these issues there is a couple of em jdk
bugs are highlighted it may be back
ported but have a chat with Brian or M
or mark actually to confirm that and I
haven't checked in the last month or so
but just be aware of this things you
know if you're deploying onto a
multi-core box which is very common if
you're going into the cloud is you know
Amazon and docker and Java may not play
well together and it's not just Java
other languages have the same kind of
issue we've Java developers are super
used to dealing with things like heap
space size heap size yeah but you need
to allow a bit of overhead if you're
deploying something into container if
you've got a 2 gig heap you probably
need a two and a half gig and memory
allowance in your container partly
because the JVM has certain overheads my
meta space or perm gen that kind of
thing but also because that native
threads and native threads require
native system resources so I had a
really thread heavy application and it
was basically all the threads were
eating up memory and the JVM was being
killed by Linux and clean the container
effectively I'm sorry between the
process in the container but
there wasn't enough memory for these
native threads to actually get so they
got the privilege the JVM got em killed
out of memory killed so think about
things like that
think about allowing an overhead for
your memory allowance in your container
final one is entropy and so entropy
basically it's kind of the randomness
like in local machine it's been a
banging the keys moving the mouse in the
cloud it's kind of network packets
coming in maybe the fans speed or
whatever entropy is kind of randomness
that is collected to do cryptographic
operations yeah so computers aren't
really good at doing random stuff and so
they need kind of randomness entropy to
do these cryptographic operations now a
lot of applications platforms Java
included and uses typically dev random
to generate the stuff needed the
randomness needed to do cryptographic
operations like signing things creating
session tokens all that kind of stuff I
never really bumped into this as an
issue up until I started using
containers but I started using
containers we were in the cloud running
lots of containers on a single it was
Amazon a bless single address node and
applications were blocking randomly just
stopping like they've start up or the
freeze they'd be running and they freeze
and we started we were chased back and
we looked at the stack trace and we
notice these containerized that Java
apps were always blocking on crypto
operations yeah and then we did some
blogging around as a couple years ago
tisn't blogging around and we suddenly
realized that what spring boot at the
time spring boot by default uses dev
random and dev random if it does not
have enough entropy from the box there's
not enough randomness there it's very
easy to exhaust the entropy in a highly
containerized cloud platform it just
blocks yeah it's the Linux file system
blocks and there's a good reason why our
blocks you can read the man page and
stuff but it can be a pain it causes a
whole lotta problem sets my team found
the issue I was super grateful when they
did you can get round it and spring us
use a spring Docs you can mention this
by using something called dev you ran
them which is pseudo-random as a poster
using real randomness there I've had
lots of discussions over the last few
months about whether this isn't secure
or not I believe this is for most people
but I've put some notes on this to some
others another gents that are very nice
blog post explaining the difference
between using dev random and dev you
random there is some subtle differences
around
I believe like most of us using sort of
you know doing web apps and stuff
they're putting this flag onto your
spring boot app or your drop is an app
will get rid of the entropy program for
example but we need to think about these
things as Java developers yeah we need
to become more map mechanically a moment
kallab moment so and we have to generate
more mechanical sympathy I'm not going
to cover the topics of deployment or
observability March deployment is really
creative critical and the book will go
into more detail I guess and then
there's plenty of great blog post out
there you can read I like the Amazon
this elastic Beanstalk but it talks
about different deployment models the
trade-offs between green and blue red
back and rolling and all these kind of
things I didn't talk about service
meshes and I think Ray's talking about
service meshes he raised always great
fun to watch so go and check out his
stuff if you're into things like sto and
envoy all that good stuff I think that's
where the kind of kubernetes space is
heading for deployment observability I
mentioned that arrow closing the
feedback loop observability is super
super important James guitar James
Turnbull stuff cat on Twitter
awesome bought a book art of monitoring
he does it better than I will so I'm
gonna just point you in that direction
we did a blog did a interview on info Q
that kind of wrapped up some of their
monitoring challenges with containers as
well because in containers are generally
more ephemeral and we're now I'm
measuring in there kind of millisecond
or seconds as opposed to minutes some of
the existing things like nag EOS are
more geared towards at different time
frames that make sense so I use
different I use like deaded or quite a
bit and Prometheus now to do you
monitoring wrapping up so many were
couple miss left but I hope that
containers are not so for I hope people
don't think so
containers they're a silver bullets they
are an amazing bit of tech yeah but
they're not a silver bullet
kind of ones red you know Fred Brooks
his stuff there are no silver bullets in
IT I've been working 99 for like 15
years and I the other genuinely no
silver bullets when you are if you made
the decision to go to container should
you go all in and some of the vendors at
the moment are kind of selling this
thing you know we completely replac form
everything get all looks nice and shiny
you know containerize everything I'm
actually a bit of a fan of this going a
bit softer in this custom this is often
used a derogatory image for docker but I
like this start small do you also
learning is then get big yeah rather
than go all-in you know I've seen a lot
of people spend a lot of money on doing
big real platforming things
over the years and I like to start small
and do learnings some people say to me
as I'm mom and consulting journeys all
this kubernetes looks a bit complicated
right yeah it's complicated for a reason
and it gives you great abstractions yeah
so you still want to learn a whole bunch
back to Pilates but Google are doing
some great and stuff for and training
around that so you have to learn about
these things but they kind of some
people get that not invented here thing
and they're like well this Cuban is
looks a bit complicated should I build
my own platform probably not is my
answer yeah unless your Google Amazon or
IBM or Microsoft for example whatever
you do decide it's probably some glue
stuff you're going to use kubernetes
it's putting some glue stuff you need to
build it yourself whatever you do push
it down a pipeline make sure your
infrastructure is being continuously
continuously delivered as well and keeps
burp Keeffe is just like that's an
amazing book it won't make you an
answerable or terraform expert or
whatever but it will give you the Corp
rhymings of understanding what
infrastructure as code is and how to
build a pipeline around it a great book
fantastic book there's lots of cool
talks as well
finally just automation using containers
does not get rid of the need for good
architecture good architecture in my
mind is about leadership that shared
responsibility about just enough up
front design whole bunch of things like
that but containers do not take it away
from you otherwise you get this kind of
pan yeah we crammed this monolith into a
container and called it a micro service
yeah which is hat tip to chaos Casey
West it's not my service Casey he's got
some awesome stuff online but you know
just got a caveat a talk by saying that
so I'm banging on time I think this is
the summary yeah continuous delivery
vitally important in modern modern
architectures and modern platforms think
about things like metadata and you're
single and you're single image so you
can single artifact going down the
pipeline for all the testing must now be
a container not the jar don't repackage
it on the way down through think about
things like mechanical sympathy
educate yourselves educate your
colleagues around these things assert
the properties in the pipelines so run
those kind of security things runners
performance things in the pipeline the
tooling is there now to support us as
developers a few years ago it was a
little bit ropey but the tooling is
there now but we just need to reapply
the classic kind of continuous delivery
practices with these new tools and tech
I'll share the slide deck on lines I
haven't given you enough information yet
obviously so then
the brain dump but this yeah I'll put a
slight leak online these are books that
have been super helpful to me on my
journey over the last of three or so
years with containers I'm gonna like yes
excuse me I'm gonna kind of do a beeline
to the Araya tea and stand on peace
coming chat to me I'm in the conference
today and tomorrow and I'll be signing
books in like ten minutes time I'll run
straight there now are we giving away
this car it's only a small mini book
it's the full ones coming later but I'm
happy to give you a give away some some
tips hope you that I've learned over the
years and as a github repo with the code
and stuff as well
so that I shall say thanks for listening
appreciate it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>