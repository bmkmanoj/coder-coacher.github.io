<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The Seven Deadly Sins of Microservices by Daniel Bryant | Coder Coacher - Coaching Coders</title><meta content="The Seven Deadly Sins of Microservices by Daniel Bryant - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The Seven Deadly Sins of Microservices by Daniel Bryant</b></h2><h5 class="post__date">2017-04-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Jw6TYEb1Opw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everyone thanks coming along I
appreciate it's like a awesome lineup of
talks now in there and it's gorgeous
weather outside so thanks for coming
along that's all good so the next 50
minutes we're going to be looking at the
seven more deadly sins of micro-services
now fundamentally these are two of the
anti patterns the bad things I've seen
in my work as a consultant over in the
UK and a little bit in the US as well
started as a talk a couple of years ago
I did it I'm DevOps UK and also Q con
New York as well and that's now on info
Q is also on YouTube as well so you can
see the original this is a slightly
different version a kind of updated
version and I've tailored it as well to
empty a box like latest learnings from
here and it's a slight java theme as
well and I know DevOps in general it's
open to languages but it's a slight Java
tuned to this and talk today and these
are the new sort of antipatterns I'm
seeing with micro services so let's dive
straight in this is me feel free to
tweet at me at Daniel Bryant UK love
getting involved in Twitter's that kind
of stuff I identify mostly as a Java
developer I think but I do these days go
JavaScript bunch of other stuff as well
a lot of business tea staff leadership
stuff and love continuous delivery and
in fact I've got a little mini book out
on O'Reilly I've brought a few copies
for anyone asking questions as well only
three unfortunately but recently a
little mini book on O'Reilly talking
about getting started with Java and
docker and continuous delivery and stuff
so that's not the theme of day's talk
misses there any but I've got other
talks online that talk more about that
as well so let's dive straight into to
one of the first and antipatterns and
I'm gonna use that the Deadly Sins the
first one is lust and it's using the
latest and greatest technology yeah now
I'm sure a few of you recognize this new
technology is great yeah until it's not
yeah be that micro-services be it docker
so easy to trip yourself up you get all
excited
riding along tripping yourself up and
this has been me many times yet and
definitely no things like docker
kubernetes super exciting but we've got
to realize that not all technology fits
you know all problems and for me
evaluation is a key skill that I see in
my consultancy work we kind of
underestimate the importance of it
times I think the first thing to look at
in terms of evaluation is our
micro-services even a good fit yeah
we're definitely seeing a lot of the
business type people and in my work in
the UK latching onto micro service is
kind of a buzzword yeah middle
management thinking you know we've got
to be nimble we've got a mode 2 which is
a Gartner thing in terms of your forward
facing public Apps should be agile which
show all makes good sense but just
relabeling what you've got already as
kind of micro services probably not the
right thing yeah and we're seeing many
more people not only mislabelling things
but just kind of layering upon you know
stacks up on stacks you know crafty old
stacks here nice micro service sort of
veneer on the top and if you're not
careful this is a bit lip like lipstick
on the pig yeah looks good at first
glance but when you look behind the
scenes it's a little bit wonky so that's
kind of the sort of strategic business
approach to our micro services right for
us you've also got a look at the
architectural principles as well and we
see quality people not building sort of
around business functionality I've seen
the best results of micro services when
you're building a kind of vertical of
business functionality there's also
something called self-contained systems
I'm Stephan and Everhard from there in
OQ or in Germany talked a lot about that
and I like these principles of
self-contained systems yes they're micro
services but they're built around a
complete sort of business unit yeah from
soup to nuts as we say also I think with
moderns deployment fabrics and so forth
paying attention to the 12 factors I'm
sure many of you've heard of twelve
factor staff if you haven't well worth
of Google twelve factors it's about
building these kind of cloud native
applications and in particular micro
services you know smaller bits of
functionality coming up coming down at
an architectural level we do need to
design them a bit differently design the
way they're configured to design the way
they stop and start a bit differently
and lastly kind of DevOps the opsi kind
of theme at the three things which you
know we're gonna ask ourselves how do we
evaluate for ready for micro services
now with DevOps I kind of see a spectrum
of some people thinking DevOps is a
developer with root access to production
brit sketchy that one probably but I
also see DevOps
oops rather in terms of massive change
control some people like you know
ticking all the boxes getting all the
forms ready I think DevOps is somewhere
in the middle and it's about shared
responsibility yeah I think it's also a
bit of a bad name in some ways I think
DevOps really is about business stuff
and it's about QA as well but I think
like bhudev quite ops isn't quite as
cool as DevOps so that's probably why
DevOps kind of stuck but it is about
bringing shared responsibility yeah to
your team so these the kind of things I
think are critical are we gonna go to
micro services you know what are the
what's our goals what's the value we're
gonna get out of it and think from a
business strategic point of view think
from an architecture point of view and
think from an operational point of view
as well yeah
evaluating tech I'm not going to go too
much into that the previous presentation
covered that a bit more but one thing I
do like to talk about is this spying
model yeah and its basics online it's
not my work and it talks about we often
have conversations at the wrong level
yeah we often have conversations at the
tooling level and we need to go up the
spine to actually truly understand how
we're evaluating technology the classic
here is that with tools is Java versus
Gosei and people are quite sort of
dogmatic about their and their actual
language choice yeah I like Java I like
go and it's often hard to actually
figure out which is best but by moving
up the spine it took what your practice
is your principles your values what your
company kind of needs these kind of
things often it becomes a lot more clear
what you should be using if you value a
strong tool chain I think Java is much
more mature there in all honesty but if
you value say really small binaries that
you can run in scratch containers on say
things like Cuba Nettie's go might be a
best fit you also gotta win the skills
of the team a whole bunch of other
things as well but this model is a whole
wiki about it online well worth checking
out make sure when you're saying you
know docker rocket kubernetes versus may
sauce Java go make sure you're having
the conversation at the right level one
and I found this let presentation and
the wiki really helpful in making me
realize when I'm having the conversation
at the wrong level yeah when I'm getting
a bit dogmatic I like Java because so
it's a really useful technique for a
valuation of technologies a little bit
of an example to crystallize some of
these things and you know to
containerize or not to contain
Dakka Dakka Dakka we all love like
docker yeah and I do genuinely like
docker thumb I'm taking to make a little
bit but dock is an amazing technology
but some people are rushing into it I
think a bit too and quickly and perhaps
not realizing the associate am trade
offs they're gonna be making as well so
from a strategic point of view we've
seen this a little bit so hat tip to KC
West on this one we've crammed our
monolith into a container and we call it
a micro service probably not quite right
yeah from an architectural point of view
some people think you know the holy
grail nicely break up staff put it in a
container brilliant the problem is when
your architecture is a tire fire trying
to carve it up and put it into container
just equals tire fire in a container
yeah quite often and you see the little
fireman down there we call this ministry
DevOps yeah this is constantly trying to
put out the fires that are caused by
inappropriate chucking stuff into
containers add a kind of tech level be
aware of confirmation bias it's all too
easy whatever you google for whatever
you search for you will find a
confirmation of you know should I use
docker yes
should I not use docker yes and these
are two good example articles of me
googling for you know should I use
docker should I not use docker one says
yes clearly and one says no these kind
of things so it's very easy to be
tricked in terms of value evaluation
these nothing's the human way we make
decisions as humans is kind of flawed a
little bit and just as an example
there's lots of like things around us a
little bit of an audience participation
to wake us up after lunch this thing
here I'm gonna give you three options
who thinks the top lines bigger bottom
lines bigger both the same size so who
thinks the top line is bigger like one
two people were kind of thing yeah who
thinks the bottom line is bigger no one
and who thinks they're both the same
size
the vast majority audience think both
the same size so I've actually tricked
you yeah the top line is bigger yeah
it's all too easy a lot of you seen this
kind of thing before you jump to a
conclusion I know he's trying to trick
me so I'll be clever and yes I was sort
of being clever in another way but this
book I'm ready at about five ten years
ago now I think Daniel Kahneman
Thinking Fast and Slow I'm pretty sure
we've already heard it mentioned in one
of the keynotes actually fantastic book
it I don't say this lightly it genuinely
changed my life when I read this book it
goes into three
heuristics we use shortcuts we use now
our brains are not like modern computing
yeah you know with a they take shortcuts
all the time and so well worth the read
it's here a little bit of a chunky read
the Wikipedia page gives a good overview
actually so Wikipedia page is a good
start but it's definitely helped me
identify at least some of my bias I mean
obviously you can never get rid of bias
because it's bias yeah but it definitely
has helped me stop when I'm you know
when I'm making mistakes sometimes and
it helps me work with clients as well
when they're just getting into you know
oh this is the only way we can do things
I'm like ah I think you've got
availability bias there you know you've
been reading about kubernetes that's the
only thing you're considering perhaps we
want to consider something else as well
these kind of things so that kind of
wraps up the portion of valuation moving
on now to the second area deadly sin is
gluttony yeah and this for me is about
communication locking now a lot of
people start with Jason over HTTP I
think it's a good start I often like
doing the most simple thing possible to
get up and running but I have seen a bit
of pushback about using things like RPC
G RPC for example now in reality people
are using JSON over HTTP or or rest as
RPC they're just doing it in a slightly
more you know standardized way G RPC
sometimes is really useful for example
it gives us a binary protocol uses
protobufs under the hood it gives you a
contract and speed that can be really
beneficial often some people put push
back and lean and they like the Jason
because it's gonna be human readable but
how much do you actually read you know
in terms of your communication ideally
you should be logging the most important
stuff monitoring the most important
stuff it can be useful to know debug
Jason but predominantly I find that the
contract itself is really good with
things like mg RPC and thrift Avro
there's a bunch of them as well and the
contract is really good and the speed is
an added bonus no more serializing and
deserializing massive Jason objects we
waste far too many C CPU cycles doing
that kind of thing now have you no moves
that I have some JSON rest having a look
at RPC don't rule out events as well why
I think events are very interesting it's
it's often a paradigm shift this notion
of a synchronicity eventual consistency
these kind of things and it's a little
bit buzzword heavy
yeah event sourcing CQRS reactive but
there if you look below sort of the
surface there's some really interesting
concepts here I think event sourcing in
particular having everything you know is
in a mutable event blog is very nice
gives you a lot of very interesting
properties and things like reactivity is
definitely a theme we're seeing on the
JVM spring five I don't if anyone saw
Josh's talk yesterday spring five is all
about reactive which I find very
interesting I've been using rx Java for
a while it's it's quite funky and also
they very much like logon and even the
jdk itself jdk nine has got some
reactive primitives so we are seeing a
move I think in the industry towards
this and in Java is actually not too far
behind on some of these things which is
really quite interesting if you want to
know more about these kind of things how
to think in terms of events I saw a
fantastic presentation by Jonas bunny
from like bent or used to be called the
typesafe and he talked about micro lifts
to micro systems so I'll upload these
slides later on you can grab the
references but Jonas has got a very
interesting way I mean they've got a
framework like on but you don't
necessarily need to use the framework
but he's got a very interesting idea of
thinking about event-driven system's
yeah not just event-driven architecture
but very much towards the sort of event
sourcing immutability model which is
very interesting almost on a
communication space if anyone's in
working with es B's they once were old
enough to work with yeah see a few hands
going up so good old enterprise service
bus is he used them a few times and the
idea is you kind of put some Enterprise
Service bus in the middle it's your main
kind of service bus your main bus for
communications messages go onto the bus
they get routed round in theory looks
super simple ya know when I rock up to
places as a consultant and I see this
kind of architecture diagram with all
these services connected nicely to this
enterprise service bus I'm always like
oh this is not a good thing yeah because
when you actually crank open the service
bus you find the routines a little bit
like this yeah and then you've got some
security policies going on probably some
kind of governance as well and it's you
know what looks so simple is super
tricky to actually work with yeah super
tricky to migrate away from so the
enterprise service bus is usually
deployed behind the firewall
it's kind of you know it's not
forward-facing it's behind the firewall
doing
thing but say we were to move the system
boundary down so the top things now you
know will change the will change the
names of those services in a minute but
that's how kind of you know
forward-facing boundary they're in the
middle of the ESB
if we're e label things and apologies it
might be a little bit small but rather
than service a B and C at the top we've
got things like web app iOS app we've
got things in the backend like payment
service you know product service these
kind of things look at this now with the
system boundary in the middle you want
to ask yourself is this an ESB or is it
an API gateway yeah very similar kind of
technology now don't get me wrong
API gateways are super awesome they're
really it's basically some way to kind
of control ingress into your system yeah
it's like yeah it's like the gates if
you had a castle it's like really strong
kind of you know gates everything comes
in by the API gateway but I see far too
many people putting things into the API
gateway now as much as I love Netflix I
genuinely do love Netflix this
technology the Zul proxy is a cause of
some concern when I worked on projects
because Zul proxy you can put groovy
scripts in it as well so it acts as an
API gateway but you can actually add
logic using these dynamically loadable
groovy scripts and Netflix do super cool
stuff with it the problem is it's like
it's it's really dangerous if you don't
know what you're doing it's very easy to
start putting business logic in these
groovy scripts in addition to your
services then every deployment you've
got to roll out a service and a groovy
script for example and I'm just picking
on Anya on Netflix Azul there's many
other API gateways like that the idea
and intention is great but you have to
strive for loose coupling your
fundamental architectural principle but
it's really good for things like
security auditing rate limiting all
these kind of things in Kong and one of
my favorites they're open source Kong
Apogee mule soft all good stuff
but do you know if you start putting any
logic in your API gateway any business
logic or you notice that when you're
deploying a service you always have to
update the Gateway that is a time to go
whoa what's going on here yeah changing
to the next the sin its greed and this
is more at the organizational level kind
of break things up a little bit so in
the previous talk I said Conway's law
super important I'm sure many people
have heard of Conway's law it's almost
like if you're doing Micra service bingo
Conway's law is like yeah
that one but it's true yeah any kind of
architectural style is about people and
particularly micro-services I think as
you know separating things up is very
much about people you know separating
code up therefore you should probably
separate teams up these kind of things
so it opened credo the company I work
for in the UK we do a lot of sort of we
help people people phone us up people
email us and say look I'm half way
through a micro service project it's
going a bit wrong can you help us yeah
no worries
we like not only to look at the you know
the code they often say you know we
can't get Cassandra working or we can't
get these micro services talking
together properly
we're like yep no worries happy to look
at the code but we like to look at the
overall business as well you know what
are your kind of goals as a business and
what is it we'll have your team
structured and so forth because we've
come to realise that the technology
problems are often symptoms of wider
issues yeah and it can be a tough sell
sometimes and I kind of get it because
people are paying us money so they want
to get what they think is value for
money but we're getting a lot of
pushback when we start saying can we
look at your teams can we look at how
you're you know structuring your micro
service teams and people say this yeah
now that no need to look at how we've
done the teams because we've decided to
decide to reform around squads chapters
and guilds yeah people know where this
one comes on as well get on Spotify
stuff we've heard it mentioned once
already today and it makes a lot of
sense but the problem is is cargo
coating it's blindly copying yeah and I
often say to people you know repeat
three times we are not Spotify yeah we
are not Spotify we are not Spotify we
need to get to the practices principles
and values as to why Spotify became you
know got to that model then rather the
model itself because I've seen some
companies have literally rebranded scrum
teams as squads like chapters are like
we have a line manager in there and the
guild is we run a conference once a
month yeah that's just last lipstick on
the pig again that's rebranding what
you've got when you actually look in to
Spotify they're they're optimizing
basically for autonomy and innovation
yeah autonomy and innovation now for
Spotify
you know streaming music service going
fast means you probably beat your
competitors you get more money if stuff
goes wrong no big deal yeah people
probably you know might complain you do
a bit of refunds these kind of thing
let's say we're building software for a
nuclear reactor the last two words I
want to hear or our autonomy and
innovation yeah I don't want you trying
something out and you can react it like
notice it's just kind of scary so for
there that kind of building software in
that environment you know change control
is appropriate maybe one monolithic team
with multiple levels of hierarchy
yeah it's fit for purpose yes Spotify do
amazing work genuinely amazing work but
we need to look into the principles of
how they arrange themselves rather than
just copy they're kind of this the
surface that makes sense I see it all
too often like I understand why people
do it but it's definitely worth thinking
about that was only a short one but just
to hopefully get you thinking about the
organizational side moving back into the
kind of tech and the fourth sin is is
sloth is laziness and I see a lot of
people getting lazy with what they call
non-functional requirements yeah and I
actually don't like the term
non-functional I think I prefer cross
functional requirements or system
requirements because non-functional
requirements I've seen many systems that
were not functional
due to non-functional requirements yeah
people forgot about scalability forgot
about maintainability
these kind of things and for me it's all
about this you know getting lazy with
sort of NF ours is the driving Technol
requirements for a system should be
identified early to ensure they are
properly handled in subsequent design
comes from Aiden Casey great blog post
out links there now how many times when
you go to like you know when you get
some instructions from your client to
your manager do they give you very clear
functional requirements must do this
must do this must do this and then you
say should it be secure yes how fast you
to be fast yes I think as technologists
we've got a bit numb to these things and
I think we should start pushing back a
bit more I've actually seen a few
projects that have gone completely wrong
because people that upfront didn't
actually ask you know what's the
security requirements here do we have to
audit these things and what's the load
light is it going to be spiky or is it
gonna be flatline so sometimes getting
in the requirements you know early is
it's really important yeah and this kind
of slide pretty much sums up what I've
said there often things like
availability scalability all its ability
they're an afterthought in projects yeah
testing and these things often get
pushed to the back Guilhem where even as
asses consultants we really have to push
hard to get these things valued now with
pushback we often get is that when yeah
we're agile we're doing lean therefore
we're going to delay our decisions to
the last responsible moment now the
principle of last responsible moment I
think is really cool it's like
just-in-time compilation yeah kind of
makes sense we do these things just in
time but the kind of news flash with
some of these NF ours is the sometimes
the last responsible moment is actually
upfront we don't design security in we
don't design you know scalability in
there ain't gonna happen and you
definitely can be costly and prohibitive
to adopt and adapt late in the project
and in my experience micro services
don't make this easy yeah I've actually
a few projects where we've had to
retrofit and security into micro
services and with a monolith we would
have just you know put it in one place
put the tests in these kind of things
probably would have been doable but with
like 20 30 micro services it simply
wasn't doable we had to replicate the
work across there's a bunch of other
technical reasons where people have kind
of gone on and did their own thing in
each service it made it really hard to
do so micro services do not make this
easier yeah as a heads up on that one
I'm really game is looking at security
at the moment it had sort of bit of a
personal interest of mine Sam Newman mr.
micro services himself has been talking
about this quite a lot as well and I do
think as an industry we are heading
towards a few events unfortunately where
security will be a dominating theme yeah
these days things like IOT is is super
interesting but a lot of IOT stuff is
inherently insecure the way the
protocols work on things and the same
with micro services and we're seeing
wood not paid sort of and too much
attention to security but thinking of
the old-fashioned way of you monolith
you harder than the edges or as we like
to say Death Star security and you
really make the edges hard but when
someone gets in they can do all amount
of damage so it's thinking about
security not only at the system level
but at the individual service level is
really important and I'd really enjoyed
learning a lot about their Sam's deck
their apps second micro services is an
awesome deck to read Aaron Greta Fiore
amazing guy did a white paper on
container security and he looked at
rocket dock a few other things as well
these are two things I definitely
recommend you read if you are going
towards micro-services and looking at
containers as well but you know I'm a
massive fan of continuous delivery so I
think we can get many of these things in
the build pipeline these days if you're
using Jenkins Circle CI you know take
your pick
we like like say testing performance and
and load testing with things like
Gatling jmeter I'm finding a little bit
clumsy now I was a massive fan of jmeter
say 5 10 years ago but I think now
Gatling is a bit more flexible Gatling
is a scholar based tool but if you know
Java is very easy to write enough Scala
to do really cool things
it's very DSL based so you have to know
if you know a few sort of things with
some with Scala the beauty of Gatling as
well as once you've got it running say
locally or you can put it in your build
pipeline it's quite lightweight you can
then actually directly take the the
Gatling files and move them to a
commercial service called flood dot IO
I've got no affiliation with it but I've
used it several times it's really cool
you can literally take your Gatling
scripts load them into flood dot IO say
how many services how many simulated
users you want to run and you can hammer
your system like it used Amazon under
the hood AWS spins up all the 80 bless
hammers and if they charge you like a
fixed fee on these things so these are
really cool tools for testing
performance and load of your system
security testing fine sec bugs is kind
of the security version of fine bugs
I'm sure if you have using things like
fine bugs it's really cool you can put
it in your maven put it in your grave
walk Gradle and you can fail the build
when you're certain conditions aren't
met Oh Ross dependency check basically
you can pit a maven plug-in and it's
multi-language as well it supports Ruby
and Python all these different things
but the the maiden and maven sorry in
Gradle dependencies we'll look for
critical vulnerabilities in versions of
libraries you're using yeah which I find
is super user useful it's also easy to
kind of get developing on a project and
over time you know you just don't update
certain libraries but there can be
really critical vulnerabilities there
things like struts or logging libraries
these kind of things and the OWASP
dependency check it's a bit like the
maven enforcer it will fail the build if
it detects one of the things you're
using is insecure or has a critical
vulnerability things like BDD security
and they're like a BDD
/ further Oh wasp tool and a wasp zap is
an automated penetration testing tool
it's not as good as a human obviously
penetration tester but it's it's got
some very basic kind of penetration
testing automation tools which you can
put into the build pipeline you can run
them headless Lee do you continuous
checking on your micro services
continuous checking on your on your
services our system as a whole and the
BDD thing is really cool you can like
say given I'm in this mode when I log in
as a user with these credentials can I
do a sequel injection attack or can I
steal a cookie these kind of things so
it's all very readable very writable but
it codifies some of the security things
in their gauntlet and service peckham or
op C for testing your actual hardware
docker bench and Clair again more
container focused things but when you're
deploying in a container
you're not just deploying a jar
obviously in a container you're
deploying a whole operating system
you're sharing the kernel but you're
deploying a whole operating system
typically particular with Java and even
if it's a very small operating system
like Alpine there is still room for
issues still room for vulnerabilities so
claire is an open source scanner for
docker images for container images
really worth putting in your pipeline
right em number-5 going through these
quite quickly actually this is about
blowing up when bad things happen Rath
yeah so previously I talked a lot about
release it awesome book by Michael
Nygaard it's kind of pre cloud pre
DevOps pre micro services but it was
actually the the foundations for a lot
of the work done on simian army famously
Adrian Cockcroft gave this book to I
think was Colton Andrus and Ben
Christensen in Netflix and said these
principles in this book are awesome
things like circuit breakers bulkheads
retries timeouts and then the guys went
away the whole Netflix team went away
and built the kind of the codification
of these properties into the simian army
and we have actually used on projects in
the UK and in Germany and we've used the
simian army to test elastic search
clusters we're running two test
applications we're running by
continually like breaking down the
system and watching what actually
happens so this at a technical level
this stuff is really worth doing yeah
codifying the expected architectural
proper it properties or the expected
operational properties because if you're
going to things like container
things like cloud stuff fails all the
time and it fails in really weird ways
so we need to codify and test this
automatically microservices in my mind
mean that we have to automate a heck of
a lot more stuff because where you
couldn't kind of simulate manually
failures in the old world and in my
monolith
it's really hard with micro-services
yeah so automation seminar me these kind
of things I'm really interesting this
one's great a bit more about the people
and people issues and I generally find
my work as a consultant when bad things
happen people are always involved I
personally like to be this guy here with
my beer know what's going on and not
getting too stressed yeah but in order
to be this kind of person we need to
think about things like DevOps yeah and
this is it's gonna be bit of a high
level kind of introduction but for me
DevOps is a lot about shared
responsibility across teams yeah so
Matthew Skelton hat tip to Matt Skelton
over in there over in London he runs the
continuous delivery meetup there he's
got this great website called
DevOps topologies calm that talks about
good patterns and bad patterns that he
has seen of DevOps implementations the
kind of goal of breaking down barriers
between Devon ops no longer throwing
stuff over the wall and he's seen that
the classic say the DevOps team where
you have like you know dev team ops team
dev ops team in the middle but in big
enterprises that just means more
handoffs quite often and he's got some
great and the blue patterns are kind of
the good patterns for DevOps
implementations and DevOps is still a
bit nebulous to many people and I think
a lot of us haven't fully figured out
what it means but reading this kind of
stuff and seeing the patterns that math
scene really helped for me clarify and
it's something I shared my clients in
terms of yes I think you've got this
auntie pan in your silo in your sari
sitter in your company that's why DevOps
for you hasn't actually helped you these
kind of things I'm a big fan of books
you I'm sorry you will see a lot of book
references in the talk I have a quite a
long commute in the UK so I've been
reading stacks of books over the last
couple of years but this these three
books have really helped kind of get
clear in my mind again what DevOps is
and kind of the sre book is is Google's
approach to DevOps site reliability
engineering from
that's kind of a subset of DevOps but I
think it's really interesting to learn
about this things like era budgets are
very nice so you know a lot of times
companies I work for want to keep
pushing faster and faster
rolling more more things out but you can
use patterns like error budgets by
saying if you have more than a certain
amount of downtime per month we kind of
stop the train try and fix a bunch of
stuff
yeah rather than actually keep going
fast they're not always possible in you
know startups and so forth but in bigger
companies this notion of an era budget
can make more real challenges you're
actually having with going so fast and
then at one point you reach that tipping
point where it all just goes wrong and
it takes you months to get back up and
running yeah so moving on the
infrastructure is code book from Keith
kind of helps help me clarify how we
should use and how we should build a
pipeline to deploy the underlying
infrastructure now you might not wanna
deploy infrastructure you might be using
pass or service but if you are using
infrastructure if it's something
interesting this book is you know it's
not gonna make you a terraform expert or
an answerable expert but it is gonna
make you an expert in terms of how these
things should be deployed how they
should be managed and again all the good
stuff that we as I'm assuming most of
the room here are developers and I
primarily I think identify as a
developer many of the good things that
we've learned in development like
version control unit testing
architectural principles broad
generalization here but a lot of
operators I work with haven't got those
background I haven't got that background
skills and I haven't got a bunch of ops
skills so it's a two-way thing yeah I
share my knowledge and ideas around in
continuous delivery around testing and
they share all the system level stuff
which I have no idea about until a few
years ago when I started doing this and
I've learned so much thanks thanks the
many operators and many C's admins over
the years I've paired with them learn a
bunch of stuff keeps book really good
book for learning the principles there
and the more kind of softer side the
cultural side Jennifer and Katherine
have done an amazing job there from Etsy
and Etsy although they run a monolith
they run a PHP monolith FC they have
done DevOps super well super super well
so we can learn a bunch from from
Katherine and Daniel as are Katherine
and Jennifer should say really nice kind
of books so this is kind of my you know
this is my attempt that this is what
DevOps is for me and this is how
my micro-service journey DevOps
automation super important when you're
running services that scale do be aware
of a slight anti-pattern this full stack
engineer kind of myth we've had a few
people push back you know people have
hired in this one special person that
claims to be full stack now when I start
my career full stack meant I knew Java
and I knew JavaScript I could do back in
like a do front end a full stack yeah
that went on the CV straightaway but
these days full stack means you know
means whatever you want it to mean do
you do ops as well as like dev staff do
do front-end back-end it's all bit
confusing and it's a great Curtis Albarn
craft conf last year by charity majors
he was trying to hire like DevOps
engineers and everyone was rocking up
claiming they were full stack engineers
and basically she got so annoyed she
pitched this one back then says I'm
sorry but if you're not designing the
computer chips and writing the website
and I don't want to hear from you yeah
this notion of full stack is a bit
dangerous I personally have a generalist
I tried to be quite widely skilled but I
totally appreciate I cannot be a
specialist in everything yeah my team I
work with their superg I've got some
people that are super good with Java
super good with Cassandra super good
with UX and I kind of often work at
they're kind of bringing all the pieces
together or whatever I think the broad
awareness is really good but people
claim they can be everything I think
it's often a lot of danger in that
particularly with things like DevOps
it's not about one person it's a shared
kind of thing yet it's a shared across
the organization shared across the
culture so be aware of people claiming
to be full stack their votes people I
think a lot of DevOps is about defining
responsibilities and and we've moved
away from this a bit over the last year
but I used to see when I put this
presentation together a year ago and I
used to see a lot of people wanting to
build their own micro service platform
yeah and I think that's a bit dangerous
really and for me as a developer we
should be focusing on what matters in
DevOps promoting you know fast
repeatable reliable and safe delivery of
software and that is continuous
integration continuous delivery
mechanical sympathy kind of
understanding your hardware if you go
into the cloud everything is on the
network for example even the blocks core
is a SAN yeah it's basically over the
network and the i/o characteristics are
a lot different than the matter
for example I've made a bunch of
mistakes on that code it code it on the
Mac worked fine put it on the cloud very
different performance characteristics
and it didn't work
things that logging and monitoring these
are all kind of platform
responsibilities yeah and again I
caution you if you start building your
own platform unless that's what you do
as a company it's a bit dangerous really
big fan of using these kind of things
open-source pass yeah openshift is a
real nice kind of wrapper over
kubernetes effectively
I love kubernetes really really cool and
thing but for a lot of enterprises Cuba
at ease is a bit freeform doesn't have
things like our back doesn't do certain
auditing things whereas OpenShift it's
open source but it layers on a lot of
enterprise features so hat tip to Red
Hat there Deus is a another open source
kind of has over kubernetes a bit more
free form if you want a bit more people
to get your hands dirty so to speak Deus
is probably bit more flexible and open
shift and clad foundry I'm loving the
kind of foundry stuff to be honest if
you just like if you're a startup and
you just proving your business but you
don't want to be writing platform stuff
yeah you want to be shipping code trying
to find product market fit and clive
boundary like CF push like your code
super easy
I think definitely myself until a few
years I used to rag on past thinking
that pass was like didn't give me enough
power
your powers kind of took away the
responsibilities but I think has
actually now for certain situations pass
is really useful and when you do micro
services you've got a whole bunch of
things going on you can minimize some of
the platform responsibilities you can
just get faster you know fast the
delivery with the code so think about
these things number six env and it's the
shared single domain and datastore
fallacy so back in their monolithic days
and having sort of one model to rule
them all was was super good yeah
canonical domain models that those words
should Shen send shivers down your spine
and having a kimono canonical tomatoe a
model was really important having us one
domain model so my clients spent almost
years trying to get this one perfect on
a model backed by hibernate you know
backed by Oracle or whatever and but in
the microservice world that doesn't
really work one model pretty much breaks
encapsulation if you're having to share
one model with like say ten services
when you change the model you have to
deploy all ten services I've done it
like five years ago first micro service
project I put a maven dependency I like
with my entities in and of course every
time we changed the entities I had to
redeploy all the services because I was
serializing between the services so
there was it implicit dependency on the
actual and on the entities themselves
yeah am i bad so we have to think about
things like domain-driven design
I think DDD is got a bit perhaps
overhyped even but there is some really
valuable properties of domain driven
design things are understanding how
entities in aggregates work versus
immutable things like value objects and
it is really it's really helped me a lot
and that the pushback I get a lot and
when I recommend these books is they're
quite academic and quite heavyweight I
think to some degrees they are they are
worth pushing through
but hat tip to water Vernon Vaughn he's
actually Curtis I've won then it's
actually current with a smaller book
this one's quite small the new one and
it distills the core concepts of domain
driven design you can read it almost
been like a you know an evening a day or
something and this if you want to get
primed or you want to share with your
colleagues
this is a really good book to get them
thinking about things like domain driven
about bounded contexts about a
ubiquitous language these kind of things
it's definitely a book I highly
recommend couple of tools I've used them
in terms of understanding either you've
got a monolith and you're trying to
break stuff up or you've got a new
system you're trying to figure out the
the kind of domain boundaries these are
two tools I use context mapping is a
good way to get the static lay of the
system yeah the kind of core context if
you like within your system the core
model components more and more I'm
seeing the value though are things like
events storming events storming
approaches it the other way around with
kind of context mapping you very much
look you know your system and you go
hang on this looks like a payment kind
of payment sort of functionality this
looks like checkout functionality over
here ah here's some auditing whereas
events you look at it at the you look
for events at a business level you go
you basically pair up with someone from
the business and you say describe a user
journey to me and what events should be
fired and not talking about technical
events but what things happen you know
oh in order to come
in the orders then pass to procurement
these car things these are business
events coming off and I found this and
then the events coming is that we have
put references there but there's a great
book by Alberto about events storming
and you can often collect together
common events and that's how you form
the kind of dynamic flows of data
through the system so these are really
two powerful tools for understanding how
to model how to kind of carve up and
your code because effectively code is a
model of something yeah with code you
are modeling a business problem
you are modeling the real world for
example and there's always the static
model and there's always the dynamic
model and I think we pay too much
attention to the static model sometimes
but I've really found it advantageous to
look at the dynamic model as well these
are some good good things one thing I'm
seeing another thing I should say I'm
seeing quite a lot with micro services
is it does give you the freedom to use
multiple data stores yeah it's one of
the kind of selling points that some
people mention and you can plug in the
graph database here a key value store
over here and yeah you can totally do
that be aware of the operational
overhead by bringing in say new data
stores and and don't rule out relational
databases a lot of people use the move
to micro services as an excuse to bring
in all new tech yeah so they bring in
docker they bring in Cassandra all these
things and they throw away all the old
stuff and unlike relational databases
are really cool for a bunch of stuff
yeah really good for a bunch of stuff
for structured data Cassandra is a bit
of a bugbear of ours at the moment and
you know it's been really lucrative for
us to know who agreed no to be honest
but cassandra is an awesome data store
but it's not a relational database I
think some people misunderstood a lot of
the early Netflix there talk about
Cassandra that you know if I just deploy
Cassandra it's a faster version of
Oracle it's a faster version of my
sequel it's really not it's a comment at
Clem nner sort of based store and you
have to model your data very differently
yeah so don't treat it like relational
database it's a bunch of interesting
blog posts I can point you to if you're
looking at Cassandra and the same thing
is that you know I've said that
relational databases are very cool but
if you do have very graph like data
don't try and build a graph in a
relational database I've seen that done
as well and the fundamental kind of
pitch bar the operational overhead being
aware of that the fundamental pitch is
in time to understand your data taking
time to understand the model yeah and
then map what is best for and you know
the actual data you're capturing and the
way you're going to query it and choose
appropriate technologies all too often
it's almost two modalities I see there's
one we're going to use relational
databases because that's what we
understand we just power through and
there's they're kind of hips thick
people which I'm sometimes the hipster
as well but hipster people like hey
let's check in Cassandra and neo and all
these kind of things without realizing
the impact that's gonna have on the way
they model a data and the way they
operate the system as well I think
that's pretty much it on now and yeah so
let's move on to the final final scene
and it's pride in its testing testing
with micro services is a big shift use
be able to have your model if you poke
something here something drops out here
easy to understand with micro services
you poke something in here and like you
don't know where stuffs gonna drop out
and before you can even poke something
in over here you have to load up all
these other services around it yeah very
very different kind of model
Toby Clemson awesome article and it's
probably the primary like reference for
micro service testing if you haven't
seen it it's totally worth reading I've
done it actually a reply to toby stuff
as well a require or more a compliment
because it's an awesome article but i've
also put some additional thoughts around
so my experience and with testing
microservices a lot of its around local
verification and sometimes contract
testing and then end-to-end testing of
kind of critical journeys and things
like that and always remembering the
test pyramid yeah units you know unit
tests at the bottom integration system
we want more unit tests than we do you
know manual test or audits of
exploratory tests it's all too easy to
get the ice-cream cone where you have
lots of very sort of brittle acceptance
tests and only a few and unit tests and
that could add some that weighs you down
after a while so definitely you wear
things like that but what I want to talk
to Jane it's kind of a shameless plug
for the work I've been recently doing or
my team has been recently doing is
service virtualization and just actually
I think last week or this week maybe
LinkedIn have come out with their tool I
don't if anyone's seen it and LinkedIn
announced like they've been doing amp
service vectorization a whole bunch of
other and organizations and open source
products are popped up as well I'm sure
many people in the Jarvis
macer familiar with while mock while
knocks by popular but service
virtualization is really useful when
building and testing micro services now
it's kind of it's good when perhaps you
all the services you know you're working
on a service and all the things around
it are hard to spin up might be a legacy
system might be expensive to spin up
might be an external thing you can't
control or and you can't control the
characteristics of it you want to
trigger failures and see what happens in
your system but you can't service better
ization you can sort of see on the top
diagram you effectively put a proxy in
the middle of two services communicating
and you record the requests and
responses yeah and then you can remove
the main service itself and and just
when a when your service you're working
on makes the request the service
virtualization technology recognizes the
requests and returns the response in its
own data store no need to go back to the
service and get the data and you can do
some really cool things you can
basically then plug in these kind of
tests since in CD so you're running like
I'm getting its delivery pipelines and
you're not hitting these expensive or
fragile resources but you are testing
the way your service interacts with them
yeah a whole bunch of technologies
around this there's the classics like CA
HP para soft IBM all got very expensive
open-source a very expensive tools
they're very good tools
there's also open source tools I
mentioned like bio mark already hoverfly
is one I'm going to mention in the
minutes when I'm working on there's
basic VCR Betamax mountebank mirage
depending on what technology you're
coding in there's probably a service
virtualization tool suited to you yeah
and so I'm working on hoverfly at the
moment it's open source it's a go based
service virtualization tool and but it's
open source we love contributions please
do get involved and it's basically it
only supports HTTP and HTTPS at the
moment but we're finding that's quite
good for testing micro services because
it's written in go it's super performant
so we're working with some financial
services where they're running massive
load tests on a service and they're
using hoverfly to virtualize these other
services and before they couldn't do
that because these services were and
they couldn't run something to keep up
with the request some load tests
well because it's go you can run run
let's run us a small very small little
binary and it responds and very brave
efficient
me anyway harvest is the sort of the
open source pitch there but this is kind
of the core functionality of service
virtualization and hoverfly in
particular you can run it in capture
mode at the top there so you put this
proxy in the middle and you record kind
of request response and then you can
then once you've captured the request
and response you can then get rid of the
external service and you can just use
hoverfly to match basically requests and
give a pre canned response back yeah now
the cool thing with this is you can
actually put something called what's
middleware in the middle here there so
you can remove like personally
identifiable information you can reg
limit you can do a bunch of stuff like
that so you're capturing traffic coming
in perhaps you're removing credit cards
you're removing sensitive data and then
we're storing it internally and hoverfly
and we play it back in in simulate mode
super cool you can chain things together
it's like UNIX pipes kind of things so
we can do all these things where it gets
really interesting though is in simulate
mode so you can use this but you
basically mess with the request and the
response so you can inject faults which
I like for me this is a game changer now
we started doing this kind of stuff you
can say return garbage data you can
introduce delays and you can see how the
service calling it handles it all in a
deterministic fashion yeah which is
quite nice and again you can kind of
layer these things up we've got native
locker language bindings and so we've
written the whole flight Java one
there's also a Python one someone's
contributed and someone recently is
contributed a dotnet and binding which
is super cool as well so loving the open
source and you can use this as a J unit
rule basically you can see the top one
there you can basically put offline to
capture mode and that that rule there
downloads the whole fly binary in the
background small download it sets up
your JVM proxy settings it does some
stuff with the cube M key store because
of SSL Certificates and there is some
cautions there around man-in-the-middle
attacks which I can talk to you more
about but you can basically run that
rule in capture mode do all your tests
and it will record like do all your
tests with the real thing present with
your real services present and run it in
capture mode capture all the data then
you can turn it into simulate mode and
you can get rid of all the external
services you can just run it in a
pipeline yeah which is really quite cool
there's also a DSL kind of wire mock
like so if you don't even have the
service say your
front-end developer and you want to
you've got the API kind of agreed but
there's no back-end service to you no
ready yet you can use the DSL to
basically you can see there you can
specify your gets given this pattern on
get on on this your I then I returned
this blob a Jason or you can use Jason
to kind of you know make it a bit more
readable these kind of things it's
really quite nice and it's kind of a
fluent API so you can run multiple sort
of synthetic endpoints so you can see
we've got two services there two
endpoints and then we layer up you know
when post is called with this return
this when get as cool with this and you
can also have things like delays we
can't include the middleware yet in in
hover like Java we're working on that as
we speak
we love contributions as well from the
open source community but it's a real
nice kind of dsl for basically recording
and mess messin around with like fake
services if you like and virtual
services so getting dangerously close to
the end of time there and but that's
community so pretty much it these were
the seven deadly sins of micro services
if you're thinking of using micro
services do think about evaluating
whether they're right for you and what
the technologies are right for you as
well should you bring in docker should
you bring in cassandra these kind of
things all great technologies but think
about whether they're right for you
watch for communication lock in I
mentioned about G RPC vs. event versus a
P I gateways definitely think about the
organizational side you know the Creed
section there and also blowing up and
bad things happen definitely think about
NF ARS micro services will only make
things harder security performance
maintainability and these kind of things
and they can all be effective when
you've got multiple code bases multiple
services be aware of you know this
canonical domain model is no longer a
good pattern in micro services I think
domain driven design is really
beneficial its notion of bounded
contexts and also if you are going to
bring in new data stores check that the
requirements of your domain there are
requirements of your queries match the
data store tech yeah and think about the
operational overhead of bringing in new
data store tech as well testing in micro
services I didn't cover lots of it today
but testing does change a lot multiple
services in testing things in isolation
you're testing the system at whole and
service virtualization is one tool I
found really useful
the reason I've got involved with with
challah fly is like we were bumping into
this problem a lot and finding that the
existing open source tools didn't quite
match our needs so things like that
service virtualization can be really
useful but testing in general is
definitely bit trickier than micro
services yes and that was just pointing
I think the key things there so I put
the slides out this is in bedtime
readings and share I love my book slice
a visa books I've found really useful
and but on that note I shall say thank
you very much appreciate time I don't
maybe have like two sort of 30 seconds
for a question if anyone's got one I can
give you got three books as well or you
can come and ask me after it's or around
the hall whatever anyone's got a
question they've got instantly feel free
to jump on the mic and shout one out or
otherwise I'll let you go cool favourite
gonna chat me a fizz guys thanks a lot</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>