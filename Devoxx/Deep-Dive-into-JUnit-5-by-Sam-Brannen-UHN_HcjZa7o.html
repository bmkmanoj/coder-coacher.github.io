<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Deep Dive into JUnit 5 by Sam Brannen | Coder Coacher - Coaching Coders</title><meta content="Deep Dive into JUnit 5 by Sam Brannen - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Deep Dive into JUnit 5 by Sam Brannen</b></h2><h5 class="post__date">2016-11-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UHN_HcjZa7o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to a deep dive into JUnit
five nice to see all of you here tonight
my name is Sam Brannan
I'm a spring and Java consultant at a
company called Swift mine in Zurich and
I've been a Java developer for for quite
some time now I've also been a core
committer for the Spring Framework since
2007 for spring to five when I took over
the testing support rewrote everything
with integration support for Jay and for
Jane three and and testing G so that's
kind of how I got into the the testing
stuff I'm also a trainer and a
conference speaker as you can see from
from where I'm standing now and the most
important reason I'm here tonight is
since last October I've also been a
corps commander for J unit 5 so just
quick note about my company experts in
spring Enterprise Java
focusing on a spring portfolio obviously
Jane and now since I'm a core committer
as well Java EE soft architecture code
reviews so if you need any assistance
with stuff like that you can contact us
we're in Zurich but we can travel we're
also on Twitter and of course we have a
web site as well so the agenda first
we're going to stock start talking about
impetus for change right so why do we
even have g25 I'm going to look at
change of five and in great detail or as
least as much as we can within the
course of this talk and then at the end
I'm gonna cover some of the features
with spring five and its support for
Jane at five so you can see how other
frameworks can can build off some of the
new features in a unit five and then it
end hopefully have a few minutes left
over for some some QA and if not you can
approach me afterwards so first up might
see a show of hands who here writes
tests okay and everyone else should be
ashamed right okay who writes what they
would call unit tests pretty much
everybody who writes what you might
consider integration tests okay system
tests fewer and fewer hands all right so
going down who uses that framework
called J unit yeah anyone not using J
unit
this here don't really have seen hands
anyone use a test in G okay not too many
anyone use a Spock like that big goofy
okay few more hands alright so good to
know so basically pretty much everyone
uses J in it right so I didn't clarify
that who's using Jane at three anybody
two hands okay
don't well maybe you should be ashamed
anyway everyone else is hopefully on J
gonna do for something
who's on non-genuine 412 okay so maybe
maybe 10% right so that's the latest
official release of Jane it so yeah the
question why do we want a new version of
Jane adore or do we need a new version
of Jane it so the impetus for change is
that Jane of four was released quite a
long time ago actually over a decade ago
now so there's the 400 release right and
a lot has changed since then and in many
ways first up testing needs have have
matured so what we do in terms of
testing has has changed we aren't just
writing unit tests anymore and one thing
that I often tell people is it
don't take offense but JUnit is a
horrible name why would I say that
because pretty much everybody raised
their hands when I asked who's writing
immigration tests right and sometimes
you see people saying well I'm writing a
JUnit test and what does that mean a J
unit test you're testing maybe your unit
testing maybe your integration testing
maybe running some kind of functional
test acceptance as stuff like that so
our needs have have matured right we're
not just testing one single piece of
code where oftentimes testing with real
databases or real smtp servers or maybe
mocked or in-memory databases and stuff
like that right so our expectations have
grown in terms of what we expect and
desire from from a testing framework we
don't want a unit testing framework so
to speak at least that's not what i want
you want to hear from a lot of people in
the community right so jane it
originally was focused on unit testing
and in order to make it work well with
integration testing third-party
developers had to do a bit more than
they probably should have had to do for
example if you look at the code that i
had to implement for a runner to get
spring integrated or the rules i had to
write to get spring integrated with j in
it that's more work than should be done
and if you go look if you're interested
in the code base if you look at the the
spring extension i'll talk about later
it's like ten times less code
to integrate spring into jn-25 now so in
terms of modularity hopefully people
keep that in mind framework should as
well if we look at jana for it's on
basically a big ball of mud right so
there's only the j-unit jar and I'll
point that out again
a bit later on so just one jar that
contains everything what you need to
write your own tests what I des need to
to run the tests all this kind of stuff
and what extension writers also need to
extend the framework so with that led to
is basically on the test discovery and
execution are tightly tightly coupled
right not very modular I'm still just
you know this one this one jar this one
module not easy to change stuff either
extensibility there's a lot of room for
improvement in jannat for so there is a
core support for that we'll talk about
that but it can be improved and that's
what we hope we have done well in Jane
2:5 and last but not least let's not
forget Java 8 right so I don't know how
many people are familiar with it but um
Jana 4 is still building on Java 5 right
has been yelled quite a long time ago
right so not even able to make use of
things like streams or lambda
expressions and stuff like that so terms
of Jana
how many people know that there's a this
Runner API and Jane it okay maybe maybe
half maybe you've seen it from like
mojito or from spring or something like
that right so this Runner API is in fact
very powerful that's good thing it can
do anything but you can't combine
runners it's just not not possible right
so they're not composable so for example
if you wanted to and many developers
have one or two of the years use the
parametrized runner to have parameterize
tests with Jana 4 and spring support and
it's runner it's just not possible
because you can only say run with one
thing you can't say run with two things
so the next up next step in the
evolution of Jana 4 it's kind of a joke
here at the top right so you can read
this three or four days everybody in
those rules our main street booking
right or you could say Jenna four rules
if you're really into Jane 4 where you
can read the whole sentence Jane it for
rules are meant to be broken and I would
say they actually are broken and have
always been broken unfortunately so Jane
4 7 introduced what's known as a method
rule which you can configure with that
rule
and J and 4/9 came up with a test rule
which you could configure with that rule
for method level indications and a class
rule for class level indications so
these are great for um simple use cases
some developers even have written their
own over the years so not too many
people written a runner but a lot more
people have written a rule because it's
easier to write and you can combine them
right you can have them kind of nested
if you want you can have like a chain of
responsibility if you want but one big
drawback here is a single rule cannot be
used for both method level and class
level of callbacks which is something a
lot of frameworks need right so if you
look at the the support I've written for
spring over the years I had to kind of
fake it or hack it to get it to work
plus with rules there is literally zero
support for what I call instance level
callbacks so that's where you would want
to do something like inject dependencies
right from like juice or spring or
mojito or something like that so again
that was another way that um Extension
writers had to kind of hack and change
to get that to work case in point it's
two classes of written for spring spring
class rule and swing rule if you want to
use some kind of custom run or like
parameterize and then use spring support
you can do that with Springs rule
support for Jana but you have to declare
both spring class rule and the spring
method rule and I would say that some
it's bad it's error prone just leaves a
lot of boilerplate copy and pasting that
we would like to avoid and with Jana 5
we can in fact avoid that so um another
show hands who had heard of Jane at 5
before that walks oh not too many people
ok maybe 5 10 percent who had heard of
the jane at lambda campaign fewer that
would be expected ok so maybe three
percent right very few all right so then
I'll tell you a bit about it what
happened was there are some guys working
on June 4th johannes lincoln mark philip
and of course all the people in
community thinking we really need to do
something with jane right but they
looked at Jane before and they're like
well well we can't really do much with
it because it's still on Java 5 wouldn't
want to break back some ability so when
the I des and everything build tools
that are tied into some of the internals
which is pretty horrible like working
with using reflection to access fields
so they started this campaign called it
lambda because they wanted to support
stuff like lambda expressions job 8 and
things like that
and then this team was later joined by
Matthias mÃ©rida Stefan Berchtold and
myself
Sam Brandon that was all last year so we
did the UM campaign online from July
through October 2015 and we raised
almost three to four thousand euros from
over 400 individuals and companies it
sounds like it's lot of money
unfortunately isn't as much as you would
think due to fees and taxes and travel
costs and hotel costs and these kind of
things without because we had meetings
in person anyway we did get quite a bit
done for the the prototype in addition
four companies donated six weeks of
developer time and have pivotal listed
here as having donated the most a
development started donated cash and
developer time so if your name is on
this page or a company you work for
thank you very much it helped quite a
bit to get us up and going we started
off with a kickoff team last October
with some some big names in the
community so we had a developer from
Gradle IntelliJ and clips there as well
as these our other developers core
developers working on Jane 2:5 itself so
now actually diving into j-unit five the
roadmap just kind of give you an idea of
where we came from and where we're going
again we started off with this prototype
immediately after that kickoff right and
we delivered that on December second
last year so that's just a tag in the
repo on github then we did a lot of work
reworking stuff deleting a bunch of
stuff taking feedback from the prototype
and release that this February so that's
all
something some people have consumed and
used more importantly five months later
took us a while right since the campaign
funding ran out people working in their
in their spare time but in July this
year we've loosed a milestone one with
lots of changes to the internals
breaking it all up into kind of three
different categories which I'll talk
about in a few minutes m2 came out a few
weeks later with some some big bug fixes
and we've been working on m3 since then
we planned on releasing it on Halloween
a few weeks ago that didn't quite happen
so working on that now we're hoping to
get something like a milestone three and
four out maybe this this fall summer
these candidates early next year and
then getting hopefully final GA release
q1 next
so that's that's the plan now so Jana
five in a nutshell what is it we like to
think it's modular at least we have
modules right so let you be the judge of
that
extensible so that was definitely a main
focus here in contrast to it agenda for
we also like to think that it's modern
in terms of how things are structured
and also the things we support like
lambda expressions and these kind of
things
another thing that is it's a what we
call simultaneously forward and backward
compatible might sound a bit bizarre but
when we met as a team we decided well
the adoption is really important right
so people are out there right now
running their Jana for tests right maybe
Spock something else we're still running
on the Jana for infrastructure and we
know the I des aren't going to give us
support and the bill too is not gonna
give us support immediately right
because first Jana five has to be
popular before they're going to support
it's kind of like a chicken and egg
problem so we came up with the way to
basically make sure that the platform we
talk about that supports Jane at three
four and five all the same time and any
future versions so if there's a Jane at
six out later something like that and in
the new testing frameworks so for
example Jana Jupiter will talk about
that that's a Jane at five program model
you can run it on top of the jane at for
infrastructure so that kind of solves
this chicken and egg problem and the way
you do that is using the at run with
annotation from jana for and this jane
at platform class we see here so that
actually launches the new stuff all the
new stuff Jane at five on top of J and
four and I actually do that in Springs
core Springs build because we have
testing support for our Jane to five
support but we're using Jane at four and
all the build infrastructure there so I
just run the test like that and it just
kind of um basically makes it look like
it were Jane at four tests it's kind of
a workaround for the time being so
another thing if you look to Jane to
five early on it was all one kind of big
project though modular and for m1 what
we did is um we had a lot of internal
discussions what's the best way to go
forward to actually module eyes this and
we came up with the notion of jana v
it's not one thing it's actually a
platform it's Jane Jupiter and it's Jane
at vintage so in the past chain of four
was was was all the stuff right it was
the probe
the extension model the platform the
discovery all this stuff was one thing
we figured we need to actually split
this up so these things can evolve on
the different rates over time so first
up we have the jr. platform and we're
calling this version 1.0 since it's
never existed before complete rewrite no
code no code taking it all from from
jayne-ann 4 and this is the foundation
for launching any kind of testing
framework that runs on the JVM so you
can think of a JVM right for running
stuff like Java : groovy right and now
this Jana platform is a platform running
on top of the JVM that allows you to
write other testing frameworks and then
we also have the launcher and test
engine API as we'll talk about in a
minute as well beyond that there's a
console launcher we have support for
Gradle and an maven and then we have
what we call J and Jupiter so this is
what you might want to think of as Jane
at 5 if you want to but we didn't want
to run into the issues that we had in
the past with like J and it right so
Jana 4 includes Jane at 3 in the jars I
don't know if you're familiar with that
but that is the case we figured we don't
want to tie it to a number J you know
Jupiter is a new programming model it's
a new extension model and maybe we end
up releasing version 6 of that
programming model or ascension model so
right we don't want to call it Jane at 5
itself in case you're confused about
that and which planet is the fifth
planet from the Sun anybody know Jupiter
all right and it also starts with J you
so kind of sounds nice so Jana vintage I
voted first we're calling it legacy but
we didn't want to offend too many people
so I thought retro might also work as
well but we call it Jane at vintage
officially so that's given the same
version number as the most recent
release of Jane 'add for itself and that
is basically a test engine that's
responsible for running by Jane of three
and J and four based tests right so you
can still run your old Jane 3 test even
when you're starting with starting to
use Jane of Jupiter you can run your old
Jane for test your spot tests etc no
problems there well we hope they're no
problem you have to test and let us know
so this launcher API what is that that's
used by IDs and build tools to surprise
launch the framework right so
to get it all bootstrapped and up and
running and actually execute the tests
so that's the central API for first off
discovering tests like are they in
classes are they and maybe XML files or
JSON files or something like that and
then finding one or more engines to
delegate to to actually execute those
tests for that we have what's called on
the launcher discovery requests you
wouldn't use that on your own probably
unless you're doing some really
low-level this is something more like
with IDs and build tools are going to
use but basically it has couple of
things you can configure you can figure
we call selectors and filters so the
selectors are the things that select
what you want to run like you select a
class or you select one method or a
couple of different methods and
different classes or maybe select a
package for classified scanning and say
run all the tests in this package that's
very Java centric right so what we've
done building up in this mm3 releases
coming out is we're adding support for
selecting other types of things like
selecting a URI or selecting a directory
in the filesystem or a file in the file
system or maybe some some file in your
in your class path that's a class path
resource and this opens up the selection
to other types of testing families that
might work is something like XML files
right there's not just focused on on
Java classes and methods and stuff like
that and filters obviously allow you to
filter stuff out say like only classes
whose names match this pattern or only
things in this package only things with
these tags stuff like that so you will
see some reflection of these selectors
and filters when you're configuring your
build for example with with Gradle or
maven yeah so that will come back and
play there in terms of um feedback while
things are running and Jana for you
might have known though the run listener
in Jane of five in the platform we have
what's known as a test execution
listener API if anyone's looked at
Springs testing support there's a class
of the same name but they have different
purposes so don't get confused there
this is just a way to get receive events
about what's happening to generate
reports and stuff like that and last but
not least there is a console launch or
implementation that allows you to launch
the platform on your own
if you want to do some kind of scripting
whatever there are some people that want
to do that so we have command-line
support as well if you're not using
Gradle or maven so this test engine API
you can think about it's somewhat
analogous to what a runner was in in
Jade for but a slightly different focus
so it sessions and what it does is
responsible for discovering the tests
that it is then later going to execute
and that's for a particular programming
model so the Jupiter one is not going to
run any of the Jane two for once right
and and the other way around
similar okay now how does this these
things get picked up that happens
automatically or automatically however
you want to look at it using the
standard service loader mechanism from
from Java so if you have a test engine
in the class path and it's configured
correctly for the service loader you
just have it there and then the Jane
your platform is going to automatically
just find that engine and automatically
ask it to detect test and then execute
them so it's kind of kind of magical so
maybe you get them some support for for
calling they're having a framework
they're going to work on their or spec
to you something else you put that in
the class path and it's just going to
work with the platform and that's what
goals we have is that other people can
also write their own testing frameworks
and have it automatically supported on
the Jane of five infrastructure so no
surprise for the Jupiter API and
extensions we have a Jupiter test engine
and we also have a vintage test onion so
again this is the one that there runs
the jane at four and jane of three code
or spot code and stuff like that or you
can implement route as i mentioned
people have have already started doing
so that's that's pretty cool and we're
happy to see that now for a bit of the
big picture here we see in the middle we
have the j-unit platform right and above
that we have different testing
frameworks so we have the the old-school
stuff vintage here right so Jane at four
and Jenny three stuff like that we have
the new stuff with Jupiter here and then
something else
third-party for example there's
framework out there called spec see that
already supports its own kind of a spec
testing framework with Scala groovy or
Java and it does that with them the API
is for for Jane in five and on the other
side
you have the IDE S&amp;amp;N build tools that
are interacting with the platform so now
if we look behind the scenes what does
that actually look like we see for
vintage we have Jane at for Jane to 412
right so that's that one jar that one
big fat jar that does everything with
Jana for and just for comparison sake so
all the new stuff right so Jane at the
platform is this code in here right and
the new programming model and extension
model that's all in here so all this
modular stuff was just this one big jar
in Jane at 412 that's why I'm talking
about how it's been modularized and
split up so that these things can evolve
separately so for new tests you can
write new tests and you're only
programming against the jane of jupiter
api you actually don't even care about
the test engine or anything else in the
platform you just care about basically
the annotations or if you're writing
extensions you care about the extension
api's and that's what this other
framework has done over here so spec c
has its own API and its own engine and
these things implement stuff from the
Jana platform engine the launcher finds
those execute them and then we have
these build tools rights we have the
cradle support sure fire support for
maven we have this platform runner
that's that that J Union runner I talked
about we also have this console launcher
and these things all interact with the
launcher API directly so that's kind of
the big picture in terms of modular
modularity so in terms of IDs and build
tools if you're using IntelliJ IDEA
you're in luck they have first-class
support for Jana 5 more specifically
j-unit Jupiter since version 216 2 and
and higher I'll be demoing later on
hopefully some some examples with 216 3
early access program Eclipse surprise
they joined the bandwagon last week
right so I just I just downloaded
installed it um
if you download 4.7 m3 and install some
some beta code you can see how they're
there Jane it support gain of five
support works in eclipse and I think
it's a quite nice actually and in both
IDs already at this point NetBeans
I have no idea Gradle so we have our own
interim solution from the Janie team
that we've written
it works it's not the best and we
actually don't want to support it
forever so we're really hoping that the
the Gradle team will at some point take
it over and if you want to see how that
works you can check out the user guide
or you can even look at our own builds
because we use our own Gradle plugin to
run our own j25 tests to run to test
chain of five so yeah we're using June 5
to test unit 5
maven we also have support for that
initially started by the Janie team
itself and it's in the process of being
taken over by the maven surefire team so
we'd like to see that get taken over
totally there so we can stop having to
having to deal with that and have
someone better skilled at that and again
for this as well check out the user
guide or some of the sample projects so
in terms of the extension model for
Janie Jupiter right so this is not an
extension model for the platform itself
this is an extension model specific to
when you're riding tests against the new
J and a Jupiter API so first up we have
extension that's just a marker interface
and then that's in the org Jane at
Jupiter API extension package and then
in there you can see all the options for
the extensions you can you can run in
your own one nice thing right so these
things are composable it's a mentioned
before with change for write you know
you could only have one runner a rule
couldn't implement the the two types of
rules write the method rule in that and
the test rule but with Jana Jupiter you
can implement as many as you like and if
you'd like to see an example the spring
extension implements almost all of the
extensions right so these things are
easily composable and if you want to
register one you remember with Jana 4 we
have the runner so it said at run with
this runner and with on Jana Jupiter we
kind of took the same notion there but
we have extension so we say at extend
with one or more extensions and you can
declare that on on interfaces on
something you couldn't do an end date
for it you declared on on classes and at
the method level and very likely at the
the field level coming up in in
milestone for as well and last but not
least is also very important to me until
a developers you can use it as a meta
annotations
you can create a custom composing tation
and for those who don't know what a meta
annotation is a meta annotation is an
annotation declared on another
annotation in the source code so spring
is always kind of had this support and
you can find numerous complaints and
questions on Stack Overflow why can't I
use Jane it's at room with blah blah
blah as a meta annotation with the
spring stuff it's because it didn't work
because Jane 4 didn't support it but all
of the annotations that we have that we
use in in Jane of 5 or Jane and Jupiter
those are supported as meta annotations
so you can declare them as min
annotations in Jane it will find them so
in terms of these api's first up we have
what are known as lifecycle callbacks so
these are analogous to the annotations
we'll see in a minute as well
we have before all callback in this kind
of a wraparound right so you have the
before I'll callbacks in the end you
have your after all callbacks and at the
next level going down to the test method
level so the first level is actually
more the container level or the test
class level if you wanna think about it
like that then we have the before each
and after each and again those those
wrap around the execution inside and
then the lowest level we have before
test execution and after test execution
so this happened those get invoked right
around the invocation of your test
method so if they're a little line here
this would be your actual test code
executing there but see these are all
the options that you have as you
ascension so you see even with the
lifecycle callbacks you have a lot of
points you can tie into the next topic
is what's known as on conditional test
execution we have that at the the
container level and at the test
execution level so the test is going to
be like the test method and again the
container um typically is going to be at
the class level next up we have what's
known as a test instance post-processor
if more spring you might've heard of
bean bose processors so it's not too
different from that basically this is
this instance level callback that I was
saying never existed in jenefor and in
Jayne at 5 and J and Jupiter we have
explicit support for that so the Mojito
extension we've written and handing off
to their own Aikido team uses this the
spring extension uses this there's some
where to write something like juice
extension it would also use this right
so that's how you could do dependency
injection at the right time parameter
solver we'll talk about that in more
detail but that's on
dependency injection as well and test
execution exception handler so that's an
exception handler around the test
execution so it's actually going to be
called right before that one there so
that allows you to log exceptions or
maybe swallow an exception something
like that so that's it for the basics of
the extension model now about the
program model what maybe more of you are
more interested right what are you gonna
be using on on your daily job these
things are found in the org Jane at
Jupiter API package and the J and
Jupiter API module right so for your
maven coordinates and in there we have
annotations and support for meta
annotations support for assertions and
assumptions custom display names
visibility like to mention that so jana
for everything had to be public and Jane
and Jupiter we don't care as long as
it's not private we'll still find it and
we're gonna go get be a reflection
anyway so you don't have to put public
on your classes and methods and stuff
like that tagging is a new feature at
least first class within the platform
itself but also first class within the
Jana Jupiter
programming model so Jana forum did have
something similar with categories but it
was always on kind of experimental
conditional test execution I mentioned
that before
dependency injection not only for
methods but also for constructors if
you're into that kind of thing we also
support land expressions and method
references and in various places and
interface default methods so who's
actually on Java 8 alright maybe 60%
that's good so hopefully these last two
points aren't aren't too confusing to
too many people
another feature there's popular and
someone the community people have
written their own runners for Jana for
is the notion of um nested test classes
and we'll look at that more details
later on last one at least dynamic test
is something that some pretty cool and
rather popular that uses lambda
expressions to register tests
dynamically so in terms of these
annotations we have an @test annotation
I know everyone's probably really
shocked about that right we couldn't
come up with a better name so we just
stuck with tests but it is and in
different package right so don't don't
get confused when you're starting to use
June Jupiter
we also have an at test Factory so
that's where these dynamic tests and I
have grayed out here on the right and
testable you wouldn't use it on your own
but if you're writing your own test
engine you would want to use that and if
you're interested not just check out the
documentation for that so some things
we've done a little bit differently we
came up with different names for the
lifecycle annotations so instead of
having them at before not after we have
or at before class and not after class
we have at before all and not after all
so that's for all the tests within that
container and then at the next level
instead of that before and after from a
and at four we have before each and
after each and then we have something
totally new so at display name you can
provide a custom display name we have at
tag to set these tags at disabled
instead of at ignore because we talked
about conditional test execution there's
a result from that and it's the things
either going to be enabled or or
disabled so ignore didn't didn't make
any sense anymore and then we have this
add nested annotation for these nested
test classes so it's urchins at first we
thought maybe we'd only want to have
assertions at all as in we don't want to
implement them right because they're
such you know good libraries already out
there but then we ended up implementing
quite a few and we keep adding some but
we we promise not to go overboard these
are all in the assertions class limited
set of core assertions of course we have
stuff like assert equals assert not know
we also have some some cooler things
that weren't in the JUnit 4 support so
we have assert throws for starting an
expected exception to be thrown by a
code block which is a lambda expression
or a method reference we also have
support for timeouts so instead of doing
that as a rule or at the on the test
annotation level we have assertions for
that and you can basically assert that a
timeout is not exceeded for a given
block of code that you provide as a
lambda expression by default the first
one is just going to be lazy she's going
to wait on it to finish so if it hangs
then your codes gonna hang in cases
where you think that it might hang you
could switch to a preemptive timeout and
that's going to basically kick it off in
a different thread but the reason you
wouldn't want to do that always is for
sample if using something like spring
has a test transaction management that's
balanced to a thread local so if you
spin off a new
read then your test transaction will not
be visible to your test code kind of
defeating the purpose that's why there's
the two options here another really cool
thing is assert all you might have heard
of soft assertions from cert J right
something like that so you can assert
multiple things at the same time
providing them all as a little
executable land expressions and then
jegging it will execute each of them and
catch the exceptions read to them and
then report all of the the assertion
errors at one time right so if you have
some code where maybe maybe your equals
is limited only to something like a
primary key or something like that and
it's not checking all the fields but you
want to check all the fields and some
kind of domain entity then you can
assert all of them and one and have all
the errors reported in one go another
thing that we've done we've used or
started making use of more functional
programming right things like that from
from Java 8 so instead of just providing
a string for you for your error message
when your assertion fails you can
provide that as a supplier of string so
that can just be lazily evaluated why
would you want to do that well what if
you're on string concatenation ends up
being expensive or looking up stuff in
some files for for better debugging
purposes you don't want to build up that
failure string if there's no failure so
that's why we allow this to be done
lazily now and the other thing might
catch off guard unless you use tests in
G the message is now the last parameter
so you're gonna say stuff like it's read
equals a and B and then give the reason
at the end instead of putting the reason
at the beginning in terms of the the
method parameter list and of course if
you need more power and there are many
times you will we recommend that you do
use other frameworks right so use
something like a search a or hamcrest
you know something more powerful with
mashers other stuff like that so now I
will see if the demo gods are on my side
I am showing you this is the the beta
work again just released last week so
for your clips for seven milestone three
and I should be able to create a class
devoxx tests again doesn't have to be
public if you don't want it to you can
create a test
do not pick the or gain one that's Jana
for I mean you can if you want use ten
to four but Jane of five Janey Jupiter
make sure you pick the right annotation
there and void also doesn't have to be
public right so you can just say first
test and I'm not gonna do anything
exciting here I'm just going to run the
class right so we see that it ran the
class it just looks like a normal chain
for tests this is all quite good pull
then a second test this shouldn't be a
surprise either right it's just gonna
show both I just wanted to show that uh
they actually already have support in
here for executing individual tests with
with Jane at five
Jane to Jupiter so that's also a good
support there so in terms of these
assertions right it shouldn't be
surprised there it just make sure you
pull them from the right assertions
class so we see here at the top that's
coming from the Jupiter assertions class
and that no surprises there right but
what about something like in an
exception right so what is gonna be well
this is not the most recent version
there's an expect throws right expected
type and we could just say something
like such an class and this is what I
thought about where you can just provide
some code right so you can say I have
this block right some kind of land
expression and if I run this says is
it's going to fail because it's gonna
say expected an exception to be found
but nothing was thrown right so now if I
have a new exception all right yep
if I run that now now the test passes
right so that's nice right now what if I
want to actually get to the exception I
can assign that to a new local variable
and I can just say exception and then I
could say something like assert true
exception message equals foo right we
hope that this runs right so that works
so you can get hold of that exception
and in such situations you might
actually wanna use something more
powerful like like a sergej for example
but this is quite nice in change Jupiter
another thing what about timeouts right
so I mentioned there's these timeouts so
you can say assert timeout needs a
duration and I have let's say something
like milliseconds I don't know 50 right
and again we need some kind of code to
run here so if I run this hopefully that
code takes zero time so it's not going
to cause it to fail right didn't see the
timeout but what if I tell it to sleep
for a bit and I tell it to sleep for 55
milliseconds then what is this thing
here yes better all right so that failed
right so exception exceeded time out of
50 milliseconds by nine milliseconds
okay it's not an exact science there we
don't know where the other 40
milliseconds came from but the point is
it took longer than we expected and
again the other option would be to have
assert timeout preemptively if you'd
wanted to do that and again that would
run it actually in a separate thread
that would execute this code block in a
separate thread but so what if you don't
want this to be um you know just a
lambda question like that you're right
you could just have a standard Java 8
syntax like that or maybe you have some
some method you're invoking in your
service layer maybe it's a I'd seriously
done that's called taken out but maybe
it is called take a nap right so you
could have that something in to make a
new service layer actually testing your
care you want to make sure that it
runs fast enough so there's a kind of
the basics there
next up assert assumptions right moving
on who's actually heard of assumptions
in Janet 4 okay that's more than I
expected so 10% so assumption is
something that you assume to be true and
if it's not true then you want to just
abort the test immediately and that's
been an engine for for quite some time
and this is an in the assumptions class
in J and Jupiter again similar with the
assertions we didn't want to go
overboard so we have a very limited set
of core assumptions that you can use and
for those we have for things like
assumed true or assumed false where you
need in some kind of condition we also
have support for on boolean suppliers
and suppliers of strings so if you want
to use method references and stuff like
that as well in addition we have
something a bit more advanced so you can
say assuming that this condition holds
true then execute this this block of
code that you can provide as a lambda
expression so why would you want to do
that we do something similar and maybe
only one place and the spring core
testing framework but we have one thing
where if it's on the CI server then we
want to run an additional bit of code as
well and then otherwise run the rest of
the code always so that's why you would
want to use something like that now in
terms of assumptions
this is programmatic this is inline if
you want to reuse it of course you could
create some kind of utility method but
then you might copy and paste that
across your codebase right so we'll see
later on with conditional test execution
custom annotations meta annotation so
like that you can actually provide a
different kind of more flexible
reasonable mechanism for this based on
conditional test execution
instead of programmatically it ends up
being coding in but in terms of the API
or the user experience it looks like you
just you know add an annotation there so
quick example with that
so you could say assume true and put
false right and then if I because I'm
too lazy to type
so normally fists Cober to execute
except it's gonna complain yes right all
right if the assumption we're not true
right this would uh thank you
right so that pass right that means this
code never got xqd right you could have
something more you know assume that uh
two plus two equals five who thinks
that's true
wait a minute yeah yeah okay sorry I
didn't rehearse that one obviously so so
now the code gets executed right so now
we could uncover the rest of this but
that's that's one way you can have these
assumptions baked in or you could do the
assuming that stuff like that all right
so test names who has ever wanted to
have a test name other than just the the
method with the name yeah so if you use
something like Spock right so with
groovy that's that's already possible
but with with Janet for typically not
right so um by default the names are
gonna default to the detest class or the
tested method names and the same is also
true and Jane and Jupiter so the
characters gonna be limited based on the
Java syntax right so in Jane you put the
answer to that is a at display name and
you can use that to provide custom
display names so just for the users not
not technical names and these things can
contain spaces special characters and
even emoji right I know this is usually
gets the best claps we'll see if it
happens here
dependency injection so things like
mocks right injecting mocks or injecting
beans from spring application counties
that kind of stuff this is one place
where we like to say the extension model
meets the program model right so come
and come from both sides there somebody
writes extension and you get to use it
and for that we have this parameter
resolver extension API so each prema
resolver is asked do you support this
thing and if yes then please resolve the
parameter the parameters that is the new
one right the new reflection API from
from Java 8 so that's a parameter either
from a constructor or from a method and
yep so this applicable not just for for
at test methods but for other kinds of
methods as well like your test factory
methods constructors your map before
each methods stuff like that
you can register multiple V's
simultaneously but only one of them wins
if two of them say they support it ends
up being an exception because Jen you
wouldn't know which one to ask to
actually resolve the parameter typical
use case
I mention my twin inject like a mock or
you might want to inject some kind of
server URL where you've set up your L in
your extension anyone might make it
available or port number something like
that maybe a data source for an embedded
database maybe the application conducts
from spring and we'll see that an
example later on so a lot of times
people wanted to find out the the test
name or some test information and I'm
jaded for that's possible with test name
it was also possible back in Jana 3 in
certain scenarios but in Jana Jupiter we
have test info is you can inject this
into your constructor at test that forge
methods etc and that gives you access to
stuff like the display name maybe the
technical one or maybe the the custom
display name it gives access to the tags
the class is currently executing the
test methods currently executed etc and
for that we have an implantation of this
brand resolver called test info
parameters over and that's registered
for you automatically by default so you
don't have to do that on your own again
eating our own dog food why do I say
that another goal we had with Jana
Jupiter and Jana 5 is that we didn't
want to implement things and say well
we're not gonna let anyone else benefit
from this this functionality so whenever
we came up with an extension point so
far we've made it a public extension
point that anyone else get Manipal int
and we also implement it ourselves so
here we're doing that
see also test reporter that allows you
to print or report additional
information based on some code executing
in your test method on the Mojito
extension again we've written that and
we're handing it off to the Makela team
and the experiments Pring extension does
this this stuff as well this parameter
resolution for dependency injection so
display names and dependency injection
quick demo here so this thing which is
called first test right and what if I
wanted to change that to something else
maybe not it's so exciting it's gonna
fail anyway but the point is it has a
custom name I don't know anyone see that
very small print this is my first test
so that's there you can do that you can
use other special characters
space and stuff like that and for the
next one I don't know how to personally
um let's see
type emoji in Eclipse but I know this
trick so let's see what people think
about this I have now copied an emoji
I'm going back and now I know what's
gonna happen who thinks they will show
up alright so yes you can use emoji very
exciting it doesn't work yet in the in
intelligent sorry it just shows a like
blank spaces but maybe they'll get
around supporting the emoji as well I
mean you can type the emoji in it just
it doesn't actually display them in the
tree but our Gradle support and our
build support they also I'm Prince and
the generated XML so even on your CI
server you can see the emoji I can't
think of too many useful things other
than maybe something like if you're
doing locales right and you have
different flags for different countries
representing locales that might work or
you could say like this method is a pile
of something and use a particular emerge
you for that but um I'm not going to
demonstrate that okay oh finish
injection I do not show that so I said
there's this test info thing right if I
can type test info test info and I'm not
gonna do anything exciting with it other
than put it out
so what
uh-huh that looks much better yes so
this is the test invert the display name
this is the the custom display name
right we saw there
there aren't any tags I could add attack
if I wanted the the class I fixed this
was a bug you no longer uses the
optional actually shows you the real
class name also giving you the test
method that's there and the method
signature so yeah if we had tags
somebody maybe you want to do that we're
gonna if I run that again I assume it
will show that the tags are there yeah
so it puts a list of the tags in there
as well and again with the makita
extension you can use at mock here for
examples I have the mock injected and
with um spring you can inject stuff like
from from the application conduct
application kind of say itself so um
egging well kind of go ahead myself
they're basically just declare at tag on
a test interface class or method for
example at tag fast test we just saw
those some working I didn't show you how
to configure the tags you can do that
from the the Gradle configuration or the
maven configuration and hopefully in the
near future also within Eclipse and
IntelliJ to set that up so custom tags
what if you don't want to copy and paste
this at tag fast everywhere hopefully
you don't want to so a custom tag is
pretty easy to do you just declare tag
as I met annotation on your own custom
annotation so here we have public ad
interface fast MIT annotated with at tag
fast and then we can just use that on
our test method or on our test class if
we had included the the type element
type there at the top so here we have
now at fast and not test and you could
have maybe at fast at smoke at
integration at CI server these kinds of
things but you can also go one step
beyond that and this is even more more
powerful I think a lot of people gonna
like this so you can compose tags right
or you can compose your annotations
declaring tag again as a meditation but
in addition alongside other annotations
maybe from Jayden maybe from spring it
works out quite nicely you have to make
sure the frameworks you're using also
know how to find annotations as meta
annotations and spring does that and J
and Jupiter does that so it's a nice mix
here here we see at tag
fast and @test and now we're saying this
thing is fast test so we can type even
less across our code base using at fast
test like this and I'll show you later
on with spring you can do even more so
the next topic is this conditional test
execution again I said it's something
kind of like the assumptions right but
it's more of a reusable approach more of
an annotation based approach again this
is another place where the central model
meets the program model right so
somebody writes an extension maybe
someone in your team and you get to use
it as you write your tests the two
levels right the container level which
is like the class or the test executions
for that test method level and at
disabled is actually on basely an
implementation of this right and behind
the scenes there's a disabled condition
written by yours truly that implements
both of these these api's so it looks to
see is the class disabled then don't run
any of the tests in it or a particular
test method is disabled then don't run
it and just looks to see if at disabled
is there so that's the simplest case you
could have for this but you can do other
things like check an environment
variable like am i on the CI server or
check your IP address or something like
that and the funniest one I've heard and
a blog a guy said well we have this one
really flaky test it fails sometimes and
my boss won't let me leave when the CI
server fails on Fridays so if it's
Friday afternoon just don't run this
test I'm not saying you should do that
but I'm saying you have the power to do
that so yes and another nice feature
wasn't really possible in a jain at
least it wasn't intentionally possible
there was a workaround to get it to
ignore at ignore but with conditions you
can tell Jane at Jupiter to deactivate
these the either a launcher property or
a JVM assistant property that's named
Jane it conditions deactivate and then a
pattern that is similar to a regular
expression you can read the
documentation for the exact diesel
details on that but for example if you
wanted to disable all of the conditions
from Jane itself you could say org dot
IO dot star if you didn't want to use
Springs for some reason if you wanted to
see you know we had this one test that
was failing on the on wasn't working on
local dev machines I want to see if it
still
works or if it works now maybe it got
fixed then I could deactivate that and
run run the test suite locally so you
could also disable something like org
duck Spring Framework dot star stuff
like that so interface to vault methods
right so this is a new feature in in in
Java 8 right introduces or allows for
the concept of what I like to call a
test interface basically allowing you to
have a multiple inheritance in your test
classes maybe you're not interested in
all but there are times when it can be
useful and this is um what else like to
call testing traits try to do four
familiar with traits from other
programming languages so you can use
this with before each and after each you
can't use it with them before all in
after all because they have to be static
and those can't be default methods you
can use this without test methods at
test factory methods with your tags
extend with etc and the string tests I'm
going to just show that very quickly
just so you have an idea of what that
kind of looks like right so we have this
string test and it just it just
implements it doesn't actually have any
test methods there's no death message in
here right but if I run this it's gonna
have some some tests that are executed
right so return zero valued is not equal
and where are these things they're
actually in interfaces so we look at
string tests it has a comparable
contract that implements and an equals
contract so then you can kind of pick
and choose different testing traits that
you've written across your codebase this
should be applicable to multiple things
maybe not optical to it all all things
and then you can just uh implement the
the tests right as default methods and
then maybe have a non default method
right so you had an abstract method that
the classes have to actually implement
so if I wanted to see the implementation
string test does actually implement that
in return return Baz so that's kind of
how that can be used next up is this
notion of nested test classes again
there was some custom runners for Jane
afford to do that now it's built into
Jane Jupiter this baby enables them what
we call logical hierarchical grouping of
your test classes so not just having
them in different packages but having
them in the same physical Java source
code source file right and in addition
they have shared initialization
state from outer classes like so going
from outside in the way you do that you
just declare out nested on non-static
nested classes aka inner classes you can
even combine this nested support with
the the test interface support with
these traits for something even more
complex use cases where you want to kind
of reuse well trade features and and
state so see the testing a stack example
in the user guide I will again show this
in just very quickly not going to write
it all for you but we see this is more
the the BDD style that's why people kind
of like it so using um you know real
language here a stack then we have is
instantiated with new stack right we
have some nested functionality so we
have this when new then then do this
stuff and then within there we have
additional we can have additional nested
so after pushing etc and so this nice
combination of at nested and at display
name if we execute this you see it looks
quite nice actually so here we see a
stack is instantiating with new stack
and when it's new it's empty after
pushing an element it is no longer empty
so you can have this kind of BDD style
with Jana Jupiter
alright dynamic tests so conventional
tests are what we call static right
there they're known at compile time
right you right in the code may be using
something like parameterize Runner but
still you could look at it and say okay
I know it's gonna produce these ten
tests right something like that and you
dealt with that test methods but a
dynamic test is registered at runtime
literally dynamically as a land
expression in a stream collection etc
and that's by in we're done in a method
annotated with at test factory so don't
put our tests on there but put a test
factory on there and this is somewhat
analogous to parameterize tests but with
a parametrized test the thing doing the
parameterization is outside of your code
it's some extension maybe you configured
with annotations but it's out of your
control and with the dynamic tests
you're controlling what you want to be
generated as a test so this I'll also
show an example might make it a bit
easier to understand
so let's do that in the actually let's
say we want to have a return a stream of
dynamic tests and we want this to be a
test factory and this has to return
something right so we could do return
stream of something right and we could
say dynamic test it's a static method I
could just say well um foo not very
exciting I know you're all wondering why
can you come up with something more
exciting that food
so we could say did I it's all looks
good yep now if I run this we see
deadlocks tests and then second test
this is our factory method right and now
we have this is now a container
something differents underneath that we
see this this foo does foo method and
what if we wanted to add a couple more
in there right we could say and then
have one that fails and not maybe not
call it foo but bar I know very exciting
so now we see second test and we see
food passed and bar failed and if you
click on bar it's just gonna jump back
to the method but if you click on the
exception the error then it actually go
straight to your to your lambda
expression so that'sthat's quite nice so
you can do this YUM I recommend you look
at the the user guide for more details
on this so you can return it stream you
can turn our collection and array
something I on the right sorry I list
something like that and you can also use
an iterator to make completely um non
deterministic test generation in your
code so what's missing hmm
lifecycle callbacks for dynamic tests
don't you at work so you're at test
methods get them but these little lambda
expressions they don't get all the
lifecycle callbacks and we're gonna look
to it to fix that truly parameterize
tests in the sense of the parametrized
Runner and Jana for or Jana prams
of that so I'm an external way to have
methods that are invoked parametrized
scenario tests this is something where
the the state is maintained across your
tests so chain it has traditionally
conventionally always instantiated your
test class anew so there was no way to
have any interactions between your tests
but sometimes you want the safe state
and the other frameworks like tests and
G support that so we're looking to add
that in Jana Jupiter as well also stuff
for like um running in a different
thread or parallel execution
those aren't there yet but we hope to
get that in before GA and anything else
if you give it a try and let us know
please create an issue so that we know
there's a demand for a certain feature
so that's it for the Jana 5 stuff and
I'm gonna have to speed up I've talked
to too much spring 5 and and Jana 5 so
the support for Jana Jupiter came with
Spring Framework 5 that om1 several
months ago and that supports all the
core testing features and springs test
contracts framework all the integration
system support in addition to
constructor and Method injection via at
Auto wired at qualifier and at value on
your parameters I'm and also very cool
conditional test execution via spell
expressions plus you can have your
application context injected and you can
figure that with nice simple annotations
this also works with spring famer for 3
I'm actually I started writing it on for
3 if you want to check that out there's
not anything you can um you can download
from from maven which you can check out
the code and build yourself that's on on
github here spring tests to change 5 in
my account so how can we configure this
there's a spring extension so right
spring previously had the spring runner
or the spring jana for class runner now
we have a spring extension just say at
extend with spring extension that class
and you get the spring integration
support if you want to simplify matters
this is a composed annotation at spring
Jane and config that combines the at
conditioned figuration with of the
spring extension and similarly for the
web support combining what we had before
plus your web app configuration so you
get a web application context loaded
with spring 5 and Jane and Jupiter all
at the same time pretty straightforward
stuff and the last part here this at
enabled if and that disabled ifs right
at disable discord Jane at Jupiter but
with disabled if we have support for
spell expressions within our
conditional execution so apparently I
don't have time for the demo on that
I'll step through you can check out the
source code for spring Raskin later
basically I have enabled on Mac
annotation the uses a spell expression
to see is the current OS it doesn't
contain the word Mac then only run this
test here you do stuff similar with
Windows like don't run this on Windows
or do run this on Windows pretty
powerful stuff there spring boot one for
that also works nicely with Jane at five
and some custom config so if you have
stuff like spring boot test some of the
new annotations there you can create
your own compose annotation here we see
spring events web test using this at
extend with that's the J and Jupiter
part right telling it to use a spring
extension and then we have the add
spring boot test so that's the spring
boot part auto-config that's also from
spring boot and the at transactional is
just a standard one from from spring
right so we see annotations coming in
from different framers here combine them
all into one and then we can just reuse
that across our code base like this so
we have an event controller tests this
is in my spring events demo app in my
account on get double if you want to
check it out it's actually running
actually works right spring boot one for
Jane and Jupiter spring five milestones
so then we have injecting the the
mocking BC instance that's Auto
configure by spring boot and so we see
then just using that within the method
so in closing resources Junod org slash
Jane of five we have a nice user guide
growing with each of these it's actually
very useful I recommend you read through
that Java doc is also there online as
well and of course on on github that's
the source code repository but we also
have another sister repository the Jane
of five samples with a few smaller
configuration samples for well this
makyo extension and the Gradle usage and
maven usage and if you have questions
just use the date at five tag on Stack
Overflow spring hopefully you know where
to find all that stuff if you don't
spring that IO and you'll find it from
there so times up that's the evening I
think we don't have time for questions
can ask me outside</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>