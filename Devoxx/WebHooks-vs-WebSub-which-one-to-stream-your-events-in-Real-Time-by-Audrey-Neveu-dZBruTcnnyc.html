<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>WebHooks vs WebSub: which one to stream your events in Real Time? by Audrey Neveu | Coder Coacher - Coaching Coders</title><meta content="WebHooks vs WebSub: which one to stream your events in Real Time? by Audrey Neveu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>WebHooks vs WebSub: which one to stream your events in Real Time? by Audrey Neveu</b></h2><h5 class="post__date">2017-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dZBruTcnnyc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone thanks for being there so
we're gonna see together which one you
should hope for between Webber can
what's up to streaming events in real
time quickly to introduce myself my name
is Audrey I am full stack developer at
Sergey which is a big data platform
available as a as a pass and ready to go
for your data engineers and data
scientist I'm although the collider in
France of the box for kids which is the
coolest initiative of the world but you
already know and you can find me on
Twitter with this sandal so let's talk
about real time which is as you have
probably noticed the real is a new gnome
so every applications you're using
whereas it's on your personal life or
professional life is using real time so
it's really what's user expect expecting
from us now and actually it is creating
some new funky things in our brain
that's created so mo the fear of missing
ions so there's really little dots
dancing around they're all telling me
that something is happening something I
would like to to know more about so that
the reason why you know I'm staying on
the application so real-time is really
what we need to keep our user intention
alight and today we are not going to
talk about data we made it last year if
you were there something with drone
we're going to talk about events because
events are important too you probably
want your users to be able well to at
first be notified each time something
new happened but also to be able to
react in order to sing something in your
application but if it's a little bit
different from data first of all they
are completely unpredictable
you never know where your new fancy
detector will sensor will detect
something and then they have very
different usages they can be simply
consumed as they write like a new video
on YouTube or a new blog post but it can
also be the beginning of something
different
as a workflow for example so let's start
directly with technologies you can use
for to stream them so usually pulling is
mentioned and well wholly in the in the
perfect and wonderful world of theory
whether I would love to leave that
because actually I'm pretty sure there
is unicorns there so pulling in the
world of theory looks like that so I'm
making a request waiting for the answer
making the same request waiting for the
answer and so on and so forth the thing
is we are living in the cruel world of
practice and in the world of practice
well there is no unicorn first and
Hollings looks much more like this you
will make a lot of useless call before
retrieving something new people at that
peer I don't know if you want if
everyone here is familiar with up here
that peer is an application which allows
you to build your own workflow so you
can serve for example each time I
received a new email in my gmail inbox
with an attachment save the attachment
in my Dropbox account so people have
that peer has made a lot of students on
on polling and realized that more than
99% of posts were just wasted it's what
they call the polling madness and we
definitely should start with a polling
because it's not solution it's a hatch
so now let's talk about real solution
and false phone and first let's talk
about WebEx so way books it's sometimes
called user-defined HTTP call back or
user post define HTTP call back it's a
concept a method there is no
specification it's not under any
recommendation like w3c recommendation
for example look at this website which
is pretty nice you will find a lot of
documentation and a good work group
which is pretty active and they got a
very nice logo and that's all we can say
about web books at this process point
it's just yellow everybody is doing web
books the way they want so in theory we
will subtract that first of all the
consumer is going to send a post
request to the apply provider saying
okay we would like to subscribe to your
event source and here is my callback URL
the apply provider is going to send an
answers okay subscription created and
then it's time does the API provide us
something new to send to the customer it
will make a post request on the callback
URL be provided with data in the payload
sounds pretty simple but actually it's
not that simple to use it needs to you
have to make a little bit of work before
using it so first of all as a consumer
you get to define a callback URL which
has to be accessible from everywhere so
not on the rocks not behind a proxy no
localhost accessible from outside and as
an API provider you get to first create
a subscription endpoint either live with
two resources but remember there is no
specification so up to you to do it to
do it the way you want so basically the
it would be really nice to have those
two resources the slash way book which
will be used with a guest method to
retrieve all web books available and
with a path method to create a
subscription and the slash web book
slash ID which will be used to with the
get method basically is the equivalent
of a poll it's made to debug and with a
put method to update the subscription
because perhaps you have changed your
callback URL and the delete method to
simply close the subscription and then
comes the very important part for the
API provider because you get to
implement the web hook use and so inline
HTTP request it's not video solution it
means that every time you have something
new to send you're going to loop over
all your subscriptions and send the
request programmatically so you will
have to deal with failure and retry it
will delay you answer it's not really a
solution it's something you can use for
proof of concept perhaps but that's all
oh you can hope for SQL base cube SQL
based queue is not the most scalable
solution but it's something nice if you
can't
foreigners add another piece of
technology to your stack which sometimes
happen so in this case you will simply
each time you get a new event to send
create an event in your database and
then having cron tsk for example
looping over and send those
notifications but the best solution to
me would be to use an NTP broker if you
already get one or can afford to add one
to your stack like RabbitMQ Reddy's
whatever because well first of all it
will save your database resources and
that's what brokers are doing the best
right but is to be concerned in case
know that you your API will send a lot
of events Facebook for API they are
doing batch so they are saying sending
events every five minutes or if there is
more than 1,000 notification on send and
then then comes a very important part
because get to implement a fancy UI you
know to let your consumers set up their
way books and that's something we are
not all of us really found of you know
you are so here I took github as an
example which is probably one of the
basic and fine whisk it up you can
create way books on both your repository
and organizations so here it's a
repository on mine so you're simply
going into the settings menu and then in
the webex menu and you can create it by
passing your payload URL that's a
callback URL choose the column type you
would like to receive and then select
which events you would like to receive
so by default you're just receiving the
Boosh events that you can and you can
ask to receive everything or just select
some and then each time there is new
event you will receive this and this
plot is really nice actually because so
the payload is really complete and most
of that in the header of the request you
get the this Expedia event which tells
you everything which tells you precisely
what has happened was it an issue was
the request was it match etc so now
looking at pros and cons of way books so
people were really happy at the
beginning with weblog saying okay we got
real-time update
for real actually it's not realreal
times because as we've seen previously
it will depend a lot on the
implementation you choose for your web
app you and five minutes trust me it's
not real time when it comes to financial
data but it's almost real time which is
I mean real nice without a dedicated
resources because obviously when we were
using polling to make this we were
having usually some dedicated resources
to end all those connections especially
if you were making long polling so here
you don't need this anymore that's a
pretty good point it's easily consumed
it's a post request we already know how
to deal with post requests and it's
easily integrated because well all you
need is a web server and you probably
already got one right now looking at
counts it provides a poor user
experience obviously I show you gear up
which is one of the best you can expect
but keep in mind that it will not always
be a say the case it's nightmare to
debug to make things clearer there is
company which I've based there's
business on debugging web apps I think
that means a lot it's it doesn't work
with all clients because my smartphone
for example doesn't really care about
post requests you know just don't know
how to handle that and the manual setup
is also an issue because it means that
you can't programmatically create web
books now looking at some known issues
we're having with web books first of all
one which is common to both the consumer
and the API provider is DDoS attack
because both will expose a public
resource to the outside world so this
resource can be catch up by some
malicious user who will for example
subscribe you to unwanted events and it
will ended up with a DDoS attack but it
it can also be simply because as a
consumer your server is not able to end
all every events received for from your
PI provider then another program is
missed notification because there is no
specification
yep Larry provider does not have to
check that you received a notification
is sent you know you can simply send it
and well the rest is your job so in case
your server is down for any reason you
will end it up with miss notification
and in case the apply provider is taking
care of your answer if for any reason
your server is not responding with the
expected code but still as received a
notification then you will have the
duplication so a quick checklist to
implement web books so as a consumer you
get well it will be best let's say to
have one callback / webbook simply
because it will be easier to go to the
bag and make it at less human readable
as possible don't follow your
traditional API scheme make something
completely unguessable from the outside
world check if there is an expected
answer and if you are sending the right
answer be sure that you can under
request number so that you don't hang it
up with a DDoS attack monitor your
parasite I know this one can sound a
little bit old but get up for example
they are keeping they pillow that side
meg and so if the event they have to
send you is up then five man it will
just not be sent and be sure that you
can endure duplicates of course and as
it an api provider okay it's not
mandatory but definitely implement some
kind of authentication like peter was
doing it will make the world a better
place for everyone so looking at those
issues with web books people have
decided to move to dynamic subscriptions
and so few project appears restful Web
books which honestly I haven't been able
to find a lot of the recommendations on
that so I think it was this was born
something like that this was born rest
oaks which is implemented by people at
the pier and web sub and we're going to
see a little bit too deep into the web
sublet a bit more so web sub which you
probably know already basically because
it was formerly known as pubsubhubbub
fantastic name
pops up and push it's an open protocol
it's a no w3c purpose recommendation
science April 2017 so that the moment
you know when guys from the marketing
came in the game and says that's a bad
not refunds name let's rename him Reb
said yeah that was pretty good idea
actually so it's based on the
publish/subscribe pattern you will find
a lot of common things with WebEx but
it's also based on topics basically the
topics is just a resource but you will
typically stress resource but you will
find this very often in documentation so
I think it's quite nice to just know
what it is exactly it was originally
designed to manage every session item
field but now you can use it was almost
everything and you get those two very
useful repository then that's a separate
repository yeah a lot of training to say
it trust me well you can find a lot of
resources like implementations in
different languages so that's very
useful and the w3c repository about
website to follow the evolution of the
project so basically Webster it's
another vibrant environment sorry of
publishers hub and subscribers so
publishers for example you can think
about medium which is probably the most
famous I think of them CNN I'm sorry I
was looking for a real media but I only
found fake news oh no way what press or
bloggers looking at herb super feeder is
probably the well yeah probably the most
known on the market it has been acquired
by medium last year but Google App
Engine provides a free hub which is
realized too
and looking at subscribers you're
probably are using feedly
or football I guess so yeah that's some
of these sectors so how does it looks
publishing with with web serve with well
first of all you get to as a publisher
go through the discovery step so it
means that you're going to provide two
links on your header on your web page
whatever you want one which is called
hub which is the hub you're going to
publish your updates to and one which is
called sales and sells obviously is
yourself and once those two links has
been published subscribers can send
subscription requested herb saying ok so
it's a post request to herb saying I
mean what subscribe that's the topic I'm
interested in and that's my callback URL
and optionally you can also provide a
secret token once this is done the hub
will answer with a - and I think I miss
something
I got a slide missing I think so the hub
will answer with a requesting ok is
going to make a get request on your
callback URL taking those parameters
like the MOT subscribe the topic it's
try and sell here is a hub challenge
which is basically a random string you
have to send back to the hub to prove
that it's really you that you want to
subscribe to this feed that it's not
someone else who is trying to subscribe
upon you and very important thing you
get to send only the help challenge in
your in your hand sir otherwise it will
be on relevee and validated so now
looking at consumer setup and I know it
can be a little bit surprising but I
took here Facebook as example because
actually Facebook is one of the best
example you can find on also a book so
when you want to create a subscription
on Facebook first of all you get to
choose between different topics user
page permissions etc and then you get to
choose which file which feels you are
interested in and then we can start
publishing so the publisher will pick
the hub each time gets something new to
send say I'm making a post request
saying okay I mean but publish here is
the URL of my updated resource and here
the hub will proceed to content
distribution and so we will make a post
request on your callback URL okay it
will provide those two links we've seen
previously except that here the self
link will be updated with the
good content and in case you provide a
token previously it will proceed to
another indicated content distribution
with the sha-1 signature so it's not
very safe because it's so on but I guess
it's better than nothing and here comes
the tricky part
because then the subscribers as to make
a get request to get the updated
resource yeah it means that Facebook for
example is saying sending you this so
you can see which field has been updated
when but you don't know what has been
updated the reason why I took Facebook
as an example actually super feeder
provide the little application you can
play with to see what it looks like most
often if it's HTML which you're
expecting to receive you will have a
little header or little title you will
have a little bit more information but
you will never have the entire content
and there is a good reason why it's to
save resources from the API provider
because the API provider knows that not
all of these events will be read by
everyone so and let's move to the third
part of web server which is the
unsubscribe process because there is a
clear and subscribed process in web sub
which is very close from the SUBSCRIBE
process we've seen previously so you're
going to send another post request on
the hub with a callback URL and saying
it's time okay I mean what unsubscribe
and the hub is going to proceed again to
the the verification of intent to check
that it's you who is asking to
unsubscribe follow from this feed and
not anyone else wasting it on behalf of
you so it will send it as a help
challenge and once again you get to send
the answer verification request back so
now I'm looking at pros and cons of four
books we've seen previously
well we fixed the poor user experience
because now it can be it's
programmatically so we fixed of a manual
setup the thing is we have to make
another call to get the data so it's
very different
looking at known issues the real nice
thing is that we fixed ddos attack so
let's make a quick demo I'm gonna make
it on web book and I'm gonna need your
participation so I got this repository
of mine which is basically the code of
the demo I'm going to make and I would
like to create a way back on it and so
that each time someone is tearing the
repository we will see it's logging so
the repository is another web box demo
and let's move to the code so it's a
very simple JavaScript application I
only got an express server at the moment
it only knows how to and I'll get
requests on the root resources so we're
going to add a post request on the slash
webbook okay and so we're going to look
at the kind of event we received so we
are going to look at others from the
requests and more specially to the at
the xscape event we've seen previously
once we get that we can switch on the
event type okay and we're going to look
first at the pink event which is the one
here I'll be sending to you each time
you create a new web book so it's kind
of the bug event we're going to answer
to the API provider because github is
expecting and so for us we're going to
send new event received for example
we're going to log it okay and break and
now we are going to look at the watch
event which is the one we are interested
in the one which is fired when someone
is staring the repository so we are
going to send another message to the API
provider saying what's event received
for example and we are going to log a
little bit more information we are going
to say new watcher and look at the body
of the request for the sender
okay and just in case we are going to
add a default which is going to send an
error of status unsupported even for
example I'm going to log it okay here it
is quite simple so first of all I'm
going to run the server so not yes it's
listening on 80-85 okay you know the box
it's running if you remember properly
what we saved previously you can't
expose a local host resource I'm going
to use n group to expose it to the
outside world
mm-hmm okay so here I get my resource
okay and now okay so I'm I think it's
yeah a little bit better than I like
that I'm going to create the way book so
here I'm copy paste the URL and work
provides me and I'm adding the slash way
back pass of my resource the one I
declared just there okay then I'm going
to opt for jeezum and I'm going to
choose even Sime interested in so I'm
going to say okay I'm going to keep the
push one but I'm going to use the watch
repository the watch even sorry and add
the way book so here it means that an
event has already been sent which we can
see there okay we got a new ping event
and now each time someone is staring the
repository and you can do it that we
will have more feedbacks yeah we got new
watches so it's pretty simple okay so so
as a conclusion I would say that as you
probably guessed those technologies are
very different when it comes to work
through like for example every time
there is a new management
I would like to trigger a Jenkins job
and to notify developers by email you
will use WebEx we can also think about
web books for IT issues because
typically IOT events are completely
unpredictable but you won't react
immediately you want you want to be able
to react when your home sensors for
example as detected an intrusion you
know but when it comes to so in this
case it means that events is more
important than data the data inside is
not really important the thing is I want
to react to the event I don't care what
pull request is it which has been most I
know that I want to trigger the build
but in case the data is more important
than the event you know for example that
every video posted on YouTube will not
be read by the user even if it has
subscribed to the channel well in this
case it's much more useful to use
website because you will be able to
reduce your resources and that's all for
me thank you very much we got five
minutes left in case you get questions
question everyone someone mmm
okay so I think we are done thank you
very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>