<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Safer Apps from Docker Security Building Blocks by Riyaz Faizullabhoy | Coder Coacher - Coaching Coders</title><meta content="Safer Apps from Docker Security Building Blocks by Riyaz Faizullabhoy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Safer Apps from Docker Security Building Blocks by Riyaz Faizullabhoy</b></h2><h5 class="post__date">2017-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yRy6pwIna44" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right good morning everyone
welcome to my talk
safer apps from docker security building
blocks
my name is Ria's fasulo boy I'm security
engineer at docker and I'm very excited
to give this talk to you today so
without further ado I'd like to just
show you this small terminal snippet for
those familiar with docker you may have
seen this before for those who are not
it's may be the first time and let me
explain what's going on so you have
docker stack deploy and with docker with
one command you can deploy an entire
application stack right in front end
back end database memory storage all
configured all fully customizable and
very easy but the reason why I'm talking
you today is that because it even though
it's easy it doesn't mean that it's
simple and really there are a lot of
pieces under the hood that are working
to make this command magic and make your
applications run like magic and in this
talk today we're going to look at all
these pieces that are necessary to do
this but not just do this but do it
securely and so with that I'd like to
draw analogy to one of my favorite games
Tetris in Tetris is the simple game you
have these blocks which actually called
tetrominoes I learned that earlier like
a domino but the trauma no and you're
given them one by one and you place them
on onto the floor onto the board and try
to make full lines and infrastructure
security is actually a lot like Tetris
because in Tetris when you make a
mistake you have these holes these holes
like to build up until you it's the top
of the screen and you have you lose the
game
but in infrastructure security you can
think of these holes like
vulnerabilities if pieces of your
infrastructure don't line up and don't
talk to each other don't integrate
securely you end up with these
vulnerabilities and you'll lose the game
of infrastructure security so with that
I like to introduce a few of our own the
trauma knows that we've been working on
that docker and in this talk seven of
them
all seven to trauma knows our
open-source projects and you can find
today on github and I like to call them
out individually and tell you about how
they were kind of the hood and how they
work together so with that today I'll be
talking to you about infrakit Linux kit
run C container D docker notary and
swamp kit so with that let's get to our
first to trauma no infrakit which gives
us infrastructure independent machine
management what i mean by this is that
with infrakit you can manage machines
VMs bare-metal across any platform you
wish so ADA us a sure cloud even on your
localhost on your Linux or OSX platform
of choice and it lets you spin up and
manage the lifecycle as virtual machines
so not only can you say I want n virtual
machines but I want me to stay healthy
and I want them to stay alive and to
work together and all this is entirely
json-based so you have a declarative
system for specifying your
infrastructure as code so you say
exactly what you want in the JSON file
you run an infant kit commit and
infrakit will make it happen magically
well not magically but under under the
hood
all the details happen and what's really
imaginable implicit is that if the state
ever deviates say you say you wanted
five machines and one for some reason
tries to go you know goes on healthy or
something infrakit will do its best to
keep the state constant and to bring
back for the node if a can and reconcile
the state likewise what's also very
interesting that infrakit is that you
can update the JSON say there's a new
version of an OS or you want to include
a patch you can tighten you know edit
your JSON bump the version number in
forget commit and infrakit will know
that the new state needs to be accounted
for and will update your machines for
you and with this I want to introduce a
very important security property that
you can achieve with infrakit and
systems like infrakit
which is reverse
time so how many here are familiar with
the concept of time I think it's a
pretty common so with up time right you
talk about Oh my system has been
generally people use it as a as a kind
of a proxy for something being healthy
right we systems been up for days weeks
months years but really you should be
thinking about instead of counting up
for security cheating about counting
down and after some amount of time a
machine should be recommissioned and
there are three very important reasons
why you should consider this so firstly
you can have OS drift so you may
provision of a number of machines
they're all healthy but as you want to
update and tinker with different
settings and different figurations the
state of each individual machine may
drift from and one another and may cause
unexpected downtime say you updated one
machine but not another or something
happened some error and your update
scripts so with infrakit and with
reverse uptime by constantly refreshing
machines to weeks months you can be more
sure that the exact configuration is
running across your infrastructure
secondly you want to make sure that you
have all the latest security kernel
updates and other infrastructure code
updates and by constantly freshening
machines again you've had an opportunity
to pick up recent patches and patch
quickly and lastly if you're always
refreshing machines same attacker
somehow gets a backdoor into one of your
applications and cop finds one of your
hosts there life gets a lot harder if
you're constantly refreshing machines
and blowing away any persistence once an
attacker is in they can do whatever they
want but if you you know remove the
machine if they have to go back and
attack again and at that point you may
have already patched so by removing
persistence and by taking old machines
and redeploying with a new golden image
you have the chance to update that
golden image for all the security
updates for any configuration updates
but also kick out any attackers that may
have found a persistence via backdoor
and infrakit makes it easy with rolling
deploys so you can move infrakit
configure say hey I want to have a
rolling deploy with my new golden image
that my security team released his team
infrastucture team has vetted and
approved an infra Kate will be able to
remove the old machines and create new
ones with rollin deploy to minimize any
disruption so you don't have any
downtime
that's infrakit I can now move on to our
next to trauma no Linux kit which is an
OS builder for your containers na notice
itself is not like Oakland - or Debian
or Fedora but it's like a builder and to
kind of show you what that means this is
how you specify an OS with Linux kit
it's completely Yamma based and whatever
is in the ammo is exactly what we'll go
into Linux kit based OS and nothing more
so in this example I've kept the ammo
file I have a kernel from you know
version 49.54 I give it a command line I
having an it view of processes in
particular it actually sets up
containers Brunson community to run
containers in the system on boots I say
give me networking so - EP I asked for a
shell with jetty note that if I don't
put in Getty I don't get a shell and
that's exactly the goes in violinist kit
OS nothing more so really what you
should be thinking about is when you're
running OS in your infrastructure a lot
of the run-of-the-mill OSS there's so
many hundreds of binaries and systems
like services that are running on that
system but you probably don't even need
and so why would you even consider
having them lying around that's extra
attack surface for hackers to have fun
with when instead you can know exactly
what's running the infrastructure and
know that nothing more is running and so
you can build an operating system in the
least privileged sense that exactly what
you say you want in the operon system is
shipped in your infrastructure
kind of a fun fact as well is that for
those recommender with docker you might
notice that the images look like docker
images and actually are so you can today
take the leanest kit images from docker
hub and create your own and share them
around it's quite nice so one one thing
about linux kit to kind of further
motivate why you want a minimal OS and
you know minimal set of components we
took it a step further and I mentioned
we have our own images we have our own
kernel image that we've kind of put
together you can use from docker hub and
really took minimal as a guiding
principle in that kernel as well so with
that we have only recent kernels that
have been configured the best practices
from the kernel self protection project
and many other experts in the field we
strive not to include any extra drivers
or gunk that you don't need on a Linux
kit based OS to run your applications
and containers and for those who are
familiar the Alpine Linux distribution
it's another Linux distribution that is
also takes a minimal approach as a
guiding principle and one really awesome
thing that Alpine has done is to have a
completely hardened user space tool
chain where they've configure the best
you know compiler Flags the for
background alpine uses muscle Lipsy and
busybox and really we were big fans of
what alpine was doing in user space and
have borrowed many of their packages for
our own own use it's quite nice going in
step further not judging minimal we also
want a Linux kit to be immutable at the
read the root filesystem level so by
making the root filesystem immutable you
can't once you build that yanil exactly
what you want which includes any
configuration like important for
Eurasian and Etsy we didn't want to give
the attack surface of being able to
update Lunas kit on the fly or for
attackers to not modify with values so
with that we have a mutable filesystem
it's quite a nice and I guess here for
also for from
more background for those unfamiliar
with containers this might bring a bell
with with container images with the best
practice is to have an immutable
consider our containers immutable so
running a container infrastructure if
you want to update it you can simply
recreate a new one with your updated
system and so we this alone escape we
took a very similar approach considering
the root filesystem to be mutable and
that if you want to build a new lens kit
you should have a new yamo file where
you understand exactly what you're
building why you're building it before
shipping it also know both Linux kit
we've been working quite a lot with the
upstream linux community and future
projects that are being experimented in
the kernel hardened listing on this
various security lists I'd like to tell
you about a few so firstly for those who
are familiar with linux security modules
if you've heard of a farmer or SELinux
there's an exciting one that is has a
few patch that's already called LAN lock
LAN lock is quite interesting for Linux
today in particular because LAN lock
makes use of a relatively recent kernel
feature known as extended berkeley pack
of filters and kind of a tldr forex
enter the berkeley packet filters is
that you can see every sis call you can
see all the interactions in the kernel
as well a lot of a lot of context so you
can kind of you can look into arguments
in the kernel and look into exactly why
the system calls being called and this
is really exciting because with land
lock it takes these this information and
lets you break policies around it so for
example don't allow writing on these eye
notes or don't allow this type of
network packet to go through so we're
really excited about how fine grains
that can be in a particular when you
have a complex system with containers
for example where you have all these
Linux primitives meshing together in
really interesting ways land lock
provides a really really really
promising way to make inform secure a
decisions about what to allow and what
didn't I
another project that we actually have in
the Linux kits kernels and you should
space for you to try it's called wire
guard why regard is a VPN it's based off
of or rather implement
it's the noise protocol which you may
have seen it's very very very good piece
of crypto that's been influenced in
integrating the other systems as well
and why I wrote is very exciting because
you have a fully featured VPN that's
using modern cryptography from the noise
protocol and it's also only like five
thousand lines of code so it's been well
reviewed folks understand how it works
you know what the attack surface of it
looks like and so it's a lower view
project and also very promising project
for networking of proxy services and
containers and across hosts so we're
very excited there we're also working
with a bunch of different partners on
other projects such as oak kernel which
is a way of splitting the kernel into
less privileged and more fluid parts as
well as we've been working with arm
support on landscape which has been very
exciting and trusted boot and so one
thing I want to note about Linux kit is
for many of you might be new that I'm
announcing talking to you about it today
but it's actually been in use by
thousands and millions of people already
so if you've been familiar with docker
from Mac dock for windows lock for 82 us
a sure all these platforms are actually
using Linux kit under the hood so we
with those projects if you use them
before use on for Mac you know that you
have a nice GUI and you don't even
actually know that you're running a
separate OS unless you really dig into
the internals and so even shipping linux
kit with these with these platforms for
quite a while and it's I think along the
way it's really helped us understand
what we could do in Linux kit how many
we could get and it really I think
doubled down on our decisions we're
really excited about look the minimal OS
with these configurations and what these
things it works and folks are happy and
so we're really excited about that and
so in the future look to more exciting
things in Linux it happening and seeing
it bubble up into dock for Mac Windows
as well as other projects other projects
in the ecosystem have been using that as
kit and very exciting so with that I
like to move on to our next to trauma
now which is run C run C is a
lightweight
Universal container run time it's
actually been donated to the OCI so it's
a standard and for those who are
familiar with containers and docker the
Latian if you're not familiar one see
already the way you should think about
run see is it handles all of the guts of
how to set up a container so really what
a container containers are from as
containers are built on Linux primitives
so of notes you have namespaces which
give you isolation between different
resources and kind of views of the world
and you have C groups and their few
other things as well but this is this is
a big two to give you an idea of what
named phases are there are quite a few
of them for pizza box ideas mount IPC
network for example in a big name space
you can only see the processes that are
in your namespace so if you've used a
container before you may know that when
you run PS you don't see the entire
hosts lists of services and processes
you see just the containers that's
because the container is in a pit
namespace
those are namespaces and runs these that
leads up for you when you're at a
container with run C and C groups are
really about restricting resources from
the hosts and between other containers
so for example you can have C groups for
CPU for memory if for kids if you'd like
and what you can do with C because you
can say look this container a can run on
CPU one you can say like it runs on C if
you wanted to you can say this container
runs with only up to half of the CPU and
this container runs with a third of the
CPU and so on and so forth and so you
can with we could with run C you can set
up the namespaces to say look this
container coming to this and the secrets
it this container can only use this it's
a really fun C is all about giving you
the ability to create containers and to
use these underlying the next primitives
for your containers and really sip as
well and so with run C you can create
containers you can you know use the
namespaces uses C groups really use that
but but our next piece is all about it
is once you
container you have there are a bunch of
now extra things to think about like you
know with the container exits what do I
do is the container live is it healthy
and that's really where you need a
runtime supervisor for your containers
and so we have a project that we've spun
out of docker and is now donated to the
CN CF called container D and yet really
what container it is all about is a
supervisor is the container still
running is it healthy did it exit if it
did exit should I run it like should
every run is that safe
and so container T is all about that one
really interesting security property
like to really point out the container D
is when you pull an image so how many my
folks here are familiar with like a
docker pull like Alpine latest okay so
in doctor pull Alpine latest you have an
image name or an image repository like
Alpine and you have a tag it's usually a
human readable name like a version or
latest is a very popular one really
what's under the hood though on that
human under the human readable tag it
points to a unique piece of content and
that content is specified by a digest so
an example here is I have Alpine hat
sha-256 292 before blah blah blah blah
that's my digest and what that digest is
is it's actually a Content address that
says look for the image at the addressed
sha-2 9 2d ba-ba-ba-ba-ba and what's
really exciting here is that on a pull
by digesters what this is you actually
get a hash tree where you have a
top-level object called a manifest which
says ok here's my image and here all its
pieces and all the individual layers all
angel pieces have their own digest and
the digests you take each individual
layer and hash them all together that
hash is represented as the manifest in
the manifest hash so once you have that
single identifier when you did docker
pull at Shaw 56 hash you're now going to
an address downloading the content and
you can verify when you down the content
but hash the hashes match and in doing
that you've also implicitly verified
that each of the layer
that bubbled up in that single hash also
match so you have full integrity over
all the layers and and net in your full
image and so container is really
exciting because container D does this
for you it handles the pull bite digest
that handles the base making every pull
into a po-boy digest it's really awesome
and gives you this really nice security
guarantee of the integrity of your
images and so with that I like to talk
about our next piece which for those in
the room is probably more familiar and
takes parts of container beer and seeing
other parts of pieces of pot so far
which is darker and darker the way you
should think about docker in the context
of Runcie and container d is that it
coordinates with these two projects and
it does so in an opinionated way to
create a secure by default container
platform
so what I mean by secure by default what
what does docker do so there are a
number of features that are on for you
by default so firstly I mentioned with
Linux kit Linux security module for land
lock docker has default profiles for
selinux and a primer which are existing
landscape modules that are included in
most Linux distributions today so out of
the box you have I see Linux and a power
profiles these profiles tell docker you
cannot touch these sensitive file pads
like proc cysts you cannot use these
cysts calls you cannot use these
capabilities
here's your profile for what you can do
and really out of out of the box you
have this access control that restricts
file paths and permissions of all the
containers that are run by docker on top
of that within Linux
I think most of us are familiar with
root and non root but how many people
here have heard of capabilities is in
Linux okay a handful so really actually
what Linux does it has under the hood is
there's more to just route and nom route
there are actually capabilities that can
give you a amount of permission in
between so they're about 40 such
capabilities you can think of it as caps
this admin is probably like the most
well-known one that gives you pretty
much route there are other ones
network like can I bind a port can I
like send raw packets and so there about
40 of these capabilities and
out-of-the-box docker has a whitelist of
13 that your containers can run with so
you have less than half the capabilities
your containers out of the box of course
if you want to tinker and add more
capability you're more than welcome to
and you can with the commander argument
or other configuration but out of the
box you have that that whitelist for you
of less than half of capabilities and
then lastly or not lastly how many
people here have heard of set comp ok
we're getting to the kernel the kernel
weeds the set comp is it's actually very
very similar again to tool and lock what
it's doing with Cisco filtering with
extended purely packet filters it uses
this a similar mechanism to sniff every
Cisco and allow you to make decisions on
syscall so it's not as robust as the
extended Berkeley packet filter you
can't like inspect the arguments deeply
but you can basic say look for this
syscall deny it allow it
et cetera out-of-the-box we doctor will
also ship with a SATCOM profile which is
a white list of sis calls so you
drastically reduce the kernel attack
surface for any current like any
containers that you spin up with docker
and then lastly I think for a lot of
folks here who are running you know APSA
don't need to change the file system you
know apps that are relatively stateless
one thing you can do with docker it's
it's not default but you can turn on is
you can have your containers be
read-only so like Linux kits where you
can't modify it out the file system you
can have your containers also be
read-only so that you know exactly that
the container is not you know it's not
drifting and configuration it's not
drifting in its state from what you
intended it to be at runtime all right a
ship time and so with that you can have
it's like - - read-only and you can set
your containers to be read-only when
they're running the docker so out of the
box you get all of these essentially set
up for you again if you want to make
them more restrictive less restrictive
we have knobs but this is out of the box
secure by default for your containers so
we talked a little bit about containers
we talked about running them about how
they run with Linux
and I kind of had a little bit of this
with container D but the next piece the
next to trauma memo then I'll talk about
is really about trusted delivery for
your containers so how do we get our
images or any other piece of content
securely on our hosts in the first place
so we can then run it and so with that
I'd like to introduce notary which is
another project that actually just got
donated to CN CF so really excited about
that
that is really state-of-the-art signing
system project and so for many folks
here who familiar with signing and GPG
you know that signing gives you
integrity basically this thing change or
not it didn't change in authenticity you
know who signed this which key sign this
over and over any kind of content and
what nobody does is it takes signatures
to provide a graphic name resolution so
it says here's the name of my signature
or the name of the entry that I'm
signing for so an example might be like
latest or v1 and here's the hash and
I'll create a signature over that so for
the for those who litter and look at
this slide you're kind of looking at
latest sand stay at one edge these may
look like docker image tag names and in
fact they they are I mean that notary
can be used for help us translating from
docker image names to secure hashes the
container Deacon use could also be used
notary can be used for any kind of
content so I joke that you can use
notary for cat videos really want to
there are a number of projects in the
wild such as Clyde that use notary for
OS query updates
there's even an interesting project from
CloudFlare that uses notary to securely
get information for container identity
by signing off on that on some content
there so notaries is really about the
graphic native resolution for any kind
of content and no really has a really
interesting history and the reason why
it's general is that it comes from this
spec called the update framework and the
update framework is a research project
out of New York University the School of
Engineering and before that it actually
came out of a tor project so for those
who are familiar with tor tor is a tool
for anonymous browsing with the Internet
and you've if you've heard of tour
before you probably know that tour is of
interest to many high-profile attackers
as a way of putting it and as you can
imagine if you can as an attacker if you
can compromise the tour updating system
you've made it big right yeah you can
compromise how towards getting updated
and you can put in your own you know
code or like a backdoor in a tour
you basically have pop store towards no
longer anonymous so the tour folks said
okay said yep let's make a really really
good update system for tour so they did
that and that project is called fan D
and so fan D really took signing and
made it you know signing and made a CD
out framework so you can understand not
only like to sign this and has it
changed but also is it fresh like is it
the content that I is it not like a
really old tour that may have a back
door now like is it is it a fresh piece
of software it also lets you do more
advanced things such as threshold
signing and being able to rotate keys
pretty easily but what you should take
away from this is that from from tour
there were standards update frame it was
update system and the folks at NYU were
like hey this is really cool so it's
really good but we need to generalize it
for more pieces of software and so with
that you have the update framework which
exists on github actually it's open
source also in CNC F and there's a
living spec where you can read the spec
it's prob about like a 30 minute read if
you want to get out it's not it's not
too scary to read it's quite
approachable and it's really exciting
because it takes the the really really
advanced hacker model from that from
lessons learned and tour and generalizes
that to be used across all pieces of
software and so notably what really is
is no reason implementation of the
framework which is why you can use
notary with many different pieces of
Stauffer if you'd like
of course the docker we've used it
extensively with docker images but you
can use it with many pieces of software
and I mentioned briefly that because the
reuses
the framework you can do many
interesting things and one thing I
really want to point out which is
probably most relevant to folks in the
room who are running infrastructure is
you can do thresholds signing so you can
say for this piece of software for this
image sign it at each stage of my CSV
pipeline so for example your dev is
really some code they sign it's saying
that they made this code it then goes
into the staging environment built
environment and runs and passes some
tests and CI signs it and then it goes
to the security team that says ok are
there any CVEs oh there's me scan this
we any issues no let's sign it and then
deploy to production in a production you
can say only deploy code or only the
point containers images whatever that
have been signed off by security a CI
and Dev
and so with notary this is possible and
one thing that's really exciting as well
is that if at any stage someone loses
their key it's not an end of the world
event so for those who have GPG keys you
know one of two things one if you've
tried setting up sub keys and you have
it's kind of difficult so not many
people have and two if you lose your GPG
key that's it you have to tell everyone
else who trusted GPG key hey sorry i
lost my key please revoke that one
here's the new one and update your up
trust and so with notary and actually
the update framework it has an
intelligent way of being able to rotate
keys by using a hierarchy of keys and an
offline key today Sulli like allow any
any authorized user and anyone who has a
key in the system to be able to rotate
their key without changing it rid of
trust and so losing a key is no longer
an end a world event which is really
exciting and so with that maybe talking
about for any containers about how to
get a containers we haven't talked about
how to run many many many containers
across a cluster across the hundreds
thousands of notes and so with that I'd
introduce our last to trauma no swamp
get a least privileged container
Orchestrator and with Swamp kits we took
these pills very seriously to the point
that there's only one way for a node to
be introduced to swarm cluster and the
only way to do that is securely and so
in order to
in the cluster you must provide a token
that has different photographic
properties in a token to join the
cluster so we'll go one by one through
each each of the pieces of this token
there four parts so the first part is
probably the kind of funniest part but
probably the most useful for everyone
here is it's just a known prefix swarm
token so if someone accidentally you
know commits it to github or you know it
somehow gets in your logs you can easily
grab for a swamp token and find it and
note that you need to rotate keys or
rotate tokens rather so for usability
and for your own auditing you can just
search for it form token a second piece
is a token version just in case token
changes I don't think it has yet so far
and now we get to the two interesting
parts for crypto which are the hash of
root CA and random secret so for those
who've use SSH before you know the first
time you log into a host you get that
scary message right like like the
warning like this is the first time
you're in this host with this IP do you
do you sure you want to do this if you
trust this and you type in yes and then
you can get in and so that's called
trust on first use right you the first
time you have to basically either you
have to trust it implicitly or you have
to go around that without like SSH and
say yes I want to trust this and so with
with swarm tokens we actually do is we
seed this hash in this hash is the hash
of the root certificate authority in the
cluster so the first time the note is
talking to that to that certificate
authority it can self compute the hash
it doesn't have to ask you are you sure
you want to do this or do you know who
this is
because the token knows token has
information and then the second part is
a random secret so that the notes you
know you so that you can't basically
spoof the token and that the manager
knows this is a legit token I should let
this this note do our cluster and once
you join the cluster what's really
interesting is that you actually get a
cryptographic node identity and what I
mean this by this is that the node gets
a certificate and x.509 certificate you
can use for TLS for those who are using
TLS before you probably familiar with
these but in the certificate
it is an individual identifier for the
node which is in the CM there's also a
roll saying that this node has this
level of privilege so basically you can
do tasks or can assign tasks some worker
and manager and it also has the ID of
the clusters joins this one ID and the
reason why I say this is graphic note
identity is that you cannot spoof this
because it's signed by the private key
of the root you know the root CA in the
cluster so no no two nodes can have the
same like the same ID in this case or
you can't have another node try to
impersonate one note because it needs to
have the valid certificate in its own
key material and on top of this there's
constant rotation of these certificates
handled by the cluster and you give me
bring it down to one hour so for those
who have have rotated starts before no
it's a pain so we it's warm it's
automatically and so what for those like
I kind of alluded to once you have
certificates you now can use
certificates to talk with TLS HTTP
basically for those who good and so we
have mutual TLS for all cluster
communications between the notes so that
means that all the cluster
communications all the administrative
sending out of tasks and figuring out
the state it's all encrypted it's all
authorized its authentic ated so you
know one can sniff the network and try
to change packets or you know network
and understand what's happening unless
they're actually valid they join the
swarm with a token and so you have
encrypted control plane and you also as
I mentioned earlier you have things you
have the role the node embedded in the
certificate no node can impersonate or
try to escalate privilege to another
node so for example a worker can't
escalate Povich to a manager because the
certificate doesn't have manager in it
and it can't enforce certificate because
I can't sign at the roots the root
patentee so it has been it's locked in
as a worker and now once you have the
secure channel communication you can
send down tasks configurations in a
secure way but we also in swarm kit took
a lot of care for secrets so for those
for secrets I mean database passwords
API keys anything really that you want
to remain private and the way that it's
really I think of many of the features
in swarm this is really probably the
most most exciting for your applications
to be safer because now your database
passwords or other API keys can be
securely distributed and stored and so
the way that this works is that by using
you two TLS we know which note is which
and we also know which nodes are running
what and therefore what they need or
what they don't need so for example if
my red worker here is running my
database but my green node does not I
only need to send a database key down to
the red node and so a swarm kit swarm
can only sends down secrets to the nodes
that need them and when it does it
exposes it as a file that's actually
stored in memory and so it's super easy
to integrate with applications because
there's reading from a file but then
also as a security measure once your
your container our task is done we can
actually remove the secret and secret
it's never written to disk so even once
the container is gone the task is gone
you can't get the secret back the secret
is is tied to the work and so this
allows your applications be more secure
and to use secrets and secure way so you
don't have to please please please do
not commit secrets to github and do
anything like that
please do some good and lastly I've
talked a lot about the root CA and the
root key and it's as you can imagine
very important and so I think one thing
that sets one get apart from many
systems and for many security people in
the room I think is to be exciting is
you can actually watch worm kit
transparently rotate the root key
material and the reason why this is
really exciting is for many people here
who have whiteboard Adhan security
things I know this happen many times
with me and ultimately often times at
least your the security system boils
down to root of trust with a single key
or like a single point that is your root
of trust
and for many people when that when you
were be your threat modeling you tried
particularly trust obviously but once
the rust compromised many people are
just like alright
we've been popped we're done nothing we
can do
shrug right but really in one kit we
realized that that was not enough we
could go a step further we had the
Interceptor to do better and so we did
is we allowed a mechanism to secret to a
securely rotate the rear trust in case
of any compromise don't just walk
through how it works briefly so you have
this swarm we have a manager node and
three worker notes and they currently
trust the blue route CA the rue blue key
material so maybe someday you decide hey
let's let's rotate so the way it works
is the first step is you you add the red
really trust every node so now they
trust both blue and red you actually
renew that so that you have both trust
in blue and red at this point so you
have you force the rotation to trust red
at this point but you're saying still
trust blue so you have a search chain
that includes both red and blue at this
point and then lastly once all nodes
have been you've determined that all
nodes have updated to trust both red and
blue then you can remove blue so Amelia
for this point we didn't remove blue
because there's a possibility that as
you you know distribute a system as
you're updating you don't you make sure
that all nodes are actually updated
before you pull away the root of trust
because then they can't communicate over
the control plane because you can only
communicate over me to TLS so lastly the
last steps once you determine you're
ready you then remove the blue so really
exciting with some kit you can rotate
that route of trust and even in the face
of a root key potential compromise you
have a way out so I've introduced many
pieces and I've kind of talked briefly
about how different pieces come together
but I think really where it gets really
exciting is when you you bring the
pieces together both within the trauma
notes that I have mentioned here but
also for vÃ¡manos that you may have in
your infrastructure
other props other projects in the
ecosystem I think there's some really
exciting integration so let's maybe walk
through a few and go back to Tetris so
first we can use notary and doctor
together for image name resolution so I
had this I mentioned earlier you could
have notary give you from tag to digest
and then doctor with retainer do you can
use digest two layers and manifest and
what this gives you is to graphically
verified image pulls right when you pull
from any registry with it's called
docker content trusts is the official
name of the integration you're actually
using notary and all the goodness of
epic framework to say is this thing
fresh is it up to date I mean is it what
I wanted and is the right person signed
off on it and so you can you know
regardless of cloud or CDN you have a
cryptographically verified pull for
docker images similarly you can also use
notary with Linux kin because I
mentioned earlier linux kit we actually
use many docker images to ship around
and distribute and build parts of the
system and so you actually have once you
build a lens kit system every component
can be pulled down with a notary
resolution so you've a cryptographically
verified build that exactly what you
wanted to build in IMO file it's exactly
their artifact that comes out after the
build that you're then get a run
infrastructure so moving on to another
integration we talked a little bit about
mutual tell us and swarm and really for
docker containers you get all the same
benefits of authorized dedicated
encrypted delivery of resources for
containers configs
and we talked a bunch about secrets but
really for configs and images you get
the same protections for me to TLS from
an the middle attackers my on the
Middle's attackers cannot inject bag
configurations they cannot sniff the
network and so your configurations and
images are safe and to get that swarm in
the first place
do you can run containers on infrakit
integrates really nice have a swarm
because with infrakit
you can actually automate the dance of
swarm token for certificate so you first
receive the root CA from the manager
check that the root CA matches the hash
and the token as a worker you didn't
send the token the manager checks that
it yet is legit and also you give it a
CSR certificate signing request say I
want a certificate to join the cluster
and then lastly you get back a signed
certificate so you can talk with me to
chill that's across the swarm and you
join securely and so with infrakit you
can automate and manage the secure node
cluster introduction in addition I think
want to talk about a little bit about
Linna skit and docker and how they work
together so I mentioned earlier that we
use Linux kit to build the OS for dr.
Mac and I would this earlier but with
let's get you really get a hardened
configuration for docker so docker
itself actually runs in a container d
and run C container with dr. Mac conduct
Windows and so we can do is we can
actually finely-tuned exactly which
capabilities after it runs with exactly
what profile danke runs with how its run
how its pulled down from our registry
with a security image pool and we have a
hardened configuration both of docker
but of course with all the goodness of
the kernel configuration and other
pieces of system a Hardy configuration
for the entire OS okay so let's get one
more exciting here let's go with three
pieces so what can we do with infrakit
and notary and Lennis kit and so I think
this really gets to some of the
possibilities with using a newer kernel
and use it and some of the more exciting
pieces of infrastructure in the
ecosystem an option Linux is you can
actually use these components together
to get a cryptographically verified boot
and so what I mean by this is that
there's this feature called DM Verity
that's upstream in Linux that
essentially if I was to summarize it
says similar to how in docker we have a
hash for the layers of an image you can
say with DM Verity I have a hash for the
hashes of blocks block storage in my OS
so you have a single kind of a top of
the tree hash so you can imagine that we
know we have infrakit
is a really nice way of
spinning up VMs so for Linux kit based
OS but notary is also a really great way
to get hashes because we have that
cryptographic name resolution from human
readable name to cryptographic digest so
we can use notary to securely sign in
diem very hashes notary can securely
give that information to infrakit which
will do all this thing their
verification and check this is the right
signature which can then use that hash
to integrate with DMV on Linda's kit
based OS so this is really exciting and
kind of forward-looking way of using
multiple these components together for
completely verified boot to be really
awesome
so another three pieces we can put
together and run see integrity and
docker well this is probably familiar
with with docker itself for free ship
and really what you get is a secure by
default container execution we talked
about DAP armored Exia Linux set comp
cryptographic hash for poles namespace
isolation cgroups
resources limitation and so you get that
all in a nice secure by default package
so let's get little more exciting what
if we take paternity run see dr. swarm
kitten notary well now you have a full
container platform you can run
containers across many nodes you have a
secure by default container platform and
then if you want to add in for kit and
Linux get to the Mexican rensi container
D doctor drum kit literally infrakit
Linux kit you now have a secure by
default state infrastructure right you
have intricate spinning up let's get
based devices which then you can use for
your doctor or some kid notary platform
so in this talk we talked about infrakit
Linnet skip run c ard docker notary in
rome kit and bringing these pieces all
together is how we build secure
substrate for safer apps and you put all
together you get the mo a whale so thank
you very much
sure I've time questions yeah
sir
sure so the question for those who
didn't hear is what are the consequences
of using environment variables for
secrets and containers yeah so they're
there quite a few and I'll kind of
summarize briefly but environment was
our it's they're known as as tied to the
environment as you may think it's quite
easy to poke around and proc in other
places and two children processes to
actually view the environments
many folks - I mean I hope this is not
the case but it's it's more commenting
we think that people dump environment
variables when debugging into logs and
other places and so of course and then
going further the variables are not
encrypted when you have them and so you
you're risking a lot of exposure within
our variables so I get that it's it's
super usable I know with with swarm
secrets we deliberately used files we
figure that any framework application
probably knows how to read a file or any
language since but yeah be careful with
the variables okay
maybe talk more offline as well of the
exact set up happy to help so cool other
questions yeah
so the question was can you use swarm
kit for as a general secrets storage
system so I think the way you should
think about swamp it secrets is that
it's really the it's really aimed at
delivery to tasks within the swarm as
opposed to storage and so I think one
ongoing effort within swarm kit is
actually to integrate with external
secret storage systems like vault and
keywords and so I recommend those two
are both are pretty biddings another one
think console ok the names from its from
lift to think but there's he was vault a
few others that are really about storage
of Secrets if you want to use swarm so
in in theory you could run with swarm
kit you don't run containers you can run
generalized tasks so in theory if you
wanted to use form kit secrets to
deliver secrets you could do that so up
to you I mean if you wanted to have
noted in the swarm and then expose the
secrets on the file system I was at em
fest like that that would work in theory
so ok other question yeah
yeah sure so the question was I talked
about land lock and wire guard the VPN
the question is what's what's the
roadmap is it already used salt about
wire at first why guard is actually
we've included it in the kernel and you
just base for Linux kit so you can use
it today I don't have Easter numbers of
hand but that's that's there it's also
being tracked in various kernel
communities I think Jason's on a fellow
who's the maintainer it's been very
active in trying to get totalement going
on the land lock front there we have
patches within kind of this like we this
project subdirectory in the in the repo
where you can scan like a playground
basically for addition you want to trial
and lock you can read all the patches
there meet al salihin who is the
maintainer of land lock I think he's on
patch 7th or something patch that he has
a road map I can't recall it off top my
head but he's definitely yeah on a road
map to get that upstream both of them
are really exciting ok other questions
all right well thank you very much for
coming and I'll see you around</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>