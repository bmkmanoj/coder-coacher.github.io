<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The End of Polling by Audrey Neveu | Coder Coacher - Coaching Coders</title><meta content="The End of Polling by Audrey Neveu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The End of Polling by Audrey Neveu</b></h2><h5 class="post__date">2017-04-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/T26J0akZxWs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome anyone through this session
called the end up pulling so we'll see
together why hand whole you should
consider transforming your recipe I into
a data streaming API so quickly to
introduce myself my name is Luna vu I'm
developer relations at stream del tuyo i
model the collider of the box for kids
in France as you have probably guessed
and you can find me on Twitter with this
in though so one time we know that
application that we develop asked to be
mobile ready business even businesses
want you to bring your own device
movement the problem is that the market
application is now completely full it
becomes very very hard when you launch
in your application to acquire users
more even active users and with to
retain them so we know that we have to
make our users addict of our education
and we also know that one way to keep
our user interest alive is animation
that the reason why I'm using gif is set
of Berlin fight I'm sorry I know you I
know you are all completely mad about
valid points but it's got to be a gift
presentation but the thing is we don't
we don't really know why the animation
is so important in fact it's because of
evolution but when I say a vision I mean
much more older than this one it comes
from this guy there well understand one
is on this one really important thing if
it moves it can be either two things
food or danger so in both case in mind
what's worrying a little bit about and
that the reason why our brain is so
addict to things that move because if
it's stopped moving it considers that it
says and there is no interest to looking
at something dead so just move on sorry
kitty so on the UN in on the user
interface is part of our applications we
already know it for a long time we got
css3 every mobile framer gap animated
components I took here react native and
ionic animation as example but same
party won and the really interesting
part there is to see that even in
material motion there is a dedicated
part two animations and one of the
reason
why recommend to use animation is hiding
from the user what's going on during the
scene because indeed the problem is what
it comes to data when you want to
refresh data usually it starts with a
refresh button which is not the best way
to start our relationship with our users
that's main front of a refresh button we
know that the less interactions the user
is may have to make to get the data is
interesting in the better it is so
refresh button is really not the best
way to achieve this goal and the problem
with refresh return is that usually it
comes with the loader screen of the Dead
the problem with this crane is that if
it stays for too long the user will be
quickly upset and will probably leave
the application and perhaps never come
back it looks like it's bugged okay okay
it's a connection problem down I said it
refresh with them okay yes supposed to
work offline you know so refresh
bitterness reveal we should stop using
it right now and in fact what you need
for application is a real time user
experience if you look at most popular
application from both coasts Android or
iOS you will notice that the most
popular applications in terms of active
users but also in terms of 12 times
which is the time user our spending
under you on your application if those
were completely built upon real time or
at least while using it for a very long
time I took her example ueber and
Twitter and what's up the Dakotas I've
mentioned slack orgy shoot because it's
a it's the case both in our personal
life and in our professional lives and
there is a reason why we're so addict to
real-time experience is because it has
created something new in our brain which
is called hello
of missing out the fact that those three
little dots are not dancing in my
implication told me that something is
happening something is going to be sent
and I want to know what it is so I'm
staying on my application yeah it's
something little bit silly but that's
that's how our brain is working actually
so basically what you need to do when
you get static classic recipe ice is
streaming them and when it comes to
streaming API so to make real-time on
basic UPI usually three sessions on
mentions so the first one is pulling
windows belt pulling yeah okay let's
step up and it's very on the long
pudding I guess a lot of you knows about
it too yeah the second mom which is very
popular eyes web circuits windows bad
web socket yeah almost everybody and the
last one is service and events who knows
biotin the room great not that much
people so pulling is this I'm making a
request waiting for the answer making
some request again waiting for the
answer and so on and so forth so that's
what happening the wonderful world of
theory where we would love to to leave
all of us but in reality what will
happen with polling is polling Magnus in
fact you will met a lot of useless code
you will retrieve the same that are a
lot of time unless you really know at
which we can see you have to pull you up
I people adapt you have made the studios
that 1998 dot five percent of ports they
were making were just wasted so polling
is not really a solution oneself that
the reason why some persons told
suggests long polling as a solution so
long polling is a small variant where
you keep the connection open until the
server's knew that extent okay fine it
can work but it implies that on both
side on seven clients you get jobs
looking constantly at those obsession
open so that really is capable to and
the problems the main program will rain
the same if the connection is wrapped
for any reason how you're going to
retrieve information you've been missing
during this time
and most important as a nappy I provider
how are you going to deal with all that
pose I mean if your application became
very popular and you get thousands of
devices making polling or long polling
request how are you going to deal with
so polling is not a solution neither
long polarizer and we should stop using
them too so that the reason why we
created push technologies what's the
captains have sent events which are both
on the w3c specification and appears
around same period as you can guess if
both exist is because they are quite
different so we are going to see why so
the main difference I think between web
sockets and service and events is that
web sockets are bi-directional so it
means that both the user the server and
the client can send data to each other
where r 7 sense even sees you need
original so only a server is able to
send data to the client second big
difference is that web sockets supports
both text and binary where our service
entrance on Elizabeth text so now
looking at protocols what forget as its
own TCP based protocol so it's only
relationship with HTTP is that the end
check is interpreted as an upgrade
request and then the server will switch
to a binary be directional protocol
which has nothing to see which ATP
anymore 70 runs on this side completely
relies on ATP so to use it you just have
to add the header you think they're the
text even stream header and it works so
as you can guess in terms of
configuration and I think its own
protocol means that to use web sockets
you need to reconfigure proxies and load
balancer and that's something apps are
not really sound of actually there's a
good reason why is because at first not
every proxy support web socket and then
even in them while supporting web
sockets not all of them are suppressing
them correctly so it could be a real
nightmare to configure your proxy to
support properly WebSocket server
centigrams well so it's ATP so you
have to be sure that your proxy will
support long live request a long live
session and that's it now looking at
messages format in web sockets nothing
is defining the specification so it's up
to you to decide what field will be in
your message it's up to you to pause and
unpause it to insert ascent events a
message is any line of text beginning
with the data perfect so it can be a
single line of text it can be two lines
of sex or more it can be a decent object
everything work and the very cool thing
there is that we also gets a few fields
we can add to a web message so we get
the ID field the Evans field and the
retry field keep them in mind we will
talk about them just after so now
looking at implementation so here I took
us example a JavaScript implementation
on customer side it's almost the same in
every language so don't worry about that
and the very cool thing is you're going
to fit very similar we got the keep the
hover ol idea of implementation on
server sentiments forward forget so to
create a WebSocket connection you get to
declare a WebSocket object and pass the
API you would like to stream as a
parameter with the ws or WSS prefix in
seven sent events you get to create an
even sore subject and fast yep i would
like to stream as parameters to then you
can register two different call back the
first one is on open which can be very
useful especially in web sockets case
because of maker connection is made I
synchronously and its really prone to
error so you might be interesting
knowing that the connection has
effectively be opened before trying to
send data from the customer to the
server for example then you can reduce
her to the on message call back so as
we've seen previously in web sockets
nothing is defined up to you two and
pass it properly on service and events
you just have to call the data field on
your own the object you get interim
eater then you get the on a roll call
back so I guess this one is pretty
obvious I'm not going to spend time on
it
but the real cool thing there is that
service and events allows you to not
only listen to messages but you can
defend to listen to arbitrary event so
if you remember the event will get the
same connection program okay kind of
it's a solid one but okay let's try this
one
ok
so if you're looking at the even field
we have get there by adding it to your
message you will be able to add an event
listener on those type of message so
perhaps source of all terms are not
interesting by every messages sent by
the server so you will be able to listen
only to those of them you are
interesting in or perhaps you want to
make a different treatment for those
different type of messages so you can do
it easily with by typing your even what
happened if the connection is dropped
for any reason we are talking about
streaming so we have to care about that
unfortunately in web sockets nothing is
defined subsea you to deal with sorry
about that in several sentiments we get
to very cool features the first one is
the recollection time I would so it
means that if the connection is wrapped
for any reason the browser will
automatically try to reconnect after
three seconds if this value doesn't fit
for your needs for any reason you can
redefine it with the retry field within
previously and then if you had the good
idea of added an ID field to your
message the browser will be able to add
a little header to its recollection
request last event ID and by giving the
last event the last event ID it has
received the server will be able to send
all information that has been sent
through this period so now talking about
the sensitive part process appalled so
what circuits are natively supported for
a very long time by every browser so
that probably one of the reason why they
are so popular where were several center
venting is only supported by modern
browser so not internet explorer
obviously but actually that's not a
problem because we can polyfill so we
can handle both Internet Explorer and
all the versions of other browsers for
edge at the moment it's under
consideration so we keep hoping you know
talking about mobile browser support so
it's the same for both technologies only
opera does not support them so now
talking about preferences
so this news numbers are coming from
matcha filson blog post so much as is
the developer of blood watch which is
which is an application where you can
search along with trim of to it in real
time and so you made it was it you
skated well he needed to preload 5 500
tweets when the application was learning
so first in May the first implementation
with WebSockets because that's the only
technology was very bad and quickly as a
lot of issues on his get up with
WebSockets issues actually so we decided
to give a try to service sent events and
then make this vent spark to be sure
that performance was not infected and so
first of all it was quite surprised to
notice that there was such a difference
between the illumination of the same
technologies and different brothers and
in notice that it was way more efficient
for him to use service and events
actually the fun part is that it took
some more time to write the blog post
than to write the implementation in
service and even so a sultan in
development is not that there is a good
technology as a bad one it's just that
there is a technology for you need if
you want to make a chat application or a
video game yeah obviously go on for web
sockets that will probably be better but
if you're going to send only data on it
text data and if this data is going to
be refreshed only from the server to the
client if probably on the other side you
will be able to just handle data sent
requests on by the client with classic
post requests so in this case gone for
service and events that will be very
much better so that the reason why we
built our connection to you ok
so that the reason why we build stream
that our tail which is a proxy available
as staff it works with energies in API
and basically it turns them into a
stream of data so you're going to open a
streaming session with the proxy and the
proxy is going to make the polling for
you we are going to involve everything
that can go wrong and we are going to
send you updates with service intervals
we're is a dynamic catchy it means that
if you get people joining the session
between two poles they don't have to
wait until the next one to retrieve data
we can just retrieve them the last one
from the catchy and most important we
make incremental updates so it means
that for example if I'm the first goal
we retrieve a snapshot we will retrieve
the initial snapshot of data a big
document with a lot of fields and on the
second poll nothing has change we were
not so new anything there is no point to
send you the whole document again so
okay and let's imagine now that on the
cellco only two fields of those of this
document of change we will use cheese in
patch which defines a set of operations
that could be applied on Jesus document
to send your knee what a change so if
this is for example the first natural of
that I we retrieved then on sub call we
will receive this instead of the whole
document again expressing lee explicitly
saying what has been changed and what
changes is that it was and from this
point we can just use the g's in touch
library to apply it to our initial
document so let's move to a demo you've
probably seen that I got it wrong there
and I would like to make it fly on the
Bitcoin value on Bitcoin average USB
Bitcoin value so first of all I again
I'm going to create my applications in
the developer portal if I got in a sweat
network
okay here it is so let's call it Bitcoin
so once the application is created the
token is generated and I can copy-paste
there any IP I you would like to test so
it looks like when i stream them so here
I'm going to keep this one which is one
of our internal it emulates submarket
api and i'm going to copy paste this go
c'mon there to see what it looks like so
so here my streaming sessions has been
opened I receive I've received the first
snapshot of data that's my even Cabrera
and then I received only incremental
updates which are my touch even so once
i get that i can just go back to the
Maya prediction and so here it has been
automatically provision eyes by Michael
command but I could have added them
manually and most important i can
configure them so now i'm going to
change the playing freaking Cephas but
if I was having htp errors or query
parameters I can put them there and if
I'm coming back to the terminal so I can
see that the polling second see has
already been updated without closing and
reopening the stream ok so now let's see
how it looks like when we want to make a
drunk fine so it looks my and like my
individual side yeah okay so we're going
to move on to Sibley don't know if it is
it critical for everyone yeah I don't
know how to zoom in how great better
yeah ok so here it's a very simple not
project I got only is really very
important the first one is the event
source library so come on geez in touch
and the third one is the API at the
Liberty i'm using two pilots drum so
first of all we are going to create a
drum client
by calling I a drone create client with
an option subject which we are going to
define there and say options the IP
equal ok then i'm going to create an
event sore subject so let's call it even
sauce and say new event source of API
I'm going to declare my my API there so
the i am using is this one bitcoin
advert a pie which i'm going to put
there in place of stream data API ok we
are going to need a data object and the
last subject ok and once we get this we
can just start listening to some event
so we are going to say even thought that
our event listener of the first event we
are going to listen to is the data the
data event which i send me the first
nature of that app I'm going to retrieve
a snapshot subject ok so I'm going to
assign it to
just to assign it to my data object so
here I'm going the data field on my leg
and here my last subject will be
developed left and so from this point
well i'm going to log what's going on so
that you can see values in real time
it's going to be left and then i can say
drones that back off okay so then i can
register to another event the patch
event which is going to send me that
chip and here i'm going to just create a
temporary variable called patch patch is
the data and hey i'm going to use my
jesus H library so I'm going to say
Jesus such that apply on the data object
the patch subject and so we're going to
log it so it's I will patch left that
out of sauce and we can try but begin
comparing it so if our last value isn't
that our data that other cells value
which is the last one I received it
means that the Bitcoin has gone up so
and we're going to tell tell the drone
to go up at a speed of other five it's
not the case it means that it kind of
gone down and we are going to talk drawn
to go down on the speed of 45 and
finally we reassigned our last value to
that out of class ok so now we are going
to listen to the error event just in
case might be interesting
so first of all we are going to log
what's going on then we're going to set
drones length obviously and we are going
to close our wave and tooth and then we
are going to make something quite
similar because we don't want the door
to just you know fly over for the next
20 minutes so we are going to say it
wrong that after 30 seconds and it's
going to be very similar to this one and
it's not into rich so the same shortcut
so let's say time's up ok so now i'm
going to share my connection to the
drones thank you sigh so sharing
should be good
so we have to wait for the don't be
ready 319 yeah great and now we can
simply try to communicate with it to be
sure that the collection is opened okay
nice and so now we are going to so I'm
going to run directly and then oh yeah
it's me mmm okay what's going on
well oh yeah it's not infinity thank you
ok so here we receive the well first lap
to drain it the drone is taking up ok
hang up the other one down great
ok that the sitting part where you're
jumping on the throw yep I said so I
really hope I convinced you that service
entrance is a nice thick surgery if it's
the case you can vote for its support in
age I will very likely thank you for
that if you have questions I don't know
if there is some are to me so with a lot
of time we also get some stickers and
postcards and nerf guns so grab yourself
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>