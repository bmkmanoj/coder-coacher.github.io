<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Behavior-Driven Development in Java with JGiven by Jan Schäfer | Coder Coacher - Coaching Coders</title><meta content="Behavior-Driven Development in Java with JGiven by Jan Schäfer - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Behavior-Driven Development in Java with JGiven by Jan Schäfer</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/x-6bT_0dTWI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so sorry for the delay I had some
technical problems and still some of my
leftovers are really working perfectly
but I hope it will not be a problem in
my life demo so yeah my name is Josh - I
come from a company called TNG which
does projects in the Munich area in
Germany and we are mainly doing Java
projects and I'm doing that for five
years now and today I will talk about
behavior driven development in Java with
J given try given as a new framework
which we developed about three years ago
- yeah do behavior driven development in
Java so to motivate a bit first why you
should use behavior driven development
or maybe what's the current problem with
standard tests I would like to show you
a small example and this is the pet
clinic example from the Spring Framework
so it's a demo application which shows
you the features of spring and the nice
thing about this example is that they
they also have automated tests for that
and I want to show you one of the tests
they wrote and the I like the example
because it really shows the typical
problems that that you have when you
write J unit tests and it's and there is
a couple of them so this is the test and
the first thing which you typically have
to do if you see a new test most likely
it's some test which was which failed on
your continuous integration server maybe
if some colleague of you wrote this test
three months ago and now you have to
understand what the test is about
because either the test is read because
maybe you have broken the production
code and you have now to fix the
production code or maybe you have
changed the behavior of the application
and you have to adapt the test and so
the first thing is to try to understand
the test and I will try now to to go
through the tests and maybe we read and
stand the test so we start with the
first line the clinic servers find on
about a d6
so here already we have a problem with
we are getting some owner by ID six we
are not knowing whether this owner is
really relevant or not or this ID is
important okay but it's some owner six
when we get the number of of pads from
this owner store it here let create a
new pad give it the name Bowser
okay maybe the Bowser name is not
important here I guess but okay it's
nevertheless we see it here when we get
the pet types and the pet type with with
ID 2 and set the type of the pet - ID -
we also don't know what the ID 2 is here
the pet - we set the birthday date when
we add the pet to the owner and
afterwards we check that the number of
pets has increased by 1 we save
everything and check it again afterwards
so what are the problems with this test
so first the first thing is that the
test contains a lot of irrelevant
details which are not relevant for the
test because the name of the ball or the
pet for example is not necessary in this
case it is that really doesn't matter
still some may be the pet has to have a
name because otherwise you could not be
stored so we have to somehow put
something there another thing is that
there are a lot of technical details
like collection types or entity utils
and so on these are technical necessary
for the tests but to understand the
purpose of the test it's actually noise
and it makes it more difficult to
understand the tests but there are
additional issues with with typical
tests so I've shown you two of these
problems and these problems make it
typically hard to understand the point
of a test and which is important another
problem which often occurs is that you
have countable occasion and tests it's
often the case that even good developers
don't apply the same clean coding
guidelines for test code like for
production code and this often leads to
the problem that you have such a test as
I've shown you before and then you want
to create another version of the test
maybe you slightly modify it
then you copy the test modify the detail
and now you have two tests which are
slightly different and both are hard to
understand which makes it even worse
but then there is another point mainly
that these tests can only be wrecked by
developers so you cannot go to domain
expert and ask the domain expert whether
the behavior just described with your
test is actually what is intended or
what the implication should be should
we'll be doing and this also means that
you cannot really use this these tests
as documentation and this is somehow a
pity because typically you invest a lot
of money into that automated test Suites
typically it's about 50% of your code is
in test code and any and you have a
documentation actually which is written
in code but you cannot use it as a
documentation because nobody can read it
except the developer and even for
developer it's hard because of this
noise as I shown so what can we do about
that
and the good news is there is actually a
methodology which can be used which is
called behavior drum development and
it's actually already 10 years old and
exists a long time now also in the Java
world so the question is why don't we
use behavioral development if it's much
better I've shown you here
a typical BDD scenarios this this
scenario describes the same behavior
that I've shown you before in this in
this test so you see this is written in
a domain-specific language so to say
everybody can read it you don't have to
be developer and it's easy to understand
it doesn't contain any technical details
and the only relevant detail here is
that it's a dog actually there's also
not really necessary in this case
otherwise you can read it and everybody
can understand it so then we can look at
the Java world and look for frameworks
for BDD and there are actually a lot of
them and they are already quite old so
Jay behaved is about 10 years old and
there's cucumber and also well known as
Concordia on Fitness and I call these
frameworks the classical ability
frameworks because they base on
technique
to split the scenario from the Java code
that XD execute the scenario so in
cucumber for example you have a plain
text file and then you write Java code
to to bind the text to an executable
Java code and you write regular
expressions so you need glue code to be
executable the problem with these tools
is that they add an additional overhead
to your tests so you have to write plain
text files or you have to write HTML
files and you have to write a glue code
for that and if you are a developer
typically you don't want to have
overhead and in our experience and our
projects we actually tried cucumber
because we had the problems that I
showed before we want to wanted to solve
them with BDD we tried cucumber and
after a couple of months we actually
banned it because it was just too much
overhead for us and then there are more
developer-friendly tools like Spock
Scala tests Janerio and there is also
serenity BDD the problem with these
tools is that they require except for
the last one require different language
all right for smoke you need groovy for
Scala test in its color and so on so if
you are in Java project with a lot of
Java developers it might be a problem
for you to introduce another language
just to have nicer tests serenity BDD is
an exception here it's only also usable
with Java but it's also quite new
framework and when you're given was
developed serenity ability didn't exist
in this and this form yet but has
similar concepts did you give him okay
so we wanted a developer friendly bdd
framework for Java
it was three years ago and as a good
developer we asked Stack Overflow and I
wanted to show you because I really
liked the answer basically the answer
was ok you don't need any framework in
Java you just write comments like given
when then and so on and then it's
basically BDD and on the other hand the
he also mentioned the framework I
mentioned before but I really liked the
last sentence and I want to read it to
you it's says I also think that the most
successful BDD frameworks for Java or
those that are not written in Java
since the Java language has no such
flexibility for DSL or domain-specific
language creation
that grooviest callus so this was then
the starting point for for us to really
try out and and implement our own
framework in Java and the result was je
given and the rest the rest of the talk
and mainly we'll give a demo but first
of all I want to show you the four goals
that we had when we created the the
framework the first one was it should be
developer friendly like maybe spark or
something so it should not it should not
be necessary to have different files for
your chest you want I wanted to to have
the scenarios with named Java directly
but I wanted to have this BDD form so
given when them form should be
maintained and I also wanted to address
the problem of reusability of tesco this
was also something which we had in our
in our case and finally we wanted to
have readable reports that we can show
the main experts so that we can really
use what we what we are writing as a
documentation later ok so let's try it
out ok so maybe before I start I show
you the spring pet clinic example it's
already here and for that I start the
demo and we shortly check that actually
what I've shown showing you is actually
working and let's see
okay it's not working yet but okay let's
let's give that part which we just tried
directly and because of I have not so
much time anymore to fix that so we have
a look now at a edit test from the
former pet clinic so this is a test
I actually made up myself it's it's
similar to the other tests I've shown
you but it's already a cleaned up a bit
because it doesn't rely for example on
this magic numbers so what the test here
does is basically it creates an owner
saves it will the owner of the
repository afterwards we are searching
for the last of the owner by last name
Smith so that's a feature of this
application that you can search by
owners afterwards we verify that exactly
one owner is returned and that the
actually the returned owner is actually
the one that we created in the beginning
so first thing I will do is I will write
in our comments which then will remove
later and described with the comments
what actually the intent is so I will
write a scenario for that so given an
owner with last name and Smith that's
the first part then when searching for
for Smith then there is then exactly one
owner is returned and finally and the
returned owner is the given one so this
is the scenario which I want to describe
and now I will refactor the test so
after that we after what's used a given
and we can remove the comments actually
so first thing you do is enjoy given at
the dependencies so there is a maven
defensive or that I have already already
at that otherwise okay before I do that
I will actually show you that the test
is actually executing and hopefully this
works now
from the IDE okay so you see the test is
actually working and first thing is you
extend from our given class which J
given provides you that's actually not
really necessary but it provides you
convenience features which you can use
in this case we are having we have a
spring test so we need to inherit from
the spring scenario test otherwise you
would inherit from scenario test these
test classes are just really simple so
you can basically also use the rules
that J given provides so in fact you're
given is actually implemented by two J
unit rules if you use J unit you can
also use it with test ng if you want in
this case I have J unit but if you enter
it from the class you you get some nice
syntactic sugar so the first thing is
you you enter it from the class and then
you provide three new classes these are
actually the called stage classes which
later contains this the implementation
of the steps of the scenario sorry give
now the three classes given owner when
searching then search result and in the
beginning it it looks like this is an
overhead actually but this is exactly
the way how J given provides you the
possibility to reuse
test code in other scenarios so
typically you don't create three new
classes for each scenario but typically
you typically you reuse a lot of them
and maybe only create one or one of
these new classes so now I've created
the classes and and I will replace the
code with methods so what you typically
want to do so I will right now given an
owner with last name
Smith so we just create a method exactly
like the comment
we now need the owner repository which
are first injected here in this test
class now now I needed in my stage class
so I will move this into this class here
so that we have the only repository we
have to annotate this now with J given
stage because it's a spring test and
otherwise it will not the auto wired
feature will not work otherwise if you
will if you're not using spring you
don't need that annotation okay so we
have just moved the code behind a method
and now the method is exactly like the
comments so we can actually remove the
comment and now we can try executing the
test again ah now the given owner is not
existing here that's a problem but we
will fix that later so let's uncomment
it out for now and now you see the test
is working just as before but there is
an additional output here which is
generated by J given it's actually taken
the name of the method here and this is
the title of the scenario and next it
uses this method call here and replaces
and put and generates a report for that
and this is all without having any
additional annotations or or something
like that so it's really a low overhead
for you it's basically you have
basically nothing to do except for
creating a method for extract your to
move the code to it's not so nice here
that we have the Smith inside the method
name so that should actually be a
parameter I would say so let's fix that
and we add the parameter okay you have
to rename that
and that should be it that's restarted
and you see that you can also have
parameters without problems and final
thing I don't like is that it's not in
quotation marks in the original report
it was in quotation marks so let's add a
quoted annotation to that so the report
actually adds quotation marks to that so
now you see that there are collation
marks around it this is a feature of je
given which allows you to define custom
annotations and provide a custom
formatter of your arguments which is
quite useful in certain situations okay
let's fix the next one if you wonder
which what this methods here actually
return and the this given one and then
methods they actually return instances
of the of these classes here so these
stage classes so when searching for ok
we can directly use the argument here
with searching for Smith I should have
renamed that
then we need the clinic service again
and we move that to the stage class and
we should not forget to add that you're
given a stage annotation so that spring
works as expected and then we can remove
the comment again and the same thing we
can do now for the last one then exactly
one order is returned okay that's not so
nice that we have to write in one here
let's replace that with a placeholder
and the one we can have this here okay
let's import the static method and now
we have a problem because we now need
the found owners variable here inside
this stage which is only existing here
actually as a local variable so what do
we do about that and that's a typically
typical problem that you that you have
when you try to refactor your tests to
have clean code because you typically
have to pass around a lot of parameters
we could now return this found on us and
its world in a variable here and then
pass it to the next method but then it's
again an unclean test and I want to
avoid that so actually there is a
feature in J given that helps you here
you can just store this in a field of
your stage class like that you have to
enter Tate that with scenario state and
after that this variable is visible in
other scenarios if you and other stages
if you put the same field here and it's
like dependency injection and also
extraction so to say and now you have
access to that and you can execute the
test again and you see now the report is
completely finished the last one is
missing I will not do it now because of
time reasons but we can you can imagine
how that this is easily fixed like that
the other ones and now you see here the
cons are the console output which
exactly looks like
scenario shown before something like
that you would typically write in
cucumber in text file and J given it's
just generated for you okay
the the text output is something which
you typically don't want to use as a
documentation because the domain expert
might not want to have texts as
documentation so what you're given also
provides is a HTML report so you can
generate a report and this looks like
this I can show you here maybe the
report from J given itself so if you got
go to J given aa toric you will see that
it contains the J given report of J
given so to say because I've we are
testing J given with J given and the
report looks like that it's it's
actually an interactive report which
which you can interactively navigate
through so here for example you can look
for all scenarios it shows you all the
scenarios which you have written you can
have tax in your scenarios so you can
group group yours in Eris by tax and Oh
show yeah but that you can then
structure your your scenarios in a
useful way
and here you see you can also have
attachments in your report
like screenshots and so on and you can
also search for switch for scenarios if
you want so that is something which you
would typically give to a domain expert
and and typically what you do is you
generate the report for example with
your continuous integration server and
then you always have an up-to-date
documentation of your application so
it's actually a living document document
which you can which you can show
everybody and it's
very useful for documentation purposes
okay so that's basically it so there are
a bunch of additional features which I
haven't shown you yet because of time
reasons but you can have a look at the
web website and then you will see what
else can be done well just sum up so
they given us actually a developer
friendly tool and that was an important
goal for for us when we develop it it
should be really something which
developer likes to use and doesn't add
additional overhead when the tests are
developed it allows you to formulate
your scenarios in a highly modular way
and it allows you also to reuse test
code this is what's really important for
us and it really works nicely
it's just Java so you don't need groovy
or Scala you can just immediately use it
in your java project without learning a
new language or requiring additional
tools in your test infrastructure yeah
you can easily integrate it into
existing test infrastructure because it
works was j-unit and it works with tests
in G you just didn't add the new library
and you could start migrating the tests
I've shown you that you can even
partially migrate your tests and that's
really a nice way to if you have legacy
tests to to move to the BDD approach
it's actually open source or it's under
the Apache 2 license so you can just
download it and use it immediately
there are maven and Jenkins plugins and
there is also a greater plugin currently
under development but you can also just
use it just call the HTML reporter it's
just a job of Java file which you can
execute it and the good thing is that
the domain experts can finally read the
scenario reports that are generated by
je given and you can use it as a
documentation and collaboration tool
yeah so that's the main thing about BDD
is that you can call it the developers
and domain experts can collaborate and
the way you do that is by you
these scenarios and this these are
really the basis for your communication
actually the only thing that you cannot
do is with je given and this is
something that you can do with cucumber
for example is that a domain expert can
actually write scenarios on their own
and this is not possible in a given
because developers have to write them so
if you are in a situation that you have
a domain expert which actually want to
write scenarios and then it's not a
framework or a library that you can use
here but in my experience in most
projects it's typically that the
developers write the scenarios and in
this case you shouldn't use a framework
which has an additional overhead and
instead you should use the developer
friendly tool and finally in fact the
domain expert can write the scenarios in
any tool that domain expert wants it can
write it in word injera in Jarra
it doesn't matter in the end the
developer can just translate the
scenario in Java code in a very fast way
so in the end it's not really a big
issue in my opinion okay so thank you
for attention and yeah if you need more
in or 1/2 more information you can go to
the J given dark side send me a note on
Twitter or go to the github page and
open an issue or whatever you want ask
questions or afterwards I'm also here
for the whole week so if you have any
any questions then I'm happy happy to
answer them
so thank you and
so times up maybe I
if there's one question I think we can
get it otherwise it's afterwards come
down to me okay I don't see a question
now then come just on afterwards okay
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>