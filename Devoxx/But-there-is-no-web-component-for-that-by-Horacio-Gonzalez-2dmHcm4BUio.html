<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>But there is no web component for that! by Horacio Gonzalez | Coder Coacher - Coaching Coders</title><meta content="But there is no web component for that! by Horacio Gonzalez - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>But there is no web component for that! by Horacio Gonzalez</b></h2><h5 class="post__date">2017-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2dmHcm4BUio" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hello everybody my name is Horatio I
am Ana Spaniard I have been living in
France for some 20 years so yes my
accent combines the worst trait of a
Spanish term French accent and you are
going to suffer that for half an hour
I'm really sorry I am a software
developer in a start-up citizen data we
work on an open system studies database
I am the tech leader of the front-end
part and I mean I am also rather
implicated in local communities local
conference and two years ago Google
appointed me as Google developer respect
so I am here because I had a problem I
have been working with a component for
several years and since my first real
application I find I found a problem and
I tried to solve it in different ways
and then now when I speak about both
components around me there are a lot of
people with the same kind of problem so
I am going to try to explain my solution
and why I think it's a good solution the
problem is city you have a new
application you are using web component
and then you need to add a feature
rather a specific feature for example
you need to generate a QR code you need
to do some data visualization and you go
to the different web component catalog
web component dot org or any other and
you find no web component doing what you
need but there are always some
JavaScript library to do it there are
JavaScript libraries to do everything so
what can you do well my talk my point is
that it is not a real problem it isn't a
show
it doesn't prove that the web component
doesn't work
you will need to take the your library
the library you have found and wrap it
in the web component and then you will
be able to use at any other web
component my point what I am trying to
show you it is more sample it is sample
that it sounds you don't need to write
any complex code in order to component
Allies as a script library so let's
begin with with some context let's begin
with the history or how I did found did
find this problem and why I did begin to
work in this kind of solution so let's
go back some years ago in 2013 I began
to work a citizen data and as fronton
leader my first task was to build an IDE
to allow our users to deal with our time
series database so at the time I was a
real angularjs fanboy I had been doing
grid for several years and after grid if
you have done greet you understand me
after grid angular was like a sunshine
in a cloudy day it was wonderful so I
did Mon IDE with lot of directives and
it was nice it work it several time
later my boss asked me yeah I know we
know we need a dashboard monitor for
monitoring some data visualization some
of the same features that the IDE but
some new features ok no problem
I took some of my directives I create a
new viola a new art I created some new
directives and everything work it
it was happy but happiness doesn't last
several time later my boss come again so
now there is a customer who want to use
your dustbowl insist application nice I
can give them this source not you have
it you haven't understood he doesn't use
angularjs he use another technology and
then
but I need to rewrite all my monitoring
dashboard in another technology it took
several weeks I wasn't really proud
because it was quick dirty but it's work
so I told myself okay it was a bad
moment but not several weeks later he
comes again
we need another version yet but this
time it's for a customer that only use
plain old HTML pages in a proprietary
CMS but but you need to record it again
and that time I knew that I needed a
solution well it was 2013 so I thought
look at Google i/o presentation about
polymer it sounded exactly I was like
what I needed a you have some website
modules you can combine them you can use
them and any technology any framework
it's wonderful
oh it's a bit alpha but it's wonderful
so it sounded too good to be true but I
told myself the next application I will
do it with with component it wasn't easy
the technology the technology was young
not very well supported
there were polyfills everywhere mmm
Google guys the galaxy you can see him
at the Google boss over there told me
you are crazy it's an alpha it's not
production really don't do it but when
you are in need you cannot afford to be
picky so I did it and I did it and it
worked I got a deadline it was for our
company both CS de las be at las vegas
in 2014 i had two months to do it and it
works the whole story
you can read it there but that not the
point of this talk the point is that
wait while i code that application I
found a big problem
I needed to do that the visualization I
needed to do hit maps lot of data
manipulation and the world
there weren't any there wasn't any
component to do that in the official
Google catalog for polymer in Mesilla
catalog of work component
no one has dude has done it with what
component yet so I told myself what can
I do
I had three solutions the first one I
could simply wait for somebody else to
do it but I shattered that line the
second one I could try to use directly
deliveries this region years and vd3
directly in one of my components I do
some a team way to make it work
a bit like people who use jQuery inside
an angularjs application it is a key
it's difficult to maintain but it works
or I could simply do the right things in
my mind I could write a clean
implementation of a component wrapping
d3.js
and wrapping and VDC so I try to do it
the first time it was difficult but it
worked and I am going to explain you how
I did because there wasn't only a thing
I needed for this application since then
I have done all the fronton apps of my
company in polymer and it has found the
problem a lot of times I need a new rich
text editor for your IDE ok let's use a
is no implementation in component but
let's do it I need to acquire code
generator it's nice there is no code
generator in the web component catalog
or let's do it every time I begin to
develop a process the same process for
all the library and I realized that yes
for some libraries you need to do
a bit much code you need to enter inside
the library to see why it doesn't work
as it showed but in general
it's an easy and systematic process if
you do it you finish rather quickly by
having a component that you can utilize
you can use them in any of your
application so let's begin with an
example the example was a QR code
generator I need it for a sign
functionality
I needed a QR code generator a rather
flexible one it should generate QR code
from numbers from alphanumeric text from
URL and I needed it to be configurable I
needed to generate variable size QR code
with variable number of elements I
needed it to generate both a HTML and
PNG format so I needed something I could
pull out finally in my application and I
did it to be sample because it was the
site feature I didn't want to spend one
month coding it so I began by doing by
looking around the JavaScript libraries
and I choose curious it's a very old
library from 2011 it's ready stub stable
and it was very well sweet to my
application it's small it's quick for a
site feature it's important
it's rather well code why it's important
because sometimes you will need to go
inside the library for kid some do some
modification so if you take a library
that it easy to understand you are
making your life easier and a side
effect that I didn't know at the moment
it doesn't manipulate directly there
and wait that's important because with
what component you are working with the
shadow Dom so most library that
manipulate directly the Dom tree suppose
that every element of the Dom tree it's
a grand grand grand child of the
document so they can do document query
element by ID and it doesn't work in a
shadow Dom world so this one submit good
it was good and then I began with my
steps to always the same steps I begin
by creating the element then I add the
library as a dependency what working
with polymer using Bower with other
technology using NPM or any Ciera and
then in the element file I load the
dependency there are a small subtility
there I will speak about it and then you
simply build a web component that we
wire the library to the outside world
and that will do it in a web component
way you send the attributes as an input
and the events as an output so the first
step the first problematic step is how
do you load the library if you are using
legacy libraries they are all well
almost always
libraries the right things in the global
scope libraries that are a module
arrested so in order to use it in your
component do you need to load the
library once and only once even if you
have multiple elements in the
application that use your library and
you need it to be loaded before your web
component is initialized well for my
first elements I did it in a quick and
easy way I simply used the script tag in
the element file an ID as the element
worth load we
HTML imports I knew that they were only
load once so I suppose that everything
was going to work and it work it it
worked while I use it in full polymer
application but once I had the problem
with an angular application that loaded
the same dependency in another way and I
had the dependency loaded twice so it
was a haughty way then I decided to do
it in a more computer science science
way in my element before loading it
I looked if the library was load of is
it it was loading then I load the
library and when it was ready I
initialized the element it was nice but
it was not of code I didn't want to do
it every time I create a new view a new
element with a dependency so I did the
only thing that makes sense I component
alized
the dependency grabbing I create a small
behavior for polymer 1 or mixing for
polymer 2 of an eatable component
something that all my elements will
endure it that will that will manage all
the dependency graph in process so in
dust mixing I take my dependencies I see
if they are lured if they are loading I
load them in the right order if there
are several and then add then I send an
event to my element to say hey you can
go on all your dependency starter so we
can go to the real problem I have a
library it's load how can I take that
library and offer to the outside world a
book component interface well there I
almost always use the same guide
I began by defining the inputs they
attribute the attributes I need in order
to fill out my library then I define the
output
the event that my library is going that
my element is going to send to the
outside world I define what I need in
the UI side a template and then I wire
everything in order to link the
attributes to the way how the library
expects the information to arrive and
then then you can simply initialize
things is you need it
and use your element don't try to read
the code
it's forest for the QR code generator
the only interesting things is that it's
a very flexible library there is a data
a data attribute the data you want to
encode and there are a lot of other
attributes but for most of them I simply
define it as default value so they
become optional attribute you don't need
to use them in most application only
unless unless you need to do something
different for example if I needed to do
bigger or smaller QR code of if I wanted
to generate an image file instead of
HTML and blocks so and I also other
added another element and auto I will
explain later why the output my
component is a simple one it's only need
to push an event when QR code has been
generated the template well then you
need to know your library maker code
library was very simple they want it
wants you to give it a Dom node and it
will create all the QR code inside that
Dom node so in my shadow Dom I create a
div element and in the initialization I
am going to tell my library age you put
your image or your estimate
generated QR code inside it and then we
do the wiring for the wedding the first
thing I do is making some validation for
its attribute I do insanity cycione
validation in order to discard values
that made no sense for example and
negative size for the block why I do it
because most libraries if they are
well-written they are already doing it
in the inside because then my element
when they iterate it receives an wrong
attribute is going to send an event or
to replace it by the right attribute so
for the begin you don't need to the back
inside the application you can debug
component by component it's why easier
what you are doing an application with
lot of components say indirectly the
arrows at the component level then I had
a listener a listener to know if the
input parameters have changed because I
wanted a flexible mod I wanted if an
attribute auto was on I wanted it to
generate a new QR code on the fly every
time a parameter change and if I put it
a false
I wanted it to don't generate a new QR
code and only generated manually when I
call the method to generate it so and
then and then I wire the everything to
the library my library expects to have
an options object you call the library
with options object and atom nod and it
will generate the QR code there so I do
a sample mapping I create an options
object using all the properties I have
define it and I call the method to
generate the kind of QR code I want to
join
and then I listened the library to tell
me when the component has been generated
and I can push my event to the outside
for the moment it's only a rather
mechanical mapping although I create an
object I call the method the advantage
is that for somebody using the element
he doesn't need to know anything about
my library she or he only needs to put
the attribute and listen to the events I
can tomorrow change my library for
another implementation and change my map
in every single work so it worked I have
a nice pure code generator it was nice
and I told myself a if every time it is
still so sample is going to be great
sometimes it isn't so simple
several months later I needed to do an
application for the Box u.s. QR code
scanner it was a quite a challenge
I was rather proud that the Box Q hadn't
told me to do it to try to do it I
wanted to do and full progressive web
application to ask an attendees but
buddies and it was for the sponsor so II
needed to work so I told myself well I
only need to a scan a QR code I have
already generated QR code it will be
easy
well it wasn't so easy
there were a lot not a lot of code
scanner JavaScript libraries I tested a
lot of them most of them didn't work as
intended several of them didn't work at
all
so I took the three for that work it I
did the same kind of analysis that the
last time I wanted something small
something quick something well return
and I chose yes QR code by Laster soft
good library is also an old library it
was small it was quit it was well code
but I hadn't seen it did some dirty dumb
manipulation and it was going to come
back after me sometime later so I took
my test so we need to do that that
dad
well I create my element I used the
dependency grammar to graph my
dependencies everything should work ok I
need to write to build the web component
encapsulating it for the input and
output it was even sample
I added some functionality like an
active attribute in order to tell the
library to shut down because they by
default the library it scans every time
when you initialize it it will scan even
if you have new no new video flow it
will scan every time so the battery went
down rather quickly so I added an
attribute for that I added a property in
order to get via properties the decoded
value if I needed the video size 1 the
the only output was an event when I had
decoded a code the template I told
myself a it's a very simple library I
only need a video what is a canvas and a
video a video tag in order to use web
RTC and get the video flow for your
telephone or your computer a canvas to
take pic of that video and the library
is going to read the canvas and analyzed
looking for our QR code well it was the
theory because I discovered then that
all the browser's implemented web RTC
for years Chrome Firefox add bad
not older browsers Safari still didn't
implement well sissy in fact Safari will
implement it in iOS 11 that will be
released and essentially soon I think
but at the moment when I wrote it
Safari didn't support web RTC at all so
I had to do some hacky things in order
to tell iPhone to open the nuttiest for
native photo application to take a pic
and to capture the pig and put it in my
canvas so this way it seems way more
complicated that it should then I
initialize my component so I tested if
my if my device supported web RTC or not
if it's supported web RTC I initialize
web RTC if not I initialized the call
for the native Bitzer application and
then please don't try to read it and
then I began to tell myself no it isn't
so easy because web RTC it's both
supported but it's rather different in
its different browsers so I had to test
it I was in Chrome in Firefox or Annette
and doing the right initialization for
each browser and it had to test this I
thought a multi-camera or not that doing
the right initialization but it wasn't
very difficult it was mechanic so I was
happy almost no whaling it should work
no it didn't worked and I spent several
time trying to understand why it works
outside my component but when I put it
in a component nothing work it and it
explained that the dirty Dom
manipulation bite me
I dig in the library I went down and I
show a line maybe you can see it
document dot get element by ID clear
till cure canvas in
is suppose that your tag your canvas tag
it's going to be called QR canvas and it
is a grand grand grand title child of
document so it couldn't work in a shadow
Dom world but then my idea for I did a
fork I tried to keep to keep exactly the
same functionality I didn't want to
break anybody's code but I added
parameter in order to give it manually a
Dom element if I don't give a Dom
element it's going to do the by default
behavior but when I give then a Dom
element is going to use it and then I
could pass to my library the Dom element
so the shadow Dom problem it wasn't a
problem anymore
I have found that many libraries it's
really important to understand how the
your library works with the dome and try
to choose libraries that work with Dom
elements and not with IDs or with fixed
I did I did and then and the network it
was used for a by the sponsor and it was
a rather innovative way to test
progressive web apps there are some
other examples and always the same idea
you are going to wrap in this case ace
is a rich text editor in a good
component way with attributes and events
so so I have one minute left I have done
it with lots and lots of libraries I
haven't found any library that I
couldn't with a small fork sometimes
adapt to this approach and Nisus never
taking more than one or two days to put
your library in a component way and then
and then you can use it everywhere and
you can the correlate it from the
library in networking you can use it as
a normal web component so yes it will be
better to have both components for
everything but if you are working before
a component and you don't have the
component you need don't be afraid look
for a library choose the right library
and one or two days later you will have
your component so I think time is up
thank you very very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>