<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Real world serverless - architecture, patterns and lessons learned by David Schmitz | Coder Coacher - Coaching Coders</title><meta content="Real world serverless - architecture, patterns and lessons learned by David Schmitz - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Real world serverless - architecture, patterns and lessons learned by David Schmitz</b></h2><h5 class="post__date">2018-03-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uMCtcZ46gns" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you for coming here this is real
world serverless
as if service was anything but real
world I can't see anything so if there
are any questions you have to scream
okay because the slide is blinding me
all the way Who am I I'm David I'm from
Germany Dusseldorf best town in Germany
I guess I work for a consultancy is a
narco technologies we do not do business
in Switzerland I guess we're only an
Austrian Germany so you might not know
us we do technical stuff for insurance
companies and then financial industries
stuff like this and you can find me
under my label Kuna cut sir on Twitter
github and PlayStation if you want to
play fifa oK we've caught before we
start I want to know who you are so four
questions who is actually building
microservices well it's 30% introduction
and who's using containers docker if
there's more than the micro service guys
so good is anybody running on a cloud
public or on premise anything other but
OpenShift a couple of hands thought so
and it's anybody experience with
serverless
ok just two hands that's good because
nobody can tell if I'm lying great
so before we start I'm not a vendor we
will talk a lot about AWS and Amazon I'm
not a vendor I have no preference
whether as your Amazon or whatever I
don't care and I'm not a cloud cool I
don't like to turn guru what's a guru
that's some guy who meditates That's not
me
so I play around good stuff I apply
stuff but everything I say should be
taken with a grain of salt that said
that's a comparison between my
experience doing Java and lambda stuff
server the service is the blue part for
those of you can't see it's obvious that
this is an emerging technology and I
think I'm more experienced with
classical web
applications and instead of Cerberus and
things are moving fast if you watch
reinvent AWS reinvent videos or been to
the conference yourself you will notice
that every two weeks everything changes
on AWS and service so everything I say
will be out of date I guess what can you
expect why shouldn't you leave these are
things we've learned when rebuilding an
internal application plainly on
serverless technologies on AWS so
everything I tell you is pain that we
experience that's why I have gray hair
the business case it's not so important
because we are technicians we don't care
about business you know we have a
internal application it's called
employee administration platform and
it's bailed on ASP and asp.net and crazy
old Microsoft database and we use it for
billing you know we are consultancy
builds our business so we use that to
generate this building's based on where
you work and follow along and we set
together as technicians and delt let's
do service and that was the idea we have
nothing more concrete than that let's
keep the asp.net models running on
premise and dying there of old age and
let's build everything else on on lambda
just that you have no idea of the
complexity what we are building and this
is work in progress if you are
interested in learning more about the
technical details come to me afterwards
and I will stick around so we have to
cover some basic I saw that not everyone
here is familiar with servers so we have
to spend some time there we will talk
about security because security is
really key when you go to the cloud
I think there was a project I've been
working on which has been shut down
because of security we'll talk about
tools as an architect I will talk about
architecture I guess and housekeeping
housekeeping is equally important in the
cloud I mean I will tell you why and
even operations even a land of servers
there will be service spoiler alert and
we only have 50 minutes I was told that
I will be shut down hard if I overtake
my time so
if you have questions and we couldn't
cover everything in that come to me
afterwards okay so some basics
aw lamda I can't really make out anybody
of use so I will just take my experience
back in the days we worked in such
buildings grey buildings banking
industry okay and we're very proud to
have our own data center own machines
who's working that environment by the
way come on you're kidding you're among
friends when we realized that this is a
bad approach and we moved to
infrastructures as a service basic ideas
that we are not so much interested in
maintaining the actual machines but
rather in abstracting away their
Hardware and working with virtual
machines was a good idea worked great
but it could be improved even further
but the platform as a service like
Heroku or open chef the old one and this
looks approximately like this instead of
deploying virtual machines we deploy
applications like when you deploy to
Heroku you do not exactly deploy a
virtual machine you just wrap your
application to something and they
provide the abstraction below and then
we are using containers I saw that many
of you are already using docker so you
talk offense and we all know docker
school solves everything we need to know
about micro services unless you start to
think about it and how do you provision
all this stuff what about scaling yeah
monitoring mmm-me tools for that state
and docker I think are good friends
security might be needed and what about
deployment and other things and then
there's one big solution who can name it
awesome we'll come to that this is
difficult and we are using this approach
how to draw an hour
who knows who can who can draw an hour I
can't but there is a easy way to do that
and that's the same with distributed the
systems you just start easy you start
with a circle for the head and a circle
for the body it's really easy and then
you drop the rest
and that's what kubernetes does for you
you have all these these basic ideas and
then all the rest and we've been using
kubernetes for quite some time now and
quite successfully it's not some tool
but in general it looks like this you
have two or three guys who know
kubernetes it's more than just a service
llaman by the way and they start
constructing something and it's awesome
it's it looks awesome it looks dangerous
also and and I will show you now a real
slide of actual kubernetes architecture
if we've been working on it's this and
by the way if you're a developer that
little tiny pod up there I don't know if
you can make it out with some
looking-glasses
that's what interests you all the other
rest is just whatever and when I first
first saw that I react like this I know
it's not for me it's not for me so this
is where service enters the idea is it's
server less but you can't define
something by saying what it's not so
it's very bad name if you look at the
documentation and I will read this no I
won't read this this is from from AWS
from your home page exactly and I think
they explained it quite well they say
you can do things without thinking about
servers there are service but you don't
think about them and you are not
required to manually provision them to
scale them to manage them to patch them
up and you can focus on whatever you are
really doing that means the selling
point is you can focus on what matters
you can ignore everything else and we
will see that this is a big lie
obviously I already told you I will just
focus on AWS but there are others and
there are similar providers like like
Asia functions like like Google cloud
functions and web tasks and you even can
run this on your kubernetes if you want
to but we are using AWS because they are
going to the moon my guess so
they're cool some basic terms that you
have to know lambda is just their term
for service compute their I have a I've
ever owned many other service offerings
like a database or s
three where you can host your webpage
lambda is basically code that runs oops
too fast s three who's using Dropbox
anybody yeah
s treats Dropbox easy that means you can
store files objects whatever I am as
identity Nexus management just think
security whenever I say I am replaced
with security like back in the days
where you had jars only jars and good
and then they have cloud formation their
own way of provisioning their
infrastructure like how do you actually
programmatically instantiate a new
server who's using terraform by the way
anybody then you know cloud formation is
just crappy terraform okay so what we
are talking about lambda functions what
is this I don't want to dwell long on
this it's just a piece of code that gets
executed for you by an event triggered
by an event executed and thrown away it
should serve a single purpose but you
can do everything you can even build
your own application and one lambda if
you want to but in general one single
thing you do not have state there are
some tricks where you can reuse state I
wouldn't recommend it because it makes
things difficult but in general do not
have stayed if you want state go to the
database it supports many runtimes and
for example dotnet core and now go is
also part of the of the of the offering
and those of you who wanted to hear me
say oh let's do service using Java or
Kotlin you can leave now I guess because
yeah node JavaScript why we tried Java
basically we tried Kotlin but it's just
a hassle to bring this thing up in the
perform whether it starts fast and and
then slows down fast but note it's just
a given we are looking at going with
Kotlin in the future but we'll see but
right now it's just no than Python I
guess so some words about the execution
model I already said this and this is
important your your lambda your your
function is triggered by an event it's
everything it's event beard a click on
web page that might be an event a some
interaction with your mobile device
that's an event
whatever and then the lambda calls you
actually handler that'sthat's the code
just Inc code and the event such as I
said can be everything you are highly
exposed to your lambda functions
completely exposed to the environment
and you can get events without proper
protection of course from everywhere
even from other lambdas the code is
stored in the Dropbox in s3 it's a
lifecycle an event arrives what happens
the code is necessary AWS creates a new
container basically something like
docker
I guess I don't know they provision that
container with your with your code and
they deploy this to production and to
them to the live runtime and they can
surf your event if another event arrives
they can reuse that thing they don't
have to really provision everything
they're just used to the warm function
and some time later they kill it and
it's exactly as I said it's specified as
sometime later you have no control it
can be in a second later ten second
later it doesn't matter it's up to AWS
now we have scared our request let's say
you're really popular you're boxed a
voting machine and that maybe not not
Android and your service gets called
many times so AWS transparently scales
it for you you have to do nothing
basically
so no more under provisioning
over-provisioning you do not have to
calculate any spikes and the best part
for your managers you only pay what you
use and so only when this thing bounces
then you have to pay everything else is
for free it can sit around for four
weeks you only pay what you use so
basics if you haven't understand the
word your fault read it up there are
many books frameworks runtimes and tools
we all have frameworks we all have to
run time to all of tools and there are
many in the land of so this just I think
it's for four months all that snapshot
so I guess there will be twenty more
especially for JavaScript there are
things like service which abstract away
lambda there are things like like
chalice which does something in a
similar way there's something like
servers Express where you can wrap an
existing application
we don't need that
you do not need a really you do not need
a framework to work with AWS don't they
have an SDK apply same practices and you
will be fine and others vendor lock-in
yeah you say but then I'm reliant on an
AWS and what if Amazon breaks down and
they go out of business and stuff like
this I guess this is the same discussion
who's old enough to remember comments
logging
I think the selling point was that we
use Commons logging in fact that when we
switch out our logging system as anybody
ever switched their logging system from
lock for J to something else yeah I
don't think so so but clear engineering
practice is something that I want to too
to imply here ok just separate the land
of specific parts from your domain logic
and this is trivial I'm ashamed to
actually mention this you always see
examples like where you have your
handler function that has the the
business logic embedded and the single
most sensible thing is just separators
separate the the number of specific
parts when you do main logic insert an
anti-corruption layer that means I don't
know if everybody is familiar with
domain driven design that just means
that the technical stuff on the
left-hand side gets separated from your
domain logic on the right hand side you
have an order and up here you have some
technical events and you have this
abstraction so that your your basic
domain logic is clear and easy to
understand so if you switched
hypothetically from AWS to whatever you
would just in the best case have to
rewrite your your handler in the best
case but you need to willing for
deployment AWS has an awesome you are
you can do everything in the UI and for
our company I mean one of the guys
responsible for maintaining our accounts
there so this is a pleasure for me
because everybody likes dialogues like
this this is when the developers kick
around in AWS and something is missing
in AWS will just say I will add the need
operations goodbye and one week later I
look and in the account and I see some
others I have all these different
security policies created
you see this I can can read this AWS
lamda basic execution roll some crap can
I delete this stuff is this important
anybody needs this and you keep cleaning
things up so definitely shut down the UI
don't use it
automation is key and you can use the
CLI don't read this it's just an
impression of how complex this is and
this is just for creating a basic hello
world function you can use the idea
bacilli everything can be done with this
I wouldn't recommend it it's awful
think about updates resources we go into
this later but just think complex and
then there's Claudia for those of you
who want to get into the server list
thing Claudia might be a great approach
Claudia makes no deployment really easy
and this is the last time I will talk
about Claudia because we don't use it we
found it just irritating because of this
stuff it's just doesn't scale
we like declarative deployments I would
just like to tell my tooling this is
where I want to end up I need three
functions scale them with whatever use
node and off you go and there are two
things you can use and basically you can
use more about we are using terraform on
the one hand and this little squirrel up
there up the Builder squirrel I won't go
in to terraform because terraform is
awesome if you just take one thing away
from this talk afterwards read up on
terraform use it for everything so
what's this Perl the squirrel is a WS
service application model Sam meets Sam
it's basically their way of declaring
some automation for provisioning it
looks like this can you read this I have
no idea I hope so
it's really easy it's a Yama because
Yama is cool I guess you declare your
function like here it's a hello world
blah blah blah function you declare your
runtime and you might remember the awful
command-line this is the same thing and
then you package it and you deploy it
cloud formations just AWS term for for
provisioning let's say they're tuning
their you package you say the template
you don't have to remember all this I
would send two files around just a
generator you package what
you want to deploy and then you deploy
it finished totally easy and it supports
rollback its supports incremental
updates whenever something changed and
it can be versioned you know it is the
thing I think the truths all have
different drawbacks if you work with
some like I did now and something goes
wrong you're in a hell of pain because
the locks are totally reversed and awful
to read you have to know your way around
that's the same for terraform so there's
no no silver bullet there I can just
share the pain choose one of those two
and you will be fine I guess until
things go south you will be worried
about debugging what happens if your
script is just wrong and breaks down
good luck finding the reason roll back
terraform supports some way of rolling
back to a previous state because it's
state management the same goes for for
Sam but sometimes they just can't and
you have to just delete everything and
start from you it's kind of worrying I
think state management is an issue what
if I provision something and then the
next developer provisions also something
can the state be merged what happens if
somebody uses the UI all these tools
have a different approach and I can't
give you a remedy there so you have to
live with that and feature completeness
do the thing why I said use Sam instead
of terraform was not that I don't like
terraform I think terraform is awesome I
will say this 20 times now but it's
future completeness Sam is a tool from
AWS and it's obvious that when new
features are added to lambda then I
guess they will be fast available in Sam
then in telephone because Terra firme
has always run behind cleanliness is
next to godliness this is something my
English teacher used to say I have no
idea what this means but it sounds
really small I think those of you are
using cloud platforms might know this
tool the janitor home from from Netflix
basically looks around in your cloud
infrastructure and sees what can be
thrown away works awesome use it just a
side note and test whatever you are
doing so this is basic so but with
lambda
you remember lambda needs all this
infrastructure needs an event source he
needs something to write to it needs to
some context so you need to integrate
right from the start
as a Java developer you tend to code
code code maybe push something and then
write integration tests know what lambda
you start with the integration test and
this is where some local comes in you
remember some the little squirrel here's
a nice friend and I see that you are
writing this down some local please add
a note do not use that's really
important I can tell you why the next
screen actually will say it
it's that can you see the number it's
zero to six back in the days when I
started my career as a developer I think
production will and testing was really
really important now it's just those
better tools so there are so many bugs I
think it's an awesome effort and it's
really interesting but right now I
wouldn't recommend it just don't use it
for whatever you're doing because you're
wasting time and I think you're testing
tools should be as mature as your
production tools because you do not want
to waste time there testing is important
testing should be stable so look at it
keep watching it maybe it will be one
day really feature complete but right
now it's not usable and on the other end
testing lambdas is just darn easy just
invoke it you just just use AWS lambda
invoke and execute it directly in
production great idea yeah but we have
to protect our production I think even
in land of servers where we don't have
servers and everything is just fun and
giggles staging is a thing at least we
separate our prot and def environment
and you might say well what no test
environment no we don't use the test
environment we don't use a QA
environment justice have prod and and
def this is the least you should do and
you can do it easily remember this this
yellow template the same template now we
just have to go over here I hope this
camera contract me up there you see the
stage parameter and we just post fixed
every function that we deploy with the
stage
you can also take it if you want but we
think a clear name is far more easier to
distinguish so you don't have any
accidential invokes like here let's see
stage def and we post fix it even even
if you do not know the syntax there are
I think the idea comes comes across and
then when you deploy it to production
you explicitly overwrite that parameter
with production and you have obviously
you should have the rights and the good
idea to deploy this to production but
even then there's not enough most
companies are customers where go to and
they're using AWS or even adder I don't
care it's the same thing there they have
one account they have this this big
insurance company account and this is a
bad idea because if I have this big
insurance company account I have to make
sure that this developer with the green
shirt cannot deploy to production on a
per user level is this really difficult
so separated create different AWS
accounts it's a hassle its bureaucracy
you have to provide a different credit
card but I think that's a solvable
problem
and if you do it this way when you
deploy you have to add the profile that
you are actually allowed to do this so
not on a per user level but on an
account level makes things easier do
this when you start mmm and clean up I
told you about our AWS account which is
total method I think it looked like
looked like this big woolly not how can
you reason about this thing how do you
know what what what is important what
isn't and we've just started where I
think we have something about 70
functions running around the production
what if you have 500 how do we know
what's important and the thing is you
need to know what to clean up what can
be removed and what is still useful and
there's this little tool when you start
with lambda this is something I would
like to to really recommend it helps you
with finding whatever is out of date
this is just the output and this tool
will tell you the region where your
function is living even if you don't
know
region static north it will tell you the
function name and who tell you when it
was last updated and when it was last
invoke ated and you can see this
obviously very important test function
which I found it has been invoked 240
days ago and I think this is a candidate
for removal and why is this important
it reduces the tech surface we will come
to security later the more lambdas you
expose the more threats you have to
fight and the less lambdas you expose
yeah I guess you you get it and you can
reason about your cloud infrastructure I
think you can reason about 70 functions
maybe about 6000 no no way it's just a
big mess and you stay in control you
want to stay in control of your build
you want to stay in control of whatever
you deploy you wouldn't allow it in your
market service architecture to having
foreign add versions of the same micro
service in production at one time you
will remove things same here
hot and cold I told you about this cold
start when when lambda instantiates your
function and it's living in this
container you remember I guess so and
this happens once right right back to a
case where we have this user of micro
service Microsoft's service application
and then event arrives repetition we
create a new container and that thing
can serve the event that's a cold start
right now the event arrives Chuck it's a
warm top it won't start hot start easy
but we scale by request so what happens
if there are many events and we have
only one warm container and that thing
can surf the event but all the other
events will be served by cold containers
another picture of my customer who was
not so happy with that because latency
yeah this was really unexpected it might
be trivial to come up with the idea but
for us it was surprising because we
thought that this hold cold and warm
start with scale better cold start will
happen for each asynchronous invocation
so if F 20 lambdas to get invocate at
the same time yeah it's so trivial when
you think about it but when we
started we were surprised so what can
you do
you turn to Google as I always do or
stack overflow for that matter and you
ask what can I do and you find out there
is no service level agreement Amazon has
no service level agreement for your
lambdas I will repeat this if you want
to so you have to think about whether or
not you move your really important
assets to that that's to protect their
investment I guess but nevertheless no
numbers there are no hard details just
guidelines and if you look in the
internet you find mysticism and miracles
and wizardry in that regard you find
four articles each contradicting so
let's look at a few concepts like
package size we have some I see those
numbers now and I'm wondering what is a
60 MB lambda I don't care we have some
lambdas that are quite quite large where
some numbers are quite quite small 6 MB
or or less and who thinks that
provisioning a runtime with the size has
impact show fans yeah you're wrong no
impact whether it's 100 MB or a 1 and B
the time for provisioning a neulander is
basically the same no no difference
there what about memory you can allocate
between 180 228 mb/s and think 3
gigabytes through your lambda function
we looked at it and you can see what
your lambda actually uses you see it's
max memory use 59 mb/s you deploy it you
run it and you see there's some
correlation we have no idea why it
correlates we saw some lambdas with 2
gigs be provisioned faster some lambdas
with 3 gigs be provisioned slower so
there is some correlation I guess but we
have not found the algorithm and Amazon
is not not telling what about warm up
ping servers the framework supports this
out of the box where there is some other
lambda that gets triggered every 5
minutes and it calls your other Lander
and tries to keep it warm
the
help you can surf one event but escaped
by request remember a synchronous
invocation and in any case even if you
have one functions AWS will kill it
after a while
they will sit around and after 40
minutes or something like this they will
kill a perfectly one function just out
of spite
just to make your day miserable I think
can't prove it but keep that in mind and
the only thing I can tell you is you
have to measure the engineers measure
change things measure again measure
performance performance measuring is
really important in lambda cost money I
know but it's important and measure user
experience if the user can tell from its
crappy web interface that's running on
some awful framework whether lambda
function takes 200 milliseconds or 2
seconds then why bother but if you have
a high performance user interface every
second counts so just measure I can't
give you any octave everything else is
just mysticism and design whatever
you're doing you are using the face your
user stories design with latency in mind
don't block your user prefer
asynchronous invocations - alumnus
always so security who is in security
expert in this room nobody who is
concerned for security but some people
didn't raise their hand so I'm quite
concerned to want to know whether you're
working for my bank well nevertheless
service is very good for for security I
guess and for a good reason because you
don't have any Linux box sitting on the
desk somewhere where some student helper
has to patch this manually this is
obviously a good thing you don't have to
care about it Amazon does I am waiting
for the day when they screw up and we
have some some awful patched on running
around for three days years but I think
my student helpers will screw up earlier
than Amazon does so this is a really
good thing but looking at web
applications you usually use some kind
of Web Application Firewall it filters
out malicious requests how do you deploy
something like this without the web or
an application and
or even a server so there's no room for
our classical tools right right so we
need completely new and adapted coding
techniques and I think tooling because
of the difference in the text surface I
told you once again this is not a
complete picture everybody can basically
call your lambda they decide if you they
want to call you if they have the
permissions and the good stance is just
think everybody is evil like a
psychopath everybody wants to harm you
just think every event sauce comes with
an axe okay that's a clearly sane
approach of two things let's talk about
the event injection who has never heard
of sequel injection good that used to be
different a couple of years ago the idea
that somebody gives you data that is
malicious to whatever you're going to
execute like a delete statement embedded
in some some name parameter and the same
holds for for lambda that's a what I
call a layered cake architecture is what
we used to build UI servers and
persistent with a clear call flow and at
each layer border we have this
validation magic and security magic that
maybe spring security execute or
whatever but in lambda we have no layers
everybody can call around as the madman
like those homeless dudes in the inner
city and those progress but this does
not apply to service what we are talking
about in layered architectures so the
first thing is never trust you color no
matter what you have to basically
validate at every lambda entry point I
don't know if you can read this but even
if you could this is JavaScript so you
wouldn't be able to read it in any case
I try to get the the meaning across for
every event try to define the stricter
schema possible be complete not
regarding your schema like here we are
using joy that's just a node framework
for for specifying a schema for for
Jason really good framework in that
sense we define it our event should
contain a lambda which should be a
string an invocation count which should
be a number and
I run parameter with the default value
other frameworks are available and if
the incoming event does not match that
we just rejected but we do not tell why
because obviously somebody has called us
who has no business calling us that's
really important totally easy you can
share this validation of course but in
general just think every lambda must
have this Esther's the first couple of
of lines of code and there's a new thing
it's called building attack why building
attack yeah that's that's something that
actually happens to us it was a self
inflicted building attack where we took
a thumbnail for offers receipt started
in s3 and we had a same lambda listing
on the same as three buckets which
triggered itself again so it was an
endless cycle and I mentioned that we
pay for invocation and compute time yeah
the manager wasn't so happy so the only
thing said building alerts of what
surprises just say when my death account
rises over 50 bucks per per month sent
me an email so it can react and shut
things and you can automate this those
things okay for me Security's like CSS
once an application is running you do
not take away privileges like ICS CSS
fine when you join a project it's this
awesome mess of 14,000 lines of garbage
and you want something blinking you just
make slash important link and off you go
same for security and there's this
principle of least privilege is where
you start slow you are not allowed
anything at the start and you're only
given permission step by step and beware
of crappy code examples back in the day
when I started to Java programming we
had those try-catch examples with this
empty catch block just slash slash
printin exception prints extras some
some like this and most of my guys and
myself we applied this this technique
back then but the same is here there's
an actual example from AWS working with
I am and even if you do not understand I
am I will try to explain it this thing
basically allows
every action on every bucket in your
account on s3 so basically go ahead
wreak havoc so basically at UM item
bombed for security so the thing is I
want to give you is when you're working
in the cloud be prescriptive nail it
down in this case just allow
modifications on this particular bucket
and just allow read access okay warning
sign yeah and there are some guys who
would recommend security policy sharing
don't there's no reason to do not share
policies every lambda has to get its own
secure policy and you say oh this this
is really tough
all this Yama file yeah it's tough life
and stuff so no it no excuses like in
this example I will just run through
this really quickly this is an exact
example of our production code where we
have a role and the function both in the
same file and up there in the road we
define what the function should be
allowed to do and we will refer to that
role when we create our function it's
totally easy so just do it don't be lazy
and use the security watchdog who does
security scanning for us jars
third-party dependencies but this is
really really frightening me your
function may be small but your
dependencies are and at least not in
JavaScript world doesn't exact example
from one of our code repositories where
our lambda function code is just 8 K but
we deploy nearly 8 megabytes of
dependencies and I think it's the same
in Java world when you you're using
spring boot or your download the
internet there's tooth like snook which
help you with that
they scan your dependencies I'm not
recommending snook particularly there
are other tools available but this thing
happens to be around and it can scan
your lambda functions can you get up
repos whatever and it will send you a
slack message when you issue arrives
really cool and it's free for open
source projects
and there's also this pure sexy li which
I won't cover much because it based on
server lists it can scan your coat and
create the wrote the most restrictive
role needed for this coat totally
awesome I'm waiting for something like
this for plain lambdas so security must
be part of your development right from
the start not enough forethought and I
would like to change this thing instead
of you build it you run it it should be
you build it you secure it and then only
then you run it this should be your
mantra
so moving fast to architectures and
traps
beware of killing everything in your
backyard we had this case where lambda
scales by request but at least my back
ends do not scale by request
we bought three machines they are
sitting somewhere and that's the
scalability basically so we had this
case where we submit buildings that we
received from the outside world to our
building API back-end server it could be
a database in the same sense looks like
this where we have a lambda in front of
our building API for reasons and we are
just use it and at the end of the month
when all the consultants come home to
their hometown and they want to submit
their receipts it looks like this and
then the guys that are responsible for
this building API they called us and
looked like this they put us to the
stake burnt us down and asked us to stop
but we needed lambda for our CVS so we
had to find a common ground use
concurrency limits useful things so easy
just use something like this where you
tell them they don't scale to 1,000 or
whatever just scaled to ten my database
can handle 10 concurrent excesses just
throttle down and keep an eye on whether
or not this concurrency limit is
actually lower than expected you can
watch this I can show you afterwards I
have no time for it to show you all the
monitoring tools come to me afterwards
but be aware that those bottlenecks you
put below on an API they tend to spread
these tend to to move up the layer and
then you have bottleneck in the next
layer and LAN la la and and upwards so
setters initially prefer asynchronous
integrations when you call your back-end
API
maybe you're able to put a cue in
between and and use throttling in that
sense and then this this attack of
self-denial we have this rather often
where concurrency is limited and this
was all sinew everything is documented
by the way but you have to find the
documentation there are account limits
and there as I said they are documented
it's written right here in your account
1000 lamda invocations can happen in
parallel which sounds like a lot but you
have a big insurance company in Germany
with many departments many developers
many stuff happening the same time
thousand is nothing so I will I will
scale it down to let's say it was four
instead of thousand then we have this
user which is popular it gets for
invocations it can surf this and then
there's a budget service which gets one
invocation and has to wait can be
remedied by using accounts what we ended
up is we split the accounts per bounded
context we say there is a user account
as a project account there's a budget
account nothing to do with technology
just administration but it helps it
keeps things separate so that things can
move along without inflicting pain on
other teams just quickly some patterns
we have three patterns that we are using
for migrating to lambda I think this is
the most important part to take away
with you one lambda with the dispatch
multi lambda with shortcode and multi
lambda would share nothing let's just
quickly look at one lambda with dispatch
the idea is let's say you have a web
application you want to bring it into
service like you say solar sounds good
let's try it tomorrow
I think that's the way you start you
just put a lambda in front of your your
existing application and call it this
way totally easy totally easy of
transitioning but keep in mind you are
deploying a big monolith that means the
security has to cover the whole
application you have just one lambda so
lambda has to be able to do everything
sizing might be a problem so you have to
assign lots of memory to that thing but
deployment is easy and you can say your
service in your CV once again
then there's multi London that's next
step that's where actually most of our
code is right now we're afters this
order once again this otter example with
a create order forward or in cancel
order and you deployed the same archive
multiple times with with a lambda in
front of it and as you can see each
lambda is just responsible for a single
of functionality in that nets and that
archive that's a good way of getting
started to this it's a good way of
bringing some flexibility with regards
to security to to sizing and to to
deployment I guess and it reduces the
complexity for adopting things but be
aware that once again security you are
deploying lots of stuff into production
which has no business of being there and
the holy grail we want to be is this
multi lambda once again the existing
application and URI factor that means
you split it really up that takes effort
you have to do this you have to do this
constantly and each gets its own lambda
so this is the Holy Grail I I would say
where you actually adopt all the
advantages of lambda but you have to be
aware of complexity and the ease of
transitioning might hurt but at the end
instead of care caring about security
and roll out there we care about
security and roll out there so I think
the advantages are clear so there are
many other topics which I have skipped
now because I was threatened that
somebody will pluck out my laptop I am
part of the server's hypetrain
I think this is the way to go and if you
I realized that you have no experience
with service in the broad sense adopted
by a book try it out now there's no big
hurdle there if you're running on
kubernetes you can use things like
vision which is a service framework run
for running on kubernetes which is not
production-ready but you can adopt some
techniques there try it out I think
that's the future it won't look like
this obviously and even the server less
designing systems is still hard things
like security like like like consistency
they don't go away just by another
tooling they're just hidden behind a
different layer the challenges are just
different but the same
and do not start with AWS and the lambda
whatever without a cloud savvy guy when
I mean DevOps I do not mean a DevOps
team in a different building I mean
there is somebody who takes care of ops
in your team I know managers always
confused that let's hire a DevOps team
and that's not going to work
not for lambda we've come from a project
where this set up was like this okay
what's not DevOps about cloud ops but it
was a mess nevertheless this is DevOps
ech done right in my opinion yeah I
showed you this picture before we care
about things upfront not at the end of
the project and tooling be aware that
this tooling is evolving it changes
every week everything is just better it
just may be alpha everything breaks down
all the time so be aware for a hell of
pain things improve but not as fast as I
would like to and this is might be a
surprise this is not a silver bullet and
a VM is sometimes definitely enough as a
stalker so you don't have to do service
because everybody else is doing it so
instead of service I would rather use
this term less service that we need to
take care of but I think that's bad from
a marketing perspective I think so this
was a quick run to of what we are doing
with server lists and some of the things
that we found out thank you for
listening questions feedback positive
feedback please I don't want to
criticism if you have any questions I
stay around and I can show you more
examples more on that no questions
that's great thank you have a nice
conference</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>