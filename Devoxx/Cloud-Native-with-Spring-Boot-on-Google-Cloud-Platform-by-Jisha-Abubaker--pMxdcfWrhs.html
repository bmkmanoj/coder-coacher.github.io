<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Cloud Native with Spring Boot on Google Cloud Platform by Jisha Abubaker | Coder Coacher - Coaching Coders</title><meta content="Cloud Native with Spring Boot on Google Cloud Platform by Jisha Abubaker - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Cloud Native with Spring Boot on Google Cloud Platform by Jisha Abubaker</b></h2><h5 class="post__date">2017-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-pMxdcfWrhs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Oh everyone hope you're having a great
time at devoxx
I'm Josh abu-bakr from developer
relations engineering at Google and I
currently focus on open source libraries
and tools for the Google cloud platform
prior to that I've been mostly working
as a back-end Java developer for over 10
years so what we're talking about today
is primarily how we're making life
really simple for spring developers and
before I get started can I get a show of
hands on how familiar you might be with
spring ok almost a large part of the
crowd spring boot same hands spring
cloud ok half or more of the crowd so so
what I've seen what as a Java developer
- with the way spring kind of got
traction within the java community is a
we all started really writing code
different right
so when but spring it was primarily
through annotations it really simplified
the way you communicate with databases
or with messaging systems you were not
writing as much boilerplate code and
then came along spring boot which said
oh you don't even need the XML
configuration right it's like spring for
spring and production-ready
microservices these weren't like an
afterthought but you could actually
build them with like a simple spring
wood starter and with spring cloud it's
kind of taking spring boot into I guess
what you would call a cloud native
framework which is now you have all
these micro services how do you make
sure they all are coordinated how do
they communicate how do you make sure
it's not a black box in terms of the
deployment and that's exactly where the
spring cloud set of libraries really
comes in and where we want to help at
Google cloud platform is really help you
leverage all that kind of integrations
into bringing your code to Google cloud
platform and this is we just released
the first milestone last week and it's
on github and what we have is like a
whole bunch of integrations which I'll
walk through some of them in this talk
is
to really help you bring that code with
minimal amount that you have to write in
terms of any boilerplate well I guess I
would say not even any boilerplate and
friendly on GCP so the speeds are a
couple of the integrations that we have
available today so Google cloud pub/sub
is Google cloud platforms messaging
middleware platform and with the current
integration it's I know probably I'll
try to cover that in the stock I may run
out of time but that's basically it's
really easy to just publish a message or
receive a message using Google pub sub
group cloud sequel is the fully managed
sequel which comes in the two flavors my
sequel and Postgres and again with this
integration it automatically wires that
up as a data source for you and that's
all you need to take advantage of it
Google Cloud Storage if you're
considering it for any of your blob
storage binary data images again it
makes it as easy as just annotation
driven and you're using Google Cloud
Storage Google Cloud salute I don't know
how many of you might be familiar with
Google cloud suit but it's it's a way of
it is actually tightly integrated with a
zip gain server and what it usually does
is that you can trace it's like a
distributed tracing so you can trace all
the requests that hit your multiple
microservices and determine the Layton
sees so if you had service a calling
service B and C you could actually look
at the latencies over time and what we
do with this integration is with
stackdriver trees is Google cloud
platforms distributed tracing platform
and so you don't have to run your own
Zipkin server you can just leverage this
integration and send all your tracing
requests to Google cloud platform the
other one is Google Cloud runtime
configurator and with that it's again
managed configuration for your
applications so the runtime configurator
is a managed configuration server and
what it allows you to is to again you
don't have to run your own configuration
server you can just leverage that and
you have dynamic configuration in your
applications and definitely more in the
works again it's an open source work so
we welcome core committers as well and
what I'm going to basically
the tools in action talk so I what I
really want to do is really showcase to
you how you would leverage some of these
integrations what we'll do is basically
well I I just figured cat pictures will
keep your attention but we will upload
some cat images to a google storage
bucket
we will save some cat information as
like a profiler information in go cloud
sequel will trace the requests using the
integration I mentioned overt start grab
a tray and finally and hopefully if time
permits we will deploy the kubernetes
which will be running at the Google
container engine how sorry you know
that's okay so here I'm actually gonna
know how big okay so I don't know if you
can read out there but what I'm gonna
walk you through is actually an
application that leverages this
integration but before I start let me
first
oh okay it's a Google cloud platform the
console I don't know if I'm you're
familiar with the Google cloud platform
okay like fifty percent of the crowd
maybe so so Google platform so the
console is a great way to manage your
services by a console and here just
because of its a really short talk I've
set up we've set ourselves with a
project it's also already set up with
billing so that's covered and what we're
going to do is actually go ahead and
create a bucket and again I didn't trust
Wi-Fi so the bucket is already created
as you see it's empty and even creating
a bucket is as simple as type on the
name you choose whether it's
multi-regional or regional in our case
we chose a regional because we're just
planning to use it for a regional
application and that's it so I'm not
going to do that same thing for the
sequel so again I have an instant list
ready for our demo but I want to make
sure you understand how easy it is to
even create the instance so you get to
choose two flavors
if so what you do is choose a my sequel
instance provide your ID in our case
I've actually generated one without a
password I know that's not great so
please don't do that for your production
applications and so we have those two
ready and I'll one more thing is
credentials and authentication on Google
cloud platform what we have is the
concept of what I call service accounts
so when you are running your application
locally what we encourage you to do is
actually here you would go in and create
what is called a service account and
which you well you can sort of narrow it
down to the specific permissions you
might need which are called the iam
permissions and this allows you to
actually if I were to go here this
create key will allow me to so for
instance this is the account that I've
already created for this demo this will
allow me to actually create a JSON key
that I can download to my machine and
use that local in my local development
environment so you will see an example
of that as I walk through that example
that uses the Google Cloud Storage
integration so you can't really see up
there but we're gonna be looking at that
GCS module and to start uh so here's the
the palm so you want to get started
using Google Cloud Storage what is like
the one thing you need to get started
with right so this is basically if you
go to spring initializer generator web
app that's all this is and the only
thing that's mainly added here is the
Bill of Materials from spring cloud GCP
this is a great way to manage your
dependency so you don't have to really
specify the versions for the different
starters you use from the spring cloud
GCP so once that's in as you'll see we
have like the spring flower GCP goop
cloud storage starter that and like I
mentioned before this is the currently
it's a milestone release and so what's
required is the milestone repository
that you have to provide additionally in
your pond and let me show you T so when
we talked about the credentials and when
you run locally we provide two options
so
of one is you set an environment
variable pointing to that credentials
file that I just mentioned the other one
is within sprinkler GCP you can
configure it as a property here
application property here pointing to
your credentials file now
here's the application as you'll notice
this is sort of the key part about how
we're using Google's our storage here so
the GS colon slash is the prefix that
we're using and in and basically by
including the starter the resource is
auto wired to talk to that particular
bucket and within the sport ler the
handler the where during is its it's not
a really smart one but it just takes an
image your URL caches that within that
bucket by the same file name so as
you'll see here what we are able to do
is basically create a relative path
width and basically treat it as a
resource and you are not looking at any
boilerplate code here that's sort of the
magic of it let's run that hopefully
that runs
sorry there you go okay the application
is up we will upload this image can you
see that alright alright so we provide
just the URL and what we expect to see
is actually the GS URL of the resource
that we just uploaded so if you go back
into our console that's where there you
go so we have our image that just got
uploaded using the integration so that
was as simple as that so now let's move
on to sequel then right so just similar
to the exact one and I think it's again
you empower you you import the Bill of
Materials here here I will walk through
the different dependencies were
including so we include the sequel
starter and what's great is that it
works well with the job with JDBC as
well as if you want to leverage APA so
in this case we do want one to save I
guess chat entities in so we're
leveraging the JPA
starter you'll also see the the rest
data star the DVRs starter here and
that's just to allow for well the data
rest just gives if you have a repository
class that can automatically give you
all the rest API so associated with it
so again walking through I'll also make
sure we cover the application properties
so this is all you are actually doing to
leverage cloud sequel within your
application so you're providing the
instance connection name which again you
can let's go to sequel here is the
instance connection name that you see
there and the you create a database name
which I probably I think I missed to
cover that but you have the databases
section that you just create a database
here like I said we are using route here
which is sort of the default and we
didn't provide a password
so yes not secure but again so you can
also by default it is using my sequel
but you can easily switch that to
Postgres as well using that property and
just like before we provided the the
credentials associated with it
and let's see let's go to the classes
right so it here's our POJO that's the
cat which has been annotated with the
entity and these are the fields that we
are looking at so we have the ID the
name URL and GS URI which is sort of the
GS URL that we will use when we upload
it to cloud storage which is not being
used right now and then here is the
simple the rest that the rest data
started that I talked about which
effectively you don't really need to
provide any implementation methods and
you're able to really leverage all the
REST API to access any resource that is
stored in this repository so you'll also
see the schema sequel that I've
introduced which is which will auto
create the table if the stable does not
exist and just some sample data that we
will be uploading into the database so
yeah and the cool thing about the
starter is really that you don't need to
it uses a proxy and so what that mean an
SSL proxy - so what that means is you
really don't need to whitelist any IPS
for access it Auto handles that it is
all done over SSL oh sorry didn't mean
is something oh stop that it's using the
same port
all right so now let's look at a so like
I mentioned the rest repository so if
you wanted to add data what you're doing
is basically sending a post request to
that the cats the cats are sort of the
URL that sorry the the URL that comes in
from the repository verse resource and
let's try out that sample request so if
you wanted to see all the available
handlers so as you can see it's actually
loaded the data that we just put in and
if you wanted to add more data as you
can see it actually returns you the
actual new URL to that resource that
just got added oh so that was cloud
sequel and that was all you really
needed to do you're running locally and
you're talking a cloud sequel and now
let's kind of put everything that we did
together so that we can figure out how
you would trace the requests to abstract
driver trays as I mentioned so what
we're doing here is basically let me
first go to the palm that'd be easier
again so we have again the dependencies
we have everything that we had before
we've just not the storage the sequel we
also include now the starter trace
dependency so that's with that said
again it's the same set of classes that
we have the cat the repository dressed
and what we had here is basically again
it's the same the handler that we had
for upload let me walk you through what
this demo one does is it's basically
it's our way of just mocking requested
as as if they were two different
microservices so for instance what this
is doing is when you get a request it's
actually sending that to the upload URL
but instead of
following the method directly what we're
doing is kind of initiating a request to
that endpoint and the same goes for
actually adding that data to cloud
sequels so we're so what we would expect
as when we for instance when you see
that new span of demo here what we're
trying to say is I want to track this
request and at the same time I'm like
that tag or that span will actually be
captured within these requests that
happen to the upload URL as well as the
cats endpoint and for those who might
not know the span it's basically a way
of saying that it's a it's a it's a unit
of they can RPC call so you you would
treat this as a span that you can tag
and which I will walk through when we
run we can actually view that and the
start driver trace so resources I wanted
to make sure I covered so these are
property specific to trace now these are
just the factors by default we only
track point one person of the requests
and with these this is primarily just
for testing we're just making sure that
every request is traced and there's
always also a delay and in sending it to
stackdriver and again just for this demo
we're setting it to a very low value so
let's try again stop the previous
application that's do you
and what we'll do is basically send a
post request to get up so we're sending
a post request to that that URL which we
intend to trace okay that did add the
data in let's go into the console so
here's the trace list as you can see
I've been playing around with this
alright so as you'll see here so this is
actually the request that we just made
and what you see here is actually the
span the demo that we created and it's
it's able to actually provide you the
latency for the upload and the cats and
what's really cool about this is that
it's not just like on Anna you are able
to sort of view it over a one day or
three day so forth you can actually also
create reports which I know people do
for I know if you want to sort of
monitor it on what is this week versus
another week and so forth it's really
great in tracking that kind of
regression and Layton sees all right so
we trace the application locally and
we've kind of played around with the
integrations I think it's time to deploy
the application so in the interest of
time and I see I have only ten minutes
left
I've kind of fast forward to a couple of
steps but I just want to walk you
through it so g-cloud is basically if
you're using Google platform highly
encourage you to install it on your
local machine what it helps us like you
have a command line interface to most of
the Google cloud platform services you
can also even try out G cloud so this
what you see there is a Google cloud
shell and G cloud is actually auto
installed there so just it's only big
I'm using it locally only because we're
trying to deploy the code that's running
locally otherwise you can easily use it
from the cloud shell so another so again
we mentioned that we're going to deploy
it to container engine which so the cube
control is we were installing it through
G cloud and then again something I fast
forward to
was Europe so basically creating the
cluster that we're gonna deploy to and
I've created with three nodes I will
just walk you through where that is
let's go to clusters so here's our
cluster that's running with three nodes
and then you have the node version again
this is super easy to create either 2g
cloud or even through the console so I
have that ready and again my
fast-forward hasn't also meant up what
we do after that is we need a let me
actually review the docker file so what
we're trying to do is basically pack up
this application that we have now into a
deployed into a into a container right
so we'll be so a very simple docker file
here
so we're just using the open JDK 8 and
then we have the the app the jar
basically of our application and then
that's the entry point and going back to
the deployment all right so I've kind of
again fast forward because pushing a
image or creating it right now would
mean you kind of waiting on getting the
JDK layer in and so forth so what we
have already is the cats demo available
so what this does is we're building that
the tag we're pushing that image out to
the google cloud got the container
registry which again let me just make
sure she hears this as you see it the
cats demo it already has the image and
now what we're going to do is basically
I'll walk you through what would it so
if you if you want to deploy an
application that uses the Google cloud
platform api's this is sort of the key
point that you sort of need to be aware
of on kubernetes is making sure that the
credentials are available to the api's
and what we do here is basically mount
the credentials so we create a secret
with kubernetes and then what we will do
is basically mount that as a
volume and then what you see here okay
well Google Cloud key will be the secret
that we create and then what we're doing
is basically mounting it as Google
Google credentials and then the mount
basically it's been mounted to the path
wash secrets Google and the Google
application credentials will be set to
the swore secret Google Google Cloud key
JSON you'll see where that Google Cloud
key JSON comes and from when we create
the key so let's go to okay go back here
so see there we're actually creating a
key which is named Google Cloud key but
we also present the path here is the
Google Cloud key JSON that I showed
earlier so we created the key and now
that's okay here's the deployment Yambol
where we reference the image references
the cats demo v1 so yeah memos that will
actually get our containers up and
running forwards as you see it's it says
it's running but with applications you
have a quick way to even look at the
logs so I look up that that's a pod name
that I'm seeing there and there you go
so you actually have the application
coming up
see the end points and there your
application is up so there are multiple
ways to actually now access the service
and again in the interest of time I'm
actually actually just gonna cover how
you would just forward that to a local
up to local port and then you can just
test that directly you can also create a
service around this which is through
like those comments down here where you
would create a type of load balancer so
effectively it assigns an external IP
that you can then use to access that
particular service so let's try the pod
okay and then actually we should be able
to just call the same thing because it's
just localhost
cool so that that worked and actually
you would see it the handling connection
four eight zero eight zero out here and
effectively we did connect to service so
how easy was that
oh all right so let me get back to I
have I have four minutes but let's see
we'll make it quick
so that that was about like you know you
have you can leverage these integrations
that's all it takes to really run
against cool cloud platform services now
if you wanted to use pub/sub again very
similar as you'd see you just include
the bill of materials you include the
dependency you use like an auto Wyatt
class and then you can just send I've
just shown a message to send a message
but then you you can receive as well so
again the manage configuration service
you have the the starter for the
configuration you just provide like an
out configuration name and an
environment profile name you said the G
cloud is actually the tool we use to
manage the configuration and after that
it's an auto fire order wired
configuration value that you
and that was it
and again we're on github like the
reference documentation is really great
I encourage you to you know go in and
try it we also have Codel challenges
we're doing right outside this room and
they do have a lot of these integrations
so I would encourage you to you know
really try that out and again please
you know request features bookmark it
and it's a first milestone release but
we're really looking forward to having
more so thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>