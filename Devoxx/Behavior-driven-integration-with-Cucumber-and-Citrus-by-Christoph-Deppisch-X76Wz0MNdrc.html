<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Behavior driven integration with Cucumber and Citrus by Christoph Deppisch | Coder Coacher - Coaching Coders</title><meta content="Behavior driven integration with Cucumber and Citrus by Christoph Deppisch - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Behavior driven integration with Cucumber and Citrus by Christoph Deppisch</b></h2><h5 class="post__date">2017-11-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/X76Wz0MNdrc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hello everybody and welcome to my
talk about behavior driven integration
with cucumber and citrus my name is
Christophe and I'm working as a software
developer in Germany and in the next 30
minutes we will handle two frameworks
first is cucumber which is covering the
behavior driven aspects and the second
one is citrus which is a messaging
integration testing platform so you can
test your interfaces to other components
and we will have a small demo
application talking with HTTP and JMS
and make communication and we will
combine these two frameworks in order to
have automated integration tests with
behavior driven aspects so let's start
with behavior driven development a short
race of hands who is actually working
with the BDD right now yeah good would
say half half of the people here and
especially with cucumber raise your
hands ah okay so behavior driven
development is about communication so
communication between teams or between
companies communicate communication
between people and in software
development we have domain experts and
this group of people they know exactly
what is the business value of the
company and how to create the business
value they know exactly how the user
experience and the user stories are so
they know exactly what is to be done and
they have new ideas how to create new
features new business value and not
necessarily these people know how to
write software and this is our job so
software development comes in and we
have to implement new features we have
to add new components and this based on
the knowledge that is provided by the
domain
experts so we have to find some way of
communication between development and
the domain experts maybe this is in one
company maybe these are separated in two
companies or more companies so that the
domain experts to deliver knowledge to
an external company that writes software
for them and at this very early state of
software development things can go
deeply wrong when the communication is
bad or when there are misunderstandings
or unclear requirements all these lead
to yeah bugs and to misbehavior in
production and we don't have or we
didn't write a single line of code yet
and this is a very early state of
failure and behavior driven development
tries to give us some tooling and some
concepts to improve that so it's all
about explaining behavior of software
and if you explain your thoughts and
your ideas to another person it's a very
good idea to give concrete examples so
if you have something in your mind and
you want to explain it to another person
and it's a very complex scenario you can
give concrete examples so the other
person can you know rethink your ideas
and can just imagine what you are trying
to explain and this is where gherkin
comes in so in behavior driven
development we have this specification
language and this language gives us some
key words in order to explain our
thoughts in order to write down our
features in a good way and these kids
key words are given a certain context
when some event happens then an outcome
should occur and this given when then
structure has been proven to be very
effective when it comes to writing down
your features and your yeah what what is
your context what is the event and what
is the outcome and everybody should
understand that so I also give a
concrete example we will have a small
sample application I can show you this
location it's running on my local
machine so it's a very simple
springboard application we have yeah
like voting's we can add Nouveau things
like yeah did you enjoy the crab
sandwich or other stuff like do you like
Java 9 and you can open the devoting and
yeah just it's it's very simple and as
you can see we can do multiple voting so
nothing nothing fancy here if I close
the voting then no further votes are
accepted and this is basically our
application that we want to test right
now
very simple so a feature specification
for this application could look like
this for creating a voting as a user I
want to create new voting's in each
voting should have default vote options
so I describe my scenario I give a
voting title and this is where the very
concrete example starts so I say given
boating title do you like the box when I
create the new voting then the voting
should have two options these are the
default options yes and no and of course
a feature is described with multiple
scenarios so I can add another scenario
for custom vote options I give another
concrete example when I create new
voting what type of books tickets do you
have and the voting options are
University conference and combi then the
voting should have these options instead
of the default options yes and no and
the good thing about that is that it is
using the domain specific wording
yeah like create a voting do vote
options have vote results and everything
this is the main specific wording and
it's readable throughout the company so
domain experts product managers
developers testers everybody can read it
and everybody is able to understand what
is the feature what is the scope of the
feature what is included what is not
included and that is the the basic idea
and cucumber as a framework can read
these specification files and make them
executable as unit tests and we're gonna
have a look at that so if you want to
use cucumber to my knowledge there is a
unit for support a unit 5 is planned but
it is not released yet so I have a J
unit for run with a notation I use a
cucumber runner and this cucumber J unit
runner will have a look in the same
package as the testing class and will
look for those feature files and these
feature files ending or file extension
with dot feature and are using this
gherkin given when then structure so
cucumber will load those files and
execute those as unit tests and what we
have to do is we have to translate the
statements in the feature files to
executable Java code and this is done in
the so called step definitions and if I
have in my feature specification aligned
when I create new voting and that title
I should have some method in my step
definition classes which is annotated
with the Edwyn and notation and this
annotation gets a regular expression and
this regular expression should match my
statement in the feature specification
so the regular expression says I create
new voting and then the expression uses
a regular expression capturing group and
this capturing group is there to
dynamically inject the title of the new
voting as a method argument so we have
this method argument string title and
this is then the the actual title that
was specified in the in the
specification and in that method I can
do normal unit testing code so I create
a new voting IDE I create a new voting
instance I give the title and I call the
voting service to to add this new voting
so it's a normal unit testing code and
then in assertion step I would have then
voting should have three
again I have method with the ten
annotation using a regular expression
and using the capturing groups to pass
in the amount of options here I'm using
an integer so it's automatically
converting the types here and then I can
do a normal chair unit assertion as I
would do in a normal unit test so the
idea is that I have this feature
specifications and the feature
specification drive the method execution
that I have prepared I have some syntax
options here for more structured data
like having multiple columns and
multiple rows in this data table and
cucumber will automatically convert this
in a data table object it is passed in
as a method argument of type data table
and then in the method I can do
everything on this data table I can walk
through the columns and see what I can
do with this data table is syntax sugar
so first demo let's have a look at this
once again I have prepared this voting
application by the way the demo code is
available at github and should be
working on your machine and at the last
slide I show you the github link so it's
a very simple spring boot web
application nothing fancy we have some
controllers we have some services model
objects and in-memory database so really
really simple and I have this test which
is running with cucumber and of course
the feature specifications and the good
thing is that I can just execute that as
a normal unit test because the basis is
to a unit you can execute that hopefully
you can see that just went through very
quick and this is what unit test should
do here should run very quick and the
good integration into the Java IDE is
that I have this syntax highlighting of
the keywords give
given when then I see the regular
expression capturing groups they are
highlighted the dynamic title here and I
can also jump into the implementing
method so if I jump into it
cucumber extension here knows the the
implementing method and this is quite
quite good integration into the Java IDE
good that's it for the first demo
there's more to come so what else do we
have we have background steps these
steps are common for the whole feature
file these are common steps that should
be executed before each scenario so I do
not have to repeat the steps every time
in each scenario I can give some
background steps and cucumber will
execute these steps before the scenarios
another nice feature is the scenario
outline that's a good way to pass in
some test data that is yeah having here
some place holders in my scenario
outline like the title or the yes vote
no votes and at the very bottom I give a
data table of example data and cucumber
we'll just run through the whole
examples and execute this scenario with
each test data and of course all the
test data should pass so the test is
passing okay so this was the short
introduction to cucumber now we will
combine these concept with citrus so
citrus is an integration testing tool
for messaging integration so messaging
integration we have like monoliths
divided into smaller pieces of software
smaller services standalone services and
all these services to exchange data over
messaging typically this is an HTTP REST
interface or of course JMS we have
asynchronous common
/ JMS or we exchanged data via FTP
protocol or we send out some emails
everything is a messaging interface to
another component that is not
necessarily running on the jet on the
same JVM it could be running on a very
different server so staying in this
voting application in the middle we have
this voting app and surrounding we have
other components that either call
services on the voting app all the
voting app is calling those services so
clients send in some JMS or HTTP
requests and when a voting is closed
then a reporting server should receive a
JMS message ok the voting is finished
the top results on the and the top
boards are and of course all the
participants should receive an email
that the voting has finished and the
results are and this small application
has three different interfaces of
different kinds so we have HTTP jam as
in mail communication and we want to
test this in an integration test
scenario and in such a scenario citrus
as a framework is able to simulate all
the surrounding components so I have the
voting application I have it deployed
somewhere now it is running on my local
host machine but it could also be
deployed on an application server it
could be deployed in Dhaka in kubernetes
openshift
it could be an achillion micro
deployment whatever you like but you
have a deployment somewhere that is your
system under test in the middle and
citrus is able to fire in some messages
and at the same time receive some
messages as the JMS reporting for
example or receive the mail content on
the on the right hand side and we will
have a look at this so if you want to
combine citrus and cucumber you have to
do one critical thing this is setting
the citrus object factory so this is the
object factory written in citrus to
provide the citrus extension to cucumber
and you can do this in the cucumber that
properties file or you can set this via
system properties but everything else
stays the same we still have a normal
unit test a normal chair unit test that
uses the normal cucumber runner and we
still have a feature specification with
the domain specific wording like create
new voting and the voting's top top
words are and so on but in the
background we do not execute unit
testing code we use citrus to really
send out an HTTP call and we really want
to receive that JMS message and at the
very bottom when I say then participants
should receive reporting email then I
really want to have this email send out
received and I want to compare the email
content to what is given here as a mail
web body and the citrus object factory
is enabling some new annotations that we
can use in our step classes like the
citrus endpoint annotation that injects
ready-to-use component that is provided
by citrus here it is the the HTTP client
and the mail server and we can then use
them these components in in our tests
and second the the test runner and this
test runner object is our entrance to
the citrus java fluent api and citrus
provides fluent api for sending out
messages for receiving messages for
querying the database for doing
something with docker containers for
interacting with apache camel or
achillion all that stuff is in the
indiana api right here we just call the
run a dot HTTP and we give the voting
client as a component and then we send
out delete operation on slash voting and
this will then just send out the HTTP
call and we want to receive a response
and this response is supposed to be HTTP
status okay so every time citrus
receives a message you can give an
expected message content so you can give
just
such header information you can give
bait give payload information you can
use XPath or JSON path validation here
so this is all on the on the rana a API
right here we receive that response and
we just check that it's on HTTP status
okay so the ready to use components that
I have mentioned these are simple
configuration here it is added as a as a
spring bean configuration so I have like
the HTTP client I say ok the the server
which is the voting application is
running on my local host on port 8080
and I want to be able to send in some
calls in here so I have the voting
client and the mail server this is a
full mail server that is automatically
starting up when citral starts and it's
listening on a port and incoming emails
pass through the test for validation and
for comparison with an expected message
content and citrus provides lots of
other components that are usable in that
same way so not only HTTP server
components and JMS we have soap web
services docker camel integration which
is really cool because you can use all
the chemicals out there to use these
components within your citrus test and
selenium integration we will see this
later on in the in the demo so there are
lots of components ready to use as we
will see this in the in the demo so for
receiving a mail content we also use the
runner api we say run out dot receive we
just say ok now the mail server is our
endpoint that we will receive the
message from and we can give an expected
mail message content and this mail
content of course has from to mail
subject and the the body the body is
passed in again as a method argument
coming from the cucumber specification
file and then citrus is able to really
do a very powerful comparison of of the
of the real
message that arrived at the mail server
and this expected content so every time
I do we receive I give an expected
message content and tittles will compare
these messages for Jason for XML for
plain text and has a really powerful
comparison of these so you can ignore
some sub elements and you can use
dynamic data and validation measures you
can do hum crest assertions every
everything so I cannot show you
everything here but it's really really
powerful and once I received that
message then I want to send back some
response as the main server so I give
citrus the response here this is an SMTP
protocol 250 ok so email was accepted
and at this point I can also do some
negative testing yeah so this is the
happy path I could also say now the mail
server should send back some error like
I did not accept your email and the
voting application should handle that a
short JMS messaging sample the the idea
is simple is always the same I have HMS
endpoint this is an asynchronous
endpoint has some connection factory and
some destination name a topic or a queue
and then I can use that endpoint in my
class with its citrus endpoint
annotation and I can use that on a
runner API to say run or receive
reporting endpoint and right here I'm
using the the JSON payload and once
again this is very very powerful you can
use variables that you created before
these are then automatically exchanged
you can ignore some sub elements and the
order of Jason arrays and stuff like
that it's not important everything that
you need is is there in the very
powerful validation okay a lot of
talking let's have a look at this in a
running demo hopefully running so let me
close that don't need that
yeah so yeah this is the the future
specification and as I said before in
the background I am using the runner to
send out some real HTTP call or to
receive the real JMS message and still
I'm able to just execute that as a
normal J unit test the voting
application is running on my local host
so the system under test is deployed
somewhere and now citrus will just call
that and when the mail is sent out
citrus will receive the mail and the
mail content is automatically are
compared and validated so we have these
implicit assertions yeah so green test
that's crude so maybe let's have a
failing test also maybe in the mail if I
jump into that and say the voting or the
subject like vote results instead of
voting results so my expectation is now
wrong and we should have a failing test
because the comparison of the mail
content is not as expected and we should
receive a red test here
yeah so yeah hopefully you can you can
see that this is a typical validation
error in in citrus so we have the
subject expected was vote results and it
is voting results as you know expected
here so let's fix that okay so this is
the basic idea we have this voting
feature files we can use then domain
specific wording and we use the runner
API to just call HTTP calls and
everything but there's even more so
citrus just goes goes a little bit
further and provide some default step
definitions so these step definitions I
had to write on my own and I had to
write manually running calling the
runner API that's fair enough but I can
have also some defaults of steps and you
can activate those and your test with
the cucumber options and this so
so-called glue code is ready to use
provided by citrus we have many
different packages right now I'm using
the core steps and the HTTP steps and if
you do that you can just create a test
that uses wording like this so when we
clear the voting lists and delete on
slash voting then receive state is 200
okay and this test is running out of the
box with with the cucumber citrus
integration if I jump into that you see
on the on the left hand side that this
is included in the citrus cucumber jar
file so I do not have to write this glue
code on my own I can reuse it and if you
have a look at that it's it's pretty
complete here we can have a payload a
JSON payload set the content type send a
post request on slash voting then
receive state is 200 okay I can also
receive some some messages here so when
I said send
on slash voting getting the whole voting
list I can validate using JSON path that
I have one voting and that the title is
as expected so you can use all of that
out of the box and another nice feature
that I want to show you is the selenium
integration so it's it's basically this
the same idea I have this selenium I
test where I use the predefined selenium
steps from citrus and once I have done
this I can write tests like this here
when user starts browser and user
navigates to localhost 8080 then page
should display the link with running run
application or when I just go in here
user clicks a link with run application
then I sleep sleep is also some
predefined step from citrus and then I
can do some validation on the page using
the normal selenium web components and
web elements having some clicks on the
on the on the page and this is a
complete different way of writing
selenium tests as as right now so maybe
let's execute those those tests here so
hopefully now my browser should start
and should drive selenium through the
application adding some voting's here
and this is just like normal selenium
integration you can click you can fill
in some form fields you can validate
that some fields are displayed right now
and yeah that's pretty much the selenium
integration and the good thing is you
don't have to write all that glue code
on your own but you are still able to
extend or to just write your own step
definitions and use them in the mix so
when I go in here and say and
and
I'm in the wrong
maybe I'll go in here yeah so I have not
loaded my custom step definitions into
the into the cucumber options I did it
here so I can mix yeah I can have
domain-specific things in the next line
I can use some predefined steps from
citrus I can use some HTTP calls I can
use some JMS calls I can use some
selenium code and I can mix those in a
future specification and still everyone
should be reading or should be able to
write to read this specification and
should be able to handle this and this
is a discussion based line for
discussing your features with the domain
experts or with the product managers and
of course when you as a developer
implemented the feature you have to
prove to the product manager that you
implemented the feature as expected and
these feature files can be the basis for
for these tests and for these for these
acceptance tests so this is basically
everything that I wanted to show you let
me show you the last slide which says
the demo sources available at github you
can clone it and it should be executable
on your local machine and I'm happy I
have 30 seconds left for maybe one
question is there a question if not or
if you have a question in mind please
come to the front I'm happy to answer
your questions and I thank you very much
for your attendance thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>