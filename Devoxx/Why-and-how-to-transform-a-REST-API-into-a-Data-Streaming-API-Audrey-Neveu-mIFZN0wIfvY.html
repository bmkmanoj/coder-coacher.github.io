<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Why and how to transform a REST API into a Data Streaming API Audrey Neveu | Coder Coacher - Coaching Coders</title><meta content="Why and how to transform a REST API into a Data Streaming API Audrey Neveu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Why and how to transform a REST API into a Data Streaming API Audrey Neveu</b></h2><h5 class="post__date">2017-03-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/mIFZN0wIfvY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we're going to start with our
next speaker this is a Audrina very
talked to us about how why and how to
transfer a REST API in the data
streaming API and I see some exciting
stuff over there so let's see
hello everyone a very very big sense to
Vox them to invite me I am very allowed
to be there for your first edition so
and thanks for you to being there
because there is Adam Jones in front of
me so I wasn't expected that much people
and so we're going to talk about the end
of falling and we're going to see why
you should consider transforming your
recipe and how you can do that quickly
to introduce myself so my name is Ray I
am developer relations at stream that
our tail I'm also the collodion friends
of devoxx for kids the coolest
initiative in the world as you know now
will be there tomorrow some of you are
coming with that child
so modern times so the last serious
Internet has been more and more consumed
on mobile devices
finally exciting desktop contributions
three years and a half ago something
like that so we know applications that
we developed now as to be mobile ready
even businesses want you to bring your
own device movement the problem is the
mobile market application is completely
packed it becomes very very hard to
large long for new applications you have
a little bit of visibility to acquire
users especially active users and even
more to retain them so we need to make
them addict and we know that to keep our
user interests alive animation is the
key the reason why I'm not using bullet
point I know you are all completely mad
about billion points sorry and but we
don't we know why
animation is so important in fact it's
because of evolution but when I say
evolution I mean older than this it's
coming from this guy there was
understand one really important thing if
it moves it can be two things food or
vendor so in this case it mice was
wearing a little bit about and that's
the reason why our brain is fascinated
by things which are moving you know and
if it doesn't move ok instead moving
over sorry so on the user first point of
our application we already know how to
do it on this part we have css3 every
mobile framework I took here we are
native in ionic but every mobile comic
as animated component so it is something
we are all ready we always know how to
make it the interesting thing is if
you're looking at material mushroom
there there is a dedicated part on
animation so obviously they are
explaining you how to make animation but
one really interesting thing is that
they're also telling you why you should
make animation and one of the reason why
is hiding from the user what's going on
during the scene yeah because the
problem comes with data when it comes to
refresh data usually it starts with a
refresh button which is not really the
best way to start our relationship with
our user that's me in front of a refresh
button yeah
doesn't work we know the less
interaction the user has to made to have
the information is interesting the best
it is so refresh person really doesn't
work and the problem with refresh button
is that you know this user here is not
stupid he knows that with the refresh
button comes the loader screen of the
dead so this lovely screen if it stays
for too long your users will probably be
a little bit upset and in worst case
they will simply leave your application
and never come back so here we got a
problem so we pick up to me refresh
button is revealed we are not going to
use it anymore
we battement face we're not going to use
it anymore
we only think to Batman right in fact
what your users are expecting is real
science if you have a look at most
popular applications on market in terms
of user number but although in terms of
dwell time which is the time users are
spending on the application most popular
are all at least using real time
experience or are completely based upon
real time experience I secure the
crumpled watch and Twitter and whatsapp
the record I've mentioned slack and
Google Drive because it's also in our
businesses life and the funny thing with
real time experience is that it has
introduced something new with our brain
it doesn't reduce pace FOMO fear of
missing out the reason why I am staying
on my application is because those three
shiny little dot for me that something
is going on something is going to a perm
and I want to know it's I'm not saving
Jana with doesn't fundraise model that's
truth so in fact what you need is to
turn the static API into a stream of
data into streams API and when we are
talking about real time usually there is
a list of solution which are mentioned
so we are going to see which one you
knows
putting who knows bad falling ok lot of
you long calling okay where books
whether the whole belt I'm not that bad
that's up Wow so most same times tracing
what's okay ah yeah everybody knows that
WebSockets right and some assumptions no
doubt become okay so we're going to give
a little bit deeper into those
technologies that before choosing mom
the thing we really have to think about
is the nature of our data hopefully with
refreshed
this refers every second every minute
hour they are you still are you even
able to predict it or is it refresh in a
random way and how is it consumed is it
just consumed as it goes and if you miss
one it's not a problem
or is it going to be the start of a
workflow that's something we should keep
in mind when looking at those solutions
so let's start with cutting so pulling
is this it's probably the simplest way
to explore the resource to the rest of
the world I'm making a post request I'm
waiting for the answer I'm making some
requests waiting for the answer and so
on and so forth and ok so it works works
yeah it works but the problem is that in
the real world you know not in the
fantastic shiny seolhui world well we
would all live in real world it will
make much more something like that you
will make a lot of useless calls you
will retrieve some items of your time
unless you really really know precisely
how and the API is refreshed and so I
don't know if everyone is familiar with
zap here there if there anyone who
doesn't know about ok so that here is an
application which give you it propels
you to build your own workflows with
applications you are using in your
day-to-day life so for example it could
be each time I'm receiving an email with
attachment in my gmail box save the
attachment in my Dropbox account and so
obviously those guys have been looking
at this solution and well they realized
that 98.5 percent of poles were wasted
simply so that's the moment when you
enter to the polling madness because
obviously if you are an applied provider
with a lot of API and with the data
which changes frequently you will have
to involve those polling madness and
it's not going to be very funny so
so I propose McClung pooling as a
solution so a long-running is almost the
same except that you're keeping the
connection open until the the seller has
you that offend so 10 that I what once
there is an update and then you're
making some requests again so it means
that in both sides
you need to have demon looking at open
connection it's not solution sack to be
clear so some programs polling
non-putting Batman says no in that
solution so let's talk about way books
what looks from one we can say from
theory you can also find them under the
user define ICP callback name or user
define post HCP callback it's a concept
a missile there is no specification so
don't look too much for duck there is
not there is a website at least so we
you will find some information that
there is even a Google group I think and
they get a logo and well from this point
it's what we can say you know on the
common path like from this point
everybody is saying the way a month
right so let's have a look at how it
works at the work flow so on web looks
the consumer is going to first register
a callback URL so it's it means that
it's going to make a post request to
them and source saying hey it's a for
subscription and here is my callback URL
fine the apparel provider will register
is waiting for update and once knew that
I arrived the app a provider is mean to
is going to make the post request on the
callback URL we have previously given as
a subscriber and give the new data in
the payload so as you can see it's not
you're not consuming web looks like that
you have to make a little bit of setup
before on the consumer side it means
that you get to define a callback URL so
it has to be accessible from outside not
a closed No
no proxy or firewall sorry it has to
involve post and get requests so yeah
little bit of job on the spot as maybe a
provider you got to create a
subscription endpoints actually you have
to create two resources the first ones
is slash web look it's going to end all
getting post requests you get requests
is used to have a list of available
where books the post request is used to
create the web work and the slash by
book slash ID resource will handle get
requests which basically is going to act
like a traditional polling resource
poured whistles the puts method is used
to update our subscription because
Paragard change our callback URL we
don't know and the delete method is used
to unsubscribe for all the way from the
web work and then comes the most
important part you get to implement your
web you queue so here you have different
options the easiest one is definitely
definitely to make inline HTP request so
basically to have a job which is going
to look if there is new event and time
there is new it I am going to look at
the loop of the subscriptions and make
pasta quests for every subscriptions and
obviously M goal we try line failure and
everything that can go wrong and we know
that a lot of thinkin goes wrong so okay
it's can working test I would say it's
totally not scalable and it will delay
it will delay the time you're sending
the information obviously if you get a
lot of subscribers oh you can make an
SQL based you so it means that for
example you can reuse if you already got
an existing database it's time you get a
new subscription create a record and
then you will still need to have a
process which it's time there is new
events is going to loop over
subscription in record and send them the
update but that will be better better
anywhere than in line HTP requests but
the best solution is well it first you
can afford to have another piece of
technology in your stack it's not always
possible
if you want to be scalable it's going to
be an ad going to use a 9 QT program so
you can do with rabbitmq axiom - radius
whatever you want you still will need to
have a running task a demon to look at
new event and send the subscription but
at least your database will live for
only what is supposed to do you will
save resources from your database and
the last solution is to make batch if
you know that you are PR is going to
make a lot tough folks at the same time
it's going to send a lot of it from same
times probably you don't want to set
them to all that subscribers so in this
case you can decide to work that is
firstly quite better so you can decide
to make a bundle and send the request
well at the delay which seems logical
view so for example if you're looking at
Facebook web box appear they are sending
batch every second every 5 seconds sorry
or if you get more than 1,000 events and
send so that could be another solution a
quick example of a consumer setup I took
as example Geeta because you get a
really nice one so Kiev proposes you to
create your webicon
every repository or organization that
you want i took a one of - example so
you're going into the set accession
you're going on to the web books pop and
here you can register your callback URL
you can select your condiment aisle
because in the shining world of theory
we are supposed to be able to retrieve
xml and json keep in mind that in theory
and then you will subscribe to advance
you are interesting in so by default -
you are already subscribed to the bush
even so every time push secured you will
be notified you can choose to register
for all type of isms
which i will probably not recommended to
you or you can select individual events
whereas you are only interesting in new
issues opens or new pull requests
and the event received you look like
that so one thing I found very nice is
that you got an experiment in your
header telling you which kind of events
has been fired and on the right you get
the payload so you get all the
information you need so now let's talk
about pros and cons of way books
proms first so people say well it's real
kind of date for real well I would say
most likely almost real-time updates
because we have seen previously it
really depends on the implementation
choice for the web follow the queue so
if it's a badge its type cigar and side
cigar in on the mobile application for
example on web application it makes a
big difference so it's really not real
time without dedicated resources yeah
it's true you don't need your clients to
keep a resource just to make the polling
check if there is new data again and
again and again because it will be bring
to you by the hook easily consumed it's
a bus request we already know how to
handle post HTTP POST request so pretty
fine and easily integrate it because on
the customer side you don't have to add
another piece of technology to support
it true now looking at comes well the
first one is that you get a critical
user experience asking you user to
define a callback and to register it on
the website not really good and keep in
mind that I take as example visa which
is obviously one of the best example it
in tag that will not be the case for all
weibull's providers so it can be really
just set up it's just an incredible
nightmare to debug because it's
completely and synchronous so just to
make things clear there is company which
has based their businesses on debiting
web books they provide tools to develop
web books give you an idea of the mess
it does not work with your claims
doesn't know how to handle post requests
right that's a big limitation and last
but not least the manual setup the fact
that in most cases you will have to go
on the website and declare your callback
URL and to select events in the curve of
things it means that you can dynamically
dynamically create web books until your
provider your applied provider provides
symmetry I saw that so that big comes -
there is also some health issues and the
first one DDoS attack so on the consumer
side for example you're going to expose
a require you're going to expose a
resource which is basically accessible
from everybody
if someone kept this URL and want to
register you to as much levels as you
can I'm not sure your server will really
appreciate on the API provider side it's
almost the same because obviously they
are exposing a way to register call back
and to send to receive those
notifications so you can imagine well
someone is imagine an unnatural just a
dream or nightmare that you can you can
totally have a callback URL which each
time it will create a new web book and
so you enter in an infinite loop and at
the end can be a big mess you can miss
notifications that's probably the
biggest problem so the thing is multiply
providers will not take care they will
just very bad data and they will not
look at what you respond if everything
has gone right or wrong or whatever so
in this case you will miss notification
and you will have no way to know that in
words in the second case for a cloud
providers which actually are expecting a
response from you and I'm going to look
if everything has went fine or not well
that's some problem because if for any
reason
your your server I'll receive the
notification but I won't respond with
the right code D API provider we try to
send it again and again and again and
then you enter to the verification
problem so Facebook for example if
you'll if the first sends off a they we
try to send you the data back
immediately and then then we'll try
again on decreasing frequency of the 24
hours and if after 24 hours your server
is not as welcome back to normal then
the subscription feed is closed simply
so I prepared a little checklist that
you should verify and you know after
you've made it to the list
before using Web books so one rule is
one conductor with Luke and if possible
one callback with a very very very
difficult very hard to guess URL don't
use resources from your happy eyes you
know the traditional files using for the
rest of your IP I don't use it just make
something completely human unreadable is
there any answer expected from my API
provider I have a look deeply into
documentation just be sure that which
kind of answer you suppose to send back
be sure that you can unload the request
number it might well for example with
the earth no it's my it might be
interesting in first time to make some
tests and be sure that you can unload
the request number that's going to be
generated by even if you've selected an
unpopular side that could scene sound
silly but in fact get a payload as our
cut to five Meg's which means that if
the event you you are subscribed for is
generating a pillar bigger than that you
will not receive it it will not be sent
that's it and obviously unload the
package on the apply provider side the
only thing you really have to make is to
in
humans authentication that the reason
why there is secret document field on
the github pages so looking at those
kind of failures failures and non issues
some people are focused to make what we
call dynamic subscriptions to fix those
problems so get restful Web books which
actually I've seen mentioned in few
articles that I live in a design mode
documentation on that so guess it's
probably dead as it was born something
like that rest hooks is a solution
implemented by the pier so if you want
to use that here as a developer to
propose them your application you will
gonna you're gonna have to use web
reserves and that suburb is the yeah is
fantastic to say it's the only Thunder
protocol in in the middle so we're going
to focus on this one so tab subs have
set cap upset okay push it's fantastic
because in the middle of real-time you
get plenty of names for same technology
is great so it's an open protocol it's a
based on the publish subscribe pattern
and on topics well basically a topic is
just a resource that's it but you will
find the name everywhere so it's good to
know it it was originally originally
designed to extend the eraser certain
case and you have this rich history
which is very nice where you can find
some polls in different languages so
basically top serve is just an ecosystem
of fishes have n subscribers so as
officials we can sign medium and CNN
yeah I know I should have take a real
media you know sorry
WordPress and blogger you can host your
own herb if you want but you can use one
problem from the market Google App
Engine purpose is one the most known and
the most shoes I think at the moment is
super sitter and the third warm to be
honest I can't remember them I
can get it I think it's super motion
something like that
and subscribers well for example most
known are fiddly and feed board today
which you are probably using if you were
using Google Reader a long time ago so
the first thing you have to do are the
two fishes when you want people to be
able to subscribe to your feed is the
discovery state so you're going to put
in your header on on your main HTML page
you're going to put two links the first
one is called hub so the help I'm gonna
I'm gonna send my notifications to and
shells themselves basically is the
resource slash topic so once you get you
have done this subscribers can send a
subscription or close to the head
telling them so it's a password quest
we're saying okay I'm in mod subscribe
and this is the topic I'm interesting in
and this is the callback of my API
because it's based on webOS so you're
going to be find very some in your
notion wanting adult you can specify but
it's completely optional a token then
the hub and that's the big difference
with webbook the hub is going to make to
verify the instance of the subscribers
to be sure that nobody is going to
subscribe on your behalf that's going to
be made by a get on your callback URL so
the modules the same topic is the same
but what's really new there is that we
get a health challenge parameter with
random string and but that's optional
too you can have a hub litigant value
which basically give you it gives you
the value at the time your subscription
will be effective and here as a
subscribers you have to really validate
the subscription you have themselves
with a verification request which must
have in stay load only the hub challenge
value and only that if there is anything
else that will not be validated so
looking at consumer setup and I'm sorry
that the part where I'm telling you that
Facebook is lying to you I'm sorry
I'm sure it's a shot it's on so if you
want to start a new subscription with
Facebook you have to choose to pick your
interesting in so it can be user update
or whatever confirm the others but
anyway and then you select feels you are
interesting in and so now let's look at
how it works when the producer is
publishing some new contents so it's
making a post request request from the
hood and say okay I'm going mud publish
and that the updated the resource of my
URL of my advocate resources and the
help is going to make the content
distribution so it will make a pass on
our callback URL it will just take these
two links we've seen previously in the
discovery step okay
if you are provided token previously
there it will be an authenticated
confirm distribution with an exception
nature which are one which we all know
is very safe and then here comes the
tricky part the subscribers are to make
a get request on the objective resources
it means that for example with the
Facebook web hooks API which is in fact
Authority I you will receive this and
you can see that again just the field
which has change and the pic if you want
more information bath well you have to
make a get request so and then for the
unsubscribe fault it's basically the
same as the subscription mechanism so
you're going to send an unsubscription
request to the head it's exactly the
same as we've seen on the first slide
it's just that you are in mud
unsubscribe and still the hub will
verify that it's really your intention
to unsubscribe from this fear and that
nobody else is trying to make it on your
behalf and so it's sending the same get
request with the unsubscribe model and
you have cancer with the hub challenge
value so looking back at pros and cons
ham yeah we fix the poor user experience
in mostly years because it's quite
transparent for the end users it's made
the IP is so pretty fine we don't have
to make manual setup anymore we can make
it dynamically at the moment we get
linking our headers for example it's
pretty fine but now the problem is that
we get to make another call to get data
so there is a feature called fasting
which means that the tarisha's will send
all the content of its HTML pages in the
ping to the hub but for example if
you're looking at super feeder it's a
painting option about known issues
obviously we fixed the DDoS attack for
the rest is still the same
you will still probably miss
notification and you will still have
beautification program because now it's
the hub who basically is the Weibull
provider so we have move it to another
public so if we compare both
technologies
I think web book is realized when you're
in the case where you're not really
interested by the content of the data by
the value of the data itself you're much
more interesting by the fact that
something like something has occurred
and event as occurs the conference is a
thing but it's it's not the most
variable information in that so for
example if you're on a workflow like
every time a new issue of is open on my
repository I would like to create a
geological or every time there is a pull
request on my rep is a theory I would
like to receive an email or if the
public receives emails I would like to
trigger a gentle sub perfect in case of
IOT - because in IOT it's a very
actually it's a short life term data so
it's really variable for a few seconds
and you you won't react immediately I
mean if someone if you have put sensors
in your house and someone is entering
you want to know it now you don't want
to know it in few hours so in both cases
it's really good to have
I think it's pretty much more the best
options because you can't you can't
predict housing of that I will be
refreshed you have absolutely no idea
when someone will make a new public
health in the other case I would reserve
except for fiddly and Facebook and that
kind of things because it's not really
real time but it's not really a problem
because I'm not going to consume that is
coming from there in real time
so if you get the notification not to
look to us it's fine yeah and that's
probably the only use case I found for
for these technologies so now let's talk
about closed technologies so two of them
exist get WebSockets in server sent
events both our our under w3c
specification as as you can notice both
as appeared around same period and if
anything is WebSockets is younger and
most of you known about WebSockets but
not that much about service in humans as
you can guess it both exists there is a
reason why so first big difference
between what's a catering service in
sequence WebSockets are bi-directional
it means that both the server can send
data to the user the client and the
client Empson that has a server whereas
in seven sentiments its unidirectional
only the server is able to push data to
the client the second big difference is
that WebSockets support both text and
binary server sent events only support X
now looking at protocols so WebSockets
as its own TCP based protocol so it's
only reason sheep with HTTP is that when
the connection is made it's on the
handshake it's interpreted as an upgrade
request and so the server is going to
switch to a binary be directional
protocol which does not realize anymore
HTTP but on which he will resembles both
HTTP request and WebSocket request on
the sampled and share the sentiment from
the outside while it's HCP
so you just need to have to add this
header except text event stream
is going to work looking at
configuration because yeah obviously
we're talking about protocols it means
yeah so there is a reason why when
you're going to see your favorite hops
and say hey I got a great idea we're
going to make what forget it doesn't
mean look at you with a smiling face you
would more likely say haha pretty good
okay we're never going to do that and
there is a good reason why not to bother
you but because there is not that much
proxy which handles WebSocket at first
and there is even less proxies that
humble would forget correctly so it can
be a real nightmare to configure
properly proxies and load balancers and
I see someone agreeing on the first line
so it sounds like an experienced service
and even from the outside it's a teepee
so as long as your proxy can handle to
have longtime connections open it's fine
if we work looking at messages format in
WebSockets nothing is defined consumed
on the format of the message so it's up
to you to decide which fields you are
going to put in it's up to you obviously
to pass on themselves and all the joys
that goes with that on seven sentiments
a message is any field beginning with
the data prefix so it can be any line of
text it can be multiple line of text it
can be achieved objects everything works
the really interesting thing there is
that server sent events give us three
other fields in specification we get the
ID field the Evan field and the retry
field so I'm not going to talk about
them right now but keep them in mind we
will talk about them just after looking
at implementation so I took here as
example JavaScript example on the
customer side but it's roughly the same
on every language because everyone gets
got their service on library so even on
the server side you can use the service
and it's not a program you're going to
see it's very similar pretty nice on
WebSockets are going to create a
WebSocket object
and passage the URL of the APA would
like to stream as a parameter on server
sent events are going to create an
events or subjected value array would
like to stream as a parameter so pretty
good then you can register too if you go
back first form you would like to
register to is on open which can be
really useful especially forward circuit
because opening the connection is made a
synchronously it's really prone to error
so you might be interesting to know if
everything has gone well before trying
to send data from the client to the
server then you can register to on
message quite obvious as we've seen
previously nothing defined under what
circuits file so it's up to you to and
pass it on even so if you're just
calling the data field on the object is
works then you can register to on arrow
obviously but the really interesting
thing there is that server sent events
does not only allow us to register for
messages we can also register for
arbitrary events so if you're looking if
you're thinking about the even field
we've seen previously this one is VIP
even full well by adding it to your
message you're giving a type to your
message and so this way you are able to
add event listeners for different type
of messages could be useful because
threats are not interesting in by every
message is sent by the server first
perhaps you want to make a different
treatment so you simply add as much
event listener as you are interesting in
so now talking about what's happening
when connection is dropped because we
are talking about real-time and
streaming of data and in streaming there
is notion of okay connection drops well
sadly as you can guess from the gif
nothing is defined WebSocket
so to you to make all the logic to
reconnect to a server and retrieve
missing data and all that stuff on
service entrance forget to very cool
things we can use the first one is the
recollection time I would feature so it
means
that if the connection is brought for
any reason the browser will
automatically try to reconnect to server
for 3 seconds and if this delay doesn't
work for you for any reason you are able
to give to another value to the browser
by adding the retry filled with in
previously so cancer pain your return
but only after 10 seconds the other
thing is if you have if you had if you
have given to your message an ID with
the ID field the browser will be able to
add Twitter connection request a little
header called last event ID which says
okay that the last ID I received what
are going on from this point and the
server will have you send everything
every new data from this point ya know
it's pretty cool so now talking about
browser support my favorite topic so one
of the reason why WebSocket is very very
popular is because it has been supported
by all browsers for very long time
natively whereas service entrance is
only supported by modern browser so
obviously not Internet Explorer but
actually that's not for your problem
because we got polyfills so we are able
to end all internet explorer and
authorizations of other browsers and
funny thing is that for age it's under
consideration you know be modern but
still not done - okay so now talking
about mobile browser supports little
same in both cases
so sentiments is supported by all
browsers except opera and so is
WebSocket talking about performances so
this benchmark is coming from matches
and from black path matches is the
develop an application called birdwatch
which basically allows you to search
into live stream of twitter or quit
so if use case was to preload five
it was 500 500 when the application was
talking plate to application so we start
with WebSockets because that the only
technology was in no name the moment and
quickly has so much issues well is users
well we're having so much issues that is
decided to give try to with service
entrance
so obviously made a benchmark to be sure
that governments were not impacted by
the exchange
so the first funny thing is that was
really surprised to notice that the
implementation of the same technology
between browsers make such a difference
like the devil basically and then in at
is that service entrance was way more
efficient for his use case and the funny
thing is it took him more time to write
the blog post than to write the
implementation and so as it's often the
case in in development there is no good
and bad technology there is just
technology for use case so you just have
to think about it before opting for the
technology if you told me that you're
going to develop the new chat
application or a video game or whatever
yes obviously
WebSockets will probably be a better
choice on the other end if you're
telling me that your need of real-time
is basically to send text data from the
server to the client and that you can
end all requests coming from the client
in a traditional way with post request
probably you should up for for service
entrance and that's the reason why we
build stream Vireo so stream the lab
basically it's a proxy available as a
service it works with any given API and
it's it's a way to stream API with
server sent events so it's completely
transparent for the API provider at the
moment we are going to add push
connectors but at the moment we were we
would like people who consider that it's
not their job to make real-time API
provider to be able to use it to put us
in France without changing and
thing on the side so we're making the
polling and we are taking care of
everything that Tim goes wrong but the
thing is we are putting some time for
the API providers it makes a big change
and then with a new recent update to the
customers using service intervals where
is the dynamic catchy so it means that
if for example your application you got
a trading application so you know that
you will have message pick a few days at
the opening up markets customers joining
the session don't have to wait until the
next poll to retrieve that up they can
just fetch it from the cache on the
catchy and we added incremental updates
thanks which isn't that we are going to
see just as for so basically it means
that if nothing has changed between my
first call and my second call the proxy
is not going to serve send me the
sender's are again you know is not going
same anything at all there is no point
when you a get the same data again
that's great and if on the third poll
something has changed but let's imagine
that your initial document is a big one
with search fields but only two of them
are changing there is it's going to use
didn't budge so didn't touch its
specifications which defines operations
that can be applied on GSM documents
there are six of them you get add remove
replace and service so let's imagine
that that's the first match set up that
every retrieve on the first call we
retrieve that and on the self call only
two values are change instead of sending
the whole document again we are going to
send those values introduced on patch
format saying explicitly this has been
replaced like this and then you can use
a decent batch library simply apply it
on your initial document so it's free
Lightwave so now let's go to the demo
okay so I'm going to check yeah normal
I've been disconnected so that's the
bottle which you can register to for
free it's free to use until 1 million
message until connection
so you can make your test so let's call
it demo so once my application has been
crazy that token has been generated and
I can see a copy pasted in the API MEAP
I would like to stream I'm going to keep
this one here for the example it's one
of our internal API is emulate stock
market data so the nice thing is I can
pull it very hard and I'm copy paste
this command I'm going to copy paste
this command here in a terminal so that
we can see how it looks like when we
stream data so here as you can see I've
received my first snapshot it's an even
called data which shows it's my complete
document and then I received only patch
each time with an ID and the very nice
thing there is once this has been done
you can go back to the my API function
so here it has been also generated by my
curl come on
but you can obviously add them manually
you can add them by API you can click it
plain and the reinvesting thing is that
you can configure them and for this one
for example I would like to change the
brain frequency to 1 so if you having
hcp errors and query parameters you will
just add them there so then I'm saving
and if I'm going back on my terminal so
I can see that the plain frequency has
been updated without closing and
reopening the stream so it's quite nice
great so now that we have seen what just
like in real life we are going to use
another GI worker use this man so I'm
gonna so this is an API called Bitcoin
average which gives me the the average
value for the Bitcoin in the money I'm
interesting in so here I am
I took her sweet friend's home office
and the value which we are going to look
at is the last value so if the last
value has been a Bitcoin
I've been sold so
let's go back to the card so here it's a
my goal as you have probably understand
is to make a drone firing on this bit
going value so just for the first one
corrupts well you will see that not
supposed to go this way but and so it's
a simple mod project I just have free
livery imported my event source library
my dispatch library and the eye are
drawn library which I'm using to command
the drum so first of all I'm going to
create a client format my drone saying
great current options I'm going to
create an options object because I asked
to make a few changes in the drone
configuration to be able to do that so
it's going to be this ok then we are
going to create our events off by
calling the Evan source library within
the URL as parameters I'm going to
declare my URL so I can just I'm quite
lazy so I'm going back on the getting
started and copy/paste my API there and
so copy paste it there so you get the
URL of the proxy the URL of the API you
would like to stream and the token
generated by the portal so fine then I'm
going to create I'm going to create a
data object and the last subject for the
last value we've seen previously so once
this is done I'm going to add an event
listener on the death I isn't the first
one we've seen which is going to send me
a snapshot
here is so once we receive that our data
object is going to be equal to G's not
pass' snapshot that data we're going the
data field our last object is going to
be equal to the data object we are going
to log it C value so let's call it first
last and obviously we are going to tell
the drone to take off then we are going
to register to an event called patch so
we are looking for changes this function
is going to retrieve patches so I'm just
creating a temporary object you will see
what your faster so it's going to be in
season dot tough patch is the data then
I'm going to use my didn't pass library
to apply patches to my initial snapshot
so it's season patch that apply I'm
calling my data object and I'm going to
apply my patch object on it
here I'm going to log the last value we
just retrieved so we're going to call it
patch left and it's data at last and
here we are going to compare both values
the one we first retrieved and the last
one
so if last values is on the data dot
last values it means that the Bitcoin
has gone up we are going to log it and
we are going to tell the drone to go up
at a state of other side and else
obviously it means that it has come Goes
Down and we are going to tell the don't
goes down at a speed of four at five and
at least we reassign our last value
so once we get this we are going to
another event is now on the ero even
could be useful you know so we're going
to log it anywhere okay then we are
going to first say the drone to land
could be ready we are going to close the
event sauce and I'm going to take the
swing tricks in friction and we would
like to drawn to lend us at any point
you know we are not going to let them
fly until the end of the day or it's the
end of its batteries I think it will
come first
so after such 30 seconds we're going to
same land close even sauce and we is
just going to log something to know that
time is up okay so first of all I'm
going to run it to be sure I haven't
screwed up somewhere could run it there
I think okay so I with with my first
last
my such last sign so it's funny I'm
going to put those drawn well I have to
take big one of the wise people in the
back will not see it so it's a little
bit shy it needs a little moment to be
prepared great green light please thank
you
okay so this part is working now comes
the configuration pop so I'm going to
share my connection with the drum
because it's a Wi-Fi endpoint physically
great now we are going back to the
terminal
going to increase a little bit flood
keeps in risky values and
okay so now let's down try to covert if
someone can buy Bitcoin Angelica tree
instead front that's the moment you know
okay done again so it's ridiculous when
it's doing things like that we will give
it another try the rocks I will give are
you try in you easy it can be a little
bit more country sorry for so let's try
this one
okay at a moment it will land so
that's what happened with real-time and
drones you can never predict okay so I
really really hope I convinced you that
service entrance is a great technology
the greatest in the world if it's the
case you can vote for its support in age
I will warmly thank you for that if you
get question I think we are just in time
perhaps we can take one or two questions
I also got postcards in sequence if you
want so feel free to grab yours
absolutely ah so much for a very nice
presentation and you don't want this
thing to be running when there's a
market crash or something right so do we
have questions for Audrey
yes not if you can use your microphone
just press the button and go ahead here
let me just
Ardi question is there a way to
subscribe for the particular events type
for the server-side event so you
mentioned that we can have a different
event type like event full event bar who
is it possible to say okay I because as
I said you can just subscribe you in
that yeah you just subscribe for
everything and then you put them on the
crime mmm actually that's exactly what I
meant you know because the thing is
we've proven we proposed this we
proposed three two options in the proxy
so you can receive the snapshot every
time perhaps you just have a very short
document and you know that all feeds are
updated every time so you're interested
in the whole document or you want just
receive the differential so basically
we've used this technology of the event
field and that the reason why I get two
different even Kistler you know I got
one called data which is the snapshot
and even called patch is just the patch
so that's it that you mean you want to
stop the subscription
yeah but you don't have to listen to all
even you can subtly decide which yeah
yeah it will be sent that you don't have
to listen to all of them okay great
thanks so much Rd thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>