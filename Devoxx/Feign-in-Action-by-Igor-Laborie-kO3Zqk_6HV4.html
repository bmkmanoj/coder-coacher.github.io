<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Feign in Action by Igor Laborie | Coder Coacher - Coaching Coders</title><meta content="Feign in Action by Igor Laborie - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Feign in Action by Igor Laborie</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kO3Zqk_6HV4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay let's go
so today I'm going to talk about sane
sane is just a pragmatic shove arrest
client okay and let me introduce me my
name is Igor I'm living in Toulouse
France and I'm working at monkey patch
I'm going to talk about how you deal
with your daily basis basis with the
Java rest client with Jason and things
like that and more advanced at the peak
at the end if I have enough time of
course so let's go into medic what is
fine fine is a simple very simple REST
API open source we can find all the
interesting thing in the github I
couldn't the documentation is basically
only the readme it's open source of
course and it has been initiated by
Netflix at the time I proposed a
presentation but today Netflix does not
use anymore fine fact we are doing more
stuff in no GS and does not need Java
res client for a lot of things and today
we see the community vat drive-ins
project in still active of course
Netflix also providing a lot of open
source charity project with Java on the
microservice system we are going to see
that later fine is targeting Java 7 and
more so you can use it in on Rohit for
example and it's quite close to the
retrofit project also already good a lot
of people doing on renown already at was
it but one key difference it was not
opinionated it's that not she is not
coming with his own client HTTP client
it led to shoes so as Ethernet says I am
which II agree with
vennett but I think today it's a type of
the micro service so we need of course
microservice for doing cats so I've
written a small microservices here you
can see just a bad dog the swagger and
I'm just going to stop right
micro-service here and it's just doing
some crude stuff we've get get by ID
post Putin Tillett okay it's quite
enough to show you how to use a fail
okay I'm going to start with that small
project
I've got which is a Java 8 project I've
got no dependency at this time just a
fat jar something beating you fragile
I've got a cat puzzle here
nothing interesting into this path and
I've got a main but does not nothing at
the time okay
something I'm going to show you is I
require to add the feign dependency the
final dependency okay use our properties
here
great just to show you that is only you
know fine it's quite a small project
very few cases okay and we have an
optional dependency I think on the
animals deferred just containing one
annotation okay very small and I'm going
to change my I am in gdk9 I'm going to
certificate it at the moment sorry
okay now I'm walking with Fame
first of all faint need to have a Java
interface okay I'm going to create a cat
client interface yeah see screeching
interface okay now I'm going to
implement the finder in that interface
okay great my method going to return the
string at the moment and in my main
class I require to create the instance
of this client cat client I'm using the
faina builder here and just saying what
he going to targets cat clackum class
with the specified URL that is defined
just here okay
I'm close to the solution yeah I just
require a little bit of magic magic
white magic in Java always meaning
annotation so I'm going to add the Fed
annotation request line then giving the
HTTP verb and the path just notice that
with string it looked like HTTP requests
the first like on fashion TV requests
and ian's the path is concatenated with
the URL given here okay
let's run that code
okay I've got my string here
representing my list of cat weight but
this is not how you really want in fact
I really want a list of cat here okay
so if I run now fine that going to be
said me that I am NOT able to decide
eyes the body of the response into a
list of cats
I should add decoder here this could be
written easily with just a lambda
expression I'm in Java 8 yeah but of
course we're also existing some
extension I'm going to use the JSON
extension of fine we're just providing
this report of chess on the Google API
for dealing with gel okay Jason decoder
and I'm I'm running so other I'm mocking
me released I'm going to extract at
least and of course I'm going to play
with metal reference yeah to display
every cut on one line okay see just a
little restaurant so now it's going to
display every cat the to string of my
cats okay it's working when going
further I'm going to write fine by ID
method yeah so just over I'm getting the
first ID of my of a cat an existing idea
of cross and yeah I'm going to do the
find by ID
I'm creating this new method and again
I'm going to say that a request line is
get slash and I'm giving parameter here
so I'm using a curly brace notation and
it's required
to also add this annotation on the
Parliament with the zoo name yeah okay
I'm going to run it again and my cat
will be displayed here
but that's working well little bit other
crate
so I've already creating a cat and I'm
going to use a client that create method
yeah okay
again a request line this time which is
a past verb and we are doing that on the
flash stuff
yeah we are going to send a body to the
my back-end and so I required encoder to
deal with my cat object and transform it
into a JSON okay it's easy an encoder
you just I just want to show you that
it's quite easy to write your own
encoder decoder this is a JSON decode
are the main the method is air if you
remove all the corner case the only line
interesting is a okay and if you look at
she's an encoder it's even simpler okay
just one line in the on cone method
over-over method are just two providing
with our configuration of gzip yes great
so now I'm going to run that and going
to create my cuts oops
here are my back-end answer with a leaf
415 era
so it's happened some time so you don't
read the documentation also
documentation is not up to date so let's
debug this okay to debug reason I'm
going to use
is the solution the request interceptor
it's basically a consumer of a template
faint on plate faint on plate is used to
create the request big fan of course and
I'm going to display this chocolate here
we're going to make it shorter
we've meet our preference and we went at
Cod to understood what happen every time
I'm going to make a call here it's
displaying my request same things also
get by ID and yeah I've got the post
method for the creation as you can see
it's also display the headers with the
contents name and in fact if I'm reading
more carefully so error code it says me
that in fact I was not the media type is
not supported it is assumed that form
you're an uncoded media type content and
which is not so I'm going to just add
into my app I hear another annotation to
say a this is content type which is JSON
okay I can put this annotation on top of
the interface if I want to be to be
applied to all the method and of course
you also can use the curly brace
notation to have some parameter okay and
it should work okay great
I'm created a CAD data bus giving him an
ID everything's okay yeah now I'm going
to show you what the real usage of the
request interceptor in often you have
that back-end we've what require
authentification so that's been in
cookie or authorization token in fact
this is a dynamic part of the
instead of the others so I'm going to
add request a dynamic a dearth in my
cold even so every corner one template
I've got a tiles method you can give it
so the key and the value I'm going to
use the current time okay now that's
string and now every time I'm running
and every time same doing the request
it's adding the dynamic with the dot
here what every time is different
of course great if you want to go
further for debugging you can use the
fine logger and providing such things
for example okay Novell to full an
example and of course you can
setting Laura is a final girl she's an
abstract class but very already an
implementation is a judge decade ago and
of course very is an extension for SLS
4G if you turn that you are looking
things very close to the verbose mode of
cure just stop in the budget so there's
a delay turns up with our other same are
doing done with the same way that I've
done the create and find my ID in fact
reserved very challenging to get back
here so I show you the card with so JSON
encode are you can use Jackson if you
want and you even can we also can use
XML if you want or write your own code
or decoder is quite easier for Rudy done
but many times
now it's work there is no black magic
that BN is just using the GDK proxy
class since GDK when the rivets allow
you to create a dynamic instance of the
interface
if you provide an avocation honor and of
course in the GDK 1.1 you can do easily
HTTP connection and it's a default
implementation you can plug your horn we
are going to see what later if you don't
if you are not happy with the final
notation you can plug your own contract
like given saying the metadata in need
or using for examples of injector highs
now advances topic first of all how to
be active activity at peak at the moment
and the first things that came in my
mind which I want to be reactive with
feign is writing a custom decoder around
linger for example compatible feature on
Eric's out of sidebar of exact that it's
a bad idea you're just going to be high
achiever during the passing of the
response and you want to be active
during all the process in fact the
networking is important yeah so it's
easy to wrap your fame at the first into
reactive one but not very sexy of course
and you can use fine streaks
next an extension providing support of
hystrix we're going to talk about just
now and it's providing the Eric's report
yesterday I've been through the
presentation about reactive cross today
I've just written a small code but proof
of concept and my github by doing the
same things with a reactor committed
flukes and model it's quite easy to make
it I produced I prefer consetta don't
use in production so in districts is
known to provide circuit breaker pattern
just have a look at this is sick Rebecca
making Belgium and it's also the switch
of the color of the Belgian beer and the
astute blonde and quick it's great
what is the circuit breaker circuit
breaker let's say that they have to
state in fact where is moment we are to
stay zoo close man so the electricity
path and you have light in your room
everything is okay your server is okay
and if you serve a crash maybe are
returning five of our horror things like
that is going to be open and now we
don't ask the server but sometime you
just want to have electricity another
way for example via the emergency exit
you need the light at the moment so you
want to provide a fallback situation in
the reality is more complex are an
intermediate state we are checking if
the server came back and if not server
not came back he just waiting a few
minutes to recheck and things like that
time to lifeguard okay I've just changed
my implementation of the client air to
be easier just one method it's not under
main you know it was something as I've
done first step of course adding the
finished with extension okay okay then
so I want to be reactive so I need
Eric's observable type yeah okay
yeah I have I need to change the builder
I should use districts fine builder okay
and now past yeah this is an absorber
list so I can shoot right on the
observable wrist example I can also do
some operation for example fat mapped
when formalist my list okay observe from
just a way to unfold to transform our
observable roughly staff gets to
observable of cats
okay unfold and rain I can also use a
map interface here to provide just a cat
named okay I'm going to try it
oops it seems that the request is sent
but not bleeding welcome interactive wow
you are some canoes and my main method
just finished before the headphones so
I'm going to do a vid card to show you
that sweat that sleep I'm going to wait
a certain amount of you of time let's
say the 10 minutes
this is a vehicle and we will run it
again and now it's everything ok I've
got my cat's name
ok great time to do the circuit breaker
things with fall back and I can pass a
fallback implementation okay this is
just another implementation of my
interface I should return an observable
of list of cats going to do like that
collections that singlet um cat cats
it's an animal protein resilience so
every time even if you have no severity
remaining at least one cat
okay to try that I'm going to play with
the air except I burn operation and just
generate a tick every two seconds med
stain okay next I'm going to flat map
that to make the call to my back-end
okay and just after that I've got an
observable of list of cat and I'm doing
the same stuff when I run with Scott
every two second I made a call on my
back-end at the time the circuit breaker
is closed everything seems okay hey
every two seconds
oops got an issue here
that's myself oh she's okay
oops okay no time to debug that just
trust me it's very we are demon good
yes
we're sorry
yeah so it's not a trouble sorry I'm
going to move on so if I crash a service
for back situation came back and give it
the only cat but in our in the list
sorry
so idyllic in a good thing which
recognized that it's arrived with a new
HTTP client it's on java.net dot HTTP
package and if you want to know more is
a talk
Thursday morning about that topic and I
have not enough time to show you the
live coding for that but I'm going to
show you the implementations direct
implementation okay so I'm going to
change my dedicate to use a gdk9 and use
experimental feature competition so
first of all in my main class I'm using
GDK things that we Tony's a version of
the Java version yeah I'm going to show
you but if I run this code is just
walking your life so same thing I've
done before so just the only two things
change that I have just hit enter so
Java browser but I can plug a custom
client
now it's suggesting interface with one
method to implement and what is it doing
taking a final request and returning a
final response that's not all
every time I'm going to print a line of
things and I'm going to create an HTTP
client with a decade nine here I'm going
to deal with the body if the very same
cache would pass nobody things otherwise
I should create a body from the
aha and after I'm just adding every
adult and of course I can just call the
method and get the response so HTTP
client also can provide a synchronous
responds with a compatible future but
I'm going to do with synchronous with
the response I can just extract extract
statutes cards body author readers
father I don't is required to translate
map of list to a map of collection
that's and of course I've got a builder
pattern for returning serve train hi
spawns let's try it
okay I can see every time I'm calling my
clients is written that so it's so
working with gdk9 and with a new HTTP
client okay of course for their already
existing implementation of that client
if you like to use rushed apache
httpclient you can if you want to use ok
HTTP but providing support for HTTP -
you're not balancing it's also available
it's quite easy to plug something with
cookie manager inside - and also
integration with ribbon he burns the
know via Netflix project are providing
load balancing for client if you use on
the other side service registry named
Erika on over Netflix project very
useful when you're dealing with micro
service architecture and so just why I
want to I love to use finally first of
all is open it's quite easy to go inside
the card very few place places the
community still active even if Netflix
was not behind it's simple and intuitive
very simple in you have an API back in a
pie you just need to write an interface
but all everything should do should be
like that in Java most of time it's
quite easy if you already known the HTTP
protocol because when you pass either on
the request line very close to the
syntax of HTTP and some useful extension
plug-in
I'll show you few it's very easy to
write your own one I'm just written one
we've I could show that if you want in
in about one hour true to deal with mono
and flips class of her chief CRO and
it's not open unity in from it's
important to to choose my
tooling JSON Jackson
apache httpclient okay HTTP this is I
think a key point if you want to compare
it with retrofit retrofit to that assume
that you should use ok HTTP going for
well if you have any question and there
is my side here you have one minute left
so I can show you just a cubicle working
if you want to maybe by cheating a
little bit of course yeah limitation ok
we're going to run it now yes I'm just
forgetting when things are checked let's
educate ok
I'm close if you have any question
during the width of course so every time
I'm doing a query yeah okay and of
course if I crush my server is going to
fall back to the shack Rebecca our
default were just providing the
technology ATS
okay and if I restart of course it's
going to work again okay
that's now it's working</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>