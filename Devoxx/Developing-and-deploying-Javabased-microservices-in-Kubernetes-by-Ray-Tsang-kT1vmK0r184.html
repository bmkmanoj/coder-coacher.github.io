<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing and deploying Java-based microservices in Kubernetes by Ray Tsang | Coder Coacher - Coaching Coders</title><meta content="Developing and deploying Java-based microservices in Kubernetes by Ray Tsang - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing and deploying Java-based microservices in Kubernetes by Ray Tsang</b></h2><h5 class="post__date">2015-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kT1vmK0r184" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so let's get started all right my name
is Ray I am a developer advocate for the
Google cloud platform quick question how
many people know about Google cloud
platform or have heard about it
all right everyone awesome that's really
nice I'm not going to tell you a lot
about it today but basically for those
who don't know right it's basically
Google's data center we are exposing
many of the services and our
infrastructure so that you can actually
build your own virtual machines and run
your own applications and they use many
of the big data services that we have
and I'm actually from New York and I had
a chance to visit Europe last week at
the in the Netherlands I attended gfal
and then I went to the Deaf sites in
Dublin and I am actually travelling for
the whole month here in Europe so I'm
very happy to be here today and there
are really two things I do I love to
bring some of the latest and greatest
technology to developers like you I'm
assuming you're all developers yes raise
your hand if you're a developer very
awesome I'm in the right room that's
great and and the other thing I like to
do is to listen to your feedback on how
you're developing your applications and
how we can make our products better so
it'll be really nice if you can provide
some feedback you know after the talk
and you know you can follow me on
Twitter at Saturdays and that's probably
the best way to get in touch with me
I've been with Google for about two
years prior to Google I have being a
engineer developer architect manager
whatever I've done a lot of things in
the technology space and I work in
consulting companies and and software
companies before and prior to Google you
know aside from technology I really like
to travel that's my other passion I love
to travel around the world and this is
actually my photo traveling by packing
for about four months in between jobs
and I was in the middle of the desert in
China in northern China because I was
backpacking there the story goes like
this
I was a backpacker I didn't have much
money or anything else really cheap so
somebody told me hey if you go into the
desert and walk for about four hours
you'll find this oasis and you can
actually stay there for free now how
many people actually walk in the desert
before
for yeah yeah very nice quite a few of
you and how many people actually found a
real oasis no well fortunately I found
it
the thing is when somebody tells you to
walk in the desert they told me to walk
in the southeastern direction for four
hours when somebody tells to you to walk
in that direction for four hours in the
desert you do it right so that's me
holding on compass and I don't know for
those who have and hiking does it before
there are these sand dunes everywhere
and if you have to go one direction you
just go up and down the sand dunes and
every step you take you kind of sink a
little bit so it's actually really
really hard okay you think a little bit
you have to pull yourself up and you go
forward another step and then soon
enough you look forward you look
backwards there's nothing but sand so it
was quite interesting experience it's
quite harsh it reminds me of my old days
developing Java GED applications to be
honest yeah but but look so so so after
about two hours it's nothing three hours
you can actually see the Oasis on the
horizon those trees when I saw those
tree lines I was so happy because I'm
pretty sure I'm going to be safe that's
what I'm actually here today I'm not
like lost in the desert and in the end I
took this beautiful photo which is
really nice it's nobody around cuz you
know it's the middle of the desert and
it was really fun it was a fun trip so
you want to see more photos of me
traveling you know also if I happy I
have all the photos on Flickr at Saturn
isn't as well so who's ready for
micro-services yeah alright so today
this session is a little bit different
I'm not going to go through the theories
of microservices because I think there
are already so many sessions about the
theories and why you should be doing it
why you shouldn't be doing it it's
really up to your decision what I want
to show you is if you are indeed making
your application with microservices
architecture
I to show you what that actually feels
like in a way and how you can
potentially manage it so oh that's quick
so let's see let's write some code so
I'm gonna do some demo here just life
hopefully everything works out yeah how
many people use spring spring yeah
spring boot how many people sell the
spring pool talk yeah it's pretty
awesome
and you know in microservices world that
the tools are you going to be using may
be slightly different than the tools
that you have been using traditionally
and most of these tools on whether
spring were GE you know they started to
package their applications with just a
jar file rather than a state potentially
a war file the way that you used to
deploy your application is what you
create a warp package what you create
the year package and then you hand it
off to somebody to deploy it into the
into the server and they actually have
to figure out which servers to the point
- okay and the reason for that is most
of the cases there's a project which is
owned by a line of business and the line
of business owns the budget for the
service that you're going to use and so
you're going to you know hint off this
year file and somebody's going to figure
out okay I need to deploy it to server
one two and three okay but before they
can actually do that what happens they
have to provision the service right they
have to you know give up machine up and
running they have to plug it into the
network this whole process in my past
experiences can take anywhere between
say six months to nine months I don't
know if anybody experienced that before
trying to get up a server for your
project it's really it takes a really
long time in most cases and then once
you do that you have to lay down the
operating system you have to configure
it with the right versions you have to
install the right tools you have to
install the right tvN's
and then you have to configure install
your application servers and then you
have to finally make it secure and then
you can deploy your application so so
like in micro service world is a kind of
movement whether you're using spring or
a cable swarm you can actually package
your application into a single jar file
so let me do a little coding here I'm in
this hello world live demo and there's
nothing in this directory right and and
I'm just going to go ahead and start a
writing a service here how many people
use Eclipse for their ID Eclipse
NetBeans something else yeah oh wow what
what what is this something else what it
is intelligence how many people
is five - right yes one so I'm gonna be
writing this in five which could end
horribly wrong so I'm gonna say and some
I took island about this from the spring
boot demo of that I think Josh did
previously so there's nothing new here
but I'm going to do this anyways and I'm
gonna add a little twist to it okay so
I'm writing this in groovy so I'm going
to define a class helloworld oh I'm
gonna call it controller maybe and then
oh this is going to do is to return a
message with hello
all right the box now there we go and
the need yeah can you boy
and once you down yeah we good yeah very
good and I'm going to make this a rest
controller this is really easy to do and
I here I'm going to do what request
happen and what I am going to listen to
your hello and I'm going to take the
name in from the parameter from the path
and of course we have to do that as well
okay and I think that should work I
don't know anybody spotting arrows no
okay so then I can just hopefully you
want this spring wrong and oh there we
go
whoo that works and oh look it started
very very quickly so I can actually go
to my post here and say hello ready
alright so that was pretty easy I got
the service up and running but that's
easy because I've seen other people do
it
and they even tweet the whole
microservice in a Twitter message but
that's not enough fun this what I'm
going to do how many people know about
docker containers I'm assuming everyone
knows about docker containers yeah
how many people know about the resource
isolations in docker containers in
Canadians like you can actually specify
how much CPU you want a process to have
yes quite a few people know have you
actually seen anything action anyone
singing action no well there's one all
right awesome
so what I'm going to do is I'm going to
add another method here and go co-ed
oops
this is when maybe somebody new like
myself goes to your company and and I
write some really bad code and what this
is going to do what I'm going through
trying to do is actually to crash my
computer how many people want to see me
crash my computer life oh thanks guys so
so I need your help so so somebody might
actually write something like this and
say print line hello do you think that's
going to crash my computer no yeah
you're absolutely right how about
something like this right that's start
yeah somebody is like oh do you think
that would do it no it wouldn't
I tried it last night what you need is
something that really takes up the
processing power so you do something
like that X is one and then you do
something like X is equal to X times 2
now this can end horribly if I don't
kill this process in time so I'm gonna
be a little spell safe I'm gonna say 0
I'm gasping up three two threads plus
noise ok that's ok all right good so
since what I'm going to do I'm gonna go
ahead and screen around this again live
demos like this that's going to crash
your computer that's that's different
oh no oh no all right so here we go up
top so you can see the CPU usages and
I'm gon give this coming ready to kill
or kill Java okay and then I'm gonna
open this other prompt I'm gonna say
crow localhost 8080 let me just make
sure can you see that hello right ok
that's up and running so we see the
application so so somehow somebody
tripped over this whoops thingy so what
do you expect this to happen
anyone ok for four oh yeah you're
absolutely right
you should have told me yes so what
happened is any base yes all right so
let me try this again okay
so that's something running so let me
try just go straight to oh oh oh
sleeping hmm let me ah three star oops
tada Opie ice for a while and start a
while true yeah well let me just make
sure I mean the right process hmm well
I'm going to do something I'm going to
copy something to here and that this
will definitely work always prepared
hahaha alright so here we go oh my
goodness alright so I start the process
and we should see this process coming up
yes you see the Lord load average yeah
going up oh that's a little way too much
I'm gonna go ahead and kill it oh yeah
so the everybody see that happening just
overloaded my machine and that's what
happens when you don't run your
processes in a potentially a
containerized environment and this
actually can happen if you're running
say multiple JVMs on a single machine
and I seen this done a lot in enterprise
deployment where you have multiple JVM
multiple multiple applications or maybe
multiple services running in a single
machine and if one of those machines
goes haywire or one of those processes
runs away you don't have any isolation
then you don't have any protection
against these type of issues so how does
this actually work in in container so
I'm going to go ahead and talk arise
this this application so the way that
you do it can be done so you can
actually create a docker file everybody
seen this before
and I can add like a jar file here so
will be like
- are into my er and then you can do all
these things right but I'm going to do
this a little bit differently
oh I'm going to do is copy a doctor file
for my other repository okay
and in this docker file there is only
one line of code which is wrong and this
is a beaut in nature that I created so
really than having all those
instructions I just have this beauty
image which will take the source code
and compile the spring boot application
create a jar file for me and then I'll
execute it and the way I can run this I
can't do Java dr. Butte and I'm going to
code this a bad server because this is
what it is okay so with my network
that's why oh look haha
that's no good I have no network so I
cannot do a demo on my pack machine that
is too bad let's try this
it was definitely working earlier these
these demos without their work is going
to be quite extrude quite bad without
the network okay
who's actually watching Netflix on the
air phones anyone anyone have a hotspot
I can borrow yeah okay so let's do that
so so he's gonna speed up the the
hotspot so the point is I mean why don't
I go back to the slide in microservices
you really just want to be able to
potentially run your servers in this
containerized environment so you get
protections and traditionally you will
be deploying these warr files and then
you know Deponia to the application
servers and stuff like that but in micro
services is the way that you do it is
potentially just clear these individual
Java files that you can just copy into
the container just execute it very very
easily but one thing that you will run
into is that when you're running these
services you'll quickly figure out like
if in this kind of demo application that
I created separately I'm just using two
services right in one front hand and
what's going to happen is each
individual service that you're going to
create you have to deploy it and you
don't just deploy one instance of it you
need to potentially deploy multiple
instances of it right and so you have to
be able to manage that you have to be
able to scale out these individual
service layers independently from each
other and you also have to deal with
many other problems how do you actually
run multiple services on the same
machine potentially because you want
impacted to get the most efficiencies so
you may run into support conflicts which
is something that if I run multiple
processes it sees in the same machine on
the same port one of them's going to
fail or it's just one of them's going to
succeed you need to be able to discover
your services because you have like 20
services of these running somewhere
every one of them is going to have like
endpoints you need to be able to figure
out which ones you can actually connect
to ok so you have to use solve these
challenges for running the the
application right which machines to run
this on where to run it make sure
there's no port conflict
make sure they're up and guilty and if
something fails you want to be
we started automatically as well okay so
if I says that's yours so let's try o
face s I think I need your password can
you sit down on the microphone
no okay yeah let's hope that works
come on all right very cool so let me
try this I'll begin some gon do docker
PS yes all right so now I can actually
boot my talking image over princess's
cell phone connection how many people
try to boot a darker image life on stage
before anyone you have to take a long
time yeah so let me show you something
pretty cool I'm running darker machine
so oh so oh it's going to do is to stand
this one text file over the internet and
then all the build process and all the
images that should be built in a remote
server I'm running in the Google cloud
platform so let's do that so here we go
time to Butte tbat server yeah there we
go that's done and then I can run it so
the internet took the most time picture
okay so I'm going to do is I'm going to
run this micro service in a container
but the twist here is and which is going
to be using 50% of the CPU and let's see
what happens and it's going to bind to
port 8080 and me go into the Machine xsh
Google machine
yeah you're good I'm gon open top and if
I did this correctly I'm gonna do your
curl the whoops URL yeah well all the
things are going haywire because of the
initial connection here was not very
good so what I'm going to do is come
here and I'm gon do a curl HTTP
localhost maybe ID and loops alright so
now it's actually kicking off the
container and do something bad with it
so if I go to dot the top you can see
the Java process on the top and kind of
being capped at the 50% of the CPU which
is pretty nice pretty nice so in case
you have a wrong way process you can
pretty sure be pretty sure that it's
being encapsulated by the container
itself so I'm just gonna go ahead and
kill out so the doctor TPS to the doctor
to kill and let's get off this okay cool
now you have the service running what do
you do well it's only one one one
machine and you do that very easily if
you just are in a developing environment
but continual works container is really
nice
in fact and you go back to the slide
here everything on Google runs in
containers everything how many people
use Google search yeah Gmail yeah drive
yeah
so all those things are actually run in
containers in fact we launched about two
billion containers a week we're now
using say docker containers we're using
some more fundamental technology like
cgroups
which we actually contributed to the
Linux kernel packing by 2009 or
something like that so so every process
that we're running is saturating a
containerized environment and this is
what we actually do at Google as an
engineer to deploy one of these services
okay so first you create a hello world
job so you create a file to describe
what you're going to be deploying and
where you're going to run this on okay
so this is like a code a job file so
Google internally and the first thing
you do is to specify which cluster of
machines you're going to run into
services or applications on now realize
here we're not like that's knitting
individual machines okay well now like
run this down sever one and sever - that
is too many to name because we have
maybe up to 10,000 machines in a single
cluster so rather than specifying each
one would you say it's just deploy in
this class here somewhere and then you
specify the binary image that you want
to deploy this is the executable that
you want to run some arguments and
parameters and then you specify the
amount of resources you want to give to
this container to this process and so we
can specify the RAM disk the CPU share
so that in case something goes bad they
don't go over the boundaries that we
need preset and finally you can specify
the number of instances you want for
this particular job or for this
particular service or for this
particular application in this case
we're running five and if you want to
run more you just update the number to
say 10,000 running this at the Google
scale a hello world Google scale
application and and what happens then is
that the developer will take that config
file and then use our Google internal
tool which is called Borg and deploy
that into our cluster of machines so
first thing is we need to take that
binary and putting in some kind of
centralized location like in a
centralized repository and then we take
that configuration file and then we push
it to our internal tool which is called
the Borg master and then the book master
will then check against the scheduler to
figure out okay out of all of these
machines
the Borg master is managing which
machines can actually run the
application will run the service and
it's going to check every one of these
machines and when it finds the machine
that's capable of running with the
specified parameters for resources that
machine will then go ahead and pull down
the image or the binary from the central
repository and soon enough you're going
to see all these machines starting up
the jobs and this process happens very
very quickly for about 10,000 jobs you
can start in about two and a half
minutes which is pretty cool so how
would you do that
say what take that and say okay how do I
do that on prince or ourselves well we
actually took all of those experiences
and we exported many of these concepts
into a project an open-source project
code kubernetes how many people already
heard about kubernetes before all right
oh well
so hopefully many of these concepts is
not new to you if it is new to you I'm
glad you're here as well and kubernetes
is the open source project it's not
written in Java it's written go so but
it actually runs in many many places it
doesn't just run on the Google cloud
platform it runs down Oh many of the
other cloud providers as well it also
runs on premise on bare metal so if you
have your own machines you can set this
up yourself as well it's heavily
inspired informed by the experiences
that we had in this internal from this
internal system that we had okay and it
is open source 1.1 of cribben eddie was
just released earlier this week it's
very popular project as you own maybe
have seen on github we have many
contributors we have many companies and
stars and many people helping out in
this project so there is real
open-source community around this in
fact I think there are more contributors
from outside of Google being Google
itself which is fantastic in the way
that it works is you will potentially
write like a job file as well like the
VMO file that describe how you want to
deploy your your application but first
you have to create that image that you
want to deploy so you can actually
create say a container image by using
docker kubernetes is actually agnostic
to the underlying container technology
but in our examples will not be using
docker so you can create a docker image
which is what I just did you push that
to a central repository which is like
dr. Hodge or you can actually use a
private repository as well Google cloud
platform offers you that option also and
then you deploy the config file into the
criminals master and through the
scheduler it figures out which machines
that kubernetes is managing and then
schedules the tasks to that machine
right once the machine figures out ok
half I have enough capacity to run this
job I'm going to go ahead and pull down
that container image and execute it
very very similar in concept and this is
just an example file that we have
created before okay very quickly since
everybody seems to know about doctor how
many people are you all familiar with
say parts and replication controllers
services in love that yeah no maybe okay
so let me show you some addition demo so
we have created this very simple service
and it's containerized so it's ready to
be deployed so I'm gonna go ahead and
just deploy this service directly onto
my kubernetes cluster and I really
created criminales cluster and you see
here again notes yeah and a half three
machines running in this in this cluster
that's managed by communities this is
currently running on Google cloud
platform and how do you actually do this
well first I need to push my image to a
central repository so if I do docker
images grip for who do you collate that
server because that's what I call a bad
server how many people ever deployed a
bad server into your production
environment no could happen it's just
not named the same alright so here's my
emails I'm gonna go ahead and say dr.
tag and then I'm gonna go ahead and use
the the private repository that we offer
in the in the platform so the way that
you tag the repository name is by using
a GC or Die or prefix and then the
namespace is just the name of the
project and that server like that and
I'm gonna do latest there we go so once
I tagged it I have to push it to the
repository so I'm gonna do something
like we call talker push and do that how
many people try to push a image live
during a live demo it taken like usually
thing sometime
well first of all I got I get my command
line right so if you want grab coffee
this is a good tight mask here so I'm
also doing this over a Francis's phone
here so just keep that in mind
so here we go so it's going to buffer to
the disk oh look how fast that is yeah
for instance you have a really good
phone now actually like I said I'm
running all of these things on pakka
machine so all of the processes
happening on the Google platform over
the Google Network itself so we're
pushed this is actually there and I'm
going to take this image there the
different ways to run these containers
in kubernetes and usually I would
actually write a yellow file like a
descriptor file like I showed you
earlier and now this deployed a file but
today I'm going to do something
different so I'm going to go ahead and
do a coop CTO run I'm going to name this
batch server I'm going to do that the
whole day in the image right and then I
can actually label it so so this is
really important so when I'm doing this
I'm not actually describing anything at
all except asking kubernetes to run a
single image but what's gonna happen
behind the scenes is it's going to
create a pod in kubernetes a pod is
simply just a grouping of containers
that live and die together they share
the same resources and every pot
increment eddie's has a unique IP
address okay so you can really think
about it like a virtual machine except
it's not everything inside of the pod is
running in containers they just should
happen to share the same resources and
every resource in communities can have a
label and the label is super important
later when we want to do some service
discovery and figure out which part is
running what you can't recreate the
label to figure out which part has the
the application that you want to look at
so here I'm going to do something
potentially read that one be able to
visualize this and I'm going to say run
is to equal to bi server okay
and while that's up and running I'm
gonna go ahead and start the proxy so
that we can see this in action
now there we go so we made a lot of
changes to this visualization tool at
maybe until 2 a.m. this morning that's
why I'm not really awake right now but
by awards so here we can actually see we
have three notes running inside of my
cluster I have one server pod that has
my service I just created
maybe Oh 20 minutes ago and then this
thing in blue that's the replication
controller okay so what I can do is for
example I can scale this pod this
replication controller thing which I'll
describe in a second but I can actually
tell the replication controller to scale
the number of instances I want so I can
go ahead and say I need two instances of
this server and there you go
they just started running so replication
controller is another very very
important concept in kubernetes right
it's basically the the controller
manager that figures out okay I need to
make sure at any given time I have say
two instances running you can actually
kill it oh we have two instances right
now let me scale up to four and you just
tell the replication controller to scale
the number of instances to four and it
is going to go ahead and run these
instances and these instances are
running inside of pots okay in the pot
has two containers and you can also see
here that for some reason right now
they're all being scheduled onto the
same machine but if I do this
differently potentially if I scale up
more party
they'll be scheduled on two different
machines please I have three machines
right now but every single one of these
pot also have a unique IP address so I'm
gonna say get pots I'm going to show you
what that IP looks like so these are the
name names of the pot they are just they
have the name in the prefix and then you
have the suffix which is automatically
generated and I can actually go into one
of these things by using the exe see
come in
okay very good so now I'm actually
executing a show inside of the container
that's running instead of kubernetes
that's running in one of my machines and
if I do a hostname - I I can see that
there is a IP address here yeah it
stands out whatever and if I do this in
another pod and if I do the same thing
you can see that it has a different IP
address now it's very possible that
these parts are running on different
machines instead of containers and they
all have these private IP address write
anything about it you can actually from
pot to pot even if there are on
different machines they can actually
talk to each other so potentially what I
can do is from this one pot this 1.6 pod
I should be able to have curl here I do
have Proteus and I can do something like
that and say hello ray and that actually
goes to the machine or the pod that's in
another potentially different server now
unfortunately I was using a file I
created last week
so the hello is actually different now
I'll fix that in a second and these IP
addresses will come and go right because
you can scale out the number of parts
you want you can reduce it when you need
to so the IP addresses are not are not
very stable right because when you're
doing service discovery you don't really
want to keep track of which IP addresses
should I be be hitting so in true
binaries there's the first class citizen
concept which is called a service and
service is really just you can think
about it like a load balancer and it has
a stable IP address and not only that
you can also export the IP address as a
DNS name
and so when you're performing a service
discovery say you want to be able to low
balance the request to all of these
hello world service you can just create
a service in front of them so the way
that you can do that on criminalities
are in the command line so you can code
this coming on line coke expose and I'm
just going to go ahead and do that
if I do the coming in line like that
it's going to create a cluster IP
address which is like a low balance like
the address and it's going to just have
the private IP address but that's not
fun because I wouldn't be able to get to
it from the outside world
so I can go ahead and do something like
typist code load balancer load balancer
like that and what what that's going to
do is it's going to create an external
load balancer depending on the
environment on the infrastructure that
you're running on it's actually going to
create a real load balancer for you so
on Google cloud platform it's going to
create a real Google cloud platform load
balancer for me with a external IP
address and I'll go ahead and do that
and there you go so that the thing the
green is the service I just created
okay and now behind the scenes is also
creating the external load balancer as
well so I can just go ahead and let me
because I have to wait for it a little
bit I'm just going to demo something
very quickly so I'm gonna go ahead and
go to - so here I can actually just get
to this blob balancer IP address
directly from inside a pod if you're
using like if you're running layers of
services right once the resume need to
call another one front end needs to call
another service behind the scenes all
you have to do is to figure out the IP
address potentially from the DNS name so
if I ping this service name it's going
to resolve directly into the IP which is
kind of nice
so you don't really have to keep track
of what all these other instances are if
I say keep CTO describe the service
all right oh okay
good catch yeah and then you can
actually see the end point that this is
routing of the request to and the way
that is rotting the request is based on
using the labels like I said everything
every destroys incriminating size labels
in this case we're just making sure that
all of these traffic is routed to the
part that have two labels one is
visualised is equal to true and the
other one is the wrong label is bad
server you can name these labels however
you want we can name like version is
equal to 1.0 environment is equal to
prod environment is equal to staging it
doesn't matter you can just name it
however you want
that matches your environment okay so
now if I go to one of these services
this IP address and say hello right now
unless if somebody already hit the
whoops in point
haha which my crashes I don't know aha
but that it should actually go through
once the networking is up and running
okay so actually scaling but now what if
I need updated I notice that that the
codes is is wrong because here we're
saying this is j4 which is last week and
let me try to change it to the box okay
so I'm going to do very similar thing
we're going to go ahead and beauty okay
and I'm going to tag it right we did
this before class a v3 and I'm going to
push it now G called
Parker push ok we need to push it to the
central repository
okay so now it's doing the push again
over a Wi-Fi connection here over
somebody's phone and then what's going
to be pretty interesting it's actually I
can do a rolling update so now I have
this new version of application I need
to do it like rolling update to it
because I want to make sure I have the
right hello message so again from
kubernetes I can do something like I can
do something like rolling update that's
a come in you can use there we go so we
can do rolling update this is going to
be the name of the replication
controller which is the thing in the
blue and then you can simply replace it
with the image which I just built okay
so the image right a dispute and pushed
is v3 so I can do that and you can
specify how much time to wait between
taking down a pod and creating a new
part with a new image all right so what
this is going to do when I run this is
that every five seconds or so it's going
to start a new instance with the new
application with a new code and then
take away one of the older code like the
version 1 code and so you can you know
make sure your service is up and running
the whole time and still being able to
update your application I'm going to go
ahead and do that okay so now it's going
to go and take a look at the replication
controller in blue it's going to create
this temporary replication controller
for you and you can see very quickly
this one server is being spun up and
it's going to take away one of the older
server as the new server is spun up and
working there you go so you see one is
spun out and the other one is connected
and it's going to do that for all of the
four servers that I have here so there
you go they just create another server
and it's going to take away another one
now oh when this is happening I can
hopefully go into my shell I'm going to
go ahead and do the curl oh let's see
here a curl HTTP wait who am i that's
not the show I was in it
there we go
so now go curl HTTP server 8080 and
hello right there we go do you see that
the new service returning the new
message yeah and I'm doing this as the
rolling update is taking place which is
pretty nice
yeah and now everything is up-to-date
it's going to go ahead and kill off or I
should really end the replication
controller and which throughout the
state just like that it's really really
easy to do but that's really simple
actually have a more a slightly more
complicated demo where I have a
guestbook
that spins up my sequel and Redis and
then have a guestbook service that's a
restful service that actually saves the
data to my sequel I can actually spin
down up relatively quickly here so all
of these code by the way is on some like
github so because of time I'm just going
to go ahead and do a turn up and what
turn up is going to do is that it's
going to run a series of these
criminally create calls and it's going
to run through many of these yellow
files which describe how I wanted to
deploy an environment and this is nice
because you know I think that Francis
said this is like infrastructure eyes
code so you can actually describe what
your environment should look like and
then you can just check it into your
repository like it and so you can
actually create your environment
repeatedly anytime you want so I just
ran through the whole script and let me
just delete the RC I'm going to do we
here the Passover one okay so now if we
think about I don't know 20 seconds or
so I can actually see that Redis is up
and running my sequel is up and running
right here this is surveys for that
there's a my sequel pod that has my data
I have the hollow war service running
and and finally I have the front end
running and once the internal load
balancer is created I can actually go to
this gates book and just save a message
and say hello and things like that and
all of these things are being
deployed on kubernetes as well and a
file of like a yellow file will look
like something like that so I cannot
show this earlier so here we have the
replication controller and describing
the labels what's really important here
is the image that I want to deploy so
that's the image I want to go to the poi
and I can listen on the port 8080 and
that's the end of it and if all these
things work I'm not sure why you know so
I'm gonna go ahead and copy that no well
it will take a while but it will
eventually show up hopefully but that's
okay it's usually always there okay so
that's really how you can manage and
deploy your services in your communities
cluster now I was giving a very similar
talk last week in the Netherlands
Ejiofor and in the hallway I ran into a
group of people from Quinn poi and they
had this really really awesome thing
which is a Raspberry Pi cluster and they
have it's actually right there
oh I thought I hid it but it's actually
right here that's the Raspberry Pi
cluster and they are very very nice in
terms of letting me borrow it for my
demo for the next ten minutes or so and
so so it's actually being created by by
printer and I saw them in the hallway
and that it's arching I'd like to invite
arching up to the stage yeah thanks yeah
thank you so thank you for lying and
borrowing the Raspberry Pi container
yeah yeah so I Mario sink I'm at work at
winter a Dutch company that mainly focus
on software development so we're here
with a lot of colleagues and yeah so we
ran into each other at a J fall we gave
a presentation on on Mesa a marathon and
we had a PI cluster running in docker
swarm and
yeah ray we were talking about Cuba
Nitesh and how cool it would be to run
that on on a pie cluster and and we were
talking about the Deaf Fox and yeah here
we are
so we want to do a real live demo with
hardware because you stated already in
your presentation it's about running
your software on bare metal eventually
and we've done a lot of things with
similar platforms running our virtual
machines and also with kubernetes some
stuff but it there are some details you
you will run into when you do it very
unreal bare metal
so what good could we do take a cheap
hardware pi is really cheap actually so
we build them a nice stack with with
buys so we have five raspberry PI's
running there are bottle to be quad-core
one gig memory hooked up a network
switch on top of it by the nice stack
for that so everything is nicely
concealed in one case and the power
supply for the USB stuff that Deborah
you already did before jail with darker
swarm took us about 12 weeks is some
some really great colleagues of mine to
get it all up and running then we had a
challenge last week it was also to
choose Thursday so can we make it for
dev ox running Cuban ettus on this so we
have to start again installing all
software needed for a few kubernetes and
we managed and last two evenings I spent
with Ray finishing the demo with with
Cuba net is a really fun in your nice
apartment loft in Antwerp with with few
on the river so yeah it was really nice
and a lot of hacking to get everything
hooked up and functioning for the demo
so
yeah so one one one big problem here is
that I don't think this laptop is on the
internet either so we don't have to get
Francesa phone connected as well so live
demo over a cellphone I mean how awesome
this is with Raspberry Pi so the rice
fried a very pilot cluster in the
hallway I was totally amazed by the fact
that exist somebody people actually
built it and and they are able to put
kubernetes and a so it's gonna be pretty
awesome it's like it's almost like a
micro data center that runs micro
services yeah yeah so what do you
actually have running on this we're
running a high period OS okay and that's
really nice because you get darker for
free with it so you have a referee on
ruffian distribution with but a docker
on it and that really works great okay
and if you do have like real java
application here yeah yeah yeah River on
it we were running to Java services the
one is hooked up to the to the other so
the stock transaction is using the buy
stock servers and we already spun up
five instances of them and yeah what we
what Rodrigo already has shown with the
scaling SL we can also do it on this PI
and that's really really nice so here
you see a see the new new parts coming
up on the pikelet instances so we have
one master node and in for and for no
business I run the jobs
so in this visualizer we can see that
0.01 is actually the master node we are
also scheduling on top of this as well
and here we have four different nodes
without our pi0 for running one of the
pot one of the instant self in service
in RPI zero one running a different
instance selfless service and we can
scale this we can contract it as as we
want so you know the point really is
that communities as an open-source
project people really are able to take
it and run it in many many different
places
addressing bear meadow you know in kill
platforms or different virtual machines
and columns and now people actually one
on in being able to install that
raspberry pi's which is super super cool
super awesome yeah so so now we have
this this rack like imagine this is your
rack
in the data center weapons if you get a
real chaos monkey in here and uh you can
we actually pull the plug on this target
um yeah so try it yeah with you how many
people want to see the plug in food yeah
uh yeah thank you some people falling
yeah so so why don't we pool park I
don't know so we have four one and two
so the bottom one here is the master and
that's one two three four so uh actually
who wants to pull the plug
anyone Fred Francesco yeah so the
princess cap or RPI - no no that way oh
not that one the middle one did the
network yeah yeah okay so is that the
one the middle one is - the other one
okay so he's gonna pull the plug in
matching this is happening you add a
Risinger
yeah oh there he goes it's a bad
engineer good run running good job good
job now we have configured the equipment
a master to kind of figure out you know
which node is down and it's going to
take about 20 seconds or so that's a
configurable value so criminals actually
do perform the health checks to make
sure that all the nodes are up and
running if it's not it's going to
realize that another start up and
running the physical machine and it's
going to go ahead and reschedule pause
so there you go so you realize they
started no this down so yeah oh there's
a new one and see did you see that it
happened all too fast
the replication controller was able to
realize hold on a second I need to
reschedule the pod right remember I'm
telling the reputation controller I need
for instance is running at any given
time and it realized one of the note
went down is unplug and and then it
figures out which part is actually on
that node and it just went ahead and
reschedule it on to a different note
that's pretty awesome now put it back
yeah
if does it work if we put it back oh
yeah yeah so if you put it back again
the hill tracks you're kicking and
the kubernetes cluster will figure out
that the note is alive
and now I can actually schedule my jobs
again into the cluster and it's not be
able to schedule it onto the note so
again it's going to take about 20
seconds or so because that's how we
configure late so I'll put the demo in
the live environment you may have a
longer time period if you like so oh no
this is not coming back what's going on
moved in yeah
demo huh yeah I know live demo with much
very PI over a cellphone
I don't know how badly this can go I
mean this is probably the worst idea to
do in DevOps and there we go
yeah okay this work Thank You Nick so
but so before before we move on to
schedule more parts here so maybe two to
maybe six or eight nine to eight right
yeah yeah and what we're supposed to see
is companies now realizes we have four
notes again and somewhat late is going
to be scheduled onto the note that we
just plug packing yeah yeah I don't know
- has also already new new parts running
notes you already have that we passed on
yeah resources should come available
again so yeah yeah yeah so now we have
eight instances of this Java micro
service running our micro data center
here on a Raspberry Pi and you actually
saw replication controller and pulling
the plugs live yeah so I thought that
was pretty heavy Francesco wanted to do
a plug off the power cable so yes I
think we have time for that oh so that's
the behavior of that so network was easy
because it's really fast you come up and
down but can we leap all here
which one yeah maybe to top on the top
for I like to do this as well the photo
which one's the power the one on now the
switch no not do not to share we have no
not this one right it's gonna make sure
okay so here we go all right so there
goes the power yeah
and blue bottle just edits down that's
yeah so we have one pot skin orange at 0
4 so again watch this this happens so
fast it's happening so fast when the pot
is when a node is realized to be down
which is
for does this work all the time I mean I
don't think we ever tried it twice in a
row yeah I did
he did oh yeah but this real demo yeah
well other demos don't count yeah this
other yo there we go so any once and
then you want to spin reschedule again
yeah so that was pretty awesome yeah
yeah I shall put it put it back in
yeah if everything goes right it should
become available again you take some
time it will take so in it somewhere it
so I ended pleasure presentation we
believe yeah yeah so how many people so
when you're building this I mean was it
fun how much fun did you have a ton of
lausanne yeah it's a I think after last
week I never get got a bed before twelve
so that so much fun it is to do and also
with colleagues they were really
enthusiastic getting started with this
so you're really building something
physical and you can play with that and
you have to learn a lot of new stuff q
Metis was a part of it was quite new for
us we did do something things with it
but when you're putting this all
together you need all all nuts and bolts
you need to know and put it together and
I have together with colleagues and with
you the last two evenings it was really
fun to do this and really get everything
up and running and stable and so yeah
that's partially why I haven't been as
prepared for my talk because I've been
up until maybe 3:00 a.m. trying to you
know put this thing together very
quickly I mean we really really really
only had a couple of days to put this
together so I'm so happy that everything
worked out and thank you Arjun for
letting me borrow this for the demo this
is fantastic
yeah and one thing everybody here in the
room now knows what to ask for Christmas
so
a good one yeah actually it cost about
400 euros foreigner dollars to build
this so you can make it a little bit
less this three notes three notes you
know would be nice here so thank you
very cool thank you Arjun
thank you that is super super awesome
and thank you again without any volumes
is and being able to show this to the
Vox audience here so if you want to get
started and try occupy Nettie's again
you can try this on many different
platforms the way you get started is by
going to this website you can install it
with one coming online on different
environments and you can you can also
try this very very easily on the Google
cloud platform we have the Google
container engine which we have the
managed kubernetes cluster and it only
takes one coming online or like a click
a few buttons to do everything I just
show you today and you can also try this
for free if you sign up for Google cloud
platform and you get like $300 credits
you can use it for 60 days so thank you
so much for coming to this session today
I hope you really enjoyed it thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>