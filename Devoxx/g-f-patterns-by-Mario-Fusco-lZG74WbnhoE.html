<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>g ∘ f patterns by Mario Fusco | Coder Coacher - Coaching Coders</title><meta content="g ∘ f patterns by Mario Fusco - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>g ∘ f patterns by Mario Fusco</b></h2><h5 class="post__date">2017-05-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lZG74WbnhoE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">furgus inflated do it make sure hi guys
thank you for coming
my name is Mario foods come from Italy
and I work for a debt on the JBoss rule
engines on rule I'm here to speak about
a bit of functional programming and in
particular under a specific point of
view so how many of you are familiar
with this book yes lots of you I started
programming professionally kind of 20
years ago probably a bit more and at
time this book was my Bibles I mean
really you weren't a cool programmer if
you didn't note all these are pattern in
this book and the more patently user the
more cool
you were so yeah and and then you know
people started doing crazy thing but
overcomplicated thing for for no reason
basically the white is because the main
problem of this book is is that it was a
great book actually but it was a totally
biased toward a single paradigm that
these the object-oriented one okay and
instead there are a few things that
could be be better and more concise with
functional programming and in particular
this book is divided in categories and
probably the most relevant category is
the one that is called the behavioral
patterns I hope that I've if I give this
book to a smart student nowaday the
thing the first question we will do will
be something like a but this book is
about object oriented weather is of obvi
a section here a section about
behavioral pattern a behavior is not an
object a behavior is an action is a
function okay so why you are over
complicating it modeling action with
object that is exactly what they did in
the book okay
the good thing about this book is that
it give us a common background the
common vocabulary so if I say to my
colleague here look here I used the
strategy but then I don't need to say
much more it's clear okay so this is the
good thing of this book but again we are
doing Fink in a way that is more complex
that how it should be okay
so let me show this with a first example
so what I did here is that I implemented
the some of these patterns mainly as I
said the behavioral ones in the
traditional Ganga four way and then I am
trying to do some live coding to
translate this implementation in a more
functional way if you want to review the
code you can clone notice disable this
collaborate oh okay so let me start over
there with a first very simple example I
have the common pattern ear so how does
it work I have this common interface and
I have a different implementation of
this command interface okay and then I
want to execute this reso common so I
passed this way so common to this
executors and I then can execute all of
these different tasks okay I know this
example is very trivial but I think that
it really shows the point that I was
mentioning before we have an action here
that is the function that is the only
relevant thing of all the stuff okay
but since the Ganga 4 is totally
object oriented about object oriented
programming day a to they could model an
action they couldn't model a functioning
in that point of view so what they did
is take in an action and wrap it with a
common taking a barb and wrapping it
with an unknown okay but the only if you
think about it the only relevant part is
this right so what I want to do is take
this and unmake it magita function and
to have a function in Java or Java 9 the
easiest thing to do is having static
method okay to have a pure function
because a pure function only depends on
the input cannot access the state of the
object when it is declared so you make
it static and and you're done okay so
this is for instance the command or the
action to log something and then I can
have a different command to save this
match please message somewhere ok and
then I can send this message somewhere
else
okay so what I do next here I have to
use this command interface but if you
look at it in reality the single method
inside this command interface as exactly
the same signature of another interface
that we already know that is the
runnable one so I don't need to declare
another another interface what I have to
do is that I can take this method and
let it run on on a list of runnable
instead of a list of common right and
then
I could do something like this and and
run all the and the runnable okay at
this point I'm ready to use to redo this
stuff again with my functions so I don't
need this okay make this tick this is a
list of round number okay and then and
then I have my runnable that are
represented as a lambda expression
that's all okay so if I try to run this
it will print those four briefings in
the same way but as I said in a more
compact way here you have a quite big
senior to noise ratio okay I just took
only the senior and and left the the
noise out and the senior for me again is
the option is the function okay so okay
again I know this is a super trivial
example but probably it shows the point
let's see something quite similar that
is the strategy pattern so again this is
the canonical implementation with tango
for I have a strategy I have a text for
matter okay that is my strategy that is
made of two things I can filter a text
to the side if I want to print it or not
and then before printing it I can do
some transformation to format it okay so
I have a few implementation
of these I have a one that is just make
acceptor every any text and printed a
CDs and then I have another one that
only prints errors in uppercase and so
on okay and then I have this text editor
that is passed with a specific formatter
with a specific strategy and I use the
strategy to publish a given text okay
but once again here the the only senior
the only relevant part is this method so
what I can do here is to okay make this
fing static again and then I need the
tumor fing I need the two functions two
lambdas that implement my strategy okay
so the first one is a predicate that
tells me how to filter the text so I can
do this okay and the second one is a
function from string to string that
allows me to to format to for
mathematics before printing it okay
that's all and then what I can do to
print this stuff is calling that method
okay and then I had to pass through this
new method to the two lambdas so I was
using this for matter for instance so I
can pass the first lambda like this
okay and then the second one is the one
that ran their old e-text in in
uppercase okay and I have exactly the
same effect okay so once again very
simple but just to show the point just
to show that all this strategy command
all this fancy object as they have no
reason to exist that's all that's so
true
okay next one though this one is the
template that is also pretty useful I
think so what I did here here I have a
resource this resources created then it
can be used in different me in different
ways okay but the resource has to be
disposed otherwise I will have memory
leak or file pointer leak or SQL
connection leak whatever I have to
disposal this resource okay
and I simulated the fact that is 2
meters the to business method can fail
with this random failure okay one once
out of three times
it feels so if I run this as it is of
course yes it may or may not fail but
the biggest problem is not that it is
failing
that's okay the problem is that the
since it is failing
I'm not calling this dispose method and
I am causing a leak into my system and I
want to avoid this okay what how I can
achieve this with the traditional Ganga
for I I give to my user a template of
how it should use it should use my
resource okay so this is the template
the template is either open a resource
do something with the resource and
then enough in a finally block you
closed the resource okay and then this
method is abstract so the actual
implementers of my template should
provide the unemployment ation of my
templating by saying what it should
actually do when you want to use the
resource okay but how can you do this
in July it you can do for instance like
this let me create these reasons okay
and then it here I dispose the resource
in the finally block so it is saving now
I won't have any a leak okay and then
what I do here
here I want to consume my resource I
want to do something with my resource so
what I have to pass here is just indeed
a consumer of my arm a resource okay and
what I do is just this okay so after
this to achieve exactly the same
behavior of of this template I can call
this execute method and then I will pass
it to it our consumer on my resource so
I can do something with my resource I
can use it I can employ it okay and then
I can run this thing okay this is the
happy part but okay if I if I'm unlucky
I will get the error but the relevant
thing is that anyway the results has
been disposed okay and I'm not creating
this fancy temple
I'm just passing a consumer to the meter
that knows how to properly create and
dispose that resource okay so this is
also called the land pattern because if
you look at this in this way this meter
these creating a resource for me landing
the resource to me so I can use it and
then I return back the resource to the
to the API that is in control and knows
how to do with it or what to do with it
and then it will dispose it okay next
example okay let me skip the observer
for time reason because it is very
similar to the former one it is another
consumer this time you are just
consuming the event that you are
observing same thing okay so let's see
something more interesting
okay so taxes this is my domain now I
have a library of taxes and then I have
and then I have a situation I want to
implement a salary calculator where I
may or may not apply all these taxes or
a subset of them okay so how I do this
in with the Ganga for I do this using
the decorator pattern okay why I am
using the decorator butter because as I
said I want to let's say dynamically
create the set of taxes that I want to
use okay so I have a defaulter salary
calculator just divides my gross annual
by 12 and then I have these decorators
okay so decorators just
does the calculation and then pass the
result to the next decorator so you have
different implementation the one that
applies the general tax the regional one
and so on
okay and how you use this stuff you have
to create you have to coordinate this
decorator okay so you have the main
salary calculator and then you decorate
it with the decorator that applies the
general tax we do one that applies to
regional tax and so forth okay so you
can try to calculate your net monthly
salary and this is the the result in
this case and what's the advantage of
this as I said is that is if so for some
salary I decided that I don't want to
use the regional tax for instance I can
just comment it out and I'm not applying
the regional tax anymore okay so this is
the advantage of doing this but of
course there is a hidden easier way to
do if you think about it what i'm doing
here i'm doing a concatenation of
function right so how to do the same in
functional programming this is very easy
I can take this one and actually this is
a double unary operator okay which is
exactly the same thing at all of this
method you see it's a it justice from a
double into another double so if I use
also the same name the compiler will be
happy okay and then what they do I start
from this and then I do function
composition and then I apply
the general tax okay and then apply the
regional one and then I apply the whole
insurance and then I first with my
salary okay and I'm done it's just this
I don't have all this fancy decorator
thing okay and if you look at it the
other problem is that this is hard to
read because you have to read it from
the inside out okay
while you read this in the in the right
order so if I print this stuff so if I
print this does I obtain exactly the
same result as before and of course I
also have the same effect as before if I
don't want to use the regional tax
anymore I just leave it out and um don't
same thing right but much more easy so
we could maybe want to do a different
similar exercise maybe we want to
provide to our user a way a function
that takes in input the gross salary
carico
the taking input the gross and then it
takes average so function and applies
this verrucosa function to my gross
salary in order to calculate the net
okay so if I want to do this what can
what could I do
I can put all these
functions inside the stream and then I
can combine all of them toward in a
single stream okay so I can do a reduce
for the reduce I need the two things to
define the reduce operation
I need the zero and the operation that I
want to use to reduce the different item
on my stream okay so now I'm doing a
function composition so what is the zero
for function composition the identity
function of course okay I have to use
this identity function okay and then a
the operation that you want to use to
combine them of is of course that the
and then one okay now I have a function
okay and then I can apply this function
to the growth okay and I'm done so I can
how can I use it I can do for instance
track I want to use is and then this
okay
what is okay and I'm done
nope okay accent okay next September
okay this is another interesting one the
chain of responsibility okay so what's
my domain one now I have a file that I
want to pass and I have different
component and each component has its own
responsibility so one component is
responsible to parse a text file I have
another component that is responsible to
pass a presentation or an audio format
or a video one okay so what I do and
this is the reason why it is called the
chain of responsibility I have four
component in this case each one has its
own responsibility and I create a chain
of them so I I passed up the file to be
versed to the first element of the chain
and then the the file is passed said to
dr the other element until it finds the
one the disabled to pass that file okay
so how do you implement this with the
Gang of Four so as I said you have a
file parser okay yeah I define at the
unobserved file parser just to create
this chain so each person has a pointer
to its next one in the chain and then I
have a text file parser the disabled
only to parse the file of type tags and
same thing for the presentation one for
the audio one and the video one okay
then our you see stuff I create my for
parser and then I create the chain so I
say that the presentation part parser is
the next to the text one and so on okay
so if I pass to it on audio file what
will happen is that the audio file will
reach the text
parser it won't be able to parse it so
it will call the the next one in the
chain that will be the presentation one
same thing it will reach the next one in
the chain that will be the audio one at
this point it will be able to parse it
to parse it and they will just it will
just do its job without the invoker
invoking the video file parser at all
okay so this is how the chain of
responsibility patterns work let's do
something similar in a more functional
style so this is my this is my function
parsing for instance a text file okay
and okay make this static okay so okay
so I don't want to create this chain now
I don't need it so what I do so I want
to have this next anymore and what I do
if this is not that text file okay I
don't I really don't want to throw an
exception if you turn attention every
time you throw an exception in
functional programming a kitten died so
don't do this okay so what's the a
what's the next option the next option
is of course returning null and if you
do this in functional programming the
whole family of kitten die
don't do this okay so what you do is a
modeling with the type system what this
function actually does this function may
or may not return a result this function
optionally return a result okay so
instead of return a string I will return
an optional of a string
right so I returned this of this and of
course in this case I will return an
empty optional right so I can do exactly
the same with the other format so I have
the presentation one then here are you
want okay
and then I have the video one okay so
what I do now now I have my four parser
that are just function now how I use
them I not I don't have this chain
anymore
but I can put this for function inside
the stream once again so I will create a
stream of them put in this in my stream
so it will be so the text was forced
then I have the presentation one and
then I add the only one
and the video on okay now there is a
small problem because the Java type
inference is not smart enough to
understand what I'm putting inside this
dream so I should give it a unint
so what I'm putting here this is a
stream of function from file to an
optional string alright so what I do now
I pass my file to all the function in
the stream so I can do this I have a
function and to us not apply passing the
file okay at this point I have a stream
of optional I have a stream of optional
I want to take only the option of the
desert value because it's the one that
actually was able to parse the file so
filter only the optional debtor present
and then I I take the first one okay
and what I have at this point
so after this map I have a 3 mode of
optional then I filter away only the one
that are present so I have still I ever
dream of optional and then the final
file first also return an optional ok
because the 3 may be empty and the test
case he doesn't know what to return so
this means that at this point I have an
optional of an optional of a string okay
and I have to unwrap this double level
double level optional because I don't
know what to do about it
the there is an easy way to do this I
flat map and I don't want to do any
transformation I just don't want to
flatten these two level
shanell into a single one so I just pass
the identity function to it and I'm done
okay and then and then I get my result
and I'm done okay so let's see what
happen okay cool so a question for you
is the video parts video function
invoked in this case or not because here
what it happened is that as I said that
the the audio file reaches the stages so
the audio parser is able to part this is
nev oak the next one it doesn't invoke
the video parser okay what is happening
now I'm invoking all the four functions
or I'm still not invoking the video one
who thinks that I'm invoking all the
video one okay actually I'm not because
the stream is lazy okay so when I say
fine first it invokes the first X it
invokes the parts presentation then
invert the parse audio then finally I
have an option of the displacement and
since the stream is lazy I don't need to
invoke the first video function at all
and I can quickly demonstrate this if
you want so probably I can do something
like this just to be sure or whether I'm
invoking a function or not
okay
so as you can see I'm not invoking the
video 1 right okay another thing here I
know that this bit is a bit complex to
get but if you are in Java 9 there is an
easier way to do this you can use in
Java 9 there's a method to transform an
optional into a stream so if you just do
you don't need this flat map and you
don't need also this filter you just do
sorry you just do this okay
optional ok and if you again this only
works in Java 9 if you are in Java and
you have these three metered so ok in
Java 9 there is jig Gerry's jigsaw but
actually there are also something useful
so and and you will obtain the same
result
ok next example the interpreter okay
okay so what I want to do here I want to
interpret this expression that is
written in reverse polish notation
not because I'm particular fan of this
notation but just because it is the bus
it is two parts because I pass the token
and I process the token by putting it on
a stack so I put seven on a stack then I
put three on a stack then then the next
thing is an operation so I pulled seven
and three do 7 minus 3 that is 4 then I
put 2 and 1 2 plus 1 is 3 and then 4 by
3 is 12
and then the result of this is 12 okay
I'll do how I do these with the gang go
for with this interpreter a pattern so I
have I defined this expression that is a
meter that is called interpret okay and
then I have the other expression and the
interpretation of the other expression
of course is the sum of the left and the
right then same thing for the subtract
same thing for the product and then you
have an expression of a number that is
just the number itself when it is
interpreted and then I have something to
decode the right the right expression
okay and finally I have the meter that
calculates please put in this expression
on the stack and working now as I
mention in before okay so it's really
really really a lots of stuff going on
here let's try to simplify this first of
all I need to define this operation okay
what I can do to defend this operation
is putting them inside a month to put
the function implementing those
operation inside a map having guess a
the symbol of the corporation itself so
I can do this I ever skied string and
these are in binary operator this is all
created and import these okay
and then I populate this map so when I
have a plus symbol I will do a plus B
right and same thing for for the other
two operation that are passed by my
interpreter by the way I'm not I don't
have any I don't have any error check
here okay if the expression is malformed
it just fail but this this is just for
for simplicity okay then I I can I'm
ready to reemployment this I don't need
anymore to have this expression I just
can put the values on my stack and
whatever the year is that I check if I D
string is the symbol of an operation
okay and if so is
and if so I will push on the stack be
the result of that operation right
otherwise I can just push on the stack
they integrate itself okay so this is
not longer useful I don't need to call
these interpret anymore and then I can
try to do exactly the same thing here
okay and I will get the same result
right okay ten minutes left so last
example is the visitor one what I wanted
to do here okay I have here I have a set
of geometric figures and so I have the
square that these are the data side I
have circle I have the rectangle okay
and then I want to implement two kind of
operation on this figure I want
something that calculates the area and
something that calculates the perimeter
of this figure okay so what I do is that
all these figure implement is element
interface so I can accept a visitor so
the figure can be visited the visitor
will have to implement a different
method for each of the element that they
want to visit and then I can have
another visitor that when it's passed to
be the square it will return the area of
the square and then so same thing for
circle and rectangle and then I can have
a different kind of visit visitor for a
different kind of operation that in this
case will be the perimeter of the square
the circle under
okay and then whether duir I put I have
a list of figure I and I use this
visitor to accept one by one my elements
and calculate the area and the perimeter
and accumulate them and and print them
at the end so this will be the final
result okay let's do something let's
once again do the same in a more
functional way okay so the in functional
programming what see it is more similar
to this visitor pattern is is the is the
pattern matching okay
we don't have further matching in July's
or nine hopefully we will have it in
Java
I don't know thirteen but but we can but
there are a few libraries for instance
there is one library that is called it
was called the java slang now they had
to calm the name of the library for
legal reason now is called wave Vavra or
i don't know the pronunciation where is
VA we are that has lots of dysfunctional
facilities like implementing are quite
powerful DSL for our pattern matching
here I did a very easy DSL with this
class to define a function that accept a
given class and that's pattern matching
on that class and when that class is
found is found
it applies a given operation on that
class okay let's see how it works
I have these figures okay so this is
still my domain but I don't need this
fancy interface anymore so I'm just
throwing it away okay okay and now I can
use that my simple DSL so I want to
create a function that transform an
object into a double that could be again
the area in your case or the perimeter
in another case of that of that element
so let's call this area it will be this
okay and then I can define this function
with my DSL so I have a metered on here
and not say on square when I when this
function is invoked with a square then I
will return the area of the square so
since I'm saying that this is a square
now the for how I wrote this class the
Java type system is able to infer that
the TSS is actually a square so it has
besides the side okay and then I can
define the same the same for the other
figure you see it's a fluent DSL
it's quite nice I hope
so this is the news okay make sense
okay so this is my function that will
calculate the area for these three
figures then I can have something very
similar for the meter
so this is this okay then these and okay
and our useless stuff I take my list of
figure okay and then I can put them into
a stream as usual I can map passing one
of the two function for instance the
area let me make this static okay and
then okay and then I'm done I can do
reduce and now I can sum okay so this
will be the area and of course I can do
the same thing with the other function
okay so I should opt fully obtain the
same result
okay so yeah that's all I think that I I
showed that you can you can
rareiy implement reffing to the gang go
for pattern in a more functional way and
and in this way the code is far more
concise and it's far more also readable
because yeah probably you need a bit
more time to understand all the tricks
but I believe it's just a matter of
familiarity I mean you are really or
personally I'm really familiar with the
object-oriented style because again I
doing this I did this in the last 20
years so of course it's it's super
obvious to me and and for all of us but
probably we are not familiar in the same
way with this functional approach but
when you use it for a bit you will find
that will be in many cases easier and
far more concise and readable than the
than the traditional object-oriented
approach okay sorry I'm madam is up so
no time for question but I'll be here so
I can take question offline if you want
okay thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>