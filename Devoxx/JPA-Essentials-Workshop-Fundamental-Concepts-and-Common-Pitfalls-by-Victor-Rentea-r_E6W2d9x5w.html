<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JPA Essentials Workshop – Fundamental Concepts and Common Pitfalls by Victor Rentea | Coder Coacher - Coaching Coders</title><meta content="JPA Essentials Workshop – Fundamental Concepts and Common Pitfalls by Victor Rentea - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>JPA Essentials Workshop – Fundamental Concepts and Common Pitfalls by Victor Rentea</b></h2><h5 class="post__date">2018-04-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/r_E6W2d9x5w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so actually this button yeah so I want
to ask you guys just disgusting how many
years of programming do you have since
you wrote the first four or if I want us
with our hands show me my fingers how
many years have been since you wrote the
first if they yes you see we can if you
want you can do that okay
how many years of Java how many's of
Java Java Java coffee mmm the best
language in the world Java good stuff
okay now this is me I mean no this is
like I'm a consultant pastry that IBM
this is my team actually I really love
my team underneath architects from the
largest clients of IBM Romania yeah 21
years why should you lots of years of
Java for money I mean I mean value lists
about Klinker dominating maniac about
blink or depreciation ami most of you
think you know me already so I'm really
manic about wrinkles that I've spoke
quite some conferences already you can
find my talks here I have a website I
have a website yes I have good then
why read what I want to do really what I
like to do most is training technical
technical trainings and I have some
experience by now lot of clients there
and stop is like spring hibernate this
is commercial yes commercial sorry it
lasts
clink yeah design factors infected that
in the Java course yes a really proud of
that in the importation any testing I
love TDD
Scala yeah and then the performance area
under immoral some guys reach out to me
talk to me let's pick up server best
team I can find me on this media so yeah
lots of lots of trainees there yeah
anyway let's get back to work so what
should we choose first we should start
with some beans with some inheritance
right so how do we do inherited in DBA
yeah good good fast don't do it I mean
favorite composition of our inheritance
says one principal from Gaza gender for
design patterns
old stuff anyway if you really want to
do inheritors what what how it feel
that's it so you have this entity right
that can then extend another class a
which which may not even be mapped to
the database may not be may not have
anything to do with it a will not get
purchased but will not be used anywhere
so just a random class we can extend any
random classroom but you usually don't
want that right no that's not water I
usually want to extend another class it
will give me some fears that can get
automatically persisted in the database
typically that there's an ideal some
base entity that has an ID field that
will get persisted in some column named
guess what ID so there you go this is
this persistent there is a smart super
try that if you extend you get all each
field in your tables and you will see
examples of course then where you can
extend another entity another random
entity but twenty of course a little bit
entity and see it's best to be abstract
that's gross tasty if it's abstract so
you extend another entity so then the
question is
there are
only the super their actual concrete
exactly what you told me but now in the
real world with real entity join me that
we have person that will have four
inches to the record table Nexus there
will be foreign keys in there between
now let's discuss Plus
tongues want to do them the first
approach less tables of course less
tables but I know all the columns for a
sheep will be newly for a person agree
of course for name but good so then you
cannot put any not null constraint of on
those columns right can possibly put or
not know there they will be no good for
your count you is not know that one
disadvantage of that good now this is
useful actually when there are a lot of
shared columns there so columns that
appear in both I mean which are common
to both of the entities to all of the
entities you get away with the point if
there are several columns which are
shared it's very convenient to use a
single did actually this is the most
used strategy really in GPA good share
when you have a lot of columns now
however so this is a simplest and also
has best performance at the King she
became a Java champion right last year I
think so this guy wrote a book about
your performance I will mention him
again
good and then let's talk about this one
what do you think it's good on that
you'll see exactly what all the body or
the entity contains so there will be
only columns for the fields of that
concrete entity Rex's just those columns
own so you can have this is usually
useful when you have specific columns so
in case you have four sub courses and
they have dramatically different columns
you should go for this approach because
this will keep all those specific
columns here in the guideline if they
have many specific columns you should go
for a table per class it's a better
database design one could say because
now only the person will have a foreign
key to another now read what could be
the others of a ship it's hard to tell
it's hard what I mean but the person has
so you can link only the person table to
the address table so you get these
foreign keys you can do this for in
Vietnam or you could do also here but
really we did make would it make any
sense for for a ship to have an address
you know so these are some of the
trade-offs that you have to do and of
course we can't not know right you can't
put right now because they are have
specific tables for each entity but good
now the when you use a single table the
first time the most used one as you told
me already
I need a kind of discriminator and it
GPA to know how to get how to determine
if a row is the ship or a person from
there we go this is a pipe colander to
to happen for this to happen you have to
store the discriminate in this case I
told GPI to use pipe that's the method
the only thing that matters by this by
the way you said you want to use a
single table strategy it will be all put
in a single table and then you said that
you want to dare to add by default
somehow hidden a column name that will
store the actual pipe for each row and
for the GPA will store in the database
in the discriminate the table do you get
the point
who got the point raise your hand good
nice oh good so now honestly I would
like to do this dinner to see how it
feels I mean let's play what ha
so in my virtual machine if you started
the this will automatically start will
be the Eclipse with the GPA to project
started but you know they look I have a
program that if I run it starts database
how cool is that so I run this program
and it starts database of courtesan in
memory database named h2 that I can then
connect from my Eclipse the full
instructions on how to get to my
so my settings are written on the paper
you can take it there afterwards so then
from the Eclipse I can't connect to the
database that's the beauty of it let's
see if it doesn't connect correct let
start the bit Sutter philosophy come on
32% yes thank you so we don't we don't
have a spring boot application that we
with then even a model already written
there so in my domain entity there are a
lot of event is actually if you flip the
page forth with the instructions you
will have the model that I have that so
when I start this application let see
what happens the application will
connect to this h2 in memory because I
instructed GPA to create all the tables
when the application starts based on the
Java entity that I have when this part
we you can see in the database that
other table after table created audited
that the tables are created right here
in front of me so now if i refresh the
stuff
let's see refresh refresh public table
there we go these are the the tables
that were just created just now by the
GPA when started actually the hybrid
freedom good and now let's look at my
model do I have a model yes so I mean in
the model I have this read this if you
look carefully I have teaching activity
how can I get to my model wait a second
alright a second so in the GPA let's big
model yes this is the mobile right you
all have it printed them and the here
the the hierarchy is right here you see
this is the huge and it means that the
teaching activity can be of two subtypes
lab activity or course activity okay
let's see this happening so in my
workspace I have this let let me show
you the code first I have this teaching
activity which is an for who else once
the virtual machine you can get the
stick and copy
this is the abstract entity which is the
teaching activity in my case which has
the inheritance strategy joint what do
you expect to see in the in the table if
I tell you that this class is extended
by two subclasses what do you what do
you expect to see three tables let's
let's see them so ultimately debate I
see here teaching activity
I see also course activity I see also
lab activity three tables joined right
let's change this and put finger table
single it's asleep finger press control
spaces finger table and then I will need
to specify a discriminator column how
would you happen to name it so this is a
discriminatory column that will be added
by GPA automatically with the name
equals let's say worst and if we save
this let's see what happens let's see
what happens first of all let's see if
it really started so I used spring but
application with dev tools inside which
means whenever I change the code the
application gets automatically restarted
which is a good thing and at each
startup the database is refreshed let's
see now refresh there you go we already
have now teaching activity right with
the worst column there that will be the
discriminatory I will insert a row of
type course then there will be a line
there which value cups okay and the
other one we remember the third option
what was it I have single table I have
joined and I heard people per class
table per class if I do that let's see
now what happens what do you expect to
see how many tables two tables let's see
that
okay identity column with what with
Union subclass cannot use identity
column generation with what
discriminator Colin I think this should
not work like this let's see let's see
the flashing flashing if it still felt
your trust my word that or a bit too so
that I can be they carry three
strategies there okay good let's stick
to a single table let's see next what we
have so I would say that we kind of
covered this part right now what's next
cash and transaction even interested
this is good interesting stuff but let
me sting just a bit just a bit so cash
let me see this goes to 64 and this goes
to I went to Adobe for our interview and
they asked me how to tune secondary
voltage of GPA I'd never didn't even
knew what the first half of cash is
that's the kind of question there you're
in the same transaction if you get from
the database the same very entity you
will what will it catch them if you get
it again
remember you will never get to the
database the second time if you are in
the same transaction the second time you
asked for it GPA will just give you the
first into the first very intimate
equals equals and of course I'll ready
to prove that if the same if you find if
you get it fire query if it's children
of another entity that you load however
you however GPA gives to you it is the
same entity if you are in the same
transaction now I would say that the
persistence context which is actually
you can imagine persistence context to
be just like a pool of instances
swimming happily right this is the best
this is the cash that you you are
working with and that this cash is bound
to a to the GPA transaction that is
active at that moment to the GPA
transaction what the hell
so I would say nice that you work with
the persistence context why are the
entitymanager
do you guys know how many of you have
ever heard of the entity manager
interface good so it means you work to
GPA persistence context is there behind
that but I will say now strong is what
what the heck was that what did it it's
a proxy to the persistence context
bounded such shooting down this map you
say the question next comes and I'll
explain everything
don't worry the question may come how do
you update an entity with GP do you need
to save it back in the database know it
yet automatically written down any
changes you do to the entities of archer
are attached automatically saved to the
database
try what what do you mean so you set the
name of the course automatically you
will see some time later in the load
updates lalala I said name equals
exactly what how when this is been in
question when does this happen we'll
just before the transaction commit
telling us so if what I want to tell you
is that your GPA transaction really
include all the entities that you ever
got from database in that transaction
you will find them in that Jupiter
version all the entities that you want
to insert in the database you will find
the same type a transaction all the end
all the changes you've done to the
entities attached and you will also have
there the pending deletion the pending
deletions are you are what what
again your code might do enter the
manager dot persist it will translate
some time later imminent self if you do
curse that name it will mean the salt
and later the
must be updated right now you can also
do remove which will be translated to a
delete by 17 law yeah
good but update great script this bTW
for these three weird sound which will
be converted eventually to do some
operations to the data is now to each
GPA transaction there is one and only
one persistence context do you this is
like persistence context of a
transaction right the same thing I mean
it is this pool of objects that move
together with your GPA transaction it's
bound want one it's my own persistence
countries so that we persist we'll get
some time later to an instant and that
will get to a delete but the question is
when will this get to the database
connection that goes to the database
so our database is done we know well
about the database but they will get in
the database in the database transaction
do you know must be the best transaction
is how many of you know what a database
transaction is okay so do you do know
then that you can insert insert insert
and if you roll back nothing happens
nice alright so action is the same
atomic block of work that you can either
commit at the end or world good now this
also have one database transaction bound
to it so this is really a rich man mean
it has a purchases context boundaries it
also carries a transaction
it's really rich now all these things
will eventually have to get to the
database right they will have to get
there so they will gather at this
operation to write all the pending
changes to the database
it's called a flush it's a flush yeah
you just flush with the changes down I
mean to date but there is an important
distinction
the flash is different than they commit
in other words with GPA you cool you can
see in the log inserts being performed
in the database however this doesn't
mean they will really do a real
remainder because legend rod so pay
attention you might feel inserts that
you did not expect at some point which
appear but don't think these really
remainder so you can then this version
later on can be rolled back very easily
voila this needs to be proven I'm pretty
sure so the context is not only a read -
meaning what I've told you before if you
get the same entity again you will get
the same identical instance this is this
means a rich - right
but the right - means that your changes
that you want to do don't just go to
database just yet just wait a bit right
they wait a bit until you flush the
changes to the database so flushing is
exactly that all the pending changes
that are there or on your entities it
will run the instance the updates the
delete everything so basically the
question is / and this is this is a
clippable the slash will happen
automatically right before the commit of
the GPA transaction that you are within
that you are in so this is that that's
an important very possible then it will
also happen
before now they know that say there are
only two things happen hard in
programming the second one the first
time with cache invalidation and naming
things mainly things now folks if I were
I was about to insert something in the
database but then I run a select and I
count how many rows I have I hope you
agree that - chef has to go to the
database before my query so somehow all
the pending changes need to be flashed
when you run a query that might get
influenced by your changes myself so
this is what what this means that these
changes automatically go to the database
when you want to run a query that might
be influenced by the these pending
changes so in other words you don't give
a rather what you should not care GPA
would just make it work whenever you're
painting changes is really fresh there
it will do it for you when it when it
must so just trust in GPA trust in
hybrid you can also do entity manager
not flash but it is the coachmen you
should never actually need to do that
yourself this you should rely on the
default behavior of GPA good now when
does this commit real I mean do you guys
know about the operation commit the
semicolon and then you press run this is
this happens in the database right you
do commit and you can run this in the
database in your transaction gets
committed now when is the GPA
transaction committed that's more creepy
we I would say that it killed
automatically when but at the end at the
end of what at the end of if nothing so
what do I mean here the GPT assertion
commit will slash all the pending
changes to the database it will also
commit the underlying database
transaction so then how do you control
now I will go to slow mode because this
becomes hot how don't don't mind that
just don't don't eat it we are in spring
how many of you spring how many of you
use egb so we are here then if you do
that before you enter a method the
transaction will get started for you
before then after you the transaction
will be committed what after who who
will commit but if you travel research
from that matter this is the bad thing
that you need that you will roll back
your transaction oh my god so
transaction get created before you enter
a method and then get automatically
committed when you exit the method are
you mad this is a declarative way of
working with transaction it works by
proxy no you guys know what a proxy is
proxy proxy epoxy who knows where the
proxy is it's something the stitch in
between that intercepts your method call
and I will show you this in a moment to
make it work in screen you put a
transaction and then you say propagation
what the heck is propagation let's see
that in seconds if you can understand
first of all if you put transaction on a
class it will automatically propagate
down to all the methods that are there
in the class but if you want to override
what you inhale you put it on a method
and there you go this is mandatory and
this is support the propagation of
transaction what I mean
transactions propagate what it is a
disease yes it's a disease from on the
method to another it's like a disease
yes now this works via an LP proxy
wrapping this employee serves Mars let's
see what that means so let's look at the
life of a transaction so we have this
method that we call here in the account
service which is called pay MLP which
then gets the account from the account
report and then call another method but
before you get to even enter the method
here you run into a
proxy there is a proxy there in between
that you don't see that's the beauty of
it there is an invisible proxy that can
execute code just before you really
enter the matter that proxy will look at
the transaction propagation attribute
you have on the method and this method
states that it wants to run it it
requires transaction what do you think
it will happen here and it's not that is
not relation so this will this case it
will create a new transaction de rigueur
so the disease is born the transaction
is here later on you call this method
this is supports what does this tell you
into it goes further with this
transaction yes so this transaction
infects this other method
good you go with GPL to the database
and you take stuff out of the tip it
take stuff out from that moment we need
to find the persistence context is born
you get out stuff from the database you
load the entities this is the moment
that you should realize the GP is your
big brother another brother the show GPA
is watching so before it gets to the end
it is the to the question but it also
keeps a reference to those entities
it keeps her it's a reference it will
monitor your regular entity it to look
very careful so you returned it here and
then you change one of them but GPA
knows because he did a snapshot of the
entity before it gave you your entity
just like pictured good and then the
thing is just going to balance because
also effect you request the same very
entity what will happen you it will see
that you're in it's ready they are
loaded in the persistent it will never
hit the database folks and you will see
that in in the experiment so you get the
same entity that again
the melody at last because nothing bad
happened the auto commit happens here
when the auto commit happens here what
will mean is that this change gets
persisted to the database you will see
an update la la la la la make sense for
you good just destroyed so you've exited
the method after you've exited the
method the persistence context dies
Big Brother dies three week is CIA with
CIA shuts down no one else cares it's
like when you are 18 and you get kicked
out of your house you're living no one
else really care about these entities
this interesting can do whatever you
want with them no one will monitor make
sense
good so how does transactional really
work this is probably one of the
toughest points in GPA trip you want the
water be it should be it is
transactional what do you get here so
you won't get beat you won't get you
will get approximately you don't get the
proxy instant something which looks like
the smells like B works like me has the
same method as B but it's not it's
something yet it's a proxy and you call
this method trustworthy believing I'm a
believer Evelyn I believe called you
want to go there but now you first get
to the first and what will the proxy do
production staff aha stop transaction it
will come to me afterwards after you
finish this method guess what will
happen here ah I have up in the
transaction Oh
though nothing that happened so let me
commit so there is somewhere in there is
someone in between you know someone is
risk is in between you and the method
you want to call good sir this man can
do more things before really very given
to the intended method
Wow yes the dozens of questions you have
to start transaction entity manager has
a method main start transaction
transaction don't use it which bring but
if you don't have spring why don't you
have to then some reason is not a spring
this works very well with declarative
stuff only if you have some our P as you
say and container that good nice good
good proxy very good we see that we saw
the proxy
good then let's see what was this
transaction about so you see this method
I will call a method B it was the case
in this in case it declares that the in
case B sub declares here exactly here
that it supports the transaction that
was actually rentals is it came without
a transaction it it enters without this
transaction myself so requires me that
introduction come to the create and
there is the third one which is named
requires you if you came with the
transaction I don't care I suspend that
transaction and I'm start a new one
right and then increase again without I
get a new one of course these are the
diversion propagation attributes plus
three more for one but we don't use them
you don't want to use these two most
then life is not that good all the time
right yeah Lance sometimes facts they
feel peppers the same scenario the same
scenario required means that someone
come coming without the transaction will
get a new transaction make sense do you
follow raise your hand who is not asleep
fine you find something from the
database perfectly again there is your
persistence context which are entities
there you change this entity here and
then you enter this method you enter you
do a fine and then guess what the boom
no this little proxy that wrapped this
mother sees your exiting hold your
horses we don't ride horses in here so
the moment this proxy sees you riding
your exception happening yeah stops you
wait wait wait what it and this means
something bad happened how would you
feel if a policeman I think the horse
will be watching them but fraud here
patrolling that moment it will kill the
transaction so there you go this is the
zombie transaction
still works these works and then this
exception that you've thrown here you
make me swallow it like we all do but
doing that is a clear sign that you need
professional advice or professional
reorientation I heard they are hiring
Sharma guys they're at money so slowly
exception is the ultimate the last thing
you will ever do in my project actually
but there are other cabal projects that
we have by the way did you know IBM is
the largest IT employer in Bucharest
it's a companies of component
yiii good so we will have projects for
all of you I'm sure if you do that but
no we don't just follow exceptions no
then you want to persist the error in
the database please don't judge me to
the requirements from them to people but
this is me years ago trying to insert
something from this method yes what
happened
this is me binding the world
from that angle back then this slide
result right which means we now commit
this is an important rule folks really a
really important rule whenever a
transaction whenever a transaction
whenever a proxy creates a transaction
the same proxy will end it either commit
or on this is super important thing you
will find yourself hunting who creates
distance
whoo-hoo and you will have to determine
whom what method actually created the
transaction the first to know what died
you know you know what died
you have to determine this is the place
the transaction was created right
because you crush the transaction here
but what you did here also is lost so
you will have to go hunting to see who
who who created this transaction and
that's an addict that's why you need to
print this slide actually and keep it
under your pillow
sleep on it I mean have it on your desk
right it is there huh this is a
reference I really use good good how do
you kill a transaction you throw a
runtime exception that's what I've said
already if an exception goes kaboom the
transaction will be killed it becomes a
zombie method depth then there are other
conditions now on the range from 1 if 1
you are super ok and 5 you are dead that
branded how are you are you fine are you
doing Dimona
or can I continue talking are you fine
yes
squeeze the chip so it has to be a
runtime transaction a runtime exception
it has to be run then the proxy will
kill the transaction but you have to be
sure that that method was intercepted
intercepted by a transaction intercept
this one the blue one the blue stuff
cannot do with eyes the person the blue
stuff actually do you remember the blue
stuff of course it's you should remember
it yeah this this kills the reduction
this one so you have to be sure that
blue something is there so you need to
see this is actually the name of that
blue santa rosa intercept any one
perhaps two zero or to print the
spectres in which you are currently in
let me explain what I mean I was now in
the create
method you see here but then this is me
somewhere somewhere below yes one this
is the controller the controller in the
create model called the subject to
create the subject watch this in between
it's actually spring intercepting the
method call this there is nothing from
me in between the only thing that may
arise dynamics of the created by CG
thanks your classes at runtime to be
able to intercept that proxy that blue
proxy needs to be an instance of the
same to be an instance of this I said
its subclasses your class this is the
last word she said rest in peace I did
it of course the first thing okay what
is it where is it final through
Craster's yes but you do know that
constants can be set right
you can modify modifiers you can make it
so fear to be non non final at random
but you did not hit a song okay someone
using GPU if you change the state of an
entity instance the change can get sales
to database that what I've been talking
about now when it doesn't how can I do
this mess let's first experiment so what
I mean here is that in case I ever
change an entity it will auto so I want
to prove you many things first of all
the rich cash what does it mean the rich
cash I allowed the entity from the
database once then in this introduction
I loaded again and I want to see the
same very entity with equals equals re
with name should we do that so let's see
we have this box this playground that
these methods are run here right here in
front of you right you see let's see
let's first see if they work this is out
one
and of course the traditional she's out
to here let's see if after the
application restarts I see one and two
what I want to do I have two
transactions in the first reduction I
will create a new thing
let's make it simple so I will do
something like first of all what should
i how should i persist the thing in
database do you know that we think what
interface what should I get here first
thank you entity manager M good so
spring will get me that asteroid m dot
persist of a new error log let's make it
simple like that no fuss easy stuff and
I want to see this in the database when
the application started that's what I
want to do next and I want to open the
error log and see it's there there you
go this is without what I wrote I'm not
sure if this is mine a that's me it's
good then I want to load that and the
question that I have for you is what is
the idea of this entity let me let's
wait one so I know that I now have in
the second transaction already in the
database and analog with ID 1 so let's
find out how do you get from a puppet I
am NOT fine what kind of class do I want
error Lord class of class of primary key
1 L and this is the error Lord not good
now let's try eat too and then let's
compare this out e equals equals e to
right this is what I'm telling actually
to get the same entity again we'll never
get to data basically give you from
memory could that be you interested
so this printed true nice but then you
may be wondering is this true the next
thing you should have in your head is oh
my god what if I call here Oh private
other know about me so I can be fast ok
other class other class
let's create this other class work and
let's say that this is a service model
and this is also transactional good and
then in this other class this other
class I want to call a method OC dot
ana best thing in the error I just found
and look what I will do next so I'll
create this method and method in this
other class and I will get again from
database here this same I mean the error
log with the same ID one so guys now I'm
in another class if this will work only
so if the transaction that I've created
in the works days playground spread with
the call to this other method here then
if I get the same entity again in the
same transaction I will get the same
very entity who agrees with me that if I
prove that is me that the transaction
propagates
do you follow let's see first the code
because you don't follow so this is the
second transaction and by the way there
is something interesting although I did
find twice here and here there is only
one select do you notice that there is
one strict actually that proves that
it's a real cash you go the second time
it gets to the same entity from memory
and guess what it's true
it is now okay the truth is variable let
me be more explicit so an entity now
getting the entity with the same ID
within within the same transaction even
from a different method gets me get me
the same very instance this is better
now
and I can follow the see printed through
the students to us to let you think the
entity with the same trail Allah Allah
is guess what is true so keeping the
same it again this proves to be a read -
do you agree are you convinced do you
vote yes yes this time that of course
good good good thinking transaction and
make it what equals requires you let's
see what happens now what do you expect
to get printed let's see it it is the
true what the second production that
does nothing wrong yeah there's nothing
wrong I should have changed the method
in their right side those clothes let's
see so I'm getting the same entity again
in a different transaction this time and
let's hope it is false
thank you lord so it's false there you
go
now let me prove you the right - right -
let's how can we experiment right - tell
me your ideas I want to change some
entity right let's see mean let's kill
this one first and let's change the ease
of I am passed to set the name set
message to a different value like fast
and let's see what happens now and I
won't even grow even more and say here
oh my god she's out after returning
let's see what happens now yeah okay
after it turning oops oops oops now am I
the only one who is a bit puzzled what
the heck what the heck how come the
update happened after return well really
the change was done here in this other
method but the update grants to database
after this was
printed what does this mean the question
action ends this matter so basically
after returning the update went to
database and guess what will come after
it will print this one so right after
the returning from that method the - - -
- message will get printed so between
this and this
who is in between do you want to see him
yes of course you should you always
should you should choose your duty to
see it so the simplest way to understand
this new random exception that prints
the a I will not draw it I just create
impede the trick we can use to learn
proxies what will print here is the
where you were in the second transaction
and let's read I was in the second
direction yes indeed but look carefully
who is below me who is he who is he he
transaction intercept receipt there you
go that's the blue one so there is there
in front of your eyes and in because
this if you shut the transaction it will
die dilemma - positive so right now in
the error log if I look it's a different
value yeah data that how can we do to
kill this transaction ideas how can we
do to kill the transaction thrown
exceptions from a method which is
intercepted which is a which is
transacted and I don't have this feeling
that this method is a good place so true
new runtime exception okay good
oh come on okay so then if I throw this
exception it will propagate where it
will pop out from here you see so then I
do pretty quickly here a try and the
catch and our exception of course I will
do that
that's what happens now will allow let's
see if it happens so sometimes on some I
can have surprises here ready let's see
let's see let's see can I explore
complete and Allah just died
just died in pain no but yeah here is de
what Alex oh you know that one throw up
when you throw it your throw your drop
this is a good point if you catch it the
exception and then you throw it again
why would you do that to lock it right
because you don't know if anyone else
will love it
this is fear my friends so that's that's
why I did the idiom is throw up it's for
complete and then and then and then and
then and paint come on come on I can do
this you can do this it started yes it
started or not no not quite died at some
point but let's see what happened in the
in the in database
this is interesting the database bad
also Oh
rest in peace anyway let's see this
really died yeah this is this weird
stuff that this throws a transaction
yeah I could show you but exactly catch
exception yeah it will throw another one
and then nothing is good good let's
target so this we saw that if you change
something it is automatically updated in
the database the persist will happen
what else have I shown you what else do
I need to prove to you that's what I
thought I was trying to do now let's see
what happens
tank for some reason it may be that the
very database needs to be restarted
somehow
start database from it's not even start
database run okay and then from this GPA
to application again let's try the
second time what else do I need to prove
to you it will be nice to see the
requires new sometime right that'll be
nice to see let's see if you can do that
but I want also to see what what else do
we have in menu this will will do what
this will do this and this actually we
need to get there with optimistic and
think I'll do first spring data ok so
it's still alive let's see to the
database what is the ender error log
record I think reconnect close close
close reconnect public table error log
thank you x6 why is it take 6 let's get
this one so what happened x6 was the
initial value let me prove that to you
the initial value was big 6 when it got
inserted then in this other transaction
I've from this method I've updated the
value to be different value and then had
thrown an astronomy exception see this
is this change never got persisted
because the transaction died right this
is exactly what had happened
yes because this one went out of the
proxy surrounding this method and killed
the transaction ok we can go on further
but I think it will be in too much
really for this let's see if you can
cover more things spring that spring
grab a GPA let's try to do that so after
you have written a lot of such fine fine
fine
save dollar you would want to get more
productive so you then hear about this
spring data GPA let's write together a
repository so look what I will do I will
create a new interface
by the way this will be probably the
most creepy thing you will ever see with
polymorphous it begins very nice is
something like let's say error oops
here a lot repository I want I need only
to to extend with by the way you know
that interfaces can extend other
interfaces right gep a reportable okay
and then you have two things to give to
this class what do you think d stands
for the entity error or not
what is this realizable what could this
be the primary key what this is a long
there inside which is all I need to do
folks now let's see whether if I can
inject this one so this is a class from
spring you can see this spring let's now
go to my workspace play ground then
let's inject this interface by the way
yeah you may be wondering i never
implemented that right so what are you
doing how could this be how could this
work out quickly comment this one for a
second and the spring should not stop I
mean what have I created an interface I
mean started what the heck let's see
what do we find in that repository can't
delete get look how many things are here
exists find wow this is the Garden of
Eden look find all with payable with
each applicant even oh my god find Orton
give you a list can get through nah nice
so to get now from this repository and
errorlog how do you think we can do fine
one of one L yeah this might not be very
it might not yeah what I think you did
was incredible but you can you could
still wonder who the heck what the kind
of implementation is there how to find
out report I will just fish them out is
this a decent implementation
let's print out the report we'll get
plus to see what's there inside who are
you who are you who are you let's see
let's see what what we'll print what
we'll print are you were decent know
this know about that old movie are
decent and the girl returned who me
you take old black in white mode so this
is not decent this is a proxy of course
no one ever implemented by hand that one
it is a generated implementation that's
the first creepy part good but then you
see that I can even in the console I see
the error log that I got from the
database you noticed this one this so it
really worked so I can call methods on a
proxy Wow cool but things just get
better because I have other matters here
since our perhaps report count why not I
can get then find all and I can do a
page able to get just the first page of
the records from the database but this
is not what I want to show you because
let's go a bit to this report and let's
imagine that we now want to select an
error by its message by its message
message so I want to build the method
which returns me an error log R or blog
find by message string message and then
I'll come to my my implementation here
but let me put this repository here for
you to wonder what I write and then I
want this to happen something like I
want to find the error log by name using
X 6 so this one above I want to find
here message so I will say this I will
pray the you know what is the most used
development methodology is it TVB the
ability now it is JDP Jesus different
different
so not me saying that others more smart
people said it Jesus hope it works I
called the method that I never even
specify the query nothing what did i do
what happened what because you know what
if you don't let them wonder right so
Christ have mercy
so fine bytes message though guys
this message really really really really
this message here is the same as the one
that you see right here is the same name
of the field that's why it worked the
spring built a query to query by the
name right wallah good and you can do
many other things we can do count - you
can imagine things good but you can even
do more let me look at bit of the model
look it has let's try to build a query
that will get me the teacher of no let
me get me at the subject with a teacher
of a given name so I want to pull out of
it a subject that I will say find by and
then let's look a bit on the tee in the
subject it has a field which is named
holder teacher so what if I say fine by
holder teacher named dream teacher me
what's that so I want to eat now to
traverse a relation between two entities
to get there inside and to join them and
then to get the name from the teacher
and get me that this is interesting
let's see this could ever work so fine
by holder ID and then I will supply this
business so our now spring data to
create a credit will join it with get
rids to another entity first and then
put the condition that's creepy
did not work because I mean the error
log repository folks I'm not in the
teacher in the in the subject repository
but this can be easily fixed right so I
can make sure
to be a subject repo repository it's not
subject really positive whatever subject
report which will have this method and
it will be for a subject you get media
Farah done doing I'm duplicating this
and then I will delete this one here I
then to insert here the subject repo
subject repo s repo and then here down
below I will say s repo like this quick
and dirty as you all love it right as we
all wanted and this is a first subject
people so let's see now almost almost
almost subject Ripple what does need to
find it
subject Ripple subject and what no this
should not be a surface actually it
should be enough really let's try to
deploy it once more I had another one
yeah just to kill it kill this one yeah
kill them kill the web
kill the web everything bad died just
now let's see now
so there you go this is what happened
guys so GP substring actually generated
me a query that will get me from the
subject to the teacher and then get the
name and filter about that good but
sometimes life is not that easy
sometimes as you all know if you work
with GP aid you'll have to write gpq
well the thing that you did not want to
hear about GP QL is that query language
in Japan GPA and if you want to do that
over
let me see just quickly one thing did
you wanted to hear about optimistic
about lazy load I think so folks I won't
be able to cover everything of course
this is a two day workshop that I'm
talking about here but just quickly the
point lazy load do you know what a load
means let's do that first
what would you give by default the name
will be get already loaded okay
that's for sure but if you then iterate
over the students of a curve what will
happen what do you think will happen so
folks now I'm talking about a course
which has many students perhaps one
thousand of students what will happen
what do you think will happen do you
think GPA will get me the curves noting
the one thousand students by default
this will be stupid right
I mean crap so there it will wait but
the idea is that GPA wanted to believe
you are working only with only with
objects so it wants you to believe that
they are out there so it gives you this
list and you trust me with that and you
think this is funny
whether in fact it's completely and it's
a sort of proxy so before you even start
iterating this list you will see in the
log select getting the sub students of
the curve this is like hibernate being
cosmic one moment I'm going to get the
data okay hey girl Nate over here I just
yeah I did technically she's good so
there you go then hard hack lazy not
mean that it is triggered by calling any
map on the students equal size is equal
iterator any method costing any method
you call on themselves to trigger a
query in the database damn it it's a
hack it's a hack said it's not a hash
tag no it's a persistent bag it's
something it's another implementation of
the set provided by hibernate so if you
call any method on that it will know the
children then the first time if you
don't want the children again it will
give you the children it already loaded
right so the first time you want to go
over this collection it will just from
database the next one guess what
we already have that loop they are in
promotion here we go so this only
happens once when you first access the
list of children make sense
who got it good now default fields are
always loaded by default all the columns
in this table are loaded always by
default
good then this what do you think will
this be automatically loaded
it's another entity right so if you know
that it means to join or to do another
select right run it sees eager this by
default loaded by hand automatically
when we get the course you'll also get a
teacher Wow cool stuff now unfortunately
hybrid up to version 5 point something
did I step will select for each course
it fetch the course of course
and then one more one more query to get
the teacher of that course which is
weird because if you now get some
database one thousand courses you have
one thousand more queries yeah one
thousand in one night to wait don't
fetch or you can make it
lazy you can make it lazy anyway the two
men is a set of students that are just
discussed with you indeed are lazy
loaded unloaded on demand only when you
for example iterate over those children
myself now again this is a hat set or
list implementation now changing the
default usually a bad idea but usually
don't mess with that leave them as they
are they are very fine as they're now
direct field if you want to make them
lazy you can but it's weird I mean why
would you want to do that the point is
what is this name was the clop will
offer up maybe 400 megabytes of it is
your CV there but
eight pages long wrong see if you should
be one page only write one page only
when you really need it you can do that
but to make it work you don't know you
don't wanna know what's helping it has
to do it will have the curse it's the
instrument it will be till POIs don't
then do one you can also make lazy of
course you do not do lazy know that you
don't want to - idiot lino your teacher
perhaps right so you can do that by that
again it will hack now the teacher class
the teacher business will be there but
in case you want to do anything with it
be select you it will hack your teacher
path which just get ugly nest ready and
too many if you want to make it get this
is the worst mistake you can ever do
because now whenever you want to load
the cursor on the database you will get
also all the students okay it don't like
a dark cloud approaching do you know you
just want to get one row and there you
go 1,000 rows so this you should never
do really really really to avoid it you
should you need to know about joint
fetch and this is what I wanted to get
join face because in some cases you want
indeed to load the parent together with
all his children make sense in one shot
you think less joint okay let's try to
do that so this time I wanted to get
from subject together with all the
teaching activities so I want to get a
gig in subjects and I will say find
fetching octi fetching DVDs I will need
to get it somehow the ID 5 was a matter
this is not generated anymore long
subject ID because hybrid could not
spring could not possibly know what I'm
trying to do so there you can specify a
query an explicit GP keyword query which
we could go something like select could
you tell me how to continue in here
as from some stop subject subject
subject yes then of course join fetch s
dot who are TV I don't know the name
let's look what her it's named Artie
what his activities there we go
I want to preload all my activities
interesting let's see now what will
happen in case I call this method and I
would do something like this out and
then I will call my subject repository
find find fetch something for one else
but now folks to make this really more
interesting I want first the persister
subject for there to be a subject in the
database already ma dot persist of a new
subject with a name let's say why not
P oh oh right and then we persisted here
and we see what happens it is very very
interested it will lead you to a best
practice that you can now where is Maya
this is just before after returning
right and where is after after returning
after where are you
after returning where are you what after
a system out after telling but where is
the did not compile or something let me
print something before see what happens
John what do you what do you expect to
find really where are you
watch the search for the message is not
here why why why why why am I in the
right method yes
then why don't I see this man these
messages turning
let's see what happens first of all if
you do you guys know the difference
between inner join and outer join
what is the difference yeah but can you
tell me why does this map doesn't work
for me hmm is this a decent
implementation where are you okay very
good and our servers error log there you
go and then somehow where is the rest
after x6 there is nothing printed why
why is that imprinted here interesting
there might be an exception summer
there's the only reasonable idea right
so what how can I see that how can I see
that exception because why ah
shawarma no shawarma let's see that EDR
instructors I deserve to go now to
shower my relative to make him all a
shower man
right I mean this is really what should
happen the next so a big argument
parameter with that position one oops
oops I forgot I forgot folks so I want
to get one specific subject folks one
specific subject where else not ID
equals the first parameter who so string
that ability the first parameter which
is this and put it here
how convenient isn't it let's see now
what happens yes thank you and it's null
of course why because folks I got the
subject with ID 1 and let me show you
something in the database right now what
is the trees database database subject
subject subject subject yes what there
is a row with ID 1 why don't I see the
row why don't I see the road
no need madam it wasn't the first
infection I purchased the first one why
I've knowed the subject French teaching
activity and I don't see the subject
exactly I have no activities and guess
what in case I don't specify the outer
world by default is the inner the bad
one so the point is in case for a
subject you don't find there is any
activities guess what your subject is
the gun also so to make it work
what should I do where so the idiom is
always left outer join or left join
fetch all revalued always make ready
because really if you want to pre search
the children but because of that you're
always left Jeff fetch all right so you
always want the parents with children
even if the rear there are no children
from the parent but this time is
returned the subject yes it has an empty
list of children you see there is one
more thing you could ask me left join
fetch left journey fetch did I showed
you lazy load I showed you right I
showed you
so now my assumption is if I now iterate
over the activities of this subject I
expect no query will happen true let's
test that I mean dance what I give you
what I give you the instructions and the
virtual machine I want you to practice
afterwards to rehearse right ok then
what I mean is that this one I need to
make it a subject and I want to get
subject subject dot get activities by
the way if I do just that what will
happen what will happen by default when
you when you concatenate something to
exchange between walk the string and to
string on the list will get each element
printed you see just
is also a method and you it will also
trigger a lazy load in case those were
not there but guess what they were there
so there is no query between these two
lines
here the point there is no query to get
my children because so this is how we
want to avoid guys this is also the most
frequent cause of bad performance in GPA
because this isn't some this is the
famous N+ 1 query if you know the set of
parents that have children and then
iterate 4 on the children of each parent
you can imagine for each parent will be
equip one more query for each parent
right so for those use cases in which
you want to get parents with children
always always do left Jennifer now how
these fields let me see if I can get the
time together how these fields is that
you will see 1,000 queries for children
the identical query in the log and this
could give you a hint that you are doing
something wrong
yet seeing the same query 1000 times
good good let's see what else so spring
that a stream data yes I need to tell
you one more thing there are also other
kinds of queries that you can build in
your application besides just getting by
some fields or doing queries in a
dedicated gpq there are also the dreaded
dynamic queries that you build by this
plastic quality shot what I mean the the
queries that map to to search forms in
the user interface so for example this
is how I do all my my dynamic query it
begins with 1 equals 1 we all know it is
classical it's already mythical the 1
equals 1 after which we begin and we say
even even the criteria the sucker and
the client gave me the subject and this
one a the subject name like upper of 2
point subject
would that be it can imagine it's a
named parameter but I specified just
after and there you go for each criteria
in intern I have was dedicated if that
in case the user specified that search
criteria
I want to concatenate to the credit Iran
also this little bit of Roger did you
understand what I mean here who
understood rather have good so the point
is this can't possibly be made using an
annotation because the actual GPG well
your run is dynamic and because it's
dynamic we love to put spaces do you see
the bug if you can cotton it too deep
equal to something which yeah yeah good
good stuff we love it yeah okay so
that's this these handles matters you
can't possibly make the annotation
that's why there you go the most creepy
stuff you can ever see with Opie let me
get to them so we know budget be signed
by EMP good we saw then find by active
to this will work fine by me it will
generate the correct query based on fine
fine but my first bite ultimate find by
address city it will get from the
customer navigate the object model to
get to the city with positional
parameters as they have their code but
one one to two then select from select
or this is native oh my god this is
native queries from time to time you
have to yeah to get dirty but if I try
not to for a classic try not resist the
temptation be as resist
this can also work and it's a common
practice to optimize performance you can
only get the spheres that you are
interested in because you can already
scream why the heck did it get so many
data
give me a break was that so you can
imagine that if you get your real
application you you will trust me if I
say to you that I did saw a query with
800 columns of which I am you only
needed 12 again 800 columns of which I
needed 12 strings and stuff that you
needed specifically this much you will
get back an array of objects and guess
my yacht it will be on the third
position in the second s-someone
right so this is selecting this is
called sometimes ratings colors or
projections but under stream as
parameters make sense
this will create projection object data
transfer these are not entities folks
these are not entities arbitrary objects
created just for this use good and also
what I showed always with good this is
earth query this is what I use red 24 so
can get you an optional folks good good
stuff an optional math and which which
bring data to 0 you can have an let not
know annotation that will force all the
matters to return only not move edit the
super cat versus stream yes how do you
get 1 million records from the database
out that's a good question let's hope we
get them but me
originated queries oh my god if they
give you just one page sorted by a
certain criteria this number of pages of
a page of of size 20 for example this is
spring in standard stuff this is pretty
standard stuff okay maybe people don't
do that so then here you go
now squeeze the chairs it'll hurt you
can then show to your the ones you hit
this slide this is your repository we'd
find my name at query what we what I've
showed then this extends from GPA post
which is a standard from Spring then you
can also make this interface extend and
not this one in this interface means
customs monitoring you only have the
methods which you could not do with this
in particular the dynamic query search
that I showed you plastico plastico and
then you implement just sorry so the
point is it is somehow like this
interface you have partially implemented
here guys this is how it feels
let me prove it so let's look a bit in
the teacher repositories is the
insistence by control oh I see the
methods defined in this file this but if
I press ctrl o again by the way sorry
for using eclipse if I press ctrl o
again guess what I get any revision I
ever inherit and look what I can find
them there is a search activity method
which is defined in the map in the
interface named teacher repository
custom folks with very careful
teacher repository will extend entity
repository and will also extend the
teacher repository custom this custom
interface only contains those methods
that were too hard that I could not get
implemented using at Qin and then I come
and I implement
this is the interface with my real
implementation and I specify one equals
one and I love myself for that one
equals one and I say okay so this is
what happens literally you are
implementing a part of the methods of
these interface you are partially
implementing an interface this doesn't
stop here because you can place one more
interface of your own between between
like I did in production which will add
some more matters that you want or
repositories to that oppa gangam so we
have one method with the name inferred
from the very method names for which the
g4 which Springs there for the protocol
and you know yes critical stuff you have
manual you implement and you also have
methods from the sky yes
some folks spring that we use it it's a
mandatory framework for us really it's
so cool I mean feels really good you
only implement what you really need
does the name occur is like the only did
yes yes question it's in red yes thank
you
many viewers many rules so this is
indeed very important many yes it is
automatically detected Bastion it looks
for an interface named import from for
the implementation of team so it's what
it does when if he wants to see the
implementation for this he just types
instead import and it has to find a
class the second naming convention we
can mess that around but the same in
convention that you have to do
you kidding but why would you have what
you could you can you can extend
multiple interfaces another one I think
you can aim it to and have to hear but
why would you do that yeah
then the repulsion is to have you should
split a repository in two you should
have two different repositories just so
folks what what was that that was spring
data GPA after yes yes but that was a
mistake I'm sorry I never inject
Antietam hydrogen production I only use
spring data GPAs but continue don't
don't do one because if you want
directive Identity Manager factory then
you are working with not transact
identity managers these are not under
the control of spring you want me you
want to live spring you want to request
the injection of an entity manager you
want that you want to be lied why let me
show you the very very good question
thank you for that one second and
probably I did not answer your question
but let me fill out in a second
what no lie to me and then you say like
seven I am don't get class who are you
who are you who are you what do you
think it will print justice in my
training class honest I always say you
know string is you know what the process
is the simple is a lie to me it's a
process course but you can do it can
even go better and say what kind of
proxy are you who are you really
who are you
right who are you let's see what he says
it's really instructive so who are you
love my ability to manage a proxy for
local container so this is a proxy to a
persistence context bound to the current
GPA right that's it yes
again you asked me the question is it
till now or yes I bow to the major
Factory yes that's the point that's the
point
it's penguins at proxy that will
delegate to the same persistence context
spring will handle the transaction
propagation for you so basically you can
work with GPA using programmatic
transactions Java standard file don't
matter if you are in spring if you are
in spring then you want to let's print
propagate the transactions you want to
be the spring transaction manager to do
a transaction
so basically GPA will work with each
transaction only if you inject into the
managers make sense is super people
start your self start yeah don't want to
do that because the begin of the dance
all started here who will ended and the
ABS guys I will started here who will
end the transaction
yes spring will manage a transaction
there whoo so what we saw we saw we
still have to do this with with marriage
No
- we saw transaction we saw leis Lord we
saw we saw even beings we we will have
this and optimistic and pessimistic and
we only have 15 minutes
what do you prefer to hear optimistic
beef or performance paintings
who wants myself who aren't optimistic
who are performance yeah okay let's the
performance in each case we have time
we'll come back to optimistic sir but we
want GPA is low made for a purpose of GP
this is what you want - this is not a
model of all my trainees the facts folks
I don't want you to get the philosophy
of this frame Oh GPA is not built for
perform it's not its purpose its purpose
that drives is to be simple maintainable
elegant code that's the main purpose of
GPA that's why if you don't use GPA with
care it can get very very slow it can so
but also you can write very high
performance applications with GPA
there's even a book yeah
like so you have them to know first
thing you know God gives us to debugging
tools lock the system out and our brains
some used the third one debug debugging
folks after five minutes I don't even
remember what I was doing for classic
like buccinator like killing me yes when
water which is much how I should feel
that's why that's why from another story
when every have a creepy problem you
can't really understand right the
universe I spent to this is my personal
record today is to write one unit one
unit test in two days it saves me weeks
afterwards look he agrees now I did not
do what I said I don't I'm not ready it
is not done the point is I invested two
days writing one interest for the
creepiest problem you can imagine and
then if you want to experiment control
and agreement reowww reowww
it was trivial to get it work to get it
afterwards work so don't spend any
effort to write a good unit test can I
show you something from a different
presentation just a just a bit just one
second it's since we got there so very
very very very very briefly so this is
how it feels
oh come on
yes 21st century thank you and can you
play this please you can't see you can't
hear anything right never man yeah but I
wanted to just put actually another
slide it I wanted you to come man what
the heck is it this one
this is really important invest any acid
necessary to create a unit test for any
tough problem you face it will pay off I
promise
email me if it doesn't so yes yes you
have landed this can work also like this
it's it's fine
so need testing good know where were a
performance right and we said first
thing you want to do to optimize the
performance of a GP applications you
want to enable the GP a logging the
first thing we need to do then you want
you want to have brains breathe and then
also some SQL expertise some experience
good symptoms that you can experiment on
in the same query 1000 times other one
reading hundreds of useless colors of
out of which you need only 12 1.5
million rows for 100 entities that you
wanted to get from the database or big
query big ugly query or it the case in
which your user will want to browse to 1
million records browse to scroll to one
miserable really good really bad report
or yeah ok the first thing you want to
do to enable the SQL logging from
hibernate this one show commits
unfortunately but you can go with
something called
p65 which is a datasource proxy and used
it it works incredible it lost
everything simple is that it's a proxy
you put in front of the rear datasource
right
it just intercepts all the SQL that goes
there unlocks it nicely
Anana in the fire vilnius good now by
the way logging experience will make
your applications behave like crap right
all the sql's
your application will
but the point is you will see many
identical credit this happens you are
doing in the loop again with thousands
millions of queries run the data point
for each parent after you can work
around this by using eager on the
collection towards the children but
don't do that because then anytime you
get the parent it will come with the
1000 children she has just like the
Indians gypsies
a lot of children right it is a bad
practice then another thing that can
happen is that lazy know is that that
hybrid will issue separate queries even
if you have two one links after certain
version under certain circumstances
hibernate can issue separate credit to
link to load the entity that you have
even if just one entity which is creepy
stuff so you want to see because it's
not deterministic the same the even the
same original hybrid behave differently
at some point so I want the beta to make
it to be sure of that
so these are the parents for each parent
they have a list of children so if you
issued them where each at least together
the children this is the famous and plus
one queries problem they ask you at at
interviews but the solution is to
tolerate if you have a little few
credits let me see how the time if you
have few queries you can't or leave them
as they are
okay it's okay
if you just want the 21 so what but the
simplicity comes in place right
don't complicate record if you don't
really have a problem then one or the
other people have been left off edge but
if you let join Finch first if you have
joined fetch the person with the address
Lukas will happen each then all the
details of the person will be duplicated
per each address this is what happens if
you do joint really this is basic
science right but then if they are 100
columns here it will matter
so this gets you first of all with a lot
of rows because yeah and then you can
get you with me I will gonna fast
forward you won't be able to read
everything there will be many columns
there so we did there's a problem still
so if you have many many many rooms
this is actually one idea to do first
equation for the patterns and then clean
for all the children of the set of
parents with it we'll get you back to
1,000 of many many children for 1,000 of
parent IDs in in several actually this
amount of credits you will get all the
necessary data from a lot faster a lot a
lot of columns out of which you need on
your field
what you should do is actually don't get
full entities from data as Vlad says
never we're going to search or export
never load full entities but always load
scholars come and it will get you an
array of objects remember or you can
select new objects with these things
beside and it will construct new object
also if you have time in a lonely night
go here and actually Google spring data
projection read and then also you can
make a video after that complex square
but I would not recommend that
but without advantage is that you can
then map
two of you guys we can let entities to
views but don't do that don't create
views viewers are created using creative
replace view SQL don't that's the point
get rid of SQL from an application so
bring only the necessary from the
database bring less data in Java add
more we're closed don't do filtering
Java we generate is so tempting let's
load everything everything let's filter
Java why because we can folks that's not
the point you should guess from data is
only a small amount of data you can then
play with it some more with you you
learn that they're okay but the main
they turn needs to be filtered so do
more in database bring calculations
bring results not the raw data store
procedures who loves store procedures
who loves start position how do you unit
test a stored procedure so the point is
there is a balance where the process is
indeed abilities fast is the fastest of
course they have dedicated features for
them but unfortunately they require
things we don't know like pivot table
connected by bla stuff we maintainable
it want to have especially you need test
unit folks this is what we are after we
want to have unit tested clean maintain
a record beautiful elegant so you want
to breathe fire you want to filter for
bit there and reach out the data and
then to purchase it further there but
bring small amount of even not for
gigabytes of it bring small amount of it
of course the big bad slow query you
should analytics primer
you know those DB reads that are paid
with five thousand euros per per per
month
you know what they do actually they look
at you they explain plan did not and
they just look for full stops they let
all what they do they are low who is
here DBA is ready be here
the fourth car went over there after
they don't want to see four skulls so
usually usually they are the index when
they are paid with five thousand euros
per month the adidas ah you're missing
an index GPA priced then put it right
from code so yes I'm kidding
did they do lot more but this is how
they optimize current with hints okay
don't mind that oh god I'm out of time a
lot of time skrt skrt skrt primary keys
primary keys primary keys sequence are
good identity sucks identity we will
will sabotage your batch inserts
whatever that means - no recap Wow guys
I'm done really so this was just a brief
superfast lightning fast things about
GPA I did not have time to go into
optimistic at all until they kick us out
why not this is the first stategy can
use no protection what does that mean
this time of course there are two use of
each edge on each edge then this is when
the press on the edge but then they
change that so you have that motives
they changed stuff and then one of them
says he wants to change the age and the
second one wants to change the name and
they gave of course in in random order
who what is the final age what is the
final age dream thank you 3 3 so if they
accept this behavior you're the happiest
person on earth you're super cool it
you're an issuer in paradise right I
mean yeah you did not don't need to do
anything but what is optimistic lot it
means that when you get data from the
database you also get the version 7
version Sam what will happen you will
come back with version 7 what will
happen here
reject because version software is no
more but each update the version will
get incremented in the database so from
seven it will get to eight and if you
dare to come with the virtual server it
will throw an exception saying bad luck
someone was faster than you please do
try and this can get frustrating because
you can need you need to redo your
changes this is ugly right and the
pessimistic locking is the one in which
you block this other user to open saying
that I'm sorry somebody else is editing
the the the record of course and it
looks like this is editing the record so
you can't edit it sorry
he just bank went back home so please do
try tomorrow so you don't open them out
a lot entity so you want them to it to
expire those locks
you can't possibly hold the lock for two
weeks right you want to do Auto
exploration and stuff and they will kick
me because I am out of time sorry folks
that's all for today thank you all for a
patient</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>