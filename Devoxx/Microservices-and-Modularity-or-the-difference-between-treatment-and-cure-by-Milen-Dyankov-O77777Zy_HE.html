<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Microservices and Modularity or the difference between treatment and cure! by Milen Dyankov | Coder Coacher - Coaching Coders</title><meta content="Microservices and Modularity or the difference between treatment and cure! by Milen Dyankov - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Microservices and Modularity or the difference between treatment and cure! by Milen Dyankov</b></h2><h5 class="post__date">2015-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/O77777Zy_HE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome everyone hope you have
a good conference so far i'm going to
talk about micro services and mon Dieu
rj my name is mean and yank off and i
work for a company life called life ray
and that's my twitter i know if you want
to tell me something about the top feel
free to it so the two key words in this
talk microservices and modularity i'm
quite curious what is the witch one made
you voting for microservices hands
up all right modularity all right so you
both wrong it's it's not the
microservices you think about it's not
the modularity you think about but let's
try to go through that okay how many
people in this room are familiar with an
operating system called linens for what
great so you're probably familiar with
this command can you tell me what it
does or you don't have to tell me what
do you know I'll tell you what it does
it displays the process ID of any
process called Java and it's very simple
going to explain right if you think
about it or wait is it what it has to do
is it actually has to go to some place
where all those process is stored figure
out what their pits are filtered through
the ones that have the name of Java and
displays the results to you essentially
it's doing something like this now in
fact if you run this you're going to get
pretty much similar result I didn't
bother to it shouldn't make it to
display on the same line but as you can
see a result is pretty much the same so
the question is how do those things
differ this is how you should be never
using this one anymore everyone is
telling you to use microservices so
that's what should be doing from now on
every time you type on your linux car
so remember that anyway let's talk about
microservices a little bit more serious
what are micro services are you know
what our microservices no one knows I
don't know either but I found this thing
it's a very interesting article by a
very famous people James Lewis Martin
Fowler they did a word to actually
describe what are the chair acoustics of
microservices and essentially what these
guys would tell you is everyone who does
microservices is doing these things
that's pretty interesting though because
when you look into it you see that half
of those bullet points I'm not strictly
strictly related to building
applications to software development
there are more about operations or were
deployments more about teamwork more
about company structure and culture not
so much about the actual process actual
application building thing but then II
ways made starting well why is everyone
you know talking about microservices why
should I consider them and every time I
ask this question like why you consider
using micro services I hear this tank it
reduces the complexity of my application
and of course depends who you ask people
have different idea of what complexity
is so complexity in this particular case
means just about anything but there is a
common belief that when you start doing
microservices all of a sudden the
complexity is gone and you're dealing
with much simpler things so here is the
card works you have your microservices
thing whatever that is then you need to
run them somehow so you probably use one
of those you java developers so you're
probably going to jump for spring booth
as i know java developers but anyway it
picks something to run your micro
services with then you probably put them
in some kind of container because that's
what everyone else is doing these days
eventually in a virtualized environment
oh by the way that's easy to do because
we have all the clouds now right
so just click about on get your
instances that nice and easy but then
you realize all these guys need to
actually talk to each other they need to
sing they need to do some weird things
so they're a bunch of other things
coming to into the picture and then you
also realize that you need to do some
weird things like lot aggregation like
configuration and bunch of other things
around and once you've done with all
this here you go you've just reduced the
complexity of your application now back
to the same article there is a very nice
quote that I wanted to show you which
sexy essentially says if you do this you
what you're doing is you're shifting
complexity from one place to another
from you inside your components to the
links in between those components and
what's worse you're shifting it into the
place which is much harder to control
now how many of you as a Java developers
are very familiar with low-level
networking and how all this works and I
like IP table rules and all these things
you feel comfortable with that oh I see
our three people so guess what you will
eventually have to deal with that but if
that's the case if I'm trying to scare
you and if you are reading me by now
that I'm saying don't use microservices
then you may ask by the way what's so
cool about them then because a lot of
people are talking about them so I did a
little research and this is what I found
and I fear that a lot kind of like
explanation so it take a second to read
those statements and raise your hand if
you think that is what describes
microservices kind of like oh I'm going
to say best but good agree with that who
does agree oh not so many who don't who
don't agree at all okay no one okay so
we have few people that said it it's
okay whew that no one says that it's
that it's wrong and everyone is like
it's kind of like this right okay um
that's what
the quotes are about those description
had been used back in 99 2002 to
describe pgb now those of you familiar
with the gp2 they know how the whole
story ended up but what you may not be
familiar with is an article by Gartner
which you cannot find on the internet
anymore and let's use the wayback
machine which tells you that back at
that time companies spent over a billion
dollars on software they didn't need and
they did that because some software
vendors convince them that that is the
right approach to build software at the
time now i'm thinking building
microservices containers many machines
cloud providers nevermind okay but going
back to the microservices thing many
question you may want to ask yourself is
who is doing it like okay and and if
you've asked your quickly yourself this
question before you found a lot of
people a lot of articles or the blogpost
did all describe how how successful they
are with microservices and that's indeed
true those companies are successful
they're doing my crew services
architecture and they blog about it a
lot they tell you how great it is now
the question that I asked myself and
kind of asked you to ask yourself is
what these companies have in common and
typically people will answer well they
are all huge companies yeah that's true
but it's not really what you interested
in which the real answer is they build
micro services for their own needs they
don't sell software they don't sell
their the product of their development
to anyone else they build stuff for
themselves right now why is that
important is because they can make a
strategic decisions about how they
operate no one is telling them what to
do they decide well we're going to have
a dev ops team
we're going to train these people or
hire these people because they have the
right attitude or we're going to
automate or not going to automate or
we're going to be decentralized it's a
decision that they can afford to make
now imagine yourself on the other side
you are a software vendor a service
integrator someone who is dealing with
customers and you go to that customer
intial I'm listen we have this great
software for you well except you need to
change your organizational structure
need to fire those guys and hire those
guys and you beam need to be more
decentralized and you need to do your
deployments in that particular way that
may may not work okay you don't do
things like this to your customers at
least not in a direct way and another
thing to consider is just because there
is a bunch of successful people out
there that have gone through the whole
pain of doing these things and are
successful with it does not necessarily
mean that it's going to be the same
thing for you right so compared like
skill levels so the most important
question is should you do micro services
and I think I kind of answer that
already for me you should ask yourself
do you fit in that picture if you like
this if you're building stuff for
yourself you can afford to all do all
these things then maybe and maybe that
is the solution for you then maybe
that's something that you should look
into it even though it's not the only
option you can still consider being
doing something else and I'll go into
that in a second because even those guys
will tell you that what you should do is
you should not start with micro services
the reason is it gets complicated for
right away when you start doing
complicated stuff what you should do is
you should start with a so-called
monolith and keep it modular keep it
modular for as long as you can now if
you have a modular application that and
the time comes that you realize that
microservices is this thing for you it's
very easy to go microservices right the
reason is microservices implies
distributed
and if you want to go into any kind of
distributed computing you add a whole
lot of different complex than a
different knowledge that you may not
even be aware of right now so
distributed systems are hard trust me
but if you accept this so far it may ask
yourself now question well what's my
option then what else well let me start
by telling you my career services is not
going to cure your complexity and in
fact nothing will and let's get clear on
that point let's stop believing and
pretending that just because we can
split things into small bits and pieces
all of a sudden all the complexity is
going to go away it won the reason is
complexity typically comes from your
domain model what you operate on now
obviously you can design software in the
wrong way and make it a lot more complex
than it should be but it's a whole
different story but in general
complexity comes from what you operate
like you imagine you're doing a banking
application or a telecom application
whatever that application is I mean bank
transfers you know transferring money
from one place to another it's not going
to get any less complex than it is no
matter what you do with your application
you still going to have all these cases
to cover in one way or another this is
typically what introduce complexity and
so if you cannot make the complex to go
away you cannot cure the only thing that
you're left with is to deal with it
right so once you start thinking in
terms of I'm not going to get rid of the
complexity but instead I accept the fact
things are complex and they will change
and it will be issues and I'm ready to
deal with it then we kind of start
talking about treatment so we know we
have the condition when that's not going
to go away we're just looking for a way
to deal with it right and so the answer
if you ask me for that is to design a
clean modular architecture that is
capable of handling all those weird
cases that can happen now that may or
may not be microservices it doesn't
matter it should not think of the
architecture in terms of deploy
and a day one all you need is modular
thing that is capable of handling all
kinds of different things and how you
deploy it is a different thing and that
is what brings me to your uncle's bump
saying that there is no such thing as
microservices architecture microservices
is a deployment option and I totally
agree with it's like three hundred
percent because that's what you should
do once you design your application
right then you can deploy those micro
services or you can deploy it as a
standalone modalert or in any way you
wish that is an option that you should
keep open for as long as you can it
definitely should not be the number one
decision you make when you start your
new project and that is the moment every
time I say it is that is the moment when
people say well yeah but in my case it's
so complicated my you know it just
simply won't work and that is why I
decided to do a demo during this talk
and show you what I did I don't know if
you're going to like it how many of you
are familiar with an application by the
way everything is that i'm going to show
you from now on is on github that's the
URL it can download it play with it i'm
going to go through that relatively
quick and not going to explain it every
line of code i'm just going to kill you
roughly what i am doing so it's going to
be a lot of code passing by on the
screen brother quick but feel free to
play with it later on and obviously tell
me if if you think something's wrong
there so are you familiar with a
application hold Dukes forest how many
of you are familiar with that
application none Wow guess what that's a
kind of demo thing for java ee right if
you learn java ee that's how you should
be learning it right that's what oracle
gives you to learn java ee from it looks
like this more or less you have some
products
you have some orders we don't have any
you can login as administrator a bunch
of administration options nothing really
spectacular but yeah it works so this is
how they show you what the application
is structure you can see like bunch of
VG bees jss beans and stuff like that
another architecture is here how things
connect to each other now ok this is
running glass fit on one glass fish and
it's fine now imagine that your
production application that's running
just fine and I'm building another one I
come to you as like well this and I am
building a very similar thing but I oh I
need is the product catalog I see you
guys have a nice product cuddle I can
just grab this product catalog think and
use it in my application and obviously
should go ahead do it no problem so now
I start looking where the product cutter
what is so that i can get it because
obviously busy developers i have the
time to tell me now from that diagram
doesn't make it really clear ok let's
look at the source code that's here
maybe can you read but from the screen
is it too small make it bigger ok well
if you don't see it shout ok so it has a
bunch of things it has like payments
resources shipment well there is no
catalog ok what I typically do in those
cases as i wrote a tool called JD pant &amp;amp;
g-deep and is trying to go and figure
out what's going on inside the
applications that's going to give me
some package information that's how i
can figure it to do so i'm looking at
some Java packages here and i have the
shipment shipment you two events for us
entity gb is nothing about catalog here
well that may be cool if you want to
learn programming is you know where the
EG beasts and things are but
handlers and stuff but it doesn't give
you anything business related or
functionality related so okay i did a
refactoring I mean just let's play with
it and see if we can fix it in some way
so here is what i did this script demo
is going to just grab some stuff from
get display the commits and then the
differences so therefore comments i
basically renamed all the entity classes
and then i had to obviously update the
references and all the other classes and
i extracted the generic model out of
this so if you look into what he
actually changed so this dick model
think it's a new so i just created a
model basically nothing special let me
show you a product it's just a plain
java object nothing particularly special
in it and my because they had the model
in originally but it was a already tied
to jps i don't want to use JP i mean i
may or may not I all I know is I need a
model that eventually I'm going to
persist somewhere so this is kind of
like my implementation so all this GPA
stuff here kind of implement extent my
my domain model and that's essentially
the whole thing that I'm changing here
the rest is just reflecting those
changes so the next thing I do is I
create three modules for use cases and
those are use cases catalog these cases
ecommerce and use cases identity so if
you look into this i'm just going to
look into the catalog one so basically i
have think I mean I probably is the bed
naming calling it manager but
essentially that's a product use case so
basically I'm saying move my product to
use case I would should be able to
create a product I should be able to get
a product up the other product whether
that's my use case right and I don't
really care how is going to be
implemented somehow by someone that but
if thats this use case it should be
capable of doing these things okay and I
also declared something that I call
product persistence which I said if
something is going to be capable of
persisting those things
it should be capable of doing this right
and I don't care if that's going to be
database if that's going to be Mongo or
file or anything else I don't care I
want to persist it okay so that's pretty
much in here the next thing is obviously
I need because I did some changes in my
domain model I obviously need to
redesign the whole thing around so the
whole dgbg air ejb layer all the facade
and all these things so I'm not going to
bother you with this good because it's
nothing in trust me you can go ahead
leather on trial it has no functional
changes whatsoever it's essentially
grabbing a piece of code from one class
and moving into another class that's all
it is right it's just three and changing
names because of the new domain model
that's basically what it does here and
finally the last thing I need to do is I
also need to update the web layer but a
little more of the egb layer the rest
services so that's cut just one more
step into things i'm just going to show
you how egb change here for example let
me find the product product somewhere
here product being for example so as you
see this is it this is what it used to
be it even had some logic in it like
search and something now my new
implementation is that long it
essentially tells this is a product use
case and this is a product persistence
and you tie these together and let me
them work and that's basically all the
changes here conceptually obviously
finally I update my Jade append to take
into account the changes reorganized
some Java packages create a few more
modules so again this is just shifting
files from one place in the operating
system to another again not nothing
really no big deal so let me build that
thing okay it's going to take a second
now you went to build is done you will
see that we're going to have a little
more modules down there like we're going
to have all these use cases thanks
and it deploys it directly to the
GlassFish so we have now some some use
cases of its few more modules let's
first make sure it works a does I still
have products I can list still cheap now
no orders but anyway so yeah we're not
going to try to another try to can use
it everything worse you can trust me it
does it's essentially no functional
changes as i said but let's now look
what happened to Jay deep in stats now
it looks like this so for those of you
who don't remember this was before this
is now and why it is important now what
I see here is I have three packages here
cut like represent use cases so that's
identity kumar's catalog then I have a
persistence capable of persisting those
and then I have those things called
wiring that are actually wiring things
together so if you look at the shipment
wiring key for example it basically
wires this persistence with the with the
identity that's all it needs so it you
can follow the arrows in E and it's
obvious what is where so now I need my
catalog thing and I know what I need to
take this guy this is my catalog I just
can grab it from there and he is it and
if I want to use jpa persistence which
is implemented somewhere here I can also
use that but I can provide my own
persistence and wire it with something
else so it's up to me how I want to do
that so now that I have this what can I
do I can do the micro service and when
people in Java world want to build a
micro service what do they use spring
but that's right
okay let's create a springboard web
microservice so again I'm not going to
teach you how to build springboard but
essentially pride the service provide
the rest interface and that said so here
is my implementation of a product
manager essentially just wiring with the
persistence nothing special my
persistence in this particular case is
very stupid in memory hashmap
persistence because I don't care that's
just a demo so I don't want to bother
with a database and now and then there
is the rest interface somewhere here
catalog and point with all the
annotations so I can provide a restful
service let's build that and once we
build it is it ready okay I'm by the way
I'm going to stop glassfish now because
I don't need it anymore and i'm going to
start something that i'm going to be
using later so we ignore that for a
second okay when that thing starts in
the meantime ok so this now you can see
we have a new catalog microservice here
so let's go there target java you're
here we go spring boot starting my
catalog service my cuddle up
microservice is up and running I also
added a front and interface to it so i
can actually test it so and that's going
to be Jason doc in this particular case
so if you do this as you can see i have
two things i have a product and category
let's deal with the product I don't have
any product so far so I submitted it's
empty but I can create a product
and just give it a price of 10 and call
it test whatever submit and then I can
list my products and here it is I just
used some rest interface to create a
product now that's out of the exact same
jar file that I get from the enterprise
app okay cool right yeah I mean come on
you like spring boot don't you okay so
what I can do next I'm going to use a
scary word osgi how many of you familiar
with osgi nice nice surprise okay say
don't that's scared after all okay what
it takes to convert those jars two
bundles if you're using maven
essentially a calif restoring nice if
you're using maven essentially need to
tell me when to build a bundle out of
your jar file which essentially means
create some more interest in the
manifest file say that's pretty much it
so what I'm going to do next is I'm
going to create two things I'm going to
create noise GI service and I'm going to
create a nice GI she'll come on now show
you what those are so it's essentially
the same thing I was doing with spring
both except it uses always GI framework
so here is my product service now I'm
saying this this is an osgi component
and it references a persistence and the
persistence as exact same thing product
storage here it's just stupid in-memory
hashmap persistence nothing nothing
really special about it now what I also
did as I created so called OS Jack
command and that's something I can use
on the shell and now in you'll see how
that is potentially I'm saying in the
scope of product i'm going to have two
commands at and list and I can call
those and do things like like another
product or list a product that's
basically everything I do here okay
since glassfish is not running anymore I
cannot do install don't ask me why
that's the way this debate work all this
island
okay a photo station goes so but as you
can see now i also have few more models
like osgi services osgi service
providers and things like that so let's
start this now I have Felix which is one
of the implementations of the osgi and
before I store it let's clean the cash
because I was obviously too easy to
anyway okay I'm starting Felix here and
it's up and running so what I have is a
nice console-like osgi typically have
and I can do things like lb which stands
for Liz bundles and it's going to tell
me what's running inside my osgi
environment and as you can see I have
the catalog management use cases the
catalog commands and and so forth ok
forgot about one thing oh yes yeah let's
do it again so I also create another one
I think in the osgi that is rest
endpoint and I think wondering what it
takes to do your wrist and stuff in n
osgi forget about the libraries those
are libraries that you need you know
like Tom card or JD or something that is
actually serving those things so all
these are just dependencies which by the
way also have in spring booth it just
you don't see them the only thing i
created is this product resource and if
you look into it its standard jax-rs
nothing special standard annotations and
it just lists products nothing in print
not nothing really rocket science here
so let's build that thing one more time
and because I wasn't ok Samara I was too
lazy to install the auto-update I need
to restore this thing once it is done
here we go so now if i list my bundles
again here you see I have a lot more
does
so I already have something that
provides a Jackson something that
provides me the what's called the jetty
and and all kinds of things and
somewhere there are my own home things
let's see how that works now not here i
am going to use another interface for
that so i have this product thing and i
can this product well but I don't have
any products and as you can say i only
have gets so i cannot add a product from
from this interface that's because i was
too lazy to implemented so what I can do
oh wait a minute I have the so called
command so let's look at into that thing
it wasn't the scope of product and it
was called ad and it accepts a name and
accepts the description and a price here
we go oh and by the way also in the
scope of product I have a command list
so I can list also my product nice okay
let's see how we do it here oh here we
go so now you have two entry points for
the exact same service it's one single
service registered in the osgi service
registry and you're accessing it from
two different perspectives one is rest
interface the other one is Walker
command now I know what you're thinking
yeah but oh s GI is so huge are you
using a container using a big thing and
you know spring boat is nice clean and
tidy okay let me do one more thing you
familiar with this too
I hope you are so this is my spring
booth somewhere here try to look
microservice jar here we go and this is
my osgi environment and here how do you
think they compared to each other let's
look at the spring booth first 700 mix
of memory currently using over 100 and
over 5000 classes loaded that's your
nice and tight is prima book now you
expect osgi is going to be a lot more
than that right oh I guess what it only
uses about 50 megs right now and it only
loads about 3500 classes and spring
bullet runs one service it doesn't do
anything else in it unless you start
another instance of spring but nothing
else will ever run there whereas you
have a noisy environment where we can
add dynamically without even you're
starting it if you're smart enough not
like me then you can add more services
in the exact same environment and remove
them any time so this is how the think
compared and if in case you were
wondering how big of a overhead is using
osgi okay let me do one more thing
create and I'll use another scary word
portlets how many of you familiar with
portlets quite some people okay so I
work for a company that historically
provides a portal so in even though we
are kind of like doing a lot of
different things these days although
people kind of think of liferay like the
portal company so let me show you how to
build a portlet now for this I'm going
to be using the latest version of OS GI
which is the for library which is not
yet released it's going to be releasing
it like the beta is out but the official
version is going to be in
soon and it's totally based on always GI
like we redesigned the whole thing to
use osgi so creating a portlet for life
ray is essentially creating an osgi
component and basically I have think
they're called cattle a portlet which I
say it's an osgi component provides some
stuff well the portlet container needs
to get some information so i need to
provide it somewhere and then I'm
referencing my service and that's pretty
much it except well before and there is
also a part from that Java class there
are three JSP pages just to handle the
display so now one thing that I want you
to pay attention is the do view methods
you're not going to understand it right
away but it would clear later on so we
have a case here we get this product
manager which is a reference to our
service and we're checking if it's now
and then if it is and we show some error
if it's not we just play something right
while we're why we are doing this now if
you think if you think about it how we
are referencing it's all clear we till
osgi that this thing is both a dynamic
and optional in in other words we're
telling the osgi environment this
service can come and go any time during
the life cycle of my application and I'm
okay with that right I will handle you
just let me know you just let me know
when the service shows up or over the
service disappear I'll handle it right
because that's what osgi is all about
its dynamism in modularity it's not just
statically wiring things but things can
come and go anytime and now it's up to
you you can tell osgi I don't want to
deal with that if that thing is not here
I'm not here as well just disable me and
don't deal with that or you can tell
well you know what I'll handle it one
way or another and that's what we're
doing here we're joining us Gareth we
know how to handle this situation okay
let's build that portlet
and my life ray is running somewhere
here let's log in first let me quickly
create a page so we can get rid of those
things here okay and the portlet by now
should be in the application hey geeks
catalog here we go let me change the
layout over the one car stuck it now my
jib catalog is obviously empty because
it's again the same in memory storage so
that doesn't have anything and much like
in Felix I can use the shell to create a
product except i started live free i
have no shell well that's not exactly
true actually because what you can do is
you can do this and you can tell that
right inside your life right portal and
get the shell and if you lose bundles
here you see we have already 200
something bundles there's the modules
that are composing this implication
thing and I can do product add test from
life ray called price one two three if I
look into here that's my product so
essentially it doesn't differ in any
particular way as far as services goes
from what plane osgi was doing I just
have a different interface to display
things and I can you know arrange them
in any way I wish okay so what you've
made thinking now is a wait a minute
this dog was supposed to be about micro
services and all the distributed think
and what you're doing is a single JVM
now I told you as soon as you think
distributed things get more complex so
you can do distributed osgi that's no
problem but you need to be aware of the
consequences now I'm going to show you
how easy it is and it's trust me it's
very easy when you do a demo right so
let's let's let's try it so the three
comments here and essentially I only
need one the reason for the other two is
when I was working on the demo i
discovered that Jackson has an issue
with dis realizing lists or any
collections that are not tight so if you
just have a collection of object it
cannot dis realize it so I had to work
around that issue so this does the
reason we have three comments here but
essentially what you have is this
product service and we added one line to
it and that line reads service exported
interfaces and the interface of my
service so essentially i'm telling osgi
by the way when you register the service
make sure it is distributed make sure
all other environments can see it and
it's going to how to magically create
some stuff around it so that it works
cross environment so let me build that
think again okay i'll stop felix clinic
ish yeah i'm not going to start it yet
ok and i'm going to do another scary
thing but let's first make sure that
everything everything works here so
because i'm going to restore it it's
going to disappear right obviously we
don't have we have a memory storage so i
can create the product again just so
that you're sure that it works right ok
so we still have the same thing like
free running displaying some products
boring let me do one thing
I go to the library folder where my
instance is running to the folder osgi
magis and i'm going to delete the jar
file how many of you are okay with
deleting jar file from a running java
application okay i don't care here we go
God now what you think is going to
happen here it's got a crash right
that's what Java do you delete a jar
file jar file crashes it does not
because we did tell osgi we are okay
with that would it tell osgi things can
come and go we'll deal with it and
that's what how we deal with it would
just display something else it's up to
us to decide how we want to deal with it
but it's gone it's fine once it shows up
it'll be back again but I don't want to
bring it back instead what I want to do
is I want to run a different environment
I think it was here okay yeah that's my
Felix so I just want to run my Felix
again okay let's see it is running let's
bundles nice let's see product list
obviously i misspelled and no products
okay product add test Felix I don't have
the so I need to type it all the time
here okay nice so I just started a
different JVM created a product year
listed at nice let me go back here oops
it's here now what happened behind the
scenes is because we told osgi that we
want this thing to be distributed the
both osgi environment created what was
needed to establish a channel in the
back end and these are talking about so
when fell it started and created a
service and registered at service in
osgi service registry that service was
immediately made available to the life
raised service registry now for any
other service in liferay consuming
catalog it it makes no difference it
still consumes a service from the from
the exact same local service registry
now all the magic happens because of a
spec that is called distributed osgi
that knows how to serialize transport
out do all the discovery and all kinds
of weird things around it but it's kind
of magic now so you sell it very easy
right just one line make things
distribute it now if that's what would
my message be if I just wanted to sell
you on osgi but essentially you're
hitting here are distributed programming
distributed computing and as I tell you
earlier that becomes complex as long as
it works it's all fine I'm all fine with
a magic now if that thing breaks for
whatever reason we should good luck
figuring out you need to really
understand osgi then you need to really
understand distributed osgi you need to
understand networking you need to
understand a whole bunch of things and
guess what same thing applies for
microservices same thing applies for any
other distributed technology out there
there is no free lunch you will have to
learn those things the first time things
break no matter how cool they look in a
demo okay so let's recap that's what we
did we have the GlassFish app which
kinda head modules but as we saw those
were not so useful and we changed it
into something like this so we have a
domain model we have use cases around it
and then some services around it and
event
an infrastructure thing so in the first
case scenario which was replicating the
original application what we used was
the domain model and all the use cases
we had wiring in d gb controllers jpa
persistence jsf for displaying things
and it all was running in glassfish
right so then we decided that we're
going to use a micro service using
spring but that's all fine we use min
memory persistence the exact same domain
model and the exact same catalog use
case so think about it these two guys we
never had to change them those are the
exact same jar files from the previous
app we didn't change anything in those
two files now then we did another thing
we just used another in-memory
persistence we registered our services
with osgi instead of spring booth and
used to enjoy run time to run the thing
okay and finally we did the exact same
thing except we use a portal to actually
display things these two guys were just
seeing all that time no one touch them
cool right okay now this is the bet the
sad part of the of the talk because this
is the part where i wish i was able to
tell you that i'm so smart and i
invented this but that's obviously not
the case this thing it's called cooling
architecture it's been around for quite
some time and if you bother to search
around you will find a lot of patterns
either that one from Uncle Bob or some
very similar ones and and this is
essentially telling you how you should
structure your application and does not
tell you anything about microservices it
does not tell you anything about the GPS
it does not tell you anything about any
particular technology it tells you think
how you build your application how your
architecture looks like what you're
limiting yourself to what you're
exposing yourself to this is what you
should care about not the next cool
thing that someone advertises at some
place
so why module art and micro services in
this dog because i think we are making
we as a java developers in general we
are making this mistake of jumping into
whatever you know people think it's the
coolest thing of the day and kind of
start forgetting about you know good
design all right oh this framework is
going to solve our problems no we want
so modularity and modularity in in many
different flavors it's a very very
important concept that you need to
understand and use as much as possible
and even and don't think of it and like
all java 9 is going to have jig says
modularity is all set it's not jigsaw
does not understand versions jigsaw is
far from being dynamic there is nothing
dynamic injixo right so it's not going
to be the magic pill that's going to
make your applications modular it's it
is an improvement it's a nice
improvement but it's far from being even
close to what osgi can do you're only
bad for real modularity in Java these
days is actually osgi now whether you
want to do that or not what do you need
to do that I don't know that's a
different story and I'm not telling yeah
well you have to do is GI now you can do
clean design with pretty much any
technology it doesn't have to be always
yeah if you target modularity though
that's probably the best bet that you
have today and you don't have to do
microservices you can also do modularity
with microservices if you want to but
there is really no reason why you should
restrict yourself to that particular
approach on day one it may turn out to
be the case that it's okay it's totally
fun it's the best thing for you one day
but it's no reason for you to restrict
yourself on day one so that's
essentially what i was trying to tell
you now about the osgi I got this
comment that people saying that well you
know nice but you know killing the osgi
is like the only solution
it's kind of too much so let me make it
clear again this talk is not to sell you
on osgi or on any other particular
technology it's about to make you think
so once you look into the application
and say this is what I care about I care
about modularity and I care about
dynamism I'm I care about this and I
care about that then the solution what
you want to use going to be obvious it
may be microservices maybe osj maybe
something else but then you know why
it's not because someone told you it's
very cool right so we looked in
different things when we were
redesigning liferay and we choose to use
osgi it was the best fit for us because
wouldn't for the reasons I mentioned
earlier we don't want to go to customers
and tell them how they should operate
right so for us osgi trying to be the
solution that we were looking for and
for all these other guys as well and
there many more which I didn't list here
and why because if you look into the
characteristics that i mentioned earlier
and just concentrate on those that are
strictly delayed related to software
building software you can do those
things with us GI there is a components
and services in osgi there is a smart
point in endpoint and dumb pipes that's
essentially what the osgi service
registry is it's totally decentralized
and it's designed for failure which I
kind of demonstrate your life so all
these things that people that make
people choose microservices you can
actually do with osgi and guess what you
can do it in a single JVM in a single
laptop which is perfect for testing it
can just delete a jar file and see
what's going to happen if service goes
away is your application capable of
surviving that but if you do go
distribute it you need to have all the
infrastructure and our simulated network
failures and all kinds of things here
you don't it's it's very easy so if you
don't know liferay you may think that's
kind of small thing
can do it but now for a large project it
probably won't work well it has over 5
million lines of code it's relatively
big project it's being used by fortune
500 companies so it's not a toy and
we've been working on this for quite
some time going to have over 80 apps and
over 300 modules now the version that i
was using for the demo is a little bit
old so essentially that's from me for
today i hope you learned something or at
least i give you some ideas to think
about so thank you and i think we still
have like 8 minutes for questions so i
don't know if we have a mic or okay yeah
there's a nice so if you have any
questions I'll try to answer them just
three the hell yeah here is one okay is
it working yeah could you please explain
a bit why your service went away when
you deleted jar file the classes were
loaded they were in plus loaded cast you
just refreshed page so no new classes
were loaded again so why it happened so
because okay okay so in an osgi when you
have a bundle and it's resolved for each
bundle you have each bundle has its own
class loader and essentially when you
when you remove a bundle one way or
another deleting a Jaffa is just one way
of doing that it essentially dislike
removes the whole class loader
everything loaded from that class loader
is gone right and then there is the
whole event and mechanism that tells
other bundles that something has changed
and they have the chance to react
accordingly thank you and then what
about our July survival capabilities in
distributed Walt
well in terms of age I fellows on
platform level I mean what will happen
if a Jew I fail well to Java stairs
check down for instance I'm sorry if
what if one of us joy notes you are
running will fail down to stand up I'm
in such a way I'm itself welfare you
mean why will it survive as it notes you
mean when it is distributed yeah ok so
the distributed osgi is a spec that
defines kind of three pieces one is
discovery the other one is the actual
transport and the third one is the what
they call them the stubs or the proxies
and so essentially from a perspective of
a local service you are dealing with a
look with an under local service you
even not aware of the fact that that
service is distributed now if there is a
network issue or that other server is
down or whatever this service simply
disappears from your local service
registry so from perspective of your
application whether that is a local
service that goes away or a distributed
service that goes away its exact same
thing you are simply handling a
situation a service is going away for
whatever reason right and that reason
maybe because someone deleted a jar file
in your local environment that reason
maybe the other server is down or
something happened on the network right
from your perspective the service that
you care about is no longer available to
you so you need to make a decision what
do you want to do about it that that's
how it works five minutes if you have
more questions
okay I guess we can go grab some color
okay sure but you need to use the mark
oh I'll repeat it okay I'm sorry high
availability yeah well exact same thing
like with everything else I mean you can
have as many notes as you wish you can
have load balancers it's chava its exact
same thing that it doesn't differ from
any other java app the same way you
would do it with I don't know spring or
anything else you could do it with all
this jar it it doesn't provide you
anything in particular or doesn't
limited you in any particular way unless
I misunderstood your question right so
okay so the question is if one instance
goes down can we have another one to
take care of it absolutely and now it's
just a matter yeah you can just use load
balancing in front of it or you can just
use advanced technology to actually
monitor how many services you have
because there is also another thing to
nice jetted you have access to what's in
the registry so you can say I just 11
service I don't care how many audio it
can be hundreds of services for one
single operation and say just give me
one I don't care which one or you can
tell us gi give me all and I'll keep a
list of those services myself and decide
which one to use or you can tell osgi
give me those services that match these
criterias right so it's up to you right
how you want to do anything you can
provide all kinds of different things
around it so you can monitor how many
services you have running and say if you
go below five then spin up some new
instances you can do very complex things
but this doesn't it ain't anything
different then you could do it any
normal java essentially
alright alright no more questions so
thank you again I'll go grab some coffee</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>