<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Billions of lines of code in a single repository, SRSLY? by Guillaume Laforge | Coder Coacher - Coaching Coders</title><meta content="Billions of lines of code in a single repository, SRSLY? by Guillaume Laforge - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Billions of lines of code in a single repository, SRSLY? by Guillaume Laforge</b></h2><h5 class="post__date">2016-11-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yM0GQw1zgrA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay hello everyone welcome back I hope
you enjoyed lunch so I hope this time
and like for the keynote this morning i
hope i won't have any technical issues
with the micro you know speakers or
Wi-Fi or whatever so today we'll be
speaking about how Google handles
billions billions of lines of code in a
single repository that might seem a
little bit scary so there are some
downsides as well but there are some
advantages to this and we'll have a look
at both aspects I'm gium lafarge I'm a
developer advocate for Google cloud
platform I joined Google last June so
it's still fairly new and although I'm
not a developer working on that big huge
codebase every engineer every software
engineer goes through the we've got two
weeks of training to get to know the the
tooling that we have inside how the
processes we are following etc and it's
a it's a very nice process to onboard
google developers and software engineers
I'll it's a bit unusual but i'll start
with references because this
presentation is actually a one that is
based on another present presentation
which was given by michelle pot pot van
boven well not sure how to pronounce it
so he can watch her video she's an
engineering manager at Google and she's
working on the all the older tooling and
infrastructure that is underlying this
huge mono repository and they were two
interesting articles so there's a paper
that has been published which goes into
some more depth into the details of how
things are
working and there was also a shorter
article on wired which is a great one to
read if you just want to to read one
thing this is the one you should be
reading so i'll publish the slides on
twitter later on so if you want to find
the links again they will be available
so just look at my twitter feed and
you'll find that out so first i'm gonna
give you a little idea of scale the
scale of that big huge mono repository
so the figures are at leave the public
known figures are from 2015 so the
figures you're gonna see are not the the
very latest figures so the figures might
be bigger now but i didn't want to go
through the process of asking if i can
speak about new figures so image in even
bigger figures than this so there are
1,000,000,000 files in this single
repository in a among those files so
it's not just source files right so they
are also you know I don't know HTML or
text files or whatever but the real
source files there are 9 million source
files there are in told more than 2
billion lines of code across all the
languages that we use 35 million commits
in total since the beginning 86
terabytes of content that's pretty huge
and there are about 45,000 comets per
day okay so it's not a you know your
small side project obviously and if you
look at there's really an exponential
growth in terms of the number of
accumulated change coming up to the to
the repository and so we we have about
25,000
so I think it's a bit more now 55,000
Googlers in dozens of offices around the
world who are actually committing to
that repository also something i forgot
to mention is that the so this is all
like let's say the gmail source code is
there the the source code for the
machine learning AP is that we're using
that i demonstrated this morning there
are also there so there are a couple of
things which are not there however
that's google chrome because the
chromium project is worked on outside as
an open source project or things like
tensile flow which is done also outside
and android android because we work with
partners etc but otherwise the rest is
there in that big repository and an
engineer like me i can go and look at
the source code of gmail any time you
know so okay how is it working and I you
know if I'm cursed I am the the ability
to do that so it's pretty open which is
very very nice there are about so there
are pics in terms of usage of that
repository and the I don't know exactly
what time of the day is the peak hour
but there are up to 88 800,000 queries
per second at peak hours when people you
know hammer come eat and Luke browse the
code etc 50,000 commits by humans for
work day and I'm going to come back to
that because we also have robots were
actually committing code that's
interesting 30,000 commits yeah by the
automated systems because we've got also
tons of tools which are handling the
code base or tools which are able to do
refactorings etcetera I'll say a few
words about that later on so it's
interesting to see that only a third of
the the Comets are actual actually made
by humans and just to give some
perspective if you look at the Lena
colonel that's about 15 million lines of
code in 40,000 files the Google
repository that's all so it's a 15
million lines of code in instead 250,000
files but changed per week it's not the
whole thing that's really just per week
and two billions light of code in nine
minutes what's right but that I already
mentioned that figure so the Google
systems and workflows so you work on
your environment or let's say with a you
can also work in a web front-end 90 in
the in the cloud so using the the user
workspace to the to the repository then
you write some code new feature etc the
code is always reviewed you cannot
commit anything that is not reviewed and
then you actually commit so they are
both in terms of code review both checks
which are done just by humans okay this
one looks good to me etc or you should
refactor this or that but there are also
tons of automated checks which are done
the thing which is so we have pre post
comment checks etc but the thing which
is really interesting because behind
that repository it's not just about the
repository but it's also about all the
all the tools browsing although all the
tests infrastructure there's also the
the CIA servers that we have internally
and if ever since everybody's working on
the same codebase you could change
something if it gets reviewed somehow
that could impact other projects and if
you make a small change with doesn't
seem to be you know anything really
critical for for for you but it might
have an impact elsewhere and somehow you
can wreak havoc if commit starts
breaking something there's a chain
reaction and you could break everybody's
build throughout the company and there's
a
to roll back feature which automatically
so if it notices that all tons and tons
of tests are failing in terms of bills
are actually failing war this commit is
the culprit let's auto rollback this
stuff because I mean the guy might have
so hopefully hasn't done that but guy
might have committed something you know
friday evening of course and then he
goes into his weekend or vacations
whatever and then everybody's screwed
because of the change so there's some
mechanisms for auto rollback if we
notice that there's if the machines and
deals and so on that is that there are
breakage so the the Google sources are
well in a book Piper it was based on
perforce but it kind of out grew that
and it's actually based on the Google
infrastructure so even that's inside
Google it's also based on our cloud and
data centers etc ten data centers around
the world replicated so that we don't
lose a single line of code and we've got
a kit see I'm not sure should be really
pronounced I will always see it written
never know how to say it so this is our
the cloud-based storage which underpins
this and which also offers a kind of
local view of the final system of the of
the other sources because you never
really I mean you're not going to check
out and clone the repository right
because I don't think you've got the
terabytes of disks for that so there's a
kind of a view on top of the the overall
file system when repository and yeah
what's in earlier what's interesting is
there anybody is able to look at a
particular project source file etc so
that's pretty pretty cool when you're an
engineer in addition to that we have
other tools like critique which does cut
it for code reviews coats are so what I
want to see okay where this cut is being
used its
I can use that tools for static analysis
pre-post resubmit checks tap this is our
testing stuff that I mentioned which
does the auto rollback if too many tests
actually fail and Rosie that's a
refactorings across the whole repository
this is like you know within your eid
but it for the whole repository so if
something is used across all repository
or all the old projects it's able to do
the refactoring at that scale and so
what makes a monolithic model that's
really the fact that there's this single
repository for everything but also the
fact we work from the trunk so everybody
works on the trunk on the master so
there's just branches for releases and
sometimes we can cherry-pick some
changes but otherwise everybody is
working on the trunk so there are some
advantages so I'm going to show them
here so there's a single source of truth
so you always know which is the right
version of a file so you're not going to
think okay now this was in version X or
in this branch etc so it's always the
last file is low always there the right
one there's no you know copy this
dependency here or there or things like
that so this is quite nice to know that
you're always have this the single
source of truth basically it also helps
for things like dependencies because you
won't depend I think I've got here this
slider because you always depend on the
very last projects or dependency and you
don't have different dependencies so
perhaps it works with different cd1 but
not with d2 now you don't have this
problem with that model also the way it
works although it's a huge repertory
changes are atomic so when you do things
like the the using Rosie the big
refactorings it's done automatic
atomically across the whole code base
which is a big large scale or large
scale one it's also great for when you
want to refactor things around that's
what I mentioned already so for example
you want to add up to the new Java 8
features the new c++ even features so
you can refactor the code base and
progressively add the the new
enhancements but there are also some
downsides because to support that scale
to support those workflows there's a big
investment made in tooling so the all
the tools that i mentioned had to be
developed somehow there's a real team
behind that so it's not every company
that can do that and that's got the
budget for that and I mean having you
know you know your own tools etc might
be somehow at risk in terms of
productivity but also cut health is
super important although we've got the
auto rollback features and so on still
that's a critical to ensure that you you
don't wreck havoc into the the code base
of others the code based complexity so
it's very easy to add dependencies to
some other projects so I remember doing
a kind of simple hello world exercise
where I started to somehow transitively
depend on the self-driving car codebase
I don't know how it came into my coat
somehow although there was clearly
nothing related to that so yeah the code
health enhancements and the investment
is very important that's what i said
already and yeah in conclusion so this
is actually possible to do a monolithic
repository even at that scale because
Google but others I think Facebook is
doing that as well they are older
organization doing that so it scales up
two billion of files millions of comets
but you really have to invest heavily on
tooling and scalability etc so it works
but it's not that easy but it's very
very nice and interesting to think that
ok whatever I want I can look at things
like the gmail could base or whatever ok
that's it thanks a lot for your
attention and I'm overtime</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>