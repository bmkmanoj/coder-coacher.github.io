<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>And the beats go on! by David Pilato | Coder Coacher - Coaching Coders</title><meta content="And the beats go on! by David Pilato - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>And the beats go on! by David Pilato</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2NTMmxlpaV8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to this session I'm David at all
and I'm developer at elastic also
evangelist I'm working on elasticsearch
and plugins in elasticsearch a tactic we
are building this stack where you have
ingest layer so basically it here where
you can extract data from a source
transform the data on the fly and load
that to a system like in a6 or other
system so we've lost - you have also
bits we are going to talk about bits now
elasticsearch is index and join where
you can so use you some data to elastic
sausages and document elastic sauce will
store the data in text the data and give
you some nice HBA some nice api's which
will help you to search for your data
and also analyze your data in real time
and we have Kiba now which is an user
interface on top of elastic search which
helps you to understand what your data
set look like we are providing also a
set of commercial plugins about security
if you want to add security on top of
your stack reacting system monitoring
system reporting right you can generate
PDF documents every day for example or
after an alert also a grey graph API
which asks you to connect documents all
together and the most important document
not all the documents and we are
providing all that on elastic as a
service which which is elastic cloud
where you can deploy all that thing
really easily and we are building the
dos day elastic cloud enterprise which
will help you to deploy all that stack
also within your company on you on
premise or on your AWS credit if you
have some or a zero Google compute and
join whatever so let's talk about bits
it's water beads so beats lightweight
jeepers that correct all kind of
operational data to elasticsearch so
important terms they're lightweight
shippers what does it mean it means that
you install those bits as agent on your
servers they are written in garland so
you don't have any runtime dependencies
and they are really lightweight when
they collect transport data to
elasticsearch what kind of data you can
have for example you can have data which
is coming from the wire you can have
system statistics coming from your
system or you can have logs as well for
example if we look at where your data we
have one of the bits we have is name
packet bit so it basically asks you to
sniff the network the network traffic
between your client and your server you
basically install the agent on your
server and one without needing to modify
your application you can yeah like using
wireshark and you can index any protocol
that packet bits is aware of how does it
work
so it captured a network traffic it
decodes the network traffic then it can
help to correlate the response with the
request so you can have you can build
response time really easily and when it
creates JSON document which contains all
that information all that information
and send that whereas 600 packet bit
walks with many decals such as HTTP my
sequel you have the full list your
Postgres and so on and we are adding a
lot of over declares already the
community also is adding a lot of them
and you can add yourself a taqueria
metric bits it's like running the top
common on your system so every 10 second
you have a top common range
and you are correcting the response from
this top command and some that twisted
search you can get access for to some
system information like the load the CPU
usage and so on you can ever view per
process so what is the name of the
process it states the command line the
usage in terms of CPU and memory also
about the disk usage so what are the
disk or a variable here and what is used
what is the free space and so on five
bit helps you to basically tell a file
log file and index the content whereas
itself one of the cool thing will file
bit is that it's communicate with log
stash for example we using this back
pressure sensitive protocol which means
that anytime log stash cannot really
deal with all the contents five is
descending to a log stash log stash is
telling to five bit okay please slow
down a bit because I can't manage to did
all that thing and fighting with load on
it super easy to implement because we
have log lines and we can use this file
as a message queue system we just have
to point to the line we are currently
and just keep the over message coming in
in this fire and then when log stash is
available again go to the next lines
that's pretty amazing
we find bit you can surpass your logs
with log stash when when we have log
stash you can send you allowed to a
archiving system for example if you want
to archive on s3 just send that to s3
with s3 log stash output and you can
also send them to elasticsearch which is
going to index to drugs
I did not mention but in Lux - you can
do some transformation for example you
can say I want to use regular expression
to analyze my line of load so my string
and try to create a structured document
from that for example issue ever
occurred I want it to be error code in
my season document so you are going to
use what we call hog filter for that
which is a library of regular
expressions when you can say oh I have a
date with the date within this document
as a specific format so I'm going to use
a date filter in lock - and when you
have IP address and you want to
understand where on the planet the
attack is coming from so you are going
to use a geoip
filter in locks - and logstash with this
Joey filter we extract from the IP
address and will give you back the
coordinates of the corresponding to the
a to treat to this IP address or
latitude and longitude points with
elastic so try that oh you can do that
even more easily if you have a simple
use case like I just want to tell a file
and understand what I have in this lock
file you can use what we call ingest in
elasticsearch v dot o and the filter i
just mentioned as part of locks - you
can find some of them inside what we
call as ingest not processes so the grog
jyp date and some of them you can find
find them inside a social basically you
just stream your line of logs to elastic
search elastic search will do the
enrichment and then index the document
that's it so you won't have to monitor
lock stash anymore
we have also win lock bit so we know bit
is like the equivalent of the file bit
we have seen before
it works even with Windows XP so really
old versions
and then you can again send your data to
elastic search using ingest or to log
stash to pass the log themselves let's
have an overview of the platform so
anytime you are writing a bit you are
using what we call a little bit I'm
going to explain in the detail watch
where we've little bit so any bit will
help you to some data to elastic search
or and then use something you can
visualize within cabana and then you can
send also your data to log stash and
which some twisted search and explore
with Lebanon bits that elastic is
building and community bits are all
based on this little bit library so what
we have inside we have inside Lib it we
have a config management part so it
means that anytime you want to add a bit
configuration so this is coming for free
the beginning filtering for example
maybe some lines you don't want to send
some lines with a sixer for example I
don't want to send all the true occurred
to elastic search it doesn't make sense
I just want to some arrows for a sick
search so you can filter lines this is
coming as part of Lib it come on line
and mean the logging to files is log and
so on outputs so you can output to
elasticsearch log stash obviously but
now you can also output to ready some
Casca if you want so this is coming
natively then you build your bit on top
of that and you have also a test part I
didn't test the test part but probably
easy to use we are also providing what
we call a bit speaker thank you
because bits are binaries you have to
provide the binary for each platform you
are targeting so for Debian Ubuntu
Windows and so on so this bits Packer
repository will ask you to create
without using docker will ask you to
create all the binaries unit this is the
best okay why it is music or because of
the name of the token and also because I
call I coded sorry a bit myself just to
play with litte bit to see what is it
actually
and the name of this bit of this bit is
soon bit and the goal of this bit is to
analyze mp3 music and try to display
that in Cabana so I want to show you all
that let's do that so I need to share my
screen first of course I already started
locally on my laptop and elasticsearch
in stands
okay so I have elasticsearch here it's
containing me because I don't have any
enough free space but that's all but I
missed you
and I started also packet bit so it's
super easy to stop packet bit okay so do
packet bit done I also started metric
bit easy right I started cabana locally
you know I also started an application
that I wrote this application I will use
this application to some data to a
sequel database and try to monitor what
is happening and then we will see some
bit so what do I have
very look at like a bit for example for
now so I'm I'm in cabana yo I'm looking
looking at the overview okay I should
just go refresh that okay so I have no
traffic for now I told you that I have
an application here running so basically
it's trying to search in a database here
I have nothing in the database but I'm
sending some such requests so I'm eating
my web application this web application
is sending requests to the secure server
if we look at packet bit now okay we
have seen that we have some transaction
so database transactional and web
transaction is what we have not really
interesting for now let's inject some
data I'm going to inject 10,000 people
so people generally quantumly if we look
at back add bit now probably yes we can
see more things opinion so as you can
see I didn't change my application I
just have to monitor what is happening
on the on the on the network card that's
all and I can look okay okay I can look
closer for example I want to see what is
happening on the way transaction part so
this is another of you if I look at the
web production part I can see that I
have some API equals yeah so get API one
in its tattoos and get API underscore
search yeah no arrows that that's fine I
can generate some arrows for example
let's call you a higher which does not
exist okay I just need to refresh that
so now I can see that I have some a
walls yeah okay let's do some new
pointer exceptions so I have a specific
endpoint in my application when I can
generate new pointer exception don't do
that in production but this is okay so I
am generating 500 arrows and if we look
at packet bit now okay I can see that I
have those arrows if I want to filter
this is a typical key banishing you can
click here and say I want to see all the
over 500 cards and this is the URL where
I have those arrows and so on CPIC if we
look at my sequel I'm using my sequel
database here
okay we can see some result let's zoom
in you know so I have a given number of
set select committee update insert and
so on
the response time what is interesting
here is that I can see directly what are
the slow West my sequel query that I
have seen during this time so that's
that super easy okay let's have a look
at metric bit so metric bit is running
me on my laptop so I have this overall
view I was already if I look at the load
CPU I can see that okay the CPU
increased a bit during that time
probably I was doing the inch injection
and that diode and if we look at the
processes we can probably see you know
something interesting oops
too much let's go back
a bit less yes okay so we can see some
spikes here so probably what is that CPU
usage per process
so yeah the Java part is the most
important that was my application
running and what I was expecting my
sequel but it's okay it's after okay
let's have a loot it let's have a look
at some bit now so I would a new bit
called some bits to do that I use what
we call cookie butter cookie butter is
asking you to create a bit using a
template so basically you use you write
cookie cutter and the repo name you want
to configure and then it will ask you
some questions such as what is your nail
your name what is the name of your bit
and so on and it will create all the
skeleton for you and then you will just
have to edit all that stuff I'm not
going to edit all that stuff live
because I did not have enough time to do
it but I'm going to explain what I did
to code some bit basically so one of the
first the file I edited was the
confluent file it was coming on me with
the duration by default I just added the
name so I want to analyze the mp3 file
so here I'm providing the name of the
mp3 file I can define some default
values all right I've also this bit the
channel 5 which is a sample so it will
be the default sample file that will be
provided as as as the configuration file
for my bit so this part of the file
you know I added the name part for
example this part of the file will be
mailed with the all the settings you
need to communicate with elastic search
for example and this will create a
bigger ml file which is the actual final
configuration file
so it will create that so your part and
then it will add all the thing you need
to communicate here with elasticsearch
or to communicate with Locke - okay so
just edit this one and you will get back
this one then the code itself now so
what I added here in that code I added
those two lines due to those who imports
I need to do some math and I'm using
here also a library named Sox so Sox is
a library running on my laptop it asks
you to analyze some files and go Sox is
a wrapper on top of that I didn't change
anything here I just on you know the new
function so the new function is called
when you initialize the bit for the
first time so you get back the config
and Here I am just checking that I have
a name set otherwise I'm giving an
exception I'm initializing the Sox
library I mentioned before that's all
the important part is the run part okay
so the run part is called just after all
you have initialized your bit and
everything is set up so it comes by
default with your clients so this client
is able to connect to whatever
destination so it can be your elastic
surf logstash
readies kefka which sucks
I'm opening the mp3 file and here I'm
doing some math basically so what I'm
doing here
I'm trying to compute the duration and I
will son an event where astok search
from now to the aptitude the duration of
the mp3 file so for if I have five
minutes of mp3 file and from now I will
generate a bit depending of the rate you
you choose so I think I choose yeah for
every 10 minutes gone I want to send
something to arrested search
so we have some computation which sucks
I'm getting back a buffer and this
buffer basically will contain I can say
that a value for the left channel for
those that the amplitude new value level
the level of the left part of this of
the signal and the right part of the
signal so I'm iterating over this buffer
which contains all the samples and then
I'm saying okay from now you are just
going to move 10 milliseconds later than
on the other iteration 10 millisecond
later and so on then I just need to get
back this sample and I have I have to
use this module to get the right part or
the left part of the signal so here I'm
just building internal stuff based stuff
basically and the important part is that
one year this is where I'm building my
JSON document that I want to send to
elasticsearch so in this document I will
find the timestamp which is my new value
so now now Preston misko know plus 20
and so on the name of the mp3 file and
then the value for the signal I will get
I am multiplying by 100 year but not
monetary is what I'm doing you and once
my event is ready I'm going to publish
that event to elasticsearch lakhs -
Kafka radius whatever so you just have
to implement that basically create a
client client do your stuff create an
event publish the event okay
in packet bit this won't stop until you
press control ctrl C right but yeah I'm
just kidding after the loop and say okay
I'm finished and I'm done and you have a
stop method well you can close whatever
you want if you just have to compile
that it will give you and provide sorry
binary so you know if I look at the
binary is this one okay and you just
have to launch it this is my binary okay
done if we look at Kiba no no let's do
normal things in cuba now if i go in
this cover and say i want to look at the
last 15 minutes I can see that some
samples are coming less obviously I'm
starting to index from now and I'm
indexing to the future okay but let's
yeah and we can ever look at the samples
we have generating if we look at the
JSON document you know so those are what
bits is creating we can see again our
let value right value and the type okay
what we can do next is to visualize all
that so let's do that we keep a now we
have a plug-in name time lion which is
coming now in by default with a Cuban
our version 5 which time lion you can
deal with time series what we can see
here so be you know it's only printing
what we have in the elastic search index
all indices sorry but we want to look at
only what is happening in the zoom bit
index okay we can see that we have some
documents coming
zoomy oh and let's say that I want to go
in the future
- did you okay okay that's fine and
let's make that video okay so I have the
kind of document spare bracket which is
not super interesting I can have a
better visualization if I'm using bowel
yeah okay so now I have a bow okay not
super interesting what you can do you
can call what we call aggregation
elastics just to compute some
aggregation and for in some matrix for
example so to do that you can say I want
to compute a matrix I want to have the
minimum value for my left part of the
signal so for my left field okay
I have the let value now can we have the
right let's add a new time serie and we
say okay let's I won't know we have the
right part okay if they're left or right
but they are overlapping so I'm going to
multiply this one by minus one gate we
have the inverted thing but does the the
bars are stacked or together so I need
to tell time I own don't stack the bar
okay it's looking like mp3 waveform
right and then you can save that add
that in the dashboard inside Kiba now
and do whatever you want actually you
are not going to use that in production
just for the demo and I'm Donna if you
have question I have three minute left
yeah
yeah so if we can do that to see the
difference between the minimum and the
maximum value yeah we you can do that
time we can do that you know also
instead of using min and Max oops mean
sorry I can use yo for example max max
on the right bow I'm going to stack them
and not multiply I can do that and then
I can do you know take the two series
and do a subtract so this is the
difference between the max and Ellen
anywhere two minutes
yes so this five bit under lock fire
rotation yes it does
so yeah totally yes so if you knew a log
stash for water so 5-bit is basically
the replacement tool for log stash for
water it's really more efficient than
log stash for water
okay so is bits compatible only with a
lasted version five no so--but started
with version 1 which is compacted with
elasticsearch - probably version 1 as
well of elastic search I guess so it
started a long time ago and we just try
to normalize all all the versions name
so now we have a version for the full
stack so that's the reason we call that
elastic stack version 5 now because it
comes with cuba now five or six or five
bits 5 and so on and log stash value
obviously
I'm not sure but and so there's a packet
bit chip or TLS and SSL basically III
not everyone solder so I don't want to
tell you worst case we can
index with packet bits what is the size
of the data we have seen and the
response time this is a worst case we
can do but but the content itself I am
Not sure we are done thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>