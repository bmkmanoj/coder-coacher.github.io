<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Dockerism at Atlassian: A million deaths by Nicola Paolucci | Coder Coacher - Coaching Coders</title><meta content="Dockerism at Atlassian: A million deaths by Nicola Paolucci - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Dockerism at Atlassian: A million deaths by Nicola Paolucci</b></h2><h5 class="post__date">2015-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YY78fYvihQE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now we're starting that timer is not
correct anymore hey everyone it's great
to be here again my second year at
devoxx talking about docker and this
year I thought I would you know present
a small case studies and tell you our
experiences with how we've been adopting
doctor how it has tripped in into our
organization and relay some of our
experiences somewhere learnings and the
history and that led us to just to adopt
this technology now the subtitle of the
talk is a bit scary I've wanted not to
get too worried about it I what do you
two think about so the million deaths is
nothing dramatic it's about the way we
use you know immutable infrastructure
for short lived you know conversion
conversions that running containers and
so they are FML you know binary is that
do one task one task and then they die
so can imagine million leaves autumn is
coming and puts me in a set the said and
thoughtful mood and and this will loop
forever and put you to get into this my
metaphor for so part of the ID of the
structure and architecture of things a
bit i'll be telling you about and we
have been adopting darker for a while
now even though it's quite quite a you
know young prern project it tested we as
just just a while ago and just to give
you a brief sense without going into
much much detail about what we are doing
because I get this question asked a lot
so why are you talking about docker what
does that last thing have to do with
docker where you guys involved with
docker well we've been you know adopting
it enthusiastic over many fronts one
front has been obviously you can you can
be published on the official darker
registry somewhere products so you can
do a docker pool and have one of our
servers up and running with the 00 set
up so that was one thing I did which I
won't cover in this session and the
second thing we did that we have a build
server that has first-class support for
containers and docker and so that's
that's also you know at the core of
some of the things we do so we have a
vested interest in dr. there too but
also in this session you know I'm not
going to be telling you about that the
more interesting story in the wanted
that I want to share with you is about
how we've been adopting more and more
darker insider or you know our cloud our
services infrastructure and then after a
small intro I'll tell you a little bit
how was one specific department one
specific group inside atlassian uses
docker especially specifically for our
media services for our upload and
conversions infrastructure often you get
that talks you get the conclusions at
the end but I thought to to give you
like the takeaways right at the start
and then the story i'll tell you will
make sense as i go and you will
recognize the bits and pieces that make
made docker for us you know relevant and
interesting a useful so specifically for
the infrastructure that manages uploads
and conversion of all the very different
media files we found that doctor gave us
for things that were actually five so
this one hidden there which is so one
thing that they gave us is this this
talk that probably you've heard about
the immutable infrastructure is a big
win whenever your binaries become a
commodity and then it doesn't matter
where they are deployed and which but
they are up and down on a specific node
in your cluster and you're set of
machines it's a big win it frees up a
lot of the load cognitive load for your
software software team so that for us
was was a pretty big big win and the
other thing is we use some open source
tools that are really good at doing some
sort of conversion data manipulation but
they are not they were not built to work
in a massively parallel setup so
isolating them into their own containers
their own context their own access to
the file system has been proven
fantastic for us and it has given us the
ability to you know scale those
workloads much more freely and and
without worry a byproduct of using
containers has been even though you know
the docker ecosystem is is evolving and
there's a lot
that's being worked on nowadays with
security certifying images making sure
that there's a you know origin and Trust
trust keys and you all sorts of security
initiatives of our around containers but
for us just the isolation that
containers gives you just the fact that
each service its binary runs with his
own slice of the file system and all the
access to that was an intriguing
proposition for you know some of the
work was related to customer data so
that was ready big win and and forth
doctor gives you the ability and you
know for each container for each image
running to tweak you know CPU loads
memory road for each of the tasks and
that that allows us allowed us to smoke
smooth and manage you know load
increasing load and automatic scaling of
our services infrastructure those are
four things and I'll get to those as a
tell you more the story but I'd like to
go a bit back and give you let's like a
brief brief landscape overview of how we
got to that point because I don't know
if you guys have heard or know the story
of atlassian but we started more than 13
years ago as a with our first broad
broad product to doing bug tracking and
if you track it software which you which
companies could download and install on
premises so and we've been for many
years and on-premises downloadable
software company over the years we have
expanded with to have many different
products but we've been for many years
focused on delivering the product
version and maintained for a long time
that people could install and this has
changed obviously it's a transition that
we've been going through perform for
several years now but we've been
consistently moving to more with
cloud-based organization and now all our
products are available in the cloud the
customers don't need to install anything
everything is ready then a pro gated for
them but the mindset of deploying and
then developing a standalone app and the
mindset of running a cloud cloud those
man sets are very different and we've
been working through and we're still
working through I'm quite a complex
transition also in mindset in
architecture in thinking
so I storica Lee obviously over brother
self I've always been java-based /
heavily since the beginning and over the
years we've we've been integrating
partially some some Scala for some of
the projects like JIRA Service Desk is
mostly written entirely in Scala and
some of our extensions and plugins are
also written written in Scala the front
end is it's been pretty standard as you
would imagine JavaScript and web web
standard stack but moving to a services
organization to a cloud to microservices
obviously meant that each each team has
adopted slightly different stack
slightly different languages so the
operations team has been working for
many years using Python now the media
services department that'll tell you
more in a bit has been using ojs a lot
of the our plugin framework in the cloud
is also developed and a lot of our
examples are also that we know Jas and
there's go creeping in here and there
for some some some you know performance
efficient services so we've become as
many organizations do now nowadays we
are like more than 800 engineers in R&amp;amp;D
we become a polyglot organization so at
one point there was a need but there's
always been the need but at one point we
started to standardize then we created
our own platform as a service which is a
developed in nodejs it is a layer on top
of AWS and cloud formation it's a
command-line tool similar to the ones
that you might get with other you know
professional put passes in the market
like Heroku you this we can describe it
we create a descriptor which is a llamo
file which specifies the deliverable you
want to deliver the software stack if
it's needed to be specified the type of
back-end system the type of instance
that you need the proxies then you need
to read it and once you you have this
descriptor you type you know micros
deploy and and the the application is
deployed for you this has been in
development development for 40
and has been quite successful and it
would grassroots movement that has been
adopted with enthusiasm within atlassian
just to give you an idea of how popular
this has been right now I did a brief
survey a while ago there's more than 600
microservices deployed using this system
we should by the way is only a small
part of our cloud but it's worth
mentioning and I inspected it and more
or less forty percent of these micro
services are actually deployed inside
containers as dr. containers also we
have predefined stacks for standardized
apps like if you have a Java a jar maven
maven a job to to install nodejs or or
Python those are predefined but the rest
of it forty percent of it is just
deployed inside containers this gives
you a new breed brief a brief idea about
about this this internal system we have
mmm the media services department now q
for the face yes it's turning if the
department as I said that manages any
upload of any media file like PowerPoint
presentations Word documents PDF
documents videos any sort of media that
you want to upload them on one of our of
our products like confluent conflict in
the confluence in the cloud is managed
by this department and they have adopted
this microservices architecture and they
have been deploying these services
inside the doctor and just to give you a
few numbers let's give you an idea of
scale we have in the media services
group there's a portal s10 microservices
nine of them are written in nodejs one I
think is written in go they process all
the conversions that happen on our
platform they process terabytes of data
every month and adjust a random
statistic this is where I mentioned the
million deaths so these are very focused
very narrow operational conversion
operations every time you upload an
image or a video and needs to be done
sample the thumbnail the converted
few containers are spun up generally
around five containers are spun up they
do their operation in isolation and then
they are discarded so this is why you
know past month this is data from from a
few months ago you know millions of
containers we spin up every month which
which are short-lived now why does this
architecture work for this for the cert
Media Services Department it does
because underlying all these services we
use open source tools that have been
years in some cases like tens of years
of of life fine-tuning conversions
between formats so whenever we need to
convert an image or shrink it down
thumbnail II modified we use imagemagick
when we need to you know create pdf's
views go script when we need to
understand extract test convert and
display PowerPoint presentations we use
LibreOffice and FFM mpeg-4 the Swiss
Army knife for manipulating and
modifying video videos the point is that
these tools even though they are
available you know you can access their
API is from the command line you can
invoke them as binaries they are not
made for massively parallel work so for
example the LibreOffice if you feed it
multiple conversions you will never know
it's impossible to know which of the
operations of the various steps in the
conversion process will happen first
obviously because they were meant for
you know other kinds of activity so it
was a big win to be able to isolate a
LibreOffice conversions inside a
container because then you can paralyze
it for free each execution runs use the
same underlying binary of liberal fees
but it has access to its own copy my
file system au au FS and this provides
isolation provides the ability to scale
it up without much thought so this was
one of the big wins for for the for this
or that we that we found really useful
in this architecture everything is tied
up by that tied out with the tide
together with the oj oj s so that's the
over / overall overarching you know to
technology that we've been using so for
the for the media services as I
mentioned the winds have been we have a
you know tiny focused microservice run
that can run on any machine so it frees
up the developers for worrying about
where things are deployed they can just
be Auto scaled by by AWS very fairly
easily and it it worked around it helped
us parallelized workflows in conversions
that were not really made for that
specific thing as I mentioned before
that it gives us a free win in the sense
of isolating data in a way that it was
very easy to make sure no customer data
would you know gets mixed up in between
up those upload uploads and what was the
last one yeah obviously sometimes people
upload videos that are like I know 500
Meg's and then the voice spread at the
office and for some reason there's this
very fairly unexplainable peeks over the
entire our entire cloud where people
decide to upload huge videos all in the
same five minutes and so you've been
able to manage you know they load the
CPU and the memory of of the of the
operations helped us smooth out these
loads and then and the fact that the
binaries are immutable version and
allowed us obviously to scale the scale
as many workers and as many servers are
needed whenever we need it and finally
the big win which I maybe I mentioned it
in passing and I like this this image is
the ops team you still there it's not
that it doesn't exist but it now
provides a service the infrastructure
that now it is completely abstracted out
from the developers so the developer is
confident that if if you serve assist
employees is developed in a way that
stateless and very focused the developer
doesn't need to worry about it feels
actually empower to
to deploy fast and easy to the
production systems and so in passing
just want to leave you with a snapshot
for our cabana dashboard form the first
few hours that the system was in place
processed in just of just a short time
45 gigs of data and if you can see the
number over there just to give you a
sense of thing the thing and this is
more or less what I had I see I've been
for few minutes my time has been up for
a few minutes there's any questions we
are at the booth here atlassian boot
comment we can talk to occur i can give
you a bit more more details about this
and I am so thank you thank you for your
attention</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>