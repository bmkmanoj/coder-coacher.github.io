<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Design Patterns in the Light of Lambda Expressions by Subramaniam | Coder Coacher - Coaching Coders</title><meta content="Design Patterns in the Light of Lambda Expressions by Subramaniam - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Design Patterns in the Light of Lambda Expressions by Subramaniam</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/e4MT_OguDKg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright let's get started welcome to the
session on design patterns and the light
of lambda expressions my name is Venkat
Subramanyam we're going to talk about
design patterns but we're going to talk
about how lambdas actually change
patterns and how we use them well I want
to first start out by saying that I
really hate design patterns that was
very motivating wasn't it
well I'll tell you why I actually hate
patterns we often tend to really want to
use patterns very quickly and if you
really think about it how do we really
figure out what patterns to actually use
well I want to say if you really think
about it we all can agree that grandma
makes the best pie so you've been
telling about grandma's pie to your
friends and your friends say well the
planets pie is so good why don't you
make it so you call a grandma and say
grandma I've been talking about your fly
all along I want a recipe I want to make
it for my friends so grandma gives you
that recipe for for the pie and you
write it down and as you're writing down
grandma says you know add two spoons of
sugar you say wait wait is it
tablespoons or teaspoon you ask for all
these details and the ones all dude all
that is done what do you do you say
grandma let me go over this one more
time and what are the best practices
well after that you make the pie and how
did it turn out to be a disaster wasn't
it the last time I tried this I lost the
spoon with it so the point is that
didn't work at all then you finally meet
grandma and say grandmother was a
disaster and grandma says let me let's
make pie together and you know and
you're watching grandma make pie and
while grandma is telling you stories and
then grandma wants to add sugar what
does grandma do grandma takes two spoons
of sugar measures it accurately and puts
it right know grandma while talking take
some sugar and tosses it in and you said
wait what was that sugar how much did
you put enough and that's when you
realize grandma never follows the recipe
she gave you well the guys who wrote the
design patterns book or the grandmas and
grandpas of industry and the worst thing
they ever did in their life is write the
damn book and now everybody thinks right
we can actually do this and while I can
use patterns too so it actually takes
years of experience and making
it's takes to learn user patterns so
having said that if we do decide to use
a pattern I often use a pattern as a way
to communicate rather than as a design
tool and of course it can be very easy
to communicate and say well I'm using
this factory method here I'm using the
abstract Factory here or a decorator
here it can be a nice communication tool
so having said that if we go to use
patterns well at least we can use
patterns which are lighter weight than
creating a monstrous set of patterns so
I want to talk about how actually
patterns would change if we're going to
be using these patterns with lambda
expressions well lambda expressions have
changed the world in Java they give us a
lightweight design tool and we can
effectively use lambda expressions do
write a lot of stuff where otherwise
would have created a hierarchy of
classes so let's take a look at some
examples of how this is going to really
work the first one I want to start out
with is the iterator pattern let's start
with the iterator pattern real quick
we all have used external iterators for
a very long long time let's say for a
minute we have a list of numbers 1 to 10
I want to loop through and print the
values you say for int I equal to 0 I
less than well numbers dot you pass a
second and think about what method to
use here well length if it's an array
size if it's of a list and then I plus
plus and then of course we could say
output in this case numbers start get
the value of I well there was a lot of
ceremony that's an external iterator as
we know are rather than doing all of
that work walk what I could have done is
I could have simply said far in element
in numbers and then I could have simply
said that what a relief that's a lot
less code already but these two
collectively are called as external
iterators but rather than that we can
actually use an internal iterator and
get our work done much more effectively
so we can say numbers dot for each and
we can simply in this case give given an
element I want to simply output the
element and we can see that we do a lot
less effort less ceremony and get the
work done
well this end ends up being an internal
iterator so what's the big difference
between these two well the very big
difference is in the case of an external
iterator we are pulling the element one
at a time whereas these iterators could
be where we focus on what to do per
element and not actually how to iterate
it so it gives us focus on what our job
is rather than how to actually get this
done we could of course also use method
references in this case we could say
system and then dark out and then we can
simply say print line and this makes it
much more easier to understand what the
code is doing makes the code a lot more
expressive as well so we can start
programming with internal iterators so
that's one thing we're going to first of
all do moving forward into Java is
iterators just got such a more
lightweight and we can use iterators
like this and we can build our own
iterators as well but we can start using
lambdas quite effectively but I want to
quickly move to other patterns that we
really want to focus on well I want to
talk about the strategy pattern
well strategy pattern is a pattern we
all have used quite often but I want to
take a little example and play with the
strategy and see how that actually
begins to feel let's say for a minute
you are working with a problem and let's
say for a minute that it's a very late
Friday and you know what happens late on
Friday right our mind kind of switches
off we got other things we want to go
out and do well imagine this is a very
late Friday afternoon and in fact to
make things worse you got some really
old friends you wanna meet and have a
good party so looking at your watch you
really want to go well one of your
colleagues comes to you and says I want
you to write a function that totals all
values this could be values to our
numbers prices stock prices weather data
whatever that could be right so they
want you to total all these prior values
well how are you going to write it so
you're going to say total values and
then you're going to say numbers well
let's go ahead and write that little
function for totaling the values so I'm
going to say public static let's say
total values I'm going to use imperative
style for a few minutes I'll refactor it
to functional style a little later so in
this case I'm going to say integer
values will call it as values and what
am I going to do here well first of all
let's say result is equal to 0 and I
want to return the value of result when
we are done with it
well but of course I have to really
compute the result what am I going to do
well
for let's say int element coming from
values and I'm going to simply say
result is plus equal to element and we
can just quickly total the value so that
seems to work really well and you look
at your watch you're eager to go but
unfortunately your colleague the one who
nags you all the time
comes to you and says but I really need
one more help from you could you please
write also a method that would total not
just all the values but also total all
the even values so you ask your
colleague are you really interested in a
function like this and your colleague
says yep that's exactly what I want and
you look at your watch one more time and
you're getting nervous because you
really want to leave but there's a bit
of a good news you quickly realize most
of the coding is actually done in fact
this code is doing almost everything you
need to do and then you look at this and
you tell yourselves there's got to be a
reason why they created copy and paste
right
I mean if nobody should ever use it why
would they create it right if it was so
bad so you quickly say total even values
and then you say if emod two is equal to
zero then total not otherwise so in this
case copy and pasting does bad things as
you can see right here but okay so in
this case of course I'm going to go
ahead and quickly run this code and what
does this really do well I'm totally all
the even values as you can see that
seems to have work really well
well unfortunately about time you're
about to leave your colleague walks in
and says but I need one more thing from
you I want you to total all the odd
values as well but you know one thing
very clearly copying and pasting a code
a third time is an act of criminal
negligence but it's a Friday night and
nobody is looking so you quickly we
don't refactor this and say total our
values and you say if this is not equal
to then of course you got the code
working but the problem in this code is
you duplicated the code three times and
that's just not acceptable well well
there on your way you start by the
nearest coffee shop because you're so
guilty you start refactoring but as fact
may have it some of your other friends
are hanging around
and they come over to you and ask you
what you're doing and before you could
close your laptop they take a look at it
and they'll get to know your dark side
and of course they don't run your phone
calls anymore because who would want to
hang out with people who do copying and
pasting for a living anyways so you know
how life really becomes miserable if
that happens let's refine this get back
to where we were a minute ago so we have
this code right here sitting in front of
us and we have this one function now
your colleague comes to you and says hey
could I please have a method that will
total all the even values in addition to
all these values well yeah you can have
it but before you do it you decide to do
one little refactoring before you add
this function a feature
so what refactoring are we going to do
well the very first thing we're going to
do is we're going to look at this
function this function here called total
values right now this function is called
a normal function so what in the world
is a normal function it's what we
normally have been using so a normal
function can receive objects as
parameters and it can also return
objects as a result as well we're going
to turn this function from a normal
function to what is called a
higher-order function so what is a
higher-order function a higher-order
function may receive another function as
a parameter it can potentially return a
function as a result as well so the
difference between a normal function of
higher-order function is what you can
pass to it or what you could potentially
return from it a higher-order function
receives a function as a parameter and
or it could return a function as a
result as well so you can begin to use
that fairly quickly well right now we
have a higher normal function I'm going
to convert it to a higher-order function
which is extremely simple all I'm going
to do is give it an element II simply
return a true so notice how the total
values which was taking on just the
numbers object a second ago now is
accepting two parameters where the
second parameter is actually a function
that you're passing to this function so
what am I going to do now I want to
receive this function well that's a
lambda but if you notice this lambda is
taking antenna
but it's returning a boolean and there
is a functional interface that matches
that kind of a signature and that
functional interface in Java eight
actually is is called the a predicate
interface so I'm going to bring in
function dot predicate right now and all
I'm going to do is add a second
parameter where that becomes a predicate
which takes an integer and I'm going to
call it as a selector for lack of better
words and I'm going to simply say in
this case if the selector tests the
value and if it's happy with it then
accept it otherwise reject it now
clearly the result did not change which
is why we call it refactoring the code
is doing the same thing but we change
the design of the code and what did we
do in this case we are passing an extra
parameter where this parameter simply
receives a value and returns a true now
of course now you can get back to doing
what your colleague wanted you to do
which is you can say I'm going to
compute only values for even number so
now we say Mar 2 is equal to 0 and you
can see that it's totaling the values
for only even numbers a few minutes
later your colleague comes in again and
says I want to write a function where I
can total our values you tell your
colleague go back to your desk and do it
yourself because I've written it in a
way that it's actually reusable and we
can easily use that value and pass in a
different one if you look at the what we
just did we are we have taken a common
piece of code right here in this and the
common piece of code is sitting right
here nicely but we extracted from the
code just that little logic which
decides whether a value should be total
or not
well what concepts is is that well
that's basically what a strategy is
except for one difference in Java 7 and
earlier if you want to use a strategy
pattern you often organize a corporate
design meeting here you just get it done
that's simple
so you can just get quietly some
patterns implemented of course we can
rewrite this code to use water
functional style here as well so what
I'm going to do is rather than writing
so much code verbose code all I'm going
to do simply is to say return over here
I'm going to say values start stream and
I'm going to simply call the filter
function and then pass the selector to
the filter after all a filter is
expecting a predicate and a selector is
a predicate so I can just simply pass
that to that and then I can say in this
case well I want to call a reduce
function because all I'm doing is
totaling and I can say integer colon
colon sum and I can perform a total
operation of that value very easily and
you can see that in this case we can
rewrite this in a functional style
rather than taking all that effort to
write an imperative style
so the code becomes a lot easier so here
we use the iterator pattern along with
the strategy pattern as well in this
particular example of course patterns
very rarely live in isolation we often
mix them together and that's basically
what we saw here is how we are able to
bring that in as well of course in this
case if you really want to use the sum
method which is another specialized
reduced function well unfortunately that
wouldn't work directly here but you can
do something a little different to get
that working so if you do this for
example that we'll be able to use some
as well the only thing you should never
ask is what does that mean don't apply
logic in these cases okay so basically
the sum works because it's working on an
integer stream rather than in a stream
so a little goofy but we have to do a
little typecasting here to get that
working in this particular case it looks
a little bit more odd than it should
really do in other cases so we saw how
we can actually use lambdas to build the
strategy pattern so what's the lesson
there the lesson is imagine you're doing
a strategy pattern in Java 7 or earlier
what do you normally do in a strategy
pattern well you first create an
interface and then you create a
hierarchy of classes that implement your
interface then you have your class that
wants to use the strategy and this class
will then depend on this interface and
then of course you would have classes
implement that interface and you'd have
built a hierarchy of classes well to me
that's a lot of heavy weighted nnessee
have to carry around so in other words
moving to Java 8 where I would have had
a library of classes I'm now looking at
library of functions
a rather than library of classes so I
can start readily using a set of
functions for example let's look at one
example here let's say for a minute I
don't want to use these functions
explicitly here well notice what I could
do I could have them in another class
for all purposes but I'm going to say
boolean let's say is even and that takes
a number here and it's going to return
number over here mod 2 is equal to 0
like I said this could have been in
another utility class for all practical
purpose in fact why don't we do that
just for the fun of it so I'm going to
say class util and I'm going to put this
into the utility class likewise I can
also create yet another function here
let's say is odd and then of course in
this case I'm going to check if it is
odd so I've got this YZ even in these
art but notice the beauty of this I can
simply go back here and I can change
this to util and then I can say ease
even and I can use that function right
there and likewise I can change this to
util is odd and I can use that as well
so the point really is rather than
creating a hierarchy of classes to
support strategic pattern we can now
create a library of functions and very
readily use those functions using
lambdas are using method references
that's a lot less code for us to write a
lot less code for us to maintain as well
so life becomes a lot better to work
with it and that's one of the things I
really like about how lightweight this
becomes with the lambda expressions so
we saw the strategy pattern let's now
talk about the next pattern I want to
talk about here which is the decorator
pattern now I'm sure we all have read
about decorator pattern but I often feel
that decorator pattern is one of the you
know nice patterns that often really
gets under used but why don't we often
use the decorator pattern well one of
the reasons why we don't use a decorator
pattern often is because almost always
when you look at an example of a
decorator pattern how does the example
look like new for example in a buffered
input stream and a new data input stream
and then knew by this time you're like
really right so this is a really heavy
weight and you keep doing all these new
and you look at this pattern once and
you decide I will never ever use this so
this is a lot of work and a lot of
objects being created and we kind of
lose interest along the way and say you
know that may be a really good pattern
but gosh that looks really ugly I'm not
going to use it so we tend to really
underutilized the created pattern even
though it's a really nice pattern for us
to use but before I talk about the
decorator pattern I want to talk about
something else that will help us to
implement the decorator pattern well I
talked about the predicate a few minutes
ago
and you can do this with predicates but
I'm going to focus here on function for
a minute
well one of the things you have in Java
is a wonderful functional interface
called a function and I'm going to say Y
integer comma integer Inc equals give an
element return element plus one well I
want to use this increment so I'm going
to go ahead and say you know do work for
example pass a 5 and pass Inc to it
let's take a look at the do work
function here so I'm going to call the
function over here the function is going
to be called as do work so I'll say do
work and this is going to take a value
as a parameter but I'm going to pass a
function which takes an integer an
integer we'll call it func for a minute
and all I'm going to do is simply output
let's go ahead and say the func dart
apply and I'm gonna pass this particular
value passed in well let's go ahead and
try this I'm gonna pass that and you can
see that 5 plus 1 is 6 that definitely
worked really well
but I'm also going to go back here and
say here is a function called the double
it and I'm going to simply take this
value and I'm gonna double so in this
case I can call do work and 5 and double
it and clearly 5 times 2 is 10 and we
can see the result is 10 but I want to
do something a little different now I
want to increment and double well how
would I increment and double well I
could do something like this I could say
Ian to temp is equal to Inc the art
apply
I and then I would say five over here
and that gives me a increment of five
with us with a value of one so it's
going to be a six then I could output in
this case a a double eight dart double
eight dart apply and then I could pass a
temp to it notice of course 5 + 1 + 6 6
times 2 is 12 and the result is actually
12 but what did I do here I did
something really nasty what is that
called
we normally call this a garbage variable
in fact we hate those variables so much
we call it like temp we never give it
any respectable name after all right and
and that's a sign that that shouldn't
really exist and it's only there because
we couldn't really get rid of it so what
if we can actually get rid of those
kinds of functions well thankfully we
don't need those garbage variables so
I'm going to call do work comma 5 but
notice this time I'm going to say Inc
and then and I'm going to just simply
say double it and you can see how nicely
we can combine these functions together
to do some really nice sequence of
operations so you can take these two
functions and you can say I got function
1 and I got function 2 but I'm going to
ask function one to hold the hands of
function two and when you pass the
object to a function 1 it does its work
and returns there to the function 2 and
says here you go and the function 2
takes the result given does its work and
return to your result so you can do a
nice chaining of these objects very
easily so functions already provide this
and so you can nicely chain them
together well now we can start employing
some of these features very effectively
for a greater good so let's take a look
at an example of what I can do to
maximize the benefit of these kinds of
operations likewise you can also use
this in predicates as well you can
combine predicates using and and are and
those good things you can do that as
well to understand what we can do with
this I'm going to take a class called a
camera class so here's a camera class
and my camera class is going to have one
function and the function I'm going to
have is called color a bit scary but I'm
going to say import Java dot a double
ud dot let's say star and of course in
this case I got a color on my hand I got
a snap which takes a color and I'll call
it as import and all I'm going to do is
simply return the input given to me
let's start with that for a minute so
now I'm going to go back here and write
a little function and the function I'm
going to write here is going to be let's
call it as print you know snap and I'm
going to pass a camera to it we'll say
came around and what am I going to do
within this well the first thing I'm
going to do here is I'm going to first
of all output
camera dot let's say snap and I'm gonna
pass a little color to it new let's say
color and I'm going to pass 125 125 125
as the value to it let's go ahead and
give this a try real quick so I'm going
to call the print snap and I'm gonna say
new camera and pass a camera to it and
then ask it to do the work so when I run
this little code what does this do it's
supposed to run through and you know
print the snap for us and give us this
output and I want to see the output of
this when when this actually runs well
that seems to be really oh there you go
so eventually it showed up so I'm going
to run this and see the output of this
particular call and being displayed
right there so that's great that's a
first step but what I really want to do
looks like it's giving a little trouble
so I'm going to run this on the command
prompt so that I can just directly run
it so give me a second to get to where I
want to get to so I want to just quickly
run through this and see the output
so let's go ahead and say I want to run
this little code so I'm gonna say go
ahead and compile and run it and in this
case of course I can see that the result
of this particular call should really
output the color given to it so you can
see the color just comes out great now
what am I going to do well I want to
really do some you know color
manipulation and I want to be varying
some of the things so how am I going to
do that
well let's first of all create a
constructor here we'll say camera right
here is the constructor I'm going to
create and what am I going to do in this
constructor well I could call a function
called set you know let's call it
filters and I'm going to call a function
called set filters so what is the set
filters do set filters is going to set
some color
is for me and what is the set filters
function you know what does that look
like well set filter says I'm going to
take a function in this case given a
color and given a returning a color
we'll call it a filters well this is
going to be filters but I'm going to
pass a bar or good to it and so I'm
going to receive a filters as a
parameter we'll come back and see how
we're going to write this in just a few
minutes but I'm going to start with no
filters to begin with I don't care about
any filters so this works really well
because you don't have to pass any
colors after all because the wore art
will be happy to receive it so in this
case I'm going to say private function
let's say color comma color and I'll
call it filter and in this case I'm
going to simply say filter is equal to
well to begin with I want to filter that
does really nothing so I'm going to say
given a color simply return the color
that is my default filter to begin with
so notice this is a lambda and this
lambda says whatever you give me I'll
simply return it back to you so that's
basically what the filter is right now
I'm not even using the filters yet so
what am I going to do in the snap I'm
going to simply say filter dart apply
and then simply pass the input to it
let's make sure this part of the code
works so far before we go any further so
I'm going to go ahead and run this
little code and see what the code does
oh wait a minute it is giving me a
warning oh it actually gives me two
warnings but as Java programmers we know
exactly how to take care of those
warnings really well so we can take care
of that
so suppress warnings isn't it beautiful
unchecked so you can take care of that
and make sure that never ever comes back
alive so you can try that oh wait a
minute
I made an error saying that so suppress
warnings okay that's good and then make
sure that's working and of course that
seems to have to fix the problem really
well awesome so this is great to really
teach junior developers right here's how
you deal with warnings okay so we have
that particular code working that's
great now what am I going to do well now
that I have this working notice what
this is doing
it's simply returning what was given to
it but what about the filters I still
want to use the filters isn't it
let's go ahead and pass this through the
chain I'm gonna pass this to the
constructor itself and then I'm going to
bring in as filters one more time here
so that's basically filters being passed
in again I didn't do a whole lot let's
make sure that part is still working
well obviously in this case new camera
is not well more warnings this is lovely
but we know exactly how to take care of
that also so let's go ahead and do that
so now that that's taken care no more
warnings well the code is still working
great now I want to really pass some
data but before we do that let's see
where the declaration actually comes in
well notice this is filters but you know
in Java what this is this is an array of
objects that's what you're dealing with
well you know that if you have a list on
your hand you can say list out stream to
get a stream but we don't have a list on
our hand we have an array so what I'm
going to do here is I'm going to first
of all say a stream dot off filters well
let's go ahead and bring in the stream
to begin with so I'm going to say here
is my stream class coming in so I'm
going to say given this particular
stream stream of filters now what am I
going to do well I want to take a bunch
of streams but I want to combine them
into one single value well if you think
about what streams do streams offer
functions like filter map but there's
one other really interesting function
called the reduce function so what does
the reduce function do well the reduce
function says given a collection of
values I can go through and create one
single value from a collection of values
it's a reduce operation so all I want
here is a reduce operation so what I'm
going to do here is simply say dot
reduce and you know reduce takes two
parameters the first parameter the
reduce and often takes as a initial
value and the second parameter it takes
is a lambda that is going to know how to
combine these values together well you
know what my initial value is my initial
value is given a color return a color
back to me and that's what we used a few
minutes ago as the default value if
nothing was available so I'm going to
start with that as my initial value but
what about the
hamda well the lambda says in this case
the lambda says given the filters so we
can call this as the you know
accumulation are carrying over would say
the filters in here so filters and then
I'm going to say a filter we'll call it
earth filter so given the filters and
the filter what should I do
well I'm going to say the filters dot
and I'm going to say and then and we
will simply add it the L filter to it so
we can see how I'm able to combine these
filters together to reduce this even
further so if I go back and try this
little code make sure that's still
working well that part is still working
but of course this code doesn't make us
really feel good we want this to be a
lot more concise than this but the good
news is we can do quite a bit of
refactoring really nicely well folks
will tell you that this actually is
called identity function so rather than
doing color is color I'm going to say
function dot identity that's what I'm
going to call to begin with so that
takes care of the color to color
function but what about this one well if
you closely look at this there's a bit
of a good news in here notice we are not
doing anything with the data except we
are just receiving the parameter and we
are quietly passing it over well you
know that if a lambda is simply
receiving parameters and passing it
without doing any work
you can then replace those lambdas with
method references so that's pretty
awesome we can do that so I'm going to
replace this code right here that you
see with simply function in here so
function and then and that would take
care of that really nicely I don't have
to write that you know clumsy code at
this point so that reduces the code
really nicely as you can see into just a
little piece of code let's make sure
that's still working that seems to be
working just fine well okay great now
let's go ahead and do actual oil use of
this decoration now that we have the
code built up nicely let's try something
else
I'm gonna call print snap and do Kay
but in this case I want to say color and
I'm gonna say brighter so brighter and
I'm gonna enhance the color to a
brighter color as you can see well now
if I go back and run the code you can
see in the second case it is no longer
125 the color actually is brighter it's
178 so we applied a little
transformation function here
when we called likewise we can also do
this one more time but now we're going
to say darker rather than brighter and
you can see in this particular case when
I run this code again you can see that
in this case the color is less than 125
that made it darker but hey where in the
world is decoration after all well I can
now do multiple of these and don't ask
me why I would do this but I can take
this and say right here I can add this
to be brighter and then comma color and
I can say darker as well and now you can
see that in the last example I'm taking
125 making it brighter and lowering it
back well of course it says are you
kidding me and it loses some little
signal there okay but it's kind of
working right so you took it up and you
brought it down there's always wonderful
rounding going on somewhere so you can
see how we are connecting multiple of
these together well take a look at this
code a it's not scary like the new and
new and new this nicely provides a chain
of things for you to provide so imagine
you have an application where you got
bunch of transformations or algorithms
or logic to perform you can pretty much
pick whichever you want to apply and you
can combine them together very nicely
so the code looks soaked not a concise
in the case where you are actually using
the decoration and then of course if you
notice that was very concise as well in
terms of how you really formed the
decoration or the chaining of the
filters as well that's very very easy to
write also so only a few lines of code
we had to write employing a nice feature
in Java
which is the ability to combine
functions together and by using that
feature you can see how we were able to
nicely implement a decorator
without that clumsiness and the clutter
and the noise that we used to so I think
we will probably be able to use
decorators much more moving into Java 8
thanks to this particular approach well
I want to talk about two other patterns
but quickly though a word of caution
both the patterns are going to look a
lot like each other in structure they're
going to look very similar but the
intention is quite different which is
not unusual because if you look at
design patterns this is pretty common in
design patterns in design patterns it's
quite often that two if not three
different patterns may actually look
almost the same in structure in fact
there are patterns that have identical
structure for example our decorator
pattern often has a very similar
structure to the composite pattern even
though the intention of using them is
quite different so the two patterns I'm
going to show you here are going to look
a lot like each other but the intention
is very different but before I take the
second pattern or the next pattern I
want to create a slightly different
example and work through it and then get
a draw into that particular pattern that
I wanted to use here so what am I going
to do here well I'm gonna create a
little class for us to play with and the
class that I'm going to create over here
is going to be a class called a mailer
so I'm gonna get rid of things we don't
need so let's go to the class called
mailer so I have a class called mailer
and a mailer is going to have a few
interesting functions but I'm going to
start out by first writing a function a
static function called the print this is
purely a convenience function for myself
so that I don't have to duplicate so
much code so I've got a little print
function but the real functions i'm
interested in are the following
i'm going to write a function called
from and the from function says string
let's say address and in this case i'm
going to simply call the print and send
the word from to it so that way i can
see that it's actually printing it and I
got another function called - and I'm
going to simply say - I've got a
function
here called subject that's going to take
a line as an argument and I'm going to
simply say subject and then I have a
function called let's call it as body
I've got a message and all I'm going to
do is say body here and finally a
function called ascend and all that the
same function is going to do is simply
say sending well the body of the
functions are really stupid but our
intention here is not the body of the
function but we are really interested in
the interface of this class so I've got
a little class called Mahler that I've
created but of course I wanted to use
this Mahler in my code so how am I going
to use Mahler so Mahler I'm going to say
Mahler equals new Mahler so we created a
Mahler object Mahler dot from I'm going
to say where this email is coming from
well that email is coming from builder
at agile developer comm and you can
imagine who this male is going to go to
well that email as it does every single
morning goes over to my email address
and what is the content of this email my
builder likes to send this email very
often to me it normally tells me your
code sucks and it doesn't usually stop
there it also goes to tell me how it
sucks today so it tells me a little bit
of a reason as well here you go
and so that's going to be and finally
mailer darts and well if you look at
this little code this code is really a
configuration to set up a kind of a mail
that I want to send out well question
anybody was written code like this
before
a few hands okay more hands more people
being courageous to raise the hand yeah
others I know you're feeling you don't
want to never admit to this in public
well this is called Java programming
right we all have done this but if you
look at this code there are two problems
at least two problems with this code the
first problem is look at the noise in
this code you keep saying mailer mailer
mailer mailer mailer if you do this to
somebody next to you they may strangle
you right because it becomes annoying
when you say this so many times
the second problem is can I reuse the
Tayler on line number 22 or should I not
reuse the mailer well you know there are
two answers the answer is yes you can
reuse or no you shouldn't but the point
is how do you know well what if you
reuse and you shouldn't well that's
called a bug hey what if you should
reuse a new don't
that's called inefficiency so both of
those are not good so how do you know
whether you can reuse it or not well
here's an idea I don't know whether I
can reuse it or not and you may suggest
why don't you go read the documentation
how did that go for you
the last time you did try to read a
documentation well the other day I was
looking at a piece of code and honestly
I have to admit the function name was
passed through and honestly I did not
know what passed through mint so I went
to the documentation and the
documentation said this method allows
you to pass through well thank you very
much right those are not called Javadoc
those are called insult the programmer
and I still don't know what pass through
means right so the point really is
documents don't help us well here's
another idea why don't you download the
source code and read it well you know
what happens when you download the
source code the minute you do it you
begin to curse alright and that is
really hard you know my wife often tells
me you're such a nice person except when
you sit in front of a computer and look
at the code right and that kind of
happens we transformed another being
when you look at a code and all the foul
words keep coming out of our mouths and
that's how we're feeling with code
always in fact this is even worse the
other day I saw somebody who was
endlessly cursing at a piece of code
until he realized he was the original
author and didn't remember it right so
that happens as well so looking at the
code is not a good answer either so the
point is wouldn't it be nice if there is
one way to do this and there's no other
way actually to you know do this the
right way is the is the only way to do
it well that would be really nice but
let's let me have two problems on our
hand let's address the first problem I
want to remove the noise in the code so
how do I remove the noise in the code
I'm gonna use what's called a cascade
method pattern so Cask
it method pattern is going to be a
pattern where we're going to nicely
cascade through the methods and apply
that particular pattern that's the very
first thing we're going to do here so
what I'm going to do is I'm going to
first of all go to this code I'm going
to take each of these functions I'm
going to change these functions to
rather than returning a void I'm going
to turn a mailer from these functions so
each of these functions are returning
mailer but of course that's not enough
because each of these functions need
also to return a value of this as well
at the very end so we refactored it to
return the dis value now of course I've
made that little change now what am I
going to do I go back to this piece of
code and I say I'm going to take away
this mailer from here and I'm going to
go ahead and take away that mailer and
I'm going to remove all that semicolons
from that very end and so we are using
the so-called Cascade method pattern
some people fondly like to call this as
a trainwreck pattern as well you can use
either a train wreck or a cascade
depending on what you are interested in
looking at so in this case you can see
how we remove that noise in the code by
simply going through and taking the
result of one method and passing on what
sometimes you may call this is a builder
pattern that's perfectly fine as well so
you can see how this is going to cascade
through well now that we remove the
noise we have still the second problem
to deal with which is what do you do
about the object can you use the object
at the very end of it well clearly in
this case could have saved the object
and reused it and is that is that the
intention well to fix that what I'm
going to do here is I'm going to first
of all go back and say that the send
method is a static method so now that I
made the send method a static method I'm
not going to call this method on the
object anymore so what am I going to do
I'm going to remove the method send from
here and I'm going to replace this with
a mailer so mailer dark send as a
function well now that may send is a
static method I'm calling it on the
class but then how would I go about
really using it well in here I'm going
to say May
well notice the difference here well
usually we pass the objects to functions
well now we got passed a function to a
function but the function in turn calls
over function and returns the data so
you can see this two-way communication
which is really cool
you pass a function and through that
function they pass a data back to you so
there's a nice way to go back and forth
with the data so in this case I am
passing the highlighted code here is a
function that I'm passing to send in
other words I'm gonna make the send
method a higher-order function because
I'm passing a function to send send is
going to give me an object which I can
hold on and use it in this function so
what am i going to do with in here all
I'm going to do with in here is now that
I have received a mailer I'm gonna say
mailer dot and do all that work right
there up to the very end so notice now
how we change the code to say I'm gonna
receive this mailer and gonna use that
mailer that's been given to me well but
of course for this to work I need to do
some work on the send method itself well
I already brought the function package
so I'm gonna say consumer right here so
consumer and this is going to become a
mailer and I would say block and within
here I'll say mailer equals new mailer
and block dot accept and I will send the
mailer over to it so now if you notice
what this code is going to do we can
nicely exercise this code and you can
see the code actually still is working
so what did we do what we did in this
case is we call the send method and we
sent the lambda to it the send method
creates an object and gives the object
back to us on the lambda and then in the
lam that we use that object and when we
return now comes the question hey on
line number 26 can I reuse the mailer
object and the answer is what mailer
object are you talking about right
because there's no mailer object on our
hand because the context of the mailer
object is within the lambda on the
minute you return from the lambda
you go back to the send method and the
send method keeps the object internally
you don't have access to the mailer
object outside so that becomes a nice
way to bring in fluency but you're also
able to decide whether to reuse the
object or not hey should I reuse the
object or not and the short answer is
that's none of your business
simply go ahead and use the object and
go home be happy let the author of the
class decided if the author of the class
doesn't want you to reuse the object
they can create a new object every time
if they want you to reuse an object they
can store it away in proper collection
and give it to you and they can manage
it and if you really think about it if a
resource is precious whose job is to
manage of course the author of the
class's job it shouldn't be a burden on
me as a programmer using that object so
this puts the burden on where it rightly
belongs good separation of concern as
well so that gives us an idea about how
to really make use of this particular
pattern using lambdas again well the
next pattern I'm going to show you is
one of my most favorite patterns we're
going to use something very similar to
what we did but this pattern has been
around for a very very long time I
actually read about this pattern in Kent
Beck's book called small talk best
practices so this pattern has been
around for a good thirty years or so but
now we can actually use it because
finally Java has lambda expressions we
can use these patterns so this pattern
actually I like quite a bit because it
gives us a nice way to do some
operations and there are so many uses of
this pattern I'll give you a few use
cases but before I talk about the use of
this pattern I'm going to bring up a
slightly different example so we can
actually learn how to benefit from this
pattern so let's say we have a class
called resource and the class resource
has a constructor right here and I'm
going to simply say in the constructor
output let's say create it I also have a
function right here the function is
called up one and all I'm going to do is
simply output up one I also have another
function here called up two and I'll
just simply say up two and finally I
have a function here which is public
finalized and imagine I want to clean up
right here and imagine this is a very
expensive resource so one of the things
the job I did really poorly in my
opinion is bring garbage collection and
resource management into the same fold
these two are completely different from
one another you can have automatic
garbage collection but managing resource
is a completely different thing and
trying to say that the resource will be
cleaned up when the memory is cleaned up
is not a good idea but we have ended
this pain for a while now if you go back
to this code I'm going to say resource
let's say resource equals new resource
and I'm going to say resource dot up one
and resource start up two and then of
course when I run this code you can see
it created the resource hey but wait a
minute
it did not clean it up why because
garbage collection in Java he is kind of
like garbage collection in my
neighborhood just because I put the
trash out doesn't mean anything right so
the point is it says yeah I've got a lot
of memory I don't have to do this my
first fear is did I misspell finalize oh
no I did not miss fault misspelled
finalized actually this happened on a
project a company called me and the boss
called me and said hey we got a request
for you can you come and work with us we
wanted to do code reviews we wanted you
to look at all the code and help us
improve the code quality but while
you're doing code review maybe you can
help find and fix a problem we've been
having for several months now I said
tell me about this problem he said go
talk to the programmers they will tell
you and I went to the programmers and
kept asking what's the problem and
nobody could really help me really tell
me what the problem is until one
programmer just nailed it
that programmer said our application
works fine most of the time I said
that's great can you tell me when it
doesn't work is it of course it doesn't
work between 7:15 and 9 in the morning I
said oh my gosh every day he said no
only Monday through Friday right I was
like wow so Saturday and Sunday not a
problem
so this made me really worried why would
it fail during work days but not on
weekends well it was a company with
100,000 employees it turned out so that
you
what happens between 79 in the morning
people come to work whether they want it
or not they log on and get to the portal
application these guys were used
developing a portal application when he
started doing the code review here's
what I found out I found out that in the
in the constructor they were creating
opening a database connection in the
finalize method they were calling a
closed on it and the minute I saw this
I'm like oh wait a minute
that wouldn't be a fun at all because
you guys have a lot of memory the
garbage collector is not going to kick
in which means you got all these
connections open and new objects are
going to ask for new connection without
closing the old one that's not going to
be fun and when I told this one of the
developers started monitoring the
database connections and we could see
that inch up and get up there and of
course all these constructor calls were
failing but not enough exception
handling code was propagating that so
the minute I got a window fit I made
only one change all I did was I changed
this function to close and the minute I
changed to close I went to the code
where they are using this function and I
asked them to go ahead and of course in
a similar example there and I said go
try this now and then they try it of
course in this case when I call the
closer cleanup happens in their
production application what happened was
the developer said oh yeah now the
connection is practiced you know stable
and we are not getting errors anymore it
was kind of funny to watch this in the
afternoon the boss came back from lunch
as bosses normally are he was fairly
curious and he came in and said how are
things and one of the team members said
we got some good news remember the
problem we've been having for several
months
that's gone he said that's awesome what
did you guys do and one of the
developers said well then could ask us
to add this one line of code and we
added and the problem was gone he said
really what else did he do well that's
only did he just added one line and then
was a little pause and after they heard
him ask if you only added one line of
code do we still need to pay him well
sure right so the point really is we
have to absolutely do the right things
well in this case of course there are
two problems in this code the first
problem in this code what is there a
problem in this code by the way easy to
forget closed right that's the first
problem but the second problem exception
right
so what if there is an exception in the
code and of course clothes will never
get called let's fix the exception
problem now well to fix the exception
problem I'm going to say dry over here
move this into the up over here and I
would say finally and within the finally
block I'm gonna call the close method
well good news even if there is an
exception this will go away now we have
two problems the first problem is it's
verbose it's more stuff you have to
write second problem this is not easy to
forget it is easy to forget plus plus
now because it's not only easy to forget
close now it's easy to forget try
finally and close what are the chances
well let's again fix the second problem
can we reduce the verbosity well I got
some good news for you Java 7 has a
feature to reduce this so Java 7 has a
feature called a or M which stands for
automatic resource management and what
this feature does this it says you don't
ever have to use finally anymore so I
get rid of the word finally and instead
of putting the word finally what I'm
going to do is I'm going to say well
let's use a try with resource so I'm
going to say in this case move this code
from here up to the try block directly
well unfortunately though this doesn't
work at this time why not because I got
go to the resource and say implements
and I'm going to say Auto closable so in
this case I'm going to say Arto
closeable and the minute you put order
closable it's simply a tagging interface
and needs to have a public closed method
and Java says oh you put auto closeable
there I will take care of this for you
so now if you notice when I run this
good news it called closed automatically
so I could say not so verbose
so that's definitely a great news so far
who would want to write finally after
all if we don't really have to write it
well that's great we're using the AR M
so we should be happy about it but
remember we had two problems a minute
ago right the one problem was its
verbose the other problem is it's easy
to forget we remove the verbal
quite a bit but what about forgetfulness
well I'm a very forgetful guy so it's
quite possible that I may not put the
try at all and what I may end up doing
is simply called resource without the
try like this but here comes the
question remember how we did put Auto
closeable so the compiler knows that
there is Auto closeable so my question
to you is will the compiler give you a
error or will the compiler give you a
warning at least to say hey dude you
need to handle this what do you think
the answer is no but of course you know
this extremely well when it started this
part because you know deep in your heart
never ever to trust a feature with the
word management in its name so that
doesn't work after all right so clearly
in this case when you did this you can
see that didn't really work well that
sucks ok great
so forget about this wouldn't it be nice
so just like everything else eventually
we're on our own when you're depend on
management right ok so what do you do
now well of course I want to really make
this work the right way so we back to
square when we started out with what do
we do well the first thing is of course
you could in good faith say resource
start close and call the close all those
good stuff but let's fix it the very
first thing I'm going to do is to change
the clothes into a private method aha I
made it private what's going to happen
well the developer comes along runs the
code it says sorry you cannot compile it
you cannot call close and the developer
says ok no worries but that didn't
really solve the problem yet ok that's
the first step the next thing I'm going
to do is make the constructor a private
as well now the developer is going to
come back and say what gives I can
create an object to this class how do I
use it well welcome to the right way of
using this object so we're going to go
back to this code and we're going to
write a function and the function I'm
going to write is going to be a static
void use function and this function says
I'm gonna take a consumer or consumer of
resource as a parameter
and within this function I'm going to
say pry and finally well remember as an
author of this class I know exactly how
to do this and why to do this and then
of course in this case I'm going to save
resource dark clothes and call the
clothes where is the resource though
well I'm going to create the resource
equals resource equals new resource so I
created the resource right here and then
I'm going to basically say here blocked
out except and then pass the resource to
it now in general you may have
constructor parameters but that's no big
deal
because you can pass the constructor
parameter as a parameter to the use
method and then you can have that passed
in here as well so we don't have to
really worry about that detail so as a
result you can see in this case we got
the used method and we got the consumer
we created the resource passed it on to
the block and said use it please and
when you're done coming called the close
method now if you notice what I'm going
to do here on this side I'm gonna say
resource dot use and I got a resource on
my hand and what am I going to do now
well all I'm going to do here is simply
say resource start up one and I'm going
to just move this down into the code
right there and in this case of course
I'm going to simply call those two
methods and of course I can simply make
this change here as well and I'm going
to return a resource that way I can just
tag along and I don't have to really you
know do what I was doing there
with multiple calls so in this case of
course I have these two functions and
you can see in this case we have the up
1 and up 2 we are calling so let's take
a look at the complete code for this so
this is called an execute around method
pattern but why because in the bottom
you can see line 23 and 24 is what you
really want to execute but around that
method you before the method you want to
do a pre-op and after the method you
want to do a post-up for that reason
sometimes this is also called as a loan
pattern because this is as if the object
is on loan to you and it doesn't matter
what you do with the object but they do
something
for they give it on loan and after you
return it kind of like rental car
companies if you go to rent a car
assuming it's a good rental car company
they clean the car and give it to you
when you return the car generally they
check for damages more so for me than
others but they check for damages so the
point really is we have this loan but
before a loan is given something happens
after a loan is given something happens
and so this is also called as a loan
pattern I've used this actually quite
effectively on projects where I have to
deal with a certain logic repeatedly but
I have boiler plated code in this code
in this application and I take all the
boilerplate code and roll it into this
function and anything in the middle like
a sandwich that I want to do separately
I would use this pattern to do this so
for example I would say transaction dot
run in transaction give the transaction
parameters it will give me a
transactional object after creating the
transaction I will do my stuff and
return and the code will now check for
any errors and log and and and then of
course return the you know that rollback
or if everything was good it would
commit and do any optional logging
that's needed so we can use this in so
many places this is a great way for us
to use this in a projects where there
are policies we have to maintain in code
and that can be nicely a kept away
tucked away in the use like method which
can enforce those policies and yet give
you control yield to you and say go do
whatever you have to do so this becomes
very powerful way to write the code with
this kind of feature this is one of my
most favorite feature patterns that I've
used actually where lambdas can shine
really well you probably have seen this
also in other languages where you open a
file but you never have to close it
because when you open a file they give
you a file handle but when you return
they will do the clothes for you because
they give you a handle to the flaw file
in a consumer like this so you don't
have to really waste your time and
effort or forget to manage resources
they can take care of it for you so what
I showed you here is how we can actually
effectively use lambda expressions to
rethink about design patterns we've been
using for a while with
lambda expressions design patterns
become a lot more lightweight there are
a few patterns that we are abused in
Java that become a lot less painful to
use and there are some patterns that we
have never used in Java before are not
as effectively and those begin to shine
as well thanks to lambda expressions I
hope you found this very useful thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>