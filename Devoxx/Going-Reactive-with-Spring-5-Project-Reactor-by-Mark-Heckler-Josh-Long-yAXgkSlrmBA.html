<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Going Reactive with Spring 5 &amp; Project Reactor by Mark Heckler, Josh Long | Coder Coacher - Coaching Coders</title><meta content="Going Reactive with Spring 5 &amp; Project Reactor by Mark Heckler, Josh Long - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Going Reactive with Spring 5 &amp; Project Reactor by Mark Heckler, Josh Long</b></h2><h5 class="post__date">2017-11-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yAXgkSlrmBA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">oh hey or I'll take that out huh
look at this good-looking crowd hey hi
everyone that was just terrible terrible
hi and it's noon hi oh that's you had
coffee and beer right it's yeah come on
it's time to time to join us okay so
before we get started yeah we need we
actually if you could we need proof that
we were here so we can convince our boss
that we actually weren't just soaking up
the craft beer scene so if we can get a
an audience selfie let's do this okay
when we say spring you all say no wait
when we say open towards you all say
open source and then smile and pretend
like you're happy okay wait wait wait
for it wait wait one second one second
one second this is so awkward
ready well we'll have to do this
multiple shots here okay what do you say
go open source and no okay and X and
over here we practiced this obviously
yeah synchronized stuffing yes okay
thank you
great right on okay so we're gonna go
through a lot of stuff we have worked
very hard on our slides you can see that
that is the truth that is a fact that is
the slide if you have questions or
comments or feedback don't hesitate to
reach out to us we're happy to help or
online there's our there's our Twitter's
how many of you on Twitter I'm just
curious I always wonder you know every
time I come to this conference yeah 2017
nay almost 2018 Twitter all right well
good so so most of you it seems are are
almost there
what about email how many of you using
email I'm just curious I'm just
wondering I'm just I'm just curious it's
a thing oh yeah couple more I think yeah
almost as much so there's that now that
we have the the 280 character Twitter
thing it you know it's gonna be like
email so it doesn't make it doesn't
matter which one you do they're both
gonna be miserable right so so there's
that um we forgot the code so there's
code if you want to follow along at home
github calm mmm-hmm like this you can
grab the code for this for this project
we're gonna look at here
both Java and Kotlin add this URL so if
you want to following later right now
definitely not now not now right the
Wi-Fi Wi-Fi is not meant for that right
now but later if you want to follow
along don't hesitate to grab that code
uh and and then let's get to it so sure
what are we doing talk we're both from
pivitol we both have the privilege of
working in a small company amounts to a
small start-up with big dreams
called pivotal at pivotal we have a lot
of great open source software and we
care about the open source office or the
thing that ultimately drives us is this
need this desire to help people build
better software faster to be able to
move an idea from concept to customer as
quickly as possible and so we spend a
lot of time talking to organizations and
to customers and community members and
so on about micro services and agility
right helping them go faster and this
how many of you've heard of micro
services
oh okay so that's not bad
that saves like 45 minutes of the
presentation yeah yeah that is also we
should be done by like yeah 2:30 now
right the o clock is sooner than later
yeah so so so we won't cover that but
the surprise that to say that
architecture has a lot of benefits it
gives you organizational agility that
said it also invites complexity right a
little bit of complexity because you're
building a distributed system and if
you're ill-prepared for that that
complexity then you're not gonna like
the journey you're not gonna like the
result you're gonna have more pain not
less and so we talk to organizations
about technologies to address the
complexity of first of all standing up
individual production worthy services
and then second of all for addressing
the distribution complexity right and
introducing things like circuit breakers
and you know centralized configuration
and Service registration discovery and
eventual consistency and messaging and
all these other patterns one pattern
that starts to become really really sort
of important and worth focusing on when
you introduce a lot of micro services is
how can you most efficiently conduct
data from one node to another because
that's what you're doing you've got
services that are talking to each other
over the network now communication
between components is no longer done in
terms of interest service calls or intra
you know inter process method
invocations it's done in terms of
network i/o so now you have to make that
at i/o that interaction between
components as efficient as possible
and they start these problems only start
to become manifest they only start to
become visible
at scale so you run into a few things
you friend to two sort of big problems
and you move to this architecture the
first is when you build a distributed
system or you have potentially large
amount of data you now need to be much
more efficient in the way you process
that data our traditional model of
managing interactions between components
of managing i/o on the JVM it's not
particularly great for this right
our traditional model is an abstraction
if you look at the input stream in the
output stream these abstractions
simplify the realities of of i/o then
let us pretend that the next byte will
come eventually
not too long it'll come eventually and
we can just sit here and wait in the
meantime because you know the network is
gonna be there it's gonna be fast and
reliable of course these are the
fallacies of distributed computing right
and that's not a great thing to build a
system on so we need to we need to be
able to sort of work around these
limitations that you start to face when
you have unreliable system unreliable
networks this is not a controversial
idea of course right if you look at the
actual way that network i/o happens at
the lowest levels of the operating
system that is fundamentally
asynchronous you don't you don't sit
there and wait for a bite to come and
then just block you get you get a you
have a file descriptor or a descriptor
of some sort and the operating system
tells you there's i/o there's activity
on that file descriptor please respond
to it but you're not sitting there
waiting for it you know you can ask the
operating system to handle that for you
so we need to have that abuddin do we
need that ability to talk about i/o in
that same way in Java and of course in
jdk 1.4 more than it was it out 15 years
something like maybe can wind up four
they introduced in IO and IO gave us
channels and that's the fundamental
capability that we're talking about it
gives us the ability to say I have a
descriptor I have a pointer to something
that is a resource that has input and
output and it has activity and I want to
be notified of that when it happens but
I don't think most of us are writing our
web services and our database layers and
all that stuff with an IO are you ones
last time you know you all use channels
and an IO and stuff - yeah not really
right fair enough
most of us don't use fundamental Java IO
input stream and output stream either
for our web services in our data access
either right we we talk about these
things in too
of higher order metaphors higher
abstractions so we've looked for that
abstraction what is the equivalent for
this asynchronous i/o world how do we
talk about this in the same way right
we're looking for a way to describe a
large amount of data potentially
unlimited amount of data that may or may
not be here it may come now it may come
next week
what is the computing metaphor for us to
talk about that this isn't a you know
it's not a it's not like we haven't
tried if you look at the JDK the JDK you
know we have the completable future that
gives us the ability to say that we have
one thing that will come eventually
right but what we've lacked is a way to
say we have many things potentially
unlimited amount of things that will
come eventually there's no common
metaphor for that and a lot of great
technology companies out there have you
know tried to sort of solve or to fill
this gap right Microsoft Research
okay the RX extensions for dotnet that
of course begat rx Java over at Netflix
and you see light Bend nei typesafe they
have akka and that was a that certainly
solves a lot of that use case as well
vertex from from Red Hat that has some a
lot of the same use cases there as well
on our side we have a project called
reactor reactor attempts to fill in some
of these use cases as well so there's a
common enough space here that we've sort
of teamed up right a few years ago most
of these players all these players
actually and some more besides got
together in created something called the
reactive streams initiative the reactive
streams initiative describes very very
simply that missing piece it's that way
to say I've got a lot of data that will
be here eventually it's called a
publisher in the reactive streams
initiative a publisher is a thing that
produces data a subscriber subscribes to
the data from the publisher when the
subscriber subscribes to the data from
the publisher it gives a subscription
and the client they get the subscriber
can use that subscription and say I want
to request 10 more records that's the
most important bit what happens when you
move to this world where you have
distributed systems producing as data as
fast and as efficiently as they can well
of course now you run the risk of having
one system overwhelm the other right so
you need that that request method that
request method gives you the ability to
meter or to gate the production or the
consumption of data you can now say I
want more data but
only ten records at a time I can't
handle a million right now I can only
handle ten so just give me ten more
records
that's called back pressure and back
pressure had to be built into this
computing metaphor if we don't haven't
that computing metaphor we invite you
know we invite ourselves to be
overwhelmed by systems that are
producing more than we can handle so we
need these two things and if you've ever
built a protocol how many we've ever
built a wire protocol using TCP or UDP
then you know you're gonna have to deal
with back pressure or flow control right
it's called flow control and protocol
design you have to deal with it there
anyway so we have now this reactive
streams initiative and these basic types
and it's a it's a de facto standard and
it's such a useful abstraction those
four types actually there's four types
there's a subscriber the publisher and
if you have a component that produces a
that is both a producer a publisher and
a subscriber that's called a processor
so you have subscriber publisher
processor and subscription these are the
four types and that specification it's
very useful it's so useful in fact that
the now and gdk9 those exact same types
are present java.util concurrent flow
that publisher subscribe etc so those
types are now de facto standards they're
in the JK so we can build code on top of
that but for now it's very useful to
talk about the reactive streams
initiative is that enough can we go out
and build our data access layer can we
go out and build our web application I
think not right these types are very low
level they don't pocket they don't give
us the operators we need to think about
processing you know mutation
transformation filtering all that kind
of stuff so we need more and so these
are this is where these different
implementations can provide a lot of
value reactor does that for us we on the
spring team have built on top of reactor
we've built a Spring Framework five that
was just released last month brand-new
release Spring Framework five integrates
reactor and provides the foundation for
all the other spring projects to
integrate this reactive support we have
a brand-new web runtime in reactor in
Spring Framework five rather called
spring web flux so today we're going to
talk about a number of different things
we're gonna talk about Spring butoh
we're gonna talk about Spring Framework
five we're gonna talk about spring
security and spring data and the thing
to understand is that underpinning all
of this is reactor and this these
reactive concepts okay so let's build an
application we sure we struggle with
this mark and I we we thought long and
hard about this we know that we have to
build a word of the demonstration and we
thought
what if we had some sort of service to
manage pets and we thought nobody's ever
done that in the enterprise Java space
no but it's not it's never been done so
new never brand-new but but we thought
no that's not really data intensive
unless you have like a lot of pets so we
thought what about what if what if
there's some sort of some sort of
service where you could work with movies
over the web now again in English you
know well actually a little bit of
backstory here the reactor project has
two specialized types I should mention
this first the reactor project has two
specialized types one specialization of
the publisher called a mano-a-mano is a
publisher that produces zero or one
value it's still publisher you can treat
it like a publisher but it has this
extra semantic understanding this
meaning right there's another kind of
specialization of a publisher called a
flux a flux is a publisher that produces
0 to n values potentially unlimited
values why would you need this you know
this this this extra bit of nuance well
let's say you're trying to display user
interface and you've got a publisher
that comes back should you display a
table or a text field you know that's
why it's useful to know if it's if it's
mono or if it's a flux so with that
backdrop we thought okay we've got to
have a service that allows you to manage
movies over the net and we know that's
never been done before
right this could be big and we were
thinking if we had some sort of service
to manage movies over the net and what
in English it's a very common old-timey
jargon to say that a movie is a is a
flick and what is the plural of flick so
we thought what if we had some sort of
service to allow us to work with movies
over the net we could call it Netflix
right and so we thought we could build a
service the the flick select service
which is shortened for ffs or 4 flex
sake so so we're gonna build that first
right here it starts out spring there
now now III beg your indulgence my
friend each time we do this talk we
switch laptops I'm using Linux and he's
using a Mac and every time one of us
looks clumsy it's my turn to look clumsy
so sorry yeah yeah the coin toss with a
very weighted coin so
application here at startup spring that
I know how many of you know start that
spring today oh this is my second
favorite place on the Internet
my first favorite place of course is
production I love production you should
love production you should go as early
and often as possible bring the kids
bring the family it's a happiest place
on earth it's better than Disneyland but
if you're not already in production you
can you begin your journey here and
start that spring that IO and what
Windows gonna build in your application
using spring boot to MX we call this the
flux flicks service important to get
that right and we're gonna use the
reactive web support right when you use
that when use Lombok to make it a little
bit less tedious to get things like
getters and setters and so on we're
gonna use an actuator for operational
concerns and we need data access right
we need is some sort of data access
layer and there's a number of different
choices here that we could use that are
supported by spring data our data access
project umbrella project so we could use
you know Couchbase we could use Redis we
can use Cassandra Burke using MongoDB
all of our fine choices and these are
natively reactive drivers and we've got
a native natively reactive abstraction
on top of them we're not trying to stick
a reactive facade and come on top of
something that is fundamentally blocking
and synchronous so while we are
heartened by the recent release an
announcement of a a synchronous or
reactive JDBC driver that's not quite
here yet right so we will wait and for
that to happen but that's good news
right you know fingers crossed
who knows well in the meantime we're
gonna stick with something that we've
got so a lot of them are good choices
but we happen to have MongoDB on this on
this on this machine so we figured we'll
use that and and why not it's a fine
choice it it's it's a reactive MongoDB
if you want to lose your data and you
want to lose it reactively
there is no better choice than reactive
MongoDB so we'll use that right we're
gonna use that well hit generate I'm
gonna save this on the desktop not in
the cloud that's not a thing right now
it's not the right cloud why does it say
iCloud no I'm scared
come in chef D okay D yeah the other D
wait is it are we sure it's gonna be
okay
yes it's perfectly fine I'm terrified
okay probably fine your zip move your
cloud okay that's command nope okay all
right all right
we can do this look at me go huh okay so
here we are by the way you will want to
worship the Hmong God just to make sure
everything comes out okay oh yeah okay
fair enough
so Mungo D very good look at that and
opening this up CD desktop unzip this
okay and open this in our IDE and again
any ID work just fine we're gonna use
IntelliJ here but anything works just
fine just curious always I'm always
curious about this how many of using
IntelliJ just curious whoo Wow gu is
what about eclipse how many of using
some flavor of eclipse rock on also good
stuff great stuff
what about NetBeans also great stuff
anybody using NetBeans what about Emacs
are you here sir where's the MX guy Oh
who's the one guy well someone please
escort him out yeah every single city
country and continent revolted it's the
same human being all right so here we go
we've got our application um we are we
are there's a temporary glitch so we're
gonna switch this to dot om5 and that
gives us the ability to also bring in
security and we're gonna come back to
that in a bit
right so spring boot starter security or
a security reactive right isn't it right
there we go so there's that we're gonna
bring that in we're gonna come back to
in a second we're gonna comment it out
just for now because it won't help us
all right and we have now a flux flick
service application can you all see that
font it's only it's only larger than
both of us combined can you see that in
the back yeah okay good yes No
so I'm gonna build a new app an
application that manages entities of
type movie it's gonna be a MongoDB
document I'm gonna give it a primary key
or a surrogate key or something like
that we're gonna say ID and we're gonna
give it a a title field here as well so
there's that now of course we need to
get our setters to string and all that
stuff so we can use data when use all
args constructor and no args constructor
and these are both from the Lombok
project all three from the long bug
project and now we need some way to
manage the tedious data management
lifecycle of this of these of these
entities right so gonna create a MA
movie repository right so here we are
it's gonna extend reactive mongrel
posture so if you've ever dealt with
spring data then youyou know what we're
doing this is fairly straightforward
this is a repository that provides data
management functionality like MongoDB
you know for insertion for deletion for
updating etc but you can see that it
returns publishers Manos and fluxes and
so on not just synchronous values and we
can even create custom finder methods we
can say flux movie find by movie or
something is re fine by title there we
are
title okay so we can we can leave it as
that that's our custom Mongo repository
finder method and now I want to save
some data in the database so I'm gonna
create a sample data initializer right
so a sample data initializer and it's
gonna implement application Runner
application Runner is a callback
interface in spring movement spring boot
starts up it's going to have this
callback interface on these beans and
it's going to a see alt-enter
it's going to implement that it's gonna
call that run method giving us a chance
to do any kind of a initialization we
can write some data to the database so
this is what we're gonna do here we're
gonna writing data to the database in
this callback run our method here so I'm
gonna say that we're gonna create a flux
of some strings I'm gonna we want to
encourage audience participation this is
arguably the most important thing that
we'll do here today is come up with some
names on the theme of reactivity in the
theme of reactive programming so we're
gonna start with my favorite offering
from our friend spring boot co-founder
Phil Webb again on the theme of reactive
programming and functional reactive
programming but also movie titles so
silence of the lambdas right there's
there's that one
right okay there's the there's the first
one what else do we have what's a good
one well I kind of like is anyone in
Alfonso Cuaron fan so you do my montgome
be in yeah any Spano oblong taste here
so so you know that I mean literally
that's in your mother also but if we
swap out my MA for mono which is really
cool because then we get the reactor
theme an A and an added bonus because
mono is monkey in Spanish so therefore
in your monkey as well yeah there's that
that very good that killed him what
about that sci-fi movie with a flux
capacitor anybody remember that would
that movie is thank you back to the
future very good and there's a there's
an anime with the word flux in the title
does anybody here know that yeah
somebody called it out in flux a very
good and flex very good look at that
okay so if you think of anything
anything at all we will stop and go back
and add these names it is the most
important thing we can do it is this
brief time together so we're gonna
create a publisher of type we got we got
a publisher of type string right and we
want to map that one okay some movies
out of it so we'll say new movie new
movie with an ol ID passing in the title
there and then we're gonna flat map that
we're gonna create another movie we're
gonna save the movie rather we can use
the Mr I'm gonna save the movie like
this and this could be a lambda right
this could be a method reference rather
so there we go there's our publisher and
women sign that to a result there
there's our publisher now if we run this
code nothing is gonna happen you see we
need to activate this this this pipeline
it's like the Java eight streams API
nothing happens until you activate the
pipeline by subscribing to it so we need
to do that so we're gonna say mr but
before we do that we want to delete
everything that's in the database all
right what do i clear out the database
you know the expression of broken clock
strikes true twice a day every now and
then MongoDB saves our data and we want
to make sure that we have a clean it so
we don't have the same o entries over
and over so we're gonna say Mr delete
all then many passing in the movie flux
then many mr that find all and then
we're gonna subscribe
here so all we're gonna do is just gonna
call system.out.print line look at that
huh
so now let's see control R here we go
let's see if that worked mm-hmm all
right looks like we've got data we got
two written to the database everything
seems to be fine what do we do now buddy
well we're going to swap seats
I'm the talkative one so I'm going to
take over at this point really nobody
laughed at that oh my gosh I think I
need to go home all right
so so what is our next step well we've
already established our reactive
connectivity to our data store right so
we're going from our application down so
at this point we probably should do
something about defining an internal
interface so that's kind of where we'll
go next we'll define our service so
let's see service class maybe service
all right and we'll pray that final
repository and we'll inject that and
notes define our interface so we'll want
to return any flux of all movies right
so we can kind of get an idea of what we
have here in our stock so get all movies
and we will also want to be able to
return a particular movie so a mono of
type movie right movie boom so get get
movie by ID right passing in an ID for
the movie in question and then we'll
also probably want to be able to how I'm
just skipping ahead here
there we go public boom we also want to
be able to return a flux of movie events
now this would help if we define what a
movie event is we want to have some
operational visibility into our
application right into our service
because if we're streaming all these
movies we want to be able to tell what
movies are being consumed if we have a
movie that's being watched once per year
we probably don't want to continue to
have that movie in our library if we
have a movie that's being streamed 100
times per second we probably want to
look for complementary movies to to bulk
up our collection so I'm going to create
a class called movie event and we'll
let's see what we're going to attract
maybe a movie ID the movie
question right and maybe the date when
it was viewed right dude okay and of
course we're going to use Lombok and an
orc constructor all arts instructor and
that should get us what we need so we
want to return a flux of maybe events so
that again we can see what's happening
within our system so get events for a
particular movie ID right so let's go
ahead and flesh out our service API here
for good ol movies we'll just return
this stuff maybe repository that find
all simple pretty straight pass-through
for our get movie by ID return this
movie repository not find my ID passing
our ID again fairly simple now for our
movie events this would be really easy
if we had a million subscribers and we
will well at some point it's bound to
happen but right now we're just a little
short of that we've got one well not yet
we got 0 ok you setting you signed up ok
0 ok something so if you yeah if you do
sign up you'll be the first one but
until that happens until you sign up
what we're looking at is just kind of
faking it till we make it we're gonna
generate a stream of value so we can
kind of see what would happen if we had
no subscribers right so I'm gonna do a
flux not generate and I'm going to
create a sink of movie events new movie
event for our particular movie ID 4 and
we'll time/date stamp that and that as
it stands will just generate a just a
crushing stream of movie events which is
great but it's a little hard to follow
in a demonstration so I'm going to slow
things down a little and delay the
elements to where we get just 1 per
second and that's whoops let's see what
what just happened there yeah there we
go so and this is pretty good but
IntelliJ is kind of barking at me
because it's thinking I'm gonna return a
flux of objects I actually want to
return a flux of movie events and that
should do it
that'll define our internal API so let's
go ahead and expand
out to where we can access that
externally now one thing that's really
interesting is you did just delay it by
a second right yes justice what value
one value per second yes so that's
that's using a scheduler that's behind
the scenes here right now he's writing
fairly imperative looking code but it's
there's actually a thread pool there's
actually this thing that's scheduling
the activity behind the scenes and you
see that above when I wrote that data to
the database that looked like a 30 sort
of declarative imperative sequence or
pipeline really but it's actually
happening in different threads right you
don't have to worry about that you write
code in their active way using the API
and it'll make sure that it's correct
yes you can't exert the control but
there's certainly no need to and you can
grade on schedule custon you can provide
custom schedulers as well of course but
by default it's already got one that's
pretty good yep so told you has a
talkative one so at this point we've
established our internal API let's go
ahead and expand that out for where we
can access that elsewhere so we're gonna
create a rest controller how many spring
MVC developers like so yeah quite it
quite a handful there so so the the kind
of the one thing I feel like we're doing
really right and of course I'm a little
biased but one thing I feel like we're
doing really right is we're not
abandoning your years of hard one
expertise because so many times we in
want the benefits of a new model but
it's a little hard to wrap up and we
want to expose the full power of a
reactive stack without that huge steep
learning curve so we've approached
things it's a lot more work for the
spring team obviously but we've
approached things trying to give you
options and one of those options is is
in a format that's very familiar with
what you're probably already well
accustomed to so I'm going to create a
let's see let's see
crust mapping and we're going to go off
the movies in point we'll create a class
called movie controller and prior to
that final movie service
and we'll inject our movie service and
let's expose our external API get
mapping public flux of movies right
maybe yet we'll just call it all and
let's see what else we want once again
we're going to want to access a
particular movie
so public mono typos my love movie all
right by ID and we're going to leverage
a path variable to grab our movie ID and
finally we're also going to want to get
our events for particular movie so
events public flux of movie event events
once again path variable string ID and
let's let's go ahead and implement these
return this movie service dot get all
movies again easy straightforward simple
pass through return this top movie
service dot get movie by ID passing the
ID again very simple here we're going to
do a this step may be service that get
events passing the ID and that's close
right but by default rest controller
we're returning application JSON and at
this point we have an indeterminate
number of events one per second as we've
already seen so we need to somehow
signal that we should keep that
connection open now project reactor does
I keep winning gets by a like court here
project reactor does leverage WebSocket
it also allows you to implement things
via server sent events since we're
sending a pulse one direction every
second it makes a lot of sense to go
ahead and leverage server sent events so
I'm going to point out that this
produces a media-type specify this
produces a media type of text event
stream value which is enough to go ahead
and signal we're going to be producing a
stream of server sent events so let's go
ahead and restart this let's see go here
clear and get up and running so if we
hit our endpoint
we'll go here and test that and we have
a winner
okay so there are movies everything's
coming back and that's the second most
important part right yes
Oh third okay I lose track so let's grab
a particular one
we'll start with back to the future and
we'll see if we can retrieve that
particular movie that monotype movie and
yes indeed we did so let's go back here
and we'll see if we can get our stream
of movie events and we're up and running
okay so everything works but we can fix
it right absolutely yes we can fix that
so that's one way if you're coming from
the spring MVC world that works really
well so again this is a very low ramp
low on ramp the only thing this really
looks different is your return types
everything else is kind of the heavy
lifting is done by spring data which is
very very nice and one thing you should
keep in mind here is that this is not
spring ABC is it all right yeah yeah I
mean and that's one thing I kind of
hinted at earlier because the spring
team rather than just wholesale
replacing spring MVC which would be kind
of silly right created a parallel
packaging of Spring web flux so it
allows you again very similarly to do
something that you're very accustomed to
but the capabilities are actually
leveraging different different modules
or then spring so what what server are
we using here oh gosh I keep keep
skipping over things just quite quite
lightly with spring MVC you're
leveraging Tomcat by default and you can
obviously control that you can there are
interchangeable options same thing here
we're using Neddie as our as our
baseline for our container but once
again you have options any circle at 3.1
container will will work
however nettie is kind of the first
mover and well established in that
regard so we're using that as our
default our foundation so this is it
looks like spring MC walks and talks and
quacks like spring MVC but this is not
spring MVC right this is a brand new
reactive what Reb web runtime say that
fast T times reactive okay stop at one I
think that's pretty good and it's
optimized to handle large amounts of
data so we could return terms and events
until until the the heat in the universe
expires and that thing will keep going
as long as its plugin right
yes and the client won't ever run out of
memory it's gonna only produce data as
it has it whereas Swing NBC by default a
servlet based string mu C would attempt
to wait for the last byte the end of
file marker and then transform it into
Jason and send it back here we're doing
it incrementally do you want to go ahead
and do you want me to go ahead and get
the the function okay I just want to
make sure cuz I'm keeping an eye on the
cloth here we want to make sure we get
you out of here in an hour and 18
minutes right that's all we have left so
I'm going to again I mentioned that we
can fix this if you're not coming from a
spring MVC world if you're coming from a
more functional reactive type of
background that that is all well and
good but it's probably not what you're
used to seeing we you have options so
what I'm going to do is create a router
function of type server response right
and we're going to create a router
function here which will allow us to
define in a more functional reactive
manner our routes right we're gonna
define our endpoints so I'm going to
first start off with let's see your
outer functions dot route so we're going
to create your route we're gonna define
a request predicate yet and let's see
we'll start off with our movies endpoint
now at this point what we could do is
specify a new handler function which
this always makes me cry a little inside
right because what do we have with
handler function we have a functional
interface with a single abstract method
so what can we use to implement that
thanks to Java 8 all we really care
about is this right we want to be able
to handle a server request and return a
mano of type server response so one way
that you can do that kind of a nice
clean way is to define a component we'll
call this class movie movie handler
right and we're going to once again
leverage our movie service for our
internal API and then we're going to
define some handler functions right and
let's do that so we'll start off here
and we'll create our all method which
once again will return a server response
not ok it's all ok oops let's see what
we want to do here is create our body so
we're going to leverage our movie
service dot get
movies and will returning objects of
type movie right pretty simple
the next handler function we want to
create is our buy ID which once again
accepts the server request and we're
going to return a server response dot
okay
that body leveraging our movie service
get movie by ID and we're going to take
our request and extract our path
variable for ID write ID and finally for
our events method will return a server
response dot okay dot body movie service
dot get events once again passing our
request path variable extracting so on
so forth but at this point we need to
specify once again that we're leveraging
server-sent events so we're going to
specify our content type so let's see
media type dot text event stream and now
we can go back up here and get rid of
this ugly monstrosity yes what kind of
data returning we're assuring in
monotype server response right now Josh
I yes I forgot that
good catch boy and I forgot that up here
too ouch
that would have been fun so here we're
returning a movie and of course for our
events for returning objects of type
maybe event dot class there we go
thank you good catch that would have
been embarrassing front row I you always
count on the front row to catch my stuff
and and everybody was just too quiet
so ouch okay so now we can get rid of
this ugly monstrosity right well we will
be able to if we pass our movie handler
will inject that so now we can take our
request do a handler dot all passing our
request and if we want to add a route
and of course we do so we can do a
request predicate s-- dot get once again
for our movies ID right and once again
passing our request to our handler for
by ID and finally for our last route
we'll do a request request predicate get
for movies movie /id
slash events so we can grab our events
so handler dot events passing our
request and that looks pretty good but I
think we can do a little better now we
can do a little code cleanup when we
have a single parameter lambda we can
replace that with a method reference so
we just do that we we clean that up just
a bit and then we do some whoops yeah
it's like I'm on your machine again and
then we'll we'll actually do a little
bit of cleanup here with some on-demand
static imports so that come on there we
go that is nice and clean and concise
and readable yeah so is Ronis in one
place as long as we don't have any typos
we should be up and running so let's
verify that Oh return missing return
statement oh okay front row no t-shirts
for you all right so let's do this again
I guess I forgot to tell you so it is
back on me but I really kill in the
front row to catch my typos so okay all
right so let's see what we have clear
this mess and let's hit our movies in
point oh so nice look at that let's grab
the monolith um be in and let's see what
that works yes it does so let's go back
to our events and we'll see if we are
streaming our server-sent events and yes
we did it okay so style that all works
same results tomb styles two different
styles the choice is yours oh and now my
chair I'm free all right so the tag tag
yeah so thank you so we have we've
looked at two giveaways Timbuk the same
REST API why would you choose one of the
other well it's not an either/or you can
do both one is one is nice because you
have all the routes in the same place
and you can have the the endpoint
mapping and the requesting request
predicate logic in one place and then
you can have the handler that handles
that all in one place as opposed to
using the spring MVC style controllers
where your annotations are declarative
they're not programmatic they're not you
know they're not you know you can't
change them beyond the options that the
request mapping annotations give you and
also those annotations live in your code
so it may be sprawled across different
packages and so on and it might be hard
to get a single bird's-eye view of all
the endpoints that are in your
application but it's ID or it's a matter
of style do it you like obviously
there's a lot of other technologies that
have endpoint mappings kinda like this
right so in the in the Ruby on Rails
world they have Sinatra for example so
this is a just a it's a style choice
right you can do either/or
or both it's okay we've got this now um
are we done can go to production I think
not right there's a number of sort of
production concerned that we need to
care about like observability and like
security so let's talk about that when
we talk about observability we usually
think about things that help us figure
out what's going wrong with the system
if something is going wrong right
so in spring boot you know we have this
project called the actuator the actuator
provides a set of end points that you
can use to visualize her to understand
or to surface information about the
applications as it's running right but
in order for us to use that in a
reactive world we had to do some we had
to do a little bit of work to make that
work in spring boot to that oh because
now the actuator which is used to which
used to be a accenture or it used to
depend on spring em you see now works
independent of spring ABC it works in
spring web flex it works for jax-rs and
it works for spring MVC as well so in
order to enable that we have to say
management that was saying endpoints
that let's say health let's say we want
to enable the health endpoint there we
go so all I'm gonna do is I'm going to
enable that one endpoint we won't spend
too long here this isn't a strictly
speaking this isn't unique to the
reactive world it's just kind of
interesting so there's that there's our
um there's you know actual endpoints you
get that C if C HTTP colon clear and
HTTP colon 8080 forward slash
application forward slash helps okay
there's that so we got some health
endpoints set health information that
works in the reactive world now another
concern is security right we need to
build to lockdown this application we
couldn't deploy an application however
fast if we had no security and if you
think about how security works normally
there's a you know how many of you ever
used spring security I'm just curious
yeah okay the overwhelming majority it's
it's a very prolific very pervasive it
very very useful it's been around for
more than a decade so it's very very
stable there's a lot of great
indications and that the fundamental
sort of a assumption there is that
you've got some sort of security context
and that context has to be propagated
whatever you need it you need to be able
to say what is my current authenticate
principle that is typically managed by a
thread local well that doesn't work in
the reactive world does it so we had to
rework some of that into bring security
to make that work right in the reactive
world spring security 5 is natively
integrate with reactive and we can
do that here so what we're gonna do is
we're gonna go back to our build and
we're gonna bring in spring boots
starters security reactive just as we
had before and I won't spend too long
with you with the possible options here
let's just we'll handle security for
both authentication which is to say
answering the question who's knocking at
the door and authorization which is to
say what can that person do once inside
the house right so we're gonna say
security configuration at enable webflix
security and at configuration and inside
this configuration class we're gonna say
at beam and we need to do we need to
return a user details repository which
is a you know it's just this is how
we're gonna end to answer the questions
about authentication you can use any
number of different systems but I want
to have a simple example where I'm just
going to hard code users in my in memory
example so user dot with username J long
dot password is gonna be PW because of
course it's PW the roles will be user
and the you know then I'll build it then
we're gonna also well whoa easy
then we're gonna copy and paste that and
I will paste that here and we'll use
another we'll build another user there
I'm gonna give that to MK heck there we
go
that's mark and of course mark is a an
admin right we'll give him the keys to
the kingdom
they're scary so so there we go there's
authentication now that is useful by
itself that'll actually lock down the
application and require that they're
being authenticated principle for any
access to every endpoint so if I did
that that'd be a start
Ryan I could do that and here I could
say curl HTTP localhost 8080 forward
slash movies doesn't work right if I up
control a - V verbose you can see that
it says 401 unauthorized now if I go
here again I say - you J long PW there
we go there's the data on the bottom
there that worked now let's introduce
authorization let's make it so that only
the the the authenticated admins have
access to any of the data so here we're
going to create a security web filter
chain
Thor is Asian and in order to do this
we're gonna inject the HTTP security
builder for spring security and this is
fairly simple we say security dot H to
be basic and authorized exchange dot
ini' exchange has role so it has to have
this role right there's that end and
that's the end
dot build right there's that there's my
basic authorization okay so we start
that and we'll go back here now the same
request that worked before
whoops that same request that worked
before no longer works you can see it
says four three forbidden so try that
again now with a more reasonable human
being here we go MK h e ck and did I do
that wrong typo awkward at the end yeah
you've got oh thank you hi there you go
look at that right he got access to the
service so we've now secured the
application using back to spring
security again easy to do easy to get
right now we should build a client we
should you should build a client to talk
to this service so let's do that we're
gonna build a client and again we could
use you know we're gonna build a brand
new client we using a new service we
could use all the normal stuff right we
could use the rest template here but
again as with spring MVC which is geared
towards having the end of the payload
and being able to map it all to a single
response we need something that for the
client we need something that allows us
to talk about a potentially unlimited
amount of data right so instead of using
the rest template we're gonna use
something new here okay so all I've done
is create a client application so or the
shell of one so now let's go ahead and
create one right first thing I'm going
to do is eliminate any port conflicts
that's always a good thing pause can you
forget that you know that's always
accomplished yes there's a conflict so
I'm going to once again redefine what
our model is so class movie I think it's
okay to do that thing I said we could
never do ever or one thing that we can
never do that when not even when we're
all by ourselves at home and nobody's
looking but we have four
minutes I can do this in 30 seconds okay
so in time you can copy paste alright
well I'm gonna take advantage of this
because it's happened so rarely so of
course we don't need to worry about
Mongo we have a backup service to that
so so this is good right
let's see almost let's see data at all
arts instructor and that should be good
right so okay so what do we want to do
well the first thing we want to do is
create a web client so web client
actually web client client return web
client dot yep build right an older dot
yeah see I always get turned around the
security stuff because even though he
put me as admin he's actually far more
trustworthy than I am so let's see so we
want a filter and we want to let's see
basic authentication filter right go
back basic authentication has two
parameters oh yes of course okay so
let's see yeah you sure you sure you
want to trust me
yeah that's true okay so P W and let's
see that build right you have to base
URL oh gosh good point yeah we should
probably do that so where are we going
to hit we're going to hit our back error
movie service 8080 slash maybes dot dot
build yeah much happier okay so at this
point we have our web client configured
secure hopefully securely so now I'm
just going to do a command line runner
just in the interest of time so we can
create our demo and I'm going to inject
our web client here so now let's let's
get started here so return string args
and there's our lambda for our main line
Runner
now let's do this client ah yet right so
let's we don't need a URI because we
already have that let's retrieve let's
convert our body to a flux in this case
we're going to be bringing in movies to
start with let's see and let's filter
so let's filter out to grab a particular
movie so movie get
title dot equals ignore case what movie
do we want one this is our favorite
let's see okay silence of the land as it
is let's grab that boom okay so now
let's flap map that alright and let's
take that movie and we'll once again do
another client call so get Yuri and
we're going to add on to our existing
base URL your jury excuse me
with events and we're going to leverage
our movie yet ID so we can grab a
particular movie the movie that we're
passing in and then we are going to
retrieve that and we'll convert the body
to a flux again in this case we're
grabbing the movie events and then let's
subscribe to that so we can see what's
going on because it's always good to see
what's going on right swimming it all
works is because I just big leave a big
assumption and here we go me :
oh can you tell I've been doing some
Kotler lately so let's let's run this
now that we have our required semicolon
and see what happens oh look at that
actually works so so yeah we everything
has worked so far what is going to care
and react on now we have just a minute
so I think we should talk about my
cursors microservices and disturbances
no just kidding we we have just begun no
seriously this is just the beginning of
the discussion we have looked at
absolute basic stuff here we looked at
spring boot to toe which is due in
December we looked at spring security 5
which is due before December we've
looked at spring data K which is our TGA
and released they looked at Spring
Framework 5 which is GA and released
this is the foundation though you'll see
spring cloud Finchley which is our micro
services framework that will be updated
it is already you can already tried out
spring code Finchley milestones my m3
for example has support for reactive
programming for all sorts of different
things for client side load mounting for
Service registration discovery for the
circuit breaker for you know eventual
consistency and publishing and messaging
in innovation with the spring cloud
stream all the stuff has been updated to
work correctly in the world of reactive
api's we have beyond this we have plans
to get reactive with a whole bunch of
other projects in this Feeny Co system
so while we've talked about a lot of
stuff here it is just the beginning and
this is hopefully a valuable thing for
you or a good opportunity so with that I
want to say thank you so much for your
time what do you think did you get
something out of this I'm just curious
did you see something else okay good we
know we know that we went through a
number of stuff so don't hesitate to
grab the code there grab the bits we're
very happy to into questions if you have
them outside thank you so much thank you
mark thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>