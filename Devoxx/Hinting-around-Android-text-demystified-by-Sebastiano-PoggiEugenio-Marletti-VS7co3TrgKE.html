<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hinting around: Android text demystified by Sebastiano Poggi/Eugenio Marletti | Coder Coacher - Coaching Coders</title><meta content="Hinting around: Android text demystified by Sebastiano Poggi/Eugenio Marletti - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Hinting around: Android text demystified by Sebastiano Poggi/Eugenio Marletti</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VS7co3TrgKE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome to our
session so today speakers are me
sebastiano podgy work in London at
Nevada and Jill Jen you again working in
Berlin for clue so today we're going to
walk you through the magical and
mysterious world of text and typography
now has to be said text and typography
is not really a science is more a form
of art and as such there is rules but
they don't always fall into like really
formal rules sometimes it's a bit more
like creative especially when you talk
about Android in general but why are we
even talking about text well there's one
important reason text is important why
is it important because what makes the
difference between humans and other
animals that we know of so far anyway is
that we use a language as a mean of
communication and to exchange
information and share ideas now this
started really in the early days with
cave paintings that were the first the
first time that someone realizes that
you know people might might learn stuff
and they might exchange ideas but at
some point they tend to die because I
don't know about you but I think I'm
quite better not dying really bad yeah
yeah at some point I guess so they
started writing down drawings showing
how how to hunt how to do different
things in their everyday life then at
some point I realized that maybe someone
was really bad at drawing I don't know
probably I if I had lived in the in the
prehistoric age that would probably be
me and then they realized away maybe
there's a more formal way of transfer of
transmitting information and writing it
down so they created the first languages
and health and alphabets and an example
of an earlier alphabet is the rooms now
from the
there's been a long evolution at some
point a guy called Gutenberg came out
with a brilliant idea what if instead of
writing manually down everything instead
of having thousands of monks copying
everything all the time what if we had a
way of doing it quicker and invented
print so print was a really big
revolution because it allowed to share
information and print books way quicker
so that gave the the western country is
a big advantage over other countries
that still hadn't developed at that take
that technology and from there of course
evolution hasn't stopped and we arrived
to what is now the modern type setting
which is not just a digital typesetting
I mean since the the invention of
newspapers and with the the uprise of
advertisement and other other means of
communication there's been a lot of
evolution in changes from what was in
vogue at the time of Gutenberg now this
means that text has undergone millennia
of evolution and I guess all of your
developers which means you know
evolution long term there's a legacy and
as developers when we hear legacy we
kind of shiver and get worried if you
thought your project was complex like
this is more complex yeah yeah because
yeah it's a mess it's basically there is
the way text has evolved organically
over different countries different ages
it means that there is basically no good
way of standardizing it in a simple way
I guess that today if we were to invent
text today with the needs that we have
so transmitted information over wire and
digitally will probably have very
different way of writing things down i
would say json everywhere
yeah pretty much today maybe in 10 years
something FX text I rexxx yeah that
would be worrying though yes but it's a
mess we know but you have to say it's a
beautiful mess it's not just a mess for
the sake of itself if you just look at
how many different typefaces just in a
western language how many different ways
of writing something you have there's a
huge variety and its really really
interesting to see that like share with
some serif slabs and there's something
else as well someone invented Comic Sans
and not just that one but it's the most
commonly known example of bad looking
text and font okay now really quickly I
want to give you some more sense of
scale so when I say the text is
complexed and dealing with it is complex
I want to like do a proportion like
let's just say we start with what you
should try to have in your code so a
class that is probably shouldn't be more
than two three hundred lines of code
because if it does is probably doing
something wrong or too many things so
what you tend to do is to reflect the
things to slim them down and have a
smaller classes as possible now that's a
sensible maximum limit for the length of
a class but now let's just look at some
classes from the android framework so
the first just stick into texas typeface
typeface is a class that mostly
delegates to native it doesn't really do
much but it's got a lot of hooks and and
methods and fields that it needs to keep
in java and that's 400 400 lines of code
pretty much now keeping the scale let's
just see the next one so the next one is
drawable trouble is something that is
used is an abstraction over something
you can draw on screen that's the name
says is quite easy and roble is about
1400 lines of code pretty much now that
is still not that big because next up if
you
look the next one I found was context
there might be other classes with
different lines of codes in between but
just to give you an idea context you
know is a big object it's got a lot of
responsibilities and you can do a lot of
things now that's almost 4000 for
thousands of code but there's more if
you look at something bigger let's just
say view so view is basically the base
class for everything you I in Android
it's a huge thing too big probably its
twenty two thousand lines of code now
that is not there is no other class that
we could find in AOSP that is bigger
than that in Java anyway but the second
biggest class in the framework as you
might have guessed by now I'm trying to
drive the point that is text view so
text handling text alone is the second
biggest concern in in class size which
is a really bad matrix but still can
give you an idea now when I say that
text view has got 10,000 lines of code
it's not exactly true because if you
focus on these two yes it's helpful a
help of you pretty much but then you
consider that there's a bunch of code
from basically text view that has been
extracted into a separate class that is
called editor and that editor class is
basically only used in text view I'm not
going to go into what that does but that
is basically can be considered part of
the text view size so what you get is
that actually the tooth together are
almost as big as the view by itself
which is quite quite impressive I think
and now if you see edit text edit text
you would think it's a big thing because
it's it's a text view that you can
change the contents of right well turns
out the edittext is just a text view
with a couple of settings so edittext
doesn't really do anything for you
almost nothing and I haven't forgotten
the dot for four
ready text is actually there it's really
small in comparison so just to give you
an idea of this small fact now when we
talk about metrics and in text sorry we
need to know when we talk about text how
do you lay out the text how you measure
it and it is something that you cannot
just say okay this the text is from here
to here just doesn't really work right
especially when you when you deal with a
designer the designer will be like oh
yeah you know this font is 14 points but
then the sender's are like 10 and dis
understand too before so just to give
you a rough idea of where the baseline
is what did you just say so let's just
quickly see the main metrics and i'm
just we're just going to look at the
main for one plus one and these are just
the vertical ones because they are the
ones that have a meaning in general now
let's start with the baseline the
baseline we're developers it's the the
origin of the vertical coordinate that's
quite easy now that's the zero but then
you start having some content there so
yeah for example a capital letter the
height of the capital letter above the
baseline is called the acent sorry it's
called a website all the capital letters
tend to have the same website usually in
phones unless you are using a really
weird font in which case good luck
happens all the time yeah well just
don't do it well there's not much you
can do now lowercase letters have what
is called the x height which is well the
hive of the lowercase X above the
baseline that's a standard measure of
lowercase letters because again they
tend to have the same all of them tend
to have the same exhales which doesn't
mean that they don't go below the the
baseline sometime
because some details might but they're
all considered to be anchored on the
baseline anyway now next up is we've
said there is some stuff that goes below
the baseline right and this is the
metric that determines that measure is
called descent next up of course we have
stuff that goes above the normal
lowercase letter and it turns out that
actually the lowercase letters that I
have an ascender so a part that goes
above the x height usually are slightly
taller than capital letters now that is
called a scent as a metric for a second
let's just we have seen a few of them
but what what about when we have
multiple lines we've just seen stuff
that is inside of a single line of text
so if we have multiple lines of text
what we see is that the space in between
the lowest point of one line and the
highest point of the other line which in
this case are the descent and the ascent
respectively might be different that is
called the leading and it's another
another metric that we have to consider
now this is all nice and fine but what
about Android how does it work on
Android because those were design matrix
as in typography pure typography metrics
well on Android there's a class that is
called font metrics which is a sub an
inner class of paint and that exposes
four metrics which it's interesting you
have the accent you have the descent you
have the top and you have the bottom
what that's what what are those so
basically let's go back to the text we
had before so it it happens to be that
first of all we have to consider we're
drawing on screen so a first really
important thing that has to be said is
that the vertical coordinates are the
opposite that you would expect so for
example well the baseline is 0 is of
course still 0 but the ascent which is
there we have it but it's going to be
negative and the descent on the other
hand which we still have is going to be
positive now that might be surprising it
at first but then you understand that
the origin of points on the screen is at
the top left corner so it makes sense
but we have said there is top and bottom
and what what really are they so it
turns out that not everybody only uses
normal baseline Latin alphabet there's a
lot of languages that add accents and
decorations and and everything else so
the top is actually the highest that any
glyph inside of a given type face at
that phone at that font size can go
above the baseline that means you are
ensure that nothing will ever be painted
outside of the top can you be sure well
theoretically yeah that's the corner
again it's an Android so maybe maybe
hopefully and the same goes for the
bottom like for example in polish you
have the little tail which is that funny
character down there and that would be
going below the descender and in that
case the bottom will include that kind
of character as well now don't be fooled
by this this is just to make you
understand but most likely when you use
it in production you will see that the
top and the bottom are actually far away
from those from the top and the bottom
of those decorations because there's
other glyphs in a font like there might
be Japanese there might be Korean there
might be some weird Indian dialect like
there's a lot of possibilities for a top
and bottom that
don't read the choice of the typeface
makers they if they want a can equal
more space for ya beauty reasons yeah
they could reserve more more Headroom
now the what is the font size that you
said when you set a font size on a
typeface the font size is basically the
distance in between the top and the
bottom it's quite easy and when you set
when you set that it's you always have
to consider that when you see like 14
points in I don't know Photoshop or
something else those points are
basically pixels at mdpi and then these
only works if the user has inset large
text because if there's an extra scaling
on top of it basically you know I'll SP
is work there is a scaling factor on top
of the piece which in turn is a scaling
factor on pixel so it's a double scaling
that you have to keep in mind when when
determining the pixel size ok so that
was the main the main thing about it but
how do we actually deal with the metrics
yeah because we're missing like the x
height and yaps height yeah we don't we
don't have those you have to do it
yourself so what you do is you go there
and you measure a string that is made of
the one character you want to measure
for example you want the excise well you
measure the lowercase X and see how tall
it is sounds silly but that's how you do
it or the cap site you just get a senior
string with one cap and that's your
website and hopefully the right one
because it could change obviously but
yeah mostly it's the one now yeah don't
don't judge that's if you ever have to
do that yourself that's how you do it
there's not not many ways around it ok
so we've seen a bit of history and
typography so the design perspective of
it but then we're interested in drawing
on screens because that's the new way of
doing it right ok so you might be
familiar
the difference between raster and vector
roster is pixels and vector is shapes
you can have funds that are both like
made of pixels or made of shapes we're
really interested in the raster ones are
more interested in the vector ones they
still have to be drawn on a screen which
is made of pixels right let's just say
raster phones are the old old phones
that you add on old system because they
didn't have the dr dealer capabilities
to actually draw the vectors yeah cuz
obviously for performance reasons it's
much easier to have pixels and just
drawn on the screen but then it doesn't
scale if the screen changes or if the
text size changes so you are you
familiar with a truetype and opentype
this is like the windows icons we're
very nostalgic truetype was the first
format created for this thing and very
popular but then open type is actually
the one that came after it and it's much
better has many features that you don't
need to know all of them but just know
that they are plenty for example you
have ligatures which is when you have
multiple characters that don't look very
well together or it might look better
they actually blend in some ways and you
have an entirely different beliefs you
have fractions you have rules for
substituting characters when they touch
or not or when there's like multiple
characters together they become a
different glyph what what do you mean
exactly when you say glyph yeah a glyph
is essentially the shape of a character
inside the advice I said yeah for
numbers there's like six different ways
to do ya to show numbers and you can mix
and match the different properties of it
and also the typeface creators have a
lot of freedom when designing that they
don't have to say have proportional
numbers or monospaced numbers they can
choose whatever they want and we're
going to see if you cannot choose you
might be stuck with a default which is
we might not be what you want and yeah
that leads to hugs let's see that in a
bit so okay that's the styrian now the
engineering problem is how do we go from
a shape to a bunch of pics
so drawing shapes vector shape is not a
new science like people have found ways
to do it but text as an added complexity
in the sense that not only the shape
that you're drawing you want it to be as
close as possible to original but he
also wanted to be readable because when
you have very few pixels it doesn't
really matter if the shape is close to
the original it matters that you can
actually distinguish it from the other
characters right so a simple way to do
it would be just you know if enough of
the pixel is covered by by the path then
you make it black otherwise you make it
white and that's the result as you might
imagine this is very jagged and when
it's very small it's not really readable
it's an effect called Eliza ng and
there's a technique called auntie
realizing which tries to mitigate the
effects of it now this is probably
better in a way but it's still not as
readable as you like so and it really
depends who is doing the Eliza ng that
the font engine makes a lot of
difference yeah this is yeah depends on
the parties involved in the rendering
process for example there might be if
you're using a system that has been
developed by Microsoft you're going to
have they're going to prioritize
legibility whereas if you use a system
that is done by Apple they say oh I like
this typeface I'm just going to make it
look pretty i don't care if you cannot
read it yeah it's your problem and
there's also like a very original
technique that i found that a sort of a
hack but it's really effective to show
it to you I need to open your mind first
so what if i told you that there is no
pixel what we perceive as a single
entity is actually on LCD screens at
least made or different parts so the
different colors generally tree could be
more are actually physical diodes on a
screen right so what if you try to
imagine that as your single pixel and
have a grid of it okay and then turn on
and off the single subpixels result is
something like that which is super weird
to look at in a screen shot because
obviously like it
looks just color in every way but your
mind your eyes actually gets tricked
when the light comes from the screen and
the colors blend and you actually see
them as sort of gray I'm going to try
and show you an example though this is
not the right between to do it but so if
we turn the size down a little you might
see the difference between them and if
you want them one-on-one this is
actually how it looks like it's quite
interesting but you can see that the
subjects are pixel one well sort of it's
actually the closest one to to the
original and the more readable so yeah
there's also second technique this is
just for rendering right there's another
technique called hinting which is
something that takes information from
the typeface creators to know exactly
where the pixels to the line in the grid
and maximize readability it works
together with a rendering and it tries
to maximize yeah it's basically the idea
behind hinting is that if you have a
straight line then that should be a
straight line you shouldn't be a lucid
so you can see it here in the first case
like the the ascenders of the B are
blurred whereas the indeed in the second
line using hinting the system rent knows
that when rendering that glyph that
should be exactly on a pixel so it
doesn't look blurry yes so what an
Android then Android as you might know
uses something called skia it's an open
source project for 2d rendering used in
like Android chrome what else other
sublime text sublime text 3 and yes yeah
I can draw essentially anything to do
related except text it doesn't know how
to draw text and it uses free time with
another open source project used by many
more actually even I OS Linux and others
used free type because it's like the
biggest open source project for that
kind freetype itself had for a very long
time I hinting engine which was good
enough I would say and you might have
noticed since android 4.3 that i
actually work with adobe to least
they're hinting ng which is so much
better and now everybody using free type
can benefit from for
they're amazing system using google yes
thanks google absolutely okay so Android
something else you should know it's
called spent you might have used them or
not i'm going to introduce them quickly
essentially when you have a string okay
string is made of characters and sponge
are not extra characters they are
literally metadata attached to a range
of characters and spans could be
anything there's no the system doesn't
enforce any interface or or base class
they can really be object yeah which is
a really nasty API yeah the FBI's are
not great like you need to iterate an
array-like yeah anyway that's the way it
is so spans why are they useful you can
use them for your purposes you can you
attach any object and retrieve them
later but they're even more useful when
the system uses them and in fact the
frameworks puns are even more
interesting to the custom ones so I'm
going to show you how many are there
these two packages mostly we should look
into android text andrew textile and
inside of those you have a lot of them
so you don't need to know all of them
but if you ever need to do something
crazy like a very specific customization
of text you might want to check them out
there like not very documented as usual
but if you look at the source code and
just experiment you should be fine it's
also quite interesting to see if you
look quickly the stuff that is in the
textile package there's like a
text-to-speech span there's a spellcheck
span suggestion span is like a lot of
stuff that you wouldn't expect is
actually implemented using spans which
is a quite interesting yes as a matter
of fact even cursors as pants and
selection or spans so yeah what's
important to understand is that it's not
just for changing the rendering side it
can also change the layout they can
treat the behavioral stuff it's very
interesting on something i should say if
you saw all of these all of them they
actually implement parse levels plan
which means every time there's a
configuration
change or the app goes into the
background and needs to be recreated
from scratch they will be saved so your
text if you have touched pans of this
kind to to it it will be there will be
carried over and when we created if you
try with your customs plans to implement
principles bun it's going to crash your
application so whenever you need to
carry your own information you either do
it by hand so you create your custom
view or activity and by hand recreate
everything or you could use the
annotation span which allows you to add
like a key value of your choosing and
carry information that way it's pretty
weird then you still have to read it
when you come back to ya rien ready our
own sponge it's only a vector of
information but you still need to
recreate the actual spans but yeah
anyway that's the way it is and we
cannot change it okay so how do we deal
with Spence you might be familiar with
string which is a Java class and the big
brother stringbuilder what's the
difference between them well swing is
immutable string builder is mutable so
you can actually change the contents of
the string and so this is pure Java okay
there's nothing more to it android adds
another layer it starts with the span
interface which allows you to get let's
say read-only mode spans again it's
implemented by the base class band
string which is like an immutable string
with immutable spans well read only one
immutable by you get the idea then spin
a ball extends pant is implemented by
expandable string again the string is
immutable the span is mutable so this
time you can actually change the spans
attached to it you might guess what this
is going editable implemented by span
able stringbuilder so you can change
both these pants attached to it and even
the string itself okay interesting that
for textview you generally have a
spanned and for edit text you have an
editable that's that's the difference I
was telling you about those 150 lines of
code are actually just saying don't use
a span able use an editable configured
so Linda ALS yeah okay good um so how
would you draw text on
Android you use a text view or edit text
that's how you do it generally there
might be some times where you want to go
further like you want to create a custom
component or you have a specific needs
like you need to know exactly how big
the text is in order to you know draw it
on a bitmap throw it on a bitmap or yeah
any kinds of you yeah you I issues you
may have so how do you deal of holy zeal
drawing and measuring text without text
view you do exactly what textview does
use a layout which is not the normal
layer you might imagine a text layout is
essentially well you can imagine it as a
view in the sense that it will handle
its own measuring and drawing but it
doesn't extend view at all I for
performance reason this is just a
convenience class that allows you to to
to measure &amp;amp; layout and draw text which
is very complex I never try to write
this yourself but this is crazy it's a
huge huge class it has three
implementations so the first one is
boring layout which is the simplest case
you can imagine a single line right to
left and it's pretty much it again keep
in mind this uses pans you mean do left
to right left right yeah yeah this you
just pants to do all the measuring
through the different rendering if you
want so this is supported well we'll see
later if you go deeper and actually do
the rendering spans are not supported
sponsor a concept created by Android for
this second one is static layout as you
can imagine is like every other case
where the text is immutable so you can
have multiple lines you can do pretty
much whatever you want it's obviously
more efficient than the next one which
is dynamic layout there's a layout where
you can actually change the text it
catches some results and it tries to be
as efficient as possible but yeah it
will not be it's basically static layout
is too expandable just as editable is
for the dynamically yeah if you try to
change the sponge on a statically out
now can you do that I don't know well
experiment you'll figure it out don't
worry long yeah but then
how do they in turn do all the measuring
and rendering so we need to go deeper to
understand that how do we render text
and Android so well those are method on
canvas a canvas is a skia class
essentially it's a wrapper around skier
drawer text is very simple you give it
coordinates x and y you give it the text
and you give it a paint and you could
paint your text okay again keep in mind
that it will paint the entire text on
one line with like one color and that's
it if you want to have different words
with different things and you want to do
by hand you would have to literally
measure every single step and render
every single character or board in a
different way which is crazy and it's
the reason why we use layout the other
one is draw post text which is
deprecated I don't know why it's in the
slide but yeah because it's deprecated
yeah they're still there anyway don't
use it don't use it it's technically you
can give it an array of position for
every single character if you want to
somehow do stuff with it and then much
more interesting rotex on path as you
can imagine you can draw text on any
path if you like so powerful and yeah
kind of fun with shapes there's an
another one another method which is not
performant but if you ever need to do
special effects you might use it you can
ask a paint to give you the single path
of every single character in a string
and then draw them if you ever seen any
of those fancy application where they
draw the graphics like with a line that
it's drawing things little by little you
can do the same with text this way for
example why not as usual there's a
problem because it's never so easy
hardware acceleration is an afterthought
on skia in the sense that originally it
wasn't there at all and then they
realize that the CPUs couldn't keep up
with the screen sizes and so let's say
yeah let's add other acceleration except
they didn't add all of it just a portion
of it so forth texts what does it mean
for you it means draw text on path is
not available before 16 fortunately so
if you need to do it
you will have to draw it on a bitmap or
disabled hardware acceleration and also
there's a problem with scaling so
normally when you draw something it will
be drawn one on one on a GPU texture and
then rendered so that means that if you
scale that it's going to be super
pixelated and you're going to see lots
of artifacts that's depending on the
call you make for example on your text
before 18 that's what happened so if you
ever wanted to scale your text before
that you would have to pre scale it on a
bitmap or something or again disabled
hardware acceleration your text on path
not to worry at all so again same tricks
and draw path in case you go through
that route is also not supported at all
yep so the other little piece is paint
which is the vector that carries
information to the native code to skia
to actually do the real drawing there's
a subclass of it called text paint there
has some extra methods especially for
text what do we have well background
color based on ship link color drawable
state density well it's pretty
self-explanatory what's interesting is
that it has some hidden properties like
underline color and underline thickness
which are very useful and the only way
you have to access them is to reflection
but as usual word of warning don't try
to do it if it's not really necessary
and even when it's necessary always fall
back to the case where it's not working
because it might happen I guess did the
alternative is to draw it yourself by
hand in doing a test run don't do it
what else yeah there's also a few flags
that you can use while painting pretty
self-explanatory the one on the left but
I wonder right are quite interesting so
whenever you are drawing text it's
actually doing a lot for you it's
catching all the the render text in a
sort of Atlas and then using that
instead of redrawing every time right
but what if you want to animate your
text for example you want to scale it
from bigger to smaller that mean
is your your cash your Atlas is going to
be completely useless and even it will
add overhead to it right because every
single step will be drawn to this Atlas
and it's going to blow up and it's going
to be uploaded to the GPO every time
because yes let's remember this is done
on the cpu and then upload it as a
texture so it takes a lot of time and
also with a hinting and all the
rendering tricks every time you try to
change the text size it's going to be
slightly different than before so it's
not just going to be like a path scaled
up throw down it's going to be a
different sort of shape every single
time and the effect is absolutely
terrible so if you use the linear text
flag flag these actually disables all of
that and when animating it's going to be
super smooth and the effect is gonna be
perfect and then take it out when you're
done yes absolutely sub-pixel text so
sub-pixel rendering is not available on
Android at all you don't generally need
it because you have enough pixels anyway
but if you want to still lay out your
text as if it was a pixel rendered you
can it helps the mind not my slightly
improve the ADA measuring yeah and it's
on by default to think anyway it it
depends on how you create your paint
yeah it's off by default but you can
yeah you should enable it if you have
small text or something like that and
then hinting as we saw before you can
turn it on and off it's on by default
and it's it interesting again hidden
flag don't use it but it's this is the
true the real sub-pixel rendering it's
LCD render text flag if you just want to
see how it looks you can try but never
use it in production I really advise
against it if you want to know more
about the especially the GPU side like
the hardware acceleration side Roman
ghee has made an amazing article about
his own experience writing that part of
the framework it just gives you a sense
of the complexity and it's amazing this
is just a specific portion of the
rendering pipeline so imagine doing all
of it it's quite crazy you can find a
link here we'll publish the slides later
so you can grab it again hardware
acceleration goes
and I don't know breaks all our dreams
again well every time so there's no set
auntie Elias before it does break them
but it makes them buttery smooth sure
and yeah it does what it works auntie
Elias is something you will assume to be
working every single time right but it's
actually not before 18 so you would see
these very pixelated text if you try to
use out of acceleration for text setting
near text doesn't work at all sub pixel
test doesn't work at all so when you're
using hard acceleration be careful
because those will not be working if you
do animate text disable hardware
acceleration and use linear text and
then swap it back surprisingly well if
you're scaling the time yeah if you're
scaling it if you're moving it and it's
fine don't worry okay some cool stuff
that happened with lollipop actually we
have some unam methods and things that
were not possible before for example set
letter spacing allows you to add a
specific spacing between each character
which is something you would assume is
super basic but it just wasn't there and
every time you had to stretch for design
reason a string you just had to use
crazy hacks again like introducing a
character and then using a span on that
character to to stretch you this line
here now its native you can use it and
it works then we have set elegant text
height which nobody really knows what it
does like the definition is select font
variants that have not been compacted to
feel 18 based vertical metrics and also
increase this top and bottom bounds to
provide more space I don't know yeah
something supposed to maybe making it
look slightly better yeah I guess but
only for certain typefaces yeah I tried
and it doesn't do anything for this
anyway yeah and then the real deal the
actual revolution that happen in
lollipop is set fun features so we seen
before the open type features right that
actually already available on CSS on
when you CSS on the web you can change
all of them turn them on off and stuff
it was absolutely impossible and ray
before so if you wanted to change any
default you couldn't and now you finally
can with this and it uses the same
syntax as CSS which
a nice added benefit so yeah that's
really cool and you can do so much with
that unfortunately lollipop onwards so
yeah okay so this is rendering right
when you want to render text by hand
this is what you do but you cannot do it
unless you know where to place it
because you know with all the baseline
stuff if you try to just draw it at
coordinates 00 it would probably not see
anything because it will be over the
screen essentially so you need to
measure how do we measure text for real
like at a very low level so first of all
let's have one string you want to
measure the string you have two methods
mainly paint measure text gives you the
the actual length of the text including
all the padding's of the single
characters this sort of confusion
especially on stack overflow we should
post a reply to a case like this age-old
discussion about the difference between
this and get text bounds and people
never figure out the difference between
because they yield different results as
you might imagine well what is a float
and the other is a rectangle yes but the
width are different that's because get
text bounds actually gives you the exact
bounds of the single shape of the single
glyphs of every character while get a
measure string measure text gives you
the real string of the real wit of the
string right that you need to consider
when laying out stuff yeah exactly like
when laying out stuff the the first one
is the one you want to use not this one
this is for very very special effects
like I really want to cram as much space
as possible or something so or to
measure glyphs if you need yes I exerts
what you would use yes yes it is okay
but then what happens when you actually
so imagine you want to write a text you
from scratch for you know at a science
experiment how do you get the real
height and that's as we said before when
the phone metrics top and bottom come
into play so if you use those as your
height and measure text as your width
you will have the real bounding box
which is exactly what text view or the
layouts do when laying out and rendering
text right
interesting enough textview also allows
you to not use top and bottom but as an
indecent there's a property called
include fun padding it's owned by
default but you can turn it off in case
you want to cram the text even more if
itself is going to use the ascent and
that's an indecent yes and basically if
you're sure that you're never going to
use anything that goes above the top or
below the bottom then just enable yeah
but even there like very little kids we
always always never assume anything
because fonts are crazy and there's only
not even done to be to be drawn on
mobile they're drawn to be the may to be
drawn on prints and stuff like that so
always always experiment and try because
it's going to be weird and also if you
do get text bounds it might be off by a
few pixels keep that in mind it could be
one or two but it's never going to be
exactly perfect so yeah always you might
see your text being slightly inside or
slightly outside of the bounds it's kind
of a rough estimate yeah yeah oh and one
other thing the bounds are actually
rectangle but the interesting
information inside rectangle is not just
the width and height is actually the
position of the rectangle and that's
because as you see it might be shifted
because of the character spacing and
yeah that's what you have yeah okay
there you go so now the world is not
just us and what you've seen you might
think that was complicated but that was
just bread and butter thing the basic
like the basics if you live in a western
country and you only use one alphabet
that only goes in one direction it's
easy ish easy if you want to step up
your game what you would do is you would
start considering that there's other
ways of writing text there is just
saying that the main ones are well we
use left to right but there is there are
cultures that use right to left which
we're not really used to probably but so
left to right is exactly what you would
expect from text that's what you would
write if you were to write to something
but then someone that comes from the
Middle East might actually
write in arabic and they would start
from the right and that's how the arabic
and other languages work now that is in
and by itself quite a funny thing
because you need to start thinking oh
wait is my text going to be in one
direction or in the other well you don't
do it because the layer does it for you
that's why you should never do laying
out the text yourself because that's
just stupid yeah and really painful yes
but there's one more case that is what
will definitely drive you nuts which is
embedded runs so if you take a run of
texts or any amount of text that goes in
one direction not the band and you have
inside of that run of text something
that might be in a different language
that is maybe in the other direction so
for example you might have some arabic
text which contains the title of a book
in English I've just taken that one off
of the BBC arabic news website which is
actually quite interesting I cannot read
it but it looks nice you should say
about the cursor like I yeah don't worry
okay one more thing I want to say before
the cursor is you might notice that that
text is quite low quality that is
because keynote doesn't know to end the
left text it just screws up completely
and shows text all over the place what
is supposed to be happening here and the
way text is supposed to be dealt with is
that you start from the right until you
get to the question mark which is an
Arabic ? after that the text is
logically continuing from the h and then
you will still go in you would resume
going from left to right until you you
reach the end of the y after you press
right again at the y you will go and
jump to the quotation marks you press
right again and you go left so that's a
funny thing I don't know if you ever try
but if you have like Google Drive and
you start copy pasting embed that runs
you will understand how crazy it is
because you press right and it goes left
and then it goes right again
it's really messy again don't do it
yourself don't hurt yourselves there's
really literally no reason to do it and
there's something else this is not all
because there are languages and again
Arabic is a good example that require
shaping what is shaping shaping is
basically if you take any single
character in inside of the alphabet and
use it by itself just putting one after
the other to form a word like this I
don't know what that means but still
that is award but if you take it as it
is like that and you show it to someone
to speaks Arabic they look at it and
like what is that I don't that doesn't
really make sense so what you do and
it's not just the rabuck there's a bunch
of other languages that need this as
well what you do is you do shaping which
means you change the shape of the glyphs
when they are close to each other and
that's basically a really extreme
variation of ligatures if you will you
change the shape of the glyphs because
then when the ward is formed then
putting all the characters together then
and only then it makes sense now again
it's really complicated luckily enough
the system does it for you if you're
using Android 4.2 or later because
before then support was patchy at best
and before 4.0 I think there was
basically very very little support for
it so 4.2 is a safe bet anything before
then no don't do it it even helps with
when you do layouts like XML layout the
real ones you have automatic support for
mirroring of all the things which is
great yeah including bitmaps yes so what
about before so if you had something
that you had to support I don't know
Android 2.3 may God help you then what
do you do well you do acts it just hack
your way through until you can make it
somehow
and it's crazy it's crazy is going to be
slow is going to be painful it's not
going to be perfect is it can kind of
match it so why am I saying this because
actually I had to do it I was working on
this SmartWatch with his called I'm
watch it's now companies closed but the
product was launched in 2011 and was a
SmartWatch running Android now you do
the math in 2011 we had android 2.3 not
4.2 now the I'm watch actually didn't
even run gingerbread it ran android 1.6
because of various reasons including
performances and hardware that was
available at the time so we couldn't
upgrade it even though 4.2 was available
at some point we couldn't upgrade it
because it wouldn't run on it so how did
we do it we had to support a rabbit
because we had customers in the arabic
peninsula that needed support for it and
proper support for it now how did we do
it well you can guess hacks of course
all over the place so what we had to do
was to basically every time some run of
text was to be displayed when it was
assigned to text view for example we
would have to cycle through it with a
full loop and just detect when there was
a glyph that was meant to be in an
alphabet that has a different direction
and basically inject unicode control
characters that is the only way we could
find to make it work on android 1.6 and
we were lucky that there was some basic
support for bi-directional text because
it was in the Unicode specifications it
just was not enabled and so you had to
inject those control characters in there
to make the system think oh wait I
actually need to show this the other way
around or I need to show this embedded
run in a way that makes sense so yeah
it's been quite quite funny not to say
painful was this the reason why the
company closed yeah no it wasn't but it
could have been having yeah now
this is the main takeaway of this old
section that I've done on left to right
and right to left do not do anything
before API 17 ever if you're asked Oh
should we support aerobic we need that
as a business and you say yeah that's
fine let's just bump the minimum SDK
version 2 17 business is going to say no
but you know the project managers nephew
has got a really shitty samsung phone
from 2012 that runs android 4.0 well you
say either that or you give me four
years to do it it is less like a try to
stick to buy a new phone yeah it's less
expensive to ship new phones to cast yes
yes and it is to actually code all the
stuff yourself so yeah that's the main
takeaway and also a good leverage point
for you if you want to bump your SDK
version and get some of the nice list
that you will get in jellybean you can
link up presentation as a source yeah
yeah it's fault yeah okay so this is it
the slides are going to be uploaded at
the link at the top as soon as we have
the time to so yes by the end of the day
and yeah there's a bug currently on
speaker stack which makes it slide
horrible like all the colors are wrong
but you can still read them so yeah yeah
and we will link the keynote
presentation as well yes yes so if you
want to yeah see how we did it or
anything you can and and our companies
are hiring by the way which is like that
yeah yeah both of us so join us come
play with us yeah Berlin London Berlin
Barcelona and Liverpool yes if you have
any questions we have five minutes ish
yeah so if there's any question and we
know we're not available to come and fix
your texture issues for you know if I
dealt enough with it you can grab us
later though as you want to ask again
present and you can also bring us on
twitter if you want so now questions
oh well yes we that good no so the
question is is there any specific
requirements for Android wear the answer
is no because Android wear was born on
Android 4.4 and it's a normal Android
distribution so you get all this stuff
for free and Android where you can
actually be ensured that it's going to
be updated to the latest version for
like all the devices will receive an OTA
because it's google doing that currently
I think it's on 5.1 and they do it yes
release an update to marshmallows
explain Oh at some point but all of it
applies the same it is undeterred one
hundred percent so you can use
everything you've seen the presentation
every single thing on Android wear
without any problem anybody else another
question no mMmmm cool okay thank you
very much thank you don't forget to rate
the session if elected yeah and we have
seekers if you want oh yeah we also
stick this come over</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>