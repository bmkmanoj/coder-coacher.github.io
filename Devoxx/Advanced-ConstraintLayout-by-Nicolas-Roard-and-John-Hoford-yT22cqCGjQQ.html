<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Advanced ConstraintLayout by Nicolas Roard and John Hoford | Coder Coacher - Coaching Coders</title><meta content="Advanced ConstraintLayout by Nicolas Roard and John Hoford - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Advanced ConstraintLayout by Nicolas Roard and John Hoford</b></h2><h5 class="post__date">2017-04-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yT22cqCGjQQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Nicholas rod this is general
fob and I'm the tech lead on on words to
do for the design tools and content they
are and John where I work on constrained
layout and on the grid builder so we'll
bring today out and just read a bit of
background why we created constantly ups
while the original idea was we wanted to
add something a new layout manager that
would support like flash sales another
load maybe alert manager that would be
more expressive for creating new eyes
and finally we wanted something that was
built from the ground up to be well
supported into the visual editor of
Android studio so just give a quick
example of what we mean by slat layout
so if you have something like that
that's a reasonably complex ish screen
typically you'd be something maybe with
you start with vertical linear layout
and yeah maybe there is a relative
layout so that the star image is
correctly positioned and also in area
because why not the tech zeros couple of
horizontal linear layout to get your
rows some you know some things due to
all the commands finally a row for the
bottom and not saying that we couldn't
do better but that's not that I think a
pretty common UI the problem with that
is that well you got your even with
something like that you have Yaqui
that's a big bit and one issue is
governments the deeper they are key the
more problematic governance can become
the other issues that you are very left
into that design if you really want to
change things well you kind of have to
redo everything but if for example you
know this particular degree needs to be
recalculated like each side needs to
really like to change the text for
instance on the size of the things you
need to be a calculated again
that we actually impact all those
containers so it can very quickly be
relatively expensive and if you are
judging the screen that may not be such
a big deal if you are doing something
like his view or recycle view and stuff
like that where you constantly
recalculate stuff that that could lead
to that governmentís so we're
constantly up the idea is well we don't
do any of that all of your views are
just that views and they're just laid
flat into the layout and instead what we
have is we have a system pretty flexible
to specify all how those views are
positioned relative to other views all
the parents yeah so the best way to use
constraint layout is in Android studio
and just to kind of give you an idea the
tool is designed to work really well
with the graphical user interface so
here you see it making some constraints
on the left is a tool palette at the
bottom left is is a list of all the
components on the right is an inspector
which will show you the state of all the
pieces and that's one that you're just
seeing right now that's exact blueprint
it is a blueprint so in fact if I go
back on that screen you know it's the
blueprints you can think about it as a
way of techniques right on your layout
it shows you all the connections all the
constraints that are applied to the
elements of the layout but you would
notice that it's actually showing you
just the right the bomb and what's
actually there
so the difference with the design view
that shows you how it looks like on the
device is that it kind of separates
different type of information so
sometimes you really want to hear it
looks some of the times you're not
concerned about the rules the constraint
that you set and sometimes you want both
right so in the hundreds to do you can
actually have both side by side or you
pick one that's that's really so you
know we just show you briefly in studio
it works but fundamentally the general
concept is that you got those circles
death
on the on the frame of the buttons those
are called uncles and you can connect
those ankles together once connected
they basically maintain a relation
constraint and you know you can
associate the matching so that's the
simplest way to think about constantly
art is that you position elements you
know related to another one in many ways
it's close to relative layout but it
actually goes much further than that and
we'll see so those are important things
to think to think about when you when
you walk in constantly out is that every
widget need to be defined and it needs
to be different its position is to be
defined basically on the two axis
horizontal and vertical so you need at
least two constraints there widgets so
you know that constraint does no good
right to keep that in mind if you need
at least two constraints the things are
is that while you are editing when
you're in studio and you're just playing
with your UI if you don't have
constraint that's not a big deal we just
let you move the widget wherever you
want
so that's kind of the idea we'll keep it
flexible when you eat it but do remember
that if you don't have those constraint
set when you push it to your device your
screen may not look the same because
every single resolve to 0 0 so beyond
that that's really the gist of it and
the library itself so it's a smaller
than the library so if it's not hundred
thirty kilo byte I dunno not it's not
really going to be a problem for your
apk I up the fact that sits on a burner
is actually very very interesting for us
but I think for the purpose as well it's
good for us because we can push the
version anytime and we definitely did
that but it could hold it well press
because it's not fact we can push a new
version and so they need brake
application right so now you won't
charge you take the library you decide
to take the latest version or not it's
up to you it's it's beautiful
upon a very flexible foundation so we
have this very generic linear equation
solver so all those constraints are in
fact expressed in terms of mathematical
equations
we thought that maybe dating you right
Julia using math may not have been the
most user-friendly experience so on top
of that we built this constraint system
that's a lot simpler and at the same
time we try to keep it very flexible one
big thing that we did since we really
moved since we announced it at i/o last
year is this mechanism of doing direct
resolution so whenever we can we try to
thank the constraint system and directly
solve it without even going through
during the observer so that's kind of
like getting the best of both worlds we
do get the expressivity and the power of
having a full-blown linear system server
but on the other hand whenever we can
and it's easy enough for us to solve
directly we do so we get a lot of speed
out of that and as I said we we try to
build it with the UI builder in mind and
the other part that we have that's not
really in the library but that's we
think about it as part of the same
system is an inference engine that runs
into studio that basically create the
constraints for you all right so right
now we are - on 1.0 point - we've been
doing 16 a date since last May so we've
been pretty keeping a pretty good pace
trying to be pretty reactive about user
feedback as well it's a lot faster that
what we showed that our last year
hopefully it's let's bring in a ton more
features bit of importance to do it if
all you tried was the rationale studio
that was released at annual since then
we'll release the 2.0 final and we'll
release the 2.3 you really should take a
look at 2.3 it's much better but
occurring for the BioDigital it also
became the default layout in order to do
so if you create a new screen in studio
by default you use constantly I'll close
with that that was actually the best the
more flexible solution if you just
wanted to throw out the string that
doesn't mean you can't use the other one
you see we did what with them and you
know there's some good use cases for
photos as well
you know that that's where we are right
now okay let me quickly cover the
photons are the possible constraint that
we support the way you can express the
different positions you can think about
it at the grammar of the system right
like oh you know you got all those new
concept and how can you create a UI far
from it so you got the relative
positioning as I said it very similar to
what Richard was doing and terms of the
XML it's pretty similar actually looks a
bit scary like that just you know on the
one at one side but in fact the only
thing that we should care about are
those four lines at the end each
describing the two constraints that that
are here on the left one for the top one
for the left and the associated mapping
and the only thing we need otherwise is
an IDs for the target of obviously you
need to be able to reference it and in
fact if you look at the the diagram
something to keep in mind is that all
those times they actually mean something
and in fact you could think that one
nine is equal one constraint or one nine
on-screen is equal to 1/9 index and so
we do more so than just left or right
button or pattern and we also support
take the a line so you can just position
you know using the text base line which
can be pretty handy we have this concept
of diets as well so if you have like a
button like that and you have it
connected on two different constraints
like two different on components on
either side by default will starter it
but we can actually specify bias so you
can make it more or less off-center and
we can think about it as a percentage
based positioning and those two
constraint assuming alcohol that you
call you connect to the notice will be
just the parent they can be anything and
use a widget we're sort of aquatic
conscious attempt for the dim postage
find the dimension of a given widget so
we have the usual drug contents of the
excise
for foramina hoping that everyone knows
that rap content basically as we jet
watch outside
give me your faith but we introduced
something called mad mad constraint
which is actually in the XML is just
shown as 0 DB it's very similar to a
Kannada at those photos we were used to
that and much content goes a little
further but basically if you want to see
visual representation of it is that Brad
well you get the size of the widget as
you know as much as do it at once match
it going to be expanding you know
spreading the size the dimension of the
widget as much as possible to match
those constraints and I didn't show it
here but if you define margins the
margin are going to be subtracted to the
space or some random dig site so much
constraint can actually do a lot more
one thing is that the default behavior
is Preda which is really just shows but
you can also make it rap and what that
does is that the widget will act like if
it's set to wrap content but if it goes
beyond see if the wrap content size of
that widget goes beyond the constraint
set then they will be limited by those
constraints so that that's kind of a
pretty interesting feature we can also
specify a ratio which is defining one of
the dimension that we'd behind you know
using the other one if you are using the
widget in the chain and I'm going to
define channel potato you can specify
wai-wait as well which very similar to
working area does and you can also
specify min and Max if you are using
that contract writing on Android you can
specify min and Max on some with that
somebody knows what to do with a minimal
but here anyway that would work as long
as you specify match concert we also
another example of Max for instance
right so the widget is is set as much
constraint in with connected to a
guideline and if I expand that you know
it will go up to a certain amount that
will example of aspect ratio and you can
set it in the editor you can see it's
like going from 6
sixteen by nine two three two one one
and one aspect of Kausalya that I you
know particularly like is the way we we
undergone so on on vertical specifies
the way of you is going to be shown or
not like it can either be evil
individual meaning that is participate
into the layout but it's simply not for
that LeBron or gone and if you use
relatively up in the past while the way
controls compiler is not always
particularly great but in constantly
it's very well specified so it if we get
in math let's go on it simply reduces to
zero zero and the marginal zero as well
so in a K in cases like that that works
really well but if you are using shall
you know changing the God state on the
first widget you see that that may not
be what you wanted here and you know it
completely makes sense right everything
goes to zero so we got all those things
going going back to the origin but what
you can define is an ultimate value for
those margin if you are connected to a
widget that is good so then you can
specify well when it's gone and I'm
actually going to use likely 32 dips top
margin how the button and so every
singles at the right place and a British
should not in earlier but well
guidelines sorry but Galen is basically
a way to help you set up a UI so think
about it more like as a helper object
rather than a graphical component that
you will have in your screen and you
know if you've been working with
designers before so sometimes they call
them key line red lines guidelines
basically those are the vertical
horizontal line and you can position
them either related to one side or the
other or as the frontage and finally
change so change are defined very simple
wet it's simply if you have at least two
reject that are connected with
bi-directional
connection so age is connected to B &amp;amp; B
is connected to it if you have that
that's on the chain and when we have a
chain we handle the those those widgets
that are part of the change in a little
little bit differently so we consider
them as a group innocence so you can
think about chain as a way to define a
group without having to create an STD
our key angles are important point is
that change can walk in a single
dimension so you can define the chain
let's say in the horizontal axis that in
the vertical axis do something
completely different so that's quite
different than letting you know they are
because in the layout we do we define
the position of the rejection on both
axes and we have value style of chain
that you can easily specify you know
some very similar to linear rails also a
little bit different which are quite a
lot of explicitly and to create a chain
in order to do is pretty easy you just
select those widgets click on Center and
the West Center box will create those
bi-directional connection there for
creating the chain and once the chain is
created you can easily toggle the
different style let's talk about tools
ok so inside of Android studio we try to
put a rich set of tools for you to use
to use this constraint layout we have a
lot of them are like the regular things
you'd think of in any drawing program or
PowerPoint or something like that you
know align left align right that sort of
thing
and some of them are a little bit unique
one of the things that the ones that you
see with blue lines on them for example
the one who just did the constraints
they actually can create actual
constraints for you so if you say a line
left it'll create a bunch of constraints
that effectively align the collection of
things you've selected to left if you
don't want them to actually create
constraints but you're just practicing
the layout of everything
you can press control while you make you
issue the operation and it will align
them laughs like you did in PowerPoint
right it'll just push them to the
location you want them to be in and you
can see their create you can create
vertical guidelines etc a lot of them
are also available on right shift a
right-click so here's a little example
where you see how you would create you
align the bunch of them and made a chain
and now I'm going to line left a bunch
of them then make a few manual
connections to finish it all off now one
of the nice things that we did for
constraint layout is that if you just
manually position everything very
accurately this button the the two stars
and apologize for the icon I didn't do
the icon the two stars will actually try
to infer what constraints took place
it'll automatically create a collection
of constraints for you and in this
particular case you see it did a pretty
good job it has a few kind of rules that
you could have to expect one is that
it's not going to try and move widgets
it doesn't beautify the image it doesn't
position things where it should be you
have to position it where it should be
it will then say use those and try not
to move them the other thing is if you
make existing constraints
it'll honor those and then add whatever
is missing so a common use case is
before you finish just hit this button
and any constraints you missed it will
it'll figure out and put it in for you
so it looks like a quick shortcut a lot
of people use it as a way to finish
their their layout some other people
layout one by one
hitting infer as they go to try and have
it add constraints incrementally and
that will work as well
um yeah chief so so one of the other
things that we added to it is something
we call a constraint set and a big use
cases animation and we'll see a few
examples of it later what other things
you can do as a constraint set is is
have a layout and get the actual
constraints from that layout separate
from the layout and then you can apply
it onto an the layout that's there so
you can switch between two constraint
set B let's start with it and I'll just
power it off so the the example here I
create two layouts one of them is
constricted it has a small image and the
other one has a bigger image and then
I'm switching the N and the the
constraint set you can ask me I'm
switching the constraint set so so here
you see - I've created two constraint
sets and i'm cloning a layout another
way of calling another layout and then I
can use those to apply the constraint
sets - to an existing layout that's on
the screen the big advantage - is that
you don't actually recreate all of the
views it's actually just positioning
views at this point the other thing is
we can use some some really wonderful
api's chat route along transition
manager begin delayed transition and so
that when you apply the constraint set
it will actually animate from one to the
other and in fact the transition manager
is very very powerful tool for when you
want to make
animations and you'll see more examples
of that as we go along another example
of its I'm showing here is where all I'm
doing for each view is setting its
height as I move along and since they're
in a constraint set they all have to all
react to that constraint and because I'm
using the transition manager its
animating them gracefully so you can
create lots of surprisingly easy quick
subtle animations with with things like
that
and so essentially all I'm doing is when
my wherever my singer is I set the
minimum height so for Android and we're
and the rest of them get set to zero so
okay so let's just cover it so a few
examples of how you can actually use
constraint layouts so yeah all you know
and control this type of example you
know any type of video programs or you
want to have a simple roll and you know
animate other layers on some text here
and there maybe some image on the right
there's a couple of subtlety here but
basically the way you would do it for
you to construct layout is really
straightforward you have the image
that's connected on the left you have
the middle the right that's connected on
both top and bottom and the right you
know same for the image on the left and
the text I'll just simply really key to
that image one thing so that's actually
interesting is that the image on the
left is the one driving the wrap content
of that roll meaning that the size of
the roll is completely dependent on the
size of that image but what's cool is
that the size of the image is actually
set via a ratio so as long as you set
the ratio of the image right you know it
will all basically derived the entire
the rest of the dimension of the roll
and what we are talking about roll and
it's something we want to get better and
onwards to you but you have actually
quite a few
you think that you can do this to do two
more injury display stuff like that so
we have this concept of the tools
attributes that in itself allows you to
override any attributes of the XML
object and to replace them with a value
that you would use only during the
design times only in the editor right
and that's quite useful if you are for
example a layout that in fact in your
application is going to be fully filled
problematically well how do you deal
with it in video editor right well if
you use of solar attribute you could
just put some random attribute and you
will have a look and you can see what it
looks like so the list is on that URL on
the bottom but there are the one I'm
using here is interesting but that's
just a recycles you and you can just do
two system taxing the layouts and you
can see what it looks like so yeah
that's just a recycle people that could
work as well if is the layout with you
know a bit more complex than the recycle
view then just a reception and you can
see back in rstudio and you see the khan
studio you got on the on the inspector
you see this list item within itself you
know a tool icon so that that's what it
means
all right so another example if you if
you see a screen like that is well the
fact you can do that for getting
articles right maybe you put one space
object above monster object below make
them you know wait and you know that
will that will Center your thing problem
comes when you know the layout may maybe
and this is ocean with written
constantly are basically this you know
Billy keep put those widgets
create a chain make it a packed chain so
it will be also internal at it but the
problem with that is if you use
something like an area to do this layout
if the height of the layout goes you
know is not enough to contain those but
what do you do and well will construct
layouts because you defined it in a with
the constraint on on the image with much
constraint the image can simply be said
to be wrap confirmed by default meaning
that
don't expand more than that but will
reduce in size if it need to be as quick
a little more and so just explain so so
here here we just won in a star to give
you some more sophisticated more
complicated examples to try and give you
a sense of of what how you'd build about
certain things this is a regular
dialogue you'd see something like this
fairly common you can see we want to
constrain things to the left we want to
put to a couple of guidelines at at 6:33
and 60% put the image in between them
but set the aspect ratio so that it will
would be a square again centering and
I'm setting up our margins usually where
you X would have said now one of the
nice things you can do because is when
you build something like that you could
then build a landscape version of it so
it you'd see that layouts a little
different
um there's only one guideline etc and in
fact you can use the constraint set to
switch between them during rotation so
you can turn off the automatic handling
of rotation and it would naturally just
handle this switching by using
constraint set to set whichever one is
the right layout for landscape or
portrait so so the next we wanted to
show sort of a little bit more advanced
use of animation and in this particular
case you'll see there are quite a few
interesting things going on you see the
shadows are raising and lowering as it
goes the image is getting bigger a panel
is opening up and some stuff is fading
in and one of the nice things about the
way we did this and the way you can do
this is you simply build two different
layouts this is the layouts
one layouts on the left
one they also write you just use you set
all the properties like the elevation
and things like that for the one that
has the raised shadows and as long as
they're they're the same you can
actually then just say use this
transitions that effect to animate
between the two of them but now you can
actually take it and do some some new
things so just recently someone in chess
team
Dara's produced physics based animation
and we incorporated this so we made a
custom transition set that incorporated
the physics animation into it and and
it's the same effect but with some
extras and you don't have to be as
boring as they live more traditional you
can come up with almost anything you
want with this approach and I think that
that's the interesting direction we can
go we're constantly out where you can
use the layout more as kind of keyframes
in your animations or different states
but you can still leverage the entire
stack of the framework to really do also
methods like that you know and you have
transition the ledger that most gauge is
going to do a great job at doing every
single tamati key for you but you can
customize it pretty easy so if you if
you don't notice API well we're an
expert in the room let's to ask later
but you know there's a bunch of local
nine and I would encourage you to look
at it so what's next for constantly up
well in general we want to refine the
downloads your visual editor as I said
editorial it's not just about constantly
art we support all those are existing
your group and you know we are working
on that you know as we talk basically
the circuit itself we want to
introduce the
this idea of having DRL containers so we
think that adding this blackjack is
really useful and particularly you can
think about it as decoupling completely
the the way the layout is made and the
accurate view views that you have on
screen and I think like animation you
can see how this is idea can really you
know show a lot of promises so the
actual container the idea would be that
you would have container that will help
you because sometimes if you set up a
layout issue all you do is set the
constraint
one by one that it can be in already
boring and having a helper object that
sets those connections for you can be
really useful
so something we're working on we saw
some ideas about extra helper object
that we make your life easier as well so
the elf and found object is basically
those object that are mostly present for
you to set up video and we know there's
more that's not their role rather than
you know the final thing and finally we
have quite a few ideas as well to really
bring animation to lock that be more
interesting and at the end of the talks
can find more information online and if
you are conta some veggies are in the
the RTD terminology or in cottage a up
please be file please do files like so
we do look at them carefully and we know
it is to contact us on Twitter or and
we'll both were both very active on
Twitter so if anybody has a problem
questions will respond on Twitter ok any
question oh yes
yes so yes sir so what happens is we
actually sort of scrape the the
constraint set it is the constraint
layout information from one of them so
one of them is never inflated it's just
read essentially it's going through the
inflator but it's the information is
just read off of it so that we now know
where what are all the constraints that
will be applied and there's only one set
of views one of them is used to load
load views up on the screen and then we
just swap in the new constraint set and
so about the old ones
now what's important to realize if that
means that you completely control when
you want to incur the cost of the Indian
equation so you can do whatever you want
and then once you have a constraint set
being initialized you can just sit it on
a contract layer it with one of the
things that's kind of attractive about
doing it that way too is that when
you're actually designing something like
like this you actually are in the GUI
builder you arrange everything you're in
another GUI builder for the next frame
you say the next keyframe and you're
laying that one out and adjusting that
one and you can have ten of them if you
want and and they're all just
graphically so someone says oh I need
this to be be adjusted to the left you
just go in graphically and adjust it so
and then you get the animation that will
switch you between the two of them and
and then you can layer more on that as
we saw in those pictures yeah
it's a good question it might be so the
idea is that if we are a construct they
are being a child of another construct
layout there might be things that we
could do to take advantage of that and
basically be a bit more efficient do the
original idea that we had for the
attribute group was to do something
along those lines
but we found I think we found a better
approach but we probably would be still
be able to do something you know
somewhat emulation there and so if we do
that we'd have to have a key that says
flatten this and you would then because
of that view that was the constraint
layout within the constraint on would no
longer really exist you couldn't like
set the background on that you know
there'd be a lot of limitations as to
what you could do with a flattened the
constraint set and and so we still have
to work out a lot of the details of how
you would what the API would look like
and what should we let the people like
know about what they can and cannot do
we don't want to API that oh everything
seems broken because I flattened it
yeah yeah it's something we've been
talking about for a chump oh yeah we
have a thought we didn't get around to
not it but yeah that's one of the idea
that /url
essentially embedding a draw a
collection of drawables into the
constraint layer directly with their own
constraints so that you could we can
have them as floating underneath objects
and things like that because a lot of
people do it you know they'll create a
view to put a blue rectangle underneath
something and you want like a shadow or
some kind of yeah so we're looking at
into it there are some implications and
you know we're talking my framework and
how would we make sure it doesn't break
anybody okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>