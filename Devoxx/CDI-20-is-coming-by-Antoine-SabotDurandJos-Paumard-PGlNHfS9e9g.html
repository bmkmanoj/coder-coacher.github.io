<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CDI 2.0 is coming by Antoine Sabot-Durand/José Paumard | Coder Coacher - Coaching Coders</title><meta content="CDI 2.0 is coming by Antoine Sabot-Durand/José Paumard - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CDI 2.0 is coming by Antoine Sabot-Durand/José Paumard</b></h2><h5 class="post__date">2015-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PGlNHfS9e9g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay thanks everybody to Adam this CD I
to talk so I'm out once a year on the TI
to speak later and you can reach me on
the count 100 scholars SD Twitter
Amidala my name is Jo Jo you can for my
Twitter and all to one of us is the
little graph with the power tool
innocence I forgot my alma so you can
send us your your question during the
the torque using the hashtag CDI too so
if you have specific questions that we
can monitor and try to we try to to
answer at the end of a joke or later if
it's a bit more complicated as you can
here we have a beautiful accent I don't
so next year perhaps some of you should
learn French it's quite easy also
understand vendor speaking against daesh
yeah so what are we going to talk about
so we are going to talk about CDI
starting with a flashback on the first
version of CDI and the CDI 11 and 12 dot
so the current version of cdisc i want
to and will give you a status on the CDI
to specification work give you some in
time the future we'd like to introduce
in CGI to some some of this feature are
already presenting the early draft some
should be presenting in any coming draft
or final release and I will finish by
giving you a small example of code
because we have this early draft running
and it will be possible to show you some
of the new features so let's go back in
time if we go on the CDI timeline we
have an rather young specification the
first version was released with the Java
is sick
six years ago nearly six hours ago and
there was a new release with java ee 7
but we did maintenant solis one year ago
the maintenance release was to fix a few
which we had with the CGI 11 so the the
official version delivered with your
favorite java is a supporter java java
will be the CDI 12 and we started the
work on cgi to last year septembre at
the end of satham de and we should
release CDI to during next year during
the first half of next year so the plan
era it's not totally decided yet but the
plan should be to release 2 dot 0 early
next year and start two dot one
targeting the release of Java 8 when it
will be released talking about feature
how many of you are using CDI today wow
wow so good have I love that thank you
so I'll go I'll go fast across the
coming slides so you have a type-safe
dependency injection mechanism there is
this life cycle management with the
context that we love all the aop feature
with decorator interceptor that was
added that the very beginning of CDI
with CDI 10 the event notification which
is one of the more popular most popular
feature on CDI and of course the spi of
CDI which is not how to say an easy
feature to to grab and when you
understood this spi and learn about
developing extension you you see the
true power of cgi as the solution to
integrate
party solution of third-party spec so in
the CDI 11 we we work more with over
specification in the Java EE ecosystem
to have a better integration of CDI
across the old platform we added a lot
of stuff to add introspection about your
meta data and stuff like that so you can
grab information about the metadata the
event or the current business of things
like that we also had unusual way to
access di from non CI code or inject
cgi-bin in density I call so there are a
lot of helpers to to do such things and
we also had a nice work with interceptor
and transactional transaction
specification GTS excuse me a
specification to have the transaction
usable for for CDI so the UH
transactional annotation which was added
to the java ee 7 I was added to GTA
specification but with the CDI
perspective thus the madman series
released last year was many crack
clarification the main the more
important feature will release with this
madness trolleys was fixed that brought
to conflict between CDI and over GSF 330
framework like spring or juice we
introduced things that met people
deploying spring application on java ee
7 server I've been seeing them crush so
we have to fix that to be a good citizen
with over framework around
and we started this work on CD I too so
it's the GSF 365 it was the first GSF
our data yet what was proposed Adam we
work with a very open x-play group we
have a weekly meeting when when i'm not
at devoxx or java one or devoxx Morocco
or I don't know what we so we meet we
met limit every week and I on IRC people
from the extra loop people from the
community so you can come and give you
your insight there is of course the main
list as well you don't have to be part
of this per group to to join reminisced
we have a regular release of the future
reference implementation with the wealth
free project we have a dollar a lot of
people giving us the feedback they wish
and so on and we will is this first
early draft in the middle of the summer
at the end of July and if everything
goes well which should release at the
during the first half of 2060 so I won't
go through all the list of the mumbles
but I put this slide you have to show
you that we have a lot of people coming
from the community index back rub and of
course they are people coming from the
big implementers of java ee but we have
a very strong commitment from
individuals and under specification so
as i said we are very open to committee
so you can join the mailing list to
follow the discussion or participate to
the discussion you can go to our website
to see what we are going to to do next
or a van information and that's it for
the story of CDI perhaps it's time to
take to talk about the the way we build
the
the backlog CDI too yes absolutely so
basically there was a survey that was
conducted some time ago about gathering
feedback for CDI 20 who answered the
survey in the room oh this is you ask
the guy oh okay all right can you see
why I give you something yeah we did a
survey it was not very popular not very
not many people answered it it's it's
quite important to answer this kind of
survey for instance java ee or all the
priorities of java ee has been set up
according to the survey that has been
made and when you look at the figures
you realize that some light somehow 2000
people just answered the survey which is
very small compared to all the people
who are using July especially to make a
very fine mint oreo Jersey you have to
keep in mind that it's easier to come
soon during the spec when we are writing
this back instead of coming after this
back when it's too late so I know it's
easier to take the finished product and
say oh they should have done this and
that but it's too late so try to if you
want to see things in cydia try to to
come to us and ask probably you'll have
some times over no as an answer but you
you will understand why and you have
asked it absolutely absolutely so what
is the process to gather feedback the
survey was one part of it grr requests
which is another way for the community
to to launch suggestions or comments on
what is under the work for Mike spectral
feedback this is the third expert group
that is that is made about CDI so yes
the former members are still around are
still providing feedback on this and
other specifications feedback they are
specification that are building stuff on
top of CDI you are going to give
examples of that in the in the next
slides alright so the survey could
gather 260 participants I think that
should be about half of the people
present in this room now so maybe next
time you should do the survey during
your addy Vox talk here to have more
participants and there was 20 features
too
rate we're not going through all of
these features of course the first and
most requested feature is a synchronous
support in CDI and indeed when you have
a look at what happened two weeks ago in
Java one and what is happening just now
at the road Belgium you see that your
synchronous called a synchronous
execution of methods a synchronous
processing of data whatever is really in
the mood currently there are many good
reasons for that probably not so good
reasons also as all buzz words and
everything that is in the mood but hey
we need to provide a synchronous support
for CDI for two things for events even
cycling and walking to talk about that
quite precisely before the end of this
talk and method invocation which is
something that is still in the ideas but
with not much things done correctly so
if you have good ideas about a
synchronous method invocation call
please come to us come to the mailing
list just make some noise bring ideas
because it's really the right time to do
that what were the other top requested
feature having a way to do some things
on the startup of the CDI engine
bootstrapping outside of Java EE and
namely in java SE jpa for instance has
support for java SE you can you can
bootstrap jpa entitymanager factory and
entity managers in july see so will be
we will be able to do that in CDI 2 dot
0 also a yuppie for custom beans we are
going to talk about that security
support security support is a is a major
concern in all the java ee platform so
also in CDI and good and the good news
of security support that was a future
requested but there is a GSR for
security on up to and they are using cgi
for integrative generation so it's a
feature we won't have to deal with
absolutely observers all the ring this
is true for synchronous observer support
we're going to see that there is
something that could be done for a
synchronous observers but it's much more
complex to control event and of course
observers and access to meta data
through SPI all right I think we are
going to cover all these questions in
fact yeah
okay so let's jump in it so what about
what about the CDI new feature so I have
so let's start with one of the major
feature that we wanted to add to CDI too
so right now CD is tied to java platform
and we wanted to add java SE support at
the specification level very often
people ask the question why would you do
that because you have the the
implementation wild open web beans and
you have even a further party framework
like Delta's like that provided this way
of booting CDI in Java Sea the program
is that we we want to boost the adoption
of CDI and we have over specification
around like just decide the GPA jax-rs
on others that support put in Java Sea
and if we don't have this support at the
specific specification level they cannot
impress the do all CGI program model
because when they will be in in java SE
way they won't have the GCD icons now so
that's the main reason we also have this
plan I will talk about it just after
having a CDI light specification the
lighter version of CD ID and if we want
to go that way we first need to do some
cleanup in the specification and of this
java SE support and they are of course
over reason like testing and other stuff
like that and be able to be used in the
desktop application and not only web
application on 20's picture time oh yeah
let's take that stick come on here plz
plz like this
thank you check that's done okay so we
already released a proposal for the java
SE support in the first storage raft so
today you can play with this distally
draft and try to put CDI inshallah it
will works so we right now the proposal
reuse existing class in the city i spec
so that it will be the cgi provider and
CI interface and we added initialize
method in the CDI provider so there are
22 signature for the initialize method
one without parameters and one with a
map as parameters so two dates let's say
it's a basic way of boot CD i the the
object that is returned is it's a CD I
object it's now auto closable so if you
forget to to to shut down your container
it will be done in a clean way and we
are still discussing on an seng this
this solution to be able to add /
parameters and non parameter no
parameters in the map but structure para
top to keep the type safe approach of
CDI so it seems quite simple when you
saw when you see the code here but the
we have to do a lot in a specification
to to do that because if you read the
specification how many of you read the
CGI specification in the room wow the
CDI user that didn't read the
specification should it should read so
if you take the specification to data
specifically the 11 or 12 specification
you'd see that there is a lot of java
references
in all the specification so you have
mention of a gb mention of salad etc and
especially especially especially a gb
session bean is everywhere so we had to
cut the specification in two part so we
created a CDI car part and the CDI for
java ee part so all the java specific
feature where put in a specific part of
the specification and to my knowledge
the first specification doing that most
specification of maanshan like when
running in java see you glad that that
you won't have that that bad but as we
had a very strong in tradition between
CDI and gb it wasn't it was very hard to
go that way because it would it would
have meant the spec very very hard to
read other than today so we had to split
the spec into bart and that allows us to
add this felt part so CDI for java i see
today in the CD alpha travis apart we
only have the boot part will add
probably stuff related to context to
text management in Java Sea and other
stuff related to July see like multiple
containers about if we go that way if
you should decide to support when people
called names array see we have still
work to do regarding the split and the
corner under services there are question
about the built-in context of CDI so
today we have contacts like request
group sessions cup conversation scope
they don't mean a lot of things under
Java C so we had a lot of discussion and
perhaps we good whether the way of
introducing a new scope so there will be
of course the application scope and
singleton and dependent but we add new
scope the metal scope that will be
activated through an interceptor and
the bean or on being method and
activating the scope for the the time of
the above the invocation so that's
something that we are thinking about
working on there is a proof of concept
that would that was developed by to me
tribe so the field Blevins developed in
his microscope project a method scope so
we had this idea with the without
knowing he was doing that so perhaps
it's a good idea because we were a
different person a different moment of
weakness mig we also have work to do
about being discovery we have the today
we have the annotated mode that can be
very costly if we go that way in Java C
Java Sea eight anyway scanning all the
dojo and class path can be very very
costly and we even disable the rootless
it's been archived right now because it
was too too slow so as I said before we
are working on the announcement of the
AC boot system we should take more stuff
from the recipe shop from world so we
have a new way of booting corner and
wagon plantation and we will use the ids
coming from the world project to add an
approach more based on the Builder
pattern adding a configuration through
methods and allowing us for instance to
disable discovery mode add class of
package has been in the in the launch
time and so on it's it's in early stage
so we cannot show you right now it looks
like if you want to to check that you
can go to the well project and check the
weld class and it will be something
looking like that another point we
wanted to introduce is modularity
this modularity approach is not for cgi
too but we want the respect to be able
to be modular the first ID beyond that
is that we want to avoid the bloated
spec syndrome like respect noon end in
the past like each year of aspect and we
want to have these sub specs part of the
spectrum LP CD I adoption we have a lot
of feedback of people saying okay you
are CDI stuff is nice but there are too
many features packets the implementation
is too heavy I don't need even stagnant
context I just want the simple
dependency injection for instance we had
a discussion with the guys at IBM that
developed the Java batch specification
and they had to to develop an
optimization of the atoms Jack
specification to have a dependency
injection system because the one they
didn't want to depend on the old CD i
spec so what we are proposing is to
provide a CD highlight sub spec so the
ID would have basic CDI producer
programmatically cab a very basic scope
singleton and dependent and yeah the
slider is basic spi gets not sure and
having as an extension the full CD I as
we know it today adding all the other
features so that will allow someone
needing only the injection part to take
this sub spec and the implementation the
light implementation
of the sub spec and start small and grow
in the time if they need they can go to
full CGI we have some challenge link to
that with with this far suspect and the
split we done in the specification we
need a CD highlight for acct Eiffel
Pharisees delight for SETI 44 e so we
are thinking as about solution for that
so probably this CD highlight stuff fond
be in cgi to at the specs level it will
be a proposal in the annex of the
specification because we want feedback
of the community and feedback of people
that requested this feature to be sure
that we did the things right and perhaps
in cydia to that one added to the
implementation to finish on the topic we
are in discussion with people in people
working on a spring framework to work on
the at inject specification and add few
staff on that inject specification to
deliver more consistent x panels for
people using dependency injection in new
community would it be spraying a juice
or CDI and now it's time to talk about
Evans and Stooges a absolutely thank you
so even as you said as you saw on on the
on the survey if not even if the survey
might not be a good picture of what the
general uses of CDI i want for CDI 20
events is clearly some one of the most
popular feature of CDI itself and the
idea is to enhance this feature to make
it more usable probably more consistent
in some ways bring precision to the
specification and bring the possibility
to have a synchronous event so this is
what this this part is about in fact in
CDI 20 there are two things that are
going to be
I added to the existing specification
first the possibility for observers to
be a synchronous and the possibility to
fire a synchronous events inside CDI and
second for synchronous events at least
have the possibility to give priorities
to observers so that the order in which
the observers are called will be
consistent and reproductive all all
right so what is the pattern of CDI 12
fire and inland I have to get an event
of some payload injected in the class I
want to that is supposed to fire this
event and in my critical business method
or what does this BS mean did you add
that no i don't know i just called even
that fire passing a new instance of the
payload and this payload will be sent to
all the observers of all the seasons now
what is the observing pattern on the
observing side i just have a simple
method with it with this observes
annotation that will take the payload
and that will be called wind with the
past payload by the the CDI itself it
supports qualifier and and many other
things now the thing is that the in CDI
1 dot 2 up to 1 dot to the synchronous
or asynchronous aspect of the color of
the calling of the observers is not
specified know is the immutable status
of the payload itself so it could be
possible according to the spec to call
those observers in other threads than
the firing threat now the fact is all
the implementations including the
reference implementation use synchronous
models what does it mean it means that
once the fire method has been cold all
the observers are called in a given
order which is not specified currently
so it might change from one
implementation to another so this also
is not specified and all those observers
are called in the same thread as the
firing thread it works like that the
second thing is that the payload that is
passed to the observers might be mutable
it's not specified
should be mutable or not and the fact is
people in the implementations are using
this payload to carry some information
from one web server to another and the
fire method returns once all the
observers are being called since
everything is synchronous now it has
several consequences first you you
cannot really go a synchronous in such a
model because if you if you mutate the
payload in one observer and another
observer is called in another thread you
will have visibility issues race
conditions and things like that the
second consequence is that if one
observer raises an exception it might
kill the thread of the firing or the
firing part so it might kill yo thread
the thread urine and there is a third
consequence out of two so that not three
sorry is that since you are calling the
same thread all the operation that our
thread bounder think of HTTP session or
transactional operation are indeed
called in that context to so observers
can also access object leave bound to
the HTTP session or do some kind of side
effects with the database in a
transactional way even if it might not
be such a great pattern to do it has
been done and it should also of course
work in the upcoming versions of CDI so
the lesson from that from all those
observation is going a synchronous
blindly just like that use other thread
to execute the observer might raise
problems or if they might raise problems
you need to understand of course that it
will crash your application so right now
what do we have first all the observers
are called in the firing thread they are
not called in any particular order this
order is not specified and if you change
your implementation this order might be
different even if you if you run the
same application twice this order might
change also and the third point is the
payload may be mutated so we need to
take all this
to consideration into account and to
continue and to build an a synchronous
system on top of that and this is part
of the challenge let us talk a little
about events and context there are two
contexts that are bound to to a thread
in Java EE space those are the
transactional context and HTTP requests
and session context those two contacts
are absolutely widely used and we cannot
just ignore them the fact is that the
different system of CDI is aware of
those context that is it is said in the
specification that when you fire an
event this event is fired within the
context you are in so it can be the
context of the session it can be the
context of a transaction so if we stay
synchronous everything is fine it works
like that and no problem will be
observed of course if we go a
synchronous that is basically if we
execute a given observer in another
thread we will be in major trouble all
right so let us have a look at what has
been done so far this a synchronous
event staff has to be backward
compatible with the previous way of us
of synchronous event that we already
have so first first things to to to note
a currently synchronous event should
remain synchronous this is quite obvious
there is absolutely no way we can have a
system working where something that is
done in a synchronous way today should
be done in an asynchronous way tomorrow
this will not work this will crash so it
is not going to happen if we are going
synchronous from a synchronous it should
be a decision that you can take from the
firing side because in the firing side
you know that your payload is mutable or
not and if it's mutable you know that if
this payload is thread-safe or not
because you are basically creating the
payload on the firing side
and on the other hand being synchronous
should be possible in the observing side
why because of context if in your
observer you are doing some kind of
contextual operation if unique the
context of the session if you need the
context of your transaction then you
need to say that so you need to be able
to tell from the other side I wish to
remain synchronous this is absolutely a
must so what pattern away are we
currently adopting it's all readiness
back in there and read a draft of the
spec so if you have feedback it is still
time to ask this kind of question why
didn't you something right because after
that it will be too late you could
answer the survey for instance okay so
from the firing side instead of calling
fire some payload i would call fire i
think some payload thus i'm telling all
right this event should be fired in an
asynchronous but can be fired in an
asynchronous context that is will be
used in another thread and from the
observing side i am going to be called
synchronously with the observed stuff
this doesn't change this pattern is
still the same and if i add the observed
a sink annotation instead of the observe
one then this observer will be called
potentially in another thread that is in
an asynchronous way if it is called in
an a synchronous wait mean that the fire
I think method will return immediately
without waiting for the observer to be
executed that is completely different
from the on the first pattern so in a
nutshell there are four cases that we
may come across the first one even that
fire this is synchronous and call me
observe the synchronous also so this is
the pattern from CD I wanted to and
previously this pattern doesn't change
now to be completely a synchronous you
need to call fire sink and have an
observer sync operation all the other
two other operation fire and observe a
sink will not work and fire a sink and a
synchronous observer would not work
so either you state that you want to
remain synchronous on the firing side
and on the opposite side and it will
work either you want to go a synchronous
from the firing side and from the herbs
of side to this is this is we might have
done something more complicated and much
more tedious to use but we prefer to
stay are simple and to provide simple
patterns that are simple to understand
what about mutable payload one short
answer don't do root it doesn't work
quite well sir it'sit's too small to
smoke yeah how could it be bigger than
regular line okay don't do it just don't
do it don't don't use mutable paid out
if you want to do a visitor do a visitor
use a visitor don't use an even bus to
do some kind of visiting stuff also
further for penalty of race conditions
all right it's better without the
written in fact sorry it's better
without the bottle yeah it's better
without the bottle yeah okay thank you
all right in fact we have some more
because we are not quite done with it
remember what I said with the the ending
of exceptions in the in this old
synchronous world if I if I there is an
exception that is fired in the thread
that executes the observer it might
potentially break the thread that in
fact is running my transaction or my
HTTP session this is quite it's not so
nice because as an application developer
I'm just firing an event other people
are catching this event observing it and
I'm not those people those are observers
so I don't know about them but they can
still break my code so it's a start it's
not pretty great in fact so in an
asynchronous well of course if they are
breaking their thread it's the a
synchronous right so it's not my thread
at least so my code will run properly
but there could might run differently
we wanted to provide a solution to get
the exception that might be raised as
synchronously in the other observers get
back this exception in the firing thread
and do something with them and the nice
thing sorry sorry okay this word this
was the exception it was another right
exit I could get it still this is a very
good example in fact all right let's
inserted of course so what is the
exception are thrown by you observers so
this is this is the second question and
the and another question is what if the
observer needs to be called in a special
thread and of course one can think about
the graphical user interface read if you
want to update some kind of graphical
component you need to do that in the
swing workers thread for instance we
know javafx thread how could you do that
in fact we decided to pass a further
parameter to the fire sync method call
which is a an executor an executor of
type executor right an executor is
basically a pool of thread very easy and
the nice thing is that this executor
interface has only one method so you can
implement this interface with a lambda
expression and remember CDI to is
targeted for java 8 that will be buildin
a cup of java I'm sorry she ate you know
CDI 2 is scheduled for java 8 that will
be that would be built on top of device
e8 so we'll have lung disease in it so
we can implement that with lambda
expression for instant like that swing
utility concurrent it work later so it's
a very clean and very easy to read
battle now this fiery sync method we
decided it will return what is called a
completion stage a completion stage is a
new API from diverse from Java 8 that
allows for synchronous computation and
what is nice is that if there is an
exception raised in one of the observer
we can gather all those exceptions and
bring them back through this completion
stage object this completion stage we
can call for instance the exceptionally
method on it exceptionally method it
takes a hero
consumer that will take the exemption
and do something with it within the same
thread so we can still get information
from what happened in the Indy observers
all the the exceptions in fact from the
from the observer will be gathered it go
into one CDI exception as a suppressed
exception so if there are more than one
exception raised in the observer we can
still get them through this this mean by
the way it's not the only mean to do
that we also have and all exception and
we also have a when complete method to
do that also so this is very nice
observers can now reach an object in
fact they also can return exception even
if the even if the if they are called in
another thread which is a rich is
realized the the CDI exception is called
fire sink and all the exceptions from
this file that could be raised in the
observer will be gathered as suppressed
exception inside this exception which is
a mechanism introduced in Java 7 the
last method to do that is the when
complete method that take a big consumer
or sob consumer the resultant the
exception and stuff alright this is
computable future API even though the
ring on this is for the synchronous
organization that the synchronous staff
we can add the priority annotation on
the on the observes along with the
observer annotation to just to give a
priority to the to the observer so that
the CDI engine will order them properly
all the ring in an asynchronous world is
possible but it's quite complex and it
most probably fig that so if you have
feedback on that please please give it
bring bring your comment on the table
basically ordering that may mean many
things in fact what does it mean to all
the same things in an asynchronous world
it could mean that all the observer
could be called in a given order but
without waiting for the observer to be
to try finished his lawyer is launched
it could mean also launch all the
observer in another threat but the same
thread so that it can be ordered in
some kind of same pattern as the
synchronous world it can mean many
things really so for the moment nothing
has been done and it's not really a
complete we still need feedback on that
all right and that was was event hey yo
p enhancement yeah before showing you
some code and we finish with the one of
the feature we want to twitch solution
cgi to regarding interceptor on
decorator in CDI we have this nice
feature the producer allowing you to
take a class that you don't own and make
it a bin with that reduces notation the
limitation Gavin the producer is the
fact that we cannot apply an interceptor
on on the producer and it's the same if
you create a custom bin in an extension
you won't have the capacity to other and
interceptor to it so that there was a
technical aspect of adding that at the
recommendation level but also the API
aspect today if you write this you can
think that in the bin that you will
produce will be transactional but it
won't be the case when you do that you
say the producing method is
transactional so the UH transactional is
applied to the method not to the bean
produced by the meter the solution is
probably to provide an instance builder
so today we have in CDI from CDI 11 and
inside I want to of course we have this
new class called unmanaged we use an
manager used and managed okay so it's a
very popular feature you should look at
manage it's a class that follow you to
allows you to to take an unmanaged class
we've at inject a notation and inject
bin from the city I can't know in this
class so it's it's not been at the end
that it's a class that as
injection point so today we we create
something that is not really been but
used but is able to consume injection
service from cgi the ideal would be to
go a step further and when creating the
instance with the injection pan
satisfied add all the mechanism indian
stands so all the proxies indian stones
to have the interceptor and decorator
activated and on the instance so this
builder could be looking like this so we
keep the produces statics with the
produces and method we use this bin
instance builder and this been instance
builder is a way to create your a stunt
n stones builder for your class and as
you need to give information about where
you want your interceptor binding
applied whether on the class whether on
this method this that method we will use
an annotated type to add information so
to add annotation and the metamodel and
given method also on so here you have an
example of an annotated type builder
which is a feature that we we plan to
add as welcoming from delta spike this
annotated type is created from the the
class myclass i take i retrieve the
method performing transaction and i
added to this method a new annotation
annotation transaction literal so it was
like I had created a class new version
of the class with the UH transactional
and the Performing transaction method
after adding this
another builder I'll build it and I
added to the dominant stands builder and
I build the beam instance video so it
creates me an instance coming from the
class i want to to install setting my
producer and build it so there are some
there are some glitch yet regarding this
approach because if you have a
constructor in your class you won't be
able to use it so we have to find a
solution but of course the old way of
using producer will be still working so
if you cannot if in fact if you cannot
delegate to the corner the instantiation
of your class you you won't have
probably interceptor at the character on
your on your bean but if you have idea
to go further we are open to suggestion
so I think it's time to go for a little
demo I'll be doing this and pick up my
laptop first and switch does it work
yeah so I have a little bunch of demo
here the first one is the demonstration
of the java AC feature in NC dia too so
yeah before if i start you can to the
test CDI to fish are so there is this
weld alpha today it's the well three
alpha 13 the well three alpha 14 should
be out next week the week after and
don't remember but before the end of the
of the month and with each release of a
new alpha version of well the world team
also released a patch for wall fly so
you have the weld
alone and you have a patch for one fly
the last version of alpha so you can
apply this patch on the world fly you
have just download and you will remove
the old CD I Russian the world well well
well Russian and replace it replace it
with the the new one with alpha so you
can test it very very easily so AI have
I don't have the test me needing well
fly it's java SE test so as you can see
I'm I have a main method I'm using the
the pattern i'll show you before in the
slide so i get a provider and from the
provider calling the initialize method i
get i get the CD i object which is in
fact
an extension of the instant center face
so with this CDL object I can request
any been in my corner from this from his
class and is qualifier so you see here
I'm using a code no select to get my bin
class if i look at my bin class what is
doing yeah nice printer on ok so let's
try to run this it will be spectacular
yeah that's it so I have launched see I
don't know request a bin and launch a
method and of the bin ok now let's try
something a bit more interesting about
avant ordering so a I have a test let me
show you I have a test using our Keanu
is there anybody in the room that does
not act Leon does not know a Keanu ok ok
so to make to make it short arquillian
is a way to create a test we're it's
with G on it and run this test with
deployment so you have a static method
and notated with add the payment and
anything in this method you create an
archive so you say ok I create an
archive I add this class this class this
class and it will be the the archive use
for the deployment so here I am creating
an archive with a classical other are
observable and payload and of course the
the current class will be integrated as
well so if i go to the order of suburban
you see I have proof the classical been
we have classical observers annotation
and I'd like to have the first method
called fast and so on from the g event
so right now if i'm launching in this
state if i'm launching my test there is
a lot of chance that
I cover him something yet in the not the
wrong order so the second was called
first and so on so now we have CDI too i
can add the ad priority annotation so
let's do something totally mad and put
them in the other I pick the wrong one I
see that the people following here it's
not the it's not the official priority
it's an issue that we have did with the
with the commands and notation
specification gems just launching my
testicle and now I should have yes five
seconds whoa yeah food yeah I put the
same put the same order so when you have
the same other you are in the in the
state you are today in a city I saw the
other is not specified so as you as you
mentioned the activity I used come from
well experimental because today that
private and notation is in the GSR 250
so the comments annotation specification
and today this annotation cannot be
targeted to parameters so it can be
targeted to type and to metod am not
sure about method but to type yes to put
priority on interceptor for instance so
we need a maintenance release and the
commands and notation specification to
be able to use to use a priority we hope
that it could be possible to do that
before the release of CDI to that would
be a Alf of next year if it's not the
case we will have to postpone this
feature for CDI to that one that's the
drawback of the gcp speed let's say
and a last example we talked about a
soccer news event so I i have an example
working with synchronous observer so
it's the same i'm creating an archive i
launched i'm launching an event and I
have this synchronous observer here and
I'll have one of your server that asleep
five seconds okay so if i launched my
test like this i will have to wait
around five seconds to have the end of
the treatment okay so if you if you can
see here it took me five seconds and
current and 41 metres gone to to to
launch my test now i have the same test
in a synchronous mode so here it's
rather the same test but with a fire a
sink and with the the same observer but
with the observed a sink annotation if I
launch it ok so now i am back just after
the test and the test finished but i
have the the control of my code just
after we go back to the test use here i
have that's not there ok i have just
after a fire and just after fire is was
written very fast come on again
syria certify alone is written right now
but you have to wait to have the end of
the the fred with the sacred mission so
it was to show you in a very fast way
because we don't have a lot of time and
i like to once a question the some of
the new feature coming in a CDI to an
already test
CDI to worry draft so we have three
minute left do you have any questions
wish remarks critics yeah there is a mic
no stalking
I'm not sure yeah add just a small
remark but in the example you in the
Arcadian test you additive epics and the
beans XML who is that still necessary
since CDI 11 you bin six a man is not no
more necessary but you'll be in in the
default bin discovery mode if you do
that which is the annotated mode I'm
talking about Java II era so in an
attitude mode the bin will be discovered
from the annotation they have on them
but you can still use beans XML to force
the bin discovery mode in this case
we'll just still work without leads xml
yeah it could not sure of the test yeah
because they don't have my bin don't
have annotation like context but you can
set your bin to to be able to walk
without the bins external but you see if
you if you look at the way i built the
archive here i added the bins xml here
in the archive but i could have avoided
adding it and added a dependent on my
bins for instance it would have work
yeah
thank you in this hello world example it
was just a main method without any
servlet container or so how would it
work when you attend request scope
annotation or something how is that
maintained when you can use it outside a
servlet container ok so you what you saw
was not a version of CDI for a servlet
corner it was a version for desktop
application so Java is C desktop
application we are still thinking about
providing in the spec the the needed
filters for a servlet specification to
have CDI activated at the specs level in
a light container it's not an outer
purity but there are people discussing
the despot so if you if you want to see
it you can go to the extra group and
push on the on this side ok I think yeah
I have a question related to a
synchronous events I recently found out
that there is already some concept of a
synchronicity in events when you use
events with a transactional mode and
you'll fire events at the end of the
dissection so you can somehow emulate
synchronous events yeah have you
considered using this as a complement of
the new a synchronous model no no no
because it's too limited it's 200 yeah
but you have you have to you have to you
need to have a transaction first
transaction active and bind your
observer to a certain file phase of a
transaction and wait for a transaction
to achieve with success or fail so that
we are not over I was not I didn't want
to directly in this way my idea was to
ESD I this idea to have a bus to view
the events and execute them after the
processing of a thread is finished or
processing of requests is finished why
don't you submit that to do to the CD i
spec mailing list yeah I'll do juror
audience agrees please do it we need to
stop sorry but talking to talk about it
offline yeah okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>