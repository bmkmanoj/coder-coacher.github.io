<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Secrets are secrets. Please maintain them as secrets by Alex Soto | Coder Coacher - Coaching Coders</title><meta content="Secrets are secrets. Please maintain them as secrets by Alex Soto - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Secrets are secrets. Please maintain them as secrets by Alex Soto</b></h2><h5 class="post__date">2015-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Iaus2NDOhnU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everybody and yeah thank you for
coming to this session and hope you are
enjoying the box today is the first day
day box and in this talk I'm going to
talk about secret management in your
applications and set applications but
also applies to you know microservices
applications or architecture as well so
my name is Alex OTO I'm a software
engineer at Gabby's but also you can
follow mean you know in other team
members like the killian community
trauma drive ask you dr. no sequel and
also i'm a member of the gsl 374 expo
group which is the jason processing api
also i'm the co-writer of the apache
tomcat this on ref card and I'm co
writing a book or cleaning action with
my friend Jason so first of all let me
ask you how many of you are encrypting
the passwords that you set on your
resources files like for example
database tooks database password GMS
password and so on yeah but I feel I
think that there's something important
that you need to encrypt this passwords
as well because if you lose this file
anyone can access to your system to your
database or your gem ski or whatever so
it's important to encrypt it let me show
you an example of this is a Apache Tommy
example which is a resort when you set
the URL the username and the password in
the sky case the password is in plain
text so if you lose this file everyone
can you know get the password and access
to the database the good news is the
patchy Tony provides out of the box
something that it's fevering the
password so for example in this case I
am putting here the driver and URL the
username and the password is a chunk of
bytes which are encrypt and then you can
set here which super you want you to
use in the case AAA yes okay and of
course if you are not going to use a
database but you want to use some other
kind of resources and you can do Super
Colon the algorithm and the chunk and
then when Tommy's beads up it simply
takes this Chung take the algorithm the
crib and gets the plain text to your
application so probably you your code
will be something like this which is I
read the key and its cap it seems that
it has sense that you have a symmetric
key so you read the key you create the
secret case back and then you have a
decrypt method which you get the
algorithm you put the secret key you do
that do you want to do a degree mode you
get all the things from the chunk and
you return the clear text it seems
pretty simple and you said okay now I'm
encrypting my resource file so I'm done
I'm secure but you're ending in a
chicken egg problem why well because as
I said you are reading from disk your
symmetric key and if someone takes the
symmetric key can decrypt the password
and get the password and login of your
database for example so you can think ok
I'm going to encrypt the decree but
you're again you need to provide a key
and you know it's this is the chicken
egg problem and it seems that there is
no solution for this well yeah it seems
that there is no solution and let me now
show you in case of mono on mono it
applications or architecture something
that work for me in the past was dis
approach something like okay we know
that we are facing a check neck problem
so what we are going to do is and creep
the password it's one part and the other
part is creating a file with the key
inside
so basically you take this key with with
the file you put it on your application
server in a special directories and when
the application servers boots up it goes
to that place it take the key eat the
Crips everything that it has configured
and then delete the file well it does
work because if you have an attacker
that have access to the disk they will
not read the key so even it won't be
able to the creep the password it work
but it has some problems is that how you
manage the axis of this file this file
is in a USB Drive there is an operator
that have to go there and copy that file
yeah it has some drawbacks but it works
the problem is what's happened with a
micro services architecture where you
have a lot of services in this cases of
course you can go to all of the services
and install that magic file but yeah you
are splitting the problem across all the
infrastructure so if one service has has
back and someone can access to this file
all your infrastructure is compromised
so in case of microservices this
approach is not the best one but also
you can have other problems for example
if you're using a cluster manager which
you know boots automatically your
services and if for example one service
is down then it restores again I'll you
know automatically or is a system then
you can dynamically scale your solution
from having one instance of one service
to three instance of that service it's
quite impossible that you need a manual
step that implies copying something
inside a specific directory so it seems
that
this solution it may work for monolith
architectures but not for micro services
but the good news is that there is one
person called bolt bolt is a project
from Hoshi Corp Hoshi carp is the
company that created for example
background and both is a tool for
securely axing accessing secrets and
yeah and a secret is anything that
contains a sensitive information a
password aqui em wherever you do it you
need for your application that if
someone installed then you appeared on
the news no this is a secret and you can
think about both as a secret management
as a service because at the end it's a
service that you connect from your
application you basically put things and
you get things from there so it works
pretty well in a micro services
architecture so what are the bold
features the first one is that is a
secure secret storage and you can think
this as as I explain now something that
you put a value der in plain tex vault
and clips it and stores in memory or in
disk or in 80 CD or in console or in a
database you can define where you want
to store the secret and when you get the
secret from the ball it takes thus the
secret eat the grapes and it send you to
your tool to your service although or
the color ok so in this case it offers a
secret way to storage things also it has
something that is called dynamics
secrets which basically it's a way to
generate secrets on the man probably in
your application if you have a database
you're setting a user and password for
example
what's happen if you didn't or you
wouldn't have to set a login and
password then you will have that problem
of having to encrypt everything and this
is what dynamic secrets do basically it
you from your application talks with
both saying I need to log in a password
for accessing to the database and then
both says okay I'm going to talk with
the database you've configured I'm going
to create a user and a password on the
man dynamically and i will return to you
this user and password so from the point
of view of your application you didn't
need to store login and password in any
place because it's generated dynamically
also can be used as a data encryption
which can be thought in some way as
encryption as a service which means that
you send something in plain text to bolt
both in cribs and returns the value but
this value now it's not a store anywhere
so you don't need to you know take care
of where this thing is store and for the
creep it's exactly the same process you
take chunk you send it to bolt both the
grips and send to in plain text and this
is pretty interesting because now all
your services can use the same code for
encrypting and decrypting things
everything involved has some time to
live it means that after this time its
delete from both the secret but of
course you can renew the cigarette and
it's also have a system of revocation
which means that in case you detect that
someone has entered to your system you
can revoke everything and no one has
access to your application from that
point it has a system for reading so you
can see what's happening who is asking
for what it has a rich ACL system for
you know applying roles to hook and see
what and one important thing is that you
can access bald you know as a standard
user but you need to use some of his
authentication methods
and it's pretty interesting we are going
to go deep in a bit but vault has
different mechanisms some user-oriented
mechanism like for example user name and
password or token but there is also
other methods which is a machine
oriented like for example Appa d or TLS
or you know something that is more
focused on machines and as a server and
as a you know a new app product it
bought with rest as you can see both
does a lot of things but in this
presentation we are going to be focused
on secure security storage which means
that we are only going to put things
inside and get things from the
application let me show you in action
ok I've got both running the first thing
I need to do is initialize and this is
bolt in it and one important thing and
I'm going to explain you now what I'm
doing nowaday I ok what I need to do is
create a key for encrypting everything
of bolt so when I do I mean it I create
a key but by default bolt is silat when
you in it so you need to unseal bold and
how you do this ok you could use some
username or password but it's love this
it going to take the key that is going
to be used to encrypt and split it in
several in several chunks ok and then
you need to define with how many chunks
you need to provide to unseal the bolt
this is a sham your algorithm I mean
that it's nothing that has been done by
a bolt and in this case I'm saying that
I'm going to eat it bold and I want you
that you share with shared the key in
tuple into chunks and I when I unseal
the ball I want that you provide both
tokens but bolting it sure sure yeah
sure now as you can read here say that
most is utilized with two keys and a
kiss three sure love to please
securities to be disabled the scales one
and you must provide at least two of
these keys so to do this then we are
going to call bolt-on sill and we're
going to get the first key
and it says okay it is still sealed you
have provided one and you need to
provide another one so we're going to
take the second key
underdog now vault is unsealed and that
everything is okay now what we need to
do is authenticate against bold and to
do this I'm going to access as a root
and notice here that both said this is
the route token so if you distribute
this token to and anyone that don't need
to be able to have root access then yeah
they have root access it's like if you
sure the user and password to the wrong
user so I'm going to bolt off and wait
no
let's try again
ok now I'm authenticated and now we are
going to store something there the first
thing that you need to provide is when
you want to use this secret secure
stretch you need to start with the
secret this is like the mound system
like in Linux and then you put here
whatever you need for your business and
now you can set some properties for
example user full password bar and it
says okay you have righted decent secret
/ hello and then this isn't crib now so
nobody if you access to the disk you
will get a chunk of bytes and created
and to get it you called bolt read
secret hello and you get the key least
relation because as we said there are
some time to live and in all the things
that you store in bold and then all the
properties that the password and the
user in the password this how you can
store and get things securely from bolt
but yeah we have told that we want to do
some thing to manage security the
secrets in our microservices
architecture but now a few unseen I've
used the route token so with the rito
can you create you can create new tokens
more restrictive that the route but at
the end you still have a chunk that you
need to distribute everywhere so if you
lose this Chung someone can enter to
bolt and get your symmetric key and with
the symmetric cake and the creep the
database password so we are still in the
same problem but yeah it's more
difficult but this is good both tries to
fix and tries to fix with one
authentication method which is called a
PPID basically a PPD is a method that is
machine oriented method so don't try to
you know do it by your own manually
because you're going to spend a lot of
time and basically it's based on
providing two elements to access or to
authenticate your services need to break
two things the first thing is a nappy an
APB ID and I PPID is a random unique
chunk of bytes you can generate it with
a random or a UAE or whatever you want
it's unique for the application I mean
that each of your service or micro
services will have one I ppi ye it
generated by an operator someone decides
that I'm going to run this code and then
you will get a chunk of bytes and do the
service one going to have this chunk of
bite in our case we use Jenkins to
generate this and this Chung is stored
on your configuration management system
and this is depends of what use you use
console or wherever you use this is one
of the things that you that your service
will need to provide this ap PID and the
other thing it's the user ID and the
user IDs
in sick property and intrinsic property
i mean the AP the mac address maybe the
hash of both the host name whatever it
is intrinsic to that machine and its
unique for each instance so for example
if you have one service and that has two
instances on your infrastructure you
will have won a peabody and to user IDs
it generated but cloudiness the script
well this is if you use in darker you're
going to use in one way if you're using
methods you're going to do in another
way this depends on your system and its
as i said it's like this you have
service one to service one deploy it in
two different machines and two service
to divide in two different machines and
you have one application ID for service
one to user ID for the service one one
application ID for the service two and
two applications ready for the service
tool of course is you have three
instances of surveyed three you will
have three user IDs so its service one
wants to authenticate against both to
gain access to get secrets from there it
needs to provide the topple of a peabody
and user ID if they provide both and are
valid then we'll get access and you will
be able to get your symmetric key from
vault or your password or whatever you
store and if not it will fail let me
show you an example wait
yep well in this case it's a java code i
created a you know and I need a Java
interface between you know Java program
and unbolt using frame well this is then
what I'm doing here I'll let me first of
all rester ball because it's already
initialized so what i'm doing here is
feasible I in it bolt with only one key
and you need only one key to enter the
bolt now here there is the source things
then what I'm doing is unsealed vault
which basically provide the key that has
been returned by init method the next
thing is i enabled the bikini ap PID
remember that in our example we use
secret secure storage we just mount by
default in this secret a slash blah blah
blah this means that it's bold but in
this case by the fall I PPID Mon system
is not built so you need to mount it
manually so in this case I'm you know
enable of began mounting it then oh it's
okay then i generate an APB ID even
using a random MP ready then I send this
Appa ye to both to say hey keep in mind
that you there will be one service that
will send you an APB ID you'll save this
finally I'm setting here that I need a
user ID and basically what i'm doing
here is getting the host address i do
the the tisha one and i send it to bolt
and then this way i will say to bolt
remember that i send you an APB ID
notice that here i'm setting di PPID so
I'm sick I'm saying and now you're going
to receive a user ID which is related to
this ap PID and if you receive both of
them you can get access and this is you
can get access is this login here
so if now I run this script right yeah
yeah it's obviously screen and you can
see here that when you login I receive a
token because in bolt everything is a
token so now in all the other operations
that I will do from Java I will need to
provide this token so when I want to get
something from there i will call get
method passing this token and me i will
get access to the information and that's
all it's really pretty simple but as you
can see now I've explained it in a Java
code everything but you're wondering ok
but I run in production I'm not drowning
in this way and since maybe you are
using mrs. maybe open shift maybe
dockers form i'm going to show you an
example with darker that we use in my
company ok or in my previous company in
just in this case and it's this we had a
Jenkins and the first thing that we did
is I'm going I'm going to create a new
service so the first thing that I do is
go I have a job in Jenkins and say give
me the name of your service and generate
me an APB ID it's a random it generates
the PPID and then we had a base docker
image then it takes this docker this
base docker image and I it adds in the
in a docker file based on this base
image this I PPID with the name of the
service so all the service that are of
type a we're going to have this docker
file if I need to create another service
service be I need to do exactly the same
process then we have the appt which is
one from service well this is that when
we finish everything we connect to both
and we
register this I PPID this one part that
is one done one for each service it was
you know when we start the development
of that service we did this but then
there is all this hard thing that is how
we deal with the user right DeeDee and
basically we do this the next thing
first of all we use a sidekick docker
image so when we start our service we
studied another container in the same
host address and basically it takes the
hostname and IP it makes the shot and it
connects using mutual TLS or cubicle
approaches it opens the gates to bold
and send the user ID obviously if we
start a new instance of the service a
the hostname and IP will be different so
it's perfect the ballot then since the
docker image we use was based on this
docker image we use we inject the
ability to apache Tommy in this case so
now the back seat on has the LPP ID then
since apache tom is running in the same
host address of the sidekick docker
image or real instant the hostname NDP
was exactly the same so we authenticate
so we create the shot of the hostname
and IP and we authenticate this is the
code that we have seen sending the you
know the AP by d and the user ID to bolt
now after that since we were providing
an IP ID which is valid because comes
from here and we provided an ID ID which
is valid because it's the hostname and
IP of this instance that at the same
time is the same instance of this one we
would be able to read data from token we
get it in this case the private key and
finally we remove the token of the user
ID from from the private key from a user
ID so if someone in the middle you know
gain access to both then
can get this key well we are finishing
but let me tell you that first of all
bolt is a service and as a service needs
to be deployed in your infrastructure so
if you are using docker put Bolton
docker if you are using methods use
messes with both yeah it needs to be
configured with high availability so I
mean that if you if bolt is down yeah
you will you will lose all the access to
your secret so you need to replicate it
monitor it and think that it you know it
can be used for monolith applications as
well and also as a final note is that
there is no silver bullet in security yo
can only put fences and fences infant
sense and if someone breaks one friends
you will have another not you have
another and this is what ball does it's
adding fences as a defense for your
application and we have one minute for
questions Rick curious the slides if you
want to review it or something you can
take it and if you want to send me an
email asking any question don't hesitate
to do it thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>