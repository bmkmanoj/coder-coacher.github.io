<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Java SE 8 for Java EE Developers by David Delabassee/José Paumard | Coder Coacher - Coaching Coders</title><meta content="Java SE 8 for Java EE Developers by David Delabassee/José Paumard - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Java SE 8 for Java EE Developers by David Delabassee/José Paumard</b></h2><h5 class="post__date">2015-11-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OCBqisJAwi8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good morning everyone welcome to this
java SE 84 java developer session so
it's great to see many faces in the
morning I mean we get that there are
many faces because we don't see your
faces but anyway so the agenda for today
we'll talk about jealousy eight in a
java context why well Jeff I see eight
has been released last year in April so
about 18 months ago on the other hand we
have java java 7 that's the current
version of the specification so there
are many applications of out there that
are java 7 compliant glassfish whitefly
and so on if you look at those
applications over most of them are
certified on java SE 8 and in fact some
of them are only certified on java SE
eight if you take glassfish the lattice
release it only runs on top of java SE
eight same is true for white flight 10
java c 8 only white weblogic as well so
the lastest version of weblogic is
device yet only i'm not sure about IBM
liberty profile i couldn't find the
details but anyway that means that today
you have a java application server that
is running on top of july c 8 so today
we are going to check some of the java
ACH features in a Java EE context how
you can use some of those features
because you have the choice either you
use pure java ee 7 without any java SE 8
capabilities or it might be a good idea
to start to use some of the java SE 8
capabilities also you have to keep in
mind that july c8 java SE seven sorry
has been enough light this year so you
really want to be on java SE eight today
so my name is david derabassi i work at
oracle in the cloud application
foundation in our group we deal with
java ee do technology glassfish the java
reference implementation and weblogic
our commercial supported product and my
name is jose a I work in a very Syria as
an
assistant professor the university there
I also work as an independent contractor
I've got quite some resources online
just as you by the way many resources
online on the Java magazine on the site
called prayer site which is a training
site US based also on Microsoft Virtual
Academy I made a java ee course for
Microsoft Virtual Academy and unpolished
for still some time well I think we can
start okay so before we start some
logistics oh come on I Monroe County not
so this is the standard set above
statement slide so the basic idea is
that you shouldn't make any purchase
decision based on what i will say today
having said that i will not talk about
project so there is nothing to buy does
it mean that all we are going to say is
just next disclaimer all right
yes despite my french accent
I'm not French I'm from Belgium and
despite my Belgian accent I'm French so
yes about the if you have any questions
we have a nice it's not a PC to Mac by
the way which which look at this our
slide on Twitter so you can use Twitter
if you if you wish to ask questions it's
quite hard to hear everybody in those
big room so you can use Twitter it since
sometime more handy there is also the
dev ox application to ask question but I
understand that once the talk is over
questions are not learn accessible
anymore there there is some kind of
delay after after the top where where
they got hidden ok so anyway since we
don't allow to usually do so if you have
any question yeah use the Twitter handle
yes please yeah that's real good the
first part of the Java API were going to
talk about is the date API maybe some of
you already used the other time API as a
third party API to handle date and time
and calendar if you're not too happy
with the java.util.date or Java util
calendar class now the good news is in
java SE aight thanks to the work of
stephen colborne the Giada time date and
time API has been ported to java SE 8 so
if you use to that now you can use it
while not going through all this API
because it's really a big API there are
many many patterns and concepts in it
it's really worth checking and the
Javadoc and documentation of it has
really been extremely well written and
very precisely and carefully written so
please go and check it just to give you
a little taste of what you can do there
is a special support for time zones in
the in the date and time API you can get
all the time zone with justice method
zone ID get variables an ID so if you
want to get the time zone associated to
Paris you just do right this kind of
thing from the time zone you can create
a special zone datetime datetime is a is
a regular date time as as you as you can
guess and you can associate this day
time which is in fact a point on a
timeline that is independent of any kind
of time zone to a special time zone to
convert
this point of the timeline in the time
zone you're in and this led to this kind
of pattern so basically this this date
by the way is the date we are France won
the soccer world cup that's a long time
ago yes this was a long time also stop
it please you know you all right so and
hopefully four years later it was the
other world cup while France did not
participate i think oh yes it did but it
didn't score anything they went on
strike I can't remember now that this is
bad tuning alright so you can just you
you have some kind of arithmetic between
those those doors own the daytime so you
can just add for instance period of your
fall this period object is also an
object from the date and time API to
handle periods of times between a date
time and you have those factory methods
very handy to compute this one now if
you want to express this zone the debt
daytime in another zone ID you have this
very handy method with zone same instant
so same instant means it's the same
instant of this absolute timeline but
expressed in different time zones so if
you want to do some conversion from one
time zone to another you can just have
to to call this method which is very
handy so you don't have to to hack again
with this calendar a class which is
quite hard and very error-prone many
many use cases have been implemented in
that date and time API for us for for
our applications which is very nice I
also added the the patterns to go from
the java.util.date to the the other
elements of the date and time API so
those are just just here so if you have
legacy code based on java.util.date you
can just convert all your calls to this
new date and time api and of course it
wouldn't make any sense if jpa was not
supporting that for java ee developer
yet which is also the case next question
how you can use that new date and time
in p.i in july so right now GPA GP 81
doesn't support the that epi I mean GPA
21 was
least one year before java c8 was
released so it makes sense nevertheless
there are techniques that you can use to
add support for that new data and typing
API and that is using the attribute
converter that has been introducing GPA
21 so the idea is very simple so you can
use an attribute conductor basically to
do the conversion between a specific
type to do type that will be persisted
to the database so how it works this is
an example so we have a very basic
entity we have just one field instance
which should be called really instant
but it's type is instant we are using
the annotation add convert to specify
that which we want to use an entity
converter we specify the class of that
converter this is a converter so it's
basically implementation of attribute
convert it works on to type the type
that we have in our entity and the
actual type that will be persisted to
the database and obviously we have to
provide the method to the conversion
between those types so whenever we write
to the database and whenever we read to
the database and that's the meaning of
those two methods so convert to database
column and cons up to n ste and tribute
so you see that it's very easy to do
something else that we can use we can
just use strings for example if we want
to persist that new zone dead time type
we can convert that to a string to a
string so whenever it would be persisted
it will be persisted as a streams as a
string sorry and whenever we read it
back the strings will be converted back
to that new java SE eight type 1 remarks
about converter so converter you can
decide to apply conductor to a specific
attribute or you can also specify that
you want all attribute of that specific
type to be automatically converted so
you have some level of granularity there
so right now in GP 81 we can use the new
dating type API either by doing
conversion
in to the date to the temporal type that
is supported by our GPA 21 or just by
doing a conversion to three two strings
one quick remark so so today we have GPS
one this is one of the things that would
be fixed in GPA 22 so supporting
natively than USC eight that in time API
is something that we should see in the
next version of GPA what about GSF it
makes sense to also support that new
data API in GSF and basically the
approach would be the same so we would
use custom conductor to do that so this
is an example so we just need to
implement that phase converter and after
interface we have tomato in there the
first one get the so basically whenever
you you you you written something in the
browser it's obviously represented as a
string so you need to con need to do the
conduction basically between the string
and do that date and time type that's
what we do here so get a subject it get
a string and it returned instant type in
this case and obviously we also need to
provide the implementation do the way
around so get a string so we get that
new date and time type and we do the
conversion to return that as the strings
and obviously I need to use my new
converter in my gsm application so
that's what i'm doing here for example
on an input text and what I will have at
the end of the day 9 model so in my
beans is obviously that USC eight date
and time type right will be supported in
the upconversion of jsf natively means
um I haven't checked but I guess so
because one of the things that that we
are doing for java ee eight so Java 8
will only run on top of Java ac8 so the
idea is that whenever we do an update to
an API in Java EE for java 8 we have to
look if it makes sense to support some
of the new se8 capabilities so in that
case it would make sense as well great
hmm fine nice I love it let us talk
about annotations I heard that Java hehe
was quite heavily relying on XML
descriptors years ago and now it
realized every young annotations now
right okay there are new things in
annotation from Java 8 together for it
sorry from Java 7 28 basically if I have
a jpa entity and I want to declare name
queries on on this entity I need to wrap
those named query one by one in some
kind of wrapping annotation called name
queries parole I could also write them
in an XML stuff by the way but we can
also do that with annotations why do I
have to to rub this in a wrapping
annotation just because I cannot put
twice the same annotation on any element
in java SE it is not allowed it is
forbidden by the by the compiler by the
way if you try to do that you will have
a compiler error now in Java 8 there is
a modification to that and we can indeed
write this kind of code that is
repeating the same annotation modern
ones on any kind of element in a java SE
code in any kind of java SE code we are
going to see how it works but let us see
first some example maybe you can show us
some example so this is a pure java ee 7
code so this is basically a bean
validation so in this case we are doing
a validation so whenever we want to
order a calf we pass the data object and
we as we are using this check car
validator to make sure that we can order
that car so to do that again this is
pure java ee 7 i need to write the check
our annotation so it's a custom
validator so i declare the annotation
you i'm using the add constraint
annotation to specify what is my actual
constraint validator so it will be Cal
validator and the rest is just as you
would as you are doing in fact today
with mean validation so there's nothing
new there and this is the implementation
of my con
validator so it's a it's an
implementation of the constraint
validator interface they're just two
method in there the initials initialize
method that basically allow us to get
the value that is being passed to the
annotation so in the example it would be
a volkswagen VW well Volkswagen and then
there's a second method is valid which
does the actual validations so either
it's valid or it's not so it just
returns a boolean and in this example
I'm just doing a stupid validation based
on the brand of the car nothing fancy
there now if we want to make that
annotation repeatable in using Java ac8
we would have to do the flowing so it's
basically the same annotation the only
thing the only difference is that i'm
using the a treatable annotation and i'm
specifying there that check cars which
is basically a container for the
repeated annotations the rest is pure
java SE java ee 7 code nothing new there
now if we check well we also need to
define the that check cars which is
basically just an array for the check
car and notation so it's fairly easy to
implement there's nothing to do there
just an array for that annotation yes in
fact this trick is used by the compiler
that is the compiler knows that the
check our annotation should be wrapped
in a check card so it will add the check
cause annotation itself this is how it
works in July see what we have done that
we can do that so now we whenever we
order a car we want to make well we want
to do validation is it Volkswagen is it
an o.d so we can do those kind of tricks
now using java ee 7 on top of java ac8
that's nice so your car should be at the
same time reversed again and an Audi
know it Kyle talking about this
validation stuff people are using for
the well is illusion management yeah so
it can be able to again it can be energy
it can be a Skoda it can be a Porsche
and so on are great so the air will be
pure with this kind of bean validation
stuff
all right there is another trick that we
can do with the annotation in java c 8
is that we can put annotations on types
which was not possible in java in java
SE seven so we can for instance if we
decide that this list of people should
not be near we can add this non new
method annotation on it and some kind of
other stuff should check for this field
or for this variable whatever so that it
is not new and I can also put that on
the type parameter of this of this list
to check that I should not be able to
put any new values in a list now putting
new values in the list is not the
greatest pattern of all don't think you
should be doing that and we heard
yesterday that in Java is 9 we will have
new kinds of patterns to create lists
sets and maps and those pattern would
forbid to put new values or enlist so
making this kind of pattern quite well
not that useful in fact all right so
this was for type annotation and we
don't see the questions anymore so maybe
we could try to do something let us have
a look at the string class now the
string class is a quite a useful class I
never enough so any application that
does not use any strings in it by the
way there is essentially one thing I
would like to point out in the string
class and in a string field oh this is
picture time David come 8h not stage
thank you sorry people we just alone
with this fine lady all right so how do
you do how do we do however we do to
join strings in our applications
basically most of the time you take the
string builder since Java 5 all right
string buffer before that we just keep
adding a pending a pending a painting
stuff with it with a separator for
instance and of course at the end of the
day there's one separator that is too
much so you need to get rid of it once
your string buffer string builder has
been built and then call the two string
method on it and this little ugly piece
of code of course is copy pasted
everywhere because everywhere we need to
join strings to build bigger strings
with a separator and even sometimes with
the Pacific's and a prefix now the nice
thing is that
we have an API for that in java SE 8
which comes in the string join a class
you can build yes I hear yes this is
great we could have seen this kind of
addition to the JDK years ago but a just
happen in Java 8 so you just create a
string joiner on this separator we have
a bit low pattern ad ad ad ad ad parola
and then we call the two-string method
and it just worked out expected it of
course handles all the corner cases you
can you can imagine that is if I have no
element if I have only one element etc
without repeating these ugly code once
again and if I want to add a prefix and
postfix to the string joiner is very
easy just add more arguments to the
construction of the string joiner and it
will work once again as expected if I
have no argument i will have the opening
and closing curly braces and if i have
only one argument of course i will not
have the separator which is very nice
it's a real time-saver with no problem i
have another pattern for that inside the
string class itself in the form of the
of the static method join method the
joint method i just passed the separator
then a varga of all the elements i want
to join and I just print out the result
and it will work once again as expected
so it's even simpler the only difference
between the strange owner and this joint
factory method is that I cannot pass a
prefix on the pots fix to the join
method so if I need to do that I need to
fall back on the string joiner element
now this works on a raised in serum
works well on a resting since this is a
virag now if I have my element on a list
the simplest pattern is not this one is
to create a stream we are going to talk
a little more about streams later in
this talk basically you open a streamer
on your list of strings are and then
just apply this very simple pattern
collect collectors door joining this
correct method takes a collector as a
parameter we are going to see other
examples of collectors and these
collectors to joining with the
separatists
we'll just work as expected once again
so if you have a list or something that
can be turned into a list this is the
simplest pattern and more efficient
pattern to use and by the way this
collector's dot in a character also
takes a prefix and postfix so you can
also create strings by joining elements
using this pattern this is great i love
this one and this is super convenient
whenever for example you have to build a
path for example i mean that's something
that we do all the time absolutely well
to build pass i have another pattern
with the path interface that takes that
takes all the elements of the pattern
will join them in a given path now
you've probably heard about parallel
streams oh you can really completely
mess up this stuff by using parallel
stream which is very nice also as you
call parallel streams since you cannot
tell in advance in what order you
elements are going to be processed it
can completely mix up the string that
you're going to use now this was a joke
don't use parallel streaming with this
kind of pattern it's a anyway we have a
disclaimer disclaimer for parallel
strings yes absolutely and we have this
safe harbor statement what we are saying
just don't do that all right I think
this you did the next slide is yours no
that was my name I was supposed to do
the strings were you I'm sorry okay so
the next I this video's I'm not good
excellent sorry I guess you're right
yeah I'm doing the old stuff so finally
this is not all stuff well we have now
in the platform base64 support so that
means that you don't have to rely on
unsafe API or using a third-party API
that's something that is finally
building the platform so it's not a big
deal but it's nice now let's not the Big
Dipper is nice yes I love this one
absolutely streams we are talking about
streams stream is the there are two big
things in java SE eight lambda
expressions i guess that all of you have
heard about that who never heard about
lambda expressions before all right
i guess nobody so and the the other the
second big thing is probably the stream
api there are the mixing things in a
Java CA the other big thing is a stream
API now we are not going in too in too
in too much details in a stream API what
I will just would like to show you is a
set of patterns to build complex stuff
in our in a quite an easy way probably
the lambda expression are not so hard to
understand not so hard to use not so
hard to get used to the stream API is a
bit harder the patterns are not that
complex not that complicated to write
but it is it is harder to get it right I
mean you can really do wrong things
using the stream API and using it in an
efficient way it is not it's not that
easy in fact the i think the difficulty
is there is getting getting to use it by
following the right patterns to build
efficient code so what it is basically
it's a brand new API it looks like the
collection API but a stream is really
completely different from a correction
the main different difference between
the stream and a collection is that in a
collection there is the data my data is
in the list or is in the set or is in
the map whereas the stream does not hold
any data if you have one idea to really
remember about streams is that there is
no data in the stream the stream
connects to a source of data it pulls
the data from the sauce it processes it
but it does not create what it when it
doesn't need it it does not create any
kind of intermediate a structure like
with all the data for me thus leading to
very memory efficient patterns and very
fast pattern too all right let us see
some code with the stream API for
instance letters extract an Instagram
from some data I've got a list of people
all right and I want to create a map the
keys of the map of the city in which
those people live and the elements of
this map are the the average of the
people living in this city very
classical kind of data processing a
pipeline I want to back to build in fact
with the stream API it is just one line
of code this is one line of code with
the first step is to open
stream on this list of people people
that stream remember this this returns
me a new stream object that is empty why
because in a stream I do not have any
data second step I'm filtering that
streamer because keeping only the people
older than 20 not interested in the
others so once again this written me a
new stream object but in this new stream
object I do not have any data in it so
this is merely a declaration it says
free stuff and the last step is the
collect method remember the same same
method we called to join all the strings
together in the previous pattern when we
are joining streams now this time i do
i'm not using the collectors or joining
a character which will decide which kind
of structure i'm going to build i am
using the grouping by collector
collectors grouping by i have like 45 or
47 method factory methods in this
collectors class which is a very very ND
very useful in the application and this
grouping by of course you when you hear
that you you're thinking about the
sequel grouping by close now it's kind
of the same in there absolutely and it
creates a map a map structure now the
first argument of this grouping by a
collector is in fact called the key
extractor it will create a key out of
the different elements of the stream so
here the key is the city it's a method
reference another way of writing lambda
expressions basically extract the city
from the from the person class and this
grouping by a collector if i if i do not
pass any second argument it will in fact
create the values as a list of the
people that lives in the city now i can
post process those values one by one by
providing another collector which is
called the downstream collector this
downstream collector may look little how
to understand it is a collector that
will be further used to process the list
of data that are the basic values of
that in this hash map and here the
downstream correct i'm using is the
original collector that will compute the
average as double of the age of the
person the lambda expression in the form
of a method reference is used to extract
the age field of those p
so you can see that this is this is not
very hard to read probably harder to
write in fact it requires on training to
do but once you've done that you can
write really very very powerful pattern
in a very few lines of code this is one
line of code but if you want to read it
unit or to indent it of course so a
steeler if you one line of code on a few
line of source code great I've got other
examples of stream I can create streams
on well known structure for instance on
the string class I've got this chart
method to build the streams on the
different letters of the string and I
can further process it so for instance
map to object i'm going to cast this int
stream into a string of characters then
pass the characters to uppercase print
out the result and it will just print
out the hello world which is nice
another another example of pattern I
have this files that lines a factory
method on this on this fight factory
class it takes a path as a parameter
path which is just another model for a
file on the file system and this stream
will we will be composed of all the
lines of this text file the nice thing
is that this stream is auto plausible so
I can use it in a try with resource
statement of data 70 it means that when
i'm leaving this this try with resource
it will automatic closed the stream for
me and automatic closed automatically
close the underlying bufferedreader that
is opened on this file so if i want for
instance if this fight is some kind of
log file and i want to check the lines
that contain the error and i'm only
interested in the first one i can write
this kind of this kind of pattern also
very very easy very handy so basically
reading a text file line by line it's
just now one liner in Java 8 using the
stream API next next example i can also
write open streams on the regular
expression we have this pattern class
for regular expression in java i can
compile a pattern or just on this on
this splitter and split this book which
is hopefully a big big string of
characters
uz using this this splitter and this
will return a streamer of a very month
which is the result of the splitting of
this huge string of character now I
could use another pattern which really
looks in the same stream off and
passbook that split with the same
character as a separator now the first
pattern using the regular expression is
much more efficient at the second one
why so because it does not create any
kind of intermediate structure the
second pattern will begin by creating an
array of all the words of the string of
characters then create a stream on it
whereas the first pattern directly build
the stream on the result of the of the
splitting it does not create and does
not store into memory any kind of
intermediate array so it's much more
efficient as far as memory is concerned
and if I want to split a text file into
lines and then each lines into words I
can use this flat map operation which is
a well-known operation in functional
programming by using this function that
will take a string and return the stream
of strain this is the pattern to split
just a line of code like that which is
nice and if while talking about this is
because we are going to use that in a
very common use case in Hawaii which is
the JSON processing yeah let's had some
Java spice to this so in july seven we
have introduced this new jsonp api so
it's a basically an API that allows you
to generate and works on JSON so streams
JSON so on the right side of the slide
I'm using that API to generate the JSON
array which I have the representation on
the left side of the slide so i have
this contact which is basically a JSON
array so now i can do those kind of
things so this is basically more or less
the same example that shows a shown
earlier so contact get value as so that
basically mean that we now have a list
of a JSON object from that window
Limited streams so we will have a stream
self JSON object so basically all our
contact as a JSON objects then we can
just use the stream API as we are doing
in Java Sea eight so for example we do a
filter so we only want the female gender
in this case then we do a map so we get
the name of that female contact and then
we invoke the final operation so the
collectors and in this case so we are
doing a grouping by so basically we are
generating a map the key would be the
name of the well all the names of those
persons of those female persons and then
collectors counting so it's yet another
don't think collectors and basically we
would count the different names we would
have in our females contacts list so
that's something that you can do today
using a JSONP 10 so on top of java ee 7
but we can go a bit further so we can
also do stuff like that so the idea is
the same so i still have my contact
object which is a JSON array getvalue
ass so i have a list of JSON object now
streams so i have a streams of JSON
object with all my contacts then i'm
using the stream api so I'm doing the
filter I'm doing so my predicate I still
want to have the female gender i'm doing
a map and then the the final operation
the terminal operation is a collector
and that's basically collector that I'm
define defining myself so for that we
have to specify for functions so
collectors off then the first functions
is what is what is the general in five
years the supplier the defer the pattern
we showed earlier for that for building
collect collectors well directly the use
of these collectors factory class when
we use the adjoining we use the grouping
by we use the averaging double and i
think that's it that's it there are many
other they are like 40 methods in this
in this factory class but if you're not
happy with all those standard collectors
provided for you by this collector's
factory class you can also create
rollin collector and to do that you need
to provide in fact three arguments and a
fourth one if you need the first one
basically what a collector do is it
gathers it aggregate all the values in a
so-called mutable container yeah all
these elements yet this mutable
container can be with so example this
mutable container can be a string
builder or this was joining the strain
it can be a map it can also be a list of
course and further for the averaging
double it's just just a number in fact
so the first element is to you need to
build that immutable container so this
is what it yeah that's what we are doing
here so doesn't fit builder so basically
we are creating a container that will be
able to contain edges just an object so
Jason create builder as part of the
JSONP API then we need to basically had
the different elements in that container
so that's what we are doing in with the
second function so that's the
accumulator part the third one is a
designer yes it is use it parallel in
fact yeah if we if we are going to use
parallel streams you basically need to
tell out combine the different
intermediate result container into a
single one so that's what we are doing
in the third line so builder one builder
to you are basically adding to build a 1
double dot 2 so you are basically
combining your containers basically if
you want to understand thing paralyzing
means that you are going to to split
your data in two parts distribute them
on the first call of the processor and
then the second call the processor now
the collector will work each collector
each collecting process will work in
parallel in both cause of the CPUs so at
the end of the day you'll end up with
two partially filled instances of the
same kinds of mutable container here
JSON array builder and you need to merge
them to create the final results so this
third element is used to do this merging
which is here very basic because it's
just an some kind of adult method that
is called and this is only if we are
using a parallel streams yeah and the
last one is called the finisher so
that's something that you might have to
do depending on which object you are
working on so in this case is my Jason
create builder and if
you have been using the jizz NPAPI you
know that at the end you need to invoke
the bill method on it to actually get a
result back so that basically what we
are doing here so we invoke the bill
method on that container so because what
we want to get in return is a JSON a red
object so that's what we have here so
that means that once we are doing that
we still averages on array object so we
can continue to work using the JSONP API
so that shows that you can combine swims
with existing Java API obviously we can
simplify the code by using method
reference so which one do you prefer the
previous one or this one the phases of
the previous one and this one ah I mean
a legend next question we have to get to
that to sew to string reference do you
have to go first through that or can you
go directly so who's using this approach
so the old way lambdas and so on to get
that result okay that's what I'm doing
because i still find metal reference a
bit it needs them some kind of you need
to get used to it real the problem is
that when you see the method reference
here you see that the second the second
argument of the third argument are
others written in the same way and if
you can kill Justin and in fact it
doesn't it does it's not the same lambda
expression so the compiler uses the
signature of the characters of method to
check that this method reference matches
in the second case the accumulator which
is a special type of function and the
second method reference which looks the
same much as another type of function so
in fact those two lambda expression are
written the same but they are not the
same and I do not do the same so this is
this is what is confusing I think so
when we design API to it would have been
I think easier to read if people instead
of creating this add method that
sometime takes another JSON array
builder or an element of this JSON or
editor because it's exactly that they
could have done the same as the India
ever a doll method just to make the
difference between those two method
references so another approach is this
so it's basically the same example as
before the only difference is that we
are using collectors collecting and then
so we have a way to specify what the
finisher has to be in a different way so
you see that I'm I've disconnecting and
then method and then I'm passing a
collector with the supplier the
accumulator and the combiner and then I
need to pass my finisher so that's a
different way of doing things so what
the use case for that would be that you
can more easily reuse yeah in fact they
are two reasons for this pattern to be
there that in most of the cases the
finisher is there's the identity
function so instead of passing an
identity function all the time which
would not be that nice you can just not
pass it and the API will assume that the
fourth argument that you you didn't
specify it's just the identity function
now if you're using a collector from the
collectors class for in sort of raging
double and you need to add a finisher
that is not in the averaging double the
API provides you a way to do that so you
have this collecting and then special
character that takes a collector that
you could specify here we specify this
with the collector off but you could
specify it with the collectors dot
grouping by for instance and add a
specific finisher that you need in your
application for instance if you want to
build immutable Maps or immutable
collections you could begin by creating
your map using the grouping by and then
rub that into collecting and then and
pass the corrections dot and modifiable
map to build your immutable map this has
this has been done for that ok so this
is basically what you can do today with
java 7 the JSONP 120 api on top of july
c8 tomorrow you will be able to do that
so basically today you have to build
your own JSON collectors it works nice
but you have to write a bit of code the
plan for Jason p11 that will be part of
Java 8 is to add specific Jason
collectors so you won't have to write
those collectors they will be part
provided by the API itself
and you would be able to write those
kind of things if you want to learn more
more more about jazz NPAPI there is a
session in this room right after this
one done by Alex and meaty from the Jays
MPEG so they will talk about this on p11
so I encourage you to check that perrin
ilysm can kill you yeah the fact is
parallel the nice thing is that parallel
ISM can kill you now it's not that nice
but it's true capitalism can really kill
you we already saw in the in the joining
collector that if you if you go parallel
in that it will completely mess up with
the order of your strings which is most
of the time what you do not want to do
if you use a parallel ISM on the stream
API to build a sh map using the
collectors that grouping by it will work
perfectly well and build your hash map
much faster now if you're in adjacent
stuff and you're pulling your JSON
information from some kind of i/o maybe
going parallel will not save you will
not bring any more performances just
because your your computation is bound
by i/o and not by cpu the problem is
that parallel ISM is built on top of
multi-threading if you keep the clicker
then you need to pass the slides so
don't you want to talk about yes bit
well do the one who should be talking
about that yeah so so right now in Java
ac8 whenever you do a parallel operation
so pal strange concurrent hashmap and so
on they are based on the common for John
pool that is provided by a job I see the
thing is that the for John pools by
default take all the resources all the
CPU resources so that's really something
that you need to be aware whenever you
are you doing that in a java application
server because you can easily consume
all the resources so you but you can
basically kill your java application
server so there are some way to protect
you from that basically you need to set
the pilot level like this using that
specific
system property having said that I would
say that if you plan to use parallel
streams in your Java container today so
in a java 7 container you should be
aware and check with the provider of
that java application server if they are
supporting that for example web projects
does not and they're a very good reason
why we don't support that all there is
all the thread that we are using in the
java application server are managed
track so basically weblogic knows how to
manage those threats so if you are using
GSR to 360 concurrency utilities for
java ee which is part of the i7 if you
span a new thread that's managed threat
so weblogic has a full visibility on
that thread if you are relying on the
the fall joint pool weblogic so the
container will have no visibility on
that thread so things can go wrong very
quickly so my advice if you are if you
would like to use parallel streams in
your Java a container first make sure
that they are just a compute bond so not
hire bound and double check with the
provider of provider of your java
application server if they don't support
that and right now i'm not sure that any
july seven applications of provider
officially support parallel streams
today but obviously that's something
that should be fixed in the future so
for example there is an airy film GSR
2236 to support the ability to have
managed for joint pool so whenever you
use the for joining pull within the java
context it would basically be using
managed thread so the container will
have visibility on those trades yes what
about HTTP sessions and transaction then
threads etc if you using power it's not
supported of course so you shouldn't be
doing any kind of operation on you HTTP
session or transactional operation
linner if you are going to do parallel
streams yes so if you really really want
to do it use it with care and don't do
this at home now you don't want to do
that
move it all right the last last topic of
this talk is about computable future
computable future is a new API from from
Java 8 once again it has been made to do
some synchronous computing inside the
JVM it's in fact some kind of extension
to the future concept and it's built on
an interface called completion stage and
on an implementing class called complete
able future it allows basically to chain
the synchronous tasks the use case are
we would like to present you is a test
of a synchronous calls in a servlet API
in the jeebies in Jack's arrest I think
there are in WebSocket too yes so
basically the use case is the following
this is a copy paste from the Jersey
documentation Jersey is the reference
implementation of jax-rs and it shows a
use case for some kind of a synchronous
computation why why do they do that
basically they have some kind of long
operation in the inner jax-rs call they
do not want this long corporation to
block the user that should wait for the
result so they just launched it in
another in another thread and they use
this pattern no new thread new runnable
is really a patterns from java 1 we can
write it in a different way for instance
this one pass the right the runner ball
as a lambda expression since the runner
ball has only one abstract method you
can implement it using using a lambda
you see that the European parentheses
here is the it shows the fact that the
Lamb that does not take any parameter
and then you submit this lambda to the
submit method of an executive service
which could be managed for instance and
then hopefully it will it will be
executed in another thread now the
question is how can I unit test this
code because basically when I sing get
returns oh I most of the time this
runner ball element will not have been
executed by the executive service and I
do not have any clue when it is going to
be executed so if I want to check in my
unit test if the long operation has
returned the correct result if it has
been cold anyway
and if this result has been properly
passed to the resume method of this
succinct response object I need to use
some kind of trick to do that basically
what i want to do is to check if the
result object is passed to the resume
method of the succinct response object i
need to do that once it has been
executed on by default i have no clue
when it is executed and i want to do
that in a visible way we're going to
talked about that in the next slides how
could I do that basically if if I if I
was not in an asynchronous world well I
would probably be using some kind of
mercury mock framework right this kind
of code mock that verify mock the
sanctuary spawns and verified that the
result object has been passed to the
resume method of the smart object this
is very basic mock pattern written in
mockito they are other mocking
frameworks around and the fat one may
vary of course but the thing is I need
to verify this one the rent method has
been called and one it had been executed
this is where the completion stage in
facts come to the rescue I can use
completion state to do that now this is
my pattern I've got this sink get method
that returns void that is called by
jax-rs on the invocation of a special
path in my rest service what I'm going
to do is to split this method into two
why do I want to do that because i need
to to get in fact a complete able future
object now if I modify the return type
of this sink get method since jax-rs has
a very bad tendency of converting
everything in JSON I don't know why it
probably will not work very very well
because a complete able future is not
the kind of object you can easily
convert into some kind of JSON array or
whatever now I tried it in fact it's
crusher there are big big stack traces
in in the logs of the service so don't
do it right so I just put this method
into and the second method instead of
calling executor dot submit and passer
in a bowl I just modified this pattern
in a very easy way
complete able future Rena sink static
method from this class pass the same
runnable exact same vulnerable and the
executor at the second argument and it
will just work the same it will execute
this renewal in this executor the nice
thing is that call Renee sink returns an
object it was not the case where it was
the case for further for the executor
this subject was a future but this
object is not a future anymore it's a
complete able future and on this
computable future I have a bunch of
method to run things things I
synchronously basically on the future
object what i can do is call the get
method this get method will return the
object or return void that is Newton
basically will reach and wants the
runner ball as finish its execution but
I need to do that in the calling thread
in the firing sweat I cannot do that as
a call back and this is not what I want
it's a blocking call so instead of that
i'm using this complete able future and
on this a computable future i have the
second method then run that will run the
pastor noble once the first 10 ball has
been executed and completed so it's just
a matter of calling executed sink then
run pass a runner ball to do the
verification now it's not it's not I'm
not quite done with this pattern why
here I saw my first problem I've got a
renault bowl that run asynchronously now
i can plug some kind of call back after
this run the ball as run but what i need
to do is since i am writing to my mark
in the the first runner ball and
verifying that this muck has been
probably called in the second one I want
to do that in the visible way so i do
not want several solution to do that but
the simple solution i think to do that
is to call it in the same thread to
ensure that all the calls are done in
the same thread and i can do that also
with a complete able future because i
can specify in which executive service
everything is run and this executive
service can be a single thread executive
service alright so the first step of
this pattern is i create my mark and
create the verification all these are
runner balls so the result on the
response are just mock object I don't
about them the trainer will tell me
right when response that log operation
is called I do return result this is
basic mock pattern then the verification
rain Bowl verify that the resume method
the resume method of the other response
subject has been called with the result
object fine and then what I need to do
is create the call I think results
execute I think then run the
verification and rub that into our noble
also that I call call and verify now the
complete patterns becomes very readable
even even if it's not that easy to write
just run I think trainer that is the
training of my mocs in the given
executor notice that this executor is a
single thread execute so all the
computation will take place in the same
thread this completely solving all kind
of visibility race conditions issue I
could have then run the call and verify
this will run the test so if the test is
green that's nice now the problem is
that is the test is red and if my long
corporation really takes too much time
to runner I will I might run into a
problem because basically my j unit test
will have threads we will spawn threads
that do not finish and that will block
the overall test so since a computable
future is also a future it implements
both interfaces completion stage and
future I can also call a get with some
kind of time out to be sure that the
thread would complete properly now if I
if I before if my estimation is that
this long operation takes like few
milliseconds to execute if I'm waiting
for one second it will be enough and if
after one second I still do not have the
result I will just throw a timeout
exception just to be sure that
everything is one quick remarks
regarding a jax-rs incompatible feature
so the next version of jax-rs subjects
rs21 which is being defined right now
one of the ID they have is to support
for complete all feature in the
jackorris client api and so they are
working on that right now so that's
something that you can see if you are
following the jacks or ECG discussion
yeah and it i think that in jersey you
already have some early works on the
only suspect by the basically the idea
is that as and standardized based on
those implementation solutely you need
really need to want to check the jersey
implementation if you want to have ideas
of what's what's coming on in inject
service add in java niner that is java
89 now in five years from now we will
have a flow class that is already
available in the OpenJDK nine with so
called reactive programming and and
complete support for this kind of
operation great so it's time to wrap up
so java SE eight is not just about
lambda so today we've seen some of the
features that are provided by july CA
that you can start in july seven context
and I mean it's just the beginning there
are a lot of things that could be done
we haven't talked about the collection
framework we havin well we have talked
about the concurrency that one is a bit
tricky in a Java context today but we
for example we haven't discussed about
Nash horn which is part of a 88 that's
something in an enterprise context that
could make sense so using javascript for
doing some specific task and so on so
there are a lot of things that are
available today and I mean chances are
high that you are already running on top
of java SE eight so it's really a good
idea to start to look at how you can
leverage some of those features which
are available today in your runtime even
if you are running in a java a new pure
java 7 context so with that we have few
minutes for questions so i think someone
asked about the slides or the slides i
think they are already on SlideShare
somewhat someone said on Twitter that
this presentation is done by Oracle guys
I'm from Oracle is not so our free man
I won't comment this is what I told ya
we don't have any more question on
Twitter so yes please yes
the question is that if you do not have
the disreputable annotation from java c
8 you will not be able to repeat
annotation on any element and yes this
is true absolutely so you need you need
some kind of refactoring of the of the
annotation you want to repeat a far away
for it to for this reputation to be to
be supported absolutely yeah I think it
still returns cars and it works the old
way it has not changed yes the question
was about the way java reflects works
with ribbiting annotations yeah well and
by the way that's something that they
are they will do a bit of bean
validation using a repeater annotation
and that's something that we'll be using
the date of GMS in GMS tomb 21 any other
questions
yes
yeah you mean annotations on types yes
how'd you check that you need to write
the code yourself is not checked by
default for you yeah absolutely you need
to write that yourself this is not
enforced by the JVM or the api's or
whatever with it's an if it's an
information you can provide and take you
to take it into account in your in your
the code of your application sorry I
didn't hear yeah we don't hear you so
yeah
no more questions
okay okay that's it thanks a lot thank
you for attention</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>