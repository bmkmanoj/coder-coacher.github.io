<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Slice &amp; Dice your Monolith with Domain Driven Design by Edson Yanaga | Coder Coacher - Coaching Coders</title><meta content="Slice &amp; Dice your Monolith with Domain Driven Design by Edson Yanaga - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Slice &amp; Dice your Monolith with Domain Driven Design by Edson Yanaga</b></h2><h5 class="post__date">2017-11-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TYgHtZhS1jI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everybody good afternoon
well it's always a great pleasure for me
to be here at devoxx I have to confess
to you it's a bit colder than expected
here in Antwerp and just in case you're
wondering I think I told this last year
but I'm a Brazilian Japanese and not the
typical Brazilian you would expect but
yes Brazilians can be anybody and I get
a lot of questions about that
my name is at ciénaga and I'm currently
a director of developer experience at
Red Hat's my twitter handles at ciénaga
and today the subject of this deep dive
session is slice and dice or monolith
with domain driven design so we're going
to discuss a lot of different approaches
both for codes and for architecture and
and we have like I hope enough time to
be covering all the days with some live
coding - I'm also a Java champion and a
macro song with MVP which is like a
different combination and I think that's
so far unique and many of the techniques
I'll be talking a bit about sakura-san
events or see in the second part of this
talk and I'll be just presenting a very
just one integration technique for you
for you to create your architecture with
that but if you want to dig more into
the subject I do release the book from
O'Reilly migrate to - microservices
databases where I discuss other
approaches for creating your your your
security architectures and on Wednesday
are presenting a talk because this book
is only about relational databases and
after that I've discussed with many
people other approaches for creating
these security architectures even
sourcing with different data stores and
different data requirements so on
Wednesday I'll have another talk about
that where go discuss different
requirements for data and how can we
create different security architectures
with that but for relational databases
this is the reference that I have and
some of the things they'll be discussing
today are written on the book - and I
always like to start my talks with this
quote from Forbes just in case you
already
about that I'll just be repeating in
there a few minutes again now every
company is a software company I like to
say never all the places I visit you
don't work for a bank
you work for a software company you
don't work for an industry you work for
a software company because software is
changing the world some people call this
digital revolution or digital economy
and I liked the the the definition of
digital economy because I used to be one
of these people that thought that
economics and economy had everything to
do about money but after studying some
some economics and particularly behavior
economics and behavioral psychology I
just learned that economics has nothing
to do about money but has everything to
do about people because basically they
study how people interact with each
other in the system how in which are the
motivations that people have to change
the system from one state to the other
and some motivations can be love can be
hate can be power and can be also be
money and we're talking about software
software is an economic system and we're
designing software for economic systems
because we we software developed by
people for people
every time we forget that we don't get
an optimal result that's why it's so
important for us to have the discussion
about Microsoft's architecture and
domain design because in the end all the
matters the true that the thing that
truly matters is the people involved in
developing the software and the people
that are receiving the software and some
great examples of this new digital
economy are that the largest car
transportation company in the world owns
no cars which is uber and I realize that
it doesn't work here yet the largest
lodging company in the world owns no
real stage we see Airbnb the largest saw
lie we tell you in their word on the
sauce no stock which is Alibaba and the
largest content network in the world
produces no contents which is Facebook
all of these companies they have
something something in common is that
they only exist because the software and
the software that they are producing is
changing the way that people interact
with other people that's what I like
about this digital economy we are
changing the way that people interact
with each other and since we're talking
about the vein driven design and how to
create and craft better software I
always like to
myself too as a software Pressman or and
I know that we have many different
definitions about that some people like
some people don't and but for me the
best I finish that I have for a software
craftsman of question craftswoman
if somebody that well when he or she
cares about that the the job that he or
she does and the software that we
delivered for the people because we know
that we can change people's lives for
the better but we also know that we can
make them usable so we can also always
make a choice I'm I made a choice six
years ago six years ago that I didn't
want to to provoke that feeling of
making people musical with the software
that delivered because sometimes we were
just in the job for the money
we're just delivering we're just coding
we don't really don't care about what
will the impact that we're having with
other people's lives into production and
I thought that I if you wanted to keep
doing what I did and what I do like
coding I really wanted to have a bigger
purpose because in my career I thought
that it wasn't meaning anything to me at
that moment but after a reading that we
can all change people's lives for a
better with what we do I think that's
that's that's the role that's a purpose
that I took many years ago I think
that's as a decision that's the choice
that we can all make today and one not
and I also believe that software is a
craft because it's not like any new
stroke thing where we can we can always
deliver the same thing multiple times
every time you craft a piece of software
is different from the previous one and
even if we were paid to do the same
software twice we would that different
in the second time because we would know
better things we would have more
experience we will have different
techniques for applying that we would
have different technology and we
certainly could provide a better result
at the second time that we do the same
software that's why I believe it's a
craft it's close I think it's much
closer to an art in the sense that we
are always trying to produce something
better then some industrial process
where we're trying to just reproduce the
things that we did in the past and when
I visit the Computer Science Museum at
Palo Alto this one of the the quotes
that I like to put in this kind of talk
that
computer programming is an art because
it applies accumulated knowledge into
the world because it requires askew and
ingenuity and especially because it
produces objects of beauty I'm pretty
sure that for many of us that we care
about the code very few things in the
world are better than seeing like a very
nice piece of well-crafted code
especially if we if we were able to do
that so I don't know maybe today it's a
good thing tomorrow is not such a good
thing but I think we were always you
always need to try to to improve the
thing that we're doing and in the past I
always scared about the code the quality
of the code that I was producing and in
some days I just used to you to look at
the code that I did like two months ago
and was looking at that was saying to
myself what a crappy thing and but and I
used to be piece of about that but later
realize that if I if I today I can see
the craft the code that I created like
two weeks ago or two months ago or six
weeks ago and if I can say today that
this code is a piece of crap is that
because today I can do something matter
I think that's the I think that's the
goal that every programmer should have
that we should take a look at their code
that we do to do we did like in the past
if you look today we can we need to be
able to say that well today I can do
much better than I did in the past
that's one of the nice things about our
our professions and also the last quote
that I want to present to you is that
from Jordan oppelo no matter what other
methods you apply to achieve competence
in a social system in the end it all
depends on whether people actually care
so I believe that you're all here at
devoxx which for me is the like the
premium developer conference in the word
is that we all care about we're doing
and just in case you're watching this
this video on YouTube - I believe that
you care about your what you're doing
and we can all craft better software to
change people's lives and since if we
talked we were going to discuss about
domain driven design the air caverns
books domain design was written more
than 10 years ago
but I still think that we're trying to
catch up on the concepts and the
methodologies and the things that we
should be doing to have a proper domain
driven design and if you read Eric Evans
book I think it's a very it's a very
hard hard read because you get a lot of
this concept even when I read the book
in the past I read lacked your free time
you read the book and you see though
this is amazing but how do I apply these
concepts in Prats it's very hard to
grasp and in the past few years we had
some authors like Ballmer no he wrote
some very nice books about how to
implement domain driven design in Prats
but even still I think it's hard for
most of us to be dealing with the
practical aspects of trying to apply and
domain different design and I know that
if you ask any domain driven design
expert he or she is going to tell you
that well the range of design is about
finding the why are you doing the piece
of software that you're doing now so you
need to know the reasons the business
requirements you need to talk about
domain experts and everything else to
know to know how the software works so
it's mainly like a design thing that's
why is the menu of design but even after
you decide well we know which kind of
system we want to design we know the
departments we know the events that we
have in your system we know how to
proper properly tech or the complexity
of that we have a gaps to you on how to
apply these things in code that's why I
dedicated a good part of my life in the
past few years trying to to uncover
better things to to transform these
ideas into code and I hope to be able to
share some of these to you and if you
think about after you're able to apply
some domain driven design ideas and
concepts into your code you'd remove
much easier for you if later you decide
to create a micro service architecture
about that because people always say
that the the magical thing about domain
designs is properly defining your
bounded context and if you have properly
define it mounted context it will be
much easier for you to later be creating
your micro service architecture because
then you can easily map each one of your
bounded context to a different macro
service and when I when I thought about
this session I look at about many
different source code bases available as
open source in github I try to dig
through many of them but I notice I I
realized that most of the source code
that we have available to to try to
apply some of the render of the design
and later refactor to a micro service
architecture they have such a degree or
complexity that it would be that would
be almost impossible for me to show
something useful in just three hours
would take like weeks to to be working
with the we would seem to just design
properly so even though it was my
initial idea I wasn't able to find a
proper source code base a legacy sort
caused base to be doing that so I had to
create a simplified model just to
explain some concepts to you that's why
we want what we're going to use today
and with that I intend to show to you
some code smells that happens in every
single piece of code that I've been
looking at in the past like 10 years I
used to be ended up not consulted before
joining Red Hat's and I used to help
many different teams ranging from small
startups to big like Bank big big banks
and financial industries and also large
like online retailer companies so I've
seen like this kind of code the some of
the code smells I'm going to present to
you I've seen that a lot and I've always
been able to help people to refactor
this code nails into better codes so
later we can try to apply some proper
domain driven design concepts and maybe
later we can even try to split some of
these concepts into macro service
architecture which is the thing that
I'll discuss with you in the second part
of this talk so some code smells that I
think that are very important for us to
check out to be able to do to create a
proper model first primitive obsession
we just you in even some of the domain
driven design books that have read in
the past Mouse these two they try to
apply the main window design but it
still have this this code mail this
primitive obsession because even when
we're talking about aggregates entities
and value objects in many diff
cases I think we're not applying custom
types in the proper way so primitive
obsession is an anti-pattern or code
smell saying that if you don't know if
you should be creating a custom type on
your own type for for defining something
in your software then maybe you should
because it's much easier for you to
remove a custom type than later try to
add a custom type to your code later and
we have this nice article from Martin
Fowler went to make a type which
basically he describes some of the
reasons for you to create a type in your
software which is basically if you're
using Java to create a new class to
represent an abstraction your code and I
would argue that like 90% of the times
maybe you should be creating a custom
time for your domain model at least ok
and we're going to explore that other
things that we need to talk about I know
there's some bike-sharing about talking
about no pointer exceptions because
there is no proper solution for that but
I think that the penny on the use case
for that you may choose between
different solutions for your problem
depending on the use case we can apply
new objects depending on the use case we
can apply Java optionals depending on
the use case we can try a different
applause approaches even embracing new
in some use cases I'm trying to discuss
some of the options that we have also in
our code to to apply proper null
handling and talking about is splitting
well if you if we're going to be able to
refactor our source code properly into a
domain driven design proper aggregates
entities and value objects proper
encapsulated code proper encapsulated
data yeah after I have that how can I
split this thing in proper modules and
later may be proper microservice
architecture and just to to tell you
what I consider to be the proper
solution right now is that if you're
talking about which kind of problem
we're trying to tackle when we discuss
in splitting our architecture into micro
services we have different scopes that
we can approach we're talking about the
problem we have simple problems and have
complex problems we also have easy
problems and we have difficult problems
I would say that split after we have a
proper encapsulated code and code and
data in our in our code base I think
that is splitting that in the micro
service architecture is basically should
be targeted if we're much closer to the
simpler problem rather than complex but
we're much also closer to the difficult
part instead of being easy and I know
how many of you had distinction in mind
but I used to be confused about the
distinction the distinction between
simple and complex and easy and
difficult but basically and we know that
something that is simple is easy I would
say that becoming let me give you a
popular thought I would say that we all
know the recipe for getting thinner like
to lose weight losing weight for some
things simple we just met yes in theory
we need to eat less then we eat less
clever than what we spend so it's a very
simple way to solve a problem but is it
that easy
certainly not that's why most of us have
a big belly that's my issue so it's very
difficult for us to lose weight so now
we have this kind of please simple and
complex easy and difficult I would like
to say this pleading later it's simple
but it's very difficult because mainly
because of the data associations that we
have in our code base and I also had to
learn that most of the techniques that I
have to show you today is basically a
process of wash rinse and repeat I don't
know how many of you are a native
English speaker I'm certainly not I
speak Brazilian Portuguese and for me I
always read this
rinse and repeat thing that we had and I
had to google and found I found on
Wikipedia but the source for that and I
just realized that is this very
sarcastic way to to be to be saying that
something should be done up to
exhaustion maybe with some recursion and
then I realised that in English it's
usually the wash rinse and repeat that
the thing that they did that's the thing
that they write songs and pool labels so
for you to be spending your shampoo in
ad infinitum so for me was a curious
thing to be learned when I was preparing
for the talk
and later you realize if you are able to
to create your micro serves architecture
you have to embrace you caress I'm not
pretty sure if everybody needs to
embrace events or see but definitely
York Thatcher will embrace events so
we're going to discuss some of the
motivations for you to be creating your
security architecture why event sourcing
is appropriate for some use occasions
for others it's not why you should be
using events and how you will you be
creating your secure as architecture I
thought about a very well designer
diagram for your to show you what is a
secure s and events source architecture
but I think it's much easier for me to
explain what is a security architecture
what is even sourcing and how can apply
that through if I just show you a code
write some live coding maybe so we're
going to create some security
architectures we're going to create some
events and maybe we'll be able to
depending on how much time we have maybe
we might even be able to create an event
sourcing kotecha for that but I'll stop
talking with slides for now and now I
want to show you some proper code ok so
now let me you're here increase the font
later I have here my IDE okay
have a typical legacy application well
not so legacy but it's I want to say
that it's a monolith because basically I
have an artifact for doing everything
but I want to use something novel so
it's a monolith but I'm using wild fly
swarm just because it was very easy for
me to create a project using wild form
but we have like the traditional J of
Java API is will have ejbs we have JSF
and we're gonna use JMS to native
queries and we're going to do some other
cool technologies that I think that are
appropriate for creating our security
architectures as our problem properly
encapsulated codes so I already have a
model running here into production and
just to show you but I did the project
in the proper way so if I want me to run
my monolith here I'm gonna one for swarm
that run and when using just using like
my CLI because you know now maven has a
color output so it's very nice to see
you too because like you know 15 years
at least now have colors if I get to run
my wild flash form application
I already have some things running and
if I store it up okay if I open here
okay my application is already running
then I can just go through the code same
here so but I'm not interesting the
partner is already running because I try
to apply some domain-driven design
techniques on this part what I want to
show what most people do when trying to
create their domain model using
traditional applications and I'm not
talking about legacy because I believe
that many people are still trying to
apply this console new code being done
today so talking about packaging when we
try to organize our code in packaging
I've seen many different ways that
people try to organize their code but
but most legacy code bases
try to organize and that's the thing
that I used to do in the past to try to
organize there the layers in the
software catcher by time so basically if
you're using da O's or repositories you
just put all of your interfaces
implementations repository types there
if you're using controllers for your web
interface you put all the controllers on
the same package if you're using like
service if you're creating service
classes which many people think that is
a nice thing because it's a domain
driven design thing you just put like
the or your all of your service classes
in the same package so basically you
have very few packages in your system
isn't like you might have a package
we've I've seen like a package wave like
you can have like 300 classes and each
one of these classes can have like 2,000
lines this is the traditional legacy way
of applying packaging and crafting your
code we can do better with that and so
what I propose you can use a traditional
domain you have designed they're docked
at room some people try to advocate for
exact I know architecture these days
where you think that everything runs in
the core you have your domain model and
everything else is an adapter to the
outer world like if you have a data base
you have an adapter to be storing your
entities into our database if you're
exposing your data through rest
endpoints maybe you have an adapter to
be exporting that if you're using some
kind of messaging system to expose your
data maybe you have an adapter for that
I think that's a very nice way for you
to organize but that's not the approach
that we have available when we're
talking about legacy systems and usually
we'll have a traditional layered
architecture and I think that after you
are able to think about which are your
proper bounded complex and once it today
I give to many different teams well what
is this bounded context well how do I
found a bonded compounded context in my
system I think that the easiest way for
you to find your bounded context in the
system if you try is if you try to to
apply the transactions boundaries that
you need your domain model into your
source code because in very very rare
situations you need the transaction to
be spanning between different
founded conflicts so if you're able to
found to find like a single piece of
your source code where all of the
transactions that are applying your
source code base that are containing it
that's the same domain model I think
that's a good candidate for a bounded
context okay so you rare you will rarely
see transaction boundaries being
expanded across different bounded
contexts so creating and one-to-one
relation between transaction boundaries
and domain model is a proper way for you
to identify a bounded context but again
bounded contexts are modeling problem
okay I'm not going to be able to to show
you the or create a proper bounded
context with you if you do not have a
very complex problem to be solving but I
can show you to how after we create we
with the final which is the problem that
we want to solve where I can show you
how can we create a proper aggregate a
proper entity and proper value object so
I'm going to create here about that
context about ordering so great in the
core of my domain model or create an
order so here I just organized packages
this way so if you're gonna have here in
the previous domain model that I have I
create a customer package and within
that I have all of different all of the
classes about my bounded context I'm
going to create another bounded contexts
called
order and within that I'm going to
create the same package of structure so
I'm going to create package called the
main dot model and on this package I'm
going to be able to create what I call
my order class so I realize well order
probably it's an entity so if for jpa if
i want to map that with my with my JP a
SKUs if I want to model this this this
order class into a giant database may
back into that maybe I can add the ID
for that
and since we have a lot of time well not
that long a lot of time but I think
since this is a long talk I know that if
you have some questions maybe it get
lost in time if we leave everything for
to be asking in the end of the session
so you've had any important questions I
think you can interrupt me in the middle
of the of my talk because I think it's
much easier for us to hold the context
of what we're discussing this way okay
so maybe I can add an entity and I know
that some people criticize the way that
I show well this is not how you can
apply a proper domain-driven design
architecture because you're just
polluting your dummy model with
implementation specific details which
are the Jaypee annotations what I wanted
tips that I want to give you one of the
alternatives that we have for like
instead of creating our domain model if
we can create a pure pojo domain model
with no one notations at all and then we
can create an anti-corruption layer in
domain driven design terminology to be
applying this domain model to our
database but basically that means that
we're going to replicate all of the
classes and value objects and everything
else in two types in two different
packages and every time we have to
change something here domain model we
have to change in the end group and the
corruption layer too and to be very
honest that's the part of the system
that we most often change so I don't
think it's worth to be creating to be
creating two different models unless you
have a very strong desire to be changing
the implementation technology that you
have for your object persistence which I
don't believe that will be true because
most of them most of us will keep using
JPA for the next few years or are we
already using JPA for that and I think
it would be like a huge waste of effort
for us to be to be creating this two
layers domain layer and adapter layer
just for and just to not pollute our
source code with our JPA annotations
okay so one of the tips that I like to
give this in this case is don't fight
the framework if the cost for you to
avoid the framework in your domain model
is too high in this case I believe it is
just a brace the framework
even with all of the advantages and
limitations just embrace the framework
because it to make your life much more
easier so order order it will have an ad
maybe it's gonna have like a northern
number so I can add an integer a number
two I need a number maybe an order it
has some items and if I want to create
an item maybe I have a list of that
there is no such thing here and for now
I think there's enough I'm going to
create this class to where your item
needs to be serializable and here that's
the first thing that I want to tell you
many people implement that as an entity
I believe there's another way for yours
to be doing that depending on our
business requirements so what does the
Northern Light have maybe I have a
string which represents a product it's a
very simplistic model for now maybe I
have a big decimal which is the amount
of the product that I have and maybe I
have also a big decimal which represents
the quantity the price that I have in my
domain model in a nomad many of us would
just generate automatically the Gator
isn't centered for a model and one of
the greatest advice that I want to give
you right now is that sorry is that the
hardest problem is that we have usually
in production when we try to debug and
find the cause of problem is
inconsistent States usually our systems
keep running for a long time and
depending on the actions that we apply
our system we can lead our system to
such an inconsistent state so we have
some things that should never happen
when when we look at the data especially
the data there is story database we
should never have to have this kind of
information but it is there and assuming
that nobody changed that information
manually it's very hard for us to know
that the source of the of the problem so
I would like to say that the hardest
problems for us to tackle
in our production code are they want to
cause it by inconsistent estate because
when we're talking about codes bugs
within a method because it's not
processing properly or anything else
okay but when we reach inconsistent
states it very is very hard for us to to
try to tackle that and the one of the
causes for a reaching inconsistent state
or reaching inconsistent state very
frequently is that because we design our
classes to be very mutable so
traditional way of creating our entities
our domain model entities is to create
like pojos and we just generate getters
and setters for everything so if I just
get my IDE which is a kind of dump code
I just I suppose all of the properties
that I have in my class here and in
order to I'm going to create the same
thing again I'm going to regenerate my
getters and setters and if you think
about there is no encapsulation all if
you think about object object-oriented
software one of the greatest benefits I
think for me the greatest benefit of
object orientation is that the
capability for you to encapsulate the
data which means your state inside a
class and create very explicit
boundaries that can control the state a
modification inside of that but when we
allow our classes to have like multiple
getters and setters
we basically return in our source code
that's anybody in our system and we're
making this things public anybody in any
package can just go and modify the
internal state of my domain model and I
won't even know who caused this this
modification so minimize immutability I
think it's the greatest go of trying to
when we've trying to work with domain
model we're trying to minimize
mutability and I know that sometimes
with JPA or even the other frameworks
that we work for because we with Java we
have the Java Bean specifications and in
many different cases we need to provide
getters and setters I'm not sure if we
have to provide setters for everything
getters most of the case we we need to
provide because of the frameworks but
even when we do we need to try to
minimize the mutability on our source
code so you can properly hold and defend
the data that is inside that so we can
never have
consistent state so I'd like to advocate
that all of the getters and setters that
we produce we're creating our codes I
don't like to generate that
automatically for an IDE I think we
should be thinking very well before we
expose any kind of data so one of the
things that we have - one of the ways
that we have to try to minimize
mutability is to not expose directly
through gathers and setters and whenever
we can we should also be trying to make
our classes immutable okay so I stop
here and I try to discuss this how many
of you are aware of the notion of
entities and value objects in domains of
design terminology okay half of the
people so I'll try to explain to you
what is the difference between entities
and value objects in domain driven
design terminology I'm gonna try to
create our domain model we can identify
some abstractions your a system that's
hold identity and some of them that
doesn't hold identity for example if we
have like if I have give you an example
again everything every time it depends
on your domain model so if you try to
oversimplify that I'll say that okay if
I'm going to create and some notebook
with which I'm going to store some
contacts on that if I'm going to create
an address book or a contact book I
created an entity called person this
person it might have a phone number it
might have an address you might have a
name and everything else
so it might have a sex in everything
else but and all of the attributes of
this entity called contacts are called
person all the attributes can change
over time but the identity of that
entity never changes so it's always the
same entity so if I have a system
payment system a banking system I have
an entity for myself I can change my sex
I can change my name I can then change
my address I can change my date of birth
I can change my social security
information but the identity never
changes right so I'm always myself
represent
the system so all the properties can
change over time but I always will
always have the same identity for in
other case there are some abstractions
in our system that it doesn't matter
which identity they have for example in
the same process if I have a contact or
a person and a person has a phone number
supposing that it's not a telephone
company system if I have a phone number
if I doesn't if I have phone number and
my phone number for now that the number
is like 1 1 1 doesn't matter for me if I
change this phone number 1 1 1 2 another
phone number with the same digits 1 1 1
I don't think so
so we can create two different objects
with the same internal value and I can
exchange these objects within my
entities and it won't change the meaning
of my software okay so we have entities
which are identified by identity and we
have other things called value objects
which are identified only by their
internal value so phone number 1 1 1 is
equal to another phone number and 1 1 1
in the other hand I can have two
different entities in my system and I
have I have two people in my system one
context is call it add sonia naga and
the other contact is called heo Naga -
but they can be different person
different ok in fact it happens it's
yanagiya is a very rare surname in
Brazil you might expect that but and
Edson is not such such a rare name
because apple s name is that so - and
but if you think about that they are
free different at some Nagas in Brazil
and all of them are relatives you see
and one of them is my father so you can
see that the confusion that we might
arise when we're talking about that ok
so you have like different people with
the same internal value of name but they
all represent different identities so
basically that's the distribution
between identity and the value object
right so
for me when I'm talking about an order I
can change all of the attributes of the
order over time but we will always be
the same order so order for me I think
it's an entity but on the other instance
if I have a number a northern number
doesn't matter if my order number is
five and then replace that order number
five and another object with the same
value five I don't think so so order
number this one could be a value object
so I'm going to create a custom type for
that because I don't want any integer to
be available as an order number maybe
for the numbers I have a specific
requirement or their numbers must start
with a thousand or their numbers must
never start with a zero maybe when I
want to output the value of my order
number I've a very specific format I
want to output that as free digits -
three digits dot three digits or
something like that so maybe I have very
specific requirements for that and I
don't want inconsistent numbers to be
stored in my entity so I need to create
a custom type for that so I'm going to
create a custom type called or the
number an order number I can create a
class for that and in domain-driven
design terminology value objects should
always be immutable and another thing
should is a very strong term for that
but if it's not immutable you can you
need to minimise mutability at all costs
as we are changed because again
mutability is the number one source of
problems in your internal state when
you're talking about the code so one of
the ways that I have to create a custom
type for that maybe I can create rate
final because I want that to be
immutable internally I can store a value
as an integer but I'm not going to
disclose this information to outside I'm
going to get it encapsulated here inside
my order number and if I want to create
of course it's complaining because I
needs a constructor I don't like
constructors - I don't think that we
should be exposing constructors so I
want to refactor that - through
effective methods and we have some
different advantages for creating
effective methods instead of using
constructor for example factory methods
can be polymorphic you can return any
subtype of order number in the soft
methods you can have cell you can have
some custom business Lodge for creating
your objects here too and also if I want
to perform some optimizations like if
you ever seen its source code of classes
like decimal which is immutable in the
JDK you can see that if the cost of
creating and objects is too high or if I
want to be able to perform object
equality maybe I can even use the
flyweight doesn't matter and internally
here when I have a sector method and it
is impossible for me to achieve that if
I'm using just plain constructors so I
have many different optimizations that I
can apply here able to perform the
validations and and some other useful
things I added to my project the google
guava library and another when I say
guava some people have some shivers
because oh my god it's good we have done
having compatibility problems in the
future because many different
open-source libraries they have that we
have available have different versions
of guava and they have a very they
didn't have a nice the percussion policy
in some versions of guava so you might
have incompatible versions and it's a
very hard problem to solve but at least
on the latest version of guava I've read
on the commentation that they changed
the deprecation policy they're not going
to remove like public classes or public
methods anymore which I hope will solve
many of different problems they're
trying to stick to a more conservative
approach for deprecation just like the
one that we have we had traditionally on
the JDK so to perform the validation
let's say that the the new that the
value that provides here can never be no
I also like to say that the value needs
to be bigger than a thousand needs to be
bigger than 0 then than a thousand ok
perish show some error message to value
must be greater and this kind of
information I can use later for example
to
to show some error message on my
interface if I wanted to do have proper
interest on internationalization I
should never have liked a business error
message here I should probably have just
a key so I can value e dot greater
thousand okay
this is the kind of string that I should
be performing because then I can get
this key and then perform a lookup for
internationalization purposes that's
some other things that we can do to
perform here a proper a value objective
must implement equals and hashcode so
we're going to implement equals and
hashcode too and easiest way for us to
be implementing equal equals and
hashcode here if object instance soft or
the number or the number other receives
the object like perform a cast turns
objects equals and Jade Java 8 brought
us these nice methods for us object dot
equals this dot value order dot values
so Chu object for equal if the hazard
since the internal value or if they
return false also here if I want to
perform a hash objects hash code these
dot value so this is one of the things
that I can do I think that a value
object also should always implement to
string and to string for a value object
I think we should return like a string
representation on internal internal
value so maybe I can show in turn
integer to string value I can perform to
maybe my order number I want to show
that in a very nice way
internationalized way to my user so
instead of in you might think well you
could have use it to string to show that
but to string I think that main purpose
of the string is to help you when you
have like some debugging problems and
you want to show the information that is
containing the order so that's why
usually I prefer to for the value which
would be just to string but if you want
to show proper internationalizing
information for your users there's an
JDK interface called formattable
which fits this purpose so if I want to
show proper information I can use the
format two methods and maybe here I'm
just going to show a string but if I
wanted to show something
internationalized there's something like
that especially for numbers format I can
say that's the digits and I'm going to
say value and I could use if you ever
use it string dot format or formatter
with like like C printf syntax you can
use the flags the width and the
precision here numbers in your in your
source code code - it's very useful but
the simplest way is to use it for matter
so I could use performer comparable to
if I want to show it if some order
number is greater than the other so
these are some basic interfaces that we
can apply in our value but just to make
it more useful so if I go back here to
order order now I have an immutable
thing how can I proper protect my order
class to entities they can't be
immutable because their value changes
over time but we can try to minimize the
mutability - okay so if I want to
protect the internal state I don't want
anybody to be just instantiating orders
and just populating everything for JP a
requirements I require default
constructor so even though it's going to
be empty I can do that if I want to
create another constructor I can do - so
maybe I have the requirement that my
order number I can't allow any not know
list okay I'll check later not know and
maybe I don't want to create like no
orders with no numbers so I can protect
and just great well all of the instances
are going to be instantiated with the
proper order number and I can say that I
can create an effective method public
static order off and I can require an
order number
can say that order number is not know I
don't even know I don't need to check
its greater than thousand or the kind of
requirements because I already did that
when I created up my value object I can
say I can instantiate a new order or
maybe I could even create provide
another constructor saying that well
this one can be private private order
order number number say this number
which use the number since it's already
protected by my factory methods I can
say that I can even return new order and
I can pass the number here okay so if I
need to perform any kind of validation I
can perform this kind of relation normal
my factory methods so I never allow an
object to be instantiated in my system
with an inconsistent state and you might
be thinking well if order for example is
not supposed to be automated if it's
supposed to be provided by a user the
information of the order should be
provided by the user and then later I
should I should save that then you can
use another design pattern to be solving
this problem for information that must
be provided for the users you can use
for example a builder then you can allow
your user to populate all of the fields
or your beuter and when you couldyou you
invoke the viewed method of your builder
you can perform all the validations so
you can always create a northern number
another instance we have consistent in
state about that so it's all about
minimizing mutability and improving the
internal state because we're defending
ourselves for external and desired
changes so now maybe since order number
is immutable
I can provide get number I know it's not
going to change I don't want to provide
set number for now and what else maybe I
can provide a get items which is not a
good thing for now because first or item
is mutable and the least that I'm
returning is mutable two so I believe
that we should never expose our internal
collections this way we should always
provide any new double copies so nobody
can change the internal lists outside
the boundaries of my order class so one
of the voice for it switch be Church in
that
immutable is copyof which is a
our class items and if I do that I have
a mutable East nobody can change the
least outside this boundary and if you
see that well if I'm providing an
immutable East I need to provide methods
to be able to change the internal state
of my class so here get items get number
what else
get ID maybe I need to expose this
information to my end user interface get
ID two and or their items I want to
provide a product amount and a price
product certainly wouldn't be a string
maybe a product would be reference to my
product itself so it would be a product
class but if you're talking about domain
driven design terminology maybe product
is in a different boundary maybe product
is in a different bounded context
because we have different options for
for the product maybe product should be
handled by the inventory system the
inventory module and one of the things
that we have in domain of design is that
if you have like aggregates from other
bounded contexts we should never
reference them by by the class itself we
should only reference their by their ID
so if I had to create have a product
here I would just reference the for
product ID and if I'm if I needed to
retrieve the information I have an order
I want to show to the end-user that the
product name - or the product serial
number to tell my user interface I would
need to create a QE for that and when
I'm good create a query I would be
creating a sakura-san model for that -
which will be creating later ok I won't
have time to create like inventory
system with a product - so for now I'll
just allow it to have a simple string
because my external ID could be a string
to an exam you double amount - they do
allow any kind of big decimal to be my
amount the adora allows negative values
0 values - how do i format them do I
accept any kind of currency that's my
system requirement that requires me to
have different currencies mayim in my
amount so these are some of the
questions that we can only answer
properly
to create a custom type for amount and
if create a custom time for for price -
yeah I'll say I mounted
currency you should be applying for
price so this kind of thing you should
be creating a value object for that -
you should be creating a value object
for amount you should be creating a
value of your price - because for
example if today we don't we don't need
the currency information or a system but
later if we need the current information
from your system we don't need to keep
adding at the second field in all of the
out of the classes we just need to
change the price class and at this
curious information on that and all of
our system would have changes already in
just one single point of change okay so
but again because we don't have enough
time to be creating all of this value of
this I'll just stick with this basic
stuff here products amount and price and
you can implement order item both as an
entity or as an a value object one of
the questions that we must have one
we're talking about order item if I have
an order item in my system with a
certain product amount and price if I
create another object with the same
product amount and price do they mean
the same thing or are they different
I believe that for most of the systems
if I have like two different objects
with the same values for order item they
represent the same thing which means
that they don't have an identity because
if it was an entity I would need to
provide an ID right I wouldn't need to
have an ID but since I've believed that
doesn't matter if I replace one object
for other object with the same value I'm
going to create these as a pure value
object and luckily we just we can create
this thing as embeddable right we don't
need to provide energy because JPA
provides us for us to be storing value R
which is directly not to my database one
of the reasons for you to be doing that
is because you decided it's truly a
value object and you know that you won't
have many order eyes item instances in
your
order so if you're gonna have like a few
of them free five six because one of the
things that happens when you have like
in battable class as a valuable object
every time you Curie the order all of
the other items will be fetch it along
the order to and if you always want to
manipulate this information whenever you
carry your order for JPA then it's a
good thing but if your order has a lot
of items like you have a hundred you
have fifty ones then probably is not
something that you might want desire
then maybe you should be better server
for an entity we love the complexes that
now you need to perform there now they
are lazy now you need to check different
things now if you want to replace one
you need to delete delete the ITT
identity and and add another one so it's
much more complicated so if your
business case is very simple and very
few items it can be unbearable if that's
big maybe you need the burden of an
identity okay and here yes Java money
API even if you've had we could have
used like Java man the new money API for
lack price but even if we had like money
API they have very nice things for
accuracy conversion they have the
providers for for the curious exchange
and everything else even if you had that
I wouldn't use money as the price here I
would create a custom type and
internally I will use in money with that
ok so because I believe that it must be
a class internally because I can say
that for my system if I create or say
price and internally I use the money API
the money class from the money API here
I could say that well the default
curious for my system is zero right and
then maybe I can say that for some kinds
of I don't know some some sort of curacy
I have a fixed exchange rate or
something like that so this kind of
custom business logic they provide when
I have a custom type that I don't have
even with the money API right because
it's supposed to be a generic thing and
we're trying to have some very specific
things for us to
dr. Tom a model okay so would use price
but again I'm going to stick with
playing like default types here because
we don't have time to implement all of
them because it consumes a bit but all
of the source code is going to be
available on github I'm also writing a
book about the subject and this is the
basic concepts that I'm trying to
explain here and I hope they're
everything we would not explain it in a
book organize it here because I want to
show these things on interface maybe I
need to provide the getters and I'm safe
for now because both string and
bigdecimal they are immutable but I can
also check well I don't want to create
any kind of order item I can't allow new
values also I can't allow any kind of
amount I can't allow any kind of price
so for JP a because of JP a I need to
provide a default constructor but if I
want proper immutability maybe the best
way for me to achieve that is to always
create consistent objects so I want to
create a constructor with all the fields
and I want to refactor that with a
factor methods and here I can check
everything I'm just going to check not
know for product I'm going to check not
know 104 amount I'm going to check not
know for price and all of this this
constraints that I'm creating here I'll
be able to use on my J JSF interface
later too so here I just create an
ordered item get here back to order how
do I store a list of value object if
they're all embeddable so maybe if it
was an entity I will have to map as I
want to many but if I want to map that
as a value object I can use at the
annotation for element collection an
element collection now JP automatically
treated as an object every time you
change the list for example if you add
an item or remove an item JP a well at
least one hibernate I believe it's going
to delete all the items and insert them
overall again so the just like I said
it's only practical if you have very few
items
in your model if have too much maybe you
need to think it's that's a valuable
object or if that should be model as an
entity for performance reasons but for
very simple use cases I like to show
that as an element collections because
not many people are aware that you can
do that
in your domain model okay so we have
order items or their item is immutable
because I never allow an or in an
inquest order item to be change it after
I created one I expose it through
getters to be a proper thing I should
implement in equals and hashcode to hash
code to I'll just leave it without a
nice implementation for now because we
want the requiring but to string also
what is the mean here it represents a
value object but it's a composable very
object may be for me for for the bugging
purposes it's very important for me to
know the internal state of the object
because I want the exposing outside it's
just for me as a developer and know
or at least I suppose I know what I'm
doing so one of the nice classes this
one needs to be from guava I can create
a two-string helper which is deprecated
by the way and I didn't realize that
more object perfect products products
thank you
it can be amount can be price to string
so this is a nice way for you to create
your to string when you need the bugs in
the bunny information and we should be
providing the same thing here for
example for order so if I have here my
vector method maybe we should prevent
the string and again as an entity I
should be providing a proper equals on
the hash code for that I won't be doing
here for because at the time here can
use more objects the string helper
and I can add maybe I can eat the add
the ID I can add the number number to
string I don't think if you have a huge
list I don't think it's desirable for
you to know to print all the list
because at the bug information will be
like huge but maybe if you want to to
know that the item size for example you
could add this kind of formation if
that's important for you to the bug if
everything is working properly your
system you can be you can be assured
that items will never be no so you won't
have a nullpointerexception
we're trying to do that okay but one of
the questions that arise is that where
are we trying to create proper value
objects proper entities and everything
else how do i map these things to my
database because JPA knows how store
long knows how to store a string but it
doesn't know how to store an order
number for example and to answer that
here in my dummy model I'll have to
create infrastructure you have to move
here order beside infrastructure maybe I
can create another package here to
persistence go it's specific to JPA and
i could create something that since JPA
2.0 we can we can provide which is an
order number attribute converter so if i
will provide this class I just say
implements attribute converter from
order number and I want to store the
number in my database as an integer so
and I want this to be Auto apply it
converter or apply true so every time JP
I found an order number in any of my
classes it's going to apply this
attribute converter to be writing to the
database to begin creating my instance
from the database - so the two methods
are important for me to implement
our convert to database so basically if
I have an attribute I just say
attributes dot and now I say value but
value is encapsulated I know it's an
integer but it's not expose it so how do
I solve this problem I need an internal
value of my order number but I don't
want to suppose that if I just create a
get value getter
I think it's poses too much information
because it's just when you read like get
value you just assuming that you have
internal property called value - that's
why I like to say that instead of get
value say like just rename the methods
to value because I'm converting my order
number representation to an integer
representations so later maybe I could
provide that to longer to big decimal to
something limitation so I'm going to
create the two integer and then I'm
expose the internal value if I get here
to integer and if I want to do the
opposite return or their number dot off
and I can get a DB data so that's the
simplest possible way and I believe that
until JPA 2.1 this kind of attribute
converted it wasn't called for new
values but now for for JP 2.1 and on
it's called for a new values too so if
you want if you don't want to handle
nose in your entities you can provide
like very nice no objects in your arm in
your system by applying the new object
pattern that directly here ended in the
attribute converter so if you want to
check well maybe from the database I'm
retrieving like a no value but I don't
want to expose new to my application
maybe I you can return or the number dot
off and we had a requirement must be
bigger than a thousand so maybe you
could say that default value for that or
you can create a specific no object for
you which will create the behavior and
you will never have a null pointer
exception we're trying to show something
in your system so it's up to you here in
the attribute converter you
can use no object or you can use some
some other strategy or if it's okay for
you to be using no I usually don't
recommend that it's okay for you to be
doing that too okay but I think it's
only after JP two point one that is
properly calling or converters for no
values to if I have this kind of
formation it's going to be properly
persisted on my database and on the
other side if I want to have this kind
of information this information to be
shown on my interface JSF doesn't know
how to show this information for my user
I need other kind of converter too
luckily for us for JSF we have like just
kind of just to have an attribute
converter we have a phase converter for
that too so if I create here another
package view no great package now I want
to create here a Java class I can say
order number phases converter or it
could be just a converter limits
converter I can implement the classes
oops
a converter I can implement the methods
and I can use an annotation phases
converter for class its order number dot
class which will pick it automatically
by my JSF implementation and what do I
need to do here here I need to check if
it's no the original object order number
of and
even information as a string and I need
an integer value to be put in that so
I'll need to convert that in some sort
of way
so I integer dot parse int value and you
know that this method comes fro an
exception if you don't have like a
proper thing so the proper way for you
to capture this kind of information you
can encapsulate that with a try-catch
number format exception yes
format exception acts and here are your
new faces exception success message just
for a message here invalid order number
okay for now and get a string I can just
if value cost no because it's yes I can
just cast it order number or the number
is justified or that number to string if
that's the way that I want to show an
information to the user if I want to
form that in a different way maybe I can
use the string dot format like they say
that I want to format that as a string
and I want to pass the order number
object for that because whenever I use
format is going to use a formatter and
if I'm using a formatter the method that
is going to get called is this one
format to where I can apply all the
internationalization and other custom
formatting logic that I want okay so I
won't want to issue some flags I want to
represent that in the formatted way or I
want just the numbers you can use the
formatter interface flags to signalize
that for methods you can say which is
the width and precision which definitely
you should be implementing but I won't
be doing for now
because it really depends on the
business logic and it takes some times
to be doing that properly okay if you
just did that then maybe you have a
proper phases converter it's going to be
okay for me to be creating this here in
my interface okay so I have order lost
here order I know how to store there a
hot store or the item and everything
else next question is well if my items
are immutable how do I add some
information here into my how do I add
some information here into my my list of
items so maybe you can you need to add a
method called a neder order an item
that's one of the ways that you can add
that you can always return these just to
just create a fluent API and then you
can you can compose your method
invocations you can check here not no
items so you can never receive a no item
if anybody tries to add a no value here
you're gonna have an exception raiser
just when you try that's one of the ways
that you can protect your code because
much easier for users to spot an error
when you try to modify the value rather
than when you try to consume that you
can always check not know here and maybe
you can these you eat items dot add item
you could always check here well I don't
want to allow repeated items to be added
to my to my list so if I detect that the
same products going to be added on my
list again I want to block that I want
this information to do nothing so maybe
I could say that if items dot contain
item or if not items contain item I can
do that but for me for this thing to
properly work I need to implement
properly the the equals and hashcode
here because they're just
comparing like object equality I did say
quality in Java sense so it's not very
useful for now but if I wanted to do
something different if I don't want to
read repeated items I would add this
kind of check here in my source code and
if I wanted to do even something
different maybe if I detect that two
items if they have the same product then
I consider it to be equal and what do I
want to do is that if they have the same
price I just want to add both of the
amounts and create a new item replacing
the other one so if this contains then
maybe I can create I can the items
contain item I can remove I could remove
the previous one and add sorry I have a
having a hard time breathing I'm just
recovering for from a code and I could
remove the previous item then I could
add the tool the two amounts create
another verbs in the back that lists all
of these they can be added here if I
have an add add item and this kind of
information will not be scattered around
my source code base because it's
traditional way of trying to add this
kind of business logic is that you're
going to create a service and every time
you try to add an item you have you
going to to get the least and remove the
item add it back and everything else so
maybe if you want this kind of logic to
be implemented in another place in your
system you're going to copy/paste your
source code in the other spot too you
don't want to do that so here you were
just centralizing where you can change
the state of your order so everything
will be done here in their order ID and
elements okay so this is some of the
things that we can do other things that
I want to show you right now is that for
some things we can apply the state
pattern inside our or our entities to
and for me this my one of my favorite
features of the language language is the
enum so I want to create a key I want to
create here and order status
and this is status I want to create that
or maybe are the status or or the type
because I want different order types to
be processed maybe the user stylist is
paying a premium and it wants to be
delivered faster it wants to be
processed faster I can do that too but I
just want to show that I can the same
logic that I created for a custom tab I
can use for random - in um Sara Sara
Sara Liza before by default I can say
that have it might have a premium and I
can have like a default one and some
people don't realize that and arms are
full-featured classes so I can implement
any kind of things inside you know I can
implement an interface for example I can
implement a function that processed some
order items to order or the item I can't
do that to okay I could provide a big
cook could be providing like some sort
of discount so there are many different
things that I could be doing with with
venom but for now I'm just going to say
that until JP a to particularly
hibernate we have this problem I didn't
check other providers like eclipsing
called top link we have a we had a
problem trying to persist in amico stone
types so the traditional way or for you
to be doing that would be using a
numerator this and if you're using
enumerated it you eat it needs to be a
known type or you know which is a
position base it or you could do that as
a string which is going to store
everything like premium or default in
your database but maybe you don't want
to store that just as a premier or
default you want to store that just at a
single character in your database so
maybe you can add some future tirana
like I have a final string value and you
can add a constructor to your enum and
you can say that here premium is with a
P and default is with a D
and you can say well to string maybe
here is question oh if I want to to
provide that to database representation
okay and I want that return a public
string return value okay that's one of
things I can do and if you have an order
type when you create an order type an
order type attribute converter attribute
converter from order type and you can
store that a string or as a char - it
would work you just need to be sure
convert or apply true that works on JP a
2.1
I don't know if what's a bug in
hibernate but is working properly here
in the latest version on hibernate - and
you can say that attribute to database
representation and now we need another
method because if I want that to work or
their type off and I need to create a
method maybe DB data how do i implement
that properly the UNAM i need to occur
usually i need to create a map which is
a internal right start i don't find a
map saying that I have if I get a P it
has to be string I want an order type
map I can use a value map and before
that I use before having like Java 8 I
needed a static initializer just for me
to pop yet populate this value map but
if I have Java 8 I could just say that I
want to create new order type string off
values I don't want to map collect
collectors here I have the type of
annuity okay so if I want to create now
I have a map which Maps the internal
representation to my proper auto type
which is kind of neat feature the
problem is that this map is not
immutable but since it's private
nobody's using from outside I can
guarantee that nobody will be changing
that and I can create just a factory
method here which can be public order
type of string value or maybe since I
know it's going to be DB data return
value map that get DB data and if you
for any instance you just pass like a C
value for my order type it's not it's
going to return a null maybe if consumer
turn on all you could return a default
value get or default maybe you can say
well the default value or their type dot
default that's another way for you to
provide a default value so you can hand
I never have no value in your class so
if I get back here to my attribute
converter or the type of string that's
nation static it needs to be a factor
method okay now it's working properly
anything that's a proper way for you to
be handling and offs but after realize
what can we ask do with enemies we can
they're polymorphic so we can apply
different operations for here I could
say that well effect check here that the
the total price if I want to add a
methods in my system that just
calculates here well I want to know how
much which is
price of my order maybe the best place
for me to calculate that is inside the
other class because already contains all
the data instead of creating a service
method which will calculate outside of
my data so if I want to create here
public get total price if I want to be
doing that I already have access to the
items and since I also have like my
order type here I know that if it's a
premium thing I have to move I know that
if it's a premium thing I can apply its
count for example 10 percent Scouts it's
another way for me to be calculating
that so what can I do with total price I
could get my items I could create a
stream I could say that I want to map
all of the items that I have and I want
to say that if I have an item I want to
get a price and I want to reduce and if
I want to reduce I want to start and one
big that small and I want to start with
a big decimal that's 0 speak this Oh
where's the bug
sorry first oh yeah okay it's very hard
to do these things like life coding in
front leg lots of people and then maybe
you can return these kind of things
because by default is just summing the
amount maybe I should be multiplying by
by the the price with the amount tubes
but if I want to apply a discount for
this total price maybe I couldn't apply
a function for this so instead of just
but in a map here I could add another
map and I could say that order I could
say that I want to get my type and I
want to use like a get discount function
and if I want to add this to my type
type which is not a violet valence or
the touch your font get discount
function I'll get you first
oh sorry order type so now I want to
implement a function which returns for
me a big decimal I could be implementing
directly I could have a map if I want to
have the different functions not only
for discount if I want another one but
if I want to play mental function here I
would say that
fly here I'm going to apply return the
own bigdecimal
here I can just return bigdecimal
multiply your big decimal
big decimal 0.9 okay I'm going to give
like a 10% discount on my orders so I
get back here to my order I can just go
or I want to map because I need a
function and it's going to be applied on
big decimals
I can just say say here order time
because already a function and it should
be working properly - okay and if I
wanted to apply different types of
function then it's not if I want to have
like a polymorphic behavior inside here
maybe it's not a good idea from our
order type to be implementing directly
the function maybe I could it just
created another map another set of
functions then I can have like I could
create a public function big that's more
bigdecimal yeah discount then I think
it's a nicer way for you to be
implementing this kind of polymorphic
behavior if you have more than one
function to apply on the same time okay
so these are some of the alternatives
that you can apply if you're using
another as I said and noms are
full-featured classes and and what can
you do enough for for now we're just
creating the value of objects that's
some of it most of the tips that I want
to show I have others but I don't want
to spend more time on that now I'm going
to read to talk about my other domain
model because I have another one which
are called customer and on this one I
had the time to create all of the value
objects for everything and I have a
proper interface working here and I want
to initiate a discussion about secure is
okay the initial way for you to be
creating this kind of interface is that
you create an entity you restored that
on the database and if you want to
retrieve information to be shown to the
user maybe that he read that you're
creating your interface is something
like this so let's create customer
repository and if you want so here I'm
using that tool called Curie de sel that
allows me to generate this fluid this
this fluid fluent DSL for me to create
my queries but what I'm doing here I'm
just creating that from JPA I'm just
creating a Curie like from customer and
retrieving everything and applying aware
predicates to to mine to my entity so
basically I'm retrieving from all of the
customer objects that I have stored
applying a future with a where clause
and I'm retiree and then asking JPA to
just well just populate the customer
instance will all the fields that he has
and maybe the customary has an address
list maybe a customer has a phone number
list maybe that customer has a credit
history list maybe the customer has a
lot of different appendices and just for
me to be able to show this information
on screen and I'm just showing name and
surname I'm going to populate my
entities in memory with all of this
information from the database it doesn't
seem to be a very nice approach for for
me to retrieve information from the
database and if you've seen there's a
there's a talk on YouTube from Greg
young which is the the person that first
reference the the term secure s command
kirie responsibility segregation and
basically when this talk we weren't
discussing domain driven design and
secure s means that we'll secure as you
can have or you have different models
for reading and writing your information
basically if you're performing writing
operations to your domain model you are
going to use your customer class your
customer aggregates and your customers
entities and value objects inside of
that for everything but if you want to
hear it in from
and maybe you want to show the customer
information hearing from different
tables different different aggregates
different entities from your database
you won't be just populating your
aggregates in memory and picking you
through gather the information that you
want maybe you want to create a secure s
representation and that's why I'm going
to show today and now I'm pretty sure
that most of you did this in the past so
if I have a customer here this thing
that I want to show here just show me
the name and the surname and if I have
the the the representation I don't want
to expose all of the custom information
I'm going to create a DTO so for these
two your customer DTO which is sir less
reliable - and here I'm going to say
that it has an ID which can be final
it's gonna have a final name it's going
to have a final surname it's going to
have a constructor and just because it's
JSF and I need to gathers I'm going to
generate the getters but it's mutable so
it should be safe for me to be creating
and if I go get here to my custom
repository I'm going to say that when I
he read that information from the
database I'm not returning the customer
by itself because you might have a lot
of information that I don't need for now
I'm just going to create a customer DTO
and select and instead of V returning
the the customer by itself I go me to
beer selection projections constructor I
want to create a customer DTO
dot class and they deformation that i
want to to curie ID name surname okay as
I said all of the source code is going
to be available for you to check later
but I feel the curious cell it's a very
nice way for you to be queuing your
entities you know we're using a fluent
language
it uses a maven plugin but if it has a
greater plug-in to to be generating your
Q classes just like you'll be using you
like the criteria from JP but this is
much nicer I think this is the way this
should be provided if you want to create
JP a qyz so if you want to use a rich
domain model you want to keep using like
your name value objects your surname
value object or earlier or the number of
value objects then it's nice to be using
cure data cured SL but if you have like
very strict performance requirements if
you have want like low-level control of
your sequel statement if you want to
reach or reach or access to your your C
code database then maybe you should be
using either ladies native ask SQL or
you can use a tool like joke which was
created by Lucas editor I don't know if
it's going he's going to be available
that walks this year but it's a very
nice to that just disrespect to your
database and generates like a DSL for
you to be creating your psycho Curie's
just like I'm creating a JPA query here
then you have like the full power of
your database in your hands it really
depends if you vary performance oriented
you have very hard Curie's you want to
create your secure SR read models with
that or if you want to stick to JPA you
can just keep doing that okay so when
people talk what is a security
architecture just remember we've been
doing these for a lots of different
years many years we just didn't know
that it had this name so secure s stands
for we have a model and this model for
now means that we have different sets of
classes for reading and writing
operations writing operations I perform
it directly by the domain model you
modify the customer class and you ask
your repository to persist or to merge
through density manager your customer
entity to your database but if you want
to curate this information from the
database you're going to create a custom
query you're not going to retrieve all
the information from the customer and
you're going to show this custom
customer video maybe you wanted to join
the custom information with with other
data source
and show here too you're going to create
a custom DG OS specifically for this QE
you're going to retreat that and you
want to run so without changing anything
I can show you the same interface
because by coincidence oops
okay controller a customer controller if
I have here since my constants
I just so it's right I have both videos
oh yes oh sorry I already had a custom
editor I'm creating another one name
surname which happens to be to have this
almost the same values I'm just going to
delete one come on yeah okay now it's
working properly and the customer DTO
now i can run it and this is they happen
to have the same like values name and
surname my interface is gonna keep
working at the same without any further
changes just want to run to make sure
it's working
it always takes longer when you're
showing something on screen so here yes
it's working I can filter that if I have
time I'll show you like a proper nice
way to be creating the spheres excuse
well here okay this is working properly
and this is the very first step for me
to be able to be creating my security
architectures we have events or scene
and domain driven design so just have in
mind for us for now security
architecture means I have different
classes different models for reading and
writing information the next
architecture that we're going to create
is that we can have like secured s
architectures with separate data stores
because you don't need to read and write
through your information from the same
set of tables from the same data base
you can read from different sets of
tables from your same database you can
read from different sets of tables from
the other database and they can be
synchronized through different ways in
after you create your secure s datastore
your security architecture with separate
data stores then event sourcing can
become a reality because after you have
a distributed secure s datastore then
it's a Mary said this it's a it's up to
you to decide if you want to store your
change events in an event store or if
you want to keep using your same old
legacy representation that you have but
I want to show you that after a quick
break because we've been talking a lot
already and I think we all need some
rest
so see you back in 20 minutes okay
you
in the Rebecca one of the good
discussions that I had here in the break
some people were saying that somebody
asked its if you're not supposed to get
a service and get all of the business
logic inside the service if I'm trying
to push some part of the business logic
inside of the entities and aggregates
and the value of just anything else how
do I decide in which objects do I put
the business logic and all of the good
things one of the good questions that I
always like to ask the teams is that who
owns the information you know which one
to manipulate it so basically if I have
a service you just queue in objects and
then you just start to get this object
that gets information get this
information get this information like
process it and then set the information
somewhere else
maybe you're performing this kind of
logic in the wrong place so I think it's
much easier for you to perform the logic
the business logic that you need to
perform inside the object that contains
the information so so that's one of the
reasons okay that's a very simple model
why the total price was here instead of
being a service and calculating that
outside because the order is the one
that no the items I'm not supposed to be
queuing the items directly because it
would like leaking information from
inside the order maybe I don't want to
expose an internal representation maybe
in fact when I do when I insulate my
code from this external exposure maybe
it can be that even the order item class
that I'm exposing here and together is a
different class than the one that I use
internally to represent that I don't
even need to store that as a list I
could be storing the things as a map or
could the opposite one I could be
storing my my items as a list internally
and JPA just because it performs better
but it could just be returning the they
are here and their items as a map like
method by something like for
the ID for example or any other for the
the for the product or something like
that so it's very important for us to
separate this internal representation
from the stern representation all right
so you should always be performing these
kind of things in the object that
contains the information and in this
case or their content contains
information another question was that
well maybe if I wanted to perform some
very complex calculations and I need to
key we created eto needed to create a
secure s model which was Johnny
information from the customer from the
order from the items or maybe something
else from the product because this
particular customer depending on the
kind of coupons that he has on his
accounts he might be eligible for
different kinds of discounts on
different kind of products in this kind
of formation clearly it's not containing
it's only inside of order and noren
customer and noren product so maybe the
one of the approaches that could be done
on this in this situation is that you
create a secure s model you create like
a discount video discount Q it is here
something about that you carry all of
this information from your database
which is in scatter for different
entities and different aggregates you
just get this information and inside the
math of this tile inside your your
secure s model you just perform all of
this so this is one of the things that
we can be be coding when we create
secure s models okay
all right ahead and I'm sorry if I'm
speaking too fast I just have like many
different ideas and concepts that I
would like to explain but it's always a
challenge to do that's why coding and
talking to you
so because it's very important for us to
focus on the the distribution part and
now I want to exchange a bit instead of
just coding the things I want to show
you how can we use this knowledge
sorry how can we use this architecture
encoder to create a name right now for
distribution and I want to emphasize one
more time traditionally secure s model
security architectures have been used in
in the in the Java world for performance
resource reasons so when a Tiberium we
needed to perform a QE that aggregated
from multiple different places and we
want to perform a computation or show
that to your user
we created this DT OS which is our
secure s models to have a better
performance but when Gregg Ian created a
term secure s architecture initially it
was intended to be used as a step
towards an event sourcing architecture
but since when we created this term like
10 years ago it was very hard for people
to grasp the concept of well now the
state of my data is not anymore a row
with some columns in my database now the
state of my data is a stream of things
that are happening which we call events
so we have a lot of different events
working and being applying all the data
and I and and I don't have anything else
anywhere else to keep in mind my
information it was very hard to grasp it
is ergo I think it's too hard to grasp
that's why they he created the term
secure s so secure s we were able to
apply successfully secure as models for
performance reasons now we're going to
apply sequest mothers for distribution
purposes because if we're talking about
distributed systems such as Microsoft
architectures it's important for us
because we need the data that now it's
supposed to be splitted in different
endpoints we need to these different
pieces of data to stablish correlate
some correlation to perform some some
business logic but if it's distributed
again it's usually it's not feasible for
as well just create a rest endpoint
whenever we need the customer
information or their old information or
the product information we're gonna
execute like an HTTP query and key
queuing information from the roadman
point and perform our calculation
we are I know I think that most of you
realized that you if you deploy this
kind of our tattoo into production
usually it doesn't perform well usually
it means downtime because you have some
very serious it scalability issues
that's why the tradition is that from
most of the companies that are visiting
and working when trying to distribute
system is that well we created a proper
at least we found that we created a
proper amount of context we create an
America service now we need to integrate
the data to perform something let's
create a rest and point here and in
create we have a rest client just
queuing information perform the
competition that we need and keep going
you deployed this thing it's very low
it's low it does a scale then you
realize that well if it's a performance
problem we need cash did you have more
problems then you realize that well an
internal cache usually create a map for
example to be caching or we cache member
something on that then you realize that
your Maps not big enough
you create a cache service usually you
you deploy something like readies or a
memcache just to store your objects as a
in a key value store then you now maybe
my cache is is big enough then I have
other kinds of problems because me my
old legacy monolithic enterprise
information system I need C code because
I'm performing like very complex queries
I have like different secure s models
that I need that I that I created in the
past for performance reasons and now for
some strange reason they don't work that
well anymore because I have to join
information that is on the database with
the information that is in a key value
store isn't there a better alternative
to be creating this and I would say that
maybe for some systems storing this kind
of cache information from from a micro
service as in this is Sarah liza object
is is an appropriate solution but i
still believe that for many enterprise
system or from
enterprise systems and I'd like to
remember all of us that like 90% of the
developers in the world they are still
developing enterprise information
systems we still need the capabilities
of the sequel database and how do we
solve this problem so what I want to
show here is that just as I created this
customer digital representation here in
my chest in my read model I can use this
information to be creating an
distracting another kind of model in a
separate datastore so sorry if I have
here a customer class and I decided that
the customer bounded context is simple
enough and you might guess well the
business real word my my domain models
are never that simple but I just want
you to take to have a notion of what
what can be done here and if I want to I
decided I want to add the customer
bounded context is an idea kind of data
to be move it to a macro source so we're
going to expose that and the customer
micro service of course it's going to
retain the customer information all of
these sort of information is going to be
stored that and I have to remove the
custom information from my monoliths
which in this case will only have the
order bounded context but it could have
the product on the context too because
in the model if everything is you
scattered around mine my codebase if I
want to is acute that then I move it
there I need information here so we are
going to create two different models the
canonical model and for me the canonical
model is the canonical source
information meaning that the true source
of information is going to be stored in
the micro service the customer micro
service so if I want to know which is
the value that customer has in this
exact moment is the customer but since I
need information to be performing some
Kyrie's inside my enterprise system in
my monoliths I need the secure s read
they store in my own mana list and how
do I create that so and it's it's at
least I hope there will become
clear why it is an appropriate
architecture for you to be creating your
your even sourcing architecture later
so if I have customer I'll just exit the
presentation mode for now I just created
another project here which is a micro
service one which is empathy for now the
only thing that I have added for now is
some dependencies there are going to be
used in common and I chose to on purpose
to be again a wildfly swarm project
because my monolith is using Java EE and
I want to uses a similar code and maybe
reuse the code that I had my monolith
and if I created a bounded context
properly if I properly packaged all the
classes in FF I created the proper
secure as read models so that the
business logic it from the customer
bounded context is not scared in other
classes too I should be able to just
like copy and paste all of the custom
information and the rest of my system
should still keep working so what I'm
going to do is that I'm going to copy
the classes from my monolith here from
my customer bound the context just type
in control C if I go here to my micro
service inside control we want to copy
the files I just copied everything since
they're in different folder I can copy
the the customer HTML file the JSF files
upon here the customer and maybe that
should be enough for me to have lack
something working in my microservice
from the code point of view and I want I
need to copy the data to
so what I'm going to do here I have a
script ready to go I'm going to
basically want to show I'm here to
basically I'm going to dump I'm going to
perform a migration I'm going to dump
all of my customer information into a
sequel script from my monolith so if I
open here I'm going to dump that into a
sequel statement okay it's unsafe
because all you don't know my password
and a kingsport import that into my
micro-service database I'm just going to
deformation and pipe that to my my
sequel client importing that into my
Microsoft database which is another
instance of a micro Mexico database
running supposedly it should be another
host but I have to defend my sequel
service running inside two different
docker containers so now it's populated
and if I want to check information here
if I check my mana my Microsoft database
I have this information here from
customer and if I open here my my Sukho
consult showing my my monolith the
monolith has this schema version table 2
which was created by a flyweight because
I I populate the database with a
migration if I check here for now they
have the exactly same information right
so I'm trying to create two separate
Seacrest data stores and see some
deploying a new macro service I needed
to perform his migration he could have
taken some time but since that my data
is very small it was very like
and took like less than a second so for
now I have to separate the race tourists
which have the exactly same information
but I want my micro service to be the
canonical source information so I don't
want my monolith to perform any kind of
operation any more on the customer table
because it's not the canonical source
information if I could I could get here
the monolith I could just delete the jsf
things I could delete the services the
business logic and everything else but
since the micro serves and I want to
check if the micro service is going to
work so I have here my micro service I
want to run it and check if it's going
to perform the operations this is my
bounded contest you can see you didn't
have any other dependencies on other
classes which because it's a clean model
but in a traditional enterprise system
it was very would be very typical in
about that context for you to be
referencing the entities from other
bounded context and for you to be able
to perform this migration the easy
answer is that for any kind of reference
that you might hold for entities in
different bounded context or MIT to you
and technically you should only be
referencing aggregates the route
aggregates from about the context but I
know that in legacy systems not the way
it works you should be performing
something like this if I get into the
monolith and one of the things that we
should mean pork refer to notes an order
probably would have a customer so if I
have here a customer and I need to
import from another bounded context
traditionally people would use a many to
one which is not a nice thing too
because when you call it and when you
put a minute one here it's going to be
fetched like eagerly from the database
so it's going to join from the customer
information if the customer has a like a
lot of fields
we're gonna have like even bigger
performance problems so usually it's not
a good idea to for you to be creating
this manage one relationship if you need
information from different bounded
context right
you can use many to one relationships if
you have only one aggregate and you just
performing data manipulation inside your
your aggregate and the internal entities
it's ok for you to be doing that for
things outside your bounded context not
that good so instead of just creating a
creating a relationship what would you
do the ideal way would you you would be
to you to create another value object
which is a customer ID and to go to
customer and change that to customer ID
too right
but for this particular example JPA
still doesn't allow me to use a tribute
converters in the primary key so I would
have to dig in tune in to JPA and to to
the GP provider in specific
implementations I will have to go dig
into the hibernate user types just for
me to be able to use this customary for
the example and that they didn't want to
add this kind of complexity now I just
want to let you know that it's possible
but then you have to go if you're using
a clips link you have to do the Eclipse
anyway if you're using hibernate you
have to do use the hibernate way using
user types so because I want to keep it
simpler I'm going to say that the idea
way would be using customer ID hate to
and customer ID there for you to be
later when you create a QE on your
secure s model you'll be able to join
that properly but since we're since
going to take a lot of work for now
we're going to leave that with a long
value and say that it's not a customer
it's a customer ID so basically we're
referencing that this customer is from a
different bounded context I'm not
creating a management relationship every
time you create a many to one
relationship you should be thinking is
that at same aggregates is that the same
bound of context the answer is no maybe
then maybe you
shouldn't be using a managed one you
just be you should be using just a plain
type and again if you want to dig more
you could be creating a customer ID type
we've we've done hibernate user time
that's my that's the idea point of view
but we're not doing that today so if you
want to referenced I just would just
create a customer ID then I would be
able to move the whole customer
information from here to the other macro
service because I wouldn't need the
customer quest in my my order code
anymore ok that's one of your thinking
right so my mom across service has
started so if I access here my endpoint
I know it's very small if you access my
monolith was in 8080 if I want to access
my micro server it's going to be running
80 81 I have the exact same information
now it's performing if I want to update
my name here it's at someone it didn't
work
just make sure the package is wrong well
it compiles which means nothing of
course it work it's before I started
this presentation if you want to trust
me method not found each other
oh and passing the DTO so here I just
change it before I want to change it
back customer it so here I'm going to
change to customer video select from
your customer coaster
okay customary most story and customer
controller okay in my microservice
because here I'm not going to need my
secure ass representation at least for
now
and even if I wanted to work in my
secret representation it would be a
quick fix I just want the one to do it
now while I'm coding so I want here it's
not at sewing one just cienaga now my
names are correct if I go back to here
to my database my name doesn't have the
one but in my odds system my monolith
ECU has the one information so once I
just split the database and I copy the
information from one to the other the
canonical source information is my now
is my micro-service but I need the
custom information from my monolith
preferably inside my database because I
want to perform complex joints to create
my secure s models and in fact that's
approach they recommend for most people
but you must have a way to synchronize
information from your canonical source
which now is now a distributed into your
mana list in the best way again for
enterprise systems is to create a secure
s datastore some people call that a
cached copy a copy table inside my mana
it you can call that the way that you
want I'm even keeping the same table
name here customer because I don't want
to change anything else inside my
monolith I want to have the same
theories the same details and everything
else
so what do I do I need some way to
synchronize these kind of things the
best way for me to achieve that well in
fact I said best way I think the how do
i but that I think there would way that
we want to perform this kind of
integration is from messaging because
maybe somebody might be thinking about
the event sourcing later but in my book
I describe many other integration
techniques you could be using a view you
could be using a materialized view you
could be using CDC you can use a tool
like the vision to just broadcast the
transaction log from your database into
your remote read the restore so that's
our some alternatives but since we're in
this domain your design demo we want to
go to the path of them and sourcing we
are going to generate change
messages from our application from our
macro service and we want that to be
propagated to to my remote monoliths so
what do I have here I'm going to create
a new service and sorry I won't type all
of that here because usually when I type
that make mistakes customary okay
customary infrastructure let's create
another package GMs and i'm gonna create
a customer notification service and if
everything went well I'm just copying
pasting the codes
I'm just creating here I need a JMS
broker I created a topic and every time
that I changed my information inside my
system I'm gonna broadcast a message on
a topic saying well now I have another I
have a notification from anybody
interested in customer events customer
change events because now I have in my
system a customer that is new or has
been updated and I'm going to broadcast
this information as a JSON payload
because why couldn't you be just
broadcast in the customer class I could
but then it would be tired all of the
endpoints in my system would have to be
job applications all of their endpoints
in my systems will need a shared library
containing the customer class I don't
think it's a nice approach if you won't
like to insulate changes from one
endpoint to the other so that's why we
were using a text payloads could be XML
could it could be something else
we chose JSON for this example so using
like JSON P from Java EE to the v7 to be
created information so I'm just pretty
casting the ID the name and the surname
of the customer that are created but I'm
not protic asking just a class that
allows me to send this notification and
here sorry in the customer repository
which is a central point of change in my
system for customer related information
I'm just going to say that whenever I
save any customer here I want to send a
message so I'm going to create a
customer I want to inject this kind
information and here whenever somebody
tries to save it I I merge the
information and I ask customer
notification service sorry and I want to
send this information but for that I
need that JMS broker and to be very
honest I spend like nice hours trying to
find them the easiest way for me to
configure and deploy a JMS broker in my
machine for for performing in a demo and
I was very surprised because after
trying many different docker containers
installing and configuring configuring
by hand everything I just found that
what flash form was the easiest way for
me to deploy an active meq broker inside
anywhere because all I had to do I just
went here to the wild fly swarm and
website generator I just asked it for
asked its messaging with active meq it
selectins is quite that it nazi was just
out here messaging just generated
project is going to download self
contain it fetch our application and it
just need to configure the name of the
queues that I wanted so here I have a
major maven project is a broker you can
see it's a word flies form application I
just called the JMS broker it just has
the JMS the messaging fraction here so
that's everything that I need to have a
full-featured active image meq broker
and I just needed to configure the mo
fire for for wildfire swarm which in
this case this one wants to configure
that I just said that I want to listen
on this port I want to create this topic
customer topic and everything else you
just get from the documentation just
copy pasted deformation and once I did
that I executed a clean package and if I
did that correctly I just have to run
this fat jar and it's going to have like
an active me queue broker running inside
my machine which will be used by both my
monolith and my macro service it's up
already since he only has that JMS
dependency it's very fast so now DMS is
running I'm going to stop my micro
service here because now it's able to
send notifications and I'm going to run
again and once he gets up my micro
service anytime I save any kind of
custom information is going to broadcast
that information as a JSON payload on my
JMS topic now everything I need to do is
to consume this kind information in my
mullet so it will be able to update
sorry to update my secure s read
datastore which is storing my monolith
and everything can keep working the way
it was before so now it's okay if I go
to my interface here my micro service
you can see that information is here if
I go I still go to my monolith it's not
running and now I go back to my monolith
source codes model it's okay
and I have to be very honest for you I
cheated on this because I didn't want to
type all of these annotations again so I
have it ready
but basically suggests that's just
standard Java EE 7 annotations for for a
JMS topic I just wanted to say that I'm
creating a message driven me JB and
message driven mean we choose will have
a message and listen implementation
whenever I receive a message I want to
get this JSON payloads convert that to
some sum of some account information
that I can store as a customer and then
save this customer so it's just
configuration here I have the customer
repository which is to a copy of the one
well now it's not exact copy anymore
because the other one is sending
notifications since I mean it's Jason
it's a text message just seeing message
received I creates a JSON reader then
from the reader I create a JSON object
reading by that and what do I do
I'm not dealing with the case that I'm
deleting a customer I'm just trying to I
just ask the customer what story to find
their ID because the idea I get from the
payload I said the name I said the
surname and I save it you can see that
it won't work if it's a new customer mud
I'm just want to show that I want I can
integrate some data so this kind
information is saving here so that's for
it work running my monolith
okay it still has add someone and I got
let's chant try to change that again if
I put here it's the Vox so he'd safe if
I go theer's for the log the broker
something's happening I'm receiving a
lot of messengers which was not supposed
to happen but well we changed it okay I
should have hidden the concept but well
it apparently intent into a loop which
was not happening before I guarantee to
you but now it has just a per day that
the message and you know it's a very
simple demo over simplistic demo I agree
but I just want to show that we just
created a secure s architecture from a
very simple model and JMS is one of the
possible approach that you can have to
try to update your read data model from
your monolith from your macro service
this is one of the simplest things the
one that I could show you using plain
Java EE many people will use Kafka for
that some people as I said before you
can use a view materialized view you can
use an ETA and ETA are tools you can use
CDC you can use a message broker the
proper broadcast in this very stupid
message that I created it with a JSON
payload just saying well I have a
customer now but the important thing is
that all of my queue is here in my my
monolith I still using my customer dto
QE
I should be removing the code that
allows me to change the customer from my
monolith here because I'm normally allow
it to perform in that oh my micro
service for now and you can see I just
copy it the classes and since I had a
proper bounded context you should be
performing well from my system I could
even say the links from my application
could could still keep working if I just
forward that properly to the endpoint if
I had like if I had implemented like
single sign-on
I could centralized authentication I
could take the benefit of not having to
lock back and again if I had a smart
roots around the front if I had like a
very less application or a zoo
application I just could hide different
points from inside as a same common
endpoint but you know what I want to
show is that that's QE the monolith I'm
still using the customer ID do which is
a securest representation I was able to
move the data to my Microsoft Remote
endpoint and all of my theories are
still working here because I didn't even
change the structure of the tables that
I had in my mouth but if I just realize
it that to my customer information has a
lot of different dependencies that is
too much information I don't want to be
replicating all of this information in
my model it's because my in maimana is
all of the aggregation theories that I'm
using using my read datastore they
really don't only use the customer name
the phone number and something like that
I would only replicate these fields in
these relationships from the customer
micro serviced in my monoliths so what
do I need to replicate in my secure as
with the restore just information that
is required for my secure reporting okay
that's important concepts you have I
don't need to keep broadcasting all of
this messages from all of the different
endpoints another discussion that I want
to have with you right now we just
realize that that with proper bounded
context creating a micro service
broadcasting a message story here for
reading purpose is something that can be
achieved as I said it's simple yeah it
can be difficult depending on how your
information is structured because we you
might have to to change and refactor a
lot your model is to be able to extract
that but that's a that's a procedure of
wash and race and if you repeat every
time
but after you've been able to do that
you can see again it seems simple but
it's difficult for you to achieve you
realize that I'm not restricted to just
creating secure s read the restorers in
remote endpoints it would be your first
step monolith microservice read the
restore then you start thinking if I'm
using a secure s read the restore in my
monolith and I didn't need to change all
of the Curie's that ever created before
because my tables are still there what
prevents me from doing the exactly same
thing even in my micro service right so
if we were able to change all of our
Curie's here for my code here I mean the
macro service if you all are the curious
that I have performed if I'm not
returning the entity by itself not the
domain model not the right data model if
I'm able to refactor in or restructure
all of the queue is that I have to use
DDoS which are read data models which
are secure s read their models if I'm
able to perform this kind of refactoring
then I'm not constrain it to storing my
canonical source information as a single
row we have lots of columns inside my
database and my relationships I could
even be changing my write data model
inside my macro service to an event
store right which kind of events should
I be creating just like the ones sorry
just like the ones that I just created
here using this customer notification
service I could create very low level
event sourcing events saying well I'm
saving a new customer or I'm updating a
new customer I'm deleting a new customer
and you could perform this kind of
things if you just adhere your customer
table you know
to restrict it to just having a customer
representation anymore you could even
refactor that you could say that is not
a customer anymore you could be creating
something like a customer events and
you're just really using all of the
information and instructors already have
the night that ID would be the idea of
the events you could be using another
strategy for generating your customer ID
class just for example creating like as
I've talked to some people here before -
it's it's a nice way for you to for your
customer instead of just using the plain
old ID from generator from the database
creating a business key to identify any
of your identities so you create could
be creating like I don't know a business
key or something like that then you just
create another customer saying well now
I'm creating and you could create a
customer event type which is a customer
created you store that in your database
customer updated you store that in their
database customer deleted you store that
in your database so the customer is not
just a simple column row in the column I
have the customer information these
would be an events tour because instead
of writing customer entities you will be
writing customer events and you could
even take the benefit of reusing the
current customers restructure for that
okay if you read some books about even
sourcing and security architecture some
people advocate for now that we if you
want to create an event store
some people even advocate well we could
be sterilizing this payload as plain
Java objects used in objects realization
which I don't recommend because you know
that enterprise information systems
usually you have to hold this
information for decades and you won't
don't want to store legacy Java
serialize in objects because the
structure change changes over time the
fields changes over time and the types
change over time
you don't want to be doing that a better
approach maybe would be to have a even
store type where you could write some
some JSON format some people advocate
for MongoDB because it's already JSON
you can write that some people also
would say that money maybe is not as
reliable as you would think for this
kind of thing okay
I used to think again that for
enterprise systems it was much easier
for you to keep using your relational
database to be storing your customer
change events because since we have like
advanced reporting requirements for that
and we were already using secure as read
data models in our macro service like
the customers EDT ode to perform our
Kyrie's we could just plainly in simple
you start our customer events as another
table
I just renamed the table from customer
to customer event add some fields make
them immutable because an event you
never change that anymore and you start
to propagate this kind of customer
events to your different end points in
your system I truly believe that this is
the easiest way for you to achieve an
even sourcing architecture we've
distributed secure s read the restore
which were their original purpose of
secure s read it read the restores write
as I repeat again when Gregg Ian pointed
that the secure s term it was supposed
to be as I stepped towards events or
systems this is the step that he wanted
to to perform to achieve in EE even
storming people didn't realize that at
the moment but now that we know that we
can use for that and the message brokers
are very popular these days this is for
distributed systems you just need to
change in refactor system to be storing
these events and you'll be calling
instead of a customer repository
customer event store or something like
that and saving benefits of using event
sourcing means that you have an audit
log for free but some people don't like
to call events or sinners
that log because audit log has a bad
connotation because you usually don't
have all that information if you're
using this kind of in store you always
have all the information you have a free
time machine
you know when the information was change
it if you ask security context here you
know which user change an information
here you know which was the previous
value you can perform a free time
machine you want to know which was the
customer data on this date of the year
on this time of the time of the day in
this specific moment in the past you get
all of these things for free and why
should I do that if there's their tools
like hibernating verse which could be
provided me this auditing also for free
all the hibernate in verse won't
integrate this beautifully in this this
nicely in your macro service
architecture for broadcasting your event
changes okay so that's some of the
considerations that I want to show to
you I could use some of the time as you
have some some minutes left I could go
back to my mana list and create the go
here to my monolith then go for me would
be to show you how to create an order
from DTO using the order controller but
since I want to show you another feature
another tip that I have for you when you
have to perform qyz and you want do you
want to do that using like if statements
in your code so I want to take like this
very few minutes that I have left to
show you how the customer controller is
implemented you can see the form class
is the one that holds the information
that I'm having this form that has a
name and a surname for a QE since the
things that I'm typing here they don't
have to be full
you don't have to be full names because
I can type just part of that you can be
types it can be I can ignore the case in
the Curie's nothing else I can I can
type this kind of things - how do I
perform the things and just keep my
business logic very small here on the
fact I can do that in the micro service
just as it's here micro service
presentation how do I achieve that why
is not something customer did to you
where's my
oh here pop it on the run screen sorry
mr. Merrick customer repository
custom hearing my micro service monolith
wrong project again okay as it's
fullscreen microservice okay
customer perfect that's working if I
open here again my customer controller
you can see that customer form holds the
key research for my entity and you can
see I didn't type simply string and
something because if I did that string
and I would have initialized that as no
I would have to type well I'm here I'm
creating a predicate this is specific
for for qada cell but you might see that
I would create helps to create a string
computer and traditional way for me to
be creating this JPA series would be
through that well if name is not know
maybe I can then append like were like
I'm from customer whereas e dot name
like and I could be using something like
that I could be a pending so basically
the large could be I would be always
checking if their argument is different
than all they would repented the thing
to the my buter so later I could create
like a pewter to string and append that
to my to make JP a query the bad things
about that is I have to first always be
checking if it's different than know if
the value is something that I that I
that is the that I want if I wanted to
have to perform a like theory in the
beginning and in the end of the the
things to I would have to add this logic
and when adding my text for the theory
if I want to check if I wanted to ignore
white space on my qe2 I would need to be
checking here
if it's different I know if name that
contains like white space maybe I would
have to trim or not train or add the
size of things and this kind of logic
gets scattered across all of the
controllers a lot of the queue is that I
want to perform typically for me this is
a use case for applying what we call a
new object pattern to solve this kind of
problem so and you even need the special
case that if you don't type anything on
the name and under surname you don't
want to work laws so you don't want to
append anything so these are the logics
that you need to control when you're
just playing with the if statement and
everything else that's why I created
this classes single string arguments
which are basically factory
implementations that provides you if you
prefer if you provide an old value or an
empty string to the single string
argument it will turn for you a new
object which will perform absolutely
nothing when you is acute this kind of
methods which is customary form so so
what do I do here name is the object
that I have I have a pen methods if you
want to Idzik to have a nova object in
your system you always need to ask the
new object to perform some kind of
action so I ask this this this single
string argument which is a class with
two different implementations underneath
it to get the buter it to append the
work clause or the like cause on this
particular field of my JPA entity and if
the user type it's a no-name the thing
that is getting injected here through
the faces converter is a new object if
the user type it like a string the thing
that is getting ejected here for the
faces converter is the interest is
there has some implementation and I even
provided some nice implementations
because a customary ones required me
because he wanted to perform some
curious like that I want and you which
is which is available in other systems
too
I want to I have a key rebuy I want all
the names a dash to E and then
continuously of this one or a two or a
2l you know it to F and start a DSO n so
you can perform like different you can
instantiate different implementations of
this class single or could be interfaced
to of custom or a single string
arguments depending on what you want as
an argument so I I have this code
available on maven central as a library
just for you to check that so the source
code is available my github - there's a
nice implementation of no object pattern
because you don't need to worry anymore
if that's new if that's not and
depending on the kind of argument that
you have here you have a different
implementation of a QE that you can
apply so if you want to arranged here I
have a sing string or argument you just
type if you want a single we found our
range string argument you can apply
Kyrie's using this kind of range if you
have an integer arguments a single
integer argument it just accepts
integers if you have a range integer
arguments you can just start from one to
ten and it's going to return for you in
your QE so it can perform nice things in
your career that's lqe just by using
like the factory methods no object and
different implementations from each one
of these cases and that's most of the
things that I wanted to show today again
I had a lot of things in my mind and I'm
sorry if I didn't explain all that that
comes that I wanted or the comfort that
you wanted to but as I said it's much
clearer when you're reading something
that's why I'm taking some time to write
a book and try to explain all of these
techniques and much more techniques
and I hope you have been able to enjoy
and learn something from this talk it
was supposed to come from the very
beginning to show some integration
purposes I hope that I have achieved
some some success trying to show to you
what is a security architecture how you
can use that to so performance problems
integration problems and how can you use
that to that that step to achieve some
sort of event sourcing in micro-services
architectures ok that's what I had to
show now and thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>