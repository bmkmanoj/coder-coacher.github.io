<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Docker, Java and the LHC by Brice Copy | Coder Coacher - Coaching Coders</title><meta content="Docker, Java and the LHC by Brice Copy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Docker, Java and the LHC by Brice Copy</b></h2><h5 class="post__date">2017-03-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IF8hNzfNwkY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone so I'm with copy I come here
to talk to you about a fun use case
because we don't have that much time
doing this quick session so I thought be
something a bit entertaining and we're
going to talk to you about the use case
for every doctor in Java and a first I
I'm not a big fan of show of hands but I
have to do this one how many of you use
darker in production today dhaka larger
containers ok not so many so i'm going
to do a very quick introduction about
dhaka and we're going to start with the
age-old conflict that you know spans the
world of information technologies you
have on one hand developers like me
another hand seaside min so as a
developer i want the latest and the best
all the time I want to redeploy anytime
I feel like it and I don't want to be
bogged down by any consideration like an
operating system network connections you
know all of this stuff doesn't interest
me my only problem is when I have a
security issue in that case I gotta be
quick now on the other hand we have a
sysadmin now my seaside mean I don't
know about yours but mine is quite
conservative it doesn't like to restart
things it doesn't like to upgrade unless
you really ask you and most of the time
it's rather that I don't deploy anything
on these beautiful machines that he sets
up for me and we have a we have a bit of
a back and forth there and now how can
we how can we fix that now at CERN with
not when we do cutting-edge science but
we can't always do cutting-edge
everything you know we got to be
conservative if the LHC is up and
running for Yale 18 months at a time we
just can't feel restart and redeploy
things the way we feel like it so we got
it we got to stay within some regional
boundaries and I mean so far they
weren't many options to come reconcile
we can file is too
these two problems and with the
technology like darker you have an
option you have an option to deploy
self-standing completely isolated unit
of computation they're called micro
services typically and the Collette's
you do that in a very clean manner and
if you want to deploy java applications
on in a docker container it's very easy
i mean you you'll find tons of images
are there based images that let you
build on top of and so you'd find this
you'd find at the bottom operating
system dependencies on top of that a few
native dependencies that are essential
for any java runtime to to operate on
then you find a Java runtimes which
typically are cool GRA or JDK or openjdk
and on top of that you're free to deploy
your application and all of this is very
very bones like I mean we're not talking
about advanced anything you just need a
java runtime now if you go on the
internet and you look around and you
find is based java images you'll see
that they they way way more than they
should the the typical container size
going to be about 200 megs 200 megs
without even any of my code just basic
dependencies and when i went to my sis
ID mean I said look I want to do dr. in
production and you said bloodsucker so
I've explained oh it's going to be very
easy I'm just going to ship an entire
operating system and northern 80
dependencies in a binary blob and I'll
just ship it to your machines and it was
like what what are you going to do have
a fantastic operating system running on
these machines it's very stable and I
don't want you to add yet another
operating system on top another layer of
headaches and that's what it was right I
mean you're going to introduce a new
operating system noon-8 see dependencies
that come with their own vulnerabilities
and probably your own java runtime
version which is not the one is set upon
on the host machines and now we have a
problem and I couldn't disagree with him
it was right I was going to do that so I
need to find another solution and maybe
we can
use the weight of these containers make
them easier to ship easier to patch and
just keep skip the seaside means a pee
and why not why can't we do that in
darker you have the possibility you can
define volumes so you can say this is my
my container but inside that container
there's a whole and have to plug it with
something and you could do that with the
Java Runtime why not so i came across
examples on the weather people doing
that they just prepare containers and
they have all the placeholders for java
runtime except it doesn't have a java
runtime and now the advantage of this is
i can go back to Merseyside min and i
can package my application and the few
native dependencies that are essential
for for my java runtime to to run but no
java runtime I just point to whatever is
on the host machine mount it has a
volume so I mentioned why why because
you want to have a smaller container it
ships faster we're going to we're gonna
have a look at the order of Magnus's
we're talking about when it comes to
container image size and I don't want to
upgrade the Java Runtime I guess it's
not really my business and I just care
about the application and as a result
it's less patching in less black box you
know my sis Amin was exactly what shifts
in my containers cook it's much simpler
and when we talk about size this is your
typical container size comparisons and
you're going to say yeah of course it's
much smaller yeah I don't have a Java
Runtime in there so I've already saved
80 megabytes and so on one hand you have
the typical sent to s7 shipping with the
server java runtime and you have another
option which is very light 2.3 megabytes
this is a using DC box open wrt i don't
know if you know this operating system
is a very lightweight linux distribution
for Reuters small boxes embedded systems
and unfortunately upon you wot is not
very much of an operating system it
doesn't really have a packaging
repository did another packaging systems
it's very light if I wanted to go a bit
more easy to manage and patch for me I
could use Alpine Linux which is a 2
megabytes linux distribution that ships
with very bare minimum to operate a
docker container and here we have the
alpine container with jealousy which lip
standard C++ and ready to host a java
runtime so as you get there what you
have to do if you're not familiar with
ducker which it's not that complicated
but but you gotta you gotta look around
i mean the problem is darker is that
everybody is writing in a base image and
upgrading it as we speak there five ten
people now working on a java-based image
or PHP based image or not jazz bass
image what are you going to do so you
can just do like me if you don't trust
anybody to pick the right dependencies
and get the right content image you can
start from scratch really scratch 0 and
and just choose your your lightweight
operating system I mean I've come across
open wrt and Alpine but Dharma options
are there get your standard libraries
this is not that simple to rebuild these
libraries better rely on somebody we've
done the work for you the heavy lifting
but they exist before people are kind
enough to contribute this type of work
and then you just position your symbolic
links inside your container ready to
host a java runtime and when it comes to
run I don't know if you can all read the
bottom line here but this is what it
would look like so it looks a bit okay
in a bit a bit complicated but really it
isn't the first parameter that you care
about is this minus V that's telling
ducker I'm going to make you run this
Alpine pico Java 8 container and by the
way you're going to inject a java
runtime in there and if you do to this
minus V and you tell it this is my host
java runtime and this is where it's
going to end up inside my container now
the application that I base
my base upon is this container we just
assume that the Java home is under opt
GRE 1.8 and that's what the dockerfile
exact so for for you if you're
interested in getting into doctor if
you're using it a bunch of environment
variables a bunch of these cases alpine
Linux I've got a bunch of APK package
manager calls getting a few binaries now
i can t being built for me I mean you
could do it yourself I could do it
myself but in that case I relied on on
on the work of this guy on on github and
just you could be your for injecting a
few more certificate so anything to make
it fit with your security environments
and and then you just leave the symbolic
links in place ready to be to be used
here so you publish wandering in the day
and age of clouds and form deployments
why why do we need this well I think if
if you if you're like me if you work in
a more traditional environment a bit
more slow-paced there's going to be a
long time before we go darker in cluster
all over the place and I think this is
an interesting compromise between
strongly strongly managed host
environments and the possibility to ship
code that lets up to date and using the
latest dependencies and so there's a few
more links if you're interested in
looking into this approach first has to
ready-made containers for you but you
know don't take my word for it take the
docker file and then we build it on your
side if you want and then a few more
points is about people who came came up
with this approach and that inspired
this we start to work so thank you very
much for your attention I'll take any
questions if you have discussions ideas
ready I'm listening for you yes
yeah well first I'd tubulin gymnastic
which was I'm going to prove to you that
I'm not going to make i'm not going to
introduce security vulnerabilities
really more than i need to when I said
busybox he felt already quite more
relaxed I said okay and then and and
then no you know which that means i'm
talking about average that we then sit
down and explain how you're going to do
this deployment because if they're if
they understand how you're going to
deploy singh that which space you're
going to deploy it then there'll be more
relaxed about it this is still no this
isn't this not to announce that there's
going to be y divided the release of
this but it's possible if you if you
minimize your your dependencies and you
reassure them that it's going to be okay
yeah it's going to be stable and it's
not going to be insecure yeah i started
explaining that i'm going to say you
know that it's going to be okay because
you as a sysadmin you're going to define
which base image we use and you're going
to upgrade this base image and any
quickly said no I I don't want a great
base image with dr. bass images and I
don't and I don't have today there are
no widespread tools that let you define
policies that could say okay I don't
want to see any containers that are not
based on one of these two or three
container based images at least that
soon we don't have that kind of stuff
yet and so maybe it's something to look
in also scanning you know scanning when
you scan your containers even if you use
a well-established images like a tomcat
image you scan it and they contain minor
security vulnerabilities that so I
didn't want my system interest to do
with this kind of thing so I wanted to
reduce it to the minimum yeah so that
that's the main the main motivation by
this I can't rely on the cash I can feel
on my she said mean to redefine based
images and you wasn't going to let me do
that kind of work anyway yeah
it's a i agree with uses the case corner
it's a corner case it's not it's not
something that you'll find everywhere
most of people say okay I've gotta move
layers and they're cached and we know
who cares exactly exactly what I told
him I said today I'm shipping naked
dependencies that I got here and there
their proprietary they come from the
industry they come with a license I
don't even have a choice and and and I'm
I'm keeping up to date which is not
going to patch that kind of stuff yeah
the Java Runtime over the way it's done
at San at least it's safe to assume that
is going to you're going to keep up with
that because that's part of its obvious
mandate so so that's something that I
could I could rely on yeah okay thank
you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>