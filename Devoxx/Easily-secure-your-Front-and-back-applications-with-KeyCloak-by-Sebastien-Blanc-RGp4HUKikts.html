<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Easily secure your Front and back applications with KeyCloak by Sebastien Blanc | Coder Coacher - Coaching Coders</title><meta content="Easily secure your Front and back applications with KeyCloak by Sebastien Blanc - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Easily secure your Front and back applications with KeyCloak by Sebastien Blanc</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RGp4HUKikts" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey thank you everyone for attending my
session it's a really a pleasure to be
here at devoxx I was here 10 years ago
it was still called Java Poly's it was
my first conference ever and I'm really
happy to come back ten year after as a
speaker so today I will talk you about t
cloak and how to easily secure your
application front end application back
end application we can secure anything
just a few words about myself so I'm
Sebastian blonde I'm half French hostage
which makes me a bit a Belgium guy but
not really I work for reddit and I got
my application sorry I work on the Key
Club project before that I was working
on the mobile project of Reddit I loved
open source and if you want to follow my
trolls on Twitter that's my Twitter
handle okay I just have really few
slides because it's tools and actions
you don't really care about slides you
want to see code and how things works
but I need some slides just to put in
context to give you the big picture of
what key clock is okay security doing
security is hard and especially for
middleware developers I hate to do that
but you need to do it in with the add
security and maybe sometimes you will do
it yourself that's probably the worst ID
because you will always do it wrong or
you will use frameworks like Springs
purity stuff like that and even with
that it pollute pollutes your code you
have to handle the users the walls stuff
that don't really have to do with your
with your app with the core business of
your app and what happens when you
create another app and another app you
have to do it all I work over again will
be awesome if you could delegate all
these security concerns and user
management to an external person an
external server and that's what key
cloaks does and here you see I'm sure
you recognized Kevin and Whitney so
giving during the bodyguard
he's taking care of the security of we I
love to put the slides it's always a
challenge to put a slide of bodyguarding
in a tech conference key clock quickly
well the Stig loves okie clock is an
identification server also for
authorization and Identity Management
you just deploy yet it's open source of
course everything that I will show you
is open source and more importantly if
you want to contribute to fix it back
add some duck well just send a PR we'll
all be more than happy so key cloak for
identification has handles open ID of
course that's the cool kids on the block
some more orchids on the block
gerber was even older and that's the
server then your applications they need
adapters to talk with this potentiation
server so we have adapters for almost
every type of application so for wall
fly
tomcat spring boot no GS and for more on
the front end we have a JavaScript
library to protect your web apps we have
native libraries for the mobile clients
for iOS and Android
and everything that I will show you is
also accessible by rest endpoints or you
can extend with your space as well okay
he clogged how does it work
so he cloak has the main concept of a
realm that's a really difficult word for
me to say in English realm that's why I
say territory territory key cloak
protects territories so you said to
cloak this is my territory and in my
territory I got applications that I want
to protect so that's what he have here
we have a this island really nice
territory there we have GE land the old
land where nobody wants to go not so
cool we get angular land that's a really
cool place to go everyone who wants to
go there we got to micro-services land
we're not sure what is happening there
and no J's land where if any place and
what happens so you arrived with your
boat there and you want to visit the
island and you arrived at angular land
and there is there's custom control and
there you need to identify yourself and
there's where you log in exactly you
arrive with your boat there and he says
hey you get a redirect so a real HTTP
redirect and it sends you back to this
tiny island that is T cloak and says hey
you have to identify yourself you
identify yourself and if it's okay doc
you get a stamp and what's that stamped
well it's a token but it's not just a
simple weirdo numbers and alphanumerics
token it's a JSON web token and a Jaden
what token is it's a token that also
contains some payload who you are which
walls you are when will your token
expire a lot of stuff
Jason web token is really an interesting
subject and now it's the tools in action
I don't have time to talk about it but
but let me just switch tomorrow our
friend
uber would just give this talk before me
will give a conference talk on Wednesday
and Wednesday um Jason what talking so I
really advise you to go there because
it's a really interesting subject okay
back to my presentation so you get your
your token and now you can visit you can
get everywhere on the island where you
are authorized for and basically that's
what key o'clock is last thing and then
we will start for 20 minutes demos
tick tock how do you deploy it how do
you use it well since we are all
developers here offshore you fork the
repo and you build it yourself
and you deploy it well we have also a
standalone version that you just unzip
and when we have and well fly EP
subsystem this that means if you are
already a wall fly application server
running and if you just want this one
you can add tea cloaks as a subsystem
and of course we got docker images okay
so let's start with a demo and what we
will do we will start with an really
old-school app they will school GE app
that is using GPS and stuff like that
and we will see if we can secure that
and from that we will extract a micro
service and then we will add an nice
angular front-end and for all of these
components we will try to secure them
and that will give you a nice
introduction to Key Club so what's the
app that we are going to protect
let me go here what we will protect is
the product app awesome app look at this
GSP I'm sure it has been yours you
didn't see that
and it's the familiar for you well maybe
you need to change to go to another job
but yeah and that's just to show you
that even this really cool app we will
be able to secure it
but before securing it let's build it
and deploy it just to have a look of
this earth okay let's go here and maybe
I can too much okay let me do a maven
clean package that will make my world
and let me copy that my products were
let me copy that to my wife life server
standalone deployments so I got my
server running here so it has been blow
it should be and if we go to my local
hosts my product portal that is the most
exciting landing page ever of my product
portal and that is the unprotected page
and if we go on the product listing we
got a list of products Wow awesome
so my bus I love that much that
application said that said you really
need to secure that because we want only
have authenticated persons that access
this product app okay so let's see how
we can protect this application and what
I will do here I will just I'm using
branches instead of live coding way
easier okay step one
let's go back to our app so first thing
we can see here and I didn't change
anything to this GSP I just added some
stuff around log log out log in but the
core business hasn't changed what I
change is my web dot XML oh I forgot to
show you the earliest version but what I
got here is familiar for those that had
to secure application
all I did was adding a security
constraint and basically what I did say
here is well when you try to access this
URL well you have to be authenticated
and you need to have the wall user the
role that I have defined here we got
also a row admin and important part is
here I say well for the locking
configure I want to use the key clock
method and you will recognize that
because I installed the key clock
subsystem and this one more thing that I
need is well my application doesn't know
where my key clock server is running so
I need to add a small file a descriptor
that tells him well where my key cloak
service running my public key and stuff
like that that's the key cloak that
didn't fall that is a file that we will
find for whatever app that I secured
with the clock we will always have this
key club that season so it's pretty
simple I see say here which we own I
want to protect my public key the
location of my key clock server and
other stuff like that so that's really
all I need now let's see if that's
change anything so let me do it again
maven King package let me copy the war
again let's match
here okay so let's go back to the
landing page
okay landing page is not protected
exactly that's what we want now if we
click on product listing that's where
the magic should happen and if the demo
gods are with me today okay look that's
what I show you with this island I
arrived there they say hey you need to
identify yourself and they sent me back
to the key clock server and here I'm in
the key cog server login page and what I
can do is log in with my username and
I'm logged in so my app is protected but
let's go back to the login screen let me
log out okay let's go to the key clock
web console to see if we can trick a bit
our logging screen go here
okay let's go to administration console
admin passwords really difficult also
okay let's go to my room the box and
here here's where I can configure all my
applications determine applications my
Wilms my walls my users pretty standard
stuff I won't spend too much time on it
because it's pretty obvious but I want
to show you the login screen here so
what we can do for instance is for new
users maybe we want if you don't have a
account you want to register to become a
new user
so yeah let's enable that yeah
maybe sometimes I forgot my password so
I want to clog to send me an email with
my password let's activate that and of
course I want to remember me because I
don't want to login all over and over
and what I do here is save that and if I
go back to my exciting product app and
as I go to the product listing now you
can see I got to remember me I got to
forget password I can reach Esther we
can try that we just a new user let's
call it D box ve D box the last name
devoxx email devoxx password okay and
our register here and that locks me in
at the same time so I create a new user
and is logged in what you can see here I
got a link it's managed account what G
cloaks also offer is for logged in users
is a sort of space where as I can set up
their own profile typically when you
click on Twitter to change the profile
we got the same here so manage account
you can change your user name last name
password you can reset your password you
can do yeah everything that is around
management of your own you can do it
here and here you see the standard
template that we are using for key clock
but every screen including the login
screen register screen the screen it's
based on templates and it's really
really easy to adapt that so it fits
your company look and feel so and in the
key club console you can just select a
team for your applications let's go back
to the portal here and so I show that to
my boss is really happy and he says but
I said I also want to have a social
login I want to log in with my Facebook
account with my Twitter account get AB
account can you do that okay see if
that's easy to do so let's log out again
let's go back to our console here and we
got here a screen of identity providers
and here keylock can act as a broker
between your app and external parties
like Twitter Facebook Google get up and
it's pretty easy to set up so just give
you an example yes since we are at
devoxx you probably all have a github
account so let me just put here dummy
numbers okay and I want it to be enabled
I just save it and if I go back to my
app and I need to login now you will see
I have my get up I can log into my up
using my github account so you saw I
just entered dummy numbers that I got
one here Twitter one is a real one and I
just need to enable it don't look to my
client secret okay and if I go back to
my app
okay I got now Twitter and if I click on
Twitter here you see the plastic way of
auto red Auto rising an app to login
using Twitter so here I can just
authorize the app and it redirects me I
can update my account information stuff
like that so you can see it's really
easy to add social logon even to this we
also GSP app though my boss is really
happy
he says subs that's great but the
product app is so popular everyone wants
to use it I want to extract the product
service as an external service and
deploy it like in micro service because
my boss heard us word and said it's
really cool and he says he also told me
I've been told that Java EE is all cool
stuff I want no GS
so could you make for me I could
services and no GS that gives us a list
of products and it needs to be protected
I say ok so let's see how we could
protect and no GSM let me go back to my
editor and what do we have here it's an
OGS app so it's a really simple one
that's the unprotected version so you
can see that I'm using Express practice
and the surf course to to handle with
which was the main stuff and I just have
this important method here if products
URL is asked give me back a list so let
me see if this no Jia's app is working
yeah that increase the Ardoin and p.m.
start okay my app is running on port
3000
let's make sure it's working no products
sorry product ah okay so my no GS app is
running pretty simple how can we secure
that so again super life coding stuff
okay check out step 1 okay and let's go
back a deterrent and let's see what have
changed here so a first thing we can see
is that we are using the key cloak NPM
module here I configure a store to
handle my session it's not serious
just to show you how it can be used but
most important part is here I initialize
my key cloak library and the big
difference here is in my rest endpoint
that I declare here I just pass an extra
function here and I say key cloak
protect that's all
and again like my Java app I have my key
cloak Jason saw and one interesting line
here is the barrier only that means that
this app this service this reservist can
only be accessed by other apps that
already have a token you won't never be
able to login a human will never be able
to login against this app and it makes
sense because there's no front end so
barrier only we say only accept request
that contains in the header and
identification token and again that's
all I need to do though let me do an NPM
start again and let's go back to my app
and here I got my
tonight so that means my no GSF is
protected so what I need to do now is to
change my product app though that
instead of giving back and hard code
lists oh yeah
that's something I didn't show you the
database service that was our database
service
you see really exciting methods we just
returned hard coded list of products we
need to change that now now this method
has to call mine OGS service to retrieve
the products so let's do that and that
will show us how to to pass a token to a
very only protected class and service
let's go here and let's go to step two
okay so what I've changed here what I do
is just using an HTTP client so here I'm
using the one from a and from G common
but you can use whatever HTTP client you
want and the resting line is this one
from the HTTP service request I can
extract the key clock security contest
context and from there I will be able to
get my token that I had when I logged in
and what I do is just adding an error
with the authorization barrier my token
and I called here you can see my node GS
service so that's really all I have to
do and again let's blow that and let's
let's deploy that okay should be
deployed okay let's go to my
where's my operating it's doesn't matter
let's go here look a host for the portal
okay let's go to the product listing I
need to login
Sebby Sebby and here well not really
exciting to see but this list of
products came from my know GS service
and it's all protected so that was the
second step and now my bus he says cool
SEP but now I want a web client using
angular because we we want to go away
from this crappy GSP stuff so can you
make a angular client for me that
consumes this no GS service and of
course it needs to be protected as well
so let's take a look on how to protect
the web web application using angular
and that's my third demo is here is
angular projects and let's take a look
at the app so it's standard angularjs
app and what I do here I'm just using
the the key cloak JavaScript library
again I got a key long season as you can
see here but pretty standard stuff like
I showed you before and okay what I do
here I initialize my cloak library and I
say when it starts logging is required
and that will do the redirect magic for
me and here I do some
hiding angular stuff I create a factory
stuff like that but the other important
stuff is each time that I will do a
request to my no g GS service I need to
put the identification token in my
header and how can you do that easily
with angular well you have the concept
of interceptors and here I intercept
each HTTP request and what I do simply
is adding the authorization header in my
request so I'm sure that each request
will contain this token so let's see if
this works
and I get here my angular client so okay
so I showed you some maven some NPM
let's do some grunt no ok surf here we
go and that's my app ok let me login CB
CB and let's load my products and here
my products are loaded so exactly the
same I got my angular app running and I
have just one minute 30 left that's when
really quickly I have one minute to
protect and mobile app ok let's do this
challenge yes I like that ok I can do it
one minute
so this awesome app is built with with
bootstrap and it's responsive and I'm
using Cordova to build hybrid apps
so basically I've wrapped a web app into
a native app and I use exactly the same
code that I showed you for the angular
app and I can just well if I go to my
IRA to app I can just deploy my app
though here it's building an apk so now
you're seeing some grado
you see
everything almost okay and let's go to
my app and look hey that's my app that's
my that's a native app I can put that in
the store and we can really rich because
the product app is so as awesome
so ABCB and can I load my products I can
load my products so and that is a real
ap Caid so and of course we have native
libraries as well so that was really
quick but it's my my goal was really to
show you how starting from a really
old-school F going to no GS to angularjs
to mobile apps how easy it is to secure
your apps with Key Club I'm here too all
week so if you have questions about key
cloves you want to see other demos how
to integrate with spring boot for
instance ever really nice demo for that
as well how to use OTP one-time password
integration with somehow just asked me
as well it would be a pleasure for me to
answer your questions thank you everyone
questions no yes
where do I store this data well you have
to choice we we can connect with
different databases with path quest
MySQL and we also also have integration
with MongoDB and some stuff with
unfinished infinity span vaguely it's
encrypted yeah yeah yeah for the details
of the encryption I'm not the right
person but we are doing great stuff
there okay thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>