<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Do you really want to go fully micro? by Robert Munteanu | Coder Coacher - Coaching Coders</title><meta content="Do you really want to go fully micro? by Robert Munteanu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Do you really want to go fully micro? by Robert Munteanu</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/a3uCeV2Dst4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everyone thank you for joining
my name is Robert Montano and I'm here
to talk about whether or when do you
want to go fully micro obviously fully
microservices wrong button I'm new with
this so a couple of words about myself I
work with the adobe yes we do some other
things besides the stuff that you know
about us I work on something called
Adobe experience manager long story
short we build on a lot of cool open
source projects and i will be showing
those today when talking about the
experience of going or not fully micro
so the title of the talk is a bit vague
i know i'm not great the titles or at
cache invalidation yeah i'll just have
you know that the other proposal was
fifty shades of micro i decided was a
bad idea for many many reasons but
anyway just to give you a little more
solid foundation about what we're going
to be talking about today first of all
microservices versus mana lives then i'm
good i arrived at the conclusion that
micro services or rather microservice
implementation approaches are not the
same are not equal so we're going to
talk a bit about how we implement
microservices then we're going to try to
find the middle ground using a gateway
approach microservice gate with a
approach and since that gateway will be
built as a proof of concept using the
batches link i will give the world's
shortest introduction to apache sling
and then see how things look in practice
okay let's talk a bit about micro
services and mono lives in in life you
have decisions right you have make
business dishes decisions personal
decisions business decisions and there
are two kinds of reasons for taking
those decisions real reasons and
declared reasons sometimes they match
sometimes they don't right so when the
that technology team comes and says we
really need to rebuild that application
no GS because it's an a synchronous
framework and it plays better blah blah
blah what they're really saying is I saw
it on hacker news and I really have to
build an application with it Micro
services are very high on the
fashionable scale right everybody is
talking about it no I'm talking about
them many other people are talking about
them lots of cool companies are using
them so there's a high pressure to use
micro services it's fun unfortunately
one of the big reasons for using micro
services but not necessarily the right
one now the biggest let's say
technological reason is that micro
services allow you to decouple
implementation from what you actually
consume so to give you an example if
you're doing consuming HTTP sorry JSON
payload over HTTP you don't really care
what's behind there right it can be
something it can be Ruby on Rails it can
be a skylight can be something written
in Java of drop resort or what have you
you don't really care so in turn that
means that you can your technical teams
can choose the tool that suits them best
for instance you have a large
organization that spends three
continents you have multiple technology
let's call them silos or excellent
centers that have different technology
backgrounds due to acquisitions due to
how the local technology market is
before that if they would be building
one single application you would have to
have the single runtime stack and then
everybody would have to do Java let's
say now if you have some teams which are
better at different technologies you can
have them do their micro services in
Python or nodejs so they really do what
they know best which is one of the great
technical advantages of micro services
then you get a bit into process
advantages which is when doing
microservices you always have this
problem that things can fail things can
go away you rely on a billing micro
service which is on a different server
in a different process and it can go
away without letting you know
so that logic that you used to apply to
databases careful pooling monitoring
sizing and all that suddenly needs to
apply to micro services will write to
whole other parts of your application
and while that can be viewed as an
obstacle it actually makes your
application much more resilient so in my
book that's a plus stealing now if you
have this big monolithic application you
probably have to be components write a
web application and a database server
and when you want to scale one of them
if you're already at the scale problem
you're probably using big servers right
so if and those costs money if you're
going to from three big database
database servers to four big database
servers that's going to be a bit costly
but in our example we have two
microservices order processing catalog
search and we decided that for some
reason catalog search takes more
processing time so it's easy to scale up
just this instances or even remove from
the load balancer let's say you have
four here we take two from load order
processing we add two to catalog search
and we have a simple story about
balancing because typically these
machines are smaller a level of
reusability is another interesting point
with microservices so micro services are
established around the idea of reusing
business level functionality so you will
not have a left pad microservice right
or maybe let's hope not let's hope you
don't have a left pad microservice so
you can have micro services which do
let's say a geolocation micro service
which is the go-to point in your
application for doing geolocation so
that allows you at the business or the
organization level to do a better reuse
deployment it's more or less site to the
the scaling idea you have smaller units
so you don't have to stop the world you
don't have to stop your application
while you redeploy or restart a sort of
large monolithic application that takes
a long time because it does so many
things micro service
be small isolated and ideally start fast
and that's where you get to this example
if you want to do a deployment of the
order processing you you just have to
redeploy two instances or if you're
doing something more courageous you add
two instances and you take two away and
if those go quickly enough that should
be really really fast for you and now
we're getting to the more management
oriented benefits how do you do faster
delivery which is something I I don't
think anyone is happy to deliver every
three months or six months or year
mostly what I what I've seen done is
getting some sort of iterative process
like scrum on the table and then teams
deliver every two three four weeks and
the question is what ways do we have to
get delivered done faster Rab not
deliver more not deliver the same in in
a small time frame but deliver more
often instead of delivering let's say
ten issues in four weeks let's deliver
two point two or three every one week
and here's the hypothetical example of
team which releases every four weeks so
week one week for week 7 three weeks
rather and they didn't they didn't find
the proper way of reducing this velocity
so what they can do is split the
deliverable right so instead of doing
one big monolithic application you get
to do microservices so each microservice
has his own life cycle its own delivery
so you can see that the de catalog team
was actually the one that was doing the
releases every three weeks while other
teams were able to deploy them much more
often so by going to the root of
microservices you actually get to
deliver faster not more but faster you
get the changes to your clients much
faster which is good that is not to say
I'm an unconditional fan of micro
services there are voices including this
guy that say well it's not all good
microservices so the bottom line here is
that
if your codebase wasn't great to start
with using micro services is not going
to solve that issue right there is
another very more graphical image with
big poop and small poop but I decided
not to show that you can probably find
it on Twitter so but really what why do
we would we want to use mono lives
instead of micro services now these are
that's pretty small i think these are
some of the things which get better with
age just like wine so this would be
eight fallacies of distributed computing
that were going sometimes in ninety 90
and 92 84 rather 20 something years ago
so they are just as relevant today as
they were at that time the time they
were thought of I think two or three
weeks ago we had the largest distributed
denial-of-service attack in history
something about 10 million IPS so it's
the Internet of Things gun right wrong
depends how you look at it but my point
is that we're using the network much
much more intensively than you we used
to so micro service is only amps or to
amplify this effect before you had a
single application running in a virtual
machine or in a single process space
anyway I haven't seen the JT and drop a
method call in my professional
experience but the network you know so
we this distributed nature of micro
services which is one of the greatest
strengths it's also something we should
really take into should really look
attentively at so one thing I want to
discuss is latency right speed is
infinite latency is zero when you start
to do microservices I'm not just 235
microservice when you really start to do
microservices then you get to the point
where you have lots of microservices
interdependencies for instance you have
a foundational microservice like
geolocation and the billing module wants
to know which country or in which states
the user is in so they can calculate
shipping and taxes user management maybe
wants to know
for customer support which country the
users okay located and and so on and so
forth so what you get is this a very
complex network of micro service calls
which can quickly saturate your network
and the latency increases the throughput
decreases and it's something that you
just have to deal with of course there
are ways to get around it for instance
caching right or just D localizing data
pushing the data from the micro service
out to the other micro services but
again it's a cost that you must take if
you want to do micro services and you
want to do them big scale you have to
take these things into account now
security now this is a typical computer
hacker notice the gloves it's a they
give you extra skill when typing now
security with micro services is still a
pretty young field we started
understanding pretty well how to secure
model lives or let's say public facing
applications but securing the network
because microservice is typically run
inside the fire over idea they're not
accessible from the outside but there
are issues such as how do we get micro
services to trust each other how do we
pass authentication credentials from a
monolith to micro services does each
microservice authenticate against a
central identity provider do we have a
central entry point for that which is
done somewhere else so we don't yet have
very good answers to these kinds of
questions there are some mechanism that
will talk a bit later when discussing
the a gateway but you need to ensure two
things one authentication right so the
user credentials how do you transport
user credentials and to confidentiality
how do you end integrity how do you
ensure that a message that goes between
microservices hasn't been tampered with
and typically one answer is private
networks just isolate microservices in
their own private network and say hey
nothing else can get in there I'm secure
that's one possible approach another
approach is doing ssl everywhere but
then you have to ask yourself well my
very small and agile microservices
deployment strategy just has a step
which says contact ssl certificate
venture request a new certificate obtain
approval for purchasing wait for one day
until it's it's wanted to me or set up
your own infrastructure for code signing
an offer rather code certificates and
all that which again it's doable but you
need to take this into account when
going to microservices now about
operations if let's consider that we
have this sort of typical monolith where
we have application server database
server and a no SQL cash now those are
three components that are in the mixed
and your operation team can probably
take three components understand how to
monitor them how to tune them how to
take care when something goes wrong but
on the other hand if you go get complete
freedom and say well we have one two
three four run x + 1 2 3 4 persistent
technologies that's an increase that
again your operations team must know
they will take the hit for this and it's
not something that comes for free so
again modulus are easier to operate well
I no I said that microservice have the
advantage of getting code reuse but they
also have the disadvantage of not
getting code reuse and what do I mean by
that it's the idea that micro services
are supposed to be extremely
self-contained and one team is supposed
to completely own them without
interference from others so while you
get to reuse at the business at the less
a business several functionality when
you're doing smooth let's say small
level sort of library code reuse you
need to ask yourself what what do you
want more do you want to allow teams to
completely own the code or do you want
to have some sort of shared code which
is used by many more micro services but
at the same time you introduce these
hidden dependencies between micro
services because some teams must wait on
other teams which are sort of against
the spirit
of let's say properly done microservices
now some of you might might have might
be familiar of Monty Python but briefly
this is king arthur and this is the
black knight and the black knight well
opposed King Arthur and he ended up
losing two hands and one leg but he
still says it's nothing but a flesh
wound I'm here come back and fight you
coward and I think this is sort of like
a web application which has most of its
microservices down but some are still up
you know search isn't working we can't
place any orders and you can't really
browse but you know you really have the
user account page which is up so 200 ok
all things check out a joke aside avail
when asking yourself is my website up or
is my application up is a very simple
question to ask with the monolith it's
either up or it's not but if
microservices you need to find out for
yourself what does that mean what does
that mean that my website is up what are
the service is behind it that must be up
for it to be as a system consider up and
when talking about services you need to
find out where those services are right
so if you have 20 microservices you
can't just hard code the list of ips or
host names in your configuration file
and say ok that's how I find my service
is because you probably want to scale
them out you want different setups for
production for testing for development
so you need another piece that you will
add your infrastructure for service
discovery which is doable it's not
rocket science many people are doing it
but and again another cost in in time
and in maintenance that you don't have
with mono lives and also one of the fun
things is correlating something a
request between microservices when
something goes wrong so right you have
this request to your web application and
then you send off five requests to micro
services and something goes wrong into
one of them and you want to correlate
all requests and find out what happened
good luck it's it's something that you
need
to build into your infrastructure have a
central log centralized location for
logging and then have some sort means of
correlating requests between
microservices of you a unique identifier
and then making sure the clocks are in
sync which is a trivial problem as we
all know and then make them ordered by
something reasonable life time stamps or
user IDs okay I've done enough bashing
on micro services now why do I say that
not all micro services are equal on that
not all implementation strategies are
equal well you can have two implemented
to large implementation classes the
first one is what i call the unbounded
implementation strategy will give the
development teams complete freedom right
so you want to do micro servers I don't
care what is that don't tell me I don't
want to know you handle this with the
Ops teams you write what in whatever
you're good at so that gives maximum
technical freedom to do what they want
best on the other hand you have this
bounded sort of limited microservices
implementation approach where you have
one runtime platform whether its spring
boot drop wizard or whatever you you
think suits you best and this time you
have something that is mandated
throughout the organization and why
would you do that well the question is
what do you want to do with
microservices do you want to get the
technical benefits complete freedom do
you want to get the organizational and
delivery benefits like much faster than
a much faster delivery pace then you
already start understanding in which
direction you want to go to the point is
its micro services are not an
all-or-nothing approach their gradual
approaches to micro services and one of
these is the middle ground and that's
using something I called and all its
it's called an API gateway I think be a
gateway is basically another layer which
sits between your micro services
communicating amongst each other or your
between your appliance serve a client
application and your micro services and
it can isolate a number of cross-cutting
concerns authentication some
parts of authorization it's a very good
place to gather key performance
indicators since all requests go through
such a gateway it very well knows the
number of requests per second it knows
which services are slow and it can do
something which is called circuit
breaking which means if a part of a
system is down you stop hitting a
sending requests to it because you know
they're going to fail maybe try a little
bit later see if it goes up or even
worse if it's not that if it's down well
at least we get nearer immediately if
it's slow now that's something which is
a catastrophe because you can break your
application down if a component is slow
so an API gateway is an ideal place to
centralize this logic now ideally it's
stateless because you don't want to you
want to scale this out these will be in
the middle of your infrastructure it
should be very lightweight again because
you want to have lots of these and it
should be extensible because you don't
want to hold back the micro service
development just because the gateway
isn't extensible enough to support the
new developments that you want now how
how would this look so something which I
call it a transparent gateway which
means it doesn't modify the payload that
gets sent between the consumer and the
micro service so a consumer let's say
itself makes a put request to payments
it goes to the API gateway the API
gateway same sense almost the exact same
request maybe it does those
authentication maybe add some headers
and then sends it on the way to the
micro service the micro service returns
created response everything is fine in
Jason and then they PA gateway sent it
back to consumer the advantage of such a
setup is that you you don't have to do
special code for the Gateway it speaks
the same protocol as the SD micro
service so you can transparently
introduce it into your into your whole
operation if you choose to do so it's
probably just a configuration change
right point to a new location so this if
you
have an existing microservices
infrastructure and you want to
centralize some of the cross-cutting
concerns this sort of transparent
gateway is a good first start now if
there has to be another otherwise I
wouldn't have given that the name so
something which I called a transforming
gateway as opposed to a non transforming
gateway can offer questions to a couple
of hard can offer answers rather to a
couple of hard questions first of all is
how do we do versioning with
microservices which is something which
everyone loves to debate let's say we
have a micro service which wants to move
to version 2 because they decided that
version 1 is crappy and something they
should never have written right then
they what do the consumers do some of
the consumers won't be ready so you have
multiple options one you make the micro
service implement two versions which is
not so nice because my services are
supposed to be small isolated agile blah
blah blah not deal with multiple
versions or you make the consumer aware
of multiple versions which again isn't
all that nice or you make this guy right
the API gateway are able to adapt to
multiple versions so the consumer
doesn't it can move to the new version
whenever it's ready the micro service
can move to a new version whenever and
everybody's happy if you're doing
multiple protocols right so some are
doing Jason some one week xml protocol
buffers there's many many choices what
what do you do as a consumer do you want
to really know all of those formats and
talk to them or you can have the API
great gateway as an adapter which
transforms and say hey I want just want
to consume JSON and the gate we can give
you that and also if you're talking to
many microservices the network calls at
least one still not moving to HTTP to
you have many network calls they will
add like latency and the Gateway can do
batching as well okay this is what my
diagram skills are not that good let's
say the consumer calls day PA gateway
with special offers requests in the ape
a gateway sends requests multiple
microservices and then someone returns
xml someone returns JSON and then the
Gateway transforms the response into one
single payload and sends it back to
consumer is Jason I'm running a bit late
so Apache sling obviously an Apache
project it's been ten years in the
making mostly Java and I won't tell you
how much may even we do but it's it's a
lot we have a good history of activity
increasing and yeah as an API gateway is
a good proposition first of all its
content oriented or restful which means
that we are already able to serve
resources in a restful way by design we
we offer a hierarchical view of our
repository we don't do SQL or no SQL as
a persistence layer it's a low level
detail but we are offered to expose
everything as in restful format by
default and I'll show you me what that
means very lightweight it's extensible
internally uses osgi so you can it has
many extension points which means that
you are free to extend it however you
see and it's very easy to deploy in
terms it's a runnable jar and nothing
could be simpler that java man Oh darker
is simple and during a jar according
some people but anyway for me it's very
simple to start and deploy and this is
the restful part that I was talking
about so when when doing telling you
what do I have in my repository it
doesn't have a concept of tables or sets
or whatever it's just a tree of
resources which is ideally mapped to a
real space so restful so very good for
micro services and the way this gateway
looks is in the front we have authentic
asian authorization and then we have
various sub trees in the URL space which
are mapped by patches linked to various
microservices and in between we have all
this cross-cutting concerns that happen
before authentication authorization the
demo application as microservices gate
which runs the number of proxies goes to
a social microservices which returned
Twitter messages spam checking and a
list of articles so it's basically a
blog sling does this receives the
authentication data does its own
authentication then encodes it and sends
it to the micro services which are able
to decode and verify it we've done this
using JSON web tokens which is basically
an internet standards which packs a
string representation of a header which
says hey I'm doing JSON web tokens using
this encoding algorithm this is the data
these are my claims this is John Doe and
his an admin and then a signature
important to see here that you don't
have the it's not encrypted so it's not
confident confidentiality is not insured
you need to check the signature to see
that the message is indeed not been
tampered with okay I have two minutes
left for the demo that's going to make
it very fun let's see right so we have
here we have free microservices running
drop wizard and spring boot we have the
sling we call it the launch pad which is
basically the the assembly all the
artifacts that go into your application
I'm going to skip straight to the demo
so whatever happens on port 8080 is is
this visible let's make it a bit larger
on port 8080 is going through the
Gateway now first of all I get a
forbidden code because i went to a micro
service without any authentication data
so let's just add authentication oh that
was the incorrect password later sep so
if i add your tent occasion you can see
here that the request has been
successfully served and everything was
passed for the gateway of course if i do
an increment occasion the Gateway says
okay I don't know who you are with that
password
and no request has went to the micro
service now something which has been
transformed as we have another
microservice which returns a list of
Twitter messages but still we would like
to have them returned in a JSON format
by the gateway so the gate slink is able
to do that for us and the way we do this
is we have this sort of abstraction
which says hey we can map any resource
that you want to give us whether it's
something on file it's a relational
database it's something else as a
resource and this is the resource
resolver that I use which says hey at
this path you will mount those resources
right so it's a single entry you get the
remote URL you parse the messages and
you construct a resource out of it I
will skip the rest since i'm running
very short on time so conclusion you saw
very little of it but eventually thing
is very cool and feature full web
application development framework it was
actually built before microservices were
designed as we know of them today but
since it's very extensible and restful
it's a very good fit to build such a
gateway microservices are known not an
all-out proposition right you can choose
various levels of let's say investment
in micro services and you need to find
out for yourself for your organization
for your team which is the best level of
involvement and I try to be subtle with
this okay try Apache sling today it's a
very cool piece of technology I have
some resources I don't have time for
questions but I'll be here all week and
please don't forget to rate the D talk
in the app thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>