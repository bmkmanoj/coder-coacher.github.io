<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Testing Java Code Effectively by Andres Almiray | Coder Coacher - Coaching Coders</title><meta content="Testing Java Code Effectively by Andres Almiray - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Testing Java Code Effectively by Andres Almiray</b></h2><h5 class="post__date">2017-05-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VSu8I19HW70" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">poof so the minuti
this is the last flaw for the day the
last session I'm very happy to see you
here
I see some smiling faces I guess this
has been a very interesting experience
for some of you who has been here for
the first time okay that's a good number
excellent next time make sure you bring
a friend or more all right so we have
less than 50 minutes to talk about a
particular topic which is testing in
Java and I assume that most of you are
Java developers in some way or another
am i right yeah cool of the Java I love
the Java excellent in my people all
right so this claimer the things that
we're going to see today are open source
right which means that instead of what
we saw earlier in the keynote that you
will do HTTP T HTTP 2 on Monday right
yes you can use these things right away
because they also open source instead of
going home and then relaxing and having
family on Sunday you will work on open
source with this T right of course ok my
goal is at the end of the session you
continue to feel like this means but so
much great content that should make your
daily work a much better experience
right so my name is Sandra Sameera I
come from Mexico so I speak Spanish I
understand somebody Italian a very bad
Italian but I love the pizza you guys
are great a pizza and I work for this
company Cano you might have heard it is
one of the sponsors of this conference
we sponsor the aborted machines don't
forget to vote at the end of the session
please and I'm also a member of the
groovy development team so I love the
groovy a lot of the Java I also have a
lot of experience working with offices
projects and is thanks to those
experiences with open source and with
our customers that we have found a
series of projects that allow us to
write tests in a much better way in a
much effective way
all right so here we go all of the code
that you can that we're going to see
today is reachable at that URL and all
the code is open source you are free to
use it
all right you also get this lines at the
end so don't worry and so here we go
now I if you are like me you probably do
some testing from time to time now
myself when I was 20 years younger I
thought that who needs that right so we
got real users we always test in
production that's what DevOps is right
and well no we actually need to do some
testing and so the first thing that you
pick up is probably j-unit let's see who
uses test Angie yeah jae-joon is only
one guy you still tested G j-unit
excellent most of you are spark ha it's
going to be new for you guys all right
so with these frameworks usually what
you do is you create some class on the
test some instances in some way cook in
some collaborators execute some steam Li
and then comes the gravy which is making
assertions on the things that you are
expect to happen now there are many ways
to do it in the old days of j-unit we
only had something like assert equals or
true and so what not the great thing
about this is that you get an error if
something fails if their check is not
correct but the description of the error
was not that good you simply set out
something fail right unless you write a
special message so in jg need for we got
an additional library called hand crest
now what's the weird name hand crest is
just an anagram on matcher and what
hamcrest does is gives you the
capability of defining an assertion that
is self describing so in the case of
this assertion I don't know you can
actually see it but in the blue is with
the things that are supposed to be
different sorry I lost the PowerPoint
slide so I'm showing something that is
just PDF so in the blue there
and to have the pointer yeah that's just
a regular hand Chris matter I will
assume that most of you are already
familiar with this because hamcrest
comes bundled with a uniform
now if these things happens to fail it
will tell you I expected value test but
I got closer so a very descriptive error
and you can do this with bullying's and
objects and collections it's actually a
good chunk of assertions coming from
anchor score and handcraft library that
you can use from the get-go
and if any of these things are not ready
for a particular type or or class that
you have in your current project that
you can extend hem crest and create your
own assertions by the way I get I talk
very fast when I'm getting excited about
these things and these things get me
very excited so if you say something I
please undress stop the googly bit
slower or if you have any questions at
any time please let me know I'll try my
best to answer them so this is basically
hand rest I expect again most of you to
be familiar with this in one way of
another so the advantages are that it's
already there
if you use j-unit and it's easily
extensible and it supports many
different assertions already right a
sergej is a different framework for also
providing assertions now so whilst we
here this new in blue is that we also
got an assert that method all right then
we got some some value there that we
want to test but what it starts to look
different here is that instead of
passing an additional object to the
assertion method we do a method chain
and this method chain is equal to will
give us the answer to if this thing is
equal to the other or not but what is
important here and something that I
cannot show in a statically if I were to
do this in the IDE is that this equal to
method will only appear if the value
here has access to that so a sergej
tries to be smart a use of feature true
generics known as self types
if this is where to be a map then the
methods that I can call here on the
other side will only work if they accept
a map if this thing is a string then the
methods will only take a string so you
got some type safety when also providing
the assertions because notice that if I
go back here to hand crest I can if I
want to use this size matcher for
collections or the contains matter for
collections is that thing a collection
no it's not it's a string so at one time
there will be a bad error because we did
something that was not supposed to be
done but in the case of a sergej the
type of assertions that we can write
will only follow the particular type or
value that we have on the right side or
I mean on the left side so in this way
if you use code completion in the IDE it
can tell you which kind of things you
can do and moreover is that you can
continue chaining mortis one things I
can say is equal to hello test and I
call so third that the size is what we
decide six or ten eleven and that it
contains to is connect it contains two
also I can do more right instead of just
a single assertion one extra thing that
a sergej allows you to do is soft a
third or multiple assertions in one
block regardless if you use hangers or
not but in this way if I make another
third and call that will be two
different assertions right what happens
with the second assertion if the first
one fails will it be tested will it be
checked
no it's going to be skipped so we fail
we fix the difference problem then run
the test and now we get the error for
the second in case that is a problem now
with such assertions what can happen is
that you can make these two things this
these are as many methods as you want to
be emulated as a single block so it
could be the case that all of them fail
but all of them will be checked before
the whole method fails and at the end
this
sergej will tell you well out of the
five assertions that you wrote the first
and the third fail the other three are
fine
so that's an improvement what I like
about Arthur J is again the fluent API
design and you have multiple assertions
there is a little bit of history coming
here coming from an older project called
fast which came from swing which tells
you that the desktop still matters I'm a
desktop guy by the way and it is a spy
behind crest and it's actually sensible
here's another project called truth from
Google and this case looks almost the
same actually the same so what's the
difference the difference is that this
project is maintained by Google
developers it's an in-house project from
Google so if you like Google stuff true
is the the thing that you want to use
because it so happens that it gives you
a fluent interface design just like a
cirlce
it is inspired by fast because the guy
that created faith now works for Google
and it's supported by Google so there
you go
anybody here has used already the go
programming language all right
so go of the many things that he has it
also has capabilities for writing test
code and one of the things that they do
is it also gave you the ability to have
multiple checks and do not fail on the
first failure so there is a project
called Jago testing inspired by the
testing features found in Gil and what
you can do here this actually this is
code that I copy and pasted directly
from the the documentation is that first
we make use of a rule anybody here
familiar with j-unit rules also on you
basically what you're doing you're
decorating a test case you can decorate
it per method which is what this rule is
doing or you can decorate it by the
whole test case it's as a keen as
annotated and a static method with
before class and after class
all right so this is the before and
after the same thing this will with this
object will be active for every test
method that we have here
now what this thing is doing is that it
will give me access to a recording any
kind of messages that I want just
because or I can have multiple checks
also following and through an interface
design where I can use hang Chris
matters or I can use a surge a matches
or even the truth matches if I want to
but if any of these where to throw out
an exception then the rule that are in
decorates the whole test method will
grab that session and make the test fail
and if when of these fails both the
others do not then I will get a detailed
report of what actually fell so is kind
of the multiple assertions feature that
we found in the previous ones so it's a
matter of preference whether you like
fluent design or not yes questionable
yes this this they follow the same
j-unit format so this this thing is just
an extinction over how J uses will work
it doesn't wanna go to war them say it
kind of relies the same mechanism as
changing it so it's generally friendly
or any any reporting mechanism that is
specs J unit like errors will also work
with this yes so this is just a little
bit of a visual thing it doesn't really
change completely what's happening
underneath good question thank you so
that's basically it so if you know live
will go then this could be another way
to get started with a going back and
forth with in Java how are we doing so
far
because we only have cover at least four
versions of how you can make assertions
this is the easy thing now if we get
started with the real deal right so say
for example and that you need to test
out or have to write a client for a
rest-based API because almost everybody
has to work with a REST API now a code
could be server-side if you want to but
in this case I decided to make it a
desktop application with a game I'm a
desktop guy but also because if you are
on the desktop you have to take care
about concurrency issues because
everything that you do with you I must
happen in a very specific thread the UI
thread and anything that is not such a
square in a REST API RS endpoint must
happen outside the UI okay so the
application that I have and I tested the
network before joining so let's see if
this actually works I'm going to query
the github API and I say that there is a
chromatic speaker perhaps we go there is
so if the neighbor is alive and there is
an Griffin organization found on grid
phone and give up as you see yay we
works a list of repositories nice and if
I input something that is not is there a
teaching organization let's figure it up
there is no so there is an error okay
okay so this is basically the
application that I want to test out and
hitting the actual default service okay
I want you to take that into in mine so
that's basically what we're doing we
need to find a way to test this so we
need to find a way to test the if we are
consuming the data if we are processing
the JSON payload in the right way
without actually talking to the real
server we need to test out these
components without talking to you I and
we need to build something that tells
the whole application as a black box as
a functional test just like we do with
web applications with selenium or
webdriver there is a way to do this with
Java effects it will not concern right
now with our so the whole code is again
available WRL that we saw earlier but
this particular application will only
queries the rent the repositories
endpoint and if you issue that's the
location where you see the documentation
of the API and if you issue a red square
like that then you get some JSON payload
like this and this is one some of the
stuff that we need to do in order to
test this thing all right
so in order to build this application I
expect that given that we are in the
year 2017 that most people are aware of
what dependency injection is and when we
use it that we need some way to actually
query the data the network so we need
some kind of HTTP client but a wasting
money we use okay HTTP which works on
the desktop not only on Android thank
you for that so let's say that now that
we have built the application we have
several ways to test this thing and we
need we have some service imagine this a
simplified version of the bigquery
service I want to showcase how we can
parameterize some things just to test
this thing out I know that J you need
for allows you to parameterize this case
but it only allows you to parameterize
one method within this case or if you
have more test methods to the same test
case they have to have the same number
of arguments with the same types what J
unit
Bram's allows you to do is to perhaps
you need to parameterize different test
methods with different arguments with
different are cardinality and different
types you need to have a custom runner
apply to your test case and you may use
an annotation to supply the data
immediately or use an additional
argument you may supply the the method
that gives the that supplies the data or
you can also define class a private
class if you will that is also that also
works at the data provider and another
thing that you can look at is that the
test method now can take arguments so
for every iteration depending on the how
many data you have defined in your data
provider then this test method is going
to be invoked there is also another way
for you to change the method to change
the method name so that it may reflect
the actual values of all the inputs that
you take in in your test method and this
is friendly to the IDS as well so you
should see that are used to this also
see them in a standard g-unit report I
like this because it gives me more
flexibility for doing the
parameterization so the next one is
Nikita why would you like to use Paquito
because well again we are testing
different components and if we were to
test out directly to the real network or
if you're testing a database setting of
the database for a trivial unit test
will be definitely overkill so for that
what we do is we usually go with mocking
collaborators now in this particular
case now we're looking at some class
under test called a controller that will
make use of the service the service is
actually the class that we need to mock
out this a collaborator that we need to
fake now Makita works in this way we
create a mock of the particular type we
set it as a collaborator then we define
our expectations run the stimuli and
finally verify that
the class under test did the right thing
but also the expectations where fulfill
mojitos like a static DSL for defining
expectations so here with controller get
service this is the mock we say we're
going to block that method with such
arguments and if that were to happen we
expect some result we invoke the stimuli
right there and if the invocation is the
right one then we need to verify that
again that particular mark was in book
only one time when that method with that
particular argument in by some chance
the input were to be different here this
verification will be failed because that
invocation never happened so mojito
allows you to mock out three different
kind of objects if it's a stop it means
a very dump object when you simply say
giving some input here the a box if it's
a mock is a stricter which means given
the input here's the output but I also
expect and given number of times for
these invocations and I also expect
certain order of invocations it has a
different I've defined different
expectations if the order is different
or the cardinality of invocations is
different then there's going to be a
failure in the case of a stuff they
don't care about order they don't care
about cardinality and the final thing is
a spy
I Spy is a real object is a real class
where you want some of the real
production behavior but you need to fake
out some things for example if you want
to aim for a 100% code coverage there
may be some cases where you need to
handle an exception and pushing your
production code to trigger realization
may be tricky but if you have a spy and
then you say in this particular method
regardless of what happens I'm going to
throw out a null pointer exception then
let's see what happens in this case
that's the reason why you will need a
spy
and by the way mockito latest version is
2 8 9 it allows you to do something the
it used to be impossible not really
recommended but in some cases you might
need to do this you can mock out find
out classes yeah so and mojitos is used
by many people already the next one is
Chiquito funny name is the combination
of j-unit google juice and mojito so if
you're already using the unit and you
need some dependency injection if you
are using juice you should use this one
because the first thing is you can do
injections on the test case the second
is this sample service type that we're
seeing here is something that we expect
to come out of the dependency injection
container now is this thing a real deal
or is it a mock right we are calling
this thing expecting to be amok and now
he is called yukito so smart if you
provide a binding for a type like the
controller or the model then that type
is going to be the real one is going to
be the production type but if you do not
then that type is going to be an
automatic mark
created by mojito if that type we're to
be needed by more than two production
classes for your test case they're going
to have the same mark so again you're
leaving the dependency injection
container the job to properly inject all
the dependencies as needed so now this
simplifies things and I can do verify
now Yukito has also an additional way
for you has another annotation cut I
think is at all and you can define
multiple bindings for a matching type
and if you do this then you keto allows
you to parameterize the test case and
all the values are going to come
directly from the dependency injection
container so all the dependencies should
be resolved
that's basically the reason what I was
suppose I will suggest you stick you to
if you already use engaging it and
induce now so you said there's only a 1%
I said I use a spark so what is a spark
the Spock is basically at testing DSL is
written in groovy or a second don't run
away
groobie school it allows you to test
java code actually yes this is groovy
code is it looks at yeah a groovy but
the code and I'm testing this controller
class the model the service
these are Java classes the code that I
show the application everything you can
see on the repository everything is
written in Java
yet the test case can be written using a
spark DSL so what we're looking here is
okay so we have the class on the test
then we've got a different way to create
a mock a spark has its own way to create
marks inspired by mojito
then here's the stimuli block here's the
assertion block and then there's some
parameterization block so here's
interesting thing did you notice the
name code name what is that that is a
string then wait a string as a method
name with a species are you crazy
now the JVM allows you to have this job
of the language says I will restrict the
number of characters or the type of
characters that you can use those
identifiers okay
so groovy and the spark DSL gives you
back that capability to use any kind of
character so you can be very expressive
very verbose groovy has multi-line
strings if you want to write the
cravings of the going win the wind right
there you can do so I think there might
be a limit of 65k characters in the
identifier but you can still do it now
these things they look like placeholders
or variable placeholders with whenever
you iterate on a new map on this test
method these values these displace
holders will take on the
values another thing is that this looks
like a strings right so we expect that
to be a string and respect that to be a
string what is that is that the proper
way to compare strings yes this is what
we want to do but Java says no you
should not do this but groovy has
operator overloading so what is
happening under the covers is you expect
the byte code this is a call to the
equals method so this is doing the right
thing by your eyes about the JVM and the
Java language all right and this block
here okay that's just a boolean
comparison where the accession is an
implicit assertion why not is the blocks
given when then where the blocks are not
just playing labels they actually have
meaning in this block we do the setup in
this block is where we run the stimuli
in this block is where we got the
implicit assertions you can make them
explicit if you want to and in the web
block is when we do the parameterization
if you don't like this it's okay I got
another way as a matter of fact these
things can be initialized with any it
terrible like a result set like anything
that implements the table interface now
what character is that one the boolean
or isn't that per year but the Spock
says I'm gonna use it as a delimiter for
a column why no and here's my data table
so room the only thing that I changed
from one version to the other is how I
initialize the data and if you want
these things can come from many other
places
now the implicit assertion here with a
new feature
Spock 1 1 was released just three days
ago it has a new feature called verify
all which is multiple assertions just
like in a surgery so Spock gives you
parameterization like the unit params
gives you mocking like mockito
it also supports market stops and spice
it gives you multiple assertions like
Arthur J and it gives you the
capabilities to use operator overloading
because is groovy now one more thing I
guess I can show it here live
another feature why Spock is great it's
called the power asserts that code this
will receive you larger font all right
so let's say we have a map of strings
that looks like this yes we got we have
collection literals Java want so let's
put some keys here like Conference is
equal to box Ticino
okay and now we SPECT map conference to
be equal to box trick like this such
antrum such an fail aha see this is the
power search it will tell me on every
portion of the graph what value does he
have so the map is printed just exactly
like that and then accessing the key
conference gives me box Ticino this is
the value I need to compare the plain
string is just the plain string but the
whole emulation resulted into false so
you have a much complex graph in on the
other side you don't know it is
difficult to know exactly where things
fail but with a power third is right
there where exactly the problem is now I
believe because we use boxed here now
this one doesn't tell you but a Spock
will tell me also that I expected both
sexes Erick
but box Ticino was came so it will tell
me that the Chino and suruc are
different i will tell me that it will be
in friend in a 60% difference or so
because they only share the same box
space characters and the rest is
different
all right that's what I like spark
basically gives you the capabilities of
many other projects in one package plus
you can write a less curl be more
expressive if you go into idiomatic
groovy yet if you don't if you haven't
done any groovy before it's very easy to
get it started
these rename a dot Java file into dog
groovy and then use the groovy compiler
chances are that 99% of the times you're
going to it's going to work and there
will be no errors there's just a tiny
difference in the syntax within groovy
and Java and the upcoming version of
groovy 2/5 will support the lambda
expression syntax and the method
reference which right now we are not
able to do with the two-egg for serious
these being said all of you that raised
your hand and say I am a Java developer
you are now groovy developers just like
that all right
I said something about testing with
concurrency I already show in the answer
but when you need to test out concurrent
code and need to wait for an operation
to finish before you can continue what
do we usually do do we actually test
concurrent code to begin with because
it's hard yeah if we actually test and
currency code how do we do it usually we
put a thread asleep somewhere casually
interrupt session
give it some time out to 2,000
milliseconds 5 milliseconds how many
milliseconds we don't care as on with
some things right the problem with doing
this is that we may be waiting too long
and our test cases would take longer and
longer and longer right would it be
better if we have some way to
conditionally wait for something and
wait as little as possible this is
exactly what I wait til atte allow us to
do so for this particular test case this
is they're actually real code of the
application we are acquiring their
repositories we are using a mock right
there we invoke that method and we know
this method because this method talk
to somehow to the UI it has to run
outside of the UI thread we're issuing
and Network call so if I go directly and
do the assertions without waiting the
assertions might fail because the code
values might not be ready yet so we need
to wait we start with a wait here
then put some time up which otherwise
the test case might wait forever not
actually not the case the default
timeout is 10 seconds so give it a 2
second timeout and we wait until
something in this case it's a method
reference but that is just a callable
object j4 method references on Dundas
and here is a hand pressed matter but it
could be it could be again a hot surgery
or throat or something else right so if
this condition is met before this time
mount expires the test case continues
if the timeout expires then the hotel
cases wait something fail is taking too
long you have to check out what's going
on right there are hooks for using
groovy closures or scalloped functions
and not a year where if you can use
cuddling functions but there should be a
way to do this also with cuddling also
base is basically a DSL for defining
waiting conditions and process so that
you wait as little as possible it's
highly extensible as well all right
before I actually show the next one
because I know where I'm going
let me show again the application let's
kill the console and let's let's be
crazy let's turn up the Wi-Fi hopefully
it will work again now I'm going to
switch to is the same project and I'm
going to run all the test cases let's do
a clean and test and I know for a fact
that I have a functional test case that
will run the UI and go through the real
repository service and try to hit a
server would it be OK in my functional
test case to hit the gift shop server
the real one what if I have I don't have
any network will that turn out to be a
failed test right ok so the next step is
let's not use the real gift observer
because there are some great limits and
whatnot let's use another server
ah do I build that server on my own do I
fake out there gateway API in some way
for this test case for this application
I am sure that the server is running
before the test gate is run is that
server in the right state before I run
my test case how can assert all these
things would it be much better if I run
the server or just right before the test
case or even better what if I'm able to
embed the server directly on the test
case so I can control everything and I
can also provide certain expectations on
the type of requests that can be made
and the expected result responses given
those expectations so I'm going to run
the application and again remember no
network some unitive and there's a
functional test case and that's it
everything is green and here's the real
test case come on there we go there is
this project called wire mock and warm
up what it does is a fake HTTP server
that you can prime with aspect ations
and if those expectations have fulfilled
then your test code is green if not then
something might be wrong so let's see
the real curl here because I'm not
showing everything this is not the
project that I want to show but is this
one and the functional test case right
there in order to use wire mock you must
use a rule like this this starts the
fake HTTP server on that port
so any query that you do to
localhost:8080
will go to that server now because it's
a rule the server is going to be created
before the test method and it's going to
shut down after the destination now this
is the simple test case where we set
with the final expectations right there
we create my stuff for a get call that
matches that URL if that happens then
we're going to return a response with
200 content type JSON and some values
map as JSON do the click on the bottom
this is the test effect thing this is
similar to selenium before JavaFX so I
click on the button and then aspect I
click on the text field put some text
then click on the load button
something's happening in the background
thread remain this is the real
application so I need to wait for the
bottom state to change back again to
enable and then I can verify again from
the UI side that I have the expected
results if any of these fail means that
I did not contact the server with the
right information that I gave it the
wrong request and I didn't get the
expected response another thing that I
like to do when I'm actually doing
functional test cases in j-unit is that
I want the test cases to run in certain
order now this is wrong in unit test
cases but it's OK in integration and
functional there is an easy way to do
that apply the fix method order this is
a julienne extension and give it some
strategy so now the metals is going to
be invoking certain order and because I
say name ascending I use the trick off
using an underscore as a beginning
identifier for the test method I could
have used some other identify for as
long as I know for a fact that that's
going to be the excel order that I want
how are we doing so far so good
all right now I suppose that you all
most of you have to also work with web
applications you need to test them out
route so right now we just say we have
written a client for a REST API now
we have created our API we need to test
it well we need some kind of fake client
to test it depending on the test
framework of the production framework
that we chose is the type of testing
framework that we're going to use if you
were to use a spring and a spring boot
there is excellent support for in the
spring test for testing these things out
so you can do injection in the test
cases you can use the spring rest Docs
for testing the rest API but I'm going
to go with a different approach I'm not
going to use the rest spring here I'm
going to show a micro web framework
micro services approach which is a spark
Java and I'm also going to use a plain
old boring Java EE applications with
servlet API for that these are very
simple to do application are we going to
expose the behavior to a REST API or
also hTML is you want to create be a
browser with this we need also again
dependency injection not CDI just planes
dependency injection we need to map a
JSON because that's the kind of payload
that we need to output and we need to
handle persistence in the way if we want
our to dues to be remember let's see
before we jump into that one the
application is a to do application this
is a spark Java let me make a bit bigger
and let's run it a spark is now running
on board four five six seven which means
that's the one that's running ok then I
can do a curl into HTTP localhost 4 5 6
7 and I think is I believe is to deuce
mmm and if I give it a content type that
is not Jason H is I think is except no
counter type content you can tell that I
hardly write address API as I work on
the list of most of the time except
thank you
yes we got an HTTP expert here except
and that will be text HTML here we go
not found whoo why because I use I fail
but there we go see live lemma same data
as before all right so that tells me my
application is working nice so here's
how we can test it rest assure rest
assured if the name is upon it's kind of
a fake client is a very simple client
and what you do is similar to what we
did with wire mock you can have certain
expectations so we are going to connect
into port 4 5 6 7 because by default is
8080 all right so when we get a get call
with that particular path we expect the
body to have what is that that's just a
string but it looks like an expression
and we expect that to return a list of
something because the observer has
already some data in the database so
what you're looking here this expression
is actually something that we like to
call in groovy G path X path is for xml
g path is for an object graph because it
so happens that even though rest-assured
gives you a java-based API that you can
use internally it uses groovy as an
expression language so with this if we
look back into what the painter that was
returned on this side in the JSON
payload what does not the one come back
the other one this one had too many tabs
open yeah perhaps I should close this
one where the royai there so there is an
element that has to do and that contains
a list of other objects that each one of
them has a description ID and whatnot
right so this is the reason why we need
to ask for to do store description and
I'll return a list of all the matches
that's what we're seeing there you can
use hand quiz matchers you can use a
sergej again the reason why I started
with assertions sadly rest assure is not
HTTP to ready because it relies on
apache httpclient which is not it should
be - ready hopefully next version will
use oak HTTP or HTTPS opposed HTTP -
we'll see but for now we should be able
to test out any JSON or XML or HTML
payloads that's fine now the advantage
of using a spark is that if I show you
the test case let's open to do one and
the test case is this one starting a
spark is just like that the server is
there and before and before I start this
before a test method I start the server
after this method you should down the
server and there is your fake client
against your real REST API is it how do
we test Java EE applications does
anybody have a clue because Java EE
applications must run inside a container
isn't it any kind of application server
for that we have our Killian arquillian
allows you to set up the container and
it can work in three ways embedded so
the container is exactly inside the test
case just like we did with wire mock for
example or manage which means the
container is installed in the same
machine as you run in the test case and
what you're going to do during the
running on the test case you're going to
deploy the application there and finally
remote the server and when it's managed
we are also going to start the server
when running test case and it's in the
remote mode the server is already
running somewhere we are able to reach
out and we can deploy the test
application right there ok so the way
I'm showing here is the embedded
the easiest one and if you're using
maven is very easy to create the
deployment archive that is going to set
out to the are on the container if using
Gradle Amana Gradle fan then things a
little bit trickier and that's exactly
what I decided to show this thing
because maven is just a couple of lines
of code and as you get all the
dependencies in Gradle you need a way
uh no actually I'm showing the maven way
I'm going to show you the Grail way in a
way so maven just say resolver pass the
pom file perhaps resolve all the
dependencies you need with transitivity
because you need everything else you got
all the libraries that need to be inside
your web archive you can add as many
classes as you want in your packages
production classes you can add as many
assets XML HTML whatever it is needed
boom there is this in the case of Gradle
let me make it a bit bigger you need an
a different class called the embedded
Gradle importer which will only allow
you to grab the wrong time and compile
sign dependencies but you need some test
dependencies as well because I'm going
to test out this thing using rest assure
as well so I'm combining both maven
resolver and Gradle resolver to grab the
Jade unit and rest assured libraries so
there will be part also of the final
deployment so the list of files that you
see there are added as part of the
deployment now this is just setting up
the container test case how the actual
test kit looks like exactly the same as
before there's a reason to use rest
assured because it doesn't matter if
you're testing Java EE or spring or
spark Java or something else as long as
sub well-behaved web application rest
assure will always work the only
difference now will be how did you start
the application right so arquillian
allows you to test out in container of
plussing if you ever need to test out
PDF reports anybody here using just the
reports JP or something like that yeah
sometimes we need to test out that we
have
the right document PDF unit add your
service with this you can assert that
you got the right sections and
paragraphs and everything the next one
is that we also need to test out XML
someway right so we're generating XML
documents is there a way to make sure
that we are generating the right
document sure there's this thing called
XML unit and with XML this is a very old
test case for another project of mine
called JSON live where I was able to
translate JSON into JSON payloads into
XML and back so some JSON objects being
translated into XML an important thing
is this your stem from XML test case and
you gain access to new test methods such
as this one with this I can assert that
the two documents says semantically
correct so may perhaps some of the tags
are in different order in some perhaps
in your test case you don't care about
the order in some other task is the
order of the tax is the strict and you
must comply so you can do that too also
you can check in doing you can define
different checks when you came that when
you think that the test or the attack
order is important or is not alright so
that's basically it remember everything
is open source you can use it right away
easiest way for you to contribute to
open sources you find a problem just
report the bug if you can do more please
do so you can supply a test case you can
even try to fix the Box apply some code
discuss with your colleagues again bring
a frame next time just make sure that
the knowledge keeps spreading so I think
that pretty much out of time if you have
any questions I will very happy to
answer them and again thank you for
being here thank you for being again
another edition of box day stecchino you
guys are awesome this is the reason why
we do this thing is because of you thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>