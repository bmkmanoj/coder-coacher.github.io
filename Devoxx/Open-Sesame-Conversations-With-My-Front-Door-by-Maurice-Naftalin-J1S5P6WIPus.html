<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Open Sesame! Conversations With My Front Door by Maurice Naftalin | Coder Coacher - Coaching Coders</title><meta content="Open Sesame! Conversations With My Front Door by Maurice Naftalin - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Open Sesame! Conversations With My Front Door by Maurice Naftalin</b></h2><h5 class="post__date">2016-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/J1S5P6WIPus" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey good afternoon thank you for coming
to this talk and I'd like to thank the
organizers of DevOps for for making
making space for me even though it's a
half an hour and we're going to be
pushed for time but I what I want to
talk to you about today as well I want
to talk to about my front door now I'm
going to I'm going to go a bit off topic
because I've got some other things to
talk about and along those lines as well
so this is my front door this is me so
I'm going to rip to these sides because
within a half an hour we're going to be
really a bit push so I've written a
couple of books on Java and I'm a Java
champion and travel one rock star a few
times this is the first computer I used
I sometimes put this slide up not very
often but occasionally it's a long long
long time ago and this was but I thought
I thought it's pretty cool was I didn't
program it but I used it as part of his
attached to a spectrometer I had to work
on all night so I got an opportunity to
play computer games probably one of the
first people to have ever played
computer games in the 1970s it weren't
very good to tell you we've got 4k words
16-bit words in those days and about for
decades later a Java one in 2015 Oracle
made nice present to me of a Raspberry
Pi which like most people who get
raspberry PI's satham I left it sitting
on my desk for quite a long time
gathering dust and wondering what to do
with it so so what the I idea was this
eventually after after a while in the
winter I don't have so much work and so
I found myself kind of staring this
thing and thinking well what will I do
with it what I did with it what I
decided to do with it was to use it on
my house this is matt this is the street
i live on its it was it built in the
1780s as you can see and it's kind of
cool because it's got a mountain at the
end of it you can just see that mountain
there it from the from the mountain this
is what the street looks like and I live
in the 11 we're about where the science
has casey over there if this thing work
that's good roughly there this is a
picture in my front door or the front of
the house rather and the
and you can see that the at the front of
the house is decorated with these blue
signs you can see them both above the
door here and the blue these blue signs
indicate that it belongs to the
University of Edinburgh or rather than
most the flats hit belong to the
University of Edinburgh this is where I
live I kind of live inside the
university's aware and this is good
because this is very cool because they
mend the roof and mending the roof on
these tenements is pretty expensive and
they paint the windows and all that and
so you know it's not what's not to like
about this and the answer is well what
there is not to like about this is that
at the weekends under the evenings that
everyone goes home from the offices and
they and the place is deserted well
that's actually really good the upside
of that is I can make as much noise as I
want and nobody makes any noise to
disturb me they set my son and he's two
floors up on the other side of the
staircase but what happens when the
Amazon man comes to make his deliveries
so here he is disguises my lodger but
there you go did you get that
I know it's everybody's problem but it
but it didn't make me think about it a
bit though please get back again um see
if I can just about good oh oh it's true
that way about sea life very complicated
right so um so what are we so what am I
going to do about this I'm going to use
the Raspberry Pi so so here's the agenda
I'm going to make a groovy door opener
and then we're going to see about
phoning it and then we're going to see
about a controller I control the fire as
well here's the entry phone system the
flats were built in the 1780s and it
looks like the empty phone system was
built not long afterwards the the the
the idea is well it's kind of standard
standard sort of thing where the
somebody speaks into the presses the
buzzer speaks into the into the
microphone there I hear it in the flat
on the right hand side here we've got
the we've got the income my end in the
flat and in due course I i press the
button and and that operates the
solenoid at the door there and that's
the min so after a while I was inspired
enough to take off the front of the the
front of the intercom and this is what I
saw behind it's just some 12 volt wiring
and there's a couple of terminals there
which turn out that when you short them
opens are what opens a solenoid so the
connection between the Raspberry Pi in
the front door is exactly that if I just
can short those two terminals out then I
can open the front door how do you do
that with the raspberry pi will it's
really straightforward it turns out not
to me I'm not a hardware guy I'm very
much not a hardware guy solo I went
through a lot of different iterations
and eventually a couple of raspberry
PI's because the GPIO controller on the
chip is not protected against excess
voltage you make a little mistake 5
volts instead of 3.3 volts does anybody
want some nearly new raspberry PI's with
they work almost completely so so it's
it's hardware 101 you'll find it in the
raspberry know any good cookbook
about raspberry pie recipes the this
thing here is a MOSFET it costs just a
couple of euros or less if you if you if
you buy them singly and all that you
need to do it just amplifies the voltage
from the GPIO pin to the Raspberry Pi
these are the GPIO pins in this
schematic and all you need to do is just
raise the the voltage on one of these
pins to to 3.3 volts and then they this
will open the gate on the on the on the
the MOSFET which is a power device it's
very it's very robust you don't you
don't blow those out and that will let
the current pass through and open the
solenoid and that's about the story for
the hardware it's really not very
complicated at all I've got it simulated
in this for this talk in a little bread
board here with the with the buzzer
attached it which sometimes works so I'm
afraid I took the slide with the picture
out so you'll just have to take it from
me if you hear the buzzer going then
that's the proxy in this talk for the
door opening it will really work the
same way so how do you get that to
happen and on the PI well if you're a
Java person you'll use Java thorac
there's a kit for the Java software kit
for the for the Raspberry Pi called pi
phi j which is really easy to install
and actually works really well and and
one of the examples in it is actually
manipulate to the GPIO here's what it
looks like when I've when I used it I've
changed it around a little bit so the
stuff in bold just shows that I'm that
I've made it possible unlike in the
light of the original to just to have it
sound more than once or to have the have
the pin go high more than once so that
you can tell it so they can change it
during the talk and you can tell the
fact that I haven't just pre programmed
everything so that's that's the Java
that we're going to be running and this
is really that's really the story as far
as as far as getting the the Raspberry
Pi to operate the front door is
concerned so you may you may wonder like
I got through that pretty quickly but
we've got we've got to make that we've
got to get the Raspberry Pi to work and
I
got to get my delivery man to talk to
that and that's a bit more of a bit more
of a push so the next part is then how
is he going to phone the Raspberry Pi
well why does he want to phone the
Raspberry Pi I thought about different
user interfaces to this well you mean
the obvious thing to have would be a
mobile app that's what people usually
use nowadays but I can't really expect I
can't really expect him to have it
installed on his phone I could put a web
page up and maybe have a QR code on the
on the front door but that again that's
a lot of hassle so I thought well but
the one thing that everybody carries
around as a phone and the one thing that
everybody can do is speak into the phone
and I thought of actually using keyed
codes the DTMF the codes that that you
operate through the the buttons on your
phone but I thought that was going to be
too easy actually that's that's what I'm
going to demonstrate today but for the
for the original what I decided to do
was the whole hog and use voice
recognition so there is a voice
recognition in this demo but it's not in
this talk but it's not quite there it's
not in that place so how are you going
to get how you're going to have the
Raspberry Pi be operated by the phone
well you're going to need private branch
exchange software on the phone so there
is actually a free a free open-source
private branch exchange software called
asterisk and it and it actually works on
linux and therefore it does actually
work on the Raspberry Pi there are a few
problems about it so is not not that
it's not extremely capable and in fact
it's in very widespread commercial use
the problem about it is that it's it
exists in very many versions it falls
really quickly the documentation doesn't
owe it often doesn't indicate what
version it's on the documentation
assumes you know a lot about voice over
IP there's there are many parts of
asterisk which you'd really like to use
which turn out not to be free because
the company that the company that is
responsible for writing and maintaining
asterisk but most of the work also makes
its living from consultancy so you can
see where that's headed I tried using
something called freepbx I'm mentioning
this because you might go down the same
row
it's a web-based open source GUI manager
for asterisk but but you find out after
you've been using quite short time that
many of the management modules are
commercial and quite expensive so that
turns out not to be such a great idea
there's a Debian package for asterisk
but it's out of date I so you're down to
installing it from source and in fact I
found for nearly everything I was doing
for this for this project that
installing from source almost always was
the thing you needed to do so you saw
some source and the confetti in a fairly
standard way once you can find the
source it's not it's not too difficult
now you have to script asterisk to make
it do the thing you want so my idea is
not just that my delivery man is going
to be able to simply telephone the
Raspberry Pi he's going to have to have
some some level of secrets have to have
some level of security because because
we're interested in because what we want
is to make sure the door isn't going to
open for just anybody so I think I mr.
so asterisk contains everything you need
but the problem about it is that the
learning curve for asterisk is steep and
it's long and it and you will it has
very very meant many built-in operations
but actually learning how to use them as
really tough some of the products that
speech recognition modules which which
we're going to want for this aren't free
the documentation isn't great there are
a lot of different versions and the
dialplan scripting language the dialplan
is the script that actually drives the
application is really terrible I'm
actually going to stop it should have
done the demonstration a little earlier
on but I'm because keynote isn't working
quite the right way I'm going to I'm
going to do I'm going to do a little
demonstration now just to see whether we
can make sure that really i have got
groovy and java working in it because
and it'll also give me the opportunity
which i'm dying to do to show you to
show you the dialplan so first of all
i'm going to connect to the PI and i'm
going to and i'm just going to find a
groovy script to run to run that jut to
run that java program is that is that
visible is the font big enough
for the people at the back okay so um
let me go I'm going to go to where we're
peifer peifer JS installed and I'm going
to and I'm going to really let's have a
quick look at the at the what we're
going to run so i can i can look at my
gpio example this is this is the one
that this is one that I just showed you
an extract of so so here is that here's
the the the the basic java code that is
going to act that we're going to run
here but i want to but i want to run it
from groovy and the reason i want to run
it from groovy is because the dark I'm
scripting language is so awful I want an
alternative and it just feels to me like
I'm going to be evolving this thing on
the pie and that's scripting language is
going to be suitable for the kind of
quick iterations I want to make too I
want to make to the code so let's have a
good so the groovy code that I'll need
to to run this isn't really very
complicated in this case in this case
all I need to do is basically just call
the main method of that of that java
class so if that works and you can see
that it should sound the buzz of three
times if it's if everything was working
which doesn't always happen in these
damn in these talks so to do that i'll
i'll run better run I have to run it a
pseudo because everything that you do
with the pie needs to be you need to
have root access and I'll just need to
bring in the the pie for j libraries and
that should do it run ok so if you
should run through it should sound three
times the buzzer
I'm a happy man well for the moment okay
so um right but we're not we're not
we're not out of the woods yet I'm
afraid this we've got much much more
complicated things to to do yet so here
I've got i'm going to show you the the
dialplan because i'm a sadist pseudo VI
/ etc / asterisk asterisk asterisk /
extensions comp this is what it looks
like and you can see that this is not
something what's really awful about this
and there's a scripting language what's
really awful about this is it doesn't
have any control it's a mini control
constructs so actually I mean writing
loops in this is going to be really
really difficult and you can see that
there's you can see that it's really
it's like writing assembler an elaborate
script in this is going to be pretty
horrible that's why I decided to go over
to groovy okay so i think i go i think i
can go back to this now i'm just going
to try if I can do to just swap the two
exchanged the displays mmm doesn't look
like i can do that's it rage now okay
right not while not worried about that
so I'm going to use so I'm going to use
a i'm going to use another I know that's
better right I think I should be able to
make this work now
okay Oh yet okay good well but we'll be
good okay so so i'm going to use groovy
i'm going to asterisk java has a as a
way is a library for accessing java from
from from from inside of asterisk it
supports something called fast AGI not a
GI did I miss a slide out here now so so
there's the difference between fast AGI
and AG is that one of them is a one of
them is a client server solution fast
AGI AGI is like the old fashioned CGI
web gateway that we used to have a
million years ago we're in order to in
order to service every single user
request a fresh process is started so
fast AG eyes are much better much better
idea it runs on a free-standing server
which you have to start separately with
code like this that's pretty
straightforward and then there's a kind
of complicated business where somewhere
a piece of code like this in the
dialplan what's what this code that's
shown on the dial on there is its
dispatched to the e to the AGI server
the AGI server looks the properties file
to find out what's what how it should
run that it goes to it goes to a script
and the idea the the the groovy script
is to is to act as a acts as a gateway
to the to your java to your to your
groovy so the groovy AGI script acts as
a gateway to your custom to your custom
script in my case in my case it's run
gpio example not groovy and that gets
sent via the via the groovy AGI script
with the important thing is that what's
passed in is the AGI channel and the AGI
channel is the representation of
asterisks is asterisks representation of
the call so it includes things like for
example the number that's been called
from and the protocols that have been
used to get in and all that sort of
thing
so now inside of the groovy script at
the bottom right I now have access to
everything that the distress cars and so
now I'm actually ready I'm actually
ready to make the calls so that's so
that's that's my that's as a story here
the the dialplan I can now write the
dialplan in groovy and the dialplan
looks like this it's pretty
straightforward when when I tried to
this this this is the straightforward
summary of it when i was using voice
recognition so the idea was i'm going to
i'm going to get the i'm going to ask
the user for the further for the code
that they're going to use to get in the
access code i'm going to i'm going to
record it i'm going to convert it into a
format that my voice recognition service
can understand because i'm using a i'm
using an offline on online voice
recognition service i'm actually using
the IBM Watson voice recognition service
though others would do and then I'm
going to I'm going to try and recognize
it let's see how that works if we can
mfi can actually make that work so so
we'll go back to so we'll go back here I
need to start asterisk up I've got a bit
taken by where's my where am I I've lost
my kit so I've lost my cursor okay so
one thing I could do it is mirror this
could know it's not my day key demos
I don't get
sorry
am I on there nope still not on machine
trouble beg your pardon the demo gods
are not with me today and time is not on
my side got it ok so I'm going to start
up I've been startup the server and go
to go to the PI startup the server I'll
go to the pie here as well and startup
asterisk so this is the server going
have to unfortunately I have to have to
restart asterisk because it starts up
with the wrong foot with the wrong
parameters here so now we'll start I'm
starting at asterisk and and I'm just
going to I'm going to go to the I'm
going to go to the to the dialplan just
check that it's looking at the right
thing so it's that's right so it's cuz
it's got a script called Open Sesame not
groovy here which is the one that I'm
expecting is going to is the one that is
going to expect voice recognition so in
here we're going to see what what the
what voice recognition makes of what I
say so I need I need a phone to be able
to gather this so so the phone i'm using
is for the moment as a softphone on the
on the on the mac it's not that's
obviously not an ideal solution because
i'm not going to expect my my delivery
man to be able to get in and use the use
of phone inside so i'm going to have to
find a solution to that as well but for
the moment let's let's use a soft phone
and see it see how that works I've got a
user here called DevOps and i'm going to
try calling this and i'm going to see
whether or not i can actually get
whether i can manage to stay the code i
need the code i need is to 1346 it's
hard coded in
but we'll do something better in a
little while please fill your entry code
now 2 1 3 4 6 i'm hoping something to
work because that it'll spoil my last
demo if it does so at the top here we
should be we should see what the what
the voice recognition service made of it
I hope it worked unfortunately that's
just such a pain right so so the voice
recognition actually did dis succeed in
in fact and finding it Oh actually sorry
I mean I missed I missed where the where
the voice recognition went I went out to
Watson I did the rest api call to the
Watson speech recognition service and my
two 1346 I spoke got sent back as text
and I translated that into digits and
and the and the result was that it
matched the it matched the stored value
you could have obviously different
stored values for different people with
different expiration dates and different
numbers of times they could be used and
all that sort of thing so we've got
plenty of scope for a web interface for
that and lots of insecurities but at the
moment it's just hard coded in so so the
voice recognition has improved since i
was using this before i have to say i
used to have a lot of trouble in in
demos with that my my basic conclusion
was that what you should really do in
these situations is use DTMF and DTMF
it's actually a much it much easier and
more reliable I will use that in the
next next demo so so then so you might
be wondering what on earth is the use of
this from the delivery when my delivery
man obviously can't get into the can't
get into the flat to use the soft phone
and and the answer to that question is
that I what I'd really what I really
want to do is I'm going to use I'm going
to get in from the from the public
switched Network I can't get him from
the public switched network when I'm in
Belgium because I can't manage to get a
sim card for my USB modem that has
international roaming so amount of luck
there but in the UK when I give this
talk I can phone it from my mobile well
that's that's just the way the way it
goes so the last part of the talk men
crammed into the remaining five minutes
is let's take this a little bit further
and do something more with it because
natural language processing is now the
big deal and rather than just having
this stupid dialogue weather weather can
wear the pie just ask for it just asks
for your your code what would be a lot
nicer would be to actually do something
do something kind of have extend the
system and make it a lot more
intelligent natural language processing
is a big deal nowadays machine
translation spam filters healthcare
diagnosis NSA spying there's just no
limit applicated the number of
applications and conversational systems
that are based on it include chat BOTS
and virtual assistance in the form of
the things like Siri and so forth and
now really becoming big and of course
home control systems based on them and
so you might have seen about Google home
and Amazon echo and there's a lot more
of that kind of thing to come IBM Watson
is something along these lines is it
combines conversation and information
retrieval it's two different things
combined in the same one where if anyone
was in on the talk earlier on this
afternoon here you had like three hours
of real detail about IBM Watson and I'm
the conversation feature which I
couldn't begin to come near to it uses
domain knowledge for for specific
industries it's obviously targeted at
specific industries and and it's quite
it's really elaborate answers come with
confidence estimates and it's exposed in
the bluemix framework so we're going to
have it we're going to see I've got I've
got here a little somewhere I have a
Watson dialogue conversation dialogue so
if I and I can actually try it out in
text here i'm online to it so it
announces hello i am the number 18
control system what can I do for you and
I say I want you to play some play some
music for me Oh can't see the screen
thank you right really worth knowing
thank you how's that any better good ok
so I said so so I I'll start again from
the I'll start again
from the clear so I'm going to start a
conversation with it and you can see the
box it's outlined in green there is the
one that is one that is currently in use
that's the that's the current dialogue
node and I say I want to play some music
and if I say play music it will make its
way through that through the system and
it said oh like plays it plays a synonym
for turn on in my system and the
appliance it found was the music player
so it says what kind of music and I say
I like some jazz and it says okay I'm
playing jazz for you and that and I've
got a node there which does that
actually I'm sort of most of the way
towards being able to control the sonar
system in my flats that's not totally
imaginary now let's see whether we can
get this thing to to actually work open
the front door for us in real life that
would be quite nice or in real buzzer it
in real buzzer life anyway so the I'm
going to need to use a different script
for this this is it's called
conversation groovy because it because
this one sense to the since the Amazon
system and it doesn't use my voice but
it uses a synthesized voice with text to
speech from the from the it bends down
textron it from the from the service
from Watson service and synthesize it
using using a kind of fairly primitive
voice synthesizer on the on the
Raspberry Pi so you'll hear you'll hear
what that sounds like I hope well it'll
yeah you will hear what it sounds like
run through the soft phone so I think
we're good to go with that see what
happens hello i am the number 18 control
system what can i do for you open
please choose something I can control
the front door the music player or the
heating system the front door
I'm sorry I didn't understand me that
please try again well you have seen it
what ya see dat work already and I'm
afraid amount of time there though I
don't know I don't know why it didn't
work in that case what what did it make
of the front alright it got the front
dog I've really brilliant why is the
matter with you so I so what I would
like to do before up before I finish
because I'm because I'm out of time it's
just very quickly show you how this
works when everything when everything
really does go well because it's kind of
cool so we just this is this is
definitely what we hit what we're headed
for
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>