<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Containerless in the cloud with AWS Lambda by Ryan Cuprak | Coder Coacher - Coaching Coders</title><meta content="Containerless in the cloud with AWS Lambda by Ryan Cuprak - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Devoxx/">Devoxx</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Containerless in the cloud with AWS Lambda by Ryan Cuprak</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RES_QaRdgh0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this presentation was going to be
talking about going container less and
also serverless in the cloud so for
probably the last 20 years this is how
we've developed our large-scale
applications we've written code and
we've deployed them to a container like
Oracle WebLogic glassfish Tomcat resin
etc the containers provide a large
degree functionality that we're using in
the security monitoring resource
management transaction management
database pooling etc and a host of other
features and depending upon what
ecosystem you are in if you're a Java
developer you're using one of the job of
containers if you're over in the
Microsoft line you're using their
technologies this is how you've you've
you've picked your container you've
picked your development tools and
developed your applications on top of
that and also handle deployment of the
application so if we look at you know
taking those traditional container
applications and moving them up onto up
on up into the cloud what you typically
have done is requested in the ec2
instance set up your you know Java EE
container up there in the cloud set up
your JMS server etc and this is how
you've you know moved the traditional
applications up into the cloud and how
you may have approached applications in
the past and as well as will c lambda
kind of changes us in terms of how you
can develop their applications now
containers as being a weblogic java ee
even if you're developing PHP they lock
you into a language so if you pick if
you pick a Java EE container of course
locked into developing using Java or one
of the other languages on the Java
platform a specific tool chain for
example if you're working with websphere
you might set along you know the via
WebSphere studio for doing your
development with the tool chain and you
also have complete lock in on locking in
the ecosystem which means if you pick
Java or PHP are one of the different
languages it locks you in in terms of
which tools that you can use for
developing your application so after
there's a really cool JavaScript library
you're developing in Java you really
can't use it so this has been this has
been one of the things with containers
and their lock ins
now in terms of container drawbacks kind
of building upon that for many types of
applications are overkill it is hard to
automatically scale an application so
you develop your application you deploy
it deploy it up to the cloud or on your
own servers and suddenly the application
takes off you've got you know millions
of users of your mobile phone
application now you're going to actually
have to stamp out additional instances
of that application on multiple servers
which may not have been designed to do
initially may be very hard to do many of
the containers have complex programming
models which requires significant skills
investment in terms of knowledge of
security configuration and also the
technology stack so there's you know
four containers there's a heavy
investment that you have to make in
order to develop upon them you can't
just take somebody that's been
developing PHP applications have them
switch over and start writing Java EE
applications easily and the same thing
goes for fun nodejs you know you pick
your picture you tool chain your tools
and your technology stack and you get
what goes with it in addition with
container in addition with containers
you have to provision servers sort of
possibly sort of data centers if you're
not you're not using a cloud provider
for doing that purchase software for
that you know if you're using one of the
commercial containers you decide to
scale will suddenly have to go out and
go she ate more licenses monitoring
tools to keep track of what's going on
up in the cloud test environments have
to be set up IT support service
contracts depending upon if you're using
commercial vendors for software then you
have to deal with data replication and
policies you know there's a certain data
that cannot leave the EU certain data
cannot leave the United States etc so
you have to take those things into
consideration as you're building your
application and then also take into
account you know requesting approvals
for all of this right if you're in a
large organization so developing the
traditional approach with containers is
very that it requires a heavy upfront
investment in order to get up and
running and as well see lamba kind of
turns this on its head so the challenge
with the containers approach
I would challenge you to try to write
you know basically in a weekend a you
know a lot an application that does
registration and authentication using
OAuth going against like Google and
Facebook support to HTTPS which is going
to be an end endeavor in and of itself
to set up uses SMS notifications for
notifying their use of your users of
like if they forgotten their passwords
supports restful endpoints for
developing mobile applications
automatically scales globally so that
you can deploy your application around
the world and you don't have to handle
it separately and in and you can do it
from from wherever you're based native
iOS and Android support in terms of
being able to generate bindings for your
application easily so you don't have to
hand code everything and then handling
versioning from the get-go you know
being able to version your API so as the
applications out there for a while they
roll out a new version you have some
mechanism of handling and also real-time
monitoring so if you've got a great idea
just yourself and you want to try
getting it off the ground so these are
going to be your hurdles for developing
and deploying your application it
requires a heavy upfront investment in
infrastructure in order to get up and
running so with that being said with the
drawbacks of containers what is Amazon
lambda so if we look at before I'd
exactly define it basically the history
of services in the cloud we started off
with infrastructure as a service in the
cloud being amazon in your different
hosting providers allowing you to easily
request VMs up in the cloud and deploy
them and run them platform as a service
not being like the Google App Engine
Heroku Red Hat openshift being able to
put you know develop applications up
their software as a service being Google
being sorry Salesforce Dropbox iCloud
etc and then finally the last one which
is where Amazon lambda comes in which is
a function as a service being able to
just deploy a block of code up there in
the cloud without actually carrying a
provisioning machine setting up
environment etc just being able to push
a function up there and run it in the
cloud so that's basically what Amazon
lambda it so it's basically a natural
progression you know we went from
getting hardware and VMS in the clouds
through software in the cloud now we're
finally to the point where we can just
apply and execute functions up in the
clouds and have it take advantage of a
large ecosystem so in the ideal world
with Amazon lambda what it allows us to
do is to write code easily deploy and
run it in the cloud without anything in
between although you know this is a
gross simplification it makes makes
deploying code you know you don't have
to seek approval is you don't have to
deploy app servers you know in order to
run hello world right it's you know
we'll see here I'm actually to run a
hello world application probably less
than a minute in the cloud so what is
Amazon lambda M lambda not to be
confused with Java Web is a stateless
function that you're right it executes
in response to an event it executed an
isolated environment up in the cloud
which may or may not be reused and it
can be implemented in one of several
languages that being JavaScript Java
Python or C sharp you can include
dependencies such as external jars
native code with it you see as C++
binary etc can be packaged with your
library and this is one of the
interesting benefits of lambda is that
you don't have language locking right
you can take a heterogeneous group of
developers and throw them out of a
building an application up in the cloud
and some you know you can implement part
of it in JavaScript part of it in Java
you can use whatever piece whatever
language or tools that makes most sense
for that part of the application or for
the skill set of the developers that you
have so if you have a mixture of nodejs
developers and java developers you know
they can they can work on the same
application you don't have to retrain
everybody or you know pick you know one
technology for the applique pick one one
language or toolset for the entire
application so it's really I think a
fundamental shift you're not getting
lock-in in terms of the platform that
you're developing for anymore and
although I'm talking specifically about
Amazon lambda today the other cloud
providers have Microsoft and Google both
have their own variants of Amazon lambda
with varying levels of functionality
similar to what I will be talking about
so the example hello world function so
this is I'm starting off in JavaScript
just because I can run it quickly up in
the cloud so we have our function that
we're going to deploy to the cloud so we
have export handler equals function and
we return back basically we print a
message vacuum hello devoxx UK do at
devoxx us answer the event is the data
that is passed to the function this is
converted to JSON forest in the case of
JavaScript and Java landed will actually
convert it to a Java object using the
Jackson Jason library and then the
context is a lambda runtime which we can
and then introspect getting information
from the environment such as environment
variables the loggers etc so there's a
number of things we'll see that in a
couple of slides that can we can get
access to through that so that's simple
one more complex one in this case I'm
actually receiving an event adjacent
object and then printing out the message
that comes across and that's the JSON
that I'm passing in so with that I'm
actually going to go over and run the
hello world
copy my code
click on Amazon lambda now if you're not
familiar with AWS or haven't used it
before anyone can actually request an
AWS account it's not limited you don't
have to sign the contract your employer
doesn't have to create an account for
you can actually if you have an amazon
account you can go over there login and
be up and running and have the code
running about the same amount of time
that it will take me to do this so I log
into the Amazon dashboard and I want to
deploy some quote codes to the cloud so
I click on create a lambda function oh
sorry that is interesting I thought it
was mirroring my screen
okay so I i will go back so I log into
amazon AWS find lambda among the
different services that they provide
great in so now i'm going to create a
lamb deploy my lambda function to the
clouds i create great lambda i'm going
to click pick a blank function click
Next go over that later
pick that it's a nodejs so from this
drop down here we can select which
language we want to deploy it's in the
app paste in the code yes I just copy
and pasted the code in there yep yes
there is an upload function so when I go
over the job example of actually pre
deployed code to an s3 bucket already so
yes this is the simplest way of doing
where you can just paste the code in
there now if you're writing a pulley you
know more functional function you
probably upload it as a zip file with
external ear other nodejs dependencies
or your additional java jar files okay
so we can select down here we could keep
it as index handler the role sting role
which is an existing lambda rolling log
over what this means in a little bit
click Next it tells us that we're going
to execute with 128 megabytes of memory
we have a timeout oh I think that the
three milliseconds and that we're not
taking part of in the VPC so we could
actually execute our land the function
within a virtual private cloud if we
wanted to click create on the function
and then it's actually up there running
on the cloud so now we can take and we
can test this function you'll have
anything this function doesn't take
anything save and test it and you can
see executed or code and return the
response back so this is just a simple
hello world of course but it was you
know fairly trivial to write the code
and actually deploy we've got
information about our execution
environment how many milliseconds so we
were built for 100 milliseconds of time
it only used up 16 megabytes of memory
so we could actually optimize this and
reduce the amount of memory that we're
requesting for it okay and we've got
several different things here we can you
know just the configuration go back and
read just configuration for it we can go
look at monitoring you know how many
times was invoked how long did it take
to invoke it so we've got complete
monitoring of it we can also go over to
cloud watch and look at any log any logs
that were generated for it as well okay
so that's a simple hello world took me
all of what about a minute to deploy and
write if you were working with the
traditional app server you wanted to do
something like that with tomcat it would
take you a little bit longer because
you'd have to write the code deployed
for war file startup the container
deploy it etc so all of that's been
taken care of for us okay so now in
terms of lambda pricing of the first
things you notice on the previous slide
it told us how much we were being billed
for the first they have what's called
the free tier and the first 1 million
requests are free so if you write an
application on your weekend and your
application doesn't take off you know
you're not on the hook for lots of money
you know if it takes off you build that
twenty cents for each million requests
thereafter and all of my
experimentations personally outside of
work I've never you know eaten them you
know I've never even exceeded the first
million requests yet and while I'm doing
this presentation please don't start
painting my code and write a nice little
loop that's my fear every time I give
this talk we charge for duration which
is even know what that is the very small
number for each gigabyte second that's
used so the free tier to give you some
idea starts out there's this matrix of
memory versus the amount of time that it
takes to execute and then you have your
costs down below now this is very
abstract on the next slide there's
actually a service that goes out there
that you can actually you know punch in
some numbers and get some idea about how
much is it going to cost so assuming
that you blasted through the free tier
the first million requests if you had 50
50 thousand requests you actually used
up 128 megabytes of memory and the
execution time which was one second
which is how we only executed and 10
milliseconds you'd be on the hook for 11
cents right so you know up the cost of a
soda back in the 1960s so it's you know
very very cost effective in order to get
up and running so you know as you're
developing an application deploying it
this way there's a really low penalty
you're not you know requesting VMs and
software to get it up and running in
terms of lambda basics security is
provided by Identity and Access
Management which is could be
completely separate presentation which
is very involved so you have
fine-grained control over who can access
it and write code board will go over it
will tie I'm going to tie it into the
Amazon cognito and how you tie into like
login through google and facebook etc
lambda functions can start threads and
ask access the disks disk and access
other AWS services as well so you can
fire up threads that execute in the
background that then return the default
right now they have a default safety
threshold of a hundred concurrent
executions / regions there's a simple
form that go into increase to request
above that that is just in case you have
some code that kind of runs amok and you
don't want to end up with the you know
after somebody writes a forward loop you
don't want to end up you know a large
bill and as I mentioned before external
libraries can be bundled up as a zipper
/ jar file with your function when you
deploy your execution environment I'm a
little slightly dead it dated right now
there's no jas four point three point
two current version of course is 610
Java right now is using Java 8 which is
the OpenJDK not the Oracle down about
the official Oracle version python 2.7
and then for.net it is one point 01 so
things tend to lag a little bit up on
especially for node.js quite a bit in
terms of the most recent versions of the
technologies the library is available in
it each execution environment so they
already have pre deployed for you the
AWS sdk for JavaScript or Python and
then AWS build of opened pumpin JDK if
you're using any of the Java 8 p is for
AWS you'll actually have to bundle this
java jar files for amazon with your java
x your java function the execution
environment now why would you care about
this so this is the am i so you can
actually go out there you can instant
you can fire up this am I in an ec2
instance has a specific linux kernel
version and the 64 bit this is only
important if you need to compile code
and you're including c++ code with your
lamb the function so this allows you to
kind of go out there
try try those executables on on that or
compile them against that specific
version if you have some native code
that you're working with so it allows
you to work with that in terms of the
environment variables that gets passed
in so as I mentioned before there's this
context object which has a bunch of
information with it one of the things
you do have access to is environment
variables which will tell you a bunch of
things about the machine machine that
you're running on for example you know
what AWS region are you executing in the
path path variable like the LD library
variables some security information your
access key access key ID your log stream
so it gives you a bunch of basic
information about the environment that
in which you're executed and you can of
course work this and there's examples
out there where people have tried to
collect as much information about the
environment in which you're executing
moving on to versioning now lambda
functions our versions for each time you
deploy a function it's basically
designed a version on the current
version that you have deployed is dollar
sign latest a little background
everything up in the up in the world
there's this amazon resource number
which uniquely identifies an amazon
resource and as you work with lambda R
AWS you'll end up tasting these things
all over the place there's a
fully-qualified which includes the
version an unqualified which does not
include the version newer versions of
your function must must be explicitly
published so this allows you to you know
create different versions of your Amazon
lamp your Amazon lambda function and
deploy them logging which is incredibly
important with Amazon lambda one of the
challenges is that you can actually
debug it so there's no way from an IDE
to actually connect n to the bucket
execute so fast that they go away so the
only way to really troubleshooting
amazon lambda function is actually to go
v it is to use logging basically your
you know system dot out dot print lines
from the java rule or counsel that log
from the javascript world so nodejs
console dot log
got air warning etc info which writes
out and you can read those logs over in
cloud watch for Java they have an
archaic version of log4j that's included
system mountain system error both go via
they have also have a custom offender
which is sending things over to cloud
watch and so you can either use the
log4j or just system that up that system
that air which will go which will end up
in the logs for c-sharp they've got
council right right line etc and you
also have lambda dot log which you
access to be of a context object and
then python which have not actually used
their logger functions in the logger
module that would so this is your
primary way of getting information out
of your amazon lambda function anything
is you can actually write a lambda
function that actually watches the cloud
watch logs and you know processes you
know what's going on there so you
actually write a lambda function that's
monitoring your logs as a part of it and
then this is what it looks like over in
cloud watch you can see you know basic
information about the start time you
know what was returned etc how long it
was billed for and all the other
information that so that all ends up in
cloud watch now handling failures and
errors because of course things will
fail lambda function can fail for right
of reasons one is it doesn't complete
before the time limit I'll kind of get
that kind of feed into where you know
lambda is appropriate versus not
appropriate obviously it's not
appropriate for long running tasks one
want to have something that's doing you
know report generation using lambda
where it might take a couple of minutes
to generate a report that would not
probably be an ideal use of Amazon
lambda the input data fails to parse or
it runs out of memory so one of those
three cases will fail your lambda
function or you can fail it and code
wise as well the failure handling
depends upon how it was invoked so
there's two different ways of invoking a
lambda function there's either a non
stream base which is synchronous like
coming via the API gateway basically a
web service call coming in and generally
in that case a 429 is returned and the
client is responsible for retrying and
calling the lambda function
again and then there's a synchronous
which the infrastructure will try we try
try twice with a time delay and then
dump it eventually into the dead-letter
queue some more and then for
stream-based it will attempt to
reprocess until the succeeds to process
the data or the data expires and until
that happens known records will actually
be processed so that's error handling
now in terms of availability lambda is
not available everywhere so depending
upon where you're trying to deploy it
can factor in there so obviously it's
not available yet on government cloud I
don't know whether you know when they
plan to roll it out to all of the
regions but generally for the US that's
pretty much everything here is covered
and just because it's not available in a
region doesn't mean the service do you
can't right people from that region
can't call lambda functions so it's
available in most locations and they're
constantly updating and rolling out new
locations with that now resource limits
so for accessing the disk you have a
disk capacity limit of for the temp
space of 112 megabytes 1024 on your file
descriptors your limit to do 1024
threads so hopefully you're not spinning
up a thousand threads in your JavaScript
function you have a maximum execution
duration of 300 seconds so hence my
comment earlier that you would not use
Amazon lambda for something that is
long-running your request body payload
can only is limited to 128 kilobytes and
the response is limited to 6 megabytes
now so these some of these limit sounds
a little low especially the request
payloads coming in I'm thing to remember
is that with em as a lambda you there's
several different ways of actually
executing and invoking your services so
for instance if you're processing large
data you put that large data into an s3
bucket and then the just the act of
creating we the record there would kick
off your Amazon lambda function you
could process it out of out of the
bucket so if you're writing an image
processing apple reading doing image
processing with lambda you put it in an
s3 bucket and then have your lambda
function
acute and process it there okay and then
in terms of deployment limits now this
is a little confusing and I've read on
some of the lot question questions
online etc that these aren't exactly
enforced sometimes and it can be a
little confusing so your lambda function
deployment package size are limited to
50 megabytes which and on the size of
the code dependencies that you can zip
into a deployment package is 250
megabytes which for if you're deploying
large java application with you know 500
jar files is probably too small the
total size of your environment variables
is limited to 4k kilobytes so these are
our limits for your function and of
course I've seen online where this
they're not always in force I've come
across people that were asking questions
why manage to deploy something that was
100 megabytes why did it complain I
think the Amazon response was well you
shouldn't have done that but we're not
going to enforce that now we've seen all
the basics of lambda and where is the
power of lamb but it actually comes down
to the ecosystem because lambda is part
of a larger ecosystem as a as I've
alluded to before with s3 it integrates
with many of the different Amazon
technologies and allows you to consume
them up there so for instance you know
for we have the ability to control
access to our lambda function with the
ability to you know using the API
gateway to front our Amazon lambda
function with a web service on the front
of it so there's there's a lot of
powerful services up here and that we
can easily build stuff build stuff using
and use it use the lambda function as
the backend for that all right so ties
in with the rest of the ecosystem so
that's the real power of lambda is the
rest of the ecosystem along with it now
event sources as of alluded to in in the
in the section on error handling so we
can receive event sources from other AWS
services such as s3 so you put a new
file into an s3 bucket it connects
automatically execute
function we can use it to source data
from amazon kinesis basically large
inflow of data dynamodb so amazon lambda
basically functions as the stored
procedure mechanism for DynamoDB so
every time a record is inserted into
DynamoDB you can have an amazon lambda
function executes as a result of that
can process cloud trail messages so you
can actually write a lamb the function
that's you know processing incoming
logging messages looking for problems
and your other lambda functions for
example SMS NS and you can also have it
work with code commit so the Amazon
basically github equivalent somebody
commits code you can have the commit you
know kick off in Amazon lambda function
to do something as a result of that now
this is probably isn't comprehensive
because they're always adding and
expanding it and it's somewhat hard to
keep up with emails every couple of
weeks where they've introduced new
functionality to it the major one is the
you're the one that I mostly focus on is
the Amazon API gateway which allows you
to front your Amazon lambda function
with a web service easily and quickly
and will actually go through i'll go
through some examples and actually do
that because have custom app sources
such as android scheduled event
scheduled events so you can have an
amazon lambda function executes you know
every five hours and every night at
midnight and do some data cleanup or
something like that so there's many
different ways of executing a lambda
lambda function besides just the web
interface so some common use cases you
know for for example I've alluded to the
s3 plus lambda so doing some image
processing and sort of image it does
some image processing on the amath on
the on the image kinesins plus lambda
you know do some transaction order
processing and auditing S&amp;amp;S plus lambda
alarm response you know audit process
events etc a dynamo dB you could
validate the data that's being inserted
filter the data so that notifications of
events events happen and also the other
cool thing if you've you know run out
and pick up one of the fifty dollar
amazon echoes you can actually easily
develop
services for this thing so you could do
something that you know turns on the
lights at home or open the garage door
for example you could you know tie it
with Amazon lamina so they have recipes
and examples as to how to do that and
actually there's actually some right now
that they're encouraging developers to
develop lambda functions for Alexis so
they have their have like free services
etc that you can take advantage of right
now for doing that so it's one of the
cool things is that you can easily write
something using the Amazon like the
lambda function and invoke it from your
Amazon echo and so forth and have it do
things for you kick off a build for
instance so you could have a thing you
have to put your elects at the office
and say kick off a build Alexa kick off
a building have it do something like
that now in terms of I kind of briefly
in the demo before that I did I briefly
hopped through this but they do have
blueprints so I started out with an
empty one where supplied all the code
but they have examples and you can
download these they show you different
things that you can do with Amazon
lambda and give you a starting point
they're basically sample projects that
allowed you to build on top of that
there's over I think like almost 80 of
them right now that's such on different
languages and different functionalities
so there is one up there for Alexa as
you can see there's you know pages ahead
right here there's you know twilio hello
world for Python so they're all over the
place you can you can search and search
to see which ones are available and then
take a look and try them from there now
moving on exposing securing lambda so
great you can run code up in the cloud
but how do you actually secure it and
how do you you know attend to get your
users and that's why I'm going to spend
a large part of the presentation on
you'd use something you'd use the API
gateway which is the web services front
end that I discussed before and also
amazon cognito so this is really what I
said before we're amazon you know it's
the ecosystem right so being able to
execute code up in the cloud is great
but then you also have to secure and you
also have to have front end it and have
some way of invoking it so the API
gateway for developing like a mobile
application this allows you to you know
gives you an endpoint that you can call
right and neck and kick off the
execution of the code I'm going to start
out with the API gateway
so the API gateway and there's no
additional charge for using this there's
an implication charge but it it allows
you to build the play and manage restful
api is up in the cloud it supports
throttling and protection against denial
of service attacks so if you know one of
the concerns you you know you develop
your own application you deploy it on
your own server up in the cloud now you
have to deal with denial of service
attacks I think it was I heard of a
group last month that had deployed their
own was a Java users group that had
their website hosted up on an ec2 and
they were doing everything themselves in
the morning of the meeting they got hit
with a denial of service attack and spin
I guess most of the day trying to keep
just keep the site up and running that
is handled for you so you're protected
against that it supports versioning and
staging so you can have basically the
test version of your API the production
version of your API and you've got a way
of you know so what you know upgrade you
know deploying versions of the API it
also auto generates client
implementations for you so it will
actually provide you with a jar file or
some JavaScript code that you can
download on a zip file Jax's C code
swift code etc which allows you to
easily you know build up your clients
right so you know it'll give you this
nice block of code that you then drop
into your application into your mobile
application or to your web application
which allows you to authenticate and
also invoke your web service right so
you don't have to go out there and try
to figure out okay you know I'm starting
with the URL how do i how do I invoke
this how do I pass the there the request
parameters and etc and then it's
flexible authorization model so ties in
with Amazon cognito which we'll get to
in the next part so as you can see doing
HTTP and and it's also the it's exam it
uses https right so they provide the
certificate there's a amazon certificate
that's used as valid that you can use to
invoke invoke your server so it's never
actually exposed via HTTP so you're
starting it with HTTPS you can upload
your own certificate you can attach your
own domain name to their services you'll
see where a little generate a URL for me
and I'll you
amazon certificate that you can provide
your own certificate and you can provide
your own donate domain name for it so
that it would be you know your company
HTTP it's your company with your own
certificate that you provide for
invoking your service this is extremely
functional so to create a new API
gateway you just log in click on API
Gateway you know click new API now when
you go through the Amazon lambo function
I skipped over the first screen X
actually asks me if I want to expose it
as an API gateway so when you go to
create your lambda function you can say
yes also exposes as a web service that
by the time you're done with defining
your your web services ought it's
already deployed as started defining
your lambda function it's already
deployed as a web service you can also
deploy if you're doing lots of complex
services you can also use something
called swagger which basically defines
your restful endpoint right and there's
an XML file that goes with us that
describes you know your service that
you're deploying so you don't always
have to go through the GUI or you know
script it yourself or in creating the
services so if you're not familiar with
swagger I recommend checking that out
hopefully that'll get adopted more in
the Java world so with that I'm going to
up back over and deploy a web service
api gateway we create a new API
yep um if I knew how to control company
van plus the real i'm going to create a
new API okay so we've got nothing
deployed yet so we've got our Soviet
this devoxx us so I'm going to create a
new screen resources resource demo
enable it for cross sides cores create
click out that and this is where swagger
comes in so you wouldn't actually have
to do all of this manually so let's
create a new get okay and we want it to
invoke our land the function so we'll
click on lambda executing us east region
I'll and the function hello box us
okay poor should execute it terrific so
now we've got we've got our laminate
function so it comes in a processes the
request sends requests over your lambda
function ions out of the back for us now
we can take and deploy your API will
call it actually fault test
and there we go we've we've just
deployed a web service to the cloud
right so that's our endpoint URL please
don't write a script right now that's
going to go out and execute that Emil
you know to 10 million times but we've
we've deployed our land the function as
a web service on the web service
actually won't work right now because I
am not returning HTTP code of 200 with
it with the body function that we wrote
before is actually not set up to work
with a HTTP request but as you can see
here so this is you know we can then use
this you know and then take and put this
into our being a mobile application and
call and we've got you know code that's
easy to do now if we look at so we've
got stages so the stages allows us to
have different stages are a pain you can
kind of see that with the the outlay
their thing the models dashboard gives
us a nice dashboard for tracking
progress actual resources
and we cook back on the upper level
there and we can see we have we have
staged variables as a part of it couple
quite a bit of that and now for sdk
generation this is what i mentioned
before we can actually generate code
that will invoke or invoke the service
for us so i can go through here select
what i want you know android or
javascript on JavaScript and it will
generate a zip file containing code that
I cannot paste into my implication yes
yes yeah so you could return a Java
object that uses the Jackson library to
convert the java objects to json coming
back yeah so if the lamb of function
blows up a little return in there yeah
so this is you know fairly easy as you
can see for writing the playing
applications you didn't have to write
you know write a ton of boilerplate code
in order to expose the service and apply
it to a server
so this is great for you know that that
that killer app that you have that you
want to build on the weekend that's
going to allow you to retire early so as
you can see this was you know or the
drop-down I just showed you where we
could generate the different output
bindings for it and then it generates
code that's kind of something along
lines of this so there's this API client
j/s file which contains the functions
that you can invoke in order to call
your call your method so here there's
this hollow confu yet so you call hollow
Abu Ghaith and pass and this is a
separate exempt waited another
conference but you pass in the
parameters the body etc and it returns
back the results to the thing to note
when you generate it is that if you
haven't actually published your service
yet it won't be this API glatt client
j/s file so just if it will happily
generate code even if the thing isn't
deployed completely so I just kind of
kind of as an FYI i made a mistake
clause a long time back and it wasn't
actually generating that and so then you
know for actually invoking it it becomes
fairly simple to invoke your code you
have a you know a try-catch for handling
the results and ernie errors that come
along so it's fairly easy to using the
code that they do then generate to
invoke your service you don't have to
you know build up the request yourself
and call the service and they also
generate now equivalent Java code and
see you know objective-c code and swift
code for you as well now the interesting
thing with the API gateway is you can
actually write api's and they have a
mechanism for actually selling access to
your AP is you have the ability to
create a usage plan basically you know
throttle users and generate an API key
that you give somebody else so you have
a great idea for you notice this you're
doing weather monitoring for your local
neighborhood you want to sell access to
that right you can you can actually you
know create your API generate an API key
and then sell it other people and either
their access to it and charging port so
the steps we're doing that is to create
a usage print plan associated key with
it and then associate a key with given
service so there's a wizard that will
take you through actually setting up
just that so if you have this great idea
you have your
mobile application or have an idea for
an API that you think other developers
or other companies want to use this
allows you to build that API and then
turn around and monetize it so that was
API gateway the high-level introduction
to API gateway the next I'm going to
move on to Amazon could neato so there
are three ways to secure an API one is
API keys which is appropriate for
services service communication however
it's risky places secret key on the
client for a long period of time
obviously there's Identity and Access
Management which is good for inter
application communication or within an
organization then the last one is Amazon
cognito which is what I'm going to talk
about now which is appropriate for
third-party invocation so it's a user
identity authentication service it
supports storage of user data in the
cloud so it actually allows you to it's
actually fairly featured in that you can
have you know user preferences that move
from mobile to the web browser and back
and forth it can authenticate users
against federated identity pools
providers such as Facebook and Google
etc to have a complete list of on
another slide it also allows you if you
don't want to have to force your users
to use or Google or Facebook to actually
you can actually create a custom
identity pool that that the users that
can fill out a form and create an
identity and they manage that for you
and you can synchronize you know
functionality synchronize user profile
data across devices etc so you go click
on Amazon Cognito and it's going to
prompt you to either manage your user
pools or manage federated identities so
I'll start off with managing user pools
which is basically defining your own
basically database of users so it allows
you to manage your sign ups the
interesting thing with this if you've
ever tried to implement this yourself it
supports multi-factor authentication out
of the box so you can actually smoke a
multi-factor authentication can enable
that feature if you like users can start
anonymous and then register and will
actually track their state between that
they provide a built-in password
recovery mechanism via SMS and
notification the email so you have a you
know a security token sent to their
mobile phone and then they can log in
and reset their password so you don't
have to develop any of this logic you
can focus just on your application
and you know you're implementing them to
function you don't have to worry about
all this infrastructure code that you'd
have to build on top of that you can
also collect and maintain user meta
information as well with that so going
to user pools you can easily create a
new user pool you know it requires email
is required you can set rules on the
passwords enable multi-factor
authentication there's a whole bunch of
things here that you can look through on
so you can set up policies in terms of
you know you know can user sign
themselves up you know if a user creates
an accountant that never uses it how
long how quickly is it destroyed right
you know the all the stuff that you have
to handle if your implement to building
this infrastructure yourself and allows
you and then ok so that was user pools
moving on to the federated identities
which was the other option that you had
they have provides support for Amazon
Facebook Google Twitter etc you've seen
where I went through and used amazon
cognito they also support on put an ID
connect provider sam'l and developer
authenticated identities which if you
have a database of existing users and
passwords you can also tie it into that
you can use all of this together so you
could provide access to your application
for users are using Amazon Facebook and
also allow you know legacy users to
continue to use your existing data store
creating a new identity pool is fairly
easy login give it a pool a name and
then you have basically a drop-down in
here sorry a series of choices that you
can pick and enable the different
sources you know that you want to allow
people to login using you know so if you
want allow users to come in and use
their Amazon credentials you click on
that tab there and it set it up so then
in terms of Amazon cognita plus the
Gateway how it works is these are
basically off of my case against
Facebook Google and then Amazon cognito
gets him in the way there then finally
in the end at once all the
identification is done then then your
API gateway method is invoked sorry be
speeding up here we're running out of
time now the in terms of the JavaScript
code is fairly generic JavaScript code
that you can download that will actually
set up and connect to your things so
this is an example here of connect
and authenticating against the identity
against the against the service and then
invoking the function so as you can see
here this is the boiler script Java
Script code that you put in your
application for authenticating your
applications so you'd have some type of
user forum that would you know prompt
them for your username password you
create this authentication details
object and then you pass it into the
authentic you know into your
authenticate user call back on the
needle user and ultimately you can then
invoke your JavaScript code okay so
that's that's Cognito in a nutshell that
allows you to control access to your
Amazon API and also your lambda function
in the end right so this is n to n so
you've got your lambda function and you
can front it with web service and then
control access to your service now
looking at Java inlet and AWS lambda
it's very similar to the JavaScript code
that we saw before so you have basically
a handler basically at the class with a
method so there's two ways of doing it
there's a either implementing an
interface or where you specify what
basically Java object / method gets
invoked within your jar file as I
mentioned before they will serialize the
Java objects coming in going back and
forth to JSON for you using the jackson
librarian how i figured that out was
unpacking their jar files to figure out
what they were using for that you can
also accept stream input so you can
accept basically input stream and stream
data to your line the function and this
is your basic this is the equivalent of
the hello world one that we saw before
in JavaScript but in Java so as you can
see it looks very similar we have our
handle requests we implement the request
handler specifying the Java objects that
are coming in and going these are
objects that I custom defined and are
converted to JSON using the jackson
library this is the request object that
i wrote that was you know that they
serialize marshall back and forth from
json to job before me okay the
dependencies if you're setting up you
know to set up the maven there's a
series of SDKs that you would include in
your palm file that all the stuff is out
there and maven central so you pulled
out in the Java dependencies for that
which allows you to get up and running
one of the things with with Java is that
you actually have
create a uber jar file which contains
any of the third-party jar files at your
service depends upon so you include that
specify that you're generating newbridge
are there's ways of doing this using the
shade plugin for maven there's
equivalent code for doing that for
Gradle as well so you packaged up all of
your jar files aid your code into
another jar file I'm actually going to
skip the demo of this one I've actually
already for this one I actually uploaded
the code already to s3 and then I just
select the code and s3 that I want
execute ins provide the name now in
terms of execution time HelloWorld in
Java took when I executed a last one
hundred and sixty seven milliseconds so
build for 200 milliseconds took forty
three megabytes of RAM the JavaScript
took significantly less now this is the
first time startup generally what I've
heard from other people is that your
lambda functions kept around for about
four hours before they destroy it
actually goes into a hybrid hibernation
mode then eventually they toss it out
and destroy it right so you can kind of
assume so there's the initial the first
time your service gets invoked is you
know it kind of has to warm up you fire
up the JVM etc so there's an initial
penalty the first time it'll take longer
to execute the first time then the
subsequent invocations right so this is
kind of misleading because this is the
first time execution so of course job is
going to take longer to start up now it
depends upon what you're executing is
for which one you know your process
which one is going to be fast you know
use it more resources less resources etc
now where does java ee and AWS fit in
well as java ee is a standard with
several different implementations the
challenge with the amazon lament stuff
is that it is not you know there's
different providers so Google has their
own implementation a Missouri Microsoft
has around one implementation but
there's no uniform standard for that so
one of the nice things of joeys that you
have a standard way of implementing
things you're not tied to one vendor
once you're in this ecosystem this is
your ecosystem right AWS is a set of
ready to maid services right so you've
got your elastic search or lambda you
know your s3 buckets and it's an
ecosystem of services that are already
deployed in the cloud that you're using
interacting with to save time on your
deployments right AWS spans regions data
centers you know et cetera so you know
that being said why would you use Java
EE versus lambda or one of the other
container technologies one is you know
you have to working with distributed you
know transactions you're doing very
complicated transaction work you've got
long running tasks you know like report
generation I Amazon does have things
that can handle that you you're doing
compute intensive tasks you're using
rules engines large you know third party
dependencies applications with licenses
I journey integrate with legacy systems
or you need something like that that's a
WebSocket you're doing a WebSocket
communication back and forth in real
time because lambda runs and it has to
return immediately one of the challenges
with Amazon land although the prices are
very low is trying to estimate and
controlling costs figuring out how much
it's actually on a cost to how much for
your API gateways your s3 buckets and
your actual thing actually gets very
complicated in terms of trying to manage
costs and understanding them and for
some applications that's that's a
problem for other applications that's
not so much an issue and then you have
you know regulatory requirements for a
nap shots for security instances etc
depending upon pure and regulated
environment so this would be an example
of a hybrid architecture so you'd have
your Amazon you know using Amazon land
with a gateway on the front end because
you could still write Java code in your
Java container but then have it turn
around invoke a lambda function or call
your you know existing legacy
application running on a VPC for
instance so you could still have you
develop kind of you could develop
complex application architectures which
include both amazon lambda and your
traditional application servers running
up there so you don't have to worry
about trying to deploy your and expose
your web services and your e container
to the world you could use Amazon API
gateway for that you could implement
some functionality using Amazon lambda
and then have some of your existing
logic or more complex code running over
an ec2 container running in a Java EE
container so in conclusion so one of the
challenges with working with us is
documentation the lambda documentation
and the AWS documentation tends to be
very primitive it can be very
straining at times testing can be a
challenge debugging is non-existent
there's no tooling support at the moment
error handling there's right now there's
no code commit integration so you can't
you know commit your code to AWS code
commit and have a deploy as a lambda
function and the nodejs version is
lagging one of the ways if you need help
with this there have the Amazon pop-up
loss which I think there's one in San
Francisco there's also one in New York
so you can actually go there for free
and ask somebody for help so after
living further out where you don't have
access so it'll be a little bit harder
so one of the best practices if you're
in a Java world strip out all the
unneeded jar java code that you don't
need into my startup times monitor logs
failures some resources way over so i
will post as you can get those up on the
slideshow later so thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>