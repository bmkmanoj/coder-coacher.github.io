<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Database Clustering Tutorial 11 - ClusterControl Scripting with Developer Studio | Coder Coacher - Coaching Coders</title><meta content="Database Clustering Tutorial 11 - ClusterControl Scripting with Developer Studio - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CalebTheVideoMaker2/">CalebTheVideoMaker2</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Database Clustering Tutorial 11 - ClusterControl Scripting with Developer Studio</b></h2><h5 class="post__date">2017-08-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wHML-r3CVmQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back if you want in this Caleb
from Caleb the video maker to this video
we are going to be doing the cool stuff
of cluster control and this has to do
with database automation and monitoring
so essentially with cluster control we
can write these scripts that will run
regularly to check things in our
database so when we open our cluster we
can find this scripting area by going to
manage and then developer studio and
here there's going to be a bunch of
scripts that are already built in so for
example you can go to s9s MySQL and then
let's say schema for example and then in
here one of them is schema check no PK
and essentially what the script does is
just make sure that your tables have a
primary key this language here is called
a domain-specific language or sometimes
it's shortened DSL and essentially what
that means is it's a language that has
absolutely no purpose or value outside
of this application which is kind of sad
but it is very similar to JavaScript you
can see it even ends with a dot J s so
it's really not that confusing if you
know anything about JavaScript there's
just a couple differences you can find
online on the several nines website
there are basically two categories of
scripts those that get ran on a schedule
which are called advisers and those that
you can run as needed the ones that are
ran as needed might just be used to
simplify a complex process our goal was
to do as few things by hand as possible
so scripts are very good for us to use
so a little bit more on the advisers you
can click this little advisors button
right here that's going to list the
advisers that we have set up these are
the ones that run regularly and you can
see there is a little pink box saying
how often these are ran so if you scroll
down to the bottom you can see the one
that I'm talking about tables without
primary key this runs every 20 minutes
and it runs this script schema
underscore check underscore no pkj s so
that is what an advisor is so to
understand these scripts a little bit
more I want to go through a specific one
and break it down so let's close out of
this this
specific script that I'm interested in
is in this s9s folder and then MySQL and
then what is in is called programs so
open programs and the one that I want to
look at is change user password this is
a very simple script that you could
start with to a look through it see how
it works the very first thing you should
notice is this include and this is
actually referring to another file if
you open that location common there's
this MySQL helper j/s so we're just
essentially taking this script right
here and plopping it right here and what
this script does is allows us to connect
to our nodes the way this script works
is there are some variables up here in
all caps almost as if they're constants
and what you do is you just plug in a
value here and that's going to be used
throughout the program so it says here
change me and then you're also going to
put the user that that password applies
to this variable here is the command
that's actually going to be ran and then
this function main that is where the
actual code starts running so when you
run this it's going to start right here
at line 11 this is just going to run
line by line so it's going to look at
this first line do something and then
it's going to go here do something and
so forth now if you don't have any
coding experience but that's okay I'm
going to try and keep it simple if you
do have coding experience I'm sorry if
this is a little too simple but got to
find a happy medium here the very first
thing let's look at this VAR host equals
cluster colon colon MySQL nodes
parentheses well anytime you see these
parentheses like this this is called a
method or a function this is essentially
going to get all of our nodes in our
cluster that are running MySQL we can
then loop over those and get information
about each one which is what this for
loop is for and essentially we're
looping over them so we can change the
password on all of the nodes not just an
individual node if interested there is
also another thing you could use here
and that is cluster colon colon Galera
nodes and this is a little bit different
in our situation that's going to work
the same but if you remember a while ago
I mentioned that Galera does synchronous
replication the Galera node is going to
get all of the nodes
are part of our Galera cluster whereas
this mice do all nodes is going to get
all the nodes that have MySQL on even if
they're not using synchronous
replication so kind of get into the
details there it doesn't really matter
in our situation all of our nodes are
using synchronous replication so the
thing is going to be the same either way
so we can just get rid of that this for
loop is used to go over each node so
this is going to loop around every
single node so for every node this is
going to be ran one time and this is
just a standard for loop you can look up
how to structure a for loop if you don't
understand this but essentially the
value starts at zero and it's going to
go until it reaches the host size until
it's one less than the host size
essentially the reason it's one less is
because we're starting at zero and then
in here we can use these variables to
get specific information about that host
so we are grabbing an individual host
that's part of this host variable
because if you remember this host
variable contains multiple hosts here is
a way we can grab an individual node and
then we have these two lines which
honestly I really don't know what those
are doing so able to skip over those
essentially though this connected
variable is going to have some value
after this is ran and it can either
evaluate as true or false if it
evaluates us true this if statement is
going to be ran and everything inside of
these curly braces will be hid so if we
are connected what we want to do is we
want to execute the SQL command and the
SQL command is this one up here and then
if it's not successful what we want to
do is print the error and stop running
our function if it is successful which
that would be the else statement that's
what the little exclamation mark means
it's the opposite so up here it's if
it's not successful and down here it's
if it is successful what we want to do
is we want to say the password for this
user on this host name has been changed
and then once it loops through all of
them and if they're all successful it
will return true and then that can be
used as an indicator as whether this
thing worked or not
now that you have a little bit of a
better understanding of how writing
scripts works it's important to know how
do you actually run these things well
that's what these commands are up here
for compiling is going to check for any
syntax errors so making sure you didn't
type anything incorrect compiling and
running is what you're going to want to
use to actually run the thing once you
do that and you let's say you want to
schedule it regularly you can make it an
advisor if this particular part of the
series has interested you I'm going to
refer you to two articles on the several
nines website so the first one is
cluster control developer studio write
your first database advisor this is
going to go through all the details of
how you do that and this is a little bit
more advanced so you can really learn
more than this crappy video the other
one which might be a little bit more
advanced than this one is called
creating your own advisors in JavaScript
so if you scroll through this you can
see all the information it talks about
and so forth and just so you know it
actually is not JavaScript you can read
it right here
cluster control DSL domain-specific
language which allows you to extend the
functionality of your cluster control
platform the DSL syntax is based on
JavaScript but it's not JavaScript it's
very very very similar to JavaScript and
there is an article out there showing
all of the differences so yeah guys
that's all I got for you today
hopefully you've enjoyed this video if
you liked what I've come up with so far
in this series please leave me a comment
and we'll see if there is anything more
I could possibly teach you guys also be
sure to bug several nines and be like yo
Caleb curry taught me about your stuff
you should help them out more help them
get some more videos up etc that way
they can come to me and maybe we can
work on some more videos together I hope
this series has really encouraged you to
understand databases even more than you
have already and this is really great
because this is going beyond just a
database for a small website we're
talking really large websites or just
applications that companies are using so
this is really cool that is all I got
for you guys today so if you've enjoyed
please subscribe and I will see you in
the upcoming videos thank you for
watching
really appreciate it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>