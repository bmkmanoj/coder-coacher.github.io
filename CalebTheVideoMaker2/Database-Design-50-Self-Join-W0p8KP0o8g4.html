<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Database Design 50 - Self Join | Coder Coacher - Coaching Coders</title><meta content="Database Design 50 - Self Join - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CalebTheVideoMaker2/">CalebTheVideoMaker2</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Database Design 50 - Self Join</b></h2><h5 class="post__date">2015-02-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/W0p8KP0o8g4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everybody welcome to this video
today we will be talking about self
joins the way of self joined works is
you take a table and you are essentially
joining it with itself and that's what
kind of makes self joins confusing and a
lot of people can't find practical
purposes for them I'm going to be giving
you draw my marker I just got white
marker all self joins are complicated
and a lot of people can't find practical
purposes for them in this video I'll be
giving you at least one good reason for
them so hopefully this video is helpful
so when you have a self join think of
basically duplicating the table you have
and making an exact copy and then
joining those two tables together that's
a good way you can think about it so for
this example I'm going to be using a
user account system on a website and you
know how some websites have like a
referral option basically if you refer
somebody you get like 20% of their money
and earlier points or 10% of their money
so forth that's like referral marketing
and when you do that you are assigned a
person who referred you right and it can
become a chain like this person referred
this person for this person refer this
person so within a user table you might
have a user ID and then on top of that
you're going to have you know email
first name last name and the person who
referred you
I'm putting the person who referred you
with any column known as referred by and
this is actually a foreign key to the
same table so within here you're going
to have numbers such as 12 which is
going to point back to the user ID of 12
so for example the user ID 11 might be a
person it was referred by the user with
the user ID of 12 now the only way that
you can make this really work for a join
is if you use a self join basically what
we want to do is we want to replace
referred by with the ID we want to use a
join to replace this number with that
user's email which I also forgot to put
in here so
you know start an email in there so
we'll take this and then our outputted
result will look something like this and
this is the table that we're going to
have and then we're going to insert data
into that table so we might have a user
such as Caleb curry and his email is
going to be swag @ Yolo comm and then
it's referred by that we're going to
replace that number with a user's email
such as hot sauce uh yeah org so that's
is an example of what we can do with
this self join now in order for this to
work we have to tell the database that
we're going to be using the same table
in basically two different tables and
that can kind of be confusing and in
order for that to work you have to use
what's known as an alias I talked about
those in the last video so be sure to
check those on out so to begin we just
kind of think of a name of what we could
call each table we could have the first
table which would also be the user table
and then the second table which would be
another copy of the user table now we're
not actually like copying the data this
is just for illustration point it's
going to use that data that same table
to withdrawal the data from and we could
say this one is a v1 and v2 for example
those are our aliases and in order to
define those we put as after our data
after our table and put v1 so we could
say user as v1 and then join user as v2
this is something kind of like what you
would do so now we have a user as V one
and then we're joining user as V two and
it kind of gets the idea that oh this
person wants to use the same table for
the situation let's try to figure this
out let's begin we are going to put this
within a select statement and I'm going
to give you some specific syntax just so
this can kind of make sense so we have a
select statement then right after the
Select statement we always put the call
on
we want to take our data from now this I
think is kind of confusing though
because we have two basically two
different tables that we're going to be
taking data from so we have to think
which table we want to take which
columns from the way we had it set up
before is we have this table in this
table this was V one and this was V two
well let's kind of in our imaginary
brains which we don't have we're going
to say this table is for the user and
this table is for the referrals so we're
going to take from this table we'll take
the user ID maybe or the first name the
last name and the email and then from
this table we are going to take the
email of the person who referred you so
we'll take the referred by person's
email so the way this will work is we're
going to have the user ID such as seven
and Caleb curry and then their email and
then it'll have an ID of seven or some
eight for the referred by and then
that's going to go to the second table
to get that person's email you got to
keep this in mind and you have to figure
out what you're going to name your
tables before you start the Select
because now that we are going to say the
columns we have to qualify those columns
by putting a dot before them and saying
what table they are from and we can just
use the alias name that we've had or
made up so we could say select v1 period
or dot and we could say first name comma
and then we could say v1 dot last name
comma v1 dot e mail finally we are going
to take v2 and we're going to take that
person's email or you can do their first
name or last name whatever you want to
put in that referred by thing if you
wanted to say their first name you can
say v2 dot first name
going to be their last name it can be v2
dot last name or if you want a
combination of both you can use a
concatenation function or something so
we're just going to use the email so
we're going to take the v2 dot evil now
that we know what columns and what
tables that we want to take the data
from we actually have to put the from
statement still and say something like
from and then put the table we're taking
this data from this is where we're going
to define our alias so we could say from
user as v1 that is going to basically
tell the database that the user table is
known as v1 now we can do a join join
this is going to default to an inner
join if you just use join like that we
could say join user as the two that is
going to basically tell them that user
is also going to be known as v2 but it's
going to be considered a different table
in this situation then you're going to
do the on which is going to say where we
are going to join these things now this
is where it can get really confusing
because there's so many possibilities
that you can put right here for the
situation we are going to take v1 and
we're going to take the referred by
column and that is going to be the same
as v2 user ID column so if you can think
about this imagine literally two tables
with the same exact data
here's v1 here's v2 now I have a user ID
and then within here we also have a
referred to by or referred by I guess
that's going to reference the user ID of
the v2 table so that means we need to
basically make this connection and say
that if there is a six over here in the
referred by table it needs to be the
same as the user ID over here that has
six if you need more practical data
under to understand this imagine we have
this guy over here
named Samuel and we have this guy over
here and his name is uh yeah that's his
name of soup and all to refer Samuel
that means oh is going to have the user
ID of six within this user row of the
user ID of one say twelve so Samuel has
the ID of twelve when he was referred by
the person with the user ID of six which
is opposite of and then this other table
which is also the same user table it's
going to refer to the person with the ID
of six which is this guy hopefully that
makes sense but in reality you're not
going to have to exact copies of the
data it's smart enough to understand
that these are all one table so it's
basically going to take that refer by
and then go back to the user column and
join that into what would look like
taking two tables and putting them
together that's why I can get kind of
confusing but when you take this query
as it is and you put it in your database
you will get something that looks like a
normal joined table it'll be one really
big table and it will have the columns
that we selected v1 dot FN on top of
this we're also going to have the v1
last name and the v1 email and v2 email
then if we were to put example data into
this it would look something like Caleb
curry an email and then the v2 email
would be like another guy's email so
such as Wow okay
jad Dom that's what it would look like
and it would just give you all the rows
for that so yeah you can mess around do
all kinds of cool joins and all kinds of
stuff but there's one more thing that I
want to tell you that has to do with
aliases well you know this might not be
too pretty how you have right now and it
might be confusing having an email and
then right beside another email like
what is the what do those mean well you
might want to say that one column is the
user and another is the person you refer
them so you can use an alias for that
too so for that you also use
as well instead of putting in the from
you're just going to put it right after
the column that you want to change so
you put here here here and here so if I
wanted the table to email or the person
who referred you could make it say like
v2 dot email as referred by and this
you're going to want to put in quotes to
say you want that string as the title
for that column and then when you get
that new table that join instead of
saying email it's going to say referred
by and then it lists the data
yo what's up my homie homies this video
or this section of the video I guess
we'll just be discussing this in a
little more depth by showing this real
example that explained on the board so
you can see I have a user table and
within my user table you know I got user
ID pass email for first name last name
and referred by this referred by is a
foreign key referencing the user ID kind
of interesting how that works so you can
see here is this guy Alamos Vega Yolo
com is referred by to which in this case
would be hi mom at Lowell Lowell calm
which he basically referred everybody
that's why has a zero here and if you
scroll down we also have some people who
referred by one basically what we want
to do is we want to replace this
referred by with the person's email and
to do that we can use a self join and
who knows there might be a way easier
way to do this so if there is just be
sure to let me know alright so here is a
query that would work to do that so let
me just refresh this and here's what
it's going to do it's going to select
the first name last name email of the
person who was referred it's also going
to take the email of the referral person
the person who referred the other person
it's a person within this preferred by
column okay so you can see we got the
first name last name email that's one
thing and then the refer by email
so how does this work we take the
columns and we also replaced the email
of the referred by and put referred by
that's why it shows up right here which
is what we want that's good
then we say what table we're going to
take the user table and call it v1 which
you can basically name it whatever as
long as you update right here then it'll
still work that's just a name I made up
I couldn't think of something cool but
basically a version one you know this
inner join is we're taking our other
version of the table and just so you
know this inner is optional so you can
take that away and it's going to work
exactly the same way then we're going to
say how it's related so basically this
referred by email that needs to have an
ID in that table that refers to a person
so the referred by is going to have an
ID and that needs to match a user ID so
within the first table let's go back to
the user table this - for example that
needs to reference an actual person it
needs to be actual data within that
second version of the user table and
it's going to go to the second version
of the user table find that person with
the ID of two and it's going to take
that email and display it right here so
hopefully that makes sense guys and of
course you can mess this mess up the
Squier you can just mess around with it
and put your own stuff in it to get your
own results and you can even change this
statement right here to get even more
crazy results so yeah guys thanks for
watching peace on earth and catch you in
the next video and subscribe as well as
v1 dot last name and VA ah it's a one
right now more on for the aliases at the
table we're going to tell MySQL ah crap
nuggets I mean it's not my skills
databases</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>