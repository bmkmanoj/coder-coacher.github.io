<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Julia Nguyen - Two Households, Both Alike in Dignity: A Not-So-Tragedy of Refactoring Front-end APIs | Coder Coacher - Coaching Coders</title><meta content="Julia Nguyen - Two Households, Both Alike in Dignity: A Not-So-Tragedy of Refactoring Front-end APIs - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Curry-On/">Curry On!</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Julia Nguyen - Two Households, Both Alike in Dignity: A Not-So-Tragedy of Refactoring Front-end APIs</b></h2><h5 class="post__date">2017-06-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6jqZQGc-hRA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you so welcome to two households
both alike in dignity an office with
tragedy of refactoring front-end api's
by me
Julian Owen I'm also a floor child on
Twitter yeah so a bit about me I'm a
developer at IndieGoGo I am originally
from Toronto Canada currently living in
San Francisco I found it if me if me is
an open source mental health
communication app you can contribute to
any capacity and join us we're an
awesome really inclusive community and
we're always looking for contributors
I'm also part of prompt or a community
of people in tech who speak openly about
mental health which is really awesome
and really important and if you've seen
any of my talks before I talk a lot
about that and also if me but today's
talk is not about that and lastly I am
one of the organizers at Rice B code San
Francisco and I help to get women and
non-binary people into technical
leadership through conference speaking
writing and open source contributions so
let's begin so I'm going to be telling
the story through the lens gifts of Baz
Luhrmann's Romeo + Juliet and like who
does a little nicer box right like it's
super cool now everyone's wearing
chokers and like crop tops and 90's and
also pre Oscar young cheekbones Leonardo
DiCaprio like who doesn't love that and
on top of that Basel written like all of
his movies are just over-the-top and
intense and this is gonna be good so I'm
going to start off at the prologue so ed
Anita girl I'm on the backer experienced
team experience and Trust team and what
is a backer backer is someone who gives
money to a campaign and yeah a backer is
someone who gives money to a campaign
and our tech sack actually is on the
back end it's Ruby on Rails and then on
the front end it's angular one I know we
should upgrade it to a newer version of
angular but we're actually looking into
that and recently we decided to adopt
typescript which has been really
interesting and when people think of
IndieGoGo they think of crowdfunding
they think of Kickstarter they think of
GoFundMe
all of those websites are in the same
category of crowdfunding but IndieGoGo
is actually a lot more than crowdfunding
it's a platform for entrepreneurs to
create products and also fulfill them
and also shout out to our new product
marketplace where you can actually buy
products anyway is back to crowdfunding
though so when people think of
crowdfunding they think of perks so you
go to a campaign page you give money and
then in exchange you get the perk and
it's usually the product that they're
trying to sell and fulfill and a perk
actually is a reward that you get for
contributing to a campaign and
essentially it is a product and products
come in different configurations like
for instance with this example this
campaign has a perk of a random t-shirt
and when we think of a perk in the
context of a product we think about
items and options we think about oh like
what size is this t-shirt come in just
come different colors what designs are
there and this was a site like in the
past where whenever you wanted to make a
t-shirt and have it as a perk you'd have
to create a perk for every single
different configuration you'd have like
a black t-shirt in size small like a
white t-shirt and size large and it just
got really complicated and IndieGoGo
we're moving more towards product and
creating a marketplace where people can
buy awesome products and it's important
as part of e-commerce to have like
itemization and another problem that our
engineering team at IndieGoGo is trying
to solve is payments so people want
their perks or products right away like
you want to buy it right away you want
to you're excited with the product and
you want to receive it you want the
shipping to work out and all that jazz
and what's we're irritating than
spending more than two minutes filling
out your credit card information is
sucks so this brings us to act 1 as the
awesome hip-hop group Boutin klein puts
it cream or cash rules everything around
me dolla dolla bills go anyways so
that's a good in fair Verona we have two
households both alike in dignity but
what does this actually mean in the
context of this talk
so almost a year ago two engineering
teams were tasked with solving this perk
and payment problem the first team I'll
call them they're Capulets were tasked
with integrating items and options for
perk so back to the example I said about
having t-shirts of different sizes and
different configurations
that's what itemization is and the
second team the Montagues were tasked
with making payments grow faster so we
decided to go with Apple pay / Android
pay first because we already had Apple
pay set up on our iOS app and also
through every user research we found out
that more users actually use iOS and Mac
than any other platform on our website
so these two projects have a lot of
overlap and as everyone in this room is
well aware of software moves really fast
and so we have to work on these two
projects in parallel even though there
was a lot of overlap and often you don't
realize that technical debt is accrued
much later and at the beginning you know
everything seems whimsical and romantic
you know this give hello cute but it's
not because you know technical guy hits
you at the end so a month later we
wrapped up these two projects and they
were being worked on in parallel and I
was tasked with adding Apple pay support
to items and options and basically tying
those two worlds those two households
together and as I said before these
projects had a lot of overlap and we
worked on it in parallel and I
discovered a lot of the technical debt
and this is what the talk will be mainly
about so this is what I wanted to do I
want to tie in Apple pay with items and
options there goes we're forgetting
poison and very dust yeah so from the
front side of things these two projects
wrote their own services and their own
directives for capturing the selected
perk and displaying it in modal's and
even though these two things touch the
same object the two teams were Thoreau
services and directives which was
problematic and so I at the beginning of
the project I went through all this code
and tried to figure out where there was
overlap and where there was repetition
and I documented this so I could keep
track of what we needed to do and what
needed to be
and I also pointed them so I could
figure out the complexity of work that
was required to do it and the most
egregious technical debt was that we had
a lot of duplicate client-side code for
the api's for the perks
hence Starcross perks okay this is cheb
alt so he's Juliet's cousin who is all
about fighting the Montagues and Ramona
specifically so back to perks so all of
the perks actually so these are all of
the front-end api's for the same thing
and highlighted in the green
highlighting text thingamabob is the
repetition and the differences between
them so what's even more confusing is
that the Montagues stuck with shipping
address required but the Capulets
renamed it to shipping required and they
did the same thing and then we also had
like the shipping object this also had
fees and then the other team the
Capulets had shipping underscore fees so
that's an example of where there was
overlap but also like renaming of things
so the only reason why I identified this
problem was because when I was working
on getting Apple pay to work with items
and options
it wouldn't work when they were shipping
available like the app just kept
crashing and I was just like debugging
for days and like thinking to myself
like what the hell is happening and this
is when I discovered that we had like
different typings
on this is typescript and and this is
the cause of the problem and it's
something that's really hard to I guess
identified especially because typescript
runs at compile time rather than run
time but moving on it's not as bad as
waiting 20 years to win an Oscar though
so okay so we made it to act 4 this is
when our star-crossed lovers marry each
other and you know the last bit of
romance until hits the fan
so let's know these perks together into
one perk through them all so getting to
my future work I actually have to tackle
this as I actually to work on this in
order to move on and actually get Apple
pay working and that was kind of hard to
do because I'm from the product side of
things or PMS we're really pressing for
deadlines to get this out because you
know cash rules everything around me
like we need to make money so a lot of
work actually had to go into this
talking the project
managers some of them weren't technical
about how doing technical dealing with
technical debt and dealing with four
factors is actually a really important
part of engineering and also part of
product so yeah let's get down to
business so we're going to start from
the server side so all this although
this problem was in the front of API I
needed to start from the bottom so in
our back end which is Wales like I said
before we had this model called perc and
we use sterilizers to expose specific
attributes from controllers and from
that we built the front of the API so
inspecting lists you realize they're
being used for items and options I
noticed this class called resource I was
like hold up what is this is this like
some rails magic but I don't know about
but actually it was a class that one of
my old co-workers had created and it
inherited from something called a simple
delegator which is actually rails class
and just going through the resource code
I inferred that this is a class that
contains logic for dealing with
attributes so you don't have to
duplicate logic between sterilizers and
I did my research on simpledelegator x'
and that's what it essentially was so
yeah like I said before it's a simple
delegator it's a ruby class and I did
more digging and I realized that it
actually implements the decorator
pattern which I am aware of so yay
software engineering design patterns and
basically a decorator pattern allows for
unique behavior to be added to an object
without affecting other objects so the
same class so we had to serializers one
for the Montagues and one for the
Capulets so one for items and options
and one just for regular perks and the
left was for a regular is for the
regular perk and the right was for a
perk with items and options so this file
called commerce perk underscore
sterilizer use the decorator pattern
through a simple delegator called the
resource so the previous slide I showed
you and then to the right that
serializer actually just put all of the
logic for querying data into the
serializer
and both sterilizers actually have the
shipping fees method so that was an
example of duplication that could be
consolidated together so given the time
constraints of the project and needing
to deliver the future
by the end of the month and also not
wanting to get blocked every factoring I
didn't get a chance to like combine all
the perks your lives together
unfortunately so I ended up creating
something called a base perk sterilizer
which was like the parent of the to
serialize errs and those sterilizers
wouldn't hang from them and this
sterilizer II would use the decorator
pattern which I talked about earlier and
it could be shared between the two
child's utilizers so yay
problem solved but not so quick so going
back to the client side of things I
became the mess I was in the client side
as I showed before the issues with the
repetitive typing's
and in case anyone needs any refreshing
or doesn't know the terms and angular a
module is the directory that contains
directives services and view templates
that you can inject into other modules
this is an example of Rize bility and
services are ways to communicate between
controllers and they're also wrappers
for api's and directives are used for
building views and widgets and it's also
place for Dom manipulation and dealing
with events so this led to actually
creating a file called giant and this
was the place for the code base in
general just to source services I made
API calls
so our architecture how it works in the
front-end is that we have different
modules for different features on the
site for instance perk campaign product
etc and like we just put all the
directives and services and all this
logic in this module and what was
interesting was that like we would make
the same API calls in lots of places and
we decided to put it in one place
because it's nice to have a place where
instead of like copying the code for
service you could just use that service
to make the API call so I ended up doing
that I created a folder and put perk in
there and since then people have put
other other calls to the API client like
campaign and product and as a result now
each module is a service rather than
importing a full component to make an
API call you can just import the service
and this is definitely better than
having to import an entire module with a
relevant code just to do one API call so
yeh success
so back to the stars perks so we just
needed one perk one perk to rule them
all and so since we were working in
typescript I had to make sure the
Taipings were also consolidated so I
created this one perk typing and then
also created one related typing is like
perk items and I put it in one place
because in the past it was like just
scattered around the codebase and it was
just really hard to deal with and
usually if people can find the original
typing they would just make a new one
and there would just be all this
duplicate and also like renaming of
things and then on top of that I also
had to settle attributes and remove
duplications
so I ended up choosing like earlier on I
talked about how they were shipping
underscore fees and also shipping dot
fees so I decided to go with shipping
underscore fees because it's actually at
shipping underscore fees as an attribute
in the model so basically when you're
building api's you want to have
consistent attribute names from like the
back end to the front end instead of
like renaming it and doing all this
weird like json magic with it so I end
up doing that and removing duplication
was great and it also reduced line
numbers and on top of that I converted
the factory into typescript so yeah not
all the perks are one per Coulomb ah and
it was a really good fake death and a
few of these perks died but they became
one hurrah yay so we've reached our
final act post mortem so as you all are
all familiar with with Romeo Juliet
Claire Danes Juliet Fixer death so that
young nineties Leo DiCaprio Romeo is
devastated
he doesn't she doesn't do that cuz so he
can get devastated but she dies too she
thinks he's dead anyways at the end they
just all die it's very tragic and sad
and even though this is kind of an
analogy to like even though we did all
this great work refactoring cleaning up
the technical debt it's not over we need
to implement a best practice moving
forward so we've got the technical debt
in some shape we all we've all dealt
with technical debt in some shape or
form
and as much as we don't want it accrue
technical debt it just happens it's just
natural it's part of software
development and obviously and in most
cases it's not malicious like no one
goes in there and because I'm in a room
code that like the other person gets
screwed up
no let's people to suffer and also on
top of that like I mentioned talking
about the project I worked on you know
there are tight deadlines projects are
running in parallel and like sometimes
you just don't have the time to sit down
and like actually write clean code and
that being said it does something we
shouldn't have addressing technical debt
as part of our engineering standards
like we should talk about it it should
be part of our best practices and like a
metaphor I like to think about is taking
out a student loan for instance um
whereas student loan is kind of like
technical debt
realistically you can't pay it all off
in one sweep you have to pay it off and
/ mentally so this is where the idea of
tackling debt as you go comes I'm just
doing it in small increments so that at
the end you end up with cleaner code
overwhelming yourself and also perhaps
extending deadlines and then another
thing I want to talk about is this like
refactoring is hard you often go down
this rabbit hole really I can fix this
and then it just keeps going and then
you don't make commits for it and you
have to like reset it and it's just a
disaster and realistically you can't
refactor everything set base but you can
pick and choose your battles and you can
choose a refactor stuff and what I did
was I documented things that needed to
be refactored
and it's really useful for the next
person who works on the project or
attaches a code base and even for myself
in the future because past julia might
not remember like all of these issues so
it's really important to document things
and then just here are some general tips
on like technical technical debt and
refactoring it's better to investigate
technical debt at the beginning of a
project then discover it later so it'd
be really awesome it would be really
awesome for more teams to like actually
spend time at the beginning going
through the codebase and like
identifying potential issues and then I
think it's also really advantageous to
account for debt when your sprint
planning and also integrate in the pull
request process like when you're
reviewing other person's code ask them
oh you know is this an opportunity for
you to clean up this code or like how
can we make this code cleaner and then
on top of that um when we speak about
technical debt it's a very like
engineering thing
and but but it's really involved it's
really important to get your PM involved
in the process because engineering isn't
just developers that software
development isn't just a fella purrs its
entire process full of different people
and then personally for me like it was
just really helpful to ask lots of
questions from the other developers on
the team who would touch the code
previously and you know on top of that
like people's skills are important and
then like I said in the previous slide
you can't refactor everything so it's
important to you know do it
incrementally and just tackle it slowly
just kind of like paying off student
debt and in the end it's just you know
nicer for your mental health and you do
end up with cleaner code and here are
some useful resources that really helped
me group after technical debt in this
project if you don't know who's Sandy
Metz's oh my god you should prepare
yourself because she was amazing and
just prepare to be enlightened and then
also check out don't reset hard this is
a talk given for my awesome co-worker
sienna bio
he or she talks about it in the context
of Android but everything she talks
about is applicable to different what
technologies and even mobile
technologies and then the last year
resources are by Victoria Koster Ranko
and Eric Elliott these were specifically
really useful for rails and J's specific
resources and then also I want to give a
shout out to judy judy was my manager
almost on the team i was on and like she
actually encouraged me to like give this
talk so thank you Judy oh yeah since I
have metaphors and analogies there was a
lot of technical debt between Romeo and
Juliet
you know the Montague Capulet beef and
it's interesting to think about cuz like
I carefully what their story like drama
you know makes things more exciting and
you learn more and you know maybe
technical debt is good it's inevitable
and we all have to deal with it and we
all come out as stronger and more
patient developers and when we tackle it
and something like I thought about was
you know you know maybe the drama made
their relationship like maybe technical
dad is okay and like it makes things
interesting and if you do know Romeo and
Juliet you know Mercutio
so this he's played by
after Henry paranoia and what's really
interesting about his character was that
he was neither a Capulet or Montague he
was neutral and going back to like
technical debt you know till dealing a
technical debt is very a very stressful
process and you want to play the blame
game you want to get blame and be like
this person at that but you know when
you think about it like ultimately it
isn't about laying blame and like
blaming someone to do it you have to
clean it up yourself so ultimately
everyone benefits when you take the
effort to improve code so let's tackle
technical debt like Romo true zero and
it's 1996 but really it's 2017 because
we've come along her way so thank you
for listening
any questions
has anyone see this movie I have a
really great soundtrack hey guys
when you were going about unifying the
code did you did they actually behave
the same because one of the things that
I might have expected that situation
that subtly the teams might have
introduced different bugs or different
behaviors by accidentally having
different mini code bases yeah that was
something like I was really worried
about because there were like two
distinctive features and I didn't want
to break anything but I worked very
slowly and trying to like refactor
things incrementally and then also did a
lot of manual testing like between reef
actors so I found that helped as well
Hey Judy Oh what was the testing
situation like oh so tested for Apple
pay is kind of painful so I am I'm an
Android user so I've never really double
around a lot with iOS and just setting
up like the test environment for Apple
was a pain and also just like getting it
to work but um it was a lot of manual
testing and for me like I had to test
from like beginning to end meaning I to
test like getting a getting a perk with
like a certain items an options
configuration and then testing
throughout the entire pay phone to make
sure it worked so that's another thing
like even though I only touched like the
perk selection I had to make sure I
tested that you could actually buy the
item and you can actually fulfill it so
yeah definitely yeah there was a lot of
like repetitive tests so that was a very
satisfying thing like deleting tests
that were repeated also like when you do
have a lot of tasks that like slows down
your test suite so it is nice a delete
test so yeah
user type script but how much code is is
everything typed at this stage no so um
we're kind of we're kind of like
tackling this as we go along but
basically every new file that we create
on the codebase we has to be type scrip
and there has to be typing for it but
there have been opportunities where
people have gone back and like converted
files to typescript but it's a long
process and we're even debating
typescript at this point now too because
it's kind of given us some problems but
yeah but in theory Lang in principle
like types are beautiful in their grades
so what kind of problems hearing are you
encountering with typescript um so right
now I'm on the performance team and
we're working on like optimizing the
page optimizing load time for the page
and like the problems that we've come up
with or like moving modules around and
discovering that like the Taipings that
were created don't actually match what's
on the server side um like with JSON you
can just put anything in any object and
that has passed on to the server side so
that was a huge problem just discovering
that like the typing didn't actually
match what was on the server side
I have a question about your approach to
refactoring so in the past I worked on a
code base that was less than wonderful
shall we say and one of the decisions
that I had to make a lot was XA in a
class or a module there's a lot of stuff
that's horrible and there's some stuff
that might be untested that's used all
the time and some stuff that's not use
that much and sometimes I found it
difficult deciding on whether to clean
up the stuff that's not used because
that's less risky and it means when you
go to the code the next time around
it doesn't hurt so much to try and
figure out the horrible bit or fix the
horrible date what's your approach
that's a good question I don't know like
I feel like like refactoring is
something that we often experience but
there's no like clear-cut instructions
on how to do it I think like cleaning up
unused codes for instance is a really
easy win and it's also really satisfying
so I kind of tend to do that first just
for like psychological purposes like
it's just nice to get rid of it and then
like getting rid of it also clears my
mind so I can just focus on like the
hard bits that I actually have to like
refactor and like write tests for so
yeah I guess it kind of depends on your
situation and like how much patience you
have yeah so like we always have
problems on whether technical depth
should be considered part of feature
work or it should be done as a separate
activity like basically lowering the
velocity of team for the following
iterations and like you know doing it in
a separate way so I'm not sure if you
have yeah that's a really good question
um so I guess like I guess traditionally
or like most people kind of see
technical or dealing with technical debt
as like a one-off like something that
you do at the very end to clean up and I
think when you think that way technical
debt becomes less important and you
actually accrue more technical debt and
just like weighting it and kind of like
the metaphor I said that's like student
loans I think it's like
but we should tackle it from the
beginning so like our teams I like at
IndieGoGo for instance we've like put it
as part of our engineering process like
time to like think about technical debt
and like time to refactor and it's
really hard sometimes to convince like
product managers why it's important
because they don't something that's not
tangible that you can't quite see
sometimes it actually is though because
like performance wise for instance but I
think just like making time to like
explain this to non engineers is really
important because technical debt like
should we addressed the beginning right
so yeah yeah like for instance like what
I was working on like I had to like
refactor because it was affecting
shipping and if I didn't do it then like
people can buy perks with shipping so
something like that like being able to
identify like the technical debt you're
working on and like how it maps to the
actual feature is also really important
so I think like the engineer has a
responsibility to be able to identify
that and communicate it to their p.m. do
you have any recommendations for
explaining the cost of the of the debt 2
p.m. I guess it's like what would I what
I was working on it was more
straightforward it was like yeah we just
like people can't buy this if this
doesn't work but sometimes it's like
more trickier so you kind of have to
pick and choose your battles and I think
for instance like writing out like the
different parts of the technical day
until like smaller stories helps and
being able to point them like p.m. is
really like to think in terms of points
and things like that so yeah I think
organizing it and like instead of just
saying oh this giant thing has this one
problem identified in smaller pieces and
hopefully that'll be easier for a p.m.
to understand any other questions
okay well thank you for coming to my
talk and go into it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>