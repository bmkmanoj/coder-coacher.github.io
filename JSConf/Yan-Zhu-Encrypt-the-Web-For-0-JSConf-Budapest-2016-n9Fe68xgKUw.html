<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Yan Zhu: Encrypt the Web For $0 - JSConf Budapest 2016 | Coder Coacher - Coaching Coders</title><meta content="Yan Zhu: Encrypt the Web For $0 - JSConf Budapest 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Yan Zhu: Encrypt the Web For $0 - JSConf Budapest 2016</b></h2><h5 class="post__date">2016-06-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/n9Fe68xgKUw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's make sure that's guys concede yeah
the slides are up so as a word of
warning I had a nosebleed right before
coming out here so if I suddenly start
like dripping blood everywhere please
excuse me while I fix that but like 80%
chance that won't happen so today I'm
here to talk about encrypting the web
for zero dollars which hope which is
hopefully an amount that everyone can
afford so when we talk about web
security people say oh well you know
what that slows us down like security as
antistick all to speed so I want to
start this talk by talking a little bit
about web performance because I think
performance is a good incentive to
security like if you can have both
performance and security that's a win
win and you have an easier time
convincing people to be secure so who
thinks the web is fast who thinks it's
not okay well so that was kind of a
trick question because what what do we
really mean by fast so let's look at
some data from the last two years on
websites from HTTP archive.org so as you
see the total transfer size of HTML CSS
and JavaScript is steadily going up over
that time the total request size the
total number of requests has you know
hasn't increased significantly
especially CSS is going up at a at a
higher rate than than any other resource
type the number of TCP connections has
actually stayed about the same
so each the average website opens about
40 TCP connections this number of sites
with flash which many of you know is a
huge security problem is thankfully
thankfully dying down but very slowly
the number of HTTP requests happily is
going up so which brings us to the next
point so we we all we probably all know
that HTTPS is the foundation of web
security if you don't have HTTPS you
don't have any meaningful
security so it's it's really a
prerequisite to anything you want to do
on the web so is is TLS fast yet and the
answer I believe is yes so years ago
people would have said no like TCP sorry
TLS handshakes are really slow
you shouldn't implement TLS but I think
the argument is that those arguments are
now invalid as one example who here uses
Netflix right quite a few hands so
Netflix is going to start securing video
streams over HTTPS this year this is a
really big deal because Netflix has a
huge amount of traffic and they were one
of the the last large websites to move
over to HTTPS so in 2015 people would
Netflix and chill you know but in 2016
you can Netflix over HTTPS and chill
which is way better and and to show you
how significant this is so on the the
first chart is the amount of encrypted
traffic in North America so weirdly in
this graph encrypted as read and
unencrypted is green so about 30 percent
of traffic is unencrypted 65 percent is
encrypted in 2016 when Netflix over
moves over to HTTPS that's going to flip
in fact about 65 percent of traffic will
be encrypted and a 30 percent won't be
so so this is a really big deal and if
Netflix can do it um so can we
there's this great website by oh your
Agora called as TLS fasciae and I'll
summarize some of the key points from
that so basically TLS is fast now
because we have faster CPUs and we have
a lot of cool tricks we can use to make
TLS less expensive so before we get into
that let's let's go over what a TLS
handshake looks like so your browser
says okay compute ok server I'd like to
start TLS and server says okay I've AK
knowledge that okay so the sender says
client hello Service says server hello
these are some cipher suites I support
and client goes back and says ok
this is the cypher I pick this is a
random data I'm gonna use as the seed
for our encryption and services okay got
it and then finally after three
round-trips finally we can start sending
data encrypted so this is usually what
people talk about when they say that TLS
is slow or TLS is CPU intensive it's not
the actual you know encrypted data part
it's it's the setting up of encryption
which takes three round-trips the TLS
handshake but there's actually a neat
trick called session resumption which
you can use to reduce reduced round
trips to to round trips in most cases
and I hope everyone has been using this
so basically on the server one way to do
it is that the server keeps track of
which client will like which clients
have been issued which secrets and the
client all the client has to do is say
hey look here's a here's an ID from the
last time we talked I'm just gonna use
the same secret data as last time so
that saves one round-trip and so you can
just say client hello server hello and
then immediately start sending encrypted
data so TLS session resumption is good
and everyone should look look it up and
you know figure out how to set it up in
Apache or nginx it's pretty easy and
it's a it's a good win another way TLS
is going to get faster is with HTTP -
how many people have already set up HTTP
- on any of their servers so it's
actually a very few hands I think maybe
like less than a dozen Wow
so so I'm gonna explain the motivation
for HTTP - so remember in 1995 around
one HTTP one was standardized this is
what websites look like around 1995 and
that's actually kind of what my website
looks like now but we won't talk about
it so there's this header right and unit
say like oh this is yawns MIT homepage
and then there's some content like yawn
is a really boring person etc and this
was really nice and really fast and HTTP
one does those quite well for stuff like
this but this is what websites look like
in 2015 20 years later
you know you usually have think of like
BuzzFeed you have a flash ad you have
some some like ridiculously coke-fueled
advertisements at the top you have some
Twitter polls on the side and you know
for ads a disguise that some tracking
pixels random JavaScript some clickbait
you know just like stuff you don't want
to see and like scrolling using
javascript etc sites are a lot more
complicated than they were in 2003 in
1995 and so it makes sense that we want
a new protocol to handle handle this
kind of document so I think of HTTP 2 as
like HTTP one if HTTP 1 took a lot of
stimulants some of the ways it's faster
are you use by no instead of text and
encoding header compression and server
push but the thing I really want to
point out is that in HTTP 2 you can send
multiple requests on a single TCP
connection remember earlier how I said
most websites use about 40 TCP
connections which seems like a lot you
can reduce that number and therefore get
more performant websites to illustrate
this ok HTTP 1 browser says give me
index dot HTML server site ok here you
go
browsers like ok great I got it now
let's get some stylesheets servers like
here you go
browsers like great now let's get some
more stuff so you it's just like you
know back and forth but in HTTP 2 you
don't like the browser doesn't have to
wait for the server to respond reply
before sending a new request so browser
says get index.html server says here you
go and I'm browser can just say get
styles and get scripts and then both of
those are sent over to TCP the same TCP
connection and so you can see like the
time has strung on the y-axis and that's
pretty great so obviously we all want to
use HTTP - um does that require
encryption this was a huge controversy
in the standards bodies because people
thought oh we should move to an all
encrypted web why don't we just make
HTTP to require encryption well sadly
the answer is no HTTP to does not
require encryption
but happily and practice it kind of
actually does and what I mean by that is
there's two ways to upgrade a site from
HTTP one to HTTP two one method is plain
text HTTP two and the second method is
only available over HTTPS so a method
one the client can send this upgrade
header and then the server replies with
a 101 with switching code and then you
upgrade and it's in the method to the
client says I support HTTP 2 in the
client hello of the TLS handshake and so
most importantly method 2 is the only
one that will be supported by Chrome and
Firefox so if you want to support you
know just these two kind of tiny
browsers you know maybe you might care
about then you should use the second
method if you only care about like curl
and really command line method one works
all right and here's what that looks
like a boring Wireshark dump but you can
see in the client hello there's this al
peon protocol and you can you can open
up Wireshark and look at your browser
and make sure it's supporting HTTP 2 and
your server supports HP 2 if you see
these fields and the client hello the
TLS handshake so that's great right and
that's that should be a good incentive
for all of us to switch over to HTTPS
but then developers say Oh HTTP is
really annoying to set up and maintain
how many of you have said this or heard
someone say this to you before yeah I
hear it less and less now but a few
years ago I think this was like
something that was really common
commonly thought and there's good reason
for it because previously if you wanted
to set up SSL over something like
DreamHost you would have this like long
wiki page with 14 steps and you'd have
to copy and paste certificate signing
request and like not accidentally copy
and paste or private key and do all this
this magic furthermore tziolis isn't a
fixed standard really because as Krypton
our Krypton cryptanalytic attacks get
better cipher suites that we used to use
are deprecated for instance rc4 up until
2013 you know
it was commonly recommended and then we
decided that like NSA can probably break
our c4 so let's just suddenly stop using
it and if you're if you're running a
server you have to keep track of these
things and it's kind of a lot of work
there's also a big problem called mixed
content blocking basically when you
visit a site over HTTPS the browser says
hey I don't want to load any HTTP
content because that's insecure and
that's gonna downgrade the security of
our entire site to http so the browser
instead of loading those HTTP resources
it blocks them and so this can be a pain
for you as a website developer if you're
depending on all these like third
parties that don't use support HTTPS but
you want to move your site over to HTTPS
so when you upgrade like all these
scripts and styles and images are
blocked and someone visits your website
and they're like this is totally broken
what the what the heck but there's a
there's a nice standard so I work I
hoped with this while I was in w3c
it's called upgrade and secure requests
so you can set this header called
content security policy upgrade and
secure request you know just copy and
paste this into your config file or
whatever and basically the browser will
automatically upgrade insecure requests
and treat them as if they were HTTPS so
instead of blocking those HTTP resources
the browser optimistically goes over
HTTP first and sees if they work and if
it doesn't work then it blocks them but
if I actually had to use this recently
because I did something weird with
WordPress and I broke my blog it like
WordPress just rewrote all my HTTPS
links to http and instead of like going
through my code and like manually like
search and replacing HTTP HTTPS I just
set this header upgrade and secure
request and then suddenly the browser
starts upgrading everything and then my
blog is nice and beautiful again okay so
things are getting better right from the
standards perspective and from from like
you know getting TLS into everyone's
configuration but still still TLS is
kind of hard
that's an arguable partly because it
used to cost
money so at iff and mozilla and and a
few other organizations a bunch of
people came together and said so how
about we just start a certificate
authority how hard can it be right and
how about we just give out free
certificates in an automated way that
takes like less than five seconds so
people can't complain that it's taking
too long and how about we automate TLS
configuration for everyone so that when
a cipher suite is deprecated you don't
have to like manually read hacker news
and figure out what to do we'll just do
it for you so let's incorrect it's
called let's encrypt probably most of
you have heard of it by now it's been in
public beta for a while so the way this
was formed was is RG is a new on
nonprofit created mostly from PFF
Mozilla and University of Michigan we
are funded by financial donations from
Cisco and alchemy and also from various
groups like Google for our actual
certificate we are working on getting
into the root certificate stores of all
the major browsers and operating systems
but for now we're Frost signed by a CA
called I don't trust so most browsers
will recognize us because they recognize
ID and trusts so we are seen as a valid
intermediate CA um thank you to all our
sponsors this is who they are in case
you're curious current status is we've
been in beta while we were in private
beta in November for months we're now in
public beta we issued about 10,000 certs
in the first eight hours which was like
whoa we can't believe this is actually
happening
one serve per 30 seconds and so far
there's been over three million
certificates issued the last time I gave
this talk was in March and that was 1.4
million so when I was preparing these
slides I was like oh maybe it's two
million by now but turns out in the last
month and the rate has gone up a bit and
they sent out over three million
certificates um here's the graph you can
see it's going steeply up and to the to
the right I always get right and left
confused
so more stats whelmed France seems to be
the most popular popular theology so far
Germany is pretty close though and okay
so let's talk about let's encrypt
clients because I think this is where
things are really interesting to you all
as JavaScript developers so let's
encrypt tries to address a lot of
different different well so there's a
lot of different different types of
servers let some could be addressing I
call this the let's encrypt the server
the server the server layer cake I guess
so at the top is people like Facebook
and Yahoo who are these large companies
and they run their own custom
infrastructure the one layer below is
people who've on like large websites and
they have multiple servers a layer below
that is people who run single servers
like me like I have a digital ocean
instance since made obeisance tenses and
then at the bottom is this like large
number of websites that use WordPress or
DreamHost where these people just have
these like WYSIWYG editors and they
don't really have a terminal where they
can like log in and do commands so
currently let's encrypt is pretty good
for the middle two tiers but we we still
need some help getting to the getting
the top and bottom layers so how are we
gonna take over the world well so the
good news is as I said if you have if
you're running common server software
will probably work for you already
so our official client which is in
Python will get you a cert and set and
even set it up and configure it on
Apache and nginx people have also been
really active in the community and
they've written these like libraries and
scripts for in bash Python etc just to
do the part where that you like get and
fetch you get a revoke and renew
certificates people have also made a
written integrations for let's encrypt
with popular servers like Express caddy
known middleware like happy and all that
and rails and there's lots more if you
if you want to see see the rest you can
check out our wiki so so that's all good
but if you don't have
she'll then you're kind of in trouble
because you can't just like log in and
say app get install let's encrypt let's
encrypt get me a certificate but there
is a solution which is that we let's
encrypt will partner with your hosting
provider and this is this has been
happening pretty rapidly so let's
encrypt already integrates with dream
host WordPress calm and OVH alchemy is
also working on this and it might be
available to some customers if you use
WordPress and you're using like self
hosted WordPress you can just install a
plugin that someone wrote and finally if
you just want a certificate and you
don't care about like you know having a
fancy command line and being all
efficient you can just get a cert
through your browser like you used to
back in the old days through HTTP GET
HTTP for free com okay so at the top of
the layer cake earlier there was this
this year that said large custom
infrastructure so if you if you work
with a company that has large custom
infrastructure or is a hosting provider
and you're too big to use let's encrypt
right now we can most likely make
something work for you so email us
sponsor outlets encrypts that's probably
not the best email but it was the
closest one I could find or you can just
email me directly we'd love to help you
get more as a sell out into the world
any way we can so yeah so here's some
more data on who is actually using the
let's encrypt client you can see it's
mostly people using our official Python
client and then their smaller numbers
using like the go caddy client and so
forth if you're interested in building a
let's encrypt client for you know some
life for some framework or from server
for some server where they're currently
isn't one it's pretty easy um I'll just
quickly give you like a high-level
overview of how to do that but you can
find all our code on github and you can
look at our Python interfaces file for
like the exact interface you should
implement but basically it's pretty it's
it's pretty simple there's a you have to
implement it an Authenticator which is
the part that proves to the let's
encrypt certificate authority that's
someone
actually owns their domain name so you
have to get challenges perform the
challenges and then revert changes that
were done to the server in order to do
their challenges the protocol is a
little bit gnarly so I won't get into
the details but it's all in there and
then ops and then you can implement this
kind of optional installer part which is
what actually puts the certificate into
the server and sets up SSL and takes
care of renewal so there's a lot more
stuff going on here like figuring out
what domain names someone has set up on
their server figuring out where to
deploy the cert where like which folders
it's been set up in and so forth it's
probably making your eyes bleed so I'm
going to gloss over the slide but at the
end of the day the point of let's
encrypt is that it's easy for people off
or server operators to use and so I'm
gonna show you how easy it is hopefully
in this one simple slide you can get
clone let's encrypt go into your
directory and just run lets approved
Auto to install and then once that's
done just run let's encrypt Apache to
set up on Apache
and in the future you'll be able to run
let's encrypt - - - - - engine X but I
think that's not not fully supported yet
and then later when you want to renew
assert to say let's equip renew and in
the unfortunate case that you have to
revoke a certificate let's encrypt
provoke so that's it's pretty much as
easy as like as it can get
okay and people are using this and just
to prove it to you
this is this was real Firefox telemetry
data of the percentage of page loads
that use HTTPS and as you can see as of
the let's encrypt launch the slope has
gone up visibly so I think let's encrypt
is making a difference in the world in
terms of who you how many people use
HTTPS so let's encrypt is hopefully
gonna make the Internet great again not
that it's not already great it's
actually already pretty great and if you
want to help here are some links that's
all thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>