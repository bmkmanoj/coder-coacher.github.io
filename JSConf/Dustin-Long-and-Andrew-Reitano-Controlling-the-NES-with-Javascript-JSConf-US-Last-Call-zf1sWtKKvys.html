<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Dustin Long and Andrew Reitano: Controlling the NES with Javascript - JSConf US Last Call | Coder Coacher - Coaching Coders</title><meta content="Dustin Long and Andrew Reitano: Controlling the NES with Javascript - JSConf US Last Call - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Dustin Long and Andrew Reitano: Controlling the NES with Javascript - JSConf US Last Call</b></h2><h5 class="post__date">2016-03-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zf1sWtKKvys" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we're presenting our
nest mg is as you can see it's about
remix in old school games with
JavaScript so go ahead okay alright so
first before we start on that she won't
tell you little bit about us we have a
common interest in like tinkering with
old machines we met through kind of a
hacker scene in New York that does
chiptune music made using video game
systems all computer stuff like that and
you know kind of like hit it off in a
way so as friends so we both have dealt
into like some nest development before
like home brew which is making her own
nes software I've done some hacking on
emulators and stuff like that and andrew
has done a lot of hardware stuff he's
going to talk a little bit about and
specifically this the system here which
is a dual port ram for the nes so so I'm
an electrical engineer by trade so I
mostly do circuit design and the NES
stuffs been hobby programming for a
while and so a lot of stuff I end up
doing for for fun ends up being around
these old consoles like super interested
in computer architecture if you go back
and you look at these systems they're
really clever so here's board for the
NES they're just flash carts you can
reprogram with your own software this is
the assembly line that's like that photo
this is a game actually Dustin worked on
eated all the programming and I just did
the hardware piece so typically I'm more
in you know embedded or like FPGA type
programming but when you work with these
old systems you need to be so close to
them like so conscious of what you're
doing that it's actually kind of a
rewarding experience to make something
run and this is just a Sega one so this
is a Genesis cartridge again you put
your own software on just like a little
dock you can flash over USB so this dual
port Ram mod was one of the pieces that
I worked on and then Dustin implemented
the software for it so yeah so first
just talk a little bit about what the
nes is a lot of you'll probably heard of
it but isn't in case so is a game
console released in 85 it was extremely
popular in the in the united states it
couldn't just blew up and revitalize
video games the important part here is
that it's extremely weak by today's
standards a pat CPU you make you do the
stats there and the key part is we only
have
a little more than two thousand bytes of
RAM so not a lot to operate too good so
Ness ma'am is a way that we can access
the ram in the NES while it's running we
can read it and we can write to it
manipulate it and basically kind of act
as a coprocessor in a way the the sort
of things you can do with it are almost
to your imaginations limit you can do
really insane cheat codes with it just
kind of types of experiments you know
like like weird things you just kind of
have fun with and it works both in
software and in hardware which we'll
talk a little bit more later in the talk
so yeah so that some of the things that
were inspired and that we were inspired
by angie was previous work with the dual
port ram was using python as a front-end
rendered graphics that way there's an
emulator called fce UX it's the most
featured emulator I guess you could say
for the NES it's a technically
cross-platform but in Windows it has
more features it has a scripting engine
in Lua which allows you to do similar
things to this where you can modify
graphics modify memory things like that
yes and we are really interesting
developer features is why we kind of
flock to it yeah out of a really cool
stuff you can do and that kind of you
know this definitely inspired forward
you have a hex editor you kind of look
at the ram while it's running but we
wanted to bring it to hardware right and
an accessory called the game genie was
was around back there in the NES that
allowed you to modify memory addresses
in the system but it was like you to do
it beforehand and it's kind of hard to
use it was a little weird and awkward
and you put a game cartridge into the
game training game shooting into the
system yeah you your one friend in grade
school that you might have actually
liked maybe had a game genie and you
would hang out with him just so you can
use it okay so just going to give you an
idea of what you can do with this we're
gonna do a quick demo okay so mm yeah
can we switch one of these screens to
the nes oh wow cool live demos yeah okay
so I thought that might happen so right
now we have the on the back of the
console there's an additional port here
and it's just a you are took a serial
port and we're reading it over and we'll
go over the background but right now
this is feeding live through USB to this
machine and Dustin will go over the
architecture but on things that annoyed
me most about this game is that you
can't see the score while you're playing
so this is a live representation of the
score and the so come yeah out of the
score and period they just scored yeah
great so actually you really can't see
it until you score so like sometimes its
neck and neck and you forget on a really
high scoring do you mean my cousin got
really competitive to put this so yeah
maybe let it run until you know the
timer updates live yeah and that's
reading from brand like real time just
funneling tons of bytes over the that
stream right yes not stimulated by like
counting down or something like that
it's coming yet it's raw it's actually
frame four separate decimal coded bites
so yeah and then TSA kind of manhandled
by bag and broke some my hardware but I
guess that's what I get it's okay i have
a video of it running but it was was
pretty much all for this
so we played this game a lot and the
yeah but completely lost his mind they
had seen it so we were just looking for
I was just looking for ways to
non-intrusive Lee extend a game that I
already liked without calling like a
hack or like disassembling it or reverse
engineering it I really want to just
take the information that's kind of
hidden to you and get like this third
eye into all the stuff that's going on
and then you could extend it however you
like there's like millions idea every
time I mean it's probably how this both
started with Dustin we talked about like
oh but what about this what about double
dragon what about you know we go you
know through all these ideas of stuff
you wish we could have done you know
game genie just wasn't enough I wasn't
enough so a quick overview of what
exactly we're working with here dismiss
cool so this is a diagram showing the
layout of the address space of the NES a
pet machine but it has a 16-bit address
which is why you see for hex bytes there
it's text on the left and the way the
memory works is the first eight pages
which is the two thousand bytes that's
the ram so that's the part that we're
targeting below that you have addresses
that when you read and write to control
the input devices the graphics the sound
below that certain cartridges have were
crammed we're not going to really touch
on that here but you don't just so you
know it's there and then below that is
where the game rom is so the stuff that
specific to each cartridge the the
graphics and sort of the the code the
levels the music sound effects all the
data for the game is in is in the rom
down there so again can't touch that
we're just living on the top there so
okay so Ness them the the system that we
have kind of looks like this on the left
you have a script you write for each
game and the idea is that they're very
convenient to make their simple you can
iterate really quickly with them in the
middle on top there you see the engine
all JavaScript stuff that kind of you
know middle where is it all together
does a bunch of magic if a web server
that handles the graphics on the bottom
client browser attaches and that's where
you get things like that scoreboard all
rendered in the client
browser running you know browse your
style JavaScript the right is the kind
of the flexible part where you could
have different backends one of them is
the serial port for talking to the dual
port Graham right here and that's what
we make it work on real hardware but you
can switch that out for the emulator
version so that you can run it on
software and your computer instead and
then there's things for like you know we
did testing Arduino it to make sure that
the protocol was good and then things
like mock backends for testing or if you
don't need a pack n for whatever reason
which actually does come into play yeah
oh yeah so here's an example script it's
a little hard to read but you can kind
of see the shape of it so this game
ninja gaiden you're like a ninja wearing
a blue outfit running down the street
like tackling people and dogs and stuff
this does a very simple mod to it where
it always sets you to have four lives
whenever you hit the B button to attack
you get full health and when you press
down it fills up your ninja magic nympho
so the way that it's defined you see on
top there is a field called memory map
within that you have to define variables
for certain memory addresses and you
have to know those I have the time so
there's a little bit of detective work
however you want to do it in there but
those define where those variables live
in the ne SS memory so i think that's
seven six months i should know this by
now 76 on top for the number of lives
you have when you assign that basically
now you have a variable called lives
that will represent that value in RAM
and then below that you have a couple of
methods just plain old JavaScript I can
do whatever you want on the JavaScript
side the the variables that you use in
the memory map are using data binding so
they're set every frame before you run
and then if you modify them they get
written back into the RAM so it's a
super easy interface you don't have to
worry about what's actually in the back
end whether it's real hardware or
emulator it just does the right thing
and then at the bottom you know kind of
just hook it all into the engine and
that makes it happen buttons are also
handled specially because we want to
know when certain buttons get pressed
the the engine will read in the the
buttons value from from Ram that you
also assign the address to and then the
engine
well calculate differences that it knows
when new buttons get pressed when funds
get released things like that yeah okay
and you're going to talk about how the
hardware works okay am I trying to go
through this quick think we're ready so
okay this is the the board that actually
installed in the NES it's just the bare
PCB but you can see it's it the
architecture is pretty straightforward
it's a microcontroller that's about
talking to keep saying dual-port ram and
what it is is it's static RAM and
instead of having one set of address
lines and data lines you actually have
two and they both can speak they both
can speak at the same time and there's
internal arbitration logic on the chip
and it'll handle what rights and what
has precedence and everything so this is
it actually installed on any NES so what
I did is I pulled the RAM chip the
little dip chip out there and then I put
my board where it was and then one port
maps directly the IDS so nothing's
hooked up like if that second ship
wasn't here the microcontroller would
still operate normally so there's no
interference but now we can read and
write it while it's running with no
interference at all this microcontroller
feeds to I'm act like a reset line and
and also the nmi which is like an
interrupt thing the 60 Hertz time for
that keeps games running yeah so I map
those for more debugging features taking
feedback sorry okay and uh okay just say
I've tried put together a quick system
diagram and the port a here this is
running to the microcontroller so let's
say this is the thing that's to reading
writing and doing on manipulating and
then the other one is running to the
Naas so it's acting normally what's
going on and then reset the nmi there
and that won't translate onto there so
this you get to see this but this is the
yeah right there and it looks like a
headphone jack it's just like geeky part
I liked on digikey which is just so you
are what the headphone jack i mean i
honestly i have that i'll try to go
through this quick 04 yeah so i'm gonna
run a couple demos and show you some of
the stuff i like to do with this thing
i'll go through make man 3 really cool
great cool so what we're looking at it's
actually a live dump of the memory
values as we go along and restless yeah
load up and it can we get an NES on one
of the screens somebody's gonna lose is
really far spall text okay so he's gonna
be playing the game and what I can
actually do is you probably can't see it
much from there actually can you hook up
the audio to the TV yep probably I don't
think I have any more cables about this
guy must know this is going into the
thing down there okay we're at a cable
skip over this one no that's coming out
of it oh yeah we're not yeah thanks so
we actually looking at a live memory so
it's actually funny you get kind of an
intuition as you kind of mess with this
thing so like you'll play and you back
okay where the lives and you'll you'll
stay right now there's more it uses less
intensive to use like the first paid 20
page because you use one less bite for
the address so you're looking here like
all the vital stuff is in here like his
ex and is why where he lives there and
like you know what level you're on and
things that get access your life for
instance so once you get this going
hopefully I'll use the audio part and
then I'll plug it right to the TV oh yes
I just get some audio so you'll be like
okay let me do something and then you
like walk left and right and then you're
like okay that's decrementing it's
incrementing sticker make it right and
then you know where it is and then you
could lock certain value so I wrote down
yeah some before how can you turn that
up I don't know mean
so like the sound engine uses a lot of
bites you know so there's like a you
know all these weird effects these four
Bravo things so it kind of hard to pull
off so like I said you get kind of an
intuition for it see find this here
so this is the sound and you can see
it's kind of syncing up with the music
and I can start messing with it live
well whoa that was this will get out the
restart that I demos so I see ya just
play the game and uh so he'd be really
cruel like I'm just hitting d to
decrement his life as we go down yummy
so like I could just well so now I
underflow now he's at 255 but a lot that
nice then I put on a sine wave if I'm
just having a sign table lookup so you
can like link that to like his ex ER is
why ok I hit the music engine that's not
right
there we go and I don't want to spend
too much time here but i actually have i
told you i was i'm on the line it's an
open collector for to do the interrupt
so I could actually frame step the game
by holding it down the ground and like
pulling it low so i'm actually telling
the thing not to use the interrupt
anymore just keep it grounded don't let
it do anything else so it's i'm stepping
well you might turn that down and then I
let him go so so for debugging that's
great so like I'm playing a game I'm
like you know if you were trying to
derive say like Mega Man's jump game you
know jump gravity for your game you
could frame step and see how many pixels
he moves one by one and they actually
watched the ramp as he goes you can see
is Delta Y it's the old stuff but you
know that's really interesting and my
favorite and I'll do a quick a while the
music went to hell gee just Lich's a
random address a random value so let's
go it's a died because that's gear that
wouldn't lock yeah actually punch out
really quick
thanks but so I have this thing where i
tortured my housemate and I make him
play megaman 1 and every time he jumps
it'll glitch a random address and the
game just descends into madness as it
goes so get this back up and but the
other really interesting thing is I use
this as a debugging tool so i'll write
to a known ram location and look at it
and helps me reverse engineer games but
then sometimes you'll hit like a ram
addressing me like whoa that already any
SME they're both oh yeah k goes from 1
nes sorry you'll watch stuff happening
like wow that's that's cool i'll be like
whoa what was that for like this one's
my favorite lee so this is not a game
genie code it's not something really i
couldn't find anything about it right so
it's actually the this right drawing
routine it's a how tall the
characteristics and goes to swing he
kind of like sometimes his vertical go
up but you know you go the other way too
but like you already feel bad enough for
this jump right and then now you yes sir
so and you know there's a real quick I
feel bad for so he sucks but i canna it
totally give some help back right at a
time you can you can mess with the thing
live and it's been really with a lot of
fun play with well okay so i want to
move on i don't want to forget this time
too much we have actually an interactive
demo really excited about this okay okay
okay okay so mm for the other half the
equation the emulator implementation
there is a software package expound call
JX court it's it's kind of a version of
nodejs that focused on bedding volvo
stuff like that and in particular you
can make a dll put it into some
application and you have a no chance
runtime so speaking about FCU x before
the emulator basically i did similar to
what the lua that'd interpreter is doing
but with javascript instead so that
allows us to have the back end that
works
the code you write once you know we'll
just work depending on which back-end
you choose when you start up our system
you can check out some of the source
there funny story it actually had a bug
were didn't run in windows applications
that thankfully was enjoy to figure out
and fixed so it all worked so yeah the
the key reason why we use JavaScript
instead of the previous languages that
were used python for for Andrews old
system and lua for the nes emulator is
that we could do it in both uh you know
we can embed it we can do hardware
manipulation excuse me and writing
scripts once you know everything works
and you have like a web interface for
free so some of the problems we ran into
there's some slowness in serial port ran
into that gave us some performance
problems never got around to figuring it
out might be OS X specific because
Andrews code and windows was working
okay that was my son there's a lot of
variables that we we couldn't nail down
there are custom drivers were using on
the mac that helped a little bit and
then the emulator version was was kind
of tricky until I realized oh yeah
threats do the right thing in this case
it won't slow down the emulator to a
halt and then utf-8 is always a pain but
ok more demo time yeah how are you that
works me now you gonna oh you gotta do
that one instead alright so how are we
on time okay
a little bit
alright sir this up should just do one
demo and then sorry that's why okay all
right quick oh sorry as anyone here
really get a counter who is you guys
gotta fight over it oh you're the plug
me in ya USB cool I need a victim suck
it out okay
alright so I know right huh 1984 1985
young video out oh yeah you can't tell
once again object right hmm yeah Oh
what's not full screen yet so you should
be able to see it live demos there's a
lot of moving parts yes it's tricky we
want to show at you all good yeah so I'm
getting up with their this move there no
this is the wrong one you put its
audience all right we'll do something
then so here it's a stampin here huh
there that work cool perfect alright so
we have a video mixer here like in key
I'll black so we were talking about
automatic games that was easy so give me
a swing across and get the favor here
alright we unplug the audio okay anyway
ha yes what you back I went through the
foot yeah and then down key so the
Tickells castlevania your vampire slayer
sirens all menthe and the game has these
right there yeah all right it has these
candles I contain items would you
normally can't see what's in the candle
so what this script does it reads the
memory of like the candle objects
figures out what's inside each one and
then like you know calculates their
position and draws it over on top so
it's it's nice to help with like you
have a certain item and you don't want
to get a bad one so you know like if the
the kennels safe to hit or not the ones
that don't have anything or actually
random value so there's there's no way
to figure that out given the fact that
we're only working with Ram not with the
program code you know we only have so
much visibility and there's only so much
you can do to like reverse engineer a
game and you know start enhancing it
like this but uh yeah you can see like
you know there's definitely gonna be
holy water in that one actually not in
this case I already have it but yeah
this one gives a big heart so yeah kind
of that idea
next we probably won't have time ok
that's what yeah we want to get a few
there but we'll we'll post and we're
going to follow right so yeah um things
in the future we want to do it would be
nice to have like an stl port for no Jas
so we can do local graphics without
having to go through a browser like this
the browser option is really nice
because you can do cool things with the
web hint hint but it's sometimes is a
little awkward and you know you could
make like snap you're more responsive
real-time stuff with with like SQL rain
the same process she'll report process
problems will be nice to figure out
bearing down on that at 3am last night
yeah and our reporting is kind of weak
right now like things go wrong and you
know something went wrong but not really
why yeah so some of the applications for
this things you can do that are cool
with it aside from just demos different
ways of having having neat input for
games so what was the idea you had well
I'm saying you can use anything like any
input you different computer you can
translate to what you said a really good
one before you remember no worries young
here we go sorry from talk there's like
the speedrunning community where people
play old games and they plan real
hardware in order to verify there's no
like interference with other processes
running in an emulators host machine and
as a result you know they want to be
like like really precise to like the
original games stick but yet when they
do timings for it you know it's like
second level precision you know they
know it's like oh you were half a second
faster maybe they down to 16
milliseconds you can get down to the
frame and you actually know exactly when
the boss died the frame you just look at
the ram of his health so this is gonna
give you later monistic right there you
go all right um yeah and also you could
do like you know web-enabled nes games
or something when I talks like that
would be okay sorry how much do we can
do audience participation you guys wanna
try this yeah so I when I was down in
Austin I met this brilliant designer
Zach Johnson who did he works with node
and he does a lot JavaScript like mi
Mouse stuff that was really cool he did
like a massive multiplayer joust that
like it's like oh so I met him and I was
like an idea to do this thing where
people would interact with the NES and
he whipped something together in like
four hours so we only got to run that
demo down there like 10 people so I
really want to run it for the second
time with much people I need that guy he
said he's got a contract so phones up
yeah everyone get the door L to go to
and contra victim
come on in and get your stripper rain
I'll get this we need you nothing sir
come on do I have to play no someone
wants someone out there we go thank you
it's concert in here Oh what you have a
 from I think it's only been like
six weeks I can't sit down oh so don't
turn around ok everybody else go this
URL and patiently wait yeah and then we
can get any s1 yeah let's get this right
there that will leave the laptop there
hmm is your thing running mm-hmm go have
a seat okay is everybody on all right we
have this problem yesterday so is it you
know if it's talking is it should be
printing to it should be script is
running okay oh right you guys are
already at it um oh it start to begin to
all a bit it's that it wasn't one check
me out check the yeah dude it's rd
alright just close it sorry one second
yeah every star something look like it's
not real Webster it doesn't matter how
do we bring it down now you know why
fine yeah I don't know quick all right
want a sec I'm gonna just do it out not
quite working yet no see oh man Suns
with sorry Zack if your line note is
getting hammered right now so it was
almost
uh oh ok there we go here we go okay
sorry about that problem but should be
working out I was the cereal this is how
did you get to get the idea someone give
uh too late I was gonna say something
bigger hey I keep going keep going so
thanks so much yeah we don't want to
keep too much time but you get the idea
this is an idea we had for a while we're
usually you you have an audience like
this who can basically affect what's
going on using all real hardware and
this mod yep and then uh till we screw
up with the person who's flying so it's
somewhat interactive that's it going
anyway well no good what was that I get
the point I have to be a lot of time
okay this'll anyway sorry yeah
they put this together in like four
hours or something he's nuts so did you
I can check out his site I should put it
back up he does a lot of interesting
node stuff there we go Zach Johnson yeah
all right thank you thanks a lot</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>