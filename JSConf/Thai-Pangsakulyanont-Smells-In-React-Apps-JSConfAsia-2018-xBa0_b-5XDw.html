<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Thai Pangsakulyanont: Smells In React Apps - JSConf.Asia 2018 | Coder Coacher - Coaching Coders</title><meta content="Thai Pangsakulyanont: Smells In React Apps - JSConf.Asia 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Thai Pangsakulyanont: Smells In React Apps - JSConf.Asia 2018</b></h2><h5 class="post__date">2018-02-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xBa0_b-5XDw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so why'd you come good
good afternoon everyone so this is my
first time that I'm giving a talk like a
fool and talked in a Tarascon like a
conflict outside of Thailand
so first I'm really grateful for the
organizers to have invited me here and
the past two days were really awesome
and I'm really excited for today so
let's begin so today I'm gonna talk
about smells in react apps and if you
talk about if if you talk about coach
males there are several books that talk
about coats mail and designs me as well
but unfortunately I don't read many
books so usually I read the articles on
the internet and piece them together so
these three books I haven't read them
yet so the contents that I'm gonna be
presenting today they are mainly based
on my experience so maybe they are not
perfectly aligned with those books and
maybe I may use a different term with
them but I really hope they will be
useful to you so my name is ty and I
come from Thailand and I'm a Thai person
and this is my twitter ID so at DT ints
so if you have any feedback about this
talk so please tweet it to me I would
really appreciate it you can also find
me on github as well so with that say
let's start so I really like to build
software for fun it's just like team
home and say in his previous previous
talk so in my free time I really like to
work on side projects so this is one
this one is a web-based musical
instruments and there are several
instruments you can choose from I demo
it in a Scottish year 2016 in a
lightning talk and some other time I
feel like doing something a bit silly so
here I created Windows 2000 theme for
autumn text editor the challenge here
dimensionless here is to replicate the
three-wheel in Windows in a
picture-perfect way so you think just
yes so this is really fun the other time
you see I sometimes I want to play a
music game like a DJ so I need a
turntable so I put a dish and put a
phone in a dish and let it send the
gyroscope signal to the game so that's
that's some of my projects so that you
see it for me the fun part is really
important because that makes coding a
fulfilling thing to do and makes it feel
good and when you could as a hobby it
will be a hobby that can also improve my
professional coding skills as well I'm
also really interested in how to make
software maintainable that's because in
one of my old project about 10 years ago
I put in a lot of effort developing it
but at that time I didn't know about
software engineering stuff so I keep on
coding and coding and coding and over
time it became less maintainable so that
we have seven thousand lines of
untestable code and at that point when I
do something or fix something another
appears you remember the last the last
demo the buck simulator so now
maintaining it it's not fun and later I
learned about software engineering so I
feel like I want to improve the code
base and add the tests but I have seven
thousand lines of
untestable code so that's also not fun
and as a side project I think it should
be fun and not a burden and this a huge
boring task so I start to feel that I'd
rather do something else and so the
development of that project stopped and
that's sad because I spent years working
on it
so what I learned here is that
sustainability really matters and so now
when I work on a new project I have to
make sure that it will not end up like
that one that's why I'm really
interested in this stuff and as you know
there are so many contributing factors
and so many techniques you can use to
make a software maintainable so later in
2014 I started working on a new project
and it's called amuse it is a web-based
open source music game using html5
technologies and I have the game with me
as well so if you wanna try a demo you
can approach me and so I want to make it
great I want people to play this game so
I need to make sure that this project is
maintainable so I organized my code into
modules and use webpack to bundle them
together I set up a fling to cache
common errors and enforce a consistent
coding style I set up unit testing
continuous integration and deployment as
well as I track my code coverage so that
took me three weeks to setup I
I just meant three weeks setting up the
project without doing any game
development and that sounds pretty long
compared to other projects but the
result is that it made a huge impact so
the unit tests they helped me to switch
from one library to the other without
fear that I would break the game a
decoupled architecture
to try out different wheel libraries I
tried two times without having to
rewrite the whole app and putting
implementation details behind an
interface lets me switch to a new
back-end service without having to make
a sweeping change across the whole
codebase also some features I can
prototype it in one night so in that
project I learned that a good codebase
it's like a clean table so where I can
experiment quickly and prototype new
ideas right away without having to first
move so many stuff that's getting in my
way
so after I implement the idea if the
experiment was successful
I try to refactor the code base to be
clean again ready for more experiments
to come in the future so I've been
maintaining this for about three years
now and I'm still maintaining it so now
I'm working out front in architect at
Tazewell and our app is using based on
react and redux
so we have many features I guess so this
is our tree view and this is just the
reader store and we have more than 900
components and over two years more than
20 engineers work on it so it is a
challenge for us to keep innovating new
features and at the same time making
sure the code is maintainable and we
have to strike a healthy balance between
minimizing technical debt and shortening
the time to market so pretty challenging
and as I say there are many contributing
factors to maintainability but the
things that have lived here they are
technical stuff and when when I work in
a team I learned that the most important
thing really is communication so you're
going to see a lot of code starting from
this light so let's see an example now I
created a module called music preview
and it exports five functions
the rest of the app only needs to know
about these five functions to use it
they don't need to know that behind the
interface of that five function lies a
big complicated ugly hack so you can see
like a four inside an if and if inside
an if inside and four in here and
there's a cache block inside a trice and
if in another if in the four so in
principle this would work fine because
the code space behind the interface and
other parts of the software are not
affected by it but in practice another
developer may be looking for a technical
solution and stumbled upon my hack since
I didn't clearly communicate that the
code they are seeing is the hack it got
duplicated so it's really important to
communicate with other developers about
when when you're writing code you have
to communicate whether you are doing
I mean while you are doing it and is it
the best practice is it the way other
people should take as an example so
another important factor is having an
effective code reviews and to do an
effective code reviews I think in my
opinion we should learn to recognize
smells inside our code and this is what
I'm gonna talk about today the first
kind of smell I call it information
leaks so let's see another example so
let's say in our project we have a
standard user interface toolkit which
contains the component that I use across
the app so one of them is this component
the user of water so we can use this
component to render and users of water
by specifying the image and the size and
we have three sizes to choose from small
medium and large maybe that's a bit too
large okay and later as we develop our
app we need to implement new features so
the code changes over time we have to
implement the messaging system and we
got the design
and this is our how a message should
look like on the Left we have the water
on the right some text so this should be
straightforward so I look at the user
avatar component and I saw that decides
that we need to use it's not there to
fix this we need to add a new size but
we already have small medium and large
what should we put in here medium large
quite lush okay so we did the most
obvious thing that makes perfect sense
we name it appropriately message because
it's only used in one place the message
right
so does this smells a bit to you yeah so
let's keep going in for now so few
months later I start seeing this
everywhere in other places that's not
related to the message at all so what
happened here let's step out a bit so we
have the message component which is a
specific feature it belongs to a
specific feature we have the user water
which is generic you say interface
component so the message wants to show
in a water so it uses that component in
turn that component knows how big the
owatta should be so it's aware of the
messaging system and when I see this I
think that okay some information is
leaking here because now the message
knows how to render itself but it
doesn't know how big the avatar should
be instead that knowledge is leaked into
the user of other component so the leak
here is that information about a
specific feature leaked into a generic
component making the component less
generic and more awkward to reuse so but
another reason why this happen is that
maybe because of our generic component
it's not flexible enough so we're gonna
try to make it more flexible to fix this
so we used to have four sides now we
have eight sides and now the message can
pick a size from the catalog and we
don't need to make any outward change to
it anymore but there's still a pitfall
here what would happen if we want to
make a new size between L and SL we may
need to adjust the size table again and
and maybe we have to go through the code
base and move it out to affect our it's
just out to ACS it out and so on
but fortunately at tasks well this is
flexible enough for us so we don't have
to do that but if you really want to
make it really flexible you can let the
user specify the size in pixel that's
really flexible but it may go out of
control right so to keep things under
control you can specify a list of
allowed size so you know they are trade
off to all of these three approaches so
this is an example where as mail calls
for a bit of code restructuring but
sometimes oh you have to do it's just
changing the name let's see another
example again we have a standard you say
interface to kit and we have a button
which the user can click we also have a
pop-up menu that the user can select an
item from it so help me with this I have
a button I have a menu ah menu button
okay
we're just putting it together so this
menu button you can click on it and a
menu opens and you can select items from
it but the cache here is that the button
must appear to be pressed while the menu
is open only until the menu is closed
then the button can return back to the
original state so at first thought we
may again start with the most obvious
thing here which is to make button and
step another prop called its menu open
so that if the if it's true then it
appears to be pressed but again thus it
smells a bit that's because now the
button is now aware of the menu which is
an entirely unrelated concept so
thinking a bit deeper we see that the
button doesn't really need to know about
the menu but it only needs to know
whether the button should appear to be
the
this example show that shows that a
simple naming change can entirely
communicate a different thing so when
people say it's just a name so you know
naming is really important so for this
kind of smell when I reveal code I try
to ask myself does this really needs to
know about that so that's how I do it
the second the second smell I call it
low cohesion and cohesion here means
that related things stay close together
let's see more examples here so now for
our app we need to create a navigation
bar and it looks like this so if I use
react bootstrap implementing this should
be straightforward so first I need an F
bar inside it header which contains the
apps name and then several items which
is shown here so that's it so far so
good again we need to implement new
feature and this time is going to be the
authentication system and we need to now
we need to update the nav bar to display
these two guys at the right so let's do
it first I'm gonna take in some props so
that we can figure out how to display
the nav bar correctly we're gonna figure
out whether the user is locking or not
and then at the bottom we're gonna at
the right of that row right side of the
nav bar we're gonna add the navigation
item accordingly okay
and now this is our presentation or
component but we also need to connect to
the readers store so we can do that
using the connect function from react
react leaders package so that's it now
looking at the component we can see that
it cleanly separates into three concerns
selecting data dispatching action into
the store and our rendering logic which
is the
sensational component again we need to
implement new features this time two new
features so now we need to update the
navbar Ken when the user locked in now
we need to display the number of unread
notifications and messages so coming
back to our code we already see the
pattern here so let's go with the flow
so first I'm gonna select some data from
the store and by the action creators
here and then late and then here I'm
gonna take in some props according to
the code at the top now going down to
the bottom here's the rendering logic so
we are going to add two more items here
so the notifications and the message
that's it so maybe we can zoom out a bit
here we can see the pattern here that
our code is cleanly separated into three
concerns but these concerns are
cross-cutting that means they have to do
with many different functionalities of
the app but if we looked from another
perspective from a functionality
standpoint we are going to see that many
functional parts they are intermixed
inside the code and this can make it a
bit hard to navigate the code if we want
to look for the code related to the
navigation we have to jump and skip over
a lot of unrelated code let's see a real
world example so this is options panel
from my project beamers so I need to add
a new option here so this is the
existing code don't worry about it
but to implement this here's where I
need to add a code first one there the
second one in the prop types there and I
have to jump down 80 lines to add a new
code here so seeing this
as I started think as I add more options
what would happen this part would spread
even more apart and I have to scroll up
and down a lot more to implement more
options in the future so some cohesion
is lost here and you can tell that when
you code you have to knit when you need
to do something simple you have to
change you have to jump up and down a
lot or maybe you have to go between
different files or even sometimes
different repository you can also smell
this when reviewing a PR when you start
to notice that I read this piece of code
but it but I don't understand it I have
to jump down and jump up and down and up
again to fully understand something a
particular feature and this can also
happen when files are organized by types
so in this example if I want to
implement a new feature I have to change
six files and Rauh grouping file this
way can make the architecture more
obvious so it's obvious we have in
entities interactors IO and UI here and
in a small project like beam use I would
say this is a pretty good way to
structure but once you have like 200
files of each types this approach
doesn't scale very well for us so what
we can do is we can try to aim for
functional cohesion we try to group
things by what the purpose that code is
instead of grouping by responsibility
like I'm gonna select data from the
store I'm gonna dispatch no this part
for message this part for notification
let's do that
so coming back to our code here's the
navigation component so I'm first I'm
gonna remove stuff not directly related
to navigation so this one is gone plop
tides gone and the rendering logic that
has to do with user message notification
I replaced them with specialized
components here so this components this
specialized components they are smart in
a way that the lucky enough item for
example it would know how to figure out
the current authentication state on its
own and renders the right thing so let's
now look at it again we connect to the
reader store we select some data we bind
the action creators and here's our
enduring logic so that's pretty simple
and and this looks pretty good because
now most part of the code is now
concerned with authentication and the
current user except for these two lines
which renders the nav item they are
still concerned with the navigation
right so we are losing a bit of cohesion
here again because if in the future we
need to replace the nav item component
with something else we we need to jump
from the notification I mean from the
navigation component at the top to here
and down to other components that
renders an F item so what can we do here
well we can delegate the rendering logic
so instead of hard-coding the rendering
logic here we let the user of this
component specify its own rendering
logic as a function so I'm gonna add
some prop types to make it more clear so
now this component is now only concerned
about the current user and the
authentication state it's no longer
concerned about how to render it it
belongs to someone else now so this
component is no longer related to
navigation
it's just authentication so I'll just
name them off and by doing it this way
the art component can be reused in other
parts of the app such as maybe
displaying some kind of content only
when the user is logged in by the way
this technique
that we delegate the rendering logic to
the users of the component is now
officially known as render props and
just a past few weeks
this just got into the official react
documentation
so let's come back to our navigation
component so at the bottom instead of
using a specialized component thus
moving the nav item down to other parts
of the code we can use the earth
component here and specify how to render
when the user is locked out and lock in
accordingly so now you can see all the
nav items are clip here so all we have
to do left is to change the notification
and messages to use the same pattern
then all the nav items are going to be
grouped in the navigation component
finally the earth component here if we
look at it the objective of this
component is to connect the user
interface which is here the navigation
bar but it can be something else as I
said to the data source which is here
the current authentication state so it
has what we call this kind of component
data connector component
so to recap once a component grow bigger
it can be hard to maintain so if we try
to split the component with the most
obvious way maybe doing something like
this
separate the logic part from the real
part but this can lead to the code
losing its cohesion especially when one
part would not make sense without the
other we can try to split the code by
the functional codes that is trying to
achieve and if we do this right it's
easier to make these components reusable
in other parts of the app so in
conclusions in code reviews we usually
reveal code for consistency for
readability
usually revealed for logical correctness
and this quality is relatively simpler
to review but define smells
they are quite subtle and it's pretty
easy to see the code as correct but miss
the such a design issue unless we are
aware of them and actively look for them
so to build maintainable software I
encourage everyone to develop the sense
of course males and be mindful of them
and today I shared you two kinds of
smells and these are the kinds of smells
that I encountered most in my
professional professional life I mean
coding and I don't know of any ways that
we can detect this males automatically
especially when it's concerned with
naming so we can check that we are doing
camelcase right but we cannot check
automatically whether this component
should know about the other component so
some human expert is required here so
when writing and reviewing code I would
like to encourage you to look for this
kind of smells and other smells as you
can find in the web and take note of
them last but not least not all smells
are bad for example duplicate code is a
well-known code smell but a duplicated
code can sometimes be easier to read
than the code that's not duplicated
because a code that's duplicated they
are more explicit and contains less
abstraction but once you increase the
level of abstraction it can be harder to
see what's going on and also that's why
I do placate all my slides instead of
using animations and in up with 201 and
202 ice here so in the end everything is
a trade-off
by making your modules smaller you're
gonna have more modules by reducing the
amount of code you have to maintain your
increasing third-party dependencies so
we have to make a lot of choices when
developing software and to see if we
have made the right trade-off look for
feedback from other developers so after
all we make code maintainable so that
other people can maintain it so let's
look for their feedback so that's all I
want to share today thank you everyone
for listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>