<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Malte Ubl: JavaScript - The Private Parts [JSConf US 2010] | Coder Coacher - Coaching Coders</title><meta content="Malte Ubl: JavaScript - The Private Parts [JSConf US 2010] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Malte Ubl: JavaScript - The Private Parts [JSConf US 2010]</b></h2><h5 class="post__date">2013-01-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DoqrsdEh1is" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">ah my talk is called JavaScript the
private parts or give him an hour the
pirate parts just quick words about me
I'm working a sinner Frogger in Germany
um I'm one of the guys doing j/s
comforter you my main project is
actually juice the JavaScript metal
object system I don't fully block on
non-blocking i/o and I'm trigger I'm
crème force so really i made this
presentation because the font the title
really funny and I thought somebody else
must have done it before because it's
such a good pun on the under good part
and just just don't um don't execute
this search because there's a lot of
porn sites that warn their users that
they need to enable javascript anyway so
what this talk is really about like who
in this room here learn programming by
doing like view source and that's like
the greatest thing about the web like
you can go to CNN why you ever do that
and see what what are they doing in the
background and I just heard this like
every time there's script tech in the
header little kitten dies so you can see
old CNN is not doing everything right
and there's other technologies like
these like you can do view source on any
iPhone app or flash f or Silverlight for
that matter so um and for keynote as
well but so and this is what happened
like a couple of weeks ago there was
this flash cs5 to canvas export coming
out and was tweeting about it say oh
it's great and I was mostly interested
in like what the export source looks
like what they're doing because I just
find that interesting and um then
somebody was replying like why does the
code matter you will do everything
within the flash IDE I said
well I'm source code groupie and I love
source code and this is what this talk
is about so don't expect like anything
new or whatever I'm just what I'm going
to do is I'm going to go through the web
and go view source and then look at
interesting stuff they're doing that's
it so um I find it interesting and if
i'm going to point out stuff that i find
interesting and if you guys find
anything else interesting just just
interrupt me so just a quick overview of
the tools obviously this view source on
the browser really important is the fire
bug net panel because you can if their
stuff being loaded synchronously you can
see it in there there's the depth
developer toolbar which is pretty
useless except view javascript panel
away you can just see everything that's
been compiled on the page so
unfortunately like a couple years ago
you could like view source and
everything and pretty much see the
original source code but then javascript
mini fire came along and this is the
first one I did it's pretty bad written
in perl and doing some how higher stakes
like to see okay this looks like a c++
style comment and cannot be code so
let's do away with it and remove line
breaks and stuff so of course nowadays
everything is little more complicated
you get the Yui compressor doing stuff
like rename variables and function
parameters and doing graph coloring to
minimize the number and the names of
variables used the stuff G zips better
and then we get closure compiler which
is even more fancy stuff like renaming
properties you all probably know that
you cannot really do that unless you
know a lot about those properties it
does function enlightening function
substitution right it seems ok this
looks like gather like let's make a
factory to make getters because it's
faster than writing down the function
and it does constant substitution like
you put in a function a constant in
somewhere and it creates a variable for
you and use that every time you you
actually would write down the front the
constant so what do you do about this
first of all and this is a nice tool
it's JSP you to fire
it has a comment line client and you can
use the website just paste the source
and what you get back is like something
that looks more reasonable than just one
line of straub script but still
obviously all the variables have bad
names and stuff so you will have to do
some work yourself and I did that work
on this talk so you're going to see
source code that's been manually reverse
engineered to include real Valerie
buildings okay let's go on our first
tour to google com you probably all know
this site and I checked how they do
their JavaScript and start it in two
thousand actually before 2000 they
didn't have any JavaScript on the
homepage and this is what they did
initially they try to focus the main
input field on the page and then one
year later they did a huge refactoring
and edit the function statement and put
the set focus until the unload event of
the page and then they invented like
minimizing your source code probably
manually as well and nowadays we're here
so this is like a lot more JavaScript
and it's it includes some interesting
stuff like for example the the google
com page works like there's a huge
there's some inline JavaScript and
that's all implemented really
defensively because it depends on a more
JavaScript that's being loaded
asynchronously and this is what's in the
page it loads yeah like a script tag
adds it to the page and it gets this
really fancy URL and I'd really like to
know what it what this URL is about I
thought maybe it was like content
addressing but it's not because the
really interesting thing is what what's
being returned and that is that Google
obviously does user agent sniffing to
deliver JavaScript exactly for you your
user agent so when you access this page
was Firefox this is what you get all
those variables are false and there's an
implementation for XH
are and there's an implementation for
get computer stuff for example there's a
lot more of course so you get go to the
same URL with Safari and this is what
you get so they change like this to true
and have a different implementation for
get computed style I find that really
interesting because they like the
general consensus would be to do not do
that because obviously like proxy
servers and everything could have a
negative impact on the quality of your
user agent sniffing but they probably
have done some testing on that so might
be something that you can try next thing
is which have really fun interesting as
Google suggests that the function where
you type in an S you type it gives you
results or possible searches to complete
your thing and that's obviously a
non-mandatory function of the page and
being loaded synchronously but then once
you load the court in synchronously it
depends on styles and so wait if you
would load those styles at an extra
stylesheet request then they might not
be there on the initial suggest result
and if you include them in the page
include none mandatory coat in the page
which you wanted to avoid innovate in
the first place so what they do is
pretty obvious they just generate all
the styles for their non-mandatory
optional features using javascript and
append them to the page um with just
like creating a style and style tag and
appending that to the current document
another thing that i found interesting
was that they obviously don't like the
chrome jason implementation the native
one I didn't like I don't know what's
wrong with it but she doesn't seem to
work so well just an observation and
then the I found this interesting piece
of code and I maybe I'm just stupid but
I just don't get what it's doing um I
mean it is maybe some someone here can
figure it out because it is eventually
calling this function and it's doing
stuff fancy stuff to the to the this
value but since
I mean this is not depending on this you
could probably just call the function
but maybe there's something magically
going on here anybody has an idea okay
maybe later next up is Bing anybody know
ping it's the search engine made for
Microsoft and it's somewhere like
homemade software so while all the
Google stuff is really fancy and
thoughts or they just do really like
like all of us do like regular
programming for example the the homepage
is kind of fancy in a way that when you
resize the window this panel here
resizes as well and maybe you'd think
you do that with like smart HTML CSS but
they actually attached to resize event
to the page and do like really um
homegrown calculation on what should be
the right size of the of the main canvas
and I find that interesting as well and
maybe they tested that it's actually
going doing better than doing it with
just the HTML but I don't know this is
where they attach the resize you in and
they take care of doing away with it and
unload so not it have memory leaks and
ie which is probably really important
when you're doing a microsoft search
engine okay next up is there anyone
you'll know that the ping image search
just endless scrolling so i only found
this interesting because i did an
endless scrolling implementation and
I've just looked whether they truck
figure out a really good way to come up
with the bright point where to load all
the other stuff but it's all in the end
really simple so you do the obvious
thing you know where the currents
rolling position is calculate your
height and then decide to go further
they also don't like f
real like magic in the place so to know
the URL that you're requesting for more
content day just to wreck X stuff on the
domain URL attaching like form it equals
HTML raw and stuff like that so anyway
that's for being so Rebecca here hey I
am you still part of my talk because i'm
doing like knowing in-depth code nelida
sort of dreamweaver around image role of
a code but good thing is you talked
about version 3.0 and this is version 2
point 0 and it's good example on why
it's good to have the good parts mmm
let's take a look at this it's it it's
somewhat like that google thing because
it's really hard to figure out why they
do all the office stuff and how it's
being it could be so hard to do things
like a change and images i mean even if
if it's smarter to do with hover there's
probably easier implementation of this i
mean it does some really heavy string
manipulation to come up with something
that you can eval I don't know why I've
already got something to do with
multiple document inside the bullet
large document object model that was in
netscape for which good thing is that
it's not there anymore also it's it's
obviously a really good yet to use
document as the main hole holding point
for your global variables and then it's
even smarter to to put that into your
global context so you're not you don't
have to like like use your global
variables as if there were in the global
scope no I guess you can do that um
actually I think it's good I mean I for
like JavaScript source code from 10
years ago have you seen many people
leave out the parentheses and the
constructor this is really fast forward
because I mean I didn't know that you
could do that until like maybe three or
four years ago yeah let's go to the most
interesting thing anybody here know um
omniture the good thing is they're owned
by Adobe so you can really hate them and
their it's a tracking company and
they're probably the the market leader
besides like the free services like
Google Analytics really expensive and so
they do enterprise-c trekking and
obviously they want to protect their
intellectual property because it's
really complicated code doing the
tracking the client-side really
important so this is their source code
and let me the wind there this is
JavaScript but it's not there's there's
weird things in there and here comes the
thing the things so they are doing
string bass obfuscation of JavaScript
which is maybe a good idea turns out
it's a really bad idea because I was
having this project and the page load
time on is 6 was 18 seconds and I mean
honestly I did have some JavaScript on
there and so I thought it was my fault
and optimized the hell out of it until I
came exactly the same point it's a
Facebook guys so I was defect in doing
no work anymore and it was still slow so
eventually I figured out it's the
tracking code and um anybody know this
graph the Microsoft guys figured out a
way to make like string computations
that you usually should be of big o n
complexity be exponential complexity
so you do a string copy and everything's
fine up until here and then goes boom
actually I think you go to the 18
seconds part I must have been here so
it's it's really weird and it can really
make John turn your day into a bad day
and the other thing is even if your
browser is capable enough to like do
this string computation in like constant
time or linear time you're still wasting
energy right I mean it's bad for trees
that you're like I mean amateur is
probably serving billions of pageviews
each day and on every single pageview
it's doing the deification of the code
because obviously it needs to eventually
eval that source code and um but that's
also a good thing because let's let's
look at the source again um go down to
the very bottom and there's really
interesting statement here it says
return c and I think C stands for a code
and next line there's the function
that's being defined way up there is
called as there's another global
variable now that that now includes the
source code of a page and being evil
they didn't want us to like steal that
because the source code includes like
statements or characters which are not
legal within JavaScript so for example
the I don't know English were the 0
character like which IE doesn't like
inside source and so you can't like
directly put that into your interior
file but turns out there's a really fast
implementation even an IE of escape so
if somebody wants to like not enable you
to steal their source the easiest thing
was pizza like for example use your L
escaping and later when you call evil
you just paste the lung string and
do that through an escape and it's all
fine there's probably smarter way and
probably could just remove the garbage
characters but that was what I came up
with so anyway um actually I don't I
thought I saw debris little slower so
I'm already done just too smart
something's up I mean looking at other
people coats maker smarter because
there's all those interesting things
that you would never come up with
yourself it also makes you a better
person of course and you can we can see
from the from the last picture with
omniture it the weapon avis need to fix
stuff so it's it's just this except with
obfuscation and you're often times have
bad ap ice and you can use JavaScript
monkey patching to make them nice and i
would think that's a good thing it's
just not not good to like lift with
bedsores so you can really fix it and um
sometimes stuff is being fixed so that's
it thanks for listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>