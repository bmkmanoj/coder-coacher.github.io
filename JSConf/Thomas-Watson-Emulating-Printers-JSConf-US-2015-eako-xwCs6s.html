<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Thomas Watson - Emulating Printers – JSConf US 2015 | Coder Coacher - Coaching Coders</title><meta content="Thomas Watson - Emulating Printers – JSConf US 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Thomas Watson - Emulating Printers – JSConf US 2015</b></h2><h5 class="post__date">2015-12-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eako-xwCs6s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">awesome thank you whoa this is too loud
I can hear myself at least that's good
um thank you for coming um so let's see
what's goes that should do it ok so if
they're so I think I think we've all
seen this world been in this situation
ourselves I have at least a lot of time
it's a really frustrating situation and
it says there's paper cam and you look
in it and you're open it up and there is
no paper can what a really think is
going on it's actually that the I mean
if you were a piece of paper in the
printer stock there all day you wanted
to have a have a little bit of relaxed
time and do some gaming right so maybe
it's not all that bad so we're looking
at a printer errors i came across this
conservation is working at a library and
i'm sure i couldn't figure out I didn't
know if it's a woman or a man but I
couldn't figure out the name of the
person but the person found this really
interesting 18th century newspaper with
something I think we've all seen on the
back of the this page we're seeing here
this is from a newspaper called purple I
think on the back it's is it's a smooth
printing everything is fine but on the
front side of the paper we have this
weird crease and when you when you when
you pull it you you have a printing
error because the piece of paper was
folded in a way when it went through the
printing press in the 1800 so printing
errors are nothing new this is also i
think one of my favorites it makes
absolutely no sense researching this I i
found that maybe makes more sense to you
guys and destiny because apparently a
letter is a size of paper that you use
in America but in Europe we like these
like nice even things that can divide up
into human smaller parts so we have a
different kind of letter or paper size
system called a4 a5 a6 but still I think
this was one of my
first first time to show this this this
era it was on an HP Latex yet and
actually the pc load that comes from the
HP series and the reason why it says pc
is basically this means paper cassettes
a paper cassette load letter just said
you're trying to print something to the
printer and there is like not a letter
so there's like an a4 piece of paper in
the printer but there's not a letter
piece of paper so please load some
letter because I can't print this thing
you're sending to me and the reason why
it says pc is because if we go back to
early printers you didn't have a nice
big display as we saw before you had
like two digits on the left that which
basically just a status code like you
have n HTTP status code or whatever I
mean serious zero means everything is ok
I'm ready to to accept print jobs but
you can have pc in there so so that
carried our way through to the large
plate when you when we have those so so
what got me into throw this this
printing stuff um to understand that i
will just tell you a little story about
a year ago I was fiddling around with I
have a lot of papal devices and one of
them is an apple TV and you could sense
it up to it and i also have an airport
express you could send music to that
into play music and I was all like fine
but I wanted to like be able to like
tweak the volume a little bit more than
you'd normally would be able to do so I
thinking could you like have a proxy in
between if you do something but then you
needed to like send the audio to that
proxy on that we have to send it to the
to the actual airport express to play
the music and I found out something
called airfoil they could do this but
you have to pay money otherwise after
like I think it's like 10 minutes it
will start to play static instead of the
music if you haven't paid the bills so I
was like I was looking online and I
found like a lot of open source project
that was doing this and but all of them
they were literally more like I want to
be a client and I want to talk to an
airport express on Apple TV and I was
like the other way around but I want to
I want to be an able to do I want to be
an airport express its their way to do
that so I
I realized that somebody already did a
little bit of research into the protocol
behind it but nobody actually
implemented a proper server so i went
ahead and thought okay I could do that
which was my talk at JS con tu this year
about how to to be an apple TV but
during this process I figured out that
the way that Apple TV works and the way
that you just pull up your phone and you
on YouTube and you want to just show
what you have on your phone on your TV
it just magically pops up and says apple
TV living room or whatever you did you
name it and it's like how does that work
and they figured out it was something
called puncture and then it I've
research that and I figured out that i'm
sure it's basically just a standard it's
baby the branding understand that
fracture isn't a is a name that that
Apple decided but the standard is called
silicon and silicon is an RFC or it's a
lot of RAC rfcs on the internet so it's
an open standard everybody can can take
a look at it and it's basically behind
the scenes is basically just doing
what's called multicast DNS so when you
have a local network you broadcast
package to the network saying a here i
am and i have these capabilities and my
name is called apple TV living room and
stuff like that let's hold standard for
that and it's called empty and SSD or
the SVS for service discovery and I
found that out and those was like that's
interesting and on NPM there is a module
called emptiness which basically just a
shallow binding and Telep apples
binaries for doing our emptiness stuff
like advertising a service on the under
local network which means that if you
have to compile it it doesn't compile on
system stuff so I thought okay um maybe
we can do this in native JavaScript in
or a note where I'm a note developer and
a friend of mine Matthias a meth in
church on Twitter and get up y'all will
you broach a very very low level mdns
arm module that basically just allows
you to send them a zpack
but it's nothing more than that where
the emptiness SD standard the service
discovery stand out that that you like
advertise the service on the network
specific specifically says there's like
three Rick NS records that you need to
use to do that you need it you have a
txt record 60 record is kind of like an
holdall record is this like a blob of
data I think it like hold a lot of
information about like the capability so
if you have OCD and stuff like that then
you need a SRV record which is basically
it's a fancy form of a record a record
the one you have for your domain it says
i have my domain com and it points to
this IP address but that s re work or
does the same thing except also specify
support number so it's actually really
really really nice so you don't have to
rely on a default for number like 40 80
for HTTP you can have a service running
on any port and then you had the final
one was a PTR record was basically just
a way to point to to to the ride a sorry
record to to you so you had the PTR
record hold says I have an embassy I
have an apple TV and then the punch to
the to this is a rebate code that has a
name of the Apple TV that you want
bigger be defined that name any time you
want how to be called living room or
whatever so I was looking into this and
I made a module called Sarah conf which
basically does this and while I was
doing that I took a look at all the
different kind of services you could
advertise on a network and this is part
of a huge huge huge document of
different services you can advertise on
the network some of them are proprietary
it's all it's all managed by i am a
internet assigned name and numbers the
same guys who also does um like you I
think they do comment on it and all that
stuff as well and there's one thing in
particular that destruction was like I
PP like what's that incident printing
for the call never heard about that
before um and I was thinking okay this
is this is service discovery this is
cyracom that I whole premise about about
Sara Khan is that you just pluck and
plays like no drivers it just worked you
don't even have to do configuration you
have to enter anything into anything you
just
quick and it just works so it's like how
can you have a printer they would you
could and it just works that seemed to
change me but normally I would think you
and each have drivers and stuff so I did
a little research into well I basic just
to use my silicon modules and say okay
I'm a I'm an IPP service and I'm on unit
I'm on your network and I'm I'm I'm for
3000 on my local and then I went into
system preferences and said okay let's
try to add a printer and lo behold there
was a printer called he gave it a name I
think it called it nokia something and
it's like printer called no jansen like
this is interesting what happens if i
install it so i click install and it
just went through and everything was
just working like it got installed but
if you if you everybody just said before
that I just basically advertiser
services in actually set up a server
listening on port 3000 I just add this
active service I was like okay probably
i can't print trip then so but but just
to check i spun up a tcp server on port
3000 and was listening for a connection
and then I tried to print it and see
what happened and there was a blob
coming in so something happening
something was happening but the print
job didn't go through it just said error
your friend Jeff just said error but I
got some data and I was looking at the
data it's like wait a second he likes he
was asking i could look in the hex and
it was a ski and it was like POS t /
HTTP and it eco did it and it looks
something like this it's like that's
just HTTP this is easy but better about
to check out this this whole ITP thing
so when I look there is also an RC so
you can go and look at the standard I've
become pretty good at reading RFC by the
way it's a pretty a pretty bad skill to
have maybe on um so so finally realized
what this IP hbu was so basically I PP
is actually a binary protocol but it's
using HTTP as a transport layer so the
operation layer is binary but the
transport layer is a tease p sub we all
speak HTTP and it's the only way twerks
is it just using post requests all the
time it's only it's only method you
always post request usually just just /
but you can have like different printers
on the same for and they will have a
different name a different path but if
you just have one printer we just have
it on this / and the reason why it uses
the slashes because in my in my when I
broadcasted the the service on the local
network I guess that I didn't say
anything so it just assume / I didn't
give it a path and you can see it's the
user agent in this is from OS 10 and the
user agencies cups which is can remember
what the sea is but a unique sprinting
service so what tournament comment yes
common unix printing service which is a
pretty found out like pretty well
established library on on linux and unix
and OSN so after the after the headers
these are these are the headers there's
nothing more than this after the head of
the body calm the body is a binary this
binary blob of operational protocol and
if you look at the hex of that it always
starts with two punch which is the
version number of a key piece and that
this is versions 1.1 and it has an
operation ID which tells the printer
like what is the client trying to do in
this cage is in this case is operation
11 which means get printer attributes so
the client is asking the printer what
capabilities that's the printer have and
there is a request ID which basically
means that every time I server response
needs to like just have the same request
ID at it is responding to so you can
have multiple requests running at the
same time and then comes a lot of what's
called attribute groups and attribute
groups are spaced with a the limit
attack and the limit attack 01 is this
what's called the operation attribute
group and it has like a lot of stuff
which basically is like key value pairs
and some can be like a raise and they
think the kind of like invented their
own system for storing data which is
really weird and then finally after you
get like a lot of these like data that
you i a'n't trying to send to them
sent to the server you get an 03 delimit
attack which basically means end of
attributes no more attributes we're done
now actually comes the document you're
trying to print it we're trying to print
in traffic in this case we're trying to
get the printers attribute so there's no
document but if we were trying to print
then the actual document which is
usually post script but can actually
can't be anything will come up with so I
wrote this thing IPP encoder which is a
encoder decoder module on NPM that you
can use to include a decode these are
lots of data and around that was pretty
simple to write something called IPP
printer which basically just sets up an
HTTP server optionally broadcast using
zero crowns on the network saying hey
you here I am this is my name I'm under
support and then just basically takes
whatever it gets and pipes it into the
encoder and handles the response and
make sure that then response so when it
gets I pee pee when it gets the get
printer attributes it knows how to
respond like it could be stuff like do
you support color or how many trays do
you have or what is the level of your
toner or stuff like that which is and
you can send error Coast back actually
you could like do pc load letter oh yeah
let's do that them okay
so boom so let's try to print something
maybe i should actually so so if we
basically can do I MPM install I peachy
printer and you can use it
programmatically so you can required
from your own stuff or you can there's
like it just a command line tool that
you can get run and now it's listening
on a port and it's broadcasting at the
same time so let's open system
preferences let's go to printers and
scanners let's add an infringer and
there we have it IPP printer that record
anything but let's do this you can see
it it's a generic postscript printer so
just no prescrip which is really nice I
click Add Printer and yeah that's fine
let's do this boom I have any printed so
um so let's I wasn't joking let's try to
print with sliced what do you have them
let's type in two slides so you see the
printer is chosen here and it's print
hello this was going on here while
printing
but that was it printed and there was a
PS file appears it's pro script so
that's why can't you take and preview is
really we need at an understanding coach
gift so we have my five pretty simple so
now we have a printer it's written a
note um and you can do a lot of cool
stuff of that oh yeah um no actually I
should so there's something called ghost
so i made so I made something else from
print cat there's a lot of opportunity
and gifts for print cat by the way so
what we want to do is you want to pipe
print or a pipe red cap to PS yes to PDF
meeting from standard in and riding
through stand up writing through to drop
the PF let's do this just run that and
then let's go bag in his add a new
printer now we have to print a printer
this let's go let this go in them in
Prince of life again and I think I'd
friend oh yes
and it will exit when it's when it's got
the first print job printhead wit will
exit but there goes it's an art you
basically just converted my my print you
up to PDF yep job yeah there we go boom
not as full of this all over the hook
okay yes cool um so that's a lot of cool
stuff you can do it actually if you just
run this again and then you can specify
a debug flag it's just our
this woops caps lock okay just want to
show you so if you try to print
something again this princess a thing I
think you see the traffic that goes on
there's a lot of calls back and forth to
to figure out what to do cool so all
this remember the hex the binary stuff
that i showed you before I basically
made a format that is really a little
bit easier to understand so so i decoded
and so what you can do is you can also
encoded using giving it giving it this
so if you want to make a response to a
printing client you can give gay son
values like this here basically this
seems to be a response to it probably
asking like do you support maaga colors
and i write back no i don't support it
this is a big quiz it's giving so this
is actually operation 11 the one you saw
before um it's saying Rick you
questioned some attributes for the
printer like Margot I swagga names media
supported I guess operation supported
print column of supported stuff like
that and I was finding back with this is
the stuff i don't know and then i miss
funding back with this is the stuff I
know so I I suppose these operations and
my printer state is currently three
which is idle and the reason for being
idle is apparently none that's the stuff
you do and these are all the document
formats I support like PDF pro script
plain stuff like that anyways ok so it's
what you do this I made a print to
Kindle I you can print something and it
appears on you can that's pretty neat
instead of you having to email it to
this like weird email that said that
Amazon gives you or you could like print
to your accounting system so so at least
in in the my accounting system
when I need to do my taxes it would be
nice if I have like the PDF of the
invoice that I'm or the the receipt so
if you adjust and it most accounting
system have this or many accounting
systems have this feature awake and you
can like import like a scanned version
of your of this stuff you your view of
your doing your book Camilla bookkeeping
on or I don't know you could print to
tweet I don't know how that we work this
stuff I'm working on now is NC fa e CP
which it stands for NASA's Nate NSA CIA
FBI ultra censoring printer basically
what you do is you print something and
it comes out like this I was also
working with the idea that you could
probably are change words inside your
documents to be funny one way or the
other or inject ads may be other so I
wrote this thing print bin last night
and print bin
this is print bit do you guys know
subtag made something called HTML pin
and there is a similar services out
there this is print win basically it's a
printer on the internet and everybody
can print to it and the jobs they
basically show up here and somebody
printed I usually be really careful what
you click here by the way because people
can print any sort of stuff I what I was
check I was looking at this the other
day just to be sure apparently nobody i
just made it yesterday so but this is
actually not me who printed list but
apparently somebody on twitter founded
and Crixus into this i don't know who it
was so and you could go here and you can
see details grow so basically all you do
new MPM install print- as a as a global
and primp in is basically just a proxy
it actually it's not a printer it's not
even a proxy that even is wrong size of
proxy all it does is it saying hey I'm a
printer on the network using the
puncture the circumstance out oh and my
IP is and then it just points over there
to to the internet and it basically just
allows you to have a little demon
running that's basically advertising a
printer that's not even on your local
network so that so we pay to be start
printing now I besides the printer on
you'd open up for another school so
let's go back here let's add a printer
we have print pin
awesome so now let's try to print this
too and you can you have selected pimpin
um let me go to there was a time go back
and then reload page and wait a little
bit there was postscript is extremely
huge by the way it's like a lot of lot
of data max often he tried to print the
Bible to me just as a joke because I was
advertising a printer on my local
network and he was like her kind of
printer Bible it was it was place he
just text a lot of pages though but it
was just text there was no images no
nothing it was stripped down version and
the HTML itself was like a few megabytes
the the PostScript was 630 megabytes
that's like it's just text I don't know
postcode is a funny funny funny fomin so
yeah that's it 15</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>