<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Bodil Stokke: Reactive Game Development For The Discerning Hipster [JSConf2014] | Coder Coacher - Coaching Coders</title><meta content="Bodil Stokke: Reactive Game Development For The Discerning Hipster [JSConf2014] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Bodil Stokke: Reactive Game Development For The Discerning Hipster [JSConf2014]</b></h2><h5 class="post__date">2014-06-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/x8mmAu7ZR9Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah staying within the theme I think
JavaScript development today has a
serious problem
we generally for the most part we write
our programs in a fairly imperative
style we go global mutable staged on
occasions object orientation and there's
a problem with that there's a very real
problem it's just too mainstream it's
not cool I mean but any self-respecting
hipster wouldn't want to touch that
stuff but we aren't really clear on the
alternative someway I mean what kind of
people will write codes in Si like that
done this thing I'm so much for
micromedex timing and enterprise
developers would do we want to be a
surprise developers no we do not
so we need an even better solution for
this so we have this thing called
functional programming and photo
programmers up in their ivory tower
femme salons they had all these amazing
words and concepts and things that what
you've probably never heard of math
sounds like it's a good start
so yeah you got your closely arrows you
got your needle um I don't know why you
would need a lemma but there you go go
burritos we don't mention the M word and
so on I'm gonna have to pronounce the
last one now so I go history morphic
people morphisms just
just for kicks he I practiced so much to
be able to say that so yeah
best function but there's all this stuff
baton what what's the ease of this there
are things
fortunately leaking out of the world of
Haskell and whatnot into you some into
concepts that are more relevant to us as
JavaScript developers for one thing
there's this thing called functional
reactive programming and in particular
this thing called reactive extensions
made by this guy called Eric Meyer for
c-sharp originally and then started
associate spreading out into other
languages and this guy called Misaki
essentially implemented at the
JavaScript version rxjs map that doesn't
look like years old cool t-shirt that is
Eric ware who's this done I don't know
it looks cool probably invented
something very interesting wait is that
the guy could see the day isn't it yeah
good job anyway so rxjs is what i want
to try and use today to actually build
something real I'm just gonna be once
I'm done introducing this thing I'm
essentially just gonna be writing code
so we're gonna build again using rxjs
and originally i i thought i'd just used
the dom to render our game components
and then I saw Angelina stalker
yesterday about the canvas so I thought
maybe we just rewrite this year's the
canvas and then just now David mentioned
this thing called react so I figured why
not use that so I just finally I was
talking I just rewrote this had think T
these reactors are back-end that's the
live by the way that was prepared so
react was in what's been invented by
these guys and Facebook and it's
essentially um well it's it's more than
just a renderer but I'm just gonna use
the rendering pot now wait we're aney
can you construct social and immutable
virtual dumb and then just push that
into the current um turn out to be
Michael very easy to do so if you're
wondering about reactive extensions is
essentially think of arrays you know
erase in JavaScript you can map them you
can filter them we can do all these
really function things with them and in
international extensions you have this
thing called an observable which is sort
of the same thing so I would also extend
over time so what we got here is we're
taken away and we turn it into an
observable and I've got this helper
function here called lunk which just
prints the what comes out of the other
end of the observable this it's sort of
like a stream as one so if we run this
we should be getting bONIES ben is a
cool we can map the ponies ponies map
only
like any and then that anything is
essentially I mean it looks just like
mapping erase at this point of course it
also works over time I've got this thing
here which takes my pony observable and
zips it together with an interval
observable which takes every half second
so if we love this we get one penny
every half seconds that is two ponies a
second that's pretty good and further of
course we can also keep applying these
functions they are still valid like say
if we're if we put a filter on the end
of this it's essentially going to filter
every pony as it comes in every half
second so if we are only interested in
bonus that and were the lesser e they
should do the trick notice they come out
a bit irregularly because there's only a
pony every 1/2 second but we only let
them the coolest ponies three so we can
go even further and we can make sure
that everybody knows that we're number
one i Sparkle and applause pinky Bach
and the completion there at the end is
when the string is done because there
are no more ponies so of course the the
stream can close anyway let's write some
code I got some code prepared already
just very basic utility stuff like Dale
it was talking about immutable data
structures so I made my own
implementation of the hash remap tree
slightly so it's simplified but it is
fairly efficient it's on4 for the SOC
function the earth earth function will
take two objects and squish them
together using the hash array math tree
function yes this just
this isn't really a hatchery mercury but
it sounded really cool to say and I just
got a function here to to click
coordinates to rather to check if a
corner to sunscreen or not that's gonna
be useful later and my bind key function
which essentially wraps the mousetrap
library which lets you listen to
Keeneland and turns that into an or
extreme so if I go find key space that's
gonna come out as a stream of spaces
whenever I press the space key anyway
let us get on with it so what you can
see on the right here is the sky above
bonia middle and we also need to put
some ground there for our character to
run along actually we should better just
get on with the renderer as well so the
way i'm gonna do this is I'm gonna have
sort of a scene graph it's not really a
graph it's just gonna be an array of of
elements and the ground elements or all
elements are going to have an
x-coordinate and they are going to have
a y-coordinate they're going to have an
idea which just is just gonna translate
directly to Adam class and this one's
called ground but but exciting so far
and I also got this idea of being able
to offset coordinates so if I have this
thing called base ax a minus 128 that's
always going to be added to the accident
when we render it just to make some
calculations and it's lazy to follow and
me going we're gonna have to write in
the round red for that first of all
we're going to have to have a function
that takes a node like this and turn it
into a react develop a
with a class name of merit ID and a
style of client left then X plus their
base acts as I mentioned or if that
doesn't exist than zero and of course
instead of master flow Thank You
Angelina no we just bitwise all that
with 0 and plus BX because CSS same
thing made sy was their own and that
would get that should do it
that should get us exactly the element
we need obviously that the dumb class
has some CSS attached to it say this
crown is gonna have a background image
that's already and then in a function to
render the whole thing it takes a list
of these notes like grant and it simply
can't react at render component with
parent 'iv with no properties and for
the second argument we just give a list
of reacts dominates which is gonna be
children and we can just simply take
notes and map make elements and that
that should do it
so we need to only component takes the
target that's why I don't hope you
notice I find the the elements with the
idea of canvas and puts it in the
converse variable so commerce and then
we should be able to give that a list of
names currently in the ground and that's
the ground thank that's the DOS
um but the ground is opposed to move so
this is why react is gonna come in handy
sorry in writing exceptions instead of
the ground object we can make a ground
stream let's just get rid of the object
by the way well you won't leave us any
more
but we got the rain wrong engine now and
we create an observable and every 33
milliseconds that should give us is that
30 or 60 frames it's gonna fire off an
event and when that happens it is
actually going to be counting up from 0
to infinity every 33 milliseconds so we
can map that onto a function which takes
the ax which is going to be the number
and returns an object like this so
you'll notice by the way I'm using es6
because why not we live in the future
now
so that would be ID grant and also
that's why that's living in the future
nobody wants to type that functional
thing on the time-base axe is at minus
128 it's 10 and X is X margin is 64
times minus 8 that's gonna keep us a
best bets gonna make the ground scroll a
bit until he's almost at the end of the
texture then it's gonna loop back and
scroll and hopefully it's gonna be
seamless why it's still 3/8 aful that
should do it of course and we are gonna
have to plug that into the rendering
engine and we can do that
we could actually just map if the
redness in function just took a note we
could just map that stream directly to
there an Essene function but as it takes
a list of nodes we are going to use them
all right observable zip array function
which takes any number of our extremes
which is positron stream that's gonna
give us a list of just grab the ground
stream and that we can map directly
entering the scene so that didn't work
at all did it
sorry sorry sorry subscribe but
subscribe is the endpoint of a stream
essentially it takes a function and says
that whenever this stream produces
output please call this function with
that athlete so it's like Matt because
that actually of course is the stream
just dr. bad that's better
are you kidding me applause for the
ground your mind is gonna be so clever
when the pony shows up speaking of which
let's get the pony in because what is
the game without a pony oh we're gonna
have to make a stream for that as well
first though we are going to you make
there's a stream that lessons for space
key presence and not just that but I'm
going to buffer that and interval that
is free what this is going to do is
every 33 milliseconds it's going to give
us an array of however - basis were
pressed during that interval so it's
gonna be like our our frame take but
it's gonna come with key events as well
and let's get there's a pinky stream
and it's gonna be actually it would just
plug something on the tick stream you're
gonna use the scan function which is
sort of like an event leave just for
pinkie and that takes a function no
sorry it takes an initial State
this is going to be one of those need
objects alas so this was called pinky
and her base y is going to be 276 that
makes it look like she's on the ground
when y is 0 and of course x is 0 and Y
is their own and I'm just gonna add the
rest of the state we're gonna need to
her because she is going to be affected
by physics so she has an X velocity and
a Y velocity and she's also gonna have a
flag which says whether her game is over
or not if we get as far as actually
adding enemies but I'm not sure let's
see
and that also takes a function which
will take the previous version or pinky
and it's gonna take the keys which is
what comes out in the stream that we are
attached T and this is where pinkies
game loop should occur I'm gonna need a
function that applies a velocity that's
gonna be generalized and this one right
we can use that velocity later and we
use the magic as a function from my hash
remap tree library we apply nodes sorry
let's just call em and - I mean we apply
XS and X plus and the ax and likewise
for y right how'd you do it so now we
have say P with the lost city of P
notice that because of the magic
immutable data structure function this
is gonna return any object and
as long as we're inside this function it
doesn't really matter if we mutate that
object as long as it is a fresh one as
long as we don't mutate what comes out
of the function so we're just gonna be
cheating a bit here for anything we want
to actually just let's see if we can
make a show up just add pinky stream to
a zip or a down here and now hopefully
yeah we ain't got a type it should be
capital y that's pinky and of course of
course pinking is affected by gravity
only because she wants to you but geez
that's a point 98 right so oops yeah she
needs to hit the ground and stop I think
so if pinkies y-coordinates is greater
than zero that will be below ground then
please make her be at zero and make her
stop no she's taste on the ground but
course we want her to jump and that will
imply that if the first element of the
keys array is space we don't care about
the other elements you can only press
space anyway so if we press space then
give her an upwards velocity make her
jump
what the that interesting I win a
manager into fitness interfering with my
key bindings but okay
I just had to switch focus so she jumps
and she can also keep jumping apparently
okay so we need to make sure that she
she's gonna come that Anna mentioned
don't worry I mean we need to make sure
that she can only jump high and she's on
the ground
so I think just now
I'm not gonna at the color braces it's
okay for Apple so it's okay for me um
that should do it and why were assets
actually nice had the curly braces
because I actually need to do more here
we're gonna play some sound when she
jumps they play in the jumps and I never
say no matter how hard I press the space
key now while she's in the air she
doesn't keep something so that's a good
stuff
I think that little fingers physics know
she needs something to do I thought that
I mean obviously we are already inspired
by a certain game so I thought maybe
thinking one might have collect some
coins so that adds in the coins we need
a initial coin time jack coin object ID
coin the X is minus six V is zero agus
is a thousand and Y is four C but
actually give us an object that is gonna
come in from off screen as a certain
height which then pinkish a jumping
catch that sound reasonable
so we need a string for that of course
pinky is going to affect the coin if she
touches the Colleen she's going to
collect it so well openly then is
essentially plug the pinkest stream into
this new stream that's gonna feed
pinky's node into our coin stream so we
can respond to it we're gonna scan again
initial value is initial coin and we're
gonna function that takes e4 coin and
pinky idea and quite simply is the
velocity function to apply minus 2t and
so if if first of all the idea is that
one pinky touches it we're going to send
the coin just moving straight upwards so
we can use the velocity to detect if it
has been caught or not if it's zero it's
okay and I got this magic function that
I didn't show you which is just a bit of
math which can let us know if two nodes
intersect with each with each other so
this will be true when pinky touches the
coin of course we need to place a trim
sound coin mp3 can you guess what that
is gonna sound like and when that
happens we are going to stop the
horizontal movement and we are going to
send that thing as going upwards and
moreover huh I'm missing a watch oh god
yes thank you
pair programming yay
okay so if it is moving upwards in fact
we want to increase the velocity so it
goes faster and faster upwards and again
okay and it's them all okay finally and
remember the on-screen function this is
why we're gonna need that because when
the coin goes too far arms off-screen
upwards we just reset it or if you fail
to catch it and then goes up screen to
the left then we also reset it so the
cysts of screen on screens are in then
we just return see otherwise we go back
to the initial state and of course the
initial state is not mutated because we
aren't crazy we use the immutable data
structures now so let's see we need to
also add the coin to our rendering
stream and see if the coin shows up and
if I can manage to catch it well that's
a coin it's a - going and icon says
oh yeah that was handy that was all
my work done but fortunately I happen to
how much it's night in case the puppets
say what I'm going to do you or exactly
my coat no it should be on top when I'm
looking for yes because I wasn't gonna
add a hang time and that as you can see
is that much good so I'm gonna just
rewrite that however this is gonna be
too time-consuming to remain I'm just
gonna explain the Dutch words but I'm
gonna add the hater stream much like the
coin because you know us brainless we
are quite frequently bothered my haters
on the internet so I thought I hate it
would be a good enemy
some people feel threatened by paintings
I painted me with eight pixels to the
left and all of this turns out that's a
thousand of screen while 300 is gonna
have a it sort of on the ground action
d7 anything semicolon just in case it
was cooked when it finds out and data
stream hey turn stream sort of the same
as pinky every tick
starting with the initial hater H and
Keith
it doesn't actually increase we can take
that out because it's a static type
checking you're crazy and the H is
velocity of H as previously and just
like coin if they hate it goes off
screen it really stops initial time
right I'm just gonna need to take up
something else down here this bit but
notice what I've done up here though
instead of just subscribing to tick for
for pinky I sip tick and the haters tree
together because pinky responds to the
hater stream the hater is completely
unaffected by pinky but if pink it
touches the hater game over
so I have squished these two streams
together and because of a year six what
comes in is an array of keys as before
and the hater so we are doing D
structuring here because we can now in
the future let's see that even runs it
doesn't expected as much C is not
defined
I asked see up here it should be age for
hater not see for coin thank you guys
okay there's a hater
see I have two minutes left I'm actually
just gonna because now of course she
doesn't die but I'm just going to paste
this back you don't have to apologize
I'm gonna try and briefly explain it but
we are running out of time so
essentially the same thing if pinky and
a hater touches touch and we are not in
game over yet then go to game another
move pinky to the game of a class which
gives her a different animation play the
game of a sound and send her going
upwards and if we are in game about we
she's just gonna like go whoa like Mario
does lunch when he dies
so instead of applying regular gravity
he we apply half gravity because was so
I just play the game over hater he says
where's the Queen that's a cotton this
is gonna be a tricky job
and now ladies and gentlemen that was a
game using reactive extensions and a
little bit of react because everything
is starting with those five letters is
awesome and you need to start using it
so and I'm not gonna be able to match
Angelina but I did as well as I could so
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>