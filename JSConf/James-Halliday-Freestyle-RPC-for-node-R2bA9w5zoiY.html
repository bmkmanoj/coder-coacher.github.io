<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>James Halliday: Freestyle RPC for node | Coder Coacher - Coaching Coders</title><meta content="James Halliday: Freestyle RPC for node - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>James Halliday: Freestyle RPC for node</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/R2bA9w5zoiY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm James Halliday or sub stack on
github and I'm going to talk about D
node which makes RPC awesome so as I
said easy as cake with D node you can
just string together your processes like
like nothing you just hack up a server
here require D node and then just call
it it's it's a function you can define
methods on it you can define
constructors the cool thing is you can
define functions in your D node server
and then those functions can be called
by clients that connect so like here we
have just a simple sting function that
has two parameters N and a callback and
then you know when we get a request in
we just call that callback with n times
100 and listen on port 5000 and here's a
client that makes use of that server so
it just goes denote connect port 5000
and it gets this remote object and you
can call the the server function which
was Xing as we just saw and it gives it
some parameters and you just get the
callback and and these processes can be
living on different servers or the same
server it really doesn't matter because
do you know just figures all that out
makes it all work so yeah no schemas
none of that about XML no like
making your own silly JSON thing that's
gonna route your your a synchronous
callbacks to where you need in your
program you can just pass a function
directly and it makes it so much simpler
so here's here's these two client and
server side by side servers on the top
and I'm just gonna go through kind of
what happens when you make a remote
function called d node so oh goodness
that's supposed to be red I don't know
what's up with that anyways so here we
call this link function
we give it 66 as the end parameter okay
this one's good and then uh you know we
give it this callback here that has just
a console dot log now in denote the
functions execute on the sides that
they're defined on so this console dot
log is going to execute on the client
because that's you know where you've run
the program it's not like sending around
a serialized to string of a function or
something silly like that it actually
sends references so that callback gets
passed into the function body and then
the N also two computer results that we
get back at the client just as a
parameter directly exactly like is as if
all of this was running locally except
you don't get return values because
that's not very asynchronous you know
and then you can just print it like this
so you just launch your server you want
your client and you get your result back
it's very simple very very easy to get
started building this stuff and so you
can sort of incrementally build these
awesome programs like I have here but it
might be a little bit sketchy getting it
uh entirely working with this network so
 yeah callbacks so you can actually
take this code this sort of server
client TCP streams like I just mentioned
that example and just throw it up on the
server with exactly the same code except
you know okay here in the first four
lines we've got a web server and then
instead of a server dot less than 5,000
we just server dot listen app
and it's a web app and it just knows how
to make that work with socket IO so yeah
and you can actually do both - so you
can like serve it out listen app and
server dot listen on five thousand and
that will like host a web server and
have your TCP service so you can have
like your your hacky back-end code that
like connects to the TCP thing and you
can have your nice fancy front-end that
connects to your web server and it's
it's the same methods for both so like
if if you remember the client we just
wrapped up this is basically the
equivalent in browser form so just some
basic HTML you just throw down a script
tag and D node makes this /d nodejs
available for you automatically so you
don't have to really worry about messing
with like deploying client source but
anyways you just pass in your 66
parameter and you pass in your callback
and you get back the end value and if
you go to the browser that's what you
see pretty much exactly like the client
I mean it's exactly the same sort of
code except for instead of console dot
log we have you know inner HTML thing
because I'm not using jQuery for
simplicity here also denote works
awesomely with browser if I actually
behind the scenes its wrapping the
client source that's like /d nodejs the
the browser side version of denote that
it needs to do this crazy trickery with
browserify already but you can also use
it explicitly browser fight is a is a
browser version of require so you can
like load up npm modules and craziness
like that and bundle everything but
here's just an example of that you can
just require d node in your little
browserify line there as a middleware
and then the code becomes even nicer
because it's even more like what you
would write on the server because now
Verdi node equals require D node and you
just you know throw in a window dot
onload and it's like even cooler so
basically what's going on here is you've
got your main denote constructor and
this can take either like just an object
with you know keys and values you can
pass attributes as well as functions and
or you can use it like in constructor
form like I've got here up on the on the
bottom it's basically just like if you
call new and a function it does the same
sort of trick where like there's this
implicit return at the end that returns
to this object so makes it a really
compelling use case because you can just
go this
whatever and you can have access to the
remote object which is the first
callback parameter and the connection
objects which you can do cool stuff with
like listening for different kinds of
events that happen and like ending a
client's connection - right one thing
that's a little bit tricky I think for
newcomers is remote isn't always
populated so because each side sort of
needs to call the others constructor to
figure out what methods it has and so
like something's got to give there you
can't like know about it before you get
it from the other side it's you get
deadlock so you can do a use the
connection object on ready to get that
event or if you call connect you get
that stuff so the other way to connect
with denote is to call the dot connect
and dot listen you could pass a callback
to that I've tried really hard to make
Dino just crazy usable and so you can
just throw fricking ports or host names
or callbacks at these constructors in
any order and Dino just figures out what
you probably you know mean by it I guess
that's not always um it's it's not for
everyone but I think in this case it
really works cuz you can just you know
not have to worry about argument order
and in the callback of course you get
the remote and the connection that's a
pretty consistent convention throughout
the you know I mean there's only just
that callback and then the constructor
callback and then for convenience even
further you can just do like Dino dot
connect instead of actually you know if
you don't even have a constructor or
anything that you want to host either
side you could just call that so Dino
does callbacks really I guess pleasantly
surprisingly something like this would
actually work because it's not just that
D note is looking in an object or you
know the results of a constructor for
functions it's actually looking for
functions whenever you call a function
in in one of those callbacks that you
supplied in the first place so here we
have like three layers of indirection
and you can just go all the way all the
way with this it's it's actually
entirely recursive so you can pass
functions around like crazy which is
great if you're making these complicated
stateful applications where you sort of
need data to be in every which place
throughout your interface sort of oil
unavoidable so D node makes that
possible at least it I mean it it might
not be pretty but you can fix that later
also yeah that's great yes so D node
will ruthlessly hunt down your callbacks
to no matter how deeply you nest them no
matter how many times you recurse like
here's a just a function call and you
can nest them however you want and that
includes when you set up like
constructors and object definitions or
if you just pass if you just call
functions remotely it's you can just
pass around data however you like and it
can have functions wherever pretty much
except in the prototype chain because
that's a key and I don't want to mess
with that
and even in client definition so your
clients can actually host up methods
that they want the server to see as sort
of an entry point into this whole
negotiation so here's some awesome
examples of stuff that uses D node in
the well my startup browser lling we use
this a lot I was gonna do a quick demo
but networks kind of for that but I
basically lets you do like cross-browser
testing in your browser so you can
actually use like IE or Safari or
something from this canvas element and
it's all on the back end done with like
on the back end and the front end dino
ties everything together another awesome
thing that maroc over here and his
buddies at no jitsi wrote up was a json
loops it's this awesome sequencer thing
that we might or may not use here in a
bit and like crazy games and
and like upload progress bars it's great
for that sort of stuff where you sort of
have like a job maybe and it you you
don't want to periodically pull it for
updates or anything or make some hacky
JSON protocol to sort of marshal data
around so you know it is great for that
stuff also you can use D node in Ruby
I've got like a little library up on
github that lets you use the denote
protocol so you can like tie together
nodejs processes and Ruby processes and
the same thing for Perl and some crazy
fool even wrote a Java implementation
I've not tried it I don't know how it
works but it's out there so it's getting
pretty awesome
and here's it up on github you should
definitely check it out and now if
everything goes well that's the end of
the slides but let's see we've got about
15 minutes so hopefully we can oh please
connect well I guess we just read it off
my lip oh yes it works yeah oh yeah
so okay big so here I've got this rap
battle program you can check it out and
github actually it's it's up there right
now
so basically it's it's just a denote
server here and we've got it uses you
know browserify and everything and if we
can scroll I don't know how to scroll
correctly on this Mac but um yeah here
we go here's the the server part you
know denote function and you get your
client handle and your connection handle
and you can just define these functions
here here's a watch function here's a
wrap function it takes a call back in
like a challenge callback so you can mix
and match and you just basically write
your code pretty much like you'd write
it in note anyways
if everything was just living in a
single process but callbacks can like be
defined on the browser or be defined on
entirely separate processes maybe on
entirely separate servers and so we can
just straight-up call these functions
like here I have it actually running
I'll just real quick in do some live
coding in the repple here so we can just
require the d node require event emitter
require event event emitter okay
and now just D no duck connect I've got
this service running on port 8081
and we get a handle to the remote object
and why don't we just like console that
derp that oh yeah ah and then it's
done some really weird thing I just want
to find cuz I don't care about the
result oh no connection refused alright
because I had the wrong port I think
yeah what's running I think oh no it's
no that would be why okay so let's
actually start the thing so we've just
got a server okay that work is being
slow so we've got these clients that are
these wrap combatants and I wrote this
crazy Markov freestyle thing like in the
past couple of days so basically with
that we can like just connect to our
server process and have this freestyle
handle going here we're like here's the
bulk of it so basically generate wrap
responses to when it's our turn
basically from the server so I'll fire
up one of these
for me and this actually takes a bit to
start up so it prints out ready when
it's ready and then let's fire up Chrome
real quick okay so we go to I hate Mac's
by the way it's so I get this think that
oh I did that wrong okay so this is the
the web version basically of this um rap
program I guess I can while these are
loading okay they're both ready so
basically what the the web app is doing
isn't much more complicated than this
this is like a command line version of
it it basically registers an event it
creates an event emitter and like binds
the emit function to this remote dot
watch thing so it can sort of like an ad
hoc pub/sub thing you can just hack
these up like nothing in denote because
it's it's that modular and flexible so
go back to Chrome real quick oh yeah so
uh we're gonna have a little rap battle
for you here it's a mark of randomly
generated rhyming D node based rap
battle so yeah yeah sure so maroc here
is gonna help me out with this I know a
good mp3 to use oh yeah
okay three more
well I'm not hearing anything now it's
gonna go through
yes either very well they don't actually
work teach you function into cube the
first one cookie jar from where my
question
are there any docs on why it's not easy
what about little wear compatibility out
of whack a simple string the way to pass
a hack
guess
try to read me encoding ex work only
supports utf-8 alright problem with that
installs updating a - cheap package side
no and it's all for you yeah yeah this
cuz that's all my no JSI are CVS you get
a real 24/7 Oh
and now we see he's not in the list
might be some lag on our network we
generated on
I guess so you guys can check that out
and github or I guess we got time for
like a few questions maybe and we're
accepting rap battles so just let us
know
oh the now Gia's question oh yeah is
expecting this
so right now jess is this new sort of
real-time projects based on socket IO
it's pretty similar now jeaious is
really new and it's got this sort of
replication thing with like harmony
proxies and and like a set interval to
check so the idea with no GS is you sort
of add and delete items on the fly and
and they propagate but D note is not
about that at all it's about just you
pass an object or a constructor and
that's just how it goes
and to get the sort of advanced
functionality you use callbacks and use
like event streams on top of callbacks
so and then D note also works in frickin
Ruby and Perl and Java and it works on
the browser or the the backend so yeah
maroc
so yeah mirach just asked if i if you
can use like just pure service server
like TCP connections absolutely you can
do that um that's actually like what I
wrote it for originally and then I sort
of just said hey why not suck it I Oh
that'd be pretty sweet
and so yeah Felix doesn't work
cross-domain um it so that's all really
dependent I guess for for browser stuff
that's all really dependent on how you
configure socket IO you can pass in
socket IO options directly if you want
to mess with all that I get no idea how
any of that works but it's probably
possible but I don't really mess with
that yeah okay no more questions then
anybody that's cool just about used up
all our time so you can check out denote
yourself at github comm sub stack D node
yeah</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>