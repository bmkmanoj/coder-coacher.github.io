<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Michael Matuzak: Amazing Things One Can Do With JS and the NES | JSConf US 2015 | Coder Coacher - Coaching Coders</title><meta content="Michael Matuzak: Amazing Things One Can Do With JS and the NES | JSConf US 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Michael Matuzak: Amazing Things One Can Do With JS and the NES | JSConf US 2015</b></h2><h5 class="post__date">2015-06-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NiOW-swy2Ys" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah let's have some fun with the
Nintendo which is a fine piece of
hardware even today so what are what is
this thing that I'm going to be talking
about I guess it's the latest in 1980s
music technology this is controlling a
Nintendo sound like the sound stuff that
the microprocessor works or the sound
stuff that makes the or that sound stuff
that is in the microprocessor like right
compiling down to the assembler through
JavaScript so this piece of hardware
right here is what we're going to be
running everything on and there's no
trickery or involved or whatever its
actual Nintendo programs like running
just want to make some people are like
hey it's like you know you have some
like crazy thing but no it's real um so
like when I first started this project
the goal was to make it easy to write
music for a Nintendo and that that's
been done a lot in the past also there's
trackers which are basically sequencers
that you can use to like sequence music
on Nintendo itself or you could have
programs it will output like the actual
sound like of the Nintendo or emulate
the sound chip but I wanted to do it a
little bit differently I wanted to do it
using javascript because JavaScript and
whatever right so why a lot of people
you know why why you want to do this in
JavaScript it's to me it's self-evident
the I mean JavaScript awesome rides a
language that i really like but the
whole project itself like i really like
this sort of music this chip tunis sound
the i grew up in the 80s playing a lot
of nintendo 45 year old like playing
super mario brothers all the time or
you know whatever Zelda and all those
games I think over over that amount of
time like there's a nostalgia factor
that like those tunes like I didn't pay
attention to the music but they're
ingrained in my brain now and so I love
it I don't know how else to explain it I
think that probably a lot of people have
that nostalgia factor they look back to
their childhood and whatever they did a
lot or play it a lot it's far as like
video games or music or whatever they
gravitate towards that so I think that's
a big thing but the javascript part is
because of browsers now I knew that if I
could if I could get something working
in JavaScript I would have a path to get
to the browser and that's important
because once once you do that if you
provide a low-level JavaScript API to
this sound engine you you can create or
you can give the opportunity for people
to create fancy you is for tracker
sequencers that are all web based and I
think that's really cool and I actually
want to do that but I think this is like
the first step to that point so that's
that's primarily why and also because
it's a lot of fun to hack on a Nintendo
with JavaScript it's just it's crazy so
the next the next question is like how
is this working because it seemed sort
of magical to have a Nintendo and
JavaScript and stuff so to get this to
work I had to read a lot about how the
microprocessor works about how the 6502
assembler like is written because i have
no I mean I did not go to school at or I
mean like I didn't graduate with the
computer science degree so I have like
no idea how this stuff works like right
it's just all magical to me but I read a
lot and like I learned a lot of
assembler which is crazy like no one
should ever have to do that right but
then along the process like I wasn't
just reading about like assembler and
like how the Nintendo works like I read
a lot about music too because a lot of
that stuff Lee I had no idea how it
worked and then throughout the whole
process like I would go like
right assembler or write JavaScript and
figure out how this stuff was going to
work and figure out the API and all that
stuff and then what I would end up to do
doing was once I had something working I
would write music and try to like figure
out like does this make sense does this
work does this API like no and then I'd
go back and like be like oh that part
stupid like get rid of it or and so I'm
at a place now where it's like there's
some stuff that I don't like but it's I
think the API is decent enough to you
know present so what I have here that
I'm going to demo in just a little bit
after I kind of get through like the
basis of what this is is a assembler
sound engine so what happened was I was
like oh I want to make like this thing
makes sound so I went and I read a lot
and figured out how to do that with an
assembler I made a square channel like
beep it it just kind of went be you know
like square channel which I'll demo kind
of in a second then after like I went
through these tutorials on like these
nez developer forums and at the end of
the tutorials you kind of have a basic
working sound engine and assembler but
assembler is really difficult to work
with and you know it's not very fun to
write music and assembler just doesn't
like I don't know its assembler so take
once i had that though it was easy to
write a javascript api to that so they
could compile down to what the what I
saw would look like in assembler so
really quickly this thing has see how
many are there five yeah 5 5 channels
two squares a triangle noise which is
just random noise and a sampler which I
did not do the sampler because it takes
up a lot of memory and I didn't really
figure out how it works so I'm just
going to be working with these for now
so the square channel the features that
it have is a duty cycle which i'll show
a demo of it because a lot of this stuff
like
you don't like can't really visualize it
I guess you can visualize i defied like
a nozzle scope but I don't but it's
better just to listen to it so we'll
listen to it in a second but these are
the features didn't get frequency sweeps
working but here we go and I'll demo the
square can we get the demo thing going
okay so this is um this is the little
file system thing on the Nintendo that I
have going okay so here's a square this
is going to play a c-note and it's going
to go through the octave range of a
c-note on a square channel and that was
just doing like you know a for loop with
the number or something and just passing
that into like you know song dot square
and it's just an array of notes and it
plays it all right I got to reset this
sucker to get back oh one other thing
that I did I kind of skipped over duty
cycle and volume envelopes so duty cycle
um it kind of spaces out like or narrows
the the did we get this back oh sorry
can we get this yeah back sorry um its
faces out our narrows like the the
actual square how it looks and it
creates a different sound so just to
kind of this is the same note same
octave just change just manipulating the
duty cycle of of the square channel
okay so i got squared square stuff
working and it was beeping um the next
thing I did was like uh actually like
once I got the square channel working I
made that beep then I went to the sound
engine wrote the API to it and then I
wrote this thing which I don't it's just
some some notes and changing octaves and
this is just what it sounds like this
was the literally like the first thing I
wrote besides the beep so it doesn't
sound awesome at all but
Oh
all right ok cool so um so that yeah
that was a like that was the first thing
I wrote and then I started implementing
all these features volume envelopes if
you're not familiar with them like
imagine like a note is broken out into
like a bunch of frames and you have the
ability to say like on frame one of the
length of the note make the volume 0 and
that on a scale of 0 to like say 10 0
being off 10 being the loudest so so 0
it's off and then you gradually increase
it like frame 11 and then keep going to
25 5 10 and then it's the loudest so
then you have like you have created a
fade in effect so you can you can
manipulate these these notes with volume
envelopes to create like blip effects
like echo or staccato or fade ins fade
out all sorts of things um i don't think
i have a fade in demo but let's see oh
one other note is like square channels
the only one that can do that so with
triangle you have the ability to turn
volume on or off so you're pretty
limited I don't know why this is the
case but you can either say like hey
this is on it's just binary on or off
and you can use volume envelopes with
them but it'll just interpret any value
that's not zero as a one so triangle
it's it's made for like bass sounds for
the like the lower octaves really high
octaves it's the like flute sounds you
hear in like Zelda and stuff so here's
an example of it I don't remember I
think this is just the same as the
square it's just going through the
octaves of C so there we go triangle um
knows I don't really know how to explain
this because it doesn't really matter
music very well it's it sounds like
drums some
you can get like certain ones sound like
hi hats or snares or like bass drums and
stuff but for musical or for like
musical notation I didn't know actually
how to represent this so this was one of
the problems I had but here's like the
full no noise range that you have so so
then with like those sounds you can
create drums and this is kind of a
really dumb like simple drum beat okay
okay so techniques so all the channels
on here are monophonic so you can't you
can only play one note at a time you you
can't you can't make chords so what
people would do composers of the 80's
would they would fake it like they would
make arpeggios and speed them up super
fast like increased the the like the
timing of the note or or speed the tempo
up a lot of like the Japanese games and
stuff they were just written like if you
listen to a lot of video game music it's
just written monophonic Lee some of the
Commodore 64 people would would use the
arpeggio technique but let's let's go
through some some songs before I go
forward so I was having trouble like uh
I was trying to like do 80 some 80's
musics for jfcom given the theme so I
did Billie Jean just the baseline though
because the square doesn't really sound
that or I couldn't get it to sound super
good so this is just the baseline it's
really simple let's see if it sounds
decent
you
that's it that's that's the whole song
pretty much and the the square channel
would be like that burn burn but yeah
okay so let's go so then I kind of went
through like a bunch of songs like I
tried a bunch of different types of
music before I talked to like actual
people that compose music and they gave
me some pointers so I was like oh I like
Slayer and I like raining blood that
must be an awesome song to do but it's
not really because it's actually really
boring pretty much I like
it's just dropped me over and over again
there's that little part in the middle
but
okay so Slayer was boring like a lot of
yeah I mean drop D over and over again
does not sound good on the Nintendo um
so I was like okay I'm going to like
take it take a crack at rewriting Super
Mario track so I came up with this so
that one that one actually worked out
really well I was much happier with that
than Slayer and yeah so then after
talking to some people and showing them
what I had though I was I was kind of
like yeah here's the problem i'm having
like all these songs have cords and it
doesn't like it usually doesn't sound
good and there's a couple cases where I
did get cords to kind of sound good but
I don't know like what what I did
instead of doing the arpeggio technique
because I could almost never get that to
sound okay is I was actually talking to
my brother and he's like just used power
chords because you have to square
channels so you can just use the tune
and that kind of worked but it still
wasn't didn't seem right but then I was
talking to a composer friend of mine and
he was like you should check out the and
I forgot what they're called out but
these bak pieces bwv 847 i think is the
prelude in c minor and 851 is d minor I
didn't finish these and they're kind of
long so i won't play them all but
they're really great because they're
mostly monophonic so they've mapped
really well with to the nintendo and i
have volume envelopes so i can make them
play at staccato which is what like
Glenn Gould and stuff plays a map
member okay it's more of that it's just
yeah um so yeah here's really quickly
this is just the first couple bars of
the D minor one so those work really
really well because they're monophonic
and there's the sense there's no cords
it's it's just it makes sense right I
can use if you're like reading music you
can use like for the bass clef you can
just use a triangle channel and then for
if you have like notes up top you can
use square or even mix them up or
whatever um okay great so that's that's
kind of like what I have so moving
forward though going back over I guess
to here is the future like what do I
want to do with this i have this API I
have this module that's on mpm that can
take JavaScript and produce these these
songs in the in the end they're still
it's mostly JavaScript there's this last
piece the assembler itself is actually a
c++ assembler but I think that that
evening can be moved to JavaScript and
there's already people that have
JavaScript assemblers for the Nintendo
so it's it's not that much of a jump to
to get there so I think we can get a nes
assembler in j/s that one module that
you can just say hey here's some
assembler give me a Nintendo program
and that would that would be awesome and
then I think also with this API we can
build web UI tools that since you have
an assembler in Jas and you have this
stuff that I wrote in j/s you can say
here's like here's the sequence of
sounds like click a button or whatever
it builds it it outputs your assembler
it assembles it gives you a actual
Nintendo program and then you have
things like people have written
emulators in JavaScript for Nintendo
right i mean i'm sure we see these
things don't pop up on all of the new
sites and whatever over the last five
years so you have your whole like build
environment in j s and you just need to
piece it together and get it in the
browser and we can have this really
awesome like authentic sounding thing to
make a bit music so yeah I don't even
know how much time I have because this
thing's not going but I can keep talking
about this stuff okay cool so um so let
me go back to like why to the why of
like how I got started into this stuff
so I had previously written like
graphical stuff and it for this and I
gave some some talks like writing slides
and stuff on on the Nintendo itself and
that was super hard and I didn't do a
very good job at like the graphical
stuff like I had a lot of problems with
it it was a lot of like stuff that was
hacked together and then I can't
remember where it was but I gave a I was
giving a talk in the AV person came up
to me and they said oh are you going to
need sound to the Nintendo and I thought
oh no I won't meet sound I don't have
any sound and I was thinking about it a
little bit later and I was like why
don't i sound like why didn't i get it
why didn't i read that part about sound
so I thought like I should go back and
figure out how sound
works and it was just that curiosity
like that in the back of my mind like oh
how does this work and stuff so I went
back and there's there's a lot of stuff
that's written about the Nintendo that's
out there but there's not a whole lot of
practical examples so finding like this
to this sound tutorial and kind of
standing on the shoulder of giants and
like taking this the stuff that this
these other people have have written and
using that as a basis for like saying
hey like I could just write a JavaScript
API to this and I know JavaScript well
enough that I can expose this so that
other people can use use this stuff and
and yeah so I got to that point and it
it was actually way way easier than all
the graphical stuff the sound stuff was
a piece of cake compared to the
graphical stuff and I think like a lot
of this stuff is still relevant today I
mean you have bands like autumn on
Iguchi that actually use like a Nintendo
in their set or like in their music they
use it as an instrument it's an
instrument that has these channels that
you're able to manipulate sound and get
like a real authentic sound and there's
actually a game that for Nintendo that
was released like a couple months ago
called star versus and you can buy this
game for like 40 bucks or whatever and
they give you a real cartridge like a
real Nintendo cartridge and that is so
cool that people are still hacking on it
and selling games and stuff so I think
this is like this stuff is really really
awesome and and so yeah I want um I want
everybody to just like you know if
you're interested in this stuff like I
don't know hit me up and talk to me and
will you know geek out about Nintendo's
and building building musical stuff and
cool thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>