<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Vince Allen: Creating natural simulations in a web browser -- JSConf EU 2013 | Coder Coacher - Coaching Coders</title><meta content="Vince Allen: Creating natural simulations in a web browser -- JSConf EU 2013 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Vince Allen: Creating natural simulations in a web browser -- JSConf EU 2013</b></h2><h5 class="post__date">2013-10-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5Td8KBUG034" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everybody yeah I'm Vince Allen and here
to talk to you about creating natural
simulations in a web browser anyway my
fiance may be promised I wouldn't talk
before the cat Falls but I believe that
a little bit about me
so I'm a software engineering manager at
Spotify and I live in Brooklyn and I
work in our New York office and you can
get in touch with me at my twitter
handle Vince Allen Vince
you can also write me events at Spotify
comm and all the code for the examples
you're gonna see are at this github
address so there's just a little note
about the code everything uses vanilla
JavaScript CSS HTML there's no canvas
there's no WebGL SVG flash Java or or
like or even bitmaps so in 2007 I was
living near an Apple Store and a week
before the iPhone released there were
people in my neighborhood camped out to
hold you know place in line and this
line you know it went around the block
and it was just chairs and tents and so
on and soon after a friend of mine
caught an iPhone and I asked him you
know what is so great about this thing
that you'd spend a week outdoors and he
said he couldn't explain it but you just
have to use one and soon after I got an
iPhone and I realized what he meant but
I thought he could have been more
specific I thought he could have said
you just have to hold one so this was
the first time I was holding what we
call now a sensor rich device and I
could see the operating system mapping
my physical input onto the UI in a way
that realistically mocked this physical
system so recently I went to a talk and
it was a futurist and he was talking
about the future and how there's there's
gonna be a post PC world where you know
like our laptops and our desktops are
gonna be so smart and we're gonna carry
around this primary computing devices
and our
it's and I don't dispute that view but I
don't think large format interaction is
going away and I don't think large
format creativity is going away in fact
I think more than ever as JavaScript
developers we should be thinking about
large format interaction we should be
thinking about it in terms of natural
interaction so for now the desktop might
go away but it's a good place to
experiment but to make desktop
interactions as compelling that's what
we're experiencing sensory rich devices
we need to figure out how to combine
physical sensors so what do I mean by a
natural simulation I have this
definition it's a collection of agents
whose boundaries of autonomy appear to
be defined by natural forces this is
just a fancy way of saying you have a
bunch of objects they have rules and
those rules make the system seem natural
but what I like about this definition is
it implies that we're observers and we
have a threshold of believability so
what makes the system seem natural
instinctually we can differentiate
between something that's designed and
something that's natural but we're going
to create natural simulations in a web
browser we need to know we need to
identify exactly where this threshold
lies because a web browser is not the
easiest place to try to do this we're
going to be resource constrained so we
don't want to do more than we absolutely
have to
so what point can we be confident that
we've crossed the line and the user will
accept the simulation now I'm not the
first person to think about this
Valentina Brayton Berg was an Italian
neuroscientist and in the 1960s he was
interested in understanding how human
beings developed intelligence and
reasoning but instead of looking at
humans he looked at insects and by
examining simple brains he hoped he
could find the building blocks to our
cognitive evolution and in the 1970s he
wrote this book and it describes a
thought experiment where he imagines 10
simple vehicles and these became known
as Brayton burg vehicles so each vehicle
is equipped with sensors that respond to
specific input
as a vehicle's progressed in his
imagination the sensors became
increasingly sophisticated and at some
point you the reader you start accepting
that if you observe this behavior in
nature that you would accept that it's
part of the natural world so let's look
at some Brandenburg vehicles so this is
a very simple vehicle it has two sensors
one it's for heat and one is for cold it
speeds up around Heat and it slows down
around things that are cold so while
this little creature here doesn't seem
all that intelligent if you've
encountered this behavior in nature you
would probably say okay this is
something that's alive but let's just
tweak that rule a little bit instead of
slowing down around cold we're gonna
turn away this is just a really simple
refinement to that rule alright but
immediately we get a sense that this
little guy understands his environment
he can navigate and he can turn away at
least and avoid things he doesn't want
to be around all right what if we took
the inverse of this what if we turned
toward things that stimulated us and we
blew them up so already you know we just
taken the inverse of the of a very
simple rule and we get something that
looks even more intelligent you know not
only does he understand his environment
he's out to get things in his
environment then what if you could
combine a bunch of simple rules all
right in this one we have heat we have
oxygen we have food and we have light
and we're attracted to food we're
attracted to oxygen stimulated by heat
and aggressive toward light this guy has
a sense of values you know if you if you
let it run you watch it's almost like he
has some type of awareness of the
different of different tastes and I'd be
willing to bet if you saw this type of
behavior
nature you would say this is something
it's natural
so when you stop looking at the
individual rules and you view their some
is a system you cross the line from
designer to observer and that's the line
that's the threshold that we're looking
for so Brayton Berg recognized the odd
situation that we put ourselves in as
designers and we know that these are
simple rules because we made the rules
but we can't help it at some point we
see the emergent behavior and not its
component parts so with sensor rich
devices I'm going to cross the line in
the other direction you know I want to
say that the iPhone that Android phone
is a Brayton Burgh vehicle it may not
have wheels because it doesn't need them
you know we're the wheels we carry them
around but it has the most important
part and that's the sensors and when you
think of them in this way a collection
of sensors you can deconstruct these
rules that govern their systems much
like Braden Berg was deconstructing
simple brains in search of answers to a
bigger question what makes a system seem
natural
for me it's detail you know at some
point there's enough detail for us to
accept the system but we need to know
exactly what kind of detail we're
talking about so I want to do a thought
experiment all right I want you to
imagine that you're James Cameron and
you're gonna make a summer blockbuster
but it's not gonna be avatar it's gonna
be a movie about a guy throwing a ball
for a cat all right but like avatar
we're gonna do the whole thing
computer-generated oh this is gonna be
rendered and it's gonna be easy for the
cat and the guy right we can get a
little kitty motion capture suit and we
can get you know a motion capture suit
for the guy but either ball is gonna be
kind of a problem right the ball we
can't just get a motion capture suit for
the ball we really need to simulate and
mimic the physics realistically enough
that it looks as real as the people or
the animal and the motion capture suits
so what a high level are the details
if we're gonna animate this ball we're
gonna simulate it what are these we're
looking for at a high level we need
variation right so things shouldn't
always be the same
be throwing the ball the same way it
shouldn't be we shouldn't float through
the air the same way and randomness
there should be a sense of randomness so
it should be hard to predict where the
ball is gonna end up it should be hard
to predict how it's gonna bounce and
that should be balanced with a sense of
ordered complexity all right so well
it's hard to predict at exactly where
the ball is going to end up at least we
know it's gonna be at the end of the
hall we know it's gonna bounce up off
the carpet and so on so let's get more
specific like what do we need to pay
attention to what are the significant
things that are that are driving where
that ball is going to end up at any
point in time so there's acceleration
there's this the change in velocity of
the ball as it comes off my hand and
then from there's the Earth's gravity
and then if we're gonna talk about
gravity we need to be talking about mass
we're gonna talk about mass we need to
talk about friction and then there's
minut forces like the wind coming from
the ceiling fan and then there's drag
from like the air density and it gets
much heavier around the litter box and
then there's resilience ball bouncing up
off the carpet so the point here is
there's a lot of things going on and I
want you to think of this system as a
mixing bowl where you account for all of
these forces and we need to figure out
we need a mechanism to do that that's
really easy right because when a web
browser we're doing this JavaScript and
we want this to be super efficient so
how do we do it all right I'm gonna show
you that in a minute but I'm gonna be
like Brayden Berg and I want to start
simple I want to look at simple systems
first and see if there's anything we can
learn from them all right I loved these
games I owned these games I played them
forever but there's there's something
that should be obvious you know
everything's moving at the same speed
you know so when we talk about detail
these games are really fun they're great
but you know they kind of contrast what
we're used to seeing in the natural
world the football doesn't go as fast as
the runner so let's look at it I created
a couple of studies just to talk about
those high-level things that we're
talking about so this
a study in variation alright so we've
got a lot of variation we have variation
in color we have variation in size but
we've done something we've mapped the
sides to mass so the little guys you
know they're not going to jump as high
and the big guys are gonna jump super
far and have a lot of momentum and then
there's a sense of randomness as well
it's kind of hard to predict you know
where each individual one of these these
guys is going to end up but the same
time we have some order complexity you
can generally tell how they're gonna
move and then there's a flocking
simulation
all right so flocking got a lot of
variety here size color and so on but
definitely randomness it's very hard to
predict where exactly any one of these
guys is going to end up but it's a flock
it's gonna self organize and so we're
gonna balance that out with some ordered
complexity and then I like the channel
Animal Planet because yeah they
differentiate between like goofy animals
and really cool animals and I think that
like flying fish are kind of the James
Bond of the animal world and I wanted to
do something where you had two
environments you know in the same
simulation you have a primary and a
secondary and just to get a sense of
like drag and moving from one to the
other alright so why is this difficult
you know to do in a web browser
well first of all I mean web browsers
were created basically their first job
is to present text and beyond that you
know they're event-driven they're
waiting for us to do things so that they
can respond and JavaScript is there to
help us do that as well but there's also
competing resources on the system and
you know you may have another browser
open there's other applications running
on the on the operating system but
there's also the network to continue so
you know rendering isn't necessarily a
first priority and rendering a lot of
things like that isn't surely not so
this is basically me saying just not
meant to do this you know browser is not
a procedural drawing tool it's it's not
like processing or
openFrameworks so there's not of like
not a lot of convenience in terms of
rendering baked in there so how are we
gonna do it all right you guys probably
already know the requestanimationframe
when you use that we're gonna use
hardware acceleration with some hardware
accelerated CSS properties but we're
gonna use vector math okay so when I
talked about the mixing bowl and adding
of all the forces vector math is gonna
let us do that and I'll show you that in
detail in a second and then physical
input for me physical input is is the
one that gets us really across the
threshold when you can map physical
input to what you're seeing on the
screen it's just all the more natural so
let's look at some code so let's say
we're trying to render that ball right
and think in the guy throwing the ball
for the cat maybe and we want to start
out really slow we're just gonna get the
ball to drop from the top of the browser
to the bottom so we're gonna create a
vector and this is a vector class and I
talked about adding forces the vector
class has an ADD method so let's look at
vectors really quick all right a vector
I want you to think of it simply an
offset it's the difference between two
points
what's cool about a vector is it also
implies a magnitude all right so I can
say that vector B here it's it's it's
less magnitude then it has less
magnitude than the vector a because the
vector a is longer and if I wanted to
then sum the forces if this was a system
and let's say that vector a was thermal
energy coming off the ground and vector
B was you know wind blowing down into
the right what would that feel like to
stand there and what would the
combination of that feel like and it
would feel like this all right
so imagine then it's pretty easy then to
pile on the forces and you get the sum
so that's what we're gonna do here so
when I create my ball class I'm going to
not have necessarily an x and
y-coordinate I'm gonna have a location
vector a velocity vector and an
acceleration vector and one for gravity
and then we're going to use that in an
animation loop then we're gonna add
gravity it's going to cascade
gravity goes acceleration acceleration
to velocity and velocity to location and
we can finally draw the ball right so
what does this look like all right
that's not that bad that's about 20
lines of code nothing special going on
all right so here's the cool part though
so obviously there's not enough detail
on that if we want to get to like that
that really cool ultra realistic looking
ball we're gonna need to add all those
forces we talked about and it's this
easy so we're gonna add some wind and
you can see the wind vectors moving
slightly to the right and we're gonna
add it to the acceleration and this is
where you get you can probably guess
what's going to happen here we're gonna
blow down and to the right all right
all right so now we've had years to use
devices that map to our bodies but by
comparison
you know keyboard and a mouse feels a
lot like using a weird little hand to
get it what you want so I want you to
think about think about the Brayton burg
vehicles we saw earlier you know I'm
talking I'm saying that like an iPhone
is a fancy breaker vehicle right it has
sensors and in fact has just enough
sensors to convince us that our
interactions with it are completely
natural so let's think about the desktop
I mean what can we do on a desktop it's
similar so large format inputs right so
html5 has given us a lot of really cool
API s and we can do things with we can
access the user's camera but
getusermedia API we can attach game pads
and analog controls with a gamepad API
there's three I'd like to focus on it's
a mouse acceleration audio and gestures
all right I don't mean to criticize the
mouse at the time it was a step in the
right direction because you know at the
time we didn't have a weird little hand
read nothing right so but the experience
of course is mediated you can only you
can only click so hard but there is
something cool we can do with a mouse
and we can do with it you can do it
right now so if you use your mouse and
you roll it around right you're changing
the location and that's a velocity and
then you're likely changing the velocity
as well and that's an acceleration so we
can apply an acceleration based on how
are using the mouse you know into a
system such as a matter of getting a
system anyway web designers have
recently figured out a way to do this
and I think we've all seen parallax
sites right they're everywhere
Spotify even has one
so I these are all the rage I mean you
see them everywhere and I think that
they're popular not so much for how they
look but for how they feel to use
because this is the one opportunity we
have right now where we get to apply a
continuous acceleration and things
behave like a natural system you know
items in the background feel like they
weigh more they're further back and so
we used these and we get a critical
amount of detail and it feels really
good so I had this idea I really wanted
to get to the heart of this I mean what
if you pushed it further what if the
scroll bar instead of mapping things
proportionally you know its location
which is proportional to how far you use
the scroll bar well if you use the
scroll bar as a pedal and so it just
implied an acceleration into a system
right so I'll show you what I mean so
this would be like the traditional way
of doing some type of scroller right
you'd have a bunch of stuff you'd scroll
and it would move in the opposite
direction the scroll bar and everything
to be nice and proportional so what if
we short circuited the scroll bar and
now it's a pedal and if I let off of it
I don't get any acceleration but the
more I pull on it the faster the
acceleration is and I can do this in
both directions you know all right so
that's kind of fun and then to make it
like a little more interesting I can
change up the colors and I can do
different sizes and so on but if we take
all the things we learned and we apply
acceleration to velocity and we map the
size to some mass let me get something
looks like this this is kind of fun
so the thing that's not cool about this
is that you know I've hijacked a native
UI element and and forced it to do
something that really wasn't meant to do
but remember what I talked about with
vectors all right and talking about the
mouse and location so if I have a fixed
point and I have my mouse that I have a
vector and the further away I moved from
that fixed point I can say is a greater
acceleration so what if I just move
further away from the middle of the
screen and now I've got something that
doesn't even need a scrollbar
so I'm not saying that this is like what
you should do with your your next
website but there is something
conventional we can do with this kind of
thing all right so we've all seen a
horizontal scroller right and I can just
take all the code that we just saw and
just flip it around and take advantage
of Mouse proximity and acceleration and
friction and mass and I get something
that is a gesture you know this when I
do this I'm pointing it at what I want I
don't have scroll bars or anything all
right so we talked about mouse
acceleration let's talk about audio all
right so Web Audio API combined with a
getusermedia API allows us to measure a
stream of audio in terms of its
magnitude across frequency spectrum and
then I can map that to dibbs that change
and I could talk and I've got something
looks like this so what if you combined
the microphone with flocking simulation
all right so here if I take a tone
generator that's on my phone here and I
play it I can activate these guys
you get the volume or the back away so
you can see I can pump them up freak
them out whatever but what's kind of
cool is I can sit then switch and
anybody has a tone generator good nuts
so that's kind of fun but what's neat
about that is all the in-betweens you
know so what if we have a bunch of
tractors and still have these guys
so now I'm implying a force with audio a
gravitational force and moving all my
fireflies around the screen all right
audio so what about gestured so you guys
have probably heard of this thing right
it's the leap motion sensor plug it into
the USB port and it will interpret it or
it'll detect where your hand and fingers
are I've got one right here and if I
combine it with some hands-free you know
a flocking simulation you know all of a
sudden this becomes really fun it would
be fun with a mouse but it's a lot more
fun just waving your hand did you think
this was gonna come back so I said the
mouse was a gesture well why not just
use a gesture
all right I want to tell you a story
about a kid on a plane so recently I was
taking a flight and I was seated next to
a little girl her mom was putting up the
bags and she gave her her phone pacifier
while mom was doing whatever it took to
get us all buckled in and within seconds
she had opened up the phone navigated to
a photos application I was able to find
a video of herself swinging on a swing
and his child was two years old and she
couldn't even talk but she could use
this phone as well as I could use mine
and when it hit me that were born
knowing how to use these things and this
child may never use a desktop PC or a
laptop but she will eventually use
something other than an iPhone likely a
large-format
interface and as JavaScript developers I
believe that we have the chance to lay
the groundwork for those types of
interactions so when you're creating web
UI on the desktop I challenge you to
think in terms of natural interaction
think about Brayton Berg vehicles and
not the component parts but the system
as a whole so in other words I want you
I want you to think about what makes an
interface appealing to this generation
you know the two-year-olds that don't
have to learn gestures because you know
they already know them they are born
with them so if you start from the
perspective of a natural system as
you're prototyping sandbox
you're gonna often come up with
something that's more interesting than
approaching the design from the other
way around but the good news is we've
seen at the threshold it's just not that
far away
I mean instinctually we're tuned to look
for natural interactions and we find
them gravitate to them and we adapt them
to talking about prototyping sandboxes
here's - the only difference is the
first one has a lot of stuff but a
little documentation the second ones
simple that has a lot of documentation
so and then I'd like to say that Spotify
is thrilled to be a sponsor at this
conference and we're out here in the
hall you can talk to us about a new
Spotify feature called Spotify Connect
that lets you control and play music
across your phone tablet and speakers
we're also hiring so if you want to work
at a cool company making cool things
come out and talk to us and we also have
a couple of code challenges you win a
couple of prizes so that's me you can
contact me I'd also like to point out
that I got a fair amount of those
physics formulas from this book nature
of code by Daniel Shipman it's really
good read it and check out the code at
the repo thanks
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>