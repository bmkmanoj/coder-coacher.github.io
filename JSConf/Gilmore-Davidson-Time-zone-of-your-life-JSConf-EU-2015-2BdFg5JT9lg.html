<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Gilmore Davidson: Time zone of your life | JSConf EU 2015 | Coder Coacher - Coaching Coders</title><meta content="Gilmore Davidson: Time zone of your life | JSConf EU 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Gilmore Davidson: Time zone of your life | JSConf EU 2015</b></h2><h5 class="post__date">2015-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2BdFg5JT9lg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Ok, third time zones, developers and time
zones are clearly a love/hate relationship,
I can tell this from looking in my Twitter
stream where I see all sorts of developers
complaining about time zones. Why are they
such a problem? We'll start with a simple
problem you will encounter: how soon is now,
you have a time and date you want to display
in your interface or you want to get users
to write it for you, but when is that time,
because 10 o'clock for you is not 10 o'clock
for someone else.
The simplest solution is avoid the problem
and never show dates and times in your interface,
not really practical. What's an actual solution,
you could decide, you know what ever time
the server thinks it is, that's what I'm going
to output, the users have to do the mechanical
computation, that's not a solution that's
starting a problem again.
Let's look into the history of time zones.
Basically, there was a concept that worked
really well up to the mid-19th century which
was mean solar time, when the sun is directly
overhead, that's noon. Every town and village
used that system, until the railway and telegraph
connected them and they realised everyone
was using a difference version of the time
because the sun was in a difference spot.
A proposal was done to standardise the time
and divide the world in 24 bands, one hour
per band, neat, precise and mathematical,
it remained perfect until it reality at which
time borders came into fly, some work was
done to calculate the differences between
what the time zones in the world are in what
mean solar time says they should be in, Beijing
runs on Beijing time, the furthest west parts
of China are three hours out from where the
sun says they should be. You don't want to
have to deal with this calculation yourself,
you don't want to have to try and work out
where they are, so you give your users a preference,
you let them choose what time zone they're
in, then you have a whole range of other problems.
Every time zone picker that I've seen on the
web, is a trade-off between the comprehensiveness
of the data and the ease of use. Most users
don't actually know what their time zone is
and they hate putting it in, like this.
Also just seeing a gigantic list is really
annoying. At this point you need to ask yourself,
do you really need a time zone, a defined
time zone or to you just need the concept
of local time. Really what you are trying
to do, you are just taking one date and time
and display it in a different date and time
depending on where your user is. The third
solution is you just deal with UTC. Standard
reference point for time.
You store it in UTC on the server, you output
it in UTC to the browser and you use JavaScript
to just convert to it the local time on the
fly as the very last step, this is by far
the best solution for the majority of use
cases, it's used by a lot of websites today,
what's is UTC, it's co-ordinated universal
time it's the successor for Greenwich meantime
it kind of stands not for much as a acronym
itself, when it was being created the organisers
wanted to have the same acronym for every
country in the world, of course the English
and French can never agree on word order,
an acronym was picked that was wrong for everyone,
putting everyone on an equal footing {Laughter}.
That's great when you can get away with it,
sometimes you do sometimes need to store a
user preference for time zones. If you want
to send scheduled notifications scheduled
notifications at the same time everyday, in
your users local time regardless of day light
saving time over a course of the year.
So what's a better way of get the users time
zone you can try and detect it in the browser,
it has to problems, it seems simplest enough
in theory, you create the date, you call the
one thing available, it returns minutes from
UTC, then you just map the offset to a time
zone and find out that everything is broken.
So to understand why it's broken we have to
take another look at another history lesson.
So five years ago Patrick McKenzie wrote a
very famous blog posed, called false hoods
people believe about names, it was based on
how many pieces of software he'd broken with
various names. Two years later, false hoods
programmers believe about time, this contained
34 false hoods, hours, minutes seconds, about
all the different ways that programmes can
stuff up when they are trying to deal with
time, this got spread around and he was in
undated with things he'd mist so-had to post
the follow-up, with all the ones he'd missed,
- I'll pull out two of my festival writs,
- I can easily maintain a time list, time
myself, also false. So why are these false,
if you want domain ten your own time zone
list, these there are problems you are going
to have to deal with, day light saving time.
Not all the countries in the world do day
light saving time, some do, some don't, for
the ones that do, not all parts of the countries
use day light saving time. Day light saving
time, one knows that just jumps forward an
hour and jumps back an hour, except for Lord
How island which only does half an hour, why?
I've no idea, you have to account for it any
way. When do places go in and out of day light
saving time? This was my attempt to visualise
the different times of the year when different
regions do it, I couldn't fit it all on one
screen, also another little oddity there,
Morocco and Egypt, when Egypt chooses to do
so, go into day light saving time, come out
for one month during Ramadan, so that fasting
is easier during day light hours, then back
into day light saving time and out again,
so four clock changes in one year, because
Ramadan is based on the siting of the moon
you can't actually know the precise date that
that's going to happen {Laughter}.
All right, you have got the rules of daylight
saving time you have finally figured that
all out, then they all go and change. So the
base offset, so how far ahead or behind UTC
a certain region is. Just this year alone
there have been five changes. These range
from whole countries to just small states.
Deciding to start or stop doing daylight saving
time this happens a lot.
Deciding to change when daylight saving time
starts and stops, this also changes a lot.
Then, the not very common case, but still
quite interesting of the country of Samoa,
where the date of December 302011, they went
from one side of the international date line
and at midnight they crossed over and went
straight to December 31. This did make sense
in order to trade better with Australia and
New Zealand, but their nearest
neighbours of American Samoa, kept trading,
they are now separated by 70 kilometres and
24 hours it's the same time of day in both
places, just a different day.
The big problem is politics, which is really
the cause of all the other problems we have
already seen, governments change, when they
change they often change their minds from
the previous government, that's when they
recognise that a zone exists, there is a group
of towns in Australia, halfway between Adelaide
and Perth, that choose a time zone - 
your software has to account for it. One off
changes such as the Sydney Olympics, making
daylight saving time start a month early,
this year Turkey will extend daylight saving
time by a month because of local elections,
when you are lucky the governments will announce
these changes with enough notice to update
the software, in reality, update all the software,
in reality all the changes will happen within
a month, in extreme cases within a day, in
some very rare cases they have actually announced
they have done it thereafter fact {Laughter}.
How on earth do you even keep up with all
of this, it's where the time zone database
comes in, it's managed by IANA, it's really
just run by a group of really dedicated volunteers,
who try and keep track of all the government
make it open sources and spread it out to
the software your computers run, if you want
to use it in JavaScript, there are some libraries
that compile this data, but there are lmultiple
releases of the database every year, everyone
of the libraries has to recompile the data
every time there is a release, it means you
have to keep your libraries up-to-date, 
the server is going to have a list of time
zones, your client will have a list of time
zones and they can get out of sync very easily.
Keeping up-to-date is important. So, I gave
the first version of this talk at JSConf Australia
a year and a half ago, this is a list of changes
in the time zone database since I gave this
talk last time - {Laughter}.
Now, the last four here have an unreleased
date, mainly because they were announced after
I landed in Berlin for this conference and
I haven't yet made the full release of the
database, it goes to show how often these
things change.
When I first gave the talk I picked out one
prime example of a politically motivated change
that was hard to predict ahead of time, Crimea
switching from Ukraine to Moscow town, I can't
think of a more politically motivated example
than North Korea switching away from Japan
and South Korea to establish its own time
zone.
It's all very interesting, but should you
care? Yes, your users will, I know this from
bitter, personal experience.
If you want to so this is my tale of where
I didn't do enough research into time zones
initially and I caused things to go very,
very wrong. Not long after I started at Alasian,
JIRA the issue tracking software gained the
ability to
store user preference four time zone. I wanted
to spend some 20% time to ad in a little ad
on that would basically turn updating your
time zone into a one click operation. Just
detect when the browser was out of sync with
the user preference. This was fine.
I was using one of the JS libraries before,
JS time zone detect, what it does it groups
identical zones together so all of central
Europe is detected as use Berlin because the
countries all use the exact same rules. For
zones that have very similar rules but daylight
saving time starts at slightly different dates
it has some fine grain logic to work out the
difference.
This is working fine I did some statistical
analysis, usage of the feature was going up.
Then about a year later, something happened
it seems innocuous but Israel started daylight
saving time a few days differently from what
they were doing before. This combined with
the fine grain logic caused support requests
where users in Israel started being detected
as being in Gaza. As one of our customers
noted it was both incorrect and very offensive.
I don't know about you when I started in tech
I didn't really have career goals, I just
thought I would see how it goes, but I am
pretty sure that if I did have career goals
I would not have made one of them to increase
political tension. In a longstanding conflict
in the middle east. {laughter} so obviously
had to fix this, but how.
I couldn't just update the library, it had
changed its API in the meantime. I also realised
this problem could come up with other countries
in the future so I starter to rethink the
approach completely. Eventually, I realised
that the best way to do it was to get the
list of definitions from the surfer which
already had to have them anyway, filter the
list based on UTC offsets in the browser then
GIF the user a choice to make the final selection.
We have not had anymore support cases about
hot topics since then, but I found out later
that I wasn't the only one to have made this
mistake the known Linux software also has
a problem with people in Israel being detected
as in Palestine, it just shows it very, very
easy to get something wrong.
That's just dealing with the time zone definitions
themselves. So I found out later when I started
digging more into this that there are all
sorts of other problems to do with time zones
when you are dealing with software, as the
developers of Angular found out {laughter}
when the unit test suite would only run when
running New Zealand or certain states of Australia.
This was effectively a bug in the 5 specification
about how to handle historical dates, whatever
the daylight saving time rules are now have
always applied. Australia and New Zealand
started doing daylight saving time in 1971,
and Angular was testing for dates in 1970.
ECMAScript 5 assumes that those dates still
had daylight saving time. This has been fixed
in ES6 but the damage was done and the browsers
still had this problem.
Some people suggested I use geolocation, try
to detect where the user is physically and
map that too time zone. I can understand why
that's maybe not a good idea, we look back
20 years. So Microsoft in Windows 95, added
a time zone selection map. After a border
dispute between Peru and
Ecuador they started to have to redraw the
borders, the real kicker came when the Indian
Government threatened to boycott all Microsoft
products until the border drawn against Pakistan
was changed in their map. Microsoft solved
the problem by removing the feature completely.
To understand why this is such a problem,
you just have to look at Google maps in 3
different countries. In this case Google maps
Germany, India and China show the Kashmir
region with significantly redrawn borders
depending on where you are viewing the map.
There are some people who have tried to solve
this though, the geonames API, does take a
latitude and longitude and map it to a time
zone identifier. I don't know what they do
about border disputes I will leave that up
to them to decide, a lot of you will using
this API without knowing it it's better known
as the backing service for Apple's time zone
selection. If you want to use it in the browser
it's not at seam let's as it would be in Apple's
products, because every geolocation request
prompts the user to allow it. Some other things
I learned. You should never rely on the abbreviation
of a time zone as being a unique identifier.
For example IST, which some people will just
think is island standard time or island summer
time also applies to Israel and India.
The other thing is that IANA time zone identifier
such as Europe/Berlin is shown in UIs everywhere,
I have made this mistake everywhere. What
I realise the maintainers of the database
recommend you don't display them to the end
user, they are not easily translatable they
don't necessarily represent a region. They
recommend you use the long name of the time
zone such as Central European Time this is
where the Unicode common locale data repository
comes in they maintain mappings between time
zone identifier and translation in a whole
heap of different locals. If you want to use
this in a browser there's the jQuery globalise,
it can handle the translations for you but
as with everything there's now another trade
off. Comprehensiveness of the translations
and the file size you are loading in the browser.
That's a lot of doom and gloom, but there
are some better things on the way if you want
to deal with time zones in the browser. The
first one of these is the ECMAScript internationalisation
API. Which says that you will just be able
to do one call and get the user's time zone
identifier as determined by their operating
system. Unfortunately you can't do that cross
browser right now, the first version of the
specification had some very undefined behaviour
that been fixed up in version 2, Chrome is
the only browser that give you this right
now. It will do away with a lot of the problems
that I have encountered.
This is also led into someone wanting to do
a navigator.time zone much shorter API, a
way of getting that. It properly won't get
through because of the previous API but people
are trying to work at better ways of doing
this.
The current problem with the time zone database
as well is that every time there's a release
you have to be notified of it you pretty much
just
have to sign up to a mailing list, find out
when there was a new release, download the
new version, add it back into your software,
see how that goes. There are some people trying
to work on a distribution service so you just
subscribe to the service when there's a new
update you just get given the automatically.
There is one thing I won't listen to as a
solution. Which is swatch internet time, or
also known as removing the concept of time
zones altogether. Understand Stefano he wrote
a very good blog post, if you remove the concept
of time zones and just puts the entire world
on one single time reference, it still doesn't
help you know whether someone on the other
side of the world us awake or asleep at the
same time as you. It still doesn't let you
know if they are at work or at home. It just
changes the reference point but it doesn't
solve the problem.
Ok so we're getting to the end of a long day,
and I just want you to remember three key
things when dealing with time zones. The first
one is do you really need a time zone and
a time zone definition or do you just need
the concept of local time? They are 2 very
different things. For the majority of cases
I have seen, you just need to know what the
local time is for the user at that moment
in time.
The next one is if you deal with time zones
you will be wrong. I don't know where, I don't
know when but you will be wrong somehow. It's
like a moment of Zen, you embrace it, you
hold on to it you move on you try to minimise
how wrong you are. {laughter}
The final one is these problems have existed
for a lot longer than JavaScript has. There
have been people working on these problems
since before our language existed. Time zones
are hard and a lot of people have put a lot
of work into trying to make them easier to
deal with in software. We should learn from
the decades of experience of these people,
and not try and reinvent the wheel. Learn
from them, don't ignore history. Thank you
very much. {applause}</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>