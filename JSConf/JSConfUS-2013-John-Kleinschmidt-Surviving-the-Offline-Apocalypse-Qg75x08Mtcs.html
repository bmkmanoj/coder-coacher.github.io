<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfUS 2013] John Kleinschmidt: Surviving the Offline Apocalypse | Coder Coacher - Coaching Coders</title><meta content="[JSConfUS 2013] John Kleinschmidt: Surviving the Offline Apocalypse - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfUS 2013] John Kleinschmidt: Surviving the Offline Apocalypse</b></h2><h5 class="post__date">2013-09-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Qg75x08Mtcs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is John Clinton I'm the director
of technology development international
were a non-profit charity that operates
in 27 different countries we treat
conditions like hydrocephalus and
clubfoot and personally I've been
working on the web app world for about
16 years love doing things on the
cutting edge and so being able to work
for an organization that lets me impact
the lives of children throughout the
world and just a little piece of trivia
I actually did server-side javascript in
97 bonus if you know what that
technology actually wasn't but yes
that's once okay so try keep on
insisting so let's talk about why
offline matters okay in the u.s. we
generally have good connectivity but
it's not always takes major out of a
conference in the Wi-Fi side here it
seems great but sometimes it's not early
stage maybe you're at a hospital that
limits your data access for the Korean
War major somewhere like this you Greg
Glacier National Park which make a
chance to visit recently and their
activities I have to check out be
practically nothing which is great for
vacation not so great
work on now globally connectivity varies
a lot more great the reality is where we
work as a non-profit connectivity is not
guaranteed a lot of these activities
over mobile networks and the things like
power failures happen or the other
things in Africa connectivity is
probably about 10 years behind where we
are so you might pay late hundred bucks
a month for 256k service so so locally
connectivity is dis an issue and lastly
your servers may not always be available
and if they're not available you are
effectively offline you're effectively
enough and offline state but there's
also another reason that all my matters
me personally one of the conditions we
treat a cure is called hydrocephalus and
type of cephalus is water and brain and
as you can see by the child the baby
here you can see a large head and pipe
some of these have been really really
big and it's a deadly condition if it's
not treated a child will die but
unfortunately we've been able to prime
care to children with this condition
and the TOWIE see Don write their names
Tom and he has successfully have surgery
and is living at a completely normal
life so we operate this program in about
15 countries throughout Africa and Asia
and we work with local surgeons and with
local social workers to to provide care
but we have a problem and that problem
was how do we manage to record the data
from remote locations and be able to
keep track of the information from a
location work that we're doing for
quality assurance also for research
perspectives so being able to do some
research to be able to find what's the
most effective way of treatment
conditions so we need a solution of this
distributed we need a solution that
could work offline and we needed
something that would allow us to to save
their data essentially so I built a
html5 app that allows us to do this and
this app is what I would call an awkward
first app so offline first design or
looking to do is assume that you are
offline everything happens in an offline
content sure you may have online
accessibility but if you don't we want
to make sure that the app works
perfectly with with without the online
connectivity offline first design is
also very effective on a mobile app
because you don't want your users
experience a different experience when
the connection is available so what's
we're going to use this guide here
someone some kind soul printed out a
guide for surviving offline apocalypse
so what pretty as a guy we're going to
look living off the grid of the fourth
light shelter we're going to look at
somewhere to store supplies gun store
stuff somewhere we have that paddock
with memory we need to make sure that we
have all the tools we need to get our
work done and we have to happen escape
plan we're going to escape it they all
want apocalypse so let's look at what
that means so the first thing we need is
we need to live off the grid oui oui
somewhere we did a structure something
like this this looks like it could be in
tattooing but it's actually in New
Mexico somewhere but we need somewhere
to be able to store our structure and
application cache allows us to do that
so all arcs jsr CSS anything that we
need to render that app offline we can
do with outpatient cash now maybe you've
heard about patient cash maybe you've
heard that it's kind of a jerk and it is
but for something like a single page
it actually works pretty well okay so
we'll look at a brief example here you
can see at the top here we have a
manifest attribute in our HTML and this
just points to a manifest file that
indicates basically what we need to work
offline so in on the bottom part here we
have the declaration of cache manifest
as well as what's most important is a
smil section here where we list the
files that are required for offline
usage sorry CSS or fugitives and
intertribal screams and then throw
things that we don't need offline we can
specify that in our networks section
down below now one of the challenges
with application cache is that anything
that use the application cache will not
be updated unless you update this
manifest file so and the other thing to
keep in mind is any HTML any resources
served from the application cache even
if you're online you're native your
bottles will be served from the
hesitation cash so one of the things we
can do is make our manifest file dynamic
you can do this at Build time so when
you're pushing a new build up of your
app you can generate a new math as well
or in this case we're just using a
simple PHP file that's going to go ahead
and basically look at
I am staying up on your on your
javascript file to use that as kind of a
build number and then that will allow us
to dynamically update the application
cache okay so real briefly just talk
about patient ash browser support as you
can see it's supported most browsers IE
less than time it's not scored in its
not supporting the upper many but pretty
pretty good coverage and explain to know
more about application cache take our
tracks of a series of talks and articles
on this so if you just look for an
application caches of you you can
find more details button so from the
time perspective we we need to time so
okay our next rule for surviving the
apocalypse is that somewhere to store
our stuff and we're going to use index
DB to do that and the ins XD BTW is a
auto school the idea here is that you're
using key value pairs to store your data
it's a no sequel database its
predecessor web sequel was more of a
cheapish database but this allows us to
store our data client-side in browser
and it gives us the capability of
storing data
okay now I'll give you a word of warning
about the index TV it is heavily
asynchronous now if you're working with
xhr know you're probably not too
concerned about that but it is
consideration in developing the UI you
need to be aware of it you need to make
sure that you're working with it okay so
we're going to take a quick look at an
example of using energy so the first
thing we're going to do is we need to
open the database which you can see at
the top here and when the database is
open one of the first things that will
happen is the version Alicia so if it's
the first time you're opening your
database origin change the version
number so so something your schema
change you can pass it in
when that happens this on upgrading
needed event on the bottom fires and
that's where we can then define our
database structure so the database has
its concept of object stores which you
can kind of think of that as being later
dating these tables and and we define
what the iee or what keypad that's the
primary identifier for the object store
then we can also define indexes for the
database and those noises can either be
unique so that frees record it for an
index only one or two have a value or
you have 90 indexes which the second
piece of code here showing okay so as I
mentioned before it's an asynchronous
API so we have to wait until the
databases over to interact with it and
this is a function that might fire after
the database is open and everything that
we're doing we need to grab the
transaction so that's the first thing
new and then once we've grabbed a
transaction we can go ahead actually and
one because it's a no sequel database
you know you're just interacting with
with JavaScript object so it's really
easy I don't even have to in this case
specify what the primary key is it knows
that I be attributed as a primary key
student so we we can use that and then
down here we have an example of
retrieving the data use
I had higher that that the prime area of
privacy and I'm going to go through
these code examples kind of quickly I
will have my slide saleable so hopefully
the double useful in the future okay so
as you might guess one of the things
that connects TV gives us is indexes and
indexes are useful for surgically when
you start having larger data sets you
need a way to be able to efficiently
pull that data back and and there's a
couple ways you can do it so the indexes
in exertion kind of works in this idea
of key ranges so you can kind of stuff
like over low an upper bound on low
around and this example here let's say a
little view for all cats whose name
starts with ch so we can go ahead and
query the database get get all the
records back and pull the day the second
example is is in this case where you
have index items that are not unique so
like let's say category so in this case
I want to pull back all my cat pictures
that are cat here in pictures so they're
using that category so so we can do that
as well so that's kind of some of the
flexibility that Phoenix PD takes us
I've deal with this if I did
matt chrome devtools gives us a really
nice view into index TV so we can look
at all the time and we look at the
object stores we look at the indexes and
michigan senior we we can see keys and
our values and it's just really useful
to debug perspective to have us also
mention that Deadpool's has support for
application cache info file system API
which I'll talk about in a second but
that those are really useful when your
work on that to be able to pull and then
information okay so connect CD browser
support as you can see here the major
crowd you're supported the really no one
here is that iOS does not support it as
well as really sorry but there's a
polyfill and using a polyfill you get
coverage on practically every browser
you miss offer me but its support for
Safari as well as or Android no Android
Chrome for Android you supported
natively but if you have to support the
old anger browser the polyfill will look
into that and that Polly collection
works with the web see for each guy ok
so the next thing work I don't know if
anyone recognizes this this is actually
a nerf gun that somebody outfitted you
know made made it look a little retro so
it's pretty kick ass so we're going to
talk about adequate weaponry and
so so so what I want to talk about here
is maybe other pieces that was helpful
in having offline app and then the
schedule allows this new guy so it's
possible to make values before well it's
useful for storing files that the FAFSA
sweet guy lets you store sandbox files
for your app and in the case of RF were
using it to store patient photos so
having a way of storing that data
completely offline one of the nice
things about it is that you can get a
little URL to that those files up so in
the kc RF we want to display an image i
can ask the pasta meat guy for for the
local you're off with a fun so here's
your's good example and one of the first
things we need to do is actually ask for
permission to to use a file system and
we need to ask for how much storage me
and one of the concepts here is your
persistent five stores as well as
temporary office or so if you only need
your files to persist over a one section
they can temporary otherwise I use a
persistent office or so once we've
requested access to the file system we
can go come and open the file system and
again this API is asynchronous says they
need to to work with this and once we
open the file system we go ahead and in
this case we're doing is we're reading
from a file input in a browser we're
grabbing that file out and we're going
to save it locally and as you can see
here we just put the debug perspective
turn out the URL so that's a little URL
of five commercially we can also get the
data out in this example work grab your
file and returning back as a day to your
ID which could useful for various
reasons and in this case it aims in
Safari or maybe I actually convert it
into a dating your eye and so it gets us
out of a really flexible way a work with
files its hierarchical nature so you can
actually have like directories and and
in our case we use so each patient gets
a its own directory and then we can kind
of organize the files for that patient
that way okay so here's the bad file
system browsers work is only in crime
however there is a polyfill for this
they can see index TV so you're using
the browser uses in xeb you can use pop
system and if you really want to be
adventuresome you use the index DB
polyfill and then on top of it gives the
policies going to have polyfill so so so
it's not useful for everyone in our case
we actually put on Google Chromebooks so
we had a specific use case where we with
the target promise and I I actually hope
that other browser vendors
to the party because I think it's really
useful ok so we've talked about you know
these different rules of of the offline
and Pato surviving that one apocalipsis
the last one we need talk about is
having an escape plan so it's useful to
sort native offline it's really useful
if we can then store it online so so the
first thing we can do is when we're all
buying a safe happens we can go ahead
and Mark that record just have an
attribute that says this needs to be
seeing the circle so its first piece the
second piece is we need to know when we
are online now fortunately Thursday's
for such a property in the browser that
might give us some clue as to what's
going on here that's a navigator online
property now to treat a little bit the
description here it says the returns
true if user agent might be online women
point young come on this is the web we
should go whether or not wrong on not
but actually if you think about it that
that definition actually makes a lot of
sense because just because you're online
just because you have a connection to
the internet doesn't mean the we're
trying goes on so it gives the hint of
online
we can use xhr to help us figure out a
form online we also use the window
online event so let's take a look at it
a good example so here the first thing
we do is we establish a baseline using
an avatar mine property we can say okay
you know baseline seems our online or
offline we can also that tie into the
online and offline events and you know
if you do encounter on that's great time
to try to save our data online and then
the last piece here is when we do try to
savor via we can again if that request
is successful we can say well we're most
reasonably online but if it fails we'd
say well okay we're going to the server
room at least at this point okay so I
link to end with sharing this picture
and the research areas picture is
because these people are survivors of
the offering apocalypse they think this
group of people has been using this off
my app to help record the stories of
these patients that we've been helping
so far nine thousand kids have been
entered into the system there are
prisons nine thousand times that have
been saved so not only were we able to
use some cool technology
do it what were actually able to impact
lives so with that thanks for listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>