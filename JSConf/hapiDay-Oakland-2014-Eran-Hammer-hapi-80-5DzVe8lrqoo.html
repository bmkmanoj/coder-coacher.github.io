<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>hapiDay Oakland 2014 | Eran Hammer: hapi 8.0 | Coder Coacher - Coaching Coders</title><meta content="hapiDay Oakland 2014 | Eran Hammer: hapi 8.0 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>hapiDay Oakland 2014 | Eran Hammer: hapi 8.0</b></h2><h5 class="post__date">2015-01-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5DzVe8lrqoo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well this was awesome so thanks all for
coming this has been a really awesome to
sit here for a whole day and hear people
talk about your thing I've never
actually said through a happy talk
before by someone else than me so it was
so weird like people giving advice and
suggestions and things I didn't think
about it was like hmm okay ah I'm going
to talk about 80 which we officially
launched this morning and the slides are
just for visual entertainment it's a new
thing I I switched to index cards as my
new my new system for giving talks so
you don't get distracted but I think
I've done a bad job distracting people
with my slides today so the the theme
for a pH is really a productive
resentment of my users basically
everything in 8 is kind of like a
you to request from someone you're like
can we do this I'm like you know what no
I'm gonna break everything now um but
but basically the the the we hit a
critical mass a few months ago with the
frame welcome to the community and it
got so big that and that my OCD was
flaring up because I'm not used to
having over a hundred unread
notifications in my github account like
you know you wake up in the morning it
is over a hundred them and like my own
city is like I can't deal with it so I
start thinking about okay I need to
start moving things to other people like
like clearly like I'm not keeping up the
team is not keeping up we need more
people and at some point you know even
it comes like Walmart will say um yeah
we're not going to spend 20 million
dollars on open source for one project
so we need to get people on the outside
to to come and participate so I start
thinking about okay how do I keep
leading this this framework without
doing all the work we
man modularizing it and moving stuff out
so it's no longer part of the the core
framework so I people can work on it and
their areas of heavy that I really don't
like not because they're bad it's just
like I don't like working on them views
anything to do with fun in no I don't
want work on it I'm really sick of the
proxy stuff like you know after last
black friday like I don't want to any
proxy anymore it's a really important
functionality people love but I don't
want to work on anymore all the file
system stuff serving static resources
and directories these are thing I really
don't want to deal with anymore but
those are also areas where people have
requests and they have and they're all
unfortunately very reasonable they're
all requests that makes sense that will
make things better sometimes they're
bugs and I really I have no interest in
doing this anymore like I've been doing
a lot of this stuff for four years now
and I would like to do other things so
how do I move those pieces out without
having to constantly babysit them
because if it's a core part of the
framework then I can't just give someone
else it and hope everything is okay and
then you know make things that upgrades
will just happen so so version 8 is
really focused on enabling more people
to do more things both in the core
functionality and also outside so it's
really a release that is meant to to
allow me to say you know what you like
that go do it I don't have to do it
anymore you can do it now and so today
I'm going to touch some of the the key
new features and changes that I think
will enable that transformation of how
we work in the end are in the in the
ecosystem the the release notes are
quite long and the like I think like
it's like 70 or 80,000 key hub changes
addition and removing in this release so
it's it's gigantic I think that 140
issues as part of it so I can go and you
know like last year nah februari with I
really stupor no it's not crazy
different quests februari I went to
Washington State and I want to be and
yet office and I give a like an hour's
ten-minute talk going through like every
happy to feature there's so I'm not
going to try to do that today I'm going
to keep this shorter but I kind of want
to go through like the main thing so the
biggest change the most obvious change
is that we now have a unified API so if
before we had a server API and a plug-in
API and a pack API and I know that that
confused the hell out of most people
that's all gone we now have a server API
and that's one server API is available
everywhere whether it's when you're
creating a server if you have a survey
with multiple connections which was the
pack in previous version so if you want
to open both an API port and a web port
on the same installation which is a very
common thing to do or an HTTP and HTTPS
where you redirect from one another
that's just a server and you can add as
many connections you want to the server
so server and pack have been completely
unified I think package mean one
confusing concept for people in previous
version he was like the one of the thing
is like nobody could really explain what
what pack is so that's gone it's one API
now and then on a plugin side we had
almost identical api's between what the
server gives you and what the plugin
gives you but not exactly and they're
like you know area where they overlap in
areas where you're different so that's
all cleaned up now it's one API and
actually if you require happy only
exposes server now that's it that's the
only thing you can do is create a new
server new server that's it so the
unified API is going to I think it's
going to make things much easier I think
it's like if you've been using happy for
a while there is some breaking changes
in the way configuration is done now but
they're all pretty simple you know some
arguments moved into options you you add
your your connection by called
connection and by the way there's
nobody's happy about the name connection
like the function in connection in the
new version
uh and yet nobody has been able to come
up with anything better so if you come
up with anything better I'm happy to add
an alias to the function and then slowly
we'll move away from the connection name
but so far it's the best we got so deal
with it all right so dr. unified API all
right um I got a little look crazy with
Photoshop um second change is we i think
is the most important one i think it's
also the ones to make my life easiest in
terms of requests in that cascading
config so in previous version you had
your pack and fig and your server config
and your route config and your state
config and some of them overlap some of
them didn't it was really case by case
which one is the global config and which
one is the proud config and which one
you can override in which one you can't
it wasn't very clear and then if you're
in a plug in some of those configs got
overridden by the plug in config you for
bind all for pap so it was like all
those fine style ways which config works
which makes sense you know if you're
building something over four years and
you know people keep asking oh can i
override that for that route okay i'll
go and add that in so i got a whole
bunch of these requests accumulated and
I was like you know what this is just
we're doing it wrong and so the new
system is basically you create a server
you can do provide defaults for
everything so you can cry defaults for
new connections and within those
connection default for cookies in the
state defaults and you can provide
defaults for routes you can default
everything you want and when you get in
connection you can override the server
disconnect configuration with the
connection configuration and in the
route you can override everything so
it's cascading where they're at the end
you get one route config and in practice
it turns out that almost none of the
settings we had or do with the server or
the connection there all right configure
patient but they're all define high up
and what this is really enabling is now
plugins can take much more control over
things they don't you don't have to
write a plug-in where you say hey if
you're using my plugin this is how you
have to configure server first that's
really annoying because the plug-in
should be its own in captured in the
solution you don't want we have to keep
you know making outside requirements of
your developers you just say hey I just
just require me you know that's all you
need to do so the cascading config now
everything and things I move things so
it's little obnoxious in terms of now
you have this option structure that has
connections in it and then there's route
in it so things move the little little
side way in terms of the the JSON tree
but now you can actually understand
exactly what you're influencing so if a
setting is about a route and you're
putting it as a default in the server it
should say this is for my routes so when
you're reading your config you
understand what is that going to impact
it's not something you have to go to the
manual to to understand the another one
that's been like I got a lot of requests
for is promised to support and honestly
I've I never even looked what promises
was until like a month ago and not
because I have anything against it but
because I don't have any reason for it
so I keep hearing oh it solves the
callback you know callback nightmare and
all that stuff and I was like okay I
don't have those problems so i'm just
going to ignore it and I've ignore it
today successfully for a long time until
you know a lot of people ask for it and
at some point I said you know what like
let's see what actually means to add
native support for promises so I looked
at the different requests I talked to a
bunch of people since the community grew
significantly we have now we have some
core commuters who are using promises
all the time so now we have people
inside of the of the core group that are
promoting use of coal callbacks which we
didn't have before it was very homogenic
environment before you know I was just
like you know just the wall more people
if we don't use it internally then we
don't use it so in promises support we
now have native support for in two
places one is you
I reply with a promise so if you're the
handler you can reply with the promise
and when that promise resolved it will
actually continue the process people
have done plugins to accomplish that but
they're all very awkward and clergy and
they don't really work well if something
breaks in the middle of the process you
end up with this promise that nobody's
really paying attention to at the end so
now we have native support for that we
also have native support for server
methods so if you like server methods
unica now set sir amended return a
promise as well and talking about server
methods we in I think 71 or 72 I fixed a
bug that removed undocumented
functionality that you can use server
method without callbacks so you can use
blocking server methods it's all
documented it's not allowed to do you
can't do that but it worked because the
way the code was written it just works
so people were using it and using it
very happily and then I broke it in a
non mais release so like I did 71 and I
broke you know everybody's code and when
they came and complained I said well I'm
sorry but the documentation make it very
Mexico shouldn't have done that but I
didn't quite expect the response like I
mean the role lot of people who complain
about so in 80 now we have official
support for server methods so now we
have promises callbacks or no callbacks
and you can use all three of those with
caching and happy internally we'll wrap
it correctly to make sure that it for
its own purposes it's getting the
consistent signature for the function so
we got that in another one that's all
about me I really really want to move
the proxy the the file system and the
views out of out of happy core all right
I mean if it was up to me I would make
it that you have to you know install it
yourself but I know you know those are
really really core functionality in the
framework and people love it that you
don't have to do anything but I'm still
happy and get all this out of the box it
adds almost no cost so if it's they're
not using it it doesn't really cost
and like any any resources for you
unless you like doing embedding the
embedded devices in which case I think
happy you might not be the ideal
solution for an embedded device
framework but i really wanted out i want
to give to other people and wanted out
so in version 7 i got most of it out so
we have three new modules inert for
static files h2o2 for proxy and vision
for the view manager so we get all those
out but the way it was it was still
happy require them and then happy itself
called functions and integrated him with
the system so when you called server
that views it was a native happy
function that called you know a vision
function and and I rely I've been
wanting to move that stuff out for a
long time so what we have now is a new
feature called decorate so in server
decorate you can decorate the server or
the reply interface and make it your own
so for example if you keep finding
yourself doing reply and then for
success you always return some JSON
structure that says you know success
equal true and you know message equal
hooray and whatever it is and you keep
doing that again again again you can now
call server declare and you can
basically decorate the reply interface
to include the success method so now you
can call reply that success and that's
it you don't have to constantly repeat
that code the same thing with a server
you can i decorate server so you can add
features so in happy eight if you look
at the source code of a p8 there is no
replied proxy or reply that file there
is no file directory handlers anymore in
the source code it's still there but
what happy is doing it's not happy is
requiring those three modules I
mentioned those are now full plugins
they're just plain plugins happy
requiring them automatically for you and
that and those plugins decorate happy
without extra functionality what's cool
about besides me you know not having to
do it anymore is the fact that now you
are an equal footing with what I was
able to do before internally you cannot
do anything you want outside so all the
power that we before was you know under
score internal variable internal
facilities that you know it sound like
you know I I use them in other modules
because it were all mine there's none of
that anymore so those plugins are now
built completely on on public API and
and there's a new feature that I'm going
to use all the time a lot of people but
you cannot create a server with a
minimal flag and it will not load those
plugins by default so you can actually
create a server that has nothing it
doesn't have files or directories or or
views or any of that stuff you can
create a completely bare bone happy
server and that means you can now create
your own Fork of the file system plug-in
and and change the native functionality
the way you want to be a more advanced
concept is called realm realm is new and
happy eight I think it's the only really
new concept in the release and and what
realms are it's really like this is a
very primitive version of what I my
vision is in future versions but what
realms are is is a way to send box
plugins to their own ecosystem
completely so you'll be able to define a
final state a cookie in a plug-in does
not leak outside the plug-in it will
have zero impact on any other plugins
you might have so you can have a plug-in
that adds a bunch of routes define some
cookies add extensions and now that will
apply to any other plug-in so you can
have two plugins that have the same cook
you define what are the same in the same
name because that that's because HTTP
still going to send the same one but but
you'll be able to define things that
will not leak or overlap between between
different plugins and with the
extensions really important because our
people have been adding extensions to
their plug-in functionality and the
problem is it's very inefficient because
now those extensions are running on
every other route in the Indy in the
server and so to avoid that you're going
to get a config that says only if I mark
this as my route in some settings then
run this extension on so you basically
with every other
you come in and you say hey is this red
part of my plug-in or it's not I'm not
going to run this extension on it's just
more function calls and some calls are
expensive in JavaScript so we're trying
to avoid that so that's the future what
room is right now is just a way to do a
two layer configuration so when you do
server when you have the server object
server has a realm and it's a container
that has a few properties you can look a
documentation see what's in there is
some settings in there and then the plug
area for plugins to put whatever they
want in there when you call register the
server that the register function gets
has its own realm that's different from
the root server on that server there's
also served that route which is the root
server that realm so in any place you
are you have access to two realms the
server realm which is the root realm and
then your own plugin realm everything
you add inside the plugin will be
faulted the local realm this is how for
example the view manager works so if you
define a view manager in two plugins and
you load them and they each have their
own templates with same name but but
conflicting meaning today it works fine
because internally happy will go and
resolve it with basically a private
version of realms in 80 it's done
basically by putting the view manager in
the right realm and then the rouse
default to that so I'm not expecting
older like completely follow what I'm
saying right now I've been playing with
this for you know for six months now but
if you really want to see how it works
and how it's being used go to the vision
module which is the view manager and see
how it's implemented it's basically
using realms all the way it's it's
really why fully had to expose the
concept outlet in public API in future
version what I really want to do is
enhance it to allow you to completely
sandbox your plugin as much as its
reasonable within one server so that's
that's realms another one another big
change that I mean it's probably not
gonna be a breakage for most people but
I think it's been causing a lot of pain
who people is logging
longing it's been very very noisy and
it's been very hard for people to say
hey look the longer facility is nice but
like happy generating so much logging
noise that if I'm trying to also add my
app noise to it and then the filtering
is it's just too much going on so we did
a couple things one we split log into
internal logging now has its own and
meet emitter event then your app logging
so those are two split now so if you
subscribe to request you're only going
to get when you call request log you'll
get those events you're not going to get
all the internal stuff at happy
generates I got rid of about half of the
internal logging that works just stupid
not adding any value clean up all the
other the tags for the event so now you
can actually and also document all of
them so now there's a page and I api doc
that tells you every single event that
happy will admit internally and you can
now see if you want to subscribe it or
not and what to do about it's a lot
quieter and and the last one it's a it's
a small one that read has been waiting
for for a long time and that's the bring
your own bring your own listener so
basically we have the node HTTP server
and you know first of all their their
their new ones now they're you know
there's one for speedy HTTP two people
want to have different implementation of
this of the of the HDP listener and as
long as they've compatible API with a
node one why shouldn't you able to use
it up until now happy create its own it
was internal it only exposes after the
fact so if you did serve that listener
you can get the actual node object but
there was no way to affect that but and
also happy kinda like you know required
to start it its own listener it will not
allow you to do anything with it and
their environments where your your
deployment requires you to actually do
something else if you have an
environment like the yellow environment
it's a platform feature so you provide
the platform with a HTTP server and the
platform called listen on it with their
own their own port then they find and
that allows them to hook it in the right
routing tables and the route load
balancers and security purposes so now
you can do that and my hope is that
beyond just the deployment feature
well this will give people it also means
that people can experiment with
alternative forms of transport so you
can try to run happy with speedy to with
speedy over it with a CP 2 and see see
what that looks like without having
happy to die natively support those
features and again the goal is really to
enable people to do more on their own
without having to come back and request
core features and can kind of make the
surface area of course smaller easier to
maintain and and also not put me as an
opinion that matters of how you want to
build your app allow you to design the
features the way you want them and and
between all those new facilities and
changes I think that you now finally
have the power to kind of fully make
this framework your own and and decide
how you're going to deploy it so at the
beginning most of these changes like all
these changes came from basically
productive resentment of you know people
asking for more and more and more and
and because it's accumulated because
there are so many open issue at some
point I think I'd like 80 open happy
issues at some point it actually was
productive because I was able to stop
and say okay here's the big picture of
what people are asking for and I was
able to start seeing patterns of word
but the community is asking for it also
get you both time usually a you know I
used to close issues within like a day
so there's no discussion involved like
someone asks for something I say I don't
think so I close it and that's it so it
because I I my also doesn't allow me to
leave an issue open for more than five
minutes it's just like it's there I can
deal with it so this more this way by
basically being overwhelmed give people
more time to discuss it and also we open
some discussed channels so people can
actually have long-term that are not
closing five minutes all that accumulate
together and and really give a good
picture of where the happy communities
today and and so this release is kinda
like my office
you'll hand over of a lot of
functionalities back to the community
and say hey you know what this is no
longer to be me who's going to make a
decision we actually have a community
that runs the project and decides on
those things and my my influence going
to be on the semantics of the plug-in
API but beyond that that's just the the
the mechanism but all the meaningful
work is now fully open and empower other
people to really take control and
experiment with things that before we're
hard to do if we don't like that the
command-line CLI is a good one where we
didn't have an innovation on the command
line and the manifest in probably over a
year and a half now and it's been like
an area that like I should I had no
interest in working on also it's an area
where it's kind of hard to to experiment
with because people using it for their
production that's like the closest part
of the framework to your ops people so
they often I'm going to want that
constantly breaking changes and how the
config file is done because that's
painful so that's an area that you know
we move it out and now there's
opportunity for people to experiment and
try new things and see what works for
them and offer competing solutions for
how to deploy this so that those are the
main things I'm happy to take question
if you have afterwards but please try it
out enjoy report bugs ask any questions
you want never be shy of asking an
opening issues you know open issues for
whatever you feel like opening issues or
issues are free the only cost kids have
some storage money so we don't care
about that and yep use it so thank you
very much and thanks for coming
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>