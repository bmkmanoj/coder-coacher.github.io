<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Nick Small: fighting crime and kicking apps with Batman.js | Coder Coacher - Coaching Coders</title><meta content="Nick Small: fighting crime and kicking apps with Batman.js - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Nick Small: fighting crime and kicking apps with Batman.js</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6PalBljoP3Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello I'm Nick I'm from Shopify like
Brendan said and I'm here to talk about
yet another JavaScript micro framework
there are people a lot smarter than me
and I'll probably manage to pitts a good
number of them off today but my bullshit
title at Shopify means that I get to
play with JavaScript frameworks all day
long and it's awesome so let's talk
about frameworks we want to build great
web apps that that can mean web apps or
embedded apps or no taps or anything
else that people like all of you are
going to build but talking specifically
about web apps it's important to to
decide what kind of web apps we want to
build so this is an old cappuccino slide
that I really like it's about the
spectrum of different kinds of web apps
on the left you've got really simple
just text document based pages and all
the way to the right you have desktop
style applications like cappuccino
builds like 280 slides so frameworks
like backbone are aiming more towards
kind of to the right somewhere between
something like Facebook and something
like 20 G slides where you have a fair
amount of interaction but not
necessarily the fully stated model that
you would have with a full desktop
application the problem is is that
building these kinds of apps is still
really hard there are a lot of moving
parts involved and complexity explodes
for anything but the simplest of
applications so at Shopify we have a
really big app to implement like
seriously this thing is huge hundreds of
endpoints and models and routes and Ajax
requests I mean things pretty crazy and
so the complexity involved is
mind-blowing what we wanted to make it
work so my job is to sit there like a
monkey had a typewriter and figure out
how we can make that happen but the
thing you need to understand is that I
am the only JavaScript developer at a
company full of Ruby developers that's
that's the important thing to understand
for this story so I started implementing
shop fight as a nap in backbone and
backbones pretty awesome yeah so I was
able to get a few tasks working really
quickly I was I was impressed I showed
it to everyone else they understood the
code they also were impressed but
something didn't seem to compute for
them even more importantly was designers
we have a team of really talented
designers but showing them this giant
javascript file where they basically
render their views in JavaScript code
not going to happen you show a designer
a bunch of JavaScript code they will
punch you in the face so we wanted
something that doesn't make designers
write a bunch of code that lets them
work in the tools that they're familiar
with I played with everything all of
these frameworks are great I love them
all please keep building really awesome
stuff but none of it works specifically
for what we wanted to build so it was
either we we came to this impasse we
could either invest in one of these
technologies that wouldn't do exactly
what we wanted or just give up on
everything but I realized that there
were just a few specific goals that we
needed to achieve in order to that we
really wanted to solve first of all
everything should be really fast really
fast start up the runtime and everything
in your app should be fast and that
means that a lot of work needs to be
done to make sure that there's no long
running code or big loops that are you
know causing a lot of things to change
within the app and it also means that
development should be fast as a
developer as an implementer of code you
don't want to spend a lot of time
messing with the library or with the
framework and you just want to develop
your app that goes hand in hand with
maximizing developer cough happiness so
for better or worse in a company full of
Ruby developers that means CoffeeScript
don't get me wrong I love native jas but
CoffeeScript is definitely beautiful and
allows you to do some things that we're
pretty hard to do natively more
importantly it allows you to implement
certain things just just like what a
developer is is expecting when they sit
down to look at the code and that's
really important is the path of least
resistance that goes hand in hand with
rails looking now let me be clear I I
don't want to reimplement rails in
JavaScript and rails is definitely not
the end-all of web frameworks but for
our company full of rails developers
sitting down and looking at some code
that looks aesthetically similar to
something like rails it again follows
the path of least resistance so spoiler
alert that's going to pop up a lot it
should also maximize designer happiness
things look different in the eyes of
designers and they're used to their HTML
and their CSS they don't want to write a
lot of code it was a struggle getting
designers to work with ERV templates and
also the more you can be couple with the
designers they can work on their code on
their HTML you can work on your business
logic and it's really easy to make that
all work together or it should be and
that's what we want to do but designers
will still write jQuery code or you know
whatever to make cool things happen on
the page so you want to give them a
place to do that without interfering
with it and without blowing all of that
jQuery away every time something in the
app has to change designers should be
allowed to have rapid iteration and
again when a designer sits down to look
at it they should know exactly what's
going on without having to struggle to
figure out everything that's happening
it should follow convention over
configuration when you have some a lot
of configuration there's all these
options that you have to set up and all
different kinds of what at light bulbs
to put in and switches to flip so we
didn't want to do that with when you
follow well established conventions you
write less code you know where to put
your stuff which is a big problem with
existing micro frameworks like when you
start up a backbone app for example
where do you put all your controllers
where do you put all your models
in the same file if your app is big then
do you put them in different folders
which folders so we wanted a place to
put your stuff and again when there's
well established conventions you can sit
down look at something and not have to
figure out how it works because it works
the same in every single application we
also wanted a really powerful system of
bindings so part of the problem with
building large apps is keeping them in
sync you when data changes in one part
of your app you usually want to know
about it somewhere else you either end
up writing a lot of code yourself or if
if your framework has implemented a
system of bindings it's usually just
kind of attacked on thing so we really
wanted to build the whole framework
around this powerful system of bindings
and that means that everything is really
really fast and finally there's no
templates when you have templates in
client-side code like ejs or eco or any
of these other templating languages they
were great on servers but we're not in
that stateless environment anymore when
you have templates in JavaScript
whenever anything in your app changes
you have to blow all of those changes or
you have to blow all of your Dom away to
replace it with a new dalam plus they
make designers program they ruin the Dom
whenever anything changes they're really
slow so not only do you have to replace
entire sections of your page but you
have to parse that string first and then
create nodes from it and that parsing
can take a long time like in the case of
the original mustache and they also mix
logic with design so we didn't want to
use any type of JavaScript templating
library and the final goal is to be more
of a framework and not a library when
you have a library like backbone or any
of the other JavaScript micro frameworks
it's a section of code or it's a chunk
of code that you can call into and make
cool things happen but you're still
writing a lot of glue code and and
boilerplate code to connect into that so
if you have a tiny well-written
framework
then all of that glue code and
boilerplate can be taken for you can be
taken care of for you so you just
concentrate on writing your actual app
so those were the goals that we had and
that brings us back to the dilemma we're
back at this impasse do we want to
invest in one of these other frameworks
or give up or you know do something
about it people told me to give up I
said sundial sticks to them we're doing
it anyway realizing that these goals are
probably completely unobtainable I
started building Shopify as the app that
we wanted to see the result is a
framework that partly extracted from
real work and partly my own
over-engineering fancy but that
framework is Batman j/s so what is
Batman it's really fast everything's
fast developments fast start up as fast
runtime is fast maximizes developer and
designer happiness and all the ways that
i mentioned convention over
configuration powerful bindings and no
templates but what we have instead i
think is better than templates and
everything is designed to just make
sitting down and looking at this code
really easy so this is Batman we're
going to be releasing it under the MIT
license soon but let me show you what it
looks like so Alfred is the first
example i want to show you everybody
always has to build it to a to-do
manager it's just kind of this canonical
thing but doing it in Batman is so
trivial that it's almost not really
worth showing a demo but that's what i'm
going to do so it's file
sorry i meant to have it open so this is
the basic template say a designer gave
this to me it's just an empty HTML file
here's what it looks like doesn't do
anything yet so we want to turn this
into an actual app down at the bottom
here you see we have a simple app called
Alfred it extends Batman app and then it
runs but nothing actually happens yet so
I hate live coding but this is pretty
trivial so let's do it first of all we
need a model called to do and it extends
Batman model pretty straightforward and
CoffeeScript makes that really easy and
it's still using prototype will
inheritance as opposed to a regular
native JavaScript class library that
would have some have its own complicated
class system now you don't need to
declare a schema all the bindings will
just be set up automatically you can if
you want to sew a to do will have a body
and in is Don attribute and then once
you have that model you can do things
like to do at all and that will return
an array of all the to do's right now
that's empty so why don't we say if not
to do all that length then you to do
and you can put that somewhere and then
call to do not save so it's very
straightforward to look at you can it
does what you expect and if we run this
it won't do anything but it doesn't
cause many years the to do is now saved
in the data cache but we probably want
to actually make it do something so for
our list of items for every item will
have a checkbox and then a label and
essentially what we want is the label to
have the context or the content of the
to do so we want to write something like
data bind is to do dot body so using
data attributes we have a number of
hooks into your app they take strings or
executable code and then they can run
pieces of your app get data bind to data
and keep that note in sync with all of
your data and the important part is that
the node itself is is registering an
observer on your data you never have to
there's never like a big Dom tree that's
mapped that has to walk through whenever
data changes so it's really fast the
node is in charge of itself but where do
we get this reference to to do well
aside from the one that we defined that
in here but that's not global so what we
want to do is we want to iterate through
the collection of all the to do's
there's another data binding that will
iterate through a collection you can say
for each and the variable that will be
defined within that loop will be
whatever you pass it and then finally
you can say what you want to iterate
over so this is saying for each to do in
to do all create a new list item now
whenever a gets added it will create a
new list item whenever one gets removed
it will remove the corresponding note
from the Dom it never rear enders the
whole list or anything like that so if
we run this there's the first to do we
can also bind the check box to to do is
done and now it'll work but we don't
have anything to show
whether the to do is done so we want to
say add a class named to the label we
can just say data class and then the
name of the class that we want to bind
so in this case the class name will be
done and we'll also bind that to do is
done so now when the to-do item is done
it will automatically add that class
name to the node and take it away again
when the binding changes so the node is
taking care of itself it's really fast
and you never have to worry about any of
the glue code to make that happen if we
just add a couple to do's play with
so now we have some to dues that we can
play with the next thing that we want to
do is bind this delete button to the
actual action so you can use event
bindings and now whenever it gets
clicked on it will call to do not
destroy now why would you use an event
binding as opposed to on click two
reasons first of all it uses add event
listener instead of on click and second
of all it's within the context of
whatever context your range so we have
access to this to do variable and we can
call not destroy on it so now these
become links and if we delete one that
node will be removed from the Dom
without messing with all of the other
nodes Batman also has this is a really
simple mixing system and a few
predefined mix-ins so if you want to do
something like make this label editable
you can just say mix in editable and now
that will apply all of the properties to
that node from the editable mixin to
make it in line editable and then when
you change that it will automatically
update it should automatically update
well live demo digs break I'm not going
to debug it but it should normally
automatically update that it gets really
cool though because you can also say mix
in animation and now whenever okay
everything's breaking well whenever one
gets created it will animate in and when
you delete it it'll animate away and
finally we can make this form actually
work there's a form for binding so you
can give it a context will say form
forward to do and it'll be to do to
create and now within this form you have
an instance of to do that you combine
two so we can bind this
input to to u-dub body I'll remove the
animation mix in so we can actually see
what's happening and finally when you
submit this form will call to do not
save pretty straightforward and now when
we add it there it goes if the animation
mixing was still there then that one
would slide in so that's basically what
it's like to build a simple application
d couple designers and developers and it
lets you concentrate on the cool stuff
unlike other frameworks like sprout core
or cappuccino though it's more like
backbone in that the framework itself is
really tiny it's less than 10k and it's
really fast because it just doesn't do
very much aside from just set up classes
that you need to to implement and extend
it's really tiny it's really fast you
can use it with an existing back-end if
you have an existing REST API like
Shopify does you can drop in that
back-end you can add to your models
persist Batman rest storage and it will
automatically persist to the endpoint
that that's just respected from the
model name or if you want to write in
end-to-end JavaScript app this is where
things get really cool Batman is
actually a full stack frame work so you
can build an end to end Batman
application there's a Batman node server
and it will actually use your same code
for client and server not a fake promise
it actually uses the exact same code
which we've seen people try to do before
but it hasn't really worked out so
seriously like you can have the same
model with the same validations and it
runs in both places you can also include
specific note code to run security
critical things or extra validations on
the
over that you don't want in the client
and you don't have to recreate your
model in both the client on the server
it'll just validate when it comes in to
the server so when you have a model like
my model you can just say persist Batman
and then it will automatically sync that
model with this server and whenever the
model changes for anyone it will change
for everyone and the Batman server uses
web sockets to to make that happen and
persist across everything if you want it
to otherwise so it's a full stack frame
work if you want it to be otherwise it's
just an awesome tiny and really fast
client-side framework so am I on time
okay I for another example I want to
actually show you what it's like to
build a full app the to do demos are
cute but it doesn't give you an idea for
what it's like to build a full app so I
could not think of anything more name
than building a Twitter client Plus
Twitter said don't build more Twitter
clients so Twitter client here we go so
basically what this demo is going to do
is it'll get a stream of public timeline
tweets and then let you locally comment
on them and persist those comments to
all other users of the Twitter comment
application so as a just to start off
your app you'll say Batman gen app
Twitter so there's a full tool twin
chain of generators and things like that
that you can use to create your app and
give it a structure so the response to
that will create your application create
your models in your views folder so it
gives you a place to put your stuff and
it it gets you set up with with a
convention that you expect and then you
can CD into Twitter and run Batman
server to start up the server so we say
Batman server then the default app just
looks like
it's just a simple app it has a binding
so when you change this text field it
updates the binding that's just the
default of what happens when the
generator gets invoked so the next thing
we want to do is we want to have a model
called a tweet so we can generate that
and it'll generate the file for us this
is the code that we want our put our
tweet model to look like it has many
comments so you can do associations
those are built in and then we'll have a
fetch method which just sends a JSON p
request to Twitter search it gets cut
off but it's using the the query object
and then we'll create a new tweet and
save it for every result that comes back
in from Twitter next we'll need a
comment model so that'll again generate
the model for us and the comment models
will persist to the Batman server they
belong to a post we you can have
validators like here we're validating
the length of if you are familiar with
rails this should look really familiar
even though it's working as a JavaScript
app and not a server-side app and then
we can define a schema the next thing we
need is a controller so in the default
app controller that the generator gives
us we have an index action now when you
have an action on a controller if you
don't return anything then it will
automatically render the appropriate
view for that route otherwise you can
specify what you want to render or what
you want to redirect to like in the
search action we will call our fetch
method so it'll send the request to the
Twitter API and then it will redirect to
a URL with that query in it and finally
we'll have a comments controller the
index action will fetch all of the
tweets or a specific sweet sorry and
show you the comments all the comments
for that tweet and then new will allow
you to write a comment for it sweet and
both of these routes will be handled
automatically by by Batman so it will
automatically generate the route matches
that need to happen to call these
methods
finally this is what your view would
look like you can still just because
there's no templates doesn't mean that
you can't still have views in different
folders so we have view / comment /
index and this HTML will be rendered
when that action is called and it will
render the tweet it will render all the
comments for it so let's look at what
that looks like i will switch to the
full version so this is everything that
we just implemented in slides you can
search twitter give it a hashtag to
search for so we'll search for jazz
cough and once twitter comes back there
we go so these are the results of the
search on twitter and that's just the
tweet model they get saved in the model
and then we can iterate over tweet doll
so you would think that there's more
going on on Twitter right now good call
so I can change this right in the route
and and it'll update everything okay j/s
conf and these are all the tweets about
Jess Khan and there's me so you can hit
the new comment button and that'll take
you to the route for this tweet /
comment and that will create this is the
new comment action we can get that's my
name and then give it a comment submit
and now this is the comment section so
it's our list action and it will list
all of the the comments for that tweet
you can head back and the routes will
update even though we're still you know
in the same application and the fact
that it's using the hash URL is just an
implementation detail just like in
backbone when put state is gets a little
better than that can change within
Batman without affecting your
application so we can add another
comment and there it is and if we go
back to the Twitter timeline now this
tweet has a comments link that will take
you back to the list of Commons
so that's the Twitter comments demo when
you look at the code you can sit down
and really easily see what's going on it
looks like what you expect there's not a
lot of figuring out to do designers can
independently work on the templates like
comment / index.html the designer can
build that that HTML page and then it
automatically gets rendered into your
app where you want it and finally the
whole demo which pulls from Twitter it
models and has relationships and
associations between those models it has
routes and it renders Hughes and
everything was less than a hundred lines
so next Batman it's really fast
developer and designer happiness
convention over configuration bindings
no templates and optionally it's a full
stack framework to persist things over
over the server less than 10k and it
will be MIT license very soon we also
have Batman chase org which will have
lots more info and examples and that
will hopefully be live later today so
you can check that out and then we have
one more thing we have this crazy demo
with a lot of moving pieces and it used
to involve an Arduino but that Arduino
exploded so we're going to fake the
Arduino part that's okay this is what
the Ben andreas website looks like
except without filler text that's not
what I wanted to show you JS comp node
stir calm so I this is the
crime-fighting application unfortunately
right now there's no crime so if i can
get cell phone reception that's the
other thing is that this needs cell
phone reception and i had not planned on
there not being any cell phone reception
so i'm going to try to make a phone call
hey it worked so what's happening is
this is a Batman application running on
the Batman server with troppo in the
background that will send messages to
the Batman server so as soon as I called
it sent a message to the server which
then sent a message to the client that
updates this page so if you see crime be
committed which you do because I just
committed a crime please call this
number so if you have cell phone
reception please call one eight eight
eight nine Batman and if not then a
there's two oh man those lot of crime
going on and so every time a call comes
in it pushes the number to the client
the client can update and then as soon
as it reaches a hundred percent then the
no file comes on and sends the signal to
light up the bat signal and when the bad
signal happens then Batman appears
thank you Chris
so thank you for reporting crime I so
that was the batman demo BAM andreas org
it will be up later today thank you very
much roads take me home to the place I
belong pork the door again jazz calm
country road</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>