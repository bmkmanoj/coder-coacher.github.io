<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfUS 2013] Daniel Tralamazza: How to prepare a distributed nodejs application | Coder Coacher - Coaching Coders</title><meta content="[JSConfUS 2013] Daniel Tralamazza: How to prepare a distributed nodejs application - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfUS 2013] Daniel Tralamazza: How to prepare a distributed nodejs application</b></h2><h5 class="post__date">2013-10-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7HxIWpuH1Wc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">nervous and definitely we can burn water
which is this really cool start up a new
system blows up well he gave my day was
here from Iman inevitable and I'll talk
a little bit of a low GS and our music
there's some distributed systems yes the
shameless blood as that I am Emelianenko
coaster and you should all check out
their web page because we do have some
pretty cool so what we do we could
Maggie so protesting which means we take
away cake how do you modify we mr. in
Jeff's report even more yet magic and
have a bunch of servers and I'm going to
talk about service so what's the server
we have this in the beginning one very
monolithic huge no TS server and it does
contain it Francis requests from several
sources it serves our clients choosing
in there and vaginas it does all sort of
things we talked to many is in the past
now we're talking mostly these ones
you're happy
amazone center for now so that's y SI es
original system so yeah it's a big huge
why I don't have lay down how big no GST
wishes are getting these days but it's
around 50k line of code oh it was
actually working for educators and the
en suite red is almost 1k flights every
crevice we want to freeze all your boat
motors dependencies and dependencies of
the Pegasus they displayed by quickly so
yes we consider it up a nice application
so they are arbiter of my blanket
because I working mostly certified let's
make this thing is simple and makes
super by breaking thing which is for me
a beautiful condition because it should
make in important variable is small
thing not to worry how they competition
so I just
so this real applications their program
are going over the mother brain of the
error problem and they are harder to get
right because there's so many ways I
think of doing it wrong and so forth so
on so what did i do what did we do we
took something and ready words which is
you know the body ache I think so
where's subject baby and it works on
change is hey to be one point straight
super and that's why we use it for us
and we're going what I call the service
and yes I cannot name it what it does it
is streamate you know he management
remote dependencies I optician it has
the bodies nice one point so they come
out and they go down people remove what
we try this magic in the code and all
that because I like sugar any like sugar
I like to just sit down and worry about
the business like I don't I'm done again
in the most complicated way so we wrote
this way this layer on top of vino and
just go back to like how I campaign
things I cannot even named things
manually like this kind of so maybe
think this is really annoying and you
have a lower Earth and Mars and you
still trying to name the object of it
name is Emily will be annoying to get it
right party so this has been going since
the 97 make for our support when
anything's wrong with Rachel so we have
necessity s.s.d.d to Microsoft and then
we have homeroom everybody knows and we
have SLP which is this thing from 97
actually which is actually very nice you
have attributes you have a multicast
unique as if it's a really broad
encompassing implementation
specification but nobody uses of course
even dhcp has something for naming
objects st unbelievable so we end up
picking mdns why because it was there
ready and it just worked and i work this
work is in quotes mdns on apple machine
will use the bunch of implementation and
it will work flawlessly but on a limited
machine it will use the valley
implementation and there is this lead
compat mdns on top of a vine and that's
a very messy piece of code I know if
anyone here had the experience of mdns
there is a node module which we use call
mdns it's super simple to use it you
just register something you give it a
name you can browse it later and it will
find using multicast on on specific IP
the thing about mdns and because it uses
this lib compat is that you get lots of
error on
no I don't know about this unknown thing
like who came up but it should be very
rare that you get an error unknown maybe
something like a cosmic ray flipping a
bit then it might be an error unknown
but in mdns case because of lead combat
you get tons of our own nose like if the
P thread fails or memory location
allocation fails or some other avahi
related error happens it bubbles up to
to us to the OGS implementation as an
error unknown so we are moving away from
from this because we have this in
production by the way it is this all
this I'm talking here we have a running
on Amazon or on virtual appliances and
we what I'm going to do is eventually
implement multiple engines a bit like
socket i/o has this down grain or
engineer has this upgrade procedure of
trying one engine and going up trying
different ones this is my current goal
so a bit of an example so because
because of timing i don't know if there
will be time for for demo I think maybe
I the thing commented out is is the
that's the example take it straight from
denote website and I just committed out
the differences which is required and
and how you create it so is I give it
this with this name here called d1 and
is the same function and instead of
picking up a port I just do a start and
this will pick up automatically a port
it will use the whatever announcement
advertisement engine in this case mdns
it will broadcast the port to anyone
interested in this in this service this
service has no versioning so whenever
you search for it it will just fine but
there is a versioning support so this is
soon this is not rocket science by far
there are other projects in fact this
this thing is been working for a couple
of months now there was another project
called hookah
by maroc I think and it does it this
thing has several like similarities with
that but it's not the same that and
because who kayo seem to have to die
down I didn't really see that much
activity or I chose to implement this
even simpler object registration for
Strings so declare the defocus you get
the client you just say oh give me a
servers and fine for me and denote for
that name which is d1 and then you call
as a as a GNote really seriously this is
the same you get the same objects back
nothing nothing seriously different but
this only only this server is boring
right it's not doing much what I want is
remote dependencies why because looking
back our problems are requesting usually
involves talking to several API several
external things I'll go to check this
mixed panel thing and go to the database
and you know many external tools and
api's to interface with and all of them
they have errors and we found out
through painful moments that error
handling is really not that simple and
easy when you talk into these multiple
sources you have timeouts everywhere you
have all sorts of things and the code
gets uglier bulkier so what what I want
is like I want dependencies I want
automatic dependencies on these small
services see if and I want two types
hardness soft dependency heart
dependencies if one service goes down I
want the whoever is depending on that to
go down as well and a soft is well it's
not it's just you can continue so of
course it's up to the programmer to 22
gauge what is the soft dependency what
is in a hard dependency but yeah so this
is how you implement the second server
service called d2 and it has a different
function instead of it explore this GS
com
here and the only difference is it has
this server does rely on d1 and this is
a hard dependency so d 2 goes up
whenever d1 goes up this guy is notified
and it also goes up do you want goes
down if there are no no other d ones in
the vicinity this guy will go down as
well and yeah that's this is the type of
sugar that I that I like I don't have to
really worry about like implementing
custom event handlers and checking these
things and of course again there's like
a timeout handling retries the load
balancing it will try different
endpoints according to reach riders
couple of metrics sorry yeah so what is
the working progress is cycle detection
which is fairly simple these multiple
engines in cases the advertisement is
advertising agents engines SLP is the 1
i'm coding now i started two days ago
there's a library called open SLP and in
implements the then-new the latest RFC
for SLP and that should be done soon
actually if anyone wants to help i
really like that but really appreciate
and it's a c++ native module and this
thing is which is a hack is I want to
just to add this small remote dependency
in the package.json and basically have
these two to be that rely so I can code
small npm modules and having the
package.json their remote dependency so
i can just lounge that npm module and
have addy service to automatically
already do the real I that registration
maybe even simpler isn't like just more
sugar but yeah even simpler to to manage
so I have these extra I know if I have
time maybe I won't have time so this is
the transact the stream part do you know
this stream based but streams are not
the end all they don't cure all illness
like students are composable they're
really cool but there is one thing that
we like
is a repeatable operations and it's it's
at some point you will buffer things
because you have to repeat so of course
you could do the absurd which is an
operation fail retry then operation fail
retry retry until you get to the end
user and you get an alert to him like
algae's repressive submit on the form
again but that's not really nice so at
some point in your on your pipeline you
will buffer something and retry later do
this later is could be in a millisecond
or seconds later so transactions are
kind of required and we do have another
implementation which is all I call a
pipeline but I don't know if that's the
correct name which is basically a chain
of operation steps and these steps are
and funny if I know fancy word it then
potent so you you must be sure that you
can call that thing multiple times and
it will give you the same answer and
what it does is you you will see realize
your comment some call you will have one
input and one working q / first step so
you implement a small a small function
that is processed something and this
working Q is what guarantees you that
you can retry operation safely so we use
right now readies but there is also a
kestrel in darner darner implementation
which is just fast faster castro in c++
and what you have is you have this
working q atomic operations so you even
if you fail if you timeout or whatever
you can completely kill the service put
it back up and it will automatically do
the recovery for you given that your
step is it the impotence so it's it's
not a problem and we have this in
production as well as really yeah simple
I won't have time to show I'm sorry so
everything will be open source I got the
approval from from the overlords and
yep I thank you thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>