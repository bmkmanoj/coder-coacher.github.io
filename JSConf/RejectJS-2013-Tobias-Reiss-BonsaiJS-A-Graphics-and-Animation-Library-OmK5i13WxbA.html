<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[Reject.JS 2013] Tobias Reiss - BonsaiJS -- A Graphics and Animation Library | Coder Coacher - Coaching Coders</title><meta content="[Reject.JS 2013] Tobias Reiss - BonsaiJS -- A Graphics and Animation Library - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[Reject.JS 2013] Tobias Reiss - BonsaiJS -- A Graphics and Animation Library</b></h2><h5 class="post__date">2013-09-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OmK5i13WxbA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi thank you for having me here my name
is Tobias vice I'm working as a software
developer forex evil and one year ago we
open sourced bonsai chess graphics and
animation library and I think it's fair
to ask why yet another graphics and
animation library I mean there it feels
to be there tons of 2d expertly 2d
graphics animation lab without there
some claim to be really the fastest one
in certain situations on certain
platforms certain browsers and def mode
but i'm not going to compare performance
today and it's more about the api and
the architecture I think that's well
kind of unique at least the architecture
of bonsai Jas but first I I want to
introduce bonds edges a little bit so
it's it's written in JavaScript I'm not
coffeescript or typescript or whatever
script at all it's a it's written in
JavaScript and it has an SVG renderer
also written by bias it's open source
yep since one year so feel free to
contribute for you to fall back sir
issues whatever and even so we have
tests and and use it in production eip I
is not finished yet we still try to
learn from our use cases and the use
cases from the user's phone from bonds
ideas yeah and the website is sponsor
gesture dark so you can are a lot of
stuff Afonso Jess you can draw shapes
shapes have attributes you can apply
filter the filters like this drop shadow
you can animate your attributes and the
whole thing is to express your
creativity for example to
to to create infographics or to do maybe
little games or educational software yet
it it is supposed to work by the way I
don't know whatever that the funny thing
about that movie by the way is it's it's
created in the flesh ide so how did that
work and that brings me to another
product that is not open sourced it's
for also for mock Sybil and it's picks
the plant and picks the plant is a flash
to html5 converter so by flesh I mean
swf files so we really take the binary
and yeah so we can work actionscript to
as well as actionscript-3 swf 12 11 and
and bonsai is the graphics library
behind pixel plant so pics van actually
transforms the abscess wf2 bonsai code
and that's one reason also one reason
why we did why we did it why we build it
because other graphical a breeze didn't
provide all the API we need to to draw
our flash movies and and yeah that's one
reason by bonsai is flavored with some
API that looks familiar to some flash
developer you can find pixel plan on
pixel plant calm ok let's dive into the
the API yeah first of all that's the
entry point of every movie its bonsai
run and any pass a Dom element I'm yeah
we take the Dom element place the movie
there we create a graphics context there
and second parameters this movie of
course it kind of reference can be a
reference to to a file it can also be a
function
and I will go I become to the reason why
we don't we don't apply drawing
instructions on on the constructor I
will tell about it right now and let's
really let's I think it's one of the
smallest bonsai scripts possible and in
your movie in your bonsai movie you have
you have a global stage object and
whatever you add to the stage this yeah
it's supposed to be drawn on your screen
and and you a new movie runs in on
sandbox so what does that mean and that
means that yes you have actually no
access to the rest of your website you
don't have access to the dumb but it
allows us to take your movie and run it
nearly wherever we want so for example
an iframe of course okay that's that's
fair enough but also in a bad worker for
example so and of course on the server
but would be possible as well so yes we
can execute your movie in these three
environments and and still able to draw
your drawing instructions to the screen
and there is a way to communicate
between your website which I call the
main thread and you your bonsai code
there's API for that and I will show you
that a little bit later first of all I
thought okay how can I show API so let's
play pong okay I create a little game
and I'm by there to show you the API if
bonsai first of all I thought okay we
need a background image of course the
rejection logo and so we simply create
in your bitmap and yeah we add it to the
stage and that and that's it so what's
next
okay so we want to put it in the
background so I decided to apply filters
wellness opacity the other one is blur
the rest remains the same we also have
other filters as well for example
grayscale or CPR or or invert there are
others as well please have a look at the
the docs and boxed up bonsly just a
torque and yeah you can draw simple
shapes I use the wrecked API to draw the
pedals for pond and circle API to draw
the ball fill them there are more shapes
then what let's actually convenient API
right so star ellipse polygon we can we
could add more you as a user can add
more wild plugins the a generic object
for drawing shapes path is a path object
the cool thing about the path object is
it takes SVG like syntax and and
something you know from the canvas API
the PostScript like operators so what
does it mean it means you can actually
copy and paste your existing shapes to
the path and pass it to the path object
and it is supposed to work okay yeah as
there's a Calliope I of course but it's
kind of rich and and it turns out it
solves a communication problem between
the designer and the developer and by
that I mean in South iterations when a
designer says can you please take the
following color and in develop a service
okay cool I take it and he says oh well
it's not exactly color one can you
please make a little bit darker okay now
that you've all possess will convene
please just give them the color and yeah
we can help
we have lighter darker and midpoint hey
what about midpoint and if you just
can't agree you can also randomized
that's still possible and that is very
handy especially for gradients because
you now can say okay my first call is
blue my second color is also blue but a
little bit darker and that makes a
beautiful gradient I think I applied
those gradients on the pedals bonds are
also supports gradients okay utter is
the function we need to change any kind
of attributes so for example to change
the position we take x x and y it was
also responsible for any other
transformations like scale or rotate and
it is also responsible for any styles
like colors for example and yep pointing
events are built in so that means we
abstracted the point events for touch
devices and for i say most devices and
that should work and it works yep so you
listen to the stage the stage is is that
what is strong so we abstracted that by
by the word stage and then you can
listen to those events like pointer you
like pointer move just to be able to
show you the animation especially
nonlinear animations I decided to
animate the ball so we never read the
game start the ball is like this new you
cool so the API looks may be familiar to
most of you because
is nothing new also used by other
graphic libraries so you have a duration
you pass all you attributes you want to
animate and have some options to also
change easing and end stuff we also have
you frame animations that's nothing else
it's it's just animation where you can
decide to change the attribute at a
certain time but it's still all about
changing attributes and this is really
just convenient API it's what we do
inside is we change an attribute which
is path so what you can do with more
tools actually you can switch from Earth
to ball by mopping all the shapes yep
this is this is a the abstraction layer
of the timeout or interval or
requestanimationframe you can listen on
the tick you can listen and a tick event
and and place all your business logic
within that callback for example yeah I
decided to write a plug-in and now we
have walls and the ball yeah I think we
can you can play now right so I will do
that just to proof it's possible yeah
okay go um thank you very much
so I think it's much more fun if you
have if we would have sound so um the
thing is you you create new sound and
you edit tools to the stage as if it
should be drawn so that's the way we do
it and then when it's when it's there
and you can listen on the call back like
load it's alcoholic and then you okay
it's available and you can play pause
and play whatever you want so I don't
you need to play and it still works and
and I think that is very important
regarding rich rich media to come on and
I think that that's I think that's very
important eragon rich media and it ends
are using this heavily so and i think
that's that's a really cool feature okay
so now as i said before we need a way to
communicate between the dom and your
bonsai movie for several reasons for
example if you want to listen on certain
Dom events that are not available within
bonsai what i did is i use the
orientation api by the dome which allows
me now to not use the arrow keys but
well just my device and now i can change
x and y and and use methods it's nice
for this for this demo and but it's
really nice for your touch devices so
this is about a custom messages it's
also useful for those abstraction layers
for for your data you normally use to
update your dumb for example angular JS
that's also a way to update your movie
when something happens within your main
threat within
you're within your website okay last I
think laughing I want to show you is a
smoothie API so most of who a few is
flash developer oh okay this is a
JavaScript conference so I think it
would be okay if you're okay whatever
and so there's the movie ipi and there's
this playlist kind of an array and it's
really from familiar to those flash
developers and the cool thing is you can
load a synchronously movies which are
nothing else then bonsai movies which is
which is a container let's say container
for another movie and you can load them
within your bonsai movie so what this is
a very simple example where we have a
load in metro and and whenever the game
pong is completely loaded we're going to
get rid of that intro and start the game
so I destroy my intro and play the game
so to simulate it like clicks Oh Zeebo
presents is the intro and bam ok here we
are that's the game and that's one part
of the movie API there is a timeline and
you can specify the timeline by frames
by in percent or I don't know and and
and n seconds of course if you use
percent please don't forget to set the
length of the weekly weather in one work
ok let's sum it up we have this player
object path bitmaps we have text we have
audio we also have experimental video
yes we do support that's the display
objects you can put this play object in
I come to it later this project have
attributes for changing the style
transforms and transform and and those
attributes are animatable you can put
those display objects in the speed
objects containers which our group very
simple container with but you can also
apply attribute on the container and of
course the movie which has a timeline
for linear any linear animation ok let's
go to the architecture and you already
knows it's ok so there is the renderer
ok cool and my script is executed in
another environment yeah we decided to
to give this a name we call it runner
because it's not clear if we run it in
an worker in an iframe or on the server
so we said okay run out and between the
renderer which is supposed to be your
website your main threat and the runner
there's of course a messaging protocol
and so we can send the drawing
instructions to from runner to the
renderer and events from renderer to the
runner and your custom messages of
course that looks like this you use new
path as an API it is executed we make it
we transform it to a drawing instruction
it looks like Jason at the moment um
that's nothing you really supposed to
touch to be honest and using an SVG
renderer it looks like this yeah you
have SVG path yep ok one more reason why
we do this because if you want to
benefit from an web worker for example
we think it could be faster and
regarding the frame budget so what is
the frame budget the frame budget is the
time the amount of time you have with a
new frame and the frame could be maybe
just six
milliseconds that's not much and you do
a lot of stuff in that 60 milliseconds
you have for example your timer
requestanimationframe whatever another
javascript stuff you have a lot of
painting especially regarding an SVG
renderer you are as I'm by painting I
mean layout pane compositing styling and
you definitely need to compute the next
frame yeah and and that's what I'm going
to talk about whoops yeah thank you I
just want to talk about the next frame
so why are we doing this in the renderer
yes that's the question why don't we
shift the computation of the next frame
to another threat which can be run side
by side so now we have much more time
for painting we can do more stuff we can
use the SVG renderer even longer and and
okay that graphic is not actually
completely a fair there's still some
overhead by sending the data from the
runner to the renderer so okay let's put
it like this so we need to send the data
and we need to receive the data through
the messaging channel and then we can
draw our drawing instruction so that's
another reason why you think our
architecture makes sense ok let's go in
a little bit of the detail about runner
I think you most of the informations are
already clear so what is what can the
context be web web worker is used by
default so an iframe environment I would
choose the I for environment while
developing because mostly the dev tools
support of your browser is much better
for an iframe than in web borracha I
think a chrome does a quite good job
even console lock works now but yeah
that's that's one that's one point but
in production i would say web burkas is
the choice and yeah note for example
with socket i/o whatever and yeah we
have one render piranha means whenever
you whenever you say bonsai run you
actually spawn another bad broker but
it's still possible to have mild will
render us but just one runner let's
that's kind of interesting if you wanna
have a a multiplayer game for example
then you just compute the next frame on
the server and you get all information
from the different devices and send the
drawing only the drawing and stretch and
structures nothing more to the devices
please don't expect me to claim this is
really a good idea for I don't know age
of empire or stuff like that and there
are too many drawing instructions but it
should be really work very well with for
example a ticker or something like pong
I think that's let's let's fair enough
okay renderer first of all via renderer
agnostic that's that's that's a big
message because we are able to exchange
the renderer so we what we did is we
wrote an SVG renderer but we are able to
take any other renderer out there as
long as the renderer understands our
drawing instructions we sent from the
runner to to the renderer and html5 is
in work menu using CSS and HTML and
canvas and SVG and everything
canvas I was a near future let's see
also depends on how many people are
contributing to the project and well
WebGL in the future he's feel free to
add and WebGL render I would be happy
why SVG yeah ok as we love with SVG API
it's so rich that's why there are so
many bugs and implementation I think
it's just too rich but it has all the
API we need to be able to transform the
flash instructions to html5 instructions
and there yeah that's that's that's the
thing about the SVG renderer and we used
it before and yeah we will really like
it okay um so let's sum it up what are
the benefits of bonsai Jess ok we have
the computation decoupled and like logic
decoupled from the actual drawing we
have one messaging protocol for that's
cool I think what I want to say is we
have just one messaging protocol and we
have multiple renderer so we only need
to let the renderer speak the protocol
and then we can use it the renderer may
block the main threat but it is not
supposed to block the runner when you
run your movie in the worker for example
that can happen for different reasons
for example a lot of events most events
touch events whatever events it's it's
kind of a rich and simple API because we
have been forced to support the minimum
API to to render all the flash movies
and yeah it's open source so you can see
the code change it you can also see the
tests which are the spec um yeah and
there's a list of links
I i prepared orbit bondages org this is
where you can play around around a
little with bondages it's an editor on
the left side you see your script on the
right side you see what's what's going
to be drawn and this is actually quite
good to see a lot of example code so we
also have orbit let's let's take group
this is a path yep the on the right side
you can also see the folder commutation
whenever you select something on the
left side and so we want to give a lot
of example code I think that's one of
the most entering parts when you're new
to a library you want to see example
code you won't execute something you
want to play with it and that's what we
try it with orbit em so here a lot of
example movies for a lot of use cases
audio and info graphics and animations
some sweet pictures and I can't scroll I
can scroll sometimes even we go into
detail how we we tried to implement a
flash API I think it's kind of
interesting to just scroll through the
list of example movies and I would say
thank you very much please follow
voltages for quite more informations and
and that's it
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>