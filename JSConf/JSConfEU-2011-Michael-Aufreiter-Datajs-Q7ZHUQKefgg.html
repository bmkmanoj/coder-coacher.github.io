<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Michael Aufreiter: Data.js | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Michael Aufreiter: Data.js - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Michael Aufreiter: Data.js</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Q7ZHUQKefgg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm Michael I'm from linz austria I'm
going to talk about data chest today
which is a uniform interface to main
data so it should make interacting with
the main data easier for us JavaScript
programmers at work at classic pacheco
in Linz which is an office sharing
project we launched in 2008 and yeah
let's jump into the topic I'm gonna give
you some background at first so how this
all started back in October last year
we'll cover the most fundamental data
structures or concepts of theta chess
which are graphs notes objects and types
will have a brief look at the API will
cover persistence so persistence is like
a drop in support so you don't have to
use it but you can so it will be
possible to to store data on the server
side back end without writing
server-side code actually we will cover
offline applications also then I will
give you a demo of substance I all which
is actually the application that drives
such data chairs development so we'll
have a look at this and finally we will
build a data J's client so that show you
how the
how the API works basically so as set
data she has developed in the context of
substance which is a web-based document
publishing engine that's how it looks
like the idea was the following arm
substance is dedicated to manipulating
documents right in the browser and as
you know documents are usually composed
sequentially like you start on top right
your text and to format into it to
structure in and add stash and in format
but um the idea was to do it that a
little bit differently so we split up
this document into its integral parts so
to say so we have a top-level the root
node the document content node so to say
which then consists the section and
image or a text node so what we are
ending up with is the data structure
that looks like this one which is
basically in the case of the document a
tree but there could also be back
references so what we are looking here
at is basically a graph data structure
and that's actually what data chest is
all about it's an object model that fits
on top of graph data so graph data is a
low level data structure in computer
science and we build sort of an API or
abstraction layer on top of it so it's
easier for us to interact with it data
chasis in-memory data manipulation so
you're basically manipulating and
interacting with a local in-memory data
structure which can then be persisted to
the server at some point so that's the
persistence layer then it provides the
exact same API on server side and on the
client side so you can reuse code
written basically it also features a GUI
interface for local and remote data this
library is inspired by the concept of
the Semantic Web which is basically also
based on on graph data so you know the
resource description framework that sort
of acted as an inspiration and there's
this project freebase dot-com I'll know
if you have seen this they have been
acquired by Google lately they also use
the concept of semantic web but they
stripped it like down to a simpler API
which is chasing based or not xml stuff
I also took some inspiration from under
scratches so where are the use cases um
you could for example um build data
analysis and visualization tools on top
of stata chest framework so I don't have
enough time to show you this project
life but what we see here is you can you
can check it out yourself then what you
see here is a visualization that shows
and that that aggregates and filters
data that are pulled from from github
and it's aggregated it's represented as
data object this data from github about
top thousand not just repositories and
the filtering and the aggregation is
performed in memory so you click on on a
certain aspect of the data and you
immediately see the results check it out
I said it could also be used for offline
applications there's an example at task
stop substance that I oh so you can
check out that as well so this deals
with the problems of offline
applications like synchronization and
conflict management so let's have a look
at the anatomy of the data graph it
basically consists of data nodes which
can either be an object or a type so
data nodes are then connected through
properties so they reference each other
basically each data node has a type
property which describes which type so
to say which class is a member of in
this example we've some example data
from from a document model and we also
include a user data structure here so a
document has a creator which points to a
user objects in the graph space also it
contains the section or more and
connects this with the children property
which is a non unique property which
means can have more than one value
so all all data nodes in the graph share
certain set of properties which are the
ID property that is the unique
identifier which is either be generated
or explicitly set by the user the type
property is also recommended so this
depict some of which type and the node
belongs to that need to be filled out
too and we have a ref property a
revision which is used for detecting
conflict in a persistence scenario so
this is how a data type looks like um
it's the Chasen representation basically
an object literal you have to specify an
ID type property and in the case of a
type you need properties property which
describe the abstract characteristics of
objects of the type so in this case we
have a section which contains a name
property which is a value type type
string and the children property which
can either be a text or an image so
here's an instance of this type so to
say it's a concrete section which has a
name and children property which refers
to an image and it has a link to the
Associated type which is type section a
data graph is constructed by calling the
data graph constructor and pass it a
serialized data graph some seed data to
initialize the data structure basically
you insert some
schema information here but you can also
combine it with objects when you've done
that you are ready to add objects to the
graph which is as easy as calling graph
top set and pass it an object
represented as a JSON object in this
case we just add a new text node we can
then set properties on an existing
object therefore we need to just pull it
out of the graph at first which we do
with the graft or get call um we then
are ready to call sec we get back a
reference to section reference in this
case and we can call section set and set
the children property in this case we
add a text object that we've created
earlier at some point we are ready to
synchronize our local data structure
with has some dirty notes that we've
changed and other ones that are not
changed yet so it should just
synchronize the 30 notes we just have to
from an user point of view we just have
to call graph top sync so that's how
grasp assistants are basically looked
like so we have our in-memory data
structure on the right side here the
client and on the server side there's
the huge craft with all the information
from all the users so to say and we are
talking to either a graph read service
or a graph right service so if you have
changed two nodes we just synchronize
those two dirty notes and sent them in
one go to the server arm which is a no
chess um back end it then gets passed
out so we fill the stack that you can
apply
and it it end up in couchdb so one node
in the local graph later on corresponds
to one document in coach t be so this is
how it's basically working and we have a
quick look at how filters work so in the
case a user is trying to save two nodes
one of it is a section another one is an
image will go through the authorization
filtered first which detects that the
user session is not authorized to save
the image node so it will be rejected
the section node and passes through and
goes through the sanitization a filter
for example if you want to strip HTML
code that could be injected and could be
used for cross-site scripting so you
gonna change this node and pass it to
couchdb then
the next release of data jess is
dedicated to offline applications so
with data chess Oh point five there will
be on the future of be directional sink
so we're going to use the pull push
approach here so that if you have your
local graph data structure you can as
soon as you click sync um you get back
updates that have happened on the server
in the meantime and those notes then get
an erection to the local graph which can
result in conflicts if you have changes
locally as well so that's the hard part
basically this offline applications in
area we are all have to deal with when
we want to build this apps and yeah data
change is going to be you are using
local storage for keeping local data
persistent and this is how we are
dealing with conflict management
supposed to following scenario to
clients check out the same node say a
text node and start editing them so from
logically the first client changes this
node gets dirty then but it will be
synchronized with the server which is
okay you see this on the left side here
client one since the client one
specified the right revision which is
actually latest revision on the server
it goes through and the client gets back
the updated node containing the new
revision which is revision to the client
to on the other hand the meanwhile so to
say also changes
um the same note and hits the
synchronize button batteries he's the
letter one so we'll be there will be a
conflict here so what happens then data
jazz cases that server returns the
newest revision it knows and the client
then have to deal with this conflict
scenarios here to resolve the conflict
himself so basically you have to
implement a strategy to deal with this
certain scenario after it has been
resolved by the client you can either
use his version or the version that was
on the server and then start another
sink and this is on the right side then
it gets back to revision three and it is
fun again ok I'm going to show you a
project I'm working on since last year
October which is basically dead wondered
um yeah drives data chase development is
set and it's basically open document
authoring and publishing for the web and
open means it's a fully open source
effort so you can check it out it can be
used for free and it targets open
collaborations with Courage's readers to
contribute to documents easily so let's
have a look at like recent documents
here there are a lot of hello word
documents already this one is a nice one
then Halladay he used the substance
editor to make a write-up about the
musical composition and he added some
transcripts here
so that's that's a nice example but what
we want to look at is how document
manipulation looks like so if we want to
add a document so let's go here and this
is actually the presentation we were
looking at before it's basically a
substance document that is being friends
translated into into a slideshow on the
fly
so what we can do here is change
something
and if you look at the upper right
corner c is spinning wheel there so if
you manipulate local data structure the
local data graph some point a
synchronization gets triggered and the
changes to the document get synchronized
with the server yeah we're pretty far
yet you can invite other collaborators
by specifying an email address so it
gets a link can join the document
creation process we've built versioning
so now it's time to publish this this
document so it is available to you right
now so if you are going to the substance
I all platform and click on the recent
documents panel it should be available
to you but you probably not interested
in looking at the at the substance
representation here you're going to see
the slideshow representation and for
that you can use the export dialog and
there are many formats that are already
available so we use msn substance I'm
exposes documents as data as a data
graph and an external service in this
case it's called letterpress which is
the conversion service that turns
substance documents into arbitrary other
formats we've implemented some some
predefined output formats which are run
through pan dock which is pretty good
for cross document compiling so between
formats so to say
okay and here's the shower
representation and we are back in our
slides
yeah so you are invited to to try out
substance on the data J's API and that
could be done by just consuming the
substance API and building a client
using data chairs so all you need is
basically a static HTML file in the
substance data chess library so what we
are going to do is first connect to
remote data graph fetch the document and
render it so we are going to to
construct a new data graph pass it a
schema which is available in substance
you connect to a remote back end using
HX in this case and you specify URL
where this service lives you can then
start fetching a document by specifying
a query object and pass it to the graph
top fetch method and you get a call back
as soon as the result is there we are
interacting with this nodes collection
you can just ask to get the document ID
you specified before once you've done
that you can like walk this graph you
can progress it by using the get api so
we have talked get children get the
first children get those children which
is a section obviously and get the first
text element of this and its content so
what you then have to do is creating an
HTML renderer you pass the document
reference
and call render on it for example or you
can do it differently and then you're
ready to inject this generator the HTML
to your website at some point so there
are some examples for substance
integration next up then he started to
to write his blog using the substance
platform and integrates his website with
the with the API lets looks pretty nice
i would say
so that's him there's another one Molly
O'Shea Liga he's here from Berlin he
contacted me and he wanted to use
substance for creating a
community-driven book and so we started
to sketch something that is basically a
reader of substance document as well but
optimized for like looking at it as it
were a book so we have two chapters on
the left side and can never get through
it let's basically strip down to a
minimum and we can as a reader just get
active and discuss certain text
fragments on the substance platform so
took the easy to contribute and you
should no longer need to write an email
to the author and coordinate this so you
just add a comment to this
that's basically is it so I would like
to say you're invited to to check that
out try out the substance I'll platform
try out a data chess and start
implementing your own application um
these two project doesn't didn't have
get any funding yet we applied for a
grant in Austria but it got rejected and
yeah just check it out contribute to the
source or if you can afford it we are
open for donations you can send to
contributed substance io or if you have
any questions just asking afterwards or
send an email to info @ substance oil so
are there any questions right now
yeah yeah it's one example exactly yeah
yeah the question was um if there's if
this document model we've seen is just
an example and yes it is you can
basically build whatever application you
can imagine so you can specify your own
data model which may be a project that
contains tasks for example or whatever
so that basically for building
applications of any kind yeah
yeah the question was there is a method
of validation and yes there are some
basic tools to do validation on it you
can specify required property for
example or you can specify a validator
regular expression to make some checks
that's that's now supported but you can
also use a middleware and server-side to
more complex stuff of validation and
reject notes or something
yeah yeah your renderer somehow needs to
know how the structure looks like but
yeah yeah you could you wouldn't need
data chess at all for rendering this
document you can just take the chasing
and use Ruby or whatever you would like
to yeah
ya know
the question was if data chess can
validate this on the client side not at
the server side so yeah basically it's
done on both sides so already so this
validator or required properties are I
checked locally and they're immediately
rejected so yeah
yeah so yeah the question was can data
jazz resolve associations between
objects and yeah that's basically what
data chess is about so to give you an
API that makes that easier so you just
can call get and get references back
which are wrapped in a so called data
hash which is also part of the framework
and yeah so theta chess is used for
commercial then
between documents I don't do yet but
that could be done to year so it's some
sort of how you index it or something
yeah yeah the question was if I've
looked at chasing schema and how it
compares to that I'm basically as a
competitor so I've had brief look at it
but I was somehow more influenced by the
meta web object model which is used at
free based calm and so I try to apply
this rules there yeah yeah
yeah the question was if there are
events triggered if some action captain
like there's a new note that gets pushed
to the client at the current version at
current at moment we just support push
support which has support push mechanism
and basically when you manipulate a
document that dirty event gets triggered
and you can bind on that one so I'm
sorry there's a tour event that gets
triggered when you manipulate documents
locally so there are some events for
different scenarios
yeah yeah yeah good question and this is
a work in progress and it's all should
be solved with a 05 which question 05
yeah so that's on the list
okay yeah then thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>