<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2010] Fabian Jakobs: Kick ass code editing and end to end JavaScript debugging | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2010] Fabian Jakobs: Kick ass code editing and end to end JavaScript debugging - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2010] Fabian Jakobs: Kick ass code editing and end to end JavaScript debugging</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hN_7tAKh0dM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you so the title of the talk is
kick-ass code editing and enter of
end-to-end JavaScript debugging
my name is five any are cops if you want
you can follow me on Twitter and let's
get started so we say code editing and
debugging why do we do this yeah we are
building an IDE we building an IDE for
the web and we called the baby
cloud9 IDE and what I'm going to do now
is are today is present the vision of
cloud9 IDE but even more I described
some of the technical details in
building this because there is a tech
conference this is not a product
conference you can follow a cloud or de
on cloud9 IDE alright so the overview
for this talk will be the code editor we
use for the IDE so technical details of
the code editor what how plugins work
and a showcase of how how we can debug
code in the cloud so let me to get
started let me give you a small demo how
this looks like ok so this is the IDE
just looks very familiar and one of the
basic things you should be able to do
with our ideas create files like so
let's create a hello world is and the
other thing is you should be able to
edit files
okay it's all nice but just having files
on the server doesn't help you sir let's
run this beast and you see well it's
printing something in the console but
where does it actually run so this could
could be run in the browser but it's
actually run a run on the server in a
node instance and I can prove it to you
by changing this to the hello world
version of node does anyone know about
the hello world version of notice right
HTTP so that's required GDP create
server and this one takes a callback
with a request and a response object
alright and then rewrite success so we
can do this and
and clothes the response of course we
have to listen excuse me
oh yes and yes yes and so we see what's
doing we say HTTP all right save the
Beast and I don't see something oh okay
let's kill it oh I guess I've just
hooray
here we go Wow looking we run it on the
server so it actually runs a node
instance on the server we can edit it
from here we can start it from here and
we can stop it from here so that's the
basic overview how the IDE is going to
work
of course I've used absolute as you've
seen this is still a tech preview this
is far from being a complete product but
nonetheless we just want to get out
early and show what we what we think
could be the next step in in writing
code in the cloud so yeah so nobody
really will use an IDE of the editor
sucks so everyone has his editor with VI
emails texts made maybe eclipse on
NetBeans and one one of the key parts of
the IDE is an editor that actually works
my aim for the editor was that it should
at least replace text made for me so all
the features I love from text made
should eventually be available in the in
the code editor are the same for for
some of the Eclipse features that I
really like so what are the requirements
for for code editor
well first of all it should be cross
browser
shouldn't should not be a big
restriction on which for us it runs so
including ie7 i8 should be fully
featured sheriff all the features we
need should be configurable that like
users won't want to show the hidden
hidden characters like spaces and tabs
or don't want to see them and all kinds
of stuff that should be able to be
configured by the user should be
scalable it shouldn't break down on
really large files like their their
files that are like 10,000 lines long
and should just be able to handle it and
should be hackable that means if someone
wants to to add a functionality that's
not there any seasoned JavaScript check
I should be able to just implement it so
why not Best Buy that's obvious almost
all of this is already implement our
best thing sorry skywriter stick to best
but you think best man has a really
excellent has done a really excellent
job - - pioneering in this area to show
that it's actually possible to to do
advanced text editing or code editing in
the browser or there are some things
that didn't fit for our things one is
that's inefficient if it's scaled to
really big canvas because it has to do
to draw all the pieces individually
that's like what Paul Bako said for the
phones game engine it's similar to to
the code editor it's not cross browser
because it's using canvas obviously so
no ie ie 708 is 6 if you want to but I
don't really care and when we started
had a big dependency on spot colors like
500k external dependency on an on
library we don't use on ourself so in
today's jquery which is a lot better in
terms of code size but still something
we don't need for the ide so so that's
why we didn't use best friend so we
choose to you to implement our own code
editor so there are several options you
can you can take and in doing this you
can have content editable you can
using canvas as best benders or you can
use pure Dom methods to render
everything that's a quick look at it so
content editable well it doesn't really
give you enough control to do advanced
stuff it has a lot of issues to get
right cross browser and we really want
you to do like fancy stuff with a
selection we want to support in the
future like rectangular selections like
text meters and there's no way you can
do this with content edit editable and
current editable was really designed to
do weeks rich text editing which we
don't really need so it's not worth it
exploring it for for code editing well
of course there's canvas canvas is nice
because you have full control about what
you want to display so you can can do
anything but seriously for code editor I
don't care if I can do fancy stuff I
just need some some rectangles and lines
and text so I don't really need all of
this and it also means that you you
cannot run it on all current ie versions
excluding the but except the ie9 beta
but that's not all yet another point is
if you use canvas you have to implement
all the key and mouse interaction
yourself because there's nothing you can
you can use leverage but that's not
actually a bad thing because it means
you can do you have full control over
everything what happens I know my very
unscientific big o-notation is the
canvas Kay it's roughly where the number
of visible pixels that means if you have
a small canvas it's all good and fine if
the canvas is really big
yeah well that's it's going to be slower
and then there's pure Dom so what is
pure don't give us give us drawing text
lines drawing text drawing lines drawing
rectangles all with different colors
borders that's all we need so it should
be able to be done but also like with
the canvas since we are not using a
predefined editor form we have to do all
the all the event stuff ourselves so
have to define exactly what happens if
you do shift cursor down or shift page
up and control left control right all
this has to be implemented manually the
same is for most interaction and the
naive implementation scales roughly with
a number of lines in the document so the
naive implementation would be put
everything in one big HTML document
which means if you have a very large
document the speed degrades but there's
a better way to do this which scales
with the number of visible lines which
is much much nicer so and this is by
using a virtual viewport so the idea is
really simple you always only see a
small fraction of the of the document so
there's no reason to generate any HTML
markup for the whole document you can
just render generate the HTML markup for
the the viewport for the thing that you
see so as I said rendering a full
document and Dom doesn't scale so we
only render the visible rows and if we
scroll like this we just always update
the contents so the updating itself of
course is a little bit expensive because
we have to really easy to implement so
our Endre we have a strategy of reuse of
Dom for drawing only so we don't store
any state in the DOM and we never read
the Dom so we just use the Dom as a
painting API like we would do with SVG
always over canvas right now by using
the Dom we can we can use the the
composition features of the Dom so like
we can have different layers which are
divs which are stacked behind each other
and each of the layers can draw a
different element of the of the document
like we have a layer for the selection
we have a layer for the curves or we
have a layer for the text and if you
move the cursor you only have to update
the cursor layer and you don't have to
update the text so it's really efficient
to to change the selection or to move
the cursor because it doesn't
of any any costly operations and then
you just put it all on top of each other
and that's how the editor looks like of
course I'd like to to show you some of
the features of the editor not perfect
yet okay so now we have an HTML document
so one of the features of the document
the editor is that it looks like
highlighting of course but it also has
nested syntax highlighting like we have
an HTML file but then there is a CSS
block and we switch the son expediting
mode to CSS and a little bit further
down we have a script mark and the
inside of the script block we switch the
highlighting to use javascript
highlighting and then we as I said I
want to have all the the features that a
normal code editor gives me like let's
assume I want to indent this within the
script block so I can select this hit
tab so I can all to indent it okay
that's much nicer and let's say okay the
on resize method I think has a buck so
what I usually do is I create a copy of
this as a reference and then comment it
out and I say okay let's do something
else the Lord as you see the cursor
jumps to the right position so we have
auto indenting so usually in a normal
text editor or in the normal text field
to cover jump to the beginning of the
line and I'm closing it and I have
authorization and also you see I don't
know if it's visible that it's
highlighting the matching parentheses
okay well well that's not really fixed
thing so I can its reverted so it also
has full undo stack and this is of
course something that you have to
implement yourself as well because our
we are not
is just dumb notes and all the the
changes are just changes through the Dom
by reacting on the events also the cause
is just a blip a small diff that's
hidden and shown again it again and the
other thing was yeah I claimed that
should be able to handle really large
files so this is a file from from our
project that's I think it's generated
but it has like like sixteen thousand
files so in scrolling in this in this
file and opening it a writing code in it
that's really no difference to a file
which is which is only 20 or 100 aligns
long because all that matters for our
father for scaling is how big the
viewport is so if I hadn't had a really
large screen then of course crawling and
doing stuff would be would be slower
because I have to riri render stuff but
this is this it it is even bigger for
for using canvas canvas degrades for
really large screens a lot more than
than the Dom and we only are concerned
about the the vertical hate and not
about the horizontal width alright so
this is the editor yeah plugins to have
an IDE to be really successful you need
a way to to plug in external external
functionality because there is no way
that a small company like Ajax orc and
could implement all the functionality
that any developer would want so we can
concentrate on the core features and
everything else should be plugins and in
this case we designed it so everything
as a plugin search as a plugin file
system as a plug in the new file
dialogues plug-in even the editor is a
plug-in so if you don't like the editor
you can replace it with a different one
the language mods are Plex plugins
the syntax highlighting and indentation
stuff like this all these are plugins so
and the plug-in is very simple it's just
a JavaScript file for the client code
it's JavaScript for the server-side code
since we're running a note and it's some
XML to describe the UI and we at Ajax
org we have a UI framework called APF
Atrix or platform which we use to build
this application and this XML is on HX
or platform XML that you need to to
write the UI so I've prepared a little
video so it's it's poisonous so to give
you some context what's happening now
what's happening now is that we are
going to write a small plugin which
takes the current selection in the
editor which should be JSON and does a
pretty printing of the selection so
essentially it does a a JSON pass and
then json stringify with the indentation
string so what you see here it's just
the template you have the JavaScript
file for the client-side code it's a
template so we replace template with a
format Jason right we save the file and
the UI in this case is an empty window
so and we add to this window VBox for
for the controls for the controls we
want in and the if you click the button
it would call it will actually call the
format function in the JavaScript file
it's ok no so now we are going to write
the the format function it takes this
argument invitation
it takes the current editor so it picks
the current editor and to do this we
need a little little information we need
some of the editor API and so we are we
are accessing there the range object
like you see this is all using requirejs
to to load the files ok so this is the
code
stop it a moment and here you see the
actual like business logic json
stringify json.parse with indentation as
third argument and at the bottom we yeah
we get the range we get the value from
the range stringify it and then we do
document replace and then we update the
selection ok and now the button the
bottom there's a little bit of like
lifecycle management so there are
functions which are called when the
plug-in is enabled disabled initialize
and stuff like that ok so so the UI is
completed yeah now we are gone we can go
to the plugin manager and since we edit
this within the IDE we can immediately
enable the plugin so we add the plugin
requirejs loads the plugin that we just
just written and now the plug-in is
enabled and now let's go to in JSON file
and there's the menu option and here we
go so that's
how how the how essentially all of the
idea is implemented all of the IDE core
functionality besides the basic
workspace is done using plugins like
this oh all right so now let's go to the
debugger how would you do debugging in
the cloud so that is a big big question
because if you host something in the
cloud and run it on the server
how can you debug the code that's
running on the server and this is really
crucial because if you don't really have
a handle to the application you can
really touch it so we need a way to
expose that and the way we are doing
this is by using the v8 debugger
protocol which node fortunately supports
so what we do is we the IDE server
starts a node process with the dash dash
debug argument and then connects to the
debugger port was a small TCP client and
the IDE server then simply proxies the
debugger protocol over socket IO which
is a really nice framework to do to do
server push from the server to the
client to proxy the v8 protocol to the
client and essentially the client
implements the whole via a debugger
protocol handling it passes the messages
and keeps the state and stuff and also
issues commands to the debugger so this
is how we can debug the node application
so there's one missing link that is what
if you want to also debug the
client-side application like the
javascript in the browser so there is a
way to do this but it's a little bit
tricky to get to get to get it running
because and that is by using chrome
chrome also exposes the same debugger
protocol but first of all chrome is we
started with a command line argument so
you have the way
have to have a way to start chrome and
then well you need to need a way to
connect to the Chrome browser which is
which is freaky because the server
cannot do it so the client has to do it
and to do this the client would have to
have a plug-in or something ok but so we
had a prototype showing showing chrome
debugging but it's not in the IDE yet so
this is something that that's going to
come ok let's do a small demo again so
this is really the most exciting demo
for me okay so let's go back to our our
application that we've written before I
happen to have this open let's
running okay
all right
okay we put it here so we can see it can
hit it reload
all right ah so but but instead of
hitting run we can also hit debug what
this does is it makes the viewport very
small but also it starts the node
process with was a debugger argument and
connects to it so what I can do now is I
can set a breakpoint here and if I hit
reload I can it breaks at this
breakpoint I can just stuff like
navigating the call stack let's see it's
called by event emitter and this comes
from HTTP and this comes from socket and
this also shows our code that you know
that you usually don't see on the on the
hard disk because because it's compiled
into note but the debugger where our
protocol also exposes it and what you
can do as well is let's go back of
course also inspect the local the local
scope like you can go to the request can
take a look at the headers stuff like
that well and then of course you can do
stuff like step into this little bit
smaller so I'm now stepping into into
node I'm not really interesting I can
step out and then I can say okay let's
continue so this is how can do debugging
but there's also one one
so that makes it a little bit more
interesting to you
and I can click on it and inspect it but
I cannot only inspect stuff I can also
change stuff like I can say message is
Yahoo Jay is Cohen so what this means I
evaluate this code in the current
context that means I'm changing the
variable in the closure and if I
continue now you see Yahoo J's comes
I pretty amazing yeah so let's let's
continue and if I reload of course now
it will always return you who JS count
because it's now stalled in the closure
so it is so but but this is this is just
the beginning you've seen that still has
a lot of edge cases it's not not a
product yet but I still think it's nice
to show what you can actually do in
running stuff on the web at the moment
this runs totally locally so there's
something you can install locally on
your machine and then immediately start
working on your code on your machine
yeah we have an nvm package yes and yes
you can install it with an NB a-- npm
right so that was the demo so we can
come over closing words so our vision is
to be to eclipse with Google Docs is to
word that means all the important
features plus all the features all the
benefits of being in the cloud so we
really want the next step will be to
move this on to the hosted servers to
run it directly from the server at the
moment it's all local and we would like
to thank the community since we are
using a lot of stuff that you guys have
built we are using connect as node web
framework we use socket iOS to
communicate from service server to
client of course we use nodejs and we
use requirejs to to do the the
client-side loading and plug-in loading
and I really love to use requirejs I
would even love it more if I could use
requires modules directly a note that's
maybe that's happening and then of
course we are also contributing stuff
back there's a lot of code that we
release as open source as well or
maintained as open source that's for one
APF the UI framework that's junior staff
there
my colleague Mike has done it's a
node-based web dev server which we use
to use the file system stuff for the
file system tree we have not all three
XML we're not using it yet
it's a wrapper for lip XML and a fast
wrapper for Pugi XML which is very fast
it's in the library with a slightly
limited feature set we're going to use
not github that github that's a library
that I've written to access the github
API and we using async s it's a very
small library by me too which basically
wraps the the note filesystem API on top
of this we are releasing the full editor
source code today as open source which
also contains implementation of the
debugger the 80 bug our protocol oh
that's not it
so we also release the full source code
of the IDE today so you can go now to
get up check out the source code it will
probably break in in in a lot of cases
but you can try try to take a look at
the source code and hang on it so the
servers are up and the project on github
are open now so really would like to
like you to join us in building the Java
Script IDE for Java Script / developers
why JavaScript developers that's our
vision and that's it
thank you
okay
are there any questions
Martin the idea itself will at the
beginning be GPL
the editor and the no debugger are LGPL
now we are considering in using more
liberal license later but at the moment
we want to want to stick to two GPL for
the ID yes yeah one one of the design
goals for the editor was to not have a
big dependency on anything else the
editor itself has no external
dependencies besides require.js
so we don't use any external now we are
not doing it right now but we are really
really want to have this in the future
that you have some collaboration on code
editing that's part of our plan it's not
implemented yet it was yeah
yes we do want this we don't have it now
at the moment it's something you can
install on your PC and edit your local
files with the local file server but we
definitely want you to make it a hosted
service and we definitely want to have
some collaboration features where you
can work on the same source code maybe
with a chat window on the side at the
same time yes I'm pretty sure it's not
working on the iPad it's I haven't
tested the iPad yet but since we are
going heavily on the UI interactions to
interpret what's happening manually I'm
pretty sure it's not working on the iPad
yet but if you want to make it work on
the iPad but we would be really happy
sir alright then thank you for listening
and talk to you later</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>