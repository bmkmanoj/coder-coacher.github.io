<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>John Britton: Ops For Everyone - JSConf.Asia 2013 | Coder Coacher - Coaching Coders</title><meta content="John Britton: Ops For Everyone - JSConf.Asia 2013 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>John Britton: Ops For Everyone - JSConf.Asia 2013</b></h2><h5 class="post__date">2013-12-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/HXhGlgtjcHE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you
so hi everybody my name is john britton
and i'm going to be talking about how we
do operations at github and how you can
too so first just a little bit about me
I am homeless I used to live in New York
City but I've been on the road for about
a year and a half now right now I'm
living in Manila and i'll be heading out
you know at the end of the week for the
next place so that's just a little bit
about my background i started working at
github about a year and a half ago and
when i first started i thought that
operations was just for neck beards and
you know when you think about it it's
like you know many companies have a
dedicated operations team and the
developers write their code they build
their apps they say i want to use this
new thing called node and the ops team
says no way that's crazy i don't know
how to do how to do that and you go back
and forth and you throw the the problem
over there over the wall to somebody
else and they solve the problem for you
and you know a lot of companies operate
that way but you don't have to and this
is going to be the story about how we
kind of change that style within our
company so as with everything we do at
github we try and work from first
principles and i'll tell you a little
bit about why we we operate this way the
first value that we have is
collaboration everything that we do we
care about doing it with other people so
it's better to work together than to
work alone when you have a you know
terminal and you go to deploy your
application no one can see what you're
doing right you're just on your machine
running running like deploy to Heroku or
whatever your your stack is and there's
no way to kind of work with each other
so this is one one main value the next
is automation how many people can deploy
by running one command how many people
have a deploy process it takes more than
five minutes anybody yeah okay so
basically the point here is that you
should you should never have the same do
the same thing twice right if you can if
you can strip it you should so the next
is experimentation it shouldn't be
difficult to try new things
when we're talking about you know
launching a new application or testing
out a new feature it should be really
easy to just deploy a branch of your
application or just deploy a new thing
without having to go through lots of
Hoops if you can automate the process
for provisioning it's really easy to
experiment and create new apps and the
final value that I wanted to talk about
is distribution so we want knowledge
within the company to be distributed
among people so that if someone is
unavailable for vacation or if they
leave the company we don't have a single
point of failure so those are like the
four main reasons why we do the things
that I'm going to talk about but let's
talk about what we're actually doing so
there are two applications i'm going to
talk about they're both open source and
you can use them the first is boxing
it's a tool for managing developer
workstations so and the second is cubot
it's a node.js application for adding a
bot to your chat rooms so I'll start at
the beginning and kind of work through
you know what a new developer does it
github and then how how they get started
so boxing I get up most people are using
max for development there are some
people on Windows there are some people
on Linux but for the most part we use
macs and boxing is a tool specifically
for max to make it really easy to get
started and kind of keep all of our
machines in a good clean state the
overall goal is to eliminate friction
when you start a new job it's often that
you know you have to spend a ton of time
setting up the developed environment for
the first time I remember my first
programming job it took me a whole week
before I could actually get the whole
stack running on my machine that's a
terrible waste of time terrible waste of
money and every single time you add a
new developer team you have this new
develop to the team you have the same
problem so the goal of boxing is to make
it possible to build something new on
the first day of work so what does a
typical first day at github look like we
have about 215 people working in the
company now and every time somebody
joins often a few new people join on the
same day what do they do they get a
brand new mac laptop retina to
play they unwrapped it and they're
having a good ol time and they go and
they install xcode command line tools
right this is the first first step and
you might say oh this that doesn't sound
very automated but we can't automate
this part because you have to click the
terms of service and all the blah so
this is not automated but once you've
got command line tools you've got you
know a compiler and whatever you need
you just go to an internal application
just a behind an employee authorization
and there's a web page and the web page
has this command and this command you
just copy and paste it in your terminal
and you run it what it does is it goes
to it pulls down a script to a temporary
directory and then it executes the
script that downloaded and pretty much
it does everything you need it just asks
you for your github user name your
github password your machine username
and your machine password so trust me
it's fine we're not going to do anything
bad too but it is a big leap of faith
the first thing to do is give you ever
give the script root access and so we do
that and then you grab a beverage and
wait on a fast connection you could be
done in about an hour maybe a little bit
more on a slow connection it could be a
few hours you know downloading all of
the different tools but once once it
finishes you've got everything you need
for a development environment homebrew
get all this stuff node no damn much of
you know javascript stuff also all kinds
of other platforms to not everything is
listed here so now you've got a great
brand new mac laptop all set up for
development you don't have to worry
about do you have the Ruby versions you
need you have the node versions you need
everything is there but you probably
have some feature requests or some bugs
that you've noticed on github com that
you really really want to fix on your
first day right so how do we get github
installed on our machine we want to have
a local development environment for
github you just run one command box and
github and everything is set up for you
it creates databases it creates key
value stores if you need them it creates
everything and that's it you've got
github now you can go write some code so
how does the github port work how does
it how does box in know
going download this particular
repository and install these back-end
dependencies and databases and you know
all this stuff that we need it uses a
project manifest so let's take a look at
a project manifest for a project that i
created so i could help i work on the
education team and I handle all the kind
of inbound requests from students and
teachers who are you know wanting to use
github for free so i built an
application that can like automate all
that stuff for me and if i want other
people to collaborate with me in the
company it should be as easy as saying
box in education web and they should
have my application setup so here's what
the the project manifest looks like for
my application it's a pretty
straightforward it just has the name of
the application and by default this this
kind of module format also matches with
our github organizations so box and
knows to look at github com / github /
or education web to find my application
and then it has some dependencies dot
anvil astok surge Redis Ruby specific
version and also information about the
databases that I need for development so
that's it it's just a pretty
straightforward kind of declarative
thing if you're familiar this is
actually puppet under the hood so if you
use puppet this is you know exactly what
you're used to if not it's not that hard
to get going so this defines a project
for us so once we've got a project we
can say you know other developers can
come and help us out but maybe I have
multiple computers you know I have a
laptop I have a desktop when the newest
you know new macbook comes out I don't
want to get the new one and I don't know
about you guys but I have a lot of
tweaks a lot of individual things and
settings that i like about the way i
have my mac setup that i don't want to
have to repeat over and over again so we
have something called personal manifests
in boxing that'll let you achieve this
goal as well so you can you can actually
code every kind of configuration change
to your machine and save it on like a
per-user basis so let's take a look at
my personal manifest step by step I know
the text is kind of hard to see but I
think you'll be able to get the idea so
first it's a puppet class in the people
module so we have a module that
represents each person at the company
and mine is John Dee Britain that's my
username next you can see that I've
included a bunch of puppet modules or
boxing things there's a puppet module
called OSX made specifically for boxing
that includes a bunch of default
settings so things like enabling the
control zoom yeah things like that and
you know disabling the doc all that kind
of stuff is there and these are all
pre-written packages that anybody can
use next you can see that i'm including
a bunch of applications so i use
1password I've got Firefox and Chrome
dropbox so when I get a new machine I've
run this stuff it automatically installs
all these applications for me and you
might be curious you know what's this
include you know include chrome actually
doing well there's an organization on
github github.com / boxing and there's a
bunch of repositories under that
organization that contain all the box
and modules so we don't maintain all of
those it's actually a community effort
so if you create a new box in module you
can send a request to us and we'll fork
it into that organization and make it
available to other people so this is
kind of how it works to install
applications that do have existing
modules but not everything has a module
and it's not worth creating a module for
everything so i'll show you i have a
couple applications that i've installed
they don't have modules so you can see
that I've got bartender which is being
installed from a zip file over the
network and I have sublime text 3 which
is being still installed from a dmg so
you can install from you know pretty
much any format next I've got a few
command line tools that I like installed
so i'm using homebrew the default
package manager with boxing is homebrew
so you can see it's installing these
commands for me and then last it sets up
my shell and colognes a bunch of my
projects since we won't like to ought to
automate everything you know the first
step which was copy this script and run
it then box and github that's two steps
we want it to be one step so I can also
install projects using my personal
manifest so that's kind of an overview
of boxing and how we you know get people
productive building things on their
first day and make it easy for people to
jump into
collaborating on other people's
applications so in short it's just
puppet being used on your on your laptop
so that has nothing to do with
JavaScript at all but I think it's still
very relevant for people who are writing
web apps who are building any kind of
applications for that matter but the
next thing that I want to talk about is
Hugh bot and Hugh bot is a node.js
application it's also open source so you
can get it on github and the goal of
cubot is to make it possible to share
the terminal working in your command on
the command line has always been a kind
of private task you know unless you have
somebody sitting right next to you
looking at you when you're deploying
your application or you have some other
system there's no way to get an idea of
what someone's doing so if I'm working
with my like my colleague Donna she's
back there and I'm deploying my
application he has no idea that I'm
doing that for my terminal so the goal
of cubot is to make it possible to test
ship and measure everything and also to
make it possible for others to see when
you're doing that so we want to be able
to collaborate on that stuff just as we
would collaborate on code so we have a
term for this internally we call it chat
ops nobody can see what commands are run
on your terminal so let's bring them
into the chat room I could hope we use
campfire so you can you know we have a
bunch of campfire rooms I think there's
like 150 or something like that and
generally we have one room for each area
of interest so for example we have a
room for ops which is where people talk
about availability and you know those
kinds of issues also supporting new
hardware and things like that we have a
room for each application so there's a
room for github com there's a room for
all of our internal applications and
it's kind of separated out by topic that
way you can kind of parse out what you
want the thing that's really nice about
doing things inside of chat is that it's
possible for people who are new at the
company to see how things are done
without asking you know they're just if
they're in the chat room you know
hanging out seeing what people are up to
they'll die osmosis learn how to deploy
they'll learn how to do a branch deploy
how to do a
regular deploy how to deploy to staging
how to do all kinds of stuff so we like
to think of chat as a shared command
line and you know bring those things out
into the open so let's like take a look
into how we actually do this stuff some
some actual commands so first let's look
at some commands for testing most of our
apps have a fair amount of tests not
everything but you know we strive for
that the first command that will look at
is CI build so the slash in the front is
what indicates that this is a command
for Hugh bot as opposed to you know a
normal chat room message so here's what
it looks like in action so I'm in the
chat room and I say see I build
education web that specifies which
application I want to build cubot
responds with a message to say that he
has begun the build process and then you
can see when the build completed you can
also use see I build with a specific
branch of your repository so if you have
a project you know this is all based on
using get as your you know as your
deployment stack so you can build
actually a specific branch so in this
case I'm working on a new feature where
I'm using kind of Mechanical Turk
service to do some work and I wanted to
see if it worked and it turns out there
was a failure after 31 seconds so we can
run deploy run builds in the chat room
so once your build is passing and you
decide you want to go you just I'd you
want to ship your software you have to
make sure that your environments are set
up so by default you know everybody has
a production environment but some people
like to staging some people like to have
multiple staging areas so that you can
stage different changes at the same time
but so we have a command called config
which allows you to set up your
environments it allows you to set
environment variables for specific
specific environments so in this case
you can see that I'm locking the room
and then I run config education web
fubar and what that does it sets the
environment variable foo equal the bar
and Hugh bought response back to me that
that was successful it's important to
note that I locked the room manually
because i was typing in credential
or something secret that I don't want in
our chat room logs so that i can read
back you know the environment variables
and if I say config education web foo it
will tell me the value of that variable
if I say config education web it will
tell you the value tell me the value of
all of the environment if I save config
educated web in staging it will show me
the staging you know environment and I
can go through all the different
environments that we have it's also
worth noting that Hugh bought
automatically locks the room before he
regurgitates what could be potentially
private information so it's really
important to make sure that you don't
leak that stuff so we've got our
environment setup now let's actually
deploy some some stuff so here's how you
would do it if you want to deploy the
master branch just deploy in the name of
the application cubot responds back that
it's begun and there's a link and then
once it's finished it says that it was
successful or that it failed that link
is actually to a just a text-based page
it has a bunch of all the lines of the
log output of the deploy process so if
something goes wrong you can go in and
kind of dig through that this next part
is interesting to me so how many people
deploy applications too many servers so
if you have if you have an application
like like how many people have more than
one server for their production app okay
so this is a useful thing so if you want
to take a look at you know what servers
are running for this application you can
use the host command so in this example
I'm showing the training application
which has two front end servers and a
back-end Redis server so it just kind of
tells me what's there if I ran this for
github it would be a huge list of you
know host names for front ends for
backends for file servers so on and so
forth we also have tools for doing
provisioning so you can actually
provision servers from chat apps as well
but say for example you want to roll out
a configuration change for your
production hosts but you don't want to
roll it out to all of the servers at
first you just want to roll out to some
of them and make sure that you're not
getting a lot of errors so you want to
do a ten percent roll out or something
like
that you can use the puppet run command
we use puppet for our laptops we also
use it for our production servers so you
can use puppet run command and chat to
actually tell certain machines to run
their puppet manifests so here's an
example puppet run training fe1 what
that says is the training fe1 part is a
matching pattern so before we had this
list of hosts it will match just the
first host and it will run puppet just
for that one host if i put in puppet run
training it would run on all three of
those hosts if Iran puppet run it would
run on all hosts in github all
applications so i can kind of glob to
match which posts i want to run my my
puppet manifests on so the next thing i
want to talk about is measuring it's
it's incredibly important to be able to
measure you know not only usage of your
app but exceptions and known knew
whether or not you new features are
actually being used so we have this tool
graph me so on the back end we use a
graphite and stats d to collect metrics
from all kinds of different services
within the company essentially it uses
UDP packets to send counters which you
know increment by 1 or gauges which say
the current status of this value is you
know 57 right there are 57 users or
something like that and it goes up and
down over time and the third is a timer
so a page load took 30 seconds or 30
milliseconds whatever it was so you can
send those different types of metrics
into graphite and then in chat you can
actually like take a look at those in a
nice pretty graph form so here's an
example of when I deployed the education
application at one point there were very
few exceptions then I deployed in the
exception spiked so i can say graph me
education exceptions and it gives me a
nice pretty formatted output of the
things that failed
another one there's a feature on github
com in issues comments in pull requests
which is called task lists it allows you
to like right mark down list items with
two square brackets and create a
checkbox you can check them and uncheck
them shortly after we released that
feature or when we release that feature
we created we did some tracking to see
if people are checking not checking them
to see you know is this actually useful
to people care about it so we can get a
look at that here excuse me so so far
we've seen how you can deploy you can
test you can measure using chat ops but
let's take a look at some some commands
that are not all serious business so we
like to have fun in our chat rooms as
well and the story behind this next
command is actually the nicest part of
cubot so my favorite command is one that
I wrote it's called I'm sorry not this
one this is my favorite command where is
I didn't write this but it's really cool
since we have a distributed team we have
people over the world it's hard to keep
track of where people are so I can just
say where is you know John Dee Britain
and when I first prepared this talk I
was in Japan so you can see here i am in
japan and you can get a link to a Google
map and see who's nearby there's also
another another command that I don't
have a screenshot of which is where is
everybody in this room so if your work
in a team say I'm on the education team
we have a few people in the room I said
where's every day in this room and I get
a nice map showing all of the people in
the team all over the place Fitbit me
Fitbit is a little device that you wear
like clip it on your belt you wear it on
your wrist and it's like a pedometer it
tracks your steps so we have kind of an
internal competition within the company
and people staying fit and walking
around and stuff so if it bit me is a
come
and it gives you a score board of who
has made the most steps in the company
and you'll notice I'm nowhere to be
found on the on there so another fun
command is new hire me new hire me now
this is the one I was going to say the I
robe we started growing really quickly
after I start working in the company and
I couldn't keep track of everybody for
this joining so I said we should have a
command or i can say who are the newest
people so new hire me gives you back you
know a percentage of people who have
joined in the last month and all of
their usernames so you can actually
summon them to the room that you're in
you can say new hire me and then start
talking to those people they'll get
notifications and things like that so
what the really important part of this
is that it's actually really easy to add
new commands to Hugh bought since you
bots just a note jf app each one of
these commands is just you know one
JavaScript or one coffee script file
that you know parses a line of code so
by default we have this like / in the
front so any command that begins with a
slash or begins with cubot gets sent
sent to Cuba and then you can write a
matcher match pattern in your own your
command file and have it do whatever you
want you're going to use a third-party
API in this case I'm using an API that's
internal to the company that shows you
know when people started and what their
user names aren't things like that so
the last command that I'll leave you
with is animate me this one's always
good fun you just say animate me and
then something that you want to see an
animated gif format and that's it so I
reserved a good amount of time for
questions so I just want to give you an
introduction of what these things are
what's going on and now I would love to
hear what you'd like to know more about
thank you
I thank you for that lecture on boxing I
was wondering if it's possible to
replace rbn with RPM with in boxing so
by default boxing does install rbm and I
don't think it's compatible to use both
of them so for example you'd have to rip
out rbm to start using our VM I don't
think we would support it but you could
probably each each part of boxing is
actually a puppet module so you could
find there's a there's a file called
site PP and the way you the wait here
I'll show you on the on the web so this
is the boxing organization there's a
repository here that's called our boxin
and the way you install the way you use
box in with your company is you fork
this repository or you you create a
clone of this repository in your own
organization and there's a file in here
it's called site PP so it's under
manifest site PP and then this is what
actually says what things are are
requires you can see like the the site
Ruby versions are specified so you can
actually say that you want to you know
change that stuff out you can unincluded
certain modules the other thing to look
at when you're trying to do this is
there's a puppet file and this actually
is where all of the dependent puppet
packages are declared and their versions
so this makes it so that within the
company when we upgrade let's say the
get version all of our laptops get the
upgrade right and we can lock to a
specific version so if we need this
version of my sequel it will always be
that version on all of our developer
machines do you know if there's been any
more progress I know that was talked
about of open sourcing any parts of
heaven open sourcing any parts of heaven
heaven okay so heaven is our deploy
infrastructure it's kind of it's not
open source right now there has been
talk internally of doing that it we're
just basically we need to find somebody
who wants to take the time to do it and
then once you publish something open
source you have to be you know kind of a
good steward and maintain it so we've
already got people who are pretty keen
on maintaining cubot and boxing but
heavens a kind of a bigger harder sell
so I would love to see that happen so
you run those commands and campfire or
right from the terminal happy being
synchronized or so the first command
when you get started you have to run on
the terminal to install boxing but all
of these commands that I'm that i was
showing here like animate me like this
is all in campfire right Oh actually you
can't see my stuff so those all those
messages it's like you know / new hire
me that's a campfire room okay
interesting and then some other boss
they pick up this information and like
propagate to other servers and things
like right so are you saying about how
how like puppet for example gets run yep
so when you do like the like this one
puppet run what happens is Hugh bot
here's the message and then Hugh bot
uses a an external API to fire off the
you know the build process or you know
in this case it tells puppet to execute
the the latest version on all the hosts
but that's actually not that's not part
of Hugh bot essentially every command
here is you do something in chat Hugh
bought hears about it and then he bought
goes and uses some API to do something
else and that part where Hugh bought
goes and uses an API is like user
serviceable so you can make it do
anything you want but the really nice
thing is keeping it in the chat room so
that everybody can see what's going on
Thanks actually I have a question you
don't mind what is the rationale behind
you guys choosing puppet over say chef
or ansible or salt or anything
so um I don't know the the whole back
story but basically there's there are
the people who are doing like writing
the code for that stuff decided to use
puppet probably because it's you know
pretty well supported there's a lot of
existing stuff out there they have a lot
of experience in it already and we had a
lot of institutional like knowledge
people already knew how to use puppet I
think that anta belen sult probably
weren't very weren't even considered I
would say it was more of between like
probably puppet and chef because those
are two of the more heavily used tools
but it was already puppet when I started
working at github so this a question
about abuse are they automated or do you
have to send a command before I you
would be beautiful but the question is
do I have to run the build manually yes
sorry no you don't need to run the build
manually the way we have it set up is on
github com you go to your repository and
on each repository there's a settings
page and there's a service hooks feature
so if you actually if you're using Hugh
bot what you can do is you can set it up
so that Hugh bot is notified when
whenever I build or whenever a new
commit is pushed or a new branch or
anything like that and it will
automatically run the build and then
hubert will report the build information
into the chat room every time you make a
new push every time you something like
that so it's it's automated but for you
know if you want to run the build again
for some reason or if you want to run a
build on demand you can do it with you
bought that way do you specify like what
the steps you wish to be collected by
graphite do we specify something with
graphite then the dimensions the which
they thought to be collected which data
yes ok so the way graphites data is
stored is a nested nested keys so it's
essentially a tree we have a top-level
namespace for each application so github
com is github in my case the education
stuff is under education there's a bunch
of buckets for each of our apps and then
once you're in the bucket for the app
you just use a dot and then
of the metric so we'll do things like
you know task lists was github task list
dot activity so it was information about
clicks and and not clicks so once you
have the data stored in graphite you can
actually query it from the command line
or from the from chat ops by saying you
know graph me and then the name of the
key that you want to graph and what you
can do it's a matching pattern as well
so just like with the host command it's
a matching pattern you can say you know
graph meet github dot star and it will
graph you all the top level metrics in
the github bucket or you could say graph
me tas listo github task list at star
and we'll graph you all of the metrics
related to that topic does that answer
your question ok great all right all
right well thank you John yeah thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>