<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>G C Marty: Play DVDs in JavaScript for the sake of interoperability [JSConf2014] | Coder Coacher - Coaching Coders</title><meta content="G C Marty: Play DVDs in JavaScript for the sake of interoperability [JSConf2014] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>G C Marty: Play DVDs in JavaScript for the sake of interoperability [JSConf2014]</b></h2><h5 class="post__date">2014-06-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lb-8euLqfRg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi so yeah I going to give a talk
entitled playing DVD in JavaScript for
the sake of interoperability so just a
word by myself so my name is Guillaume
i'm i'm french but i'm living in in
london i'm working at mozilla on firefox
OS but actually this talk is about
personal project is not related in any
way to my work at mozilla so let's I
going to tell you a little bit a little
bit more about myself so I really love
dvds i have some dvds so this is a
picture of the main my collection so
most of it is made of Japanese animation
and and also I i use google play music
and I've noticed that since i started
using will play music that is to encode
my CDs and and and and oppose them to to
play music I've noticed that I listening
to my cities more often that I used to
when they were just the CDs so and and
and also i love javascript so VI d was
using javascript I going to combine my
passion for DVDs to make something but
sees very similar to google play music
but but would that would use dvds
instead of off CD so what I want is
basically I want to service but will
that would stream my DVDs from the cloud
down to my mobile and eventually and
and hopefully done to my yet don't my
mobile so so what I can enjoy my DVDs
when I'm undergo so but why would I do
that because obviously there are
services like Netflix but the main
problem is I don't want to use metric
because we offer is too mainstream for
me and I have nothing very interesting
for me there and in this case why don't
you just rip the video and put it
somewhere and the problem is dvds is
more than than just video dvds us a kind
of multiple video and audio tracks you
can have menu and interactivity you can
build games and karaoke and quizzes so
what I want is I want this all
experience my brother so not just the
video so this talk is about how i
implemented this in JavaScript and and
also what type of issue I I faced during
this implementation so first of all I'm
going to just give you another view of
the DVD so yeah as you know now before
on DVDs 10 for versatile not video so
the DVD is it just a format and the DVD
video is a specific application that
uses that format so and during this talk
when I when I when I say dvds i will be
obviously referring to a DVD video so
the specs so the problem has a problem
with respects of a DVD so it's a
document you have to pay a huge amount
of money to to have access to and also
you have to sign an NDA so if i add that
look if i add a look at the official
specs I wouldn't be able to give that
talk because I would have signed this
NDA and wouldn't be able to talk about
it but fortunately respect has been
reverse-engineered from actual discs and
there are open source libraries but
and execute execute DVDs okay now so if
you if you open the DVD on your computer
you'll notice that there are two folders
one called audio underscore TS which is
optional and most of the time is is
empty and the other one is called video
TS and the one we're going to look
inside so if you open this this folder
you'll notice there are two different
types of file we are info files whose
extension is I for or bub that stands
for backup and we are verb files so we I
for files they contains over the logic
for the playback we contain the menu and
and the chapters all the languages
available and and and all that stuff
Reverb file vote files on the other hand
they contain the video and vo do they
also have subtitles and bedded into and
we also contain the menu and the
position of a button and all that stuff
and on on top of that there is a virtual
machine that takes care of all the
interactivity of a DVD so the vm is as
16 registered so it's very similar to
two variables you can set them get the
value you can compare different
registers it has 24 system parameter
register we are like built-in variable
that contain very specific information
about the language currently selected
the region of the DVD active button were
parental leave all and all that stuff
and it has 36 comments / commands allow
you to jump to a specific chapter or
select specific menu your menu or
compare different registers or set the
value of a register and it also as a
go-to and and and obviously I go to is
always a pain to implement in JavaScript
just going to show you an example of a
command so comment is actually made of
of eight bytes so it just random numbers
that has to be passed to be understood
so this is silver the first line is a
row command as taught in the DVD and the
second line is actually we recommend of
a meaning of recommend so we can broke
down the eight bytes so the first free
ones stand over command that's called
gem VT spdt so this particular command
is in charge of jumping to a specified
chapter in the current titles so let's
say you have a DVD with free let's say
it it's a TV series you are free free
titles free episodes on this series and
then in so the second one over ten which
in Exodus ml stand is l.a so it's time
for what we call in a DVD land the PTT
which is which is the chapter so and the
number after is equal and then this is
the number of a title so let's say we
have is this DVD with TV series ep the
DVD of Assyria to see read our visit EVD
of a TV series so in this case that
would mean jumped over to the tenth
chapter of a third title and then we
have the first parameter that is going
to be compared to the second one so if i
were to ride this is something
equivalent in JavaScript I would get
something like this so we have all
registered in a in a in an array called
GPR em so we compare the value of the
first register to the second register
and if that might be they match then we
we jumped to the title free and there we
then we play the chapter 10 okay good so
okay so I saw to that so I wanted to
play DVD in JavaScript so I say okay I
going to play DVD on the fly so I told
you before that we are
libraries open source libraries but
reverse engineered respects so we are
called live DVD read and live DVD nav so
the first thing I did was to port with
libraries written in C to JavaScript so
I did that manually because it was easy
for me to to understand how it works and
all that all that stuff so the first
experiment I did was I said okay I going
to to redirect give a DVD from the
browser I going to pull the data
directly from the disc so this is the
architecture of his experiments so I
have a DVD disc I have my brother and
the browser just go to the disc and and
try to to to read this disc so what is
asked to do is first we have to to pass
VI for files to understand what to play
what's the logic of other disks so was
very easy because in JavaScript we can
use typed arrays and data view so
passing data to generate something
meaningful in javascript is very easy so
I get it done and then I go to the point
that I need to play verb files so if you
remember the verb files of a father but
that hold the audio and the video and
then I had many issues the first one was
the browser can't play the Codex using
DVD so there are many codec so the video
is always encoded using mpeg-2 and we
are several codecs for the sound
including AAC but known of them are
actually natively readable in the
browser so i coud us try to use
Emscripten to actually compile a decoder
in JavaScript and use it use it use it
from the browser but that's another
issue is that the browser actually very
bad at handling huge files and on a DVD
reverb file can be as big as one gig so
so handling such a huge amount of data
in the browser is simply not possible
in the future we're going to have stream
in the browser so that may be helpless
but in the meantime I couldn't wait for
several years before it's even
implemented or standardized so I try
something else I said okay I can't do it
just using my browser so I going to use
a server the server is going to to sit
between the DVD and my browser and it is
going to be responsible for for taking
the data including the video data from
the browser and and transmit this data
to ver tu veux to my to my browser so
this is my updated graph so I have a DVD
like before I have a browser like before
but it in the middle I have a server and
the server communicates with the browser
using binary web sockets and all the
logic is actually taking care by the
browser so the browser is responsible
for running the vm for playing with
playing every from playing the DVD but
it just asked for the server for for the
date i and and then the server does
nothing more than just taking the data
from the DVD and sending to the browser
that doesn't work but doesn't work
because the main the problem is we play
back is to Turkey's the issue is the
server is actually whenever the browser
requests a video of a server is going to
take the original video from the disc
encoded to to a format that's readable
in a browser and send it to a browser
the problem is this encoding takes
longer than than than reading so
obviously the browser most of the time
is waiting for data that are being
encoded so I couldn't do like this so I
had to fight to find some something else
so I thought ok so what I going to do
now is I'm going to take the video we
are going to encode it to to wear them
that can be read natively in the browser
and then the server is going to be
responsible for sending the
a video already encoded so I updated my
architecture I've a server instead of
just taking the data from the DVD is
taking the data all the binary data from
the Eiffel files from the DVD and all
the video is taken directly for a pre
encoded file and and the rest of the
architecture is very similar to the
previous experiment and and I was very
happy because it's worked and I was cool
but but I had many many many issues for
so first of all the server and the
browser I completely out of sync if the
server is well ahead of the browser so
so yeah that's an issue and also it
needs a very super powerful
configuration because first server
should be super efficient the browser
should should use it only actually it
only worked on modern browser with
experimental flags activated so overall
it was a very fragile implementation and
also because of that powerful
configuration needed I couldn't run in
on on a bra on online online mobile and
if you remember running this thing on my
mobile was my main goal so so yeah that
wasn't okay but actually the biggest
issue I have with with this thing is it
it is in the web it isn't aware because
i had to reimplement many things but are
already in the browser like for example
video buffering re-implemented
re-implementing video buffering and
that's a bit ridiculous because it's
already everything is already
implemented in the browser so it's a bit
like if you if you want to do your own
image image library and Yuri implement
it on on top of one converso but that's
not that's not good so I had to somehow
reintroduce the web into my project and
to do so I I used a converter so the
idea of a converter
was actually came from the static web
site generator as you know static web
site generators we're quite a hot topic
probably six months ago i'm not sure now
but yeah probably it still and so the
idea was okay i can't read DVD on the
fly so what I going to do is I going to
to to use a converter to generate static
assets directly that can be directly
consumed by the browser and it has
several advantages the first one is
obviously that you can offset yourself
because the video is going to take a lot
of place and and server space is quite
expensive so doing cell fasting is
probably a good idea and also i go into
to generate static static assets so i
won't need something i wanted a very
powerful server i mean its control icon
cumbuco i can probably use Leiter your
engine eeks running on top of a
Raspberry Pi and also that will be
mobile friendly because I won't have to
use crazy hacks to to to make it work so
before going into the details of that
particular converter are going to show
you the demo so the day we are going to
show you is a movie called Sita Sings
the Blues it's an animated movie created
by the animator and free culture
activist ninah Paley and she realized
this movie and of a ver cc0 license so
this movie is is is public domain so I
believe it's a completely legal for me
to do to show it to you ok so it's the
pre-recording video of so on the
left-hand side varies the original DVD
run on a DVD player in this case it's
VLC media player and on the right-hand
side that's my application that mimics
but the converter of so as you can see
two completely
work in progress if you if you pay
attention to the buttons versity are
still using this gray button with round
corner because I haven't implemented the
overlay passing and and sometime it's a
big it's it's a bit buggy like the menu
are not where they supposed to be and
but however you can still navigate
through the menu you can start playing
the video and is going to play ad right
chapter VIII chapter you've selected and
obviously you can you can pause it start
it and jump to the next chapter and
doing all that stuff like you would do
in a in an actual actual DVD River River
river with with a normal DVD video
player so how did I do that so when I
started thinking about this converter I
thought okay what I need to do is I need
to map the features of a DVD to
something semantically equivalent on the
web platforms so let's go through all
the features of a DVD and let's find
something similar on the web so first of
all obviously we have a verb files that
contain the video so on the web platform
the equivalent would be the video tag
then we have the subtitles on the web
file and on the web platform we have the
track the track tagged and for webvtt
format for supplied for adding subtitles
to to a video some DVDs can can be
multi-angle that means we have multiple
stream of video and can have multiple
audio tracks so what we can use is the
API call media controller have your word
of media controller yeah ok 1 / 2 maybe
so the thing is beta controller is an
API to sync several video and several
audio stream together so let's say you
have free video and two toward you
stream you can using this this
this API you can keep up in sync it's
only implemented in in Chrome but it has
been i believe it's now only active you
can only enable it using using a flag
server yeah it is yeah it's still very
experimental then we are the chapters on
a DVD and we equivalent on on the web
would be would be a track track tagged
with the kind attribute attribute being
chapters then anh vui we have money
buttons so obviously we're going to
implement them using the button tag and
and n PNG because on a DVD the buttons
are they use actually an overlay that is
like a four color images with with
transparency so that's very well
convenient to to implement it using PNG
so that's the part actually I actually
haven't worked on so that's why if you
remember on the video I I the office big
ugly grey buttons anyway and and we have
a DVD vm but we need somehow to to
reimplement on the browser so obviously
we're going to use javascript ok cool so
so at this point I i have have a way to
to mimic the features of a DVD and to
make it work on on the browser so i
started working on line on my converter
so this converter is actually made of
several several steps and and the first
step is so all the iphone 5 i'll pass to
Jason so I just pass it pass these five
once and when I can just use with Jason
to to read the data as very convenient
but then all the sharp the chapters are
the information above the chapters on
the DVD are stored in VI for files so i
take this jason and
I generate webvtt files that I going to
to use in my in my browser for for the
chapters of a video then I extract was
what's called Nath packet so basically
there are data packets embedded into the
video stream and they contain several
things like the button overlays button
logic button coordinates and size and
all that stuff so I first of all I just
extract these these packets and pass
them to Jason form to make it easier to
handle later then I extract the button
size and position and obviously are
going to save this using CSS I just
create static CSS file holding V
whatever is is related to the position
of the buttons then the menu the menu
are made of static images so the easiest
way to do is to extract them and save
them to to PNG but the browser can read
them natively and and and obviously
regarding the vm i have 2x try for
comments and and compile them to to
javascript and yeah DVD comments are can
be stored in multiple location on the
disc so i have to somehow cover all this
command compile them to javascript and
and create a huge javascript file so
that the browser can execute it whoops
and then obviously at the end i encode
the video to wear them so wide browser
will be able to to to play it for
playing the DVD i created a web
component that I called X video so it's
basically like an enhanced video player
vai can do chapters playlist menu and so
that's what was very convenient for me
because it could take all that burden
out of my application and I could just
generate my static
set and send them to turn to xvideo and
I would just make it easier to develop
and and obviously this component is
completely independent and you can use
it without this DVD application so doing
working on like that project I were I
learn many things so as I told you the
browser at the moment we are not
powerful enough to play DVD on the fly
but the web platform is is quite
powerful because because it it's a
browser can play an application as
complex as a DVD natively it has already
everything so but that's great and also
if we use javascript we can pass binary
binary files like we can play mp3 you
can read PDF we can emulate flash and
now we can even play DVD so that's
that's something great i think i'm and
and also the web is versatile like
remember of in dvds 10 for versatile and
the web is versatile as well because it
has many element that you can recombine
together to create something a richer
experience and and yeah what I loved
also is the web can be used to give some
kind of second life to all formats like
like a DVD so yeah that's it I'm almost
done so if you want to have a look at
the other code it's hosted on github
just go to to this address it's is
actually on you have to go to work to
the branch called converter and all the
first implementation I've show you with
a plane trying to play DVD on the file
is on the master branch and all the
converter is on the converter branch so
what's next obviously it's still work in
progress so in the future I'd like to
make it more more feature complete like
porting all the commands and all that
stuff so if you want you to help don't
hesitate to simple request
very happy and so yeah maybe in the
future I'll be able to to play blu-ray
disc and why not so oh yeah I have I
have a boner because obviously it's a
talk about the DVD so like like any good
DVD I have to I have to to have a bonus
so in this in this case are going to to
show you the application are going to
show you is actually it's actually the
web is not just something some fig thing
okay so there we go okay so this is for
example a button so we are going to
inspect it so as you can see I'm not
lying to you it's it's it's a real input
tag with always information about this
size and the position of a button is
generated into a static JavaScript and
the background here is it's just an
image an image tag with a PNG that has
been extracted from from a DVD and yeah
can I can use it to navigate to go to go
to navigate through the menu and and
yeah I can also play the movie why not
so whoops what what just happened okay I
know I must have clicked face anyway I'm
almost done yeah I'm actually done
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>