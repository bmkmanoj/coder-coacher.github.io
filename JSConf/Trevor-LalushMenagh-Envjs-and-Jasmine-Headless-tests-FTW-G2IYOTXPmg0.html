<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Trevor Lalush-Menagh: Envjs and Jasmine: Headless tests FTW | Coder Coacher - Coaching Coders</title><meta content="Trevor Lalush-Menagh: Envjs and Jasmine: Headless tests FTW - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Trevor Lalush-Menagh: Envjs and Jasmine: Headless tests FTW</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/G2IYOTXPmg0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi good morning um so yeah I wanted to
talk to you guys about Evie Jasmine v
jayus and and jasmine and how I mush
them together to get the unit testing
working on my Hudson server which was
really awesome but first of all let me
introduce myself my name is Trevor
leishman awe at Trev max I I work for
comcast which is a big evil company and
we do being evil things but the stuff I
do is kind of fun and the payment money
do it so that's cool and yeah so I
wanted to talk about that it was it's
interesting I came from a smaller team
and I I went to that that was doing unit
testing and doing a lot of stuff to a
larger team where we really didn't do
any testing at all especially not in
JavaScript and I came from Ruby world
where everyone's like I love unit
testing I was like yeah I love the unit
testing too so I started in doctoring
people in my team into the unit testing
but really I wanted some accountability
to that so I'm going to give a little
bit of the presentation i gave to them
to try and passion them on unit testing
and then i'll talk about the tools i use
to push it together so i already asked
this before but raise your hand if you
test your javascript programmatically
okay good that's awesome so i'm going to
go through a little primer on what unit
tests are unit test test functions i
believe that you should test your logic
of her functions and not not just a
function for testing and function so
that function does have any logic so I
wouldn't write a test for it now you
might say that's dumb but you know
that's the way I would do it I also
believe that you should write functions
that do one thing and one thing really
well so this is the unix principle that
you you have a program that does one
thing and one thing really well i like
my functions to be that is small like
that to you write a small function you
can you can test it really easy if
you're i Function there's 13 different
things well then your test is going to
be beast and you're gonna be crying and
it sucks right so that's
so here we go here's a test I have you
guys if you're familiar with jasmine
this is jasmine it sort of looks like
our spec coming from a ruby world I
really like our spec so that's why i
chose jasmine actually I chose je spec
first but then the guy that did Jace
Beck said I'm not doing that anymore you
Jasmine so Mazel Tov that's where we are
and so so that's pretty straight for Ida
scribe add one it returns the parameter
plus 1 and then I expect add one with 12
equal to so it's pretty straightforward
and the entire point of this is is the
red green refactor cycle I and I really
got into this after going to a code camp
on site I went to this code camp about a
year and half ago and its really awesome
like we got together and we r I T crappy
tested broke we would write the test
that fixed it and then we fix the code
because we wrote a really crappy code
just to make it pass and over and over
over again and it's addictively fun to
to code this way but it's really really
hard to get people in in the air prize
at least or we like when you have a day
job and you have to get your stuff done
you know I can't get my stuff done and I
don't test like I I'm really bad out
test all the time I wish I did test all
the time I love testing but it's hard to
do that without having a group of people
that also love testing so that's why I
preach on testing because I want other
people to to get excited about it and
the entire concept beach n red greening
factor is really my ideal working
situation I write something I right
little thing I make it work I make it
better that that seems like the best
case scenario in my opinion but the
problem is legacy code so like this is
really great in Greenfield stuff and
like you know it's all fairies and
unicorns when you're talking about this
stuff but then you get this 20,000 line
javascript file 20,000 line javascript
file why why they end with a tons of
crappy code in there and like how can I
test that well it's it's about testing
little tiny things at once right and you
guys probably already knows the ones
that are testing at least
that if you have a piece of legacy code
you have a bug right chest that proves
your bug exists and that's like a little
tiny thing you can do to make you make
your life a little tiny bit better right
even that's a hard sell for a lot of
people because they have a bug and they
just want to get stuff done maybe you
have an SLA that says you need but get
this bug fixed in eight hours or you're
fired you know that happens and you're
thinking test test won't to won't make
it better but you know what happens is
that when when I don't write test if I
don't write a test for a thing i sent
off the QA curious like you didn't fix
it and like oh no so that kind of sucks
and the right knee chest really helps
mediate that so I'll go through this
quickly like how do I refactor stuff so
look I have a reference to a global
variable in a function what the hell so
I see this a lot in the code that I work
with where someone has a global variable
and they're referencing a global
variable inside function so that one is
adding our buddy spike to the kennel and
that's really hard to test because my my
test now has to have a global variable
kennel and know about that and handle
that so so here's how we're testing it
we're defining a global inside our test
itself and then we're adding spike to it
so this actually works but you know it's
kind of crappy and it doesn't work very
well I mean I'm not a big fan of doing
that so so here's a cool way refactoring
it in my opinion I just say add dog to
kennel i passed the catalan hey still
have the stupid global kennel but now
this function can live without and
access to that global and that's awesome
like I like a function that that doesn't
depend on anything external and this
function with that small change to the
signature now you don't have an external
dependency isn't that cool so that's
much much easier to test in my opinion I
just say expect add dogs kennel and
passing in an empty array that's my
kennel just so I can have an equal spike
on I have to define another variable in
my
in my tests it's kinda cool okay
sometimes you have to call external
functions this is my favorite example of
window console.log right so so I have a
function that that does console.log if
console.log is this right i call it
whatever like sim dot log or something
like that so that it doesn't blow up in
IE because that sucks so I you spies for
that jasmine has this concept of spies
I'm sure that other test suites also
have the concept of spies are mocks or
whatever you want to call it but spies
are cool this says I'm going to spy on
window console.log that means i'm going
to i'm going to say look at what winds
up window console.log is doing a
register when it's being called and let
me know when it's been called and then i
can say expect my cool log thing that's
been dame space you guys really
namespace your stuff if you're not named
station yourself god damn it right but
you know please do that that would be
good so I expect my log function to
equal test message but I'm also going to
expect window console.log to be to have
been called the test message that bottom
expect is what I'm spying on because a
funny thing with jasmine if you actually
call window console.log and jasmine it
explodes that kind of sucks for for one
reason or another and maybe your test
suite doesn't have this problem but I'm
guarantee your run so these high
problems somewhere so that's that what
about ajax ajax ajax is cool so I have
an ajax ii like function that doesn't
stuff so I have my widget that that
makes an AJAX call and add some to
the Dom when it's successful whoops I
curse sorry um and in add data to dom it
doesn't stuff right so um what i'm going
to do here is I I'm going to make the
Ajax call on top and got add a spy
to add dated on what that's doing is
saying well just make sure to see if
this has been called and jasmine has
this weird thing called most recent ajax
request which is basically just a an
array of Ajax calls so what what jQuery
AJAX does it add on to not jquery what
the Jasmine Ajax does which is an add-on
to jasmine is it it creates this age
executing that captures all of your Ajax
requests all over xhr requests and puts
them in this array so I can just say get
the most recent HS request and and set a
fake response to it so then I expect my
widget to have been called with foo
because that's what the response text is
going to be so hopefully that's not too
complicated but that's a way to to test
Ajax with with jasmine so hopefully some
of you are I knew that and that's really
cool but maybe some of you didn't that's
really really awesome my opinion um so
this is the interesting stuff I one of
the big problem now that you know what
jasmine is and all that stuff that's
great one of the things that that I
really really wanted to do when I
introduced JavaScript unit tests to
comcast as I wide like front of
developers to be able to break the build
so we have a continuous integration
server hut we're using Hudson and that's
hooked up with this huge maven build
script and so a maven test runs every
time you you make a build on hudson
server and if one of the mill were
backing guys they wrote something crappy
and a test blew up it break the build
but are frightening guys myself included
were not held responsible for bugs so
they slipped through and then QA we get
something you know every time you have
QA involved with something it cost a
whole bunch of money a whole bunch of
time that really sucks well it wouldn't
be nice if we can catch it earlier on so
what we did is is we took in bjs did you
guys know it EMV jess's raise your hands
that's cool so for you for you guys
don't evj s is a headless browser
written in JavaScript and is written by
the guy it did jquery john rzeznik and
it's awesome it's really cool it runs on
top of rhino which is a JavaScript
engine for java now that's hot because I
can take rhino and run that in my maven
build chain so Odin is we took rhino and
on top of rhino we put in vgs and top
vgs we lower jasmine and top of jasmine
we load all our tests so with one java
command i can run all of my tests inside
a java runtime and that's really cool
because what we did then is hook that
into maven and now when your JavaScript
test fails you get an alert and you
broke the build now as a friend engineer
maybe was saying I don't want break the
build breaking the builds lame and I
don't want the responsibility well you
suck if you do that it would be better
if you did break the bill I think
breaking the bill is a really good thing
because it means that that that you did
something wrong and you should be able
to to be aware of that so basically if
you go to a Jasmine under my github
account you can you can see what's going
on there it's really straightforward
there's a bunch of directories the bin
directory is where there's some shell
scripts I'll just run the test and
that's kind of cool then you could add
your dependencies which is like if you
have jquery or other dependencies that
you aren't testing but you need you have
them there create tests in the specs
directory run him that's it it's it's
pretty straightforward the two other
things I did is I created a of the
plugin for maven which is is here and my
husband maven example that's just
honestly all I have to do is look at the
Palm XML on this if you're familiar with
maven and you look at the palm to xml
and this directory you'll see what i'm
doing here it's pretty straightforward
basically it's a cut and paste in
to your your palm that XML configuration
file and you're done last thing I did
because I'm a rails geek was that I I
envy Jasmine two rails the cool thing
about this Evie Jasmine thing is that
you can it's totally powerful this is a
self-contained thing that all you need
is Java to run so i can take it in put
it in any project doesn't have to be in
in maven it doesn't have to be an aunt
does have to be in rails one of the
things that the one of the reasons we
created this because because a there was
a maven plugin for for Jasmine but it
just didn't work so hot it didn't work
the way I wanted the work so we made
something more portable and the only the
only thing you have to do to add this
its rails is add a tiny rakefile in in
your lib toss directory and then when
you run rake test you have you have you
Jasmine chess training and in rails so
what's next what's next is is you should
you should test you should test your
code and if you're in a big enterprise-e
place where they have lots of other
tools you should work on hooking those
tests up in a way that other people can
pay attention to them it's testing is
really important it helps everyone's
code quality go up it helps you as a
program right oh no ever since I started
working with test it's made a huge
difference on the way I code I mean it's
fundamentally changed the way I write
functions the way I write my code is
different because I think about the way
you test it so if you don't test your
code please test your code if you do
test your code and you can't break the
build please figure out how you can
break the build because it's pretty
important that's my talk my name is
Trevor nice to meet you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>