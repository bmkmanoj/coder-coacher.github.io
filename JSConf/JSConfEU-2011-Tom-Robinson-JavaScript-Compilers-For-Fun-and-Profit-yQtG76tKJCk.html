<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Tom Robinson: JavaScript Compilers For Fun and Profit | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Tom Robinson: JavaScript Compilers For Fun and Profit - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Tom Robinson: JavaScript Compilers For Fun and Profit</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yQtG76tKJCk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm Tom Robinson I'm talking about
parsers and compilers say so originally
it was just called compilers but it's
actually more about our sirs and in
general and as they relate to JavaScript
so previously i started a company called
280 north where we built a language
called objective j it was a superset of
javascript and it was a moment in
JavaScript so you know you would just
reload your web page it will load your
code compile it and evaluate it not
working there anymore but cappuccino is
is the project that uses objective J and
it's open source it's a sort of desktop
like framework for building applications
on the web so I'm going to talk about
two kinds of compilers today compilers
that produce and consume JavaScript and
compilers that are implemented in
JavaScript and you know objective JS a
good example of one that produces
JavaScript and it's also implemented in
JavaScript so they're not mutually
exclusive so before I started working on
on objector J in cappuccino I really
thought of compilers is Magic really
like had no idea how they worked but
once you really start looking into it
it's it's not it's nothing magic it's uh
it's just it's code and I hope that you
know if if you think of compilers is
Magic you'll no longer think of them
that way and start experimenting with
them because there's a lot of all things
you do a lot of people think of
compilers is something that you know C
programmers hefty we use and it's really
not the case there a lot of other uses
for them
there's a lot of good tools available
for JavaScript developers and web
developers and you probably already use
a lot of them I'll talk about a few of
them so start off this is just a really
simple example of a compiler for sort of
a calculator it's like a prefix notation
calculator kind of a little bit like
Lisp but I was able to fit each of the
components into a tweet so each of these
is 140 characters or less we've got a
lexer that i'll talk about each of these
in a moment but lexer parser interpreter
and compiler so let me just show a
little quick demo that so sad little
program with a little people I'm just
going to copy this string here but so if
you're not familiar with this notation
it's just the the operator is first so
this is 1 plus 2 plus this expression
here plus this expression in that
expression and then this is you know pi
x 42 and this is 3-4 5/6 so whoops that
wasn't
so here it sits out putting that each
sort of stage that I mentioned earlier
now the first stage is the tokenizer
basically splits the input into tokens
we've got like a parenthesis of plus a
number etc so that very first step the
second step is parsing turns that stream
of tokens into a hierarchical data
structure called an ABS abstract syntax
tree so here you can see we have plus 12
and then we have another array here for
that sub expression and and so on so
it's pretty pretty simple structure it's
just arrays and then the the next two
steps are a compiler an interpreter and
you know those are two different ways of
you know evaluating this code and so the
both the compiler and the interpreter
take the abstract syntax tree as an
input to their to their code so here you
can see we Lex the code we parse it and
then interpret it and you know up it's
this number and in this case we exit
parsad compile it and then just evaluate
it so end up here I skip this step but
this is the compiled code so just
compiled it to JavaScript replacing
changing it from prefix notation to
JavaScript you know infix notation
so here's here's that same process or
laid out starting with the string going
through the tokenizer than the parser
and then either a code generator or
interpreter this is just the code for
each of these functions sort of
undefined on gulf i guess and you know
you can see here we're just using a
regular expression which is fairly
common for for tokenizing in parsers and
then we we convert the numbers into
actual numbers the parser is just this
is sort of just a recursive function
that that looks at each token and
decides if it needs to you know add the
sub expression as another element or if
it's a literal detik and it can add so
that outputs the AST and this is just a
very simple interpreter it gets the the
function as the first first element of
the current node and the arguments are
the rest and it applies those arguments
to that function or if it's a number
then it just returns the number and this
last part here is is basically looking
up the function implementation in an
environment which you know just contain
sort of the built-in functions for for
this interpreter and here's the code
generator basically just you know
outputs string with the the operator in
between each value of the oven owed
so yeah this is I think pretty relevant
a lot of you know people think of
compilers as just you know desktop
software server Java kind of thing but
they're really useful for all kinds of
things so here's a here's a funeral
thing so optimizers you know minna fires
more advanced tools like closure
compiler do more aggressive
optimizations like in lining and unused
code removal that kind of thing linters
will tell you sort of common errors that
in your in your syntax we can have you
no alternative languages like objective
j or language extensions i'll select
object Jake concurrency and security or
to other applications of compilers we'll
talk about in a moment so yeah closure
compiler uglify is another fairly
advanced optimizer in in parentheses it
shows you what's what language is
actually implemented in so closure
tyler's java Uggla thighs javascript and
common lisp shrink safe and yui
compressor I think use basically the
same parser and then there's a couple
others less popular ones winters there's
Jesslyn that's the popular one by
crockford j/s hint is a port or a fork
of JSON with some different different
rules javascript lane closure actually
has a winter and you can get linters for
lots of different things CSS HTML
there's even jQuery not really sure what
that does but
so alternative languages coffeescript is
probably the one most people are
familiar with you know Java scripts
great we all love JavaScript but you
know it has its problems and you know
some people prefer other languages
there's a lot of different options out
there like pretty much any popular
programming language has been
implemented in JavaScript at least once
like sometimes several times yeah
there's here's just a few okay so
extensions to the language or an
interesting example so tracer and
narcissus of tracers from google
narcissus is the javascript it's
actually both an interpreter and just a
parser is implemented by Brendan and
both these are being used to serve
prototype new language features so you
can try them out in current browsers and
provide new backwards compatibility for
for older browsers that don't implement
language features natively so and then
objector J so objector J the first
version of objective J was a custom bar
sir just hand rolled we really did that
for for performance reasons so initially
we wanted users to be able to just load
up their application and have the
JavaScript or the objective J compile to
JavaScript on the fly without you know
really noticing any slowdown or anything
but you know it became clear that even
with a very fast parser it's not
negligible amount of time so we've sort
of moved to deploying with precompiled
objected shade to javascript so it's
less important now that speed and I'll
talk a little bit about language jas
which is a new parser generator that
that we've been working on for building
the new objective J compiler
here if you the things that tracer in
particular implements the new language
features you know if you saw Brendan's
talk yesterday a lot of these things are
you know proposed in es6 so you know you
won't need to wait until every browser
implements these start using them if you
were to use something like tracer to add
sort of compatibility layer 44 older
browsers not gonna go through each one
but there's a lot of them concurrency is
an interesting application of compilers
so if you're you know at all familiar
with node or you know any any sort of
asynchronous callback oriented
programming you're probably familiar
with the the problem of you know all
these callbacks scattered all over the
place and nested and everything so
there's a lot of solutions out there
that will actually let you write your
code as if it were synchronous and it
will transform it so that it's it uses
those callbacks internally but you don't
actually have to deal with all the
callbacks it's there's a few different
projects out there they'll work a little
bit differently but
security is the last serve a Legation
I'll talk about so there's this common
problem where you have you know widget
that you want to embed in your web page
but you don't want that widget to access
all of your data steal your cookies or
your private data so there's these these
tools that will verify that the
JavaScript provided by the widget is
safe to execute or it will actually
transform it to something that's safe
and you know there's usually a pretty
big performance penalty by doing this is
the Aptus or intercept pretty much every
every property access and that sort of
thing so yes five I think is sort of
strict mode in es5 s or designs to make
a little bit easier for these kind of
tools to work so there's a huge list of
all these different types of compilers
at ljs org this is sort of a new
movement of people interested in in
alternative compilers and languages on
top of JavaScript so courage encourage
you to check that out it's like a huge
list like hundreds of 10 hundreds but
maybe 100 different projects so yeah
that's those are the existing things
that are already out there but there's
things that you know other people
haven't even imagined yet that you could
build and so there's a lot of different
tools out there you know there's
existing parsers narcissus I mentioned
earlier it's written by Brandon tracer
another that's the google one also
implemented in JavaScript Rhino has a
parser you can you can programmatically
access from Java j/s parse and jazz par
cas which are used in uglify and a few
different projects and the json parser
i'm sure i'm missing something that is
fuel
and you know if you don't to use one of
those or if you want to build a language
it's not JavaScript or parts r for
language it's not JavaScript you can use
a parser generator which basically takes
in a language definition in the form of
a grammar that defines you know how the
language is structured basically and you
know you input this this language into
the parser generator and outputs a
parser be either in JavaScript or you
know one of many languages typically
easier than hand rolling your own parser
sometimes it's slower so that's one
trade-off or larger a lot of times the
code that generates is is very large
which can be a problem if you're trying
to execute a client side here sort of
the the main popular ones JSON the
second column is the language of the
parser generator itself is implemented
in all of these parser generators it
will output JavaScript parsers but you
know sometimes you need to use Java or
yeah I guess that's just antler which is
a java program that outputs a JavaScript
parser then this notes column just
mentions a few sore what type of parser
generator is so there's sort of two main
different types of parsers there's
context-free grammars which is what the
lalr 1 s and ll ones are and then
there's peg which is sort of a a
different type of parser the main
difference between the two is CFG s the
context-free grammars can actually have
sort of ambiguous they're the definition
of the grammar is ambiguous whereas pegs
serve order the the rules they give each
rule sort of priority so it's it's
impossible to have sort of a you know an
ambiguity in the language
alright so here are a few other things
that are possible with with parsers so
you can instrument JavaScript which is
not commonly done I don't think but you
know you can do interesting things like
record stack traces more accurately than
the browser will give you so most you
know a lot of browsers won't give you
good stack traces but you can actually
add a line of code at the beginning of
each function to record the stack and
then you know pop that off at the end of
the function and you know you'll have an
accurate stack trace at any point in
your program you can catch exceptions
cross-browser completely the same in
every browser and there's this company
called proxy no it's actually doing that
they give you a proxy that you load your
JavaScript through and they
automatically do this for you and report
back errors and give you like a nice
dashboard and stuff it's pretty cool you
can do things like code coverage I saw
this project called heat wave though I
think was done it and one of the node
knockout things or something it's pretty
cool that sort of gives you a heat map
of your of your code like as it's
executing it does that by again putting
a function call it at each line of code
and recording when that that line is
executed you do things like runtime type
checking if you you know were to declare
all of your types in some sort of you
know readable format either in like a
comment or something you could read that
in and generate code that actually
checks that those arguments are the
correct type and debugging which is last
thing I'm talking about and so I sort of
started working on a code coverage tool
while ago and you know is instrumenting
my code to record which lines were
called you can get like sort of a a
report of you know your test coverage
basically you know show like what
percentage of each
file is covered by your tests and that
was cool but I realize you know if you
could actually you know block the
execution in each of these statements
you could sort of do a a debugger a
thing where you step through each line
that kind of thing so I've created this
project called Z bug it's basically an
instrumenting JavaScript debugger that's
written in JavaScript so it's it's
entirely JavaScript it works in any
JavaScript interpreter the one thing it
does need is asynchronous API to block
execution so in the browser that
basically means either prompt or
synchronous XL HP mer HTTP request and
we all know those are evil but for this
purpose it works pretty well actually so
and it works everywhere so like you know
you could run this you know in rhino or
you know Photoshop has a JavaScript
interpreter you use it there pretty much
anywhere and so it implements the VA
debugger API so rather than you know
building my own you I can actually just
integrate with any of the debuggers that
support that v8 API and there's quite a
few actually so the WebKit inspector is
one Eclipse has one I think there's a
few others cloud 9i think so i'm gonna
show that to you real quick how am i
doing on time
so if you have a computer you can play
along
oops
okay so if you have this IP address
there we go someone just popped up
someone else just show me your IP
address in your user agent so i can
actually you know go to one of these
oops yeah so it turns red when somebody
is connected so is that not working
okay well
let me try it myself
okay so it's working for me at least
this is you know the code that's running
on here it's just printing out a bunch
of stuff like every few seconds so I
could actually add a breakpoint in here
anywhere and next time it times out it
should open up it should break maybe not
okay um OOP that's not good I'm gonna
just disconnect you guys cuz that's
probably not working well
okay let's try the skin okay so
yeah perils of live demos I don't like
those me hmm ok try one more time
okay there it goes so you can see it's
selected that line and if i go over
safari it's you know completely
unresponsive so that's one problem with
this is it actually does completely lock
up your browser so you know if you're
using chrome that's fine because you
know each window has a different process
and it's not going to block your
debugger process but if you were to try
to debug safari in safari they'll just
you know sort of block up the entire UI
you won't be able to do anything so i
can actually you know step through the
line numbers on the server off a little
bit right now but you can kind of see it
you know basically stepping through all
these you can disable enable breakpoints
evaluate code so i should be able to
actually get that string yeah so you can
you know evaluate in the actual context
of the function that you're the
breakpoint is on that kind of thing so
it's still working progress it's a
little bit buggy and there's still some
stuff that's not implemented but it's
getting there and let me release this
there's a really old version on that
when my github right now but that uses
the prompt statements do that to do the
blogging so it doesn't have a nice
interface so i'll be releasing this in a
few weeks hopefully
so that's pretty much it um I'll take
questions i think if i have time am i
doing on time hmm ok any questions yeah
yeah
ah yeah I probably wouldn't have created
my own language but I mean I it's just a
lot of a lot to ask of people to adopt
entire language and a framework and is
great for you know the people who were
interested in the cocoa like environment
that objected j &amp;amp; objector cappuccino
offers but yeah and there's a lot of
people using it for you know great stuff
it's just yes it's harder it's a lot to
ask of people and but I'm a big fan of
you know the things like tracer and the
narcissist stuff we're through adding
these these new language features that
are you know sort of driven by Beckman
those kinds of things and we'll be able
to use them a lot sooner than if we had
to wait for every single browser to
implement them and every single used her
to start adopting them so yeah I still
encourage you to you know build your own
languages and play with it at least and
you know things like CoffeeScript are
great so yeah it's not you know it works
great with you know existing JavaScript
libraries so
yeah I haven't done a lot of stuff with
the generators but like so I think
there's one for JSON think one of these
let's see which one would tame j/s uses
a javascript grammar I don't I haven't
really evaluated it but there's one
there's definitely one for for that and
there's one for language jayus which we
use as the foundation of the objective
jayonce in subjection j is a superset of
of JavaScript we basically just add a
few a few new rules to the JavaScript
one and there's one for antler I tried
to get that to work once never never got
that working but yeah
at one point it is taking like 45
seconds but we're compiling the entire
framework which is fairly fairly large
it's like a megabyte of JavaScript so
sorry how much oh yeah was sorry what
yeah I mean that's and it depends on on
your type of application like free
google com no but you're not going to
need that much javascript for google.com
but if it's like you know our flagship
application that we built with
cappuccinos 280 slides and you know it
loads in three seconds something like
that which is faster than like
PowerPoint opens on your desktop so I
think that's for those types of
applications it's perfectly acceptable
so and you could do interesting things
like you know if the user has already
loaded the page once you could actually
cash the results of the compilation in
local storage or something like that be
interesting
oh yeah yeah that's I haven't done that
yet but yeah you can definitely use this
as a sort of native debugger for other
languages basically instead of sending
it the raw compiled JavaScript code you
would send it the original the original
source code for your your language like
coffee scripter objector J or whatever
and there's this new proposal for a map
mapping of I think you map the original
source code to the the compiled source
code lines so the debugger can actually
show the correct the correct code and
this could certainly support that
oh yeah now I forgot to mention so this
is using node inspector which is you
know web inspector for node basically
it's I I mean actually would work for
any anything that supports the the v8
JSON API be a debugger API so you know
you could also use the the Eclipse
debugger whatever
cool all right thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>