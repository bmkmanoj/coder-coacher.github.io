<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Bruno Fernandez-Ruiz: mojito your stuff runs on both sides | Coder Coacher - Coaching Coders</title><meta content="Bruno Fernandez-Ruiz: mojito your stuff runs on both sides - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Bruno Fernandez-Ruiz: mojito your stuff runs on both sides</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OY1VS61q3LM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we've been talking about if you
follow the Yui theater about your staff
rounds on both sides and today this
morning later clock we release some code
and I thought I'll explain your little
bit well while we've done it and what it
is and have questions are the M probably
find interesting and the basic
assumption is that you know we think
that the web is broken and we are the
first ones that actually are breaking
the web these are an example of the
apple front page rendering Indonesia
it's actually running something that's
called core is some machine learning
statistical analyses that allows you to
optimize for what gets shown it's a
little today modulating the top that
shows 16 stories for the case of
Indonesia and they're optimized to show
the ones that are better for the user
has a little arrows in the bottom that
allows you to flip through them now when
you access run Indonesia from a real
internet cafe minute 384 kilobit per
second this is what you see for about 20
seconds so the page will load up after
seven eight seconds and for another 12
to 15 seconds you're looking at a pace
that you can actually click on you
cannot rotate through the images and the
ad is not showing why is that because
somebody forgot that sometimes
JavaScript doesn't run another one these
time in the United States that's yahoo
movies running at home a good broadband
connection it loads a beautiful Jumba
trying order the call and an ad when you
connect on a 3g network again after 23
seconds this is what you get a page that
is barely usable so I'm putting
ourselves at ya poo but actually I could
go around the web doing the same
experiment i'll show you that when you
connect on bad networks and mobile
networks things just basically don't
work so the lesson learning is that
regardless of what you think and you
know this is not any more than my
website does need javascript doesn't
need javascript let's assume for a
minute that your website actually need
javascript is that you should always
always always assume that your website
will have to run without javascript
enable on the client
my dog is that actually we should call
these you know the node.js calm section
of J's conf so why is this let me
explain a little bit so if you look at
it 40 years of innovation that happened
from 1972 2010 CPU power density
transistor density has increased by
let's say a factor of a million and I'm
probably being optimistic here but let's
say there is a million storage density
has increased by a factor of a hundred
thousand so when you actually look at
are these phones the amount of
innovation that happens every 18 month
is incredible now when you look at
networks in other words that have only
increased something between 10,000 and a
thousand depends really how you actually
counting so there are a lot of issues
here when you work in a networks like in
Indonesia the rest of the world were you
know it in Silicon Valley writer having
the best network connection you have one
anywhere in the u.s. packet loss is an
issue and there are things like slow
start and the window size and TCP that
actually affect things when they ran out
sort of a good network so as a result
connected devices are only partially
connected and this is this thing that
you might get two bars on your phone and
you might get two bars in your tablet
your gun on a train you're basically
even at home on a 3g connection or even
in a 4g LTE connection you think i
should be connected but actually things
don't work you either don't get a page
you get a page that you cannot click on
that's what we call impartially
connected so as a whole you know we
should actually understand that reach
ability is actually spory and you know
when you run on an apple iOS with
Objective C you get this thing called
reachability API that allows you to know
how am I connected but when you run in a
web browser how do you actually do that
so another example of these I'm actually
to make concrete is the reason that
Indonesia homepage wasn't actually not
working is because the beginning all the
assets that download to the brass are
actually small like we actually optimize
things to be like 3k for k7k those are
things that feed really well with in a
packet they get to a browser but you
start getting to those larger package
that's a lot of retransmission has to go
on those networks and you know 100 k is
no 10 times think
so the sex second thing is that mobile
is actually important and hopefully
that's not a surprise here but let me
actually give you a number that
surprised me yesterday there six billion
mobile subscriber in the world and 277
mobile Internet users in China as
sixty-six percent of mobile users at say
hello to actually think about it that
the u.s. is probably going to get to
these states in no time now mobile web
web is no desktop web and you know if
you actually connect with you know
actually we seen it too it right that
you can bring the mobile interference
between different networks is constant
electrons fly much better than copper
that they do over there and that's just
going to be a reality in at 10,000
factor of innovation several orders of
magnitude slower and cpu is going to be
constant and true for the next years to
come and this is not just latency this
is batteries power is whatever you want
and i said we saw the thing if you know
if i can get one thing away from you
guys is mobile web is not desktop web
and we have innovated a lot on the
application layer on the web there's a
lot of work that has to happen in the
layers 427 to make the mobile web
actually interesting so recapping let's
make sure that you know you design
things of this never javascript in the
browser and in most things you know
that's called to improve vision in
husband and we've been talking about
this for a long time you know since the
days where people started showing only
Ranson msie or only runs on netscape
navigator and we started saying no no
there's such a thing you know you start
with a basic and then you start adding
on top of it now the reality is the
things are done just don't work that way
and we keep building parallel realities
these actually from Nicholas I Cassidy
de took a couple of weeks ago Arab Ajax
and he showed an electric toothbrush it
was a great analogy with progressive
enhancement should be so an electric
toothbrush is a toothbrush if you run
out of electricity still works as a
toothbrush so never assume that you know
the path the developers take to do
progressive enhancement is the hardest
path actually is the opposite when
people actually have to do progression
by writing the code twice or three times
well you end up with with this case of
it just doesn't happen so there is these
things that are we call in a wall
between the client and the server and
this is this paradigm that the code that
you write is different so let me give
you a very quick example I'll just be a
let's say that you did a link on a page
you generate the page using in Ruby on
Rails you fit amount of post you create
a little template to show the post is
shown as links and they say okay I'm
done I have it and now let me add some
Ajax on top of it so you are at an event
handler you catch the event you do an
age ice call you update your inner HTML
on the dorm and now you change your
handler to have two paths one for the
data call and one for the HTML code so
this is called duplication at the end of
a in this case it's very small amount of
code duplication Maurice code
duplication with timelines and time
pressure and developer sometimes has
been lazy we skip this so the lesson is
really with Ajax never accepted because
in mobile networks you're going to fail
and your pages will fail so what are we
doing about that remove the application
we do that through server-side
JavaScript and we found that finally
with node.js we actually could do that
scale I'll give you actually a number
we're running part of our mobile search
using this framework on node.js servers
we're getting about twenty to thirty
percent higher throughput or lower
latency depends how you want to measure
it with eighty percent more unique
visitors on the pages compared to our
baseline in PHP and that's search so if
you work for us and search it probably
works for pretty much everybody so we
need to make client-side JavaScript on
server side JavaScript equivalent how do
we do it we study with Yui 3 Yui 3 for
25 years I've already been running on
server-side and client-side actually
runs across environments so that's a
great place to start so that's it'll
work so the basic assumption is that you
have a browser the abstraction the
browser exposed to you is adult and to
access the Dom you basically
ramming language is called JavaScript
and then you write some code let's we
call the client stuff so you end up with
one stack of things which is the client
stuff then you do another one which is
the server and you start with another
thing called not yet okay fantastic now
have another run times instead of
instead of reducing my complexity i have
a new browser called no DOJ's but in
this case instead of a dorm i have an
HTTP later and I still have jazz now
instead of J's I have v8 and I have all
these things that I can learn about
running my code faster just for v8 so
you end up with server stuff and your
client stuff is not the same as your
server stuff so programming language by
itself is not enough to actually get
your coat okay just know it's not enough
to get your code executing both sides
it's good it's a necessary requirement
but it's not enough so relation the
issue when you think about this problem
is that the web the layer 7 protocol
that carries the data between the server
and the client is carrying Bates and
those beats are representation of a
string but when you step out and you
look at the browser the browser is
operating on domes you can still operate
in strength is mainly a don't
representation and the server is
operating the strings and sometimes you
can create a dump representation so you
end up thinking what is more efficient
here shall I bring the dorm onto the
server side or shall I bean bring the
strings on to the server side basically
the typical question shall I bring build
things out of a template insert them
into them or shall I bring the JSON
representation of the client on the
server side so what we've done actually
we we chose to bring the template in and
the JSON representation to the client
side because of the serialization caused
that was happening between the both it
was significantly more performing we
went to choose a serious set aside done
at the end of the day you have to
construct a Dom you allocated a lot of
member in the server but you need to
serialize the tool to get that data back
to decline and then the client has to
reconstruct another dorm and he sort is
gone on to a note and reflow and
recalculate so we pick Jason we pick
some templates to transfer that JSON in
our case we're picking mustache
and we we done is we say you can drive
server-side only logic you can write
client-side only load to you can run
common logic the client side is what we
call these binders that allow you to
isolate the dome event and the dome
insertion into a little bit of code so
we'd essentially rather than bringing
the client to server a ring that
Dominator cetera bringing the severn to
a client so we have these little thing
called remote proxy that runs from the
client that simulates basically how the
seller how to operate the interesting
thing about this if you look at
applications like lifestyle and it
fielder is that we're actually building
for the iPad we're actually leveraging
that the mobile device storage wiimote
leveraging the cpu and we're able to
shift where we call publications which
are groups of modes from the client to
the server because as a whole we
basically similar in a note DOJ's
environment on the clock we are
basically falling back onto the server
when the client doesn't work so when we
have expensive publications with a lot
of data a lot of calls what we are in we
can basically instrument the code and
say well your code is actually doing a
lot of data calls from a client remember
these the mobile device the network's
flow is actually better you make one
call to the server from the server use
our pipes fetch their resources assemble
that response in the server give it back
to the client the client has a bunch of
links the user can interact with the
page at that point and then later on 18
or 20 seconds later you're going to get
the JavaScript loaded at the bottom of
the page and then you can start
interacting with the page so that whole
flow basically enables us to construct
web wonder you Sybil for declined and
later on web 20 pages a little bit down
the line so let me dive into what
emerged it is so the basic thing is what
we call a model mojito is a mobile view
controller framework is you know very
standard you can use lethal or more is
based on a plug-in model you are things
into it so the very basic thing that we
add is a model and our abstraction here
has been you know object relational
mapping is not a great idea when you
running on the web
and our basic constructs are thought
that yql is a great interface it's a
great dsl for getting your data one of
the reasons for that is that things like
index DB or sequel I'd are available in
1.7 or two billion devices out there so
you can always assume as an API that
your your your application is going to
get access to sequel if it doesn't get
access to sequel through the actual
device you get at it gets access to
sequel through a YQL interface in the
club or Qali you which is another one
from for an evening so as a concept you
basically layer these wide or yql which
basically abstracts am I talking locally
to sequel light or am I talking to
remote into YQL and then you have a
callback those in the data back so I'll
ignore the controller for a minute you
just apply some moose test and what you
can say is either use things like media
queries to adopt your template or
ideally if you want to do more precise
things because an iphone is really not a
tablet you'll have different templates
then the controller level is very
basically a very simple Yui module you
access the namespace that you just did
for the module behind it you get if the
photos from the gallery and when your
callback triggers essentially you can
pass the data and whatever manipulation
you want back into the template that we
saw a minute ago and now this code you
can basically decide these bit runs in
the server these bits runs in a client
or you just make it common rise in both
places so on the action context which is
how do we actually make this thing is
actually the secret of of mojito and
it's a multi-dimensional it's a
multinational data structure that allows
you to store for example things like
device class and you'll have multiple
device classes or you can define things
like speed and you say i'm on a fast
network i'm gonna slow network so that
when a user actually roams and changes
from being at a Wi-Fi connection inside
the room to mean outside on a 3g network
your application can detected and the
action context gets passed between
client and server other things that you
can do is the typical things with you
know mo define days to be request adding
removing
p 7c essays and so forth so all of these
modes basically they become a mojit
library and the motif library is
available to the mochi engine and
modular engine gets the dispatcher this
patch is basically a router it will find
out for that resource are you trying to
add to execute notice that you want to
run and then each of each runtime binds
into this so this is what is common for
both run times we then doing the climb
is that you know you have your dumb
abstraction you write your binders
that's what binds the dumb event and
they don't template onto the execution
and that goes to that remote proxy that
abstracts with you run on the client
server and on the server side is very
similar you have HTTPS an abstraction we
actually are using node.js and expressed
and if you want to modify this to be it
requires what you do is you add more
middle way and that's basically the
picture for mojito so I want to make
sure I'm quickly because I think we're
randomly relate so I want to you know I
said we actually announcer this morning
I want to tell you that the code is
available on github it's a bsd license
like yui is it solves the one problem
which is putting emphasis on the mobile
web and the web is not the same as
mobile web it helps you fulfill the
promise that your staff runs from both
sides and as i say that's not just being
javascript you need javascript and
something to help you run both sides and
this is one of them we hope that people
find it interesting and being an express
on the server side and being on Yui on
the client side I think it's going to be
interesting I think my ass would be you
know let's stop creating those single
page html5 apps that don't run without
JavaScript because that's just we're
going to look at in five years from now
the same way that we looked at Netscape
Navigator msie Wars back in 2005 you
know why Norah the-- wind up there and
to give you a little bit about the
future this is just the beginning right
what I think the vision that we have at
least that i dream about is it's a world
where
no if you actually abstract this a
little bit what you're doing is the
little application that you've written
can actually go to the server can come
back to the client and it's an
optimization you can make us a developer
s of how much for your car runs on the
client around some server now imagine
that if you have access to the content
of the CDM to the edge network what if
you could postpone and change the
authenticity of the caching that happens
in that layer what if you could assemble
things in that later now what if you
could power your CPU or your network on
your device because you close to your
laptop so particular page is executing a
lot of JavaScript what if you could
actually use your laptop that is next to
it or if you could enter your car will
you found and leverage the display in
the car delivers the phone they just
enter the car and these all these things
have to do with the technology refresh
cycle people change their phone a break
in 18 months people change their car LED
TVs every three years right so mojito is
just a first step cocktails as a whole
we're going to deliver what are these
things all these things the target is to
really allow the code to flow between
all these players and eventually to
really enable that if I have a laptop
and phone I want the code to just
basically ship between them and find out
where do I have the best battery where
do I have best cpu where do I have the
business work so the charisma github I
encourage you to you know go and check
it out lonette fork it to whatever you
want with it hopefully you'll find it
interesting there's extensive
documentation you need to know a little
bit about why you I but not a lot about
Yui so hopefully you'll find it
interesting and to give you more context
and two very encouraged you should have
a little car that had a mojito beach and
a palm tree we're giving out t-shirts
there if you just go with your cart
there are free drinks between now and
five o'clock as many as you like no just
wander mojitos the bar is going to be
open tomorrow too we have some Yahoo
developers that are going to be there to
answer your questions and you know if
you're interested in playing we have two
bundles cocktails that I have in this
graph here better basically is our
hosting platform for motive
so if you run mojito applications you
want to run on the app infrastructure we
make it available for you during the
conference so you can basically play
with it you should have gotten a little
app ID on your carts and your new bags
on tomorrow that's another talk by
Julien Lecomte who is going to be
talking about shaker which is one of the
plugins that extends mojito and there
are many of those plugins that are going
to be started created thank</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>