<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2009] Alexander Lang: Writing apps on the edge with CouchDB | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2009] Alexander Lang: Writing apps on the edge with CouchDB - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2009] Alexander Lang: Writing apps on the edge with CouchDB</b></h2><h5 class="post__date">2013-06-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jIaeDYqJ8d4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi um yeah let's get started um as you
can see this talk is called wedding apps
on the edge with couch TV and so we're
going to see some apps of course and how
we want to write them and of course
they're going to be written in couch TV
um
just start misty on already said my name
is Alex can call me lang Alex if you
want to I'm a programmer as you might
guess and I have a little software
company in Berlin which does software
development and consulting and we were
big fans of the what you today will call
agile thing and untested and all that
and we do most of that using Ruby and
also rails so how come we use JavaScript
or how come nice I'm standing here
talking about JavaScript when ninety
percent what I do is Ruby
first of all some point our customers
came and said we need Ajax without a
Jaques we we can't sell our products
anymore and so we had to do javascript
of course and then one day quite a while
ago
Yan came alone in our office or and he
said CouchDB to me and I was like what
okay
what is code TV and so Yun said whenever
he talks about coaching he's talking
those really long sentences seems like
yeah it's restful you know like
MapReduce has other amazing stuff and
MapReduce again and our language scares
and blah
and he keeps on talking until he finally
has to breathe and yeah so I was
presented with his lung sentence about a
couch TV and didn't really know what it
was and so I started to investigate and
I won't and this kind of adventure
journey here I'm asking myself what
couch TV actually is and so first thing
I saw was a sign that said it's not an
SQL database instead it's a key value
store which means you can buy keys and
values and you can put values into it
and then have keys and get them out
again and so I started talking to the
couch as the digital natives you know
what comes naturally for me is HDPE so I
didn't know what a couch would respond
to so joy try the HDTV and surprisingly
that worked and the couch responded and
talked back to me
and so this is the first thing as you
can see here and basically saying hi I'm
Alex to that couch and it says back hi
and that has stored my my requests and
you can see here I'm posting some data
to it as you can see that is JSON which
you might all be familiar with and I get
back this this ID and revision here the
ideas and the key of that data from now
on and so I can ask it again for that
document and as you can see here I'm
doing a get and this is the same idea
that it just gave me under step before
and so the couch again talks back and
gives me the data I just stored in it
next I wanted to know all the speakers
at this conference and so I told coach
TV about this map function I had made up
and what this internally does it takes
that function and then takes every
document and in that database every like
chunk of data and processes it with it
and as you can see here my data has some
kind of speaker property
and if that hazard then it's sort of
return said so I'm not going to
magically details about the MapReduce
how it works because it's kind of
complicated sometimes but so um the
thing is it'll just collect all the
speakers that are in the database and
return them which you can see here on
the right side so I mean there's so not
all of us but most so I again talk to it
and I wanted to know how many speakers
are actually where and for this I passed
in or gave it this reduce function which
looks quite simple so it sums up all
these ones that you can see here and it
said okay there's 23 speakers and yeah
pretty nice so I look down at the couch
and at the Eternals and wanted to know
what it was and so you can see here at
the left it's kind of this big sucking
machine that sucks up all the documents
here and there at the bottom and gives
them to me when I request them so I can
whenever have the key to a document I
can load it using this which is very
simple that's why it's a key value store
right and then there's this other thing
which kind of has these pipes and when I
give it a rip function like give me all
the speakers it'll like internally sort
of create one of those pipes and then
like so are the speakers ready for me so
whenever I ask it they're already
available and I can just get them so as
you can see here it says speaker so it's
the speaker's pipe and I can just say
give me the speakers and they're there
um what I was added also looked at MySQL
again a bit but um well as you can see
it's all sorted into tables at button
but it gets messy by the rap so I went
on back to the couch looked up and it
was again and those boards here are a
few documents edit corrected for me and
so suddenly there was four couches and
not just one and they all had the same
data so
what country we can do is replicate
itself which becomes important later on
and whenever I change something in one
of those couches or the others will pick
up and just have those same documents as
the one I changed so I can change any of
those cultures and it'll automatically
transfer the data to the other couch TV
couch the weeks um
couches can live in servers like this
one they can also live in like laptops
which um doesn't come as a big surprise
I guess um but you can also run on
phones which can become quite
interesting as we will see a bit later
anyway so that was a long day and I said
on the couch and watch the sunset at
middle and it's already the end of part
one of this talk and what we fluency for
we using JSON to to store data in the
database um it has an HTTP interface so
I can talk to it if I talk it should be
myself but can you take dude I can't
speak to directly I can use a browser or
any HTTP client I want I can pass with
those map functions to sort of extract
data from it and I can pass those reduce
functions to do calculations on that
data it's sort of the essence of those
two and it has this replication which
means I can set up as many copies as I
want and I can tell it to love keep all
of them in sync so like in multi master
data they set up something which is
really a pain when using traditional
databases like MySQL for instance yeah
so that was part one
and this is part 2 so let's talk about
some apps and I have a little
co-presenter here which is Steve hearing
them on the left and it's gonna help me
present this thing and this is the first
slide um I think that's the other
presentation so let's move on so am the
apps um apps are this which is a couch
and the apps live inside the couch which
is why they are called couch apps and
basically what that all is is JavaScript
on the server side and in this case the
server is
couchdb so you can run those apps inside
the database and then deliver them to a
browser we have documents as you've
already seen you can just put any JSON
into couchdb and then it's gonna be
stored there and you can get it back if
you want to you can also have
attachments which can be anything you
want anything binary data HTML pages yes
as far as good whatever videos you want
which comes in handy when you talk to a
browser we have those views that this
that is a map function thing so you can
extract data so if I have documents with
speakers I can get a list of speakers or
the sum of all the number of speakers
and that kind of stuff
we have shows which can be used to
transform a single document into
anything else which might be a just
email in this case I could be XML it
could even be binary data I think and
yeah so this allows you to serve a
document to a browser or some other
class
like say like some RSS reader or so and
transform it into a format that this
client can understand and we have lists
and that is the same thing but it's not
working on a single document but on a
view so you can admit or you can serve a
list of data or anything you want and we
have updates and updates
well they update they don't so you can
post output to the database a little
update data and you can run code in this
so it's not like a fixed thing but you
run code well and tell it what to update
from the request so like like a real
server
um so anyway um this is the short
overview of what couch apps are and I
don't know what is it new MacBooks no
it's something called semi and Sammy is
doesn't really have to do anything with
couch TV or not even with server-side
JavaScript but it is a nice little
framework inspired by Sinatra I don't
know anyone knows Sinatra just written
in Ruby so I know Sinatra it's a tiny
little framework that allows you to
quickly yeah write web apps and there's
a bit support of mapping URLs to actions
and then you can run some code and it's
a nice way to to write a little apps and
I'll show you some code later or how
that works
so anyway Sammy is pretty nice because
it takes the concept and runs it in the
browser so you have a full sort of
little framework for web apps in the
browser and you can run web apps in the
browser and then you can an use couch TV
under that and use it as a storage which
is pretty nice um those are a few apps
that are already out there so there's
something called
amazing which is used for presenting
this ayah which yawns little URL
shortening service there's a calendar is
a real-time chat unless an e-learning
app less time tracking blogging Twitter
clients wiki's and maybe most notably
there's also rain drop which is written
by Mozilla and it's sort of I don't
think I'm supposed to say this but I'm
sort of Google Wave quite familiar but
it's not so it's like their approach to
like sort of next-generation messaging
and it's it's a couch app which is
pretty cool um anyway um Steve and I are
gonna show you how this works right now
um by the way the first couch I've ever
written a sister CouchDB admin interface
which is of course served as a cow chip
so it runs in the database and that's
this nice Ajax interface but okay so
this is I oh this is the URL shortening
service yun wrote um it's pretty simple
I can go here and type in some new hour
gives me a shorter URL of course if you
wanna use this in production you're not
gonna expose this long URL but you're
gonna use some kind of proxy and then
have just this little part here appear
to the client so anyway and if I just
pasted in here and if the internet would
work then we would see J's confer you
now anyway so that works you've seen it
all
another example that I wrote for another
talk is a little wiki this is written
and using semi so it's all running in
the browser you can see um right here
maybe you can see I don't know so this
is the important part of the URL and
that changes well and filling in forms
and clicking links and so this uses
JavaScript on the client you determine
what you do next depending on what how
this changes here so I can create a page
and it's my first page and I can click
on this camicus link and create more
pages and so that's what you would
expect from a wiki I guess and so that's
all client-side and it just saves data
back to Akashi be but takes for
rendering of templates and everything
runs in the browser and my third example
is Mozilla raindrop raindrop is pretty
new it's actually so new that it doesn't
even run on my computer yet at least
I couldn't install it or I couldn't
solve it and it's this is what I saw but
it doesn't really do anything for me
which is why I found a video about it
which I'm going to show you over the
bulk well as an example here's our
initial version of raindrop and here you
can see we already recognized mailing
list messages and put them to the side
you can get to them when you need to but
they shouldn't get in the way of
messages that are only for you
we're also working on ways to filter for
notifications like those you might get
from Amazon Facebook or eBay to keep
them out of the messages you get from
real people and because this is an open
source project with a built-in extension
system you'll be able to pick which
notifications you want where well that's
all for now thanks for listening the
range up team welcomes
comments indeed been but so what are you
said in the beginning which you did not
see you said it's a messaging kind of
system so Audion acid is from everywhere
from Twitter from Facebook from email
from Skype everything just go into this
one app and then this app figures out
which messages are important and which
are not or visa tries to and so it does
set inside of couch TV
next one I'm gonna show you some code
because I mean talking about apps is
nice but you might want to see how that
actually works so we're gonna look at IO
which is really simple so I can show you
all the code because it's just a few
lines um yeah it's simple eyes that's it
and it's only code Shiva so there's
nothing added on top of us no sugar or
nothing it just is just contains a few
of those things like views and updates
and lists where I'll just show you so
anyway this is um the map function and
what it does is so it takes the key of
every document which is like a sort of
short version of the URL so the secret
and the target is the actual URL and
then it spits out a list of every key so
every like secret and every URL and this
way we can figure out if someone gives
us a key what the URL is this is the
update function that stores a ul so as
you can see here and we are getting the
document which in this case is now
because we're creating a new one and the
request and so what we can do here is
okay if there's already duck we we just
return because we don't want to update
existing ones and then we create a new
document and then we just say okay the
target is the URL which we are getting
from the request object so from the form
that I've just submitted and the
shortened version we just generate the
random string and we send that a cid and
so this just gets returned here and so
this is the stuff that gets saved in the
database and this is the this is sent to
the browser so you would actually want
some HTML editor maybe so that people
can click on it or
and yeah what generate secrets not that
interesting I guess this is the actual
thing that redirects you to the URL you
wanted to go so when I clicked on the
link this is what get exit gets executed
and as you can see here we are returning
and redirect 302 and giving it the
location header which is the target of
that document so pretty simple and
here's the list and that just spits out
all the links or all the URLs in the
database so I can have a list and see
what people submitted
okay next one is some the CouchDB wiki
that I just told you that is as I said
implemented using semi so that's a bit
different as I said my dog runs on the
client and I just uses an occasional a
jQuery to to store the data but
everything else happens in the client
and semi is based on jQuery and there's
also little a brick couch days which
makes it easier to to talk to couch the
front within the browser so you can just
say okay just save that you don't have
to do HTTP by yourself this is part of
the source code at least so this is how
you write a semi application and the top
you're you're just initializing semi
itself and then what you do is and you
can call get put post and delete and you
can see here and you just pass it a
pattern for ul so this one will match
everything that says pages slash some
string so when my URL changes to slash
pages some string this function gets
involved and this will here load the
documents
whistling which in this case is a page
and it will run and this function this
looks like pretty nominal jQuery so on
success there's another function and the
dog gets passed in and then you can
render a template here showing the page
or whatever you want to do so and yeah
pretty simple again this is some sort of
the create action sorry I'm talking a
bit like a trains person's own rates
they're actually our actions and they
are called create so you know so here
let's posts to the pages path and again
this load some some kind of object and
and then store sets or you say coach Doc
TV dot save doc and then it saves that
and you can show some message saying
okay that worked or it didn't so what is
it and some he also has some sugar like
the fall filters I don't know with that
but so you can run stuff before every
request if you wanted to like in this
case clear the error message yep that is
semi and um as I said it all uses Ajax
and that makes our customers very happy
of course so um the last one damn it
it's called rain drop on that wave drop
that was yesterday night sorry
so as I said um rain drop it collects
all the messages from other clients and
all your accounts you have so if you
have Twitter and Skype and I am client
on Facebook I will collect those and it
also integrates email em neutrals
they're going to work with weight and
you can also shop in RSS feeds a 19-1
basically and install it and those into
whoops
like this and that's actually some
Python involved so it's not all just
JavaScript and couch unfortunately they
need some Python to to set up things and
to actually go to Twitter and and load
stuff so that is our Python but we're
not going to talk about that and then
I'm that goes through the couch and then
again it serves the stuff that you've
seen in the video so you can use the
browser to see your messages inside the
couch is again documents and those
contain your tweets your emails your
everything your contacts and so every
everything that raindrop collects stored
in one document and then what they do
they have a view and that view is called
mega view I'm not gonna get into why
they're doing it but I have a few
reasons to instead of using many views
for extracting data they're just doing
this one big thing here which looks like
this which is the because of you I've
ever seen so usually you have like three
four lines or something and yeah so they
have a bigger one because they're
Mozilla and they need something big and
this is reduced function which is small
again like you're used to and it just
comes something and then they have some
assets and libraries like 30 megabytes
or so in that CouchDB and it is enough
to serve the application and generate
HTML and everything and of course it
wouldn't be a Mozilla project if I
didn't have
engines or you can write your own
extensions and do we stop with that and
then the way it works is that every
document gets passed with every
extension and the extension can generate
more documents which get fed back to the
extensions again until no more documents
are being generated which sounds like a
bit crazy but it seems to work
I'm sorry where this is like the
architectural overview everything goes
into the Python thing fetches all the
data and drops it into the couch and
then it runs all the extensions and then
it goes to the browser okay so um that's
actually already the end and the song
questions and that's sort of what comes
next all those apps and first of all
what what do we now now so could she be
stores those documents a situation we
use those views and then with a map and
reduced to to extract the data it has a
built in HTTP server which means we can
talk to it directly from the browser I
test for shows and lists which allow us
to generate HTML or whatever XML we want
to talk to the clients it has assets
such as images and CSS so you can serve
those as well direct directly from the
from the database and you don't need a
specialized server for that and together
all this is called cow chips and one
other thing has said now that everything
is in the database it also means that
the data of your application and the
code are in one place which is pretty
nice because um together with the
replication where you can sort of copy
data from one database to the other it
also allows you to install absolute
weight because everything is just in the
database so you replicate your data and
that includes your code and then this
how you install your apps which is
pretty simple um okay so so again and
this is what we already know
and so the question is what what comes
next I mean why not have an app store
and they get giant couch TV somewhere
and then people can just replicate stuff
out of that and maybe pay for it all
right maybe not for it and have some
some sort of even better open source
word than we have now because whenever
you run an application you have access
to the code and you can change it and
everyone can can can improve apps and
stuff and replicate that to other people
and it might be a pretty a pretty nice
scenario having those apps everywhere
and everyone can hack on them which
isn't my idea and I didn't come up with
this but I like the in the scenario and
of course we want more apps and more
presentations that consume so I mean
what you're seeing here is of course a
couch app that I've written in the last
week and already stopped working it in
the last week it I've had it written for
a previous talk and what you're actually
seeing here is a one giant enormous SVG
file that I generated using tons of
tools
soo-ji on Austin really sucks um
everything crashed yesterday and I
didn't get a nice BG files into the
browser um but anyway I'm gonna do
presentations like this and you can
check out amazing yeah thanks that's
everything so far
there's a couchdb book if you want to
read it it's online and you can also buy
it on paper
soonish thing and if you want to look at
couch apps use those things here you see
me and there's a couch TV website any
questions
so the question was about security
because of course of what I've showed
now when you have access to the entire
application and the code from the
browser you can change it and spy on
people's passwords or something there's
a number of ways one would be to just
put it frogs in front of it and just
check which data you want to give out to
users or to - to clients and you can
also catch to be has some integrated
authentication modules so you can do or
author and stuff like that
and now to decide what you want to give
out there's a dancer a question okay I
don't really see much SNU okay thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>