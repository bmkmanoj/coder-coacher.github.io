<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Elijah Insua: Why node has a DOM | Coder Coacher - Coaching Coders</title><meta content="Elijah Insua: Why node has a DOM - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Elijah Insua: Why node has a DOM</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YSgAyXvBzHM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so my name is Elijah Tinto ah I work for
art 90 and we're located in New York
City today I'll be talking talking to
you about why the node has a dom i think
this is important that I explain this
there's a lot of jaywalking and buses
and taxis in New York and if I get hit
by any of these I think it's important
that you guys know what I'm what I'm
trying to do what I'm trying to
accomplish here so the first thing that
I think is important and I get asked
this all the time what is a Dom right so
the w3c and its infinite wisdom defines
it as the document object model or dom
is a platform and language neutral
interface that will allow programs and
scripts to dynamically access and update
the content structure and style of
documents I mean that's great but I'm
still I'm still confused right so when I
think of the Dom my mind immediately
goes to you know a browser so this is
the nodejs homepage and the image here
is the result of markup being turned
into a Dom being styled being run
through a reflow like engine and then
being rendered to an image so as an
example here's some markup it's the X
it's the TOC like the links the
navigation on the left hand of the page
and when the browser retrieves these or
when it retrieves the HTML it sends it
to a parser the parser is kind of like a
assembly line it takes raw material or
markup in this case and it turns it into
usable components which we know as a
tree of Dom nodes
by the way these are f-22s which and
they're awesome okay so after they get
turned into a dom tree as you can see up
here there's i've used a tool i don't
know if you can see that he's a tool
called HTML graph to graph the markup on
the no th node homepage it's kind of
interesting to see this whole this whole
tree visualize but the purpose of this
is to show that the navigation div the
purple note that the orange arrow is
pointing to is actually like parenting
this whole hand looking thing which is a
noel a bunch of li is a bunch of links
so why is this valuable what what is the
purpose of this basically there's no
more text manipulation you can't read
documents as a tree and you don't have
to write x things and just you can use
it programmatically as opposed to
packing ground manipulation is easier
because we now have the tools to you
know traverse the structure manipulating
nodes moving them changing them whatever
you want to do so this is also good
because it's a common paradigm the DOM
is everywhere it's in server-side
languages or server side of platforms
browsers I mean it's one of the most
common paradigms around I mean it's just
a tree and some functionality to
manipulate you know the notes so I'd
like now to dive into some of like the
implementations on server cited
platforms and see how they work so
basically every every server cited link
every server cited platform has at least
one Dom
the problem there are many problems with
these though a lot of them actually all
of them you can't execute JavaScript and
we all love JavaScript so the question
is what would you use these things for
and in general it's a lot of XML
processes XML manipulation there's
xmlrpc soap xpath xslt and these are
these are a lot of short-lived arms
right they they're not meant to live
longer than the time that it takes to
remake a request there's no window
there's no events so even if you had a
long running Dom you couldn't you know
wait for an event to happen and capture
or bubble it or whatever and they're
they're extremely hard to bootstrap and
again there is no JavaScript so this is
the xml and HTML rift which i don't see
as it's horrible like you should be able
to process HTML and have a headless
browser native to your platform so
markup is good we all know this it's by
far the most known language even
non-technical people know what markup is
even if they don't know you know the
intricate details of like CSS they still
know what you know tags do in some some
fashion and to prove my point many
people know what this does so how do we
fix this problem we must be compliant
with the w3c
many platforms make bootstrapping a Dom
extremely tedious and painful we need to
fix this they also don't they don't
execute JavaScript so if you include a
script tag it just treats it like a
normal Dom element so the ideal
implementation would actually be
scriptable like a regular browser you
would execute JavaScript in the context
of the platform and in the context of
the window so you could you know combine
both of these worlds and do some pretty
amazing stuff so as because or because
node actually runs in JavaScript we kind
of get some of this for free and we can
do things that other platforms can't
even consider because we can execute
JavaScript on both sides so what does
jess dom about a year ago I started
writing Jace Tom as a as a common as a
common J's implementation of the w3c Dom
spec I've kind of limited that down to
node specific there's a lot of
intricacies with you know loading files
and all this other stuff that hoarding
it is kind of a pain and it's not really
the primary focus right now
so what is jas Tom it's pour sur les
which means there's no parser I rely on
the community to you know implement
these parsers and it's it's basically
between the parser and the rendering
engine so it would be you know as shown
up here it's you know the parser adapter
which you know takes markup sends it to
a parser and then the parser actually
creates down for you then it's the dom
which is specified to a tee by the w3c
and it's also a small window like
implementation right now we have a bunch
of stubs but that will change also
something that I should mention is the
parsers in red up there there are three
of them and they go from order they go
in order from you know fast but very
strict to slower and they deal with more
messed up markup so if you wanted to
scrape you know the world wide web the
wild the wild web you would actually use
probably html5 the html5 parser but if
you if you're just trying to do XML you
probably use sex so what makes what
makes us great so the first thing that I
did when I was writing guess tom is I
got the test suite from w3c because it
is very important that we are w3c test
suite compliant right so right now we're
really close a hundred percent of level
1 level 2 and level 3 which is more XML
or passing you yeah
so jess Tom isn't done until all of
these levels are complete and it's fast
which we have some some problems with
but first off I want to explain what
these levels are because I get a lot of
questions about okay so what there's a
bunch of levels what do they do so level
1 is it has this core module and it
basically defines you know what a
document is what a node is what an
attribute list is all of this basic
stuff level 2 kind of splits it goes in
one direction xml so you have namespaces
and all all of that fun stuff and then
on the other direction it goes HTML
where you have you know anchors form
elements and it also implements or also
introduces events so you can have
capture and bubble and all the things
that you're familiar with in the browser
it's also jess tom is also extremely
easy to bootstrap as seen here I mean
it's for brevity it's I've split up the
lines but if you combined all of this it
would be one or three lines of code and
it's extremely easy to scrape pages or
you know load up your own markup and
manipulate it and it works one thing to
note about this example is that it does
not run external javascript so if you
have a script tag it will not fetch and
execute that JavaScript there are other
jsm methods for that there's a salvage
as Dom method and there's also JM dud
jquery if I which will allow you to load
remote scripts and execute the
JavaScript that's that exists on those
pages so I guess I could explain this
basically we require jsem that env or
Jace Tom run NV it goes out to nodejs /
disk which is basically
lists why so this dis page is basically
a list of links
hello hello hello okay so
where was I oh yeah the slush disk page
actually is just a list of node releases
notary node releases all right and when
it's when it's done when it actually
fetches the content and parses it and
puts it into a dom it will call back to
the count function where we have access
to a window in a document and everything
that you expect in a browser except
we're scripting it from the outside so
we can run you know window document
document get elements by tag name a
which is what this page contains and
then get the length and see how many
node releases we we've had it's kind of
interesting and very easy right here
okay I can do that okay so i think it's
i think it's important that we show that
i show what projects are using json
closer just eat it okay so the majority
of projects that are using json today
our screen scrapers so we've apparently
we love stealing content which is good I
suppose I mean at least people are using
this which is which was a surprise to me
we also have some people using it for
testing zombie is great toby is also
great other people use JSON the new
smoke tests which is okay I mean j/s tom
is a fully featured browser so you only
get some of the functionality we have a
lot of stubs I this is it's good other
people use it for development these
projects are interesting as well things
like JSP p which Michael wrote and I
mean a lot of good stuff in the space we
also have people using it for
unobtrusive templating this personally
is why i started jazz Dom I hate micro
templating and I help high jinks right
well which is up there so you guys
should check it out because it's awesome
and it basically fits the need of
it scratches the itch that I was trying
to scratch when i started you a stock so
other people are trying to use it for
code review code reuse and if you
haven't seen Dave glasses Yui 3 examples
you should check them out because they
are quite amazing he basically takes the
same code that he's or the same dawn
that he's rendering on the browser
renders it on the client and if there's
no JavaScript it doesn't matter all the
links work all of the like he has some y
UI widgets with a calendar and it you
should check it out because it's amazing
there's also people doing charting
graphing so things like highcharts plot
rafael which is pretty cool people like
to serve images instead of instead of
raw SVG for browsers that don't support
it as well as not giving away like
details of the payload like they don't
want to send you know actual financial
data across the wire so they just render
an image on the server and then send it
as an image to the client so Jason would
not be possible without these people
these 46 people which is quite a few
whether it's writing a one-line patch or
rewriting the entire test infrastructure
Janice Tom wouldn't even be close to be
it wouldn't even be usable I mean there
there'd be no way I don't have enough
time this is a personal project and I
don't have enough time to do all this so
I really appreciate everybody that's you
know helped out as a bit of a roadmap
some of the things that we're missing
right now our default actions for
elements so say you click on a link you
would expect it to navigate the entire
document or the entire window to the new
page that does not work right now
we're also looking into speed
improvements namely a live node list
alright extremely slow we have to resort
to this crazy machinery to make this
these work because we don't have proxies
mm-hmm and I think I think we can solve
this problem but it needs to be looked
into we also need to fix memory leaks so
if you set a timer like a set interval
when you execute external javascript it
will leak and if you have a ton of Dom's
you'll go over the one gig limit and it
will be will be bad very bad for
everybody there's also some work that
needs to go into the window
implementation right now we have a lot
of stubs we have enough to make some
stuff work like jquery and yui and
prototype I think mootools but there are
some other libraries that don't work
because we don't have the proper you
know stubs or functionality in place we
also need to test these methods which is
going to be difficult because each
browser does a slightly different thing
and there's no spec there's no test out
there so we'll have to write the test as
well another thing that's not on the
slide but I just remembered is that we
need to be able to log what's going on
in the Dom when you go out and fetch a
page right now if
right now we can get in these situations
where you won't see anything happen it
will just look like you know you never
get a call back it doesn't even it an
error it just goes away and it doesn't
return you anything and that needs to be
solved immediately and that is all do I
have any questions
questions
of the Yui through stuff
I don't have any locally uh yeah yes if
I could show some demos perhaps with
like the Yui 3 stuff or other things I
have one
can you guys read that can you read it
No
how about now all right
a little too big so this is the same
example that I was showing before in the
slides the problem is we don't have
Wi-Fi so it won't be able to go out and
collect any data so that's that's kind
of a problem but I mean this thing work
that's right it earlier when I was at
the hotel so there are other examples on
the github page which is 10 power /
guess I'll so if you want to check those
out it might uh might help
not yet that is one of the things that I
was mentioning with the default actions
so the same thing sorry yes if Jay Assam
supports the you know like form
submissions and stuff like that and the
answer is not yet yes so the question is
with exit with in regards to executing
remote javascript is there potential to
basically jump the shark and start
executing javascript in like node and
yes yes there is so that is why env does
not do that it's meant to be like you
know easy to use and it there's like
really no security risk the in the
future it will as soon as we can figure
out how to do that whether or not its
spawning off the child process and see
it's routing it and going crazy or if
it's you know finding a better way to
sandbox it in node itself okay so the
question is with all of the browser
stuff not being exactly like the Dom
stuff is there is the goal to split them
apart or just to expand Jase Tom I think
it would actually be optimal to split it
out but I don't think we're quite there
yet I think we need a once we have a
working implementation then we can split
it out to another library have its own
test and maybe even you know go as far
as to provide different implementation
so you know it emulates IE or firefox or
whatever and then you know add that as a
dependency to jess dom i think for right
now it will all be one library but
eventually it will probably be split up
no and the question was did this come
out of work with readability so the
question was how important is the speed
of the Dom when you're using many doms
on the server it's very important in
fact it's more important that it is on
the browser you know and the browser
people expect you know the Dom to take a
little bit of time but on the server
it's important that we get responses
back immediately especially since the
DOM is
looking we want you know we want results
as soon as possible which means you have
to spawn out more processes to handle
more requests so the faster the dumb is
the more requests we can handle with a
single process right does that answer
the question so what am i doing to
improve the speed so there's we have a
clergy implementation of live nodelist
which which it is it it's very slow we
have to recalculate a lot of things
basically we're crawling the Dom back
and forth and it's it's extremely slow
and I think once we fix that it will be
much faster thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>