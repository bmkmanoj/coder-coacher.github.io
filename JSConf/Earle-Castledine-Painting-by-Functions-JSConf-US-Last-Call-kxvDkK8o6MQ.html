<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Earle Castledine: Painting by Functions - JSConf US Last Call | Coder Coacher - Coaching Coders</title><meta content="Earle Castledine: Painting by Functions - JSConf US Last Call - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Earle Castledine: Painting by Functions - JSConf US Last Call</b></h2><h5 class="post__date">2016-03-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kxvDkK8o6MQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so there are many categories of wasps my
favorite of the solitary wasps and of
them the digger wasps the digger wasps
dig a lot sometimes several feet into
the ground they can dig bit careful and
they're smart and they're precise the
facile for instance she will go out
looking for crickets paralyze them drag
them back home and it so it can be a
long ways you have to go like climb up a
tree fly down if because the crickets
heavy and have to go up another tree
it's a mission but when she gets back to
the hole she has a little ritual she
takes the cricket drags it to the edge
of the hole right on the edge goes down
check things out comes back up and grabs
the cricket then dragged him down to the
depths where she lays her eggs stores
the cricket comes back up seals up the
hole he's still following me and then so
when like the poppy wasps or whatever
they're called a emerge they have some
food
it's a pretty good system but a long
time ago someone found a bug in it hey
what's on bugs though I guess crickets
are the ritual goes like this drag the
cricket to the edge of the hole you go
down check things out come back up and
drag the cricket in and go lay some eggs
but for some reason some weird person
sound a floor or a hack if you messed
with one of the steps you could get the
wasp into an infinite loop after
dragging the cricket to the edge while
it was down checking things out for some
reason I don't know why move the food
just a little bit just a little bit it
was like a couple of inches and when the
worst came back up she was like that's
not right so she dragged the food to the
edge of the hole then went down to check
things out and they do move the foods
and I was like what so she dragged the
cricket to edge of the hole for infinity
which I mean it was like in nineteen
eighteen hundred so infinity was only
about 40 but then like they did gave up
they got bored that's how you defined
infinity is just like now I'm not doing
this anymore I read that on a Snapple
lid
today I want to talk about rendering
things and with the intention of
rendering stuff for the web and stuff
for our applications widgets and user
interface components and I want to look
at doing them with what I mean I they
think it's a real term this functional
rendering but also i'm going to call it
so i want to look at rendering things
functionally rendering things and then
doing that in react and react native
with the goal to making some cool
widgets so i want to start with pure
functions the wasp going into infinite
loop was not a bug it was a feature like
all of our bugs it's a feature not a
flaw wasps have a big problem with
parasites so while she's out looking for
crickets flyers and stuff could get in
to the nest into the hole and if she
didn't go down and check it out then the
Flies would eat her eggs and things and
it wouldn't be good she comes back up
and the food is moved even just a bit
she'd has to assume to have parasites
bear to go down and check it out the
worst was a pure function from cricket
to puppy wasps an array of puppy wasps
no messing around with the state always
got to come back to the same inputs same
outputs even if someone sits there
forever we end up with our puppy puppy
wasps so looking at some examples of
functions and some tests are tests for
you guys here's an example of what is
the result of this expression I was
there you know a little bit tricky there
with a DVD you icon in the middle oh
damn unicode okay seven thanks to the
DVD the point is it's always seven every
time you run this nothing's ever going
to change the fact that
seven well unless they have a changed
unicode but how about this guy what's
the result of this one sign starts at
the bottom and close starts at the top
it's fun ok cool here's a trickier one I
have a function that takes an X and
returns to x times X and what is the
result of square 1.5 I thought point 5
because I thought that was pretty nasty
enough I looked it up on my calculator
any 12.25 are you sure you really sure
yes there's no reason that this function
will never return not return 2.25 what
does it mean if it didn't return 2.25 it
would mean like the apocalypse and that
computers were topsy-turvy and dogs and
cats living together what about this guy
anyone I don't know and we see this more
of an example of an impure function
which is relying on some sort of hidden
state I've got a function of Omega which
takes an X and returns excellent abdo
ratio and what's the result come on they
told us in high see there told us in
school like anything x 0 is 0
functions do like with side effects or
that rely on hidden state a dangerous
can be dangerous that's where fewer
functions have some really nice
qualities they make it easier to reason
about the behavior of our code to make
like assumptions about the behavior what
optimizations we could make and things
like that they're composable and I went
composable to sort of run through this
talk as a theme i guess if we know what
has to go in and we know what comes out
then we can use the output as input of
something else and we know that it's not
going to break anything else and we can
use all the functions together and
they'll always work for all eternity or
until the apocalypse but I want to talk
about rendering and specifically making
like widgets for the web and stuff which
is harder to do without side effects
thanks to our billing the technology we
have it's hard to do anyway because the
easiest way to think of a drawing API is
through some functions that they you
draw some stuff on the screen so here's
an example where I'm calling the same
function twice it should draw the same
rectangle I'm sure same inputs I should
get the same outputs but it's relying on
a whole bunch of context that's why its
context so depending on the context
we'll get a different output addition
the canvas is a bit slow for making
widgets you can do it but pushing pixels
is pretty slow using the built-in
effects and you get a built-in shadows
and things which would get with CSS so
we want to be able to do something some
more interesting stuff so WebGL that's
an option now because it's supported
everywhere and it's really fast and we
can you know make 3d games that are
really amazing but it's old and it's a
big ball of state here's some
boilerplate for setting up something
just to draw a couple of triangles in
WebGL
and of the boilerplate these bits set
global state it's a mess well you can
feel that it's an old API when you use
it you can feel the parts that that are
troublesome and you have to be careful
because you need to put things into a
state do the drawing you want change the
state do the drawing you want and then
it becomes hard to reason about what
what is in that in that the next frame
of rendering so if we're going to go
with something you had no state and was
just pure functions but how could we
draw anything then Haskell guys of if
you ever do intro to Haskell then you
know this problem is sleep you can't
change anything you can't change state
what am I supposed to do anything there
is a way in the browser that currently
exists and I don't know much about it
but it is one it's the CSS only drawing
think I don't know too much about this i
like it because what i like about is its
declarative stateless well I don't know
if you'd want to use it it looks pretty
hairy underneath it but it is one option
but I don't really want to go making my
widgets this way so I want to know what
some other options are and I want them
to be really fast because I want to do a
lot of pixel pushing and a lot of
advanced effects so i'm going to revisit
WebGL this is the WebGL pipeline it's
all the steps that happen to get some
code from the of the from the API goes
through a rendering pipeline and there's
a couple of places where we're allowed a
mess with stuff before it gets drawn to
the screen and this happens every frame
so you set up the pipeline and you can
mess with it there's two places in here
there's a vertex shader which is for
defining your geometry and you vertexes
in space and what things are going to
sort of shape and then there's a
fragment shader there the orange boxes
in this the vertex shader defines the
geometry in 3d so when it's not in 3d
it's the model is 3d it could be 40 or
just a model but it gets projected onto
a 2d screen and usually it's 3 because
that's the one we like looking at but if
you draw it on the screen then it just
looks like this is just a mash of color
because screen is 2d it's we don't
really have 3d screens in the way that
we get some 3d effects and things that
look like 3d is through the fragment
shader and the fragment shader is what's
responsible for doing a lighting and fog
and highlights and and things like that
that make things look really cool I
don't know where there was a hashtag and
I'm sorry the way the fragment shader
works so you have your geometry and it's
made up of triangles so whatever your
shape is is made up a whole ton of
triangles and for each triangle one of
the steps in that render pipeline is the
vertex shader and this is where we have
a chance to color coughing's in the
first example I showed where it was just
flat we're just making choosing a color
white for every pixel we're saying this
is the color it's white here I'm saying
it's red so I don't know if you can
really see it there every pixel is red
because I've setting the fragment color
to be 100 and one for alpha that little
bit of snippet of code is glsl GL shader
language it's kind of a see like
language it's pretty interesting has
some interesting properties that we'll
look at in a minute and the reason that
the thing that makes it so interesting
is that although the WebGL whole API is
very stateful and you need to be careful
where you're mutating things and
changing things shaders themselves are
very functional they're just a function
from point to color and so for every
spot on a triangle you get to choose
what color comes out it'll say like the
first pixel and you say it's read this
can pick celine say it's red the third
pixel ooh so it's slightly less red and
then it looks like we have shading or of
course just like CSS drawing which is
kind of seems like a hack a cool one
people do abuse them and instead of just
making lighting effects people start
doing winamp visualizations because they
look really cool and that's what we want
but this is all in the browser now and
it's all supported in a lot of places
and we can use it everywhere so there's
this sort of a side stream of shading
shape shader coding that's run up in the
world and it relies not on the geometry
in 3d shapes but it's just on two
triangles so here's my phone on the side
and the two triangles are a box and we
know from the web if we know the box
model we know things are made up of
boxes but we can convert every box into
two triangles and we have a box and then
for every pixel on the screen we can run
a program I think about that that's
pretty crazy every point we get to run a
program and say what color should come
out and like everything on the internet
is in the world as soon as someone comes
up with like a little creative idea for
using something it goes out of control
arm this is that here's some video from
this year's shader showdown finals which
is live coding glsl shaders in
competitive mode
that's from the revision demo party this
year and people make if if you look on
shader toy calm and GL SL doraku calm
there's amazing amount of effects and
creative outlet like creative output
from simple tiny functions and that's
what the shaders are they're made up of
like they're just simple functions that
are pure and can be composed and once
you have those two properties you mash
things together and you can make
something bigger and you can rely on
that and that's when things get
interesting so this is just a little
side just like in the CSS shaders the
CSS drawing you you can start making
extra shapes people figure out how like
if I can if I can run a program at every
dot and I figure out how far each point
is from the center of the canvas and I
make it either black if it's further
away or red if it's closer to this point
then I have a circle and so you have a
simple thing for making a circle and
then that extends to other shapes simple
functions that generate a shape then
they can be combined because it's just a
function and you have things like the
minimum function I'll show you this guy
here here's an example they've got to
define a box which is one of those
previous functions and a cylinder and
then the minimum between from the
surface to whichever one is farthest
away gets drawn and they looks like they
intersect looks like there's the union
of the two and you can do the opposite
and get the intersection and then you
can start carving out shapes and then
you can become you can have more complex
shapes that are just made up of these
same small functions added together and
again it's the internet so people go
crazy this is from
a pc demo 64k it's a 64k demo but this
is just one tiny piece of it there's a
lot in there all made up of those
functions together composed and you're
making these scenes so crazy that's the
power of pure functions and
composability and that's what we need is
start that's what I'm really interested
in there's something at the moment that
okay let's let's get out from shaders
and 3d and things and we'll go back to
web dev a bit and apps there is a
technology that's become big now that is
kind of following these this idea of
composable pieces and in a functional
manner and that is react it's a
JavaScript library for building user
interfaces but it's I mean everyone when
they first had it's like oh not another
framework but this one I like this this
I love the core ideas of react which is
this idea of composers ability and pure
functions and now how is reactive pure
function will you make up your
components and whatever you want to get
because it has this one-way data flow
model to get anything into a component
it has to come from above a parent or be
part of its local state so there are two
ways that you can affect how something's
rendered in react which means it's a
function of its properties passed down
and its local state which is only
looking after itself to their virtual
Dom thing which then under the magic
under the hood gets turned into real Dom
which i think is not the interesting
part of react this is the interesting
part of react you get the benefits of
pure functions like being out a reason
about it and you know what Abdul
performance optimizations
all the good things that we come from
the shaders that come from pure
functions in case you haven't seen it
here's a terrible example I just quickly
wrote up but you'll have a component you
can pass in some properties and inside
the components you have the state so
then each your app becomes a composition
of these components and like I said it
isolates the state in the component and
then can be composed which is what i'm
talking about as being interesting whoo
so now finally talked about shaders and
you will guys were all like whoa those
shaders are really cool oh and then I
talked about reacting you're like yeah
react that's really cool now so
obviously at this point you're all
thinking come can't we have react and
shaders together well I've got some good
news introducing GL react this is a this
is a project that I've been working on
at us our super-secret startup it's a
little bit less super-secret now it's
called Project September I can say your
name we've been working for the last
five or so months on an application that
will be out in January it's all react
native and graph ql and fun stuff and
it's in the businesses in the fashion
social fashion something like that now
the problem with this is that it needs
to look I mean it's not a problem it's
an excellent problem if you're going to
release a fashion social app it has to
look really cool and it has to be really
interesting and has to get people
quickly you have a small time to try to
get somebody hooked on your app and go
and it's in that fashion is they're
fickle you know so
the design our designer she's really
good and she wanted a bunch of things
that just don't exist as designers one
and so we decided it was a good chance
to get the power of WebGL into a react
native app it seemed to make sense and
thanks to my good friend and co-worker
gate on Ronaldo who came over from Paris
one week and the first week he started
with us and turned out most of G or
react now he's made it all summer and
I'm presenting it GL react is the two
triangles I talked about before two
triangles make up a box the box is the
component so in react whatever you would
be rendering is these two triangles come
out because it's WebGL it's super fast
and you can do some interesting things
because it's react and because the way
we've written it it's very composable
and you can instead of having one off
little shaders that i was showing before
you have the ability to compose the
shaders in a react way and make complex
effects which you can then packaged
together as a new effect and use that
somewhere else and package that together
as a new effect and all those advantages
of composability can be yours what can
it do oh you ask he asks yes well it can
be its I said it's two triangles and
shader so it does have a can-do shade
it's just what I was showing before like
that is what it does it can draw two
triangles you can run a glsl program for
every pixel in those two triangles and
you can do fancy shader effects but
that's not why we built it we built it
because we needed it for making widgets
and making things that we couldn't do
in the UI alone and Dom so for example
we needed a way to Instagram afire
things we needed a way to rotate hues
and change text dynamically we needed to
draw things and now this one I like this
one because it's using is it going it's
using a where does he go he's not going
anyway it's a pie chart doesn't know it
looks at it's a pie loader it looks
better than that in real life there we
go now it's using that idea of drawing a
function where am I at this point am i
if the pixels here am I on or off that
kind of thing so it's using all the same
techniques that come from the crazy demo
scene world to draw a UI component it's
going to be in a fashion app that's kind
of cool I like that idea we've it can do
more advanced things here can't really
see it on here but it's like instant
tilt-shift with vignette effects and you
stuck and poison is very it's very
snazzy but where can you use it you
asking hey everywhere for Country and
Western iOS and Android and desktop so
it's it's a good library for doing some
cool things but just like react I think
the important things are not like what
fancy-pants things going to do is what
are the core principles behind it and
what I think is most interesting about
this and I've said it a million times
now is the composability aspect of it
being able to know that what you're
putting in is what you're going to get
out all the time and be able to take the
output put it as the input of something
else and make something bigger
where am I and it gets rid of all the
crappy with WebGL stuff which is really
nice because we're the WebGL stuff is is
horrible so today actually or maybe
tomorrow is the launch of GTL react
version to wait you know epic I didn't
even know Joey at version 1 now we are
first version of it was kind of a
prototype and now this version is much
more powerful and works as a react
component as a dumb as react native and
in the Dom it's hitting WebGL on the
browser and it's hitting we had to write
a bunch of objective-c in java for react
native so you guys didn't have to the
api is pretty simple and in fact it got
a little more complicated in version 2
to take advantage of this what I've been
banging on about those ability I'll
quickly show you how this is getting the
simplest shader you can into our GL
create shader which is exactly modeled
on the stylesheet create from react we
make a component which is a function
that will render out a GL node which is
the loss the part in the middle and the
GL mode is the effect itself the thing
that you want to do so here I'm saying
it's that hello GL effect and it can
take some extra things that I'll talk
about in a minute now the final part and
the reason that the API is like more
verbose on this end is because we split
out the surface now the surface is what
finally renders that so there's a
surface for react native and as a
surface for the DOM and the effect goes
in the middle what what's good about
that is that the effect in the middle is
now it doesn't care where it's running
at all and it remains exactly the same
everywhere and you can package it up and
put on MP
and anybody can use it in react native
or wherever react goes next and and it
will work like by magic go skip over
this one you can rasterize a bunch of
stuff like images and and other GL modes
so talk about a minute here's an example
with react canvas spitting out some
images and texts that get turned into
canvas which think you can run pixel
shaders over your fragment shaders over
ok finally my favorite thing is
composability this is why I think that
it's a really cool tool I start with a
dog with a garlic clove on its head and
over you make the before I showed the
create component and it spits back it
runs the GL mode and will affect
whatever the children are so here I've
made that just a plain old react
component which is the blur and it can
then be used with whatever you put in
the middle either a URL or another GL
node or or another GL component and then
you can combine them so then you make
another one is a humor Tate effect and
then our dogs gone blurry and funny
colored and then you can combine it with
a negative effect and then it's gone
blurry and you rotated and negative and
what's up word is then another effect
that you can have an effect called
blurry rotate negative thing and then
use that anywhere inside your inside
your own programs which is really cool
also because it works like react native
like react it lets us do some other
crazy things like the most impressive is
been utter share nodes we make a render
treat like an AST that is what needs to
be rendered then we can look at things
for referential transparency say that's
the same thing that's the same thing
they can be the same note and we can do
a bunch less processing in WebGL which
is really interesting and as I said then
you can just package them up as your
effect that you want run my affair
and anybody in the world can use them in
fact just today there's been six effects
pushed to mpm so you can start playing
with them today GL react negative and
contrast saturation and things like that
so we're hoping that this is going to
grow and people are going to start
adding really cool effects and the
beauty is that none of the power of glsl
is hidden from you if you want to get
your hands dirty and be the shader
coders competition next year then start
now it's a good good way to start
learning and if you don't want to see
glsl in your life then go to NPM and
find the affects other people are doing
and then you can just apply them to any
set of two triangles and your component
in your app lastly lastly lastly is
there's the GL react playground which
will show you your shader broken down
into into its render tree on right there
and all the pieces that will retreat
it's being processed so you can see
performance issues or how long things
are taking and what things look like at
each step then you can tweak it and you
can make really cool effects so there
you go composability is powerful try not
to mutate state if you can avoid it and
WebGL is going to be really cool for
making widgets thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>