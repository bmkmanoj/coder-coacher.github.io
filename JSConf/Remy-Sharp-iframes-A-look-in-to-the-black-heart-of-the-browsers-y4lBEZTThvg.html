<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Remy Sharp: iframes: A look in to the black heart of the browsers | Coder Coacher - Coaching Coders</title><meta content="Remy Sharp: iframes: A look in to the black heart of the browsers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Remy Sharp: iframes: A look in to the black heart of the browsers</b></h2><h5 class="post__date">2012-11-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/y4lBEZTThvg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah I wanted to give a talk about
something that isn't cool like html5 or
JavaScript I also realize talking about
an HTML element at javascript conference
is risky I didn't actually expect them
to where it might talk to even get
accepted so then I had to write
something about iframes but kind of in a
way I frames is all about JavaScript
like we hack the out of it and it
does magical things but Amon of fun comp
did actually call me out on this and I
realized that now I've got my hipster
badge properly achieved now so that's me
right okay so um oh I did that about 4am
last night right so the reason I'm
talking I frame is because I I built a
talk with Jay has been actually to like
help my colleagues instead of describing
in English what the problem was with
their bugs actually give me some code so
i could edit and so on so this is Jeff's
been in 2008 and this is jess been in
2010 and this is jay has been in 2012 so
now there is a lot of iframe action
going on inside a spin and I kind of
learned a lot not learned a lot like
I've been with my frames since
2000 something so i wanted to share some
of the things that I've done I wanted to
share some of the stories that people
have shared with me and it's just a kind
of share the nasty iframe hacks talk
that's that's what this talk is I'm not
only talking about any of the cool stuff
that's coming in browsers there is
actually a really good slide deck
they'll point to at the end of this this
is all about the old with busted ship
that we do so this is the the history of
the web all these beautiful lines and
here you can see in one 1996 framesets
and as uncool as framesets are the
reason why they're interested in
netscape to and and the reason they were
there is as far as i understand is that
the internet connections were pretty
crappy and they didn't want to reload
entire pages every time so they create
the frame set so that you can have a
static block across the top and a static
sidebar static footer a curve reload
like just the center block content lead
that the content part which sounds
awfully familiar right that sounds like
Ajax that we have you know today the
downside is how we you know screwed up
Ajax it's it doesn't link very well and
people were you know losing astral
navigation and so on so it's all being
deprecated and shouldn't really work but
it does work on an iphone for which I
was amazed it's completely I mean it's
not we haven't got position fixed
through hacking I for a frame sets but
it does actually work in brand new
browsers so old crappy busted technology
works in in ii browsers anyway so I
frames we got iframes in 1997 fire my
III I believe Scott Isaac I think a
Wikipedia page suggests that the eye is
from Isaac's and but I spoke to chris
wilson at microsoft and he said no
otherwise CSS would be CS s wilson
something they don't name that their
products after their themselves so it's
just I frames and the iframe was
deprecated in XHTML 1.1 so we're going
to lose iframes in you know HTML as we
know and love but IE being the amazing
amazing browser that it is didn't really
support the alternative so the object
element was supposed to be the
alternative to iframes and because I e7
 it up a little bit it had the rest
of the browser support with iframes and
we continue to have iframes today for
some of the crazy stuff that we're doing
with iframes so if anyone's written any
bookmarklets this is the kind of thing I
was writing so to inject my bookmarklet
into the page I was writing document dot
get element by tag name head and then
append child for some reason I by
thought I'd read like back in early 2000
this is because of them of framesets
because there's no body element here
right so if you try and inject into the
body it's not there and you're
you're bookmarklet would fail something
i came across just recently is that if
you do want to use frame set still and
as an iframe talk but if you want to use
like framesets document body which is in
IE 5 and above but document.body points
to the the frameset even though it's not
the body of them and so if you want to
write bookmarks or document up body you
can do that all right but ok this is
what really showed us that I frames are
really quite powerful if you if you
force them to do things they're not
supposed to do so comet exists or we
could we could make use of comet using
iframes and this is a early snippet well
it's a abstraction of a snippet
basically create the iframe point it to
a streaming server because of
progressive rendering and the browser
you could give it a script tag with an
executor scripts and you pass that data
about so you know prices for instance
live prices and now on the server of
course we can use node and we can create
these these active sessions and just
kind of push up data through the browser
alex russell coined the term comment in
2006 but the more you search on the web
you see examples of comet iframe hacks
going way back to 2000 which is it's
pretty impressive i think and probably
one of the best hacks inside of gmail at
the time in 2006 is there i don't know
if this is true but apparently google
brought up the last few i ii engine is
to solve this kind of you know the
clicking problem that you hear in IE
when you hit refresh it kind of gives a
click noise and because they were using
iframes that hidden away on the page to
basically keep the connection open get
the new email you'd have to reload the
iframe every now and then otherwise
memory would go like ape and you
had to kind of close a connection so
you'd hear this little like click click
click click and what the what the gmail
code had inside of it was an iframe gets
created then inside of that they put an
activex object the html5 the HTML file
acts of x object which is opened and
then an iframe is put inside of that the
went to the live stream of data and when
that reloads the that the ActiveX HTML
file thing doesn't it suppresses the
noise so they solve this with like
iframe activex by frame probably an
iframe somewhere else as well just to
you know keep the iframe stack going
that was pretty cool and bit barmy and
like who would know that so this is
these are my experiments with iframes
the public and 2007 I i needed to i was
working with a lot of other developers
and like polluting global scope is a bad
thing sort of anyway i need to work out
where the global where the variables are
being introduced and i came out of
basically using an iframe to detect
where the global variable to being
issues by comparing them against the
current global scope and KAG kagak
pronounced that perfection kills calm he
then took that a few years later and
kind of cleaned it up and fixed it and
made it better so the sum of the things
I'm going to talk about this this part
are partly iframe hacks that I've come
across and also kind of my experience of
J's bin and how i'm using iframes to
share with you guys and girls and so on
so probably I mean you may have heard of
this one already the this is not
obviously Jay has been the samsung s3
remote wipe you send someone an HTML
page with that but has that phone it
will just wipe their phone back to
factory settings and the clap is for the
engineers that let that one through this
isn't an HTML deck by the way it's a
screencast a gif and make a video and
put that in keynote so but there are a
few things like this where you can kind
of point them to appoint an iframe to
something and it will kind of somehow
work and there was a time in iOS the if
you wanted to play background music on
your web page which I know there's a lot
of you want to do that you could um it
could point the iframe to an mp3 or WAV
file and it would just play in the
background of the the iphone
pretty awesome they they did either fix
it or break it depending on that like
how much music you like in your web
pages but it doesn't work anymore
unfortunately so the iframes that I work
with are often like dynamic generator
you create an iframe you drop it into
the DOM and you start writing like HTML
into it or whatever you want to do but
though the way that you you right
through it is you need to get the window
object for that iframe but you can only
get it once it's inside the Dom so if
you don't put the iframe enter the Dom
the window for that iframe does not
exist so it's how you get it out this
will be some code where I'm injecting
some HTML basically this this awesome
HTML is my awesome HTML and this is
fundamentally what Jay has been does as
you type it just makes an iframe and
keeps kind of injecting your code as you
go along it's a kind of a not a quark
this is obvious when you think about it
but the load event doesn't fire on the
iframe until you close like do document
or close once you finish right to it and
the reason that's obvious is that when
you have a web page and it's taking a
long time to load like if it's if it
keeps the connection open the load event
doesn't doesn't fire because it's still
loading right so we've got the same
problem until we hit the clothes until
we call close the load event won't fire
so something to if you're listening for
when it's loaded to pull stuff out again
so you don't have the window object
until you put it into the Dom but
equally if you take the iframe out of
the Dom the the whole thing gets
destroyed and it again it kind of makes
sense like hitting clothes on the tab
you basically close that window entirely
but any javascript that was running has
been killed and when you put it back in
the Dom it'll just rerun everything as
if you judge just hit refresh basically
I include the slide I found this weird
bug which really doesn't apply to anyone
except for me but if you if you would
like some webkit browser and opera they
ignore the mime type on CSS basically
the point of this is that if you have an
iframe and
rendering if you do in kind of live
previews or rendering HTML into an
iframe it's not the exact same thing as
the full kind of web page and I frame is
very slightly different to the regular
kind of web view in a way like mobile
safari is different to web view for
instance so I want to talk about some of
the preview stuff I do enjoy a spin so
it Jasmine if you type it renders live
preview as you're coding so you changed
some CSS it will actually you know make
the change immediately which is we're in
this kind of like impatient era where
everything needs to be lives and real
time so achieving that takes a few kind
of little hacks and the first one was
iframes don't know half the browser's
the iframe doesn't know how wide it is
so if you have something like a canvas
that you want to do a full width so you
know the code run do you do canvas top
width equals window dot inner HTML in in
it with WebKit browsers and opera one of
the other browsers they don't know about
the width is zero until the next tick so
you know like process next a core set
timeout so on so I wrote this pretty
clever code that makes another iframe
set a call back and on the globe on my
window object and when the iframe runs
it calls that callback with the width of
the iframe and if it's zero it says
don't run the code so i have this bit
that says if there's an active delay
then do a set timeout 0 otherwise we're
on the code immediately and I say clever
code because actually it's complete
waste of time all I should have done is
set timeout run so that was the basic
meet but just trying to be too clever
for my own good and only realize that
whilst writing this this deck but if
you're doing anything where you actually
need to know the width you need to wait
until the next like render yeah so what
I do enjoy a spin to make sure that you
don't block so when you're typing if you
had an alert box as you type your code
it could just like bring up an alert box
an entirely block the UI you wouldn't be
able to continue typing with their pain
us so I actually put in the scripts just
at the top of everything just the top
before your code that just sets alert
confirm and prompt and maybe the print
box as well to like an empty function
basically like a no-op function and then
at the end of the the code actually
remove it so an alert box can run but it
won't run whilst you're typing so you
don't have this kind of interruption
oddly opera completely suppresses alerts
or any blocking like dialogue inside of
an iframe which also suggests that the
iframe is slightly different again to
the main window so I haven't really
bothered checking how how far different
is but it it's a different environment
basically i remove also focus when i'm
dropping into the iframe so I'm looking
at your HTML and I'm removing the
autofocus again because if you want if
you're typing away on one side you don't
want the cursor to suddenly jump to an
input element right and i spoke to
richard worth at the last year's conf in
the u.s. who was working on jquery UI
and as he was coding he would be using
like the the the jquery dialogue plugin
which would then grab focused so
anything that grabs focus anyone live
render is going to take you away from
your like your coding basically so i
cancel any focus events on the window
object inside of the iframe and you just
do that by doing window dot add event
listener or just on focus and then
cancel the event it means it'll focus
all the way through the iphone the
iframe but it won't force focus on the
kind of the the outer window da that the
window will work again basically I do
things like restoring scroll positions
because if you again you got like a long
page and your coding your re-rendering
iframes you want to get it at the same
point and so that that's kind of live
rendering these are these are other
tricks that we can use iframes and like
I said Kang Kang acts upgraded the
scripts you basically create an iframe
to detect Global's all it does is
compare all
global variables on the window element
compared to the iframe and the
difference is any newly introduced
global variable phonegap uses uses
iframes were called over users iframes
in iOS but the interesting but I was
talking to Brian last night if there's a
network request made whilst you have
input focus so you have the keyboard up
if there's a network request that's made
the keyboard will drop away but this
only happens in the webview not in
Safari like that the main browser which
may not be a problem except Chrome for
Android or Chrome for iOS is a webview
so this actually is happening to JSP lat
moment because as you type it's saving
and it's doing an xhr safe so you have
focus your typing some code and then the
keyboard just vanishes and then you tap
and it brings back and you type and it
vanishes because it's doing an xhr
request is doing a network request and
the way the phonegap the phonegap guys
solved this problem is you just wrap it
in an iframe of course right that will
solve every problem eventually you put
the network request inside of the iframe
keyboards laser random um I wanted in
J's bin to be able to point by in the
URL just do J's bin gist and the idea of
a gist and I wanted to suck the gist
into jo spin now either because i'm lazy
or because it didn't exist and it's
probably the former i couldn't i didn't
bother looking at the the proper api
that github provide and it's possible
that it wasn't there in the first place
but they do have a script in bed so you
can embed just onto your website and
equally like lanyard you can you can
embed like like this conference is doing
embedding the actual upcoming talks if
you put that in an iframe because
everything belongs in iframe you can
wait until it's loaded and then drop
into the iframe because it's all hidden
away and pull all of that content out
again but as an object or as an API so
you can create an eight
I if if a website provides a script
include that we're just kind of like
drop in a bunch of HTML if you put that
into an iframe wait for the iframe to
load you can traverse the Dom nodes that
are in there and pull them out as just
you know values as an object that
represents like the the upcoming talks
and you can present it in your own way
so basically creating third party a
crust mapi is out the potty script
embeds the only thing I have been told
to say is there's usually T's and C's
that require you kind of credit lanyard
for instance so just read those and
don't blame me if you get into trouble
cross-domain communication is kind of
the big bit that I frames good for I've
used this with the JS consoles like it's
just a full-screen console i could write
some JavaScript and I gain out of
laziness I was asked to debug an Android
app and I couldn't be bothered to read
the documentation for the SDK to work
out how console.log works so I changed
j/s console to have this remote feature
which just drop in a script tag into
your page and the console is able to
control the mobile phone and consulate
logs come out into the desktop but I did
that with a bunch of iframes and i think
is and maybe socket i/o use iframes as
like the last resort to assault on these
problems you have to bear with my
diagram here right so there's a video of
the remote working and but you have you
include this script that points to JS
consort calm and that creates a console
object and cover overrides the actual
one inside of your page but it create it
creates an iframe that points back to
jas console calm and then uses post
message and I'll message communicate in
and out of that that I frame and then
the iframe can then point back to Jess
console calm and communicate using Ajax
posts an event source the reason i jump
through all these hoops to do this is
because i wanted to be at a test us on
phones like Windows Phone or old Android
phones that don't have I think
don't have flash so I couldn't polyfill
web sockets for instance so I'm using a
combination of like I photo frames post
message and on message event source and
Ajax to get a message like basically web
sockets yeah one of the so with Jeff
spin again I wanted to be able to
support pointing a phone at the like the
URL that you're working on at the time
so you're writing some code I want to be
able to point that phone at that that
code and have it kind of live render and
it does that now but the way I first
looked at it is by wrapping in an iframe
and having the iframe keep an active
connection to the server and just sorry
the like the top-level window we then
just reload the iframe the whole time
and the first problem i encountered was
the viewport is ignored when our window
is in an iframe on phone so the text is
very small obviously didn't work as a
solution so I threw that way as a bug
but actually someone sent me a tweet
saying they use iframes around windows
on phones to be able to see the full
like view of a page so it's kind of a
bug or a feature depending on how you
look at it if you actually want to see
the full width of a page because you
don't want to have like a mobile version
stick it in my frame so the document dr.
main thing this is them this is what
allows like twitter com to talk to an
iframe the points to api doc twitter.com
for instance what they do is both on
just on both windows they just say
document on a domain equals twist calm
and at that point they have the same
origin rules allows them to dip inside
of each other call methods and so on so
that's kind of the the opener to cross
across two main not quite cross domain
but like between see nose basically to
be able to communicate between iframes
comets obviously the the for me at least
the most impressive thing has come out
why frames and I stole this from Alex
sextons talk we
Shh i have a link in the notes but
that's no good to you basically boils
down to this is kind of how calm it
would work if a dot-com is your website
and beer calm is your life server that
can stream data up you can then put an
iframe inside of be calm and send it
data and a calm at the bottom can talk
to a calm at the top basically if it's
on the same origin it can penetrate all
the way down and all the way back up
again which is kind of weird you can
have like Paul was talking about having
lots of nested I frames and but a calm
can point back to a dot-com at the top
level by just doing top dot course on
function give us some data that you need
to know your way through all of those
iframes you need together I actually
talked to them by name and to get
through I have some examples that i
might post out later to prove this and
this is a if you want to there's a weird
hack I don't understand why this works
but if you want to communicate with an
iframe and give it some data regardless
of whether it's on the same origin or
not if you do window dot name and give
it some data it'll the the iframe will
have accessed that so this works across
domain which I don't understand why I
think it might just be broken in every
browser see you you have an iframe
pointing to twitter com and if you
immediately do i frame go point to the
dom node and do dot name equals some
data like JSON string twitter com will
be at a read window lock name and it
will contain that data and also it's a
way of passing data to an iframe before
the actual load event fires so if it's
like a long lasting iframe you can you
can pass them date of the wind up name
it will have it up front basically we
have it before the Dom has loaded or
anything like that yeah weird
clickjacking obviously one of the
coolest things we got out of iframes
stick an iframe on top of a button
you've tweeted for me you poopin to
yourself but that's preventable in ie9
above and by above i mean everyone else
of course by just sending a header that
says you can
this unless you're on the same origin so
google com twitter com they all send
this header which means that if i put an
i frame around it it's not going to load
it just fails to load it throws an
exception and nothing happens at all so
this is probably one of the newer
interesting hacks that that I've seen
iframes being used for you can use it
this is a little tricky but you can use
it to have URLs that have unknown
unknown paths like Jo spin has like 80 /
ABC / 1 or 2 and so on you can have it
load your manifest using an iframe all
right so basically you have you have
your regular application okay this comes
from lanyard and Jake Archibald kind of
he mentions it in his douchebag talk I
talked to him a bit more detail and this
is this how it work so you have your
application chrome so Jo spin the the
user content is just a adjacent include
so the whole application is the the
chrome so if that could work offline all
I need is the URLs to work and the user
content to work so the root path is my
application chrome on any URL that isn't
on the root path so / ABC / 1 you
include an iframe the points to a very
light page maybe not actually the the
app but this very like page it has a
manifest inside of it and the manifest
points to your your your application
chrome so the assets the JavaScript and
the the HTML actually drives that chrome
that app and a manifest says fallback
anything on the the root path to the
root URL so this bit here says if i go
to Jasmine calm / ABC / 10 and I'm
offline it will serve up the web page
it's on this URL so any URL now works
and my content is coming back
and it means that I can I can basically
have support unknown URLs inside of J's
bin or this is what they're doing for
land use so if there's a an event that
isn't already in your in your cash and
you haven't got internet connection they
can still serve up the application
chrome basically it kind of works as
well I it would help season code and but
i'm not going to show you any code and
but in theory you should be ever using
like that same iframe technique to
basically keep a hot cache of like a
very large javascript library you can
have in a hidden iframe always available
and always being delivered to your main
application this is just the theory I do
one have a play but this is kind of the
the newest thing I've seen iframes being
used so the good parts just going to
mention them there's a really really
good slide deck that you can get quite a
bit information out just like looking at
the slides they talk about how they
implement iframes with discuss but
there's a postmessage anon message which
is it has some decent support ish
there's a seamless property which
basically gets rid of the border as far
as i can tell i think you're supposed to
be either use CSS to start all the way
into the the iframe saw stock means that
you can put HTML on an attribute of an
HTML tag which looks ugly as and
then we've got these sandbox properties
which stop jobs from running if we don't
want it if we untrusted domain so that's
my my kind of like brain fart on iframe
hacks the one big one I didn't include
actually is sandboxing so basically
creating a sandbox to create a like a
fresh perfectly clean version of an
array object d Neville's did a lot of
work on this while back but I wanted to
talk about some kind of the weird a bit
so that's me done I can't see a
thing
I</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>