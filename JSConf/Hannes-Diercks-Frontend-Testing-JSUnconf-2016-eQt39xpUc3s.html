<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hannes Diercks: Frontend Testing - JSUnconf 2016 | Coder Coacher - Coaching Coders</title><meta content="Hannes Diercks: Frontend Testing - JSUnconf 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Hannes Diercks: Frontend Testing - JSUnconf 2016</b></h2><h5 class="post__date">2016-06-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eQt39xpUc3s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah thank you very much
I'd like to start with a kind of
question because as I said I didn't
really prepare something and this would
be a live coding session and so I'd like
to know why what you're interested in
and I show you two projects of mine who
we can write tests for right now and one
is a note project is that that's a
helper for writing better commit
messages you see I sneak in some parts
of my part of my talk that has been
rejected I show you how that works so I
have a project here that's and add some
community it's big enough can you read
this ok I for the whole talk if you have
anything any ideas anything how to make
the think better if I should talk slower
or you just want to say something or see
an arrow i do just yell at me and feel
free to interrupt that would be nice so
I add the package Jason here and there's
a tool called committed sin and I can
say get it set and now here is proposing
types for for this commit so the package
Jason will probably show commit and
that's on the package and now i can
write something here I don't yeah I
don't know basically the note package is
a small tool that can help that's part
of this chain to write better commit
messages so in depth that's untested
right now and we could write notes unit
tests for that too the other thing is i
work at gym no
and we do have this UI library it looks
like this it's basically a long list of
how i can scroll somehow so a long list
of patterns that we can use in our you
is and I don't know if there's that's
not really a use case but a lack of a
better project to chest we could write
some entry and chest for this library so
basically we can switch from production
to better state and see marcos for
example and yeah we can basically use
selenium to click on that and Maggie
make some screenshots so that these are
the two projects i propose and now by a
sign of hand who would like to see you
know chest 44 no project okay and enter
and test for for another okay we do nain
test i can close this
I reset this commit so i won't go into
the details of setting up this stuff
because i use not that fancy new
technology i will use Night Watch which
is kind of a yeah and then not a hipster
just new project that came up but some
some good software that in my opinion is
stable and I won't be really opinionated
about what to use for for that stuff but
instead I'd like to show you the
concepts that I think you can apply on
other frameworks like protractor or some
new newer stuff so I worked a lot with
projector for angular halves and s you
might hurt all angular apps are now
dying and we skip to react and stuff so
a protractor is not that really think so
let's go to Night Watch
I prepared what i did is i installed
Night Watch npm install Night Watch you
can get it and installed a selenium
helper that is called webdriver manager
and that can help me to set up a
selenium server locally here we go
selenium service up and running so what
we now can do is start the demo app I
think I killed the summer so yeah that
might take a little while and then
Night Watch is testing something
I'm not really sure but because the
screen is so small maybe we can we will
run into issues because of that but we
will see no actually okay my first chest
I prepared is passing so everything is
fine here's what I did we have a Night
Watch Jason oh that's a wrong project
one moment we take this one he's a Night
Watch Jason basically this is just cargo
coding from the Night Watch home page
interesting is that we connect to a
selenium here so we started a selenium
server and that's running on my local
machine here on port 44 44 and here
we're saying Night Watch to connect to
you this that could be also some cloud
service like sauce labs or browser stack
or something anything that can that
provides a selenium API and we are
saying hey we want to use a chrome and
the rest of this fire is pretty much
just cargo coding setup here's my first
test so basically what we're doing is
we're assigning the browser to weigh
more than you know can show us so every
600 to 800 800 600
then we want to test something so let's
test the production check what we first
need to do we tell the client to go on
this website so that's exactly the one
that I showed you here running on my
local machine could be anywhere I could
run this test against a production side
icon could run it against Google or
whatever and then I'm just asserting
that there is an element with this CSS
selector on the page it's a UI check
that's active and I want to ensure that
this is production so basically this
would be a chest to ensure that we see
this state when we land on this page it
could be that some person things that
would good would be good to it we have
the beta enabled by default and then
this check this chest would fail so if
we say we would like to have the beta
enabled by default and run the test
again I can watch it here yeah and now
it says hey the element was this
selector contains the text beta that was
our assertion but we got production so
something is wrong
it will but we actually want to have it
to be production and now let's change
that lets say hey what happens if we do
this we land on the page we click this
button and then we click this button now
we want to have one to ensure that the
beta button as a active it's simple as
that we say click here now we should
have a state where where there is no
active check and then we click on the
other
check when I'm searching for a selector
that we can actually click on you I take
better looks promising
and now we assert that this is Vita and
in case you wonder I have a palace here
just to have a chance to see the stage
before the browser quits if we would run
that in CI or some headless draw that is
pretty much useless so we can skip that
but right now it's kind of interesting
to see the state that we are after
having menu eadha manually clicked not
manually click I rerun this and that
word so these are our two assertions
then we have production better and
everything is fine I think you get the
idea you can basically go crazy with
this and we could yeah normally on the
left side here would be a navigation we
could check if the navigation works so
we see the exact pattern that we
navigated to we can check the context
switch that we have here but i think
that would be repetitive so let's dig a
little bit into a regression visual
regression stuff what we just recently
did is to use exactly this tool to do
then screenshots of this page so what we
can do is say hey please screen shot
here and i think i have to it's safe
screenshot and i have to say beta
something like that I don't actually
know if this works that's chick
you
doesn't look like it and so them oh here
it is nice we have a screenshot so and
we could now take this screenshot and
run some image analysis against it and
compared with another to ensure that we
made made few years ago and say hey we
want to have want to ensure that there's
no difference between this and that
there are tools that do all that out of
the box like phantom CSS and webdriver
io problem is right now I feel that both
of these projects are kind of not that
stable State so that's why we used Night
Watch but i highly recommend to to check
for pro for projects that do all that
out of the box before you try to to make
come up with some solution for your own
m so what's the time that was just a 50
minutes ok what we do now any ideas
that's a really good question I kind of
hope that we just came into a situation
where that happened and then I forgot
about that thing so there are a
synchronous things so maybe the web page
will load some scripts after user
clicked on a specific pattern or maybe
you have a really big JavaScript app
that just takes some time to calculate a
state or whatever one thing I really
loved about protector is that protractor
can hook into angular and kind of asks
angular if there is a state that that is
stable so you can if you know a little
bit of the insides of angular angular
has this digest loops so basically
whenever I click on a button angular
just runs and waits for state where
there's no change and with protractor
these angular can tell hey I have a
state where where I don't expect any
changes and now you can make assertions
um so and basically if you happen to
work on an angular app i highly
recommend to use project over because
you normally don't need to think about
that but let's just assume we are not a
name on an angular app and we have some
asynchronous stuff here so as you see
when I read out that page maybe can
throttle that a bit
there's this loading screen and if I
happen to make assertions by this
loading screen is active normally what
what selenium will say hey and this
button that you try to click on it's not
visible to me right now so right now if
I click here nothing will happen because
the button is not there and therefore
mostly all so there's not not a nice
what Night Watch specific thing most
yeah most implementations for selenium
do have such things I'm it's a wait for
state so I could say hey um I know that
when I go to this URL there's some kind
of loading overlay or some asynchronous
stuff and I could say hey let's wait
until this loading overlay is not
present I'm not visible would be another
thing so the the difference between
presence and visibility is basically an
element could be on the page so the dumb
notice on the page but it's on this
plane on or hidden between after another
element or something and in that case it
wouldn't be visible and if that dumb
mode simply doesn't exist it isn't
present so let's try to figure out how
that loading overlay
if I just had watched the war and the
talk about service workers yesterday
it's just this loading class on the body
so there was actually this one that was
correct let's check if that works nope
so he expected a second parameter on
that I think it's a timeout
okay yeah and that's not actually what
we wanted but it's traits the the issue
here because now we're getting an error
that we timed out while waiting for the
element loading to be present and we
expected it to become not visible but it
wasn't actually found so we need to
ensure that this element where the
selector loading is not present after we
go to this website and wait for five
seconds for at most five seconds okay
here we go element loading was not
present after 33 milliseconds and then
all the rest of our sessions were okay
that's a bit tricky because yes you can
do that but maybe if you any made an
element in the view and you say hey wait
for this element to be to become visible
it will be visible when it just enters
the view a little bit so I know how
angular is solving that and I don't know
if I assume that other animation
frameworks have another approach so I
think if you have I guess jquery can do
that too that you just manually inject
the JavaScript into the page that sets
all animations 20 so it just happened
instantaneously that's the magic one of
the testing magic behind angular animate
and I think other animation framework
can support something simular so the
ideas that you just disable animations
for inch and tests and what I just did
in a case where I wasn't able to do that
is work with palaces but that's not
elegant so we checked what is the
longest animation that we can expect and
then when there was a state that we know
here an animation is happening here we
just waited for 500 milliseconds but I
see that this is not a good nada not an
elegant solution but it works for all in
our case so
no sorry the question was if I had
problems with scroll events not really
ran into problems why not try to scroll
in phantom ge'ez because that kind of
don't support scroll events but I
haven't dicked into that so we just
didn't use phantom j/s then I think it
would be possible somehow that we used
native products or Firefox and Chrome
for most parts and there the scrolling
was we had no problems did you have any
problems concretely or okay
okay so the problem was with phantom Jas
yeah I can relate to that but I haven't
I don't have a good solution for that
should we just continue with some
questions or should any thing in that
you want to see or I can show you the
the visual regression stuff we did but
as a disclaimer we didn't actually test
it so right now that's just a tool that
produces screenshots and we are in the
process of using that screenshots to to
actually test that against in other
states so basically it's just what you
just saw we are going on a page like
this and clicking around two to produce
a state that we want to test and then we
make a screenshot of that and the next
step would offer used to be be to have
some kind of image dipping 20 to say hey
we have a change and we don't have a
change and the big question that is most
of the parts not really solved in my
opinion is how to say how to to come up
with a state that we want to test
against with so it's kind of easy to
make a screenshot of a page but how do
what's the state that we compared
against so well if this runs on a Cir I
have a pull request test that makes
automated three shots what is the state
that we want to achieve here I do a pull
request because I want to change
something and when the two were just
said maybe it fails because it's
hey the button that you just changed its
now no red instead of green maybe that's
exactly what I wanted to have so the big
question is how how do do we create the
input for the test so what's this date
so when we are in a great point with
lesson two young two of them the contest
no sorry
this
okay so what was it anyway Galen yeah so
there was just a comment about the Galen
framework and I haven't had it looked at
it but that what maybe that maybe in
framework to solve exactly the issue
that I just said and I have ideas on
that and would like to talk about that
but these are not in this presentable
state I think</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>