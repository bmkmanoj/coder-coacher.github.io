<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Eiji Kitamura: Making The Mobile Website Faster - JSConf.Asia 2013 | Coder Coacher - Coaching Coders</title><meta content="Eiji Kitamura: Making The Mobile Website Faster - JSConf.Asia 2013 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Eiji Kitamura: Making The Mobile Website Faster - JSConf.Asia 2013</b></h2><h5 class="post__date">2013-12-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Ntjo00m-Be8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">before I start I would like to offer my
condolences for the people who are
suffered from the typhoon Yolanda my
sincere sympathy for the numerous people
who are effected affected by the
disaster okay my name is AG Tamra as he
explained I'm a developer i will get
working at Google mainly focusing on
chrome and open open web stuff and I'm
based in Tokyo in Japan and yeah I'm
working on various things that's
happening in the browser front end okay
so today I'm going to talk about how to
make the mobile web faster so how many
people in this room have actually had a
mobile phone everyone right everyone
right so um where do you use your use
your phone I'm sure you use it at home
right in office and maybe sheer and
while you are walking and maybe in the
toilet something that's unusual for
people who are living outside of Japan
is that we can actually use the phones
in the subways right I mean subway not
observe patience but on the train in
between the stations which is moving
right so Japanese mobile phone carriers
enabled the mobile base station
underground so we can use data
connectivity in between the stations and
we can still surf the web using the
mobile phones isn't this amazing so it's
like like I have one hour commute from
my home to the office and half of my
communities like on train and it has
data connectivity all the time one
hundred percent but I still have a
problem because
when the train is moving even if we have
data connectivity it's not very very
stable and sometimes it gets flaky or
sluggish so is it's a destiny for you
know you know the mobile devices
comparing to desktop there on the mobile
phone the data connectivity is very
flaky so what can we do as a developer
to solve that kind of problem so
comparing to desktop the mobile phone
has a very thin connectivity that data
amount of data needs to be loaded to the
mobile phone next time so as a developer
we can build a website that's the
optimized for mobile website that's what
I'm going to talk about today so I'd
like to show you some techniques how to
optimize and increase performance of
your mobile website today so I've been
working closely with a team that's
dedicated to the website performance as
well as team that's working on the
google mobile search in japan and also
external developers who are working on
performance
so one second do you think one second is
long or short it depends on people right
some people say long and some people say
short it depends on the context how
about 100 millisecond is it long or
short so let me show you something I'm
going to show you a spinning chrome icon
to spinning chrome icons that shows up
for 1000 millisecond and the other one
is nine nine hundred millisecond and
let's compare which is longer which is
longer let me try once again this and
this which is longer
did you get it actually to be honest I
did a little cheat here so the icon on
the left hand side said it's 1000 meter
second but it actually showed that nine
hundred millisecond and the other one on
the right hand side it showed up one
southern Michigan although the Texas
says it's a nine hundred millisecond so
it's really difficult to tell the
difference of the 100 millisecond right
so it's very very difficult to tell the
difference but what is a point to
optimize the website to eliminate that
one hundred millisecond this is a report
from our research team at Google a few
years back this shows how small delays
affect humans behavior so in this
research we have picked up random number
of people users and we inserted
arbitrary delay between page load times
and for a few weeks don't worry too much
about the which part we inserted the
delay but the important thing is that it
actually caused users behavior by
inserting that delay for example if you
look at the role from second from the
bottom it is inserting four hundred
millisecond delay and for six weeks
after that the users with that delay
decrease the number of searches by zero
point fifty-nine percent how about 100
millisecond we we were not quite able to
detect the difference right so second
from the top says that a delay with a
100 millisecond and for four weeks and
you know surprisingly people did 0.2
percent less searches comparing to the
without the delay this mean that you
actually know the difference
unconsciously even you don't detect the
difference by you know by brain that it
you know the difference so you react to
the delay so it makes sense to optimize
your website much much faster it you
know even slightly so now we have a
reason to optimize your website how can
we make the mobile website web site
faster than now before God with before
we go deep dive deep into the concrete
techniques I'd like to review some basic
stuff first thing is cash so let me
bring up Jess conf website sure
what you are looking at is a chrome
devtools open up on the right hand side
and by clicking on the network tab you
will see all the list of resources that
are loaded to this website by looking at
the column called status you will see
numbers of HTTP response and if you see
200 that mean that the server is
responding with full content but if you
rewrote the page
and if the cash is available you should
see some responses with three or four
which means that Sabah responded with
that okay you brother how to cash so you
can use that cash instead of the
response i'm going to give right so the
the interaction between server and
browser is much faster and sometimes you
will see response with 200 with great
text this means that browser knows that
okay i don't even have to ask the
Thurber that I need if I i if i should
use cash or not rather know that i can
use this cash so there's no interaction
between browser and server for that case
if you are not sure you can just look
into the by clicking on the resource you
and look at the server header you will
see the response header with cash
control or etag last modified these are
indication of that the rubber is
responding with good indication cash I'm
not going deep about this thing but
please make sure that you have cash
enabled and also it's important to
enable compression there are
surprisingly a lot of side that doesn't
have a compression enabled so make sure
that your response header have content
and coding gzip or something like that
that's you know done by web server so
that the amount of size of the content
will be compressed and transferred to
the browser
ok now we we have the very basic stuff
right from here on I'm going a little
deeper how to optimize your site this
figure is actually taken from a website
called HTTP archive org the number is
tracked by throwing Alexa top 1 million
sites on the Internet this one shows the
breakdown of components website
component sites by content type as you
can see there are script style sheets
flash HTML images and other others and
as you can see the significant
significant part of this graph is images
more than half this means that if you
could optimize images and reduce its
size you win
so how can we optimize image sizes one
way in one way you can do is to shrink
or compress father as much as possible
but we are already using formats like
jpeg gifts and pins right we're already
compressed can we converse father
actually you may be able to do so what
I'm going to demo here is to show you to
use a tool called image of team let me
show you image of them it's free tool
you can download from internet and I'm
going to pick up one image from jess
conf website and see let me see how how
far it can shrink the size
so okay i'm going to use this image
I don't know where this image is used
but it's on the website so let me find
my finder wow they're so wonder if I can
drag and drop this image onto there you
go so we now have this image and type
size up
size of this image is now 387 kilobytes
then what I'm going to do is to use this
tool by drag and drop and see how small
it can get
so it takes a little while is it working
yeah it should be working so
so
now it should be you should have reduced
its size it saved 56.4 percent so far
let me see
it takes too long anyway this image
could reduce the size significant we
write so its original size was 387
kilowatt but it's now go down to about
like 170 kilobytes it's significant
right I think this image particular
image is quite extreme example if you
pick other images it only reduces like
five percent our six percent but
actually you have room to optimize your
image so this is please check your other
images on your website if it has more
rooms to optimize or compress right so
that's image optimization and actually
there are a bunch of tools that's
available on the web and one of my click
adios money has put together nice very
nice web blog not have a list of those
kind of tools that optimize automate
sorry optimizes the images so please
have a look on read on his blog when you
have time and the next thing is web p
where p is a new image format that
google is pushing forward which could be
la ca lossless transparent and you made
it or can have a color profile and
metadata so and it's it offers amazing
compression rate you will surprise so
let me demo this one as well
I'm going to use a tool called X and
calm Bart
and let me pick other image maybe
something like this
ok
so where's it
so now we have an image with size of 100
study in kilobytes and what I'm going to
do is 0 is to heart this image into
weapon
so the format output format is where p
and settings as I just leave it as
default eighty percent of quality and
convert boom now you have web p image
and let me just drag and drop this onto
the browser so you can see how it looks
so this is image web be down this
wealthy and this is jpg do you see
difference not so much right just a
little bit but not not significant and
the look at the sides the original image
was 113 kilobyte and web p is actually
37 kill white it's surprisingly small so
happy we are pushing web be forward but
it's not perfect yet
so unfortunately web p is only supported
on browser chrome right now so if you
want to make web be working on other
browsers you need work around yeah it's
important peoples you know encouragement
other browsers to support it you know so
if you want to work around on other
browsers I will suggest three methods
one is to use a feature detection on
JavaScript so for example if you use
modernizer the library called modernizer
you can detect that if web piece
available or not so if web p is not
available you can request a image with
other extension not like jpeg or pink
PMG the second walk around is to use
accept header it's sent by prom so the
sub 0 should receive encoding head
content encoding header with authoring
accept header with web p indicating
repeat so cyber knows that if the user
sorry the user agent the browser has
availability to display web p image so
fabrikam decide if it should serve web p
image or not answered suggestion is to
use polyfill there is a polyfill called
web pjs so you can you just fiber just
sense where p image to the browser and
the browser use the web pgs library to
convert that image into something
different that's affordable for the
browser if not available so you have
work wrong but it's a very good idea to
use web p please consider using it so
other techniques to reduce image sizes
is to use inline images and spriting
spriting image is technique to you i'm
sure that everyone here knows about this
technique but this is a idea to combine
multiple image it into one
single image and optimize the connection
to the father for that you know brother
only makes one connection to the server
and download multiple images and
exposing that part each part of image by
using CSS it will reduce you know about
the overhead this technique is quite
good for small and repeatedly repeatedly
used images and the aligning image is
actually in line the image as a text
into that HTML so you can actually
convert binary into a string called data
URL by inserting that data URL into HTML
you can help single connection to the
server and download both HTML image if
you embed multiple images as a data tech
data URL you will have everything with
one single data connection but you have
to keep in mind that converting binary
image into data URL will bloat by thirty
percent so data URL we have thirty
percent more side than original one so
you have to watch that and use it with
care this is suitable for image that not
repeatedly use or large ones okay now
you have all images that's optimization
optimized as possible as we can what
else can we do so we have text HTML CSS
JavaScript
well idea to optimize loading up txt
file is to come by or concatenate
multiple files this is very common idea
right so JavaScript for example you can
just simply concatenate multiple files
into one file and load it to the HTML so
it will be single connection to the sour
the next idea is to minify HTML CSS and
JavaScript in the example you are
looking at on the slide is actually the
CSS so you can remove spaces and returns
and can compress that into a one single
string that's very simple but for in
some cases for example JavaScript
sometimes some tools does changing the
name of a variable with keeping the
semantics so it could be much much more
small so you shouldn't do that manually
of course so you should use tool there
are a bunch of tools available on the
internet free tools like your yui
compressor project compiler CSS Minn dot
J's and so on you know it and once to
that i'm particularly like is unsee SS
on CSS is a tool that detects the unused
files from the CSS by crawling through
all the HTML and find the unused style
and remove that this is particularly you
use particularly convenient for when you
are using like bootstrap or jQuery UI
you know you have a bunch of assets
that's not used that you are not using
right
for concatenation and minification and
so on it's it's a good idea to use grunt
because you don't want to run those kind
of small tax tasks every time you finish
the development or try to test so you
have a very good tool called grant so
that you can automate that kind of
workflow it's a good idea to use grant
if you don't know about grant please
check out our grand chase com alright
how many times do I have unlost okay
alright so by the way I'm knowing how
brother connects to the server is quite
important especially when you're trying
to find the point of optimization so
this figure is showing the approximate
timing how connection is established and
each process is distributed on 3g mobile
network so for example when the browser
tries to connect or fetch content from
saba first thing it does is to DNS
lookup it looks for the domain and
extract the IP address right dns lookup
that takes to 200 millisecond then the
browser try to connect with TCP
connection that takes also 200
millisecond and sard a browser sends HTP
request and receive a cheapy response
that takes another 200 millisecond then
the browser receives the data content
that takes 200 millisecond and finally
finally the browser takes 200
millisecond to render the content so if
you are on 3g network it's it takes at
least one second to load everything
so you cannot do do anything about about
you know the first three portion DNS
lookup TCP connection and HTTP requests
on response but we do want to optimize
more right what can we but what else can
we do so one idea is to eliminate
redirection so if you're serving mobile
specific version of your website that
means that you have desktop version as
well as mobile version so when your
website goes social media the URL has
one canonical URL ideally that means
that if you have different URLs for
desktop and mobile the URL be redirected
to mobile version if the user is
accessing accessing from mobile device
right so it needs redirection and it
takes 0.6 seconds 600 milliseconds at
least to redirect so it's time consuming
right so if we could we should remove
that redirect what can we do to
eliminate that redirection so one idea
is to do make the website responsive so
that one serving one HTML to support all
the devices that user is accessing from
and the second idea is to use certified
branching which mean that visas the
important thing that that's keeping the
URL the same so depending on the user
agent server if the server could serve
different HTML depending on the user
agent I'll be a good idea in that case
you have to keep in mind that adding
vary header on HTTP header very that
tells excuse me that tells the search
engine troller that this URL resource
may vary depending on something in this
case user agent so if you are serving
something that's varies depending on
user agent you should add vary header to
the HTTP response and the final idea is
to use a a width attribute called ping
this is a particular use case is
sometimes you want to track which link
user clicked so you insert the
redirection page in between the next
page and original page you just want to
track the user but you insert the
redirection page I think it's is it's
not very good like when I'm looking at
Facebook that has a redirection page and
it takes sometimes more than once again
it's not good right but if you are add
pink attribute it will send it to
external connections one is to the next
webpage one is to ping the URL so that
the browser goes forward to the next
page as we are pinging the URL to let
the server know that which link the user
has clicked this is actually use
on the google mobile search if you have
to react yurius use google chrome and
check out the source code ok and DNS is
something we can optimize too so if
you're like we we have seen in the
previous slide that if you make a
connection to the server the first thing
it does is to resolve the DNS but it's
it takes two hundred millisecond if we
could eliminate that we save 200
milliseconds each connection what we can
do is to add link tag with rel ecole
equals DNS prefetch that way as you can
see on the figure on that slide the DNS
lookup happens before the actual
connection this is very useful so DNS
will be cached on the browser right this
is useful not only for a single page but
also the pages that i have a multiple
you know next page I mean next page so
if you could predict predict the DNS
that's just pop up on under at the next
web page if you could resolve that DNS
in advance you will save 200
milliseconds so it's a good idea to add
this DNA DNS professed sing ok so we've
been improving size and connection
numbers for images HTML CSS JavaScript
what else can we do so one more thing we
can improve is a process some perception
of users
here's an example a website that i'm
going to show you
so what you are looking at is a demo
website that blocks the rendering so you
have a the second block it stopped right
now it's loading the advertisement and
it stopped do you know why because
browser try to render the web page from
top to the bottom by reading the HTML
and if the browser finds a script link
its try to load download the resource
and execute that JavaScript meanwhile
the rendering is stopped it's blocked so
it's not a good idea to insert a
javascript in the middle of HTML I mean
the body so what you should do is to
move the script tag to the bottom of
HTML if possible or or add async
attribute which which enables browser to
load that script while the browser is
doing them rendering and as soon as the
browser finished loading that script it
executes that's async attribute and the
fire attribute in every browser to wait
for the script to 2x cute until until
the browser finish rendering meanwhile
the script is loaded so it's a good idea
to use these two attributes a sink and
defer if you care about the order order
javascript execution you should use
default if you don't use async so mind
about the JavaScript blocking
and it's also important to prioritize
the visible content so if the user is
browsing your website all they care
about is the thing that you see at the
first glance so we call the region on
the webpage that's available on the
first glance above the fold so we should
try to prioritize that by aligning
important portion of CSS which means CSS
particular part of visible part above
the fold in aligning by aligning that it
should be prioritized and you can see
that HTML rendered as soon as possible
if not you can just defer that to the to
the later right and also it's a good
idea to to consider about the timing of
the image load there's no point loading
all the image of long long content you
know the user won't see image at the
bottom of web page so you can load that
images later so that's called image lazy
image loading there are a bunch of tools
that enables the that kind of feature so
you should keep in mind that the users
per shift per section all right so
Speedy's experience so we've been
walking through many aspects or
optimization of a website I think most
of our techniques i have introduced can
be applied to not only for mobile but
also for desktop and but it's kind of
tough to check all the things that we've
been walking what works through so
actually we have a very good tool for
you to
easily check the optimization condition
of your I mean how well you are doing on
your website which is called PageSpeed
inside by going to PageSpeed inside
website you can just input your
website's URL URL and see the score of
it so 100 is a perfect and the ulc then
score how well you are doing and this
tool PageSpeed inside gives also gives
you a concrete ideas how you can further
optimize your website which I have
introduced you to you today so please
use a page speed inside if you are
curious and also there's a tool called
web page test web based web page test
org is a allows you to analyse the
website more detailed than web page page
page speeding inside and from multiple
locations around the globe using real
browsers and real condiment connection
speed it's quite useful when you're
analyzed when you want to another the
website more in detail actually this web
page test thing is actually open source
so if you are interested you can just
fork it and build your own version of
web page test and maybe continuously
watch the performance of you over your
website over time and here the spoiler
so we have a tool called mod PageSpeed
which actually does most of things that
I have explained today just by
installing mod PageSpeed on to your web
server it automatically automatically do
everything that's possible to optimize
your website
so but you know I have expanded
everything that many things that today
it's still useful because you know what
the mod PageSpeed will do and if you
have any trouble you will see which
portion of the module of mod PageSpeed
has something wrong or whatever you know
or the best thing you could do is to
just do that optimization by yourself of
course because you know if you use these
kind of tools that uses its resource
cyber resource so if you could do by
yourself that's the best thing okay so
with that so I've been walking through
many aspects of website optimization but
hopefully that helps your website web
development with that thank you for your
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>