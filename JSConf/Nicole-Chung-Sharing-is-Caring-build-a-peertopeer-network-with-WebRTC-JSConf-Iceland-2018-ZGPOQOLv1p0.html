<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Nicole Chung: Sharing is Caring: build a peer-to-peer network with WebRTC | JSConf Iceland 2018 | Coder Coacher - Coaching Coders</title><meta content="Nicole Chung: Sharing is Caring: build a peer-to-peer network with WebRTC | JSConf Iceland 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Nicole Chung: Sharing is Caring: build a peer-to-peer network with WebRTC | JSConf Iceland 2018</b></h2><h5 class="post__date">2018-04-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZGPOQOLv1p0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi can everyone hear me yeah okay cool
today I'm gonna be talking about sharing
is caring and in particular how you can
use our browsers to share with other
browsers using a technology called web
RTC RT C stands for real-time
communication and it could be real-time
communication of audio video and other
kinds of files a few things I want to
cover today are a bit of the contrast of
what we do in our day to day work for me
most of the time I'm writing code for
the client or I'm writing code for a
server so I'm used to writing code that
involves sending out requests and
getting back responses from a server
some other people might be used to
writing code like WebSocket code which
is bi-directional communication between
a server and a browser where a server
can actually push information over to a
browser so this is makes up most of the
websites we use so why do we really need
something like WebRTC well the thing is
once upon a time a long time ago it used
to take a really long time to download
files it would take a really really long
time to download a song and then so we
people came up with peer-to-peer
technologies that allowed people to
share files quickly and easily so if I
had part of a song and someone had a
part of the same song we can sort of
share those parts and then that would
just result in a faster download we sort
of forgot about that
when stuff like YouTube came up and our
internet connections got faster and
servers became way more efficient but
right now the thing is out of our
Internet traffic 70 percent of that is
now streaming video so it's gonna become
an issue when we start having millions
and millions of people watching the same
episode of Game of Thrones or trying to
download the same file so there are new
companies coming out such as pear 5
which are using WebRTC technologies in
order to help people share and download
those files faster it helps people
stream video at better quality if they
happen to be in Australia but the server
for that video happens to be in London
Technologies like pr5 will enable that
person to watch that video as if it's a
seamless experience another use of what
RTC is web torrent web torrent works
with the BitTorrent protocol in order to
help you stream video files right into
your browser so instead of you having to
use something like transmission or
utorrent or any sort of BitTorrent
client you can just go to like a really
beautiful web page and watch that file
people kind of worry about bit torrents
they kind of associated with privacy but
it's actually possible now like inter
Ledger's doing demos where you can like
actually have micro payments associated
to a bit torrent download you can attach
metadata to an mp3 or a video file and
people can pay as they're streaming and
downloading your file even though it's
peer-to-peer so back to the whole
WebSockets thing we when we do
WebSockets
it's almost stuff like push
notifications and it sends little bits
of data in order web RTC doesn't care
about dropping packets it just sends
everything in a big big stream so it's a
big stream of video it's a big stream of
data for online game you're playing if
you lose a packet that's not the
important part the important part is
that you get most of the data you need
at the right time so again back to peer
to peer web mercy see the browser
support is getting better and better it
used to just be for Chrome and Firefox
but now it's also for edge and Safari
most of the time it's recommended that
use a shim called adapter Jas to account
for slightly different names or naming
in the API between browsers one thing
I'm going to spend a lot of time on is
how to connect the pairs so the thing
with WebRTC is that browsers and
computers are very good at sharing data
but they're not very good about caring
meaning they're not very good about
caring about each other or finding each
other so in order to connect to pairs we
have to talk about a lot of technical
terms I'm going to touch on really
quickly such as SDP
offers answers IP addresses ports
routers firewalls ice the interactive
connectivity establishment different
kinds of ice servers such as stun
session traversal utilities for not turn
traversal relay using that and then I'm
just going to very quickly touch on the
data channel which is available through
an rtcpeerconnection the data channel is
what allows us to share data with each
other so the first part making a
connection we take making a connection
for granted most of us we have eyes we
have ears if we see another person on
the street it's very easy for us to
connect with another person we just
start talking to them they can hear us
they start talking back and we've made a
connection
however for computers it's not that easy
computers don't know how to find other
computers computers are pretty familiar
with finding websites you just tell a
computer to go to a certain domain and
that domain is associated with an IP
address and a port and that way the
computer can find the website so that
kind of thing your computer is pretty
comfortable with but there's things that
the computer doesn't even know about its
own self your computer doesn't even know
its own IP address which we're going to
talk about in a bit so I lied a bit at
the beginning WebRTC is peer-to-peer but
you actually need servers to help
connect those peers those servers don't
need to know anything about your peers
and they don't need to store any data
that those peers are exchanging with you
we cheat the other yeah but they need
those servers help make a connection so
an example here we need to do a lot of
this thing called signaling so at the
beginning of the connection the two
pairs do a lot of signaling and then
once the signaling is done and they're
connected it's almost like the signaling
server can follow away
so signaling starts off with this thing
called a session description protocol
this is the almost the equivalent of
like just finding out if anyone's out
there so a computer needs to find out if
another computers out there they make up
a session description protocol and send
it out so this is sent out in the form
of an offer the offer goes through the
router through the signaling server and
then reaches the other pair the pair
accepts the remote offer and then they
store it as a remote description once
they've done that they create another
part SDP called an answer and then that
answer is sent out on the network and it
goes through the signaling server and it
goes back to the other pair so the pair
accepts the remote answer and sets it as
the remote description however at this
point we've sent offer we sent an answer
but a connection between the two pairs
haven't been made yet so all they know
at this point is that someone is sending
out an offer someone's ready to accept
that offer they want to make a
connection but they still don't know how
to make the connection and they make
this connection by doing something we
call exchanging ice candidates so this
is a little complicated I'm going to
start at the beginning so basically the
computer knows that there's someone else
out there that they want to connect with
but they don't actually know where that
other computer is and in fact like I
mentioned the computer doesn't even know
where they are computers connect to
other computers by this thing called IP
addresses imports but because of our
routers we only know our private IP when
we're on a home network to connect with
another pair we need to know our public
IP and we also need to know the peers
public IP and this whole thing about
only nosing your private IP is something
called NAT which is basically a
technical term for hiding your address
from you the other thing we have to
worry about in order in other in
addition to this thing called NAT is we
have to know a tiny bit about firewalls
so the thing with firewalls is that
firewalls block ports and to connect
with another parent we need to know
their public IP and we also need to know
their port so how do we get around these
issues with our routers and our
firewalls how do we get around that so
the two computers can actually make a
connection we get around these with
something called ice the in turn
interactive connectivity establishment
it's a framework for getting two pairs
to connect to each other and ice has two
kinds of servers one of them is a sun's
stun server which is session traversal
utilities for NAT and the other kind of
server is a turn server which is
traversal using relay net so a few quick
things about these servers the stun
server is often free there's lots
available and when you're using a stun
server you're only exchanging maybe 10
kilobytes of information at a time so
the cost is next to nothing people
usually give out Sun servers for free
turn servers are used to relay media in
case your peer-to-peer connection isn't
strong enough and because it's relaying
media and large amounts of files turn
servers can be quite expensive so the
thing with these ice servers is that
these ice servers give you ice
candidates so while that whole offer
answer process is going on that I spoke
about earlier at the same time these
pairs are also like making a connection
to often a stun server so the stun
server they get ice candidates from the
stun server and the main purpose of a
stun server is to find out your IP so
the stun server tells the peer what
their IP is and it gets sent back to the
peer once they have some candidates
ready the pair's exchange candidates by
the signaling server and then that's how
they reach each other and once they find
enough ice candidates they have a
connection so it's kind of a complicated
process but there is that's the that's
the gist of it you have to send out
offers you have to send out answers and
you have to exchange ice candidates in
order to make
connection sometimes son servers aren't
enough to give you a valid ice candidate
this happens when your router employs a
restriction called symmetric net also
like I said earlier when you're reeling
large amounts of data you can't rely on
stun alone so this is where the turn
servers come in if anyone's ever used
videoconferencing in slack slack uses
WebRTC and they rely almost entirely on
turn servers so one thing I want to talk
about really quickly is troubleshooting
before I dive into the code just kind of
like my experiences like working with
WebRTC and issues I've come into contact
with so the first thing I discovered is
WebRTC as of last couple years I think
it requires a secure connection so even
though you're just writing maybe
client-side code you have to make sure
that you have a certificate and you have
to make sure it's HTTPS especially for
some of the api's such as getusermedia
which takes control of a user's camera
like if you're controlling someone's
camera or their microphone you want to
make sure you're sending out whatever
video stream you're getting from them in
a secure encrypted connection because
your client-side code is secure though
whatever you're using for your signaling
and WebRTC doesn't you can use sip or
you can use WebSockets for whatever
you're using for signaling also has to
be secure so depending on how
comfortable you're comfortable you are
with setting up a TLS certificate I
think if you're just like messing around
you're just starting you just want to
make something basic and WebRTC to feel
find out if you like it or not I would
stick with using firebase for your kind
of first kind of messing around the
other thing I found out is like in my
personal experience I think Firefox is a
lot better to do WebRTC development in
the developer the internal WebRTC tool
is a lot more user friendly it has logs
it tells you if the offers being sent
out and received correctly I know that
Chrome is like kind of pushing WebRTC
and it's probably like I'd had in terms
of the technology available but I just
find Firefox was a little more friendly
to do development in another thing I
didn't know when I first started messing
around with making peer connections like
rtcpeerconnection
is that you can only send signals
between two pair connections at a time
if you try to do something like this
it's not going to work if you're kind of
trying to broadcast messages from one
pair connection out to two pair
connections you're getting get all sorts
of errors and the problem with these
errors is that those errors are
misleading that's not actually what's
going wrong with your peer connection
you're not sending out the wrong thing
in the wrong state it's not that you're
missing a turn server that your turn
server is broken it's actually because
you're sending out the wrong message to
the wrong peer and it's getting confused
so you have to be really careful
whenever you're architecting or
designing your signaling system to kind
of keep things like unique IDs and make
sure you're sending out the message to
the exact pair the other thing I found
like in my personal experience is that a
lot of the tutorials are pretty
misleading often you see the remote pair
and the local pair they're often shown
in the same script so you'll see
something like this in the Mozilla Docs
and you see that local connection and
the remote connection are kind of on the
same page but really you almost have to
have a mental model where you take that
code you see in the tutorial and you rip
out the remote connection and you keep
that in a separate web page which is as
you can imagine a little confusing here
like you'd have to rewrite all your
promise code another thing I want to
briefly talk about I'm just going to
show a bit of code now is that we I just
spoke a lot about how this whole offer
answer exchange process but I think like
if you're just starting out it's good to
have a library that sort of abstracts a
lot of stuff like this away from you so
I found it was really useful to use this
library called simple peer so as you can
see all you do is require the library
you create a new pair so there always
has to be one pair that sounds that the
offer so if you have two pairs one pair
has to be there to send out the offer so
in this library you do that by setting
the initiator to true and then you can
just listen for
these four events you can listen for the
error so if there's any errors you can
log it to see what's going on
parents signal that usually happens when
a pair is ready to send out an offer or
an answer or send out some ice candidate
information so in your signal event you
just use your your firebase and you send
out the messages you need to the correct
pair on connect once you're connected
all you have to do if you use a simple
peer library if you want to use the data
channel is just send stuff using the
send method so and you can also handle
incoming data here's some example
firebase stuff it's if anyone's worked
with firebase before I think the first
three lines are first four lines they're
pretty like familiar you import firebase
in the config it's just you cut and
paste what you get from the firebase
website when you set up a new firebase
database you initialize your app with
your configuration and then you get a
reference to your database and then when
you want to send the message you just
you just push that message to the
database and if you do it with a unique
ID the other peer knows like hey this
message is from me based on the ID and
I'll accept that message and I'll use
that when I'm signaling and trying to
find another pair so I have a simple
file upload example here I'm just gonna
kind of play an animation of it so this
is a destination page it's connected to
one user and then the data channel is
sending cat pictures over and that's
what it does it's just it's hard to see
how this is different from like a
regular file upload but really what's
happening here is that instead of you
uploading an image to like an s3 bucket
and then displaying it on a web page
this image is going directly from your
browser to another person's browser
so in summary WebRTC allows computers
share media directly with other
computers without an intermediary server
however to connect two pairs you need to
use some kind of signaling server and
eye servers are required I just want to
show one thing really quick
might possibly need some okay here yeah
okay so I'm just gonna make this bigger
this is one thing I really like it's a
little hard to see but if you if you go
into Firefox and you type in about :
WebRTC this pulls up your internal web
RTC tools and if you go to web I'm just
gonna go to web wait can I get some
technical help just for a second
hey just uh when I'm like you know what
hmmm maybe I'll try can we just try this
sorry just give me a minute
always to connect it to a keyboard or
some just okay so okay I was going to
show a website to show how it worked
with the internal web RTC tools but I
think having a little bit of technical
difficulty so that's it for my talk
hopefully it's a good intro to WebRTC
and some cool tools you can use to get
up and running with it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>