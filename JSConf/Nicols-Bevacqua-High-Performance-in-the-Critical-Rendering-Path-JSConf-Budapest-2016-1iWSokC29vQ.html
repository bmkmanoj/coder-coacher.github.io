<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Nicolás Bevacqua: High Performance in the Critical Rendering Path - JSConf Budapest 2016 | Coder Coacher - Coaching Coders</title><meta content="Nicolás Bevacqua: High Performance in the Critical Rendering Path - JSConf Budapest 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Nicolás Bevacqua: High Performance in the Critical Rendering Path - JSConf Budapest 2016</b></h2><h5 class="post__date">2016-06-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1iWSokC29vQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you
okay thanks Jake for your awesome jokes
yeah yeah it's pretty amazing so I'm
going to talk about high performance in
the critical path this is something that
I'm interested in and I became
interested in mostly because bug when I
started my blog I was just loving now
then as most people who take on a
personal project at some point in the
lives I had to have a client side
rendering framework because back then it
was like the thing to do right so this
turned out to be really really slow so
mostly all you saw my blog where these
spinning balls so eventually I was
interesting performance and making my
side load faster on the first load so
today I'm going to be trying to speak
how you can achieve that kind of thing
and how to make sure that it doesn't
happen to you that you have like five
second page loads so the first thing
that you need to do in order to improve
your performance is actually measure
what's going on and know where your site
is sitting on so there are a ton of
different ways that you can measure
performance the first one it's probably
the most abuse you Shaz open dev tools
and run an audit of your sign this is
not very interesting but it's probably
the easiest way of running these kind of
performance analysis and it gives you
some tips on how to improve performance
like caching gzip in and stuff like that
so you get per resource advice and you
also get some cash in best practices
along with some other general tips like
minify your stuff and so on but that's
the this simple option right then you
have PageSpeed insights which is an
online
in service where you can just paste on
in oral to your side and it will tell
you a few different metrics on how your
site rates like how is it performing in
the case of moil connections and how is
it performing in desktop connections
which are supposed to be better and so
on um it gives you some tips and the
kind of things that you should consider
fixing and it even gives you some your
ex advice like maybe your buttons are
too small for a moral device and things
like that so it's a nice tool to try out
too it gives you both desktop and mobile
wrap scores from 1 to 100 and some
practical advice as well in in the in
each of those scenarios that you should
fix or consider fixin you can always
learn more going through the resources
that they give you and they also give
you some of some best practices like
differing non-critical content and so on
which is something that we'll talk more
about later on during this talk and then
another tool that really really like is
webpagetest in web page this is
basically something you just put the
link to your site and waiting in a queue
for for a machine to be assigned to you
and the way this works is it will fire
up your side and it'll shoot the video
have the site is loaded and then it will
give you a bunch of different analytics
and metrics that you can act on for
example it gives you the load time in
seconds the time to first by the time to
pagelet page complete and all these
different points in the life cycle of
your page and also gives you rough
scores like in page speed using grades
for time to first byte keep alive
compressed transfer caching where you're
using a CDN or not where you're
compressing images um things like that
besides this brace you also get the
waterfall view which is a very easy way
to look at how your page is loaded and
what resources plug the next few so for
example in this example you can see that
fonts are blocking everything else and
maybe if you were able to love those
fonts asynchronously or not all of them
at all maybe because they are cached
you'll save like 600 milliseconds or
even more so it's really easy looking at
this to figure out how to parallel eyes
your downloads so that even takes a
shorter amount of time and just as you
had the grades in general you can also
look at these grades on a per resource
basis so if you for instance have bad
static caching you may want to look at
this because most of those failed grades
may be due to third-party ads and stuff
like that that you probably have on your
side so it's one other thing to consider
um and like I said they take a video of
your side loading and this makes it very
easy to spot things like flashes of
invisible text and it helps you
calculate the how fast your site is
loading using a metric called the speed
index which is I'll just read this
spandex takes the visual progress of the
visual page loading and computes an
overall score for how quickly the
content was painting so this basically
means spandex tells you how fast content
is viewable to your users
and generally speaking and speed index
of 1000 or less is a good value to be in
the lower is the faster your patients
showing content to you your users so in
short web page that gives you a very
detailed inspection of februari single
request it analyzed is TCP traffic and
shows you all of these low-level things
like handshakes honor than what's going
on in every single step of the
connection it helps you identify
bottlenecks and visualize progress and
this makes it very very easy to figure
out wearing in your in your page load
you are taking too much up taking up too
much time the problem with every single
one of these tools is that you have to
proactively go to these sites or open up
devtools and run the audit and it's just
something that you may just do once
after my talk and then never do again so
this is not what i recommend are all i
recommend that you automate this stuff
and you measure often not just once
after check on BP so there are a few
different tools we can use to automate
all of this one of them is called PSI
it's an admiral that comes with a CLI
grunt and gulp plugins someone that when
use it on the comment line you shall see
the the same stats that you should use
on PageSpeed insights which is what PSI
is short for um and then on grant amanha
you just get json objects this is pretty
useful to to automate the these
measurements and maybe make some sort of
graph over time and five your site is
evolving I one not so it's one thing to
consider there's a similar to
for a web page since it's a little bit
slower because again you need to be put
in a queue for so that you are assigned
a computer where your test will run and
then you need to make another request
and and then eventually like two minutes
later you'll get all of these data but
it's so much data that you you'll want
to use it probably so take it take that
into account and then there's why slow
which is kind of outdated ish so I think
I'm really included earlier but you can
still out i made this using run twice
low so it's an hour or two that similar
to the dev tool audits that we saw
earlier so what do we do with all these
measurements right we know our site is
slow now so what what what can we do
about that well the first thing that I
recommend is setting up a performance
budget and these basically helps you
track the impact of every comment
because if you're enforcing a
performance budget that basically says
okay if my page isn't loading in a
second or our second I have or or if my
page weighs more than three megabytes
then these build is going to fail and if
you do this you will ensure a certain
level of performance throughout your
site which is a great thing there are a
lot of different things that you can
track its much as page load so for
example you can track milestone timings
like the load time or the time to the
first piece of content like a tweet for
instance this is something that we are
popularized and then it became thing
there's also speed index which is the
index I defined earlier this thing comes
from google and it has like math in it
but it's pretty accurate way of
measuring your performance um
then there are simpler metrics that you
can use like quantity based metrics like
Rico scanned page weight image weight
and so on and there are even simpler
rules like just using whatever why slow
gives you or whatever page please score
you have our now you can enforce any of
these using a something called perf
budget it's again a package that you can
use to enforce all of these different
metrics and it comes with a bunch of
options that you can use and basically
if if one of your isn't met
then the the build will fail the task
will file on the bill will file
hopefully your site won't be deployed
because it will be let it it would be
less performant towards that but what
can we really do to improve performance
beyond minification right because there
are a ton of different things that we
can look at in the web stack going from
TCP all the way to JavaScript so let's
start with the lower lower levels like
networking if you are interested in this
beyond what I can talk about in 30
minutes I recommend reading
high-performance browser browser
networking by Ilya it's a very good book
it it describes him in a lot of detail
all of the underlying protocols of the
web all the way from TCP HTTP HTTPS
everything websockets where DC or not it
talks a lot about more networks and why
it's important to to understand it helps
you understand why progressive
enhancement is important because on
intermittent connections you you want to
deliver the fastest possible experience
to your users so it talks a lot about
again
the intersection between UX and
performance but beyond that something
that you can extract strike from that
book is how to optimize tcp and there
are two basic ways of doing that first
off you you you should increase the
initial TC being window size and this
basically allows you to have more
throughput on every connection from the
get-go and to do that you basically need
to have the latest version of your OS in
production and that's basically it and
the other thing that you should be doing
is disabling slow sorry start and this
is part of the TCP protocol that's
usually enabled by default but what it
does is on long-lived connections
because you're supposed to be using
keep-alive on HTTP so unlucky live
connections that go idle for for a while
slow sorry sir make sure that the
throughput goes back to an acceptable
level and then that's not very good in
in web connections where you're using
may be reusing a single connection for
many many requests when it comes to http
obviously just make less requests um and
we all can be done turn on keep alive
because that way you have to go through
all of the handshakes involved in
setting up a connection obviously gz
ball detects that expires and it occurs
and use CD ends so there's not a lot of
explaining that's required there and
absolutely look into using HTTP to https
speedy and all these things because they
come with a lot of different benefits
for you some of them are non blocking
multiplexing and this basically means
that you're going to reuse a single
connection for the whole
regine and send all of the requests
through that and it also has higher
compression which basically saves even
more bites by by not sending the cookie
headers for instance when they are the
same as the last request I wanna um and
there's also proactive server push which
allows a server to send along with the
HP's of HTML for instance some CSS and
JavaScript that's also required by that
page in Heller so that the the browser
doesn't need to wait until the page has
loaded to start downloading downloading
those dependencies and others the the
website right and then here we have HTML
and the the single best piece of advice
I have here is just run around the
server side you can always become a
single patient later but important thing
is that you deliver your content first
and last different critical asset
loading and this includes all the
JavaScript that you have all the images
are below default and so on another CSS
ah one thing that you could do is in
line in critical CSS this basically
means if this was your page and the the
D in your web browser all of the content
does below default imagine all of these
slides that are coming up those are
aren't critical because they are not
loaded now so you should be able to
defer all of that CSS from the initial
page load and just in line in a style
tag the DCSS for this page so it looks
very fast and you don't have a blocking
request for CSS we'll look at that later
too um avoid them domain some things
like that is responsive
sign concatenate the unfollow a style
guide that's that doesn't quite sound
like something that would improve
performance but it does because you
don't repeat yourself on things like
this so eventually the code base is much
cleaner than otherwise it'll be when it
comes to phones load them asynchronously
because they are very very expensive you
can use a fallback font while you're
loading and then switch them preventing
a flashes of invisible text while
different slowed use fewer phones this
is something that's probably easier said
than done because it's not like you can
go back to your company and be like oh
hey yeah this guy at the conference said
use P or funds we're cutting all the
phones um designer won't like me but but
the truth is that design works well with
constraints and if you plan on using
less funds from the get-go and try to
work that with your design teams they'll
probably be thrilled about it probably
not in the middle of the project but
definitely when it's just getting
started um and obviously cash funds
aggressively using some some mechanism
like local storage or just HTTP caching
when it comes to images I think the best
thing that you should do is a shrink in
them because usually you have like user
uploaded images are like very big like
screenshots taken on a Mac and there are
like four 4000 pixels wide so you should
bring them and there are tools you can
use that you should be four images below
default create spreadsheets using tools
much as having your designer do that in
line tiny dynamic images may be like
gravitas and so on um and use CSS for
simple icons like that
and one you should be able to live
without JavaScript I said it differ all
of it use small smaller modules acid
hashing and cash bender scraped
separately so they are cached more
aggressively so yeah how the hell do we
do all of this right well that's soon
you guys um but in all seriousness one
of the things that you should be using
his engine eggs which allows you to
serve static content and cash it very
aggressively it supports HTTP to now
gzip compression all this good stuff by
default um and it allows you to lay some
pressure off of your front end servers
set up a CDN first look into this maybe
you don't actually need a CM for like
your personal blog but I still set set
one up for mine because why not um you
can use cloud flour if you're just
setting up your first in the end it's
pretty easy to set up but there are
other enterprise the options as well
when it comes to rendering them both the
server side on the client side there are
a bunch of different options that you
can use there's a backbone with some
hacky thing called render there's
angular 2 maybe I think there's tunnels
which is this thing i did that nobody
knows about so don't use that there's
free act which people do now so maybe
use that but just try to run the server
side and then figure out how to run
their own decline hmm when it comes to
the foreign assets shaz you say sing for
for javascript and then when it comes to
style times justa you can set the media
type to something invalid like only ex
or something
and then after a timeout said the
immediate I to all and that allowed the
Stiles asynchronously and not blogging
your page don't ask me why but it works
when it comes to I new CSS you can
remove things like bootstraps code that
nobody uses just there's this package
called an CSS and you can it's a like a
common line a gold package and whatnot
and it allows you to get rid of all the
bootstrap code that you use and just
have like the button class maybe don't
use bootstrap but you can my point in
line critical CSS and there are plenty
of tools you can use to do this it's
kind of convoluted because the dimension
to do this is something called penthouse
it allows you to it's a script for
phantom shares and it allows you to look
at the page and extract from a
stylesheet all of the CSS that's
actually being used at the top of the
page and it prints that out so then you
need to take that put it in style Tai
and for the rest of the styles as we saw
earlier there's also a package called
critical that allows you to automate all
of these things in a bit of an easier
way but it's well worth the trouble so
consider doing that use of unloader this
is pretty obvious you just have to to
give it your font name and then when
it's loaded it that's a document a class
on the document and then you can swap
the funds so that you have flashes of
imbecile texts and you maybe have some
some flash when you're swapping the
fonts but it's very small and it also
helps you speed up page loads
significantly optimized images you can
use image mean to optimize them to
remove metadata that you don't need and
stop
like that when it comes to shrinking
them you're gonna use graphics magic it
also has like an animal that you can
easily use in in galt tasks with like
five lines of code so do that image mean
has like planes for SVG and JPEG and all
the things I comes with the CLI and gulp
and grunt plugins so it's pretty useful
then when it comes to spreadsheets you
can use bright smith this thing
basically you give it a equal a beam
pattern of where your PNG icons are and
it'll give you back a CSS style sheet
with all the classes that you need for
your icons and a single spreadsheet so
it's pretty handy and it also has a CLI
and a grunt task um when it comes to
inline in images you can use the data
URI manual and it's basically either a
common line tool or or an API you give
it the the path to your file and it
gives you back the decompressed data URI
for that that you can just embed in your
side so that's awesome you can also use
a module system again kind of like
following a style guide this allows you
to not have 20 persons of jQuery common
shares or I es6 modules either way
they're both pretty awesome so that's
pretty much really need if you want to
learn more about all of these things and
maybe gets your hands a little bit dirty
you can use perf school it's a con line
tutorial thing that I did it has
exercises that you can follow they're
basically what I discuss today in the
endurance doc um is pretty fun to do so
it has guts and it
to people like that and yeah and I wrote
the book called the JavaScript
application design it has like a bunch
of stuff that's it's not quite on
performance but its own code quality and
processes and automation all these
things so if you care about any of that
then just follow that link or maybe send
me an email or something i will give you
a discount code if you're too cheap to
buy the full price um and that's it
thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>