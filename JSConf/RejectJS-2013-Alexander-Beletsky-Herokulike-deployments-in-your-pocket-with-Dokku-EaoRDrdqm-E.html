<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[Reject.JS 2013] Alexander Beletsky - Heroku-like deployments in your pocket with Dokku | Coder Coacher - Coaching Coders</title><meta content="[Reject.JS 2013] Alexander Beletsky - Heroku-like deployments in your pocket with Dokku - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[Reject.JS 2013] Alexander Beletsky - Heroku-like deployments in your pocket with Dokku</b></h2><h5 class="post__date">2013-09-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/EaoRDrdqm-E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright let's get started so first of
all I would like to say thank you for
having me today I heard a lot of good
things about Berlin and J's community
and I'm really excited to be here on
that stage what I'm going to talk about
is the project named oku and it's what a
referee's a kind of the pocket-sized
because it's really small but it's
really cool and interesting and I hope
it's kind of make you change the way you
think about the code shipment so my name
is Alexander and I live in Kiev and they
work for a Danish company called
economic and inside economic we are
doing a very interesting things but
besides of the full-time job I also work
and a kind of the side project called a
like a store and the like a store
started out is the hackathon project we
gather together with some friends of
mine we build stuff stops through the
night and yeah just participated that
and had fun but how it's usually
happened after the hackathons you throw
the things away and yeah you just forget
about but we were quite excited about
the stuff we did and it's no GS and
MongoDB an angularjs a pretty GF
sweetness stuff even if my talk is not
directly related to the JavaScript today
so we wanted to push the things out we
wanted to release the things and
probably the most important thing that I
learned through the whole my career the
way you ship the code matters it matters
in a few ways I would say it matters for
the business but it matters also for the
kind of developers happiness as soon as
you doing something you write the code
and Yokote immediately or faster reach
the users you feel happy otherwise you
write in the code and if it stays in
repository for weeks for a month as of
four years that's something that we call
the dead code the code that which never
be valuable for anyone and in particular
I feel really really bad the time I'm
writing the dead code and doesn't matter
what you think what technology use
doesn't matter what language uses I
think that what
really important is that you can quickly
move your code somewhere out from your
development box into somewhere then the
actual users could reach it so yeah you
can see that like git push production
master this is just an example but the
point my point is it should be easy it
should be just small step doesn't matter
is it grid push run the shell script or
whatever or press the button it should
be easy for anyone to just promote the
things and yeah that's what we of course
started with the like a store we wanted
to move faster we wanted to push our
code in really really quick manner so of
course the code shipment is the problem
which not appeared yesterday
it's exists for a long long time and it
involves all the time and yeah it's
changed because the technologies changes
and programming languages popularity
changes and so on and so forth and what
I see currently the evolution cycle of
the code shipments is the something that
we refer is the past and the past is the
platform as-a-service you're probably a
lot of you heard about that and we have
really good implementations like Heroku
or no Jitsu where you simply create your
account you have one or another way for
pushing the code either by git or SSH or
whatever and you doing the things
locally you push that out and hit your
brows with a browser your URL and you
see the results and this is the way how
I like to work then you can quickly see
the things you are doing and the users
potential users or whatever can quickly
see that so we started with the app fog
and we've been pretty happy with the app
fog because it gives what we need it
gives the kind of experience of
deployment which is easy you can run the
AF deploy command and it's out this was
really cool we have to drop it actually
because of few technical challenges and
we switch to no do so and no jisu is
exactly the thing that we need it it
works fast you can
fire up the machine really fast you
deploy the code but unfortunately the
time we wanted to have a public release
we wanted to go out for for a public
beta let's say we wanted to have us a
cell connection because we deal with the
private user data and yeah we could not
just expose it through HTTP and yeah we
asked no gifs on sale all right you can
do as a cell it's not a problem but
instead of the personal account you have
to switch to the business one so instead
of twenty bucks per month you are now
paying 120 and that's absolutely fine
because these guys have to earn their
money they're doing a great job but if
you are in the side project if you are
in your own even not small but micro
business let's say it could pretty much
for you you invest your time you invest
your nights weekends and if it turns
about money you think all right
yeah the Samson that I could not take on
me so the time we realized this
constraint it was the I personally was
really upset because I understood that
we can go further we can arrange we can
took virtual private server and build
some stuff that would make you feel like
pass but instead of release in the end
of the week we will be releasing the end
of the next month something like that
and that personally give me a really
really big upset so I was started to
think about the kind of alternatives and
just by chance I would say I don't
remember what exactly was the tweet or
hiking news or whatever I've seen the
project name Doku I forgot about that
slide a bit but so my point here is that
Doku is something that allows you to
have a kind of paths that you can run on
your own on your own machine and while
you can do something like that
on your own you could invent your own
lightweight code shipment path whatever
way through SSH
but it's the kind of the thing that you
don't want to spend a lot of time on
that because you want to be in your
domain you want to develop the product
not develop now at pairs which complex
and time taken and so on so you might
have a feeling that you need a pairs
like experience but you don't actually
for some reasons can't use Heroku or no
G's or whatever
so doko is is the hack by bright hair
color called chaplaincy and it's
actually 100 of lines of the bash script
which can do you the feeling like you
are using the hiroko so it's the time
I've seen it I said I thought to myself
wow that's exactly what I need and yeah
I decided to try it so I immediately
clone the repository I started up
virtual machine I tried the things out
and it was not exactly what we need at
that time because it means as few
features but those guys who is yeah who
is doing those proud of that project
they're really cool they're cept for
requests so saying in three or four days
we make it the way it worked really
worked for for our product and in a few
two days we've a few days we launched it
and digital cloud so it was a great
experience and that time I've seen that
reject GS : four speakers and I thought
to myself wow I I would like to be here
and share that experience with you guys
so to to show you how cool is that
I'll do a little demo of the of the co
deployment so I have Doku running on my
virtual machine right now and I would
like just to show you how how it feels
like so I just have the document you can
see it's local IP it's running it's
running locally
Doku me is just an alias for that and I
haven't it really really simple
knowledge es application is basically
expressed GS with one of you so the
experience of moving the code
the man one machine to another disk with
Doku is really similar to what you have
with zero code how many guys use Heroku
before all of you so what you do is that
you have a alias for remote repository
and you point out it to the machine
where the Doku is installed so what you
do next is that you just say git push
and the name of that local repo is local
deploy and you say from master and some
magic is happening there so I am pushing
the code and it says all right you push
there some some some data is here and we
build in your note simple application
and it detects that it's no GS behind
that application and it's alright did no
GS with version 0.8 an NPM version like
that so I'm fetching the node.js
binaries so right now what is doing is
preparing the environment to run my
application in and as soon as the
environment is ready it installs the all
the dependencies that application have
through the npm install simply enough
and said boom you already know simple
Doku that me so i'm going hero i have
supposed to close that before and this
is the Express application that that I
have so as soon as I decided to change
something so you can see it's the
version 0.8 so I can apply some change
and my change would be just the version
app for that and I'm saying commit
version up and redeploy so I just say
fix the buck or I implemented the new
feature and I wanted to fast out as
faster as possible I'm pushing that way
and again it does the same thing from
the very beginning it's understood that
it's no GS application again it have to
fetch the the environment for my
application again
it'd have to install all the dependency
and it should run it so if I go back to
the browser
I can see that my new feature is just
deployed so this is feels exactly like
experience with a Heroku and probably if
you use the Heroku the output that you
can see is really similar to to Samson
you can see with doc oh so if I go back
to my slides again 100 of lines of the
shell script could you believe it that
it's possible that it can do all that
stuff it's because the doc who is not
exactly implemented all of their things
of course it's not but it's staying on
the shoulders of giants of the few
projects that actually make it possible
and I would like to just briefly
highlight what the project because all
of those I actually are quite useable on
their own so doc who it's built up on
the three major things and one is called
the git receive also it cool hug by Jeff
Lindsey so the get receive is a small
component that you can deploy on your
Linux machine or your server and it does
turn that machine to something that
could receive SSH or HTTP or get through
the git protocol the pushes of the code
so the first thing that you've seen if I
pushed the code out and I pointed to the
my machine it's exactly the get receive
component who understands all right I am
receiving the code now and what it does
is just say okay I received that this is
the stream and run any bash command what
I want so this is the let's say the gate
to the dock with assumption that there
are interesting things I started and
after that again I will refer to the
heroic who that the output is exactly
the same as you seen then you are
pushing to Heroku and why because Heroku
is also a cool company and they open
sourcing a lot and one other thing that
they open sourced is D called build
packs so build packs are
simple simple enough let's say also bash
script that could understand it does two
jobs basically so it detects what kind
of application you have is it PHP or
Java or Ruby on Rails or no GS and then
it realized that it could prepare the
execution environment it of course
depends on actual language so for know G
as you've seen it fetched node depending
on the version I specified in the
package is on for Ruby on Rails it would
fetch Ruby and rails for Java it would
fetch g vm and so on and so forth so its
job is to prepare the environment to run
the application in and and yeah as I
said it's exactly what how it works in
the Heroku because Heroku made it
possible to use because they open source
that and doc who is relying on that
component and finally what makes you
wonder where exactly it's gonna run is
the project named docker and how many of
you guys heard about docker before yeah
a few of you I think it's it's currently
how to say we're in noisy topic a lot of
people are talking about it and then
Twitter and and I can use it usually
goes up because yeah it's just really
interesting it's been released maybe
four months ago by the company named dot
cloud and the guy who is implemented
that Simon hikes they are in the
business of passes let's say for four or
five years and they have of course they
get a lot of expertise they get a lot of
knowledge of the shipment of the code
from machine to machine B but they are
awesome because they did realize that
they have their core functionality of
the containers which I will talk a bit
later they took that out because they
needed to clean it up but they realized
if they would start to rewrite it from
the scratch it could be too dangerous
and never end so they took the core
they yeah they probably have a really
really good understanding what exactly
need to be done they even switch the
languages to do not copy paste the
things because I believe the previous
infrastructure code was in Python but
that one they decided to write and go
and they reimplemented that and open
source and this is something that we
currently know is the docker project and
you can check it out in a docker that a
or URL yeah and while I was preparing
the talk and I was thinking how I gonna
explain those containers that's he a
pretty technical and pretty difficult
topic to just explain it in a few words
and I like the myth of war that Salam on
hikes used for explanation and imagine
the shipment of the goods like 100 years
ago if you want to ship the stuff from
one place a to place B you pick it on
your own when you place it two boxes of
barrels whatever you push it to sheep
then you have a lot of concerns if that
sheep comes to another Harbor would it
be enough you know infrastructure around
like grant to put it up and put it on
the land so you have a lot of things to
think about and in the middle of the
fifties the situation is radically
changed because people invented
containers which are metal boxes with
specified dimensions which you just put
the things in close the door put the
label Ukraine China Germany and it goes
by its own and you perfectly you you
clearly understand that you will not
have any problems with that because it's
not only the containers it's also the
infrastructure around that you have a
good enough ships to put it in good
enough currents to put it out and so on
and so forth so the container in the
docker project is a Sanson that could
host let's say your executable process
whatever process it is and it would make
it run in a very repeatable and
consistent way so whatever machine which
is running the docker and you have the
application
which should be started inside the
docker yura guaranteed you are having
the same exactly the same result
whatever times you ran it whatever times
you ran is so and Doku is using the
containers to actually run the note GS
application there so it's not running on
the Virtual Machine where I'm pushing
the code where the get receive is taking
in instead it creates the another the
docker has did such term as the image
and that image is like the base base
application from where the container
could start from so we have the image
already prepared with the build built
parks already injected in let's say and
the output that you seen is actually
something which is produced as the work
of the container so the docker it solves
that containers idea and the docker
itself is the based on the Linux kernel
Fisher called lxc which stands for Linux
containers and it's it's the core
functionality of operation system but as
if you probably start to just play
around with it it's really hard to get
any meaningful result and the dog who is
exactly implementation would make it
easier to use LXE tool to use Linux
containers in the way it's yeah you can
use it you don't spend tons of time to
to just realize how how the things how
things should work so a little bit about
docker if I go back here I have the
machine where the docq is installed and
of course I'm having the docker here so
what I would like to show you quickly is
that Sampson I described so we have an
images and I have a plenty of them it's
not that good I can see that but you can
see this is the program build step is
the image which is doc who is using then
and starting new application and I have
a plenty of the
and you can run whatever you want inside
the image you can say docker run and you
specify the image name I could say it's
Ubuntu a machine and I could run any
kind of comments so I just say beam bash
- CLS and this is the execution of the
comment inside the container and it's
actually the local system of that
particular container so the containers
are highly isolated processes which
exist through the time that comment in
Rand and till it completely exited so
the time it exists it's and this comment
is run inside the container I hope it
makes a bit of sense to you guys because
I really struggle in to to express their
- to explain that and yeah I'm also kind
of new to that - that stuff so but
what's important is while I'm rounding
any kind of comment if I can use the - D
property here to run it on the on a
background say it returns the hash you
can see that here because whatever you
run inside the container you changes the
state you can run the process which for
instance write something on the file
system but if you do that you know if
your application is doing that you are
not actually changing the base image
because every time you run it
I can't demonstrate it every time it
returns the new hash it's run and it's
absolutely new state if you want to
preserve that you have to say commit
docker commit and then you have a child
say child image of your parent image it
means that you can run few things you
can run apt-get for instance to install
Mongo Jia's you can run up get to
install couch or whatever you can meet
that and now you have base image which
already predefined environment and
what's also cool about docker it had the
public index it's kind of the public
repository that you can push your base
image to
other people could very very easily
reuse that so imagine if you have your
local development environment in one
that image you pushed it out and all the
developers in your team are just reusing
that test in your code were in the exact
environment where it's going to be
executed so it met smile smell for you
like the virtual machines because this
is what the virtual machines problem
solving and yeah in in the concepts they
are they looks really similar because
they have that base image and you can
run it but guys can you believe that
virtual machine could run as fast as a
container so this is the whole process
imagine the image virtual images
actually take some time to boot then the
operation system started then you
execute something you got results so 30
seconds 40 seconds and so on docker is
highly let's say performance in that it
it runs really really fast and you got
you got the things in so doc who uses
docker to host the containers this is
where the application is started and for
no GS in particular what it's only does
you have note AP PGs started you specify
the port say 3,000 and then docker might
expose your port to it could map it for
Sampson on youand I say 5 5 5 5 5 and
that's where you can reuse it in your
machine you can use the results and you
can read it from that port so finally
you can have the one machine where you
physical machine a with your machine
then you are running few applications so
in our case we're having one machine and
it runs three different applications
which is you know accessible by main
domain name its example.com then you
might have a PP dot example.com somes
another dot example.com all of that is
being orchestrated by an Jaques and the
time you install Dhaka on your machine
you also install it comes with an Jaques
you and you don't need to spend the time
to configure on that because the time
the deployment of application girls
besides of the preparation of the docker
instance container which where the
application is running it also creates
the small injects configuration and said
all right
for that particular domain name which is
your this your upstream you read it from
that port and that port is exactly the
execution of the container and it just
Maps it out
so guys yeah I hope it makes a little
sense for you because it's a bit kind of
as I said it'd be tough to me to do this
Claire describe that things technically
in more or less but what I want to share
more is the experience how the dog who
helped us as I said instead of waiting
for for a long time as we wanted to have
our product to be released just used aku
and we had exactly the same experience
like we are having the Hiroko but
locally it's not of course the Hiroko no
it's something really really small but
it gives you the feeling like you're
using that so let's just try to put the
things together that hopefully you would
understand at least something from this
talk I'm heaven so the start the the
action started from the get receive you
push the code to your machine and this
is their the get receive component start
to play it understand alright here is
some someone is pushing on me I
understand that and I am running the
shell script and this is where the dock
will start to work it says ok I have the
base docker image with already installed
build packs installed on that what I
need to do is to inject let's say the
sources of the application there and run
the Builder and builder is the script
which iterates through the series of the
build packs and trying to detect what
actual environment you have is it now GS
PHP Java and so on and so forth if it
detected it gonna install the
environment there and then docker
commits that image so you have the image
with already contained
our application and executable
environment around it so it's reusable
if it's crashed and it happens sometime
of course what you need to do is just to
restart that image from the beginning
and you have your application running
exactly the same as you deployed it two
days ago say it exactly in the same
environment exactly in the same way so
the docker solves all that problem and
daughter is amazing heck with we're very
high ambitious so as I said they started
four months ago in October they plan to
have zero 1.0 release very ambitious
guys and they have a very very ambitious
plans to to proceed with the docker and
finally the injects is the one who
orchestrates that HTTP HTTPS stuff so
because you might have a lot of running
instances in one physical machine and
injects is the one who balancing that
who who who separates who separates the
things so for us Doku was something that
as I said allow us to proceed with our
little product and I'm really appreciate
to jeff Lindsay to Salomon hikes for the
things they did and for me the docker is
the really simple interface between your
development environments a and n
production infrastructure so by just
using that and you can install it say in
20 minutes on any Ubuntu server it
taunts that server into Heroku like
server and for me that was really really
good things so this is it guys
yeah again if you have any questions I'm
here till the end of the day I hope you
can try Hiroko Doku and you will like it
because that's really amazing heck so
thanks a lot for your attention</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>