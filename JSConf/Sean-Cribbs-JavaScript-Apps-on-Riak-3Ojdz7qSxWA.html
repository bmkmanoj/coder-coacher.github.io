<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Sean Cribbs: JavaScript Apps on Riak | Coder Coacher - Coaching Coders</title><meta content="Sean Cribbs: JavaScript Apps on Riak - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Sean Cribbs: JavaScript Apps on Riak</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3Ojdz7qSxWA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey there hi I'm Sean I'm gonna get
started a lot of you may not know me I
mostly been in the Ruby world and doing
some Erlang lately but that's me a newer
picture on the left side you might
recognize my avatar on the right side
that shows up on my Twitter account so
you can get a hold of me so I work for
batch o technologies you may have seen
in your goody bag a manila envelope it's
got jazz comp boccio calm stamp on it
somewhere so make sure you get inside
and get get get stickers and so I work
for batch o as a developer advocate
we're basically like jack-of-all-trades
type type people we handle support for
customers but also do things like this
come out and talked and work on all
kinds of random internal code projects
and documentation whatnot so I'm here
today to talk to you about JavaScript
apps on react so what are we what do we
mean by that first of all what is react
you may not have heard of it but rioc we
usually use these three things so react
is distributed its fault-tolerant
replicated key value document database
thing and the best way to explain it is
actually through this animated gift that
was made by the wonderful matthias meyer
this is a play on the react logo and it
basically shows that when you write to
rioc it's going to send out three copies
of everything two nodes around the
cluster and then when a node goes away
you're going to write to fall backs and
when the note comes back it's going to
transfer data back to the node that was
lost so I think that's the best
excellent visual explanation of what
rioc is that I've ever seen thanking the
Tina so is awesome so rioc loves
javascript that's why we're here is why
i'm talking today so what does that mean
well it means that key value operations
are HTTP so you want to store your stuff
in rioc you use use put or post you want
to fetch something out of rioc use get
you want to get rid of it
use delete but the key thing about this
even beyond just using those for HTTP
verbs we know is that the content type
matters so you basically tell rioc what
you're storing in it and it'll
willy-nilly very happily store whatever
but also beyond just playing well with
HTTP and web apps you've got MapReduce
so you know I'm a produces a big
buzzword right now couchdb Mongo Hadoop
rioc all have MapReduce we embed a
spider monkey engine in each rioc node
that you build into a cluster includes
you know by default aight spider monkey
instances that you can run your
JavaScript functions on so this makes us
very happy right but you're saying now
why should I give a care couchdb has
that couch me has HTTP it has javascript
it has MapReduce well we accept that
challenge and I'm going to throw down a
little gauntlet I love couch TV and I
see I saw Jay Chris here a minute ago
hey hey Chris but I'm going to say that
you know CouchDB has this this statement
where they say how should be is made of
the web and I'm going to say that rioc
doesn't need it well what happened with
my text there rioc doesn't need a couch
app so since rioc uses pure HTTP you
don't have to have a separate
abstraction to build your application
okay if you like the troll face so
beyond that you've basically the reason
why you should care about rioc apps is
you can build a completely browser in
totally in browser apps you use the
three things you know well HTML CSS and
JavaScript you deploy your application
with curl or whatever HTTP client you
you uh you are happy with and you do
scale so like this is a graph and I got
to give a shout out I don't know if any
of them are in the room but two giant
this is a graph of some benchmarks we
don't on joint and it's
sorry the text is a little bit small at
the bottom of the graph but as you
increase from five nodes on the left to
14 nodes on the right you get a linear
increase mostly linear of of throughput
and the green one down at the bottom
sorry it's not labeled is the
performance per machine so you see it's
that stain kind of constant but as you
add notes to your cluster you're getting
more throughput so if you're interested
in using react go try it on joint it's
pretty awesome so what are the kinds of
things you might be able to do with rioc
JavaScript apps you could build a little
intranet a portal completely in your
browser completely easy to deploy we had
a customer who is working on some kind
of web-based mobile app that they served
directly out of react and a popular
thing that that I've trying to push for
is using it for asset storage so you
could put your your scripts your your
images I to limited extent your videos
in rioc and then if you have some kind
of server-side app like rails or Django
or you know a Java framework which none
of us use right you could put like you
can send back an XSL redirect header to
engine X and have that file serve
directly out of rioc to your client so
I'm moving really quickly I intended to
so we can have questions but i'm going
to show you to sample apps that we've
built that are basically served out of
react they're all HTML CSS and
JavaScript one is called recon and one
is called yak react so recon is a kind
of sort of like futon or PHP my sequel
for react unless you show all the stuff
that's in your cluster and it lets you
interact with it with simple key value
operations and that's built using mostly
Sammy GS for the state management and
various flipping through various pages
yak react is something I wrote last year
it's an ajax pulling chat room and it
uses reacts MapReduce to get all the
newest messages and display them
in your browser and it just uses plain
jquery with you know regular JavaScript
code so it's time for demo and this is
nice even get a little bigger now that
doesn't work so this is recon and this
lists all the buckets that we have
stored in react and actually if you can
I'm sorry it's a little tiny but if you
can see it at the back of the room this
is actually my presentation and this
recon app and the Yak react which i'm
going to show you in a minute is being
served out of react so you can flip
through you take a look at my
presentation here these are all the keys
that are in that the the bucket that I
stored my presentation in you know you
want to see the the HTML that my
presentation is it uses pal which is
pretty cool so there's all the HTML and
there's a ubiquitous content type at the
top let's see so you can you know get
images etc so recon is pretty cool you
so you can flip through all of the stuff
you have in your your cluster just to
kind of see what it's wet its storing
and I could click Edit down here like
and actually go and edit the HTML of my
presentation save the back and react so
this is actually pretty similar to what
futon gives you in couchdb so the next
one I think is is the more fun one and
in its called yak react and in previous
conferences we've tried to set up people
with laptops all connected on the
conference Wi-Fi which you know is
always a problem at conferences and they
connect their laptops together and then
jump on the chat room from their local
machine so they connect their laptops
together in a cluster but i'm going to
show you basically what yak react does
so i'm going to put in
my name and Shawn at basho calm and it
just gives me kind of a blank screen but
and so that was a full round trip posted
the the message in to rioc and then and
then displayed it back on the machine so
are on your browser so if you want to go
to that I want to jump on there and
start you know trying it out you can go
rioc apps basher calm and then port 80
98 / react / yak / index.html and I'll
have that link later in the presentation
so we'll check back and see who's who's
jumped on there and started chatting
okay so we had the happy fun demo time
but that's these are just you know
simple apps there derp scale they're not
serious but it's easy so the key things
to take away from here is that rioc is
like what HTTP should be for put and
post and delete it's really easy to
build a browser side app that you store
in react and you can deploy really
easily so what will you build so if you
want to go play with this stuff I've
just showed you again I said a rioc apps
basho calm colon eighty ninety eight
sorry about the port but I couldn't get
my load balancer to work yet and so you
can go see the slides there j/s comp /
slides recon is a separate project you
can also get from recon basher calm and
I'll show that in a second / go and then
there's yak react so if you play with
this please be nice and don't hos my
cluster it's running on giant but you
know if you delete something these
things might not work anymore so a low
plug here bash is hiring we're looking
for developer advocates and other type
of people so send an email to react at
basho calm if you're interested enjoy
the stickers in your little manila
envelope and that's
that's it thank you and I'd love to take
questions yeah we'll start here and then
go back since you were trying Ronnie
basically full app straight up Rihanna
would you put all the notes behind a
boat balancer and then how do you deal
or do you deal
yeah so rioc is is doesn't have any
built-in authentication yet so the
question was would you put rioc nodes
behind a load balancer and then how do
you deal with ACL so rioc is designed be
used behind a firewall right now there's
no built-in authentication but plenty of
people have put like apache or nginx or
some other reverse proxy server in front
to do authentication and you know
they'll Pratip we do like basic over ssl
or something but once you have
connection you can basically look at any
of the key space that's in react and did
get your your whole question I guess so
when you do is apparently the next
redirection you with some type of woman
yes
right so actually what that when I when
I showed the X Excel to redirect let me
put back here what that actually means
is that your application receives a
request first and you send a header back
and you've got an internal location and
engine X and so it will only serve gets
yeah your question back there yeah
sure um so here's my other gauntlet to
throw down Mongo loses data rioc
replicates and so you should use react
concerned a Mongo see see see the
victory baby here he killed a note in
his react app still works so actually
I'm talking on Thursday if you're coming
too no comp i'll talk about rioc jas
which is the the driver react driver for
node i just wanted to focus on browser
only apps question way in the back how
do you create data that's a very good
question i kind of glossed over that
it's MapReduce so we can actually look
at the code oh wait we're still in
chrome here so we'll just flip that's
going to be too tiny isn't it here we go
okay so this is some of the MapReduce
that's in in yak react and basically
you're building up a job and that's too
wide I need to learn to do 80 line you
know 80-column code here so in this case
we're running a map function this is to
pull and get all the new messages you're
running a map function that's stored in
this bucket and key and you're passing
an argument and the relative reduce
function is stored in this bucket and
key and you tell it to return the
results keep true and then you give it a
call back so in this case it's it calls
back to this poll function and I did
some function prototype buying stuff
since I didn't want to include conclude
prototype and so the initial poll is
pretty similar except that you limit it
to 25 since you don't want to get you
know hundreds of messages back and crash
your browser okay and so then then once
it gets the the data back and I'll show
those map and reduce functions in a
second when it gets the data back it
runs this little thing that adds them to
the Dom so and actually we can whoops we
can look those functions in recon right
so
ok let's look the buckets and you see my
mug so i made this bucket called yak mr
which is just the MapReduce functions
and so there's this the very first
function that gets run in any of those
jobs is this and it just takes when I
say object it just takes a rioc object
so that's the the value the key and
value and it parses it it interpreted as
JSON and then it determines if the
timestamp is later than the thing you
pass to the phase if so it returns the
value otherwise it returns an empty list
and so instead of like doing a
declarative you know query language
you're doing like I'm going to start
with these keys and I'm are running
through a bunch of functions that are
kind of like a pipeline and that's going
to return result to my browser they
answer your question ok cool any more
questions all right thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>