<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Peter van der Zee: Sweet sixteen, but where are the tools? | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Peter van der Zee: Sweet sixteen, but where are the tools? - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Peter van der Zee: Sweet sixteen, but where are the tools?</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZJD61GgmV40" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everybody I'm here I'm touched
JavaScript hacker I warframe zebu we
make jobs of applications cutting edge
so we work on mobile basically and we do
going to pretty much anything we also
sponsor a gyroscope by the way so much
for that so I'm going to talk to you
today about tooling and Tony we all use
tools in our everyday life whenever we
use a text editor whenever we use a 98
you know testing frameworks or whatever
their old schools and they're all I
would say very important to our line of
work and it occurred to me that last
year that the number of tools are
actually pretty well you know not
limited but I would like to see more and
so I'm going to try and persuade you and
to show you how easy it would be to
create new tools and to persuade you to
you know make no tools so I'm going to
talk to you today about Xion Xion is a
static JavaScript analyzer I created
using a handwritten parser and based on
the Han River parser I can do while I
can for a lot of stuff and most of it is
pretty trivial let me try to quickly do
the demo thing of course it doesn't work
as intended ah alright so this is
interesting this is basically what xeon
is as you can see let's see there is a
pop ups it will give you more type
information it knows you guys like
static references to lick variables or
discs or whatever it does inference like
it sees that well right now it doesn't
throw but if I would like throw I don't
know some string then we'll say throw
string if I return if currently there's
an object and something it doesn't
doesn't know the type of it
all kinds of tools right here
minification beautiful are I don't know
generating jazz docks whatever and you
can no one you know you can all do that
so that's basically what what Z on this
and let's get back to the presentation
all right next yeah so what's Yun does
is not magic it's it's just a set of
rules you get the information from your
source you know the structure of the
source and so you can apply these rules
and for well data from it warnings
errors or you know derive tools from
them so these rules are applied to the
input you get the input rules you apply
rules and you get that but that's
basically what it works how it works and
xeon just you know displays it
graphically so it will immediately give
you the feedback that you need so the
parser works with tokens I'm going to
quickly do this actually did this for
Paul but I don't think he's president I
haven't seen him yet he one minute to do
this you realize real way digress so I
token in Java speed is the smallest
piece of code it's still single unit it
would be like an in fire or a number
whatever the smallest unit these are the
smallest units you only have like eight
or nine of them and the smallest units
are fast in a greedy fashion so whenever
you have a plus it could be like the
single token right it would be fine but
if it's succeeded by an equal sign then
that would also be single token it would
be bigger so it will take that and not
just a plus sign that's an important
part for for the old Parson process this
is my favorite expression I don't know
why it's just visually appealing I guess
this is actually a regular expression /
right expression something that was a
test case for my earlier parser so the
parser tells the tokenizer to take the
next tokens all right so it will tell
tokenizer give me the next token and
I'll handle the rest
you know us to worry about how that
works just give you the next token so
that's betta parse right now we're going
to start with an empty script so we know
that we're at the start of the statement
and the first token we get isn't if we
know that it started a statement we're
either in a started statement or to
start of a function declaration function
declarations are with function so this
must be a statement in fact that must be
the if statement yes i'm a can only be
followed these keywords going to be
followed by one you know valid thing and
that's the opening parenthesis anything
else will be an error opening for
instance is followed by a shitload of
stuff and that seems to be complicated
but let's just for an ounce say that
we're going to parse the expression and
just leave it at that right so it must
be followed by an expression any kind of
expression is fine up until the closing
parenthesis because that would not be
part of that expression and then the
final part is a statement a single
statement don't worry about it is it you
presently do the same thing as we just
did with the earth and congratulations
we just parse the if statement there are
a lot of statements of course but they
all start with keywords and you can very
easily you know see that if you start
with a keyword howdy structure is going
to be so parsing is relatively easy once
you get to it so let's go for the
expression expression is slightly more
complicated it can start with something
I call a lead value which is basically
just any kind of value like at this or
null or through or a number and then the
universe right is deployed to type a
type of or it'll aid or whatever so
that's what what ale expression may
start with nothing else so let's have
this expression it's a silly expression
I know it's still valid departure will
not tell you that the lead new is not
going to be in working you can do it the
interpreter will tell you that's pretty
much well actually this will work i
think so this is these are tokens all
right so when the tokenizer is finished
with it this is what it ends up with any
boxes a single token so we start with
the operators we start with delete and
new just keep forcing a prefix operators
that you know until the point where you
can't and that would be shoe and so what
we find shoe we we have the the delete
value all right
a case just in the land of fire there's
a variable we don't need to know what
the value is we know it's an identifier
identifiers leave fellows ARF well maybe
followed by property access or call
expressions which are in all cases all
here at dot and this grand opening
square bracket or the opening
parenthesis those are the only three
that would be found for well it would be
only with valid for this part of the
parsing we find the opening parenthesis
so we know we get we can have now parse
an expression in any closing parenthesis
we continue we loop do the dot and then
we do the same thing we with dot is next
an identifier and of course then the
opening square bracket with another
expression so xeon throws well tries to
throw you a comprehensive errors
something that annoyed me at least in
the earlier today is that that errors
were often you know just missing
identifier or missing this you have no
context you had no way well no not
really a way of knowing what was
actually wrong you know it's still you
can't always know sometimes you're just
missing stuff or whatever and you can
really guess or know what should be
following but often you can right now
the missing thing it would be the name
because a function cannot start with a
function expression so after the forest
was done this is what's left basically
my parcel just just releases a stack of
a race with objects every object is
token and it's time for race is much
like an AST it's not like the classic
AST but it's something that's the young
works on for almost everything this is
the actual AST has a lot of properties
lots of meta information which you can
easily see with a click of a button in
the GUI cecile also releases to token
streams it's a so-called white and a
circle black token stream the white oak
stream contains the white space the line
terminated and the comments whereas the
black dog extreme doesn't the partial
doesn't really care about those it only
cares about line terminators and only to
apply ASI so the first thing I started
with was variable declarations and you
know that's the easy part departure
already releases or already gives me a a
scope chain
which declare which has only variables
that are declared including parameters
or like function expunction expression
names or whatever so I can all find that
back in the scope it's not in the scope
and it is in a ballistic level and so it
will warn you for that if you do a
double decoration the parse it goes from
left to right so the first time it finds
the declaration the old market as being
declared if it finds the second
declaration for the same name in the
same scope you have a double decoration
and you might want to be award for that
because this this example is trivial but
now you know imagine you have like a
long piece of code and you were inside a
loop with a my and you want to do
another Lupin and I just out of you know
you're not even thinking about it you're
suddenly double declaring I and you have
a bug in your code if you would have a
warning for that you're you know you
know say for like two minutes basically
the same goes for the premature usage if
you're using a variable prematurely it
might indicate a problem at least in
Cody cell in my opinion but you know it
might indicate a problem as well as
undeclared variables you might just have
forgotten or missed typed it or whatever
so let's just take some look at some
simple examples for what Z undoes
whenever it finds the closing
parenthesis of a statement header it
checks the next token is the next up mr.
curly brace no problem nothing nothing
is reported if it's not yeah basically
to share two options either it was
followed by lanterman a door wasn't i
personally prefer the second version so
i don't think it's it's an extra error
but you can still get a warning for it
you can disable it if there was a line
terminator then yeah you get a like a
you know bad indentation warning but the
next one is like an assignment in the
header all we have to do is find a token
for an equal sign and since we're
parsing from left to right we know when
we are in or when we're not in a side a
statement Heather so it's really simple
to just you know there's a fly check the
flag if we have a token with an equal
sign and that's it and for awarding the
same force for a week comparison find
double equal signs as a single token now
you have a weak comparison there
there's no other reason for a double
equal sign if you have a trickle a
typical equal sign you know you don't
this is a typical Douglas Crockford
pointing but it's in there you can
disable it if you don't like it there's
an exception for type of type of ours
Orangemen you know always returns a
string and so well I'm fine with double
equals but that makes it slightly more
difficult so where I use the toka string
for all the previous things I just
explained I have to use the AST because
i need to jump back one expression and
that's too difficult to just deal in a
token stream so i went to this if you
have an equal sign that's previously
there was just following a dis token and
the distal is a lead value you've got a
problem in your code basically so you
get a warning if you're a regular
expression followed by a call X pression
it's it's valid I think still in Firefox
so maybe they were removing it but you
have a you might have a problem your
code so you get a warning for this so
this is you know this is what was the
end of it will just give you warnings
for possible indications of your code
you can disable them i'll just show you
in a second you can disable every
warning you want to flow breakers flow
breakers can cause dead code and they
say they can cause that code because in
the first x is not that code of course
because who might be false in that case
it doesn't return in the second one it
does because both the if and the else
they dragged the code the second x is
never executed it's impossible and you
can just proved that statically so you
don't have to run the code to know that
x is dead code and ziam does this and it
doesn't know more complex levels it
checks for switches it checks for try
catch properly all that magic so it does
type inference a simple example is this
anything at any time you assign a value
to a variable you can probably infer the
type if you know the right hand side
type in this case we assign a number to
X so we know that X is type number in
this in the second assignment we know
that X is going to be string at that
point in the middle example we you know
we might still know that it's a number
but for all intensive purposes we show
every type that X might be
it is a terrific example but there are
more examples where this makes I guess
makes more sense because you're not
every time you're able to tell whether a
variable change the type type inference
is can be complex and so anyway it type
the first the type inference makes it
easier for operators if you have a
multiplication it always returns a
number there is no no way it doesn't
return a number it might be man but
that's okay that's still a number type
and so the same goes you know the
student thought tools always return
number so x and y are always a number
the third one is more difficult because
the plus might return a number or my
pretoria string xeon will try to you
know check whether the left and right
are both of number in aggregates it will
return a number but if it doesn't know
or it knows it one of them is a string
or an object or anything else then it
will just you know do a double typing
some operators are transparent and these
are trivial examples but also very silly
it will hardly have to see them busy on
doesn't evaluate the types so it will
know that knowledge title now it will
know that through this type of boolean
and it will just say that okay you know
it for X is he your type of null or type
of boolean and we'll do it is in the
indie well any kind of expression the
same goes pretty double and you know it
just returns both types because that's
that's basically what could happen as
long as they're not literals there's a
simple navigation in a bottom right-hand
corner there was a navigation part as
you click on a number or the arrows you
can just click through all the warnings
and errors and whatever is out there and
you get a blue circle and you can jump
to it really easy really fast and that
in my pin that was really missing for
already classic the classic linters you
know DJ's let you get omega text you
have to go back to your source code line
5 character 55 what helped you know this
made more sense to me if you click on
the description for some descriptions
you get a more detailed pop up with like
a group thing and you have a separate
nap for that so if you just want to know
where the
implicit global's are you can just go
through that and you don't have to go
through all your millions of mornings
there are quite a few of these warnings
and you can configure them all if you
don't want to see it a mini GUI just as
Island just tell them I don't want this
I don't want to see this it will still
check for them under the water but in a
GUI it will not show up so there are
there are a few tools how am i doing on
time listen so bad there are a few tools
one of them is pragmas I've been playing
for this for a while and basically
allows you to pre-process your your code
when you want to push it to production
so you have some unit tests in there you
awfully don't want your unit tests in
your code but you also don't want to
either do a regular expression on your
code because that's not a safe is it you
know is it as it could be and I think
this is really nice zhi-yong knows about
these about these friends that I defined
and it will dim them so we'll not really
you know it will not clutter your your
view you'll just tend to ignore it
because you're more prone to look at the
colors than the grayed out area and it
will still be jeaious I mean when you
run this code it'll just you know do the
assertion but once you press the pragma
button it will remove all the fragment
statements and whatever wasn't defined
is removed so you're in love with is the
debug statement because you were
defining debug up there macro is a
similar kind of thing I guess it's more
for Constance but sometimes I know from
production you might wanna office Kate
your code or you know in my case for the
parser it's much faster for me to just
have a literal rather than a global look
up but for you know for development it
makes my life easier if I just have more
saying kind of things than rather the
magic numbers so that's well that's what
macros come in you can either do it like
the top one just have a literal it will
only star tokens so if you use the name
in a comment it will not replace that
but if you use it as a token it will
replace token with whatever you give the
second version is slightly more complex
you can do like identifier that
identifier and it will replace those two
because I think that's a very common
pattern just to create an object literal
for the flags or Freddie constants on
the right hand side you can see that the
flags object itself not
removed I guess you could do that but
yeah minification of course is probably
like the first thing people do once they
get their hands on these things it does
it there is a special case thanks to
Fabian he's probably somewhere around
here yes for this it replaces the semi
column with a return which makes your
code still minify the skills might be
more legible in case you want to debug
it you can actually string variable
names nothing special there and
something I actually don't seem in the
fires is that it can also it will also
catch property names of you if you
enable it which reduce the size but of
course adds the look of time for global
variables still in most applications
that won't matter and you can often you
know for a hundred Cape script you can
easily say like the ten or maybe 20 k
beautification simply proof of concepts
actually had to rewrite my HT for that
or these not rewrite it create a new AST
because rewriting means that you have to
have a single function for everything
you rewrite I couldn't do it with my
original st it's not preferable simply
because there are no other options but
it's easy to extend them simply because
there are other functions it will save
the load your code the little storage
unfortunately you're not currently able
from the browser to directly save to
your file system and I mean the actual
file system not your local sandbox file
system if local file API but you want to
like load of file then save it back to
the file that's currently not possible
this is not why to my knowledge if that
is possible please tell me because that
would be like a killer feature I guess
as I just showed you it can generate
jazz doc said look General James Ducks
from functions or variables variables
optional by the way because it will
clutter your code kind of it will use
the type of ferns and just generate
those jazz docs as is well you know as
things is right and well that works able
to regenerate existing jazz docks and
will do proper indentation there are
some trivial tools
like converting your code to a Jaya
string which is I don't know something
that that I tend to do every now and
then convert a string back to a code you
can do a bookmarklet you can trim
trading white space because that's
opinion most people's IDs you can show
you Royce T the one the picture that I
showed you before that's just a button
it will show you HD if you're really
interested any hash part in the URL will
be a you know put inside the code editor
so you can easily link to it and there
are some tests both for the parser both
buzzer which just tries and tries and
tries help me out in a few bad spots
right now it seems to be very stable and
there are a unit well not unit tests but
you know test for checking whether the
warning is there but that's literally
like two weeks old so it's not very
complete there's a fixed hoisting button
which will collect all variable
declarations removed if our divorce
statements and just move all the
decorations to the top of your function
it's best practice I guess it can do the
same for function declarations
optionally it will refractor them
properly initation everything and well
you know if you want to do that you can
easily just do it for your entire code
code rewriting it can inject function
expressions or not just expressions with
a function call to every statement and
that function will that make hold with a
unique statement identifier and I
actually use this to create a life a
life profiler which I'll show you in a
second there is this rules so for every
kind of statement you have there are
simple rules where you can just add is
the expression the function call and and
it will be equivalent in you know the
execution of the code of course it will
be slower this is a feature require
requested by matias offering a
precedence tool you have a stupid
expression that you can make you can add
for instance automatically to
disambiguate the whole expression this
is I guess more learning tool than an
actual tool using your code the
whatever branching tool that's a pretty
cool to actually though much useless if
you have a simple function like this
it's super function oh if you have a
simple function like this there are
actually two code paths in this function
there is both the dakotas where it
evaluates x and returns 5 and this
should still you gently with X and then
return six well there are two code paths
and they can do this for pretty much any
kind of slow breaking construct in the
function if you have larger functions
with a lot of code paths beware because
it will take some time to compute all of
them this is it full this is my new
school able to declare your product
you're missing phototype instance
variables say you have like you know the
prototypal a way of doing things you
declare variables just like either you
know this X is 5 but you haven't
declared it explicitly on your prototype
object and that's something you want to
do because you know either for yourself
like six months or for other programs in
your project they will want to know
which instance variables exists on the
prototype this tool let's try to do an
educated guess on what the prototype
object is and we'll add the missing
properties to that object and well I
think it's the best price to do so let's
see real-time profiler so I've got a
simple demo for this can't be doing can
be done from the browser unfortunately
but that's okay alright so demo all
right Oh
so this is the beautiful code it's a JS
1k from the first edition pretty much a
random one that would work like this so
it nothing special happened here is just
seein wit code in the editor I can press
this button now dividual profiler and it
will show you the JS from k and the
right-hand side you can see that the
code is highlighted which was Randy most
it actually is life so whenever if this
code would not switch to say execute it
is more then this would be comrade and
this would dim slightly and so this is
real time a real sign heat map on the
client side no note no nothing as you
can see these are the tests and not all
of them are finished I mean they're all
working to just you know these are
placeholders so don't don't worry let's
get back to the presentation yeah all
right so the client server is pretty
much detached as a client-server I mean
to parse the GUI and in post-processing
so it's very easy to port this to a
server environment or to embedded in
another application you just take the
departure or yeah five minutes of things
just to pick the parser or whatever
integration is easy and the API is very
simple the parts available reasonably
fast as f did a benchmark well you know
it actually I can quickly show you a
simple of course is it bad because I
haven't seasoned it in to do well you
know let's not do that but it there's a
benchmark you can run it oh my you know
on my laptop it does megabyte of
JavaScript in 70 milliseconds completely
parsed which blew my mind first time I
saw it I didn't know Josh could be that
fast yeah so tooling is important make
more tools it's fun it really is fun
once you get into it it's awesome to
create these schools it's you know some
some things are trivial to create some
things are more difficult to create
in the end you will help yourself or
maybe something else you know you can
make either tools for your actives day
programming or you can make tools to
help other people you know you can
create an operator the operator
precedence tool whatever make more tools
i'd love to see more tools uh and i
think that's something that that is you
know picking up we we saw cloud nine I
can see the but there was another ID
there it's also very good so yeah
anybody remember this guy alright so you
know this catchphrase right alright so
we've been wondering about Z and what to
deal with it and that's it Zeon is an
open source I will push the actual code
in a second but you can hack on it you
can look into what does it what it does
and you can push new updates or whatever
if you want to thanks for your time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>