<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Jakub Siemiątkowski: Magic Wand for surface generation - Voxels with JS | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Jakub Siemiątkowski: Magic Wand for surface generation - Voxels with JS - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Jakub Siemiątkowski: Magic Wand for surface generation - Voxels with JS</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WT_BOU9i2Ec" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Jacob just as Martha said and
today I'm going to present topic of
voxels rendering with JavaScript just a
short about me and just started George
Street like who in the December so
before I was a formerly Python developer
so that's my first attempt to ever to do
anything in 3d so just take take it into
account my twitter is Sasquatch or
Sasquatch and give counties rather empty
currently but I will place the cold
after my presentation and the street
does the blog also mainly about Python
currently but i'll try to fix that in
the coming weeks so why voxel octrees
well basically because of this guy
everybody knows the guy I believe John
Carmack the guy behind doom Wolfenstein
quake and the games like that so they've
got father of gaming okay and they're
just about two years ago John Carmack
said that we are currently reaching the
limits of the possibilities to render
simply render graphics using the
traditional methods so what are the
traditional methods well obviously
traditional methods are rendering using
polygons which are just a tiny triangles
and polygons are cool
because this hardware is optimized to
render using polygons also the polygons
are really nice big to show uniform
uniform surfaces but they suck at
complicated scene so a karmic decided to
go that bit different way and he
introduced voxels well nothing
introduced but he said he in the next
engine she's gonna render the scenes
using voxels and factories so forces are
just small cube so we just move the
pixel in 3d dimension trading a tiny
cube so you can get a better
representation of the of the scene there
are a lot of trouble with this technique
implementation is pretty straightforward
traversing the trees very easy
collisions are easy resolution change is
easy we have possibility generate sparse
voxel tree so the nodes of our tree that
don't contain data that need to be
rendered are just not shown it's really
easy to hide surfaces that we're not
showing there are many possibilities to
improve because the topic is not as much
research as the polygon generation but
there are a lot of cons so first thing
she can be expensive because if you move
if you start from the not from the
correct point you just can move back and
forth across the tree and this can be
really expensive and time-consuming
animations suck we'll just think about
moving 5 million or 50 millions of atoms
at a time across the tree structure it
really suck at the moment but will check
about that later and size doesn't matter
unfortunately storing data in an octree
44 voxel it's really sighs consuming so
let's proceed so first we dig into all
trees basically oak trees are just
trimmed with data presentation which
device divides the
the special into small box when each
book consists of eight children and so
on and so on and so on and this house
knows basically some pretty
straightforward I live third where you
can get it and how implemented it well
to be honest I just went through like
thousands of different codes to a lot of
different implementations in C in
JavaScript there is I believe only one
implementation JavaScript but I wasn't
able to contact the outer so I'm not
sure how it works he just states that it
does so old after that I went to check
the implementations of quad risk or
basically just the same idea but still I
wasn't able to find anything interesting
in there so after skimming through some
sickos C++ code I was able to come up
with a solution of my own solution which
is not over complicated and it worked so
basically that's the up three object as
you can see we have the node which is
the root of over over three structure
the road can't the root can contain
shape if you just have one level we have
also position over root we have also
type which is a bit not useful here okay
maybe it is the length of the wall which
gives us the size of the whole space and
the depth and the max depth which are
useful when traversing when adding and
etcetera etcetera so following now
denote the law basically is just the
same it differs with having nodes
reference which is a reference to an
array that contains the child node of
the root of the node which can be either
another note or can be
the stuff that will be rendering during
our scene and the data that will be
rendered I just stored in a flat array
because it faster to traverse roof run
away then going through the whole tree
it also has a parent reference because
it's faster to it give us really a boost
when the traversing girl Rory a location
which is the real magic here the real
deal okay now location I needed a way to
find my find the note i'm currently
dealing with and across the whole
structure and it had to be fixed because
basically we don't wanna guess in which
note we are so i went the bitwise like
idea where the note the the position of
the note inside the parent node it's
just defined by a difference on XY and z
axis so in all this further than half of
the length of XY or z axis we just said
to know set the beach one and if it's
closer to point zero zero just set the
bit to 0 0 to 0 and this gives us a
uniform distribution it's the same
across the hall the node so just the
ticket program now change the rest of
location magic I'm not really going into
the bit bitwise bitwise where it was bit
kinda start and so I decided to just set
the position and save the position as a
string as a triple of Charles so just
traversing deeper into the tree I just
add the current position
of my note inside the parental so just
as you can see in the no list for
example the first node in the in the
array then the second node we just start
with 0 0 0 and so on and so on we just
go deeper and deeper and deeper and
finally adding the the triples of
strings we just end with the correct
position of over note inside the whole
oak tree now some code for way it's not
maybe too obvious but I really try to
keep it simple mmm the recursive adding
of course we there are different
approaches but the recursion is the
easiest to just show you so we just
Traverse across we just Traverse across
the the oak tree we have to as you can
see here current location in our equal
string location and current depth is not
equal string depth so these are the two
the two operations that limit our as
approach the travas traversing so for
example 48 level 3 unless the current
location is equal to 8 times 3 / 111 we
just reverse deeper and deeper if the
current depth is not equal desired depth
you just go and add our node in the
correct way so how the function for
inserting looks like well it's pretty
straightforward we just divide the
string of location in two triples once
again and just following the idea I told
you about before we just select the
correct we just first okay with vesicles
we need to recalculate the position from
string to integer from bitwise to
integer then we can go through
the nodes selecting each node and we
when we down we just add node set the
values and that's all so the last
interesting function here is for
retrieving the node is we also reduce
recursion here and we can use make the
usage of the bit presentation so we just
calculate the boundaries of the note
we're currently in as well as the node
point or object we will be matching
against and if the x-axis if the
exposition keeps in the boundaries of
the note you're currently in we just
select the node and now we can use the
magic I told you about because if the
position of if the position of the
object will matching against the node is
smaller than half of all the length of
for example 4 x-axis or y-axis or z axis
we just set the bit to 0 either way we
set it one and this way we can limit the
amount of the child nodes that we need
to traverse so I can really boost up the
search now for some real life usage I
will just show you two examples the
first one ray casting also I believe
that this graphic shows though we can we
just need to calculate the position on
the entrance and deposition on the exit
we just then we traverse across the ray
through our up three and we select only
the notes that were affected we just
skip the rest and we saw it the note
that were inside the first room and
that's basically all the second one is
collisions the simple bounding boxes
approach is the one I've told you about
the one that uses the function presented
earlier but the other one is a bit more
complicated so basing on the path that
our object already traversed if we if it
did we can predict the road it will
follow
calculate the bounding boxes of their of
this element fire raised from the edges
of the bounding box and this also
selects us just the space that will be
affected and the space that we need to
really take care of that's just a simple
demo I hope that it will work who's this
I frame is a bit more not cooperating to
be honest ok yeah ok so just that simple
collision on bounding boxes just move
here and wallow ok we have a collision
so pretty cool thanks ok nearly half of
the time ok so now fast vocals the voxel
are just I said previously just remove
pixel in three dimension we create a
little cube from it and basically this
that's what we create a word from the
usages of divorces well you might have
thought that they are not used at all
because the concepts that previously but
while they are we used them for example
for medicine for rendering to the images
as well as we use them the way they were
previously used in games I can play the
rounder the whole vaccine the whole beam
engine was created using voxels
unfortunately they had some problems
with efficiency of this engine I believe
in chromatin conquer and red alert games
the units in the game will create
diffusing voxels the outcast game the
whole map was rendered using voxel but
they were cheating a bit there is a game
called foxes time so a clone of
Wolfenstein pretty cool also the whole
world is created of voxels you can just
see it clearly here and just recently
there was a lot of noise about
technology called unlike the detailed
technology well they really didn't
really
released any official info about the
technology behind this the this demo but
not the creator of Minecraft and some
other smart guys stated and agreed that
they for sure might be using optrician
boxes because they're mentioning atoms
for the rendering of the role so Adam
and q PM does the same as well as the
the model shown in during the demo are
just all the same so that's easy to just
cut part of our oak tree and duplicate
it and so buddy that's it also yeah for
sure will you say it in quake 5 and do
for and whatever other implementation I
just found one implementation of voxels
using javascript which is the one
display here from the ipod on the roof
why we don't like it and why that's not
what i wanted to do well basically
that's not a 3d engine but two and a
half d we now have the freedom of
movement here you just can move oh sorry
as you can see you can just move in this
way also it uses height maps only it
doesn't really have a structure so you
cannot have overlapping pixels when
there is a free space between them so
well that's not all that's not what I
wanted to build mmm now show about my
engine is a 3 beta alpha alpha alpha
really I just can't even say how not
finished it is there's still a lot of
work to do but basically i'll be able to
show you just a working demo unit
pinhole camera type thanks Marcus
Pedersen fillet to the trader of origami
3d I use geometrics for calculating the
mastery separation i'm using quads
instead of triangles for rendering and
texturing because apparently drawing a
quad it just uses four moves and joined
quad during using triangles these five
moves so we just have one additional
three i used parts walks of trees so the
space that doesn't contain any data
needed for rendering you just removed
from the tree there is a back face
culling there is no ray casting so it
really affects the performance and still
a lot of things to be done so I believe
that somebody will help me after the
conference with finishing this whoa whoa
whoa sorry once again of course we need
some data to generate a word so I went
the noise generation way and i'm using
Perlin noise for this party noise for
the year hey Moreno is what is that it's
just a set of formulas mathematical
formulas that can power in I believed
invented in like 1980s and that's the
really smart guy because basically
everybody uses that even unwittingly and
guy got an oscar for tron special
effects yeah so that speak for itself
also the effect is used in Photoshop
route filter so probably some of you
have used it already he has a side that
describes step-by-step how the noise was
Heather knows how the noise is made and
how to implement it I believe in C so
probably maybe somebody will find it
useful basically does the noise i'm
generating so does the sample 256 for
256 so i can just generate him
differently shapow yeah i'm just using
some and the idea single rate and some
different calculations which is just to
fit it to my world generating engine I'm
well I was thinking about going the
going to Minecraft way when they just
generate few noises after one after each
other just plating the splitting the
whole generated noise into small pieces
taking this piece generating goes over
this piece and so on and so on and so on
and it gives them proper results but I
didn't either that's all how we do it we
just cremate create an image data array
the size of the canvas
it was x 4 of course because RGB na and
for each pixel we just now the RGB data
to adjust the RGB data to zero and use
paulinho's only to generate alpha and
because it just gives us a uniform
distribution and really it works
properly so then we just have this
moving a little bit read the data from
the creative image can cut the noise in
half because obviously we don't want the
we're not in Himalayas we don't want a
nice to be the size over the whole
generated world and then just render it
so how it looks rendered will basically
something like that it pretty simple
currently as you can see there it's well
it resembles some kind of world not sure
which and just okay with him who short
one so I have a demo of generate
probably noise a small sample because
the performance is really cool I think I
mean you really really really cool yes
as you can see have added some lighting
it's just a word from last day so it
basically you can see that it's working
hopefully I'll manage to just improve it
a bit and have it work better and now
the fun part we need to generate the
world but I just hope that my firefox
won't die 23 is time consuming and
really resource consuming and I will
just tell you in a second one as you can
see it almost dies yeah still
calculating yep yeah free me from here
why it takes so much time well basically
i'm generating a sample of 64 x 64 x 64
so you can calculate from how much boxer
we have in it I haven't yet implemented
any removal of the hidden of boxes that
are not seen so the amount of data that
needs to be rendered off as you can see
he just really really really big and you
can see the noise generated in
in the corner basically it resembles a
bit they think that is generated I will
just try to move it but I just said it's
really poor performance there is also a
zooming but i'm not sure if it's capable
of showing it maybe we'll open have 10
more minutes yeah well it resembles
minecraft a bit even the textures are
used from minecraft so just I just I
needed to really turn off the lighting
because the computer would die even that
it has four cores and well basically why
it's working this way why the
performance is so poor isn't closing all
the tabs Yuri time consuming oh come on
come on come on how do plane yeah thanks
I just really need to show my slides
again yeah everybody's in it now sorry
for that it's going to take so much time
oh come on Firefox
oh nothing strange happened i believe i
just turned the world upside down okay
let's put this really shouldn't happen
oh no no it should it should ease that's
how it went to work yeah I just need to
consume the time of it yeah cool work
okay I'm just believe that I have to
come on slides
okay sorry it just is yeah I just need
to buy a macbook I believe ok kill this
process yeah close the process yeah
Firefox is checking first version yeah
for sure
okay so if you can fix it okay so we're
the slides
why it's not working sorry for that
really you just couldn't get a bit bored
maybe I'll tell a joke on outdoor
cooking okay kkkk uh yeah so it was like
26 leaf
oh yeah basically we will hear yeah I
can trust trampoline yeah you have the
noise the noise possible improvements
why it's working so slow well mmm there
are a lot of a lot of things to be done
as I said earlier we can join smaller
boxes in big round so we just have
blessed data to draw we can for sure we
need to hide unseen boxes like surround
sound rounded by other voxels we can
draw the the whole images with image
data so just the way I used for
generating the noise we can use it the
opposite way we can create magnetically
quick we can create our image data array
but without knowing the RGB and this
gives us a boost off like four times so
it's really cool properly casting needs
to be implemented yeah and some other
maybe some other traversing algorithm as
well as well GL cause currently event
used with WebGL cause WebGL is cheating
and where is that basically with GL
opengl and other lip lips for graphics
just don't allow you to create websites
we just you're just forced to use
polygon so basically building a world of
voxels with wedgie is just building
world from polygon so you can implement
it easily I've tried to implementing it
using the fridge is so just
straightforward because even mr. dupe
created demo of building world of voxels
so it works and summarize were drawing
voxels is slow really it's slow
everybody says that it's too slow
animating a slow sizes an issue and it
really seems impossible right now well
John Carmack states that he was able to
animate like three million boxes but
nobody believes him so probably we
should wait for for him to finish his
engine but still how does the full quota
girl photo from i believe last last week
we have to just everybody said that
there is nothing faster than speed of
light well neutrino just proved that the
wrong
so maybe the same will work on fox cells
and we're just a bit more info you can
ask me about the boxes you can check the
gift wrap after the presentation you can
come to voxels blogspot com which is a
block of guys from Nvidia which use cuda
for rendering the proper voxel images
which work and you can also ask just
karmic how to do it but i'm not sure if
you'll tell you just a short demo how it
should be done i believe that okay so as
you can see as you will be able to see
yeah it's pretty cool so they have
potential for sure the world looks cool
so probably would if with some help from
you guys or with some help from other
guys that will just go dig deeper into
this topic there will be a possibility
to create such things in in with
javascript and if I close that once
again you don't want to cooperate with
me okay just let's demo because you
obviously can go deeper into this topic
or just saying was all so
instead of going deeper into boxers you
can just not working
instead of going deeper into voltage you
can just play it for your March using
floppy music so thanks that's all
questions if you have any issues no
chrome dies Oprah dies and Internet
Explorer doesn't really show the window
so I believe that Firefox is currently
the only the only browser capable of
displaying this data cause it's about
250 megabytes to show in one rendering
so the three a lot of data to be shown
does it does it does the problem great
thank you thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>