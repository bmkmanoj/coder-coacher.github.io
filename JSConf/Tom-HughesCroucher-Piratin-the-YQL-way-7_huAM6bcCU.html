<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tom Hughes-Croucher: Piratin' the YQL way | Coder Coacher - Coaching Coders</title><meta content="Tom Hughes-Croucher: Piratin' the YQL way - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tom Hughes-Croucher: Piratin' the YQL way</b></h2><h5 class="post__date">2013-01-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7_huAM6bcCU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">ah
pirating the YQL way this is a really
random talk title in fact Chris asked me
to do something is like yeah that sounds
good so let's start with some pirate
jokes who likes pirates say are that was
rubbish say are much better what did the
pirate say when his wooden leg got stuck
in the freezer shiver me timbers No so
the point of this talk other than
telling incredibly crap pirate jokes
which will be liberally scared through
the talk it's about plundering the seven
seas of data so the web is this really
interesting wonderful thing and it's
it's full of data there's data
absolutely everywhere there's all these
kind of interesting stuff that we could
just access if only it was a little bit
more in touch so my entire talk is
actually a man standing a computer type
of stuff this is what all hackathons
would be like would be like this in real
life you know there's no Angelina Jolie
there's me sitting there typing stuff
into a computer beard man that's right
thank you Brian so this is why ql hands
up people that use wake you at all
before few people okay good so for
everybody else I'm going to do a short
demo and then I'm going to explain how
this is even slightly relevant to
JavaScript so to start with hands up
people that use SQL right you'll know
why ql to a greater or lesser extent
show tables has given me a list of all
the tables and right now that's this is
all Yahoo stuff which is you know some
of this stuff school some of it you know
maybe you don't care but if I click on
the show community tables we don't have
this great list down the side and this
is every table that anybody's ever
committed and it's really good because
we suddenly have access to a kajillion
sets of data or 737 if you really want
to push me let me make the font big
resort
people a bit too big you're not your
grandma so if we want to do something
with this let's actually start using it
so select star from search dot where
anybody care to guess what search that
web does thank you sir it searches the
web stand up who is that this guy stand
up that man's want a t-shirt for
answering the most obvious question the
whole talk come and simulator will get
your t-shirt so what do we want to
search the web for not Brian everybody
but Brian can answer this what do we
want to search the web for pirates all
right there you go if I can smell and
what a query equals pirates and this is
the thing is I'm such a ham-fisted
drunkard if I can use the system
basically everybody in the whole world
can use the system so we run this it
goes to a web service and it fetches a
bunch of results about pirates hands up
people that use yahoo web search really
awesome thanks guys you're like making
my money but you know hands up people
that use google web search all right so
let's go in search google table instead
because you know this isn't about you
know i was constrained to any particular
thing it's about us kind of allowing you
to access web services in a really
meaningful way so we clicked on the
table it's given us an easy default this
is like a sample thing that you could
run so we obviously in this case would
change from pizza to pirates or ninjas
at such a ninja's just to give it a bit
of balance the force so and then you've
got some Google search results so the
point of this system is that we've got
some really interesting ways interesting
and easy ways to get access to this web
data right and you can start to mix it
up so people will use Flickr most people
use Flickr so let's do some searches
just stuff pirates this awesome
where c 10 t pirates awesome okay so
we've got this stuff this is kind of
interesting we've got a bunch of pirates
but does anybody know how to manually
key urls just off the top of the head
and that's probably my cell phone classy
so nobody knows how to construct these
for the key URLs off the top of their
heads because it's kind of obtuse but
what you can do instead is if we take
one of these IDs and I'm going to copy
it I'm going to paste it in here so
select star from flickered off flickr
photos dot info where ID he calls this
and i think photo ID so it's helping me
not it up there we go right so this
is the thing and if we click on this
here okay wasn't my phone somebody
else's phone everybody throw their
phones on the floor no all right so i
don't know well I guess it's got a skull
and crossbones that's rubbish I'm not
impressed with that pirate picture but
you know so let's get the rest so can
anybody guess let's use SQL what we're
going to do in order to among these two
things together in a queries did
somebody say sub selects no nobody said
sub selects its to select star from
flickr doc photos search wait yeah we're
text equals pirates okay that gets as a
bunch of stuff but what we really want
is we want the idea is to feed into hit
so let's do in this like that that's
going to break because it doesn't want
that it once 10 photos thank you perfect
so now we have the information from all
10 of the photos so instead of that
single URL which is really annoying
we've now got the whole information from
everything which is great right this is
this is starting to get really useful
now obviously I know how much ever
enjoys looking xml so let's switch up
let's go to Jason and this is where YQL
starts to get really useful because
suddenly you've got and I guess people
can probably see immediately this isn't
jason this is actually Jason P so you
can wrap whatever function you want
around this and you can use that in
order to get this straight into a web
application and this jquery plugins
there's dojo plugins there's Yui plugins
there's a node plugin there's a node
module that somebody made right this is
absolutely everywhere and if you need to
get any kind of web services it's bang
on so what is you know what does it have
to do with JavaScript let's that's kind
of dig into that a little bit deeper
does anybody do anything for pirate day
this is what I did for Pirate Day last
year this is a blog post and I basically
decided it can I sucked the web wasn't
partying up it's good photo isn't it you
never see me on a weekend amazing so
it's like what can we do to make the web
more piratey so I built this little
bookmarklet using wake you out and i'm
going to show you now the problem is is
that it works best when you pick
websites with lots of texts but with
small words or easy words so let's go to
fox news
right and I'm gonna cheat a little bit
because I wanted to know he'd been
playing with with the story about the
story about the volcano because i'm
going to show you my system but you know
i was playing with this story earlier so
here's here's this story about this
volcano and you know the big cloud of
ash and i really really really like the
name i'm going to run it yeah oh ya you
look all sounds great what an awesome
name for a volcano so i clicked my
pirate ice bookmark and it now reads so
let me let me read the the first version
the first version reads you know blah
blah blah blah blah site scientists say
that because the volcano is situated
below a glacial ice cap the magma is
being called quickly causing explosions
blah blah blah you know there's all of
this stuff so that's prioritize that so
how I'm doing this is really quite
simple magicians say that because the
volcano be situated below a glacial ice
cap you're under magma be cooled quickly
it's really it's really quite stupid but
you know how did I do that what was that
what was the thing I did so um here's a
table that I built in yql it's connected
to some cloud storage so you can insert
stuff and store stuff it's it's a key
value store it's not yeah it's not
whatever but you can see that what I did
was I swapped the word plane for ship
pirates don't have friggin planes who
have heard that you know so pirates have
ships so that's sort the word planes to
ships and I can also take this table
that I did and you can see actually this
is a really interesting feature of like
oil is I'm not just selecting data yto
lets you insert later as well so this is
one of the really key features is that
it's a full can SQ i'll set but let's
select star from that instead well from
from so start from pie recipe go to
shrink and this is my list of pirate
words what's awesome this site is live
right so if you i'm going to give you
some instructions in a minute but if you
all go here then you also can add pirate
terms and the dictionary would get
better with all
some pirate terms so let's part it up
why is pirating addictive because once
you lose your first hand you get hooked
zing so how does this work basically
what I've done is this is the same URL
we had before and this is incredibly
easy to read font I like one through all
the fonts on my macros like yeah that
one looks like pirate font so its
developer dot yahoo.com / yq l / console
so this is this easy console I've been
demoing and then I've added to the end
of it this environment file EMV equals
stall bloody bloody bar and basically
what this does is this tells yql to load
a bunch of extra tables so I click and
i'm going to get my thing and now you
can see that I've got this extra table
called pirate speak and we've got a
dictionary and then I've also got the
translator and actually what the what
the bookmarklet was doing was it was
calling this translation using JSONP and
then it was replacing all of the text on
the page so it was just in a giant inner
HTML on the whole page so let's have a
look at this I Minister what we're doing
you know we're taking some text or
translating it hello friend I'm a mighty
pirate looking for a good woman do you
know where the nearest bar is to the
left of the right ahoy mate mighty
pirate looking for a good wench and so
on and so forth and all of these words
are getting drawn from this dictionary
that we've got so let's start looking at
some code codes more interesting than
the other stuff so let's see okay make
this a lot bigger so why care all of
these tables all of this stuff that
we've got if I show the community tables
so we're looking at at the beginning
whichever tablet sent all of these
tables are contributed by other people
the one to get a particular web service
and anybody can just write these and
this is the one that I wrote in order to
do the pirate stuff and this is where it
gets really interesting because we're
actually running on the server all of
this is a clear I know so we're using
rhino you've got JavaScript 1.8 and we
possibly have the only legitimate use in
the whole world of e for
because I really personally Haiti for X
quite a lot but when you have to work
with XML it's fairly helpful so
essentially what this table does and you
can see so let's let's break it down a
little bit the you can see that we've
got some keys so when I'm selecting
stuff from these tables I've got key
HTML I'm passing that in and then
there's some other keys so there's a
selects already that's actually getting
passed through automatically for me and
there's a couple of times I could also
have passed in a URL and in the case of
the URL it does essentially the same
thing but instead of getting the HTML
passed in it goes and fetches it using
the web server so it's doing this rest
call to go and fetch it and bring it in
and pass it into all of that you know
the JavaScript's fairly simple I'm
tokenizing the whole page so I'm getting
every dollar Dom element tokenizing it
down into single pieces I then find the
content so this is all the stuff in the
middle of tags there's actual words pass
them out put them into single word
tokens and then just go through my
dictionary and replace find a word
replace it find a word replace it you
know it's not a perfect approach but it
you know it worked for half an hour on a
Saturday so you know what can you say so
that's you know that's a really nice way
of being able to do something really
random and crazy and it's great because
all of this is running in your whose
cloud I don't have to host any of this
you know the only thing I'm doing is is
the bookmarklet literally includes a
script which just runs this and that's
it so it's incredibly simple so the
bookmarklet looks something like like
that so all this literally does creates
the script and then that includes
somewhere mmm don't I put the script I
guess I closed it but that just includes
wake you out so let me find that real
quick now we could just open it show off
the website and this is the thing so YQL
is just so easy to access so that's that
looks like this all I do is I crate
the query which is that so the URL of
the page I call the URL I include it's a
script and Bob's your uncle it's just
jason p right so this is me doing
something really spirits right i mean
obviously you don't need to translate
everybody's pages to pirate but if you
wanted to get access to a web service
it's the same ease and simplicity so
although i do advocate dorking around
with fox news that's obviously that's
obviously worth it let's see I had
something else going to talk about all
right so yeah to give you an example of
kind of other stuff that you can create
pirate jokes and i'm getting all my
pirate jokes of off this website called
pirate jokes Donette you know i know
right it's like who would have thought
you know i searched a pirate jokes and
jokes up net and a particular like this
and if it's going to work are you don't
mean this is possibly the best song on
the internet but you know i was like
booop he's a pop-up pirate indeed so I
want these jokes and it's like war you
know why don't I just knock up a table
to go and get them and actually somebody
was like you should do that in the break
so far wherever you are thank you this
is a really quick table that I knocked
up that pulls all the jokes out of out
of that and I have it queued up
somewhere there we go so you can see
that i'm using a used statement so use
HTTP kid 666 comments made my domain and
not even my parents when I was a bit
younger whatever their it annoys my wife
so it's still working and I've included
the pirate jokes XML that I made so this
is this XML as pirate jokes and then I
can select star from pirate jokes and
it's gone off when it's got me some of
the jokes some of these is really
terrible though why do seagulls fly over
the sea because if they flew over the
bay they'd be bagels I mean yeah I know
right yeah whoever wrote that should be
shot make them walk the gangplank you
know so yeah so some of these jokes are
really quite terrible but
the point is that it took me you know in
order to get that really fast I used
some CSS selectors so i can just a
scrape the page i use some CSS selectors
right here so you can see that i pulled
out the joke set up Doug downs the
elements that I wanted and then simply
constructed some XML iterated over it
and create the XML which comes out in
that format so creating these tables is
really simple and it just allows you to
do all kinds of weird and wonderful
things so what's called a pirate with
two eyes and two legs a rookie hey no
I'm running super fester date so that
was actually it wow that was really
short try yq i will make something
awesome and yeah questions I guess I did
that really fast yes that's a great
question so the question is what about
authentic aid restful web services let's
do netflix who wants to see my netflix
login details yay net net net flix Jesus
somewhere alright so yeah you can do all
kinds of things and this is this is why
it's really awesome having JavaScript on
the server because we were talking about
how are we going to you know how we're
going to make it extensible so that will
work with more web services because
obviously I've written this is true I've
written an xml RPC library in JavaScript
and a soap library in JavaScript so that
you don't have to write nobody wants to
do that and I did because I'm foolish so
let me just look I'm real quick yes my
password is star star star star star or
rain rain rain rain rain because i'm
using a mac um so these are my our
credentials have people used both people
familiar with OAuth if you're not for a
move I will you should get familiar
quick because Twitter about to turn off
the basic auth and at that point you
will not be able to use the Twitter API
without knowing off so it's a good
reason to get familiar and you can see
that we actually have
if it turn on the community tables let's
do that somewhere there is a netflix
table and you can indeed access netflix
using OAuth using the table so we've
done the description it's told us i need
a term as ckn SEK so let's select star
from that wire see k equals that and ck
s which stands for consumer keen
consumer key secret basically these
inside the brackets term anybody want to
give me a term for a movie pirates yeah
alright original there sir alright I'm
going to copy that I need to sew and
this table is enforcing HTTPS which is
fairly sensible given that it's
accessing stuff with secret someone on
so yeah there we go Bob's your uncle
you've got that and we can actually look
at the source of the table 2 or of the
hell netflix has gone again you do and
yeah i mean it's you know it's fairly
standard JavaScript come on Chrome there
we go it just includes the OL fibrous
straight off google code runs them and
then just some old signatures its to
like this but you can do three leg as
well so if it's not until my dad vs in
table what about
build it proprietary some somebody just
has that web services not totally
exposed to everybody we see where you
can use it I mean you don't have to put
in the tables so you saw you know oh it
just randomly went off wow this is what
happens when your own flash people it
just takes over so yeah you can see that
you know I mean to be honest yeah
loading stuff off kid 666 calm is not an
incredibly you know legitimate place to
host content but you know it works for
me so you can just include any domain
the other thing is these environment cut
these environment files you know you can
set those yourself you can just make
your own and host it somewhere and it's
just got all of your stuff in and not
anybody else's so yeah any other
questions this question is a normal
session cookies yes it does cookies how
does it make you pull in the information
vibrations or web pages of using the
yahoo local store and never page like I
have
Eliza right so the question is how is it
pulling its it does use the HTML table
which means that yahoo respects the
robot stop text so if somebody has a
robots.txt that says no robots then so
be it you can kind of get around that
but we don't really advocate it because
it's naughty bad bad pirate yeah I'm a
poet any other questions great hands up
people that have got beer right
everybody else go and get a beer the
chest is at the back and then fill out
some crock for vets that's it I'm done</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>