<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Douglas Campos: dyn.js - 100% invokedynamic JavaScript implementation | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Douglas Campos: dyn.js - 100% invokedynamic JavaScript implementation - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Douglas Campos: dyn.js - 100% invokedynamic JavaScript implementation</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/XhGnhXJNYQ8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone first I want to sq oh excuse
me my English is very hard so if you did
understand anything please manifest
yourself well I am q a Mac go I am oh
let's forget it I am Kira max no one's
no knows me by dulles that's okay I work
basically all my free time I'm open
source i'm kinda objected i recommend
the service to anyone that wants to
evolve on the career or to learn tons of
things so gap get involved with a
non-person open source stuff i
contributed a really project la with
this kind of stuff like the players
generation and whatever and I'm a Java
developer so you can throw the tomatoes
the question is why to build a new
JavaScript implementation so why no this
is all ok but it's complete it's pretty
complete even it even has the e 4x
extensions like no I don't think that
the he was a it was the first one if I
believe and that is why why build a new
implementation just the geek appeal just
because it's fun to write some kind of
this kind of software so the main reason
was it's because it's fun in all open
source projects in growing extended to
my life if i don't have fun with
something there is something wrong
definitely so i want to have some fun
and my main motivation was because of
this i love a bench source so i started
to find some project to experiment
if the Evoque 10mg stuff and I think you
probably aren't really able to read
anything I'm surg ok this is the commit
log from rhinos open-source degrees
circa nine ish nine solar I know is
nearly a very very elder project when
one who was release it we got nearly the
release of Java ciao that's slow
painfully slow this GV m it was on the
beginning it has very cool features very
interesting ideas so before more worried
about the write once run anywhere stuff
but you also so we can say that Rhino
developers are the miracle guys they
made amazing things to make this happen
like optimizing things by hand bypassing
all the limitations of this GV m to get
some performance some at least some
decent performance so I ask you let's
collect further right guys they made an
awesome job without Souls without
everything they could have they could
have today so my main idea I don't want
to bash Rhino project or not this means
they were amazing the problem is we are
talking about ten years more than 10
years of software developments and all
softwares open source software or
commercial software whatever suffers
from bit were odd usually time spaces
and people Oh every factors is tomorrow
or this tomorrow is about two years
after that but that's not that's lots of
question so Java 7 came with all lots of
new features very cool stuff i like
javascript is away why not try to put
invoke dynamic in the coast of Java 7
the support for dynamic language support
inside of rhino well when they get dry
no they didn't have the tools we have
today so the majority of things that
were hard like generating by travelpod
coach are generating deep low level
stuff we're done by themselves they
basically they are they were generating
bites and deeds and all that stuff
directly to files to emulate what the
java the java matching would expect
that's pretty steep to learn so i
managed to run to understand the code
base but i have you frustrated because
well we have better tools today and
that's the main motivation i wanted to
have fun i wanted to contribute to open
source learn new stuff so that's the
challenge I want to build an
implementation but why not so I took the
challenge and made three premises for my
development I assumed that at first I
wanted to have fun on the second I
wanted to learn something new that took
me a whole lot of work and the best of
all if possible have beautiful codes
that makes things easier for these
people but having beautiful cousin
compilers compiler is usually are things
they had some guys with long birds and
stuff like that though on the dungeons
or something like that so
yes you can we can have beautiful code
or at least we can try hard to have it
so I started to try to write a
friendlier compiler why not again we
have the GPM the GPM is a very beautiful
piece of software ok it's damn hard it's
them complicated they did lots and lots
and lots of optimizations this means
that they optimized at the GPM for one
language that begins with j ends not
JavaScript unfortunately so they make
some structure to make the language
runnin and runnin fast we're talking
about what how the invocation of code
works on the gvn when you need to make
an invocation the JVM on the compile
time need to be aware of what types are
involved so we're talking about static
typing that usually works with dynamic
language don't like it majority of
people i like both but anyway anyways
the idea is the tvm needs to know the
type that's calling and the tower type
that will be called so this made this
makes the gvm aware of types and put
opens the possibility of very specific
and powerful positions when you have
object object orientation you have some
invocations own instances are like
objects by the way you need to know the
object that contains the method why
let's see let's imagine that seeds a
function and I need to know where this
function are I just can invoke it alone
I have another case on Java that we try
to implement some kind of duck typing
but it's nearly impossible to have its
unfortunately because of the static
static typing so when I
also has polymer fees I need to use some
stuff like interfaces that this guy
swear that his be but on the reality
he's just implementing Twitter open so
on the truth is that he is implementing
a contract ok that's pretty full of
boilerplate let's see what we have new
on the GDK 7 we have dynamic invocation
what does this means i don't know this d
type it's whatever i don't have any idea
of what type is that when I want to make
the invocation of the c function the
promise of the GPM is that we need to
know the both sides of the conversation
like we are talking about objects
passing messages so when i try to make
this invocation it won't even compile so
the invoke dynamic instruction and all
the gvm support means that now i can
have an intermediate partner on this
conversation that will knows how to find
the target method that i want so when I
made this invocation after passing with
this guy I'm able to make a direct
invocation without now in the other side
that's huge that's huge because we can t
move tons of calls that were use it
before just to make City vocation happen
so I we have on 0 be like for example
lots of evo caters classes that we
generate only fly just to glue some Ruby
code with some Java code and begin
passing methods between them that's
pretty huge about 3,000 files we've
invoked dynamic we can remove everything
that's great
but unfortunately there is a catch this
is vm only supports so I don't have a
like new invoke dynamic on the Java code
we know that Java language sucks its
effect we can do pretty awesome things
with it we can we can even do awesome
pretty things with vb vb yeah so the
idea is that even if java language sucks
we can make it work like as we have vm
supports the true language of the gvm is
byte code that's binary stuff hard stuff
and pretty complicated to do this is an
excerpt of the bytecode basically it's
binary data I don't want to do that the
Rhino guys go very closer to that they
have some helper classes that that
generates that kind of stuff so we have
better tools now I want beautiful coat I
don't mess with binary data so i started
to think about abstraction how could I
abstract the byte code generation that
it could be better so we begin to see
the Enterprise enterprise labels that
people gave but anyways I made the
internal language inside jvm to make the
byte code generation a little bit
friendly that's tight script it's
another project that makes things a
little bit easier let's take for example
this JavaScript code I'm not making the
compiler yet I just making what I want
to do I want to print something in bytes
colder will do that ok forget it when I
go to the high level of these are single
byte codes I will get some instructions
like the final constant find the system
out people that
every student Java knowing noses I get
out very able on the dividing the
outfield on the system then I turned in
on the stack and make the invocation to
the print method that's pretty usually
forget it I have a better form to do
that I want to use as I I have a static
language I want to use what I have on
the ides and that stuff to make my life
easier so I didn't dsl this is the same
cold this decoder generates they're ugly
bytecode so you can have a new code
block and all the constructs on the tjs
you use this code box as building blocks
so if you take you have a big problem
you split season be smaller part and
this makes things a lot of either so I
don't want you as generously JavaScript
developers to understand jeez just
compare that's all a lot easier to read
and makes easier to explain what's
happening under the hood so I can let's
see you on the simple further the reward
and this time we're talking about the
ggs aot compiler ahead of time so i have
this code that stupid javascript code
what i need to do to make this work i
need to define this decimal little and
it's retrieve the current scope we have
the global scope on JavaScript I don't
like it most people don't like to but
anyways there's n I need to assign this
new object that i just created or in
this case a primitive type to disco so i
define the literal which this is moral
amount of code then i find in fetch
minded microscope and finally I quard
the variable the
Valerie on the score three snippets of
code it's complicated I know but at the
same time I have comments and I have
very small splitted parts so we can
start talking and that's it there's more
there's more we did I don't know if we
will be able to read but there is an
invoke dynamic instruction with a string
passing like ding j has a scope define
where did this thing go when I make this
invocation I'm sending such a GVM and
instruction to do that stuff and that
stuff has a signature I thought that it
returns nothing it receives an open
string and Nadine Adam is the common
type for all the objects and primitive
types on the ice cream on the ggs so
this code will go to this framework that
was released it on the GPM language
sandwich a very deeply technical
Congress that happiness I don't know why
I wasn't there so this framework is mean
to make dynamic link possible so i can
have on piling face like generates in my
bytecode I don't have the type
information but I can make the linking
of some dynamic code with some static
calls at runtime so I get building type
conversion for free I just need to tell
the framework like I have a primitive
like string when I when we try to call
some metal on that primitive string it
gets out a box it oh I made wrong okay
it's even a number it's the same thing I
will take this primitive do a new number
and then invoke the method or something
like that
I just can't convert the types even two
classes I can compare it in the make out
the conversion under the hood so on the
invocation patch I don't need to worry
about that if the type is a even a
superclass of the number or whatever the
framework will take care for me i have
another thing for free gene Dinah link
comes with from monomorphic in mind what
hell is death so the idea is that I do
remember GS is dynamic we like it so but
we need to know the types how do we get
from the agency we need whoa whoa whoa
problems we when we want to go to see we
should instruction like scope define and
will receive this call scope define as
this linker the cause inside because
base and let's not worry about that but
I instead of I needing to have now the
times before hands I can do this linking
with a nice ugly if code that apparently
six but the truth is that we are not
making the invocation by ourselves we
are just in passing pointers to the jvm
do you remember these pointers that's
awesome the c pointer is a poor boy a
pointers for functions and that stuff
now on the gvm because of java 7 we have
pointers to methods they are called
method handles I don't even know how to
translate these super cookies thank God
so I need to find that targets for my
invocation then I I want this target i
have a method on the scope class name it
define that receives the name of the
variable and whatever that i want to put
on my scope so i get the pointer
this weird API I just need I tell what
the second nature I want to find what's
the name of the method where is that
matter if I know this class even though
we have some freaks chew even not
passages and these will be returning me
just the pointer I I won't make the
invocation the framework will make the
invocation for me so the GTM do all the
hard work for us in the sense that I
don't need to worry about if Michael be
slow when I make these pointers the gvm
looks like looks it as if in he knows
that news that I beforehand and this
invocation will be potential alignable
because of this we have a new idea lying
around we have more language on TBN like
Ruby and Jay ruby Psion we had Ryan Ryan
itself is walking slowly on to invoke
dynamic and we have now done ginger yes
ji ji is that I can they are trying to
agree on a common protocol for our
object object oriented language so that
I can make an invocation between jruby
in chin jsr JRuby in Ryan or rot every
all the language that implements this
protocol will benefit from all the GI
chi that GV m has the just-in-time
compiler announcing lining even beating
language we are starting to cross the
bridge meeting between the language and
G charter this game so we can go get
lots of performance when how much time I
have five that's great gjs is being
released it no I just who do the push
it's open source as it should be I am
listening it now under an oppressive
list and so do whatever it was it's a
little better than the wtp that worldly
sense that the guy talk talking before
so that's it the current status gres is
a beginning project I do the most part
with a friends for a leash and report
jelly a very smart guy so we are walking
slowly it's nowhere near to complete I'm
even it struggling to have something
working on that but it's huge it has a
lot of potential and I need to remark
something I was talking on Brady vs
conference that happens happening in
bridges ear on March about this project
and three months later who have the same
idea the big fat Oracle so i might be on
something don't don't you think the
current stops what works and what won't
work we have an es 3 grammar because we
we wanted to go straight to the six but
it was not so well defined it so Brandon
like help at me like I go when he when
he talked oh we're we're getting there
so we probably will move to es6 some
very awesome we have a perch away or chi
compiler so every time you create a
function we strike on pilot to bytecode
so you will have an lit overhead when we
start your program but for a long
running applications like no like stuff
you will be better spot because the gvm
will take care of much of the patrons
ations you can do we have this auto
boxing stuff so i can pay as a preemie
chief to a metal that receives the
number instance and visa versa and
whatever and we start tingling means
boolean stuff that Aoki em if string and
gather get some results like that we
have the prototype I'd prototype chain
working to closing the stock why did I
is it gene J is because I want to have
fun believe me if you are not making
things worrying I know we have works
that need sometimes we need to do things
that we don't like but we need to try
after all usually we are done worth
working only for money we're working
because we like to program usually if
you don't actually recommends Ruby make
you a better person a better programmer
and second learn something new never
stop learning i wanna i wanted to use
good abstractions and i'll learn it a
lot on the process keep it simple I get
myself straight Rapids on my arm be a
design Frome's so I need to basically
here right from scratch two times that's
learning and finally why not make
beautiful codes that's the whole idea so
there's on Marty we have unwrapped oh so
let's see if I big to be readable does
anyone knows then were the
transparencies sorry whoa thank thank
you so the results from NGS compilation
is there ginger yes Oh dejar Dodger so I
just run this and we have a nice help
telling us we have a repo in this rebel
shows us what's happening under the hood
by now we are on the development phase
so we have the beginning fo been split
all over the console so I can make
something fun do you remember the code
that I talked before the stupid verge
cheese equals 1 let's do it looks like
what is it for us that's the idea I have
this a symbol dump of bytes code so we
did assign the variable but let's
printed so that is it I hope you gotta
love this project it's it has a lot of
work to do yet but I I can see the
potential because when you try to be
careful about having more clean code
base you can have more contributors you
can get people to understand what's
happening in everything wins everyone
wins so that's it people that's all
thank you
little question
I don't want to even talk about
performance now just because have you
ever seen that I didn't put performance
on my main goals the idea is you need to
make it clear we often Charlie Nutter a
guy would admire a lot told me one time
that if i want to make java faster java
coach i should write code sickos on java
so that's the idea we are trading off
for now building isn't clear the
clearness for performance but this thing
will change because the gvm are making
tons of work that i wasn't doing that
people from wine we're doing it's than
themselves so things tend to improve on
general codes that was simpler and clear
run about four to eight times faster
than JRuby so there's no reason that we
can couldn't get this benefit here to
societal I will worry with performance
after we get expect compliant that's the
idea any questions
though so thank you I have one more
question okay uh is this a full free
time project or full trying through full
free time I have some friends helping me
the Jane on this thing and I hope we
have got mark on triple trees now right
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>