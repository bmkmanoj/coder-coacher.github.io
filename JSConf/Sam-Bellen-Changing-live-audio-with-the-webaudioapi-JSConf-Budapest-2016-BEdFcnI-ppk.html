<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Sam Bellen: Changing live audio with the web-audio-api - JSConf Budapest 2016 | Coder Coacher - Coaching Coders</title><meta content="Sam Bellen: Changing live audio with the web-audio-api - JSConf Budapest 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Sam Bellen: Changing live audio with the web-audio-api - JSConf Budapest 2016</b></h2><h5 class="post__date">2016-06-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BEdFcnI-ppk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi so I'm changing live audio with the
Web Audio API yes I'm going to talk
about today but first let me quickly
introduce myself I'm some belem I'm a
front-end engineer it's made with love
you can find me on the Internet as some
me so I'm a guitar player I play guitar
in my bedroom in my living room just at
home and I have this collection of of
pedals to put effects on my guitar and I
got interested in how to display these
pedals work how did these effects come
to life so I started researching making
the pedals myself with electronic
circuitry and stuff and then I got the
idea like a we have the Web Audio API
maybe I can create this with just using
javascript so that's what I try to do
and that's what today I will just try to
explain how I did it and you'll get a
live demo yeah first the first thing we
need to do is get the sound of the
guitar in the browser so you can hear it
through the speaker and you can
manipulate the sound of the guitar with
the Web Audio API it's actually kind of
simple first you create a new audio
context which is the basics of the Web
Audio API then you get the audio input
of your computer so I just put the
guitar as a microphone basically I
connected it to my computer use
navigated up guess it getusermedia and I
can access the microphone this has been
deprecated like this and it's been
changed to navigator dot media devices
don't get user media but it only works
in Firefox and in chrome behind an
experimental web platforms feature flag
so for now I use the old version because
it's better supported and then basically
we're almost done getting the sound of
the guitar into the browser all you have
to do is create an input nodes from the
media stream we just cut from the
microphone off or from the guitar and
connected to the audio context
destination which is just the speaker's
that's step one I will demo this later
but basically that's all you have to do
to just get the sound of your guitar in
your browser and
you play guitar on the app step to add
effects to the guitar sound because
that's what I wanted to do I just wanted
to alter the sound you use some effects
and make some cool noise basically then
you have a few of different pedals which
you can find on most pedal boards the
most basic one is a volume pedal in
which with which you just can change the
volume of your guitar this is quite easy
because in the Web Audio API you have
something as the gain note which
controls the game or just the volume you
can create one which is odd with just
doing all your context or create game
and then set the game which is usually
between zero and one or zero percent and
1 percent then you connect the input
node to the gain nodes we gain out to
the audio context destination and you
have a chain of input gain and output
and the gain in the middle will control
the volume of your signal signal I have
a quick demo of how the gano it effects
your audio waves this is just an audio
wave of a fixed node but again out of
100% so the volume is 100% if you change
it to 50 you will see that the waves are
getting thinner if you put it bigger you
will see the way is get bigger but they
get clipped on the top of the top and
the bottom that's basically how the gain
no it works it just decreases or
increases the gain of your signal this
is the audio chain I talked about if you
just want to put a volume pedal on your
guitar sound or on any input sounds this
is what you have to do inputs do not
gain out outputs
done then the second one when you play
guitar unless you play country music or
so you want to have this little bit
gnarly sounding guitar or metal rock
whatever doesn't matter you want it to
be rough this is usually a distortion
pedal or a first pedal or an overdrive
pedal does it really matter it's all
something that affects the waves of the
sound waves in a way that it sounds
rough
dirty doesn't matter
we can do this with a wave shaper note a
wave shaper note is basically just a
note that you can create and you can
give it a mouth curve and it will apply
this curve to your audio signal it's
very complicated to calculate these
curves so there's one very good one on
stackoverflow there's a link in my
presentation if you want to see it it's
just a lot of math stuff which I don't
really understand but it works I can do
I can show you what it does because we
have the basic inputs I'm single again
it's just the sine wave if you apply the
formula or the curves to this sine wave
you will see that it's suddenly becomes
a totally different way if it's get
chopped off at the bottom and at the top
and this is what makes your sound
actually rough dirty proof you'll hear
this later as well one of if you want to
make it a single path it's just again
input wave shape or node output it's
always this simple you have the input
node you have the output which are the
speakers and in between you can just put
as many audio nodes as you want in this
case the volume and the distortion are
quite simple the next few examples will
be a bit more nodes in between but the
basic stay the same inputs audio notes
other audio nodes outputs then a third
pedal which you can commonly find on
guitar players or keyboard players or
whatever is a delay pedal a delay effect
is basically something that takes your
sound and repeats a few times while
failing out so you have this delayed
sounds after you play it to make this
there's a delay nodes in the Web Audio
API it's the same we do audio context or
create delay you can say the delay value
in this case it's one second you connect
it from input to delay node to the
output you have a delay but in essence
until I know it just delays the sound
and it doesn't really repeat it so if
you want to really make the delay effect
of the you want to rig ATAR it's a bit
more
complicated it looks like this we
basically just send the delay it sounds
too gay no it's decrease its value send
it back to delay back and forth until
the gain or the gain is zero so the
volume is zero so it will stop repeating
that way it fades out the next one is a
flanger pedal anger is a bit like a
delay but it has a dynamic time or
duration or speed of the delay so it's
not going to repeat like pom pom pom but
it's going to be like a sine wave going
up and down fast and slow and to create
a sine wave if we can use an oscillator
note oscillator notes are basically just
audio notes which create a sine wave or
a square wave just one big stone you can
use to make a synthesizer for example it
has a few values you can edit the most
important ones are type which is a sine
wave for a more a nice sine wave or a
square wave or a sawtooth wave or a
triangle wave and you can set the
frequency which is basically the tone of
your of your sounds if it's a height if
it's a high frequency it will be a very
high tone with a low frequency it will
be a very low tone you can put any
number you want but humans usually can
just hear that the frequency is between
20 and 20 thousands but if you want to
annoy your dog just put it on five you
will hear it you will not you will not
be happy I will here you can see and
also they don't know it by default it's
a sine wave which is just a sine wave if
you make it a square wave it's something
else
triangle wave sawtooth that's all
something else and then you can control
the Hertz which you will see it goes
faster and faster the higher the the
Hertz go and I can annoy you and let you
listen to the sound which is kinda
annoying but that's what is what an
oscillator does it just creates one one
sounds that just continues to be
annoying
one of the cool things though is that an
oscillator note it creates a wave so if
you want to create a dynamic delay like
in a flanger you can just create the
wave of the oscillator to the delay time
the delay note we saw earlier which you
can set the time so it will just go up
and down constantly depending on the
speed of your oscillator so the delay
will be dynamic a.k.a flanger basic
flanger then the last pedal I want to
talk about is a reverb pedal a reverb
effect is usually a bit of eco
atmosphere behind the sound of your
guitar or your keyboard or whatever
instrument you want to play and we can
do this with using a convo over note
it's a bit more difficult because you
have to load an impulse response file
then get an array buffer out of it and
then decode the audio data and put it as
a buffer of the controller nodes and
basically what this will do is an
impulse impulse response file is just a
file with characteristics like is a big
room it has some echo that
characteristics are in that file and the
convolve inaudible projects these
characteristics on the sounds you're
making so on my guitar I didn't make
this impulse response file myself but
I'm Chris Wilson has the Webber the
playground which has a very few very
good example or a few good examples
actually and then if you want to make
the effect it's also just a few notes
together with the convo over notes and
you get the the effect you want the
river actually so there are a lot a lot
of other notes I'm not going to talk
about all of them you have and as
analyzer note which just analyzes your
auto audio and you can get data like
frequency or stuff like in the first
slide I add the wave which you could see
it was just an analyzer node analyzing
my microphone if a big quad filter note
which is just to filter some frequencies
channels better and merger shell split
channels from stereo to mono or the
other way around I don't know to go from
left
right or if you have a seven points one
Dolby Surround system or something to
just position the audio inside a space
which can be 3d and you can use a
paranoid for that or a dynamics
compressor not-it's just to compress
audio and I'll go do it go into details
of these because they're cool but
they're not necessary for my
demonstration then it's cool that you
can create all these things but as
you've seen some of these effects are a
little bit complicated you have the
schemes and if all the notes working
together so I started building a library
where you can just create easy audio
effects it's kind of working
I used it there's still a lot for it to
do if somebody's interested you can
still help me or give feedback whatever
you want but basically it works like
this you want to have an input you want
the distortion or delay effect import it
create a new distortion or delay effect
and chain it all together that's all you
have to do so I'm quite happy with the
results already and now let's see if it
works
I'm not really good and playing guitar
in front of people but we'll see I've
made this small application on top of
this library I was I am building which
is just an interface to create the
effect notes first off you start by
creating an input node and let me see if
it's going to use my guitar yep if you
this is just now going from the input my
microphone to the output the speakers
which will just let you listen to the
guitar it's nothing effect yeah there's
no effect yet it's just input output
guitar but then you can start adding
effects like volume pedal which is now
the full volume but you can put
unless to create just control the volume
next up we have distortion it will just
make your guitar sound super badass the
next one is the delay effects I'm going
to put it a little bit faster so you can
just keep some going and fades out
eventually you can still control the
parameters but that's something you can
play with for hours and hours so I'm not
going to do this next up is the flanger
let me switch off the delay turn these
on because it's badass and then this is
the dynamic delay which goes faster and
slower waving sound in the audio that's
the flanger and then last the reverb
effect in the background
so we had this is basically just using
javascript to control the sound of my
guitar pretty cool Danny we're not
finished yet what if you have our hands
of not view if you don't have our hands
available to control the mouse because I
have my left hand on the guitar my right
hand on the pig but I want to switch
between effects and stuff there's
something called about MIDI API which
we've seen yesterday night it was very
cool so I've tried to integrate it with
this little app I have so I can just use
my feet to control the switching on and
off of the effects what I did is I built
this stuff which is just a piece of
aluminum with some switches and a Tesla
inside it it looks like the schematic is
roughly this hardware is just buttons
then they connect to the tassel which
has a socket connection to a server
running on my laptop which just converts
the signal to a MIDI signal basically I
wanted to put do to create a MIDI signal
on my Tesla but it doesn't support it
yet because the node libraries are just
bindings to the native core MIDI or the
windows engine experience so now I'm
just having a socket connection between
my laptop and my my pedals and hopefully
they will work because yeah Internet
network other web MIDI API is very
simple you just request MIDI access you
get a list of devices and then you
basically just choose the device you
want in this example I take the first
one but they have name so you can just
search for the name of your device let's
see if it works
I just turned off my inputs which is
nice I can just
all of the effects on my pedalboard
which is me you can you can just buy me
the pedals and use it but where's the
fun and that's just created yourself and
this is the end of the presentation
thank you if any of you guys are
interested if a few project and get up
which is the audio effects library or
the pedal board the little app you saw
the oscilloscope which is to create the
waves visually and my presentation is
also in get up so thank you I'm a bit
early so maybe questions is somebody
else who wants to come and play this
week we could do a Q&amp;amp;A or you could just
do it like a concert you know why that's
not going to happen they won't have any
questions I'll bring the microphone to
you
hopefully it's not gonna feedback hi
awesome presentation thank you how's the
latency it's sometimes really bad
sometimes super good it's depends on the
amount of tops fear you're running in
your Chrome or in whichever bus you're
using I found out that using Chrome has
the best audio that's because in Firefox
you have this annoying sound in the
background but Firefox does have very
cool developer tools to debug your audio
chain so I just use them to develop I
use the Firefox and Chrome just to
listen to it but yeah the latency like
you asked is just depends on your
computer on your tabs on the amount of
effects you put together that kind of
stuff all right thank you cannot do
superfast solos because you'll hear it a
bit later okay
hottest one
I want an extended demo please it was so
short please show us the pedal again
that was so nice I want to get a video
please just do something with the guitar
and use the pedal please that's my
question
I'm very happy is for questions so what
do you want to hear let's just create
some dirty stuff does anybody know where
a nice riff or something that's not a
riff that the whole song
quite hard because create a lot of cool
sounds and just play around with the
stuff let's see what we get for maybe we
get noise maybe we get something very
funky I really love flanger by its
sister makes everything seems like it's
a psychedelic rock band was playing then
it's all the pedals and all the settings
but I don't think that's interesting if
I can 70 be kidding I'm a musician
so I'm going to do this</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>