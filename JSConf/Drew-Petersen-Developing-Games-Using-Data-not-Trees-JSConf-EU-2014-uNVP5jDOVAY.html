<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Drew Petersen: Developing Games Using Data not Trees | JSConf EU 2014 | Coder Coacher - Coaching Coders</title><meta content="Drew Petersen: Developing Games Using Data not Trees | JSConf EU 2014 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Drew Petersen: Developing Games Using Data not Trees | JSConf EU 2014</b></h2><h5 class="post__date">2014-11-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uNVP5jDOVAY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in a world with one man versus his own
mind and 24 hours this is a game jam
there's just one problem his game
asteroids totally different this time is
actually not different oh man it's just
asteroids that's kind of a problem uh I
can't even shoot that's even worse oh my
gosh okay uh it's not different at all I
mean it uses all this cool stuff typed
arrays physics I had all this fun making
it but the players don't care about that
at all what am I gonna do there are only
a few hours left before the deadline
maybe I can like quickly change it may
be all right what can I do here all
right um okay I could try like maybe
making the ship huge like all right I'll
try I'll try that just make the ship
huge okay all right now I got a big ship
cool uh yeah it's the same game that's
that's really a problem what okay
asteroids tiny that'll be hard to hit
that'll be fun people like hard games
right right thank you oops
okay well now it's just this is just bad
so that's that's just no good that's no
good at all um okay what the heck am I
gonna do like Oh what if you control the
asteroids yes I could do this this is
something i could do this is something
that would win i would this is awesome
okay yes yes yes awesome totally cool
let's do this oh wait wait how will I
have the time this is not an easy thing
to do i'm totally changing my game how
is this gonna how's it can be possible
all right yeah that's right I modeled
everything is data okay that's awesome
yeah right right okay cool uh right what
does that mean I total I've oh crap I
forgot ok ah they're like a database or
something cuz databases are pretty fun
right no no they're not they're really
boring actually they're really quite
boring and they're also not a game you
know like in fact if you like go up to
one I hit the action button a few times
you can kind of like capture one and
eventually you know but then it corrupts
your save game and you really kind of
get screwed over because then your game
is gone so my god I've devolved into
meme I'm oh god sorry sorry I'm back
back totally back okay alright alright
so what what are we talking about here
okay well before we discover what we're
talking about let's talk about how
another version of asteroids might have
been created okay one that uses object
an object oriented approach as opposed
to this mystical data concept so with an
object-oriented approach you'd have your
asteroid your ship and if your bullets
you'd have maybe some other things they
would inherit from each other that might
look like this on the left is an
asteroid and the right is a bullet
they're very similar they all inherit
from a renderable thing which inherits
from a kaleido beset the atom smash
which renders from a physics entity
which renders from or inherits from a
like a global world thing great the ship
is a bit more interesting the ship might
actually inherit from keyboard control
because we want me to move it around
right and there's going to be a lot of
implementations done in each of these
areas of the hierarchy especially the
ship itself right we might have an
update and if anyone saw hunters talk in
the other room he was talking about
update functions you're going to have
that kind of threw out your hierarchy
you're going to have concrete
implementations of things such as draw
it's actually gonna be in the ship even
though something's renderable it needs
to know how to render itself and you
know shoot of course is going to be in
the ship as well because the ship shoots
great so if we wanted to refactor our
code because this is great code right
you can totally tell what's going on
here if we wanted to refactor this fake
code to enable controllable asteroids
what would that look like well maybe
this we have to physically take our
inheritance tree on the left there we
have to take the keyboard control
density rip it out and put it into our
asteroid entity as well as just
physically copy code like the handle
input handling like keyboard and stuff
and the shoot function probably a bunch
of other things too probably have to
handle copying over data properties and
it's pretty hard to know what those are
but they'd all have to be copied or
paste it over into the asteroid that'd
be kind of tricky and of course keep in
mind the real world is definitely a bit
worse you know this is a game jam right
you just write code you get it done and
that is really messy code so it would be
worse so pros and cons real quick you
get kind of faked out all of your logic
is local it like appears to be local you
know all your logic is in the ship or in
the renderable or in the kaleido bowl
but really it's spread out throughout
the entire heart hierarchy as well as
the state your position rotation
shapes images things like that are all
spread throughout this large object
hierarchy and it's kind of hard to
reason about it's also hard to optimize
since you have to deal with these fat
objects which may have different
interfaces and you don't know it's hard
to do that so um you are restricted from
making certain types of optimizations so
that's the object-oriented approach the
data oriented approach which is what my
asteroids game is actually made out out
of has three main tenants the first is
that functions operate on data not
capital o objects and what I mean by
this are because obviously new object is
capital oh it's valid syntax ok ok ok
but what I mean by this is that an
object meaning a fat object something
that is hair inheritance sorry inherits
from many other objects or has methods
attached to it anything more than just
simple data so we want functions that
are relatively pure there's always going
to be more than one of the data that
you're operating on there's always going
to be more than one canvas even though
it's a game in the browser they're
probably going to be more than one for
double buffering or or like effects or
something there could even be more than
one ship there could be more than one
asteroid of course there's more than one
asteroid and the final tenant is to not
inhibit optimization if the developer
chooses to do that and we'll see how in
a little bit mostly that means bashing
things up so this is not perfect I
barely know what I'm talking about let's
move on so it all starts with a pocket
and this system this thing that I wrote
I wrote it obviously but I didn't write
it to be a library that you all use I
wrote it to demonstrate these ideas so
just keep that in mind so it starts with
a pocket and a pocket is just a
container just like your pocket and it
also has a tick method meaning that
every time you want to update the pocket
or maybe call something you're going to
call this tick method it's not really
important but just so you know that it's
something that's constantly running
once we have a pocket then we can add
component types to the pocket you mean
like like and react you know maybe well
no no not not at all actually um
components in reactor are they have they
don't have a ton of state but they do
have a little bit of state or they can
have state and they also have methods or
like functions inside of them so these
are a little bit different here's an
example of one this is a rotation
component type it's the definition of
what rotation means in terms of data in
terms of properties it has an angle
property and a rate property and they
both default to 0 and if we look at the
pocket when when it's a when its told to
create one of these is going to pass in
an object the cmp object that we then
use to attach our properties to so this
is a pattern implying you pass in
options and then you get back you get
back some data there's also on the
further slides the shortcut which is CMP
type just to save typing you know but it
stands for component type so in further
slides will see that instead here's
another example of a drag component
meaning something that slows down over
time it's being dragged upon by an
external force there's no functionality
here there's just the data required to
implement drag which is a percentage of
velocity kept each frame or each time we
call update we'll see how it works in a
minute but just notice it's just data
these are just kind of plain objects
once we have our component types our
definitions once we have once we have
that we can then request a key from our
pocket because your pocket always has
keys right now a key is simply a
collection of component types that will
be turned into instances of that
component so in this case we're
requesting a key be made that points at
rotation and drag and we're passing in a
default value of rate 0.92 the rotation
this is important because I said earlier
it defaults to zero so we're overriding
that value the key that we get back is
just an ID and it is a number it is
simply used to index into something
else this is important later I swear but
it's just an ID here's a bigger example
I know the code it's a lot of code it's
not important to notice all the details
here it's only important to notice that
there are several different things in
quotes those are the component types and
then the thing after it are the options
passed into each component so in this
case there's no options passed in the
thrust or drag but rotation has it has a
default value default rate so this is
actually the ship this is how the ship
is defined in the asteroids game we
define our points and some other things
which I'll get into more so once we have
our component data and our keys then we
can write systems and these are going to
modify our component data and here's how
that looks like this is the system or
effectively the functionality required
to apply thrust to to something in the
game so first of all has a name it has
requirements these are the types of data
that it operates on and this system will
only be invoked if those types of datas
exist and finally what the system does
is its action the system is invoked it's
given a list of keys that have all these
different components and then finally
also given collections of each component
that you can index into and this is what
that looks like you can c VAR k equals
keys we're looping through each key
using it to index into the collection of
position shapes and rotations now the
actual code that does like in this case
render point shape and the previous
slide was a was apply thrust that code
is not on these slides just so you know
it's not like a magical low and suddenly
it moves this is just showing the
structure around it because that stuff's
pretty much the same in most games okay
here's another example of a system or
sorry here is the the input thrust
system but there's one more little
shortcut that I'm going to be using on
further
clydes and that is that rather than in
previous in this previous slide the
system is invoked once and then loop
through you loop through each key
manually in this case the system is
invoked once for each key and it gives
you the data that you want the your
position rotation thrust it's just a
shortcut don't worry too much about it
but just wanted to point that out okay
now at the beginning of this we talked
about player-controlled asteroids right
okay so are we ever going to come back
to that we've been like been talking for
a while now all right so yes the first
step is rotation we want to take our our
asteroids and make them rotatable
because the ship can rotate around
that's the first step to moving around
so here's the rotation code this is it
this is all the code responsible for
rotating something it has a rotation
component and a human control 01
components how scientific sounding and
you might be wondering well what's up
with that and also why is there no data
being passed in called human-controlled
01 and the question or the answer is
there isn't one and this is our last
components or sorry our last part of our
pocket system and those that is that we
use labels as anonymous components these
are just ways to label a key as
something this is the definition of an
asteroid it has a position a shape a
bounding box and a rotation it also has
an asteroid it has itself it just has a
name it just has a name of asteroid and
this is useful because for example in
the asteroid ship Collider code we only
want to talk to asteroids you only want
to deal with the asteroids and a ship is
very similar to an asteroid actually the
ship also has shape position and
rotation so our asteroid tag or label is
the only thing that makes this system
only being vocht for asteroids instead
of all these things and just the pocket
gives you a little warning I don't know
that you can even see that but if it if
it doesn't find it
honi just says hey I didn't find it I'm
assuming it's a label I hope it's what
you meant okay it's an Outback to this
rotation this is our first step in
making the asteroids controllable we add
we have this tag called human-controlled
01 or this label what happens if we just
add it to the asteroids maybe something
awesome let's find out use our asteroid
down here can everyone yes perfect
alright i will add this in save it
refresh hey that's not working at all
what happens what happened well what
happened is that we have our
human-controlled 01 that's great what
didn't happen is that if we look at the
system itself it accepts a rotation and
it uses the rate to increase the angle
of rotation the logic here is not that
important what is important is that this
component rotation as a default value of
zero for the rate so on our asteroid we
need to make sure that instead of just
using the defaults we use an actual
value so here's what that looks like
here's our rotation save refresh we've
got asteroids moving around I swear
they're moving around but hold on a sec
let me undo my changes from before those
really boring changes asteroids are
moving alright alright cool
so there's step one okay yes now let's
make them thrust so to make them thrust
here's our thrusting code we look at its
requirements it has a position rotation
thrust and human control 01 we already
have human-controlled 01 looks like all
we need is thrust so here's what thrust
looks like in the ship let's add it to
the asteroid here's our asteroid over
here and refresh okay we're spinning
we're spinning and we're moving okay yes
we have a cloud of asteroids okay we're
really getting somewhere now let's make
them shoot okay so if we look at the the
asteroid all we need to do is add this
projectile launcher thing which is on
it's already on the ship so let's just
add this into the asteroid this will be
this should be pretty good let's see
projectile launcher and the value was
launched force that's how much that's
like how much power it how fast it goes
hit refresh oh yeah look at that they're
just I've got I've got so many asteroids
just shooting now and they even kill
themselves look oh I can't you there
there we go yeah just killing themselves
um it's not even challenge anymore for
the ship he's just like yeah alright
that's cool but now let's make the ship
get hit right let's let's reverse things
here so this is the code that is
responsible I mean minus the actual code
but this is the system that's
responsible for colliding asteroids and
the projectiles okay the only thing that
is specific to asteroids about this
system aside from the name which doesn't
really mean anything it's just a some
string is the asteroid label and
remember that we just added that
asteroid label to the to the asteroid
for the heck of it so that we could do
things like this so what happens if we
take the system and instead of telling
it to operate an asteroid
we tell it to operate on chips okay
let's try that so here's our projectile
Collider going to change this to ship
keep in mind if we go back to ship real
quick it has a ship tag or label hit
refresh and now if we chase there we go
it killed itself but if we chase the
ship eventually where'd it go eventually
if it hits if it hits okay I should have
made the ship bigger so you can see that
the bullets are not being hit by the
projectiles anymore or the the asteroids
but the ship yeah
go get it okay trust me it dies ah okay
all right all right I'm gonna do it for
real now here we go wait wait here we go
for real okay it will be impossible to
miss right ah okay you got it okay the
Hunter has become the hunted now the
asteroids finally have their revenge
okay then there's still tons more work
to do tons more to do but but not today
because there's just limited time in
this talk yeah we could we could finish
up this this this thing so talking about
the data oriented approach and some pros
and cons these are kind of the same
thing I call them pro cons because
they're sometimes they're beneficial
syndromes or not one logic is spread out
you have many systems your logic is in
each system and it can be can be kind of
tricky to have them all spread out
because it's all these separate systems
but it's also kind of nice because they
are separated your state is completely
consolidated you have components that
the systems operate upon and the state
the only thing that changes are those
components because we cannot we can
create a system that operates on a whole
range of components it's a little bit
easier to optimize if we wanted to make
all of our positions backed by a typed
array for fast integer math we could do
that because all of our all of our
positions are actually stored in the
same same kind of area same same data
and as you just saw it's extremely
modular we could take labels we could
take code and just kind of move them
around and get totally different
functionality well pretty different
functionality so I did mention databases
quite a long time ago so what what what
does that mean well there's actually a
pretty good one to one analog between
what I've done here and the concepts of
a database or at least at a you know
fuzzy level let's just say so our
component types our definitions are
roughly equivalent to tables it's like a
schema we define a table each property
is a column in that table such
our position has a our rotation has a
rate and angle those are just like
columns in a table our components are
like the individual entries in the table
they're the rose you know each
individual instance of rotation is just
a row in the rotation table our keys are
primary keys that's why they're called
key also that I mean the pocket come on
let's sleep ended up being pretty good I
think and then finally our systems are
like stored no they're not like stored
procedures at all they're more like
queries and business logic kind of mixed
together which is like PHP land or
something but it's okay because it's
it's game development it's fine all
right and just to show you how much like
a database this really is if we take
here's our pocket our pocket instance
our container of things if we look at
all the different components in it and
just log that out just stringify and
lock it out we get this it gets
interesting if we kind of scroll down to
the positions this is the position for
key number four you know this is like
entity number four or thing number for
our values are right there this was a
snapshot in time at when this when this
snapshot was taken when we stringify
this the x and y values were 7 19 and
397 so it's like an instant save state
almost and with just a little bit of
tweaking you could actually have save
states with this it's not not too hard
another example is rotation here's the
rotation for key number 4 it didn't
actually have an angle set but it did
have a rate yay okay cool I'm sure
you're all wondering did I actually
finish the game jam right that was
that's probably the number one question
on your minds right now and get ready I
hope you're prepared I didn't um there
wasn't even the jam it was just for this
talk I'm sorry if I confused anyone I'm
sorry if you feel jipped but that's
that's all it was there was no game jam
and you know I hope that's okay thank
you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>