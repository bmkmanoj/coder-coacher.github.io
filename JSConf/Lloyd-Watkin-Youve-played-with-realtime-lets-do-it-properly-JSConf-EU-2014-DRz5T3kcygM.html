<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lloyd Watkin: You've played with realtime, let's do it properly... | JSConf EU 2014 | Coder Coacher - Coaching Coders</title><meta content="Lloyd Watkin: You've played with realtime, let's do it properly... | JSConf EU 2014 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lloyd Watkin: You've played with realtime, let's do it properly... | JSConf EU 2014</b></h2><h5 class="post__date">2014-10-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DRz5T3kcygM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone yes I'm going to talk to
about real time in the browser he's xmpp
I'll try and keep it quite light because
if you feel like me or a bit frazzled
and tired so okay so what is XMPP so
it's the extensible messaging and
presence protocol and this was developed
back in nineteen ninety eight at time
when people had lots and lots of
different IM clients you had AOL instant
messenger yahoo messenger people at icq
so you you know you cure your sort of
coup de coeur every couple of minutes
and it was a bit of a rubbish situation
because some of your friends would be on
one another set will be on another one
and you'd have to either run them all or
you know ignore some friends or not
talking online it's a bit of crap
situation so some guys got together and
they thought well what we'll do we'll
build a system let you know you can have
lots and lots of different servers but
they'll all be able to talk to each
other and it was originally built as an
application called jabber and but since
we exchanged XMPP when it came part of
the ITF and it's not a single server or
a single piece of code is a set of
standards so anyone can implement it you
can have proprietary servers open source
service and there's lots and lots out
there yeah and this is the big advantage
of it is that it's federated so all the
servers can talk to each other without
doing any extra coating so like a show
of hands who here uses XMPP okay keep
your hands up that's not right okay so
whoever you here using whatsapp yeah
that's a few more okay course a whatsapp
is basically a hacked version of XMP
they just used some of the bad bits and
not another good bitch but anyway who
you uses facebook chat yep okay who you
use the hip chat cool right so you're
all using XMPP so I think there's maybe
two or three people in the room I
haven't put their hand up so who here
has a smartphone yeah so you all use
XMPP you just don't know about it um
yeah it's widely used in areas such as
finance government it's used for a lot
of messaging systems companies that do
building management use it quite a lot
so what my point is it's often not
advertised that it's been used so why do
I think XMPP is important well we're
seeing a continuing growth of real time
on the web and you see people bring it
up new real time systems or a quite
often and you watch how it goes and they
just keep making the same mistakes that
were solved in XMPP about 12 years ago
14 years ago and then you see them try
and do things like I would be really
cool if we could run it on multiple
servers or talk to each other and they
do this hacky piece of crap again these
are already problems that we solved with
ex mpv so people shouldn't keep making
the same mistakes um the other in area
where it's quite interesting as well is
with the rise of WebRTC so peer-to-peer
sessions or great but there's no signal
in WebRTC so how do you find each other
and the way that's done currently is
people use these crappy meet me URL so
you both go to a website you both maybe
have to agree some terms and you maybe
have to be tracked and maybe this system
doesn't have all the features you want
but this one does and your friends don't
like that one so why do that when you
can both just log into an account and
share the details directly and there's
also moving back towards the sort of
decentralized web so that the Snowden
revelations came out and you know big
targets like Facebook and Google and
Apple it's very easy for people to go in
and request information whereas if we're
all running so of smaller servers or
small groups
actually to get information about what
you're up to is a lot more difficult and
then the last point is if you also use
XMPP you don't just get some chat
messing stuff you get things like
presence which is I'm available right
now I'm away I'm busy you get address
books you get pub/sub you get PHP
session set up you get tons and tons of
stuff for free without doing any extra
work so I'm quickly going to go through
some of the fundamentals of XMPP and so
stanzas though this is just some of the
terms you hear stanzas are just chunks
of XML so there's three basic stanzas so
one of them is a message or which is
just sort of chat messages sending
updates the second is presence which is
basically I'm online I'm offline there's
a really cool feature called priority
which I'll talk about in a second and
then the third one is IQ or information
query which has set and yet so it's
basically like you're very simple HTTP
verbs okay then there's also the jig so
the did or the jabber ID it consists of
three parts so first of all you have
your server so in this example it's
example to org I then login as user at
examples org I then have this third
thing on the end call a resource which
is really interesting so even though
this was designed back in 1998 it was
designed with multiple devices in mind
um so going back to the presence stands
we talked about a second ago if I'm on
my laptop and working away my laptop has
a presence priority of five and so when
people send messages to my bed so that's
usual example to org messages get routed
through to my laptop when I walk away
from my laptop and have my phone which
has been happily sitting there at
present priority of for my laptop goes
to sleep drops down to presence of
priority of one and now anyone sending
messages to just my bed will get routed
through to me
on my mobile phone so you can always be
sure that messages get to the people you
get to the device that the person is
most likely to be using so clients so
more we say with XMPP is that your
client should be very very light and
this is really good for mobile phone
usage because we don't expect the
clients to do any work whatsoever so you
save a lot of battery that way you
connect to the server in three different
the three standard ways connecting one
is just a standard socket the other one
is a long polling set up and the newer
one is the web sockets and the other
thing that's really good is unlike other
systems which polar server to do real
time that's quite heavy on your server
and your clients here setting up new
connections you like is there any
information no thanks great so it's very
intensive boys with XMPP data gets
pushed so if you imagine kids sat in the
back of the car you know I there right
there yet we there yet very annoying and
what we do in this case is just shut up
and I'll tell you one more they're very
different servers so all they'd all
there they were you there for is to
route messages they set up these secure
connections between each other and they
handle the authentication and then third
part is the components which is pretty
much wear anything you develop is going
to be held so the servers allow you to
implement custom business logic you can
have standard components or you could do
something you know it's terrific to your
use case a nice way to build components
in javascript is to use node X and PV
component additionally sorry they're
completely server agnostic so i could
write my code in JavaScript and
connected to a server running Lua I
could then get rid of that server and
replace it with a Java server and I
don't have to change anything about my
code all right so why don't we see it
being used by web developers well the
big advantage of XML is the
extensibility part but the big
disadvantage is to developers is in
order to achieve that extensibility
use XML and I don't know about you guys
but when my sort of interactions with
XML have been via soap and that's a
horrible experience it's also not very
nice to deal with it in the browser it
can be slow and you can sometimes lose
data and things like that um and also
when you compare it to Jason XML seems
really verbose and ugly and old
fashioned it's just yeah so what I've
done is I've created a library called
XMPP for the web and what this does is
it converts messages to Jason for you on
the server and then send it down to you
over a web socket and this makes it much
nicer to develop applications using XMPP
but not be exposed to any of the nasty
stuff that as web developers we don't
really like all right so what I'm gonna
do now is probably get this completely
wrong this will be the funny part of the
talk I'm gonna do a live demo and show
you how easy it is to build a very
simple application but I'm going to need
some of you to help me out so it's a
participation exercise
okay so i'm going to write a little
application here and what it's going to
do is listen for incoming chat messages
draw a little circle on the screen and
allow you guys to move it around but the
interesting bit here is you you're all
going to connect on servers all around
the world and you're going they're going
to talk to my server and perform the
actions so if you pop over to that URL
and in the meantime i will start coding
up something
so I'm just gonna drop this over here
oops
okay so the first thing I need to do is
log into my server so let's get that
done so all i have in this very much
like the clients you'll be loading is an
md5 library because a hash of a string
is 029 a2f take the first six characters
that gives me a nice hex color code I
have jquery and i have a web socket
which is being delivered from XMPP for
the web so
ok so that's listening for my incoming
connection Christ and now I'm gonna ask
you to log in for me
and for any of you about to get excited
ahahaha okay cool right I'm online I'm
connected so I can start doing nice
things so when I was talking about the
dude just now you'll see that i'm
connected as lloyd a buddy cloud org and
i have my resource which has been
assigned to me by the server i could ask
for a specific one by didn't in this
case body cloud needs coincidentally is
a distributed social network that I work
on you should check it out it's it's a
cool play with ok so next thing I need
to draw a circle on the screen when i
get new connections so
and so what I'm going to do is hash the
incoming did
do-do-do-do yep okay so if if I already
have it obviously you don't want to draw
again so
otherwise I'm just going to draw myself
a nice little circle I also some CSS
which will handle the circle part
and what I'll do in here as well as I'll
drop and identify it
okay and what I'll do then is I in order
to show you the fact that you are
connecting from different domains I'll
change the border color of a circle to a
hash of the domain that you're on so
ok ah
sorry I show got some music for this way
you shouldn't I
and lastly actually we're just leave
that cool right so I've let me draw
function so next thing I'm gonna listen
for a chat message I promise you won't
be too much longer so socket dot on XMPP
chetan actually first of all forgotten
this I need to tell the server online
because I may be connected but haven't
told it they want to receive updates so
first of all let's just say to the
server I'm online
cool right I'm online and i want to
receive updates okay so suck it on xmpp
dot chat dot message nestle passed me
through a nice message which is just the
content and the who sent it to me so
let's go so first of all we need to draw
a circle and then we just need to listen
to what you've said to me and just shift
your circle about so if i create the
hash again okay
ah
so if we want to go up we will pick up
our
no it's minus equals and we'll just
shift it by 10 pixels
cool is anyone actually logged in to the
client everyone logged in okay yeah cool
okay so up down and we'll just add 10
pixels on I'm going to go right we will
or left even go ahead left
now hopefully oh look someone's already
there so if you guys want start shifting
I'm guessing it's not actually I'm
guessing I've got this wrong um okay
well in the UK we have a show called
Blue Peter who if when they build
something they always have the line
here's something I made earlier so
here's something I made earlier and
there we go that's everyone moving run
screen from all the different servers
and it may be a little bit of lag but
that's because I am connected to a
server on East Coast the US that's then
connected to my xmpp server which is in
Munich which is then connected to a
server somewhere in the world depend on
which one you guys have connected to
that then talks back to a server on East
Coast the US and then comes back to
Berlin to talk to you so it's going a
long way but as you can see that's
everyone starting things from various
different servers so there's polish
servers us servers British servers
French servers American servers but
they're all talking to my server in
Munich without any additional code
so in summary XMPP is a secure scalable
a real-time messaging system it's
scalable because when you get a thousand
users rather or tens of thousands of
users you don't just you know cluster or
get more servers you just create a new
domain stick a new boost so it's very
scalable it really how it is essentially
it's a really easy way to help rebuild a
decentralized web and you get lots of
extras for free as well so when I keep
it very light hope that was okay thanks
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>