<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Chris Lilley: The Evolution Of CSS4 Colors - CSSConf.Asia 2016 | Coder Coacher - Coaching Coders</title><meta content="Chris Lilley: The Evolution Of CSS4 Colors - CSSConf.Asia 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Chris Lilley: The Evolution Of CSS4 Colors - CSSConf.Asia 2016</b></h2><h5 class="post__date">2016-12-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PqDw0ZPYIq8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so I've just been introduced
apparently now knew who I am so I can
skip over that part the talk and as you
can see it's about color CSS for color
css3 color is what you already use its
boring stuff well I was co-editor of
that too but you will know about that so
that's boring so that's me we already
established that and that and that and
that only that but the the CSS for color
part that's the interesting thing that's
what I'm here to talk to you about today
actually i lied i'm not going to talk
about CSS for color except for like one
minute at the beginning and two minutes
at the end because here's the problem
okay this is what we have in CSS for
color as you can see we have kurma here
a hue angle here we've got a full back
color and an alpha right understood i
can just stop now right yeah the thing
is you can look at that you can see what
the syntax is what you don't know is
what does it mean Chris why would I ever
want to do this so what this talk is
actually going to be about firstly some
basics of our color then we're going to
talk about how you measure color then
they're going to talk about CIA la b
which is the cool thing that i'm telling
you about that you'll understand why you
want it once you've seen it then i'm
going to talk about displays and print
does anyone here well ok everyone who
uses CSS you will use CSS for websites
does anyone here use CSS for printed
material as well a couple yes ok good
well I'll talk about that briefly and
then lastly as I said we'll get onto the
CSS for color where I show the relevance
all of this stuff so the first thing
what is that what is this device here a
prison right what does a prison do we do
flex light and what's the results of
that it makes a rainbow right it makes a
rainbow ok so we've already established
that you already know all about
light you know that it's made of
different wavelengths and that they go
through glass at different speeds and
therefore you can turn white light into
a rainbow and the white light actually
consisted of all those colors originally
so this is good we already know
something light is the range of
wavelengths visible to humans I
mentioned humans because like if you're
a bumblebee you can see some ultraviolet
and if you're a snake you can see some
infrared and so on so there's nothing
specific about those colors those colors
don't exist in nature those colors exist
in our brain in our eyes it's a human
colors as a human response or at least
the colors that we care about we don't
actually know much about bumble bees and
snakes and how they feel about color so
here is a rainbow don't worry about the
numbers but it's roughly 380 nanometers
to 700 nanometers that's the range of
wavelengths that we can see and as you
can see we got all the other colors in
between so that's the visible spectrum
the next thing we need to know is you
you have to don't worry about all the
labeling here there's only one thing you
need to know about which is the retina
which is this set of nerve cells at the
back the rest of it you can just assume
it works and for the purpose of this
talk that's it so what's the retina made
of well it's made out of these cells
these cells and these cells and these
cells and then a big black layer at the
back which basically stops that like
okay the light comes in from here this
way due to do goes through all this
wiring who designed this stuff goes
through all this wiring and then hits a
black layer there which it gets absorbed
and we've got rods which look roughly
rod-like and cones which someone in a
fit of imagination looking through a
microscope decided with conical ish and
then you can see that they have
basically connections to these pink
cells this one is connected just three
of them and this one's connected to one
and etc and there's also these blue ones
which connect groups up laterally so
there's basically think of this as a
circuit there's lots of things happening
here even before we go on these these
these from the optic nerve these
out the back of your eye and go after
your brain so even before the signals
have left the I lots of stuff has
happened to them it's actually really
complicated there's groups Sarah was
talking about animation said that our
human visual system is particularly good
at detecting motion it is the parts on
the outsides of our I a really good at
detecting motion really poor at
detecting color the bit in the middle is
actually it tends to average things over
time so you don't notice changes fast
but you really precise on little color
shifts so we have two completely
different visual systems which we use in
tandem to build a mental model in our
head of what the world is okay great
that's fun so let's have a look there
are three different types of cones and
if you read a bag textbook they'll tell
you they're called red green and blue
cones no they are not here is the three
cones and you can see that this one has
its maximum response in yellow this one
in yellow green and this one in bluish
violet so we'll call them LMK and s or
long medium and short wavelengths you
can also see that these two are pretty
much the same and this one hardly does
anything at all so let's look at that on
a logarithmic scale now we can see much
more yeah these two are definitely
almost the same and now if you were
building a system if you're building a
piece of electronics to measure light
you would never design it like this
right these two you could probably
replace that with just one sensor course
they're almost the same you would have
you would have nice sauce bandpass
functions like this to keep nice no our
eyes on like that at all this one in
fact all of these three cells have
evolved from the same cell they've just
diverged and got different sensitivities
so we now know that we have these and
these do not give us a red green in the
blue they're giving us these sorts of
strange values then all of that
information goes off to the brain to
this bit of the bat actually goes
through a bit here in the middle which I
missed out I never mind that the lateral
geniculate nucleus and then we goes to
the human visual cortex over there
where it we get this entire visual
processing happening going on so let's
go back from all the complicated things
to stuff that you already know about
color now what I want you to do is you
see the black dots in the middle there
and we need to look at that try not to
let your eyes move and I want you to
look at that for about 15 or 20 seconds
just keep looking at it don't let your I
track around just keep fixing looking at
that same black dot 15 20 ish do you see
anything green right that's weird that's
a white slide completely white slide
with the dot let's do that one again Oh
different colors time so look at the
black dot trinocular eyes move just keep
looking at the black dot 10 seconds 15
20 oh yes so these are called opponent
colors why are we seeing this what
actually happened is the the rods that
sort of the cones in your eyes use a
particular pigment which absorbs light
and over time if it keeps getting the
same input it kind of bleaches out he
gets tired and then if I suddenly switch
to white you'll see basically the
inverse of that you'll see the opponent
thing what this tells us is that all
those nerves what they're doing is
they're producing opponent colors colors
which are opposites of each other and
we're very good at detecting changes
where something changes to its opposite
color and you'll see the relevance of
this later on when I get onto la be next
thing you need to know what what color
is this yellow right it's a piece of
white paper which I took a photograph of
in a hotel room but I switched off the
auto white balancing on the camera so it
came out as yellow and if I have to do
the same thing outside it would come out
as light blue but if you are with me in
the room looking
that you and I look at it and say this
is white why because we evolved to be in
a constantly changing visual environment
the Sun goes behind a cloud and it takes
the light level down and it changes the
color balance and none of that is
relevant our eyes will just filter that
out and we will just see the scene as
having shifted slightly not all the
colors changed right so our eyes are
constantly doing white balancing we
adapt to whatever we think is the
brightest most white like white and all
the other colors shift to adapt to that
and if you don't do that then you get
things like this where people have wars
on the internet about exactly what color
dress was okay so color what we now know
about color is it's a subjective
sensation in the human brain and it's
caused by visible light acting on the
human eye and then been going through a
whole bunch of layers of neural
processing okay that's a great
definition that tells us about color
what how what can we do with this I mean
it's really complicated now if we want
to know what a color is we're going to
have to measure how bright it is every
different wavelength like a spectrum and
then we're going to have to have
electrodes in the brain and measure all
the impulses from all the nerves and put
it all together and it's going to be
really complicated and we can't possibly
do this actually we can it turns out to
be simpler than that simpler than you
might think we can treat the entire
visual system as a black box we can say
here's the input tell us what the
outputs are like and we can build a
model from that so next stage imagine
that was all basics that was all the
easy simple stuff whoo-hoo so a
measurement you want to measure color
let's start off with this as a spectrum
this is a graph of how bright a
particular thing is at all the different
wavelengths from read through to violet
and you can see this has got all these
peaks so from that you can tell what
color it is right and these guesses what
color it is I couldn't tell you frankly
looking at this this is actually white
it's it's a light bulb
um from that you can't tell you can't
tell at all and you can have a totally
different spectrum also looks white or
green or whatever the color it was just
the spectrum alone doesn't tell you what
color it is what can we do about this
well looking at that graph we can see
that we actually know that brightness
responds like this if in the greens and
yellows we see a lot we see those colors
as very bright enough here in Reds we
see it as very dark and the same for
blues and violets so we already know
this this is one response that our I
producers and in fact there is a channel
coming out of our I into the brain which
is basically how light or dark is in a
particular area that we're looking at so
that's one thing remember I showed you
these cone responses so you can see
where that graph comes from it's
basically you just add them up together
good well I've gone back why did you do
that it's gone right back 20 tell me
that I'm not in a loop please don't let
me be in the loop yes good okay so a
visual matching and you can have
different spectral things and they look
the same even though the spectra are
different and we can use this to our
advantage so here's an experiment this
was done in the 1930s so what we have is
two grand glass blocks and a person
looking and on this side we have three
lights this one is 700 nanometers so
it's a dark red and this one is 546 so
it's a yellow green and this one's 430
so it's like a violet color these are
actually made with mercury vapor lamps
so they could do the same experiment in
different laboratories and always get
the same result and on this side we have
the mystery light which is actually a
diffraction grating you've got you make
a rainbow you take one tiny slice of the
rainbow you shown that and then you say
to them they've got three knobs or
sliders whatever and you say match that
match that color keep moving these until
you get the same color on both sides and
then you do it again for a different
wavelength and so on and so on and you
have subjects who have an awful
patience because they have to do 700 of
these experiments to get the result so
you'll notice I've also got another set
of these lights on this side why is that
it turns out that sometimes for some
colors you could not match them at all
right you've got red turned all the way
down and you really wanted to make it
less red than that and the way you do it
is you cheat you put the colors on the
other side and you make the color trying
to match more red until it matches
that's fine that's just a negative
number negative numbers aren't very
popular in 1930s because they're doing
all their mouth on slide rules and they
don't want that so they've got this
table of how to match with these three
particular weird lamps and they convert
it to something called XYZ cie is just
that the organization that did these
experiments but ok XYZ gives you three
numbers and if two colors have the same
XY said value they will look the same
they will be the same color to you so it
gets rid of the negative numbers also
why is the luminance that was the graph
I showed you how bright particular
colors look so it gives you the
luminance straight away it's also an
additive color space what do I mean by
that if you have well that's actually we
do have there's a yellow light shining
there and there's a purple light shining
there and if Martin was here he could
make these moving together so they
merged on the stage producer cover and
if I have the X Y Z value of that light
and that light and added them together
it would tell me the color of the
mixture will appear in the middle I
could actually predict it you can do
math with XYZ and get the right result
so that's cool that's useful there's
some problems that exercise it here is a
graph of luminance from whatever it is a
hundred 20 and you can see that mid gray
is a way over there which is not very
handy because it would be kind of useful
if it was in the middle so luminance is
not what we call perceptually uniform
another thing with XYZ is that white
adaptation isn't handled remember I
showed you the piece of white paper and
how we always see it as white even if
it's a yellowish lamb
or if it's bright bluish daylight
however not only does that change white
it changes all the other colors as well
so let's have a derived system will take
the active I said and will change it a
bit we'll take the Y component and we'll
put a bit of simple math on it so we get
a scale which gray is in the middle like
that there that's the plus of L from
nought to 150 is right in the middle
great excellent much better than that
now we have a and B so we did these
opponent matching experiments together
we and we find that this this color here
there we are that color hair if you
stare at it for a while you'll see that
color and this one this one if you stare
at it long enough you'll get that color
and so on so these are the two axes for
colorfulness put that together and you
have a nice 3-dimensional color space
with lightness going up there and a and
B now the trouble with that actually you
try to match the color using RGB right
you've got three sliders and you're
trying to get the color and it doesn't
really work and you like oh how do i get
actually get there fast it is difficult
it'd be much easier if we looked at the
angle around from say the a axis and
just went round like that how far round
and how far out so we can take a baby
and just take it from take it into a
polar coordinate system like this and
then we get that that's nice so now we
have L coming out of the screen like
this likeness and we've got Hugh as an
angle and at this point some of you are
thinking hang on I've seen all this
before I seen it before we've got hsl it
is exactly the same thing doesn't it you
got white you've got black you got an
angle you've got a saturation if any of
the other noticed that if you mix up
blue right in hsl it has a lightness of
fifty percent and if you make such
yellow it has a lightness of fifty
percent and does the blue and the yellow
look the same whiteness to you at all no
yellow is much brighter the blue is much
darker if you do that in lch
then it actually corresponds to how
light it looks the yellow will have a
lightness of about 70 and the blue will
have a lightness of like 30 or 20 or
something in other words it corresponds
to what we see it corresponds to what we
can measure good so now you know that la
B&amp;amp;L CH are basically the same thing one
is polar one's rectangular it's actually
a measured color you can get physical
devices that you stick on something and
measure the color it gives you a readout
it's good so we can do that but now we
need to display these colors how do we
do that first of all you characterize
the display you measure the color of red
and then of green and then a blue or
separately at all the different levels
for not so 255 and then you calibrate it
you correct the imbalances you say okay
at this value got this much lighter this
one you've got this much light and you
measure it so that the greys don't have
a little bit of a shifty a little bit of
shift there there are absolutely neutral
graze all the way along and you also
have a known white point whatever the
white point you want to be as a
standardized white point you set it for
that now let's talk about the gamut the
gamut is not to be confused with gamma
gamma is the shape of the transfer curve
gamut is the range the volume of colors
you can have so you've got la b and you
produce a volume there which is the
range of colors a tiny one will not be
able to display very many colors and
abroad one will be some fancy pro
monitor can display lots of colors
you've probably seen this diagram by the
way if you ever look at high-end
monitors that will have this and I'll
have a little triangle here and it's a
this is better than this because it's
got a big this is rubbish don't ever
trust this diagram this is a
chromaticity diagram it's a slice of XY
said it is not perceptually uniform and
remember I told you a perceptual uniform
is the important thing so any
calculations you do on this space will
not give you correct answers ignore that
instead what you want is that that's a
three-dimensional shape which I'm going
to try to manipulate using this model so
let's see can we do this
okay so this is the gamut of srgb we've
got the a and B axes there and then
we've got the white point here there we
go good
next slide come on
sigh okay this one is a much smaller
gamut you can see his smaller this one
is a little mac macbook air and it has a
less of a gamma 2 then srgb this one is
a high-end one ish unity it's got a much
larger space this is a broadcast space
actually this if you go to a high-end
cinema now and it's got digital
projection it will use this gamma it's a
thing called DCI p3 and I mentioned that
because when we get on to CSS color
again which we will do eventually I
promise you'll see that DCI p3 is one of
the models you can use ok so now we need
to distinguish between device-dependent
colors and device independent so
device-dependent is kind of what we use
we have this RGB value and it looks
different on my screen it looks
different your screen it looks different
on the projector have you ever seen
people say i'm sorry i don't know like
these colors look great on my monitor
but on the projector they seem to be all
different thatthat's thatthat's
device-dependent device-independent is
where you say here is the measured value
this is the actual color i want to
produce and then something some piece of
software converts it to the RGB values
that's needed for the device you're
using so use instead of having the same
numbers everywhere in different colors
you have the same color everywhere and
different numbers which it calculates
for you how are we doing for time we're
okay so I'm also going to talk about
Prince a little bit because it's the
same procedure does anyone know what
this is this background diagram by the
way G naught that is any suggestions is
anyone awake it's just that you don't
know ok that's fine that's fine this is
a dot pattern the thing is that the inks
are opaque they're not transparent so if
you put say cyan ink on top of the
genset ink what you see is cyan right
you just covered one up with another you
don't get a mixture they don't add
together because this is relying a lot
right
sing off the paper coming into your eye
and you can't cover them up so you have
this dot pattern and you put them all
the different angles so that hopefully
they don't cover each other up too much
and you make a color by changing the
size of the individual dots that's
that's the way it is so how do you do
this well first of all so remember when
we're characterizing a screen you
measured red and once you've done
measuring red you measure green and then
you measure blue you don't have to
measure the combinations just the
individual ones because it's additive if
we know what red is and what green is we
can make any of the colors of mixtures
because it's an additive color specks in
print it's not additive so we have to do
all the different combinations lots and
lots of them like that we make all these
patches and we measure every single one
and that once you've done that once you
buy a much more expensive instrument has
a robotic arm that measures more like
this because it's really tedious
otherwise so you measure those and then
what that tells you is for any given
combination of cyan magenta yellow and
black what actual color will I get and
you got the measurement and the problem
we want to solve is the opposite given a
particular color how much of these inks
do I need which is a 4d reverse
interpolation but the result is the same
as on screens you've got neutral Gray's
you were accurate colors you know how to
mix up any particular color as long as
the device can produce it then you know
what cards if it can't produce you're
stuck coming you you just can't produce
more than it can do and you can save all
the data having gone to all that trouble
you want to save it somewhere and you
put this thing in an icc profile icc is
the international color consortium and
they are the ones that made print
actually be reasonable so that you could
go to different print shops and get the
same result and that data is stored in
either XYZ at a lab as appropriate good
now finally we Gonter CSS for color and
now you'll understand when i show you
this Intex you actually know what it's
for so first of all css3 color here we
go we've got RGB blah blah blah and on
the wide gamut screen it looks correct
because that's what you mix it up on and
then you look on an SI b screen and it's
too pale because this is
device-dependent color now we can hack
we can use media queries for and we can
say do you support DCI p3 and if you do
who use this that's really horrible you
wouldn't ever want to do this just in
different values so that they look the
same now instead what you do is you use
lch which i already showed you the first
number in l CH is the lightness the
second one is the chroma and the third
one is the hue the angle not to 360 and
then the browser calculates on four
different screens you will see the same
color five different screens you'll see
the same color there we have asked the
syntax so we've got lc8 just like that
that's the simplest way these are all
numbers from nought to 100 apart from
the hue angle which is not to 360 you
can have decimals as what no you can
have as precise as you want this /
introduces the Alpha and if you have a
comer you can have a whole new color in
fact you can have several but this is a
fallback so if you don't understand this
syntax here's the srgb value so that's
lch which is the easiest one to
understand we've also got la b which is
much the same functional notation so I
CC colors by default it's in srgb for
web compatibility that's what we've been
using so far but we've got predefined
display p 3 which is a sort of a
reasonably wide gamut if you have a pro
mana so it will be wide gamut like that
it will be display p 3 apple recently
introduced some phones which are also p
3 they've got some laptops which r p3
and imax and the sort of thing it was
actually Apple that pushed us to have
this in the spec so there we are that's
how you do it you say what space you
using and then you give the values
there's no commas between them because
the CSS working group has a war on
commas at the moment we want to
eliminate them except where they used to
have lists of alternatives so get used
to that because it's going to be
the challenge as the browser's cache up
rec 2020 by the way is a huge ultra wide
gamut thing that was designed for 4k and
NK television it displays almost all the
visual colors you're not going to see
one of those displays for a long time
but you can actually use it you can
specify colors in it in CSS for color as
well and media queries for as i
mentioned can check for support so you
can basically say I've do I have a wide
gamut monitor because otherwise I won't
bother I'll just here srgb but if you
have got it great i'll send you the
other stuff instead and lastly CMYK if
you're doing a style sheet for prints is
how you will do it you have an appt rule
here the same sort of thing as at
font-face but in this case it points to
a color profile on icc profile and then
you can just use it so i give it a name
foo and then i say foo and here's the
values in this forum CMYK that's it and
that's device-independent CMYK actually
so again you can send that to different
printers and it will understand it great
so this is all interesting can you use
it no no you cannot i'm telling you
about something because it's going to be
important in the future and because i
have been trying for years to actually
get it into the browser's it's not in
the browser's yet well okay i lied it's
in Safari nightly now some of it is
starting to get there Google are also
interested in some of it is shipping
it's been weird because for like the
last 10 years all of the major desktop
operating systems have shipped with
color management enabled as part of the
OS and I was like great can get can we
get it in the browser now a bit too soon
not yet his kind of specialized nobody
really wants it but now with these wide
gamut screens people do want it but then
before that happened mobile happened and
so as suddenly everyone had a little
device this big and did it have color
management on it no no it didn't haha
but now it does now it does the newest
version of
I OS does in fact have color management
and the new versions of Android which
they haven't shipped yet but they tell
me they're going to will also have color
management so we're back in the
situation of the OS supports it is just
a case of having syntax in CSS to let us
use this feature the first working draft
of this was only in July so it's fairly
early days all of the specs by the way
from CSS working group are now on github
so you can look at the spec you can see
the latest edits as soon as an editor
checks in an edit you can look at it you
can look at issues you can add your
comments on them you can file a new
issue for something in the specter you
don't understand file an issue say why
is it like this why isn't it like that
people will talk to you it's much more
open now it's a very good way to help
specification development and that's
basically it these slides are online on
my github the spec itself as I mentioned
is also on github and they also wrote
some code in JavaScript that does some
of the color conversion so you can see
how that works that's it I'm done
hopefully that was useful</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>