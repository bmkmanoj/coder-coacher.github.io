<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lisa Passing – Ukulele Hero [Reject.JS 2015] | Coder Coacher - Coaching Coders</title><meta content="Lisa Passing – Ukulele Hero [Reject.JS 2015] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Lisa Passing – Ukulele Hero [Reject.JS 2015]</b></h2><h5 class="post__date">2015-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xiX8jf2NajQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">reject thank you for the intro can you
hear me all right cool yeah so you could
really hear Oh
first of all hey reject is how are y'all
doing nice I wanted to say a quick thank
you to the organizers who were like very
supportive in like making me like
actually propose a talk and then Here I
am standing talking to you and I'm
thinking a very thankful for that as Yun
said hi I'm Lisa
um yes there is a hashtag with my name
other ways of communicating with me are
shooting me an email this is my
preferred way and if you're really into
social media I am NOT on Twitter that is
the reason why there's this hashtag so
people can talk about me without me
being involved and but if you're really
really into social media and you can
find me with this handle this a wk3 arc
on diaspora which is a super cool
decentralized open-source social network
and if you don't know what that is come
talk to me afterwards yeah let's get
started um exciting times we saw like in
the first talk like Hardware hacks with
JavaScript and it feels like this every
day there's something new we get new
browser api's we get new a new standard
is released or a new best practice or
somebody has an opinion an opinion on
something and somebody else has a
different opinion and you think like hmm
what is my opinion on that thing yeah
and there's all these things that come
up and all the things that I read about
and I feel like oh my god I really want
to hack on this I want to get my hands
dirty I want to like build something
that's cool with like all the stuff that
is now available and I can just do it in
JavaScript because like the entry level
to all these things is so low the thing
is I don't know where to start
I spent my day job mostly writing CSS
with a little bit of JavaScript and
we're using ember and there's not much
time to experiment on like all these
things that are so crazy and so cool
and so I have like no no entry point
really and also what would I built
because so I'm working at Travis CI and
we build continuous integration software
and but this is nothing that I would do
as like a pet or hobby project where I
would rather do something else with
basically anything else that is fun like
really fun for me as a programmer
something that's also fun for me is or
are video games I've been a fan of video
games for like a long long time I spend
a lot of time in my youth
playing video games and I think I've
only grown more attached to them as I
learned to program because I started to
think about what is actually happening
happening like in the back of a video
game and I said I think about like how
game design works and what is it that
like in fast people was like really like
making them obsessed with playing a game
yeah so reasons why and I thought about
a lot about that why I like video games
so much and select the combination of
all the all the things basically you not
only have like visual and textual and
audio information that goes into that
it's like the combination of those and
the set of rules that a game gives you
to explore and explore not only the
input and decide on the output of the
game but everything else that is in
between and the most like the thing that
blew my mind at one point was wait I can
control basically every aspect of the
game with code that I write and from
that point on it's like okay games are
basically the canvas of what I can
create and what I can like what I can
make aside from a web app yeah
so this is basically the thing where I
say that games are art because a lot of
people don't think that is true because
for them video games are like shooting
people which is still a big part of the
game industry but this is not the part
the game industry that I like and that I
really really really really love so this
is more about being creative with a
medium so back in the beginning and
there's lots of Technology especially on
the web platform there's lots of
technology that we can work on with
JavaScript and then there's video games
as like this medium that is defined by
its credit creativity and those two
together are just awesome and I like
awesome do you like awesome I thought so
yeah so this talk is called ukulele here
this is why I'm introducing ukulele hero
to you now people who are somewhat
familiar with a similar sounding game
called Guitar Hero was like I don't know
if you heard of it it's a musical game
where you play City play along to a song
and you have a plastic guitar that is
like aims to give you the feeling of
like really being able to play a guitar
and I thought hmm well there's this new
cool thing which is like the Web Audio
API and one year ago basically exactly
one year ago at last year's Web Audio
heck day and there's one this Saturday
as well I for the first time touched the
Web Audio API and it was kind of like oh
my god there's so much stuff going on
that I have no idea about I want to know
more and this is like I started a lot
about reading about the Web Audio API
not understanding anything and reading
more about it and still not
understanding anything and this is like
a long process that at one point
accumulated in this torque so whoo yeah
so I'm gonna like I'm gonna play the
game now with you or for you and I hope
you'll enjoy it I'm kind of proud of it
but it doesn't look that good so this is
like disclaimer this is a hack this is
in no way anyway like something that
would I should like
I would show it to my friends and since
we're all a community your are my
friends so I will show it to you so this
is demo time now
I brought a ukulele and and I will know
very elegantly switch to my play screen
so yep
matching slides and game so we start I
get some I will get audio information
from the microphone from the computer
with getusermedia and I did not click
right share please does it say share I
can't even read it built-in microphone
yes please share selected and it doesn't
work that's great let's lose this one
maybe no that's weird it works today I
want to share please
hmm okay can does someone if the other
people know anything about this okay
let's do it
damnit I also did not prepare a
recording of what I would do me great so
what would happen is that it would get
to a list that would tell me like to
choose a song one of the songs that I
prepared it would analyze the song life
in the browser which is like really
everything this was about and then draw
and yes sorry it doesn't work in Chrome
because it did yes oh okay
No
okay debugging I love it
you think okay let's try it sorry I'll
do people in my work let's make this
work now
mmm that is sad
okay so I will just continue with the
slides so no demo time I'm sorry if I
can play your song I have to kind of
because I like this is really bad
who here knows the show Adventure Time
okay do you do you want to sing along
with me
The Adventure Time theme song can you do
that okay
sorry Adventure Time come on grab your
friends we go to very distant lands Jake
the dog and Finn the human the fun will
never end it's adventure time thank you
just imagine that with basically a
little illustration of look like the
charts I was playing but yeah anyway if
this would have worked
I would now explain you how it works
yeah so I would have loaded and analyzed
the song there was a song that I picked
from SoundCloud from a Creative Commons
license and then I would get like the
analyze get the life input from the
ukulele through the microphone which did
not work and this is like the weird part
because that always works
and then I build like a little game
structure around it to like compare what
I have calculated before and the input
that I gave it life and yeah make it
pretty in quotes so in depth the song I
don't know if like who here has like try
it out Web Audio API at one point okay a
few so what you usually start is start
with is creating an audio context and
from that audio context you get all the
other nodes that you like connect and
then at one point you have this like
long pipeline of the input that
eventually goes and output in your your
speakers and then you do stuff in the
middle with it and this is also how I
started when I thought about how can I
analyze the song turns out like this is
really really great for having like real
timeline analysis of the of the audio
source like what I would do with ukulele
but not if I want to like analyze a song
upfront yeah because I actually needed
to need faster processing of the sort of
the source material and therefore
there's a fairly new thing that I only
found out by accident because I was on
Stack Overflow wondering like why can't
I like process these things faster and
there is offline audio context who knew
they didn't ended will like what offline
audio context does it will analyze data
the audio data
fast as it can and here's the thing why
it won't work in chrome because there's
a bug in Chrome apparently that just
like that the processing happens so fast
and that it will skip a lot of samples
and we'll get like a very inaccurate and
very like faulty kind of result but it
works in Firefox this is why I'm I need
to use Firefox which I usually do and so
that's cool offline audio context as
compared like in as opposed to the usual
audio context takes three arguments and
the first one is the channel or the
number of channels you want to have the
second one is the length of a buffer and
the third one is the sample rate and
these are all like very weird like
things that you need to give to an audio
context and I also had no idea this is
why we have a little intermission where
I try to explain these things to you
because nobody explains them on the
internet really and this it was a long
journey through a lot of Wikipedia
entries and Stack Exchange physics kind
of things okay I think I understand it
and everything starts with sounds so
let's take like take a step back from
like Web Audio and talk about physics
sounds sound comes in periodic waves
they look like this kind of without the
colors
yeah so we have like different kinds of
wave shapes and this in this case it's
like a sine wave so it's like very even
and the interesting thing like about
these ways is that we can measure them
and we measure the frequency which is
the pattern and then a number of times
the wave pattern repeats a within a
second so you have like a wave pattern
starts at 0 it will peak to the top it
will peak down and then it will hit zero
again and this one cycle of the 1 cycle
is basically the number of times this
repeats within a second is what we call
the frequency it's not its measured in
Hertz so when I go back to this one the
pink wave will have like a very high
frequency because it repeats more often
and the red one at the top will have a
low frequency because it takes longer to
repeat itself what does this tell us
so you might be familiar with another
word which is pitch and the pitch is
basically just the way we perceive these
frequencies so a high frequency is
perceived as a higher pitch and a low
frequency is perceived as a lower pitch
that might sound simple but it took me a
long time to understand that but now we
know that we can go a bit further
because for the analysis of audio of
audio data we're talking about simple
frames and this respect to like 3
arguments that we need one was channel
then we have the passer size and then
the sample rate and the same here's a
diagram that kind of shows where
channels and samples and frames fit
together so channels are played in
parallel in this case we have two
channels stereo like stereo so we have
left and a right channel we can also
only have one channel which is what I
was using because it's way easier to buy
do math with only one and A two or even
six channels or you can go up to a 32 if
you want or if you have like a real use
case and per frame all the samples of
the like the samples of a channel are
played in parallel in one frame and then
you go frame by frame by frame and have
samples per channel per frame and this
is like the way we analyze the audio
data in respect to time and so what are
all the lengths and the sample rate that
we give to the audio context length is
the sample is the size of sample frames
so and the sample rate is the number of
sample frames per second so I chose one
channel so that I can have a sample rate
of 44,000 100 Hertz this is like the
number of frames that we pass per second
so 44100 two frames per second and the
length of the buffer that we need to
store this data is basically these this
amount of samples per second which is
why I so I chose a sample like an audio
sample of 60 seconds so I would need the
length of the sample rate per like times
the seconds I hope I said that right
yeah so end of intermission so we like
basically need to I'm just like or I
need to understand how we like how live
audio processes audio data and all the
parameters that go into it just to like
load a song with an like simple request
which yeah so I'll get the song from
that I uploaded and have to run all
these I don't even run anything at this
point I just need to understand what I'm
doing and what kind of data I get next
up I hook up and analyze a node which is
the standard like it's a node that comes
with the Web Audio
context and it gives you like data of
the of the input source like the sound
or the file that you upload you created
from the context and we or i define a
the FFT size of the of the analyzer node
F of T stands for fast Fourier
transformation I think which is a way or
an algorithm that analyze the sound data
it's built into Web Audio API so you
don't have to understand what's going on
because this is crazy and what the
number is it's a number that needs to be
a power of two and this later influences
the way we received the samples from our
analyzing part I chose 4096
maybe remember that it will come back
what else do I have I have a script
processor node which is also note of the
web audio context and the way this works
is the fun thing is actually that the
documentation already says that the
script processor note is deprecated
without having the successor which is
the audio worker implemented in any
browser which is yeah I don't know yeah
so I like basically needed to work with
something that is already deprecated
because the successor is not yet there
cool but it works but the the script the
processor node and gets three arguments
the first one is also by the power of
two it's the amount of samples it it
takes like four one cycle of processing
and an output like output and input and
output connections which is in both
cases one for me because I like to keep
things simple so that they work and the
processor node comes with an audio
process event and here's an interesting
part where I like hook up the analyzer
node to get the data and the data that
we get is called byte frequency data
and I think some for another
intermission because I talk a lot and I
took fast and this is all these weird
words the FFT data that we get from the
analyzer node it looks like this
and in my case I would get an array that
has length of 161 like elements in an
array this is calculated from the
original sample rates from the audio
context divided by the sample rate of
this processor node which in this case
yields 161 so I can adjust these numbers
to get more or less and every element in
itself is an unsigned you you into eight
array which is an error like structured
for dealing with binary data in your
browser and each of these areas has 2048
like value pairs and this is like the
half of the half of the rate that I gave
to the analyzer node which was 4096 so I
get like half of this so you need to
remind yourself that like you will
always lose some sort of you will lose a
lot of information or samples along the
way so start high and you will in the
end you need to get something that is
still kind of a decent output out of the
data within DV like the you I call them
you into eight areas but I don't know
look like and they look like this so you
always have the key and like some value
and that the first like I had this in my
console I was like what what is this
like I thought about like I would get a
frequency or something and then
something related to the frequency
because that's what the thing should do
analyze my audio data so I yeah I was
reading some Stack Exchange thread where
someone is like I want to do like fast
Fourier transformation but what do I do
with the data that I get and then I
understood that every key corresponds to
a frequency already and the value that
we have here is which is always like a
value between one
and 255 which is like how like the
volume or like the the magnitude of that
frequency within the sample that we have
so there's a lot of them in this like
the little screenshot that we have here
key 14 would be like the the strongest
like the highest magnitude and for the
kind of analysis that I did because I
have no idea what I'm doing
I just thought mmm I just like pick the
key with the highest value and that is
kind of like the core that I would be
playing which is like a very very very
very simplified solution to the problem
that I had of like getting a chord from
my audio sample data yeah
the way that you calculate the actual
frequency from this is kind of still
another like weird thing that I needed
to figure out so I from my all my
samples like the the very long areas I
always took the the biggest value and
the key and the key that I get so the
the samples that the FTT data gets me is
always within the the range of what is
here belen hertz frequency to the human
ear so humans can perceive frequencies
between 20 Hertz and 20,000 Hertz and in
the beginning I started with forty four
thousand one hundred Hertz and I will
lose like kind of half of it in the in
the analyzing process so I would still
end up with more frequencies available
to analyze than humans can hear which is
cool so I can like cover all that and
this the range that I then get is then
divided again by the keys so I can
recalculate the key that corresponds to
a frequency and once I have the
frequency I can look up what this would
be as a musical note because those are
just basically every frequency
corresponds to a musical note this would
be so much cooler if you had actually
seen the game and
mmm-hmm you have it okay
he has it working okay I will like we'll
try again in the end because I'm kind of
almost done
because part two the input that did not
work this is actually all done by Chris
Wilson who does a lot of cool web audio
hacks and he made a pitch detector which
I found really cool and I yeah basically
took his code from the pitch detection
and made it so it like fits within the
game but he does he gets the request
like he gets the user media like the
audio stream uses dead stream as a
source for an audio context where I
would use in my offline in my offline
analysis would use a song or like an
audio file and he also uses an island as
a node to get the data but he does
different that he uses like an actual
algorithm and an autocorrelation
algorithm to determine the actual input
frequency where I just like hacked
something together that kind of worked
for me which is cool yeah so if you want
to know if you read if you want to read
about autocorrelation there is a lot of
stuff on Wikipedia I just stopped after
the intro because I don't I couldn't get
my head around it which is fine it I was
part of the the game that I was working
on okay so we had like the the the song
that I would load that like most of the
code came from me the second part of the
input that came from Chris Wilson's
pitch detection and then I have like the
actual game like the interface and how
everything goes together I like to call
it the spaghetti code because it's just
like making things work in whatever kind
of way and thinking about the logic and
what could I do
so what would have been is like I would
fire events every time like I detect the
chord change in the data and once I get
to take like a chord change in the the
sound that I'm that in the song that I
analyzed I would fire an event that
would
then check the life input data for like
hey do these chords match and I just in
this case I only compare the actual
musical notes that I calculated and not
the frequencies because the the
frequency spans from the life input and
the offline are they diverged a lot in
the process then I made up a scoring
system where I like calculated basically
the percentage on based upon the amount
of chord changes and then I had some
visuals like some simple drawings on a
canvas with bars that I calculated from
again the transformation data and then
it would have been done yes and it
worked kind of I will try again now for
some reason what browser did you use
same cool yeah maybe it was just weird
one last time no can we hook it up okay
I will quickly end the presentation
because I think two more slides one is
thank you so much for like you as
community to the people who write the
Mozilla developer Network articles and
documentation people hanging out in the
web audio slack and all other support
channels and select the people who
answer questions in-depth on Stack
Overflow this is like I like this
community because we help each other and
I like the the thought of like having
communities to support all the people
like people like me who have no idea
what they're doing and still like spend
a lot of time hacking on stuff and I
would like to thank all the people who
like open-source the things so that I
can use them build upon them and develop
things further and thank you also given
a pulse to yourself because you're part
of that community
yeah and there's an online version of
the game I don't even know if that works
and there's also the source code of like
to get the game and the presentation
it's all on github if you're interested
and if this if there's a lovely person
has it working on their computer once no
I only have an HTM I think okay we can
try it in the break come find me you can
play the ukulele if you want thank you
reject</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>