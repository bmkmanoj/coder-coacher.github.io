<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JSConf 2015   Mike Ball | Coder Coacher - Coaching Coders</title><meta content="JSConf 2015   Mike Ball - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>JSConf 2015   Mike Ball</b></h2><h5 class="post__date">2015-09-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/aGIJWWKLzF8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi thanks everyone so i'll be speaking
today about a headless testing against
real web browsers using XV fe so if
you're not familiar with what XV FB is
just just bear with me i'm going to
share some background on why this was
relevant to my team and may be relevant
to yours as well will transition into
you an explanation of what exactly is XV
FB and then allah i'll finish off with a
demo also a quick footnote is my first
time speaking at a conference so so bear
with me there too hopefully you're not
about to watch my yeah hopefully you're
not about to watch my career in
professional stature crash and burn so
again my name is mike ball md be on
github and clap excitement on twitter
and i work for a little company called
comcast my team at comcast is
responsible for building some TV and
video streaming applications effectively
where we turn your web browser into a
tv's 2015 and TV is not just for your
set-top box anymore so we do that with
heart in Philadelphia as is evidenced by
our Xfinity origin label response header
which we serve back with every HTTP
response served by our application and I
mention this because I know historically
comcast is a company that hasn't always
enjoyed the best reputation customer
service wise and user experience wise
and my team is really really working to
change that we do do what we do with
heart and with quality in mind and that
that in turn relates to a lot of what I
plan to speak about here today so a
little bit of prologue
um why why am I talking about this here
today so let me let me lead up to that
with some background on my beliefs about
software development so automated
testing I'm a huge advocate of automated
testing and I'm sure many of you guys
are as well I I rely pretty heavily on
automated tests within my own team to
operate as an insurance policy
guaranteeing that our software continues
working as it should with every change
that introduced this this helps my team
move fast it helps us understand how a
changing changing business requirements
or changing user experience impacts a
larger system and we this this insurance
policy is in place again with the goal
of guaranteeing customer quality and and
serving as kind of a digital audit trail
that when something needs to change
because change is inevitable that suite
of tests or in this maybe in this case
test failures highlights immediately
what else throughout the software needs
to change to align with the evolving
business requirements and that leads
into you another important aspect of my
philosophy as software developer I
believe pretty strongly in continuous
integration and my team relies really
heavily on a healthy continuous
integration pipeline I think in its
ideal form continuous integration
ensures a code based health is
continuously monitored with with each
change with each push a developer on the
team makes and that happens many many
many times throughout the day in its
ideal form this CI pipeline should be
scientific it should be consistent needs
to be easily repeatable and it also
needs to be as fast and cheap as
possible but still just as sophisticated
as is necessary to serve as
quality insurance policy and I mentioned
that because I think that's kind of true
of all engineered systems that you want
them to be just complex enough to honor
their responsibilities but when they're
they grow in complexity beyond what's
necessary that's kind of a sticky space
in which in my experience problems occur
and conversely when they're not complex
enough to serve their their need that's
a sticky space as well and that
threshold is ever-changing so we're
constantly monitoring that constantly
tweaking the process to make sure
quality is guaranteed and so that brings
me to you my my last point about a good
CI system which is that the feedback
cycle should be fast we work fast
business changes fast the customers
expect fast so we we really need to to
rely on speed we need to get feedback as
soon as possible about problem scenarios
so moving on with that point I'll say I
think the story of computers is kind of
that they're getting you know they're
getting cheaper and cheaper and servers
disposable infrastructure is more and
more readily available technology like
virtualization container technology like
docker cloud infrastructure all of this
works in concert to illustrate this
point I have that servers are cheaper
and cheaper and more and more readily
available in our own continuous
integration pipeline relies on this
pretty heavily we rely on virtualized
disposable Linux VMS and then within
this world especially at the JavaScript
layer headless testing is is pretty
important and so historically tools like
phantom jsf jsf ear acer have all
provided a headless JavaScript runtime
and and this this allows us of course to
execute our JavaScript code and assert
that all all within it continues to work
as it should that the overall health of
the software is as it should be or or
that it isn't as it should be and and
accordingly we're alerted to this
problem but there is a problem now those
all those tools are great and I my own
team relies pretty heavily on phantom
j/s is a great tool and seems to have
risen as the leader amongst these
headless run times in recent years and
so this is not at all a dis on phantom
JSI blown away by how great it is but
one problem remains and even ray touched
upon this and mentioning the need to run
headless ie in the presentation before
mine so what if your technology can't
run on one of these headless runtimes
what if phantom j/s doesn't suffice in
serving your needs so what do I mean by
this well here's a few examples flash
and wjs which was until recently known
as node WebKit and google polymer web
component tester provides some examples
here so these are all three examples of
some technology that comcast in across
various teams or different layers of the
ginormous software ecosystem that
comcast is responsible for leverages so
flash of course requires and assumes the
presence of a GUI n wjs if you're not
familiar is a great technology for
authoring distributed desktop
applications across windows linux mac OS
using web technologies and nodejs and it
to buy it you're reasonably of being a
technology for authoring desktop
applications it seems the presence of a
GUI
and Google polymer web component tester
web component tester being the the
polymer community testing tool of choice
also assumes the presence of a web
component or excuse me the presence of
an actual GUI in actual web browser so
for the purpose of this presentation
let's focus on Google polymer as a case
study now if you're not familiar with
Google polymer I'm not going to go into
too much depth at this stage partially
because my colleague Chris lurin and
raise your hand chris is going to be
given a great introduction to Google
polymer this evening at 5 45 is that
correct so be sure to check that out but
the basic skim the surface background as
is relevant to my talk here is that a
google google polymer is some great
technology used to author HTML web
component this is a technology that
various teams throughout Comcast's have
taken increasing interest in as of late
and like i mentioned this tool web
component tester is the polymer
community setting tool of choice for
automating google polymer tests but
here's the here's the deal web component
tester like i mentioned previously
assumes a GUI and so these virtualized
CI build agents i mentioned earlier they
don't have a screen they don't have a
GUI they're cheap disposable VMs and so
in this case web component tester really
challenges some antal infrastructure
assumptions and problem isn't isn't
mountable there are some candidate
solutions provided
by Travis CI for example or sauce labs
or Travis CI has some really extensive
and great documentation on how to run
GUI headless browsers on its own boy
infrastructure and incidentally this
their technique also leverages xvii FB
which I'll cover in more detail here and
a headless Firefox so that's great and
sauce labs if you're not familiar is
also a great option sauce labs offers a
selenium cloud with access to over a
hundred device OS browser combo so
that's a great option as well but what
if your team can't use these tools so
why might your team not be able to use
these tools well budget might get in a
way these are vendor services and your
team might just not have the capital to
pay for it sought complex software
licensing agreements may not meet your
needs for various reasons or maybe the
amount of load that your team will do
will will generate is just prohibitive
so what are we doing in these cases well
that's a that's really where my my
concept that my ideas for X virtual
frame buffer come into to play so X
virtual frame buffer more commonly known
as X vfb I'm kind of using the two
interchangeable in this interchangeably
in this presentation is it's not new
technology and it's not JavaScript
technology but it is some technology
that allows you to run GUI applications
like web growl web browsers with no guey
so with no screen so let's talk a little
bit about x.x VFD and i'll hopefully
provide some contextual understanding
for what it is before I lead into my
demo and with that a quick sidebar the
talk about the x window system so the x
window system is how guha displays are
rendered on unix-like systems unix-like
systems being linux and mac OS and the
x11 display server is the curt release
of the x window system so again this is
a windowing system for bit map displays
used to render gooeys and this is
effectively how visual elements are
rendered on a screen and available for
user interaction via mouse click or
visual gooeys with qualities like color
and shape on mac OS and linux and so
with that what is x virtual frame buffer
so x virtual frame buffer or x vfb babes
just like any other x server the
difference being no graphical output
which is rendered so it allows us to
perform all graphical operations in
memory without showing screen output so
again it doesn't require the computer
running it to have a screen as is the
case in my own teams continuous
integration workflow and I'm sure that's
true of many other teams continuous
integration workflows we're relying on
EMS either in a cloud or even managed
VMs that have no display they have no
screen so that brings me Oh Jim so with
all of these problems in mind and
bearing into consideration xvii fbsm
candidate solution technology a doctored
up a polymer testing box so this uh this
is a repo available and like all along
my github user name is md b and the
testing boxes polymer dash testing dash
box and so a little disclaimer I'm not
advocating necessarily that this is the
best or most appropriate way to solve
this problem your team this is just a
reference implementation proof of
concept for how you can run your
automated tests in a headless DM so the
core technologies I'm going to be using
throughout it throughout the
presentation and demoing polymer testing
box are of course xvii FB we're going to
use ansible ansible is a configuration
and configuration management and
provisioning technology comparable to
chef or puppet or CF engine typically
used by system administrators and
operations professionals in provisioning
servers we're going to install Google
Chrome we're going to solve Firefox
nodejs Bower and web component tester
which are all the prerequisites for
running Google polymer web component
tester test ok so demo time so again
here's what we're going to do we'll
provision a vagrant bun to box ansible
is then going to do its work installing
and configuring all necessary
dependencies and then we're going to run
some web component tester tests against
a polymer web component so quick sidebar
on vagrant a disclaimer for those of you
who aren't familiar with vagrant this is
not JavaScript but you know takes a
village so it's a feel obligated to say
that at a javascript conference right
but this is some great technology that
helps us help serve our needs within the
JavaScript community so vagrant is built
on VirtualBox and it's effectively a
tool to spin up lightweight headless VMs
but a quick quick point I want to make
about this is that in this case on my
laptop vagrant is the provider of this
Linux VM but that provider could just as
easily be a remote or cloud provider
such as Amazon Web Services or digital
ocean or OpenStack
in this case for this demos purpose is
I'm just using vagrant but in theory
this ansible PlayBook playbook being the
ansible metaphor for how provisioning
happens could take effect on on a box
provided by a different provider like a
crab cloud provider and so the primary
way that we communicate right that we
want a the bun to vm from vagrant is via
this vagrant file so again this is also
not JavaScript this is Ruby but i do
want to point out a few things here
there's there's more going on but in the
larger vagrant file which you can see in
my repo but quick quick points here so
number one note that we are poor we are
forwarding port 5900 to 5901 on the host
machine so the host machine in this
context being my macbook so the vm
becomes available to us on my macbook
via port 5901 and then secondly we're
declaring a vagrant provision this bun
to box we're asking for via ansible and
the instructions for how to do so are
contained in this playbook yeah mol file
alright so the ansible playbook yamo
file again not JavaScript ansible is
Python but again I hope you see the
relevancy we're going to as per
directive of this playbook diamo file
install and run xvf be on display port 0
we're going to install node Bauer web
component tester and then we're going to
install Chrome and Firefox so we kick
all this off by executing by running
vagrant up so that gives us
bass ubuntu box and then kicks off the
ansible provisioning process point here
is that this is you know I'm storing my
infrastructure in code here so this is
an easily repeatable scientific process
this is not a fragile managed server
this code allows us to repeat this
process again and again and again and
get the in theory exact same vm again
and again and again so when that's all
done we're going to shell into the
polymer testing box which I'll do via
vagrant SSH and then I'm going to clone
a Google polymer web component so in
this case will clone core Ajax which is
a google polymer component maintained by
the polymer team that whoops provides
some Ajax functionality within polymer
so will clone that I'm going to check
out version 056 of core Ajax I'll do
that because I want a demo working tests
and I know 056 is an official release so
it's tests pass and then we're going to
run Bower install to install the core
Ajax dependency so again this is all
happening the polymer testing box
vagrant box okay so now I'll demo
running web component tester so what
you'll see is all i'll run WCT which is
the web component tester executable
setting the environment variable to
display port 0 so I'm telling web
component tester to run on display port
0 and remember per hour ansible playbook
ex virtual frame buffer is also running
on display port 0 and we'll see evidence
I'll go ahead and kick this off that
selenium is going to spin up both crow
and firefox so you see chrome 43 and
firefox 38 which were installed via
ansible and we're going to run the web
component tester test in each browser so
you can see we've passed all of our
tests in each browser and that happened
with no screen output that happened
entirely on my vagrant box so that's
like as the core of what I I seek to
demo here thanks so i can understand any
skepticism you have you know how do we
know that chrome and firefox really ran
and what about debugging what if you
actually need to poke around in
development or maybe even remotely to
figure out why are things failing you
might need a GUI to do so you might need
to actually with a web browser so I have
a solution BNC well the polymer testing
box has no screen and has no GUI your
Mac does so what this means is that we
can open a VNC connection from in this
case my macbook to the vagrant box and
because my macbook has a GUI has screen
the drall commands and the of the GUI
commands executed will have a screen to
take effect on so step one on the
polymer testing box will have to install
VNC server so i'll do that via sudo
apt-get install x11 VNC and also writes
on display port 0 and then on your mac
or on my mac rather I've brew installed
tiger VNC viewer any any VNC client will
do and i'm running this on localhost
5901 you'll recall that I i forwarded
port 5900 of the the vagrant vm to port
5901
Mac sorry for the little small I wasn't
sure what kind of screen real estate I
have to deal with but on the Left you'll
see this is my BMC connection opened
from my mac to the to the vagrant box on
the right so I'll go ahead and run the
same command Iran previously on the
vagrant box and now on the left it's
going to be a little squished up but
hopefully I'll take my word for it that
you'll see chrome and firefox actually
open and execute these passing tests so
there was chrome first and there's
Firefox and all tests pass and then the
browsers will close
so again that that code is available at
my github profile MDB polymer testing
box in quick extra credit I also
doctored up a solution for running in NW
running and and testing both unit
testing and in testing an NW desktop
application on a similar box so as for
next steps you know I'm hoping that you
could see how you could kind of adopt
maybe some of what I've proof of concept
adhere to spin up some cloud
infrastructure or something during your
own builds maybe a leveraging AWS
digital ocean or OpenStack or some
comparable cloud provider also have a
harebrained idea for how similar vm
could be spun up and provisioned for a
building and unit testing actionscript I
think this also opens a lot of
opportunities for some advanced web
scraping for those wacky websites which
just don't seem to behave at all in
Phantom Jas for whatever reason and it
also provides a path towards headless
functional testing if if that's
something that you're interested in so
that's it thank you very much again on
clap excitement on Twitter and MDB on
github</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>