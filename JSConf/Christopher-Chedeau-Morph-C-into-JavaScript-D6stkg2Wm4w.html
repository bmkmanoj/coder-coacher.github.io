<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Christopher Chedeau: Morph C++ into JavaScript | Coder Coacher - Coaching Coders</title><meta content="Christopher Chedeau: Morph C++ into JavaScript - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Christopher Chedeau: Morph C++ into JavaScript</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/D6stkg2Wm4w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone so I'm going to start
with a little quiz for you so I'm going
to use some snippets of code and I want
you to tell me what programming language
it is so I start with an easy one
anybody yeah i wish i had some goodies
for words so next one is also an easy
one yeah c++ I what about the last one
yeah it's actually C++ so if you want to
make sure that c++ we just have to
include two things at the at the top and
at the bottom and what's inside looks
like javascript but it's actually C++ so
you can give that 5 2 GC c or g + + is
going to compile binary and execute like
if it was JavaScript so the goal of the
talk is to explain you how I made it
work so you might be wondering why did I
do that because Java sweeping cheapest
price like why the and so I was in
a class and they wanted me to make a
rapper a c++ wrapper around this an ugly
capi so everybody in my class they
weren't like doing a creating like
dozens of files with many classes on
everything and I was like yeah but you
you could just just put a JSON put
everything in a JSON object and oh yeah
it's working so I I try to make it work
in the in C++ and then once i get json
walking i try to do all the pattern of
the language like lambda functions on
protoje Pelini returns so my plan is
going to be first we are going to to
write a json in c++ and then we're going
to imitate the syntax of
c++ 11-under functions into into the
JavaScript syntax and finally we are
going to see how to under prototype I'll
prototypal inheritance so let's start
with Jason so our goal is to make this
or something like this compile in C++ so
the first thing we want to see I want to
check is the general script primitives
so in JavaScript they are undefined no
true false numbers and strings and you
can see on the left you can see how each
other some tax is in JavaScript and we
want it to work on C++ so the first
thing we are going to do is to make a
structure core value that is going to
annul all the different data types
because in C++ everything is strongly
typed and in javascript is dynamically
typed so we want only one that one data
type and at one time we're going to see
which one we have and dispatch like that
so we are going to make a fruit value
and the other way to overload the
constructor so a constructor with zero
argument is going to be undefined with
double is going to be a number an int is
going to be a number a boolean is going
to be a brown and the cost char star is
going to be a string so now how do you
call it in C++ how do you create a new
viable in C++ so there are three ways to
do it so the first one is you put the
type name and the variable name and it
will call the constructor without any
arguments and then you can put the type
the variable name and in parentheses the
value or you can do type viable name
equals to the value so yeah I am pretty
sure you can see I'm targeting now so
we're first going to tag def
you into VAR and the second one is not
very useful so we are going to remove it
and then with only those this simple
class we are able to imitate JavaScript
syntax in C++ and in fact we are able to
write the liquor I just showed before
and it's working but at the moment this
exact code is on compiling because in
C++ you cannot write code and anywhere
you cannot run code anywhere you have to
run code in a function so we are going
to wrap everything into a main function
and basically everything which is int
main and above is going to be our first
include and the last time we to be our
last include so at this point we can
write JavaScript primitives so it's
pretty nice and now we are going to to
see how to make arrays and jason and
objects so it's not it's not going to be
mostly a difficult implementation it's
not going to be difficult to implement
it but we are going to see how to make
it look like JavaScript and so it's
mostly about syntax Mosul implementation
so the first thing i did i tried was to
make a very thick function called a and
then give it a list of arguments and the
problem is raya dick functions in c++
are made with macros and the mac road
don't do any type conversion so here Jes
conf is going to be a cost roster and
not a value so we are kind of stuck and
we cannot reuse this one so the signal
atoms was to use some operator
overloading a curry and I was able to
get back the bracket notation but I
didn't manage to only have the bracket
notation so I have some strange door OH
and underscored coma so it looks a bit
like JavaScript but not quiet and I
wasn't pleased with it but the right the
good part with it is that it does it
does enabled type conversion so a cool
thing we can do is to rewrite the first
one as a macro that generates the second
one and we can get the first one to work
but this is not something I want the
user to type and finally I went to see
press press 11 initializer list and the
just give us something we want it's just
like a JavaScript array instead of the
square brackets you've got curly
brackets so it's pretty much walking and
the implementation is read figure so you
just overrode the value constructor and
to add to to implement an initializer
list of values and it does a time
conversion it under the viatical
agreement so it was working pretty well
so now we are we have the array is
working now we want to make the object
walking and I'm going to go to a fun
fight in the JavaScript first if you
type this in your console is going to be
evaluated to one because curly braces
will be a block and a i'm colonel will
be a level so it's unfortunate
fortunately in javascript if you put a
hey equal to that is going to become
treated as an object but in C++ this is
the standard behavior so II we are not
going to be able to reproduce Jason
notation because of that because we
cannot overload labelled operator which
doesn't exist so we cannot write it so
we're going back to try on the arrow and
the first thing I did was like on the
RAS make an o function that's going to
take multiple arguments and the first
argument is going to be a key the second
a value and then a key and the value etc
so it works with a trick I mentioned
before but it doesn't feel like a key
value pair and if you don't indent your
card or put brakes at the right position
it just just doesn't feel right so next
I was like a crazy into a parrot
overload and I I came up with something
like that but but the prime is it
doesn't really look like JavaScript but
with operator overload we can do some
nice things and in the end I came up
with this one so we are still using the
initializer list with the curly brackets
and in order to get the key value you
are doing underscore bracket key equals
to value so this is a bit more verbose
than key current value but I think it's
a good trade-off or at least it's the
best reader if I could come up with so
if you want to do some crazy things with
presidents with operator overloading you
have to get this president's list in my
you have to have it in mind so here it's
working because the bracket operator has
more present than G equal one which has
more precedence than the comma 1 so we
are going quickly going going to see how
is walking in reality so we've got an
underscore instance of the class
underscore that has a bracket operator
that creates a key value pair on set the
key and then the key value pair as an
equal operator that set the value so now
at this point we've got a key value pair
and we just can give the key value pair
we just can overload the constructor of
the value with
value pair and we got we got it working
so the implementation is a bit tricky
tricky but it's and now the
result is we've got JSON working so it's
not exactly the same syntax but the
great thing is we are the exact same
possibilities as JSON so we can write
the we can put all our JavaScript code
to jason to super stressed with that
it's so now we've got objects
walking and and a big another big part
of of JavaScript our lambda functions so
unfortunately for us in C++ 11 they
introduced lambda functions but we've
got a program which is that the the
syntax is ugly it's like a bracket and
everything so we we don't want to write
the the c++ syntax so what we want to do
is to write function parentage this wife
and get is translated to the thing on
the left so unfortunately the only way I
found to do it was to use a macro so
we're going to make a macro function is
going to take a leave a decrease of
arguments and just copy and paste it and
put the boilerplate around and we have
also ran across the program which is
that c++ you are in suppressed first you
have to type every viable and even in
the arguments so there's a quick ACK so
you have to put VAR before is a viable
name the argument name in our GSP p but
other than that it's working so now
we've got we are able to create lambda
functions that looks like that that
looks like javascript and now we want to
store them
so in so again in C++ everything is from
retyped so we are so two functions with
different arguments have two different
types but we are we are lucky enough
that we have only one data type to
handle which is a type value so at every
function return the value and every
function thanked 0 1 or more values so
we can just overall though the value
constructor with all the rets we want to
support then we want to call the
function we have thought and it's as
another divergence between c++ and java
script in the core semantics so in sip
in c++ if a function takes two arguments
if you give it three is why it won't
work in javascript if you give less
arguments it will feel the other with
undefined and if you give more it will
just in your the last one so we are just
going to to write this so if we've got a
function store that has zero arguments
we just call it with zero argument if it
has one argument we are going to call
with the arguments were given and if it
as two we're going to call with a and
undefined and so we get it working but
if you want to support many averages
it's a lot of copy and paste so the the
implementation is dependent on the
number of of the RET of the maximum
arity of functions you want to support
so now let's get to interesting thing so
we've got Jason we've got functions so
now we can tackle the one things that
javascript stands apart from all of us
or all other languages which is for the
type or inheritance so in order to do it
the concept is very simple when you have
an object and you want to reach with a
property from the subject you're going
to see if
is inside the object and if it if it is
if it is inside the object you're just
going to give it back but now if it
isn't inside you're going to ask the
parent of the object and see if it's
inside and this you are doing do it
going to do it recursively until you
find the object the property you want to
look for and if it doesn't if you if you
if the properties and they're they're
going to return the fine so in a so you
just have to overall the bracket
operator to reproduce prototypal
inheritance and there's only one thing
you have to remember when implant
implementing this is that when you read
a property from an object is going to
climb the prototype chain however if you
set the property to an object is going
to set it on the object itself so I
didn't know about it and now that I know
it seems logical so so yeah and so now
we can retrieve a property from the
deposit I chain but how do you actually
set up to the type shown so I'm pretty
sure all of you I've I've read the do
black Douglas Crockford implementation
of objected create we just with which
does some crazy stuff with prototype new
functions and everything and in fact if
you allow to the user underscore
underscore proto it's really easy to
write so object of crate is a function
that takes a parent and return an object
which has the underscore underscore
proto property set to the parent so ill
we can make it work like in two lines of
code so it's very nice and but it's not
enough all the JavaScript code isn't
using objective trades so you want to be
able to use the new constructor the new
operator so fortunately for us it's also
possible to do to implement it in pure
JavaScript if you are now and does come
on the scalp photo so let's see how we
do it
so new is going to be a function that
takes a constructor and that going to
reach on the function that takes
parameters so we're going to create an
object which has underscore underscore
proto set to the constructor prototype
so we set the prototype chain and then
we are going to call the constructor in
in this case it's going to be point with
this set to be the new object we just
created and all the arguments are going
to be passing so we are just going to do
point apply the new object on 10 and 20
and return the objects so it's a really
nice thing that we are able to do that
in JavaScript well now in C++ and the
only downside is that you have to write
to wrap the constructor name into
parentheses but it's also accept it's
also working in JavaScript it's cool so
now I've been a I've shown you how to
make objects lambda functions and
prototypal inheritance if you ask me a
wet javascript is i would say those
three points because I to me that that's
the only three points that differ from
C++ or any other language so it's it's
really nice that we've been able to
implement them in C++ with a close in
tax so now I don't really have the time
to go into really really death details
when i'm going to show you what other
features we can implement so the first
one is going to be closure so since we
have longer with written in C++ we can
just use lambda closure oh that works
and there's only a little nasty bugs
that I don't have the time to explain
right now but if you want to know more
about it I talk to me offline then we
can set this
in the four way that says RG fine in
JavaScript so the first way is with new
as i showed earlier the second one is an
unbound call the third one is a bound
call like when you do a object dirt
function and you call it and the first
the last one is a using color and apply
and we can do it we can do it using a
little hack so if you remember our
function macro we can insert two
additional arguments which are this an
argument and then when you when we call
it we can add those those arguments in a
hidden way and the they are available to
the user so since we can also overload
all the traditional JavaScript operators
so less than equal plus plus plus equal
plus and you can make it work for all
the data types so a string number and
everything it's just a matter of using
the the jet on reading the JavaScript
specification and implementing all the
other cases we also get with CPS first
11 iteration for free because in C++ 11
you can do for type the viable name
colon and the object and then we can
just define in to be rewriting in colon
and it's working so it's pretty nice and
we've also got exceptions working with a
channel with a c++ exception mechanism
we just have to make sure to typecast
the exception value into a value object
and just rewrite the catch to ignore the
the type so we've got like ninety
percent of
of JavaScript walking in C++ with more
or less the same syntax so I'm really
proud of of it because you can pretty
much run any JavaScript any javascript
file and convert it to 2g SVP and it
just works but there are some divergence
and I couldn't fix so the first one is
there is no evil and you might say evil
is evil so it's not a problem but in
fact we use eval every time in
JavaScript so in the console when you
have a read eval print loop you are
using either and in the browser when you
add a script in line you are using evil
when you require a module file you are
using evil so not having a valley is is
a big issue but if instance if it since
it is simpler stress of does not much we
can do about also one real annoying
thing is there is no implicit return
undefined so in c++ if you say the
function is going to return a value you
have to return something or the compiler
will stop you and I did not realize
until then but you you often an already
often miss and forgot to write a written
something and so it's it it makes some
boilerplate code on your on your GSP
pecan and also as we've seen we're at a
different syntax for ra an object
initialization so there are bunch of
thing on the bottom that you might be
interested in and if you want to know
more about them you can you can see them
in the slides so the other difference is
out there is no dot notation and I
couldn't find a way to emulate it and as
a retail undefined we use that notation
like all the time in JavaScript so
having to go back to the bracket on
string notation is really really really
annoying so and also that there's a
afro name with the empty object notation
since we are using initializer list I'm
two objects is treated as mersing so it
calls the empty constructor and so it's
written undefined instead of an empty
object so you have to just make sure to
know the trick and I'm very sorry but I
know you all like to write for a peacoat
and I couldn't reproduce with statements
so I'm sorry but I have I have a gift
for you so since we are in C++ you can
use go to so it was a bit of a
consolation for me so as a conclusion
I'm going to answer a question of often
asked which when I'm talk about the
project which is it is useful and my
honest answer will be I don't know so at
first when I played with it I was like
oh my god we can we can do everything
that JavaScript can do in C++ and we've
got an ear we have near the same syntax
oh yeah it's awesome but when you start
using it you realize that the absence of
the dot notation and the return on
defines the make your color looks really
like crap and you don't want to write
code like that and also the second
things is like you personally I love
JavaScript because it's a dynamic
language you can just save a file on the
reloads abrazo it's working and having a
10 second compilation step in between
was like I don't know but well if you
really want to use it a good benefit is
that you are you are able to communicate
with all the C++ code that exists and
you can just write C++ and mix C++
course on JavaScript course and
everything and it was also really fun
and also one thing I want to point out
is that c++ 11 is now able to run many
of the same
we used to run to do on JavaScript so
it's I think it's a big step forward at
the server side or our low level stuff
to be able to take paradism from the
dynamic world and put them back to the
static fault so if you want to play with
the code it's available on get up at
this address and if you want to know
more about me i have a blog and you can
follow me on Twitter so thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>