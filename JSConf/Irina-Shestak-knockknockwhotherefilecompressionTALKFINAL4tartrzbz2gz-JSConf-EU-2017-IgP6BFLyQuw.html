<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Irina Shestak:  knock-knock-who-there-file-compression-TALK-FINAL-4.tar.trz.bz2.gz | JSConf EU 2017 | Coder Coacher - Coaching Coders</title><meta content="Irina Shestak:  knock-knock-who-there-file-compression-TALK-FINAL-4.tar.trz.bz2.gz | JSConf EU 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Irina Shestak:  knock-knock-who-there-file-compression-TALK-FINAL-4.tar.trz.bz2.gz | JSConf EU 2017</b></h2><h5 class="post__date">2017-05-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IgP6BFLyQuw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone
Jess come to you
2017 this six of me
there will be coding there will be lots
of coding and then suddenly Abraham
Lincoln and Jacob Civ show up and what
is this even a bunch of encoding about
we'll find out will we find out will
that happen who knows there will be
images lots of images what are these
images even about will she explain
hopefully she will explain but let's see
there will be waiting lots of waiting in
this season hottest code buster code
buster get it get it get it
knock knock who's there file compression
talk this is a talk race I hope to stock
file file compression hey everyone my
name is erina I write code overhead
script oh and today I'll be talking
about compression so I when I start off
on preparing talks I kind of go into
this research mode and I read a bunch of
like papers about stuff so I was reading
some of certain papers on compression
kind of minifying your code and being
faster on the internet and I came across
this quote rolls of JavaScript are
extending far beyond XML and HTML Dom
manipulation to solve is like super key
to find in a paper but yeah so a bunch
of people kind of came up and said you
know what we do so much JavaScript and
JavaScript takes up so much of our space
on the internet if you think that's like
the Internet is taking up space so yeah
we're rewriting a
of JavaScript and in fact by using
friction we're saving about 50% of all
that JavaScript traffic so that's why I
wanted to talk about compression i know
i lured you in here by phil collins and
but we won't actually do anything
college it's just stacey to be a
compression i'm really sorry
so what is compression compression you
start off with a file that for example
index agent x HTML will look something
like this right you compress it and
hopefully it works compressive compress
compress it and then at some point you
end up with a much smaller output so if
you were to like cat's-eye compressed
file kind of looks a little bit wonky or
much more different than the first one
we kind of had to begin with cool and a
bunch of that if you think about it if
it happens a word in HTTP what you have
is you have a client and server
communicating with one another and you
want to kind of pass in certain
information from one to the other so
what client does is it says okay I'm
going to accept some types of
compression and these will be these and
that all goes under accept-encoding
header when the client sends in its
request and what the server does it says
okay cool I'm reading that through but
I'll send it to you based on whatever
you can accept so if the client says
I'll do deflate gzip and broadly your
server will send in whatever it is
feels like it's necessary but what are
all these names they're a little bit
confusing so I think we should kind of
let's kind of work through these as we
go through the talk so if you were to
actually look into your headers and
stuff like that in your console you can
see that the except encoding could be
seen through the request headers and
then if you were to look at the response
headers they're just the same and that's
what the that's what the page sends you
back finally this is also from
accept-encoding page of exams oh so a
lot of these
a lot of these compression things
started off with something called
deflate that's kind of the basic
algorithm that most of these will use
things like gzip and broadly so but
deflate is a basis of two Huffman and I
was at 7-7 and these are kind of
compression algorithms that take in a
bunch of data and see whether or not
it's similar in one way or another and
look at the distances between like
similar coatings I won't talk too much
about Huffman and nails at 7-7 because
it's a little bit boring so I have a
bunch of sketch notes on those two in
particular so you can look at those
later but I'll talk about deflate
because deflate is a basis for
everything else to begin with so
deflates used quite quite primarily with
a PNG Zin gzip those are the ones were
kind of used to seeing to begin with
what it is is it's a stream of locks so
all of these compression things are
streams would deflate steam or blocks
that each block is individually made up
of three different bits in the first one
is the one that indicates whether
another will be more data coming through
in your stream of data so one means okay
we're actually kind of done here so we
can close out that stream and zero means
that there will be more stuff coming
into its binary the second bits a passes
on the actual raw data and passes in the
static Huffman boxes the ones I talked
about that I won't actually mention as
much but static Huffman box and the rest
of it is a little bit more dynamic so
it's the dynamic Huffman box and the
table that kind of references all the
other ones to themselves and there's
like a little bit that you don't touch
so that's kind of what a single
individual deflate look looks like
awesome and so the the the dimension
that I will do with lz77 and Huffman is
the fact that a compression works with
the pointers and the pointers are the
ones that are handled by the lsat 77 and
when we talk about weighted symbols and
when we talk about symbols in general
and how these are a lot more than
to letter a it has a lot more meaning to
it that would be handled by heaven
so that's defied and all of these other
ones are bases of that cool and then the
one that we hear a lot more about than
actual deflate is gzip compression and
those are the ones that most of the
content on the Internet is actually
moved through so gzip is kind of cool
and an implementation of that that's
probably the most used software library
out there maybe after like mine my
favowite is Z Lib and dilip is the one
that actually has has a node
implementation that's the one we'll talk
about in a bit so with Z Lib what you
get is you get a little bit more control
over processing and memories is that
means that you can create a trade of as
to whether or not you want a more
compressed content or you want it to be
faster and that's kind of how you get
around it and it comes with three
different levels that you can do to
create that kind of compression so on
level 1 or level 0 you actually don't do
any compression but a level line on
level 9 you are able to compress content
a lot further and you're able to go back
further in your static blocks to copy
content over and pass it through so what
would be cool is if we do a little bit
of work with Z libs so I mostly write
node and so Z Lib is it's a built-in API
in node so I want to what I want to do
is actually let's work through it and
see what we can do in terms of
compressing content as we serve our
files over to the client so let's
actually do that awesome so our kind of
started us off yeah there is a lull in
case I forget file so I'll started I
started us off with having an HTTP will
have FS gives me one to create a stream
when we serve stuff over and I've
started us off with actually having a
server and it'll listen on 8080 cool so
when I was mentioning previously what
the client does is it says I'm going to
accept certain types of encoding and
based on those types of encoding we
should be able to work with certain
types of data so I said we'll be working
with zeod so actually let's see you live
in here and we'll be using streams so
I'm just going to require pump and pump
is in a non broken version of pipe well
did I say that out loud I was a skinny
film there cool so what we'll want to be
able to do is want to have a source so
this will be our stream so so we'll have
a read stream that takes an hour
index.html and I should have an
index.html and a cool and what we want
to be able to do is based on this accept
header that we get we want to do
different types of content so this would
be a basic match for gzip and now gets
indexed in a bit because I forgot
so we'll be working with either gzip or
deflate
and I will actually copy the batches
over because that's a little bit either
and then based on that particular match
that is deflate I want to be able to
create a deflates compressed file and
what pom does is it takes your source
and it handles your your operation
handles your output which is the
response and I also have a head ler that
does the error handling for us and then
what I what else I want is just like to
be able to make sure that whatever is
the response that comes out is fine
so our content encoding here is I'm
stuck oh I'm on a different keyboard I'm
sorry Persian is not going to work in a
vineyard
neither will Russian okay cool so I'll
copy these over as well go a little bit
faster and then if we have a gzip kind
of content we will then do the same
thing z lip has a G's at the
implementation nodes Z lip will always
have a gzip in fermentation but so does
node API of it and we'll do the same
thing pop it over I pump it over okay
awesome
so let's actually test this out because
we want to be able to see whether the
content will actually get so let's start
up a newt server and what we what we
want to do is we want to be able to curl
the command and we need to pass in
headers because that's what basically
we're looking at hand so the headers is
accept-encoding
and that would be gzip let's start off
the gzip and localhost Edie Edie and
I've done this literally every time it's
command is header yeah
funny story my trackpad stopped working
yesterday okay I will type it out again
and we'll actually get the information
right away to actually be able to see
this so header is accept-encoding and
it's gzip again and localhost:8080 cool
that actually did not get zipped
that's was cool but what we can see is
it's going through your okay um well at
least we get the file back so let's get
back to our editor so that should be
lowercased is the issue and if we come
back no that's still not working
oh yeah probably good idea ah cool
and what would be kind of interesting to
see here is actually how much space this
takes so what we can do is ah oh you
can't see the bottom cool that would be
important I think my keyboard also
stopped working
awesome so what we also want to do is is
maybe just see some output huh okay well
silence everything else and then we'll
still pass it in the header which is
except coding gzip and then what we'll
do is we'll pipe it over and just look
at the word count which is 235 with
deflate I'm going to minus this a bit
and just for a second
and then what else we wanted to do is
compare it to what a deflate output
would look like instead and kind of do
the same thing so also compress but the
word count should be a little bit
different which is three or five so gzip
just is smaller than what a deflate
compatible thing is it's kind of
interesting so that was kind of like the
Z lib example I wanted to show you which
is neat and then let's let's look at
other methods that you could use so we
looked at like 305 deflate 235 Jesus
just so you keep those in mind cool
another one I want to talk about is
broadly Bradley's Ben I think in out in
the wild for about a year would you so
it's a fairly new kind of way of
compressing and what it does it's it
specifically was made to handle HTTP
compression so it's made specifically
for web development which is kind of
cool so if we look into like go back to
this this stream of blocks that deflate
desk would deflate has is a single block
has like the literals if you don't think
about it in the bits that I was talking
about before has literals and it has a
length and a distance so like the
pointers and then the weighted symbols
that's deflate and what broccoli is is a
single block is actually a set of
commands if you can see the bottom so
instead of just actually these
interpretations is a set of commands and
what it has is insert copy distance and
actual insert literals and what's
interesting about this is that normally
weighted symbols have a dictionary that
you only insert while working in a
specific window but what you can do with
broadly is you can go back further at
any point in time instead of just in a
specific sliding window and apply that
dictionary which makes for a much
smaller compressed file which is neat
but it also comes with a dictionary of
Kalman they used HTML terms
which is again specifically made for
each to be compression so makes for a
much smaller file but it is base I mean
you can tweak it and things like that
but it's at its base it's much slower
and you have to wait a little bit longer
for actually for for the compression to
happen so a lot of the times it gets
used with static content rather than
doing it on the fly and what I wanted to
show you now is actually being able to
use this library I found called
broadly backwards because it can
pronounce that and actually you should
so you should be able to see the
difference kind of between the tube
things okay so let's start up another
file
and what Lulu what will needs kind of
the same deal I just copied over
we only need see Lib and now just call
it Express
okay broadly backwards teeth are the
bird oh I will still use pump and we'll
still use FS and will still do it on the
fly rather than actually compressing
files static files just so you see the
difference and okay let's not worry
about the headers we'll still need a
source let's not worry about having bees
what we'll have is then instead of
having compress will create a stream
with the broccoli stuff let's create
stream
Oh
ah maybe that is correct
it's called this broadly
broadly create stream awesome and let's
again start up server yeah and let's
look at I mean the compressed file is
going to look the same up Edna just want
to look at what the word count is like
so we'll do the same thing and we kind
of don't need to send in headers I think
but it does matter and also look at the
port count Oh will the word count in the
work crate stream is not a function okay
there's a bunch of different methods so
you can do async and synchronous but I
like the stream stuff so
oh it's compressed stream not great
stream cool that would make sense you're
compressing okay and we're going to need
a server again which is like 148 it's
like half the size which is neat yeah
there's that and that's how roughly
works
it's a Forney - actually I think and I
think it's super need to be able to work
with something that's more static so
you're probably going to have a ton of
images you're probably going to have a
ton of static assets you want to be able
to share and if they're taking up a
bunch of your space it's neat to be able
to use something like broadly and most
major browsers will accept it actually
all the big four the big four I think
are all on board with broadly so edge
Firefox the big three and chrome all
accepting and much more but Safari so
you'll have that and then when you're
working with your usual kind of bundles
of JavaScript and CSS working with
something like gzip if you're not
already doing that you would be yeah so
we went through the example so I wanted
to be able to kind of show you what it
is - what is like to kind of work with
HTTP compression I hope you learned
something
buzzy lip and I hope you get to use it
in your day to day work thanks
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>