<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Chengxi Li: Bootstrapping A Live Streaming React Web App - JSConf.Asia 2016 | Coder Coacher - Coaching Coders</title><meta content="Chengxi Li: Bootstrapping A Live Streaming React Web App - JSConf.Asia 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Chengxi Li: Bootstrapping A Live Streaming React Web App - JSConf.Asia 2016</b></h2><h5 class="post__date">2016-12-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RHq6bEgeZD4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">morning Singapore okay
my topic is about how to boost chap a
live-streaming react web app I think
this girl's J's conference is perfect
and I just saw the five minute talk just
an and I think there is a rare kind of
thing I think it is quite consider a
there is Cameron out there and then he
will switch the video here to show the
demo performed by the speaker had thing
I I suddenly see this behavior in
China's conference so I think it is
quite considerate but I think there is a
pity that this year's conference has no
live streaming video so the developers
outside Singapore cannot enjoy such a
perfect conference so hopefully next
year the committee of the conference
will permit up to write a live streaming
video to the developers all over the
world
yep we okay we will provide service for
you yeah okay about me
I'm from tension alloy team which is I
think one of the best front end
developer team in Hanson and my major
focus is on affirmation web and the
performance of web app and there are
some there's a small numbers of as with
live streaming features in China so you
can see the competition in this segment
segmentation is quite fears in China
because everyone wants to catch up
and so what comes up in your mind if I
mentioned live streaming do you have any
ideas yep
but there are more scenarios for example
in university we usually skip our
courses because the professors are
boring so we will just watch the lecture
video after the class and then some is
some musical students we all like prayed
a piano to earn money in the live
streaming app and as a gaming fan we
would like to enjoy a gaming narration
or as a james of bronze fan I'd like to
enjoy an NBA sports but there are a lot
of mature native apps out there but why
we need to build another like web
version of life swimming out there are
two reasons number one we would like to
attract traffics for example this one is
the scripture from life taught me which
is the famous live streaming app in the
USA which is produced by a Chinese
company and when you think the house of
the obvious video is it's funny and you
click the share button to share it the
link to the Facebook or Twitter then
when your friends clicked the link and
they also thing the house is quite
impressive derivatives register a ton of
the app and register as the user so
that's the target of the version number
two it can be a replacement for some
native features like the live room and a
second one is promotion activities
because there are a lot of different
kinds of activities the users were pay
this activity is because they will earn
some like gifts or they can improve
their favorite host in the rank but it
is not good for a native app to build
different kinds of activities so this is
the opportunities for for web and in
this talk what I can show you there are
three parts the first one in case there
are some people do not know what live
streaming is I've show you some basic
concepts about it and then after that I
will show you how to design the basic
structure of complete live stirring app
and lastly if the core of today's topics
is what to build in react so what is the
video here is a group of pictures and
they're consecutive when you pray these
pictures in a virtual time you can see
an animation so this is a very simple
video but for video it is not only
contains images it contains like audio
and the metadata about this video and
codec is like a - to compress the raw
data for example video we usually use
h.264 to compress our video and we use
AAC or h8a see the compressed audio and
after that we will wrap it into a
container we usually use like mp4 avi or
FL we but is there any connections
between like streaming and video yep
they do live streaming is to deliver the
video frame by frame from the server to
the client here is the fraud of how live
streaming
it's delivered to the client firstly we
use our device to produce a raw data and
then we upload the data while I'm rtmp
and web RTC then we can add some like
watermark or some filters to make the
picture that the video without the facts
and then we contrast the whole thing
with Kodak and when we when we finished
the compression we will push the stream
using like affair we Arabs Evo HLS and
finally we get through the client when a
client gets the streaming they will just
pray the video right away before front
and side we you we we cannot do a lot of
things about it but we can still do
something in the last step I will show
you later
so how can we pray the reader sauce in a
web we have three kind of solutions in
O'Day's fresh applause FL we is the main
stream it has low latency
however since Apple and Google decided
to give our supporting France in the
future so video and HR else will be we
do tag and actually how as will be the
future in though it has high latency but
it is it has a good compatibility in
mobile but am mpeg-dash I think will be
the future stander it not only has
loaded later disease but it also has
bechamel operating and it's also
convenient because we can load unpacked
- video while HTTP and it should be
asked
so what exactly is hls it is soft for
HTTP Live Streaming it has a control in
this fire core m3u8 and in this file it
has a lease of TS fires which is the
video we pray in a client-side and then
it has H dot 264 for the widow con codec
and has am be 3 or AAC for the audio
codec but if you would like to play that
HLS in chrome you have to install a
native OS pray extension and when you
install it and show the developer to in
chrome you can see there is a lace of
information about TS fires it includes
like the data and a duration so after a
very boring lecture
I've gonna show you how to design the
whole picture of the architecture before
we kicked off we need to think about
where the apps will be where our web
apps will be shown firstly we usually
have a standalone version and then for
some pages we will show it in the native
web and in order to attract the traffic
we will like share the links to QQ or
witch hats in Chinese in China or in
Western countries will share it to
Facebook or like Twitter and there is
some sophisticated so the video
solutions like in tans and cloud we have
a reader solutions for those startup
companies and and as a solar company a
developer you can use it you can use the
API or SDK provided by it as an cloud
and then you can like build a very
simple video
pray prayer but it is not enough is
still far away from a complete video a
live streaming app so based on our
working experience I come up with this
map of a whole structure at the top we
have a user system we offer a system for
reducers to register or login and we
have a charming pawns and LeBeau system
this is quite important because the
users will pave to increase their
charming points and the level and that's
why we can survive and next we have a
room which accommodate a lot of content
we provided to the users and for the
video we have two kinds of videos we
have a live streaming and the house can
deliver the message there or perform
things in real-time through the clients
and then if the thing the content is
quite minified who the clients Dave you
just make a record and then after they
finish the live streaming the the
clients can take a look at it in when
they when they're free and we also have
a message system for a client to
interact with other like users or the
host and we call the false for pass the
content provider because we think these
four systems we provide a meaningful
content to our users but besides we have
to survive so we we need to attract
users to pay for our service so we have
a few a payment system a gift system and
an activity system but to ensure the
whole thing working fine we need we need
a monitor system to monitor like the
performance and there now the arrow rate
of the whole system but you see it is a
choir large-scale system so it is quite
limited there Israel not enough time
today so I will just focus on the front
and side in this conference so what we
used to bill I have already mentioned in
the first PPT I will use react to build
a house system but it's not enough have
you also used with us to manage our data
and react route to manage the the route
and we also have to help from the web
pack because we need some API is like
require ensure in my version 1 and
system dot import in web pack ocean to
to make sure that we can build a single
page application but to ensure the
stability of the whole system we have to
use the started here in in July Facebook
has ready launch starter kit core create
rehab app but I want to use it I think
it is good but it is not enough because
it only gives us a hello world project
so I start I just decided to create a
starter kit course tamer reacts this is
also started care but it is based on our
teens max practice and how we improve
the performance of reacts for example we
include like pure render features in in
this starter kit to ensure that we can
improve the data comparison process
in web and we have a touch in Bank
component to solve the problem that
reactors no support touch in R and in
mobile browser and we also like have a
reduced dev tools to help the developers
is to see the data fro when we develop
an app an octane in addition we have
three template Rises for the first
branch we have a simple branch it is
just the helloweb project just like tray
or a gap and we also have a react branch
I use tensor news web app as an example
so as a developer when you use this
starter kit you can just copy the code
from these demos so it is quite an easy
process to develop an app using this
starter kit and lastly I have a I also
include in some morphic feature in your
starter kit so if it will you would like
to boost your performance you can use
this branch and in the future I may also
be like steamer carpet steamer wheel and
similar rectangular and so on so you can
choose whatever framers you like based
on your project but for today I will
have two cases to show you case one is
the life room and there are several
pages for the first one is this lays it
is the least page which has the
recommended hosts in this app and the
second one is the setting and the last
one is the life room and this one is the
anchor the profile car in endure and the
life room and I will show the demo here
I write ass demo for the past three
weeks right after work and here's the
lease page and then I click click it and
now it pays game of thumb you can chat
with the anchor
I guess and
give today
there's about
and in after this conference when I
clean up the crowd I will just put it in
the github and hopefully you can help
you to build a live streaming app for
your company so our target is to build
and our SVA
let's do a division job first because
react is a component based framework so
we will need to divide a how app into
pieces so the inner reffering is the
radial component and the green one is
the message component and blue one is
the activity component the yellow one is
the gift and payment component the red
one will be the user component so as a
whole they compose a room component and
it's quite clear that the co structure
will be like this so before you create
app you can just pray you can just pray
some empty components first and then you
praise video chat feature and so on in
in this structure in its wrapper and
after that you can just fulfill the
content of each component one by one so
let's come to the most important part of
video we have two kinds of video
components as I mentioned before we have
a live one and a pray by one and clearly
the live one is the subset of pray bag
so let's finish the moral compress one
first let's do the division drop again
here is the progress bar the pray bottom
that they talk the audio bottom the
audio controller
and as a whole it is the controller and
right above it it is the component to
show the video so for the bottoms which
is which has not so much change we can
use a console abandon rack in react to
represent and we can and all this come
cause elements can compose it a praetor
control so we can create another
component to accommodate these elements
and write some logics about how to
control the video and since we know life
control is the subset of pray back
control we can just simply extends it
and then we we can just do some small
modification for example we know a live
controller does not contain a progress
bar we do not need to initiate the
progress bar in this component and and
then we use live control playback and we
do text to form the whole life rooms and
in this process we used hoc to help us
to finish the job so what is hoc it is
so for high high order component I think
it is quite easy to for you to
understand it is just like you put a
Picard shoe and then it returns a Rachel
now it it always returns a stronger one
and then when you when you try to create
a live room or private room you just put
the video and a controller and does it
so here's an example
it is create a the pray back and room
creator which is the is a an hoc
and then you'll pray some metrics in in
these components and then that's it and
this is the same here so in a row it is
just like a template you might think if
you use hoc correctly you you can just
create a different tamp raise for
whatever the product manager asks you to
do so if the manager hope to add the
bullet screen you just put a Burris
scream component here and then you just
finish this component does it it's quite
easy actually these are all concepts
which you maybe see in other as one's
programming languages but Reax is this
is a new implementation of this new
concept it and it is the perfect one for
those elements does not change much the
interest you easily use Khan's element
to represent and for those components
have a lot in common
simply use extend and lastly for if you
wanted to create different combinations
you can use hoc after some chitchat I I
will also like to show you how to
control the video for life raucous it is
not takes a long time you can just use
m3u a if you use HLS and you can praise
video tag here and as some logics to
listen to the real events like like can
play praying time update and etc for
pray back it is also easy to but what if
the product manager helps to support
trom and then you may consider to use
mp4 but what you use which is still use
only one link and one video tag in this
scenario I'm saying no I reused two or
more widows text to help but the theory
is the same as HLS because in HLS there
are several pieces of TS virus but the
browsers we would do the whole work for
you if you just you just pray the first
test fires and when if it is nearly
finished it will load a second one
here's the example we have three widow
text here and when the first one is
praying
the other two are idle and for example
there is 210 seconds to go in the first
video you will start loading the second
one and when I friend the first one
finished the second one starts praying
and the whole process loops and then
this distinct theories I think is quite
clear right and here are some
compatibility issues on how to control
the video button I will not go into
details you can take a look after the
conference so next I would show you how
to lower the stream as far as I can
there's something front-ends I cannot do
but we can help the back ends I actually
you're the size of group a GOP really
matters in in this situation for example
if the GOP is too big so it has a high
solution but there is some downside the
performance of the first screen will be
slow and we have a high delay so we have
to trade off we have to pick up
relatively small size in acceptable
range of resolution
but they were sooo something the front
ends I can do in react we can use server
render which is core in some morphic and
there are three options here to and from
left to right the performance will be
with the worse for the big pie it is it
has a it has the best performance before
the window data a scrape it has the the
worst performance but it is still
slightly better than the app without
server and ax so one is window data for
example you create a an express server
and then you just load the CGI the API
and then you just put the data in a
script and after the server render the
whole structure the jas in the front and
we just gather data from the script and
then it is and then it was render the
whole structure however from the right
the right one is is the easiest to
implement for big PI you have to do a
lot of work like change the whole
structure of of your logic and you have
to also modify the building too to build
an app so for me I will use just use
render to stream it has a relatively
better performance and you don't have to
change a lot in in your app you just you
just use render to stream API in a react
and does it so after I finished the we
do part I will introduce the interacting
part in a live room there are three
pictures here for the first one it shows
you the messages and a second one it has
some like faces you can send to the
anchor to express your
fillings right now and the right one it
offers some gifts for you to send to the
house if you like this tanker so there
are also three choices for you to build
this interactive part we have a
WebSocket which is the future choice but
since it has some compatibility issue
and some polyfill to finish this job is
quite large so I will just dumb this
choice but I will take a look at mckee
p-- watching how the community solve
these problems and if in the future the
browsers a more browsers we support the
WebSocket feature I returned through
this option for the second one event
source since it has a once I
communication feature so it is also not
good for building the interview
interactive feature so lastly I would
choose long polling it is a cross
browser option you can just use it you
can just use Ajax to finish this feature
and it is not used up too much servers
to resources so it is quite a good
choice one last thing don't forget to
control the dom numbers because when the
users send a lot of messages and the dom
numbers will just increase immediately
so we have to in control the numbers to
avoid rendering issues in this app so
the second case is about activity which
is also the important part because we
need to rely on this part to survive we
need to attract the users to pay our app
we have to client different kinds of
activities here like
kajoor gift game or discount for each
charge and some requests and and
actually we can see in the left side it
is a PC version of luggage or activity
and on the right side it is the mobile
version of lucky Joel and there there
were a lot of components we can really
use and when we when we finish the left
one we will just copy the code and do
some modification in CSS styles and we
can tackle it using what using just one
developer account but in this case what
I want to show you is is that rillette
is too heavy for this kind of pages and
when I try to recommend react to my
colleagues in such kind of activities
they refers to use it why because the
thing is too it is too heavy of activity
pages so I would recommend you react in
this case it is a library solution in a
community and it has also has a good
performance you can use with exactly the
same react API and Jas and the code base
of this project is quite small and and
our team started to contribute to this
project in order to fulfill our target
and here is the benchmark you can see
the the performance of this framer is
not that bad and in some I am in some
tasks it is also better than react and
the most impressed impressive thing is
that pre L only has 10 KB and even you
you add prayer
act come back to use foo api's with
react
it only has 14 KB to the whole bundle
but comparing to react if you use react
it occupies more than 100 KB and that's
quite a lot and here is thickly yourself
it would be good if you couldn't wrap up
in the next two minutes sorry
it would be good if you can wrap up in
the next two minutes depth yes III am
you finished and and here's lays off
like lightweight solutions and you can
take a look at it when you go back home
and yep this is the end of my topic and
today I have already talked about
livestream this is the content we would
like to provide and we use react to be
the whole things so hopefully I this
lecture will tell you how to build the
whole thing in like one week or two
weeks so thank you thank you
same thing
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>