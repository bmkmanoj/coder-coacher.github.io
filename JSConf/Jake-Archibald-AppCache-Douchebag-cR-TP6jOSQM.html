<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Jake Archibald: AppCache: Douchebag | Coder Coacher - Coaching Coders</title><meta content="Jake Archibald: AppCache: Douchebag - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Jake Archibald: AppCache: Douchebag</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cR-TP6jOSQM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">or just exciting thing about gaming it
was really fun so we're going to keep
the fun rolling with an in-depth look at
part of the web application
specification so I'm just going to dive
straight into that so back in the days
of dial-up we were at peace with the
internet being this temporary thing
right we would log in we would check our
email and we would log out and we were
cool with that but now we're almost
always online we carry devices with us
that I've always have an internet
connection and because of that that that
means being with outer connection
becomes a much more of a deal in it than
it used to be our speaking to a few
people who are not from the states and
they don't have mobile data here an L
know what I'm all about when I'm data
roaming I feel like a like a gambling
addict I know every time I connect that
I'm hemorrhaging money but I can't help
myself I'm kind of worrying what the
Internet's doing behind my back like
it's some kind of untrustworthy partner
or a party that I'm not invited to I but
my phone makes this little beeping sound
when I date a room is a kind of warning
but I almost don't need it because I can
almost hear the champagne corks popping
in the tmobile offices with every
megabyte I eat like I connect to the
internet they go out and buy a car I'm
I'm disgusted by my own dependency on
data where I a place i used to work this
happened about six months ago I needed
to go to the toilet for a dump which is
a thing I do now there were five
cubicles to choose from and that this
one instance the first four were
occupied that's usually okay because I
tend to only use one toilet at a time in
this as an extreme circumstances by knew
from personal experience that the office
Wi-Fi only stretched to the first floor
cubicles
and there's no mobile data there either
and I fought for a moment in the sport
no not good enough I find this totally
unacceptable and I turned around and I
went back to my desk and I sat down and
I waited until later and that's when it
dawned on me that I have now become a
human being that requires an internet
connection to go to the toilet what can
we do to fix this well obviously we
can't create data out of nowhere but we
can't make our sites work offline and
let users use pre downloaded a
downloaded data in new ways browsers
have historically required an internet
connection to work they've had a cache
they've had a cash for like forever but
maybe the user or the developer has
enough control over that cash to create
a reliable offline experience Google
weren't happy with this and they created
local server as part of the gears API
that let you create stores of data heat
against URLs and that would be available
offline as you can see that's no longer
available Google gears is no longer
active that's because most of the ideas
were taken on by the web applications
group the offline stuff was reimagined
as offline web applications and therein
lies the application cache and that's
going to be a sort of anti hero of this
talk now the application cache is like a
candidate from The Apprentice now I
don't know if you guys get the UK
version here if not you're probably
wondering why I've shown you a picture
of a shaved head hog who looks like he's
suffering from ingrowing spines this is
this is Sir Alan Sugar he's a boss in
the UK version of The Apprentice the US
tends to do TV better than UK but I
promise you that this this man is much
more bearable than the u.s. equivalent
Donald Trump whose hair along just looks
like a cloud of piss that's lodged
itself the top of a ragged sex doll you
know but the application cache is more
like one of the candidates of the
apprentice you know that when they're
interviewed they are incredibly
confident they're really good at selling
themselves they'll turn to the camera
look at directly in the lens and they'll
say I'm going to turn your offline
experience from sucks ass to success and
and when they're given the task they'll
definitely try and take over the
operation trampling over everything else
just to try and get noticed they'll get
the job done in a manner of speaking but
you're left with this loud horrible
business douchebag at the sensor at all
and we have to be very careful as
developers to hide all of that
douchebaggery from the end-user I'm
going to
how you go about doing that when you
make a site work offline with
application cache how you do it depends
on the kind of site it is and the two
extremes we're going to look at our
sites that tend towards doing stuff with
content insights that tend towards
getting content in terms of get stuff
sites things like Wikipedia travel site
YouTube Twitter these are sites with a
lot of content and as the user you'll go
and find a bit of content and look at it
the heavy lifting tends to be done on
the server and they should have lots of
hopefully meaningful URLs not all of
these do alternatively do stuff sites
things like Google Docs linters and
validators games online IDs these sites
offer a relatively small amount of
content themselves but you can do a lot
with that content or you can use them to
create your own content the heavy
lifting in these cases tends to be done
on the clients or could be done on the
client and they tend to have fewer URLs
this is the case that app cache was
designed for but as well see the app
cache specification is like an onion
peeling through it can reduce a grown
developer to tears or at least that's
what happened to me we're going to look
at off lining a do stuff sites like to
start with now I realize I've just taken
the word offline and verb ified it in in
fact I just took the word verb and verba
find it and the problem here is it's not
really a good verb for making a site
work offline so I've taken some verbal
shortcut but I'm told that it's good to
try and explain something using your own
words and these ones aren't even in the
dictionary so I should get bonus points
I think so with that in mind we're gonna
look at offline arising sprite Cal com
which is a sprite cows the only useful
thing I ever built I'm not like Remy and
check out a new thing every couple of
months what you do is you give it a CSS
sprite sheet you load that in this it's
just a test image you click a bit of it
it gives you the CSS for that that part
of the image it's one HTML page all the
processing is done client-side all the
server does this serve the assets this
is a live demo running inside Chrome so
if I were to cut the connection and
refresh the page it doesn't work we get
some of the files and not all of them
and that's because they we can't rely on
the cash that's a shame cuz it'd be nice
to be able to use sprite cow on the
plane on the train I I shouldn't need an
interconnect internet connection to make
it work so let's let's go about fixing
that
to make this site work offline we take
the HTML element to the page and we
point out a manifest using this this
manifest attribute now fortunately this
is at the manifest file it's not XML
we've managed to get over that whole
thing unfortunately it's a custom baked
format it starts off with cache manifest
in huge capital letters which is kind of
warning sign because that's the you're
quite a douchebag thing to do to shout
your own name in capital letters but but
but after that just list the files that
you want that form part of your site
your co CSS your JavaScript any of your
assets images fonts favicon on all of
those things all these URLs are relative
to the manifest itself but you can also
include absolute URLs make that the rule
is you can't cross the schemes if your
page is https you can only include HTTPS
URLs you'll notice like the HTML page
itself isn't listed here that's because
any page that points out and manifest
implicitly becomes part of that cash and
you need to make sure you serve the
manifest with the content-type text /
cache manifest that's that is going to
be dropped from the specification that
decided that shouldn't really matter but
the current implementations require it
so you need that for the moment and with
that small little change I can now go
and cut the connection and refresh
refresh the patient but it still works
so that now works without without a
connection and that was relatively easy
the browser support for that is really
good as well so the desktop browsers
they've supported it for a while all
that transitions not working Paul Irish
needs to fix chrome wherever he is
anyway the mobile device we were hearing
before that it doesn't work on some
mobile devices that's not being my
experience it's the be support for quite
a while ironing out the bugs the the bug
that you heard about there with airplane
mode I've seen that but oddly enough it
seems to only exist in airplane mode a
lot of these things will work offline
when the phone just doesn't have a
connection or sometimes after a couple
of refreshes they'll pick it up tend to
see that on all the blackberries I am
Android my android phone it works fine
on the Android ahead before it works
fine unfortunately there's no support in
internet explorer and that means no
support windows mobile either although
it does work in IE 10 platform preview
whatever it was so there's a good chance
that it's going to be there when it
fully launches all these browsers let
you use the application cache
transparently if the exception of
Firefox which will put a message up and
user has
click allow to make it work it can seem
at first like this was a small piece of
progressive enhancement but watch this
time he'll go to an editor and I'm going
to change just that the title of the
page there from sprite cow to yay j/s
conf and say that out so now back in the
page I'm going to refresh refresh
refresh no change oh wow hello the
behavior of the site has significantly
changed to what we would expect and this
is the first piece of douchebaggery are
going to look at the application cache
completely takes over the operation
let's try some of what's happening here
the first time you load a page it's
requested normally and if we get an HTML
page and that points at a manifest file
the manifest file is downloaded and then
the browser will go through that
manifest file and download all the files
inside it and if they all download fine
they form a cash if any file that you
list for all fours 500 anything like
that the whole caching process fails
I've seen this described as a gotcha but
no this is actually a really good thing
because it gives us two states who can
rely upon can I've rely upon the cash
being entirely there or not there at all
and that's what makes it better than the
current browser cache where some files
will disappear another ones will stay
subsequent requests will go differently
if a file is in the application cache it
will be served from the application
cache otherwise things will carry on
down the same path we saw before a lot
of blog posts and speakers on the
subject they make the assumption that
the cached version is only used if
you're offline and that's not true
connectivity doesn't factor into it at
all the version will be served from the
cash if it's there always the plus the
reason they do this is because what is
offline what does offline mean offline
could mean you don't have anything a
wire plugged into your machine it could
mean that the roofie you are connected
to doesn't have an internet connection
it could mean that you you know have a
dns problem a proxy problem the site is
down there's no fast way to detect any
of this so it makes it come straight
from the cash straight away and that
means you get the site quickly but it
still checks the manifest in the
background when it comes on the cash to
look for updates but if it's looking for
updates then then why are we not getting
the heading not changing why is it still
so sprite cow unfortunately this is
another piece of
magarri there's another layer of cash
validation it has its own system see the
application cache it won't update unless
the manifest file has changed in some
way and I mean that in any way at all so
anything that makes it not bite
identical so here's a list of files we
had before you'll notice that a lot of
files have version numbers that's
because they're all far future cached so
changing them involves changing URL like
that version 2 and that's also changing
the manifest everything just kind of
works and that's fine for the CSS and
JavaScript but we changed the HTML and
that's not listed here and even if it
was it's not going to change URL so a
common way to get round that is to add a
comment into the manifest file something
like this comment start with a hash
symbol and although it's a comment that
still counts as a change to the manifest
and that will trigger an update here
I've just used a single digit you could
use some kind of build system to combine
things like e tags or something like
that this is the biggest ball ache when
developing an app cache site every time
you change any of a file you have to
change the manifest as well and you
can't just use some kind of random
number generator because when when the
application cache updates the manifest
it downloads the manifest at the start
of an update and at the end and if the
manifest has changed during the update
the caching process will fail because it
will assume right I've downloaded these
five files but the manifest changed at
some point during that these files could
be from two different versions so it
fails it the cache won't settle this is
something that catches a lot of people
aren't going to start playing with
appcache the byte for byte identical
check thing this is additional to the
normal browser caching app caches is
separate to the normal caching layer it
doesn't replace it it sits on top of it
and it shouldn't be used as a
replacement that might seem obvious but
this is what catches people out because
they'll update a file will update the
manifest and they still won't get
changes to the file and this is because
they're playing around on the local
apache server and they're not using
caching headers so basically he's got
the first I'll cash instructions right
we can say don't cache this or check
back for the server or assume this file
is good for you that's fine but without
one of these the application cache takes
a file to the networking layer and says
update this file and the networking rate
goes no but this doesn't have any
caching instructions how should I update
it
oh yeah however I want and browsers try
and be as fast as possible and that
involves doing as little as possible so
quite often the caching layer will just
send the file back and say it's probably
okay the application cache will
unwittingly update itself with a stale
version from the standard browser cache
if you don't tell it otherwise and that
kind of copying can be really good when
it's under your control when you're
controlling it with cache headers
because you can save HTTP requests with
far future caching but out of control
caching has awful results out of control
copying that that took street fighter
and turned into street fight of the
movie and turned it into street fight at
the movie the game this this is a thing
that actually happened I assume at this
point someone had to step in and reboot
Hollywood in the games industry before
it just got itself in a complete loop so
in terms of your manifest you'll you
know far future cash things that change
not on every request and then make sure
they change your own when they do so if
it can change your world and do it for
content that can't change URL but
updates relatively frequently use a no
cash header or must-revalidate but make
sure you change a comment in the file as
well now following that advice you might
think I'll hang on I could do the same
to the manifest file itself I can put a
version number in there offline v1 and
far future cash it and save on that HTTP
request that's going to happen on every
page and then when you want to make a
change change the url same as you do if
the javascript and CSS you must never
ever do this the specification will
punish you for doing this what actually
happens here is where does the browser
find out about the updated manifest well
it finds out from the new HTML file but
where does it find out about the new
HTML file from the new manifest I did
this with sprite cow and I did it my
deploy decided it was about 20 minutes
before I just a little for entered my
head and I oh oh gods and I went back
and changed it looking at Google
Analytics 30 people visit the site in
that window those 20 users will never
get an update to the site ever again and
unless they clear their browser cache or
you know get a new browser that they now
live the life of blackberry customers
everyone's
shiny new stuff but they're getting the
same whole thing again and again and
again so before we move on why do we
have this extra level of cash validation
why do we have to change the manifest
file I think it's really stupid but this
is the reason imagine how to manifest
like this you know 50 HTML files date
URLs don't change updating this manifest
is 50 HTTP requests 52 if you count the
manifest on either side the text
changing trick is to avoid that
happening on every page load it really
just puts the problem back in your hands
as a developer you have to decide when
it happens and it is just a
specification just clearing itself of
any blame in my opinion but let's prove
a point let's get this heading change so
I'm going to go into my manifest file
and add just version to something like
that okay so now i'm going to refresh
the page no change refresh the page
again and yay ok so the contents changed
but we saw something important there end
of a piece of douchebaggery it took us
to refreshes to actually get the content
and that's that's kind of a side effect
of the flow of the application cache we
saw before that the the version comes
from the cash if it's in the cache and
then the manifest is updated afterwards
but by that point the users still
looking at the old version so even if
they get a new version they're not going
to see it until the next time they load
the page there's a JavaScript event at
this point that you can use to do
something and that's an update ready
that happens when the this browser
downloads a manifest there's a change
and it downloads all the files within
and all those files download
successfully in form of cash at this
point you can call swap cash and what
that does that starts using the new cash
immediately for subsequent requests but
by that point the horse is already
bolted you know the users already
downloaded the page swap cash is
actually pretty useless I don't
understand why it made it into the
specification over a load of glaring
omissions there's very few use cases for
swap cash you could just force a reload
of the page and that we on the user will
get a new version but this is a bad user
experience because these are might have
already started interacting if the page
imagine you'll be using Gmail you
started composing an email and it just
refreshed on you because there's an
update that's not great as a compromise
just within your app show some kind of
message saying hey there's an update
refresh at your leisure and you'll see
this on various Google Sites another
compromise it just to not care and
that's what i did a spike how I mean so
what if people are on a version before
for one viewing in terms of breakout
it's not a big deal people aren't going
to be on that site for a long time so
this is the simple example are we done
yet it looks like we're done but a nasty
buggers crept in our analytics to stop
working you'd only spot this if you were
looking at web inspector or fire bug or
something so why are these connections
failing well let's have a look at a more
visual example so this page here users
are manifest but in the manifest it only
points at the CSS file and obviously the
HTML file is implicitly cached so even
though that we have a connection here i
refresh the page and the images suddenly
fail of course this is another piece of
douchebaggery the application cache
doesn't like stuff that isn't in the app
cache the first time we saw the page it
wasn't cashed we refreshed got the
version from the cache everything Oh
Liam just stopped loading to explain it
some afraid we have to go back to the
diagram unfortunately we've missed some
detail from the top once the browser
makes a get request to a URL it looks to
see if its associated with manifest and
if it is associated with manifest it
uses it and things continue as we've
already seen if the URL isn't associated
with manifest things just request
normally as they normally would without
a manifest now that just sounds like a
complicated way of saying what we've
already said but here's the difference
every request that's triggered by a
cached page your j/s CSS your images as
before they go back through the same
system but they don't reselect a
manifest they'll use the manifest of the
host page now that's fine if the image
is in the cache it will come from the
cash otherwise the connection fails and
that's what we saw if those images it's
no coincidence that this part of the
specification is in section 666
this is the specification of the beast
this is where all the really gnarly
stuff is so this is that's what's
happening here that's why those images
are failing we can fix that by using the
network section of the manifest and we
can list full paths or we can use a star
and that makes things work the reason
that makes things work is if the URL
isn't cached but it's listed in the
network section it's requested normally
otherwise if there's a star in the
network section then the files requested
normally otherwise it fails so that's
how you bring things back those files
that you list a network they won't be
cached they will fail when you're
offline but they will work when you're
online so you need to make sure your
online only stuff such as analytics that
they're taken care of by one of these
two network rules well that's it really
that's the simple example all done and
it was at this point that I wanted to
lock myself in the bathroom and wait
until the internet had gone away maybe
even in the end cubicle at work where
the internet can't get me but but this
is jess conf we're not afraid of peeling
the appcache onion a little bit further
so we'll look at a different kind of
site will look at a get stuff site and
i'm going to use em lanyard calm as an
example for this is something we built
we found on your comm you can look up
future conferences you can get details
on events that you're tracking or
attending and you can get information
about a particular conference so it says
Jess conf because that's got the
scheduling things it would be great if
this worked offline so I can look it up
and I was on a plane or in a different
country wherever but there's too much
data and lanyard to offline afuck ate
everything right but users are only
interested in a subset of the data that
that language has marked pilgrims dive
into html5 that had a decent section on
the application cache and it offered up
a solution to offline ur eyes wikipedia
which is maybe something we could use it
worked by having every page pointing at
our manifest every page and that
manifest just had like the JavaScript
CSS usual stuff because page is pointing
our manifest are implicitly cached as
you kind of get lost in the Wikipedia
labyrinth more and more of the site is
becoming available to you offline dead
simple it doesn't even require
javascript but also as a solution it's
just not good enough reason it's not
good enough is there's no indication
which page is going to be available
offline do you
doesn't know that one of the major
oversights in the spec is there's no way
with JavaScript to ask the browser
what's cached there's nothing there so
we can't we can't provide like a UI to
show the user what they can expect to
work and it's near impossible to manage
update those cached files are only going
to update when the manifest file changes
but when do we change the manifest every
time a page on Wikipedia changes that's
going to be far too frequently and those
updates are going to be heavy as well
imagine you look at 100 pages on
Wikipedia which is you know probably a
conservative number you have 100 pages
cached when a manifest changes that's a
hundred pages for you to download and
we've already decided that that's going
to happen every page load pretty much
latinum was only going to get bigger and
bigger and bigger as you browse around
the site more because we have no cleanup
mechanism got no way of expiring those
pages from the cache the cash will
eventually hit it's allowed limit and
then things will start failing so not
good enough ideally we want to be
showing up to that content to the user
while they're online and in control with
JavaScript which content is going to be
cached and what isn't and defer that
content to the user so maybe in the form
of a save offline or read later button
and indicate which content is available
offline and maybe change the link color
do something there so the user knows
what they can expect it to work for them
when they don't have a connection and
this should be set up with a single view
to any page on the site we can't say to
the user oh if you want the offline
stuff go to slash offline as any page
should make this all work app cache
makes this really really difficult so
when I was a kid we had a sandbox in the
garden not metaphorical sandbox an
actual sandbox with sandy and I'd go
there to play and build stuff you know
it was a real creative outlet for me
unfortunately the family cats they also
used the sound box for a completely
different kind of outlet turns out you
can't build sandcastles a catch it I
made some stunning catch it castles oh
but fast forward 20 years and Here I am
them in the same situation again but
this time it's the idiot someone else is
crapping in my sandbox it's the
application cache putting a manifest
attribute on HTML element means the app
cache moves in and takes over to solve
this we need to take the application
cache and pop him in a box where he can
be Schrodinger's douche bag and we can
leave in there until we care if he's
dead
alive to do this we're going to put the
manifest on one page only just one page
offline stuff to HTML or whatever but
going to make sure that every other page
knows about it by having a little hidden
iframe point into that page so not
matter what page you visit is going to
pick up this cached page and its
manifest the manifest is going to be the
same as you know what we've seen before
CSS JavaScript network rules whatever
but a new rule fall back a fallback rule
has two parts a URL prefix and then a
full relative path to some file to cash
this is the point where they should have
been using JSON or something because
it's getting complicated Google gears
use Jason and it was much more readable
in my opinion so what does fall by 2 ok
so if the URL isn't specifically listed
in the network section it scans all of
these fallback prefixes and it looks for
the largest one that matches the current
URL if any and if there is a match it
will request it normally and if that
request goes ok then it uses it and then
things will continue as if the manifest
wasn't there at all but if the request
fails they'll use the second part the
cache partner will show the cached
version instead and that's really good
because we can we can use that to create
pages that act normally while the user
is online such as this but if we disable
the connection and refresh the page we
get completely different page but the
URL stays the same it's just it's like a
it's more of a rewrite than other than a
redirect so when I bring the connection
back and refresh the page we get the the
online version again unfortunately thank
you I invented that I didn't
unfortunately this gets us into some
browser troubles by using fall back we
wave goodbye to opera support we have
cold like this on lanyard unfortunately
and it's not great but I haven't found a
reliable way of feature detecting fall
back we've got too many false positives
it didn't work i'm looking forward to
removing this one's or prefix is that so
we're using the manifest for static
content only and every user's going to
get the same manifest thank God so where
do we store this the date of that a
particular user wants cached offline
over that we're going to use local
storage and I've flown together
demo of this so you can see from this
page that I have to test articles one of
my test articles is bigger than you have
a test article but that's okay but thank
you sometimes people don't get that joke
okay I just put it in there for my own
entertainment really but as you can see
it's got this save for offline access
button so I'm going to hit that so what
happened when when I press that when i
click that button it looks at the the
URL for the page and gets the HTML
because the URL doesn't change remember
so and then it's going to stall at HTML
into local storage using the pathname of
the URL as a key and we update an index
op object as well so it goes to
something that we can quickly look for
pages available offline on that this
code runs every time the user hits the
cash later button or if they visit the
page later and they've already decided I
want to cash it will run that code again
anyway to make sure that the version in
local storage is as fresh as that the
last version the user saw so if i
disable the connection and hit refresh
write the content comes back but under
the hood it's actually gone to this
completely different fall back page and
what the fall back page does is looks at
the URL because the URL doesn't change
and it looks to see in local storage if
there's content for that URL and if
there is it just repopulate stu page
with it so this is a simplification
you'll also want to catch your l's that
you don't have content for and you know
do more error detection around putting
stuff into local storage but having that
index object is really handy because it
means when we go back to the index we
can just we've got a little piece of
JavaScript I can just go is this your L
cached and we can get a true or false
value and we can show that to the user
so the user knows what they can rely
upon being there when they're offline
this is the same mechanism as we use on
MDOT language comm with a few minor
alterations we store Jason rather than
HTML because it's a more efficient use
of the local storage and we render that
Jason using mustache templates we use
the same mustache templates on the
server as we do on the client so there's
no repetition there and the server
remembers what the user wants cash is we
catch things when you click the attend
but another track button because that
data stored on the server if you lose
your cash or change phone we can quickly
repopulate the
and we expire all day as well when a
conference goes into the into the past
then we get rid of it we assume you need
anymore MDOT Langer calm is is mainly
for current and future conferences the
main sites for the ones in the past and
we do more error detection as well is
the system perfect no now there's a
introduces a few new problems when you
navigate around the site online use that
page is fix fetch bio xhr and we saw
that in asynchronously we change the URL
with push date we do this to avoid
passing some JavaScript you get a minor
performance benefit but it's mainly
about giving a more of an application
like feel to the site app cache screws
is over unfortunately when we do this
and really sorry gonna have to go back
to the diagram earlier we found out that
HTTP requests triggered by a cache page
will always use the manifest of the host
page which is fine however if the
request happens normally then any
requests triggered by that page will
also happen just normally app cache
wants no part of it that means if your
user requests a page when they're online
and it loads fine but then they go
offline like that driving through a
tunnel or whatever new requests like hxh
our JavaScript whatever they will fail
even if they're part of the application
cache even if they're covered by a
fallback rule they will just plain fail
so what we do online your diff a piece
of xhr navigation fails we just set
window.location to whatever the original
request was and that throws things back
to the top of the diagram and the user
barely notices another drawback to this
method is the fall by technique gives us
problems with error feedback to the user
I mentioned before that yo D the
fallback version is is used if the
request habit goes okay but what does ok
mean the request is considered to be
failed if this is some kind of
networking error the HTTP code is for
something something 5 something
something or there's a redirect to
another server that last one can seem a
bit odd the reason for it is this these
things these captive portals so you
request something in it redirects you to
some kind of Wi-Fi thing that wants your
data or wants you to pay for it app
cache is kind of clever here and it
assumes that that counts as no
connection and it will get the version
from the cash if it's there but it also
means you can't legitimately do a server
redirects if you're using app cache so
that means you can make redirect to
Twitter or Facebook for logins instead
you'll need provider
for the user to click on to do that
otherwise your it will count as a failed
request unfortunately when the the
fallback is used we're not told why
there's nothing the API it tells us why
that happened we can't tell the
difference between a mistyped URL and a
URL that the the user just doesn't have
cached offline and that makes our error
messages a little bit vague but that's
it really we've covered all of the
gotchas and it turns what's night offers
a very simple diagram into this big
horrible sprawling Christmas tree I
think of other diagram well the point
I've been trying to make a guess in in
the last 30 minutes is the application
cache is a douche bag as part of my
personal therapy at work I have a
selection of post-it notes on the wall I
have one for each browser and the theory
is I could draw a little against a
browser if it made my day unpleasant
but I had to create one just for the
application cache and it became what
could only be described as riddled with
 very quickly but the application
cache is actually extremely useful it
does stuff he does stuff like no other
feature can so we need to learn how to
work with him here's me a presence on a
page will change the behavior of the
site it's not really progressive
enhancement you need to build your whole
site around it which can be okay with
something like sprite cat which is
pretty small but for you know a big
slide such as lanyard you need to
sandbox sandboxing use the iframe trick
so you're only using the app cache of
the connection fails use the app cache
just for static files and then use
something like local storage for
anything optional probably in the future
you're going to use index DB instead for
because that'll be an asynchronous API
and that's it really oh thank you very
much my email address is there if you're
makassar just ask me questions in the
break whatever i'm on twitter a lot of
the demos and stuff or up on github and
the slides are online on language so
thank you very much thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>