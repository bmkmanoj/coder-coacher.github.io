<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Mathias Buus: Booting Docker Images over Bittorrent | NodeConf ONE-SHOT | JSFest Oakland 2014 | Coder Coacher - Coaching Coders</title><meta content="Mathias Buus: Booting Docker Images over Bittorrent | NodeConf ONE-SHOT | JSFest Oakland 2014 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Mathias Buus: Booting Docker Images over Bittorrent | NodeConf ONE-SHOT | JSFest Oakland 2014</b></h2><h5 class="post__date">2014-12-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PdBHYYHY7z8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so everybody i'm mateus i go by math
intosh on tour and get up so max said
that he was told this morning that he
had to do a talk I was literally told 20
minutes ago they had to do a talk right
so this is going to be highly improvised
so I'm gonna try to stick with the idea
that Michael talked about of having like
a flu so I also i also work on the debt
project with max where we do like fun
stuff with replication right so one of
the examples i'm going to just cannot
light types on mice nights because i
have nothing basically so like one of
the slides the net max sure what's
coming like this right like dr. Ron
thing think so like I'm very interested
in like this step right here right the
daughter run think so has anybody here
actually try to using daughter because
like I run into this all the time where
people have heard about daughter but
haven't tried it all right has anybody
tried pulling an image from the registry
right that's a pain in the ass right I
mean can we all agree on that I mean I
don't know what they do with that
registry by think it's located in
California because I'm from committing
and cross-atlantic latency thing like
literally every time I try to do
something with it takes two seconds
because it has to do it's the P
connection for every layer and it's like
you end up wanting to kill someone which
is kind of annoying because they're
killing people are illegal is illegal so
I mean anyways so I wrote this thing
called torn stream which is like it's a
note module kind of touching like if a
reference back to a node weight talk
it's like a small no module that's one
thing that's really cool it allows you
to stream a torrent so it basically
allows you to I think there's an example
down here somewhere right so it makes it
basically allows you to like pass in a
torrent or a magnet link which is just a
shortened for torrent then allows you to
do a read stream to that torrent so a
rich Dream is basically just saying I
want to get that data for this file this
torrent when you have it but guy kind of
try to fetch it on the man right so fits
this data in the torrent as quickly as
possible
so I use this thing to build a video
player called pure fix that yourself you
just display video and somebody use that
to build something called popcorn time
that I've actually to show a legal video
but that's like that's unrelated back to
back to like so what does this thing
have to do with docker well it has to do
with the fact that I don't want to kill
someone when I pull something from the
registry so i made this other thing a
color weeks back called torrent docker
which kind of combines the idea of
illegal videos on the internet we're not
killing someone when you pull the docker
image so what it does is it it actually
it's actually really really simple but
it sounds really advanced so like it's
something that makes you sound a bit
arrogant but anyway so it implements a
union file system that's backed by bit
torn for a readable part but like right
stuff to the local file system so if you
think about it this way it's like if you
you can like mount a torrent right and
then every time you reach and that gives
you like a drive like to a drive right
and then every time you read something
on that drive this happens tonight is it
local if it is local reading local is oh
is it in the torrent then we different
chart so this is basically a doujin file
system because like it has two layers
it's a union of these two layers and
when you write something to describe it
face it just says like right to the
local file system right all right and
I've talked so this is fat well that's
weird
so she's probably make this figure so
I'm just going to demo it because I
think that's explains it there so if i
boot into log into digital ocean
instance I've running here I think it's
running in here so I'm on Max's tack on
it it might be I don't know how fast it
is but alright it's fine so like this is
a machine that's located in Europe
across the Atlantic all right
in here I quickly made a folder it's
called one shot this machine should have
a Duggar image ah that's a nine called
test image dogger images oops right so
that this has a program is called test
finished this machine in Europe has a
dog ranch golf test image I can daughter
run this thing and it boots up a
daughter container here to have stuff
like Nolan right that's cool so
what I did beforehand like 20 minutes
ago when next told me to do this thing
was i exported this thing into a tarball
it was basically just like you can tell
dr. to say that image there can you kind
of create a tarball the contains the
entire file system and dump that out to
stand it out so I did that and I say
that in the file so it's in here oh I
shouldn't get that don't you aah buh you
get the center this thing is big ride I
want to do this thing right I think you
can do the dash age all right so this is
like literary business just and a
butcher image and the only thing it
contains is node right and it's 540 mix
so I mean it's kind of a button contains
the entire linux distribution so
normally if i wanted to push this thing
to registry and i hadn't pushed any of
it before I would have to push like 550
MX and even if i push some of it the way
that register works is I would kind of
had to ask for all the layers and my
took a daughter thing if it had that and
again like going cross atlantic and it
always takes like a minute for me I
don't know what so what this was I ran
this command called torrent or create
the test image and what does does is it
takes that image
index it says like basically just runs
through the tub all figured out Oh what
files in this tub all put that in a
level baby I'm kind of assuming people
know what I labeled B is Jesus is that
level to be creates a torrent it
contains the tab all and they label to
be and save that here here right so this
thing here this test image the torrent
is a torrent file that references these
two files alright cool so why don't you
be able to do now is that you'll be able
to do torn Tucker feet testing this
torrent so now like my digital ocean
instant is sitting this torrent so if i
go locally i should be able to go in
here and 0 NE to this is the wrong file
I should first have to transfer this
torrent file to my machine oh oh
so I just need to copy paste this thing
just downloading the torrent file so
connectivity works that's cool so let's
get back to seeing this thing see
alright cool so locally I had my turn
fire so what I can do now is I can do
torrent darker food and then I can pass
in my torrent file and I name of a
container by one shut container that's
it so this gives me like a deep boxing
here so what it's actually happening now
is hopefully my local computer will
connect to the devotion instance it's
done that now plow to find each other
using the BitTorrent EST and it's trying
to put that door container it actually
took that turned and mounted it as a
file system on my machine so hopefully
like without laying a bit slow now like
hopefully in a bit it will have
downloaded the debate on index and stuff
yeah okay for it that's not good let's
try again
2222
so what it's trying to do is it's taking
the bittorrent its mounting mounting
that as a local file system and trying
to boot the Dark Continent set the
thought system by basically fetching any
file in the file system based on demand
using the turn over max's torn sorry tag
on it is that right so oh wait wait wait
wait no this is stupid okay I'm not
running puto daughter locally I'm just
going to put that up so I got on a Mac I
need to run a virtual machine to run
virtual machines inside daughter which
is why we love mac i guess it's so easy
to use let's see darker ok so this thing
is running out let's give it another try
whoa
yeah alright cool so now I shoot it's
happening down here right so like its
mounting the file system and its trying
to boot bash because that's the entry
point of my thing so basically this
fastest was trying to figure out what
what are all the dependencies a bash so
it's like there's like lip info in there
I don't know what that is or something
cool lift Hill stuff like this is all
being yeah like this is all being
fetched of a bit torn from like all the
piers in the world which is just one
night now because it's my digital ocean
instance or what makes this type on it
that's running on t-mobile so like we're
getting there apparently we're getting
back Chelsea that's probably like one of
the last ones your name right cool so we
just poured a 540 megabyte turned image
using bittorrent over like shitty
network right and like this thing is
totally usable I can do like LS here and
like it has to fish LS but of course I
haven't synced that right and you can
even like you can you can even run node
and it'll start it fits that so you can
see down here in the big I don't know if
you can see it but like it's trying to
fetch known all the dependencies which
is like lip standard C++ that's probably
cool inshare ripe and in a second it
will have that first so basically the
idea is that we just fetch what is
needed we don't need to fetch all these
five hundred forty megabytes and like
while we're running this thing like oven
the top corner is also seeding the image
right so if someone else tries to put my
machine we now have two peers if that
guy tries to run it we now have three
piers and like you know it's spreading
like crazy right which is really really
cool so we got note and we can run note
now so that's cool so like imagine going
back to the original example like a
female's dislike so we can basically do
like that cat that could be like it
let's do it alive right
and like you could run into torn darker
here so basically you can using this
kind of thing you could you could have
like a debt that contains like a
terabyte of data typing into a sucker
image that's like a gigabyte but it all
put in like seconds so I think that's
pretty cool anyways that lasted talker
stuff I'm just a sub sector here right
are you talking about replication right
right so I won't talk too much about it
but like just that so this is part of
our big replication scheme like we want
to view up the time we want to do stuff
like that we also in the process of
discussing how do we actually like how
do you distribute that right get is
pretty cool it is pretty cool mr.
brewing like you can everybody can have
a kid and you can push to each other and
that's kind of cool so we were just I'm
just going to pre flea talk about what
we're trying to do there and kind of
make the scenes of subscribe to do this
thing so like we wanted to be able to do
kind of like the same sort of things
like get up doing is doing with baby
Kiedis multimaster like you can have a
kid you can put stuff in my kid I can
put stuff in your kit and we can sync
and reverse resolve complex interest
works so like basically the idea behind
you these things is that like it
everybody has a database that database
has an append only lock does anybody
know what I've been penned only log is
all right again that's one of the things
that make you sound cool because like
when you know what it is it's like oh
it's so simple and if you don't know
what it is is regular on oh so like it's
basically just a log and apply a log I
mean just a list and you just a pimp to
it that's the append only part you just
never to be from it because it makes it
really really easy to redistribute right
so basically the idea is that if you
have something like a database every
time you do an operation on a database
like if it's a key value store every
time you delete something or insert
something you just append this to this
lock right so you kind of end up having
a lock like this that's like well first
I'm going to ensure the key is called a
copy called hello the valorous world
it's a put by the way then afterwards
someone it says like hi oakland right on
the key hi that's also good then if i
delete something i don't delete the
first entry here i insert a new entry
and i'd say like that's a dream so
basically if i read this entire lock and
i kind of like you know resolve every
entry from 12 to 23 i end up with
something like my my my key value store
contains like hi oakland right because i
deleted the other things so like this is
really easy it really easy to it to
replicate because if i have a lock like
that and you have a log like that and i
want i want to get your log like let's
say this other guy has like free
interest in this walk what we do is oh
is that we just go back you're like if
this guy has has 3 interested in the dog
and I don't have anything i just thought
by selling y'all guy can you give me
everything from zero because like that's
all i have i have 0 there guys Joe guys
like sure still I have like from cyril
at my head is free so like the tip from
0 to 3 is 1 2 3 so he sends me that
thing let's reread a simple they like
now i have free entries in my log there
was three entries so if i wanted to
replicate again I what till a guy can
you get me everything from number three
and he would send me like the tip of
that was a stag nothing because he has
free that's the head of history so
that's really the symbol so now i have
not now i have this all guys log and
have my own lock right so we might want
to have a situation where we want to get
every lock that have ever been
distributed does this is like really
really easy to do because what we do is
we just instead of just sending the head
of like my log of the gel guys look like
you're sending the head of DB once log i
just sent him the heads of every log i
have basically so if you have a
situation here where like this other guy
has two logs he has to be one flock yes
free entries from this guy and has to be
to slog he has two entries from that guy
if i wanted to replicate to him i would
just start by sending him all the heads
of my local ox which is nothing because
I don't have anything right now it
describes a like okay so nothing but if
from nothing to my thing is like TB 1 2
3 and d be chewed 122 right so he sends
me like those five entries so if i
wanted to replicate with this guy again
I would just send him the head of my
local arcs with us now like db1 that's
the head of that one is free and the
head of db2 is to write so I presented
that little information and he would
like calculate the tip locally and the
date of that locally is nothing because
he already has DB 13 mtv2 so this is a
really really simple like replication
mechanism for distributed replication
locks so if nutmeg was here he would
tell you that this is called scuttlebutt
because he wrote like most of this yet
I'm just going to steal his thunder and
take credit for it it is really really
cool because we resemble it has like one
yeah and the cool thing about it is that
we don't even need to be connected to
rebut in this network to can I get
everybody's lock because we just need to
kind of have a path between everybody
and then eventually its eventual
consistent we will get everybody's lock
so that's really really cool that's
kinda like you know kind of like same
situation with get where you don't push
to everybody if i push to Max and Max
Brooks pushes through someone else I
notice someone else would get my changes
eventually because like I pushed them to
maximize we carries my changes low on so
that's a really cool property it has
like one big big trade-off that might be
okay for your use case I think sub can
talk about that but like you might have
situation where we cannot make the
assumption that someone needs lock
arrive before someone else's life we
just know that eventually you will i
will have everybody's lock right so with
Max and serve something in this key
value store if max it serve something in
this key better store and key like a low
right so like if max says hello it's now
world and like I say well hello it's bad
because that's the Danish word for world
so that's the true one and like we
replicate it's really hard to make an
assumption here thats that's like one of
them is going to win because there's
really no ordering between these two
blocks so how would we solve that which
is like a big problem we would happen
and that because that is basically you
can kind of follow that almost down to a
distribution at least or in this kind of
sense so we need to pick someone that
wins and we need to pick someone the
winds consistently
me and we could just pick like max
because X is higher than T and diabetic
be that source higher but it's kind of
like a shitty way of picking one because
like mine is often used in better so
like how do you fix this and this
basically you fix this by doing
something called a merge right so I'm
just going to quickly show this thing
that I wrote on the plane ride over here
and I named it yesterday because I saw
subtext talk yesterday and at four like
hyper that sounds cool so I'm calling
this thing hyper log so it's basically
just the it's very very young and new
but like I think this is going to be the
might be the foundation of that going
forward the idea is basically that if I
go back to my log slide here that that
that entries analog can have references
to entries in another lock right so
basically db2 here might say do i'm
totally merging like DB 12 right because
then I know if I get this entry here out
of order I know that if I somehow
afterwards get this entry it's like
that's entering because like this
guy is merging it and also I know like
if this guy down here is if he is
referencing DB one free I actually don't
need to send him this head of TV the TV
one lock because I know if I send him
the value of db2 to it gets a reference
to yell a lot right so it kind of makes
the handshaking reading really simple so
I know this is advanced stuff it's like
it only makes sense to me because I've
spent a month taking into it so I'm
trying I'm trying not to sound very
smart and make example still count old
same old but anyways I'm just going
to try to do a quick them a lot of it
and then I'm gonna get off the stage oh
we still actually probably to stop
replicating this thing so actually a
really cool thing about this is that it
actually works even though you're
offline so if you I just shut off to
torrent but I can still boot it maybe
yeah i can so boot it because like it
everything said oh CLE so that's a real
cool
anyways so I can still run like most
efficient of node awesome right so
anyways the hypo lock thing if I demo so
if I make to folder sugar so like we had
free peers in this system I should
probably make this figure I can go in
here and i can call like I blog add a
message like hello world like that this
would be maxed at Susilo world right and
I should be able to print this thing out
so like it says oh there 41 minutes in
the log into the world it has this key
if i go into like another folder let's
assume that it is also it would be a
different machine i could run at like hi
blog at hello that if i print this thing
out oh it says like oh this is a
little bit now so what I could do is I
could pull the changes from the other
log into this lock so this that pulled
the changes using the algorithm I rather
every quickly describe that nobody is
understanding and if I print this thing
out now i will say that there are two
two values here but if we tell it like
print out the heads which heads means
that everything that said at the top of
the log it says oh there's two now
because these berries are kind of
conflicting so what i can do is i can
add a new one and this local demo i have
just implicitly merges these two values
into new value so i'm just gonna say
like add hello real bad Oh read real
there we go so if i print this out now
this thing will have free values and you
can see here this links and the link is
kind of like a merge because the merch
is a very high level concept i think i
think is a bit lower level doesn't
matter like this links to values now and
you cannot read this but like this one
of the
cell uses this one and yellow value is
this one so i know that if i read this
thing and this has like a merge of these
two things as you didn't know he's like
wanna soon in the bottom basically
that's kind of cool and like we had the
same property as we do and get where if
i go to the other peer again and do like
print this guy out i can pull in the
changes of this all appear and like it's
still resolved right we don't get a
conflict or anything like that and it
will always for solving a nice way so
yeah if that's that small is it so yeah
anyways so this is like the I think it's
going to be the foundation for death
going forward and it's kind of come to
pretty cool so yeah if you want to talk
about that or just want to talk about
bittorrent or anything hit me up
afterwards that's it thanks everybody</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>