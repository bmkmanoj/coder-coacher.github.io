<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfUS 2013] Blaine Bublitz: Sound Will Age You | Coder Coacher - Coaching Coders</title><meta content="[JSConfUS 2013] Blaine Bublitz: Sound Will Age You - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfUS 2013] Blaine Bublitz: Sound Will Age You</b></h2><h5 class="post__date">2013-09-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hAZWYtTP4Tw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so this isn't going to be like
generating sounds and cool stuff like
that you can find those on the internet
this is going to be kind of ramp tea I
hope I don't make the mics crackle so my
name is Blaine bublitz you can find me
on github at faded if you can't remember
that it's fat ed and I started a company
it's not last December this December
before with my business partner Louie
you might have saw us talk earlier it's
called ice dev we do javascript
consulting and html5 gaming we're always
looking for awesome fun projects so if
you have anything hit me up we also have
fantastic shirts to give away limited
edition and I want to give all of them
away so find me and and take a shirt we
have an open source game engine called
frozen j/s and we've been working on it
really hard for the last five months
we've put out four versions in that time
and we're really proud of it we want to
actually start like making games for
money but right now we're consulting go
use it submit issues tell us what's
wrong with it stuff like that we also
have awesome stickers that look like
that so get them too and I run
hackathons Ian Phoenix where I'm from
and we did an html5 game hackathon in
December Arduino in March and if you
want to have awesome time and you're in
Phoenix or close to Fenix you should
definitely come out because we have tons
of prizes and also always looking for
sponsors so gather round everybody well
I tell you a story of ancient times when
the proprietary once ruled the world and
made us do horrible things like embed an
object until one day the html5 warriors
vanquished them and delivered unto us
multimedia
most of you explored the sunnylands of
the audio and video tag but very few
ventured into things such as web audio
and codecs and mobile I decided to take
on this challenge so I dawn my
adventurers gear and before I even began
my quest the great wizard bulto Gnaeus
uttered these words to me sound will age
you I i told him that i was going to be
working on sound and he was right sounds
are important we can all agree that
sounds are important if you've ever
watched a movie or a TV show or play the
game with the sound off it's not the
same when I was little I was scared of
Chucky so I turned off the air I muted
it and it's just a stupid doll running
around with a knife in his hand it's
kind of funny actually and I didn't plug
in the speaker thing so we're going to
do this really loud I kind of wanted to
play a game sounds are iconic if you can
hear these and you know them shout out
what you think they are yeah sonic nice
if I can die and there's pack men out
there yeah mega man dying yes so we all
right but a lot of us recognize them
they they really they bring you back to
a moment they bring you back to memories
sounds are iconic and they they add a
lot sounds are also very hard ask
anybody that does sound not just in the
browser but sounds are hard I don't know
why we haven't made it but why we
haven't made it easier so my perspective
is from frozen j/s which we've been
working on so it's coming from a games
perspective a lot of this talk will be
influenced by that and hopefully you can
take it and apply it to web apps stuff
like that
but i just wanted to point out that it's
towards games i guess so let's take a
look at like I said Web Audio verse
html5 audio like how to implement kind
of the same things in each codex how to
deal with codex that's you'll see and
mobile and that's where the ranting
comes in so so the first implementation
of frozen it had a sound implementation
but it was just Web Audio so that was
like the best foot forward this that's
the technology that we want to use but
it didn't have any fall back sword
enough nothing happen if you didn't have
web audio so my partner Louie
implemented it at the first
implementation and he did something
really he did something right right he
started with Web Audio like this
technology that they've developed for
for us for four games and stuff it says
in spec he did something horribly
horribly horribly wrong he only
implemented Web Audio and expected that
the browser vendors actually cared
enough to get it out quickly so you can
see by this can i use thing that chrome
has had it for a long time and it just
got into Safari and iOS Safari which is
really cool and it looks like it's
coming in Firefox it's actually a
nightly on flag right now and who knows
about ie it might it might not I don't
know and there's bugs open for firefox
Android I I definitely encourage you to
go there plus 1 then at least show
people or show the browser vendors that
we are that we want them that we need
them or that we need these api's so if
we start with Web Audio what do we get
things like very high performance low
latency so like you can fire a
thousandth of a second right like just
crazy amounts of sound processing and
playing and all this stuff it actually
uses buffers instead of resource loading
so so the html5 audio tag goes through
a resource loading process and streams
the the data down and plays it but Web
Audio if we're just going to play a
sound it we grab the whole buffer in and
we know when when we have it and so so
start with web audio but fall back like
I said he did something horribly wrong
the browser vendors don't move as fast
as we would like and to make games and
apps we want to support browsers so do
fall back to html5 audio for browser
support I just wanted to show you some
of the things that you would want to do
in web web audio and then that you can
fall back on html5 audio it's things
like initializing like preparing right
it's getting their new audio context
it's actually prefixed right now in in
chrome and safari so it's WebKit audio
context hopefully they move away from
that and then html5 out of your just
moving up an audio object I like descent
syntax better than document create
element audio so use this one instead to
load us a resource for web audio like I
said we have to get this buffer ahead of
time and then after we have the buffer
we can decode it into our audio stream
or yeah and then we can use it so we
just make an AJAX request out we grab it
you just have to make sure that your
response type is array buffer if it's
not shit's going to get man and
and then when we get it back we just
pass it to the decode audio data and
we'll get a buffer and that'll that does
it a sink so you have to do your two
callbacks one per on error on success it
on air that's how you load an html5
audio tech set its source and it starts
downloading because preload is such a
true by default to play it you for Web
Audio you create a buffer source you got
to have some place to stick this buffer
now that you have it and then you just
connect it to a destination that's like
speakers and in in headphones your
browser your audio context keeps track
of that and then you just want to start
it you start it on a second so that's
how you play in web audio just a note
note on is the old API and I believe
that Safari only supports the old API
html5 audio is just calling play for
volume again it's a little more
complicated because like Web Audio has
this node system and use plug nodes
together so you're actually creating a
game which is like a volume thing
connecting your source to that so that
it knows about the volume and then you
take the volume node and connect that to
the destination instead of the source
directly because otherwise it's just the
default level and then you can just set
the game value and that changes the
volume an additional five audio just
volume so you're probably saying like
that's so complicated why is there so
much boilerplate for Web Audio it's
really because they implemented this the
API so that they can extend it later
like they really paid attention to that
the whole node thing so they can add any
note and just plug it in but so if it's
so complicated why do you want to do it
we get a ton of extras so yeah we can
fall back for those simple things but we
can't do things like we can't create
sounds in the html5 audio tag we don't
have transitions it's just like cut off
start another one and you can't do any
kind of processing or anything on the
fly so Web Audio is definitely the best
way to go and like I said future
features stuff like that so i guess the
goal is to turn this into that and i
think i have a link at the end to go go
to this it's pretty cool all right so
let's talk about codex this is a pain
point not not as big as the next one but
you can see all the not supported I hope
you can see all their not supported
there is a lot it is not fun at all if
you notice
ie does not support wave all right
moving on so something that you can use
that they expose this API as part of the
spec we can check if our browser can
play a codec it the function is called
can play type alright so yeah that's a
cool that's cool function name but I
don't know about you all you but I don't
like getting strings back from my
functions that say maybe or probably
like 0 to 1 come on we have floating
points so if it if the browser thinks it
may be can play it returns maybe if it
thinks that it probably can play like
what does that even mean I don't know
like why can so web M only has one Kodak
right now so why is that a maybe if it
doesn't have that codec it shouldn't be
able to play so I I don't like it but
it's in the spec so to get full browser
support because I e doesn't support wave
we need mp3 and everybody likes mp3's
mp3 so bored by chrome IE Safari some of
the Firefox is like weird edge things
like if it's a brand new firefox on a
platform that has mp3 codec installed
it'll go out to the operating system and
use it but it doesn't come with it so
that's a big pain so expect to use web M
log on firefox also chromium does not
have it so if you if any of you use
chromium you don't have mp3s and opera
doesn't and that'll be based off
chromium so it still won't and like I
said Chrome Safari they also support
this stuff but I e is the main thing so
you probably want to start with mp3 so
how do we decide which codec to pick and
use to to play our sound we can have an
array that has both of our sounds in it
with a different
tight a different type and a different
extension if we start with mp3 as the
first one and web them as a second one
we can just go we can just iterate over
them returning early of course when we
hit one that doesn't return empty string
we check if it can play type and then we
just assign it to the source and I have
comments at the bottom telling like what
browsers would have which extension and
all of my examples I just did a fiddle
and then I kept building on the fiddle
so like the links are at the bottom so
what if we try to do an mp3 when it
tells us maybe and it doesn't work it
just errors out like big error is
horrible but we can listen for the error
event and if we do that we can then
filter out our current ones since we
know it errored and we can try the next
one right so we filter it out and then
we just do our same iteration over and
get the next one that's available if
you're doing a bunch of like different
codecs because of file size or whatever
that this is very helpful because you
just keep trying
so I said we had maybe and I said we had
probably and now we're catching errors
but the errors happen after we try to
get something so we're doing a round
trip to the server which sucks so what
we probably want to do is try all the
probably's first then try all the maybes
so what we can do is we can go over our
whole array of sounds find all the
probably's put them at the beginning of
our of a new array find all the maybes
and shove them at the end anything that
gives us an empty string just ignore it
and then our set source kind of becomes
a little easier and we also don't need
to filter so you then you do set source
and you just shift off and you're trying
all the probably's then you try all the
maybes so that's really that's that's
good that's the least likely to make a
second round trip to the server which is
good turn it into a function call it
load it just needs up an audio object
injects the filename into our array and
gives us all of that boilerplate we just
wrote and then it returns the audio
object out so then we can just call play
and we know that we have one that that's
either working or completely didn't work
at all so in frozen we have some plugins
and when we use them to manage resources
I was really proud I had a lot of fun
with and I'm really proud of like the
load sound implementation plugin it
defaults to web audio sounds if you
don't have web audio it falls back to
html5 audio if you don't have HTML five
audio it falls back to an no opt version
like a just empty play and empty load
all this stuff so you can just write the
same code and if you call this extension
with a file name without and if you call
log in with a file name without an
extension it will auto complete the
extension so it
will do the maybes or the probably than
the maybes and get you the best sound
alright so don't codex what do you guys
expect play to do alright and load all
right me too so these are the specs and
I just copy and pasted them because it's
the spec you can see me do load supposed
to load media play is supposed to load
if it's not loaded and play it's
supposed to load we don't need no
stinkin spec here chrome works chrome
loads chrome plays Firefox plays loads I
even plays and loads Opera Safari how
about mobile safari no but chrome on
Android no there is hope though firefox
on android it plays and loads and
Firefox OS plays and look what what's
wrong with this you guys lost all of it
it was beautiful anyways there's
beautiful beautiful logos up there so I
OS is excuse on there like developer
documentation copied and pasted I don't
care if you read all that but read that
God yeah read this
so preload and autoplay are disabled
javascript play and load methods are
also in active until the user initiates
playback so in my java script that I
wrote on my web page that a user chose
to go to I cannot play or load a sound
without them touching the page and then
Android on the same bandwagon it's
intended was their response to a bug and
then 30 days later that bug was closed
so then somebody opened another issue
saying the exact same thing and there's
the source of that quote I in my other
slides where I point to the body I point
to the new bug it will cost data usage
remember that quote we will get back to
it meanwhile you can download terabytes
of images unrestricted try it and don't
even display the images download them in
the background okay so they're going to
stick us with this weird requirement
that's off spec in terrible so how do we
work around it we do a we bind to touch
start because we're on mobile because
mobile is the problem and we call load
be so we intercept this user interaction
and then we just remove it because we
only need to do it once per audio
element you can't do it on one and then
it works for all of them it's each
individual one all right so this is our
work around this is what they tell us to
do so all's good right we intercept user
input and this these sounds are loaded
but nothing is actually how it seems you
intercept user input and call load and
it loads them a second time that means
on Chrome on
android it already loaded them it they
are saving data usage by already loading
the files and telling you that they
don't load so we can do better because
we now know this because i thought that
i could write some code and it would
work the way i thought and then i
debugged it and it wasn't we can set the
volume to 0 we can play the sound so
that it doesn't load and then we can
pause the sound immediately that we can
turn the volume back up is it solved
it's actually a solved as we can get it
so they're still late there there's
still some latency because it pulls it
it feels like it pulls down some but not
all or something it's weird like this
doesn't give you a lot of information as
you can see it doesn't even show that is
loaded it likes shows pending and it
doesn't and even when you call load it
doesn't show load loaded so there's
weird and it's still latent so that's
the best we can do but at least we're
not loading things twice which is good
for the user right alright so we have a
new hope and that is disabled gesture
requirement for media playback yes do it
if you have chrome on on Chrome for
Android you can go and enable this and
do it please please please please please
it will make everybody's life easier and
hopefully because they have this this
this flag now I'm hoping that they
actually try to move that into
unflagging which is a good thing so I
can't go a whole talk without talking
about streams you know like there's this
node thing and like they say streams I'm
just kidding so audio stream so so audio
streams are like playing once out and
playing another son at the same time
right I'm getting really close to you
and so we want to layer these sounds
right we want to create a kind of a
sound scene of like person walking and a
clock ticking and a gun firing right we
want to layer all these things to make
it an immersive experience we need it
like that's how you make a good game on
mobile no you start playing a sound and
then you start playing another sound and
it cuts you off the first one and then
you play another one it cuts it off and
these are individual elements or like
separate elements it's not the same one
that you're playing again it's a totally
different one it just cuts it off it's
like we cannot create html5 games or
even like really good web apps that that
need sound for emerging without fixing
these fundamental things on mobile and
there's no reason for them to be there
firefox doesn't have them there is hope
again the return of the jedi mean Web
Audio it is in chrome again in chrome
beta 28 so install it and enable it
again flags are awesome Web Audio they
let you play as many streams as you want
the same time and it feels fantastic
some of the games that we wrote actually
are amazing now on mobile because you
can actually hear the sounds so we're
much better than before we need sound
like I said we need for immersion
feedback feedback like if you shoot a
gun you might not see a bullet fly out
but you'll hear it right and brand
recognition like those sounds at the
beginning the iconic sounds right say
stuff like that sounds are that's why we
need them so we start with Web Audio for
all the awesome reasons that I already
said we fall back to html5 audio because
it's there on pretty much everything and
it can get us kind of the way there
there are some for some trade-offs don't
fall back to flash we all know that
flash sucks where JavaScript errs
there's no support on mobile pretty much
right andand SF is a resource hog why do
you want the fans spinning up for a web
browser game for your user you don't if
at all possible so let's push Web Audio
instead don't do flash screw that don't
write libraries for that push Web Audio
go a comment on the issues and +1 them
and get get get them to get that in
there faster and enable it in Chrome
it's awesome they're still areas we need
to improve like I said about Android and
iOS enough we need to fix those can play
type like maybe it should be a floating
point 0 to 1 and we need some better
abstractions for like Web Audio and like
even creating sound stuff like that
there are some cool stuff out there such
as this awesome list I found howler
actually the right as those finish up
the talk it looks really nice and then
there's some that are not not fall back
libraries but actually let you do the
sum of the sound creation and stuff some
game engines with good sound
implementations I have to say frozen
because I did it sound Jess looks
excellent i actually found that one will
ball researching or making my slides
i'll probably be taking a lot of their
advice issues go participate go forth
and participate some tutorials and stuff
to eat you off the ground with web audio
the specs because everybody likes
reading specs yeah images and I'm blind
all my awesome links and that's where my
slide deck is at
thanks
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>