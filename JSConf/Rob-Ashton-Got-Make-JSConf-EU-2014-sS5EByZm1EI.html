<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rob Ashton: Got Make? | JSConf EU 2014 | Coder Coacher - Coaching Coders</title><meta content="Rob Ashton: Got Make? | JSConf EU 2014 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rob Ashton: Got Make? | JSConf EU 2014</b></h2><h5 class="post__date">2014-12-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/sS5EByZm1EI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hello that's what I love you coming
to hear about make that turned off thats
that's no good okay watch that so this
is going to be 101 talk to be quite
basic I'm going to go for the steps are
building up a decent make file to do
some stuff if you only know make and you
an expert then I apologize please do go
next door and sees me more interesting
so I'm Rob Ashton if you've tried follow
me on twitter from the page on the site
it's not spelled like that on there so
you now following some random agile
consultant in London I'm not him so
don't send abuse to him on Twitter
because he'll be very confused send
abuse here on Twitter and I know we're
talking about this is me these are
things i don't like quite a lot of
things and these are things i do like
just to give context for this talk but
is to say I don't like very much some
context I work in a team of dumb Erlang
developers they're all a bunch of beard
wearing Emacs users we have a lot of see
a lot of Erlang and therefore a lot of
bash and a lot of make our see an erlang
are largely polished diamonds and the
wrapped up in duct tape where that duct
tape is pretty much just bash and make
because of this it made sense to use
make for our JavaScript it may not make
sense for you I'm not evangelizing up
here although I kind of am because I
haven't yet seen a tidy nice grunt or
gob file so make I found this picture on
a make website I quite like it it's a
apparently it's a new org new or have
you say it I don't know looks like I've
drawn by three year old of drawn by 30
year old I really like it so make it as
old as the hills it really is old but I
mean solved all the problems and it has
solved all of the problems in weird
wacky ways which makes it super fun and
always kind of established that if
you're using cowboy languages like
JavaScript and Java is a cowboy language
you may as well use cowboy tuning around
that and keep things fun keep
living a little bit trying to build
professional and use like really shiny
build tools like grunt ogle and
arranging everything is at Heidi nice
streams and arguing about semicolons is
all about very fun but it's not as fun
as wading through obscure symbols and
traversing we're depends on graphs and
make I really enjoyed this and it's find
about entertaining so yes that's why I
make so I'm going to jump right into
what make is and do some demos because
that's more exciting and more
importantly what make is not so over
here in this directory I've got some
stuff I haven't got any cool music to
 to play you can hum if you want to
and whatever you can do a dance but to
use imagination for now so I've got a
recursive vars make file over here which
couldn't have anything in it I went that
make is not procedural so here I'm going
to make a variable and science and
whatever the value of two is I like
another variable and assign it to a
result of three years and a safe three
is equal to hello world and then down
here in the all target actually make
that even bigger so you all see it
that'll good at the back yeah we're good
ok cool I'm going to echo out the
whatever is in the value of three and if
I run this so over here we get hello
will print it out yeah which is quite
interesting if you are reading that top
down but one the bottom all these
variables are lazy there are bio data
point of actually using it's called
expansion variable expansion and these
are occur recursively actually I got
that wrong these are meant to be and
then oops okay whatever haha forget
everything I just said so if i go into
simplifies over here you also have these
ones and a semicolon in there instead
and these are actually evaluated at the
point of time which means in my all over
here if I echo out the value of one
oops I should not have worked and
everything wrong and Emma fail already
that's pretty exciting oh yeah oops
meant to do that yeah quite so anyway
because the semi court because of this
coal I'm over here these are evaluated
at the point of execution which means
the value of one at this point over here
will be nothing but and prints out this
is kind of important it makers all about
expanding expressions others expressions
might be simple variable assignments or
there might be function calls to go and
get lists of crap not really important
but we have is a very non procedural
language recursive variables are really
lazy and simply kind of variables are
not but simply expanded variables are
really a new make thing and they're not
in all flavors and make so whatever i'm
going to use recursive variables
absolutely everywhere in this tin these
demos so what is the structure of a make
file what does it look like well it
separated out into these things called
targets prerequisites and recipes and
transfuse a terminology and they use on
the site I tended to call a big pile of
make and get all of life but that's not
for everyone's tastes so over here I've
got a very simple setup in the a
directory where is simple copy ok we
have a make file and we have an in
directory in our in directory we have a
file called pinky text where pinkie pie
is the best pony and we have a file
called rainbow detect Reema dash is not
best pony this is a truism everyone
knows this if you don't know this you do
indeed you know I hope having a fee on
that please do and we have a make file
right I'm actually copy and paste from
down here rather than try and write
things because I think I'm in a demo
fail mood today this is preparation this
is right so we're gonna do over here is
I'm going to define a target my target
here is a directory called out with
pinky text in it and that's got a
dependency on in dot pink in such pinky
up text it's also got dependency on out
which is nice give copy and paste it now
the recipe is the contents found relief
this so here I've got in pinky text and
out pinky text and here we'll do the
same thing of rainbow and down here we
have a target called out which is
directory and we simply say please make
the directory called out over here we're
just echoing Devon all because all
doesn't do anything if i run this so i
got a simple copy and say hey please
make that will see here at copies over
my pinky and rainbow is the output
directory and if i run it again it
didn't do anything at all because makes
quite clever and when you have these
targets set up and depend set up it
looks at the files it looks the time
stamps it only does things where
timestamps are different when it
expected which is nice because if i go
into in that rate pinky text and say
pika pi is definitely the best pony
because i want to remove any ambiguity
and I don't make again it'll only copy
pinky dot txt this is like the best
thing about make which is if you set up
a decent dependency graph it will be
very clever about what it runs what
doesn't run which is all very nice and
shiny I believe that was the only point
one to make here really which is we can
do copying of gum so that's nice we have
a target we have a list of prerequisites
and the pre episodes execute from right
to left got that course we did excellent
so what we learned here is target's our
usual actual output physical output on
the disk the requisites can be either
files or other targets need executing
and recipes I'll just simply scripts
that executes to make targets appear
from those dependencies nothing too
exciting of course that make flowers
absolutely crap I can't sit there and
write a make file for every single file
in my input directory and every single
file I'm an output directory because
that would take me all day so we have
these things called pattern rules let's
go and do a demo of that show me now so
let's give it to my pattern directory so
here I have the exact same MacPhail I
decided I'm it I just made before that's
the wrong keyboard shortcut I'm normally
a linux user so i just closed that
terminal rather than actually doing
things in vim that was very clever of me
i'm gonna pretend it didn't happen and
go over here again I don't know my
keyboard shortcuts on Mac OS my fraid so
I make mistake all the time ok to carry
on so here we have a really crap make
file because we're actually copying
files independently and all the time we
can actually use pattern rules to do
this and say well actually if we have a
if we call a target where it's any
pattern rabbit matter matching out /
something dot txt then actually our
dependency will be in something dot txt
and down here we can actually take the
value which we've got from above which
will be a is it a single bracket of
course it is the incantations are
important I want a copy from here
RunKeeper shock it again I don't get
confused by no Mac OS that the control
key is in the wrong place I always get
me so isn't that exciting we can say
this is a magic automatic variable given
to us by make that says whatever the
target is please put it in dollar open
angle bracket and the other one dollar
at is whatever our first practice it was
we still have up here all out / pinky
and out rainbow a text but they will
actually both pattern match on this
target over here and they will both work
so if I go and run that so we'll be here
I say make that actually works it
expanded to pinky and rainbow and it
works just like it did before which is
super awesome and nice so we saw hear
something really nice which is we have
pattern rules where you have
substitutions with that lovely Patel
simple automatic variables are then
exposed to recipes from both the target
and the requisites and we have a nice
long list of magic incantations that
will get things out of that list you
start reading the magic incantations and
they start memorizing them clearly I've
forgotten because I'm on stage and
panicking but as like a dozen of these
and make sure make file really pretty to
read because no one has a clear what's
going on if they don't know make which
means when you in a coffee shop and
people look over your shoulders they
think of their clever which is awesome
so make has a bunch of built-in
functions which you can execute for
valuation I'm going to go into that now
demo wild cards very exciting so the
thing did it wrong with this make file
currently I don't really like is that
over here and having to do out / pinky
and out / rainbow as my actual targets
and how to do explicitly well as kind of
crap because I don't want to write out
all of my targets manually in my
makefile it's rubbish so instead what i
can do is i can call functions do that
over here as inputs i can generate this
pin put down here and say well actually
if i call this function wild card and
match on anything in the in directory
asterisk and text please put that in a
variable called inputs thank you very
much well that's not very useful because
of course i want to replace out flash
pinky and out / rainbow over here and
currently have in / pinky and in /
rainbow which completely useless so I
can call more very I can call another
function on my input over here oops oops
oops again there we go and I can say
actually could you do a pattern
substitute on in / whatever and replace
that whatever with out / whatever on all
those inputs and now I've got list of
outputs I can actually print out this
list it's going to hide this entire line
from now so i say i'm going to echo out
my outputs and for good measure and
economic inputs as well as a pin set
that's no good
did I mention I don't have a keyboard
shortcuts on Mac OS I'm hitting all the
wrong keys constantly it's actually
quite embarrassing so if i run this
makefile see what you'll see here that
my output list contain out / pinky and
outside rainbow an input list contained
in / pink in in / rain but we're just
super cool I've generated a list of
files and then I've replaced some
expression in those files or something
else and now I've got two lists of files
which are my inputs and my outputs and
what that means is I can feed these
outputs into my target over here as a
dependency and that will match against
this out / percentage iPod text I'll
execute this rule for everything in that
outputs collection these inputs over
here aren't actually used apart from to
build this outboard collection obviously
an example you might choose to do that
something to echo to definitely get in
here going it's like to do that I don't
like to print cut out so run this now
that actually executors and I copied
over my pinkies and my rainbows to my
output directory and we can see that
very easily expect cat out / pinky and
cat out / rainbow we see that Pinkie Pie
is still best pony and Rainbow Dash is
not best pony quite firm on that opinion
by the way so we learned here that we
can generate list of inputs using
wildcards against things on the file
structure and we can generate list of
outputs by then patent substituting on
that list which is really cool when
combining that with pattern rules and
this is basically what happens in the
every single make file you ever build
you go and you scan your folder
structure which is known for the
structure for all the files you wish to
input into various command line tools
and then you generate the output you
probably want to expect out of that and
the generated big power targets off that
and you run all your code and hopefully
you end up with a compiling application
which is super cool so this is why
Pinkie Pie is best pony by the way
because she plays all the instruments
awesome I don't put this together now
I'm going to build something that's
roughly equator ball to a real world
example it's not going to be a wearable
example because I don't want to sit
there and start playing with browserify
and mpm and react to Phi and everything
else I might choose to use in a java
application so I'm actually going to go
incredibly vanilla right now and this is
not going to represent how I
do things in the real world too much but
I didn't want to start throwing in all
sorts of crazy concepts so over here
I've got a simple widgets directory and
in my simple widget directory I have
rock it again nevermind i have a widgets
folder in that widgets folder we have
three widgets once called celeste year
want to call pinky once called rainbow
and each one of these has both a stylist
style sheet of some sort have some kind
of index file is the index coffee or
whatever and they've got some images too
so there's pictures of Celeste ears of
child and such as a grown-up and
whatever and they're just widgets and I
don't want to know what this widget or
action composed of but I have a
convention in my project that all
widgets have some kind of index entry
point and some kind of index for style
style sheets or whatever and what I want
to do is I want to copy all that cross
so this index pile will actually work so
over here I'm referencing widget CSS and
Widow Jas and these functions are
magically appeared that I can evoke over
here obviously in a real world that
probably is browser fire but actual can
pile things beforehand and pass them
through but whatever this is nice simple
example so I have two outputs here at
least which is widget CSS and witness
Jes but i also have images in these
widgets folders and then any copy across
somewhere as well again the real project
you might want to put them in an image
map but we're not going to do that today
because pretty crazy so here I've got a
make file which is quite invasive
current vicious thankfully I pairs all
down here before so I had copy and paste
everything again absolutely wonderful so
the first thing I always do we're making
a new make file is I think about what my
outputs are and I started them I work my
way up so it's quite clear that i have
two outputs over here and these outputs
are going to have to be loop it the
completely wrong got the wrong file open
there we go Wow
okay good so here i want to say i want
to make a British judge is and I want to
make a widget csss and clearly i'm going
to need some javascript files to
concatenate into this thing over here
and at least once it has files put into
that thing over there so how am I going
to get those well let's go to the top of
our file over here and let's go and get
some expansions so if I have some coffee
files in each widget will be here and a
wild card against widgets / whatever the
name of the widget is and then anything
there's coffee in that directory and I'm
going to generate a list of output Jess
piles from that by patent substituting
and placing all the coffees with jess's
obviously as you do I'm also going to do
the same of stylus files and I'm going
to say well actually I want to take all
the stylist files from that directory
over there we did / whatever / whatever
style and I say my output CSS files are
going to look like that with the style
replaced with CSS make sense so far of
course it does not moving complicated
here at all I hope not anyway okay cool
so I'm gonna focus on citizen and such
for now what I need to do is I need to
somehow convert all my JavaScript files
across the coffee at my copy files
across the JavaScript files before
concatenate in them so for that we need
to compile up well obviously that's
going to be the coffee ship can pile up
so if I gather up all of my note if I
gather up all of my coffee files over
here as dependency so we just / whatever
coffee and I have a target of widget /
whatever JavaScript it's quite clear all
i have to do is execute CoffeeScript
compiler against the target I want
generator which will work perfectly fine
it's also quite clear that if I want to
generate a pile of widget or CSS errs I
can do the same thing which is nice so
now i can make a big pot set files over
here taking the stylist pals and gang
some outputs which is super cool if i
want to execute these rules i'm going to
have to say well actually let's make two
placeholder rules over here
let's say we have style and we have
coffee this style and coffee by the way
go intrinsically hands in hand if you
haven't got coffee you're having our
style so here we go up with cs files
goes to requires site with your success
and output just files does nothing over
there so that's a wonderful and fine so
here well if i call coffee it's going to
look at the output jess files it's going
to match against this rule that every
single JS file and it's going to go and
look at all those coffee files is going
to execute coffeescript compile it
against any file hasn't been has been
changed in the region in recent times
which is nice so if i go over here and i
want to generate my code i can say over
here well if i want to do the code i
want to execute the conscript compiler
and I want to make the widgets Jess file
over here so over here we are oops oh
they are and confusing myself here the
copy and pasting I hope you're following
cuz I'm not okay cool so to make sites
sites fast widget ijs we take all the
J's output files and we cut them all
together in a really horrible way so i
hope it's hammy collins and those files
obviously there will be semicolons keep
using coverage crib thank heavens for
that if it wasn't semicolons have some
kind of hipster then this wouldn't work
friends don't let friends don't use
semicolons and I shouldn't make a clean
director over here just because it's
polite it's good to be polite to sleep
the images for now though cool unless a
mite all is going to depend on my code
and it's going to depend on my style as
you'd expect I'm going to echo this down
two down four slash nope again
cool so what we've done is we've
gathered up all the carbon script files
in all the widget folders we've
generated targets for them which are
JavaScript files in the same folder and
it made another target which is the
output jobs get a file which depends on
those things over there and we have a
nice pipeline of individual files to
individual files to one big file we're
just super cool and because I don't
trust any my copy and pasting I'm going
to copy and paste all this over here
there we go yeah let me turn out like
Carol I've coded all of this so I'm
going to copy all of my CSS across into
one file might ask you one file
everything wonderful and vine and run
this over here and we see here it ran my
car script compiler against all my
javascript files I did everything like
that everything's one fine if I wouldn't
make again it is nothing at all because
nothing needed to be done because
nothing's changed which is super cool I
need you make clean now and show you
something really awesome one of the
great things about make is once you have
all these targets set up and you're
doing things on a file by file basis
this is important it's very easy to
parallelized because it has built-in you
say make /j and it goes paralyzes all of
that and as everything really really
super quickly you get this for free so
basically if you build a sensible
composed makefile comprised of lots of
small targets and small files is very
granular you can bet get a very build
fast process out the gate bye-bye
parallelizing it for free which is super
nice by the way the site I've made is
really quite funky tobago look at that
there's my HTTP server if I go to Safari
or Chrome or whatever goes into on the
machine Pinkie Pie Rainbow Dash and
Celeste year if I click on these guys
they change or whatever and these my
widgets they're very awesome widgets
they have ponies you click on them they
do things which is super cool it's most
exciting thing I've written all day okay
cool
so we'll see here that we have a widget
or CSS and a widget ojs and the image
directory of everything copied across
which is super cool because I've made a
make file does that for me in a nice
granular way now the thing is this is
kind of cool you have a make file which
seeps out open composed very well we
have some placeholder parts lying on the
place du timestamps and we have
automatic parallelism providing on a
sensible operating system clearly if
you're on Windows on this works but I
don't really care about that that said
this make files not perfect obviously in
a real world at pappadeaux's browserify
against those compiled JavaScript files
we'd probably have we probably we
execute make on a per widget basis so
you could do more explicit pattern
matching on things like the penalty for
dallas files and we probably have a
widgets full they would probably pattern
match on the node modules folder and in
fact that's what i do my work place in
all of our widgets I just knowed modules
that contain all the JavaScript all of
the CSS and all the images we pattern
match against a node modules directory
we pull this things out and we can build
image maps we can have put the CSS and
output jess and everything and paralyzed
and it really is super fast because only
things that change get copied across
which is awesome quite a lot of
stream-based pipelines kind of forgo
that because you went gathering all the
files together and put them for a stream
and it gets quite complicated hard to
understand makes quite complicated but
also incredibly simple so reuse I've
spent all this time making an amazing
make file ok this in this case it wasn't
an amazingly quick file it was quite
simple but my work one is probably 500
lines of make and I want to reuse that
across all my projects because all of my
projects have a fairly similar structure
how do I go about doing that well let's
go and look at that shall we what I've
done is on to github I've actually
pushed this repo and as an assets folder
over here where I've got a common look
nothing's changed in this make file from
one I just showed you except for over
here we have additional assignment of
widget der to widgets so if widget do
has been specified by the caller of this
make file will actually not sign this
variable so in my current project I want
to call widgets gadgets or baubles or
something I don't know and your thing
over here is I set the default goals
when I invoke this I will always
call all unless I specified a girl
myself what I can then do is inside my
inside a make file on actual project
that's empty because I meant to be empty
of course there we go clever we can
export some curation for that so we can
say export widget dough equals baubles
so by exporting it is available to other
make files that we invoked in this point
and I'm gonna set a target I've
commandant Merck and say well actually
if we haven't got a comment down go and
get it from guitar by double getting it
thank you very much and everything
include common don't look and now all
works and this is actually what all of
our make files look it look like a work
we basically have a boost wrapping make
file with downloads our latest version
that by make and goes and gets it and
I've a run list right now it'll
hopefully if on the Wi-Fi there you go
download the make file into comment
Merck and execute against baubles
directory and gave me a site which was
very sensible so there we go there's
bubbles Jess bubbles or CSS and index
HTML I'm not gonna bother doing them of
that because it's exactly the same as
before it's just ponies I say just
ponies and by Thunder ponies so such a
thing as just ponies that have awesome
so we learn here for bootstrapping our
make files do we get is our friend or
curl whatever you like we can export
variables to make files super cool you
can set default goals which is kind of
useful because otherwise nothing will
happen and if you have a set of
conventions across your projects you can
reuse make files across all your things
and get much joy and happiness from your
life especially as your make files look
very pretty so here's a bit of friendly
warning of something not to do this is
what I see quite a lot with make files I
see this alarm github which really sucks
what we do is we use make as it has
grown oh so we have some targets they're
called bill Jess and build CSS and they
simply invoke some command line against
entire directory of JavaScript and
execute all that stuff some kind
templating thing or whatever and then we
have to have phony directives down there
to say well actually those aren't real
output please execute these things every
single time and basically make is being
used as a task runner and I see this a
lot not some node projects by an erlang
projects as well like one of the most
common make files for Erlang is
basically a glorified bash script with
and make which is really quite atrocious
because it's really slow because it's
not doing any conditional compilation
that's not going is that beam file out
of date it's just compiling every single
beam file which is completely useless so
is it important note build systems are
not task runners and vice versa not true
one of the mistakes I see I think one of
the problems I see all the time is that
grunt and gulp are being used as like a
combination of both these things and
that's why they get some hairy and
confusing most the time if you just want
a task runner well that's where mpm
scripts as for just took a bunch of
bunch of bash scripts in there and Bob's
your uncle or in my workplace it's a
bunch of bash scripts calling a bunch of
bash scripts because we're a bunch of
cowboys and that's what we like doing
but whatever its bashing bashing bash
for doing task running and make for
doing gold compilation these two things
go together very well choose your tools
wisely and that's it and I am running
out of time I was right about having to
brush myself a little bit so if you want
to come and tell me how awful this was
do so outside over a coffee or a beer
remember do not send abuse to rub Aston
on Twitter send to rub Ashton two very
different people he will not appreciate
that thank you very much that was make
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>