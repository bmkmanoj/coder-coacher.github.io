<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Anand Vemuri: What Your Scanner Doesn’t Tell You CAN Hurt You | JSConf EU 2015 | Coder Coacher - Coaching Coders</title><meta content="Anand Vemuri: What Your Scanner Doesn’t Tell You CAN Hurt You | JSConf EU 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Anand Vemuri: What Your Scanner Doesn’t Tell You CAN Hurt You | JSConf EU 2015</b></h2><h5 class="post__date">2015-10-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GPce5lNUhtc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Hello, hello. Ok. Just one second,
so hello everyone, my name is Anand Vemuri,
I am going to be talking about security today.
Before I begin I was like to pre-vast by saying
that I'm extremely humbled to be here JSConf EU,
is arguably the conference I used to work
a couple of years back, it inspired me to
take JavaScript seriously for me to be on
this side of the stage is a really big honour.
So who am I, my Twitter handle is brow hat
57, a software developer who later went to
the dark side and is now doing testing and
security, I work for nVisium in the DC Metro
area, I'm very passionate about Taco Bell
if you are, please talk to me, we can talk
about Taco Bell. I do play the flute, if this
whole developer thing doesn't work, that's
my back up. I'm a wannabe, I'm by no means
an expert in this language, I do what I can,
I come to these conferences and I see these
incredible talks, I'm so inspired to learn
more and more.
Just a quick show of hands here, how many
of you guys write code for a living - just
raise your hand - wow, this is awesome, great,
it's not surprising, as we're at a JavaScript
convention. As software developers that's
pretty awesome.
So another quick, quick show of hands, real
quick, how many of you guys work on the dark
side of things in security, whether it ethical
hacking, or for your own fun? So... ok...
good a couple of you. So, as somebody who
was a software developer who later became
an application security consultant, I faced
a little bit of a problem, this problem was
that as a software developer you can, the
word 'Software developer', basically tells
you what the person does, they develop software,
it's almost a no-brainer, there is really
no good word for what I too, in terms of what
my job description is, what do you call somebody
who does security, like a security guy...
or... I don't know, maybe a consultant. The
best thing I could think of is penetration
tester, that really doesn't define what I
do really well. I feel like, because
people don't necessarily understand what it
is I do, I've been called a couple of things
in my career, among all of them I've been
called a scan tester, scanner, security scanner
tester, vulnerability scan tester, even sometimes
in jest a scan Monkey, it's a little bit alarming,
it's a common motif here where people think,
people have this notion of security in that
you run a bunch of antivirus scans, or a bunch
of scans in your application, you point click,
you run your application through and you create
a PDF and ship it off to developers to make
their lives miserable. This couldn't be further
from the truth. If you actually look at what
the English dictionary says about scanners,
for starters it uses the word 'Scan' in the
definition so it's not very helpful! {Laughter}
It defines a scanner as a person or thing
that scans. What is very interesting about
this, I'm going to refer to scanners in my
talk, I'm not just talking about automated
pieces of code, I'm also talking about people
that just scan, by scan I mean to glance at
or read over hastily, therefore, by, by missing
out on a lot of things, if you are just running
some kind of automated scanner or just glancing
over something very quickly, there is a very
good chance that you are going to miss something,
something very critical. So we're talking
about application security, what we typically
too is rather than look at an application
and try, trying to just quickly pump out a
PDF, we look at an application's architecture
and after every point we try to systematically
break the application, if it's a database,
ok can we inject some sort of query in to
the database to get some kind of code execution,
or trick the app into clicking a button that
will submit a state-changing request, or can
I, you know, use some insecure direct object
reference to escalate my privileges, these
are the kind of questions that run through
my mind when I use the internet, which is
sometimes a curse in disguise, especially
when my credit card is going online, it's
not pleasant to think about it. As someone
doing a lot of JavaScript recently, a lot
of my attacks for research are focused on
the browser and the client side aspect of
things, I'm looking into client side attacks,
especially with the newer frameworks, as we
see them all throughout the past so many years,
when we talk about 'Client side security',
the major vulnerability that comes to mind
is cross-site scripting, it's one of the most
common vulnerabilities that we see all throughout,
ever since the inception of the internet we've
seen vulnerable code and the problem is, cross-site
scripting attacks users like me, you or, like
admins to an application that have some kind
of privileged data, cross-site describing
is very dangerous in that respect, it's kind
of, you can think of it as a JavaScript injection
attack on the client side, the exploits, as
we will see later on, can get very, very bad,
by that I mean really, really scary.
So what exactly is cross-site scripting? Well,
it starts off with the very, very evil guy,
right and so this evil guy wants to do some
really evil things, so he's going to send
a hidden URL, or a URL to a victim which contains
some hidden script somewhere, you guys work
with JavaScript, I don't have to tell you,
a lot of times these scripts run on your browser
and they are very transparent, you might not
even know you are being attacked. The URL
contains a hidden script, the victim opens
the page, when you follow the URL, you know,
the browser renders the JavaScript and then
the exploit happens, whatever, whatever the
attacker told the browser to do, it's typically
executes that and bad things happen.
So this is what we typically think of when
we think of cross-site scripting, but it's
a very, very deep vulnerability, because,
you know, it's a lot more than just this,
I've actually met someone who conducted his
full PhD thesis in just this one vulnerability,
that means it's extremely deep and complicated
to talk about, cross-site scripting comes
in many different flavours, this is what you
would talk about, when talking about reflective,
also stored, where you would inject some malicious
script tag as a comment, every time that's
accessed the pay load persists and basically,
any way, it's just a lot more dangerous, anybody
that accesses that page is now going to be
vulnerable.
Then we have DOM based cross-site scripting,
also very scary, manipulating HTML in the
DOM to get a cross site scripting, I think
DOM-based cross-site scripting is quite interesting,
it only requires a few lines of JavaScript
and HTML, the code snippet I have on a slide
it's maybe a couple of lines of HTML and JavaScript,
very basic, but totally vulnerable to cross-site
scripting, so within just a very simple HTML
page that's basically static we have, we already
have a vulnerability.
So, my, my story kind of begins earlier on
this year as we were doing a client assessment.
The client that we were testing used an application
that had backbone JS on the front end and
it was like a Java back end. You know, they
told us that, you know, they were very confident
with the application, they said, &quot;We built
this with security in mind, we parameterised
our query so you don't have to worry about
SQL injection, we have done the mitigations
you won't get any attacks&quot;,. Talking on and
on about all the typical things you would
want to defend against. So we said what did
you too for cross-site scripting? They responded
with like, &quot;Oh, you mean that pop-up thing,
we tested for that, we're good.&quot; So this sort
of caught me by surprise for a couple of reasons,
the first being that, you know, cross-site
scripting is way more than, &quot;Just a pop-up
thing&quot;, admittedly when we are testing for
cross-site slipped, we use a canonical alert
pop-up to quickly see if it fires, if it does
then it's vulnerable, if it, you know, it's
totally a lot more than that and when they
say that we, &quot;We tested for that, we're good&quot;,
I was really curious what they meant, they
said, &quot;We have a third party vendor, they
ran their scans, we ran our scans, we talked
to developers that knew about security, so
we're good&quot;, we're like, right on! {Laughter}
.
We decide to run our own scans and just see
what happens, so we run the application through
Scan JS which admittedly now deprecated, didn't
find anything, so cool, JS prime, another
static JavaScript analyser, these are the
only real two JavaScript analyser that's I
can think of that are willing to give reliable
results some of the time. So JS prime didn't
really find anything either, it found non-active
sources and non-active syncs, so let's test.
So, obviously I can't show a client code,
so I'm going to use a, a sample application
called wine cellar, which is basically this
is a sample application built in the same
stack with the same exact vulnerabilities,
the Github slide is in my link and you can
download that.
So we have the application here backbone,
everything looks cool, let's play around with
it. So let us do the first evil thing and
let's try that pop-up thing and let's see
if that works. So I'm just going to put a
quick script alert, one script. Oh my gosh!
I thought they tested for that pop-up thing,
like, this is totally not ok! {Applause}.
So, at this point we have demonstrated that
this application is totally not pardoned against
cross-site scripting, we want to go further
than that, we want to show to the developers
that cross-site scripting is actually a problem,
so what do we do, there is a tool, the browser
exploitation framework or BeEF, it's a tool
that we can use to basically assess the security,
exploit our cross-site scripting vulnerability,
so how does it work? Well, here we go. I have
a virtual instance of kali Linux, which is
running the beef server virtually, I'm going
to quickly see why this thing isn't running.
What Beef will do it creates a beef hook which
allows us to hook our browser, when we hook
are browser, we essentially, if we can inject
this into our victim's page we gain control
to their browser and start doing really cool
things. Let's go ahead and take this script.
Go back here and we'll do script sources is
equal to that... we'll just save this guy
in, it looks like it went through. Now we
can access our application on our beef panel
and there we go. We see our application is
online and now we are remotely attacking our
victim and we have a lot of information about
their browser as it is, we see what kind of
browser, a browser... a hooked page et cetera....
Probably the most powerful aspect of this
is that we have a bunch of exploits we can
kick off, we have when you talk about JavaScript
injection your exploits is limited to your
imagination, you can kick off whatever exploits
you want, that the JavaScript language can
handle and so as people at a JavaScript conference
it doesn't go with much surprise we can execute
a lot of really crazy things. If you take
a look at some of these exploits we can get
cookie values for our victims and for example,
if we're running an application where we're
attacking an admin we can get access to their
session and attack them. We're at JSConf I’m
going to try something a little bit more bold
and daring I am going to try to break into
my webcam.
So the first thing to do this in order to
do this is to run a quick permission check.
So I just kick that off, now I am going to
write a quick social engineering message like,
hey, allow this for lots of money. This is
not a scam. {laughter} do it. Hopefully if
the demo gods are happy with me today... there
we go. So we have now just asked for access
to my webcam. So I know everybody in this
room is totally not going to click allow because
of course you wouldn't but if I sent it out
to thousands of people there's a chance that
somebody would properly press yes so on behalf
of that guy, let's take a cross-site scripting
selfie. {laughter}
pictures I hope these come out I don't know
how my hair looks right now {laughter} I am
just going to run a quick, well let's see
how BeEF handled that. It's going back, we
get the base encoded hex dot of the images
that we have done, I am going to dump this
into a text file ever so
elegantly and just run a quick processing
script. All of you front-end developers out
there please do not judge my CSS. Hopefully
if this works,... there we go. {laughter}
{applause}
So, we have just taken cross-site scripting
and exploited our webcam. Albeit we have asked
for permission, but that's a social engineering
component that was involved. So, what is special
about this? I mean scanners in these kind
of security vulnerabilities have been round
for quite sometime, but what is concerning
is the fact there are so many frameworks out
there that are just coming out and each of
them has their own different type of vunerability
that's, or different types of security configuration
that create a different type of attack surface.
It doesn't go to show, it goes to show that
there's a lot that can go wrong by using your
own framework. There's so many different frameworks
out there there's a lot you have to know about.
So let's take a look at Angular real quick,
those of you who have used it you might have
used this NG bind attribute. This attribute
is what people use to typically bind data
to a model and before Angular 1.2 there was
this directive called NG bind HTML unsafe
which as the name of the directive says it
unsafely binds HTML to model. They decided
to get rid of it now they have a problem,
you have a lot of legacy code that's using
unsafe directives that is now broken because
they have got rid of the model. If you go
to stack overflow in Google for this directive,
literally the third result is somebody talking
about this problem the response you get is
just use this sanitisation service just trust
everything has HTML, that's what you do. So
here's what happens when you trust everything
as HTML. So I have an Angular app, you see
a two-way data binding every angular tutorial
has something about that if you put bold tags
it totally works. Script tags won't work because
it won't allow for dynamic script injection
but if I try an image tag I set the source
to blah on error I say execute this script,
before {laughter} before I can even finish
my sentence {applause} because of two-way
data binding before I can finish my sentence
it executes. Every time after that if I key
stroke it executes again. Which is kind of
a problem. This stems from a fundamental lack
of understanding in the way that the framework
works.
So the strict contextual escaping service
is used to properly white list things when
you trust everything as HTML here's what you
get, and moving on to something like Meteor,
is full stack JavaScript is not just a client
side vulnerability, a client side framework.
Sorry {laughter} Meteor was built with security
in mind by default it HTML escapes everything.
This a great deal, nothing can totally go
wrong here, this awesome. Until you actually
see somebody actually mess it up and they
dynamically allow for anchor together as be
defined and so what this results in is basically
if you were to name your list some kind of
JavaScript command it would actually fire.
Different vectors and configuration you see
inside it itself. Nothing that a scanner will
necessarily pick up on but something that
is definitely going to go wrong in your application
if you don't look at it properly.
So I would be doing a huge disservice to this
community by just saying that we're all kind
of screwed and we should give up, what can
we do
to prevent against these kind of attacks.
Contextual escaping skill a thing, and in
fact the same vulnerabilities can be mitigated
by the same techniques in different ways.
So if you look at the previous backbone example
all I have done in this case is basically
escape the values as they are getting set,
and so if this code is applied, then rather
than actually rendering the script tag as
JavaScript the browser will look at these
tags and basically just say that oh it's like
HTML escaped it will render the actual HTML
escaped version of that tag which is much
safer. Contextual output escaping means wherever
the I put is going to you escape it to that
context so if it's going to JavaScript, a
JavaScript escape if it's going to CSS you
CSS the escape et cetera. Real quickly the
next topic is content security policy. It's
like a secondary defence, it's a way for you
to specify to your browser or to your application
which browser, which scripts you want your
browser to load. So obviously you don't want
like untrusted evil scripts to load you just
define this policy which will block these
scripts. Content security policy it's a talk
on it's own so we're just going to talk about
it at a very high level but you can still
bypass this by setting a very lax policy but
it's a good way to kind of prevent a lot of
unnecessary scripts from coming in.
Finally, we have server side input validation
more like a tertiary measure if you are expecting
a phone number your request comes in with
a script tag, that's not good you don't want
that so you should throw that away. That should
happen at the server side so it can been bypassed
by intercepting proxy. So coming full circle
here we have seen that scanners don't work
especially when we're talking about new frameworks
and new techniques. New frameworks create
new attack vectors, but we have the fact that
the same overarching defence of strategies
can still be used to mitigate the old, the
new issues that arise.
So with that I would just like to introduce,
we have developed a full JavaScript vulnerable
application here thank you to Ken Toller who
is a colleague of mine who worked on this
project, you guys can check out the Github
right here, it's something that you can use
to practice hacking on. It's vulnerable to
a lot of things not just cross-site scripting
so you can Tweet about it, you can submit
issues for things you would like to see but
it's a really cool project. I like to thank
my mentor who basically have taught me everything
I know about security, Jack, Tim and Michael,
and as far as further training is concerned
here are a bunch of links, you guys can use
to learn more about cross-site scripting,
a fun fact is that the Google cross-site scripting
game which we have here was actually developed
by our next speaker, Artur Jank. He will be
giving an incredible talk about some more
cross-site scripting you find in Angular,
I hope you guys will stick round for that.
Thank you very much. If you have any questions,
feel free to hit me up on Twitter, or contact
me while I am here. Thank you.</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>