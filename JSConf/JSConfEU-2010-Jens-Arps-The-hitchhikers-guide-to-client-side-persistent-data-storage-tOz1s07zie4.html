<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2010] Jens Arps: The hitchhiker's guide to client side persistent data storage | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2010] Jens Arps: The hitchhiker's guide to client side persistent data storage - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2010] Jens Arps: The hitchhiker's guide to client side persistent data storage</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tOz1s07zie4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so good morning guys
you with me perfect so I'm yen's and I'm
going to talk to you about storage so
this is going to be the hitchhiker's
guide to all things storage we don't
have too much time when I'm trying to
pack it all into this remaining 25
minutes yeah I do work for the company
oxy boo very awesome company and we open
the mobile web yes we do so back to
topic client site persistent storage
which is a kind of a long awful term but
in case that you do not know what that
means this is about storing data in
sight of the browser in opposition to
the traditional approaches where we send
data to the server and storage on the
server side we do store it on the client
side beat in a browser a device in air
application and I will give you a
walkthrough through the current existing
storage engines thanks a bunch we were
beginning in the past and move on to the
future I'll talk to you about existing
frameworks that ate you and assist you
and storing tasks we'll have a look at
mobile oddities and we also if time
allows we'll have a short glance on
performance and security and of course
they'll be ie Beijing but there will be
acknowledgment of Microsoft's work in
this field so why do we need client-side
persistent storage we need it for
several things on the one hand we needed
for web apps that have a flying support
also known as work now soon later and
we're online most of the time so
but being offline capable becomes more
and more important we need a perhaps to
just need persistence just for stuff
like user preferences application
settings and we needed as some
controllable alternative to cache
manifest on cache manifest is great it's
html5 or the bus and everything but it's
not a storage engine we cannot control
it cannot get data from it and of course
we need it for all things mobile if
you're tethering on a train you would
want to pull the data over the wire over
and over again if you do have the
alternative to store it at the client
site okay let's start with a walkthrough
as I said we will be beginning in the
dark past and moving towards the bright
future and we have a more detailed look
at two of the engines presented here
which are currently the best available
engines okay it all started with cookies
which are obviously the worst choice to
store Adam they have the lowest size
limits of all storage engines they are
sent to the server on every request also
known as how to slow down your ex
application they have basically no api
you need to write your own wrapper
functions or you rely on the framework
that that's the work for you so I guess
you know everything about cookie so
let's quickly move on to Microsoft
achievement user data behavior Microsoft
was the first to offer an alternative
for persistent storage client site and
it's been there since IE 5.5 and it
still is there in current IES it's a
nice key value store but it has some
issues with size because the available
storage size depends on the zone let the
current website is associated to and
that differs from 512k down to 64 k so
64 KS what you can our reliable work
with it's a special behavior that can be
applied to HTML elements and what's
important and what's not envy msdn
article can be also apply to you a link
element in a style element which can
reside and they had and therefore our
independent of dom state next up is the
global storage which was an early
implementation of the early storage
draft which was then to become local
storage was implemented by mozilla in
firefox to choice in 2006 i guess it's
still there in firefox and as far as i
know it's going to stay inside a firefox
but well yes it's firefox only so that's
the big drawback but that was the first
real key value store inside of a browser
with a nice API having get input methods
next one is SQLite implementations um
well it's a database it has kind of
broad support as it's there in
webkit-based browsers and an opera 10 so
there are some routers supporting SQLite
and as compared to the other storage
engine a good size I get more into
detail later o con CS it's a it's no key
value store it's a database most
scenarios where we need client sites
storage we do not need a database but we
need a key value store and another thing
is that there is no specification on how
the SQLite implementation should be
implemented in the browser
um yeah it's get some details here rule
of thumb sqlite reads pretty fast and
writes annoyingly slow especially on
large amounts of data writing a check of
one megabyte can take up two seconds and
on a mobile device can take half a
minute and another annoying thing is
that Chrome has a limit on the single
field size no matter if you choose
binary large object as a column type it
still has a limit other browsers do not
have that well as I mentioned before
there's no real specification I guess um
well most of them if not all of the
implementations are just third-party
sqlite implementations just baked into
the browser remember if you're using
SQLite remember to use variable binding
those question marks inside a few
queries they also work inside of the
browser a very annoying thing about
SQLite implementations across all
browsers is that they have the habit of
sometimes failing silently not storing
your data but not throwing an error not
calling your arrow callbacks so this
makes SQLite pretty unreliable and in my
tests that happened over and over again
but um and check your worker support
this is there in chrome dev channel and
I bet it's not there and in 5 4 4 I
guess what I'm not sure but this will
come and doing this work apart from the
UI thread is definitely a good idea some
are notes on size limits that differs
from browser to browser but you can be
assured that you've got five megabytes
of data which
um a big deal for for most scenarios and
Don's a fairy and an opera you have up
to unlimited storage um but that depends
on user choice user may reject your
request for more storage and well then
you don't have the amount but basically
technically it could be armed unlimited
on Safari and opera I'm chrome you get
you could get unlimited storage in for
the Chrome Web Apps there is a manifest
and you can request unlimited storage
there I don't know if this has landed
yet but it will I guess very soon opera
is pretty cool at your opera shows if
you need more than four megabytes of
data it shows a pop-up box to the user
with a drop down and really has to
divert unlimited in there so unlimited
is uh well pretty cool okay next up is
local storage first I'm a bit be asked
here because I personally think that
local storage is by far the best storage
engine currently available it's there in
all current major browsers even in ie8
so if you're building a modern web app
local storage is there for you it has
the perfect API because it's a plane key
value store let's get set item get item
methods clear and delete item basically
that's all oh there are some more
properties but if it's a simple API and
very cool to code with it um local
storage is still in draft status but
it's implemented across the browsers
with the exact same API so chances are
this is not going to change so the code
you write for local storage will be
usable in the future for a very very
long time and again also with local
storage
if you use it check for worker support
also in chrome dev channel there's
workers support for local storage and
I'm pretty sure it will get into other
browsers as well so that you can do your
storage tasks outside of the main UI
thread and keep things flowing no points
absolutely yeah okay maybe one thing
sighs again is an issue okay I gotta
stop here remote isn't working sighs is
kind of complicated but still I got some
numbers for you the spec recommends the
size of 5 megabytes but unfortunately
Safari has a limit of two megabytes
which is again if you're storing
application settings or JSON object may
be enough but what would have been nice
if Safari had also five megabytes as the
specification recommended there is no
field size limit and local storage you
can store all the two megabytes or five
megabytes in one field there's these two
hundred megabytes in Firefox is for
offline apps Fairfax determines offline
apps by the protocol if your application
is from from file or from localhost then
you get 200 megabytes of data but you
should be careful writing 200 megabytes
of data this can get real slow an opera
we have the same dialogue as we have it
with sqlite databases if you attempt to
store more than four megabytes the user
gets a pop-up dialog shown with a
drop-down box in it and again the user
may select unlimited so well opera is
pretty cool in there you can have
unlimited storage on the user but
you know better be careful no user
really wants that you store I don't know
one gigabytes of data on his file system
again in Chrome Web Apps you might get
unlimited space too if you request it in
the manifest I'll another very cool
thing about local storage is the storage
event which is basically a great idea
the right operations are not gonna have
to be synchronous they can be done a
synchronous and whenever a change of the
storage object happens a starchy event
should be fired well and on the left
these are the top rows are the keys they
should be in the event and there's some
other stuff noted in this table don't
want to go into detail here but some
some notes on it first opera is the only
browser that is really compliant to the
spec again opera big big pro this is
really really cool what they have been
doing it local storage has been there I
guess from opera 10 so it's relatively
fresh but it's perfectly implemented
another thing is cross window messaging
the storage event is supposed to fire on
every window that has the same storage
object which means basically the same
domain or in a concrete scenario the
same URL oh but Safari and chrome have a
very odd behavior them because they fire
the storage event in all other windows
so if you have four or five windows open
and inside of one window you modify the
storage then event gets fired in all
other windows but not in that window
that initially triggered the change of
the storage object which means that in
one window environments
which happens most of the case and which
is the case on mobile devices you get no
storage event because there's no other
window open that can catch the event you
need to to work around and another
oddity is with ie8 because they don't
have the event called storage as it's
recommended in the specification but
they have two events on storage and on
storage commit I mean why follow
standards on storage commit is fired
when the local storage data is written
to the disk which is so low level that
nobody really cares about and in
opposition to the documentation on msdn
the on storage event is not fired on the
window object but it's fire on the
document object took me a while to
figure that out why I wouldn't get any
results from ie there yeah let's lock
the storage best storage engine
currently available let's have a look
into the future there is indexed DB a
new draft containing the object store
which has the great point that it can
store objects all other storage engines
I've been mentioning can only store
strings so then you'd have to Jason
stringify you're at Adam before you can
store it and the object store will allow
you to store j/s objects directly it
will be both a key value engine and a
real database because you will have a
synchronous API with gad input methods
and so you can use it as a key value
store but it will also have a database
like access that you can query the store
you can
create ranges and you can iterate
through result sets and move the cursor
so it tries to combine best of both
worlds and it's very very promising a
next EP is probably our biggest hope to
help us in our storage needs constable
it's not really there yet you can play
around with it it's there in Firefox 4
and latest minefield builds and it's
prefixed with a mo Zhi underscore prefix
but you can firefox minefield only has
the s in parts of the s and Kronus
implementation yet but it's still on
well you can already play around with it
next thing for the future will be the
file API because the file API from the
specification will allow us to open
through the browser a file on the user's
filesystem a new file where we can store
data in it which is very interesting but
it's it will only be a flat file thing
so if you really want it as a store
you'd have to do a lot of extra work to
have do to manage your keys and
everything but it might be a good
alternative if you try to store a really
large amounts of data say if you got
like some hundred images you want to
store on the client site or anything and
this might be a good choice because it
well directly lifts on the file system
of the user it's also there in Firefox
and latest minefields but I got the
feeling this will take a long time until
we can really work with the file API but
finally is all the bus and let's hope
that things are moving there what they
did not mention or plucking based
storage engines they are of course
plucking based options flesh gears error
and silverlight i guess but basically
that's not what we're here for we want
plug-in independent client-side storage
so let's move on to the main question
which of course is what engine for my
project all that on the one hand depends
on on your needs of course and on the
other hand it basically depends on the
question if you know your target
platform do you know what storage
engines are available there and if
you're developing for the web in most
cases you just do not know that means
you have to do a multi-engine approach
you need to be prepared to deal with all
engines that are out there you get a
search for the best available engine and
then just step down step by step until
you find an available engine and use
that one this really sounds like pretty
much work especially if you want a
unified API for your storage application
but rest assured of course there are
frameworks that do the work for you as
others have already done the work of
writing wrappers for the different
engines so that you have the unified API
and these frameworks also do the
sniffing the feature detection of what
engines are available in your current
situation in a desktop environment this
is not a problem if floats of a memory
usually have a good internet connection
so you can just kick in another
framework stand-alone frameworks are for
example lawn chair ryan lewis project
that offers a document store that you
can sort also use it as a key value
store it's completely a synchronous
because it also supports SQLite it has
local storage in it user data gears
cookies and I'm not sure maybe also
global storage precyse jas supports the
same set of storage engines also a
standalone framework and it's also a
synchronous and a bet there are more and
in case you're already using a Jas
library
then there might be well chances are
that there is storage rapper inside of
that library as it is for example
indulgent egg storage Dodger egg storage
is synchronous as a very nice API
currently supports global storage gears
and flesh and flesh encrypted storage
and with 1.6 I hope they're also be
rappers local storage user data and
cookies and that well kind of depends on
me if I finally commit them Yui also has
storage wrappers in there at least in
Yui to there was a storage plucking and
I strongly believe that Yui 3 there are
also wrappers and well I guess I don't
know other libraries will have records
for storage engines too okay let's leave
the same world of desktop where
everything is easy kind of predictable
move on to mobile client side storage is
even more important in mobile
development and again the first major
question when you're trying to you or
thinking about using storage for your
mobile application is do you know your
target platform and the good thing about
mobile development is that in most cases
you do know your target platform because
you're publishing your Europe or your
web app via a store so you at least know
the operating system that your
application is going to hit and chances
are that you're targeting a smartphone
which has a good webkit-based browser
inside and as you can see on different
operating systems you have well pretty
cool storage options with sqlite and
local storage even bada has local
storage Niska light um webos 1.45 is
supposed to have sqlite database
according to the website but in tests i
found that
it wasn't there I don't know need to ask
some palm guys on Android devices
because they're kind of google phones
you also might have eight years database
built in which is not which cannot be
disabled by the user size limits on
mobile devices is again tricky um
basically the limits are the same as you
have them on the desktop environment but
mobile devices tend to be limited in
storage by the device itself so it may
very well happen that you trigger a
limitation from the device before you
triggered from the browser so it is
assumed the same limits as on the
desktop but just be prepared that our
storage space will be more limited not
because of the browser but just because
of the device being full because I don't
know there's not much storage in there
the max amount of amount of data I ever
managed to store on a mobile device was
at least 10 megabytes on a milestone
running android 2.1 which is quite
impressive for a mobile phone so if you
don't have a smartphone running a webkit
browser you maybe have the widget
namespace and with that you have access
to the witch in preference store which
if preferences is also a nice key value
store available in the widget namespace
the API is kind of odd because it is no
delete method and the methods are set
preference for key and get preference
for key and it's pretty dangerous
because it's recommended that
devices using which it namespace may
delete data of widgets if widgets that
are o more often opened require the
space then it can be that the stored
data of your app just gets deleted by
the device which is not very nice so
well you have a store but it's not
really reliable probably you have an
application built with a tool like
PhoneGap and then there are other
options we've got to be kind of creative
that there are options in android less
than two there is an implementation of
the internal SQLite database of Android
exposed to the browser by a phonegap so
on android 1.6 devices you might using
using phonegap you might have sqlite
support which you can open just via
window dot open database as you would
with the normal built in SQLite
implementation also found some cookie
size oddities i managed to store two
megabytes of data inside of a cookie in
an android 1.6 application and was not
being sent to the server and there are
even more options that might be
available now as i mentioned before
gears might be there you might get
access to the file system where you can
store data may be larger amounts of data
and there's for example couch for
android which is also a nice nice option
um yeah I just got to be creative fool
around with the device you're targeting
and see if there are some crazy options
that are not standards approach but
which are there any help Jesus time is
running out
okay quick frameworks for that no not
not not one and you really want want to
throw a full-sized bloated framework on
a phone but very shortly and there be
storage j/s which I initially wanted to
release but just didn't manage which is
especially targeted at embedded devices
and which uses the ambit jes approach
that means that you only deploy what you
what you what you need so that you have
specific builds with a maximum or the
the smallest possible footprint for your
target device so it will be super tiny
in size and currently supports cookie
local storage wichard preference store
and google gears and i might add sqlite
to it performance well in most cases
when we need a client-side storage we
have no real choice or performance
doesn't really matter we just cross our
fingers and hope that it's fast enough
thing to keep in mind is that reads are
important than rights because rights can
be done in the background but let's look
at some numbers for local storage yeah
big big dealer numbers the only thing
which is important here is that you see
that Safari these are operations for a
second that you see that Safari has
insane numbers it's insanely fast and
that means when you look at the the top
row on android 2.2 it beats most of the
desktop browsers so local storage on a
mobile device is a really fast storage
engine it's really really cool and on a
good smartphone it's available for you
sqlite reads similarly fast but far
slower gotta hurry a bit security well
there is domain based access
restrictions for all storage engines
mentioned here of course it's not
involve all 22 cross-site scripting
attacks but it's basically it's kind of
secure except for stuff like DNS poofy
which you well then you're absolutely
you can kind of do anything about it the
only thing that you can think about is
have client-side encryption like a
Blowfish inscripted store but that would
make your store awfully slow I did that
and it was like unusable slow because of
encrypting large amounts of data is well
slow okay we made it number one client
side storage is possible it's also
possible on mobile devices and you never
have to use cookies again to store
application settings or anything you
need to store persistently client site
we have local storage with which is a
perfect key value engine and we can do a
lot of stuff with it and we also have
SQLite which is close but also pretty
cool and future is right we can wait for
index to be the object store which will
be maybe the perfect storage solution
that we've been looking for all the time
so it's doable and it's getting better
and we can do it thank you very much
thanks for listening thanks for having
me</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>