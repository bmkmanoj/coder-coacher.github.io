<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Mathias Buus Madsen: Javascript... Torrents... and Mad Science! | Coder Coacher - Coaching Coders</title><meta content="Mathias Buus Madsen: Javascript... Torrents... and Mad Science! - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Mathias Buus Madsen: Javascript... Torrents... and Mad Science!</b></h2><h5 class="post__date">2014-10-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BTCsSwCpGP8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright yeah i'm mateus I live in sunny
Copenhagen Denmark not that far from
here
I go by math intosh and trailer and
github so if you want to get in touch
with me that's probably the way to do it
we're gonna talk about three things
study JavaScript yay BitTorrent and a
little bit of math science stack VM
represent alright so when a bit of a
tight schedule here so we're just gonna
dive straight into it and get going so
what is BitTorrent how does it even work
so how many people in here have heard
about bit torn alright so usually when I
ask this question like what is
BitTorrent people tend to think this one
thing which is not completely untrue but
it's a bit sad because actually bit torn
is just right way more than this it's
way cooler as applications way beyond
piracy so yeah let's talk a bit about
how it works so like normally when
you've stretched a file online it could
be any file to be a video of this talk
that's probably gonna go up so while you
you you have this scenario where you
have a server and you trust this server
and you go to the server and you're like
dude send me this file and the server
side yeah and do here's the file
I checked it kind of nice because Lex it
is super simple super nice it's a
diagram with two things on it which is
awesome and what's the problem well what
happens when like a million clients come
in and like we want to watch this video
it's going wild
I don't know if anybody saw the Apple
Keynote a week back but they kind of had
this experience so what of course
happens is that the server is like
sending the file to everybody it's like
yeah it's going okay I can still see
some of the iPhone stuff going on there
it's like oh
starting to lag a bit there's only one
like natural thing that can happen this
like server explodes right nobody's
watching the video now it's not really
viable anymore so how about we improve
this and I really like simple way of
improving this will just be like you
just have every client send data to each
other right kind of get a kind of thing
that looks like this it's like it just
called and Pierce instead of clients
because now there's a both sending and
receiving data introduced like around
that's awesome this especially what we
call the peer but I mean introduced a
couple problems because now we're
sending data from arbitrary people we're
getting data from arbitrary people how
can we trust this how do we know that
like no one will come in and be like
this is that Auto talk that nobody likes
or CoffeeScript talks
so there's actually a really simple
solution to this you just take the file
the video we want to share we just flip
it into equally sized pieces usually
they're around half a make 10 mix and we
hash each of them people know what the
hash is right looks like digest 55
usually so we can just get a piece of
this file from anybody now assuming we
have these hedges and we just hatch this
piece again and we're used to so verify
it and if the hash doesn't match we know
it's a bad fear we throw away so the
only thing we need to do now is just
take this list of hashes what we usually
call a torrent file and we can just put
that on trust the server and now just
server just needs to distribute that so
that's pretty nice but it still
introduces this problem of I mean you
still need people to talk to right to
get the stuff
so how do we do that well dhts disturb
your hash tables all right people know
what a disappear hash table is all right
so it's it's basically a table that's
distributed
so like a table is a thing you put a key
in a value in and you can get like give
me the things that a store on this key
and you get the values back so we can
just do something like this where we
just take our torrent file and we hash
that so we just took a hash of hashes
that's a small like turnip ID thing
right and we just store an address to
ourself in this thing so now if we want
to find out who share this file we just
do a list of keys on our torrent file
and we'll get a bunch of peers back we
just connect to them super simple and
BitTorrent DHT is huge I mean it's crazy
it's studies have shown there's around
10 million notes in this database at any
time so it's like a database where you
have 10 million notes distribution data
between each other like partial data
it's crazy and you need to take all
these 10 million people down to shut
down the network it's insane it's
probably the biggest database department
out there so yeah so that's basically
how bitching works I think it's pretty
simple alright so let's move on so
BitTorrent is really really good for
distributing a bunch of data and there's
a huge amount of data already on
BitTorrent that's cool but wouldn't it
be cool if we could like access all this
data instantly that we wouldn't have to
wait to download all this data basically
if we can make a picture on stream I
think that would be pretty cool I'm a
dog guy I like streams so how can we do
that
alright so streaming BitTorrent
basically means that we have these
pieces each equally sized piece and we
just fetch the piece we need based on
demand so if somebody wants piece 5 we
just go ahead and fetch these five
that's the order we fetch it so it kind
of looks like this you you have a pure
that has pieces five and you just ask
that pure
please give me that but again this
introduces a problem because this guy
can become like an evil and being
stopped being slow so now we're not
really getting our data
and if this pierce really we're not
really streaming so that's a problem
luckily it's it's it's really really
easy to improve this thing we just
fished the same piece for multiple peers
so we just take like the top five peers
ranked and based on speed or something
and we just fished the same piece for
multiple people so now we get the
scenario if one of the peer starts to
act up and become slow we can just take
that like measuring the speed and swap
them out with someone else that's pretty
cool and this gives us just an area
where every actually we waste a little
bit of bandwidth because we're
stretching the same data or more than
more than we need but it doesn't really
matter because it's only four critical
pieces so it's probably only for like
when we build up a buffer or similar
right so it's it's it's it turns out
it's a really really good algorithm so
yeah I implemented this as an opal jewel
because that's what we do these days
it's called tor string especially a node
module that allows you to use this
algorithm to fix data and actually to do
this really really nice thing where you
just pass a torrent file to a
constructor and you get this abstraction
back and this abstraction contains the
list of all the files and it's warrant
and you can just create streams to this
file right away you don't need to wait
for any of this to download and you can
even do like random access where you say
I just want 5,000 to 10,000 or 11,000
right away and the stream will start
emitting data when it's ready so what
can we use this for well it turns out
that streaming on the Internet is pretty
big it's a billion-dollar industry
there are huge players out there people
like Netflix and it actually turns out
that during peak hours when everybody is
like trying to watch house of cards or
something
Netflix consumes about a third of all
Internet traffic and if you think about
that number for seconds like
huge
a third of the Internet just like what
so natural conclusion wouldn't it be
really really cool to just take some of
this things and pista producing pitch
appear instead of going to like a
centralized thing like Netflix so I
implement this
let's call pay flex especially a program
that streams video using peer-to-peer
and picture on to VLC so yeah
run try to put a move that and we're
gonna it's a right demo so things might
blow up this is the wrong way all right
so I get the main line tool and you just
do like pure flakes and you just pass it
a torrent and what we'll do now is so
actually go out and start fetching data
from multiple peers and open up you'll
see so it's on my screen here to sing it
so this is actually streaming and now
live there's no cash involved nothing
this is like a video documentary
we can even even do really cool things
like skipping the movie because all
random-access even though we're
streaming hopefully
so yeah pretty awesome and this gives us
this I was watching the World Cup like a
couple of months back thank you him
anyone and like it was very noticeable
in the when you had a game where a lot
of people are watching it like the
quality of the national broadcasting
their online broadcasting would drop
quality because time there's a million
Danes sitting there trying to watch the
game and we can actually flip this
around and do something completely
opposite because the more people are
watching our video the better runs so
like we can actually increase quality
which is crazy I mean the more people
who watch the video the better runs
that's completely opposite of what we're
used to so I think that's that's really
cool and and I mean this is a streaming
video I've seen that's before there were
some guys build the UI on top of my
thing called it's called popcorn time I
don't know if you know it but it's like
we're always trying to work around this
use case a video which is cool
I can also become a little bit gimmicky
so I like to try to push things which
takes us to the next segment Mad Science
so when you're in this space a little
while you cannot get this realization
that we can kind of stream anything out
there that's on BitTorrent which is kind
of cool
so like week ago I was preparing for
this talk and I I was like I need some
cool data stream so I went on Wikipedia
to try to find some good data sets and
Google around and then it like it hit me
everything on Wikipedia is actually on
BitTorrent like there's an actual
torrent file containing everything on
bit on Wikipedia then typing it's huge
so I implemented something called purity
it's a program that allows you to browse
Wikipedia peer-to-peer
in real-time using BitTorrent and I'm
gonna try to demo that it's really
bleeding edge so I'm crossing my fingers
here so
so what it does now is it's actually
connecting to to teach T finding peers
to share the capilla and it creates a
web server that runs on this thing
so what you're actually seeing here is
the PPD article on BitTorrent
streams using BitTorrent from multiple
peers there's no like centralized
servers involved here is this old peers
appear I don't know if you've ever like
went to Wikipedia and they had the small
banner tortoises like please give up
money because we run a lot of servers
like this runs several servers and we
can even click the links here hopefully
so there's a bit of latency involved
because now it needs to like go out and
fetch this link I clicked on
and I mean like this torrent it's crazy
that contains everything on Wikipedia
even like the assets this picture yeah I
don't know if you can see my mouse but
the picture up there that's not that's a
file this in the BitTorrent thing that
is itching when eyebrows here there's so
many things happening here is that it's
like we're just reading this article but
I know what's going on it's like crazy
and again we get this property of the
more people who browse this patient
better Wikipedia runs I mean that's
awesome alright so let's try to stop
that before we kill the network
there's actually a I think it's the
first use case for pit touring it turns
out that like all of Linux isn't it
turned and it's like the use case we all
hear that you should download a puno
using it turned so there's this program
that's called the VirtualBox and it
allows you to spin up a VM using a an
ISO file if that could be any Linux ISO
file and virtual machine what if we
could somehow take VirtualBox and make
it use bitter instead what if we can
make it understand streams well actually
that's kind of lame because virtualbox
always already has a nice feature it
deals with files so what if we didn't do
anything to VirtualBox and can't just
made it work I mean what if we somehow
made this thing that would make
BitTorrent completely transparent on
your machine and and just make
everything appear as regular files like
a bit torrent file system so I don't
implement this it's called a torn mount
it basically allows you to take any bit
torrent file I mean any it could be
typically one it could be any other file
and pass this to the program and it will
create a virtual file system using
something called fuse which is like a
thing that allows you to build file
systems and user space and you can
browse these using your browser so let's
let's try to do that so I need to open a
finder of course it opens on the
different thing
so I just run torn mount and I passed
the Abu new image made the starting so
connecting it's downloading from 40
peers I can go to my finder now sorry I
don't know if you can see it but it's
actually here in the finder there's a
file now called Abu no that's not really
there and it's just an abstract file
because we're still downloading for
people and we can hopefully pull up
VirtualBox to things and I can go in and
I can create a new virtual machine and I
can find storage and I can just click on
browser you're like usually doing
virtual box and I can just fake open
finder and now I just select this ISO
file and I can just launch VirtualBox
it's launching on to thing so what's
actually happening here
so I don't know if you can see the other
thing but we're actually we only
download like 8080 makes up this file so
far it's just fetching data based on
demand and I should probably select
German because we're in Germany and it's
like the appearance talking and I see we
have a little bit more time so we can
even buy two most fun things with it
so let's just leave this I should
probably shut it down I mean we can also
just take stuff like we can take the the
torrent file I was shooting before the
video file right mount that and here's
the video
it's an mp4 I should be able to open
this with VLC just as a regular file
it's not even there yet the file and
it's plain and it's like streaming in
from some patron
and actually this gift was this really
really nice property that if we skip in
the file and try to find some dialog
it's because like VLC is seeing oh
there's another file here in this thing
in deterrent that's the subtitle file
and is trying to read that file but that
file is also a bit turned so what's
actually happening is a torrent mount is
saying like oh you want to read this
subtitle file cool let me just go to
these hundred peers and try to fetch it
like live and stream it back to VLC but
really doesn't care it's just reading it
I like a regular file so you get this
really really transparent thing where
programs don't really know what they're
doing but they're just reading files
which is awesome so yeah that's
turnaround so that's it for me I am
always interested already interested in
talking note BitTorrent JavaScript mad
science anything please come find me in
the hallway or at the party before I get
too drunk or after depending on how mad
the science should be you should also
check out these cool things that's web
torrent which is I think just went into
alpha it's like trying to do this thing
but only in the browser using no native
things like self-contained BitTorrent in
the browser that's gonna be Tracy there
are sub stacks crazy wild pyramids thing
that we hacked during our conference a
while back that's like let's take all of
Google Maps and program be turned so we
don't need coca maps anymore
so so yeah that's it thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>