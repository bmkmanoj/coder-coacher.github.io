<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Paul Adenot: Elements of Dance Music - JSConf.Asia 2015 | Coder Coacher - Coaching Coders</title><meta content="Paul Adenot: Elements of Dance Music - JSConf.Asia 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Paul Adenot: Elements of Dance Music - JSConf.Asia 2015</b></h2><h5 class="post__date">2015-12-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Ww0jTafmd_w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so my talk is called elements of
dance music um we're going to chat on
how to make people dance with music is
that another appropriate title so yeah
we're going to make music using only
maths no not a lot of sound samples no
nothing just like pure mathematics and
might even work we'll see how it goes so
I'm Paul I work at Mozilla on the Web
Audio API implementation I also do the
spec work at the w3c so we end up like
we write this massive massive massive
massive document that ends up telling
you how exactly where would you EP I
should work and and when I'm not working
I actually just make music with like
normal people not with math and software
and everything like that so yeah alright
without further due let's talk about
what we have for today so we'll do a
brief introduction and try to define and
characterize why is music yes big task
so it's going to be scoped pretty gnarly
and then we'll chat a bit of a verte a
specific genre of music school acid
techno general i like very much and
maybe do a little bit of the
construction of an acid techno track so
yeah listen to a couple tunes we'll see
how it goes maybe you understand the
parts of it and then we will learn on
how to like how Web Audio actually works
and try to bend these to make do an
actual technotrack like to make sound to
make the drums to make the synthesizers
and to make the yeah the Sun we want and
then we my
it's even try to do it live in a text
editor and just like you know dry too
quick dirty technotrack like and then
five and write some more texts and six
in my work seven if we have a good tune
me out just get up and dance right all
right first what is music so it's a
simplistic a simple definition is not by
any mean like the one definition react
academicians use to me and for today
music is rhythm + melody + timber right
so rhythm can be characterized the
absence of presence of a sound at some
point in time and the duration of its
sound so for example we have a note HB
for a quarter beat and we're gonna have
140 beats per minute right melody is the
sex session of a sound that have a
height a pitch and they constitute like
a unity right so it's a tune you can
sing and you remember that's desa melody
and what is more important to me and for
us today is a chamber so it's the
entrancing sunny quality of the sound so
for example is it like a pure tone is it
pitched like can you can you determine
the height is it a metallic sound is it
like bold like a violin is it like a
vocal like someone is speaking or
singing so yeah today we're gonna focus
on on tamron like actually making sound
that sound nice and yeah the code is
already written to make it sound where
it's like when it should happen and and
the notes already 13 so yeah but yet
tember isn't what is important for us
today okay so now we can talk maybe
about a general music school acid techno
is going to be a focus for today so the
sound design that we're going to do
might sound like that
alright so say yes electronic music as
you as you can hear got creating Chicago
and Detroit in late 80s Early 90s so
yeah so in this I in this specific track
that I made quickly the other day you
can hear two machines so it roland
tb-303 which is an bass synthesizer
which is like the little tone very harsh
very fast and there is like a roland
tr-808 which is drum machine so it's got
the kick drum clap hi hats so if we
listen to it again ok so in here we've
got the kick drum right and then we have
America's sound then we have some claps
right if we mix the drum together okay
cool then we've got a baseline
kinnear it changes i'll just play
you
and then if you mix everything and add
some delay and reverb like some effects
okay so that's the kind of the goal for
today so while we're doing it techno in
the first place it sounds good right
that's one thing it's also very simple
to code so i can explain you wear with
your concepts with that so the kick the
clap in the rad cast we're going to
we're going to synthesize are actually
going to be tr-808 simulation that's why
i was presenting this machine and the
baseline is going to be a tb-303 like
sound okay so without further ado let's
introduce the audio context and now from
no one's going to be all JavaScript and
some codes on the slide so please pay
attention is going to be worthwhile okay
so you've got this thing fire AC equals
new audio context and really when you
talk about where would your API there
are three main concepts you've gone know
your context you've got all your nodes
and you've got audio params right so
you've got a number of audio nodes like
a key I've seen this picture and you
connect them together using the Kinect
call so if you connect an oscillator
node to a gain node you will apply the
processing of the gain node from the
oscillator node and then if you connect
something to the destination node then
you will actually hear it in your
speakers which is what we need right so
what can you do with an audio context
you can you have the destination you
connect things to his destination you
have the current time so it's the time
of the audio context it's always going
forward you cannot really pose it it
cannot go backwards so it's always
progressing then you can create some of
your notes so for example an audio
buffer source node I can play another
buffer a gain node can change the volume
of its input an oscillator node can play
a simple wave form like a sine wave
square wave and things like that and a
biquad filter node can filter the sound
and alter its characteristics for
example removing the high
frequencies all the low frequencies or
something like that we will see more
example in a second what can you do when
you get an oscillator node so an
oscillator node can be connected to
another node you can also disconnect it
from the other nodes you can set the
frequency that is the height of the
sound you can slightly ditch you Nate to
make it more interesting you can change
this type for example whether it's a
sine wave square wave or so to what we
will see that in a second you can start
it at some specific time and then also
stop it at a specific time audio program
as you can see the frequency here and
the detune are both audio params right
so what can you do with an audio
parameter you can set the value here you
can set the value at a specific time so
you say set value at time for 10 at
exactly 10 seconds the value we jump to
for you can do an exponential ramp to
value at time so it will do a smooth
ramp from the current value to the next
value using an exponential curve you can
do the same with a linear ramp and you
can do a set target at time that will
gradually become goes to value from the
time time and with those with a constant
which is I explain it later with more
examples so it goes like that when you
do any do / am so for example here we do
set value at time 1 20 at 120 seconds it
jumps and then we do linear rom to
evaluate I'm 22 seconds at 0 it goes
down gradually like that and then we set
value at time again and then we do a
setter I get a timing decreases
exponentially like that okay so now we
will actually hear some sound ok so we
do an oscillator we create a gain node
we set it to a sine wave and we set it
to an a for which is 44 in Hertz and
then we will see two inputs so we will
change the frequency and we will change
the game then we connect everything
together and we start so it
change the frequency and we can change
the game all right so it's just a sine
wave ok now we can change and use
different type of wave
that's a square
and that's a triangle
and now we have a sawtooth
so it's different sounds pretty useful
all right now what can we do like this
pretty static not very interesting so we
can we can change things using the audio
param methods so for example if we take
a very low sine wave at a hundred Hertz
and then we set value at time at 120
which is no volume reduction and we set
a look at that time at 0 to 0 which is
silent it will do something like that
right can start to hear the start of a
kick drum maybe I one sec maybe you can
do a bit more so if you change the pitch
at the same time maybe yeah start
sketching like a kick drum okay we'll
see you later now we need a bass sound
right so what can we do we get like two
oscillators maybe to sawtooth set it to
the same frequency we're going to same
have two sliders to be able to change
the value of the day tune and and the
the value of the frequency and then we
connect everything together like the
usual okay
sounds better right yeah so yeah some
techniques we can we can learn
okay we need a bit more okay no need to
introduce a bit like a bit of a heavy
beasts like the Fourier transform your
friends so you can you can look at the
sound in the time domain where you see a
sine wave like looks like a sine wave
you all know we can also you see it in
the frequency domain where in the x-axis
you've got the frequency and in the
y-axis you've got the actual amplitude
and then if we change the frequency so
yeah and if you change this he changed
it to square the number of different
patterns here
right so this just thing we're all using
the next point so now which we can do is
to filter the bass the bass right so for
that we use a biquad filter and we'll
get a saw tooth and we'll debt unit like
previously and then set a pretty low
frequency value and then we will get a
low pass so what the low pass is it lets
through the bass sound and it cuts the
high frequencies and then we will change
various characteristics of the bike
words so the frequency which is is it
cutting the high frequency at a very
high sound or very low sound the queue
you'll see in a second so what can we do
with us ok so we have a base right and
the red line is the filter right
we can change the characteristic amounts
all right
so the QE is little notch
let's call the resonance filter of
course you can go get high pass which is
exactly do
he cuts the law and like the high
frequencies like a treble stays here
right and then you've got various other
stuff like a like a band pass that lets
through you're near specific frequency
but then we won't use it for now okay so
now what can we do like we go on and on
and on we create a buffer and then we
fill it with random noise not random so
it's noise between minus one and one
okay what's can Ladd to let me just drop
the balloon just noise it's gonna be
very useful to do or America's sound
just like yeah just random noise really
okay and then yeah for the clap I didn't
really feel like synthesizing a clump
because pretty hard so I'm using all the
facilities of the web would your API so
I'm fetching with a new fetch API which
is the new xhr an OGG file because like
that's the one one time I'm cheating and
I'm I've actually sampled the machine
and sorry it recorded it the sound and
you can use decode audio data to decode
the buffer it takes the same codecs as
the HTML media element and then it gives
you a decoded buffer and you can just
play it back right so you just played
back like that you get a buffer set the
buffer you set it to loop so it looks
indefinitely connect your destination
and start it sorry just just playing
back the clap yeah
so without further due let's try to make
a little something so okay so this is
just a roof
ok
it's just a text editor I'm going to
just setting this up ok cool and then
what I need is my actual order Firefox
so I can run the code ok so this this
vim thing is running in which Firefox
I've got so many open yeah and this one
yeah so yeah let me just explain to you
what the code is here is doing I didn't
feel like as I said previously at we are
focusing on actually making the
instruments so the notes here I've
actually always been written so we just
have a tempo which is 135 beats per
minute which is normal for technology
and then we have a kick as we heard
previously that goes on each beat so one
silence silence silence once island sat
in silence and that goes for ever and
ever the hi-hats goes on the opposite so
that's going to be kick I had cake I had
the clap goes in the middle some time
here and then we've got some notes for
the base so that's me denotation if you
know what that is but like just just
know it's really then what we are doing
yeah we get s4 since we get to know do
contacts here we set the track so the
track is what we have just here we get
the destination here we get a clap
sample because I didn't feel like
synthesizing a clap again then we get a
noise buffer because we're going to need
a noise buffer then a couple acidity
function all the code is going to be a
liner as well with a lot of explanation
like text Jewish nation so the clock
lets us know what time it is in the
track we count not in seconds but in
beats that's easier if you want to do
audio-visual synchronization yeah so we
start the track and then we have a
little scheduler here so the scheduler
is continuously looping in the track and
telling you which know
you need to play and when you need to
play it and which and which instrument
has to play it so this is not very
complicated nor important topic for
today so let's just close it right so we
have four empty slots here we want to
kick drum whoops we want to kick drum we
want hi hats we want to clap and we want
to base right at the bottom is just the
initialization with the fetch and or new
audio context and everything so it's not
very important ok let's start trying to
make a kick drum right so it says boom
boom boom in the comment that's exactly
what's going to happen right so we're
going to get a first oscillator ok so we
do create oscillator and then what can
we do with an oscillator we can set the
type to a sine wave we can we also need
a gain node because we will need an
envelope so a kick is louder at the
beginning and quieter by the end so
let's gates let's get us a game node ok
create gain ok then of course we need to
connect the oscillator to the gain node
and the gain node to the actual
destination right we need to start the
oscillator in each function we get the
time T here so it's the time of which we
need to start the note and then we also
need to stop it at some point one second
is good is going to be shorter than one
second we need to stop it at some point
doesn't really matter and then we need
to decide like which curve we will get
to for our kick drum so let's start with
again so it's gonna it's going to start
at a full volume set value at time so
full volume is 120 and I was at T it's
at full volume so beginning of the kick
drum and then you will guard you leave
all target at time to 0 at time T as
well and the constant is how fast it
will go down so 0 dot one is pretty fast
but not too fast that's I guess it's
good then as we saw earlier we need to
set the we need to drop the frequency a
notch frequency okay set value at time
so a kick drum 120 Hertz is good I mean
I'm just doing those values on the top
of my head really like I've kind of
listened to 808 kick sound and it
sounded good so I yeah I was alright and
then it'll it also drops to around 50 a
bit shorter okay so yeah maybe we can
try to hear do we hear something ok
let's Britta maybe you can make it a bit
yeah that's better so it's not that okay
um we can we can really make the kick
drum would be better if we do like a bit
more of an attack sound so I'm just
typing this real quick what we want is a
is a sound of the beater on the on the
kick drum right so it's going to be full
of high frequencies and yeah I'll see
how it goes so hmm just like doing
something real quick here
a second sound is exactly the same calls
a very much shorter though um what can
we do what do you need yeah oh and we
need to connect everything together
oscillator 2 with gain too oops into ok
does that sound better no it doesn't
what have I forgotten oh yeah so that's
a bit of a better kick right ok alright
that's good we've got a kick but we've
got a number of more instruments to go
right so let's start with some high hats
so for the high hats i canna sound like
a noise bursts but we need to remove the
low-frequency content because we it
doesn't have a real bass sound of high
hat not really so let's see we need to
play back a noise buffer so for that we
use the audio buffer source node thing
source ok and then we set its buffer to
a noise buffer so in noise buffer is
where is no its buffer yeah so a noise
buffer is just a buffer that contains
random values between minus 1 and 1 so
yeah it's just playing that box not very
complicated or anything and then of
course we always need a gain node
because percussions have like a
different amplitude during the of the
over the course of the sound creates gay
ok then we will need a high-pass filter
hpf create biquad filter ok and we will
set it too high pass so the high pass as
it I
name suggests it lets through the high
frequency let them pass but it cuts it
cuts the low frequency right and we set
it to a frequency of randomly chosen
five thousand Hertz as usual we we
started at full volume at time T and oh
it's called gain and then it drops in
volume to 0 at time zero it's fairly
short so 0.02 is going to be a very
short sound then we need to connect
everything together so source connect
gain connect I pass filter connect these
dots sink and then we need to start it
and then stop it oh no no it will stop
whenever whenever it reach the end of
the buffer automatically okay so it does
that sound alright oh my season yeah so
that's a little symbol the Americas okay
okay cool ah ok we go now we need we
need a clap sound okay so clap is just
playing back the buffer so and we do
like virus source equals this AC create
before Souls exactly like before and
then we actually don't want it full
volume we want we want a bit not very
loud so we all create a gain node for
that as well you always have a ton of
game knows where you where would you
like a ton create gain okay and then we
connect the source to the game oops no
connect to the game and then connect the
game to the sink okay and then we need
to source dot buffer equals the clap a
clap is something we just got using this
fetch thing here
um and it's the sound of a clap and then
we start it same thing is going to be
stopped it's going to stop automatically
so does it's all right okay okay okay
and now we need as it is written in your
strength here we need to drop the bass
okay so let's do this as we saw to
sawtooth together slightly detuned sound
good so you're going to give it a go so
we need to create two oscillators then
we create a gain node always great to
gain node O'Kane okay and then we'll
need a filter as filters I'll call
create by quiet ok so we connect all
this little world together last two okay
then what can we do we need so as you
can see here we've got the actual notes
we need to play passage to us bio
scheduler isn't it nice so we need to
set the frequency of the nodes okay so
oscillator dot frequency dot set value
at time then we've got a little helper
at the top so from a note to a frequency
it's this barbaric formula that you can
find on Wikipedia so not to frack oh
it's tea and then same so I follow first
and the second one then we did tune one
oscillator like we saw in the slide
before and then set the two to sawtooth
so tooth because like in the original
303 you could choose between so 2000
square but i think i prefer the so to
sound so let's let's go with it and then
give it a little envelope so it doesn't
sound boring gain gain set target oops
mm-hmm fairly short as short as the kick
because the kick was also zero point
wine in a constant then we will set some
value on the filter so fairly aggressive
resonance and then we will automate the
filter as well so the filter cutoff
frequency will change over the course of
the notes so the Sun will not get very I
will not be boring because boring sound
you just want to like shut it off and
really don't want to listen to it mmm so
let's start at three hundred again just
picking the value randomly
yeah and going up to 3,000 fairly short
again and the filter will let the bass
through and we'll cut off the high
frequency right so for that will use a
low pass because let lets the low pass
and then we start all that jars start t
stop at somewhere in the future t plus 1
okay is that gonna work I think it's
some licks okay I had for Burton to
connect it to the actual destination
yeah wasn't going to work okay let me
get this one back okay
alright so maybe we can try to make it a
little more interesting and can I'll
know I like 10 minutes okay what we can
do is to dynamically change the value of
the filter and so let's try that so
we'll put variable here prick equals and
then we'll drop a slider so if I are
equals document create element inputs
inputs these days with html5 can do
really crazy stuff input type range
input min on a thousand maybe and Max to
10,000 input step 1 then inputs on
inputs I'm going to go okay so we're
going to say Frank equals 0 dot target
what are you and so that will all change
the frequency of the filter of course I
need to do document appendchild oops
input no slider it's called I it's got
okay
is it working
I lied saw one ah yeah good one okay is
that dropping a slider nothing is
starting to to work don't do only
something else um yeah I think I'm
pretty much done uh-oh can take
questions long yep Wow thank you Paul
big round of Gloucester so this is how
we learn how to make sounds and music
eventually I would love to have some
questions hi that's awesome I got a real
light away I got one question about the
way you're constructing the sounds yep
every time you trigger a sound you
you're constructing the whole thing is
there a reason you're doing that as
opposed to making a once and then doing
a start and stop each time so I've got
two answers for you the first answer
would be yes you could create your note
once and seek a gain node in front of it
and mute it the second answer is you
cannot restart a note once it started
and stopped you gots garbage collected
right so it's kind of like a
fire-and-forget kind of model the nodes
are extremely cheap to create and are
extremely cheap to destroy so that's it
simplifies the model so you don't have
to keep track of how many voices you
have and things like that so yeah two
models either create all the nodes in at
each time like I'm doing
here because it's a bit more simple the
second yeah you can just stick a game
note and sticking again now in front of
it is much more like the old analog
analog way of doing things so when you
have a voltage controlled amplifier as
it's called vca so we have two way of
doing things I picked one for this talk
really hello what is between this and
doing something like the cerrado
software in a browser hard work and
tears so serato for the people who know
we don't know about it is a thing where
you put like kind of fake vinyls and and
you can play mp3's and the vinyl yeah
you know the orientation the speed of
the vinyl on your turntable so you can
actually scratch with your mp3's right
so that's the idea about it so no it's
like I think is very much possible
people have done turntable applications
on the web before so if we if you
haven't even hit me up afterwards I can
give you some names is yeah it's kind of
working pretty nicely but yeah I mean
just work you need you need to do it
basically I'm making sense maybe you can
make the next era so on the web so the
two that you visualize a frequency I
think it looks really useful to me like
I think that that's all I've I knew that
there's the q value that you can play to
adjust somebody like I could not
understand and i never knew like what
that means so how do you draw that red
line and you know the shape of dirt so
in the Web Audio API there is this node
that I have not presented but that
exists that is called the analyzer node
so the analyzer node you connect to
analyze the UConnect other nodes to the
analyzer node and it gives you either
time domain or frequency domain
representation of of the data that in
input and then it gives you a buffer and
then you
I'm just drawing the buffer on the
canvas I repeatedly using
requestanimationframe so this one way of
doing things for the filter for the
filter there is a method on the bicoid
filter that can give you what is called
the frequency response of the filter and
then you give it a number of frequency
where you you want the the information
and it gives you back a buffer that says
oh I'm catching at this frequency and
I'm boosting at this frequency and
things like that so but the code is
going to be online I have a last slide
to show with a number of URLs if
possible okay so thanks starters and and
the other code I've presented today I've
made a later literate JavaScript program
that explains you in-depth how it works
and possible ways of making it better if
you want to know more about synthesis
and how to emulate all the analog gear
you just search since secrets on google
and give you like a 60-year something a
article series so yeah of course Twitter
get a pad not an email if you if you
need anything from me but yeah so it is
like a literate JavaScript program so
JavaScript on the right and pros on the
left that explains everything that it's
doing so yeah that's yeah so it's
exactly the program that I wrote so I
mean exactly not because like it was
improved but like it does kind of the
same sound it same technique is same
instruments but yeah so yeah feel free
to read to read it to read up on that
because not sure about you that I find
it pretty fun right thank you so much
for thank you amazing
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>