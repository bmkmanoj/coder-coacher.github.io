<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CSSconf EU 2015 | Horia Dragomir: I Don't Want To Be On Facebook All Day! | Coder Coacher - Coaching Coders</title><meta content="CSSconf EU 2015 | Horia Dragomir: I Don't Want To Be On Facebook All Day! - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CSSconf EU 2015 | Horia Dragomir: I Don't Want To Be On Facebook All Day!</b></h2><h5 class="post__date">2015-10-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rSx5RxuaZfc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi and welcome back from lunch am I too
loud yes no alright so let's talk about
how we build messenger calm and if you
don't know messengers calm is a full
page react application on which you can
send and receive facebook messenger
messages um why would we build such a
thing when you already have chat on
facebook well when we launched it we
gave all the reasons in the press
release and they're so true something
nice happen is a side effect a lot of
corporations for instance block access
to facebook on their corporate networks
because they want people to be
productive but they don't block access
to messenger calm at least not yet so
there's that but also we thought it
would be very cool to build and how do I
get to work on it I was just lucky I i
joined facebook right about the time it
was started and the web messages team
pitched the project i liked it and i
joined and I never looked back before we
get into actual messenger com I want to
take them over and talk about how we
front in that facebook and I think it's
time we use front-end as a verb it's
hard to talk otherwise but as most
companies do we use modules small
components this is the thing that makes
sense everyone knows everyone agrees I
think how we make modules is the same as
everyone else we will define one just
messenger foo it lives in the file that
has the same name messenger foo we just
add this doc block to the beginning of
the CSS file and ready to get started we
had our rules but we have a special kind
of syntax as you can see we use the name
of the module and a slash and then the
actual rule name this makes it very easy
to whenever you look at the class name
to know what it belongs to
and we have it so that you can only use
rules and class names that belong to
this module over here so if we try to
use messenger bar this will be a lint
error why would you want to change
messenger bar rules from with a
messenger foo we do this for
encapsulation purposes and to try to
make our CSS components small and very
focus on one thing so we can compose
multiple if we need to however sometimes
you do need to style something from
another component so we have a thing
called public classes we just define
them in a way that you can use in a
different module because sometimes you
do need to style things differently
depending on how you can post things but
this will really make a lot of sense why
would we always overwrite the public
class of another module we just
concatenate with our rule it's very
simple it just takes some getting used
to especially with a slash in the rule
name which is not valid syntax I don't
think well you don't even need to use
all that a simple rule like that is all
you need for a mile to exist we don't
even need a rule you just need to put
the module there and everything will be
public and it is how we would use it in
JavaScript we have a simple mark
messenger foo react component we have an
h1 and we want to just use the title
class name on it we just right you know
react does anyone here use react I'm
sure you do yes there we go put your
hands down but we can do more complex
things instead of saying just use this
class name we can pass it some JSON and
this in this JSON the property names are
the actual class names that we want to
use and the values are booleans and the
signal whether or not to include this
class in the class list and let's focus
on the the weird thing over there that's
CX CX is our class transform function it
serves multiple purposes for one thing
it actually evaluates the logic of which
classes to include based on the boolean
values for jasons but it's always there
we always have to use it so we know that
we can search for it
and we look for instances of CX and we
find out which modules do we need to
include in this case we need to include
messenger foo and messenger bar that CSS
these two modules and we do this not at
runtime because that will be very
inefficient we do this through static
analysis at build time we just parts all
our JavaScript files and we see which
modules are being referenced and then
whenever the module will be loaded we
already have the CSS loaded side by side
with it it's on a package and all
required and this is great because you
never forget to include your modules and
it saves you love you know time hassled
debugging effort and this enables us to
do very cool things that have to do with
the two modes and now I'm not talking
about you read software more than you
write software even when you're writing
software or when you're reading software
a code or when you're debugging it
you're still in the human mode it's you
interacting with the code that you or
somebody else is written the other mode
is the Machine mode is the machine when
it executes your code and it has to do
something with has to understand it our
our static strength our static tools our
psyche transforms and analysis allow us
to do things there are good both for
humans and for machines for instance
this is all we need to type to get all
the prefixes these get added at build
time automatically this is an
optimization done for humans it's very
unpleasant to have to type these manuals
I'm sure you know and you'll use prefix
free or something of the sort we go a
step further we also optimized for
machine at this level as well more or
less when a person loads our page they
load it with a browser so if I'm using
Firefox and I load messenger com why
would I get the MS transform and the
WebKit transform declarations they make
no sense the browser will ignore them
they're wasted bites we actually don't
even send them we look at what browser
you're using and we only send you the
rules that you will understand which is
very cool because this saves a lot of
bites and bites save energy in fact I
estimated just by this thing
we save enough energy which is
equivalent to about half a Hiroshima
every day to put it in a different
perspective it's enough energy to warm
up this room to a temperature of 214
cats for about a week that's a lot
another thing we do and this is actually
a pet peeve of mine it doesn't matter if
an element is 0 pixels or 0% or zero
elephants from the right it's smack on
the right we don't need the unit there
we actually do remove it the static
analysis and this again saves bytes
white save energy this simple say by
removing the unit from zero allows 200
stray cats to find a new home every
single day that's my estimation and this
managing is something we do for machines
because I am a human I'm sure your human
as well most of you and we need
something like this we need a rule that
makes sense when you read it this is the
title rule belonging to the messenger
for component a machine doesn't care a
machine needs a unique string so why not
make it something very very short a
machine will do just fine and we never
have to read this this just happens
between machines so back to our
JavaScript example this whole thing gets
evaluated and say we also have the
subtitle it will be those two classes
but this is after build time when this
actually runs so it's not that big long
string in the class this is just
something small like this now the
compound savings from all these bites
arteries are enough to boil all the
coffee that has and ever will be
consumed that all the CSS cons would
ever ever happen but we're not over I
mean this is just writing and maybe
debugging a but yes we're shipping code
we're shipping our code to the the users
and they're loading in their browsers
but we're not done we have another thing
it's called machine learning which we
can use we have this cool thing called
packager and remember how we reference
to
ss modules in our example messenger foo
and messenger bar well packager we'll
look at how messenger full and messenger
bar are loaded especially in relation to
messenger food out Jas and we'll see
that whenever we request messenger foo
we also request messenger bar so it
makes sense to turn these two files into
one single file and the file name will
also be very small again fewer bytes and
fewer bytes and this is these are just
randomly generated hashes but even even
machines can make mistakes two weeks ago
or so this file was generated based on
packagers heuristics and I'm sure some
of you already see the problem some
people couldn't chat for a considerable
amount of time because ad blockers
thought this was an ad when in fact it
was just a couple of our modules that we
kind of need for chats work machines are
silly but that's why we're here and here
today yesterday and just in general
people ask me a lot whether we use less
or SAS and which one would prefer at
Facebook or do we use tieless we use
nothing because using one of these make
it harder for people who just start to
get into the groove anyone who's ever
written a web page can work at Facebook
and they instantly know everything they
do need to know to be able to be
efficient we use plain old CSS however
we do have the static analysis and style
transform step in our build system so we
can do some funny things we use
variables of course we call him
constants though because they're not
really variable and this is how you use
a constant what it's a bar but anyway it
builds stuff we will replace it with his
actual value this is great so you don't
have to always remember you know fo six
for a magenta you can just say messenger
magenta and that will be great now the
rule that you have to use to you know to
go from a actual explicit hex value to a
constant or after how many repetitions
do you use that the rule
I still don't know it but I'll find out
and I'll tell you but that's enough
about how we we actually you know ship
code I think you got a pretty okay idea
of what happens hopefully otherwise
let's talk later but let's get back to
messenger calm because it all actually
started a long time ago when we rewrote
chat the facebook chat with this in a
very special way we thought let's make
some components that have no styling
they just get the data they need and
then we have different components that
will present the data this is not a new
concept but we decided to apply this
religiously through chat we call these
Stalag gnostic components containers and
everything is a container and needs a
presenter to actually display the data
so you wrap a you know a normal
presenter in a container and you wrap
that you know what multiple lists of
them in another container and so on you
go up and go up we call this shawarma
driven development because everything is
a rap as a simple example let's say we
would hypothetically have a list of
recent conversations that we'll just
call the style agnostic threadless we
give us some parameters we give it a
presenter which is something again we
control and we give it a class name just
so we have a hook so we can use its
public classes to style things and we're
done it goes down one level it calls the
class the component we pass in and then
again we for every conversation we just
add a new container pass down to how the
classes have the hooks and so on until
we have the whole tree shawarma and
because this was a new thing right this
is facebook com and facebook com has
been there for a while we believe that
everybody should be able to use facebook
so we support a large amount of browsers
but messenger come was a new thing and
by definition it is niche it's people
who really want to use messenger and
they want to have a nice environment to
do so and Icefall this type of
environment so we decided to not support
the old browsers and that meant we could
use the new CSS stuff we were finally
free to use flex box and suffolk CSS
grid for layout and whatnot except we
weren't because we want to
have something that looks like this and
with a CSS only solution it didn't work
out that well as Leah mentioned in her
talk just having the CSS only solution
doesn't help you is just so you can say
that you have it but it doesn't do
anything else than be and sometimes it's
wrong as well so instead of using
flexbox and CSS to it we went back to
using an old component of ours it's a
layout component and it is JavaScript
based but it's battle-tested we've been
using this for a long time we figured
out the bugs people who are much smarter
than me fix the bugs and we ship with
this and later after it was ship when we
had more time we went back and found out
what was wrong with flexbox it turns out
that because flexbox has changed so much
over time it's you know its
specification and all that and the
standard it still isn't we had some
static transform tools that were
conflicting with each other and chrome
would sometimes get the new version of
flexbox automatically transform but for
Safari you would get the old version
with the WebKit box and of course that
wouldn't work well what once you figure
out those issues it was okay except for
you know Internet Explorer because
engine explore is to need to specify ms
flex in a 1 10 pixels and it needs to
have pixels there because if you just
say 0 it doesn't know that it doesn't
know what you mean I remember our rule
that strips away the unit from pixels so
we just added a couple of exceptions and
we were fine to go with flexbox flexbox
well we weren't out of the woods yet
because it's a bit product even though
it's it sounds simple it actually has
very many moving parts the shawarma wrap
is very deep and I'm sure you can see
the problem with this and if you miss it
let me blow it up for you as you're
typing in a right-to-left language and
you type in comma space as you do to add
a comma the college's jumps
this is weird we never understood why
and we spend a lot of time just
debugging why this happened we thought
were supposed to some old archaic
components that we weren't including by
mistake but it turned out that it was
our over optimization as many websites
as many web applications we have just
one font definition it's a font family
we have a fun stack and everything's
fine we were using helvetica neue
Helvetica neue actually has this problem
that if you're typing in right to left
and you've having a character character
character comma space character space
and comma will just invert and that
looks very horrible if you're a user
that you know speaks in a right-to-left
written language so instead of using her
veticon know which is the cool thing we
detected if you're using right to left
we don't want you to have a better
experience so we just fall back to REO
REO the old boring REO but the old
boring battle-tested area which has been
improved over time and works well with
anything you throw at it and this was
just something that we just happen to
find out Helvetica neue has this problem
but there are some things within
facebook that got in our way java
subcomponents really like pixels as size
dimensions as they should but remember
we're a full page application pixels
don't work well because you resize the
page a lot you might want to dock it to
the lift and not only that but we need
to accurately display what you have sent
to the other person with which you're
talking if you send them an image we
need to display like this or if you send
more images each case has a different
grid on different sizing and we need to
kind of make it look nice and if we try
to stretch images they will look
horrible and we needed a different
approach also they're always about
roughly half of the other conversation
window even if they're six or just one
in short we needed to be responsive and
that's very hard to do if you're using
pixels so we had to add our own
containers again just so we could
use different CSS classes that were
based on percentages and we couldn't use
a lot of the building blocks that people
on facebook com use out of the box
because they only work with pixels still
though we have four break points oh
that's not a lot but it's kind of a lot
because it's four and we change small
things that every one of them the bigger
thing that you'll notice is the right
hand side information panel if we detect
that we don't that you don't have enough
space to comfortably displayed and also
view the conversation will just
automatically close it for you you can
still open it if you want we have the
button and again if as you expand and
you have more space we automatically
open it for you actually the day we
released we got featured on good
products as you do and a person
literally spent enough time resizing is
browser window back-engineering how we
what the rules for this are and he was
so impressed that we took the time to do
this but this is actually something very
simple it makes a big difference but
it's something simple you can do but if
something is very in your face you can
also be responsive at a smaller scale
titles and messenger even on your phone
app are there centered so we Center the
page title which is messenger but we
also Center the conversation title in
this case it's an unnamed group between
me and two other people with long names
what if you want to dock your window to
the left of your screen truncating
centered text is weird especially if you
have icons on the other side because
they will take up space on evenly and
we'll just look weird and you can't do
it you can't use a CSS only solution for
this because it's not dependent on the
size of the viewport is depend on the
size of the name and the element that
contains in the name and not even
element query if we ever get it will
help us here for this you need of a
hybrid solution you need to measure the
size of the text and measure the size of
the container and when there's not
enough room just change a class named
float everything to the left and apply a
truncation if you need to now we do a
lot of these small things on break
points or when we detect that you don't
have enough space just so everything
nicely and looks nicely it's supposed to
be an app that's on par with the native
experience and that means you need to do
a lot of these little polishing and
speaking of polishing and how we know
titles messenger are centered that's an
interface guide and we have an interface
guy for facebook now please please tell
me you know what this is just say what
it is yes it's a fig right the Facebook
interface guy to fig I showed this to
Americans and they just had no idea what
it was they had not seen figs I went hot
air ballooning and the person though the
pilot dropped the balloon so we could
just brush against some walnut trees you
know walnuts and he said you know if you
reach how you can actually grab some
walnut so I did and I grabbed the walnut
and was all still green and only me and
the pilot knew that that's what walnuts
looked like Americans are weird they
don't know what fruit looks like in any
case that's the fig that's the facebook
in your face guide and we have a
different product it's a messenger thing
so you get the reference i'm trying to
make we have the mig the messenger
interface guide and that's just a visual
style guide of how things should look
like a different combinations and all
that normally it's made by a designer we
found that it's a lot better to be made
by people who are working on the product
not just the design is not just the
developers with everybody involved
because some things make sense the
designers somethings are very cool to
design two designers but don't make
sense to implement or just don't make
sense for people to use in any case we
took some of the facebook components and
turn them into our own components
remember how when Chad was rewritten
everything was a container and a
presenter that's kind of how we do
components everywhere we have an
abstract thing and something that gives
a presentation and we were able to take
the Facebook button turn into a
messenger button which looks a lot like
a button I know I'm sorry but you can
see you know facebook facebook on the
left messenger on the right even though
it's the same component underneath and
that's great because the facebook
components
have undergone a lot of work to make
them accessible you have we have a lot
of customization for Aria roles and for
screen readers to be able to properly
detect them and their states and we
wanted to get all that good stuff over
the messenger I want to take just a
short time to emphasize accessibility we
need more of this doesn't matter if it
looks good if you can't see it you need
to be able to use something and another
thing that's bad also focus ability but
just bad as an element is my new
favorite element the hate lets the image
tag let's go back to this example the
images here are you know the basically
shawarmas but they're each a different
image but we need to display them in a
nice grid if we would have a jagged
thing it would be horrible if we display
them one by one it would take up too
much space and use your contacts of your
conversation so we need to you know
sighs them evenly which is not always
possible with image tags if you also
want to make the images look nice and
then we have other use cases where with
your share a link will show you a
preview of what that link is and
sometimes the link will have a thumbnail
in this case yes hot-plug that's me I'm
sexy but I have a square image as my
profile although over here is displayed
in this nice wide ratio that we decided
would look best for all images there are
big enough to be displayed like this but
it's a square image being displayed as
wide but what happens if you don't have
a big enough image well we fall back to
a different more in line version we just
use the icon and we stretch it in a
different way you can't do this with
images and live a sane life so we just
obviously use background size we still
have invisible images on top so you can
still drag and drop things and we still
have links around them so you can open a
new tab right there so the accessibility
there is still there but the
presentation there well it looks like
the people who can see it's a lot nicer
and it's also something we control and
that is MIG compliant the messager
interface guide and we do everything we
can CSS to make sure to set it up and
then we close the deal in Chavez
some things you can't do in CSS like
this especially if you have a lot of
dynamic data and because we have these
polite little building blocks we can do
cool things I have interactive maps that
respect are an interface guide and
respect the Facebook interface guide on
facebook look at the look at the corners
they're all nice and rounded therefore
when the corners meet up there in the
top this is also partly interface guide
but you get this for free if you just
use our components because they're all
very small and all do just one little
thing you can have simple attachments
that just say hey here's my opinion or
you can have nice stunning-looking
images that retailers would like you to
still experience after you've left their
shop and you get notifications yes you
know you bought this belt is on its way
great and people who have built these
things that aren't on our team tell us
that they really enjoy building stuff
from messenger calm because of how easy
it is just use the small components that
we've built and the CSS is very small
but does its job very well but that's
not the best thing the best thing that
we've we feel that we've done is we were
the first secondary domain everything
you saw is basically Facebook code
running on a domain that is in facebook
and they'll never be able to take that
away from us so do try messenger calm
and let us know what you think we'll be
here all day in the facebook booth thank</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>