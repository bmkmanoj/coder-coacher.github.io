<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Mariko Kosaka: Elektroknit! - JSConf.Asia 2015 | Coder Coacher - Coaching Coders</title><meta content="Mariko Kosaka: Elektroknit! - JSConf.Asia 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Mariko Kosaka: Elektroknit! - JSConf.Asia 2015</b></h2><h5 class="post__date">2016-01-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lj4xPkrTPKs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm Mario has introduced my twitter
handle is this and that's my icon if you
know me from Twitter I read a JavaScript
at a company called scripto and I do not
do this as a job I'm a web application
engineer company called scripto I also
co-organized a meet-up in Brooklyn New
York called Brooklyn Jas and it's
interesting it's just happening as a
Thursday night right now in Brooklyn
joke so like I've been like getting a
lot of tweets it's our two year
University so it's really honor to be
here speaking about this Saturday is
gone flowering I also make textile with
JavaScript and that's what I am talking
today what do you mean by making textile
with JavaScript
well that means my weekend desk look
like this computer in the middle yarns
and my knitting machine so the title of
the talk is electro knit pixel to
textile and I'm going to explain like
how a digital photo image gets into
textile pattern - yeah
so as I mentioned I design and I get in
JavaScript so I'm going to explain a
little bit about knitting with
JavaScript part part first so here's a
little video of me operating a knitting
machine so I wrote a code know the base
code to talk to this machine from 80s
this machine was developed in 80s or
it's been made since way way before time
and in 80s they made this knitting
machine that is a electro net which is
computerized knitting machine and this
year I took on the project to figure out
how to talk to this machine from my
computer because this was an 1880s way
before Apple computer so it's designed
to talk to a special module that gets a
frumpy discuss of data and then store
that they are actually
he plugs into your your TV monitor and
then you have a controller joystick to
program the patterns into it so I wanted
to do that from my computer a lot of
people have hacked on this so I
researched a lot of code written by
other language and I thought why not
JavaScript so I started doing this and
so as I mentioned it has a computer and
I presented at a J's Kampf us in May and
it's very nice to get to talk what came
after that a disease comes Asia in
Singapore so this is run by computer but
a model will be full disk knitting
machine was operated by punch guard much
like how all the computers were operated
by punch guard so right after I figure
out how to operate this machine I got
really interested in punch card
mechanism and I kind of like prototype
my own punch coil computer and program
that with johnny-five which is a Java
JavaScript robotics framework so what it
does is it takes the punch card it's a
huge punch card I designed it takes it
if there's a hole it won't push the pin
if there isn't the hole then it push the
pin and that gets the input of it and
this is kind of a little mock-up of a
web application that is designing the
textile by punch card input so this
whole thing about doing JavaScript and
knitting came when I actually was
studying JavaScript and to be able to
code I was another way before I became
engineer and I noticed that when I was
learning JavaScript I I noticed that the
JavaScript is really like knitting or
coding is like knitting knitting atomic
unique for knitting is two stitches much
like computer is ones and zeros it's
knit stitch and purl stitch
and it creates a very different face of
the fabric and the combination of those
creates a calf of your sweater or
neckline or like a lab rat pattern in
there the code
or pattern for knitting the instruction
to knit certain sweaters or scarf comes
in the form of code so that means you
can knit in JavaScript so first line of
this instruction it's Co 5 meaning cast
on 5 start a width of 5 which it's like
creating a new array of length 5 and
next one K 5 meaning like put 5 knit
stitches into that array M 1 is make 1
so now you're expanding the size of the
array which is like operating a scarf
dot price method and there's much more
clear loop indication in knitting code
or pattern knit until 2 stitches
remaining meaning much like wild loop
until there is a count of 2 just append
knit stitches into the array so now if
you can switch to this machine basically
this machine knit way faster than your
hand can knit it's doing the same thing
it's appending the knit stitches inside
it but it is going to do it way faster
than you can do so in stuff feed switch
to the camera yeah if not I can show the
video
can we focus the camera to the knitting
machine instead of the slides to video
maybe technical difficulties welcome
back to right Linda you're here all
right
so as you can see if you can focus on
this area this is a width of 60 array to
me and when you pull this handle it
knits a 100 fabric and to me this is
much like leading LA and not appending
into the matrix so you can see this is
creating one wall by wall needing a
little by little but if you have knit
this is way faster than you do at a
heart so can you switch to the slide so
now I figure out how to talk to this
machine put the data in and then knit
and I started knitting and I thought
instead of just taking an image it'll be
cool if I can JavaScript to make actual
image too so I started doing this nerdy
knit project first I did a cleaning a d3
visualization and exporting it as a
image and put it into the machine so
that the pattern for this scarf is
actually made by JavaScript the other
project that I did was a creating a
domain specific language for knitting so
again this is written in JavaScript web
application the raw parser is learning
made by pictures I can type and change
the pattern interactively and then you
download and then load it in the other
one I did was a one day somebody from
Travis CI tweeted that they had a API
outage and they had this beautiful
or maybe sad glass of their day
dropping down and somebody not knowing
anything about what I do
tweet it that it'll be great if I can
make a scarf out of it my friend if you
knew I do JavaScript knitting tweet it
at me saying like maybe you can make
this and I was like I totally can so I
made it and then send it to Germany
office of a travesty I so though this
thing kind of things JavaScript through
and through cleaning the image put it
into the machine is what I do a lot of I
started after I figured out how to use
this machine and how to hack on it I
started making a lot of knitwear and
then there was a lot of friction and
friction was using Photoshop just the
color image is not automatically
loadable to machine I have to do a lot
of image processing and I was using
Photoshop but I was like hey why not do
it in JavaScript right image processing
doing JavaScript if you think about
image processing you immediate to me I
immediately think oh maybe I should
learn a language see or using a
framework like open CV but I'm a kind of
developer who started making button
smooth by JavaScript I didn't go to a
computer science College I just started
making websites and then learn to code
so javascript is pretty much my choice
of language in but what I do so let's do
this in JavaScript right so the process
of making a color image into this
machine is three steps first you need to
get a lasso graphics which I will
explain what it is in a minute and then
do image processing whether you want to
change the color or invert the color do
whatever you want and then that step is
making it to one bit bitmap image which
I will explain but what it means is that
just compressing the data so that it is
representable by just two colors or even
one color color or no color because my
machine only takes two color of yarn
it is not a web-safe color variety of
you know yarns right so let's start the
last three graphics what does that mean
NIDA Laster graphic well the last thing
I think is best explained by a
collection of pixels so this is my movie
that I took from using a color picker
you can see the magnified version of the
texture each pixel has a color data so
you can think that the name is levy like
a pixel art the stitch cannot be bent
from point A to B by making straight
line I have to draw a line saying like
the left left up left left up so you can
think of the last two image as like a
collection of pixels information the one
that's the opposite of blaster is a
vector like what I explained you it's
like a SVG you define I want line from
point A to point B but that's not how
knitting works so you need a Laster so I
need to get a last two image right
collection of image but like what do you
mean by like getting a data out of image
like I only know like using image tag
and I've never liked Leonard a picture
pixel by pixel how do I do that well
actually you can do it as a JavaScript
engineer using canvas of html5 you
create a compass and assume that you
loaded some kind of image into this
canvas and you use a get image data
method to get a array of numbers and
this is a flat LA of numbers which start
from the top pixel corner of 1 1 X 1 Y
RGB red green and blue value and then
the alpha opacity so if you do the CSS
color in LGB a you or much familiar with
this format it's basically a flat array
of all the pixel information of that
image so now I have a data that means I
can emulate in canvas how computer
displays an image and i padded the LA so
that it's a little a lot easier to read
so you let's clear our output canvas
objects another one to have fun with it
and clear a function of draw draw
function gets
like holiness of the pixel and then
three colors to represent that pixel and
every time this function is called you
append a colored rectangle into the
canvas object so first one is blue which
is red is zero
gleen is 43 blue is 125 and opacity of
no paucity lady and then you get lighter
blue lighter blue the next one is yellow
and yellow so this is how computer
lenders image based on the pixel data
that you can get from the canvas so that
means you can manipulate or life
intercept this draw function and then
have fun with it
so let's invert the color inverting the
color is flipping the the value so
basically you get a red green and blue
value subtract it from 255 and then use
that number instead so you do that and
then get the inverted image Joe maybe
you can just increase the value of just
a blue color in that case you add in
this demo I edit the 60 and then glue
gets blue R and yellow gets less yellow
you can also grayscale an image and I
use very simple algorithm to do by
scaling gray scaling there's a many way
to do it though the way I'm doing it is
not the most accurate to the human eye
but my clay scale image what eventually
goes into this two color and fabric so I
don't need II need sophisticated I'll
going to do it so the way to do it or
the way how you do it is you get a color
RGB value you find the largest value in
those LGB repeat that four three times
and then you get grayscale the color so
now you manipulated the color let's do
something more fun like let's blur a
photo or sharpen the photo or let's find
the edge because sometimes I take a
photo of something and I only want to
represent the outline of the thing and I
load it into Photoshop and draw the line
from that object to get the thing but if
I can
do it and automatically that'll be cool
in order to do that all three of them
use the same method called kernel
convolution but I like to call it as a
pixel social water and it really is a
friendship between pixels so you get an
image again I'm using a gray scale
because grayscale image again only has a
one value per pax also it's easier for
demo if you want to do it in color you
just repeat it three times across
LGV again each pixel has one color on
one number you introduce this idea of
convolution and kernel but I'd like to
think it as a pixel social graph so this
the center is you you are the kernel you
give number to yourself how valuable you
are the surrounding pixels are your
friends and you also give a number to
France how valuable they are so you get
to choose like I like this like a
left-hand guy too and then later on size
three you can choose your friendship
right it's basically how much of your
friend or which corner of your friend
you let affects you more you over way
that invisible window there so let's
look at this kernel 134 and we're going
to figure out what to change right start
from the corner
you take actual value of the pixel and
then multiply by the the friendships
level that you define so in this case 1
so it stays as 159 next one is 2 so
doubled into 72 next one status 63 and
then you do that for Hall 9 pixels and
then get the total of 2061
you divide it by the total amount in
this convolution or your social graph
divide it by that and then you get 28 so
next time you lender draw image you use
28 at 128 instead of 134 you do that for
every single pixel this 190 gets 80 42
gets 54 you do that every single one and
then you can
get a image processed data so let's look
at some of the effects so the social
graph that we used in the example
creates a blur maybe it's a little
harder to see but you can see that the
photo is blurring blur function is not
only to make image fuzzy it's a way to
get a little noise so if you have a
noisy photo you can blur it and then
sharpen it again and to get the make us
goose photo next one you decide your
friends are a little more negative than
you are right your top down there five
friends or minus 1 and then the diagonal
corner so 0 that gets you a sharp edge
so you can see that before head after
the next one is edge detection so this
time you are really valuable but your
friends are not right and instead of
dividing by total sum of the number this
time you divide it by number of pixel or
the size of the matrix so this time 9
divided by 9 you get a line from the
picture may be a little hard to see it
but you can see it so doing this was
leaving slow because remember just
joining the picture is number of pixels
but then you added the computation 9
more time to calculate what this value
would be so I was like can I make this
like pattern yes you can with web
workers
what do you mean parallel with the
workers way JavaScript this thing was
ready
what web worker is magic thing and that
lives in browser that I did not know
until now it's a piece of JavaScript
that lands on the background separate it
from your browser's J's thread so you
can hands on the data into Volker Jas
and while Walker Jas is doing heavy
computation it will not block your UI
being animated
so worker from now on the few slides are
about web worker so if you know you can
just you know skip it
so you start you you make a new worker
by new worker and then get a pass to the
worker ejs the hosts JavaScript and the
Walker JavaScript talks in the method
called post message and each of them has
event code a on message and listening to
the post message fired post message have
one argument so if you want to pass many
many data like in this case I am passing
ID and data you needed to put it into
the JavaScript just so that the argument
is one worker je s can be multiplied so
that you are parallel processing in that
case hostia
starts as one but then you fire up many
work as many workers you want so in my
case i divided up my image into multiple
workers get just this area for worker
one of the data and passing it into a
workers and doing it it made it faster
however this is not a magic function for
everything the trick is you are passing
and copying a data every time you fire
up the worker so this data part data
part you're passing copying the data so
if you're doing a simple thing and
copying the data takes more than your
computation of simple simple computation
it gets actually slower than just doing
it in the single process so this is kind
of give-and-take
but if you have leaving heavy
computation work web workers makes it
faster so we covered what the last
graphic is and then how to do the image
processing on the data from last er
graphic let's talk about how to make it
into two colors so that I can represent
it into yarn you can start from color
image but in that case you needed to
make it to grayscale first the grayscale
image you may think it is black and
white photography so it's already late
already
liddie for two colors but in fact
grayscale image is a white pixel black
pistol and many shades of grey in
between so I absolutely need two colors
like this one way to do it it's
breathing in half or put the threshold
somewhere and anything over then that
number gets white when seeing less than
that number gets black and you get image
like this this works very well if you're
dealing with logo data or graphics data
not a photography
sadly you can see the definition of the
lion male on gets you know washed away
in order to preserve that like what
newspaper does you need to do things
called dithering this ring start again
with image data that you get from
greyscale image well each pixel gets one
number you apply a noise matrix or
detering matrix and over where you
compare the under pixel and then the
overlaid pixel value if it's lower the
the image input is lower than the desert
matrix it gets white if it's over then
it gets black and you can we present
that in 1 and 0 1 bit image so the
output of that would look like this so
you may think this is grey from fallback
but this is actually represented in just
white and black pixels and that way I
can use two yarns to the present this
image so once I figure that out I was
like okay I can make I can automate my
process to create an image for this
knitting machine I can save that data in
some kind of JSON or something because
up until now it is just an array of
information right I'm just using that a
layer of information to lender on my
screen not as an image can i download
that as an image file because it's a lot
easier and portable to keep track of it
should be able to do that right because
we download image from web all the time
so my thinking was that okay I know the
the type of well the the what do you
call it
the type of the the la that the canvas
object takes so let's create that I have
one zero one zero but then converted
into 255 255 255 Pasadena 255 pixel and
then 0 0 0 255 pixel create a new canvas
object put that data into canvas and
then once it's in canvas you can use to
data URL to get a base64 representation
of that image and then you can just put
it into your L and then download the
image however this did not work
specifically dispar did not work and
this part what's the problem it was not
just updating the data and I was looking
at this inspector and why is it not
doing this because it's la because I
assumed that it's la because it came
back in you know square bracket looking
closely into it this was something code
you need a clumped array and I was like
what is that what is that I mean I have
never seen this thing in my inspector
before I mean granted I was in the game
developer I wasn't dealing there's a lot
of compass at all but like what this
thing is called typed array and first of
all typed it's JavaScript it's not typed
what do you mean type well let's talk
about JavaScript
all right first so they can overlay
there's a magical saying that takes any
type of information put it into one
collection right so you can clear la you
put you specify index and put the one or
push two or you can push the object or
string and then the output of it looks
like this the JavaScript la to me is
like a baking tray that you put in and
then it takes like anything any shape
any size if you want to bake a chicken
right next to a snow summer law you can
also do that too so it's like very very
useful thing but it needs to expect a
lot of possibility when it's doing the
computation the time delay to me is a
muffin tin
it is very specifically designed and
very specific size to hold specific
thing weight it can be muffin tin it can
be donut mold it can be I don't know but
you know the the factory makes it
specific product or specific shape in
size so that's type terrain so type
array the size and shape is defined in
this part so you need a meaning a bit of
unsigned integer so that means you put
anything you put has to be a bit
unsigned integer if you put more than 8
bit so a bit is 0 to 255 if you put more
than 255 then it will just hold over fro
from that if you put anything that is
not integer like string it will just not
put it in there for you it just stays as
0 and if you put a number that's within
then it will just keep that number so
here is a list of typed array and what I
specifically need it was you need a
clumped array 8-bit unsigned integer
parenthesis crumped no explanation what
does that mean so I did a little bit of
search and clumped means is that any all
the rights from the machine just cut it
off it has to be exactly the same size
within this defined range so you need
eight again so 0 to 255 anything more
than that
it's get 255 anything less than that
gets 0 so if you assign 280
then naked 255 and if you assign minus
30
it gets zero this does good thing when
computer is only expecting one thing and
doesn't have to think about many other
possibility the computation gets faster
and that's part of the web browser that
enabling a lot of games and things that
we feel like it's native so I modify my
code one thing is that the type
doesn't have same method as the legal
array so you can't do the push so i
specifically define the index and then
assign the value from my base array and
I was able to download it so at the end
of this exercise or journey that I was
doing I was like surprisingly I just
wanted to knit but then I learned a lot
about web by just knitting and I really
recommend doing that all the things I
was a web developer I was in the
hardware hacker I just wanted to do fun
project with JavaScript and I learn how
to talk to machines I learned how to
what the clumped array is around what
live poker is and like from now on
whenever I see opportunity in my web
application coding I totally gonna use
the web worker and clump dice right so
my like my suggestion is that like if
you think and you think that you like
and possibly compute it by computer you
should try it and I promise you that you
will learn something new that you can
use in daily life so here's a few
resources of my project so right now the
loading the data into machine and
creating images to separate project but
I'm creating a one application so that
on the UI just you click on it and then
load it into machine so that code will
be up on the repo I specifically like to
think it's like Lieberman and go for
poetic computation if you let me sit in
there pixel class um that's where I
learned a lot of image processing so
thank you that's my twitter handle if
you have any question please tweet at me
or DM me and I have a feedback form on
where bitly slash chicks alternate if
you like the talk or didn't like the
talk I would love your feedback thank
you so much thank you
very</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>