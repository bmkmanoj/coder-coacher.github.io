<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Alexander Pinnecke: Automate Everything - JSUnconf 2016 | Coder Coacher - Coaching Coders</title><meta content="Alexander Pinnecke: Automate Everything - JSUnconf 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Alexander Pinnecke: Automate Everything - JSUnconf 2016</b></h2><h5 class="post__date">2016-06-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MlrY3qcMkHE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah welcome everybody my name is Alex
I'm going to get the talk
odd from get up to production a few
learnings I did implementing an old
deployment process our concepts my
slides are on github under this domain
not very interesting okay who's the one
in front I'm Alex working at adventure
so you know in him work is very small
company I'm front and software engineer
and I'm carrying about everything
regarding to develop our automation and
operations Oh from originally yeah I
love music and play drums okay almost
two months ago very not far away i
started at adventure as frontal engineer
the first day i had looked at as
followed well i had a project and i did
some small changes committed it pushed
it to get up then okay i wanted to apply
to staging yeah hey guys which button
arrived to press i see is more a few
smiling face maybe a few of you can
imagine yeah even better there's nobody
but haha as this etching to the
surrogate pool yeah cool and I was like
sorry wrong direction you all you all
know it seriously it's 2016 one does not
deploy a very good call so I said okay
we need to change that seriously Kenneth
BAE okay to give you a little bit of
background as i'm doing mainly front and
I give you the
project / he would kind of repositories
we have first and variant important we
have documentation repositories yeah we
have also front and projects the regular
one we did too for customers and for
internal purposes and for our own
startups plus we have front and
libraries where are all these project
depend on and obviously we have taken
repositories back since this isn't
JavaScript's so I keep them away sorry
okay requirement what do we want to have
from this from this deployment circuit
yeah after pushing to get up to the
branch develop as we follow the kids get
flow convenience we want to have the
deployment running on the CI server we
want to have the tests executed
obviously we want to have bumped the
next semantic version to our package
Jason as we are only following it flow
but also following the semantic version
release cycle I will have a deeper look
into that later plus we want to build an
automatic change lock from the last
symmetric version we did till now to the
latest release the next yeah fancy
buzzword we want to build docker
containers yeah everybody likes docker
containers or having haven't even heard
about it we want to push this sucker
container into our repository we use
scuba netas as deployment know as an
serving framework for the docker
containers as an infrastructure we want
to push the flag because we are fancy we
want to have a slack party here
we have them at Donnie deployment yeah
good stuff plus we want to have the
sides SSH protected this isn't exactly a
requirement of the deployment workflow
but for the whole infrastructure setup
so i added it to the list next what we
what we have as as tooling set a coffee
ously we have get up so we done don't
need to change that we have Circle C I
that was one of the first decisions I
contributed in the new company as we are
very deciding to use Travis CI or a
circle TI and I said I've got some very
good very good experiences with soccer
see I regarding speed and extensibility
and the possibility to to script things
yeah so as circle has a free container
for builds for private bills we decided
to try circular and if it's not cool we
can even change to the Travis so today
we still stick with circle because it's
cool sorry we use cout benitez but not
the plane coo benitez we use google
cloud platform so we use the google
container engine to serve our stuff plus
obviously we have Tucker and I equally
asslick not infrastructure related by
the school okay the first I did because
no the other way aren't the first step I
took was creating a deployment
repository we decided to not put the
whole executions the whole command into
the circle Yama's or travis yours and
because we want to have them one reuse
all reusable and two
we change them we want them to be
applied to every circle Yama so in order
to do that we decided to create a
deployment repository where all this
deploy and Peele scripts and the circle
yeah modes we have they are are
collected there yeah soccer yeah Mets
and the deploy scripts to pushing it to
cuoco Benitez or for the old projects
SSH into the server and to agra pool and
that's good yeah of course that isn't as
easy as expected as every project so
obviously there are pitfalls first we
wanted to imagine automatically get the
commit or the bunch of comets
transitions through the gate flow
workflow but there is a problem with
that because sorry locally you would
just do a brew install good flow adh
assuming you're on Meg and this is
working pretty good but it's working
pretty good on OS X or locally it works
on my machine hat all super fancy as we
are building on ubuntu distributions on
in circle you one would assume that is
only a sudo apt-get install dash no cash
flow yes that works but you can't
execute good flow I have no idea why I
wasn't able to figure out so I had to
install it manually luckily the gate
flow AVH repository ships with an
install script but this install script
wasn't that easy to use it doesn't get
clone and from serious reasons it wasn't
able to get clone so it's a public
repository and doing that it said hey
looks like either the preparatory does
not exist or you don't have access it's
appropriate public repository what's the
matter I don't know I will show you that
one later it's it's a bit of a mess no
i'm going to show you that now does work
I have to find my manual yeah so is
everyone able to read that yeah yeah
yeah cool okay that looks pretty simple
but it took me five or to figure out
okay first we create under the home
directory they get flow directory it's
pretty obviously then we get this there
is an install script string there so we
just get this deploy script and now they
are so magic you have to export a
variable repo home to set the repository
a where L to get to work on circle so
simply get clone HTTP Calvin double
slash does not work and but with this
setup cool it works with this setup one
could easily export this environment
variable and tell 0a0 if you open a new
shell to execute this command please
pass through every environment variable
to the command bash and then you could
easily executed funny leap there is
another problem as you may see and now
I'm executing this script with set dash
e setesh e fails if one of the commands
containing contained in this file fails
but honey
this command failed every time even if
it installed correctly so yeah no words
right and having that done one can
easily install it okay let's remove it
again there's my cursor goodbye yep
storm okay that was good flow now it's
set up and the working with it was
pretty pretty nice but there is another
funny effect with get flow if you do n
brew install get cash flow on was X you
get the old version there are two
versions of kit flow one is get dash
flow and one is get dash flow dash AVH
and there is an issue with the old one
which doesn't get update for two years
now I guess when you do get flow release
finish dash mne to pass a message and
this message contains the space it flow
will fail for some serious reason I
don't know this issue was fixed and get
flow AVH so I simply decided to use that
but then I could we get got into this
issues and you can imagine yeah okay coo
benitez coo Benitez's how many of you
doesn't know coo Benitez 1 2 3 4 50 K
and Q Benitez is an very smart framework
it allows you to simply replicate
containers within replication controller
which you can then expose as a service
which makes the whole process very easy
about
show you a bit more of that later when
it gets to an example there is a problem
with that because yeah koo Benitez has a
nice feature called rolling update to
replicate no to replace the replication
controllers which does work very nice
you know just tell cubanita say please
repeat please replace this replication
controller with this new image of docker
with this new docker container image but
this this pretty nice command has a
problem which isn't contained in any
dogs it's singleton over the whole crew
benitez cluster so if you do a rolling
update for one replication controller
and during that one is running start
another one combinations will say sorry
there is already a rolling update
running if you want to do that on a CI
server with multiple projects you can
imagine that does not work so I don't
know why does I don't know okay you want
to see it in action sure and we want to
see some code obviously sure so Tim time
um as an example this is a very small
documentary documentation repository I
created about one and a half weeks ago
this gets compiled to Jekyll and we'll
get to this later and we just have
marked on files here and a bunch of
configurations so how does that work on
circle well let's give it and let's
change
uh-huh gets even bigger okay and this is
the circle yamel which tells circle what
what it has to do during a build run so
first okay we do some Tucker info that
doesn't care but then we we clone no
that doesn't fit on the monitor we clone
our internal deployment repository under
deployment in the home directory then we
do a simple NPM install because there
are some and PM scripts and we use some
NPM modules which will dig into later
then we have to execute a few scripts
and as you see here we just execute
scripts in the circle llaman so there is
no no command which gets executed
because every command we execute a
certain are contained by one of these
script files so in this case we use
within the scripts file we have
documentation directory which contains
every file or build and keep write
scripts depending on documentation
repositories there is an installed eps
file there is also a google cloud or
file which just as google cloud hey i am
this user please give me access to push
the docker image and access the coup
benitez cluster and then it's just just
a built just a bit of car plus we have
here this deployment configuration on
master and develop we want to build the
docker container you want to push the
docker container into our registry and
we want to trigger the release and crew
benitez as you as I told you before
this I want to trigger the deployment
Combinator's isn't that easy currently
this is to is doing nothing and because
it was breaking the bills but we plan to
push and message into a cue from this
circle build and then have a cue
consumer working this disc you and doing
this rolling update to have them
executed in a in a sequence okay now
this this talks i'll show you pretty
quick it's just the sequence of of bash
scripts we just do we just do and Jeckle
build of this of this documentation
stuff and to a jackal headpiece compare
this this background files and build it
and not much then we just do a tucker
built from this image and push the image
into the registry and that's all for it
on circle this looks as follows that is
pretty big I guess week yeah better okay
so on circle it looks like follows um
just installed the whole bunch and
installs the whole okay one cannot read
it dependencies and install the
dependencies and authorize ice builds
the bill to the docks yes they are not
tested we execute exit here then we
built a container and this one can see
from here and at this whole stuff and
install HTTP server as as a serving
package and then we just push it into
our google container registry so but
that's it for this documentation
repository you will say no okay
it's just the commutation we want to see
some I don't know project the problems
that end of the lot to show these and
what I can show you how it works out but
also not a lot sorry okay for the
projects what we decided to use as I
mentioned before we want to get these
change locks from what we did in order
to get that working we decided to use
conventional change lock which itself
requires some commit message standards
how many of you are are aware of this
angular commit message standard not so
many you didn't expect that one angular
has a commit message standard guideline
in which does that open that's working
the commit message standard is pretty
much only okay you have a type of commit
you give them its scope and a subject
plus you can add some informations here
and these get and gets analized you have
a few types like feature or bug fix
documentation style changes refactorings
a bunch of things yep so we decided to
use this commit message Jenner as we all
were aware of it plus there are a few
very nice packages they are all
belonging to the conventional change
locative organization yep there are a
few packages which you can use like
these there is one package which does
the whole infrastructure setup called
conventional change lock and then there
are a few very important packages for us
there is this conventional recommended
bump this is the package analyzing the
git commit history and telling you a you
need to you need to do a major bump you
can use then zemer to say ok my current
releases this one and I get a major bump
and temporal and tells you ok you have
to do in one dot one dot 0 for example
plus having that set you have this
conventional change lock COI which
generates from the dip from the last
from the previous get tech to the
current get tech and generates a very
nice change lock from that we also use
comet ISM that isn't plug-in or in non
module which you lose locally to have
your git commit messages standardized so
it gives you a form which type one I do
you wanna to commit orange which scope
to UF and stuff like that and then
generates the commit message for you
pretty nice ok unfortunately this whole
setup isn't done yet for production
because I'm I'm there only two months
and it wasn't enough time to get
everybody set up unfortunately but we
have all this this process for
committing and i'm building the npm
release and going through the gits flow
workflow we have our everything belongs
let's working for the documentation
repos and for the libraries so when a
library is is merged when the puerto
rico's on the library is merged and then
we we go through the sole workflow and
open
get flow release and commit the next
bump and commit to change lock and
finish the release push it back to
github and then the NPM release is done
plus a change as notices pushed to to
snag and but you can do a lot of things
more you can do what I tell you earlier
I'm able to queue to get this whole crew
benitez rolling update on either using
cube CDs CTL which is the CLI are using
the communities API which does the same
plus we are planning on using on doing a
netting monitoring one using google
container engine there are a few options
you can choose one is google cloud
monitoring which has some pretty pretty
nice statistics but unfortunately Google
monitoring google cloud monitoring
collects all the data data but you
cannot create statistics from all of
those there are only a bunch of lock
types which you can aggregate and do an
address that is this going to create a
statistic from that so we just decided
okay there is a nice dashboard framework
of their Jets just use it so we're going
to use we gonna build those webs for our
circle status and all sort them and
gonna build some zips for KU bonitos
replication status because Q Benitez
itself and provides a very clean API to
get information about every everything
you have running in your cluster so you
get Larry variables output and you can
use this to to create some informational
dashboards for it yeah we want to build
status overview for our projects like
you know from Travis are circular gets
up where you can see okay this project
is this version and
the last build on circle was green and
it's the last version there and
production is this and on staging is
that version and communities is green
for it there are four pots running with
this application where you can also
create projects and trigger deployments
by hand if one failed and that's pretty
much all from now I guess I missed a few
steps or I left a few steps out because
either I'm was enabled to fill them or I
wasn't allowed to show them you can do
pretty much with the soul npm and
conventional changelog stuff on honest
on a CI server and if you invest in a
few mount of time you can automate the
whole process so that one of your
developers doesn't need to do anything
by hand and this is this is pretty a
pretty strong feature because automatics
things are tested often and there are
less best false false afflicted so for
us it worked out pretty clear and it's
running pretty pretty good since now um
so I hope we can open source a few of
these scripts and a few of these
projects we are building like this
rolling update q and and we hopefully
will write a few blog posts with this
learnings with hey how to install good
flow AVH or how to do this and how do
that and yeah then thanks everybody
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>