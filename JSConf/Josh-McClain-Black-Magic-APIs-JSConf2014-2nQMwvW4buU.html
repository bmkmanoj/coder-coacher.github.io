<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Josh McClain: Black Magic APIs [JSConf2014] | Coder Coacher - Coaching Coders</title><meta content="Josh McClain: Black Magic APIs [JSConf2014] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Josh McClain: Black Magic APIs [JSConf2014]</b></h2><h5 class="post__date">2014-07-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2nQMwvW4buU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is just side note everybody's
curious i'm using the module picture
tube by a sub stack and like most sub
stack modules it's not been updated in
three years but seems to work okay you
just feed it a ping image and then it
spits out the ansi color codes for it so
so yeah my talk is called black magic
api's I am Josh McLain that's my email
pretty small down there at the bottom
and my github URL it's just github com /
Patchett I go by Patchett most places
online yeah so I work at this company
it's pretty fun my talk today involves
this gentleman here you probably
recognize him mrs. Roy Roy fielding he's
a very smart guys the author rest for
those of you not in the know rest is a
set of API design constraints that kind
of sits on top of HTTP and it dictates
the kind of relationships that we should
aspire to hold to hold our resources
accountable for maintaining between each
other so if i had like URL slash dogs
you can make reasonable expectations
about the kind of resources that exist
as descendants of a dog like maybe a dog
has an owner and that would be dog / dog
ID / owner conceivably and it just makes
it
almost empirical hat and navigate
between related resources and that's
cool so those obviously there's a lot
more that goes into rest and just that
I'm going kind of at a high level today
so if you are not familiar with rust or
if you're only curse we're so really
familiar with it you want to use it for
your own api's I highly recommend
reading Roy Fielding's thesis he's he's
not much of a humorist but it's it's
still an interesting interesting read so
a lot of people obviously a lot of
people are using rusty pies it's just
it's generally accepted in our
profession that it's a good way to style
an API and to flesh it out but I have
bad news and a lot of you that are that
are veteran conference attendees
probably have heard this already but
I'll say it again that's that most like
ninety nine percent of people that have
implemented a REST API hadn't
implemented a truly restful api there's
one particular implementation detail
that Roy fielding mentions and it is
called right so is that old programming
adage that there's two hard things in
programming cash and validation and so I
I mean in his defense Roy fielding big
get cash and validation right so anyway
yeah hate or ass it's a so fun to say
very very strict academical
representation going on here he throws
all the all the articles all the
prepositions in there it could be hates
I mean think about how much easier that
would be like we know it's an
application we could drop that we could
drop the of I feel like that would read
a lot better in PB so I feel like that's
part of the reason why nobody really
even knows what this is is that the
acronym is so god-awful anyway so what
is this this is like I said it's a
specific constraint within
within rest and what it what it dictates
is that the resources that you return
should be linkable together via
hypertext and sometimes you see
hypermedia and so what does that mean
that's kind of a mouthful hypertext is
the engine of application state you
don't want to have to say that at a
party so basically what that means is
that the responses that your API returns
the body of your response or something
like earlier I said if I have dogs / 123
that should not only should that return
information about that dog like maybe
it's got its further color maybe it's
got its breed stuff like that it should
also return links like URLs to related
resources like I said maybe that dogs
got an owner dog / 123 / owner and if
we're just coming to this API without
having the documentation manual sitting
on our hotel coffee table next to us we
might not necessarily ever figure out
that that dog has an owner that we can
learn more about so this basically just
dictates hey have some representation of
the related models within the resources
that you pipe down so that people can
without having a document like having
the documentation for it be able to
navigate related resources I think
that's pretty cool um so I wrote a
couple libraries once for humans and and
basically so there's this I think
there's an accepted and accepted well
I'll just say it's like the prevailing
opinion among people that right recipe
guys that doing hey
is not really worth it I mean you have
to there's obviously there's an
additional payload size for like
flushing out all these links and maybe
have a lot of them and then you have the
computational overhead of adding these
to every resource that you pipe down and
we see I mean what are we going to do
which they're going to it's more work to
write an API around resources that we
don't have any concrete grasp over ahead
of time than it is just hard code these
things in our code base so most people
just like just thrown under the bus I
hate that thing and so that's that's
kind of why we we don't really have a
lot of love for in our in our prevailing
REST API frameworks and stuff so I did
write an API framework that that kind of
tries to adhere to the specific
constraint and it's called sorcerer kind
of keeping with the black magic name
it's available my github if you want to
look at it right now you don't have to
you don't ever have to look at it and I
also wrote something for robots or for
humans that right robots like many of us
have done and that's the subservient Lee
named acolyte and that lives also at my
github URL and so what do I mean when I
say that's for robots or for humans
writing robots so like I was saying most
people that are running rest api is
there they're not going to go to the
work and being like well i'm going to
implement this state machine and this is
like auto-discovery bought in our
company's production code base so
there's just hard code those stuff but I
was like you know it would be actually
pretty cool if I could just have a very
easy way of specifying what kind of what
the ballpark fuzzy relationship that I
want fleshed out almost declaratively
and then have the library take care of
doing all the traversals of resources
that come back down the pipe later on so
that's kind of what goes on I use
promises a lot
just my code in general and definitely
in this and so the general idea is that
you you say hey I want dogs you know
let's see if this whatever you whatever
posts I'm connected to you let's see if
they have something for dogs and if they
do then let's see if I can create a new
dog and if I can create a new dog then
let's create a new dog and let's go
ahead and give that dog and owner and so
you kind of flesh out these
relationships or operations that you
want to do against the API and very
broad terms and then the acolyte library
is responsible for talking with the
actual API hopefully getting some hey
response compliant stuff back so that it
can traverse these relationships and do
all that stuff for you and give you back
something pretty at the end so you're
probably wondering why I have this kooky
antsy art thing going on here I wrote a
little example for demonstrating these
two libraries and it uses I thought to
keep with the node comp theme I would do
some stuff with helicopters and little
landing things and automation and I
think that would be cool so I'm trying
to pull that up hopefully nothing breaks
probably will I was working on it about
30 minutes ago let's see where and why
somebody from work wants me
oh yeah okay so I have this little
server here and what it does is it's
going to start a bunch of different HTTP
processes and all those HTTP processes
are running their own little sorcerer
instance I mentioned that there's a that
sorcerer API a little library that I
wrote and they have information on these
landing platforms that I am putting out
in this digital can't say digital ocean
anymore in this this pixelated ocean
that I made and I'm going to show you
that a minute and basically they each
have their listening on a certain port
they each have x and y coordinates and
I'm going to try and be able to fly a
little helicopter and ask one of them
for permission to land on them without
knowing anything about what their API is
shape or the topology of their IP eyes
looks like in advance so I'm going to
start the server to do that and you see
that spawn 10 I think yeah off by one
airs would be the other hard thing in
programming so I hope I didn't mess that
up attended separate instances in there
listening just on the ease of sending
ports so now I should hopefully be able
to open that up let's end this folder
this is all my get up as well and it's
just in Patchett / black dash magic dash
api's if you want to like have all the
talk coves not slides really so let's
see I have this manual demo let's see if
this works cool so I have a little note
copter here presumably as a jlo go on it
that's cool so I'm going to try and use
i'm going to fly this thing this way
conceivably all the landing platforms
are that way i'm going to try and fly it
that way and then if i see a lady
platform i'm going to try and interact
with it and get it to let me land on it
so let's see you can't really see it
very well but you can see my x and y
coordinates up here
she doesn't really look like I'm moving
but you have to just take my word for it
that we are fly oh look there's one okay
so here's the landing platform let's get
a cool right for anybody that's a big
video game geek and I am if anybody is a
big Atari geek I am this is actually a
spreadsheet that I ripped rather rather
unofficially from a game called sky
striker for Atari ST it's a flight
simulator they have these little things
it's actually one of the most fun games
ever so if anybody has an Atari ST
definitely should go on ebay and try and
get a copy of skies drinker anyway so I
see this little any platform here that's
cool I see kind of its kind of receive
it it has what Portland like what
localhost and what port it's listening
in so it's listening on 3006 that's cool
so if I click on it it's actually going
to open up the API for that that's
another feature of obviously this is not
jason another feature of rest that a lot
of people tend to neglect is content
type negotiation so really you should be
able to serve back content in whatever
format the the client wants and then
there's obviously you're not going to
always be able to do that like I didn't
take the time to write a something to
convert the stacks ml but I did write
something to converge a sin to HTML
which is what enables me to look at this
so that's pretty cool and if that's like
another takeaway that of things that you
should probably do any rest api is this
is another thing also version like side
note versioning don't put that into our
i put it in the accepts like india the
content type that you specify it's much
easier okay so anyway we see the
representation of the api for the
specific landing platform that's that
guy so we're going to try and see what's
going on with this guy again I don't
have any preconceptions about what ap is
this thing exposes
um but we can see that make it a little
bigger there's looks like there's a way
to get the position of this thing
negative 3822 rotas worth that's pretty
cool I'll look there's something called
landing requests that sounds topical
requests the land on this particular
boat I think I could use that and it
shows me what methods i can do so i can
post to it and actually create a landing
requests conceivably so i guess that's
what i would do if i were to land it
even shows me what parameters that
expects in order for me to to submit to
that so that's pretty cool so i think
based on this I know how to interact
with this thing I know how to get to let
me land on it but you know what this is
not really very interesting aircraft
carrier let's keep going and see if we
can find a cooler one I hope I don't
though randomly like where they spawn is
the randomly assigned so sometimes it's
like okay we didn't have to wait too
long oh well we could say it's a
cavalcade here boat party okay let's see
what's going on with this guy oh look
this one's got a menu that's awesome
I've been flying in this helicopter for
a long time in kind of hungry yeah let's
look at the menu okay so we've got some
lovely JavaScript related foods here
Remi salty shims that's that's cool got
Cowboys immediately invoked fries I made
all these names last night at like three
in the morning so I apologize original
at my burger hmm st BLT happy patty melt
the v8 shake is that everything oh well
yeah i think i'm going to get this I
mean it's fast food you know I am in a
helicopter so let's see if how out I how
would I create an order here ok so
there's orders and I can post to it what
does it expect it expects an array rave
IDs for the items that won't work ok
let's figure out what I want
I want number one wow I'm going to go to
want the BLT for and I'll get the v8
shake just because I feel bad for those
guys to 16 that's pretty easy to
remember oh cool so I think I should be
able to post two orders right let's see
I'd be my curl food is so bad faking
oops one two four six I hope this is
right and it was a thousand two thousand
four loko host 2004 / orders i right
maybe not
I stopped my surgery today I don't think
said I think it would've given me a
message back maybe I did oh no um anyway
let's pretend that worked um okay so
let's try and do something I mean yeah
we didn't get food let's try and
actually land this sucker so landing
requests looks like it takes a post body
and it spikes weight length and time I
don't really know any of those things
but i guess i'll just make them up how
long in hours your carefully laying to
hear it's funny when you can't even
really remember that own API like that's
maybe that's an argument for he is the
fact that i can't remember my own API
okay so what I don't know it should just
already like automatically assume that
because I didn't I wasn't very smart
about you even though I really you guys
about content types after what now I
don't think so i think i can get in
first it by data like if you if you pre
fix it with data but you might be right
dash p I'll try it um okay so anyway
we're going to do landing requests right
and oops no that's not right type that
we need a weight to whatever lengths to
time green beer not very long one day
okay and cool and now we don't want to
post it orders anymore we want to post
at any requests oops
and it's a looks like an express area
okay I've never seen that error before
it's good timing all right one second
all right I'd bury that none sir see I
used to leave it right yeah they're also
really that's weird maybe it's in this
thing
oh yeah okay thank you um that's exactly
what happened ok anyway in the interest
of time let's assume that my landing
request worked and then we can just kind
of like who and yeah so okay so that's
doing it manually kind of interacting
with the API manually posts
notwithstanding so I'm going to do next
is close that I'm going to open a
version of the same thing except now i'm
going to have a bot drive it and
hopefully the bot has a better time
actually interacting with with my own
API than I did that's what we write lots
for anyway okay let's try and make sure
that I killed us cool and i'm going to
start the server backup nope okay so
they're all back up and i'm going to
open this alternate version called
automatic and their index 2.html sweet
okay so it's kind of looking a little
too fast i don't know if i'm going to be
able to narrate it it's trying to find
information about that thing there and
it says it didn't like it so it's
fetching something else and it's yeah
there goes what's he doing its starting
landing oh look wow so you're gonna have
to take my word for it but it would not
have done that is that post request that
I was unable to make Holly because micro
food is terrible it would not have been
able to land there if the landing
platform hadn't said it was okay so yeah
so if you want to check it out there's a
very simple declarative way of writing
logic for these BOTS so
in broad strokes I am and this is kind
of where it gets into using black magic
api's so we all know hopefully we all
know that there are a bunch of es6
features that are coming out and
Dominick's working really hard on that
and that's cool one of the es6 features
that I think should be killed on sight
is proxies I think that they're terrible
terrible things I've had many a drunken
argument people where I tell them that I
will never like them if they use that
and so i use it for this and and so what
it does is I yeah so I'm a sucker for
declared simple you know silly
programming of the simplest kind so I
like to be able to do things like few
Bart bass and obviously this is no way
to interact with an asynchronous API
somewhere you're running something
because these are just property accesses
they all happen synchronously there's no
way to do that aha except if you're
doing something where you're defining a
getter that returns functions
transparently for these things so let's
say that instead of foo bar baz let's
say that I had my my acolyte library and
then I talked to listening to your to
connect to you 20 50 whatever and then I
can do things like it's like a light
let's say that we have some collection
dogs that we just assume is there then
we want find dog with ID too baby and
maybe we assume that that dog has an
owner and then we can do owner dot I
don't know University maybe they
graduated
and then at the end of it when we're
done doing terrible terrible things to
javascript we rely on the fact that all
these things are kind of transparent
functor transparent promises so they all
have been properties and I could attach
a bin bin at any point in this chain and
get that result out for that step and
then I can and that would conceivably
give me the information about that the
dog number two's owners University and
yeah and so like I said it uses object
onto fine I'm sorry it uses proxies to
set up a like a get trap on properties
for each of these objects and succession
so it says okay somebody requested dogs
they tried to read this property dogs I
don't have it but instead of throwing a
read error or something I'm going to
give them this promisee type thing back
that is it's it's itself a proxy and in
the background i'm going to try and make
this API request or a resource at that
matches dogs and I'll first I'll fetch
the just the route link and then i'll
look if there's anything related to dogs
and then I'll give them that it back if
I can find it and so kind does that it
drills down through the list of stuff
and yeah and so that's I'm kind of
rushing for time but that's what i did
in broad strokes if you're more
interested in this kind of stuff then
you should be then come talk to me about
it yeah I think that's about all the
time I have maybe like one minute left
maybe night neither that but if anybody
has any questions you know
well thank you guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>