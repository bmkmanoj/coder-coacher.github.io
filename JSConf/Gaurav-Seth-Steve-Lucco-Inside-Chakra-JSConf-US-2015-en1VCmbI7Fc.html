<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Gaurav Seth &amp; Steve Lucco - Inside Chakra - JSConf US 2015 | Coder Coacher - Coaching Coders</title><meta content="Gaurav Seth &amp; Steve Lucco - Inside Chakra - JSConf US 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Gaurav Seth &amp; Steve Lucco - Inside Chakra - JSConf US 2015</b></h2><h5 class="post__date">2016-01-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/en1VCmbI7Fc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I really appreciated
so javascript is the most popular
programming language in the world today
right and you're some of the most
important people in this community
influential sitting right here you know
today in my talk I have three things to
talk about I will talk a little bit
about the journey of chakra so far I'll
talk about something that's really
exciting for us and hope you will find
it exciting as well and last I'll kind
of talk about the road ahead so you know
those are the three things I'm going to
go through in the talk today so back in
2008 was when we decided to invest in a
new JavaScript engine grounds up you
know at that point in time the biggest
context for applications in which
JavaScript engines used to ship were
browsers and we shipped chakra first in
ie9 back in 2008 between then and now I
you know chakra has made a very good
progress and now with Microsoft edge you
know we are leading we've evolved chakra
we've optimized it to really run the
modern web payloads you know very very
efficiently and fast in terms of you
know what chakra contains it has a
unique architecture from the very
beginning it starts with an interpreter
you know for faster paid start ups and
you know the interpreter also helps port
the engine across architectures and
across operating systems and then on the
background thread it utilizes the power
of the machine to have you know a
multi-threaded multi-phased
JIT compiler for extremely good
throughput and it's comprised of a
concurrent you know traditional marking
sweep garbage collector which can do
partial and time-based collections so
that really helps things you know state
height and be optimized but over the
years right between 2000 and now
JavaScript has gone way beyond the
browser landscape today javascript
powers a lot of server applications
cloud services where the compute power
or the computer sources available to
those applications are really flexible
right they could be you know huge - you
know going to the Internet of Things
where the computer resources are really
really tiny during this time we've also
optimized chakra and evolved chakra to
power a bunch of these kind of scenarios
outside of the browser today
chakra powers you know all Universal
windows apps across a whole range of
hardware profiles where Windows 10 is
supported chakra powered services such
as a short DB which is a no sequel
database katana
outlook.com and last but not the least
we brought you know the power of node to
Windows 10 IOT by making node work with
chakra during the Windows 10 timeframe
so we have all of this stuff going on
now when we started on chakra back in
2008 we really had a goal about you know
making sure that as a team we really
start pushing the boundaries of
interoperable language landscape you
know to make sure that developers such
as you can actually build great apps
right and what does it take right to get
there because the whole goal is like the
platform needs to have those
capabilities in an interoperable way so
that we don't repeat any of the old
stories so today you know chakra has the
highest support for ECMO script six
there's the chart on the left side of
the screen where you can see like you
know where chakra is but it's not only
es6 you know we've already already
started supporting a bunch of you know
evolving or proposals for future
versions of ECMO syrup like async
functions etc but in terms of pushing
Interop you know it's not only about
implementing those features right as a
team you know we've been active members
of Ahmed tc39 that's the committee where
you know Java Script evolves and right
now you know we we are not only having
we are not only championing a bunch of
features in there but you know the
editor for Echo script 2016 is from
Microsoft we've been the editors of test
262 since the very beginning in case
you're not aware test 262 is the test
the official test suite from equi that
helps you know JavaScript engines and
JavaScript implementations remain
interoperable so that's the
certification you know tool that we use
to make sure that it is certified so you
know that that's great like that's
that's one of the other contributions
you're making but you know just saying
that leading leading in language
implementation has its own pros and cons
if you if I kind of talk about it from
an injury
in perspective right it has its own
challenges sometimes we get ahead of
ourselves with the speck right
the speck changes you already you know
ask the engineers to go develop
something and then oops that speck
changes all of that work kind of goes
down but what it really helps with we
found is like it helps us find the
places where you know we can bring the
data back to the committee in a very
very timely fashion to say that hey you
know you should not be evolving this
particular feature this way because this
is the impact on the web so you know
let's have this feature implemented in
the other way so getting that timely
feedback timely data back to the
committee as we are evolving is a very
big thing and here are a couple of
examples I'm not going to go into the
details of them I think there were a
couple of things that you know when we
were evolving es6 we found hey there was
a particular thing that broke her
version of mootools and there was a
particular thing that broke Oberon off
you know Zepto now all of these things
with the latest versions the frameworks
keep evolving and keep fixing but people
take dependencies on old frameworks and
old versions of those frameworks which
kind of breaks the web and we have to as
a community as a you know member of the
committee make sure that the entire web
continues to run or the impact is
minimal over the last you know year or
so we started doing a bunch of
partnerships to bring new things to
chakra you know to work with partners
one of the first things there that I'm
going to talk about is as in Jas I hope
how many of you know what Adam Jas is
awesome so yes it's a pure superset of
you know JavaScript you basically take C
C++ code transpile it down to you know
JavaScript and the best benefit of Azzam
J's is the predictable performance it's
all ahead of time compile you can run it
in the browser at almost near native
performances and the big thing here is
that we brought this technology to
chakra into Microsoft edge in
partnership with Mozilla and this is
again a new thing you know you would not
expect me to come up here and talk about
it but you know we partnered with them
we kind of loved the technology and I
think we could really expand that
technology to a lot more scenarios and
we are internally actually working on
some of these stuff you know to talk
about or bring the power of as MJS to
the web platform ourselves so we
recently announced that
Azzam jess is now available by default
in Microsoft edge so it's on by default
and when we announced that recently with
the November update we also kind of
published a demo so you can hit that you
know the tiny URL as some GS chess and
go play with it and you can see there's
a chess engine running with as MJS code
and non as MGS cause it's the exact same
code from which we transpile and you can
see the differences in the same vein you
know we've been partnering with Intel to
bring sim D to JavaScript to all of you
guys all so no sim D like I know for
Adam she has a lot of hands went up okay
not not much so sim D essentially stands
for single instruction multiple data
it's one of the proposals for ECMO
script 2016 and what it does is exploits
data parallelism using Hardware cap
capabilities so imagine this is
JavaScript
you know exploiting the full potential
of the hardware to accelerate the
performance to take an example you know
what simply provides assume that you
have two vectors you know each of them
has four elements and you were to add
those two vectors in general you know
the typical JavaScript world you know
there will be four add operations that
will happen but if it's MD you know
simply looks at those two vectors and
just with one operation it can add those
two vectors together there are a lot of
you know hardware devices out there and
processors out there that already
supports simply instruction sets so you
know given that you guys have not seen
it let me actually move back to a demo
and show you a demo of assembly in
action and how you know sembly is
helpful and kind of is brings
performance to the next level so here I
have what I have here is it's a it's a
demo you know it'll try to go towards
let's see if I can
you know I'm gonna start playing this
and right now somebody is off so you
know it starts with about sixty frames
per second which can you can see at the
top right corner and then the goal is it
will try to keep you know getting these
jumping birds into the demo as things
proceed so now when I'm going to enable
simply you know notice the jump in the
frames per second and the number of
birds that are in there so right now you
know again it is you know we try to
stabilize this demo at about thirty and
if I switch sim Dion and the other thing
you should notice is the number of birds
that are flying around if I do simply
off it jumped from thirty to about
twenty-one and look at the number of
birds that are in there it's gone down
to four fifty four so this really tells
that you know there was extra hardware
capabilities on my machine that were not
being utilized and Cindy is bringing or
lighting up those hardware capabilities
but that's all great you know I'm you
know excited about the advancement that
the team is making etc but the reason
I'm here really is not to kind of only
tell you about the story of you know how
we brought chakra here it's really to
tell you about you know the next step in
our journey
you know you might ask why now why I
hear there I think three big reasons
that I would say I mean Jaya stomp is a
premier event you know with great
community support the next big thing is
that it's a lot of awesome things have
been announced urges conf including
things like note itself and third but
not you know the least is this is last
call it is special and that's why we
wanted to come here and talk about you
know our journey ahead so I think our
you go already
okay
so I am very very happy to announce
today the chakra is going open source
you know over the years we've started
partnering with a lot of people a lot of
partners to do a bunch of things to
either bring new features to JavaScript
to innovate on top of a technology that
we have built or you know even like give
us feedback from the you know
relationships we have with them I think
it's a great opportunity to open it up
and have a much more intimate
relationship with all the developers you
know of the community and all of you
guys and see what you guys build with
this so the sources for chakra core
which is the core of the chakra engine
would be available for the holidays in
the month of January they will be
available at github under an MIT license
we would be accepting contributions for
the community so when these sources are
available I would really you know urge
you guys to go browse these sources you
know submit pull requests help us find
issues you know embed the technology in
your apps and innovate on top of it you
might
check check one two
all right so you know what is chakra
cool right chakra core is a fully
functional JavaScript virtual machine
you know it has the exact same
characteristics and capabilities as
chakra except for two key differences
difference number one is that chakra
core does not have bindings exposed to
the browser and the you know Universal
Windows platform both of those are very
scenario specific very platform specific
those are the two things that are not
available the second thing is instead of
using the old Khan diagnostic api's or
the debugging API is that we currently
have in chakra chakra core is gonna have
these new modern diagnostic api's or
modern debugging api's and the reason we
are doing this is we want to make sure
that even from a debugging perspective
you know we can make chakra core
interoperable in these debugging api is
specifically interoperable across both
tools as well as across different you
know VMs and javascript engines out
there so that's the difference so what
do you see here in terms of the
component there are two things that go
away from here but it's essentially a
fully functional you know virtual
machine that exists there with that I
actually want to show you a couple of
demos to show you the power of you know
chakra core what I have here in the
first demo I have this candy robot right
here
candy is powered by Raspberry Pi 2 it's
running Windows 10 IOT core on it and it
has no js' running with chakra core it
has 100 plus npm modules including Cylon
4 mada serial port express all running
on that machine very long way to say but
the thing that I'm trying to convey is
that job you know it's a fully featured
VM which supports you know a great set
of node modules the second demo that I'm
going to show you is going to be about
time travel debugging you know
developers typically in JavaScript only
have a way to go forward but you know we
are working on this new innovation in
very close collaboration with Microsoft
research to see how
we can really advance the state of the
art of JavaScript debugging going ahead
so let's let's hit the demos
so what I what I have here with me is
there are two controls here so let me
let me explain you the setup I have
candy sitting right here which is
controlled by this first you know
control panel here and then I have
another node server running on my
machine in a VM out here what happens is
candy has a light sensor on it as I move
candy around candy goes and you know
captures the light intensity at a given
point in time and uploads it to the the
central node server the second control
that I have here and then you know we
can go to the second server and see like
hey how the average brightness is
changing what data are you getting and
then we will go into TDD from there so
time-traveled a bugging from there so
let's see let's ensure I have
all right so Danny go forward what you
would notice is you know it kind of
moved ahead and if you look at my
control panel which is on the you know
left screen here all right for you guys
you can see that there is this light
intensity 6:21 that it uploaded try it
one more time let's see it's 6:14 and
support of course it's the same you know
light thing that is coming here let me
cover this guy a little bit and right
now what's happening is if I go look at
the average brightness right so see that
the brightness is changing every time so
that data is actually flowing to my
second server which is you know and now
you know once now that I'm done with
this let me actually go and take a look
at exploration time of like how much
time did it take me you work with Andy
so then I hit the exploration time
button I already have a breakpoint set
up in my second half you know
traditionally JavaScript is single
threaded and synchronous in nature you
know if you set breakpoints and we the
only way to do is keep going ahead with
time travel debugging there are these
two extra controls which can actually
take you said you know move back now
what I have here is a demo debugger can
you can you guys in the back see the
screen or you want me to make it a
little bigger
is this okay all right so I have a
breakpoint set up here and I will start
moving back in time in code so I'm gonna
instead of stepping forward
I'll start stepping reverse so the first
thing you'll notice is the response code
here was 200 and it moved to let me go
ahead so when we started the response
code was 200 and as I start moving back
see that the response code changed I'm
gonna go keep stepping back a few more
times so there's a switch statement it
came out of this you know switch
statement which is great because you
coming out of a control flow block there
and now here see look there's this time
stamp right there's a notion of time
stand that we took the time stamp and
keep a watch on the variable here now
look that when I kind of replay this
it'll exactly play the same timestamp to
show you that it's actually capturing
that data and replaying stuff like
calling you know new dot new date
let's give it another try I think I
messed up the control here so this is
the fun of playing with prototypes
all right
I hope I can show you so the response
core changes I'm gonna go back a couple
of more times and what you see here is
VR at that time stamp and now I'm gonna
you know go play this so the time stamp
right now is twenty sixty three one go
back come forward 20 63 so exactly same
time stamp being replayed I'll keep
stepping back but you know the
interesting thing would be like here
there was another callback that came
right I was kind of talking about the
intensity so time travel debugging also
brings you the ability to go to the
previous callback think of previous
promise etc so you know I click the
other button so I'm in the you know
handle request again and I'm gonna keep
going down you know a few more times to
see that it's actually the right thing
so I come back to the switch statement
and this time you see that I got into
the case which is talking about
brightness rather than the exploration
time and keep going ahead you know now
we are in this loop where we just
calculating the sum of the total
brightness so keep a watch on this so
the first data point we get is 80 let's
go through the loop it's it's 580 and
then you know now if I step start
stepping back it goes back to the exact
same value so that's just to show you
the power now this is very early bits
you know early innovation but we really
hope to get it you know to a much better
state to complete it and bring that
innovation to the JavaScript community
and to the developers
so with that you know I talked about I
showed you two demos the first one
running you know Windows 10 IOT with
Nord and chakracore on this machine and
the second one actually showing you some
of the innovation in terms of you know
time travel debugging which is going to
hopefully change the state of the art of
JavaScript debugging to the community
now I given that I was talking to you
know talking about node I really wanted
to bring somebody from the community
over and we asked Michael to come join
us
you know Michael's from northbound ation
he's been with the node community ever
since it was formed and I just wanted to
bring him over and ask him like hey what
does he really you know feel about the
announcement that we just made today and
some of the demos we showed so hey
everybody
yeah so when when node was first
released in 2009 at JS conf people like
just couldn't believe how fast it was
especially compared to all the other
languages were coming out at the time
and this because we we weren't starting
over from scratch with a brand-new VM
that hadn't been optimized we had a VM
in v8 and it was part of this you know
friendly competition that was happening
in the in the browser landscape where
everybody was leapfrogging each other in
terms of performance and that's how
we've gotten such fast VMS in general
and so it's really exciting to see node
now becoming a platform where multiple
VMs can continue to duke it out and
continue to leapfrog each other in terms
of performance and so the great thing
about this isn't just that you'll be
able to use chakra in node and in your
notifications but also that everybody's
gonna get a faster VM out of this as
soon as we start doing comparisons right
regardless of which one you're gonna use
they're all just gonna get faster so
this is just amazing
and know the story you know today is
looking more and more like the story of
the web we just we end up going
everywhere JavaScript ends up taking
over everything and part of taking over
everything is being on multiple VMs it's
being compiled in multiple languages
being compiled then they'll do it
sometimes because that's just what you
have to do to really get everywhere so
this is like a really really exciting
exciting announcement and also just
Microsoft is killing it with open-source
lately this is awesome like it's all the
stuff on github and like close to your
code it was amazing so just give it up
for this guy man
thanks thanks Michael so uh you know
Michael did talk about you know one
interesting thing he did talk about
performance and I know I did not cover
performance in my talk till now so let's
let's move and talk a little bit about
that before we kind of wrap up so ever
since we started working on chakra our
goal has been to enable developers to
deliver consistently delightful user
experiences across a range of form
factors right I mean it's it's a whole
spectrum and it's all about the user
experiences that you could deliver and
ever since we started chakra we really
have you know our goal has been to go
look at real world stuff you know the
stuff that you build and see how we can
extract the most juice out of you know
the stuff you build and essentially make
the VM really really go fast on that
stuff you know I talked about you know
working with some of the you know select
partners to advance the landscape of the
language itself recently with Microsoft
edge and with Windows 10 in general I
think we've started listening to
developers a lot more we've started
listening to customers a lot more in
Microsoft edge if you go there's a way
to kind of go and just send feedback so
here's one of the you know customer
feedbacks that arrived in our mailbox
one day they were like Heather's this
YouTube html5 player on a particular
gaming site that's that's behaving
slowly or that's running slowly and then
when we started looking at it we said
hey there's a pattern here that we could
identify I think there's something
happening in the JED it's kind of really
you know essentially what is happening
is there they were calling a caller
which made sure that I mean which made
the VM actually virtually unwind the
stack while we were loading the page we
took that code example we kind of ran it
through you know some of the other top
web sites and we saw that you know it
was not that it is extremely common but
it was there were still occurrences of
those kind of things you know what was
happening in the engine is when you have
JIT compilers and you have super
optimized at compilers they create
something called bailout and bailout in
or bailout info is something that
happens that you know when you're
compiling and JIT compiling JavaScript
code anything can change these JIT
compilers rely on the bailout
information to say that if any of the
assumption I made about a type goes
wrong I need to use this data so that
there is no hitch in the perceived user
functionality of the app that I'm
writing so essentially if something goes
wrong we unwind from the chit we use
this bailout data to make sure that the
execution just continues right so one of
the things we notice was in terms of the
bailout info you know that was a little
slow and we were essentially relying on
the OS api's to do the virtual unwind
but what we realized was like you know
doing calling the OS api's was actually
you know extremely rich in terms of the
data I provided but was not giving us we
didn't need all of that API information
for those unwinds so we essentially what
we ended up doing is we linked we
created rbb chains linked them up and we
use them so you know there's one part
about bailout data I think I spoke a
little bit ahead I'll come to that but
this one was really about you know this
optimization was really to find out like
hey how you were doing stack walking in
the engine and instead of relying on the
OS API which provides you much richer
much you know fuller stuff how do you
actually make it much faster so we
started using these rbp chains and the
impact of this on some of the real web
sites was you know about 40 to 50
percent better page load performance
that's huge that's huge the next thing I
think one of the things we always keep
doing is we always keep optimizing the
engine for a bunch of things startup
performance throughput scalability and
even to use the full power of the
hardware that stuff is running on so the
couple of things that we did in the last
one year we you know created a new
simple JIT here a simple jet allows it's
not fully optimizing JIT but it helps
you you know get it get from the
interpreted code through the JIT code
much faster we did multiple concurrent
choose so what it implies is before we
just had one concurrent JIT thread or
one towel JIT thread running but now
based on the processor that it is
running on you know octa-core zon phones
are not uncommon these days so there's a
lot of untapped hardware potential that
you could utilize so chakra can now go
and you know spawn multiple concurrent
rate threads and the impact of this like
if I'm just going to talk about from a
true
perspective the typescript compilers
throughput you know it's it's a
JavaScript heavy payload improved by
about 30% which is again huge and last
but not the lead like it's all about
staying lean you know those two came
directly from the browser those two you
know points I talked about but I told
you we've started optimizing for things
like Cortana Cortana needs to runs
across a variety of devices from high
profile devices to extremely low profile
devices always on always there with you
one of the things we found was you know
the memory footprint was huge or there
was one particular issue where the
memory footprint was big we took that in
for we you know again went back to the
web we found a pattern and we kind of
say sadly let's just go get that data
and this is where the bailout thing
comes which is you know what we saw was
for about 15 MB of jittered code that we
were producing the engine was producing
about 50 MB of this bailout information
right that's a lot of bailout data that
you're producing so we did work during
the last three months to make sure that
we really optimized it we compress it we
share data structures there and we were
able to compress you know the bailout
information from 50 MB to about 18 MB
that's about one third of the memory
usage that it was already using and all
of these things are applicable with
chakra core available across you know
all the hardware profile so it's great
from a user perspective but whenever we
talk about performance you know people
do come back and ask us like hey how are
you doing on benchmarks because that's
one of these things you know I'm
personally and not a huge fan of it but
all I'm gonna say here is that it's
great to see that we are also leading on
benchmarks we don't have any benchmark
of our own you know here are two key
benchmarks like there's octane from
Google and Jetstream from Apple both
from are competing you know browser
vendors in chakra today is winning on
both of them in the market so to sum it
up you know it's a it's a it's a great
journey we are on and I'm really excited
and looking forward to chakra core going
open and you know the sources becoming
available post holidays in the month of
January I think once the sources become
available some of the things that we
have on our roadmap I think one of the
first things is you know we would want
to submit a pull request back to Nord
main line with chakracore
one of the other things we want to do is
you want to keep working on those intro
interoperable debugging api's so that
you know we can even power that you want
to you know bring time travel debugging
to a more production quality so you did
CI you know ran into a hitch and that's
because you know you're solely in the
prototype but I do want to show it to
you because you know we advancing it in
a very different way so that's the next
thing and last but not the least when we
open source we will be only on Windows
but you know taking chakra core
cross-platform is one of the other goals
on the roadmap that we have that I would
say you know we have really really
committed to OSS this point in time and
you know we would love to see what you
build with the technology that we have
open-source how you know you helped
contribute I just want to say it before
I end that you know throughout the two
days we have a booth set up just outside
if you walk through the door to the wall
so if you have questions come find me
there you know we'll have we have a lot
of other folks from Microsoft edge as
well and with that you know thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>