<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Dean Landolt: Pintura, Perstore and Awesome-Oriented Persistence | Coder Coacher - Coaching Coders</title><meta content="Dean Landolt: Pintura, Perstore and Awesome-Oriented Persistence - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Dean Landolt: Pintura, Perstore and Awesome-Oriented Persistence</b></h2><h5 class="post__date">2013-01-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UC1YgUL9SrY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">and there's a query API that's really
really nice and really flexible to get
at you know lists of your data slices of
your data
that's what per store is all about so at
the lowest level actually these these
stores you don't gonna have to use per
store these stores can be shared across
different other JavaScript frameworks so
there's a lot of people working on
persistence in JavaScript so there's
like node persistence
I think it's Tim Caswell is doing that
there's there's a bunch of things going
on with node there's some stuff going on
all over the place stuff that uses the
JDBC to talk to sequel it would be great
if we could get together and actually at
the very lowest level just have an API
to that we can all reuse the same code
to talk to all these different no sequel
databases and so that's pretty much what
this API is about I'd show you some
examples that demonstrate this but it's
if anybody's familiar with the w3c
indexeddb api it's that it's it's just
that it's it's there's get and that
takes an ID and it gives you your you
know your data there's there's put you
give it an object and some directives
and it puts it you know in its store
there's you know delete same thing you
get the idea so the way per store works
there's the the models constructed with
three pieces three things that you need
to to create a model you really just you
require the store you instantiate it you
then you have VAR model equals if this
was a whiteboard that would work out
really well
but VAR ma you know my model equals and
you just give it three things you give
it an ID you give it a schema which is
it's just a JavaScript object it's it's
not like XML schema it's just JSON
schema it's really simple the empty
empty brackets like the empty object is
a valid schema that means schema Furi it
means do whatever you want there's no
constraints and then you give it the
store and so those three things
are now allow you to essentially have a
back-end storage for and whatever back
in storage you want for a given
collection like to have some models just
like an MVC it's there like a class
there's nothing it's not specifically a
class there's no you know it doesn't do
any magic with you no it doesn't require
any like you to choose a particular
class in prototype will inherit and
structure but it's like a class I mean
it's it's a place where all of the like
things gets get persisted and you can
you can talk to that that model and say
give me all of all of it and then for
each over it for instance if you're not
over HTTP that's a really helpful thing
to do or you can just ask for a very
specific query a very specific bit of a
model which is it returns a collection
it actually streams that all the way
back through the process and it returns
if by default it's going to return
application JavaScript if you're over
HTTP so I have a whole progression of
slides I was going to use here and we
did some artwork with some leaves it was
really pretty on I'll show you guys
later
but so that's per store per store is all
about just storing a very specific type
of data that's defined by a model in any
database you want we don't have all of
the stores yet we have many of the
stores there's a Mongo store there's a
almost I'm in the couch store if anybody
are you guys node users if you Felix
have you anybody seen no dirty so I was
okay so I was trying to map that as a
store and then I realized that wait a
minute we have this thing called a
memory store that it's just it just
stores everything in memory but it gives
you the same interface to get to data
and so I just wrapped that in a like so
stores compose really well because it
has this common API this it just exposes
a set of functions like that's all it
returns it's an object with a set of
functions and so I just wrapped that and
you can override any give and be hit
like all of the different behaviors that
you might need to actually make this
memory store
to write it out you know with new lines
separating every you know Jason objects
and now you have it essentially you have
no dirty except probably not quite as
fast but definitely more flexible so you
have you're able to use this common
query API that I was gonna demonstrate
this is awful let me see if I can't
bring this up yes okay so the query API
this is the this is that actually that
the coolest part of I think the most
effective thing that per store provides
is this notion of like the queries
themselves are they look an awful lot
like your standard query strings and
Chris died when he created called
resource query you still I think he's
gonna spec it and actually you know IETF
IETF it or something but what what it
does fundamentally it has two primary
terms that you can use so a query would
look like question over HTTP a query
would look like question mark you know
foo equals bar so that that's that would
be a comparison query and that would
look like a standard query string you
can do greater than less than greater
than equals you know all of that good
stuff and that's one term and then
there's another that's that's a
comparison type term there's another
term there's other type of term called a
call which is you know to do sorts for
instance the standard ways to just say
and sort open paren you know and then
you can put the actual sorts as
arguments in this this these question
are these parentheses close that and
then once you close the friends you have
this this thing that parses down as a
call so it's it's one term in this list
of terms that's your query string and
the parsed object actually really easy
to work with so it allows you to do some
fun some fun stuff too like manipulate
queries that come in so there's this
like at your model for instance or you
might want to actually override a
particular particular behavior like it's
a you know blog storm I had a whole
example that was a blog store and so you
might want to tack on a published thing
like you might want to say okay this is
a timestamp this is the author that
would you would override the put to do
that you would just it's just like
aspect-oriented programming kind of like
a round advice or in Python it would be
decorators like it's like you can met a
program you're the store functions that
actually that you expose you can wrap
them and do new things let's see what
else so but the query would look kind of
there's that's that there's there's
different terms and then they're
combined with a logic operator so either
an ampersand or a bar which is or and
you can have groups what comes out of
that what gets parsed and what you get
to use is this just a list of these
things these different terms and you can
use so I was saying you can actually use
it for effective things like so I wrote
a adaptive indexing store that you can
take say say have a sequel store it
every query that comes in I can inspect
that and say oh what fields are you
using and then if it's a field that
hasn't been indexed
I can set I can tell the sequel database
to create the index so kind of like how
in person for one pointer that's what
jason deep or j sdb did so in 2.0 i can
actually do that with sequel which makes
it kind of fun okay so there's this
other notion of the applicator assets
that those actually wrap the model
facets are they come from oh cap they
are a security mechanism they expose
this view of the model like of the
objects that exist in your database you
can only you can see just a bit of it
you get a certain set of capabilities so
a read-only facet would eliminate put
and delete and you would just have a get
that you would be able to like you just
be able to get and query the object but
they also have some other uses some of
interesting benefits
so that that's kind of that's the
general idea of per store it's on github
Chris's I slash per store it's
incredibly simple I now that I don't
have slot
I'll have to put I'll obviously get the
slides online and to actually
instantiate a store like and to use this
code it's it takes no effort like it's
really like ten lines of code and then
all of a sudden you've got a working API
to do effectively what no dirty does
except you can underneath the hood you
can swap that out for Mongo you can swap
that out for sequel evening but then you
have to define your schema obviously
because sequel is not gonna do a very
good job story just any arbitrary data
but once you do that there's there's now
no you're completely not no longer tied
to a specific database no sequel or
sequel it doesn't matter ok so on
ignoring per store like there's this
thing on top of it that's called pintura
that's where the HTTP side of things
comes in and that's the most interesting
thing to me because I don't I'm not
necessarily when I'm interacting with my
date I'm usually doing it over HTTP and
so pintura is just effectively its
documentation might as well be RFC 2616
like it I mean it's HTTP like the good
part so what the slide said but so it
does it does some of the stuff from HTTP
that you would typically most people
just ignore so it uses HTTP like all
these like edge things in HTTP in a
really effective way so content
negotiation turns out that's really
useful like if you do it right like if
you actually have a means by which to do
it
you it's so it's solved certain problems
that I didn't even I didn't know where
they're early because I'm I'm more
interested in just getting you know
Jason out of my database or or
JavaScript actually because then you can
have functions and you can share them
with the client and that's kind of nice
I didn't mention that feature but but I
mean there's just simply no way to turn
a JSON database to turn to turn the
Jason coming out of your database into
an atom feed just you can't do that on
the client it's not really gonna work so
it's helpful to have a way to tell the
server hey I want this thing as
application slash atom plus XML can you
that for me that's what content
negotiation is and it works out really
well so a lot of the time you have to
set a header to do that you say accept
application slash atom plus XML well you
can't always obviously can't do that if
only the browser's were a little smarter
like when you clicked on it stupid
little feed button it actually sent the
right accept header I don't think most
professors do that it would be nice if
they did so instead of actually since
the client can't actually say can't set
the accept header the browser's not
doing it properly we can set the accept
header you know and in the query string
just using a simple little syntax and
some jsg i middleware that interprets
and tears down all like you can pass any
header you want the query string if you
prefix it with HTTP - and you know it'll
just tear that down into a header and
then it'll look exactly like it'll run
through the rest of your application
through the middleware stack looking
exactly like the header was set you know
by like as an actual HTTP header so kind
of content negotiation can go both ways
- so it's not just for getting data out
it's also really interesting like for
putting data back in you don't have to
serialize everything into jason if
you're especially if you're not using
like the thin server approach where it's
just jason going back and forth over the
wire then it's really cool like if you
say you have CSV like this this does
happen if it happens to me actually I
work in the enterprise-e world CSV very
common I don't know why they just they
dumped us they had a CSV it's got no
type it's got nothing but you know a lot
of the time that's that's what you're
dealing with so CSV actually is not that
bad of a representation if you have a
schema that says hey this is a date hey
this is a yeah this is an integer this
is so so when you define these models
and you define your schemas you don't
have to but you can define a schema and
then you can include this representation
that's text CSV and so someone can
actually put back in the interfaces like
I said it's I was describing the first
row interface the Pantera interface just
as simple all of those methods map to
http so you know put and then some
object does your put but you can put
some object that's a CSV file and say
ten type you know text CSV and per store
will because it actually the CSV is
actually relatively easy to do so we can
have a generic interface that we we can
have a generic module that does this so
you require that module to turn it on
and then it'll it'll rip down that data
into Jason and put it into your database
so it doesn't matter if your database is
sequel if your database is Mongo like
it'll just put it wherever the data
store is that's not that useful but it
can be useful like for atom pub you can
you can support any of these models and
what the really cool thing is you can do
in a very generic way you don't have to
choose like you don't have to every time
you write your like as you're writing
your models you don't like for instance
to support atom or to support HTML for
instance because we can do H atom just
if we can do atom we can do H atom to
support that you don't have to think too
much about how it should look how your
how your actual model should look but if
you want to over override the behavior
you can define a little bit a little
interface that lets you define a get
title property you can define a get
content property it gets summary
property alright and these are just
functions that if they exist the default
the serial is the serializer which you
can also override it'll use those
functions to actually make your your
representation for that specific model a
little nicer so what was gonna be
next on the slides hmm
the the one of the nicest things I
didn't really get into the details but
so pintura like the way it's built it's
a pure j SGI op location and what that
means is it all it is is this stack of
middleware and i have this interesting
slide that's like a log that has the
different layers but it's fourteen
different layers of middleware most of
which are reusable they're not specific
to peter at also like I was describing
the the HTTP headers thing where you can
just take any header and it'll pull it
out of the the query string and put it
into the the actual you know header of
the the request object
so that's your the Pinterest pure
application that way that's just one
little matter where
that then it uses and it stacks all of
these on top of each other
I should probably define jsg I a little
bit better so it's a lips
I guess web gateway interface if
anybody's used was gear rack same
general idea we kind of I guess deviated
quite a little bit to be a little more
like HTTP because CGI it has some
problems it's got some significant
problems so I we papered over a lot of
those and I think it actually came out
really nice like it there's I think
we're still you know trying to figure
out how to finalize it it still depends
on having a few more things in common
Jas but it pintura is kind of a
candidate of just it's one of the first
applications I guess full full stack
applications that runs across all these
different engines and all these
different platforms so it's kind of the
first experiment in that in that sense I
mean there was a jack obviously that is
an or wall application that that is kind
of the jsg i implement or kind of
default implementation but yeah it's a
port of racket it's the it's this guy
and it's really nice but so ventura
ventura actually depends on jack and
uses quite a bit of jack's functionality
so there's just the point i was going to
get across was there's just a lot of
these pieces you can pull out and use on
your own so but there's I mean there's a
lot of really cool stuff so the bottom
line I guess is it's not that hard to
get started with there's there's a build
that the Chris is set up that I should
also say I don't think I said this it's
a dojo Foundation project written by
Chris type I just kind of like hack on
it I get to do it for work it's awesome
like I highly recommend being able to
like hack on server-side JavaScript for
your day job because your life will be a
lot easier if you can figure out like I
work for dotnet shop but I get to hack
on server-side JavaScript so I I'm much
happier person because of it but so it's
it's uh it's really easy to hack on
I mean you you can crack open any of the
modules and you can just start using
them all right so yeah you crack open
something in Pinterest something in
first or something from a depending
library and you can just start changing
stuff it's amazing how it'll just work
it's there's a build step I mean you
guys know this obviously it's JavaScript
interpretive yeah so okay I I was
supposed to try I was trying to get like
get that point across but I guess I
confused it somewhere so per store is
it's you wouldn't there's no apes it's
not necessarily the HTTP part it's just
you would use it from your code now it
would be a package you require but
pintura is this other package so this is
a big branding problem I think with the
project there's just these three notions
is persevere which now 2.0 consists of
pintura and per store so this per store
thing is just that that library that you
would require pintura requires it and
maps HTTP to all the calls so yes and
their peen it's it's restful to like in
a sane degree like a lot of people would
say uh you know arrests just like it
doesn't really mean anything
I would having especially now like spent
so much time working with it like it's
amazing how how well-defined it really
is and like I mean obviously there's
there's certain pillars that you try to
ascribe to it's not just the uniform
interface obviously like things like
content negotiation things like just
using for instance content ranges why
don't we use more of that like we should
really do that more they allow you to
take like a resource and have all these
different dimensions on it now so
pintura uses the items type the items
content range that that obviously dojo
use cuz again Chris type said you know
dojo committer so I think you know they
originally kind of created this items
range that's representative of a slice
of a given query and so if your if your
store is just a big table there's a big
list of objects well then you can you
can look at that store and slice that up
any way you want
using this there's simple syntax that's
defined in HTTP really well I mean it's
it's only defined for the bytes there's
a there's something called bytes range
that's that's the
wellspect in HTTP but then it just says
yeah you can use this for other stuff
too in any event check it out there's a
lot like there's so much left to do but
there's already so much you can steal
like if like you summit it it just it
already works like really well</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>