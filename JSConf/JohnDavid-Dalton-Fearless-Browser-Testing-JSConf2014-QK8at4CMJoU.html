<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>John-David Dalton: Fearless Browser Testing [JSConf2014] | Coder Coacher - Coaching Coders</title><meta content="John-David Dalton: Fearless Browser Testing [JSConf2014] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>John-David Dalton: Fearless Browser Testing [JSConf2014]</b></h2><h5 class="post__date">2014-07-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QK8at4CMJoU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm John David Dalton and today I'm
going to be talking about fearless
browser test automation so a little bit
of background I am a contributor to
lodash lodash is a before I begin how
many people use lodash alright are how
many people use underscore all right get
out get out it's ready yes no that's
okay you can stay I also help and
contribute to underscore too but today
I'm going to be talking about browser
test automation and what I did with
lodash to to tackle that when i created
lodash one of the things i wanted to do
today to separate myself from the
competition was to list the browser's I
test and that meant testing those
browsers and so when I first released
lodash I was very accommodating to
testing lots of browsers I said I
support chrome 5 and i support firefox
what is it now 29 or something like all
the ranges all the browsers and that
meant testing all of those things and so
that took about two days to do and we
had 38 or 34 releases in that year which
meant a lot of time spent testing and I
knew there had to be a better way but
before I start j/s comp is a conference
of firsts I started lodash after
j/s comp one year and I was inspired by
Jen's talk on George sort so I'd like to
announce that we will be getting short
by it's a it's a drop-in replacement for
George sort but it is faster and more
consistent yeah thank you all right you
can follow along and some of the the Q
A's of the my testing story at sauce
labs they did a blog post where I answer
a lot of the questions I'll be talking
about today so there's the short URL
there bit ly / sauce hyphen loaded with
no hyphen on the low dash all right
manual testing made me do this it was
horrible it's lots of browsers its
variations its versions its virtual
machines and it's time so I mentioned
that I test a lot of browsers and I'm
sure everyone's setup looks like this so
we all have our Chrome browsers right
okay we all have our I ease we all have
our firefox's our operas and our safaris
and I tested on all of those manually
opening up the browser going to the unit
tests running the unit tests doing a
drop-down menu to change out the file in
the build and doing that over and over
and over and over again and that just
sucked up my weekends so so I wanted to
automate this but the problem was it was
intimidating there wasn't a lot of
documentation around browser test
automation I noticed that it seemed to
be mysterious and very hard in fact I
could not do it I had to ask the
twittersphere for help and someone
actually jumped in and fixed bugs in
dependencies of NPM packages and to get
it to work for me and then once they did
that then I was able to kind of refine
it and clean it up and I took it on from
there and so I'm going to be covering
some of the roadblocks that Iran
into getting testing started so let me
go back all right if you noticed I had a
lot of virtual machines to that eats up
my hard drive this box is basically just
good for javascript there's almost no
hard drive space left it's all just VMs
all right so lodash tests on five
browsers that's five environments so
it's not just it's not just note or the
browser's it's Ringo Rhino norwall I'm
about to do Nagy horn which is like the
new rhino and I even test on things like
adobe illustrator but that's not
included in my automation I just
manually do that one there's also build
so it's not just the monolithic bill
because we've had a lot of talks on
modules right so lodash supports custom
builds we're one of the most customized
libraries out there so there's the AMD
build there's the common j/s build which
is different than the MPN build and all
of these are tested and they all run in
the same unit test so I have one unit
test file and every single one of these
bills can run against that unit test so
I know that each one's covered and
testing it in the browser it's the same
thing it's not just the monolithic build
it's the AMD built it's the underscore
build it's the backbone build its it's
the comic the compat build it's the
modern build it's the non minified
version it's the minified version of
each one of these things because bugs
creep in to lots of different areas
closure compiler Advanced Mode likes to
think it knows more than you do and will
say hey this code can never be reached
but engines are buggy and lots of places
where code can should never be reached
can get reached if you're doing a
feature test and so close your compiler
will like to strip out those feature
tests so I have to put them back in and
I have unit tests to make sure that the
minified versions work correctly this
says 30 versions i have since pulled
back because even automating it that's
still a crazy amount of browsers so i
follow the jquery
a method of this which is take the
current browser and go one back so I
test that except for things like IE
where I still support ie6 and Safari
where I support safari five and that's
mainly because things like phantom jas
still use ish five ish for for its
WebKit so I make sure that I support
that too okay so I said there's got to
be a better way and there is and it's
browser test automation there's a couple
of options out there there's there's
sauce labs which I'll be talking about
today and there's Tesla ng which is a
different way to do it just because I'm
talking about sauce labs doesn't mean
it's the one true way it's the way that
I I went if you if you use Tesla ng or
you use browser stack or you use
something else as long as you're doing
test automation you're in a better place
so I would encourage anyone to just to
to read up on these different options
and pick the one that's right for you I
like sauce labs let's see if I get into
that real quick I might because it has a
view of you can do lots of things with
your unit tests so for example here's an
exam I my page layout here for the sauce
labs you can go along our play along
with me here and follow along that is
and go to sauce lab / you / lodash to
see the recently run unit tests I ran
these tests about 30 minutes ago so it
was a really big chance because there
could have been mass fails there could
have been instability and the the test
automation but in a little bit i'll
explain why that wasn't the case and why
they're all green you'll notice that it
has the name of the test it has the OS
it has tags with it too so you can
associate with your unit test run
keywords so for example when I'm testing
the compat build and the minified build
its compat production and it's also the
underscore unit test suite so it says
underscore and so using that on the
search session name I can I can narrow
down tests by the tags and the tests I
can also you'll see here it has the
commit hash there too so I can look up
test
by commit hash and then of course it has
the the name of the test so it has
things like the underscore test the
backbone tests and the low dash test
because lodash tests against underscores
unit tests it also test against backbone
to to make sure that there's that
compatibility there all right so to get
started I used Travis CI qunit sauce
labs supports jasmine mocha and a few
others it also supports custom unit
testing libraries and I'll kinda I'll go
into that a little bit later too i use i
don't use grunt but it is optional how
many people are using current all right
so if you're using front there's a
really easy way to get browser test
automation set up and i'll talk about
that too and then you'll need a sauce
labs account and that's just real easy
you sign up you get your account you get
a AP I key and that's what you'll need
okay so i make travis CI do all the
things i don't do I don't use grunt in
my case because grunt traditionally has
used lodash too and I kind of wanted to
have this pure dependency stack where I
wasn't using anything else that was
using me to test myself so I i make
grunt Travis do it and that looks
something like this this massive yml
file go to my github repo for lodash and
it's lodash / Travis yml to see this
this pretty hefty yml file and what it's
doing is it's running each one of these
various versions of the build so it's
running phantom Jas norwall rhino it's
running the various builds as well too
and then somewhere in there towards the
bottom you'll see the sauce labs runs
too so I throw my command in there to
call a helper file which establishes the
tunnel sets up the tests runs the tests
and will actually reach fry the test two
all right so this is what it looks like
on Travis CI when it's actually running
the jobs you'll see it says the name of
the browser the version
and past and if there was an issue there
it would say failed at how many if there
was a connection issue it would say what
the connection is she was it may even
give you a link for more information
about that issue too but when I when
everything is good you'll see things
like this where just says past and
you'll see there too that I have the
fancy colors and that's because chalk
which I mentioned earlier here oops it's
not there it's over here somewhere I use
chalk to color that again optional
alright what I do now is I I take it up
a notch and I do code coverage too so
not only is it test automation it's code
coverage as well and i use istanbul to
do a passover lodash and then i feed
that to coveralls and what's nice about
coveralls coveralls is kind of a bit
beta ish but for me at least with the
modular build so the modular eyes build
is the screenshot that i'm showing here
it can show module per module or in this
case like method / method and show me
how much i have coverage for that method
and i just used that today to find dead
code in two of my methods which was a
sign and merge I had a little if
statement that was never being hit and
it wasn't a coverage gap it was a
usability gap like there's no way to
actually get to that chunk of code so i
was able to spot dead code and remove it
from my build and then of course that
increases the coverage percent as well
so this says ninety percent in this file
or that file overall it's Tildy a
hundred percent so if you go to the
actual interface it says a hundred
percent so I'm rocking about a hundred
percent test coverage there so to do
this the MPN depths this is the one
where chalk was there I use chalk I use
a static file server this case was
ecstatic I tried a few others and I'm
not a pro at like all things server
related so I found one that worked a
request and then sauce tunnel now just a
just a few weeks ago I would have had to
put like an astronaut a sauce tunnel
about connection problems and using a
very specific patch which was a
roadblock that I had to overcome but
they have since fixed that so now you
just use sauce tunnel
and everything works it's using soft
connect version 4 which is an updated
version should be faster more reliable
all the things so some of the cool
things you can do with browser test
automation and one of the reasons i use
sauce labs is because it gives you more
control I did not want to do I did not
want as much control as like webdriver
so that's like scripting all kinds of
things and I did not want that but I
wanted a little bit more control because
one of the things I test is ie compat
ones so you all know that there's
there's compat modes in IE and that
they're not exact emulations of their
mode so if you're running IE 11 as ie8
that's not really ie8 that's an emulator
form of ie8 it's a compat mode and
there's bugs in the compat mode that
don't show up in the normal version and
underscore and lodash patch issues with
that and it's in the library and so I
need to test that and with with salsa
labs I can I basically detect a query
string I set the header for the file
because you you can set compat modes
inside a meta tag or you can set compat
modes with the HD HTML header for the
header for the HTML file and so I do it
that way so I can have the exact same
unit test that's running all of my
browser tests also run the compat mode
tests too what's also nice is concurrent
tunnels so it's not just run one unit
test suite wait for it to complete start
another started another that would take
forever this allows concurrent test
tunnels so you can have tests running at
the same time there's limits for the
free account there's like a limit of
three I opted mine to 10 but 10 has been
more than I've ever needed and I do a
lot of variations here like I mentioned
earlier with all of the builds and the
minified and all of that automatic
retries so this is something I've been
working on it's it's not available in
the grunt plugin yet but it's what it
does is this this is running tests from
travis CI its opening a tunnel from
travis CI to sauce labs
and running unit tests and a lot of
weird stuff can happen on the net like
some connections could be dropped
something could be hanging somewhere
causing it to fail and it's not my fault
it's not that it's not my codes fault
it's not failing unit tests there's a
connection issue and normally that would
that would cause the the test run to
fail and that would cause my Travis job
to fail and each one of them i have
three Travis runs for the the monolithic
build and that's each one has like eight
sauce labs connections and so that means
if one of those eight fail my entire
Travis job fails and it says my unit
tests fail for that so it's very
important that I don't have false
positives keeping up because it could be
very chatty and making me always have to
double check my work which is annoying
so what I've added was retries in all
the place and all the things so it does
things like qunit how many people use
qunit whew not a lot I tell you what I
qunit because it was available at the
time and because underscore and backbone
use it and I want compatibility with
them so what I did was I made qunit work
in all the environments that it doesn't
naturally work it so I made it work a
note I made it work in Java ooh by
shimming set timeout set interval and
clear timeout and all of those things
and get got it working there so I'm i
found this this this way to make it work
I use it it's called qunit extras which
is the note on the bottom there and
that's my shim for adding things like
retries to qunit so one of the things
that bit me with browser test automation
is asynchronous tests anything that
relies on set timeout and solo dash has
the bounce and throttle and I have unit
tests that rely on pauses there and when
you're testing in old browsers those
timeouts and those timers have really
poor resolution and there could be
things going on in the background that
caused them to drift and when they drift
you get false fails so what I've added
was qunit config async retries and so
you can specify how many times you want
an async test to retry before it gives
up and so in my case it's ten times so
if any one of those ten times
asses I get a pass from the test I don't
have a problem with false positives it's
always been false negatives if the test
is going to fail it's always going to
fail but the timer drift could cause
false fails every once in a while so I
need to try that the other thing I've
added was retries two jobs so before I
said hey there could be a connection
issue and that could cause a job to hang
so I detect that and if there's a
problem with the job that's not test
related I retry the job and so that
requires stopping the job deleting the
job creating a new job and continuing on
and if there's a lot of problems with
the jobs it could mean there's a problem
with the tunnel the tunnel connection
could be corrupt and if there's a
problem with the tunnel then I stopped
all the jobs remove all the jobs and
then restart the tunnel and continue
where I left off so when I've done that
I get a super stable browser test
automation I don't get false fails I've
been tweeting about this recently where
I had like a hundred runs with no false
fails and then I had two weeks with no
false fails and so I just keep refining
that and getting it more and more stable
and I've even added mobile testing which
I'll cover in a bit and even that
completely stable just I know if it
fails its unit test related and it's not
just the setup tailored platforms so
before I said hey you can do compat
testing right for IE but if i'm doing
compat mode testing that means i'm not
interested in firefox and chrome and
safari right because this is IE compat
modes so you can do things like say okay
i'm testing IE compat modes i know i
don't need those browsers or i'm testing
AMD modules right so then I know I don't
need some old version of opera that
doesn't work with that so you can tailor
based on what you're testing and so I
can I can detect that by the tags that I
assigned to things and only and make
sure that of my browser matrix I only
test the ones that it's relevant to next
so going into some of the cool here's an
example of the tiny bit of code that is
required to set the header for the IE
compat mode and you can see there if you
want to go to my
repo which is a low dash / lodash and
then go to test in sauce labs jes you'll
see this in there too and that actually
does the the sniff for the dot HTML and
then sets the header for compat mode and
that's all you do I'm not sure you can
do that with something like Tesla ng
which is why i like i like sauce labs
sauce labs also allows me to do things
like have a screencast of my failed test
so i can run it and see exactly what
error didn't win and what's helpful
there is to say for AG least for Q unit
is to say hide passing tests so it only
shows the ones that have failed you can
actually go a step further and intel
sauce labs which tests have failed and
they'll do a really pretty print out
that doesn't require a screencast or
anything i just haven't done that yet so
okay five minutes alright that's awesome
so here's here's the always think i'm
going to be short on time but this is
cool this is an example of filtering
platforms here so i just say hey if it's
a compact mode I filter it down to the
relevant user agents and browsers and
this is the secret sauce to doing
anything with sauce labs and that was
something that I had to kind of find out
on my own it's better documented now but
at the time it wasn't and that is if you
even have a custom unit testing
framework you just have to set global
test results which is a global variable
to your details object so and your
details object can have a pass in a
failed count and that's the minimum it
needs right but you can add like a error
message too if you want but that's all
you need no matter what unit testing
your framework you're using as soon as
you set that global object it will
detect it and then close out that
connection for that browser and say all
right and report back the results so the
other option instead of making travesty
i do and if you've seen the hefty travis
yml you're probably thinking well that's
not for me well i made up for me for you
you might like the grunt way to do it in
the grunt way to do it is fairly
straightforward there's a project by
parish rum a ms open Tek employee i
believe this might be on his own
I'm though and it's called grunt sauce
labs and this allows you to fairly
easily by configuring a config that
looks a lot like just a regular object
with you or your the unit testing
framework you want to use some pads some
browser names inversions you want to use
and that's it it handles a lot of the
stuff that i had to stumble along the
way for you in fact i was really
surprised when i started doing research
for this that the thing that I came up
with looks really close to the thing
that they have except there's uses
grunted mine uses traffic see I so I
would recommend using this this project
for that here's an example of just of
what it would look like the config you
can see you just specify your browser's
your platform your version and maybe
some pads in there and a port and and
that's really it this is taken from when
j/s which was recently open sourced they
use the grunt sauce labs as well and
they use cue units here and so that's
really all you have to do to set up your
stuff which makes it very nice so some
of the things that made me go hmm these
are more of the stumbling blocks you'll
see at the bottom I've crossed out some
I'll cover those in a bit so I'm not a
ruby dev I'm JavaScript all the way but
in order to get this to work for Travis
CI I had to do gem install Travis mess
with encrypted strings so here I those
questions like does secure inside your
Travis yml work with multiple variables
does it environment variables how does
all of that sort out so the the basic
ideas is you go Travis encrypt sauce
that capitalized sauce access key and
your access key from your account and
then it you can put that in your Travis
yml with dash secure and whatever that
encrypted string is and so what Travis
CI does on the back end is take that and
actually turn that into the legit
environment variable the global test
results I've already covered and Android
testing was a big pain and what the
problem there was is that I believe
has to deal with HTTP or I'm sorry HTML
headers and headers for JavaScript files
it seems to be very picky about that so
what I was getting in my mobile testing
were files that would load as valid
JavaScript but only partially load the
file and then throw syntax errors which
was really frustrating to to solve so
what I do is I add an on a window on
error handler that detects the error
tells the unit test that it's done
running and reports the error back and
then my retry logic goes hey there was
an error running this test why don't you
retry that test and then I retry it and
hopefully that issue is resolved it's
not a very consistent issue but that
mobile testing one that was really
tricky there's no longer an issue with
sauce tunnels so you don't have to worry
about that special version and there's
no longer an issue with an undocumented
tunnel idkey that was fun to find that's
been resolved to there they just
refreshed the documentation it made
everything super easy for more
information on their docs you can go to
docs / rest / additional config /
connect and get tons and tons of
information this thing is super
configurable the rest api is what i use
because i didn't want to deal with
webdriver so i just i take the URL i I
post a request with a JSON object and
then I just check it and I do everything
from there you can delete jobs you can
rename jobs the list kind of goes on and
on and on with how configurable these
things are so i would say check that out
and i think i'm done and there is no
questions so that's it
member</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>