<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Emil Bay:  Keeping passwords safe in 2017 | JSConf EU 2017 | Coder Coacher - Coaching Coders</title><meta content="Emil Bay:  Keeping passwords safe in 2017 | JSConf EU 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Emil Bay:  Keeping passwords safe in 2017 | JSConf EU 2017</b></h2><h5 class="post__date">2017-05-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/EAaweXzUVh4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hello everyone my name is
nowadays again just hang on okay let's
try again
hello everyone my name is the muo-ping
and today I'm here to talk about how to
keep password safe in 2017 so just a bit
about me when I'm not hanging on
passwords I I have this little startup
thing with a couple of other people
called Komodo trader and what we do is
that we sell cranes online so if you
want to buy a boat full of green and I
mean like a boat full like five hundred
tons of green you can talk to me after
the talk and I'll ship your whole boat
for green online I'm known as a mule
bass bass is like bayes theorem from
math NOLA
okay yeah so and when I'm not working on
Nick moderator I also do freelancing to
pay the bills so that's this guy I'm
from Denmark so that's why it's a legal
guy just a bit about my background I
used to study math but didn't stay at it
very long because I like to write
software as well and besides that I'm
before doing the moderator I have worked
at an advertising agency and I've worked
at a high-performance computing lab and
most recently I've worked at a newspaper
as a data journalist but today we had to
talk about passwords so just to keep get
everyone on the same page I'm sure you
know what passwords aren't but
technically if you know a password in a
part our password is something used to
identify salford right so if you know a
password then that password is pretty
much equivalent to your identity online
because when you go on a website it's
not like you're showing your passport
anything about that you have a password
and the state of the world is that
everyone has passwords like I mean my
grandmother has a password as well so
and if you can steal someone's password
it has a lot of implications and the as
a matter of fact most people only have
one password so your password is your
identity if someone feels that they have
your whole identity you can they can log
in as you everywhere on the internet
kind of thing so what do we do about
this well as I see it there's three
things we can do we can eradicate all
security holes which is a pretty noble
task and I think that's what the world
strives to do right but it's probably
not going to work out in the short term
another thing we can do and I'm
increasingly convinced that that's the
only solution is to have unique
passwords everywhere and for tech savvy
people that's what's not what most
people do I don't know about you but I
keep a password safe with a unique
password for every single website
because as I'm going to show you in a
moment you can really trust websites but
as a service provider one thing you can
do is also to use safer password storage
and that's what we're going to talk
about today so here's a question for you
what do all these companies have in
common their visit by this guy now in
the Lego world every lego man looks like
so it's not me this is some other lego
guy right so in this talk the way we're
going to go about things is that we are
going to build safe password storage
from the ground up and the first way
that we could store passwords and the
easiest way is to use plain text and I'm
sure plain text to a lot of you guys is
going to like it has already has the
alarm bells ringing right so in let's
look at some code here this is the if
you go and look at the examples after
the talk this is the model I've I've
used throughout all the examples so we
have a we have a database of some kinds
in this case is just a map that's in so
in another file then we have a bridge
function and a login function because
often these two functions are not
symmetrical I mean the register function
you take and install the password while
the gating function you have to verify
that the password is the same as was
provided when you signed up and we
return true or false if the depending on
whether the password is is valid and you
can see down here at the bottom I have a
register function where register my
username and then I because we are in
Germany I've chosen a password to be
hunter
which means glove but literally
translated means like hand shoe so I
don't know and then we are first going
to attempt to login and we should see
true over in the console and then
afterwards I'm going to use and use the
wrong of wrong path which is spassvogel
which kind of means literally translated
means bunny bird but it could also like
mean funny guy kind of thing so let's
try and run this and we can just see
that our model for this talk works so we
get a true and a false which we are
supposed to great now as I said before
plain text doesn't great work out but
that doesn't stop these guys from
actually implementing plain sight
stories for passwords in I don't know if
you've heard about the Sony a famous
Sony hack that was in 2011 where that
Ike stole all of the PlayStation Network
all the passwords were out there was
stored in plain text Bill Canadian
telecom provider stole all them
passwords in plain text Comcast yeah
okay so the problem plain text just a
problem in F itself what can we do about
it well we can try and obscure the
passwords I don't want to say encrypt
the passwords because that's not what
we're going to do and we're going to
look at another offender later who
actually did encrypt their passwords but
they had no idea what they're doing so
I'm okay so what we're going to use is
something called a hash function so a
hash function in you probably all know
what a hash function is are like you've
probably at least heard the word hash
function hash functions is what powers
the small random numbers that you get
from your get commit but hash functions
have a lot of other properties that are
very variable in our case as function is
one deterministic so today deterministic
means that the output is solely
dependent on the input there's nothing
in there like what is the alignment of
the planets or what's the yeah I don't
know random number or something
take a rabbit up ahead laughing so to
terminus thing very important probably
number two it is preimage resistant so
that's a nice way of saying that it's
one way I mean it means that you can't
take the output and figure out what the
input was you can only take the input
and get output never the other way
around kind of thing then it also has
another property that sounds kind of
similar the second preimage persistent
and that means that you can if you have
a hash function so you have the hash you
know what the input to the hash function
was you can find another input that
gives the same hash so that means if
that means you can find another password
that gives the same hash meaning that
you would be able to find like a
completely different password and try
and crack the password the hashing
function and last thing is collision
resistance and that's kind of a involved
circulation meaning that by some
accident two passwords maps in the same
hash which is kind of nasty as well so
these are the properties the hash
function have to to obey and we're not
going to build a hash function that's
hash functions out there so yeah studied
math I spent like three years being able
to write the last slide in like this
notation here so in yeah waste of time
some penguin what's safe but I mean this
looks trains arrived so in another nice
thing about hash function hash functions
have like heaps and heaps of
applications we're just going to use
them to password but let's start there
is like one of the most amazing
properties about hash functions that
means that you can take like a extremely
long stream of bytes or of bits and you
can hash it down to something that's
finite so it has like in fits in there
and that's pretty amazing and something
that if you go study hash functions
we'll just above your mind so was that
demo now the demo comes in so here's a
couple of hash functions you probably
heard some of them md5 md5 was the first
hash function I learned about and I
learned about it when I was building
password system in PHP now the problem
is that Osborne 1993 md5 was starting to
break in 1996 so I was still wearing a
diver when md5 was program shell one you
probably all heard about the reason
shattered paper shadow attack sha-1 is
broken too
it was a nice it had a nice run but a
yeah it's gone now then we have a couple
of other hash functions there the ones
in green these are cryptographically
secure hash functions but they are very
very fast and that's something we don't
want which I'll also show in a minute
then at the end we actually have so you
might have a hard time seeing this but
I'll just bring it up we have bcrypt a
script and argon to be creating a script
are still has functions that you can use
to store passwords it's not what I
recommend but you can do that and then
we have argon two and argon - I have
something to sell about later so I have
a little demo let's just open it up here
so because everyone knows md5 as I and
and to make it clear that this is not
the way it should do it I used md5 as a
hash function up here if you run this
you can see that it note it gives the
same output as before pretty simple and
now instead of doing a strict equality
to the string that we passed in we have
to hash the password again and them and
and compare the two hashes and you can
see here I also try to use some some
German words shield clear which is like
turtle and valina yeah we get the output
that we expect so this is like the ball
down version of how you do a hash in
note with core crypto a hash the output
of a hash function is often often also
called as digest because you like
digesting something big into something
small these are the offenders
I don't know if you know these guys but
in 2015 and I said that this was broken
when I was wearing a diaper
in 2015 these guys were hacked and
password sleep and it turned out that
they had used md5 as the hash function
for their passwords so my wife is a bad
was a bad idea it's because there's a
very famous attack called a dictionary
attack that you can perform on a on a
passwords that are hashed this way what
you do is that you have a dictionary a
large table of words or common passwords
or some way of generating candidate
passwords then you take all the
passwords of the words that your
candidate would you just run them
through the hash function that's very
fast and then you afterwards look up in
your table whether you could find
whether you have a hash that matches the
password you're trying to crack and then
you have the plaintext and I don't know
this might seem far-fetched but it's
actually very fast to run so here I have
been taking DM oh wait this is gonna
work yeah that's gonna way so I'm taking
the year the built in dictionary that's
in there on pretty much all Knicks
machines and I've run the code that we
saw on the last slide and we are now
going to try and crack my password and
this this is a shady MacBook Pro it runs
in like one point three gigahertz it has
two physical calls and four virtual
calls so I mean it was probably state of
the art like eight years ago hardware
wise and we cracked my password which
was secret in like 1.3 seconds so yeah
rainbow tables I very powerful if people
don't know what they're doing kind of
thing so yeah problem rainbow tables
what can we do about it we can so the
issue is that if a lot of people in the
same database have the same password
they're all going to have the same hash
and research shows that a lot of people
choose very common passwords so we are
going to try and obscure that people
have the same passwords or make a mega
make it very hard to generate these
rainbow tables so we want the identical
password
to yield unique hashes so how do we do
that we use salt solid hashes so so
little heads just makes precompute okay
so the way you do a dictionary text and
is that you generate these huge rainbow
tables because storage is cheap and you
can even go and buy premade rainbow
tables so and we want to make it
impractical to generate these rainbow
tables and then the way we do that is
that we salt the passwords so in in this
case I can actually use it in this case
I generate a salt I generate a
cryptographically secure number of bytes
and I prepend them to the password then
I have a separator and then I have the
password and then when we stored in the
database we need to put we need to save
the salt and an important point to make
is that the salt doesn't have to be
private the salt is just some random
value it's not sensitive in any way you
don't need to encrypt it or anything
like that you can just stall in database
because the point is that if a
adversary' breaks your database and
dumps all the passwords then you'd have
to generate a unique rainbow table for
every single of the users because they
all have a random piece of data in the
password M and we can run this we want
to it's not too interesting
oh wait that's photo just so yeah this
goes like that a very fast notation and
it's in it's very easy to implement so
here's the here's the details I just
chose 64 random bytes because all hash
functions have something called block
size md5 has a block size of a think 512
bits 64 times 8 that's 5 4 and 12 right
maybe I don't know something like that
so but um yeah so these are the
offenders it's still very easy to break
these be salted and salt hashes it was
state of the art like eight years ago
and I guess that's why it is still like
common knowledge that it's okay to just
sold passwords and stole them in the
database but what these guys also did
was that they used a
very very fast and efficient hash
functions so I think some of them used
md5 which was still broken so still
don't do that and some of them used
sha-1 which is also broken now so don't
do that either but I mean that kind of
forgiving in a way they still had eight
years to to migrate though so I mean I
don't know if that's forgiven problem
it's way too efficient it takes way too
little time to crack these passwords so
you can you can just go to Amazon and
and hi and rent out one of the big GPU
servers and then crack up the password
hashing assault benchmark for in salted
Java one with the tool called hash cat
and it could do something like 2000
million hashes a second on the big
Amazon server the big Amazon server only
costs oh that's the sound again the big
Amazon server only cost something like
eight dollars an hour I think so
when you think about cracking passwords
you have to think about not how much
time does it take you have to think
about how many dollars does it cost the
other day I read about a mathematician
at some US University who was working
with these special curves and to study
the curves he had to generate like heaps
and heaps of them and to generate all
the curves he was trying to start it
took a sixty CPU years so sixty CPU year
sounds like a long time but a hideous
win and Google branded a bunch of
servers and it also in the afternoon to
run 60 years of computation so that's
where every like the intuition we have
about time doesn't bring map to cracking
passwords so what can we do about this
bring some money so we can try and make
it less efficient to crack our passwords
how do we do that we use our iterated
hashing and iterate hashing is one of
the techniques you can actually use
today if what you're doing needs to be
NIST compliant you can use a built in
function in no-drip so called pbkdf2 so
password-based key derivation function -
and that's what we're gonna do now so in
the thing with the M
with the iterated hash functions is that
not only do you give a salt and password
you also give a work factor so how many
times does need to take the output from
one hash iteration usually the input to
the next hash iteration and so on and so
forth and here we are going to use at m1
is number five instead so you see now it
takes a bit of time there was the true
there was a false so in now we're doing
something like I don't know two hour
milliseconds maybe for every time you
need to authenticate a user that's very
good because now an attacker instead of
using maybe one millisecond per password
or perish has to spend 200 milliseconds
per hash and suddenly those maybe 60 CPU
years turn into a thousand few years or
similar this is what you need to do to
use the TV KDF to you can see there's a
lot of parameters you have to save in
your database here and a lot can go
wrong and you have to think about what
about the future when this hash function
is broken then we need to upgrade and
all that stuff but you need to give a
salt you need to choose an iteration
count so how many times we're going to
run food risk you need to choose how
long a hash do you want and need to
choose what hash algorithm do you want
to use and then you pass all that in
runs asynchronously in another a worker
threads that doesn't block the event
loop and back you get an error or the
hash so you can do this today I don't
recommend you do this but you can
Dropbox did this and I don't want to
call them out on it well it's not bad
it's not bad
they used a iterated hash cipher called
a bcrypt you have maybe heard of Bikram
is based on a block cipher called
Blowfish and then the only issue with
equipped with this which is kind of a
non-issue is that it limits the password
to 72 characters I mean if you use I
don't I don't know anyone who would be
able to remember like a sims 2 character
password it's more of a problem if you
use a passphrase
instead of a password so the problem
here is still that it's
very easy to just run all these hash
functions in parallel and that's the
whole deal with the GPU is that instead
of having one call the lot of memory you
have like thousands of course each with
very little memory and I'm saying memory
memory all the time because I'm counting
hitting it what can we do next but even
more money to spend all the money on
hashing and now we are getting to what
is kind of state of the art today and
that is key derivation functions but a
special kind of key generation function
which is purposely purposefully slow
because it both uses a lot of memory and
a lot of computation and here we have it
argon too so in 2013 the academic
community kind of had enough that been
way too many breaches it was way too
easy to correct these passwords and
there was no clear consensus or well
though kind of was but there's no one
place you could point to say just use
this and forget about all the other
details so they made a competition they
had a lot of entries in there and argon
too was their recommendation at in at
the end of the compare competition so
let's fire up argon soon so let's see
that's the number seven and you can see
it's computing take a long time maybe a
single user to long time so that's what
I was saying about this MacBook ah yeah
there we go so it's the first
verification and now it's trying to
verify the next one and you can see that
it comes out there now one issue is that
and I'll show that by showing you the
code so the issue is that this is
blogging I was trying to when the hash
function was spun up to authenticate I
was trying to log out um I was trying to
log out console a deadlock with the hash
to just show you that the event loop
wasn't blocked but it was that kind of
issue which if you have a server running
with like thousands of people trying to
authenticate then um you only have one
guy at a time after
that's caricature users very mad at you
so em but the good thing about this is
that I want to show you just the
performance profile of the two functions
so here I have the pbkdf2
in a file web friend rammed up the
iteration counter something very high so
we actually have a chance to start top
so top is a UNIX command to show in how
much memory and how much CPU a given
process is using so I'm not going to
spin up here you can see that the no
process is taking my CPU at a higher
percent but it's the no process is only
using something like nine kilobytes or
nine thousand to nine megabytes of
memory which isn't very much I mean the
top of the line a GPU class GPU server
at Amazon has something like twenty four
gigabytes video memory so I don't know
how much 21 to me four gigabytes divided
by nine megabytes is but it's a lot like
he sleeps so let's just kill this and
then instead let's go and look what the
performance profile of our gun to is so
again I spun up the the work factor like
heaps and let's try and write and you
can see now that it's again taking my
CPU but it's also taking up five hundred
megabytes of memory so it's very easy to
do the math twenty four gigabytes
divided by five hundred megabytes that's
like 48 so you can do 48 of these
cracking cracking attempts in parallel
which isn't very much so nice but the
problem is there was blogging and this
is the if you want to do the blogging
stuff this is how you do it you have a
small library with one of my friends
called Matias math and Tosh online it's
called sodium native it exposes argon to
as a PA as the PV hash function so you
can go use it if you want to put as you
can see it's a bit complicated and so
yeah it was blogging what can we do we
can make is synchronous and that's what
I've done for you made it asynchronous
all you have to do is run npm install
secure password and i'll make it
possible to secure for you that's why I
have the crypto be it so in you can use
this today and it came out like two
weeks ago and I'm still in adding in a
bunch of other features one feature I'm
still missing is that because it is
using so much memory it's actually a
very real scenario that your box might
run out of memory and the process will
crash like the operating system will
kill it for you so I'm using I'm still
working on putting like a cue mechanism
and you can inspect the cue and choose
whether to like balance off the the
hashing to another machine something
like that it's very is used you can see
here's all as to it you don't need to
think about salting or think about the
work parameters or arm think about the
algorithms or anything like that thing
about forward compatibility and forward
compatibility is very important when we
do hash functions because if there's a
paper coming out tomorrow saying that
there's a reduction attack on argon 2 we
want to switch to something else maybe
so we can do that with this library to
doesn't get much easier than this I can
just show you so the parameters remain I
can to with before in blocking mode
we're pretty high as well so with the
secure password the default settings
should be good for now and they are set
to a what the beggin library calls
interactive settings so settings that
are suitable for a passwords on the web
and if we run it you can see it's pretty
fast so it's not like your users have to
sit down wait for several seconds for
you to compute the hash and authenticate
them now we are running out of time so
in I mean you can take this home with
you it has a couple of options up there
you can see that in the readme what you
can configure is very easy to use and it
has a equally easy verify function for
you to use there's also a sync sync
version in there if you want to use that
for command line stuff or whatever so
yeah oh wait there we go thank</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>