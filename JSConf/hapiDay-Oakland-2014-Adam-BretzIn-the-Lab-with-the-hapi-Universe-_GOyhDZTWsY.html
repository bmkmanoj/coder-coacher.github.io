<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>hapiDay Oakland 2014 | Adam Bretz:In the Lab with the hapi Universe | Coder Coacher - Coaching Coders</title><meta content="hapiDay Oakland 2014 | Adam Bretz:In the Lab with the hapi Universe - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>hapiDay Oakland 2014 | Adam Bretz:In the Lab with the hapi Universe</b></h2><h5 class="post__date">2015-01-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_GOyhDZTWsY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">um so yeah hi my name is Adam Brett's
that's a or b on github and a or b on
IRC and the happy channel and Adam
Brett's on the Twitter so I work at
Walmart on the open source team believe
it or not that is a real thing and so I
pretty much spent my day working on the
happy basically universe and everything
that sort of goes along with it if you
follow any of the activity stream for
that you'll notice I do a lot of work on
the good ops monitoring plug-in and sort
of the the pieces that make that up so
as you can probably guess I'm here to
talk to you about lab so lab is the
testing framework that we use at walmart
we use it both internally and externally
for the entire happy j/s stack before i
get too far into this all the examples
are for lab version 5 so if you're using
an older version yeah you're encouraged
to move to five there's read me Thanks
there's read Me's and sort of help as to
how to do that it's it's pretty easy
though so today I'm going to talk
basically about three things why use lab
at all talk about a new assertion module
named code and then I'm going to give
you a pep talk so why use lab three
things three main points really it's
been battle-tested it's easy to use like
hopefully you find the other happy
modules to use and it's got useful
options and features that are you know
enterprise-grade so all the all the 30
or more it keeps changing open-source
repos under the happy j/s umbrella all
use lab in addition to that every
project inside walmart uses lab as well
so you know labs been built to test high
demand high uptime systems like happy
and the servers that run inside
that that power the walmart sites so you
know it's really been been run through
the ringer so um these are just two
examples to make sure that one plus one
does equal to and if you look at them
one is TDD ones BDD I don't know which
one I don't really understand the
difference but ones one and one is the
other so it's on a pit onion opinionated
how you build and lay out your tests if
you can see you kind of sort of can it's
basically just aliases you flip around
to make it TDD or BDD and so change it
to to suit suit your needs all right so
some of those features i mentioned
earlier we have talked about some of the
really handy ones these are all like CLI
options the dash C and T sets this is
all CLI stuff the next few slides so
dash C and dash T for coverage and
threshold so r out of the box lad gives
you code coverage basically is their cup
is their lines of code being hit in the
test context that you have define yes or
no the dash t sets up the threshold for
a failed versus passed test so if your
code coverage is less than X then you
get you know a frowny face your tests do
not pass once you start using it you
will find that the code coverage is
annoyingly thorough so in this example
I've got here you will need code that
exercises both sides of that or
statement for settings both sides of the
ternary operator for results and all
three sides of that if statement it's
annoying but it's no way to know for
sure that you've hit everything so
there's built-in linting right out of
the box it comes lab comes default with
a as a lint file that sort of matches
the happy style guide it uses es Lynn as
the rule engine if you don't like our
style guide which I don't know why you
wouldn't but if you don't
you can override it with your own es
lint our C file at the root of your
project and one thing I want to note
there if you do that you need to supply
your own entire file it doesn't like
merge or anything wacky like that so if
you want to use your own you've got
right you're your own and this example
here is basically what what it looks
like if lint is mad so this is new in
five the dash a option you basically
tell lab the name of the assertion
library using and that is helpful
because then it can keep track of how
many assertions you've run it doesn't
sound very useful but sometimes you
think you've run an assertion but you
actually don't and you can sometimes get
like a mysterious test that pasts but
you don't end up actually testing
anything so the dash day is a very
powerful new feature to lab so we got
verbose and ID verbose prints out all
that test verbiage you spent time
reading for your t dds and BDDs it
prints out you know math module shump
sums numbers it does not crash on empty
raised it prints out how long it took to
run the test a little glyph for past
fails and it also prints out a test ID
that test ID is useful for the ID flag
so that lets you basically run specific
subsets of tests if you're trying to get
coverage or make a particular feature
work you can run an ID and just keep
hitting the one or two tests over and
over again instead of rewriting the
entire suite and I'll take a range 1
through 2 1 &amp;amp; 2 it'll also take a little
mix and match so you can do 1 comma 2 3
through four let's see so there's a few
other quick features that I want to
mention that don't need a whole slide
async testing is easy because every test
is passed a call back I know some other
testing frameworks it's you do something
a little different to get a sink testing
in lab everything's already assumed to
be a sink you have a bunch of different
output options not just console so if
you have a very involved project manager
who wants to see graphs and charts
you can print it out to HTML or
coveralls there's a bunch of different
reporting options as well so how we use
lab and again when i say we i really
mean walmart internally and externally
and again it's the same pretty much in
both cases so that dash t option i
talked about threshold is 100 so the
threshold for code coverage always has
to be a hundred if you've ever made any
PRS into the happy universe and I hope
you have and encourage you to do so you
will probably get comments about hey
this is missing coverage or tests don't
pass taking you to add test it's the
dash t 100 that that's doing that to you
so that that's where that comes from
always use a CI server that runs a
designated test command and we have we
use a make file but the make thought
really just has different lab configs
but NPM test is usually fine for most
people and nothing ever no PR ever gets
merged in unless the CI server says that
everything passed so you have to meet
that coverage dress threshold you have
to pass linting rules if you use it
unless your errand then you can merge
anything so what you get from all this
you get the sort of neat automatic
feedback loop that doesn't require
humans so you open a pull request
against something your CI server will
run and you'll see that little glyph on
github warning you that it can't be
merged in and so then hopefully you look
at the details and see hey coverage is
less than one hundred percent or your
linting failed or you know you're
missing a test entirely and so the you
know the cool thing there is that you
have this feedback loop it's pretty much
automatic and you kind of pull people
through writing better code without
having to harass them to do it so it's a
pretty pretty nice little cycle and it's
definitely worth setting up just for
that alone you get higher quality code
and you sort of get that for free by
having this sort of come continuous
feedback loop
so quickly going to touch on the this
code module I talked about so that's a
new one and yeah it's just a base a
pretty simple assertion library lab
formally came bundled with chai but but
we broke that out because child was kind
of a little more than what we really
needed at a lab and it was also he sort
of this problem here where you couldn't
remember if it was a property or a
method so encode every like assertion is
always a method and this also goes back
to that assert command I mentioned
earlier where this expect property
versus expect method if you didn't if it
was a method but it wasn't supposed to
be you could inadvertently get a a true
test when you actually didn't assert
anything because that exists might not
actually be a property so yeah codes
cool it's consistent everything is
always a method and there's a lot fewer
human words to sort memorized so it's
easy to to commit to memory okay so how
can you get started hopefully you have
tests already but if you don't this is
supposed to make you go and do that now
if you don't so number one do something
yeah you're not getting one hundred
percent coverage and tests that say it
work is going to take some time so just
start small write the test that the it
works type of tests and you know just
the simple sort of integration tests
like that you'll probably hit 50 60 even
70 percent code coverage right out of
the gate once you get there you know
change your process if you don't if
testing is not part of your process now
make it part your process new feature
you you don't nothing ever happens and I
should have a test to prove the feature
works if you fix a bug either create or
add a test to make sure that the test is
good and doesn't cause any regressions
once you change your process and get
that part of it code coverage will go up
and and you'll be happy and once you put
that time into
get you know testing built in your
process get coverage up the rest is easy
it's just maintenance from there and
yeah so 87.5 percent they probably
thought this truck was okay but it
doesn't really look like it still works
so one hundred percent should probably
be your goal or close to it and that's
probably not good enough 87.5 okay
that's the end if you want this deck
i'll send it out there's some links to
the deck to the lab repo and to the code
repo as well thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>