<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Michal Biniek: HTML5 audio sprites --  Holy Grail or Programmers Hell -- JSConf EU 2013 | Coder Coacher - Coaching Coders</title><meta content="Michal Biniek: HTML5 audio sprites --  Holy Grail or Programmers Hell -- JSConf EU 2013 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Michal Biniek: HTML5 audio sprites --  Holy Grail or Programmers Hell -- JSConf EU 2013</b></h2><h5 class="post__date">2013-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8skJbjEh9SY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Oh
you
so let me shortly introduce myself I'm
Michael biniak and I'm senior front-end
developer in inner games and I'm working
grepolis game it so let me short really
shortly introduce to grapple this game
what is it few short facts so it's
browser based strategy game which is set
in ancient Greece there is open twenty
million registered users it's translated
to 22 languages and I think what is more
important that all front end is done in
just craved HTML and CSS and we are
using some newest features from html5
like a history API we are using audio
obviously and canvas and of course css3
so like transitions or animations and
yeah so let's go back to presentation
what is the plan for today at the very
beginning I would like to show you or do
short introduction what our earliest
prides afterwards how we are using sound
in grepolis game and what is our case
though afterwards few words about
preparation how the files should look
like and what is important during when
we are merging them into one afterwards
some tests about more users view and
file size and short summary at the end
all right so what our audio sprites let
me explain how to look like starting
with image sprites which I so it's quite
usual for everyone that everyone knows
what is it so we are merging multiple
files into one file and afterwards to
get immediate access to it and well to
use that we usually are using CSS rules
so we can be somehow pixel perfect so we
are minimizing the space between them
somehow with the rectangles around it ya
Abdul sprycel almost the same however
the color is a little bit different it
sounds so we are merging sound different
sounds into one yep well actually we
can't be pixel perfect
the we are here using time so it's also
hard to be millisecond perfect as in
depends of the hardware but so then we
have to separate different files by
silence and afterwards we are using time
update event to handle when the sound
should stop in this one huge file and of
course we then using each set of CSS
rules Sam Jessie J's config so JSON or
XML it so let's do a short presentation
how we are using it in ripple each game
I think I have it open here already yep
so this is gray Polly's game it's a
little bit cut maybe make it a little
bit smaller just to get it's fine now
yeah so we can we advert beginning we
have some cities here so let's start it
so and and this city the goal of the
game is to conquer all island at the
beginning and afterwards to conquer a
whore word so it's a little big yeah and
if you wanted to convert the word we can
do it alone or yeah we can use it to
together with others to set up some
alliances and so on and I think what is
the most important part to conquer are
the our army or units and so we have to
somehow recruit them and we can do it in
the city overview it's a little bit I
think too loud may be great to do yeah
it's internet here is working quite not
well
yeah all right that's right it seems it
try to restart
yeah live demo all right on your back
try to open it again yeah now we are
here yeah and if we wanted to recruit
you needs we have to go to barracks and
as we can see here we have a lot of
different units which we catch which we
can recruit so let's say we recruit the
first one yep and then we have to wait
till the end of the recreation process
the other staff when we wanted to for
example to get different technologies
different units we have to go to the
academic and get to start to accent or
to research new technologies also few
other staff to manage God's to manage
out right and so on such we can notice
here we are playing a lot of short sound
effects to different buildings to
different units and they are playing
somehow in the different sound set for
each window or 40 each view so let me
shortly introduce or summary what we
have there so what we wanted to play our
short audio files they are playing
somehow separately at least according to
the Sun sets and we are not going to
loop it and our goals in the group
bollocks game where to make as fast
installation installation as possible we
also wanted to split the sound set
because we wanted to represent on them
and just to not use whole bandwidth of
the userid liver beginning of the game
and we also wanted to deliver to I 9
users as many sounds as possible or like
to other browsers because we met some
limitations with 40 LD players created
at once and as the game is over 150
sounds then
this was a little bit hard yeah so let's
start with some JavaScript this is
example of the config yeah so we have to
just pass when the sound starts and when
air when the ends this is actually
current example from the police games so
the prepared name is the idea of the
sound afterwards we have ID of the sound
sprite and then when it starts so the
first one at zero second and ends at
three seconds 75 and as we can notice
here this breaks between different
sounds are two seconds on the next one
starting at 575 yeah what's the idea of
implementation and this actually ropa
for the audio element that we are here
playing just fragment of it we are
passing this fragment from our config
and so at the very beginning we are just
setting the current time from the start
property from the fragment then
assigning even listener time update to
so our callback function and we are
starting playing sound yeah and on every
take of time update which should we take
at least once in 250 milliseconds
according to specification we are
checking if we already reached the end
of our sound which is set in config and
if so then we are just stopping it and
then we can do some reset of it and set
some extra states as we already said few
words about the silence between
different sounds with merge into one
yeah we have to summon determine what is
the optimal vows this is important
because this also some make impact to
the file size and this time updates
whistling said that it should be trigger
at least once in 250 milliseconds but if
is there's something going on the
background like game with some
animations and we are running it on
mobiles then it could be triggered
a little bit less often so we can reach
summing over one second so if you wanted
to avoid some glitches we have to differ
mine or our devices what will be the
perfect house and as we can notice on
the graph on the bottom the file size of
it is not really a different usually we
can oh no GG we can always make hip
smaller files Matty mp3's somehow a
little bit worse especially with
compressing the silence it was important
when we are compressing files which
always should use vb air so for a bit
rate because it's compressing silence
really well yeah if we wanted to hip
numbers here's comparison other sprites
to separate files so as you can notice
the OGG is always almost eight person
better the mp3 is a little bit worse and
it's anyway growing instantly linear
rate about eight percent on every jump
of the second the Emperor is a little
bit smaller but it's not huge issue yeah
let's move to the tests on the browser's
we tasted memory usage in spears edge
for them and we tested the newest chrome
the newest Firefox and a little bit
older Internet Explorer which is
actually most popular and some
independent values like size of the
files and number of requests yep this is
a full list of the Sun sprites used in
our game in grepolis game and as we
notice some of these some surprise are
bigger some are smaller but even if we
can save one of your every player of the
element for internet explorer I think
this is worth it and I tested memoria in
cpu usage on two cases one is great
police case so somehow we are playing
one side up one sound after another and
the edge case which are also prepared
it's ten sent at once so we are trying
to play all of these sounds this
moment and then we need to note only
this one on two other elements to
handling some sprites but we have to
create extra one so then we can notice
some issues and I tested it on two data
sets one on barracks which I already
shown and academy as well yep so as you
can notice Memorial usage for a great
police case it's really good for the
sound sprites we are saving a lot of
memory especially because of audio
elements so it's like twice smaller and
yep a little bit different is for 10
sounds at once our escape as we can
notice if you have to create more algae
elements which are handling bigger files
more usage will be way bigger so I think
in games like counter-strike where we
have a lot of explosions or something we
can think about other solution talking
about Maury I would also like to show
you the difference between what we get
the more usage when we enable sounds and
we are just creating out the elements
and after we play them so integral
politics case we can notice that if the
percentage comparison it's almost the
same for the sprites and for the
separate sounds so nothing really
interesting but for the ten cents at
once when we are creating a lot of new
of the elements the difference from the
beginning and the afterwards it's really
huge so we can be surprised afterwards
that the more you is so big and what we
have to do with that and handle all
these additional audio Clemens cpu usage
for sounds are usually it's usually not
no problem it's about health person of
CP usage when we are playing one sound
the pics here which we can notice it's
like only when we are setting current
time for so we are starting the new
audio sprite part it's of course
different for 10 sound at once when at
the beginning we are creating the new
audio elements and we are trying to set
them
as you can notice at the beginning is a
huge pig so for example chrome was using
almost whole accord running it and
afterwards anyway this p usage is like
ten percent so it's really big and
especially comparing two mobiles where
we are trying to run it and we don't
have so much yet operation per second it
could be a little bit problem on the
firefox we can only notice that these
jumps for the time update handling it
the last week which we tested our size
of files so we i already spoil it the
OGG is smaller usually always mp3 it's
sometimes smaller sometimes bigger this
we can notice if we have bigger files
and usually a little bit smaller for the
hours a little bit bigger and m4a is
slightly small difference and yeah the
arab speed factor is still number of
requests so in the group police game we
went down from 150 to request for this
sounds 213 which is quite awesome it's
like an eight percent of that yeah for
the other this is exactly size of the
files so let's do a short summary so
what we wanted to achieve in the grip
police game and what we wanted to
achieve anyway using other sprites is to
prepare solution for IE somehow to get
immediate access to all of them without
creating magnetic how many others price
we already have and for mobiles is also
really important where we have
limitations with the memory we also
achieve the smaller files they're less
dreary place to the service so somehow
we can also avoid situation that there
are some errors or river during the
creation the connection to server the
integral police case the group police
game we reach also lower memory usage
during the plank and creation of all
these parts and for the others who
wanted to
test it if it's really Worf to use it
it's supported by quite known libraries
likes a minute or two so just feel free
and put it there with the config what we
didn't want to achieve and what was
shown on this are our edge case it's
like 10 sounds at once case and where
this piece which is really high and the
memorial usage is really high there are
other bad parts I'll like a complicated
culture right if you wanted to do it by
this libraries and library by our own so
in this situation we have to catch all
these events and we have to take care
when to stop when to start which rely on
time average event which I already told
it's kind of buggy or not baggy but it's
not really reliable so on the mobiles we
can have some problems with some
glitches on playing two cents which we
shouldn't do that and of course the
loops because of the silence before
between these our merge files so without
fade in and fade out we can't do
anything all right thank you for your
attention yep that's
Thank You mehal do many questions I have
a question with especially with image
sprites a lot of the pain that's around
image sprites is ostensibly going to be
solved with something like HTTP to or
speedy how is that gonna affect audio
sprites does that make any sense so too
so like insert in terms of requests
right you don't actually have a request
for each thing right you could actually
batch push down a bunch of things you
don't need to sprite anymore does that
is that something that you guys just so
for other sprites we are reaching the
smaller files anyway small request and
we have an immediate access so if you're
trying for example start sitting up then
you owe the element on mobiles you take
some time and here you have already
created everything we just have to set
the current time and ply it so it's way
faster ok cool ok any questions any
other questions ok ok so if you have
more questions about the other surprise
or gaming so feel free to ask me
afterwards or my colleagues from
mini-games you dispatches extra bodies
so yeah cool thank you so
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>