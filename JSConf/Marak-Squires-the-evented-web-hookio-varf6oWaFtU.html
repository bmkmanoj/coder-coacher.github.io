<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Marak Squires: the evented web, hook.io | Coder Coacher - Coaching Coders</title><meta content="Marak Squires: the evented web, hook.io - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Marak Squires: the evented web, hook.io</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/varf6oWaFtU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">ah
I'm gonna clear we're going to join okay
i'm here to talk about the invented way
pretty much this problem stuff is
happening on the internet and you want
to do stuff when that stuff happens very
descriptive description very technical I
hope everyone you brought that first
morning expected presentation is
unexpected Jr fooled hello hello did
everyone hear me all right all right so
like I was saying stuff is happening on
the internet and you want to do stuff
when that stuff happens a bit of a
warning I did not think I'd be
presenting today I didn't even think I
would be here the tickets sold out for
Jay Escott before i bought low and i
came down on friday i wanted to party
with you guys meet some people and I was
lucky enough to win scurvy comp so I'm
here today there's gonna be some badly
created slides which I made last night
on the boat and this morning and I'm a
little nervous so just bear with me web
books okay so in the world of the
invented web it's really all about web
books so what is a web hook there's no
RFC for web hooks there's no standard
definition there's no committee most
people have dealt with web hooks before
if you do web development usually they
are presented as a restful web hook
there's a bit of information out about
this at web hooks org jeff lindsay is
kind of a pioneer working with this
stuff I haven't seen much other
information out there and yeah the
definition of a web book is kind of
ambiguous right now so most people think
of restful web hooks you have an
arbitrary URL that's not a real URL
don't go there and it's just sitting
there and it's waiting for an HTTP
request when the HTTP request comes in
some arbitrary action is going to happen
and this is kind of how most people
think of web books today so I kind of
disagree with this restful web hooks are
not web hooks they're a type of web hook
they are a of web hook yeah
excellent so yes a restful web hook is
just a type of web hook so we're going
to kind of restate our assertion here
stuff is happening on the internet and
you want to do stuff when that stuff
happens so an incoming HTTP request does
count as stuff but there's way more
things that you could be listening for
not just an incoming HTTP connection so
first who is this guy with the dumbo hat
and who led them on stage hi my name is
maroc Squires I'm a software developer
from NYC I participate in the NYC j/s
group a little bit this is my github I
don't do Twitter I have a fake facebook
can't find me so yeah check me out on
the github I've been involved in a few
internet hijinks for those who know me
they're not really appropriate to be
speaking about here I've been banned
from most online services at least once
that's the banhammer even got banned
from github they unban me thank you very
much for those who don't know the story
i created a bit of a script that worst
people to watch a library that i created
and it went pretty far before they
caught on but uh yeah so i'm not going
to do that again because getting banned
from github would probably be
problematic and I once scurvy comp
because I could yell louder than
everybody else so also i'm here because
of kokia which is a product or a open
source project that i've made i like to
call it yahoo crack pipes the websites
up right now it's hooked I it's pretty
rudimentary you'll probably be able to
break it if you try hard enough so I'm
going to give you a very brief history
of hokey oh this is the github commit
log I've got 88 Watchers I'm pretty
proud of that they're legitimate
Watchers not ones that I forced you can
see from the commit log actually do have
a full-time day job which I'm not
allowed to work on other projects so you
can kind of see I don't sleep much this
is hooky oh the main application it's
about yeah 9000 sir shins this is the
front end for hooky oh another seven
thousand or so and I started this
project two months
and the first line of code went two
months ago so it's been pretty busy for
the past two months with all of these
commits and yes so what's hokey oh
Tokyo's a few things Tokyo is a
standalone server Tokyo is a common j/s
module Tokyo is a freemium
software-as-a-service Tokyo is
open-source MIT license and who Kia was
a standard interface for building web I
oh okay so oh one more thing kokia was
100% javascript in nodejs no JSL
interface that's a Brian as you can see
so I didn't really explain anything I
just kind of threw out a bunch of
buzzwords so yes what exactly is hokey
Oh aside from these things I just
described well Tokyo is a web platform
and yes platform is probably a terrible
word to use maybe it's an application
framework but let's not get bogged down
by the semantics Tokyo is going to
listen for stuff to happen on the
internet and when that stuff happens
it's going to do other stuff so in the
world of hooky oh we have two main
concepts we have web hook definitions
and we have web hook protocols a web
book definition comes in two different
flavors there's a web hook listener and
a web hook action web book definitions
are common j/s modules so pretty much
what happens with a web book is that
it's going to listen for an action for
an event and when that happens it's
going to perform an event or an action
arbitrary it doesn't matter what it
listens for it doesn't matter what the
action is going to be so for the most
part when I say listening there's two
ways that hook EO can listen for events
on the internet it can pull which is not
really a traditional way of listening
since it's actually going out and
pulling a resource but what happens is
that hook you can actively you know
request a resource on an interval which
is polling and it's going to listen for
a change listen for content listen for
something or Tokyo can use sockets ochio
will open up a socket and wait for data
so if you think of a restful web hook
that's really just an HTTP socket
waiting for an incoming connection
actions so in a web hook definition we
have actions well what are they they're
just arbitrary action
they can be literally anything it
doesn't even need to be over the wire it
could be something for system
administration who knows in most cases
it will be an outgoing HTTP request so
kind of look at a little bit of code
here this is a sample hookie Oh webhook
listener this is for incoming HTTP
requests so if you take a look at this
code there's not really too much going
on here we define the definition we give
it a configuration and then we give it a
handler here we have a hook EO webhook
custom action definition and again
there's not really much going on here
this is for sending emails and all we
have is a config 42 and then the body is
very simple I don't think we have a
subject in here yet and yeah as you can
see these are just common J's modules
and a little bit of Jason in a
definition so it doesn't really look
like they do anything it just looks like
their configuration and validation
options and that's kind of the whole
point is that all the business logic is
uploaded to something we call Tokyo
protocols and probably not the best word
a lot of the problem with working on
this project has kind of been defining
new definitions as we go along so a
hookie Oh protocol is just a cluster of
business logic for doing stuff in most
cases your hook yo protocol would be a
thin wrapper for communicating with a
third party aap I also hook your
protocols are valid common J's modules
so what protocols are available in Tokyo
the first version um we've got a bunch
of stuff in here you know we can parse
hamill markdown mustache we can
communicate with s3 we can communicate
with Twitter they're streaming API and
they're playing API we have a timer
which is what a lot of the polling is
based off of it's an interval we have a
documentation protocol which is pretty
sweet recently just got mints going I
don't know if you guys know about this
it's a documentation project for node.js
applications and JavaScript applications
which is pretty sweet so the
documentation protocol every time hook
yo starts up for the first time we
actually auto generate the documentation
based on some static markdown files and
then based on the ex
words from our common J's modules so if
you're making changes in the code and
you restart the application its Auto
documented instantly which is pretty
neat and again protocols are just
clusters of logic so for instance the
HTTP protocol handles incoming HTTP
connections and outgoing HTTP
connections but you can make a hook yo
protocol for anything okay so let's back
up a second how did I build all of these
protocols and right fifteen thousand
lines of code in two months I didn't the
trick is sub modules nodejs has a really
strong community and there's a lot of
really good people doing really good
work and I've just been stealing at all
so um but going back to protocols this
is kind of what we have right now and
what we're planning for the next release
we're going to have github API access
we're going to have a get protocol for
doing system level get stuff working on
a really cool RSS burner parser from you
know aggregating a bunch of RSS feeds we
want to integrate with the Facebook
Connect API and then some of the really
interesting stuff is I've been working
with my friend Eli who did jas Tom he
goes by Templar if anybody knows him
we're working on doing server side
support for Yui which came out a few
weeks ago jquery and just HTML parsing
so the interesting thing here is that we
can begin to scrape pages and then
perform client-side selectors server
side so you don't need to learn any new
selector library if you're familiar with
jquery your sizzle or yui you can start
to use that stuff server side so i'm
sure a lot of people here have had to
deal with scraping static web pages and
it's a pain in the ass the traditional
approach is you know pearl and a whole
bunch of reg ex going back a few years
and it just doesn't work so being able
to leverage some of these existing
technologies which have been really well
defined on the front end is a very
interesting thing so yes the node
community is awesome I've gotten a lot
of help there's a lot of really good
people writing modules github is pretty
amazing as well everyone's on github
that's um involved the node community
you know you can I need to go tell you
guys how github works I like to think
I'm a core contributor but I
and submitted anything to note itself I
just yell at other people to fix their
modules which is kind of fun I'm in the
IRC room all the time I might be the
most active person there in there right
now go back to that so hooky oh the
development plan like I stated before
really I'm not trying to reinvent any
wheels people are doing really good work
and I just want to leverage that so the
current plan is to just fork and steal
all of the best common Jas modules and
then for can steal all the best work
from the node community and then of
course integrate with every single web
service we can find create a lot of
github issues and hope somebody fixes
them I like to join the github IRC room
on occasion and say hey I've been
creating issues on my github project but
nobody's fixing them is github down yeah
they don't like that too much and of
course part of the development plan is
to yell at more people on IRC so now
that we've kind of talked about what
hooky Oh is like well how could we use
it how could I build an application on
hooky Oh as a developer so first I kind
of want to talk about the hook EO API so
the API for hooky o is exposed through
different interfaces so you can
communicate to the API through many
different ways json-rpc is the current
way that it's exposed but we'll get a
little bit into that later so at the
lowest level the hook EO API is exposed
through a common J's module so you just
require hook view of the commonjs module
and then you have access to hook Yoda
API which is the top level API calls
some other interesting things is that if
you're importing hookie Oh as a common
j/s module new tend to use it in that
fashion you also have access to the
underscore library by Jeremy are no fees
in here right now underscore is a
functional library for a JavaScript it's
pretty cool you have access to the raw
DB command so if you want to bypass the
API you can just go straight to the DB
layer and start running queries you have
access to hooky ODOT de bug which is
really neat it's an alias for node debug
which is another project I've been
working on it's a synchronous web
console for debugging for node
s so I actually had a few more options
for hokey oh you can log to a file you
can log to the console and of course to
the asynchronous web console and then I
started to add some flow control
libraries by Tim Casswell step is in
there right now which is pretty neat so
now that we have this idea of the hook
gyo API we're going to talk about using
hokey o as a software-as-a-service so
like I said before ochio is a standalone
application a common J's module and a
software-as-a-service so it's a little
confusing because the name of the
project is also the name of the website
which is also the name of the software
as a service which is also the name of a
common j/s module so if you want to use
the software as a service now it's
available at hook do as the JSON RPC
we're going to be investigating exposing
it you know maybe xml-rpc maybe so if
there's a lot of options we can do
working on Jason P support so you can
start doing some cross browsers to I'm
sorry at cross domain stuff so using
hook yo as the software as a service you
can build a standalone client just on
the front and it's just going to talk
over JavaScript so we have a browser
side JavaScript API which wraps the
Tokyo API in je s and then communicates
over the JSON RPC so if you're using
hookie oh you know as a common J's
module you've become familiar with the
API calls it's going to be identical for
the JSON RPC and pretty much anywhere
you expose the API through any interface
all the calls are one to one so you
don't need to learn different things so
okay hook you as a standalone server
really simple all you have to do is just
clone it run the sub-module update will
be doing packaging for later versions
but for now they're sub modules and then
you just node server j/s so the
interesting thing here is if you look at
the actual server JS file all we're
doing is just requiring hookie oh and
starting it up so part of the problem
when I've been developing hook me oh is
that I'm trying to solve a domain
problem that isn't very well defined and
what I was hoping is that I would kind
of cut my presentation a little bit
short and I want to open this up to a QA
so we can kind of talk about web hooks
and the web hook environment I know a
lot of people here have
to deal with this in applications and
I'm kind of curious and get some
feedback about you know what do you
think of web hooks what do you think
Tokyo would you ever consider using a
service like it and what features would
you like to see so um if anyone has any
questions I'd like to kind of turn this
into a QA that's yeah anybody where do
you sort of see the first potential use
of this and like in the industry right
because right now you just have it as a
more of a private project or public
project rather but where do you see it
kind of being hooked into so if you go
to hook that I oh there's actually a
section called business ideas there's a
lot of businesses right now web
businesses that I consider a subset of
pokeo functionality if you look at
something like bit ly like a URL
shortening service and hook EO all that
is is a listener for a unique URL and
then an action which redirects to
another URL so in theory you know you
just kind of replicated the basic
functionality of bit ly right there and
the way that web hooks work in hookie oh
is that you can chain them so you have
the initial action of an incoming URL
and then a redirection so you could put
a couple of hooks in between and then
you could start logging things like
analytics you know where they came from
and so that's like one specific use case
but um there's probably like eight or
ten of them on there there's a lot of
services right now like people are
parsing and scraping HTML from sites and
then there a cure gating that data and
then pushing it somewhere like Tokyo
could really take over a lot of that
stuff into the question
so the general purpose of it is to kind
of monitor or what a job there and
rules are something that once it catches
that then you perform some punk
interaction on average indeed sure so
monitoring a web page would be polar
you'd be pulling like a static resource
so that's one way that hokey o can
listen for things but again it can also
do sockets oh yeah you're just like
listening for some event and then you're
going to perform some arbitrary action
so a lot of the use cases I think will
be for scraping like you're saying you
can start aggregating information from a
static page or you kind of turn it
dynamic so suppose there was a website
you really liked going to and you wanted
to get updates from it but they didn't
have an RSS feed and they didn't have a
mailing list or anything like that you
could set up a polar to check that page
and then when the content updated you
could fire an action maybe send email
then it would send you the contents of
the page so what's your description
there else I guess I'd probably want to
think more about the similarities
so of course so in one of the future
versions of hook you we haven't really
planned it out I want to make cookie o
itself a pop-up sub of note i guess and
i don't think it would be very difficult
to do because to just push those
messages back and forth is you know we
already have most of the functionality
established another user fee I'll go to
my head of gamer testing content on
holidays like is the API up org or
something like that yeah we still a lot
of unit testing working so then we
always do the testing prior to pushing
the code Apple once it's out there if
you know something changes if you're
including gums for
that's failing for rent
something but is this one this would be
rendered JavaScript but definitely outta
there any other questions you do yeah I
can show the live site I was a little
hesitant to do a demo hopefully nobody's
taking it down yet so this is the live
site right now I'm going to probably
load up the local version so there's a
few things going on here sites down so
see if this is up okay so we have some
API unit tests i think the last ones
failing right now awesome so again kind
of the mantra when something happens do
something else so in this case will say
ochio URL visit i'll just say blah and
then we'll say do something else and
then we could say perform arbitrary HTTP
requests or we can say send an email
this is always fun yeah so i don't think
i have send mail setup on this machine
but the idea would be is you you know
you can figure the listener and then you
can figure the action gives you a little
pretty print confirmation of what's
about to happen here you have your web
hook object you have the listener and
then you have the actions array so the
listener is going to be HTTP and you're
going listen for the path of blah so
this means an incoming HTTP request with
this matching path and when that happens
we're going to perform these actions
which is going to be send email with the
values rocks wires from President Obama
Tokyo is awesome what's wrong
okay so this is the protocol would be
the type so the type is the protocol
HTTP and the action protocol would be
send email so in the web book definition
the listener is going to be listening
using the HTTP protocol which we've
defined with these configurations and
then the sent email for the action is
going to be using the send email
protocol which is a very thin wrapper
for my email protocol which we could
probably abstract into something else
and yeah and it's going to send it out
with this definition that answer your
question and then yeah so create this
confirm successful look is successful
and then if we go to front / blah it
found the hook and right now I don't
think it's actually performing the
action it's just kind of bringing it up
and dumping it and that's the action ID
so any other questions
so I'm curious as to exactly how would
we get from listening to actually
scraping content bulova whistling you so
sure yeah so um it's a little hard to
explain without you know a concrete
example to show you but the idea would
be is that when something happens you
would say on a timer right so you say
every 30 seconds I want to perform an
arbitrary HTTP requests right so now
what we haven't really set up yet in
which we're really working on for the
second version for the scraping and the
server-side Dom parsing would be on the
timer this would hit the URL every 30
seconds and then we would have another
hook that would be chained on to this so
when the response came back and the
timer fire we would say take the payload
from that HTTP request and then perform
some custom validation or parsing on it
and then based off that we can fire
another web book yes that's all I I
didn't really go over it here but that's
really where it's going to be going is
some flow control you know many
listeners to many actions and then you
can create complex chains so by creating
simple web hooks in a chain you can
really make some awesome functionality
and then of course you can start
splitting the chain for and then in the
back network
distribute
so there's UJ totally so there's two
approaches here um you could easily just
set up to wikio instances completely
separately and then make them
communicate with each other through
restful web hooks that's kind of the
cheat you could also have been kind of
thinking about I know that um Rick over
there has been working on something
called dealer j/s so like I'm definitely
thinking of being able to set up
clusters of pokeo servers and actually
have them communicate maybe like you
know through a TCP socket opposed to
doing HTTP requests so there's nothing
available right now but that's
definitely planned for the future
anybody else are we done great well
thanks a lot i'm really glad you guys
voted for me and i got the opportunity
to speak here and yeah check out the
check out the site hooked on Io and
check out check me out on github maroc
and uh thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>