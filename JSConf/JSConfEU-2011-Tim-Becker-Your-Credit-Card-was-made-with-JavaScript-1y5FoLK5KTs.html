<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Tim Becker: Your Credit Card was made with JavaScript | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Tim Becker: Your Credit Card was made with JavaScript - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Tim Becker: Your Credit Card was made with JavaScript</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1y5FoLK5KTs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everybody thanks for coming this
is the talk your credit card was made
with JavaScript this is me my handle on
all sorts of wherever social media
Twitter sort of stuff and where I work
and where we created a or produced a
smart card that goes on credit cards for
a poor this was post and in the process
of doing that we didn't just produce the
the module we also did the entire
integration for for this for this
product which included writing the
programs for the machines that actually
produce the cards later on and those
programs are written in JavaScript so
this talk is a bit of a curiosity I
guess most of you won't be programming
credit cards or personalizing credit
cards so it's sort of hard for me it's a
brother abstract topic there's a lot of
bits and bytes and it's kind of boring
so I want to try to get get you guys a
general feeling I think you know some
people are interested in in smart cards
what all this is about how these things
work to just get a general feeling of
how smart card to work have a look at
that at these api's that are used on on
the machines and there's an there's
actually an open-source implementation
that you can that you can run on a
normal laptop which you could use with
just a normal reader to just look into
your cards to see what they're actually
doing and how they work so this is more
of a preparation for you know maybe
hacking a little bit with with the smart
cards that you guys have in your pocket
so basically when I when I said your
credit card is made with JavaScript
we're talking about these things the the
card number that's that's punched into
the card the magstripe data that's
prepared the CVB that's that's that's
calculated and put onto the back of the
card and all of the keys and stuff that
are inside of the that are start inside
of the chip and if there's any questions
you can feel free to just interrupt or
if I'm going too fast or too slow one of
the main so this is the next several
slides are going to be just sort of in
general what smart cards are how they
work and one of the main misconceptions
is that even with the with the mag
stripe is that sort of when you take
your card put it in the ATM the ATM
reads the pin or whatever off of the mag
stripe and then you types of payment and
it compares the two and that the that
the that the chip basically does the
same it's just a store of data but the
chip is really a full computer on the on
the card so what typically happens and
said that the data is exchanged you have
these keys in the card and that apart
that are specific to your card and they
can find themselves into the into the
into the chip this is when the chips in
the factory being produced and when the
merchant who accepts your card what they
will do is they will they will give the
card some data that they won't sign from
the card and just like in your computer
there's a little man inside of it that
can calculate and he has a
us to the to the keys and he can he can
generate a cryptogram which then the
merchant can use to prove towards the
credit card organizations that yes I did
actually have this person in my store
doing this transaction so again just
getting going across some of the things
that if you ever want to play around
with this stuff and it's fairly easy to
play around with that you know that you
need to sort of have heard and this is
going to be really quick the whole thing
is 7816 those are just the ISO norms
that do everything with with chip cards
and this is chip cards in general it's
not specific to credit cards the one in
two is really low physical layer we're
talking centimeters how big the little
module is where it is on a card and
fault and and what the different pads on
the thing mean level three is sort of
this in-between type of thing this is
one of the few pictures and one of the
nice elements in the and the
specification sweet where it's a little
bit higher up it's on a signal level of
how to communicate with the card if
anybody does anything with with hardware
it's it's it's basically just a UART you
could just connect an rs-232 serial
cable to it to a card and talk to it if
you get voltages right there's only two
three terms though out of this that you
would ever come across and that you know
you need to know it's T equals 0 T
equals 1 those are different modes of
communication to the card and the only
thing you need to know about those is
that nobody ever uses t equals 1 and h
er ITR is the thing that the card sends
back to you to identify itself and that
you can identify the card with when you
get one and this next level four is the
area where it gets interesting and this
is what we're also going to see when we
when we look at these when we look at
these api's these are the apd use APD
use or sort of the frames and there
anything from sort of an IP frame all
the way to an HTTP request response pair
they're very reduced but these are all
these define how to talk with the card
on a on a on an application layer their
commands that you sent to the card and
this is what a what a pack up like that
looks like you start off it's always
four bytes the first flight is the class
which is sort of metadata about this it
will the payload be encrypted is this a
is this an ISO standardized command
things like that the second one is the
actual command that's that that's being
performed that could be something like
select a file or an application on the
card or I want to give you I want to
present you attend for me to verify for
me then p1 and p2 are parameters for the
command and then optionally you can send
data then you do an LC where you would
say how many bytes of data you send and
then the bytes that you send and if you
want the command to answer back you
would you would send le the length of
the expected data they sent back so the
way this okay well you can skip over
these bits i think there's different
sorts of files that the whole thing
defines and the files can be more or
less anything they just have names but
the way that they can either be a big
chunk of data they can be variable or
fixed length records they can be
circular buffers so to be a little bit
more concrete how this how this works
this would be an APU that a terminal
sends to to a card and so it starts the
first but the class is 0 the instruction
is a for that means select select an
application on the card the parameter of
for that bit sets has selected by name
please 40 and then I tell it
the name that I want to select so I'm
going to send it e.e bit hex e14 bites
and that last bit if you you're good at
a ski and hex it's one paces DD fo one
that's what all credit cards basically
happens they're based application what
everybody starts out so lightly um and
what you get back is the response code
says word one says we're too usually you
will you would want nine thousand nine
thousand is sort of the sort of the 200
ok of the smart card world 61 is sort of
a almost okay but I can't there's some
technical problems that a card can send
back data in response to a command that
sent it data so this it's it's a bit of
a problem so the 61 says I would like to
send you back data it's technically not
possible though but there's 12 hex bytes
of data I want to send you back so the
next command and these are the only two
commands don't worry that i'm going to
show c0 is a get response it doesn't
take any parameters it doesn't have any
data that it sends but it says I'm
expecting 12 de 12 bytes of data back
from you and in that case the the card
responds with with the data and all this
data is tagged length value people know
deal with Darren coated if people deal
with ssl you might have heard of it so
this is a tag this 6f bite says the
following data is 6f data and 6f happens
to be file meta information there will
be hex 10 bytes of it because the first
two bites already taken up by the
tagging at length the next this is a tag
again and it's a it's filename and we're
back at the file name it was a bytes
long that says
blah and the 9000 that was okay is at
the end good so this level 4 thing these
APD use and files and things that you
can do are sort of like XML they define
a lot of building blocks that you can
use to make a file format but if you
just like so many loads XML you don't
really know anything about the file
format you just know that that's the
building blocks that they're set up on
so there's a bunch of application layer
there's a bunch of higher higher layer
specifications that say well what do how
do we put these building blocks together
to make a contactless payment
application or a something to use it the
photocopier or something like that EMV
is what is the standard specification or
the base specification for all four per
payment protocols visa and master and
different payment schemes make their own
and they basically define make their own
and they're based on an be though and
they define specifics of how terminals
talk to the cards how ATMs talked to the
cards and things like that so and
finally there's a layer above that and
that's what we're at which is which
defines of how to interact with the card
from the outside and basically there's
it's a very small market these people
making these machines that personalized
cards but everybody thought of their own
way of doing things and at one point
they standardized it and strangely
enough they standardized on on XML
script to do that they also do they also
specify other things that are in the
card but this is only going to be the
scripting language so there's a bit of
there's an API that they that they
define and
we're seeing a lot of the things that we
saw before like the t1 and t0 protocols
for the card the status word one status
word of the response there's a send a
pdu command to send bytes to the card it
also contains primitives to deal with
cryptography and especially in cases
like this that you you have hardware
security modules where all the keys are
stored in so you need to access those
one of the problematic things of dealing
with these with this sort of data though
and why why javascript really isn't a to
go to fit all of this was just bites and
that the PO at the point where they were
there that this was specified into South
2003 there or there were no WebGL
buffers there were no no buffers there's
I'm not really even sure how common
joyous deals with character data so they
made up a lot of their own stuff and
there are really heavily influenced by
Java they have two different ways to
deal with these byte buffers are sort of
like java string buffers in that you
can't really do anything with them but
they are mutable although what the
purpose of having a mutable data
structure when you can't do in when you
can't change it around this is sort of
questionable and on the other hand the
immutable string type has all these
operations but that will keep on
creating new byte strings but that sort
of the access into the bits and bytes
world there's another problem with it
that all this is there needs to be XML
in this because these are financial some
so they put their best man on the job
for this and
and what they came out up with is this
of you why you don't really need a pesky
function key word around and curly
braces around your your script you can
just have much more clear and succinct
XML tags wrapped around your your
individual functions and that makes
everything a lot easier to deal with
it's there's all it's it's not very
pretty okay that is how far I wanted to
go because I think a lot of these things
we can if people are interested in this
I think we can get we can we can play
around with these things later what I
was saying that I wanted to do a small
sort of demo this is in case somebody is
interested in trying this stuff out at
home this is the open source
implementation of the JavaScript part of
it and they have a fairly nice
do you know a keyboard to mirror the
displace no
okay I'm gonna have to sort of scoot
around then I guess
okay i don't have the card reader
plugged in ok so
ok so it recognizes the card reader i
can put in i can put in a card now and
ok a card objects slip sugar
and then I
we said that with a constant you can
either turn off the electricity and turn
it on again or or not do that we'll turn
it on and off again just for kicks cold
would be you actually cut off the
electricity to the card warm is you just
tell it to reset itself this is the ATR
actually the these bits here of the
three be and 60 and and are the ATR and
this is sort of this describes the this
describes the card and now well I just
would like to do is what was in the demo
just to like the payment application and
just see how that works so we need to do
one of those byte strings and that was
one pesos yeah one and then you have the
way this works is now you tell it this
is hex or in this case it's not hex it's
a ski that I want the bites of and we
have those bites again so press a length
okay it's 14 that's right and now you
can just do cards and a pdu and that was
the class by it is 0 the instruction is
select I want to select this file is a 4
I want to select it by name so I do that
and then the second parameter is 0 and
finally it has the utility method it
calculates the length of the data I want
to send I just have to give us the data
and i can send that to it and this is
the reply in response this library takes
care of the get response part all in one
go for it and this contains more data
about the file then then my example did
so what the only about done the question
is be like what is the practical use of
this on the I guess the main thing is
really play around with it to see you
can you can use Java for other stuff I
could imagine having a net if you're if
you're doing server-side JavaScript the
actually the only safe way to store
ssl-certificates is is on on smart cards
so this would be nice if I'm sort of
working on that is that you have a small
ffi binding for four node or something
like that that you can that you can
access cards to store your your SSL
credentials or if you're doing some
local sort of things if you're doing
home banking and you have a local
component that does it that you can you
can sometimes in Germany at least you
need a smart card interaction in order
to authenticate to authenticate your
your financial transactions that you
want to do and it's just sort of fun to
play around with and unless of course
you have a job doing it and then it's
fun to good so if there's any questions
I think we're you yeah
see there the money is not on your
credit card the money is resting in your
account that's the problem you could
break your card with it you can also you
can you can block your cart you use it
to block your card if you want to do
that if you want to keep the money from
getting off of out of your account and
then well in Germany there's a thing
called get cod where the money is
actually on the on the chip but they say
that's safe and you couldn't ever
no this is not on the cart at all this
is just on the side of the computer to
talk to the card but the the set of
commands the the EMB the CMV that they
define the language that's spoken by the
card and that's that's the same on every
card which enables you to you know go to
Saudi Arabia and get money from an ATM
there as well so unless you're in this
unless you go to the states where they
don't have chips it's it should it's the
same everywhere there's some subtleties
it's not quite true but and it's also
the same when you're doing NFC or
contactless payment then only the the
bottom the physical layer is exchanged
for rfid and everything above that these
apd use and and all that stays the same
and you would be able to use this
library to talk with the contactless
credit card or an NFC based handy wallet
or something I cell phone wallet or
something like that
okay okay thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>