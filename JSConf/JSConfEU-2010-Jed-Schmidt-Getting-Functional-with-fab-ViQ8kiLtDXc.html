<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2010] Jed Schmidt: Getting Functional with (fab) | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2010] Jed Schmidt: Getting Functional with (fab) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2010] Jed Schmidt: Getting Functional with (fab)</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ViQ8kiLtDXc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone good morning it's good to be
here glad to see so many of you here
after last night that's awesome you know
flightiness talk getting function with
fab unless you are a German speaker than
I guess this would be a title unless you
are a German JavaScript ER in which case
this would be the title so hopefully
that should educate you on where we're
going here getting social with fab my
name is jet Schmidt yeah name is German
but that's where it ends my dad's dad's
that is German that's an awkward
conversation you're a lot so that's been
fun but I'm not I'm a hobbyist
programmer actually translate computer
manuals for living so most of my
language stuff is natural but I really
do enjoy programming and I have a kind
of a weird flavor that I'd like to share
with you I love functions do you guys
love functions functions are seriously
awesome to the best part of JavaScript
do you think do you think does note love
functions yeah all right fire up node
and type that guess what it doesn't
I mean Brian are you here because
seriously that is a WTF but seriously
basically I think you know you be
further like you know javascript is you
know the father is seeing a mother
scheme and you know Brendan Eich is the
Midwife I guess and so it's really you
know a lot of the see parts of it are in
there but there's not a lot of scheme i
like the scheme parts and so we're going
to talk about that I'm going to talk to
you about the problem that has been
talked Tim Caswell talked about it
actually the next speaker tom is going
to talk about the same problem that
exists in kind of this non-blocking
environment I have one just one hack I'm
going to share with you that can make
your code a lot easier that you can
apply that is very functionally oriented
and I'm gonna show you what you can do
with that hack so what is the problem
look at this here's the current schedule
for our block right here and if you if
you guys could go to jays compu / 2010 /
speakers HTML and search for spaghetti
you'll get two hits the presentation
before mine in the presentation after
mine and I to i'm going to talk about
spaghetti code so but if they are non
blocking what looks to you like this
actually runs like this right which is
why non-blocking code is the position
absolute of JavaScript you know all of a
sudden you know you had no concept of
time it was just order but now we have
this concept of time it's just like with
CSS you know everything you know no two
blocks could occupy the same space but
all sudden you have Z index and like you
know it's like just like for you know
CSS book that's kind of a one of the
things they get around I feel like
non-blocking you the same thing for us
so if the code don't block you must call
it rhymes in German in a German accent
at least and so basically I feel like
developers have two choices you could
take the blue pill or the red pill you
can abstract it or attack it with with
this kind of code and so to to kind of
update to a more modern movie reference
you can have someone else do it for you
or you can do it yourself right and so
let's talk about these two choices
abstracting it there are a bunch of
things that people use I'm not one of
them but you know basically if you want
to maintain this illusion that you live
in this synchronous blocking world there
are libraries that will help you do that
but it's not easy you know because you
really have to rewrite this code and so
the guy who really explained it best
does anyone know this is its Jeremy
ashkenaz he is the guy who wrote
coffeescript which is awesome and so
there was a there was actually a branch
of coffee script that called defer and
they basically like let's have this
thing called it for its keyword and then
we'll rewrite your job your coffee
script into code that actually handles
it into you it's just totally you know
you don't actually see all this mess
that's happening and Jeremy said this he
basically says you can't do it and
maintain the one-to-one mapping you
don't have debugging someone else's like
machine generated code that's no good
and so and so he basically gave that
branch the bots the X because he looked
at it and to function like this and then
basically when it was rewritten by
status stratified chance return to this
right and so like you don't want to you
don't have to pluck that I don't know
about that so I think the best option is
take the red pill and attack it but then
you know you get this you know code that
turns into this and you know that
spaghetti code on less you're a German
JavaScript ER you would call it Spence
the code
or if you know if you're Tom you called
a pyramid I'd like to refer to it given
the current movie reference as a Cobb
salad and so we're going to try to see
how we can avoid that because the
abstractions with these generated
frameworks are leaky ER than this venue
in the rain you know you have this pre
compilation step which is annoying
because then you're not dealing with
your actual code and that makes
debugging really hard but then if you do
it yourself then you get these like
nested callbacks you have all the
shadowing and worse so we want to kind
of avoid that by using functions
functions are going to save us here so
here's the hack ready take a look at
this code same could you saw earlier
we're gonna get rid of those because we
don't need those I don't need those if
you use let you will but all right so
are you ready here it is one hack we're
not going to change any characters on
the screen here's all we're going to do
is this that's it you're done all right
cool did you miss that ready here it
again oh then awesome what happened all
right well we accidentally the whole
execution stack right instead of letting
the interpreter decide when stuff would
get executed we did right and so let's
take a look at what actually happened
there people know what's going on here
when they see this code right well
basically the first perp set of friends
we don't need that's the function that
gets called right everything after it
gets passed to that function right so
this setup that's like another function
reference that gets passed and now you
could have a closure that would return
in this case a function in it s because
it represents the state of that function
being called after it was given that
argument right so we can just keep doing
this right you can just load this thing
up with all of these functions right all
right so now let's talk about this thing
right here what is that well it's seen
all the execution stack after it and it
could potentially resume evaluation when
invoked what do we call that anyone what
do we call that it's called a
continuation exactly so basically a
continuation is basically you're running
some code and you stop right and you you
have some sort of object that you could
then reify and then continue execution
so that's we just created a continuation
and then we did it you
streams which is kind of cool we
streamed all of those functions into
this one function streams are very
important as you know malta works on you
know streamy streams or streams are
pretty important I think they're they're
pretty they're going to be a pretty
important data type especially for node
going forward if you'll get all the work
and note it's all around streams so but
streams I mean if they're not an easy
concept for everyone but they're we've
seen them before does anyone know what
what we filled these two spaces in with
any guesses streams are two beer as a
raise are two more beer yes right now
streams at a time as a razor a space
that's it a stream is an array in time
instead of accessing it in memory in
space you get it in time right so it's
like literally just a different
dimension just like we have the idea of
you know CSS position absolute is space
whereas non-blocking code is time it's
the same thing so these two look very
very similar and they should because in
the first in it you're passing it
basically in a right ah it's an
arguments object I know but it's
basically an array in the second one
you're actually sending things to it
multiple times as long as it returns
something to keep listening right so
what's the difference between these two
things well arrays are fast streams are
small you know when you usually have
such a framework that kind of abstracts
it the first thing to go in like a
framework that does like web stuff is
dreams they just buffer everything right
so what ends up happening is you have to
handle these huge bodies that's bad for
memory so arrays are fast cuz you've
accessed everything's already in memory
but streams are small small is important
because small means a small memory
footprint so arrays are eager everything
has to be there once dreams are lazy you
can kind of get it over time whether run
is called immediately synchronously
after a rather clean up is called
immediately asynchrony after run or like
five minutes later does not matter as
long as that state is preserved it's a
raise or sink they're all their streams
are but does they do not have to be but
they can be a sink so that's kind of an
important thing and that's it that's
back okay so what's the upshot from this
well I've developed a framework called
fab which basically takes care of that
that kind of exploits this kind of
streaming and so basically it love
functions it's a functional framework
and so it's basically originally modeled
on jquery
this is not true anymore but basically
what I looked at you know you know
jQuery is traversing over the Dom we
have routing / URLs yes oh really sorry
all right anyway any questions thank you
for that every to that any questions I
feel like I've been scolded by my German
school teacher so my mom told me to slow
down dude tragedy where he was where he
would traverse over Dom you route / URLs
where you would manipulate a Dom you
respond to calls to your web server
where you would have UI events you have
HTTP verbs so I'm like that's kind of
cool map so let's take this you ah this
dsl you guys already know probably
unless you're Rebecca and then you would
replace it just kidding scoop you would
replace it with this it's like these are
come on the same thing right and so I
was like that's kind of cool cool thing
so that's how fab started there is
actually fab is find and bind because I
basically co-opted those two jquery
methods all right so but jquery wasn't
really cutting it for me didn't really
match right jquery have this huge DOM
everything is synchronous you know in
terms of manipulating the chain I like
the chain but I didn't like the
synchrony so I got inspiration somewhere
else and that was UNIX so unix chaining
basically looks like this right so I'm
not a UNIX guy I'm just kind of faking
it here but the idea is that you know
every every little program you have as
an input as an output right and so
that's really cool for frameworks if you
look for the frameworks that are really
cool like for example look where rails
went look we're so not sure when they
all went to rack right because rack is
good for middle where everyone's going
to middle where it makes sense the thing
about fab the entire thing is middle
where you saw those streaming functions
fab uses that and those basically every
function every app is middleware that
operates on a stream even the app
definition itself there's no difference
between a app and a response a app is
just a response that hasn't been
evaluated completely yet right so you
stream things some of those things are
functions that you would then
later so there were a bunch of things
how am i doing that time i doing okay
1230 i started 20 15 I can do okay I
want boilerplate I want to keep it as
small as possible I want it to be
natural nope no compilation step I
wanted to be JavaScript I don't want to
write some other language some franken
language I want it to be consistent I
don't want you know like kind of
different classes of things I want
everything to be a function I want it to
be clean no global pollution an
ambiguous no mandatory magic the first
thing frameworks do to solve an abstract
away problem is give you all these likes
play methods everywhere that make it
really easy to pick up but really hard
to scale I want to avoid that so if
you're this magic it's yours no shared
state that's obviously a functional
programming thing can't be synchronous
of course very low side effect ver gala
therrien I don't like the system of well
there's apps and then there's your
plugins I want those all to be on the
same level and I want it to be
composable so you should be able to
create apps and those apps should go
into other apps so fab is two things
okay the first thing is fab as a pattern
every single fab app every single one
looks like this okay take a while for
this decision it's really not that hard
basically the idea is you have a
function every function the first thing
it does it takes a call back that's the
function it's going to write it to
answer to okay then it returns another
function that is going to listen to
everything they come subsequently right
until it hears nothing right and then
it's like okay I'm done so usually what
happens at this end step you here at
they see right there it'll actually
return the original right function
passed in 1st right when it sees the end
it gives control back to whatever was
before it does that make sense the idea
here is you're using callbacks to pass
data asynchronously and you're using
return to pass control synchronously
right so you're passing control
synchronously and so fab is also a
library right so it's basically a
library of just all of its a flat
library if you go actually the git
repository it's literally just a flat
list of all of these functions there's
no hierarchy at all each one could be
put anywhere so what are these video
notes these libraries so like I really
like this units philosophy of keeping it
small so literally f
zipping which you know only is to show
not so much how small it is but I think
it's the most canonical way of
representing of sorry comparing two
libraries this is the size of each of
these functions each of these apps I
mean this is one of the few frameworks
that you actually might even you know
enter json' cake probably not you would
probably takes a bunch stuff out of it
but everything is very small and so I
guess the only thing left to do given
that I didn't complete my slides
entirely is to show you how it works and
so there's going to be some live coding
addition we're going to build a nap
right here so I'm going to roll up my
sleeves and we're going to switch over
to text Wrangler because that's how I
roll any questions well I'm really gonna
sleep
alright cool let's get out of this
keynote hell okay cool here is a text
editor okay cool so what does it look
like well it looks like this everything
is nap every app is on the same level
including your rep you know like a lot
of times you would have a library and
you would have an app and the app
requires the library and it does it's
tough the thing is your apps are also
libraries right everything's gonna wear
so basically everything is looks the
same so we're going to use this yeah I'm
sorry I should really fix up man
everything here on my screen it's like
weirdly fat like I'm looking at Sun woo
music video hold on it's that it's that
ok that's probably a little small but
we'll see what it work it's a so far ok
um alright so you've seen this pattern
before I'm not a huge fan of this to be
honest function
um alright cool so exports because we're
going to basically co-opt exports should
be asynchronous it should be a function
it shouldn't be assigning something
honestly not a fan but whatever I will
yield for that system and implement it
myself so basically we're going to do
this we're going to return exports and
we're gonna call it with our app what
are we going to do well it's just going
to say hello ok cool that's a wrap all
right you can really start small it's
not a huge thing right so all this app
gets is this exports thing and it just
so basically gets a pipe and you're
right to it ok cool so if we ran this
hello that I want to see that ok we just
ran a nap all right you see what happen
yay that's cool right so fab is not
necessarily a web framework if thank you
fab is not necessarily a web framework
right at web is just a part of it so
let's actually do some web and to do
that we gotta we gotta imports and stuff
and again same thing I don't think
require should be synchronous and it
requires a synchronous but you know a
lot of people who are much smarter than
me disagree so that's ok but I'm gonna
do it myself so basically you get two
things here actually i lied one is
imports imports basically wraps required
but it makes it a synchronous I don't
think I don't want a synchronous
necessarily because I need it to be
somewhere else in Bangladesh when I get
the file I just want to use one API for
everything that's why I believe in
asynchronous this thing is really feel
like a Backstreet Boy alright cool so
almost you almost had me so let's import
stuff we're gonna use function not
function this time alright cool so let's
put this in your yay ok so that's that's
actually does the same exact thing which
is imported nothing in this case right
so now we're going to import let's see
well what do we need to run a web server
we need like a listener well first of
all we need to actually run this
function this actually is not running
it's just literally sending something
right so we're in need something called
run we're also going to need a no
no listen right because basically we
want note to be able to listen to stuff
this is a huge hack by the way I love
this do you guys know what's going on
here I'm basically taking your call and
this is optional so don't get too upset
about it I'm basically taking your call
back and to stringing it and sucking out
your arguments and looking at those
strings then going required myself but
that's totally optional after right here
you could put arguments and do it
explicitly but i think it's myself ok
cool so now what we're going to do is
they're actually going to return run and
then so run basically just evaluate the
stream and so the first thing we do here
in the stream is we do node oops sorry
jquery sorry node listen we're going to
listen on a port my favorite port
sorry and then actually here so the
thing is we we don't export it so we're
actually gonna leave so run it's just
another function the first thing it
takes is is its call back right but
there's no we don't to actually send to
the standard out so we're actually leave
that blank and then so we have this
thing here and this is kind of cool
because it looks like Marco but it's not
it's pure JavaScript and so we're gonna
run this hello yay web server oh alright
cool and this is actually going to get a
little bit messy so I think what I'm
gonna do is put this down here this is
for Isaac thank you alright cool so
right so we're going to we're gonna pull
some more stuff so we have all this
library of these tiny functions so
what's the first thing you want to do in
a web framework we have okay with web
servers just returning hello what else
do we want to do yeah like a root okay
cool we have that it's a tiny app it's
called root thank you check is coming
and so let's root so what does it look
like I don't want to create a lot again
what am I claims about these web
frameworks is they all create like their
own special syntax you have a syntax for
matching strings it's called red X ok
Reeve that and so here's I'm going to do
I'm going to wrote and I'm going to do
it on this is going to have to met this
is going to have to match the root path
all right cool all right
right that's a block okay and then if it
doesn't match we will return not found
and that will status for oki all right
does everyone understand what's going on
here all right should be pretty easy it
looks to us I've invented this it looks
like it's indented it's it's not Python
indentation is meaningless each app is
responsible for knowing what happens
here's what Rupe does when root is
called it's like give me a stream give
me a stream give me a stream right
actually I did this wrong I Paul does
it's like give me a stream until it sees
stop this should be out here right until
it sees stop and then it says okay
everything that I just got in that
stream if it matches I'm going to I'm
going to reify that stream if it doesn't
match i'm going to refi the next dream
so if this worked properly what should
happen now when we read this oops we
reboot this thing is that I still get
hello but if I take some weary path like
it not found okay is that cool they're
gonna get that really really all right
you want to see the source it's really
that bad it's earlier than others not so
bad so what does we do all right well
basically this is it we have something
called stream stream just basically
takes a stream and saves it you can
replay it later so get a stream we're
going to call that yes get another
stream we're going to call that no
return a nap right which is just a
function that gets evaluated that looks
for that URL if you have a pattern in
there it'll it'll capture that and store
that in the head and sorry like hit URL
that whatever and if not it'll actually
just keep it alittle just I'm sorry if
it doesn't match it'll go to the second
stream so going back here I guess we
have five minutes left so that worked
alright cool so we routed what else do
we do in a nap well let's for example if
we want to say like hello we wanted to
say like a name like if you want to say
hello mean you could capture something
there and so all that would look like is
basically
actually you know what let's do HTML
first HTML actually you know I'm going
to slide back because I'm only five
minutes left I'm going to tell you about
HTML I have an HTML ideas about HTML
template is like the literally the
biggest thing and the node modules it's
like the biggest less after databases
right it's huge there's a zillion
templates and they all do it differently
and I'm not a huge fan of any of them so
i created my own it's called fab market
language and so all right so all right
so if you created a template what would
it look like mustache is awesome i
really like mustache a lot of like you
know the power of rustics what's it
called but basically here's I I think it
Maps pretty well ok we have HTML we have
JavaScript right so like are you with me
all right good okay all right sure okay
sure close that and your contents and
close that okay these are identical
okay that's a win I think cuz it's like
you don't have to learn anything I have
to learn that like you know since I
means this and it's like I don't want to
reinvent pearl in the template engine
and so basically what your HTML app
looks like is this right take a pipe
right the open tag push everything
through as long as there's data when
data ends all right push the close tag
that's it's really easy there's a
special case in this that I'm not
showing here for I'm sorry I'd like your
argument what you call those attributes
but that's basically it you know all
right right the div return this function
if there's data right it return read
really back when data ends right there
okay cool and so basically what we can
do here at this point is import HTML
right and so and here's you guys this is
where you might deport with me all right
you see we're doing here is the
namespace all this thing is a namespace
for each element but what that means is
we can do like really cool stuff left
except actually what we can do this we
can actually put this around the route
we can put this here so we can go you
know HTML body you know ID equals you
know James Jaya school and then mmm
that's here actually whole what I do
hope that this year to you right we want
this not found to be in there so
basically instead of having a router in
front of your app your router is your
appt your router is just another app in
this chain you can route anywhere you
mean of course you can abused this and
your code can look like PHP but you
don't have to i mean you could you could
put it wherever you want but the idea is
that it's super easy to get started oh
man get there whoo there it is right
there's enough phone okay HTML and again
this entire thing is asynchronous this
think it's it forever okay check this
out how much done
am I done I got two minutes check this
out I have something called sleep what
do you think this does is it synchronous
who thinks at synchronous you guys know
me so well all right cool let's put it
right here I want to sleep for a second
that's pretty dangerous right but no
what is sleep do as soon as it's called
it gets a stream of everything that's
left and it saves that and it's like it
does its thing and when it's over it
just replace it right and you can do
that because you've all the state in
your application is in this chain that
function knows exactly what's happening
and that's the benefit of using the
style and so if this works i havenít
winner yet this should take a while
right and so actually you can keep doing
that so I can just go like Bam Bam Bam
Bam and then what I can do is actually
let's see if this works I can go over
here and go do this I hope this works oh
I'm sorry did it oh I didn't I yeah if I
forget what we started
right that's for free you didn't have to
do any sort of marshalling of anything
like that's kind of cool right it's just
just as long as you can you know control
yourself enough to conform to this kind
of spec stuff like that is easy and that
you sound you slide again fast forward
through this is it thank you
it is paper compliant thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>