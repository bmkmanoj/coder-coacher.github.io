<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ben Schwarz: Real world connectivity: Beyond the bubble | JSConf EU 2017 | Coder Coacher - Coaching Coders</title><meta content="Ben Schwarz: Real world connectivity: Beyond the bubble | JSConf EU 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ben Schwarz: Real world connectivity: Beyond the bubble | JSConf EU 2017</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rwyZc1keSew" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you
hello
how we doing doing good my mother
doesn't know what I do so this isn't
going to help her but if everyone can
just yell yeah as I just as I come
around okay mom just I don't know that
was fun
so look yet my name is Ben Schwartz I'm
from Melbourne Australia and as Karolina
mentioned I've been coming here for a
few years and it's my favorite
conference anywhere in the world to come
so to be able to come and speak is
actually a really huge privilege so
thank you to everyone for making it
great for me to be here my talk today is
called beyond the bubble and what I hope
to achieve is to is to give you some
some context that maybe you haven't
maybe necessarily considered you know as
part of here as part of your day jobs
when when we usually talk about
performance we talk about how quickly
pages load we talk about how much money
Amazon made when they made something
half a second faster but often that's
that's kind of really as far as we go
which i think is really sad because
performance is a pillar of user
experience and yet every aspect of
performance work that we're doing right
now seems to be a bit of an afterthought
sites are often deployed to production
and then we say all right let's see how
this performs and if the results are
disappointing then you know maybe we
then go and do our best to see what we
can do but often we have to just move on
because there isn't the time there's in
the budget and nobody's really sort of
committed to it by that point and we're
still when we're doing this we're doing
this with you know when we're building
these sites and apps and these
manses we're doing it using a $3,000
computer or $1000 phone and you're doing
it on localhost and of course it's going
to be fast so if I think it's our job to
understand that context a little bit
better and so hopefully we'll get there
today I'm the founder of a company
called calibre it's a reasonably young
company it's so young in fact that I'm
the sole Ocala founder and the only
person in the company I do everything
and what that what that really means I'm
full-time now I became full-time in
January and ultimately that means that
every day I'm helping to build tools to
make a web faster or you know helping to
try to contribute to that or I'm doing
audits for people or undying in to stack
traces and you know I'm kind of just
doing that performance work that you
would maybe do if you had the time but
it's all I'm doing right now so I hope I
hope through that you know you'll in
maybe enjoy the talk ahead so I thought
it would be really interesting to look
at somewhere where time really equalled
money and and in the last thirty years
we've been trying to reduce latency
between locations but somewhere where it
was really sort of hyper focused was in
the stock exchanges between Chicago and
New York and every you know every few
milliseconds that you save you said
literally billion or you make literally
billions of dollars and in the mid-1980s
the round trip latency was about 14 and
1/2 milliseconds and this was cut by a
millisecond and a half in 2010 by it
just they shortened the physical fiber
route that it actually took but in 2012
they thought hey this is some this is
this is too slow so we're going to try
and do something else and if you look in
this this cow field somewhere between
New York and Chicago you'll see that
that large Tower there and that's that's
actually a microwave Tower and these
these towers were able
using these towers they actually able to
get that connection speed right down to
like four point two to five point two
milliseconds which is as you can see a
huge improvement 3x over of where we
sort of started back in the eighties
interestingly enough these these towers
were when they were constructed they
were buying up little plots of farmland
in between and I think some of these
towers they had to they actually had to
pay these farmers 500 you know in the
south in the regions of five hundred
million dollars to just put tower there
and I think that's that's particularly
interesting because I think when we're
building sites and apps and we're
throwing them in a browser and we're
we're you know we're delivering this
HTML right and as you saw in a tease
talk you know now we're getting a little
bit better at detecting the resources
that are in the page and then pre
getting them but up until now what we've
been doing is this we're just throwing
things down at the customer and we're
just saying just take it all I don't I
don't care about you but whether on your
on a tiny phone with a really slow CPU
or you know maybe you've used all your
data plan like I have here in Berlin
already in a week we're not really doing
enough here so I'm going to take you
through some stats about the global the
state of global connectivity and yeah
okay so right now there are seven point
four billion people on the planet forty
six percent of them have access to be an
init which means that we're actually
we're actually at a point where there's
full billion people who don't have any
access to the Internet at all we're only
halfway there we're not even halfway
there yet so why don't we have a look at
how quickly the Internet is growing and
if you are thinking well maybe a Europe
is getting better connectivity maybe
it's maybe it's us there's 300 million
people there maybe it's in Australia
where I'm from and we're really trying
to build a faster internet but
struggling it isn't really
sort of
in that in that bubble that we're in
right now today if you look at India
just last year there Internet users grew
by 108 million people which if you in
case you were wondering and you haven't
checked Google recently that's more than
the population of Germany and this is 30
percent year-on-year from the year
previously if those match numbers are
matched again this year that'll be a
hundred and forty million people Airtel
who are the largest carrier have two
hundred and fifty-five million customers
this is just people who have a phone
plan and this that is actually I you
know last time I research this that it's
gone up by five million subscribers and
their share has actually fallen from 32%
of the marketplace truly truly
incredible numbers but in India only 65%
of the 1.2 billion - sorry - 65 % of the
1.2 billion don't have access to
Internet to the Internet so that means
that's 864 million people who are yet to
get the Internet they're about to and
that's essentially the population of
China again I took some time to look at
what data costs in different locations
and so the way that I came up with with
these numbers here is I took a prepaid
plan which is usually cheaper than a
postpaid plan and I took the minimum
wage of these countries and I calculated
how many hours would you have to work
just to get 500 mix of data in India as
you can see it's 17 hours but in Germany
it's actually less than one hour
so our let's call it data addiction
isn't quite met with the same enthusiasm
in other places in the world could I get
some water
that could be one hour for eight songs
on Spotify six minutes of YouTube and
less than an hour of playing games or
which I think a much more fun step you
could go to the verge empty your cache
and hit reload thirty-eight times but
even if you can afford the Internet
you're not necessarily going to get fast
internet all the time back in Melbourne
last year I lived on the wrong side of
the street to get cable connections so I
ended up having DSL and it was a lot
slower than it should have been even if
you have LTE advertised on your phone
you may not get the same LTE speeds in
Singapore the average is capping out at
about 50 mega second which is actually
super super great but if you look down
at India it's just doing 6.39 and bit of
second so it's very different no matter
where you are in the world I had a look
at German internet plans because I'm
Australian and then you know it's very
different here and I saw that there are
400 MB of connections available this was
about I found a plan that over the
period of a year worked out to about 30
euros a month with a contract and
everything like that but you could get a
400 MB connection to your house so
putting it on a global scale does anyone
want to guess where the global average
for connection speed would be just shout
out numbers to one guy one guy has an
answer there's 800 people 5050 okay it's
actually seven this is the global
average so this is you know it's pulled
down by some places and pulled up by
others I thought maybe we could look at
the mobile speed in Canada which is
covering the Americas region
the best average of the highest average
speed 10.3 in Australia
for asia-pacific 13/4 United Kingdom
Europe it was 26.8 and the UAE for the
Middle East Africa region was 17.2 but
it goes further than that sixty percent
of all global mobile connections are
actually to G so we know that even if
you do have LTE you can't really assume
it's gonna be fast and on average we're
only doing seven M bit a second seven
quick and good devices most devices on
the web our handsets this has been the
case since 2014 and I thought maybe I
would have a look you know I have an
iPhone in my pocket and I'm sure a lot
of you do too and maybe use an Android
and that's cool too if you have thought
about the devices that people use in
other locations I don't look here are
the top five devices for three three
regions China had three phones that I
had never heard of and they were selling
they were selling enough devices to
cover the population of my country
multiple times over a year so that's
that's reasonably significant the I
don't know hands in India is
corresponding to the it's very mixed
market but it's a big collection of
devices so I got to wondering is there a
single device that best represents
average for us to go and like if we need
to you know we know that all these
devices are super super different how do
we how do we test this and how do we
understand what to do next well thanks
to our friends at Google there has been
some research done into this at the
moment today if you were to take a
fairly average phone it's not super
expensive I think in Germany it's 180
euros if you were to go and buy one
you'd end up with quad-core CPU two gigs
of RAM decent amount of storage
now this isn't this isn't the slow phone
that people in you know performance
talks like mine will tell you is you
know you have to think about you know
these other people this is a pretty
middle-of-the-road
phone it's not the fastest it's not the
slowest but if you average out global
Global devices this is where you'll end
up and that's really great because you
can test this on webpagetest any day of
the week and they have these actual
devices sitting in data centers around
the world so that's really great
but let's just say that you didn't have
access to a device here's what you can
do go into your chrome dev tools it's
going to play ok go any chrome dev tools
click on the timeline click on capture
settings go to CPU drag it down to five
now I know five is seemingly an abstract
number but if you're in a recent MacBook
Pro you're going to end up with about
the speed of a moto G 4 there's been
some research put into this and
obviously you can try and calibrate your
device and check the JavaScript
performance but if you're looking for a
kind of close enough experience that's
where you should end up so it's five
times 5x slow down but what's clear
after we've looked a little bit of
connectivity and a little bit of devices
that there aren't really any context if
you if you you know go for a proper
average it changes in the you know daily
I like to think that there are two
versions of the Internet there's the one
that we use up and then there's one that
we usually don't and I've been
experiencing a little bit of the column
B in the last couple of weeks here in
Germany and the airplane Wi-Fi I think
at times was actually better than the
air B&amp;amp;B Wi-Fi that I have at the moment
the conference Wi-Fi hasn't been too bad
thank you for for doing really well on
that Jay has come and then there's life
I like why is when your device says that
it's on Wi-Fi but nothing happens and we
know you know we know that the
connections vary and we know that it
might be just cuz you're at the wrong
end of the building and there's too many
brick walls for the Wi-Fi or conference
or a plane or a tunnel or just for
whatever fucking reason your modem needs
restarting again it happens I understand
one thing is clear we need to stop
optimizing for $3,000 computers with
lost connections
devices connections language contacts
they're different for everyone
inconsistency is a major property of the
web in general but now that we're
understanding that we're in a global
landscape you know that it's time that
we start thinking about strategies to
better scale what we're delivering to
people so we should gather some
knowledge and build with more
understanding and more empathy looking a
little bit beyond the delivery of an
asset or looking at how an asset is put
down onto a device
we're generally looking at three things
delivery so this is the time where we're
saying how many scripts are on this page
how big are they what do they what do
they look like is there a lot of JPEGs
okay cool
there's the past cycle so this is when
the browser gets those those assets and
it has to figure something out maybe it
has to decompress the gzip on a resource
maybe it has to pause and compile the
JavaScript maybe it has to get an image
and composite it before it actually
paints it and the last part of that is
runtime these three phases of sort of
performance that we should worry about
and runtime is obviously the actual
runtime or you know we're giving smooth
fluid animations and we're making it
responsive to user input but
unfortunately at the moment the one that
we're really forgetting is this past
time we're throwing down these scripts
at the browser and we're just hoping for
the best this this wonderful graphic is
taken from addy Osmani z-- breanne
graphic sorry brilliant blog post called
JavaScript start of time and it's a
rough kind of hell v8 works or more like
as far as the v8 people tell me how it
will work really soon but and you know
this varies from from engine to engine
but they take your Jas they posit they
turn it into an AST they generate
bytecode they do some optimization stuff
and then they build it for you know they
build it for your architecture but when
you're taking the 410 average script
size this is the average across the web
right this is what we're on average
setting there has been the argument that
maybe we can just like
use that size maybe we can just just
remove a JPEG I won't name names but
this became a bit of a popular thing to
say a couple of years ago but I'll tell
you why it's wrong forget for 10kv it's
not for 10 KB because when you
decompress it it could be 3 to 4
megabytes and it's 3 to 4 megabytes that
your phone has to go and understand
compile and deliver something I took the
J's comfy use side which is actually
really light whoever whoever worked on
it didn't have to do a lot of stuff to
make a pretty pretty website that told
you everything about the conference it I
mean we had 57 KB of scripts and that's
that's jQuery some web stats and a tiny
1 kilobyte fjs and as far as I can tell
all of us for navigation so nothing
really sort of sinister going on there
but when I benchmarked it on desktop
this one and a moto G 4 I found that the
the script time this is all I'm doing is
loading the page and as you can see
we're spending three times the amount of
time just in scripting and why is that
important well it's important because
this is happening in the JavaScript main
thread and this is also blocking paint
and these are these are all the little
things that make your website feel you
know when you're also contending with
web fonts loading and they're loading
and then appearing and then disappearing
and then a different one appears and
then your user is scrolling and it's
janking and then image loads and then
that pops back up you've all seen it
right we're all suspect to it I do it I
took a real side lufthansa I took this
is the mobile side so this is probably
reasonably optimized on average a little
bit bigger than you know than other
stuff and it actually compressed really
really well and again well it was double
it doesn't mean that these numbers are
completely linear you can't say that
it's going to be 600 Kb and that's going
to equal these many seconds you do need
to test this stuff I did start doing
some testing and I thought well let's
say let's do an experiment here I mean
we're job is like at a JavaScript
conference
maybe I can just say delete all of your
JavaScript and you might not like that
so I took the Guardians website The
Guardian have done some fantastic work
Patrick Hammonds who's here spoke two
years ago at CSS comp and he showed all
the really great work he's done at the
Guardian and so I don't want to bash it
up too much but I'm going to show you
something this is the Guardian loading
side by side on the Left we have it
without JavaScript and on the right we
have it with if you didn't see the
version on the left was completely
visible in under five seconds on a 3G
connection Bank done the other side well
there's the font switching loading the
weather appeared and then a related
article appeared at the bottom of the
screen and it stopped rendering
somewhere around the 22 second mark and
unfortunately the 22 second mark is
about the average the average for this
is about 17 seconds so this is not a bad
website this is very very normal
goes a little bit further to of all of
the requests that were you know the
difference between the requests and it
wasn't all JavaScript it was images and
assets and other stuff we with
JavaScript was three point four
megabytes 115 requests and otherwise one
point five nine and sixty one requests
and I think that's a lot to just show
people a related article and weather and
different fonts I don't know about you
but we offered the same experience but
we didn't really we didn't really
improve it and we talked about
progressive enhancement for so long and
yet we're doing this every day
one thing that that I've really noticed
in my time of trying to optimize
websites and trying to build a product
that optimizes websites is that the
metrics that we're currently using
really don't tell us much about the
people I think they're the important
part for a while we've used metrics like
onload on Dom content loaded which is
kind of your everything's ready Dom
ready and speed index which is my
particular favorite to have a little go
at there is a problem with speed index
and it doesn't mean anything to real
humans trying to understand the metrics
either if you ever try to explain this
to your p.m. I have I know people who
put MS after it so that it looks like
seconds good metrics can't be gamed the
on at risk of failure and they aim to
try to explain something here are some
examples of some good metrics first
paint visually complete and time to
Interactive's anyone heard of these any
of them all of them some of you ok cool
I can explain a little bit about what
they are so user navigate we have a
first paint and a first paint is just
when the user sees anything that is in a
white screen we go on we render a little
bit more we have the first contentful
paint and then we have some more graphic
starting to appear the font still
haven't loaded yet and then we get to a
point where we get the meaningful paint
and that means that the text is visible
somebody can actually see something that
means something you know reasonable and
of course visually complete is just when
the area in the viewport is fully
resolved let's call it that's great
these are human centric metrics now
visually complete is a bit of a
difficult one because it's not really
something that you just do get out of
dev tools so how can we how can we
produce these metrics and actually you
know get something out of it thankfully
there's a tool called lighthouse built
by the Google Chrome team and its really
fantastic it comes with a browser
extension and you can just go to a
website click on a generator for it it
loads your site by default in a
Nexus 5x I think and it slows the CPU
down it checks it in an offline mode
it'll give you some stats about how it's
performing as a progressive web app does
that have a serviceworker does it have
recruiter
what is the critical request chain look
like performance and some accessibility
stuff and best practices and that's
really great
a little secret to you know can we just
keep this one else okay
as of Thursday lighthouse actually
dropped into Google Canary Google Chrome
Canary and I'm going to show you how to
how to actually go and get this now so
you need the latest Chrome Canary and
you will animate I imagine yes okay you
need to go to the chrome Flags page
search for dev tools experiments turn
that on then relaunch your browser this
quite a step isn't it go to the thing
that you want to you know and then pop
up your dev tools go to the settings
down here over the experiments you don't
see it right see how it appeared you
have to just press shift it's a little
secret and they then they appear all
those things that you you know you
didn't know we're there then you have to
turn it on close it open it again and
audits to will appear after you've done
that you'll get a little Lighthouse
button and you can perform an audit you
can choose the audits that you want to
do and you'll get some idea of the
performance of your browser I'm not sure
when this is going to reach stable but
they're working really hard on it
Google iOS in a week and a half and the
guys have been working really really
hard so that's really cool we know it
first time first content will paint
first meaningful paint visually complete
all our I'm going to talk to you about
what this other metric that we've heard
a little bit about is it's called time
to visually complete this is how they
calculating it now in lighthouse and I
think it's really really cool so we
watch the timeline and we figure out
when the browser you know is visually
complete and then we're watching the
JavaScript main thread and we're
watching these little subtasks that are
happening
and we're you know we're looking for
ones that are shorter than 50
milliseconds we figure out when there's
a five-second window without a long task
and then we call that first interactive
so it's after it's fully rendered and
when the JavaScript main thread of stops
working and the reason that we do that
is because time to interactive is a
really good way of getting that that
empathy for a user that you know it's
not popping around the web fonts anymore
and it's not jumping up and down it's
not it's not going all over the place so
your target for every device and I'm
talking about the Moto G 4 I'm talking
about all those phones in your pockets
do it in under five seconds or even
better maybe we can actually come up
with some things like the Twitter team
do they have a metric that they call
time to first tweet they've been using
this for years try and find ways of
understanding how your users are using
your apps and sides and get a metric and
track it because it doesn't matter when
onload happens that's totally irrelevant
don't try and keep people on your side
for as long as possible help them get to
their goals and you know do it quickly
and so they can go and do something else
that's far better and I know that the
performance landscape is really fast and
there's so many bits and pieces to worry
about my advice to you is to pick one or
two of them and give them a shot and all
of all of these things that are on the
screen here using a CDN modern aim of
formats like WebP II the purple pattern
all of these will improve website
performance so give one of them a go
test it measure it and improve if you're
wondering where I got any of these stats
from they're from the Akamai's state of
the internet reports anyone seen this
before like ten people I think okay so
it's a quarterly report that Akamai put
out so all my data is from q4 2016 and
it's just a PDF report you can send it
around with your team and you'll see
what all the global averages are the
global average for connection speed went
from six point two million six point two
in bits per second to the seven so we
are actually slowly improving but it's
very slow
and remember you know we've been so
focused on the wealthy Western web for
so long we're just building for the
machines that were using but that's
bullshit we didn't sign up for that we
signed up to build the World Wide Web I
really want to encourage you to try and
make the web fast for everyone that's
what I'm trying to do at caliber and
that's what I'm dedicating all of my
work to at the moment so you know
hopefully you can give caliber a shot if
you don't use lighthouse because that's
great
and if you otherwise want some stickers
or something come see me hook you up
it'll be cool thanks a lot
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>