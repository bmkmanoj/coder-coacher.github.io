<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>hapiDay Oakland 2014 | Brad Harris: The Middle-Tier with hapi | Coder Coacher - Coaching Coders</title><meta content="hapiDay Oakland 2014 | Brad Harris: The Middle-Tier with hapi - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>hapiDay Oakland 2014 | Brad Harris: The Middle-Tier with hapi</b></h2><h5 class="post__date">2015-01-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ayJakb2FKr4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">um yeah so my name's Brad Harris uh I
also work at Yahoo like Reed we work on
different different things and different
areas of the company but it was it was
fun when we found out that that there
were multiple people of us a yahoo both
using happy and in both in different
ways excited to speak with you guys
today I live in Denver Colorado I come
out here once in a while and this
weather kind of sucks but at least it's
not cold and snowy there's some contact
information about me but I've been
working at Yahoo for a couple years I
work I work mostly on different
publishing tools for both internal
partners of Yahoo and external partners
where we have different services that we
provide them and that often means like
creating some sort of an application for
them to access and and see how that
service is working for them and sort of
manipulate and interact with it as we
were building a few of these apps
recently there often just these
client-side applications or interacting
with some different services throughout
the company both old ones and new ones
and and as we we built a couple of them
we found that we were like using the
same services across multiple
applications and we tried a few
different ways of like sharing code
sharing modules to try and keep keep
that code this communicating a sort of
orchestrating that service communication
at least minimize and so we don't
duplicate it we ran into challenges with
with like sharing code and using modules
for that and we'll basically what we
settle on was like pulling all that
service orchestration and service
aggregation into its own dedicated layer
this middle tier and that's mostly what
I wanted to talk about today there's
been some awesome talks on like specific
things was happy whether it's features
how you use a certain thing or why why
choose happy so what I was what I was
hoping to talk about was pick a couple
things that we noticed once we once we
pulled all this like service
orchestration and aggregation out of our
client-side applications and gave it
like a real home that was dedicated to
it there were a few things that we
noticed that we weren't expecting
initially
so I picked a couple of those and
there's a ton of things you could talk
about but I picked a couple that I'm
hoping will be we be useful for some
people here to share those with you you
know aside from the inherit benefits
that you get from like pulling all of
that logic to to sort of normalize that
service communication out of your UI
they're really sees these things that we
I think you could have a whole talk just
on that about like how pulling that out
of your front end application and doing
it somewhere else has all these benefits
for you you I but that'd be a completely
different talk so I want to talk a
little bit about some of the benefits
that we saw so so when we build when we
build a lot of our applications you know
Yahoo's been around for a while so we're
building on on some existing services so
wanna see you buy a raise of hands how
many people out there have built like an
application a website something where
they got to build it on top of like
pristine services basically from the
ground up like they had no baggage no
legacy anything all right so you got
like maybe a quarter of the people here
and then how many people have had the
opposite where they built an application
website something and I've had to
interact with at least like one legacy
system it looks like about everybody and
that's kind of the the reality of
working for any any established company
or company that has been around for a
little while you're going to have to
interact with some legacy services
probably so I got a story so we were
working on this one this piece of our
application this new UI where we have
this this concept or this thing that a
user needed to interact with they needed
to create this thing and and so so we're
coming up with like what's the UI
supposed to look with look like for that
and it was like dead simples like we
need to collect one piece of info for
the user to create this thing so like
that was settled we knew what the you I
was supposed to look like we had to
prompt the user for this thing and we
started interacting with with a team
that was was handling these services for
us for this particular this particular
data structure that we needed to somehow
persist
so we talked with them and explain what
it is that we need it and they came back
said yeah we got something for that will
let me send you the schema for that so
they sent us this thing and we're like
really like this thing there's like 30
fields in it or something we only need
like one of them and they're like well
this is how you have to persist this
thing because of things like you have to
save it this way I'm I'm taking some
creative liberties a little bit with the
story but but the gist of it was like we
had a very simple thing that we needed
we needed from a UI perspective and all
son got like very complicated once we
needed to interact with these services
so so we were thinking like you know
there's a lot of ways to handle that you
can build like a very simple sort of
mapping layer in your UI to try and
create an abstraction it makes sense for
the UI but then converts it to something
like this or whatever it is that you
need when you when you talk to that
service initially that's sort of a path
that we took but like as we had that
like that mapping layer or that
abstraction we were trying to do it in
the UI like it just feels fake because
it's like right there next to it it
didn't feel like like it was a real
abstraction and and I as we got into it
it actually ended up being that we had
like two different UI concepts that both
like needed to be persisted in the same
data structure in slightly different
ways so that that's where like we found
we found this benefit of like creating
these tailor-fit abstractions for our
you is so in one case like we had two
different data structures for our you is
that that were like exactly what we
needed for the UI no more no less and
and creating those you know those
abstractions and putting them in this
middle tier it had an interesting effect
because like as soon as you have like a
set of dedicated routes to something you
know an actual model that represents it
so a set of these resources dedicated to
the subtraction like it becomes more
real for some reason
and the you I can treat it that way and
it's not it's you know it's it's a it's
a lot harder to sort of budget and just
you know let the abstraction leak into
what that big huge thing was that that
you really want to kind of hide from
your UI so but that doesn't come without
overhead like as you create you know you
want to create all these abstractions
that are tailored fit for your UI
there's overhead of like creating routes
and then having to maintain those you
know you want to make sure that they're
validated correctly and I think that's
where like some of the stuff that's been
talked about earlier that Regis talked
down with joy like it makes it really
easy and cheap to do a lot of that stuff
you can even at the end of each stock
had talked about sharing schemas you can
share schema so you avoid some of that
duplication some of that overhead to
maintaining that stuff so that was one
thing that we did that we found was
really helpful that we weren't really
anticipating that once we created this
dedicated middle tier we'd have a place
to create these abstractions that you
know didn't necessarily exist in some of
the services we were calling but but
they became feasible for our front end
and that had some great great side
effects the other thing that we thought
we noticed so as we were like building
up these these applications and talking
to different services like not all
services are created equal like some of
them some of them you know use status
codes for for how you can detect whether
there was an error whether it did what
you wanted it to do some of them send
you JSON and it's like you know in a
great format that you can look at some
property some of them send you some
string that maybe you have to like match
patterns against and some of them
sometimes send you nothing and that
means it worked or sometimes they send
you nothing for a different route that
means it didn't work and these are all
examples of like something that we have
right now any services that we've talked
with that that we've had to go through
so you know for your UI like if you have
to normalize all that in the UI it's not
only like extra code but it's like it
just becomes a mess and you have to
maintain it it becomes very buggy so so
it's an obvious thing to move to this
middle tier and to normalize all those
crazy services so you have like one
consistent output
or for you you I oops went too far so
and happy has modules that make that
really easy that you know we've talked
about or I don't know if booms been
mentioned but boom like I used to hate
status codes and I built api's in the
past in the past and I always hated like
trying to figure out which I wish status
code am I supposed to use how can I make
sure that like everybody is returning
the right status code at the right time
that were consistent across our API and
boom makes that pretty easy like in
English that people can understand when
you're doing code reviews is pretty
obvious like whether it's doing the
right thing there but we had like we had
these existing front end applications
that were expecting a certain payload
structure of Jason does anyone heard of
Jace and not a lot of people just me all
right there's not a whole lot to it it's
just like a JSON structure that's a
convention for how to send messages back
and forth with certain properties so we
had these you is that were already built
and sort of anticipating that structure
so it was really easy to just tap into
the hooks too happy provides with angry
use the on pre response hook to take
whatever that structure was and then
take like a boom response and then
convert it into something that that was
what our you eyes were expecting which
was this thing and you know did
converting like these four hundred
errors into into failures and 500 into
22 errors and then leaving some
additional properties that we didn't
have before that were helpful but not
that I think that'll be super helpful
for anyone else if you are using James
send which it sounds like nobody else is
out here it could be helpful but it just
for me was it was nice to see how easy
it was it just happened to that hook
well inspect the response we're getting
back it was really easy to see if it was
an error because I was like in is boom
property and then handle it accordingly
and convert it into what our you guys
were expecting and it's something that
if we migrate and change our you eyes
like it's really easy to pull that out
and just leave stuff as as
sort of with vanilla boomers and their
responses so more than anything what
what I'm hoping you get out of this if
you got something out of this other than
the ten-minute nap is that you'll
consider like this middle tier of your
application and like that doesn't
necessarily mean you have an actual like
dedicated layer or dedicated service
like that middle tier if you're talking
with services is probably somewhere and
it might even be in your UI code it
might be through like your UI code to
your node server for your front end like
sprinkle through several places but
consider that and if it's becoming like
hard to consume and manage like try to
try you know think of some of these
things and consider moving it to a
dedicated middle tier one of the things
that we found really helpful for I guess
we hired new engineers when it was all
in one application where is this one UI
that was like you know all the UI code
the front-end code also talking to all
the services it was a lot to bite off
and consume and sort of grok for for new
hires but when you could like break that
out into its own layer and then let
people ease into it as they were
starting to get everything became a lot
easier to maintain so give your your
middle tier the attention that it
deserves it's probably somewhere in your
application already so look for ways
that you can use some of these tools
that the happy ecosystem provides to try
and give it that attention the desserts
make it something beautiful like that
that you can manage and just eat it and
enjoy it one of the things that I really
appreciate about happy is like the
effort that let's put in to making it
very modular it's not just one library
it's it's a series of libraries that you
know like reads that you might use joy
for something that has nothing to do
with HTTP so it's great that there's
these these suite of tools that are like
heavily tested and sort of proven that
the end they work well together but you
don't necessarily have to use them
together so as you sort of give your
middle tier the attention it deserves
like some of the tools that happier
provides whether you use happy like as
an HTTP server or not there's probably
something in that ecosystem that will be
a benefit to you and then there's some
cats and warm fuzzies because everybody
likes cats i'm not really a cat person
but i thought if i showed cats you guys
would like my talk
and like me a little bit anyways all
right thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>