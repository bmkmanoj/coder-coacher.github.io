<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Andy Wingo: DIY Internet: Snappy, Secure Networking with MinimaLT -- JSConf EU 2013 | Coder Coacher - Coaching Coders</title><meta content="Andy Wingo: DIY Internet: Snappy, Secure Networking with MinimaLT -- JSConf EU 2013 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Andy Wingo: DIY Internet: Snappy, Secure Networking with MinimaLT -- JSConf EU 2013</b></h2><h5 class="post__date">2013-11-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/mik7AwHOVcA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you
you
so yeah this is a talk a super nerdy
talk about networking crypto and early
phase tinker and all kinds stuff thanks
for yeah man thanks for coming i hack on
compilers at a company called agalya we
do mostly browser internals so if you
ship WebKit or you should blink or you
ship you know note or v8 or something
like that and you want to participate in
making the web better for your use case
and for everyone now let's get in touch
we can make it happen we recently did
the generators work in v8 and adapted
the generator stuff that existed in
spider monkey so work with a new es6
standard and that was all sponsored by
bloomberg that's the sort of stuff I
normally do and this is not a talk like
that right this is talk about crypto I'm
not a cryptographer and I'm not you know
super network engineer I'm just you know
a tinker and a nerd and so I thought
that you know I saw this paper and I was
like damn I got to play around with this
thing right so this is to talk about
that so the context we're in is you know
the context of you got generals peeping
in on your emails and your google
searches and you know if you search for
the wrong thing if you read the wrong
thing they'll send men with guns right
this is what they did you know recently
if you with the mother that was
searching for a new pressure cooker
while the teenage son as one does was
searching for the Anarchist Cookbook and
you know they sent the SWAT team so I
mean this is just a freaky place to be
in you know it in the world it's just
you know creepy and disgusting and the
the thing it makes me think of more than
anything is that at Tom Waits tune you
know like what's he building in there
he's got subscriptions to those RSS
feeds he's been hacking on minima LT or
in his router and we're in his phone and
you won't believe what we saw from the
drone
what's he building in there what the
hell is he building in there we have a
right to know you know it's like these
assholes are looking at you and the real
solution of course is to smash the state
you know overthrow the political systems
that are you know creating this reality
we live in right now in the meantime you
know as you know people who make the raw
substance of the future we need to make
their jobs a bit more difficult right
and so let's talk about HTTPS HTTPS is
you know it can be fairly secure its
seen the long good life and Wilkin will
see you know even more but if you are
going to attack it you know you have a
number of vectors at your disposal right
now that you know you didn't have maybe
you know five years ago you could do
some serious crypt analysis work on RC
for something you could you know pay off
the certificate authorities to issue you
a rogue certificate and you could use
JavaScript boo boo right in the crime
and beast attacks that we've seen
recently there's been recent talk that
you know some implementations of sea
lice have back doors but I don't think
these are you know the the biggest
vulnerability in HTTPS because for me
it's HTTP right it's the fact that you
can access services in an encrypted
fashion or not encrypted fashion and
often we're doing it in such a way that
everything can be snooped on right so
the biggest enemy to me of HTTPS is HTTP
and dan Jay Bernstein has a competition
that that he and some other folks are
running to come up with a
next-generation stream cipher and they
quote so number of disasters and if you
go visit this web page there's lots of
interesting stories about you know
crypto systems that just broke right and
the worst kind of breaking is when you
just don't get any crypto at all right
and an HTTP has that sort of side of
things so I want to do a poll i always
like doing polls in my talks so how many
of you use the eff HTTPS Everywhere
extension good job
I mean that's really great but obviously
you know it's not all of you and it's
not even me right so how many of you
ever use Google to search you know using
the normal HTTP thing or that has this
in the reverse way so i can't i'm
confusing all of you but you know i know
i searched sometimes often usually
actually over just plain HTTP and it's
just you know it's Nast right so there's
actually a reason for this though you
know it and I think you know you feel it
yourself and it goes down to you know
actual fundamental things about the
internet so i took a packet trace of my
browser which you know i run linux as
any you know tinker and hacker does and
then i actually use epiphany which is a
browser built on WebKit to on the gum
system so i'm super weirdo here but you
know it's a modern web kit to build so
this is very similar to what you have in
your browser's so I at zero milliseconds
I did it get to http now too goood org
right so at zero milliseconds we send
out this syn packet right in the syn
packets saying hey and then 130
milliseconds we get back a packet from
the server saying hey you know it's
exactly like when you pick up the phone
it's like hello hello and from this we
can compute in this particular situation
that I've got a 130 millisecond trip
time or half of that would be the
latency and you know this is not going
to go down like this is bandwidth are
going to go up but this particular kind
of latency obviously this is a
transatlantic one from you know my
french home to the server in Boston but
it can't go down below you know a
certain level that certain level is you
know if you were to take a plane like a
light speed plane you know your latency
would be 45 milliseconds so there is you
know something at which you're not going
to go down and so after I get this syn
ACK I can you know finally send off my
you know get me the page later on I get
the first packet and the in the result
and I can start to parse it right and so
I realize okay I got some CSS and some
JavaScript and all the things and so I
can't actually ask for anything else
over this same connection so I fire off
three
in this particular case parallel
connections so three more sin packets go
out to guna org I finally get the end of
my request like the end of the response
back at 410 milliseconds and then in
super sad panda mode you know well I
finally get my parallel connections
opened after I've gotten the first
document and only then can I make the
other round trip necessary to actually
start fetching the auxiliary resources
so I mean this is our internet and you
know I don't know this is half a second
and it's horrible well yeah so this is
even not very many bites so it's not a
bandwidth question at all it's
completely latency driven and of course
you know with HTTPS as we all know it
just gets much worse so sin I get back
my syn ACK i sent off my you know client
hello thing server comes back and says
hello we do the certificate exchange
dance at this particular case and this
just blew my mind right when I saw it
for some reason we wait for the act for
the server so that it received our
certificate change packet to then send
another thing saying change cypher and I
don't know if this is a bug in my
networking stack or if it's something
more fundamental because I wasn't
intending to you know do a deep
investigation on TLS in this particular
case but I don't know this is a sort of
you know multiple round trips thing to
set up a secure network connection that
it's really horrible i can i can only
start to send my request you know i've
been talking back and forth and back and
forth and wasted an entire half a second
right i would have gotten the result
before using HTTP but i'm only now just
asking for it using https to finally get
back the result that almost a second in
and only now you know only at that half
a second the when i get back the first
packet which is somewhere in between
this 583 and 764 milliseconds are we are
we actually starting to kick off the
parallel connections which do the same
thing x 3 you know and this is why it's
slow like this is why the internet is
slow and it's fundamental because i'm
doing this cynic dance for nothing right
for nothing you know i'm saying you know
hello hello establish me a connection is
not even secure so there is readers room
here for a protocol which for
provides properly implemented strong
crypto a phrase which you might
recognize from the first Snowden
interview like that this is what works
right properly implemented strong crypto
that connects faster than TCP I like
that this is a possibility so this is
something that probably will happen at
some point and this particular talk is a
kind of early technological preview the
the preprint on this paper for minima LT
this new protocol just came out in May
so it's it's early days yet still you
know making and breaking but you know
this could be a sort of future glimpse
on the internet so I want to talk about
the two parts so properly implemented
strong crypto part and the faster than
TCP part minimality uses a high-level
knakal library yes it's actually
pronounced salt I always say knakal from
DJ B and Tanya lang hash breaker and
hyper lipstick on the Crypt on the
twitters and doing a fresh protocol
actually can make things much more
secure because you can design things
sensibly from the ground up you don't
have to include like a bunch of broken
ciphers you don't have to include the
null cipher you know the opportunity to
make a connection in plain text mode you
can make sure that by default your
implementations of the crypto primitives
are not vulnerable to these various
timing attacks that we've been seeing
recently and I know it's just like an
opinionated high level base on which to
work and the salt library has been out
and crypto analyzed a bit still
relatively new you know but but it seems
like a solid thing and on top of that
minimality adds forward secrecy layer so
that if someone breaks into either side
and manages to get all the private keys
on the server or the client they won't
be able to decrypt previous connection
so that's that's what that is and it's
minimal latency right the equivalent of
DNS and min melty includes a sort of
equivalent to DNS requires one round
trip and otherwise zero in theory you
can send your sort of hello packet which
opens the connect
and include the equivalent of the HTTP
GET request in that first packet so you
don't actually need a round trip in the
beginning and furthermore your
connection can be it's actually a tunnel
there are connections inside tunnels
your tunnel can be persistent they can
live a long time it can persist over IP
changes so you don't need to do some
particular parts of the protocol set up
every time you work so you can start
working at home like reading your
Twitter's or whatever and you get on the
train and as the GSM changes your IP you
know it's still persisting on the same
tunnel without you know seamlessly
changing you over IPS without needing
the application layer to do recovery and
reconnection logic so it can it can make
things a lot faster in that case and in
addition you know so you're designing a
protocol today you have to base it on
UDP or TCP all right otherwise it
doesn't get through the internet and
minimality is based on UDP it adds a
reliability layer so it's sort of
equivalent to TCPS reliability it adds
crypto as well so it sort of folds in
what would be a TLS layer as well so it
packs them in into one sort of layer
violating protocol but you know I think
it comes with a lot of advantages and
and it seems to be okay it's also
resistant to a denial of service attacks
which is another important detail when
designing there's sort of a family of
this kind of protocol coming out right
now and and resistance of denial of
service is one thing that that all of
them are struggling with and minimal LT
seems to have a good solution although
there are some some details will touch
on a little bit later and it's fast it's
really fast it's really fast when you're
you know running full speed you can
saturate your multiple gigabit links and
it can connect it very high rates as
well so will poke at that so their
tunnels and connections inside the
tunnel the first time you create the
tunnel you have one connection its
connection 0 it's a distinguished
connection and that's the one that
actually allows you to create other
connections so you would make you know
your tunnel and you would
I opened me a connection to the HTTP
service and then on that connection
which you provide that connection number
you would say get me index.html and at
the same time you could add open other
connections and get other resources also
connection 0 is for authentication the
minim LT includes something that's like
client-side certificates it's an
equivalent basically but i won't go more
into that and the multiple connections
yep can proceed that at the same time
although the precise congestion control
details differ a little bit from quick
which is a new protocol from google
that's very similar so you might want to
google both of these to get more
information about them quick seems a bit
more interested in that a packet loss
that affects in the beginning doesn't
delay parallel resource loading in the
end whereas minimality seems to be more
interested in total ordering of all of
the packets even between connections so
they're totally ordered but again see
the paper for details so it wouldn't be
a crypto nerd you know networking
protocol talk without some ascii art so
i'm just busting that out right now i
didn't i didn't have inkscape at the
time that I was making this and so I
didn't ask you art them like that's
awesome leaving that so there are two
parts to a packet all right there's a
clear text part and the ciphertext part
and the clear text includes your
Ethernet headers and your IP headers and
your UDP headers and as 42 bytes in
addition there are 16 more bites half of
that identifies the tunnel and half of
that is a nonce nonce is actually an
English word and I didn't know that and
so it means like the moment the now you
know and it's also pronounced number
used once because that's the thing it's
like a number that just keeps on
incrementing and you combine it with
your secret so you can prevent replay
attacks it's basically that's form and
in addition the first packet includes
your ephemeral public key which as you
can see is only 32 bytes which is the
wild thing about elliptic curve
cryptography you can have keys that
aren't like you know 2048 bits long
they're only 256 bits long or something
like that so that that goes out in the
first packet to establish the shared
secret and then later the tunnel ID
identifies a shared secret for the
server
in a ciphertext you include the flow
control fields the SEC the sequence
number and the acknowledgement field
those are the ones in TCP that allow TCP
to be reliable reliability is a layer
you know on top of the protocol of
communicating with those fields so
that's actually that can be done in user
space and that is super rad I was like
you know how do you make a reliable
protocol because I didn't know you know
and then I saw that it's just layered
over this field and you have this round
trip timer and you estimate how many
bytes are in flight and this is totally
something you know anybody can hack up
and do that's one of the points of this
presentation it's like you know there's
room for new protocols and we can hack
them in user space you know we can hack
them a node you know and we can
experiment with different congestion
control protocols and and that's a thing
man that's totally a thing so after that
what's so so after that we got the
payload you know that's as your
application data on the crypt aside the
the ciphertext is a box which is a
concept from the salt library it's a
public key system and so you have a
public/private key exchange obviously
you keep your your private keys and you
exchange your public keys and in a way
that you establish a shared secret
combine that with an onsen and
authenticate and encrypt the box so it's
complete tamper proof it's at a higher
level than the most crypto primitives
it's built on top of other crypto
primitives and an opinion aid way by DJ
Bernstein and tonya lang so it's like
you know check right right but the the
shared secret is this public key
exchange which takes some bites right
fix this you know larger 32 byte key and
the 32 byte keys and combines them so we
actually trim you know we don't have to
send that at each packet you do that
shared secret established in the
beginning and then the server identifies
associate it's a 64-bit identifier with
that larger shared secret on the server
side that's the tunnel ID and there's a
protocol to sort of change your tunnel
ID periodically so that you know passive
analysis can't track your connection
over IP movements although if you
control the entire internet like some
assholes do you know maybe maybe that's
a thing so it's a public key system and
that's the problem right you know how
how do you distribute public keys it's
just a big old mess
right so in TLS as we know the mass goes
like this your your client knows the
address of a DNS provider the DNS
provider gives the address of the server
may you know there's no authentication
or anything in that it still hackable
thing the client connects to the server
directly and the server gives it you
know its key and then the client checks
that key against the list of known
routes which is also you know a hackable
thing in minimality it's a little bit
different the client knows you address
of the directory service which is like
dns and and the directory service the
server's register with the directory
service and the client connects to the
directory service over a minimal LTE
connection because it knows its
long-term public key and makes a minima
LT query for that servers address and
current ephemeral public key their
ephemeral because they they change for
forward security and then it gets that
back and with that information they can
then connect directly to the server
without a roundtrip I'm kind of breezing
through this stuff because you know I'm
burning through time but the paper is
super interesting and check it out so
yeah I'll skip a bit for performance the
expensive part of the whole thing is
this initial establishment of the shared
secret like that's that's the only thing
that just costs a lot of resources yo
and so minimality can do about 8000
connections per core on a modern x86
system and extrapolating from some other
numbers that they have I think it's
about 750 on an arm device although I
haven't tried and then afterwards it can
go quite fast so why does TCP need a
three-way handshake and why can
minimality avoid it well one you know in
a in a connection flooding attempt
minimality can force the client to sort
of effectively mine for bitcoins like
given this secret produce another value
that with when combined with it it has a
hash whose three low bits are 0 or
something like that you know forcing the
client to pay computationally for the
ability to connect to the server and in
addition if you have a request to an
unloaded server and you just give back a
response directly
to call is designed ideally that the
response would be smaller than the
request so you can't use the servers
resources to attack a third party
although that's that's really the result
of this day has come for me I was
talking with folks and then I realized
you know is that right you know ken it
is our zero round-trip protocols
actually compatible with defending
against amplification attacks and that's
not clear to me you know the the paper
sort of gloss is over but that's
definitely not clear to me because it's
not authenticated when you get a packet
that it comes from that IP because the
authentication corresponds to the fact
that it comes from this public key but
not that when you reply to the IP bits
in the packet that it will be to the
person who sent it and so if you include
a request like get you know whatever
file in your first packet you're going
to fill up the window in the TCP window
is you know five or 16 kilobytes or on
that order you know in your response
which is a pretty big implication and
I'm not sure I probably don't understand
the things and so I'm not a
cryptographer and all the stuff it's
also where the protocol is really new in
any case if it is the case that you
acquire a round trip it's still not a
total lose because you are not worse
than TCP in the worst case and in the
best case where you have a tunnel
established already yet you you don't
need that round trip so so in that in
that regard zero round-trip connections
are always faster than TCP at any
network latency over half a millisecond
which I mean damn right and it always
can x faster than openssl obviously for
the round trip time reasons so very
briefly for foreign alice up this
project is new its associated with a
research project at a university of
illinois chicago and their main thing is
not minimality it's this new operating
system called ethos it's built on the
Xen hypervisor and and it's kind of
complicated and new and stuff and john
so where's the main fellow and and
michael patellas doing minimality part
and minimal t is best conceived out for
them as a way of they do typed IPC
interim process communication in their
in their operating system and for them
minimality is a way of like transferring
that you know to the remote case and so
there I think they're thinking about
more authenticated connections between
hosts but in any case it's a mess right
because you got you know this new
operating system and you got to build it
and it's built with the fork of an old
version of go that doesn't compile
anymore and Linux side as well you have
libraries building for both and I mean
that worked on I worked and I worked on
and I just I wanted to give you all an
old library but I didn't make it I'm
getting there though I'm getting pretty
close the POSIX API I think it's going
to look more like this what they do I'm
going to go back a little bit they they
have these types I pcs but the type the
way to establish these types between the
two sides for me it's kind of more
complication than I care about right now
you know I'd rather like an API that
allows me to just sort of write data on
top of a lower level protocol and I
don't have to you know convert
everything to this new API so that's
that's what I'm working on should have
out soon and the JavaScript I n is that
you need an event loop running in order
to manage your your window and your
reach we transmit times and stuff like
that so Libby V is an obvious and
awesome you know thing to think about
right there and you could talk about you
know actually just basing it on salt and
other things they're like progressively
rewriting parts that are in see right
now into JavaScript like the whole
reliability layer I think that would be
super awesome right have the pure
JavaScript congestion control running on
you know authenticated encryption flow
control fields so that'd be super
awesome so any message is that BAM
weights going up latency staying the
same there's a space for a protocol that
offers a strong crypto at low latencies
you can you know they you can lower your
Layton sees by a large percentage I
think it's on the order of you know
twenty to fifty percent on
gone connections so it's a new thing go
forth and hack the minimality this is
the first presentation about this
project anywhere that I know of and the
next one is going to be here in Berlin
in November at the ACM computer and
communication security conference so
they're actually presenting the paper of
which the preprint came out in may so
cynic just say no i'll be on the
twitters andy wing it i'll tweet these
slides and give an update on on the
release so thanks very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>