<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Nic da Costa: A Symphony Of Sound, Gone Mobile -- JSConf EU 2013 | Coder Coacher - Coaching Coders</title><meta content="Nic da Costa: A Symphony Of Sound, Gone Mobile -- JSConf EU 2013 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Nic da Costa: A Symphony Of Sound, Gone Mobile -- JSConf EU 2013</b></h2><h5 class="post__date">2013-10-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9Q4L9XQ7qdo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Oh
you
hi everyone welcome to my talk on a
symphony of sound gone mobile now let me
just give you a little bit about myself
as they said earlier my developer from
South Africa in Durban work on mainly
mobile doing mobile web games so today I
thought I tried a little thing a little
bit different and that is to have a demo
a live demo please don't curse me okay
so now I actually need everyone to
participate if they can't pull out their
phone the devices hit the wire fire and
start go to that address in a matter of
seconds cool if everyone can just head
on over there well you do that so what
we're going to do is I'm going to try
and get the whole everyone's if you just
pump up your volume is going to try use
your phone's then to control all the
various sounds stop cheer with sorry
we got some sounds playing clearly no
that's great sorry Tendo 11 to 13 dot 1
48 48 thousand
I hear some sounds
we'll have one person playing sound yes
Oh jet pump it up let's try it with
everyone else
I some noise in the back
any other ones All Hands up for those
who are playing there well that means
smashingly anyway but that there wasn't
that important what I want to remain you
speak about was that working about with
sound on mobile with what you have to
come across what some of the issues
you'll do the main goal of this is that
to get people to understanding what
actually happens when you're going to
play with sound on mobile what are some
of the quirks where some things I need
to look out so you're not sitting there
bashing your head against the wall and
then I want to try talk about current
about synchronizing sounds across the
devices audio all is relatively simple
to play on the end of us as you can see
using html5 audio will just create a new
instance audio set up the source hit
load and play no problems now you think
that that would obviously work it won't
that doesn't work and force your mobile
Wow the main thing that you could
understand is that depending on the
operating system as well as the actual
browser you can't just go and play a
device it with iOS specifically I know
Remy shops that a lot of work and all of
this thank you sir that you can't look
the load they won't load the sounds I
os5 in below and then well as it won't
also play the sound off the play you
actually need the user to initiate play
and chrome on Android is the same issue
so in order to not only low but play
sound you actually need to get that user
input upfront otherwise as you can see
not much will happen so a solution using
the auto buffer and preload to preload
it up front and then adding a event
listen foot touch starts as the user
goes and basically interacts with the
phone go to call call play it'll go up
play it or to buffer all the automatic
start loading and at the same time you
obviously don't want the user to start
freaking out as they touch the screen
sound starts playing add a listener to
play as well which then as soon as it
kicks in you send it to your go away you
basically send it to a force pause which
will then basically stop stop it
immediately remove those vent listeners
and basically keep it for later so that
any time you need to call it later it'll
go back and play so you thinking cool
well we're bored with audio APR that
should be much easier you have to worry
about all these mirrors inconsistencies
with the html5 tag you've got a sprite
issues which I believe someone's talking
about sprites later today so hopefully
they will cover some of those little bit
of nasties so let's take a look at
basically this is grab this morning or
can I use what the current support for
web audio is on mobile as you can see
there's not much thanks to the chrome
guards for shipping it I think about two
three weeks ago inversion 29 definitely
made life a lot easier so you're looking
at iOS 6 and above and then Chrome for
Android everywhere else doesn't really
support it and I believe Firefox for
Android they're looking at possibly
bringing that in as well now that it's
unstable Thank You chrome so wait a very
simple function pull or from html5 rocks
on how to basically load up a set of
player sound passing through the buffer
very straightforward simple create your
buffer source said it's play it no shoes
again on the phone it won't work and you
probably will be like that because none
of your sound is ever playing but
thankfully it's very simple to remedy
you haven't got the loading issues that
you have of the audio tag you've just
got the plank with iOS as well as again
chrome the user has to actually initiate
that initial play so using the hack that
we do earlier we can actually just put
that in the play the sound up put even
to your Creator master game mode which
basically set the volume to 0
just play it off for a second or so stop
it and the next time you come back there
should be no you should you can carry on
playing so it's actually quite a nice
and with the Web Audio and just while
playing around is that it's as
everyone's voices it's very responsive
there's so much you can do with it and
the support on the devices they have got
that do have it is actually quite good
so now the thing which is every time
I've brought this up with someone that
way said I'm crazy and maybe a middle
synchronizing sounds now the whole idea
behind synchronizing sounds was today
for those that did play was to have
basically played or for a server and
everyone will then get all across so
what is that actually entail they can
see that's the core bit of being
synchronous aren't you need to know what
the latency of every device is because
the last thing you want is to be able to
say okay everyone play from the start
and then three seconds later this device
starts playing and that device starts
playing so you got when working with
this you've got to really factor this
into your code just a brief explanation
of latency and thanks to wikipedia so
lazy is a measure of Tom DeLay
experienced in a system so in this case
we're mainly interested in especially
with mobile on the radio how long did it
take hit my server and then returned to
get it so this is what I'm that I was
using to calculate latency as you can
see all I basically did was I ping my
serve with a current time and then the
server will respond back with the time
that it was received along with the
original time that then lets me say ok
well how much was basically the round
trip and here are / or / to just to get
a lead see one direction but that of
course isn't a hundred percent accurate
because lady can vary from inside but
this gives you a good round instance of
what it is and then the response
received sorry they're like what the
thing with latency is of course it's
always changing so that one little
function won't do much use it'll concert
it'll return a value and then two
minutes later also late and shut up
you're still not synchronized so I found
what would probably works best
to you constantly ping your server
getting calculating the latency and
storing all that in the right and then
using the mean latency so of course very
pretty so please push it all in the
array get the middle instance and use
that I found that that works quite
nicely when I was testing early as we
managed to get easy four or five devices
to sync perfectly across with no
problems so when a point of applying
your lady once you've got it it's no use
sir cool I've got my lady I'm going to
push play what's going to happen you
actually need affected us in such a case
for this what would I have what I found
that is the probably the easiest way to
do is whenever you're sending from the
server to go and play to actually add
the latency to that start time so that
you can then estimate that each device
when they receive it they'll have
restart time of one second plus it in
their latency they all should start
roughly at the same time if not the
actual sound but the sound instance will
be then the same some more interesting
things about audio and latency and all
those is that audio responsiveness
differs so from that of using the audio
tag to the HTML to web audio APR was
that it takes up to a second just in
order to instantiate that play on with
the audio tag so if you're going to be
using a situation like such on mobile
where you want to add multiple devices
you can have to cater for both of them
you never then worry about if you tell
the Web Audio to play guaranteed it will
play near instantly but then about 500
milliseconds later the audio tag will
play which then gives you that kind of
like stereo kind of a late late into
effect to do this probably the best
thing is to then buffer that time a
little bit more so whatever your latency
is increase it by give another for
another second or so which just then
pushes that up and hopefully gets
everything synced across some other more
interesting things is of course
depending on the sound you can actually
have leeway with your difference between
various devices what I found is that if
you have a basically a monotonous tone
of course it'll make no difference
not many changes in notes and if your if
it's a fast paced track with multiple
changes you will notice that a lot more
if with that is half a second or for
less so just going over to to recap on
some of the things that with when
working with audio with mobile things
you need to bear in mind is that the
user needs to initiate load and playback
with audio tag this is iOS this is on
Android all of them use the preload
attribute as well as the buffer auto
buffer that is fortunate appreciate
depreciated so preload with or with Auto
should do that so far space that will
every time you kick play immediate load
because calling the load and iOS
actually won't load the sound wave Audio
API you've got the same instance the
user needs to actually instead initiate
that play backwards we're using a touch
interface or whatever else and with
latency late she is constantly changing
so just bear that in mind when trying to
go it's you need to always make sure
you're getting the either the mean
latency because average the last thing
you wanted to get one spark and your
average just thrown out exponentially
use uut UCT timestamps that's catching
for different time zones and easiest
thing for to communicate with server and
client of course and then factoring in
latency when scheduling start time for
audio taking that start time adding it
on and carrying on so resources one of
them is Remy shops audio sprats I'd
highly recommend likely talks a lot
about some of the iOS fixes that I
mentioned here today we're what you
actually need to do and there's an us
there's another little issue when you're
trying to seek through and set the
current time with the audio tag which
actually just doesn't work so you found
a nice little hack around to do that
also the Web Audio API book by virus was
its I would highly recommend that if you
don't know much about audio or even just
the Web Audio API was actually really
great resource to get you through html5
rocks also they have an intro to the Web
Audio API highly recommended as well as
sounds of racer
this was really interesting because they
they actually start talking about how
they used and various algorithms to
calculate latency for the game and some
of those issues that they came across
which funny enough was similar to the
ones that I was finding thank you I'm
Wi-Fi as you can see Nick dacosta on g+
twitter ethnic underscored acosta if you
have any questions all the welcome to
come fine we will give me a sharp
nothing we've got some quite a bit of
time for questions yep we definitely
have time for some questions dad's also
wander around in there too so put your
hands up if you got questions ok one
over here and I don't see anyone and key
comment on whether there's any
difference between the Web Audio API
inside of Chrome for iOS compared to
safari for iOS because obviously it's
the webview the jobs cleanser is
slightly different not as fast i found
one odd difference which is more like
about a browser bug but whether than any
performance differences i haven't found
i haven't found much i don't actually
own unfortunate iOS device i wasn't able
to kiss that much on there the job said
from what i have done because we add
work we got a few devices going through
all of those haven't found too many
issues with that begin the sounds that
we planes very simple just setting up a
sprite playing going through not found
that much it is that I think the this
actual issue are in terms of performance
is quite nominal specifically full audio
because it handles quite nicely anybody
else actually he's got another one if
that's cool do you know if there's any
way to capture that that audio so record
the audio that you generate on a mobile
device so I know there's a the offline
context that was in the spec I don't
know whether that's landed at all I
don't know don't think that's actually
landed I could be hurry mistaken
anyone knows correct me if I'm wrong but
the the implementation on mobile is
still very new and as I said with chrome
really only shipping that about earlier
this month with vision 29 which the
latest one and then of course iOS with
iOS 6 all right thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>