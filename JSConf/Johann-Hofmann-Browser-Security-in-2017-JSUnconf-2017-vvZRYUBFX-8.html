<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Johann Hofmann: Browser Security in 2017 | JSUnconf 2017 | Coder Coacher - Coaching Coders</title><meta content="Johann Hofmann: Browser Security in 2017 | JSUnconf 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Johann Hofmann: Browser Security in 2017 | JSUnconf 2017</b></h2><h5 class="post__date">2017-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/vvZRYUBFX-8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so Firefox 45 was I think released in
August of 2016
2015 and we've seen a very steep decline
in the existence of HTTP login and HCP
page loads are also slowly going down
from you know now from initially almost
sixty percent to now a bit under fifty
percent which is really good considering
it's been such a short amount of time
right so what if what's responsible for
this change in my opinion it is first of
all that browsers now start to
aggressively flag insecure sites so if
this is your site you probably don't
want to have that label this will that's
what we currently do well you know that
one thing is what chrome current without
the other thing is what we as Firefox
currently do when a page has a login
field but it's not using HTTPS we're
flagging that because the transmission
of these credentials would be insecure
and so we want to warn the user hey you
know this is not a secure website there
has been a lot of concerns from the web
developer community around these
warnings we have been getting a lot of
box by people saying don't slack my
website as insecure we have our own
security mechanisms we don't rely on
HTTP and I have to say that this is the
only thing that I can do about it like
you know give a talk and tell people you
know it's not that's not true you user
data is exposed if you should spend
anything over HTTP there's no way you
can reliably make it secure there's no
you know no token generation mechanism
something that people from bring up
nothing that you can do to replace the
security mechanisms that HTTP provides
so we kind of had to get a bit more
radical and that tipped off a lot more
people so this is what Firefox 52 now
does when your login pages insecure it
says logins enter here could be
compromised if you focus a login field
or path or a password or a user name
field that's already pretty heavy I
would say and we've gotten a lot of
complaints around that people are really
freaking out
around this and we're not backing off
because as I mentioned so far it's been
pretty successful like the numbers are
dropping and the numbers of insecure
HTTP users are dropping and we're pretty
satisfied another part of the story is
that we now show what we recently
started to show warnings in the
developer console when you're using
these things so if you're a developer
and your website is insecure you get one
of these warnings so for example for
mixed content for insecure passwords for
weak signature algorithm like recently
shot one you get a warning that hey you
know you're using something insecure
please click it and these are the most
popularly clicked links that lead to MDM
and so that people can look up you know
what's wrong on my website and can you
know find dogs how to fix it and you can
see that the most common ones are all
related to HTTPS or you know insecure
HTTP which they're the most those the
top four and so leading people to a
website explaining that they need to
update HTTPS otherwise you know the
content is Borg is really nice we need
to present an alternative or a way to
for people to easily upgrade to HTTPS
without you know paying money that's
what let's encrypt is doing it's getting
a lot easier to obtain free HTTPS
certificates which is something that is
vital for this whole story to work there
are still a lot of shared hosting
providers and stuff where it's not as
easy a good example which is actually
providing my website my personal website
from working is is github pages with
custom domain names so that's that
doesn't work right now which is a shame
but it's getting more more and let's
encrypt is definitely helping with that
there's also clouds there which I wasn't
even sure if I should mention it because
there are a lot of controversies around
cloud fair and how they use or they you
know how they put themselves in front of
your interior page but it's also an
alternative if you can't use like some
fruit for example so all right I'm done
right so this target doesn't really have
a lot of sense I just turn on HDS
there's a lot more to do so you can see
that two of the most popular warnings
are about mixed content what is mixed
content mixed content is basically when
you have a secure page and you're
linking to insecure resources from your
from your secure page so mixed passive
content which I would like to call the
bad kind is when you have an image
resource for example any kind of static
resource that is a link through HTTP
mixed active content is a really bad
kind and that is when you have dynamic
content such as a script that can
actually alter the content of your
website so let's sort of looking at
mixed passive content so mixed passive
content is fine right I mean who cares
if I have an insecure image on my
website what is that so yeah so this is
this is from a talk which a colleague of
mine Lou Crouch recently held and he
wanted to check the the warning that
comes up when you have mixed passive
content on a website and what he
accidentally found and I have to say
that this is basically a a random URL so
it's locked out for security reasons
this is a random URL that he entered and
wanted to check if they have mixed
passive content and this is a major
Internet service another internet
service provider but like a major
internet platform and he found out that
they actually deliver so basically you
actually have access to the cookie
header in there mixed content images
obviously right because the browser
delivers that which is really critical
for their service because you can just
copy the cookie and then just you know
log in as you know being any website
embedding that thing that's kind of yeah
not cool and so be careful with mixed as
a content there's usually not a big
reason to have it like in my experience
it's not it's usually easy to get rid of
that's how we flag makes passive content
the warning so you get a a gray lock
with a yellow icon and you get a warning
in the Euro in the developer console
mixed active content is actually pretty
easy to avoid because browsers block it
by default so you get a green thing
green log and a warning that Firefox
developer edition for example has both
parts of this page a good way to
differentiate between mixed answer
convicts active content is if you ask
yourself a question can it alter the Dom
if yes then it makes active content the
really bad kind but that will be blocked
anyway so just to summarize please move
to HTTPS I'm sure a lot of you already
have moved to htps but if you have a
page or something you know some
resources you're not sure should I move
it to HTTPS just just do HTTP is for
dinosaurs and you know what happened to
dinosaurs they became cute conics right
so assume you have moved to HTTPS you
should consider turning on the so-called
HSTs header which is HTTP strict
Transport Security that basically says
all right for that length of time
I want my website to only connect
through HTTP or I want the browser to
only connect to my website through HTTPS
so if somebody for example types
explicitly types HTTP example.com in
their url bar they will still get routed
to the HTTPS version because you said
really I want this website to be routed
through HTTPS and there's also for
example an option to include subdomains
and that's a pretty good reasonable
defense against an attack called SSL
strip or a tool called SSL strip and
which basically exploits the fact that
you make a single HTTP connections to
override all your work and yeah that is
that is pretty dangerous and that's
pretty good security mechanism against
it and right
we've made our connection secure how do
we secure a web content so this is just
a collection of techniques that modern
browsers offer you one thing is the same
origin policy it's not really a
technique for you but it's rather
something that the browser automatically
applies so whenever you make a request
to something from from one domain to
another domain that you don't own then
it says or doesn't process not currently
navigated to then it says eh sorry we
can't do that this is also yeah showing
this nice little graphics basically you
connect to one side side a.com and then
cite a.com in your browser wants to make
an XML HTTP request to site be calm but
that doesn't work so that's pretty
annoying and but it has its uses
so what affected by same origin policy
why am I telling this so xhr requests
are covered window the opener windows
are also covered although these are not
weak fests they're technically access to
a different page so in case you don't
know window open or window door current
these are basically objects that you
receive in a website accessible
accessible by j/s when you were opened
by another website that means if you are
in an iframe and if you have been opened
by a different tab you have access to
these things but only or the access is
restricted if the origin of the other
page is different than your origin which
is also a good thing however there's one
thing that is not restricted by by same
origin policy and that is for example
forum with post method why is that lower
case anyway so it's not protected and
that means you have to apply your own
security mechanisms to not fall victim
to basically websites embedding post
forms to your website they're just
randomly changing things or maliciously
changing things randomly would be nice
right so there's a mechanism called POF
tokens for that and also more stuff I
didn't have
on this page I will edit in the slides
that are available online
so should definitely read up on theater
protection if you have websites that or
api's that accept posts don't rely on
copies that that doesn't work it's very
easy to use to say okay
allow everything you know I'm in I'm in
debug mode I don't I don't care I'm just
you know this is this is not production
and then at some point it just rolls in
production because it works right and
nobody really cares about it and so
please think about this from day one or
make a big to-do or something that this
is not a good thing if you aren't on a
public API and even then you should you
know consider the options that X control
are in office you oh yeah if you don't
know this is this is a header that you
can set in your request in your response
to basically say which origin is allowed
to access this resource right so another
thing that you could oh that's really
dangerous on the web is XSS attacks
access s is basically cross-site
scripting so an attacker inject
something in your page and dad is not
properly sanitized and then that
contains like a script that can run and
it completely wrecks your website and
then if you're really unlucky persistent
in some sort of database of yours and
then every one of your users sees it
which is really bad a good general
protection against this is called CSP
now I've heard a lot from people at CSP
is like I had on UCSB that's overkill
and I'm I'm not sure
CSP in my opinion is a pretty good
technology it's just kind of a set of
rules that define how a site may load
resources you can set it as a header in
in on the server side but since we're
talking about dais I just thought I'd
show you how to embed it as a meta tag
and that's how you do it basically you
have this meter tag with the boilerplate
and then the content attribute is the
important thing so here for example you
say that by default is the required
attribute default source all resources
should only be loaded from this
named images may be loaded from HTTP
domains and please don't use iframes
that's basically what you're saying cool
side effects of content security policy
is that it disables inline scripts by
default unless you're specifically an
asset which is really bad idea so any
kind of XSS that injects an inline
script is not really well it has a hard
time because it can either load an
external resource unless you made a big
mistake in your content security policy
nor can it execute JavaScript there's a
cool way to test what content security
policy would break on your page if you
said the content security policy report
only header instead which basically
allows you to test it without breaking
things by just logging everything that
you would that constitute a policy would
have blocked if it were actually running
in related to that is another really
cool feature of CSP it allows you to
record violations of the content
security policy so if you specify a
report URI in your content security
policy you can set a URL where we just
send all violations - which is my
personal opinion really cool and there's
even a service on HUD that supports just
you know you signing up and getting all
these reports called report your ID at
i/o which which is also awesome because
you can you know you can even have run
in all report only mode and just you
know check what would have been violated
because website can be pretty complex so
I can understand that how can I make
sure that the third-party content I
receive has not been changed on the
server this is a common problem with if
you have a CDN for example well it's not
a common problem because most of the
ends are pretty secure but it's a
problem that many people think about
when they use CDN so how can I actually
trust that the CDN is delivering me the
right script the right content I just
you know I'm not downloading jquery from
one of these popular to the ends but
what happens to the internet if that CDN
is compromised and jquery includes
malicious code now
that'd be horrible that's why a lot of
CND's on their home pages now
if you want to include things with a
script tag now include this integrity
attribute by default the integrity
attribute on a script allows you to
specify hey the the original source that
I looked at had this hash digest
basically you know this hash and I want
to always receive content with this hash
in the future if it does match your
browser please don't allow it that's a
pretty cool technology to prevent it
doesn't have to be the city and even but
like prevent any kind of tampering with
the original source that you were
downloading
yeah the cross-origin thing is that
basically that's a course attribute for
for scripts for script tags and there's
even a cool website called as RI hash
the rogue which you can just use to
generate the hash easily we don't even
have to like go into the command line or
anything okay so we've made our web
content secure let's go another step up
and talk about securing access to
privileged device api's which is a
relatively new thing I would say there's
only a couple of AP is right now third
or you know device storage there's some
geolocation web notifications microphone
camera pointer log and the screen
sharing sounds like a lot but if you
imagine the possibilities that devices
like you know your computer or your
phone have it's still you know still
there's still a lot to add we could you
know have raw TCP sockets bluetooth USB
whatever all these things sound pretty
dangerous to just expose by default like
you know if you just give a website
you're you know default permission to
access the camera for for any user that
that's just really bad because you know
you could just record anyone without
them really having a choice about it so
we need some kind of permission system
for the web to allow users to have a
choice whether they want the website to
be able to
athletics is to the privileged API or
not unfortunately so this is something
that my team has worked on recently and
we found that the web platform isn't
really it wasn't really built with the
permission system of mine or wasn't
really ever build with the fact in mind
that you can easily get access to like a
lot of limited technologies that are
only that can be very detrimental to the
user privacy and security and that kind
of mirrors in how the spec is written
usually so it says user agent must
acquire permissions through a user
interface thank you that's very helpful
and it's it's not really expect out how
the permission the whole permission
thing works so there are different ways
for example to get permissions for
different technologies you can you can
get a camera or video that's the same
thing camera or audio or screen share
permissions by calling navigator dot
media devices get user media and just
you know specifying what you want to
have this has lots of options and then
that returns a promise and when the user
allows the permission you get a promise
back what the promise will not reject it
and then fortifications that's a compute
of a thing right so you call
notification dot because permission and
then again that's a promise and
geolocation doesn't even take promise or
doesn't even return a promise but it
just has a callback function which you
could pass and then you just you know
get if there is a if the user has said
okay the website can have my geolocation
it's inconsistent but that's not even
even the worst part of it is the worst
part is actually that there's not a
consistent API there just isn't to get
information about whether you already
have permission or not whether you saw
present I think for geolocation there's
no way to do that right now except using
the permissions API which is like a
draft that is only implemented by
Firefox and it was at some point
implement by Chrome but I'm not sure if
a folder or not because it's not very
popular it's not really gaining traction
which is a bit of a
and something that we as browsers I
think should work on so also the the UI
for it is also kind of different and so
this excellent thing that we worked on
recently to get Firefox in line with the
other browsers in terms of UI so if you
as a website request permission right
now expect to have your users expect
your users to have really different
experiences around different browsers so
currently this is actually not accurate
for the like the screen shows on the
very left the the screen shows for
firefox and that's actually not accurate
right now for 61 that's coming in 50
then for 52 that coming in 53 which is
out in a couple of weeks and the old
version was for example not model so we
converged them to be all modal and that
the user can't dismiss them and in the
old firefox you could dismiss it and
then the website which is forever wait
on the callback or the other other
promise to arrive and not at any point
get a reject the promise of the user
just dismissed it it's it's very
different around remembering permission
so you have to be really careful if you
request information that it's a pretty
good permission request because most
browsers are pretty strict about if you
can ask a second time
Firefox has the concept of temporary
permissions now which basically blocks a
permission for the duration of the tap
lifetime until you navigate away so that
websites don't continually spam with a
permission request hey you sure you
don't want to get notifications okay you
said no again please please and Safari
and chrome are for me personally a bit
harder to understand but they do similar
things like they if you continually ask
for permission it doesn't work like you
can't just spam the user with
permissions which is a good thing
because permissions have been pretty
annoying recently so there are the
features that are exposed to permissions
are super powerful
that's why malicious websites have a big
interest in getting these permission
and are employing tactics to basically
get the permission from the user
eventually by just nagging them or
through tricking them into clicking it
so one example of this is if you have
such a permission problems a website and
hire folks used to spawn a window on top
of the permission and have a click
target approximately whether your K
button is that that actually happened
and then when the user hubber did it
went away and then you I don't know some
people probably instinctively clicked it
and then they granted the permission and
then they found of geolocation I don't
know why why the website was doing that
but we had to implement the fix that
basically as soon as the window is
focused the window that sponsor
permission prompt is focused the
permission prompt can't be clicked for
like two seconds or something so there
are a lot of abusive permission costs
and that's why browsers will start to
penalize intrusive and surprising
permission problems so chromium has an
intent to implement and I think that
that's linked to intend to prove and
blocking permissions after you denied
for the third time completely like
permanently for your website and the
link bug that is linked there from
Firefox is the the concept of
implementing temporary permissions to
vlog when you've already said no so this
is a really bad example just to give you
a really bad example of you know how you
shouldn't do things this is basically
t-mobile the t-mobile home page which as
soon as you browse it offers you hey Ken
t-mobile come access your location
you're like I think they use it for
their store search or something but
you're like why why would you do that
and it's pretty obvious that most users
will either say no or will be confused
and say yes something which is also not
something that we want so there is work
to prevent this stuff ongoing which
would probably look like following if a
user did not cause an action for example
click a button
you may not on the permission prompts so
we call it is handling user input
basically that prevents spawning things
right away and it also prevents spawning
without any user interaction it's only
you know it's a limited kind of check
but at least you can prevent this from
happening so a good technologies
to pre prompt we pumped give the user
context it tells them you know hey
here's this message but we would really
like to be able to alert you in the
future when you receive more messages
would you like to us to be able to
notify you on your desktop whenever your
browser's minimize or close or whatever
and the user then make much more able to
make a conscious choice about allowing
or not allowing the permission prompt so
this is a good example slack I think
it's a pretty good examples slack says
you know slack needs to Commission to
enable there some notifications if you
click the X they don't show this thing
again if you click on enable desktop
notifications they show the permission
prompt or they ask the browser to show
the permission from folder and another
good example is whatsapp web it's they
do that in a similar way notifications
are usually pretty pretty good example
of this so they say you know you can get
notified when you get new messages click
here and then they show the permission
problem and the user can then make a
choice and I think it's no coincidence
that these two companies do that I think
they use the testing reveals that this
results in a much higher rate of
acceptance from users - so do it for
yourself because you want your users to
accept your notification permission
problems but also do it because browsers
will likely force you to do it so
another thing that we will probably do
soon around what permission problems is
which restrict permission forms for my
frames because iframes are nasty to
manage in browser UI so what if you you
know so
it's so the browser your eyes is pretty
limited around security so you you know
you want to put it in the main UI of the
browser but you only have so much space
in your browser Chrome so and you don't
want to pack it with all the details
around all your iframes that you've
embedded around your permissions and
whether they can open pop-ups and
whatever so a rather easy solution to
this is to just say iframes can spawn
permission problems and if I were you
and you are for example running a
notification service embedding it with
an iframe please ask them to migrate
away from iframes because Chrome will
soon duplicate it and we're also
thinking about it all right yeah the
serve the classical you know with great
power comes great responsibility
where permissions and and device
capabilities is a really dangerous thing
but it can also be used for great things
like web RUC live chat screen sharing
and an location access alright that kind
of concludes the oh wait okay this is
this these pages are completely broken
so that kind of concludes our tour
around secure web site just to give you
another quick summary of what we what we
talked about so I would really like to
ask you to make sure that all your
connections are secure through HTTPS
please take care of your mixed content
because that's also really dangerous and
may break your website Sinan HSTs header
we worry off cross origin restrictions
when developing and be wary when you
know allowing for sergeant access to
your own ap is have a CSP just to just
to deny the inline script notation of
inline scripts nowadays just feel I deny
your inline scripts on your website have
a CSP and this is for some reason the
rest is not this place but I'm another
thing that you should absolutely do is
well basically what do we talk about
to some remember all more stuff secure
access to device privilege we talked
about this basically browsers are
limiting the way that websites can
access device capabilities and you
should be careful when asking for
permission because browsers are much
more restrictive or will be much more
restrictive thinking you know about the
user experience and and users are much
more prone to deny if you don't give
proper context in your morning's right
that's me
I will move on and you can have
questions yeah go ahead
right right so this is planet like all
business plan is not am i working with
of it's not an official statement of
intent from the perfect</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>