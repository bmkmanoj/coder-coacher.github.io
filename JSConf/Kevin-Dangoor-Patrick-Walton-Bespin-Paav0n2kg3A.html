<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Kevin Dangoor &amp; Patrick Walton: Bespin | Coder Coacher - Coaching Coders</title><meta content="Kevin Dangoor &amp; Patrick Walton: Bespin - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Kevin Dangoor &amp; Patrick Walton: Bespin</b></h2><h5 class="post__date">2013-01-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Paav0n2kg3A" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">ah
I'm Kevin that's right mr. Patrick
country and we are both members of
mozillas Bespin team so we're gonna be
talking about betta vestments best in
today and this is best bin whoops
there's messmann screens a little bit
tall but best bended basically a text
editor that runs in your browser
specifically a programmers editor that
runs in your browser the whole idea that
you can write code manipulate it and
we'll see why you might want to do that
so why would you want to do that there
are actually a bunch of reasons so one
is that the web is a great open platform
that we've you know we've all come to
know and love and why not have our
developer tools built on that same
platform that we're developing for at
this point the platform's gotten to the
point where we can do that kind of thing
and is getting even better with html5
html5 is actually as a whole bunch of
features that really do add a lot to the
platform now if you ask these guys is
html5 ready yet demo tell you it's not
gonna be ready until 20 22 but they're
wrong html5 is ready today as long as
you know what your users are like if
your users are among the thirty-five to
forty percent of the people running an
html5 compatible browser then yes this
is the time to start using this stuff
because there's a lot of great api's
here and I know that there's been a
bunch of other talks that have touched
on an html5 so we take we take advantage
of those api's investment because we
know that probably everybody in this
room unless there's somebody in string
will work for Microsoft cool then okay
doesn't have canvas yeah we should talk
don't worry um okay well anyway I so so
people in this room most likely who our
target target audience for best been are
likely using compatible browsers and so
another reason why is that there are
lots of cases of this on the web this is
a shot from WordPress theme editor where
you edit code in a text area which is
really really crappy so there are a lot
of cases like that these days where you
have some code that you want to edit in
a browser and we want we have a best
been embedded
gage that's kind of designed for this
purpose so you can actually pick up that
package stick it on your server and just
all just JavaScript and it will you can
replace your text areas with something
better one of the other use cases is is
basically being able to get access to
your code wherever you are so if you
have actually like the best BIM server
environment where you can code in the
cloud the idea is you can go to any
computer sit down there and have you no
immediate access to everything you're
already working on this is not one of
the things that I was originally geeked
about when it came to besten but
repeatedly I've heard from college
students they really like this aspect
and you know as we get start getting
devices of different form factors where
you might want to access your code in
the cloud you know these these kinds of
things phones and bigger phones are
going to become really really
interesting for coding wherever you are
and they want to really have all your
files on there so that is actually a
growing use case and it is the number
one request I'm uservoice yes ipad
support for best bin is actually the
number one request under user for say
right now so that's kind of interesting
remote pair programming it you know most
of the way that we collaborate by and
large Morganne code is through version
control systems but there are times and
its really nice to be able to sit down
with somebody else on a piece of code
that and they're not necessarily in the
same time zone with you which actually
is a case on the best been team every
single number the team is a different
time zone it's really nice to be able to
code collaboratively right now the
current shipping version of best been we
are actually the process of getting the
collaboration features to a new state so
this is a use case that very soon we're
gonna have a good answer for so one of
the things that makes best been
different from the many many other ones
we're kind of going after the big major
editors that people live in all day
they're probably 403 I'm just making
this number up there are a large number
of code editors that people have already
written for the browser but the thing is
most of them are kind of avoiding going
after the big guys they don't actually
try to make an environment they try to
make an environment that's good for you
know quick bits of code not so much for
the things that you do the better that
you leave
an all day long and writing code so
we're trying to go after some of those
things so what are some of those things
some of those things are like
customizability obviously for all
programmers and we're all working on
different kinds of projects we want to
be able to make our tools do the right
things for our projects so
customizability is a big thing in any
one of those editors I just mentioned
you know if you look at textmate there
hasn't been a real text me release for a
long time but there are new bundles
coming out all the time to do all kinds
of stuff syntax highlighting I mean that
you know even the basic web editors do
that but it's pretty critical because
you know it makes it a lot easier to
read your code good use of keyboard
since we use the keyboard we hate
reaching for the mice when we have to
behave well for code like indentation
that's one of the most annoying things
about text areas obviously is that you
know you can't hit tab and if you you
know it doesn't keep your indentation
level and all that kind of stuff and
these things since they have since
they're very customizable and a lot of
these editors been around for years
there's usually lots lots more that
these editors do for you and we're
trying to get best been to the point
where we can actually be competitive at
that level yeah a lot of editors have
scripting languages and being in
JavaScript we have the advantage of
having a scripting language already
there for us thankfully yes sure you
guys thinking about a shell extension
like with text me there's a meat
extension where your
and in a file that's conceivably
possible in like some specific depending
on the packaging's investment i mean if
there are lots of different ways to
package this up and that would be one
one possibility i'll go into more detail
on the packaging at the end so on the
customizability front you know we've
just been we've been actually for the
past several months completely
overhauling the way best been works and
customizability is one of the big
factors so we have we created up a
plug-in system for best bin that
basically each plug-in has a bunch of
metadata that says what it does Intel's
best me what does and all that metadata
gets eagerly loaded up to the browser so
as soon as you had best been best been
knows all the functionalities available
but it doesn't load all that
functionality until you need it so you
can have 50 syntax highlighters for you
know different languages and only once
and none of those get loaded until you
actually open a file in that language so
that saves all a lot of loading and
these plugins will be able to do all
kinds of things right now we've got a
handful of different kinds of things but
that will grow so one example of using
the plug-in system basically is
basically as we've got a little command
line best friend has a command line I'll
get into that a little bit so you type
hello and it says hi there and this is
the plugin that's doing that so I'm
changing the code in best been right
here so best ones actually great
environment for editing vestment plugins
because you can say plug-in reload hello
run the command again and then it gets
the the change text so it automatically
will dynamically reload plugins so you
can do a plug-in install and it'll just
install a plug-in while you're working
live you can remove plugins and the
commands go away all that kind of thing
it's very dynamic environment which is
nice and you can even publish to so that
other people can use them yeah that's
right there's a there's a plug-in
gallery that currently lives in best
Bend and we're also gonna have one on
the version of that on the web so that
people can browse through the different
plugins available syntax highlighting
Bespin has actually pluggable syntax
highlighting engines so you can change
out the way syntax highlighting is done
and the one the current shipping engine
basically works on right regular
expressions and States so you can
actually have a bunch of regular
expressions parcels through the code
figures out how it should be colored and
then change the states if it needs to
because it's you know your work you've
gone into a like a multi-line comment or
something like that
so that's the current syntax
highlighting engine I mentioned commands
basically everything you do investment
at this point is a command from like
changing some text from being mixed case
to being all uppercase or hitting the up
arrow key to go up that does or commands
to and there's a command line that we
offer that can rather than having great
big heaps of menus and views and stuff
we actually have a tricked-out command
line this is not like your unix command
line this is it's anna graphical
environment so we can do all kinds of
cool stuff will give you documentation
right in line as you start typing the
command there's a bunch of cool stuff we
do there and it's a great way to sort of
bootstrap some new functionality you
want to get some functionality and
they're just write a command for it it's
pretty good good commands it have the
bottom avail so I like typeset and it
popped up the help for set the complete
help and then you start adding
parameters to that it will tell you this
is what you're supposed to do here and
tell you when you do something wrong
yeah it's actually the command line
that's doing it so you if you were
writing a command you wouldn't have to
write all that stuff that you just write
some documentation and then you
automatically get all those
functionalities that's kind of baked
into the command line one of the things
commands can do also is they can provide
they provide a default key binding so
like I mentioned pressing up to go up if
you're VI user you might be used to
pressing a different key to go up so we
have key mappings key mappings can be
provided by plugins so here's an example
where it's kind of going up and going
down by pressing J's and KS then I
pressed i started typing to insert for
us escape to get back into into normal
mode so I'm moving back and forth so
we've got key mapping plugins and you
can also use individual users can change
their key mappings so you can say no you
know what I really want I really want
the pound sign to be go up because I'm
masochistic okay so but an individual
user has that power to sit to remap the
keys however they want behaves well for
code Bespin actually is I don't think
we're quite to the level of the desktop
editors yet but you know we at least get
the indentation levels right like you
know it stays the indentation level
these are spaces not tabs and
I hit backspace it'll actually really
really erase all four spaces this is it
we've got all the infrastructure there
so at this point it's just a matter of
adding a lot of the little behaviors
like when I hit the brace there it
didn't automatically indent me that'll
be like the next step that you get a lot
of editors we can turn off right yes
well yeah that's that's the other thing
we want to be configurable and you know
give the power to the user as much as
possible so sometimes you can help yeah
absolutely true you know yeah sure sorry
it's probably not question time continue
please okay all right okay all right
sure ok so the lots more aspect you know
been working hard on the infrastructure
side of this and the lots more is going
to come this year we're actually now
that we've got a lot of the
infrastructure out of the way we're
adding all kinds of cool features this
year mercurial and subversion support
we've already got there's actually so we
went through this reboot were majorly
refactored best been around plugins and
we're just coming out of that so there's
some features we actually need to
portforward version control system
support is already there yes get support
will come one of these days is on his
like you just have to schedule it in
collaboration like i mentioned we're in
the process of getting that feature
going it's largely working but there's
some more work to finish it off SFTP
deployment this one of those features
where you can use Bespin in the cloud
and then deploy your website to another
server vs ftp that's a feature that we
that we had and just need to portforward
from our code base and that's actually
largely a server feature so that's
probably be coming soon so expect a lot
more features this year especially as
others two people start writing plugins
that's a great thing to about a plug-in
system so now I'll hand over the mic to
Patrick so I'll just be talking about
some of the internals of best bin this
is not going to be extremely technical
but it's just to kind of piqued your
interest so as Kevin mentions
no that wasn't what I wanted it to do
that is interesting keno quit
unexpectedly nice Apple anyway so what
that slider was going to say is that
that we have lots and lots of plugins
and as kevin was saying the entire
editor is based around plugins and here
are some of the here are some of the
ones that we support so these are bunch
plugins that come with it and they're
even more that are in the labs
experimental sort of category and the
the cool thing about this is that not
only can you write your own plugins so
you know if you really don't like our
theme and you want a different one or if
you want to not if you don't want to use
the standard syntax and you want to say
load textmate bundles for the syntax
highlighting then you could do that too
so so you can swap these out but they're
also totally reloadable while the editor
is running so you can you can hack on
your plugin and then reload and even if
it's one of these core ones it'll just
reload the appropriate parts we have I
have some things where I've been editing
the overall app controller and it'll
just reload the whole thing so it reload
so it's pretty smart about reloading
things so this is how the text editor
itself works this is a really familiar
diagram if you've ever done any UI
programming at all it's all MVC and it's
especially familiar to you if you've
done cocoa programming so this is
actually pretty much exactly how Coco's
text API works which I we thought was a
pretty good model because first of all
it's like the poster child for MVC and
second of all it's been around since the
80s and hasn't changed much and so
obviously it's it's doing something
right and so i'll just go briefly into
all these into each of these big parts
so the text storage to make the editor
as flexible as possible
the model that it displays is actually
as close to a mutable string as you can
get in JavaScript so it's an array of
lines and when every ends so you can
basically take an editor and hook it up
to anything you want as long as it
follows this this really simple protocol
and then you can just go in and change
any of these lines it'll just show up in
the editor and it can be read only or
read right so the idea is you can use
the editor for not just text editing but
also text viewing you know code code
review tools all sorts of other things
can be used because well because it's
pretty decoupled from from the actual
storage on the file system it also lets
you do different storage api's you could
store in memory you could store on the
file system you can store you know from
the Dom you could all right you could
even store on the local disk there's a
plugin there's actually a fork
investment that someone has created
called Espen that uses the Mozilla
platform and asks for local storage if
you tweak is heading in your about
config you can actually get allow files
to allow web pages to edit your local
files and so despot lets you do that so
that that's a pretty cool fork so the
view is just a text view it is our claim
to fame is canvas and there's also a
hidden textarea behind there now which
was which we still can't get away from
because we need it for internationalized
text input until Dom level three text
input events come around or are actually
supported we've got to have a hidden
textarea but on the plus side people in
Europe can actually enter curly braces
now that wasn't true in earlier versions
which made it kind of hard to actually
edit code but yeah so we're using canvas
and why canvas well because of
performance with the Dom it's just
really hard to get the kind of priya lee
good performance because code tends to
be big we want to scale to thousands and
thousands of lines and you can do
incremental rendering in canvas but you
can't make it perform as well when you
have edit with editing and content
editable is one of those things that
they tend to be dark and scary parts of
of browser engines that people haven't
looked at in a long time I know because
I've looked at the Firefox code for this
and so for the actual editing canvas is
what we use and not everything is canvas
so our UI is actually mostly Dom but the
actual core editors can is canvas and I
think that's part of the reason we've
been able to have a really good
experience so the browser that we
support obviously Firefox that was the
first then Safari came along and added
even though they started canvas they
didn't add text support for canvas for a
while so and Safari and then chrome so
those are the browsers that you can use
the browsers that you can't use our
opera right now because they have canvas
before but they don't have text and text
is kind of important for an editor so
can't use it right now but 10.5 is
looking good in that department internet
explorer 6 no canvas supports and you
know frankly I think that's that's made
life easy for us not having to support
that but you know we are open to
supporting internet explorer if they add
canvas and internet explorer 9 hopefully
so we don't have anything against IE we
just want to use the canvas so the
controller part that's fairly straight
it's fairly straightforward we do all of
our layout manually because we are using
canvas and we have a pluggable syntax
highlighting engine that is not only
totally pluggable it's also can run in
the background so you could put things
in a web worker and run J eslint on your
JavaScript for example to do this index
highlighting so it's it's pretty
powerful and here are some of the use
cases we have in mind so you can
obviously replace a text area and when
we first started Bespin we thought most
people would use it here but actually i
would say over half of the interest is
coming from what people wanting to add
besten on to their sites so when we
rebooted it we really wanted to focus on
that embedded providing a good a p.i for
embedded users so you could add it on to
a site like github or sourceforge you
can obviously use the editor on best
friend mozilla labs com and since it's
all open source both the client in the
sort
where you can install it on your own
servers you can do custom projects new
intranets or you can package it up
locally so with titanium or zool runner
it actually does run under zool so you
could have so you could do a local
package of vestment as well and if
you're interested you can check out our
project website at mozilla labs com /
Bespin if you have any questions feel
free to subscribe to the mailing list
you can follow us on Twitter here and
you can check out the editor yourself at
Bespin up mozilla labs com and we'd like
to hear your feedback questions a little
bit more into sports sure so though
that's mean that's a server-side
function basically so the best one
server handles that there's a so there's
a there's a couple different ways that
works actually we have a command command
set that the commands are actually VCS
so you can say like VCS update commit
and those actually those commands work
regardless of which version control
system is in use for that particular
project they work the same way whether
it's so it's kind of interesting with it
largely takes the distributed look model
so you can commit and I commits locally
and then you can push to get it to the
report remote repository we also
something that hasn't hasn't been ported
forward yet is support for like svn
commands like you just type svn under
the command you're used to from the
command line so that that that will come
back sometime soon and then so that's
the basic support those commands run on
the server side two runs against files
in the project on the server side we
actually basically have files sitting in
a file system for each of the projects
and so it just uses the normal command
the hood yeah when we're editing best
when we actually just are i actually
just sibling the best bin directory into
the server and it just works so it's
actually file sitting there help hey
what status on students or bringing that
up to or is it still gonna be written in
JavaScript yes it will be in yeah I'm
hoping you know we we don't yet have it
on the actual schedule but I'm hoping
it'll be this year that that'll be a
relatively major project I don't play
this year well our desk we're talking a
little bit of that performance of campus
and rendering monster text files India
is so do you just repaint portions your
paint one line at a time MSP changes are
ya it's only it's actually pretty
optimized well it actually does what
most you I toolkits do so it actually
does not only lines but rectangles so
it'll only rectangle only paper will
rectangle that you're using and that
works for syntax highlighting too so
it'll only syntax highlight the part of
the file that you're actually looking at
and as you scroll down it'll catch up do
you render the whole file that as time
is a huge canvas for really big file or
indirect of it is no it's just a chunk
of it and currently when you scroll rear
enders the entire chunk but since it's
only a few lines that you're looking at
that's pretty fast if that's a
performance problem in the in the future
we thought about other solution that we
can do but so far it hasn't been you're
saying ipad support was the number one
yeah it is what's not working what you
have what do you have to do it's
something with text input the invisible
text area is not actually I've had
doesn't get that farther so there's
something out really login screen
apparently like just trying to get the
login form to work isn't working so we I
mean it's you know obviously it's a
two-week-old request so you know we
haven't really had that chance to sort
of prior my lab figure out I got some
other things got it they're well
basically we look at for sure a lot of
what I do which the text editor is
pretty much tightly integrated into into
the operating systems file system
structure so like for example opening a
multiple file searching and replacing
across multiple files like all at once
that just it just best if it happens
capability well it let me show you I'm
gonna um see if i can get this window to
be a size where we could actually see
what's going on can I oh not exactly
okay you're not take the mic basically
so the short answer is yes let me right
now right now we actually don't have the
search and replace across files that is
still a feature we need add but we will
because best been already has but it has
a notion of what the files are that are
in your project and already so one of
the things you know prior to vestment
I'm a text mate user so I'm used to
command T so it's like for anybody who
doesn't know command T like let you open
a file by typing a little little teeny
snip at a file named best been already
has that I was going to demo it but it's
gonna be hard to see in here molla
status you can just I maximize it or
pull that up a little bit so that it's
insane
oh yeah maybe is that just the wrong
brother that's the wrong window your
browsers open yeah well anyway basically
if you if you type open space and you
start typing some part of your file name
it actually pops up a little list of the
files that match and you can select one
so it already has an idea of what the
files are that are in your vestment file
system what about like yes like putting
on 252 Wow side by side not yet but
actually what so one of the things
architectural II now best bin is
actually in a much better position to
support like split views and things like
that that architectural II would have
been very difficult before so you know
all these things are features that we
want to have about a coding offline
since years in turn to deal with ie can
you use local storage to you know to
order your own internet connections that
insane we already use local storage for
settings definitely and we're actually
the next thing that we're going to do on
the file system is to make like mount
points sort of things that you can have
multiple files and back ends because
already I projected out that way so if
you could it would definitely be
feasible to have like a local mount sort
of thing and the files all of the
positive calls into school against the
SPO light or something you make that
work well in there are a number of
different ways to potentially do this
because one is some like imagine a
jetpack for example that lets you access
a certain part of your your local disk
did you get that best man can talk
through so you could mount you can like
a mountain your best man file says you
can up like mount a slash local it talks
to a certain certain projects directory
on your local disk through a jetpack so
that'd be one way to do actually be
working with local files and have access
to eat all your horrible local tools but
edition being able to use best fit I
mean there are a whole bunch of
different ways that
had that direction may our file system
is is objected on the client side so you
know we can plug anything we want in
there do you guys have plans to support
languages that require where are you at
the whim of the Kansas I'm sorry oh yeah
we definitely do that now Japanese is a
little tricky because then you lose the
you lose fixed-width in that case
because the characters are different
widths like you know our characters are
tall and there's our square so that's
actually been the biggest stumbling
block but actually if you enter japanese
text it does work avengers in well yeah
it doesn't render probably but it does
render it actually voters properly once
you take the problem is it doesn't
actually display while you're typing
only when you oh yeah yeah now that
problem is because of the invisible text
area and there isn't a whole lot that we
can do about that one yeah really the
solution for that is going to be dom
three it in text input events I'm which
you can read about to suspect for it
it's just that I did a lot of research
into this and that's that's really why
those exist but no browser has
implemented them yet chrome sort of does
but not but only enough to say there was
a text input event and not tell me what
it was so that so really there's a lot
of work that needs to be done to the
browser department so that you have no
access to for example like move it to
the character it's like for example on
tightly
three kristee one goal like it would be
like there's three like you're actually
I can tab between the characters but
like the actual offset it's not right
like you're actually assuming that it's
like a regular yeah we actually measure
the width of a capital M right now um
which that is actually gonna have to
change pretty soon because that breaks
down in the face of tabs that are
actually tab characters as opposed to
spaces so that's probably gonna have to
change pretty soon so be looking for
that but um yeah but as for actual like
ime supports that's just really hard due
to the platform but i mean fortunately
we're no worse than I mean we're no
worse than text may hear textmate
doesn't even try to support that so
which is not you know what excuse but oh
what do you say that you've had supply
problems or oh no no it is that Bespin
is just a word that sounds nice it has
no relation to any property of Lucas
bahaha oh it's something it's something
I neglected to mention I don't know how
I got away with not mentioning this in
the presentation Bespin plugins are
actually super set of common J's
packages and cabbages packages can be
used investment and we and so if it so
nobody can tell me that you can't use
coming chance modules in the browser
because I can tell you that you can I
don't know why you guys for working with
for did that pan out is that that one
must reboot so well most of the reboot
is actually about re architecting and
building around plugins the GUI that you
see here is actually rendered by sprout
more okay how have you a 2-cm widget you
need all this crap order the embeddable
widget is currently heavyweight but we
do actually have a goal for this corner
to fix that but it depends what you mean
by heavyweight I mean it is just one CSS
and one Jas that you just copy and paste
it they just have to be big yeah they're
they're big CSS and JS files but they
are just one CSS in one case file um
like seven ok or something yeah the
kirtland is like maybe an 800 k really
large yeah but that's actually something
that it is our our goal for this quarter
we're gonna fix so yeah and actually all
you have to do is just put a vest bint
at our best in class class some yeah on
any of your divs and then it just turns
into a best but so it's actually pretty
lightweight in terms of how much effort
you need to advent best with embedded
anything else</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>