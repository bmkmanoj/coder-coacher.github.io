<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2010] Ulrike Mueller: Server-side JavaScript the untold story | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2010] Ulrike Mueller: Server-side JavaScript the untold story - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2010] Ulrike Mueller: Server-side JavaScript the untold story</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jk3Gs5CsiT0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so my talk will be again about
server-side JavaScript but in contrast
that gets to the most of the other talks
i'm not talking about no chess but first
a little bit of background myself so i'm
chief software architect at the demand
for it was a while ago a little startup
now we're 150 people and what we're
doing it be offering online e-commerce
in a software service way so our
customers don't don't have to buy
servers run servers host server
somewhere that just have a login they
login that can put up their products put
up the prices run promotions and an
important thing is they can customize
the website and it's not that they only
can change the color and the icons they
can do full fledge customization to
really implement their brand identity
here for example some examples for
example the deal on london olympics 2012
they use our system and for example this
side is done with server-side javascript
pulling in running the search and
everything another example is here crops
so maybe some of you is wearing these
plastic shoes currently there are
customers of us totally different
experience then here is its Burton
snowboard so if your snow bunny fan you
can go to the website you can buy
snowboards there or here one of the good
cheap brands I have to bring it up
because actually say and try to
implement at that store then for I one
here in Germany and nekem on my command
runs on our platform the whole online
traffic what they're doing is running
through the platform what about should
describe over the next minutes and last
example as Oliver they have also known
here in Germany and they also for
example to have a mobile site so all you
see it's it's not a cookie cutter
customization and that's the question
will come later is where we where we
then use the server side JavaScript just
to give you one number is overall we
currently deliver roughly in an average
day 40 million pages and all these pages
are basically rear ended with a
server-side JavaScript ok some of them
are rendered but
one of them are cached but a lot of them
are really rendered that's also why I
called this the untold story because
we're doing this basically a little bit
in a secret so even so now server-side
JavaScript gets a little bit popularity
actually be doing is quite quite for a
lot while and we're doing is in the
software service environment also what I
want to like to talk about what it
really means the constraint in a service
night in a in a software service
environment our constraints are there
and what we have to what we should have
to acknowledge it's a little bit about
the history so everything started back
actually in 2004 that's where we
actually were founded as a company and
what we did we started with an existing
ecommerce system which was a classical
on-premise software and we said you want
to bring this into a software service
environment so before customization was
stunning done with full fledged java
programming and we wanted to find a way
how can we bring a customization concept
on top of it so that people can
configure the business logic and
implement it on their own storefronts
and also wanted to do things like how
can we do background processing of jobs
how we can do integration into back-end
system so transferring data how can
reduce the web service calls so
basically everything what you typically
have when you want to customize on the
server so at that time it was clear we
want to have a separate programming
language we don't want to open up java
java you can do just too much much
things in the wrong way we have to run
that thing we have to guarantee service
level agreements so there it was clear
that you want to put a specific
customization language on top so
requirements what we had this verse
first of all they were a small team and
wanted use something out of the box you
wanted to use an own language
want to use definitely something open
source so that we can debug it that we
can fix it it was also that we wanted to
have a good control of the execution
that's also one reason why we said it
should be an interpreted language so
that we can interfere and better
integrate and intercept the execution
and also because we had an existing
large java system we wanted to have
something which fits very well in the
child environment absence had time clay
JavaScript with lino had a good stable
codebase how it's used in a lot of
approach that we had fairly good
confident in used to going that approach
options would have been cheap hyphen
project was not very active at that time
crocus I was actually not aware it's a
PHP interpreter in Java was not aware of
that project at a time groovy was pretty
coming up at that time but it was not
finished yet so it was unclear how
popular it would be that would have been
another option and actually at that time
they existed even a Java interpreter but
that was a little bit of a skeptical
about it so that's why we choose and
JavaScript and as a coincident when you
think about 2005 that's also very basic
the whole HX started and ver basically
JavaScript moved actually from this low
dirty language to really a fully accept
the length which again into a check so
it was a good timing that you also said
okay let's pick up JavaScript at that
time so with that one we did one that
overlies and we try to be not a full
book cramming environment and just a
little bit of customization everything
so my only comment is was on this flush
it away are not worth to talk about it
and then we came up to the tutor or
release and that's what we basically
using since 2006 what we have basically
in our product what you hear is just a
little snippet out of our reference
applications or reference application is
very showcase a store on here's a little
bit thing but you can see how we have a
customer we get to the customers profile
to the address book then we can get out
of the address book we can get an
address or a product list is here use
for example as a gift registry we can
here
taken an address out of the address book
inserted as the default shipping address
so that's something very how you do then
customization off the business logic on
this on the server so now I want to go a
little bit more indeed in interesting
part is or let's start with the API
capability so first of all it's clay you
have took all the business objects
available you have products you have a
catalog you have a basket order profile
you can have called methods on on these
things you can run for example but your
product searches you have there's a
search model you just specify your your
parameters and then you do a search you
also need for integration we need data
processing capabilities so what we using
the ephah extender which Rhino supports
were using that heavily so that
customers can import data with it an
export data and process the XML data for
communication we have web servers to
have a little bit more details about it
you can make HTTP calls ftp calls SFTP
calls so that people can integrate their
back-end systems what Pierre we have
form framework your generation we do
click stream tracking that's all in a
web tier and then also custom business
objects and that's maybe something will
quickly go a little bit more details is
so one thing what you may be and don't
see here you don't see sickle so there's
a good reason why we don't provide cycle
access because we are again we're in the
software service environment we want to
change the infrastructure when we want
to decide that we go to a different
database technology we want to do it
without interfering to give our
customers so we are completely
abstracting this one so that's why there
is no sickle here on the list instead
what we provide a mechanism then that
customers can model their little
business objects and say this should be
go into the database and we manage
everything other things you won't find
here is my system access we have a
little bit something in that direction
but it's also something which can be
problematic you don't find that you can
start processes or sub do something in
fretting it's really mad
that you yet we provide the big building
blocks and what the customer should do
is really just arrange these things and
it's also when we look a little bit at
the audience we don't want to force all
because usually because our customers
are implementing these storefronts or
external partners implementing this one
and not we are implementing this drawer
fronts we want to have that let's call
it average developer can use it and
there is not the deep knowledge
necessary on how to how to run a well
behaving and Val performing server-side
application so what we're using were few
words for her towards Rhino sir rhino is
it's actually the core java script it's
very very stable so really in the core
we found one buck ones in the indie
optimizer but beside that one actually
it really the Rhino core is very very
stable who has ever looked into the
Rhino chorus dealt with rhino ever has
looked into the code who would say that
is a clean code yeah that's also what
you found out this makes a little bit
tougher to debug it but it's it's really
it's really working very very stable you
have sometimes a little bit hiccups for
exam with the latest upgrade they
changed the parts of the change so
because we have so many many customers
using it outside we can basically say
that one of our customers is actually
using one of the all the parts of the
code patterns and so they run into
something but a little change in the
parser costs a little bit a hiccup and
also something when you call into chava
methods because that's basically what
we're doing all the time calling into
into our java system when your verbal
arguments they change something they
look up agar rhythms so this is details
when you're really having basically so
many customers outside and using your
system and you want to keep the
compatibility that's a little issues
which you can also run into so talk
about the
ability xml support i'll be using it it
works actually it's a little bit in the
in the edge cases they're a little bit
ish issues so that's that's something
just to know the eyes actually we made a
few little extensions or little tricks
and I want to talk about pick two out of
them the first thing is we allow people
to add a little type annotation and the
the only reason we did this actually is
so that we can provide in an editor of
good completion support so we were back
and forth and then we gave it the first
customers and our own developers to said
oh no no I need completion i need
completion i cannot work with this type
last language and so we decided at this
one this is actually not not checked at
runtime so you don't have to do it your
program works line your program works as
it would be at i plus and it's just a
hint for the editor to to provide to
completion again this was back in two
thousand six nowadays we have way better
javascript it viewers who do path
analysis and that's currently also what
we are looking a little bit whether we
can switch over to this one based on the
notation you can see it's also a little
trap we run into it's actually the
notation which was initially proposed
with the ACMA for proposal so at that
time 2006 we were enthusiastic that's
what that will be coming and
ActionScript already is doing it so we
put it in and ya later showed it was a
mistake to do it in that way but it's
basically helps a little bit to write
these fairly complex aprs to to write a
quick at this table code so the other
extension are talked already a little
bit about web services and get when you
know web services may be on the Chavez
ahead you you check your Vista file you
have to put it in your
or for example that the Vista file is
compiled down for example access down
into Java and you didn't want you to go
that way and we were to really wanted to
fully leverage that we have really a
dynamic environment and what we actually
doing is basically the only thing what
you have to do in within our environment
you take the Vista file upload it to our
service and then we figure out
everything by ourselves and then checked
it basically in the API so what you see
up here summer is a global global SMS
and that's that's a name of a Vista file
so whenever I say rep references global
SMS or the name of the Vista fire the
system knows that now want to talk to a
web service and SH ask a default service
and have my service when there are XML
structures in in that this like NHS new
vet reference global SMS registered user
that create my user information but my
license information then I get here get
the sent message object fill it out with
phone number for example here for
sending an SMS and then here here at the
bottom you can see that i'm calling on
this service actually a sent message and
that's where I call my operation in the
web service wherever I need I don't have
to deal with the details of a
substandard of the octave is defiled how
are we doing this internally here's an
SMS example is basically the first you
take these vista 5 and it's called with
web reference that the Vista filename we
check whether if you have already cached
if not which has compiled a whistle into
Java dynamically loaded java code find
this service through introspection then
create a service instance cash it and
then we basically give de chava script
and war runtime environment and handle
on this java on these java classes and
from vero neck and chest are just call
them okay that's if you have a few other
extensions one is for example it's
cautious import script so it's basically
the little predecessor version but you
have income comments j a common shares
the requires function we do a little bit
more more simple that's what we
example edit so that you can what you
what you could to recall can you can do
programming in the large and structure
your eurocode okay now a little bit the
specific things what it means to be in a
software service environment so the
software service means we have to
operate a software so we have service
level agreements about how much downtime
is is allowed about response times and
everything and they have to Conti this
and we have to guarantee this even so
the actually the softest that we are
operating includes custom code and
that's that's a really SD stretch so how
much customization can I allow so that
hopefully the customer cannot interfere
with my service level agreements and
when I look back I think over the last
since we start with this one s was
always a struggle how to get this right
and it basically means at the end if
there is malicious code it can hurt us
so initially the obvious thing we got
right from the beginning we didn't open
sick of it or didn't open the studying
and everything but you still had some
things wrong so for example we couldn't
believe it that we saw once when service
were crashing with out of memory that a
customer have really had generated a
single single string with 200 megabytes
in the main memory or we found that
executing one storefront script that the
custom created over 100,000 Java
JavaScript objects just hanging around
in memory or another thing like how do i
parse XML oh I read it everything whole
file into into memory even it's 50
megabyte and just positive memory even
so they give the customer a streaming
API that they can do it sequentially
they found out of the way o read that
whole file in and so from this one
that's something which regulate causes
some crashing service luckily the
customers very often don't see it
because we have multiple servers so
someone else can pick up the traffic but
it's always bad for operation
people when the phone rings in the
middle of the night they have to
intervene so what we now implement it
actually is it's now it's a quota system
so that we can control this so that is a
little bit to tube how we did it we did
it a try no modifications so that we can
now control the length of a string we
say if someone has a string with more
than one megabyte some something must be
wrong same way if we if the length of an
often often array or the number of
properties in an object or the number of
objects actually act within an execution
context also we are estimating the size
of the XML ettore if that's too big then
something is wrong and the vet 1b can we
can control a little bit like really bad
behaviors again what I said behind
learning all kinds of developers we have
very sophisticated developers and we've
not so sophisticated developer who
basically just look cold something is it
working and don't think by on this and
we cannot control these curses of these
developers and that's why we have to put
in these mechanisms it's also
interesting be in you know when I would
have other entries for example in
written in C++ I would have access to
memory allocation can change that VNA
chava environment that's why we have to
do that a little bit more on the
semantic level of the of the JavaScript
language another thing is also bad thing
is the eval function it was already
named today once evil and for us it's
even more risky because you could write
something like evil search program and
you put in directly a form value and
basically that's the same equivalent as
you would do a sickle injection it would
now be called service on JavaScript
injection and I know some you can do
create great things with it and if
you're sophisticated available you know
about sickle injection but what are they
about the other developers and what you
keep in mind we are dealing with credit
card data and then we would have an
incident where credit card data is is
exposed it will fall back on us so
that's why the at the end decided okay
we must must turn it off just to prevent
this kind of server-side script
injection okay now a little bit more
lessons learned actually that's one
thing lesson learned was when we started
that I said that we were basic coming
out of the Java world and also our first
customers were coming out of the Cholla
world we knew it basically at that time
still as the little let's say dirty
language on the websites and this had
also a little bit consequence on the API
that the API fears a little bit more to
java centric how the thinking model is
so when I would do design something now
nowadays I would more often for example
use closures so what I can write where
more compact more efficient code and
also another thing was that it would
more use these native objects and and
erase more often when we first came to
this looked at this JavaScript review
used to all these great collection
classes in the Java API you want be
thought we want to have something
similar and so we're focusing on this
one and nowadays I were to go a
different approach and really really use
much more often these arrays copy stuff
into the chair into JavaScript arrays
and expose it in that way that's one of
the miss really it learns what I would
do different today the the other thing
is a little bit how we implemented that
API so basic we had our e-commerce logic
and we decided not to block the
JavaScript code directly on this on this
logic what we said you put in a thin API
layer so when you look at when you would
look at download Java classes you could
see the e-commerce logic it would see on
top of it alone each other API classes
and basically the rider who can directly
talk to the Java classes we talk to
these api classes at that time we were
also a little bit concerned about
performance and when you do this style
you always have the
way am i doing it in a rapping style so
I take a business object put it around
decorated and share certain things or am
I saying I'm really doing a full copy so
if i have my product a copy the value
give it over to the to the javascript
code so we went small very often in the
rapping style and this cost issue so
side effects so we have to upgrade for
example our software then we have new
features we have to upgrade this and it
happens several times that we basically
didn't touch the API and you have fairly
good test coverage on test a PRS but
there was some really strange side
effects and whenever there is something
changes in the business logic with a
rapping style the risk that it basically
take it through and is visible in in the
JavaScript code you can also think about
that basically a problems with via phase
is very similar to on to a browser
vendor we have other people's writing
the code running in our system we have
to keep it comfortable we have toward
side effects so we're basically in a
fairly similar business and that was one
lesson what I took from this one don't
copying is not so in intensive copy of
stuff and make sure you're basically
separating and really isolating from
your actual business logic ok so now I
want to also talk a little bit about the
future so what is what is in our plans
so one thing what was mentioned today
already are a few times is common shares
so that's what we are currently looking
into it what what thoughts are coming up
there so we will adopt the module
concept so to replace or what I
mentioned before what we have an import
script which is a tiny little bit
awkward to real place that we're looking
into the package concept you're looking
us in the unit testing so we currently
have you a basic unit testing in there
that you can run assertions and check
assertions and everything but maybe if
this baby want to take this one what is
currently in discussion other things
what is currently in
proposed in the common shares it's not
applicable for us it's the gay as again
because we are soft as a service
environment we cannot have streams we
can all sockets we will not have a real
full-fledged file system access we will
always have the abstraction of just
storing plops you also have no real
notion of a standard in standard out so
so they come and share so we will
constantly look at is whether we can
adopt some things but we will not go the
way that we say okay we will and
implement everything another thing what
it will change it's also something when
we really go server side is really think
about the template language so we
currently have a tank template language
in the system which is but mostly
inherited from the existing old system
and yeah it's a little bit ugly and so
we are currently looking to replace the
Swiss was something which is very fairly
simple and so assembly it took some
ideas maybe how the other Ruby works and
so just these little smaller and percent
simple then you can insert JavaScript
code and in between it's all HTML having
some libraries that I can to trustee for
template utilities link and can generate
a link for example to another page so
that's what we're currently a think
about doing if someone knows about the
approach edge where someone is doing we
should talk yeah yeah we should talk on
them and so that's also a look really
looking around if there's a cool project
group someone around it so also we are
happy to help there and also use it then
on ours our side okay that's that's
actually all material but I had prepared
and any questions or is everyone hungry
who's hungry I don't know whether this
is the maturity okay
good thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>