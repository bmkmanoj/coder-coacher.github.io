<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[CSSConfUS 2013] Pamela Fox: When Bootstrap Attacks | Coder Coacher - Coaching Coders</title><meta content="[CSSConfUS 2013] Pamela Fox: When Bootstrap Attacks - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[CSSConfUS 2013] Pamela Fox: When Bootstrap Attacks</b></h2><h5 class="post__date">2013-08-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xbpnqbM6cRk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone hope you're enjoying your
time on the island I have so far seen
three lizards I don't know about you
guys but I'm kind of a lizard stalker so
I'm going to start off today with a
horror story and I think that would be a
nice way to start off of everything but
I'll try and have a happy ending at the
end so this is about an experience I had
with Twitter bootstrap while working at
Coursera so first some background I drew
in Coursera about a year ago I have any
of you used Coursera before cool all
right
so Coursera offers these classes online
from universities and we've got a huge
range of classes so we do have you know
the really nerdy classes like machine
learning and probabilistic graphical
models which I still don't know what
they are but then we've got stuff like
the history of rock canine theragen
ology which is how dogs reproduce which
is apparently is really actually
important to people that reproduce dogs
for a living and so we've got a huge
range of courses on this website and so
what I have been working on since I
joined was making it possible for people
to browse courses and take courses and
learn and all that good stuff right so
when I joined Coursera of course I was
curious about how the Coursera stack
worked and what it used behind the
scenes so we had a a modern stack which
was our backbone j/s which was backed by
a python django api but then of course I
discovered we have a legacy code base
and our legacy code base is the code
base that started it all that was the
prototype right because there was some
Stanford professors who said oh I'd
really like to put my classes online and
they had their grad students sitting
there and they're like hey you grad
students make me a web app
so the grad students made them a web app
using what they what they knew of as the
the best way and that was using PHP and
my sequel and a custom PHP routing and
templating and sequel query library and
everything was custom and so that's our
legacy code base and that is actually
what the majority of our code is in is
in this code base so I avoided that code
base for as long as I could I played in
the in the modern code base for as long
as possible I was like oh I'm gonna add
this to this and this to this and this
this and then one day I was like you
know I can't just avoid this legacy code
base forever
it was kind of this thing like looming
in the back of my head like I know I
need to get in there because that's what
the stuff that I really want to change
cuz that's where you do all your
learning is in that code base so
eventually I decided that I wanted to
actually get into that code base and
tackle it but it discovered that we
actually had a lot of bootstraps that
we're using across the code base so our
modern app was just using bootstrap 2.1
but in the legacy code base I found that
we're using bootstrap 1 and we were even
using bootstrap 2.0 in some places so we
have three different bootstraps across
the code bases and that's bad because it
meant that it was really hard to reuse
things across the code bases right so I
couldn't reuse the same JavaScript
libraries I couldn't reuse the same CSS
I couldn't reuse anything right so the
first step for me to getting into that
code base was to unify the the
bootstraps across them and now I think
it's obvious why it's bad to have that
many bootstraps but I have done a bit of
scientific studies into the number of
bootstraps and developer happiness and
this is based on a careful survey so you
know you could be ok with zero bootstrap
and you could make your own CSS and all
that stuff but of course we like
bootstrap because it gives us a nice
basis for prettiness so you know one
bootstrap is really really great right
but as you approach infinite number of
bootstraps yeah it gets really bad so I
don't know
so there's my science for the talk so I
fired a little JIRA issue that said port
to bootstrap - and I thought it was
going to be easy
I had ported previous apps to bootstrap
- and it was just one of those things
you did you know when you had a couple
hours free and you're watching a crappy
TV show which is all I watch and I was
like this is easy I'm just gonna do it
on one of my cow train rides to and from
the city and so I started and I just
started by following the upgrade guide
and this upgrade guide will tell you
what the new classes were so from
bootstrap one to two I don't know how
many of you have been through this
process I raise your hand if you've ever
upgraded bootstrap wow you guys are
lucky alright so if I'm bridge type one
to two they changed a bunch of the class
names they added some remove some they
changed away some of the JavaScript work
and so they had this upgrade guide which
showed you how to upgrade from one to
two and it's funny because they actually
took down this upgrade guide at one
point cuz they thought nobody else was
upgrade and I was like hey hold up you
got to put that upgrade guy back there's
gonna be people upgrading for like years
and years to come
so I've started following it right which
mostly meant looking for class names and
replacing them with new class names so
first thing I realized was that it was
going to take me longer than a train
ride right so two days later you can see
all my commits over two days I was
basically going through each of the
different parts of bootstrap so
upgrading the table and then the button
and then the grids and then the forms
and then the tabs the pills the alerts
the popovers right just going one by one
through the guide but after two days I
realized that this was not a job for a
train ride this was going to take me a
bit longer because I was still only
through like the first half of the ups
grade guide and I hadn't even touched
our JavaScript at all because there's
also bootstrap JavaScript and it turns
out we were using the bootstrap
JavaScript too so I kind of had to put
this off for a bit and work on it in the
side and a month later I got back into
it and started doing more and more stuff
and then I realized like wow this is
big thing I've taken on I discovered my
codebase was bigger than I thought it
was and and that this was actually going
to be a lot trickier so I got kind of
tired doing it by myself and I brought
in some colleagues right this is what I
kind of realized every time I try and
rewrite something at Coursera is that
it's really hard to do it on your own
and it gets really exhausting sometimes
you got to bring in colleagues and and
people to do it with you because they
can give you the energy to keep going
because it's not a really glamorous and
exciting thing is at the end of the day
my goal was for it to be exactly the
same so if I did my job right nothing
will change and nothing will break so
it's one of those things that is so not
glamorous but something you really
really want to get done and stuff like
that sometimes you just got to bring in
recruits to help you out right so I
started getting my colleagues to jump in
and one of the things I do when I want
to get my colleagues to jump in is I
have a thawne's so you can basically
take a thorn and put it at the end of
anything right so we have tested ons and
perfect bones and skeletons so for this
one I had a bootstrap v2 athon I know it
rolls off the tongue but I was like
listen guys it's really really fun we
sit in a room and we upgrade bootstrap
and we look at every single page in the
site and we check to see that it's
working so my colleagues really enjoyed
this a fun I luckily we work across the
street from a party store so we just go
to the party store and we bring back
like balloons and inflatable shark
somewhere like come on have you come to
the thon you can have an inflatable
shark which works surprisingly well so
we had a Nathon we had to had a couple
of thawne's and and that helped a lot it
got a lot done and so after we were done
making what we thought were all the
fixes we send it to QA because at this
point I didn't have the confidence that
we'd actually gotten everything and that
everything was well done but I was also
kind of tired so we have a QA team that
we sent it to and we gave them to
staging servers and so they just went
through every page and just looked back
and forth between bootstrap one and two
and remember the goal is that it should
look exactly the same so they gave us
this is only part of the jury
so there was like 60 screenshots in this
issue that they filed with all the
differences and so we had to go through
each of them and make this fixes so that
took about a week of QA and finally
after the week of QA I was like all
right okay I think we're ready I think
we can do this and so then we had what I
call a deploy athon which is where we
sit in the office and deploy code that
I'm too scared to deploy by myself so
this usually involves some sort of
alcohol too I usually have my colleagues
press a button because I have like a
mini heart attack if I press the deploy
button so finally a month after I filed
that issue I got it out right and you
can see my final pull request was 97
commits 346 files changed and I think it
was something like 4,000 additions and
4,000 deletions so it turned out to be
kind of a big pull request and kind of a
big change and I might have taken the
opportunity to redo some of the rest of
our architecture at the same time and we
only had one big issue that came out of
it and that was just a mistake with with
this silly JavaScript in our in our
system so we kind of measure our deploys
by the number of post mortems that come
out of them because we always write post
mortem so I only had one post mortem
which was yeah okay um so that was the
ordeal right and I did not expect it to
be that hard right I thought this was
gonna be a fun thing that I did on the
train and I get off the train and be
like yeah I upgraded bootstrap woohoo
but it wasn't right and why was it that
hard so there are a few reasons right so
first of all our code base was a lot
bigger than I thought it was because
when I joined Coursera my only
experience with with Coursera was as a
student right I had taken the HDI class
and I knew that oh there's these quizzes
you take and these lectures you watch
and there's not that much right but then
I discovered that 90% of our app is an
admin interface right because the
teachers have to create the classes and
upload and create
quizzes and all that stuff and I had
never seen that before so in doing this
process part of it was good because I
got a chance to see everything in our
code base it is actually a pretty good
way of getting familiar with every
single part of your code base so we had
something like 200 PP template files 350
controller for aisles 143 JavaScript
files and 25 CSS files right so this was
a lot of files to look through because
maybe basically I was looking for you
know bootstrap usage across all of these
different files and the thing is that we
were using bootstrap class names
everywhere right so you would think that
oh just look in your template files
that'll be good enough no we had PHP
utility libraries that were generating
you know of course your classic form
generating functions right we had a lot
of those right this is a little form
helper class so we had we had class
names in our HTML in our CSS in our PHP
and the worst of course is the PHP that
outputs JavaScript that has class names
in it so I had to look everywhere for
these class names right
and of course bootstrap does not have
very grep bubble class names right try
and looking for you know alert across
your codebase
I found 80 but try looking for info
because of his button info was there
there v1 class name a thousand places is
where info is mentioned cuz info is kind
of a generic thing that we use
everywhere right so these were not very
easy to grep for and I'm like really bad
at creping right but I every time I like
tweet about it my dad is like no it's
not that hard so I can't even whine
about how hard it is to grab things so
really hard to grep these these
bootstrap class names in that big of a
codebase and of course bootstrap wasn't
just CSS it was JavaScript and we were
using that JavaScript and we had
modified that JavaScript and we need to
get it to working exactly correct again
and had to be accessible and all that
stuff so a lot of our our changes in the
end we're all around the JavaScript and
getting that JavaScript functionality
working exactly the way it worked before
so that's why it was hard now I've
thought about after going through this
process I thought about what would
actually make this better and I came up
with a lot of different things that
would have made this experience better
and some of these are things that we've
already started doing other things or
things that I would love for us to do in
an ideal world where we had enough time
so hopefully this is the sort of stuff
that you can think about for your apps
and especially if you're starting your
app now from day one right you can
actually start off with these practices
in place so that you know year later
when you have more engineers join it's
gonna be pleasant for them to upgrade to
bootstrap 300,000,000 so the first thing
that seems kind of obvious is that the
way where you were using PHP was it's
kind of horrible write PHP outputting
JavaScript outputting CSS and HTML is
it's pretty bad and the reason that can
be really bad in this case is because it
means there were so many places I had to
look in order to find we were using
class names right I had to look I had
look in PHP classes for this stuff right
and we actually had you know we'd have a
line which is our HTML and then the next
line would be a sequel query statement
right so if I did a grep and replace
wrong I could accidentally mess up a
sequel query statement right
you know we're placing your CSS class
names should not end up and you
accidentally changing sequel it's bad so
generally it's better if you can
separate your concerns better so that's
why we have our new architecture uses
backbone GS and then Jade for HTML
templates and stylist for CSS and our
API is completely separate from that
right so at least I have some degree of
faith in the new architecture that I'm
not going to end up changing the data
that comes back but of course another
thing that's important besides having a
better architecture is to try and only
have one architecture so this is another
one of these highly scientific graphs
but basically I think one architecture
is good to have and the problem is the
more and more architectures you have the
harder it is to come up with best
practices and conventions and the harder
it is for me to figure out how each of
the architectures work and where I
should look inside of them right so this
is one of the things we've been trying
you know we've been experiment doing a
couple architectures and we're
converging on one but right now we kind
of have a handful of them but now there
are things that would have made it a lot
easier if if Twitter bootstrap itself
was different right so one thing is that
bootstrap has these incredibly ambiguous
names short names alert label but in but
so one thing would have been amazing is
if they had been named space right if
they were just TBS - alert that would
have been a lot easier for me to grep
for it right and there is actually an
issue that has been filed on the
bootstrap issue tracker about Auto
prefixing all the bootstrap classes
unfortunately they decided that they're
kind of not that into it I think it's a
hipster thing so we're probably not
gonna have bootstrap appending
namespaces to their to their class names
anytime soon but there's a lot of people
that are interested in this because it
you know what things make it better so
there's multiple blog posts out there
about how to Auto prefix the bootstrap
classes so there's one about doing it
with less there's another one about
doing it in sass so if you're using one
of these preprocessor frameworks it can
make it a lot easier for you to actually
get bootstrap namespace in your own code
right so I would highly recommend
looking into that I think it would be
amazing if the bootstrap team decided to
be to prefix it for everything cuz I
worry that five years from now there's
gonna be all these code bases that have
this alert class name in there
everywhere and there's gonna be somebody
sitting there like me trying to grep for
it and wishing that they had been named
space right so the thing about bootstrap
is that it is used by so many so many
websites today that anything that they
do as a default will become the default
on those web sites so we can be you know
good conscientious people and try and
prefix ours but the majority people
probably won't so if you can convince
them to fulfill that issue it would be
amazing but one thing I've tried to
start to try doing is just to avoid
using those bootstrap class names to
directly entirely write so I want
ideally in our CSS we would only ever
have Coursera CSS class
and those Coursera classes would simply
extend from the bootstrap classes and
you can do this if you use a
preprocessor so we internally at
Coursera we use this bootstrap stylus
port but bootstrap is written in less so
you can also use the original less so if
I want to extend the button I just
create my class and say which which
button classes extends and then I also
at least in stylists have to define it
for the hover state as well and say that
those extend the button hover States but
then I have this CSS class name that I
can use and I can just swap out what is
extending from behind the scenes right
so this seems kind of ideal because this
kind of means that if you were only ever
using your own class names you're not
dependent on somebody else's class names
you could theoretically swap out a
different framework behind the scenes
right and that seems really promising
like if one day you know you decide that
ZURB is better there's this new crazy
thing that one of you guys is working on
and you come out with you just swap it
behind the scenes so I've only started
doing this in a few places because you
know it takes a while to to start coming
up with new practices and implementing
them but I do generally think this is a
really cool approach and then what it
would be great is and this is something
we thought about doing as well is having
your own internal style guides that show
all the classes that you're using so
imagine when you go to bootstrap and you
see this is our grid and this is our
button classes this and this copy that
but just do it with your own classes so
anybody developing or designing can look
at this style guide and see oh right
these are other classes we should be
using right so they're not using at the
beach they're not looking at the
bootstrap Docs anymore they're looking
at your style guide so I think that
would be awesome as well
another thing I've started to do is to
stop using class names directly in our
JavaScript libraries right because one
of the big things about this upgrade was
that we were using our JavaScript and
I'd have to go through and upgrade
everything in the JavaScript as well and
everything was depending on these class
names so we've started writing our own
JavaScript libraries and we tend not to
even use the bootstrap ones anymore
and these JavaScript libraries will
specify a CSS prefix in the the default
options
and passes into all the templates so the
templates we use them for the libraries
so you can see like our Jade template
says okay this class is going to be
prefix + - toolbar and then when we use
this library we specify that the prefix
is going to be Coursera
- wizzy html5 right so then in our CSS
we can define what that will look like
so now we have full control over what
those classes are and exactly how
namespace they are so I think this is a
nice technique as well and it gives you
a lot more flexibility to namespace your
classes however you wish and there's
another there's article about that as
well and another idea that I've seen
talked about in some blogs is just not
to use class names in your JavaScript
all right because one of the things we
see is that we're not just using CSS
classes for our styling we're using CSS
classes for JavaScript often right we're
saying okay
whenever something with this class class
name is clicked on we're going to do
this action right so that means if
you're changing a CSS style you could
potentially break JavaScript all right
which means you could potentially break
your entire site you could change the
CSS style and rename it and suddenly
nobody can sign up on your site because
you are listening to a click event on
the wrong class name right so this game
sign it kind of scary because it means
that CSS is doing a lot right so one
thing you could do is two different
approaches one is that you could have
class names that were specifically for
j/s right so I could have Coursera -
submit - Jas and that - Jas at the mean
could mean to be oh wow if I change this
I know that I'm changing this thing
that's used by Jas right so it would be
like a convention so that you knew that
was just for Jas and not for styling
right and then in your interview you
could listen just on the - Jas classes
another approach is just use data
attributes right and I've started doing
these in some places so if you use data
attributes and so you might have like
data - Jas action and then in your view
you're just going to hook into that data
attribute instead
right so these are just techniques to
make sure that you're not using a CSS
class both for styling and for
functionality because it just introduces
a whole other realm of things that can
break if you decide to change that class
name
now of course testing all right this is
one of the big problems with our old
code base is that it was completely and
utterly untested I think it's at 2%
coverage now so if it had been if it had
a testing framework in place then I
wouldn't have been so nervous about
releasing it and deploying it right I
would just run the test and run Oh
beautiful everything works I don't have
to worry but it didn't so I had to set
it through that week of manual QA so
it's really really important to test
your front-end especially as we're doing
more and more stuff in our front-end
right before our front ends were dumb
and our servers were the smart ones but
now our friend ends can do a lot which
means you need to be testing them a lot
and a lot of times you actually have to
be testing them even more than you would
think so because if you've got
JavaScript hooked up to your front-end
then you don't just have to test the
like you know that they click there and
something happens you have to test like
sequences of events that can happen as
well right so testing is really really
important
so we use a combination of mocha and
chai and jeaious Dom to load in our
views and to render them and to
stimulate clicking on them and to check
what is visible then and check that
things are shown and check the content
and the size and all that stuff so now
we can run this code over all of our our
backbone views and make sure that they
work we don't really have that for our
PHP templates yet but one day when we
just rewrite everything we will and we
also have some selenium tests as well
and selenium will you know selenium
tests will open up a full browser and do
the entire integration tests from sign
up to log in to view the page right so
that's the ultimate cuz it Meo that's
exactly what the user is doing but the
basic point is that if your if your
front-end is doing anything it needs to
be tested right so this is something
that I wish we had had from the
beginning and something that takes time
to
right so once again this is a great
opportunity for a test Athan if you
don't have tests yet just say you're
gonna have a test Athan go and buy a
bunch of inflatable animals and sit in a
room for a couple days just test stuff
right because it takes a long time to
build up the amount of tests and it can
be really intimidating if there's no
test right it's a lot easier to add a
few tests to existing code base than to
go from no test at all but testing isn't
going to catch everything right testing
isn't gonna catch the subtle differences
that can happen in terms of the padding
and the sizing and all that stuff and
those differences actually matter quite
a lot right and this is actually what
I've run into the most with upgrading
bootstrap is these subtle differences in
spacing and those differences can be
really really bad right like there was a
change in bootstrap which meant that our
input widths were like six pixels less
which now means all of our numbers that
people are entering are cut off and they
can't see their second number number and
that's basically a functional problem
right if your user can't see their whole
input that they've entered that's bad so
CSS is you know not just about it's the
perfect amount of white space it's
actually functionally showing you you
know information so you can actually
have differences that happen that are
hard to test for because they're purely
visual but you could actually test for
this if you could do what we call like
visual diff tests and so there's this
cool framework called needle which is a
way of using selenium plus nose and
Python and what it will do is they'll
open it'll use selenium to open up your
website it'll take a screenshot of your
website and then it'll dip it against
some known screenshot that's good right
and then it'll you can compare the two
and see what the differences is using a
visual difference algorithm so that's
really cool right because you could just
automate this to go across your entire
website and find all these differences
which would mean that I could have run
this instead of sending it to a QA team
who had to do this manually right so I
think that's really cool is isn't
something that we've had time to
implement yet but if you do have
selenium tests already and then this is
something I would definitely try out and
see
that works and I know there's also other
people working on other perceptual
difference and so I think that there's
gonna be a lot more of this stuff coming
out because I think more and more of us
are realizing that we care about the
differences between between our two
things I've done even the ghetto
technique which is Photoshop and you
overlay and you just change the color
layer brightness - it's just something
like saturation different something like
that but that takes a while right so I
think in the future we're all we're all
gonna be running these visual dips over
our front ends every time we deploy
because it'll get more and more easy and
people will create more frameworks for
doing it but we're just getting started
with that okay so what I want to take
away from this is that CSS is actually
something that really matters right CSS
is not just something that we're styling
our websites with to make them pretty
CSS effects a massive amount of things
it can affect your JavaScript which
means you can affect your functionality
it could break your entire website it
could disable people from signing in
correctly from being able to submit
their quizzes it can make it impossible
for somebody to read a bit of
information that they're trying to read
it could hide a modal instead of showing
it so we are using CSS for a lot which
is cool but also really really scary
because so much can can break if we
don't use CSS correctly right and we
don't use it with protections so so
that's the takeaway is that you should
you should really be paying attention
your CSS like actually when I do code
reviews these days I pay more attention
to the CSS changes in the code review
then to the server side changes because
I know the server side changes are
pretty well tested I know that people
know that those are important but CSS
people often think like I'll just change
this number here no big deal right but
it can actually be a big deal so pay
attention your CSS think really
carefully about you know how you're
handling your prefixes and how your
modernizing it and how you're testing it
and how you're doing it and just
remember that it actually really
does matter Thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>