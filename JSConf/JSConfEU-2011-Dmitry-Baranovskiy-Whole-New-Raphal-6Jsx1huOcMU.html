<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2011] Dmitry Baranovskiy: Whole New Raphaël | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2011] Dmitry Baranovskiy: Whole New Raphaël - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2011] Dmitry Baranovskiy: Whole New Raphaël</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6Jsx1huOcMU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm gonna talk about Rafael uh so who
doesn't know what is Rafael who had no
idea wasn't to go and talk to them you
gotta kidding me okay then we will skip
the next slide I guess next couple of
slides so it started as a three years
ago and it it's just rude back to
library to drawing stuff from the web
uses a surge in BML doesn't use canvas
and more concentrated on creating a nice
API than you know solving any other
issues so chapter 2.0 I basically giving
this talk because i was told me recently
that Rafael is stagnating no nothing no
development happening and I was so upset
about this because they're huge
development happening for last year just
happening on the 2.0 branch and it's
also looked like a small improvement is
most of the time it happens and then it
grows grows grows and I can't stop to
improving it so I going really release
it because I can't really hold it
anymore so what's new in 2.0 the first
of all the BML the Microsoft drawing
rubbish
it was completely rewritten from scratch
so I just take everything that was in
Raphael destroyed away the problem was
that as many developers when I was
creating Raphael I look at the msdn and
to look at the other other libraries
like daughter like X can you ask how
they use a vml and obviously follow the
same path that was a big mistake they
all wrong they all did it wrong so I did
it better now so that's like an example
of a difference in BML which I was
trying to solve it called sub-pixel
rendering that you see there two squares
and the square on the right the square
on the left is this quadrille and SVG
the square on the rights of how the same
square will look on vml you probably
can't see the difference from this so
let's zoom it up so that happens because
when you specify when you when you
specify the coordinates and as integers
and when you use a you know SVG and use
one pixel stroke it actually doesn't fit
in the pixel grid and happens to be on
the edge of two pixels and get blurred
across these two pixels and we could
have a long discussion is good or bad
thing but this is how it is and in envy
ml you CSS to position elements and you
obviously use integer numbers for that
and that's why it's always nice and
crisp but it's not the same it's not
consistent and sometimes this difference
is really really annoying so it fixed
now in Rafael 2.0 it's pixel to pixel
exactly the same in BML and SVG because
it was rewritten again the
transformations it's not the important
part of a pretty much any drawing
process so the transformations which
originally didn't pay much attention
when it when it created the Rafah
and then I paid more attention to it and
then I decide to completely change it
the whole API or the transformations the
reason why I did it is because it's
something which is you use most of the
time if you're really doing stuff and
something which is very important so
what the transformations basically it's
like I can rotate and draw a rectangle
then I could rotate it around some point
and then I should be able to rotate it
around other point that was impossible
in Rafael before if you want to rotate
around another point you will reset the
previous transformation so now you could
rotate another around another point the
problem is a transformation then when
you apply multiple transformation they
all relative to previous one so if now I
want to say okay now translate
horizontally 100 pixels you will see
this picture because the whole
coordinate system is transformed
transformed as well which is may be
correct but not really useful so in
decide to introduce relative and
absolute transformations in Rafael so
now you could say transform relatively
and then you will see this or you could
say transform absolutely and then you
could see that I think it's important in
transformation to specify the Holy
origin of transformation especially when
you're talking about rotation scale for
example in SVG venue when you rotate you
specify the point around which your take
when you scale you don't specify the
point around which you scale because it
doesn't really sound like make sense so
I'll show you if you want to scale this
reactor from around zero zero point look
like this that's how it by default does
it not really useful most of the time
you want to scale somewhere around the
middle of this of the square now maybe
maybe here maybe there you should
specify the point of scale it's actually
existing or in rockville 1.5 and i just
want to emphasize it a little bit so
original sort of API will be like that
right she rotates about some point then
you rotate
on another point then you translate
around town point and that sounds good
no doesn't sound good at all hey the
problem with that approach is that later
on you can't really okay you use your
Tate used cave you rotate it on site now
you want to get the transformation of
the element how you going to do this are
you going to animate the transformation
a felony this approach of this API
doesn't really work well this which you
provide a different approach it has a
transform a tribute which contains a
string which contains the comment i like
idea of one attribute which keeps all
the data but the format's of this not
really good i look at the canvas API
don't want to talk about can see the SVG
is a little bit better but it's still
not good enough so i was thinking about
this and I will decided it sounds it's
the problem sounds familiar there is
already in SVG the API for linked
comments with the parameters it's called
a SVG path when you create SVG path you
have a comment and you have parameters
you move to this point draw a line to
this point it draw a cubic vizier to
this point you draw something else and i
decide that it would be in spirit of s
with you to fold the same pattern for
transformation and that's this API
appears so you give a string in string
each letter represents a comment and
numbers represent the values you pass to
the comment so for example the first
line grid like rotate 30 degree around
100-120 then rotate minus 45 degree
around 6210 then you could when you ask
for transformation give you a string so
you could ask this element what is your
transformation grab this transformation
applied to another element and when you
get it you get it as an array of commons
you could easily parse it goes through
the comments remove some commons at new
ones you can also spin you specify you
could also use the ellipses and in this
case energies would be replaced with the
current transformation of fun element in
this case they say like scale twice and
then apply whatever current
transformation is and on the last third
line i say okay whatever it is now
transformation then scale
you twice around 100 hundred position
and boot absolutely so the law case
letter means relative transformation
uppercase mean scale you could rotate
you could translate you could scale and
first time in Rafael you could do matrix
transformation so just like pretty much
any transformation animation the
animation in Rafael is actually pretty
good and the API is pretty nice and
nobody was complaining except me so I
don't I look at other api's of animation
and I don't like any of them because
they don't give you flexibility and
sorry let's just look at what I've did
so let this is a small example of the
animation this is a sort of pac-man like
animation so I click on this circle it
moves on that's pretty simple right
let's see this code how it's actually
done not here yeah right so we include
the Raphael and then we create them here
we create the Raphael colder FL
functionally create the surface and then
the raffle function now have a fourth
parameter which function call back so it
will create surfaces on Dom ready then
call the callback and the surface will
be called call back in the context of
the surface the surface become this now
this CAC AIT's a new Elias for custom
attributes so the custom attributes
exist before just I want to again
emphasize a little bit so we create
another new custom attribute month and
basically the mouse it's a function
which received value from 0 to 1 and
return me the path of a pacman face and
from 0 is closed mouth and one its open
mouth and whatever between its whatever
is between as soon as I have this is a
custom attribute I could then animate
this custom attribute and I could
animate the mouse
so then i create the animation this is
another news feature so I call the
Rockville animation and I create the
animation with two keyframes and only
half is mouth wide open and on the end
of the animation mouths shut and I say
that it's running 500 milliseconds this
is just animations it wasn't applied to
any element yet just the object
animation so then i create a path and as
you see the past doesn't get any past
drinks its pass without puzzling and set
attributes mouse 0 which will call the
function and you draw me back when with
a shot at mouse i make it yellow remove
the stroke and unclick i say this
animate and I grab the animation I just
created until to repeat eight times and
then I say animate transformation 400 /
x + 0 / x so the element it's happened
to be in two animations at the same time
so it's opening and shutting his mouth
and it's moving horizontally and they
apply it to the same element and the
first animation actually repeated eight
times and this past animation just goes
right right i am little bit ago so the
this the animation usually represents
like you you click the click the button
you start the animation and while it's
going you have no idea what's going on
unless it's finished and you receive
your call back and then you see aha
animations finished but you if you want
really to know the status of animation
any point of the time you don't you
don't really have a tools to get it so
in Rafael too i introduced a new feature
so you could actually give their status
of animation and you could change the
status of animation that give you
ability to totally control any animation
as much as you want so you could change
you could stop you could continue from
the point where it stops and so on and
so far I think it's awesome
well doesn't doesn't look like this you
lost your phone so they all they all
were all apic rocks you still could
create animation like that so you
animate to the new attributes during
this time is in Quebec but behind the
scene to create the animation object but
you could do it yourself you could
create animation object and then you
could animate element just like that it
was the object the good thing about it
then later you could say what's your
status and the element which I ok I'm in
three animations right now the first
animation am in the beginning the second
animation I'm in the middle in the last
animations I'm about to finish and this
is animations now okay I'll grab the
second animation apply to this element
because I wanted him to move like that
and so on so the API is like that there
is a method status and by default
settings which only array of all these
animations and their statuses if you
pass the animation object it reaching
the number from 0 to 1 depending where
the animation is but if you it also set
us so if you pass the number and the
animation then it will change the status
of this current animation jumps to the
position you specify forward to backward
depending on the current status you
could pause and resume you could stop
said time is basically a shortcut for
status but you use milliseconds from the
beginning of the animation for example
if you want to sing Chris keep better
parade milliseconds and percentage and
the animation has method delay and
repeats delay means it started up right
now but after some given period of
milliseconds and repeat basically it
will go to the end then roll back to the
beginning and go again and let's as many
times in specify if you want infinite
loop you pass infinity ok events I'm
generally big fan of event driven
development and event-driven
architecture so I was thinking that
events is something the draw file is
missing so not so long ago i wrote the
library called EGS which is basically
event managing custom event managing
thing and somebody asked me yesterday
why I don't use some
some existing libraries for events well
basically because when I wrote it they
didn't exist yet so you could use
recovery for that so I'm not promoting
this library I mean you don't you don't
have to use it but Raphael have it
inside so how it works it work Raphael
always firing the events in the eve
space so you could always listen to
events and lots of internal features are
bounded on events but you can do it like
that so you could say okay Eve on an
animation do some function that means on
any animation event animation related
event in the Raphael it will call this
function so if you start animation stop
animation animation frame or you could
say on each animation start call me
function some animation started or each
animation start the idea of element for
this particular element called the
function all a niche animation related
event for this particular element of
this function all you get the point
again hope so this is a another thing I
had let's say you want to draw the the
polyline this is actually how your
approach to draw a line like that it's
very easy to do it in SVG or in Raphael
for that sake and the problem that it's
not always what you want sometimes it's
quite easy but it's sometimes you want
to cure and the only thing you know it's
points which curve is going through and
you don't really want to create its
pubic began thinking how they should go
so basically you need to draw the spline
so I had new Commons in Rafael so now
it's easier said you could create the
curve which without much trouble the
only difference that instead of
specifying the common l-proline you
specify common are and that will create
this shiny cove just specify the points
and to draw you the cough against around
this point just you can do it with the
math but i guess nobody likes math so
I don't like math so I decide to put it
in another improvement is bounding box
bounding boxes soldiers in battle of SVG
every time you do something it's very
commonly you want to know what the
bounding box of element you are
operating with so like if you have this
cloud the bounding box would be this
green rectangle now in for some reason
in SVG if you apply a transformation
transformation doesn't bond in both
these antique transformations into
account so let's say if you want to
animate rotate the cloud and keep the
bounding box to look like this doesn't
really care about God my cloud because
doesn't care about transformations I
don't think it's useful I think it's
stupid so I change it and then Raphael
2.0 you could use all the way if you're
crazy or you you know like pain but you
could also do it neway and then it gives
you real bounding box of an element on
each point it wasn't easy you know
this time was better okay the view box
is also very powerful thing it's
basically if you want to zoom page to
some region to show this region because
it's all vector graphics should be
easily to achieve this that's what view
box in the SVG is for but unfortunately
vml has issues which now resolved
because they were brought Dave EML so
you boxes like that you just scale and
you see the image like this it doesn't
scale change the view box but it's kind
of scaling the whole thing down load up
and you can throw back so now this is
view box new view box comments in the
Raphael write documentation this is a
painful thing for every developer to
write the commendation I'm not an
exception I hate to write the
commutation especially take into account
as you can hear my English is not my
first language not even my second
language and I hate documentation but
good documentation is the essential part
of any software so this is in you
documentation for Raphael it's very full
it has everything and how it happened
actually is I include the documentation
into the ruffian to the source code so i
will be ensure that it's always in sync
with the changes and bug fixes and soul
and improvement and so it generated this
documentation have this church so if you
want to search for the tailgate point
get point at length so give me the
straight away or if i want to search
like four point give me print because it
seems close it's like trying to find the
it has nice church it's called this and
it has all these methods here so you
could go through the ole alphabetize
italy all grouped and the documentation
self has a very nice has all this
you know examples embedded in it has all
the parameters listed you could help us
these parameters so you pass just
animation all the type so let's
explanation the pooh pooh pooh all the
source code syntax highlighted all very
nice and very like to do this
documentation i use library i wrote
because as you could guess a look at
existing libraries and even like them
and so that's how the comment looks in
the novel at the moment so you specify
the name of the methods as the first
line then you specify the type is it
method to property and you can see the
first character in each line actually
tells me what the line is for so you
could asterisk is just the description
just the text if it's cash then it's an
HTML I take it as ease if it's a greater
than then its header if the dash is list
of arguments and because in JavaScript
you could pass different list of
arguments the same function that gives
you ability to create documentation for
if you pass 300 miles please if you
passed for grants is that and so for and
so far and the pipe means it's a course
it will be grabbed since is highlighted
and put into HTML and the name of the of
the element of the methods will be
taking off who this alphabetize it all
be structured so it's structured but
it's very flexible you could write any
rubbish here you could break it up but I
don't care about you because I wrote it
for myself right and for a fail so the
main one important thing that Rafael now
have a good documentation and I call
this library dr. GS so if you if you're
interested you could go and check out my
github account so what's new in Rafael
2.0 I really running out of time because
just 30 minutes talk so I just quickly
run through the new features to Rafael
function now has ability to go specify
the callback she could pass the call
back in and it will
give you the coal bag the new object
animation which I was talking about I
have met his delay and repeat the
element has metadata just like jquery
data so you could associate data with
the element and then take it the gate
box get bounding box was improved to
actually rely on the transformation then
you method glow which everybody was
asking it's just like drop shadow but be
careful because it's consumed wads of
memory so don't use it cautiously on
drag all right the way to assign the
event handler in case when you're
dragging Raphael has drag-and-drop
building so when you drag over some
other element it could throw the events
you dragging around on top of this
chocolate log of this rectangle so you
could use it for your work the post is
the animation part remove data is from
opposite of data resume the time stated
solve animations that transform you
method to create the apply the
transformations and to get it the new
alias for custom attributes CA the the
paper hazard for each method so you
could go through all elements on the
page and do something get element by ID
kind of tells for itself get element by
point so you could pass x and y and give
you the point give you the element which
is on this point the topmost not all of
them path has a new add new comment for
the splines render fix is a special
method for Firefox because it has issue
is SVG sub-pixel rendering and you
resize the browser window if you run
into this issue you could use this
method to fix it up set start and set
finish is a two methods when you so you
could call set start then run some code
then call set finish and that finish
will give you back the set which
contains all the elements which will add
it to paper between sets start and set
finish so this presentation is all done
in rafael if you noticed and each slide
is using set start and finish and then
when new slide appears they just drop it
down I don't care what I add there the
animation new property the color is
new nice utility function you could pass
their color in all the four months you
could possibly think about and it gives
you back the object which has the hex
representation RGB hsl HSB and all this
stuff they create unique ID it's musical
internal the full feel is like a tempest
molten plating solution edges BHS le RGB
obviously give you the color but you
specify HSB or RGB the metrics if you
really want to play with transformations
each element now has a matrix property
and metrics property you represent the
matrix and you could then grab these
metrics and add some new transformation
if you want to play with metrics you
know literally go for it there is API
for that Parsons from string give you
the ability to parse the string set has
new methods clear exclude for each and
splice there is Yves and there is even
more awesomeness
any questions yes
sorry
not fully
well basically the only difference is
the transformations so all the others
past but you use stuff only
transformation has been changed and yeah
by the way I the Raphael 2.0 available
now yeah I release it just before I
start talking the glow yeah glow creates
shitloads of Dom elements to represent
to make the glow effect so if you want
to create a glow it looks fine if you
want to animate them glow then it
doesn't look but you yes god
forbid what canvas well I already split
like if you look at the source code i
split raphael into three parts so now
there is rafael core of LSU gene or flv
ml which is built into one Spile still
and my plans is to create a Raphael pro
which will be Raphael without vml but
with all the different SVG features
which are missing in repair because of
vml limitations at the moment so if you
like developing for WebKit let's say you
don't care about IES and you could just
use raquel pro which gives you more
power but doesn't go in ie6 but if you
don't care about a six seven eight then
you're lucky man jealous but you can use
it it's it's a future I thought there
yet there is Raphael pro already but it
doesn't include new features it just
doesn't have vml at the moment so you
could use it yeah any other questions
okay then thank you all the time and you
can go and draw something amazing</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>