<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Matt McKegg: I Play The JavaScript - JSConf.Asia 2015 | Coder Coacher - Coaching Coders</title><meta content="Matt McKegg: I Play The JavaScript - JSConf.Asia 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Matt McKegg: I Play The JavaScript - JSConf.Asia 2015</b></h2><h5 class="post__date">2015-12-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NL0nb8A8FDM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone how's it goin uh yeah I'm
Matt and I'm from New Zealand as you
probably didn't know from my accent is
anyone here from New Zealand by any
chance yes excellent I was I had this
whole list of things I was gonna ask so
no one here was from New Zealand I was
gonna say well is anyone heard of New
Zealand and has anyway yeah okay great
I'm just making sure cool so yeah I I
make music with computers and the
JavaScript part is pretty recent I've
been doing music a lot longer than I've
been writing JavaScript but I'm gonna
tell you today about how the two worlds
collided for me about three years ago
and you're gonna hear what I'm going to
tell you basically the entire story so
yes sit back and enjoy and hopefully at
the end I'll be able to show you my new
zakat that I'm developing and I'll try
and make a song with it based on some
stuff from yesterday so computer music
I'm sure a few of us here are familiar
with the concept so this is Ableton Live
this is the software that I've used for
quite a long time now and it's um it's a
way of making music where you you're
basically putting all of the individual
notes in by hand while with the mouse so
I have about five six different
instruments here and so the first one
we've got is a synthesized bell sound
so all those sounds are hearing I've
actually gone in here and I have
manually put them in with a mouse
actually I may have recorded this using
a MIDI keyboard but I'll get to it later
and but but the the point is that I have
complete control over everything that is
happening here I I see the entire
timeline out in front of me very much
like a composer would I'm not actually
playing an instrument Here I am telling
the computer where I want to hear sounds
so I'm gonna play you a little bit of
this song just so you can hear how it
all comes together so you see is a
marker moving left to right showing the
position and you can see the events
being played as it Scrolls past
Thanks so with this way of making music
it's more like you're painting your song
rather than playing your song
you're in complete control of every
single thing that happens and it's
actually quite a fun way to make music
particularly at first because you don't
actually have to be particularly skilled
at anything you can just put things in
and they make cool sounds and that's
what I was doing back in 2006 I was just
having fun making interesting
compositions on my computer I had a few
friends that were interested in too and
we were just just basically hanging out
at school not doing any work and just
making music and then I grabbed a bunch
of all the songs that I've made and I
uploaded them to the Internet and I made
some fancy cover art and I don't know
why but some music blog thought it was
really good and they wrote this
wonderful review all about my album and
then it got on some links sharing
services and before I knew what I was
getting hundreds of visitors every day
and all these people were downloading my
album and the next thing that happened
was I started receiving some fan mail
and I started off you know like oh this
is great we love your music and the next
minute was like come play your music at
our University and how on earth do you
play this this is not I didn't actually
perform it it's it was something that I
it's like asking asking a painter to
play their work live you can't really do
that but you can get them to exhibit
their work so a reproduction of the work
so yeah how do you play me as a computer
music laughs and the obvious way is just
to recruit recruit a bunch of musicians
to actually play all the individual
parts live for you
so maybe you can play the cool synth
flying or whatever but you have someone
else playing the drums and someone else
playing you know the other things and
there is actually a pretty cool way of
playing electronic music live I really
enjoy bands that do that but at the same
time it's it's a lot of work and it's
not the same thing you're actually
having to go back to the beginning and
refigure out how you gonna play your
song live so I I have never done this
and I would love to do this play yeah
this is this what obviously wasn't the
way forward you need you to pay them
obviously you need to pay the musicians
and yeah I'm I just want to work on my
own so really the only other option I
have is to DJ my music and this is
actually the way the majority of
electronic musicians or computer
musicians play their music live they are
really just playing you what they
created in their studio it may be as
simple as changing the tempo a little
bit and mixing the songs together or it
could get elaborate and you could split
all the individual parts of your song up
you take like that sound there that loop
and the drums and then put them all on a
special launcher
like this where I have all of the
individual parts of the song laid out in
front of me synth up here drums and we
have Hardware controllers so this device
here is called a launchpad it was
designed for being used with this
software here called Ableton Live and
you can see that this grid of all my
clips actually corresponds to this grid
so when I push that there that clip
launches I push this button here their
whole line watches
and I also have some knobs up here which
control a few parameters like the filter
so
so yeah that that works alright but if I
wanted to veer off the path at all if I
wanted to just play the synth a little
bit different I'm kind of stuck with I'm
just stuck with this pattern here I'm
not exactly going to come over to my
computer one plane and start plucking an
extra notes because that's that's stupid
and not cool and I want to be cool we
can add another controller and that will
let me play one of the instruments live
so I'm still using this for all my drums
etc etc but one of the synthesizers I
could play live on top so to do that I
would just select it from my list and
turn the input on and now when I play it
here
and here lies the problem I can't even
play the keyboard so Who am I kidding
yeah so all this this this is quite a
kind of quite a reasonable way of
playing your compositions alive but I
actually don't really find that that fun
and I tried doing this for a little
while and it was just it was just so
much work setting up everything and
putting in the perfect place and then
when you actually went to play it you
had no control you know I wanted to feel
like he could tourists they can just get
up on stage they can just start playing
their instrument and they can improvise
they can do it or they like they can
have other people playing along with
them and like a jazz band they just
groove and it's great I want to be able
to do that with electronic computer
music and well yeah obviously JavaScript
you kind of saw that one coming right
because it's J's cough bs JavaScript
that was where I went next
and the reason I went to JavaScript was
because I know JavaScript I don't know
any other languages and yeah I thought
let's just let's just see if we can if
we can add another layer of expression
to this software here so instead of me
having to play everything live
or having to rely on the clips that I've
already set up I want something in
between where I can play something and
head a button and that will keep looping
or I can go into a mode where everything
is triggered perfectly on beat because
that is kind of the most important sound
of computer music so everything is
perfectly quantized with the tempo and
if you want to make computer music it
has to be spot-on it has to be perfectly
in time and playing this isn't going to
get me that so what I want to do here is
intercept the messages from my MIDI
devices do something clever to them and
then send them to Ableton Live so this
device here uses a protocol called MIDI
MIDI was invented in about nineteen
eighty-something so it's quite an old
protocol but that makes it really simple
and every music software today
implements this protocol and just about
every hardware controller implements the
protocol too so just quickly this does
not make any sound on its own all it is
capable of doing is sending messages
saying which button has been pressed
so using this little bit of JavaScript
oops we can see what's going what the
messages are that are coming out of this
device so that looks pretty simple right
it's just a bunch of numbers there
there's only three numbers we can deal
with three numbers we're not passing
some complex protocol here so the first
number sorry the first button I push
gives us 144 48 and then either at a
some number or 0 so I push it harder we
get a high number if I push it softer we
get a small number and it goes to 0 when
you let go well this it's complicated
but that's the easy answer it goes to 0
when you let go if anyone's done any
MIDI stuff they'll know what I'm talking
about there maybe so as I go up the
scale the number in the middle increases
and octaves that's the zero note it's
beautiful now if we wanting to intercept
the messages we can capture them easy
enough but how do we then send them back
to Ableton Live to actually play the
things we're processing so at the moment
I'm only peeking in to the things that
are coming out of here I'm not actually
able to change it in any way but this
little bit of code here lets me create
what's called a virtual midi port so I
can pretend that I am a MIDI keyboard
but it's actually my own JavaScript code
so now if I run this nothing happens yet
but in this list here we now have a new
keyboard called JavaScript music so I
can hook that up here and now if I run
this again
so that was node telling Ableton Live
what sounds to play and for some reason
it didn't work as well as oh I missed
one
so I'm sending messages to both the to
the two first instruments so they play
the same thing now this device here both
of these devices they also use MIDI it's
the exact same protocol that this is
using so I can use the exact same
technique to intercept the messages from
the launch pads whoops
frame time
and now when I push buttons here you can
see the same messages coming up whoops
I'm just gonna disconnect from live
after I'm able to live otherwise things
would be crazy okay so we've got one
4401 27 let go it goes to zero so it's
just counting up from zero all the way
along we get to the end of the line
though and it goes to 16 so we've got 8
here and then 16 and that could make our
lives a little bit trickier in the
future but luckily I know how to solve
it with maths now if we send the same
message back to the launch pad again
that we just received it will light up
that button I don't know if you can see
that on the projection but that button
is lighting up when I press it
it's really loud you can all hear me
right excellent
okay I'll just I'll just play along with
the wonderful rhythm outside so how can
we turn this stream of MIDI data into an
object that is really easy for us to
transform in interesting ways
so we're talking about being able to
loop the playback so oops I missed
something I know I didn't know if I we
want to better loop the playback we want
to be able to quantize it align it so
I'm a real fan of the observable pattern
and this is my favorite module for
creating observable objects it's it's
just JavaScript which is what I like
about it so really what you're doing is
you're creating a object sorry a
function and you can actually set its
value or you can request its value just
by calling it and if you instead pass a
function it will call you back every
time that changes now this here is a
very small wrapper around arrays to turn
them into two dimensions so I specify
the shape I want of the array which is
three high and four across and I pass it
some data and it will data and it will
stick it like that so I can ask what is
it position 0 1 what is it position 1 2
etc etc and then this little bit of code
here no just the two together it gives
us an observable grid so every single
time I play something over here is
actually returning a whole new immutable
object that represents the state the
entire launchpad at that exact moment
and whoops
try it out
so now you can see I have a grid
representation of the data of my button
presses here
and if I want to send that I want to
translate that grid back into MIDI to
then forward onto Ableton Live I can use
this really complicated little function
here it's actually quite simple when you
break it down but all its really doing
is every single time there's a change to
the object it scans through to see if we
can find out what's changed and then it
will send that particular message
through to Ableton Live so it's kind of
it's converting our snapshots into back
into a stream of changes
so now we can hook it up to our other
grid by saying whenever the input grid
changes sit at same value to the output
grid
so it may not sound that exciting but
that message is going from the launch
pad into JavaScript and then into the
music application so we can do anything
we like now at this point we can we can
transform what I'm doing over here in
any way that we can imagine and I can
also send it to the launch pad as well
just so we get the lights lighting up
it's it's really hard to see on this
camera unfortunately but no it's not
gonna work it's really overexposed get
my white hands in there then we can know
that the lights are lighting up though
believe me okay so this is what we have
so far like I said now if we want to do
anything clever with this observable
object transform it into another another
form like like I was talking about with
a looping or the quantization we can use
this module here called observe
transform and it's really just a special
kind of observable object that does
something to the data as it passes
through so you set it with one value and
it will call you to ask a little
callback and I asked what object do you
want this to be actually what object you
want to be notified to everyone else so
you can transform the data to become
anything at that point so this here is
using these two other helper methods
called connect and send whoops so just
clean up our code quite a bit so instead
of having all of this stuff we can just
do that and it becomes a lot easier to
see the signal flow here so we're taking
the launchpad
and we are sending it to the output grid
and also sending it back till they walk
the launchpad to light up the button
oops I'm just gonna and this is a
transform using that transform function
we just imported before and what all it
does is whenever there's a change it
then calls keep range on that input
which is part of the array grid that
I'll be using they can you can request
just one little part of it so every
single time the main grid is changing
you'll get another grid there is only a
small portion of the first grid so we
can just grab that that one whoops that
one part of the grid
and oops how did i zoom no ah this there
we go
yeah I had three fingers I was resting
my okay and we'll stick that in there so
we are slicing the grid up into a bunch
of smaller grids which are thin so we
take a slice and then we send it to the
output so the first range is 3/8 which
means three down and eight across so
it's that whole zone there the one below
it is to eight so it's two two down and
across and so on and so forth and I am
seaming 144 for the first one but 145
for the next one and so on and so forth
so that actually lets me split it out
into different channels in my software
whoops channel 2 channel 3 channel 4
channel 5 and channel 6 so if I save
that and then run it I get a big error
because I deleted the input grid wait
why is the Empire I probably got console
that log in here somewhere
there we go you read that
so now this first line here the first
three lines play the the bells
instrument but the next one down and
that's working pretty great but as I
said before the most important thing
about computer music is that everything
is perfectly in time and there's just no
way that I can play as perfect as a
computer and there are certainly people
that do have the skills to do this and
if you look them up on YouTube you can
find some amazing performances people
that are actually playing things live
with your fingers but I can't do that
and I don't want to do that and I don't
think it really represents computer
music anyway it's it's another art form
and it's great but it's not computer
music so how do we quantize how do we
align things perfectly with the clock
Ableton Live has the ability to send out
a clock signal and what that really is
is just a pulse at a certain it's 24
times it will seem to pulse perfectly
aligned to the current tempo every beat
so that's quite a few ticks every second
at 120 beats per minute that's like 48
different events and we can hook into
that clock using another virtual midi
port like this so we and we're now
listening on clock input as well and if
we log that out you'll see a whole bunch
of messages coming in and that's coming
in extraordinarily fast it's coming in
at 107 beats per minute so that'll be 24
I don't know math had yep so I'm gonna
use a computer to figure that out for me
so this little bit of code here creates
another observable object every single
time it receives that message 248 it
increments this value here and it also
figures out the current beat by then
dividing another by 24 again so what you
get out of this
is the current play that position I've
got three four five six seven eight nine
ten and if I change the tempo here you
can see that number getting faster it's
incrementing faster if I bring it down
it goes slower see perfect 120
okay so now that we've got the current
position we can use that as part of our
transformation so instead of just taking
one little section of the grid we're
going to be as I guess instead of doing
a spatial transform we're doing a
temporal transform and we can hook it up
so I'll quickly explain how this works
every single time its value changes
either the input value or this current
position which is that new observable we
just created this function down here
gets run and we're using a little bit of
mathematics no just kidding to figure
out so we've got a rate so we want to
quantize to every beat for instance so I
can't play faster than each beat if I
hold down a note it will just keep re
triggering that beat so we're just
voting out if we are at the start of
that or not and if so we capture that
frame and then we keep playing that
frame back until we get to halfway
through and when then we just return
nothing and that sounds like it sounds
really cool I promise you so we stick it
in here the launchpad flows into the
repeater and then it gets sent out to
all the different instruments
so that's great yeah that's really great
and like once I discovered that if I M
she'd tell the story correctly that was
one of the later things I discovered I
was doing the looping stuff first and I
found that's actually the main thing you
need is be able to hold the buttons down
and have it trigger perfectly in time so
it's it's kind of like you are playing
chords of time that makes sense so I'm
holding down buttons and instead of it
creating a nice chord and musical sense
it's actually creating one over a bigger
time frame which is yeah never mind I
don't know it made sense in my head
before s it is but say we do actually
want to be able to loop what I've just
played so say I'm playing a really cool
drum beat but I want to free up my hand
again so that I can even play something
else
so in order to do that it's actually
quite simple because we have the entire
state at all times we can ask what is
the current state of the launchpad we
can record each event we can record each
event and hahahaha it is alive and and
then we can go back in time and get
those events later and we can take just
one little chunk of the of the things
that have just been played so I can be
playing something and it's recording
everything I'm doing at all times and
then when I push that button there I
want it to go back in time and retrieve
everything I just played and keep it
playing that's what this function here
does so this is really simple all it's
doing is every time there is a change
its thing just pushing it onto the onto
an array it's really straightforward
and this one here is just doing a filter
on that array to get the the range that
I've asked for and that just lets me
listen to when I'm pushing the button
and I want to say is I want to loop and
it takes the slice and this here plays
place it back so this is just a reverse
transform it's taking the current loop
and it is checking to see what the
current time is and if the current time
corresponds just to an event in the loop
they will change its state and broadcast
that out so yeah well we that's what we
want and I would love to the live code
it for you but I've only got ten more
minutes so instead I am going to just
give you one I prepared earlier which is
right here
no MIDI and I've also added a few more
things like of these buttons here up so
I can see where things are so that's
like an undo and redo and I've got down
here I can change the rate of repeating
absolutely
I'm gonna stop that again that was
really weird
oh yeah so what about Web Audio this is
not web audio this is node J yes and all
I'm doing is processing a stream turning
into another form and then putting it
straight out this is just like any old
streaming web server really and but what
can we just get rid of Ableton Live
altogether and just do the song we've
audio and I really wish I'd never asked
that question I wish I just stuck with
doing this this is so simple and great
and you can explain it in one little
40-minute talk but no I I went down this
rabbit hole and I have actually gone and
built my own application based on the
exact same things I've shown you here
but it all runs on top of web audio so
I've got really time to talk about the
technology behind it but we've got as
module a wrinkled audio slot which it
lets you create it's an observable
object just like everything else so you
can put it on your grid and do clever
things with it and you can declare what
sounds you want and will build the
necessary web audio stuff like what Paul
was talking about but it does it for you
so you don't have to worry about hooking
everything up it just makes it a lot
easier to wire everything together so
I've got that and I know I won't
I won't show you this I will just show
you my app so I can play you I can play
your whole song if we if we do it now so
let's do it
okay so we'll close note don't need that
anymore and that and close Ableton Live
sorry Ableton
ah and down here I have my app called
loop drop and I'll open the project now
when I was just out the back before I
quickly put together some sounds yeah I
I really like Douglas Douglas Crockford
he's great but it's it's just really
cool hearing and him like regretting his
decisions about JavaScript what did he
say
oops there's not going oh great here we
go technical difficulties
yeah it's gonna have to shuffle my ports
around of it until they work it's it's
not my apps fault it is a problem with
USB 3 and compatibility or something I
don't know hopefully it'll work now
now nothing's working
oh wait no it's cuz I didn't hook it oh
gosh I didn't hook it up yeah we're good
we good everything's fine cool so let's
bring that up so we can see it okay
javascript is a hot mess
javascript was designed in 10 days it
turns out you can
I don't know anyway I don't know whether
it was going on this day
again that was in case I forgot the link
to the video so yes this is my
application it's called loop drop it is
fully open source you can look at the
code you can hack on it you can do it if
you like but you can also know you can
you can buy it as well yeah if you if
you don't want to like it if you don't
know how to use NPM then you can buy it
I'm trying to encourage a new kind of
open-source where people that can
develop as sorry can contribute by
developing you can get it for free but
people that just want to like use it and
abuse it they can pay me it's great so
everything you saw is JavaScript HTML
CSS all that stuff but I'm using
electron which is a wonderful tool by
github to package it all up and turn it
into an application that actually runs
on your desktop and it has access to
everything node has as well so it's
chrome and nodejs
smack together so I can have full file
system access which is great for an
audio application because it means you
don't have to be worrying about shifting
large samples around the internet now
destroy with science this is the name of
my band everything gonna go a bit crazy
once I started playing with the stuff
and my old band name just didn't seem to
fit this Luna yeah so you if you want
you can listen to some of my interesting
experiments so every every single
Thursday night I play a live session at
at a hack group in my city and usually I
play for an hour along and and I put
them on soundcloud so you can check them
out um and yeah I have no idea what I'm
doing I just did it I just started and
learnt an awful lot along the way very
much like what I in a couple of talks
before about the
the textiles about for the Knitting is
the exact same thing you even it's
amazing what you can learn when you just
start doing interesting things like this
and reaching out and but I have learned
some important takeaways from all this
so yeah just start writing but you need
to keep on rewriting over and over and
over and over and over again but don't
do the whole thing at once so just throw
everything away just rewrite the parts
that bother you right now and try and
keep it modular so that you don't have
to throw everything away when you want
to make a change yeah that's what I've
got
so thanks so much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>