<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ray McDermott: How Toyota Motor Europe use Heroku | JSConf EU 2014 | Coder Coacher - Coaching Coders</title><meta content="Ray McDermott: How Toyota Motor Europe use Heroku | JSConf EU 2014 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ray McDermott: How Toyota Motor Europe use Heroku | JSConf EU 2014</b></h2><h5 class="post__date">2014-11-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JlRHyg60vvI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi yes I'm rare thankfully the rooms
emptied out a little bit so I don't have
to be quite so nervous as I was
beforehand I'm not going to be showing
you much javascript code I'm afraid so
if you don't if you want to see a lot of
JavaScript code from Toyota then that
means you go to the next room I'm going
to start about something that we've been
working on as a company for the last 100
years and that is these things the cars
okay
this is the one example which I thought
might impress JavaScript developers most
car companies most equipment
manufacturers most people in the
manufacturing world think about this
kind of thing which is a product and
this product doesn't have anybody in it
if you can notice this you'll find that
most of the manufacturing brochures for
almost all equipment is without people
because most original equipment
manufacturers really care about the
product and once it goes outside of the
factory it goes to some distribution
network and then other people deal with
the people who drive these cars and we
can see a nice lady here in a car that's
good we can get some people into cars we
know that's happening in a dealership
somewhere but we don't really know much
beyond that now something about this
picture you might recognize apart from
the fact that we've concentrated mostly
so far on the steering wheels and on the
dashboards and on the kind of engines
and all that kind of stuff but now we
have these new things in the cards will
allow us to serve the customer a lot
better and to really track I mean
understand what they're doing
in a better way so this actually changes
the game for equipment manufacturers
especially car manufacturers we've had
an engine we've had steering wheels
we've had cars out on the road for a
long time we haven't really known what's
been going on with them until fairly
recently we've got stuff like the Maps
telemetry and what we want to do is to
be able to connect the actual vehicles
to the customers that are driving those
vehicles and this is the beginning
actually of a culture shift that was
mentioned earlier on because all of the
systems inside of Toyota all of the
systems inside a Ford inside of all of
these manufacturers are all geared
around producing stuff they're not
geared around linking the people to the
things that we produce and that's an
opportunity for us because you know as
architects we we benefit from
opportunities and crises and in this
case we want to connect to the cloud
there's a lot of people out there we
can't control that so all of the on-site
technology that we have that we've been
used to where there is a kind of
understood a limit to how much activity
can go on no servers suddenly becomes
challenging so we have an opportunity to
go to the cloud in manufacturing
companies this is the sort of split of
things as it were we have research and
development we have supply chain we have
manufacturing and distribution and what
I want to discuss a little bit is about
the fact that from a software side
research and development looks like
software development to me that's where
we do all of our development nuts
bizarrely that's not where all the lean
manufacturing stuff comes from that's
not where all the agile stuff comes from
actually that that is a bit undiscovered
like most software development it's kind
of hard stuff that has to be done and
it's not repeatable it's not simple so
that's where we are mostly on the left
research and development but we've got
supply chains now for us and for isness
room supply chains typically are things
like software as a service or software
libraries like we use databases or
commercial libraries or open source
frameworks and then we have
manufacturing and manufacturing in
software in my opinion tends to be
around the deployment the data center
and the data center is the thing which
was under pressure so we want to
potentially change that manufacturing
from a local data center to a cloud data
center and of course the distribution
from our side is the internet or the
network now these guys do their
exercises in the morning so they are
agile in that sense but they're not
changing things here okay what factories
do is their repeat things there we have
the ideas in the software world and
factories stamp them out go through a
process manage that process make sure
it's all repeatable make sure it all
works and and that's good now one of the
problems with this is that this this
doesn't work very well if it's not
reputable if it's not scalable so if I
have to go to each of these factory
workers and explain to them how to build
that car it's not good we were taking up
to two days to deploy stuff in the in
the existing system now I've got some
drawings here if there are some pictures
on the left-hand side this guy is
actually making bricks by hand now
that's fine artisanal work therefore
this guy everyone's happy you know he's
got a job but I would liken that perhaps
a controversially to the technologies on
the right hand side which are all the
sort of stuff that we were using before
this very manual so dotnet XML using
file systems for our content using
subversion is our version management
system everything was kind of manually
deployed it would take dears to deploy
something not just to write it and test
it in queue it
things but to literally deploy it into
production and then we're using
monitoring tools on a per server basis
like this sconce type from Microsoft we
decided to change that too to a
different stack because we wanted to
what I would say is architect for the
factory we want to architect for
something which is scalable something
which is automatable something which is
simple and visible front to understand
and what we did there was we moved
basically everything and we didn't we
didn't do any competitions it says net
use this many CPU cycles or did is Java
slightly more no more friendly by the
way I I've got it like the other guy
I've got a background in Java and
closure and some other non JavaScript
stuff but i sat with naud for a few
years did some development in it made
sure it was real I like to think that
architects should actually touch stuff
and make sure that it's valid and it's
workable and the things actually do what
they say on the tin so so I spent about
a year with JavaScript without node
about a year and a half with node I'm a
competent I guess I can write a few
scripts what I found hidden or which was
really interesting was that you could
run it you all know this but you can run
it in incredibly small environments so
what you don't want to do is rely on a
big fat operating system underneath it
so if I want to spin up ten nodes for
instance then I don't want to be
starting up ten instances of Windows I
don't restarting ten instances of Linux
either it seems a bit strange to us so
we went we realized that node is very
lightweight
we wanted to potentially spin up lots
and lots of instances of them and so we
didn't want to go with something which
was dependent on some very high cost
monolithic operating system and I think
Windows is that I think Microsoft
realized that I think they're getting
involved in a docker project they're
getting involved in all kinds of Linux
environments on their azul' platform
but but windows as a for us if we're
going to get ready for the factory then
I don't like to look at their factory
that Factory looks a bit heavyweight it
looks like it's kind of clunky to start
things up so we want to drop dotnet and
drop windows we wanted to drop xml we
were using xml as part of our content
management system but that was burning a
hell of a lot of CPUs and so if you if
you know we didn't we didn't benchmark
this because we just the CPUs on the
existing websites were just always at
100% so I don't need to benchmark that
it's terrible so with it's quite easy
for us to say okay let's just stop
parsing stuff if we use Jason we don't
need to pass anything so that's really
nice I didn't need to like you too much
about moving away from a disk to to
MongoDB because we be getting disk falls
on a weekly basis are we getting
discount which is on a weekly basis so
that was quite an easy sell
moving from subversion to get was a bit
of a headache for some people because
they didn't understand what the benefits
of get were but we worked with the
developers to offer to make them realize
that actually pull requests and the PS
system was a lot more powerful than the
subversion work for they had at the time
and we went from a manual deploy to an
automated deploy we use we use a stack
from Atlassian some of you guys might
know confluence and JIRA and they also
have a build system called bamboo and a
git system called stash and the stash
because we're a big manufacturer and
we're scared of Secrets going out of the
the world then out of the world then we
have to have everything behind the
firewall so our cord and our build
systems are behind a firewall at the
moment at least and so we use that the
bamboo and the stash stuff to do that it
supports pull requests and everything
which is very nice so you suddenly get a
lot of visibility into
cord quality and then we moved from
these individual systems out to things
like New Relic and log entries on Heroku
a lot of add-ons to understand what's
going on within the system suddenly
we've got eyes on the system in a way
which we've never had before so that's
been removed from that kind of sludgy
stuff out to the this more automated
environment now so okay where do we
build the factory typically we build
factories in the real world where there
is a lot of water a lot of energy sorts
of available labor so where do we build
our Factory on the cloud well do we
build it on the cloud first question of
course I mean a lot of people are
thinking okay let's just take a take a
stack and do it internally the problem
with that for us was that we wanted to
say okay we're going to go this way
strategically and if we do it like that
then unfortunately or fortunately with
Toyota you have to build a lot of
consensus and that's that's good
because if you are doing things together
then you're doing things in a strong way
but that means that to do this on
premise to do it properly on premise
would require a lot of investment and
the startup cost of milk and internal
cloud is quite high you have to buy a
lot of hardware you after a datacenter
you have to invest in training people up
in how to run that cloud so actually it
turns out from a timeline if nothing
else we couldn't afford to do that for
this project something that we're
considering for future projects but an
on-premise cloud at the moment wasn't
possible so we decided to go off premise
now we do need to be aware that while
you movies need to be aware that Toyota
is a global cooperation has
relationships with lots of different
companies so we have come
relationship with Microsoft and Amazon
we're using Amazon all over the place
and we wanted to do a comparison then
between essentially those three big
flavors Heroku Azure Amazon some of the
smaller players like Engine Yard joined
Google App Engine OpenShift that was
more of a on on site stuff so why did we
go with Heroku rather than those are the
two big guys mostly was because we
wanted a true platform as a service that
we could adopt quite easily we wanted to
build something which was unaware of its
infrastructure so if we deployed nodejs
to Heroku then it would be unaware of
the fact that it's going to Heroku with
Azur it would be a bit more aware of it
because it would be on Windows if you go
with a zero on Linux you don't get the
platform as a service Amazon has this
thing called Beanstalk which can do Java
and no js' and docker and these other
things but again Amazon is really an
infrastructure as a service company does
that very well as its moved up to
platform as a service there's a few gaps
there
so for instance the tooling around the
Amazon Web Services isn't as strong as
the tooling around things like a zoo or
actually or Heroku all these are the
guys because Amazon's API so if you ever
look at them there's like a thousand API
is everything is a REST API and it's and
from that sense it's really good if
you're a tool builder actually if you're
Heroku then it's really fantastic
because you have a platform to do that
but as a as a kind of shop where we're
trying to essentially outsource this
activity again it would be an extra cost
for us to manage that the other thing
that we liked about it was the fact that
there's a lot of ecosystem around Heroku
we could make add-ons we could add
MongoDB without elasticsearch just push
a button
the add-on comes and configure an
environment variable start consuming
I'll start pushing to that database or
that search and
so it's really nice what we've leveraged
also with Heroku is the fact that they
do have platform API it's like like
Amazon but that platform API is quite
small you can we have a system for
instance that uses nord to deploy
applications from one environment to
another environment the other
interesting thing about Heroku is that
it's an open-source build platform I
don't know what the code is for for
Beanstalk and I know what the code is
for Azur but I know what the code is to
deploy no js' on Heroku I can go to the
github repository I can see what they're
doing and if I don't like it I can
change it
in fact we built we built our own build
pack for nginx
to include some Google PageSpeed
functionality so that's really an
advantage that we that we found with
Heroku was that if we didn't like their
build packs we could change them in fact
we just use their vanilla node.js
package but we have added some others we
can deploy in Europe as well
once these guys can deploy in Europe and
so that's good but the fact that we can
keep our data in Europe helps
regulations and helps health people from
being too scared about putting stuff
that the NSA can see although to be
honest the NSA looking at websites
that's okay it's another hit the other
thing I liked about Heroku was that
coming back to that kind of monolithic
operating system model is that Heroku
has some early insights into Linux
containers so everyone's awash with
docker now everyone's kind of happy
about docker and Microsoft even and
Google and all those guys are all
getting into docker as the basis for a
platform as a service but Heroku is
already there so they're already using
these these Linux containers and they
have a nice document called 12 factor
net it's a website which gives you all
the kind of architectural guidelines you
should follow which helped us to prepare
for the factory the thing that
and again I don't know how many of you
guys are from big enterprises but if you
if you look at these smaller companies
like Engine Yard or joint then it's a
difficult sell to say okay I've got this
thing called nodejs
and I want to run it on this platform
called Engine Yard and the executives at
least in our company are like what's not
I haven't heard of this engine yard
isn't that where we scrap our vehicles
they just don't understand so I could
say instead actually we want to deploy
on this thing called Heroku and it's
owned by Salesforce we already have a
global partnership with them okay take a
box
move along so essentially I could come
in under the radar which was which was
pretty tricky but it all worked out I'll
give you a little bit of an insight into
how we run our operations now I can't
we don't literally go to Italy and
deploy to applications or got to spin
deploy applications over with a
helicopter what we do is we have I
mentioned at the beginning I actually I
think my my friend dimension the
beginning we have this monolithic
application on site and on site we have
one app or one cluster of apps that
serve the rest the whole of the Europe
and what we do now instead is we have an
application which we can clone and
deploy out on a per nation basis or a
per market basis that's actually turned
out to be really good for us because we
can then go to places like we can we can
try things out on markets like Portugal
or Bulgaria or Azerbaijan as a back
channels about three visitors a week so
we can try a few things out there make
sure it works we've got a couple of
diners over there and then we can say
okay right now let's roll it out to
Greece that's right out of Portugal or
we can take a bigger risk and we can
circulate make a change on the French
website and it's isolated only to the
French market and that's really helped
us because in the past we've been stuck
with these discs Falls or these out of
memory errors or if we lose a machine in
the cluster we're suddenly down a 60
sent of our capacity with this system
instead we can just say okay if it's a
particular campaign going on in in
Poland or Russia or Finland or whatever
we can just turn up the dinars for that
market either manually or through some
automated system and that's what I would
call manufacturing these websites so
we're going more and more towards that
model of having everything dedicated
towards a particular marketplace from
the top to the bottom so the web server
the the middleware in the Nord the
database has everything all the way down
the stack I'm at the moment we still
have some things that are on premise and
that are kind of monolithic and we're
breaking those out as we gradually break
those out we're following the same model
and this is really a key thing for us
it's the ability for us to spin up lots
of different clones of the same
application in many different markets
and we know that they are all going to
behave pretty much the same way but we
can configure them going forward as well
so for instance if the Italy guys want
to integrate with their dealer
management systems or their order
management systems then we can have a
special environment variable or special
add-on that plugs into their application
that doesn't plug into the other markets
so this is really a powerful option for
us I've kind of run out of steam so I've
done a little bit early so I would be
happy if we could take a few questions
any questions hmm how can I ask how is
the workflow been are people like for
people at Toyota a birthday had they
used because I know for example for me
most of my work that I've ever done with
Heroku is has been really like hobbyist
and so for me it's like I've wanted
something just want to spin it up don't
worry about it just go to Heroku but
like for you guys had you had engineers
who had experienced the platform already
and did that help with transition we had
no experience with the platform at all
it was I mean and that's that's real
good thing about it because I did
discussion actually with the CIO last
week about it and he was saying oh yeah
but in the end you need to log on to
these machines you need to get into this
platform as-a-service you know you can't
just buy these platforms you've got to
go and really discover everything about
them which is great for you but you know
what actually turns out not to be true
you can't actually log on to any of the
machines in Heroku
you can't literally touch them there
it's impossible to touch those things so
we can't fiddle with them and we can't
know exactly what's going on in there
all we know is that we can run up exact
copies of them and diagnose things we
can we can get hands on to them but we
haven't had we haven't got any we
haven't had any experience beforehand of
the the deep platform and we haven't
really needed it because actually the
surface area for Akoo is quite small
from an engineering perspective and
actually the workflows been quite simple
the developers are developing in a
completely where we Heroku has a concept
of organization so you can have an
organisation which is the development
organization for the websites another
organization which is for production so
that goes beyond the kind of hobbyist
they have an enterprise package where
you can set up an organization called
production organization called
development all the developers can have
their roles and their activities and
they can spin up their diners in
complete safety in the development
environment when they're ready to go we
have one little program which will say
okay take in your your your Diner your
exact like the docker file a docker
image take your image out of that
development environment and plonk it
exactly into production so that's the
workflow we have in terms of promotion
but the development workflow is
basically just a standard kind of do
everything on your local machine using
JetBrains or web ID you know whatever
you want to do sublime text and then
push it out to Heroku and get make sure
it all works put it into some test
environments so the users can check it
out and then report promote a product
you haven't run into any and not having
full control over the machine as you
would otherwise you have have you run
into issues like
where you you know is hard to install
something or when something went south
it was hard to detect or or mitigate in
a way that you that you wouldn't have if
you actually had physical control as
much as you at least can have in the
cloud of that machine not through Heroku
uh this is often the question you get is
that all you don't you don't control
this stuff right you know but actually
you don't want to control it you really
don't want to control this stuff as long
as you can get high eyes on it you know
so there's dashboards they've got lots
of things like their browser New Relic
log entries you can you can inspect what
your code is doing and like I say you
can start up an exact copy of your of
your Diner and you can look into that
you can look into the copy and if that's
not doing the same thing as production
then things are definitely going south
but we haven't had any problems like
that we've had a few problems for there
api's where we've had to talk to the
Heroku guys and you know have a support
call to say we've made a deployment but
it doesn't seem to have worked for all
of these cases can you help us out
that's probably the only case that's
ever really happened and I think it's
happened twice in in three or four
months yes sir
sorry I have a question oh what's your
question Tim we're talking to ourselves
so yeah you know you can you can also
put your hands up uh-huh um what are
some of the tools that you're thinking
of building in the future like what what
are you excited about as far as building
to automate all your Heroku processes
mmm your desktop well there's a few
things I mean we want to build we want
to build basically the tools that we
want to build our around release
management now I'm not sure I talked to
some of the Heroku guys as well they've
got plans for building release
management tools we have some ideas
about what we'd like to see in those
tools and we'll probably build them
ourselves but it's basically about
saying okay well I'd like to know which
version of the app is in is in
production at the moment across the
entire organization at the moment we
have to go into each app and have a look
at that in detail and that's a bit
annoying so I'd like to have a dashboard
that could show the entire production
environment
I'd like to also see for instance why is
this one application different from
those applications if it was if it was
intentional that's great
we did it deliberately but if it's not
intentional then I want to know about it
we have one I think we've time for one
more question before we go into break
well I've got not quite technical
question but I'd like to ask how you
plan the budgeting for your cloud
infrastructure if you go to CEO you have
to provide some figures so is there a
tool or something that helps you so I
don't can you repeat the question well
if you have to plan the budget for your
cloud infrastructure Hiroko
how would you approach that okay your
wait you have to do that actually of
course so what we did was we said okay
we did some benchmarks not not with this
in benchmarks to price out the
infrastructure basically we took the
existing website and we said okay what's
the number of hits we get every month
let's run up a basic version of Nod run
it on on on a local machine see how many
how many hits we can sustain on Nord we
run that on Amazon we ran that on on
Heroku as well I mean sir care we really
they're a bunch of add-on tools for load
testing as well through heroic ooh and
you can get on the cloud of course so we
run some benchmarks mr. clear right well
this instance of node can can handle for
this country let's say Germany we've got
to know Jess instances it can handle
this much traffic without sweating so
everything's good and then we can
circulate while the Germany's our
biggest one of the biggest markets so
everything else will at least match that
so we can go with to diners everywhere
at the node.js layer maybe use to
diagnose at the nginx layer and then we
can see if we've got 30 countries will
just cost out there then you're going to
appear for add-ons like MongoDB like
elastic sir
urghhh and they're all well priced up
front so you can do those budgets so in
fact it turns out to be relatively
straightforward with Heroku to do that
it's more complicated I think with
Amazon because all the component pieces
are quite difficult to all wrap your
head around and you find oh actually I
need this I need that I need this so I
would say that from a it's course it's
possible to do with Amazon and then we
already use Amazon for a number of
things but we it's more difficult to
predict I think with Amazon than with
Heroku because it's not so simple to
package those things up yeah good
question
okay we've hit break time so thanks to
thanks to Ray for looks very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>