<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Dan Silvestru: Distributed Complex Computing Using Node.js [JSConf2014] | Coder Coacher - Coaching Coders</title><meta content="Dan Silvestru: Distributed Complex Computing Using Node.js [JSConf2014] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Dan Silvestru: Distributed Complex Computing Using Node.js [JSConf2014]</b></h2><h5 class="post__date">2014-07-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/V3mPEnBa8D0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm Dan Sylvester and there is Lord and
he'll join the talk shortly so we're
here to talk about it was the original
title was distributed parallel computing
of a multi machines and multicores in
javascript using node but i couldn't fit
it on the slide 8 so any or so i'm
assuming that you guys are here because
you know computering is the card and
we're getting to this point where we've
lost the ability to you know just saying
oh well my cpu is just getting faster
and faster and faster so it's becoming
more of a parallel processing world out
there and so before we jumped it out who
we are and this isn't really a plug but
Gordon are both from a bit hound we're
sponsoring here comes out with us
afterwards you can follow us on twitter
confuse minh and gore tanner and you
might know us better from our cosmonaut
survival kits that we've told out and i
keep hearing the little lasers go off so
thanks so what do we do and this isn't
again a plug for a company but this is
why we're here talking about distributed
computing we are here to help you write
better code but to do that we have to
analyze all of your repositories and all
of the code in them and that is a lot of
work that needs to be done right so kind
of a typical problem you want to run
lint you have something that's never run
length before and this is an actual case
I just I won't name the project 73-68
right that's how many lint or through
and it took 29 seconds to run this now
if we want to run this over another
thousand commits and we have multiple
multiple critics or analyzers that we
run this becomes
quite onerous and you know some of this
processing if you were to do it
sequentially will take two three four
hours and you know waiting sucks and we
hate it we're on patient people but we
have a bit of a challenge in javascript
in that you know we're single threaded
so how do you go about processing many
many many things and still you know
making things performing well so there's
the cluster if you i know'd anyone we
use cluster at all okay that's pretty
cool there's a little bit of overhead
but it's kind of nifty kids essentially
it's you know the profs calda exactly
and it just allows you to spawn
processes and can take advantage of all
the cores on that one machine and that's
nice but that means you just have to buy
bigger and bigger and bigger servers
that have more and more cores and they
cost a lot of money and you know for
startups that gets expensive so to the
cloud all right let's let's go out there
and and use a whole bunch of different
machines and max all of those out and
see if we can get performance to
increase and go better and so that's
kind of what we do and this is where is
your cue comes in as anyone used is your
omq oh awesome cool if you have that
installed on your laptop's by the way
you could actually joined a demo later
so I you know I read the description the
first time I saw cmq it's like looks
like an embeddable networking library
about acts like a concurrency framework
wow that's a whole lot of buzz words and
I don't know what any of this means so
we started kind of looking into a deeper
so this is totally legit this is off of
their manual so you basically take TCP
sockets you add some spandex cosmic rays
illegal radioscope or yeah radioisotopes
from secret soviet atomic city and then
that all of that stuff together and you
end up with zero and few sockets and
really awesome things so essentially the
sucks you know the carrier atomic
messages across multiple transports like
that's kind of a key here for us as well
so you can do it in process
inter-process tcp
multicast and you can connect sockets
well as many of them as you'd like and
there's multiple patterns that you can
den take advantage of it there's the fan
out fan in and I'll talk about that
that's part of gorgeous demo we can do
pub sub task distribution and then
obviously the standard a kind of request
response and of course we apply and this
is kind of the you know simple I've got
some tasks to be done I'm going to send
it out there whoever is out in the cloud
that's available to do the work we'll
just pick it up do what they need to do
and come back the pub sub I'm sure all
of you are familiar with it within bit
hound we use that mainly for all of our
stats so we've got all of these
distributed nodes you know doing work or
being idle or whatever and we want to
understand you know what our performance
is at the various oh so they all just
publish their stats and we've kind of
segregated that sits there and listens
and you know provide us with our with
our stats tooling but this is really
where all of our work comes in and this
is the fan out and then fan back in so
what we do is we have batches of work
that need to be done that's so you have
a thousand commits that doesn't critics
then we need to run we fan those out and
you can do that in batches or you can go
to all the once it's up to you we do
ours and batches really to kind of
maintain a shallower queue depth so we
can better utilize multiple requests for
repositories each one of our slaves goes
off and does some work and when it's
done it kind of response back and we
aggregate all of those results and we
end up with with what's on our website
so that's going to be a quick run
through what zeromq is and how we use it
and how you can go about doing
distributed computing but that was just
a theory essentially so we can prep for
Gords part of the talk so I've gone six
minutes so you have an extra four
give you nice of course I've prepped for
an extra four minutes um so when dan
told me we were doing this talk and said
you're doing the code portion of
distributed computing in JavaScript I
thought this is going to be fun so he's
like you just need to come up with a
really awesome demo and my mind was
racing I was like oh I could do like I
don't know like what about Fibonacci
that's not controversial in the know
community but that would be boring so I
racked my mind for a long time running
different things in it actually the idea
for my demo kind of came from a ride
with my daughter taking her back from
school she was sitting in the back and
kind of little conversation is a good
time to catch up with your kids and she
just randomly asked me daddy how many
letters are in 10 and being a incredibly
common question I said 3y and so she
sits back there and she goes well well
if Penn has three letters and three has
five letters and then we worked it out
okay well five has four letters and four
has four letters that works and I was
thinking this is odd so
we we worked we worked out a few more
numbers and she's like almost another
number i'm like i don't know like 13
he's like oh that's a lot of letters and
we worked through it and back and forth
and they everything kept reducing down
to four and this was such a amazing
experience like I I had to take a
picture of it because it was this
serendipitous exchange between me and my
daughter where I'm saying they're
thinking I have to have a compelling
awesome example for distributed
processing and here's my daughter
sitting in the back doing word games and
number games with me so that that is
actually my face my mind was blown that
that this happened so the key is
everything can be reduced to four I'm
not I'm not one to preach a religion
ought to you but just so you know there
is a real livered religion saw on urban
dictionary so it's legit called for ism
it's a religion based solely on the
worship of the ever cool for often
involving telling tales and giving of
muffins but we're a start-up so you can
buy your own muffins so I decided you
know what I'm going to create an NPM
module called for ism I I created it
kind of last week somehow 34 people
download it today with without me even
telling you about it so kudos I have no
idea how people are downloading that but
so this is the official launch of for
ism for this talk only and don't ever
use it so for those of you who know
about 0 and Q if you do have the zeromq
libs installed you can easily npm
install for ism and you can participate
in this demo it's also codes on G Tanner
for ism not that you really want to look
at that but give you a quick idea of
this summer's going to be this bigger
because
my eyes are old so I need to create a
couple a couple small modules so first I
need to create a module to like take a
number and were to fly it which is a new
word for me so we'll start here and
let's take ten and that returns me lo
and behold 10 and because the word the
number four is the greatest for you will
notice that it also returns for but it
works up to like really crazy big
numbers 10 trillion 43 billion 252
million 350 2356 so that was a fun
module I didn't really write that so I
can't take much credit I grabbed it off
a blog post somewhere that's the wrong
module oh that could have been bad I'm
yeah so Andrew Hoyer if you're here
thank you I didn't have to write that
but it's a really really fugly looking
code that that does that for me so we
won't look at that ever again so also we
needed to do the little game my daughter
played and little that I realized that
she was a prophet in this new religion
that we're going to talk about
enlightening us all so we can take our
example 10 I'll pass the word 10 to four
ism and will log that and it returns for
now I know some of your kind of like
what so I'm just like you're just kind
of like huh so if I this kind of passing
huh it'll expand out and we'll see a
little exchange ahead where 10 has three
letters three has 55 has four and four
has four and of course I wanted to play
around as like all cool like let's do
that awesome like 13 example it's also
for weird now I was playing around with
this and I notice that there's there's
some ones that take a little longer like
one two three which could be also for so
if i run node talk so this this example
is really interesting where 23 has 11
letters 11 at 66 has 33 has 55 has 4 and
4 has for those seven steps and seven is
really close to four it all relates
because if i took if i took seven that
took three steps and if i took three we
all know that three I should save the
file three took three steps whatever I
thought it'd be funny I did actually
prepare that so that's cool it's not
really a distributed but it takes a
little time and I'm like okay I want to
I want to like four fly all the numbers
so starting off I made this little
program it's really not not a whole lot
so I were to fly I'm 80 utils just to
like log log the results so I'll keep
track of my counts for one to a million
I'm going to for ism were defy the X
keep track of the turns and this node
sample and there was light thank you for
so that took about four seconds
so obviously this is going to take a
long time oh my gosh I am probably going
to hell for this talk it took a little
time and I was like just going to take a
while and this is a distributed
computing talk so let's kind of go let's
do this first thing and we all played
with cluster before so I took the same
code you'll basically kind of see right
here but word of Phi for ism counted
pretty much the same code except I'm
just grabbing the start and end from the
process environments and then when I'm
done I send it back on process so if if
your clusters you have a blaster and he
delegates to his slaves so I have a
little send function where I just kind
of fork off a new process sitting start
and end and when I get the message back
I'll call my callback and just to make
this easy to do the synchronization i'm
using the async library which we all
love a bit hound it's an awesome library
for doing callback management so I just
let's do five million on my I opted for
the cheap cpu on my act book air so just
wait for it wait obviously when someone
hits our website running this this
religion 20 seconds a long time to wait
for our response you see there's really
not a whole lot I can do to optimize
this like I could buy a bigger computer
but I'm poor but then we're kind of
limited to like how many cores we have
and we could do distributed kind of like
we have like a proxy in front of our
like node server and it will like go to
each one but i will have state i kind of
want to go i want to do when you request
like the supreme knowledge of the number
for you want to know all the numbers at
the same time so that's that's where the
true beauty of for ism lies so basically
there's a lot of code here just want to
make it pretty but at the root of it
you'll still see
I still have this little thing here so
counts loop over here return account
size call back and then back on the
slides where are we here so all I'm
really doing is using the push-pull
socket so zeromq sockets have basically
we're called types and the types are not
really what you would think of normal
socket type a lot of socket libraries
would be like oh you want your in
process socket or you're like TCP socket
your web socket one of the key
components of zeromq is you kind of a
sign like message balancing type so you
have a push socket which is you can push
out messages and a pole socket which
will pull messages from a poor socket so
this this kind of diagram here is really
all I'm doing in this example where I
have a task ventilator well I'll push
out these like little batches of a
million processors and i'll have my
workers well just call pull and then
push back to the ventilator so that's
what you're seeing here where I pushed
result back pull it on and then really
all I'm doing is calling batches push so
pretty much the same code i did in
cluster and there was life so I'm going
to start this guy up so so I made like
any good library there's a command-line
interface so we have basically our
master and we have our slave so our
Master will start up he'll sit there
waiting for people to connect and we can
start up slave so go for ism master so
you're just going to sit there prompt
for millions all the star up locally
slave okay so I've like because I have
four cores on this machine therefore so
i have now i have eight because i have
some of my other guys from enhanced
joining so we can next if any of you
actually happen to install for ism my IP
is where we have here
192 168 1 59 128 so we should have more
people join in oh there oh wow there we
go that's distributed computing right
now so that was super cool so now where
is zul the gatekeeper ok i dazzle the
gatekeeper so just I've never had 32
cores on this this is good like so what
the heck let's do 20 million so let's do
this so cross your fingers so this is
going off you'll see you like like your
processors are going to get little
batches of jobs like so the force is
with them they'll kind of go off we're
kind of turn along here I built massive
stats otherwise no one is just waiting
oh there we go so so that that's pretty
cool that took 16 seconds and i just did
20 million of those so oh I well I'm
astonished at that I'm just going to
let's do like so another cool thing with
0 mq so you notice that my master
service i just killed this i'm not
starting a server it's just a it's just
basically a node command line and so I
killed that entire process and all these
slaves out here in the audience were
like uh where'd he go but I I stopped it
now i just started up again and they've
all reckon ected and you'll notice that
in my code I didn't really do that all I
did was use call connect so we just
connected like on port 1337 replying on
1338 and that's all we did it's just a
TCP socket hidden but all that crazy
stuff if you've ever done like any
socket work where you're like oh god the
server like disconnected and I guess I
got to reconnect and then get some state
back all that's been handled for us
through zeromq because these sockets are
amazing so i'm gonna i'm going to start
out on the scope I don't want go 100
million 1,000 million w well i'm just
going to at that run
1000 million is a desert word for that
billion so really s about it because
Danna was a four minutes earlier I have
four minutes left so really as this
Trump's way like the cool thing about
this if you uh if you are doing any kind
of distributed work think of as you're
designing your applications rather than
thinking of request response start
trying to think about if there's ways
you can just kind of send a message
we're infinitely familiar with how to
send messages and JavaScript kind of go
send this off here's a call back when
you're done but think about send this
off send this group of stuff off and
here's a call back when I'm done and
think of the power if you can have an
unlimited number of people out there
waiting to basically do your bidding wow
that's a minute to do a billion that's
cool that was awesome dude actually to
add to that room Q is also not linux
specific right so if you got a whole
bunch of work that you need to get done
and some of it is to happen on the
windows box or you know on a Mac machine
because Allah say when we're going to
analyzing objective-c and whatnot you
could totally do that it's just a
message and those slaves that run on
those systems will pick it up just like
anything else if they know what to do
with it let's go process it and respond
back so you can kind of still keep your
management and you're going to overall
restoration and node I just love
JavaScript so that that's about it thank
you also we are launching our developer
preview this is our pitch parts so if
you are interested in helping us build
one of the tools that are going to sit
there and help you guys build the best
software possible help us help you
register for our developer preview a bit
how no sighs preview and may the force
be with you thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>