<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ryan Seddon: Performant UIs Using CSS Magic - CSSConf.Asia 2014 | Coder Coacher - Coaching Coders</title><meta content="Ryan Seddon: Performant UIs Using CSS Magic - CSSConf.Asia 2014 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ryan Seddon: Performant UIs Using CSS Magic - CSSConf.Asia 2014</b></h2><h5 class="post__date">2015-01-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ScXXBvs32Pg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm gonna be talking about
performance user interfaces using CSS
magic so kind of trying to take that
magic of CSS and trying to explain what
is actually going on and how you can
make and use the dev tools to measure
performance and define where performance
bottlenecks are etc and find issues
using the different tools we have
available so yeah I'm Ryan Sedin from
Melbourne Australia I did a fun little
animation they're going to call play
with it works on touch as well and just
to show that like performance is more
than just about HTTP it's about the user
experience and also about how fast you
can paint to the screen so there's sort
of two sides to it I'm mostly going to
like the the technical side of it but
i'll cover slightly some of the
animation side so animation can improve
performance whether you're a technical
person and you like you like you look at
the animation you think I this is really
well executed or you're just a general
user and you sort of get some delight
out of it well executed animation it
really instills the perception of like a
really well performing application well
that's on the web and mobile and it's
not the bad old days of 22nd transitions
and flash this is about like to enhance
the animations and the user experience a
really great example that I've seen is
the stripe check out page I'm going to
Adam Atticus there you can see that
comes in really nicely and it looks so
really cool and how everything sort of
interacts and like sort of like it's got
a pseudo physics pace set up um necron
it looks really perform it and looks
like that it's like a really nice user
experience to use so how could you do
this yourself a not sure how strive did
a technically themselves but there is a
couple tools that I've seen one called
bass chairs and that allows you to do is
sort of like pseudo based physics
animation so you can do like Springs
staff interferes with each other and you
get that sort of nice spring emotion
natural sort of movement in your
application and the web is capable of
native performance I ain't using that
word Nettie's performance but they've
sort of set the bar of what users expect
but it's a lot harder on the web because
it's really easy to degrade performance
and not no way so that's kind of
animation side so I'm going to go into
sort of like a case study this is like a
little project I built and we had a
performance issue with it and I couldn't
figure out what so sort of like my
journey and how I discovered what was
going on and sort of what the browser
does so I read this library called
scroll this view so just be too
background on it it's kind of like a put
the idea was a performance scrolling
library it's not like I scroller doesn't
do like the bathroom stuff but what it
does is it basically works like in iOS
development they've got the UI tableview
essentially it'll display as many cells
that needs to to fit the viewport and
then only a few more either side and as
you scroll it sort of reorders the cells
and I'll show you an animation of that
second mi own uses the flexbox order
property so rather than using like
transformed to or position up to loop to
reposition an element or even ripping
out of the dolmen replacing it down the
bottom we can rely on the algorithm that
flexbox has and this has had more
benefits where I can have variable
height cells so a lot of those a lot of
the scrolling values you'll see that I
always have a fixed fight and with the
flexi-box order property you can you can
do some really cool stuff this is a
animated gif you can see I this is a
chrome tracing so this is like a really
low level tool but more importantly I
just wanted to show like how the
scrolling work so you can see up here as
I scroll the cells move down bottom here
it's kind of replacing and that's the
flexbox order property being changed on
those elements and so look this
experience painting that's kind of like
a 3d view so that's the scroll container
and that's like the browser window you
see it gives you like a frame-by-frame
look at what's going on in the browser
but it was a nice way to demonstrate
what it's actually doing I wrote an
article about this so you can check out
my blog the CSS dinger if you want to
have a look and there was a problem so
let me actually show you a live demo of
it here so you can see the the scrolling
here I've got like a list item in here
so this initially has 20 items but to
just feel the viewport its renders 8
list items and you can see I put the
order property on there so as I scroll
and see that adjusts and now that's down
to bottom so it's going to disagree
ordering as you go and just adds up
adding to the top so you keep that
scroll position so you can scroll
through a lot of stuffs and it works
pretty well so it doesn't sales and
performance problem with it so as I
showed you there it works pretty well it
works fine and good example working at
mobile and it works well so as you like
normal as a user that goes through their
Facebook feed or Twitter feed a sort of
scroll at a steady pace but when you
start to do high-velocity solar
scrolling so you get to the bottom of
the list and then you want to scroll
really quickly the top and you build
momentum of the scroll the screen starts
like whiting up I see who they like it
just goes blank and doesn't render
anything and I didn't know why so I'll
go back and I'll show you demo so if i
drag the scroll bar you can see it's
kind of just wiped out there and not
sure why if i scroll a little bit
suddenly repainting it and it's kind of
confusing why that's happened there's
like steady pace it's fine but then when
you start like really getting some
movement happening it sort of like
renders what's that and something is
going on and that's animated gifs of
showing it so it's null scrolling and
then just drag it you can see you like
it just gets white with family so why is
that so to understand why we need to
sort of take a step back and understand
the performance the cost of changing its
CSS property there's a few things that
happen and ending on what's this is
probably you change different things
happen really good website you should
check out is CSS triggers calm so this
is basically like a nice little search
tool you can search recessive property
and a layout and tell you like this it
caused a paint that's caused a reflow
or does it just cause a composite and
looking up the order property
essentially order when you have you
change it update it it causes a reflow
and a paint which is expensive in the
browser and it if it needs to do a lot
then then some things can happen
essentially the only really safe
properties you can do we are updating a
lot transform so like scale rotate
translate and a past Atia there are only
really safe ones to do because what the
browser does that composite it to the
GPU and the GPU then handles that and
there's no sort of reflow your paints
happening and if you're translating
elements using those two properties
otherwise everything else is kind of
detrimental and will will degrade
performance and that is a screen grab
from the CSS triggers so you can see
like order on when it initializes and
went to updates the causes the layout
paint and composite and you kind of want
to stick to just properties of do
composites for a performance-based us
another side of it is knowing your
paints versus reflow so it's kind of
rudimentary knowledge of the browser
it's two different diets so a pain is
like a non geometric change so that's
when you change out the background color
or the background image something it
doesn't affect like the dimensions of
the page a reflow the other side so when
you affect the dimension so you change
the font size you change a margin got a
border etc anything that where the
browser needs to recalculate little
stuff is missing an example so encourage
so toggling like visibility that's just
the paint because it's not it's a non
geometric change whereas totaling the
font size will cause a paint in a reflow
so it is the reflow to calculate where
everything's position now because the
font size increased and then it needs to
paint it to the screen and then you can
also have properties where you access
where it forces the browser to do a
reflow to the browser probably
intelligent tries to queue up a lot of
this stuff for you but there's certain
bits are out has two black flush the
queue and it has to like cause a reflow
so one of those is like offset left so
you have to get the correct dimension
back otherwise the browser could be
lying to you so they need to cause a
tree slow so you kind of need casts all
those property
you can see here this is a screenshot
from the chrome timeline dev tools and
it kind of shows you what happened so
like you do it you do a change that the
function call happens it'll change to
recalculate the styles and then any of
the properties like wit pipe margin left
and top can cause a layout any of the
other properties in the green bar screen
bar here can cause I box-shadow border
radius those things that don't do a
geometric change and you can see you
lastly the composite layer which is like
transform and opacity it's like handled
by the GPU so that's really fast so one
of the key things you should do is
batting so you need to batch you read
and write so you'll want to read write
read write read by other words the
browser needs to reflow repaint real
slow the paint and you get that sort of
junk that a lot of people talk about and
that's it up so you want the only one
layout and paint it happen once per tick
so it's kind of like you will use
something like requestanimationframe so
that works that doesn't call back every
time the screen refreshes so the average
refresh rate my screen is like 60 Hertz
nuts without 60 frames a second come
from so I want to execute 60 times a
second so that way you can like queue up
a lot of stuff and have it happened fast
and it won't like make your app seems
slow because it's happening a lot but
you'll get like this is what they call
layout thrashing they're on a controller
in minimize so the best way to do that
is use a doll abstraction like because
it's really easy to degrade performance
you kind of need an abstraction on top
it's really thinking about that kind of
paved the way in that thinking with
their virtual Dom and kind of their
representation of the Dom that you write
and they sort of angle writing to it so
it's pretty good amber has HTML bars
which is like a lot of similar thinking
to react so they're kind of doing a lot
of performance stuff there and their
latest release and if you don't use a
application sort of framework there's a
library called fast on which hooks into
like requestanimationframe so all your
reads and writes is Dom you do through
this library and that will bat it up and
do it in a performant way for you and
you can't opt into a framework it's
pretty good one
so how do we measure you I performance
recently so for a long time will Dailey
really chrome that offered the ability
to do that but now like I Elevens firing
Firefox will have really great support
to extract in performance seeing what
Spain what's reflow and kind of giving
you like a frame rate and they all offer
a timeline I just checked out I Elevens
tools and they're like really really
good they're up there with chrome for
getting performance information addict
like your website they give it a really
nice interface for it so let's let's go
back to that issue of the scroll this
view was waitting out and we can sort of
discover what's going on so first thing
we'll do is a timeline in chrome and
this will like I showed no other
screenshot i'll show you like the
reflows paints and will give you like a
frame rate but when we do that and I'll
share a screenshot of a profile i took
it doesn't eliminate why the way that is
happening so as far as the timeline is
concerned it looks like it's really
performant it's not doing much the
browsers like handily okay but it
doesn't make it clear why suddenly
everything is disappearing off the page
so it doesn't it doesn't help and that's
the same for all the browsers they're
kind of say it's ticking on 60 frames a
second and everything according to the
timeline is fine but it's still you can
see it's not fine because it's not
displaying the data so that's a timeline
i did of the scrolling thing you can see
it's it's below the 60 frames a second
which is up here so you want to be below
this line so that's ticking along and
then you can see sort of the bars
happening there it's like doing some
paints and composites and they're really
small and it happening with the past and
better still problem so it doesn't
doesn't always help this is where Safari
sort of has some really hidden tools for
a long time this feature called show
compositing borders was hidden behind a
flag you had launched safari in the
command line to get it happening but now
they've exposed it in a debug menu and
I'll show that in a second and show that
Nia
refresh that
one second
so
what
so to show this this you can see it's
got these borders and essentially these
are like the the textures that upload to
the GPU it finally gives you some
numbers here so you can expose that by
going to debug draw compositing flags
and then down here show so it's kind of
hidden behind these these menu options
but you can get to but what actually
illuminates is as I scroll you can see
that number is increasing a lot what
that means is that's uploading a texture
to the GPU but every time and it's
happening a lot because we are paying
order property so like I start to scroll
that really fast you get the wire
happening and you see like the number of
creases exponentially and that's that's
kind of like what what is happening in
the browser so Straits of textures are
being sent to the GPU and that number
should be small so if that's big then
you've got a you've got an issue where
like the GPU is getting overloaded
things here I took a screenshot here
essentially what we're doing is we're
flooding the GPU so kind of and good
analogy is like a big sports game and a
stadiums finished and all the crowd is
coming out to the door kind of a really
slows down so you're trying to upload
way too many textures to the jeep you
and I just can't handle it or just just
wiped out and it just like stopped
rendering in fact keep up because you're
doing too much for it to handle and just
you know you're technically overloading
the GPU bus with too many textures for
it to handle properly to be able to
painter the screen in the browser and
that's the Atari ever answer to the
white out so it's kind of get a bit of a
journey the tools a bit immature to get
to it and they're kind of hidden behind
probably some confusing names but once
you start to learn it they make a lot
more sense there's a good article about
this very subject of using that to debug
performance and Safari and basically the
conclusion we come to is the order
property isn't performant option when
you want to do high velocity scrolling
like it has a lot of other benefits but
when it comes to like writing out that's
kind of like a no-go so it's kind of
like you have to avoid it but offers so
much which is unfortunate
so it's not easy like the dev tools are
still immature whether they where they
do Excel is you know inspecting and
looking CSS JavaScript profiling but in
a lot of like the UI performance stuff
the stool likes and some blank areas
where they don't cover it work where you
kind of get stuck is only because Safari
expose that that I was able to discover
what was actually happening and
otherwise I'd just be I wouldn't know
what what was going on and
high-performance user interfaces are
really hard on the web especially
because it's so easy to degrade but you
can do simple things like just change
the CSS property and then suddenly like
everything comes crashing down but it's
not impossible so like I said before if
you want to do native like performance
really fast and you kind of need to use
an abstraction where they're really
thinking about this for you and you kind
of just define your application and a
really good one that I've seen lately is
called famous the kind of stews all
these ideas into soft instruction where
they really think about performance and
you should have described your
application in JavaScript and it sort of
handles the rendering to the Dom for you
and now you so they use a number of
strategies so they use a flat Dom so the
Dom structure is really like flat so
it's easy for the style recalculation to
happen so the more complex the Dom you
have the more work to grouse has to do
when it needs to recalculate installs it
means to traverse all the notes in your
document they use your first animation
frame to do it 60 times a second they
make sure everything's put on for the
GPU so they use the matrix Freddy
transform and also have it built in
physics engine so you can get that nice
stuff so that where I was dragging my
head around before that was using the
famous same thing you like the sort of
spring physics happening it's really
quite good the other benefit is too is
because you described in a in their
framework you can render it to other
endpoint so you can range the Dom you
can do SVG and they even have WebGL so
that sort of Brewster performance again
and you can start to do more cool
animations with in reggio that's all
possible in the doll so you can do like
cloth based off
so before it is fragile it's very easy
of us said many times to degrade
performance now you really need to put
an abstraction in front hand rolling
always end in tears so if you're working
by itself maybe that will work for you
but if you're in a team really trying to
like not degrade performance is really
hard when you're working with many
people and basically the dollars of West
it's a worse for performance is not was
never intended to do like the sort of
application level stuff that we're doing
now but that's what we've got to work
with though we have to work with it and
what we really need is the web platforms
kind of needs is low level control so
people who really want to extract the
most performance out of their web apps
they really kind of need to trust from
the browser that then they know what
they're doing so there's a few things
where you could control you could
isolate something on the page to know to
say I know when it needs to paint and
when it needs to reflow but that's sort
of not available there's there's some
specifications like there's a CSS
containment specification which you can
isolate some stuff to do that but that's
all early days and just just a it's not
even in any browsers so yeah isolate
opponents pretty much we need the
functionality of an iframe but without
the baggage so I frame has obviously has
a lot of baggage around it we kind of
need the benefits of that but in a nicer
way so we can do we can start getting so
extracting really good performance
that's it thanks you're living with
ember it's in this man ah yeah yep do
you have issues with repo'ing we've got
a bunch of them having issues with
things don't have the right time or seem
a bit slow are you doing Oh
optimizations or is it just changes to
imitate it going through going to sleep
set up so I don't work with that day
today but I think HTML bars kind of like
fixes a lot of the problems that the the
other templating engine they used
previously and they're kind of taking
some cues from react
hi great talk with all the amazing
performance that you've shown do you
think there's reason to be optimistic
enough to think that web applications
will at some point become better than
meet us in terms of performance yeah I'm
pretty optimistic about it I think I
think the it's capable they're like
there's a lot of work being done in
discovering performance issues as well
as like helping increase performance so
a lot of like the frameworks are kind of
like fixing that for us by retracting us
away from that like fine-tuning their
they're working on the fine-tuning as to
whether we ever get like native maybe
we'll be close you know mozillas doing a
lot of work with their as I'm jeaious
for high-performing games in the browser
and Java scripts getting faster and
faster all the time and the nailing so
though I'm pretty hopeful that the web
will be like the the one true place I
hope hi I'm that was an awesome talk can
you you mentioned a little bit about how
the Safari dev tools that you that you
see repaints but then there's stuff in
the chrome devtools jump like a
suggestion of your preferred workflow of
like we're developing in chrome and
safari or so yeah I tend to mix between
firefox and chrome like Rome because
Derek on the first ones to surface that
sort of timeline user interface
performance stuff and I've only just
been recently looking into Safari
because they've got some extra stuff
that other browsers don't that's really
focused on like seeing what's happening
with the GPU like when you're doing like
transform stuff there yeah so I mostly
work in chrome with my looks like i
don't really i kind of just jump around
browsers depending on what i need to
discover it have been kind of nice to
have like a unified to the devtools
approach but that's very long way away</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>