<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>David Khourshid: Reactive Animations with CSS Variables - JSConf Iceland 2016 | Coder Coacher - Coaching Coders</title><meta content="David Khourshid: Reactive Animations with CSS Variables - JSConf Iceland 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>David Khourshid: Reactive Animations with CSS Variables - JSConf Iceland 2016</b></h2><h5 class="post__date">2016-09-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lTCukb6Zn3g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everyone my name is David course she'd
and believe it or not animation is an
extremely important part of the user
experience in fact there's a lot of you
here right now this is probably the most
amount of people I've talked to but many
of you are here right now because you
realize that animation is a growing
trend in both the web and mobile app
development and this is for good reason
- animation increases delight reduces
cognitive load and it could be an
important factor in your brand when it
comes to your style guide so a lot of
developers realize this but so do a lot
of users if you open an app in your
iPhone or Android device you will expect
animations to happen whenever you
interact with the app so um my name is
David as I said and I live in Florida
which is right about there
and this is actually pretty exciting
because I met Jay has come to you
partially talking about CSS which all of
you are familiar with this is pretty
much where I sat on the airplane I got
like an hour of sleep so so like most
front-end developers which I'm guessing
all of you are either doing a JavaScript
on the front-end or back-end there's two
very important technologies that we have
to work with and that's JavaScript and
CSS and as front-end developers we know
that the landscape is constantly
changing as well
so we'd love to experiment or at least
most of us love to experiment and a
couple years ago I asked myself the
question what if what if I were to maybe
not use JavaScript and see what CSS
could do so this is how I approached
user interfaces I would look at examples
on dribble some cool animations and then
I would try to recreate it as best as I
could
using only CSS and so I looked for more
and more complex examples including ones
with stateful transitions such as this
one and with lots of checkbox hacks
hacks and like target whatever I was
able to you know recreate it pretty well
and by the way don't do this these were
all really fun experiments but
javascript is good for a lot of things
and you should probably use JavaScript
if you want to do interactive animations
like this I got a bit crazy so you know
some animations online and I decide to
recreate them completely in CSS so this
is one of the animations I made and one
important thing here is that we have the
dev tools on the right if I created this
with just JavaScript we would not get
this we would not be able to play around
and interact with all of the elements
you know in CSS so why do we get this
with CSS animations and not yet with
JavaScript animations well it turns out
that even though CSS could do a lot of
things it involves a lot of hacks so I
realize that CSS is not the most
powerful language and that's why a lot
of people start flocking to using CSS in
JavaScript using javascript to apply
Styles because hey javascript is a much
more powerful language but here's the
thing the fact that CSS is not powerful
is actually a good thing there's this
principle called the principle of least
power and it states that you should use
the least powerful language for
expressing information constraints or
programs on the world wide web and the
principle basically states that powerful
languages such as JavaScript inhibit
information reuse and what I mean by
that is that even though JavaScript
could do a lot of things the
the fact of the matter is that CSS
provides like a limited dynamic library
that that you could use to express style
succinctly and JavaScript even though it
could do everything you're gonna you
know have a mess in your code if you try
to define styles in there or try to find
many things at once so it sort of
inhibits reuse if you do that so today
we're going to be talking about two
things CSS variables and rxjs
observables how many of you are familiar
with CSS variables all right how about
observables all right few less people if
you don't know anything about any of
these two that's okay we're going to go
over them
from scratch and sort of just do a quick
deep dive into both of them and then
we're going to understand how they could
actually work together now I know the
title of my talk is called reactive
animations with CSS variables but I'm
not going to be talking about react in
this talk unfortunately however the good
news is that the techniques that you
learn here you could apply to any
framework react angular ember or any of
those other dead ones I'm kidding now
react is good angular is great and CSS
and JavaScript sort of seem at two
different ends of the spectrum we have
custom properties being very much a CSS
thing and observables being very much a
JavaScript thing so today you're gonna
get sort of a taste of both and we're
going to for whatever reason try to mix
them together so through all this you
might be asking yourself why why do we
want to do this why do we want to mix
you know CSS and JavaScript together in
this way and the reason is because
frankly you can make a lot of really
cool animations using that we have right
now a system
doing things in JavaScript where it's
imperative and by imperative it means
we're telling JavaScript exactly what's
to do how to apply each style to the
element and because of that we can't
either a quickly and we can't quickly
create user interfaces that are rich in
interaction and animation such as the
ones you see here and I'm a little
jealous of mobile developers because
Android and iOS developers they
basically get the tools to do this for
free and us and the web were sort of
left in the dark so let's first dive
into how animations are currently done
we have CSS animations which look like
this most of you are familiar with this
there's two types transitions and
animations transitions are good from
when you're going from point A to B and
maybe going back from point B to point A
and animations are good when you want to
define explicit steps or keyframes in
your animations so that it does a
certain behavior that you want the
beauty about this is that CSS animations
are declarative they're reusable they're
also really legible I mean you could
read this and know exactly what's going
on also these are built into the browser
so you don't need any external library
to pull in in order to get these
animations supports also pretty good it
goes back to IE 9 I believe for
animations and hopefully no one uses ie
8 anyway CSS animations can also be
offloaded to the global processing unit
the GPU which means they are not going
to be choked up by the main thread
especially if you're using a framework
like react or angular we're using the
main thread for a lot of things so it's
best to you know keep things such as
styling an animation off that thread
also we could use selectors media
queries and other things like that to
define our animations so we could keep
that separate from from the Dom
so that when elements appear and
disappear we don't have to keep track of
those in CSS but also this has issues
one of the big issue is that CSS
animations are not dynamic
we can't change these on the fly we
can't for example set this translate Y
value to anything other than 50% or
anything other than the static value and
they're pretty difficult to compose so
if you want one animation to go after
the other that's not the easiest thing
trust me I've done it I've tried it's
it's a pain in the ass it keeps me up at
night so we also have JavaScript
animations and this is the web
animations API which is a pretty recent
spec and it's actually really awesome
because it is supported in mainstream
browsers today and it looks almost
exactly like the CSS animations example
and that's because it pretty much is it
uses the same underlying constructs in
order to make the animations so this is
the exact same animation we saw and this
is offloaded from the main thread to the
GPU so this is going to be really fast
really performant and the beauty is that
because it's in JavaScript
it's dynamic we could add this to any
element we could tell it to start till
to stop whenever we want but the web
animations API is not really supported
in Internet Explorer but that's okay
because nothing is there's also dynamic
JavaScript animations too and this is
sort of the problem that we're going to
be tackling today this is how we do them
today we use requestanimationframe which
basically asks the browser which
animation frame should I do this on so
that I'm not choking the main thread and
I'm making sure that my program my
animations run at 60 frames per second
and so we run this in the loop sometimes
or we run this on events
such as this one so over here we're
moving the mouse and whenever we move
the mouse we get a weekend events back
and from that event we could grab the
X&amp;amp;Y position from the mouse and we're
directly applying it to the style of the
box this is inline Styles this is bad
for many reasons first of all inline
styles are going to override any other
styles you have it's hard to configure
them you can't put it in the media query
well actually you could you could listen
for the browser resize event and change
the animation based on that you're also
updating the Dom a lot and upping the
Dom is expensive for those of you who've
heard Lynn's talk it's an expensive
procedure and that's why react and other
frameworks try to minimize updating the
Dom as much as possible by doing this
you're saying forget that I'm gonna
update it all the time and there's
nothing you could do about it also
because this Dom elements the box has to
exist at the time that you're adding the
animation this could also be problematic
if you're using frameworks such as
angular react where Dom elements appear
and disappear they're mounted and
they're unmounted pretty much all the
time so the problem with this is that
you have to keep track of it and you
have to make sure that when it's added
back you're adding this event listener
back on and also if you want to add more
animations based on the same event
listener you either have to hard code it
inside this function right here or you
have to add another event listener which
could lead to memory leaks because
that's a lot of event listeners to keep
track of all right so let's talk real
quick about CSS variables in case you
know you might not know this is how a
CSS variable is defined its prepended
with two dashes I don't know why it
stands out though and in order to use it
you
put it inside a selector such as root
and this is the most common way that
you're gonna see CSS variables being
defined because this is going to cascade
down and be applied to pretty much every
selector that asks for the color and for
this you would just put it inside a
selector and that color is going to be
applied to any element with you know
with that class name and of course this
follows cascading and it also follows
specificity too so you could do some
pretty cool things like putting this in
a media query or putting it as a
different color in a more specific
selector so you have a high amounts of
configurability with this now here's a
really cool part about CSS variables and
that's that you could define them in
JavaScript so we have three methods to
do this we have set property which is
going to set the custom property and
it's going to put it right on the HTML
root element you could also get the
property value like like so so you just
pass in the variable name and it's gonna
return that value to you as a string and
there's also removed property you know
if you ever need it it's waiting for my
slides to update alright here we go so
here's an example of this I didn't make
this West boss made it a really cool
example where I'm attaching what I just
showed you
updating the values with JavaScript and
I'm attaching those to event listeners
here so as you could see we could
dynamically change all of these
different variables and this is just
using CSS if you can't see I'm changing
that to blue and so our JavaScript is
very small by small I mean
you could barely read it because it's so
tiny up there but just trust me these
variables are being applied using just
CSS here's another example if my slides
decide to let me go to the next example
what they probably won't so that's okay
ah here we go
I love conference Wi-Fi all right we'll
skip that let's look at browser support
so browser support for CSS variables
believe it or not is actually very good
and this is very recent in fact my iOS
Safari right now is still at nine points
two and nine point three I guess just
came out so the only problem here though
is that neither Internet Explorer or
edge support you know custom properties
but not a big surprise not a big problem
either because we could use we could use
plugins such as there's a couple post
CSS plugins for variables that will
default to the original value and ignore
any other their custom variable
declarations in your CSS so this is
where progressive enhancement comes in
really really handy preprocessor
supports to is actually really good so
it doesn't matter what you're using to
to apply your CSS whether it's sass less
stylist post CSS or inline Styles does
not matter you could use CSS variables
in any of those all right let's talk
real quick now about rxjs
observables which about half of you
already know about and half of you maybe
don't so this is going to be a real
quick crash course arrays are finite
collection of values so for example this
array has six balls
in the stream is sort of like an array
except these values come in over time
and they come at different times and
streams can also have a beginning and an
end so if you're a musician think of an
array as a chord that you play or you
know to compare that to a stream think
of a stream as an arpeggio where you
play one note at a time instead of all
notes at the same time so a good way to
think about this is that an observable
stream is an array that's asynchronous
the items could come in at any time it's
immutable which means whenever you do
something like an operator to an
observable it's gonna give you a new
observable instead of that same
observable and it's subscribable so
whenever an item is pushed onto the
observable whatever is subscribing to it
will know about it when it happens
finally that's live loaded so over here
we're applying CSS variables the same
way I'm gonna backtrack a bit and we're
adding a transition to it so what's
going to happen is that by changing the
values you see that using CSS we could
smoothly transition each value all right
back to our scheduled programming Thanks
slides calm write browser support
Internet Explorer sucks inline Styles
suck all right moving on so creating an
observable there's a way that manually
create an observable but we're going to
breeze through that and we're going to
just figure out the most common ways of
creating an observable so rxjs has a way
to take normal arrays or normal I
durable such as set and by calling
thought from you could create an
observable from that you could also
create an observable from a promise
which is basically going to be a
REME of only one value which is the
return value of the promise or whenever
you call dot n on a promise that's the
value that you get back we could also
call observables from events which is
what we're going to be using in the
coming slides so we give it the Dom node
and we give it the event name such as
mousemove we could also call it from an
events pattern so what an event pattern
is is just a callback so there's a lot
of libraries
that's use callbacks for their event
patterns such as hammer Jes and this is
one that I use in a lot of my examples
when showing observables with CSS
variables because hammer J has abstracts
all of these concepts and it's really
easy to use so we could emulate rotating
pinching pressing panning tapping
swiping all the things that you're used
to on mobile devices on regular websites
so all you do is you passing the Dom
elements to hammer and then we're going
to have a event pattern which takes in
the handler and passes that on to
whatever hammer dot J s is doing so over
here all we're doing is listening for
pan now subscribing to an observable is
pretty easy - all you do is you call dot
subscribe on that observable and you
passes in the function where every
single value whenever you get a value
you do something with it
optionally you could pass in an error
handler and a completion handler so
pretty much the only thing you need to
remember from this unless you want to
dive into more details is that you could
pass a handler to subscribe that does
something every time an event is called
there's also a bunch of operators - and
the best thing to think about is that
Aris rxjs is low - for observables so we
have the same methods that we could use
on the race such as filter where we if
you imagine this as an array all
is taking the green balls there's also
map which works just as you would expect
there's debounce which doesn't really
happen two arrays because arrays are not
time-based and there's scan where it's
sort of like array reduce and we also
have things such as flat map where if
you think of an array of arrays and you
want that to squish into one array flat
map is basically the same thing okay so
here is an example of using an
observable to update the Dom all we're
doing here is we're listening for the
mass events and we're seeing you know
the values change over here so think
about this we're using an event to
create an observable to update the Dom
whenever the mouse moves so hopefully if
the slides change they will
are you thinking what I'm thinking I
mean hopefully you are we talked about
rxjs we talked about CSS variables and
we sort of had a hint of how we could
mix the two so what if we modeled
observable events as CSS variables what
I mean by this is a question that you
might have all asked before is what if
we could write JavaScript in CSS so this
is where functional reactive animations
come into play and we're gonna be doing
this with CSS variables and rxjs
observables and trust me there are
awesome this is not a new idea dates
back to 1997 in an academic paper called
functional reactive animations which is
one involving discrete changes due to
events such as user behaviors or even
other behaviors or behaviors that are
based on other behaviors as well an
important quote here is by allowing
programmers to express the what we can
hope to automate the hell react is
really good at doing this but we're not
the best at doing this with animations
right now because right now the way we
do this is we directly tell JavaScript
how to style each element so here's a
little preview of what we're going to be
doing so taking the last Mouse example
where whenever I move my mouse the
values are updated we can see that the
little Huskies head moves around and
follows the mouse now there's a lot of
moving parts here so you might think
there's a lot of JavaScript but in fact
that's all that's all we have everything
is being applied to the CSS which is a
crap-ton so we're not going to go
through that and as I'm waiting for the
slide to change actually no I'll do it
right here that's the wrong slide all
right so here's how we're going to do
that we're going to need to use
something called a subject now a subject
in rxjs is just something that's both an
observable and an observer so this
subject is going to observe
things such as whenever the mass moves
whenever we scroll tap swipe maybe
timers that we have it's going to send
them off as a side effect to CSS
variables using the techniques we
learned about how to apply CSS variables
with JavaScript and it's going to also
dispatch to all of our observers
whenever the values change of course
that's optional I made a really really
tiny library for this called our X CSS
and it's on NPM if you want to try it
and all it does is we take in
observables such as whenever we move the
mouse which of course is just from the
mousemove event and we stick that into
the RX CSS function so if you're
familiar with redux think of this as
combining reducers if you're not
familiar with redux you have no idea
what I'm talking about but basically you
could just stick that inside the arc CSS
function and then you could use these
values directly inside your CSS so
hopefully you could see how this is you
know very very useful where we could
define dynamic animations inside of our
CSS and of course it only comes down to
one point five six kilobytes if you're
already using rxjs which in some of your
applications you are so let's look at a
real quick example of how we could apply
this this is something that I found on
dribble which you know is Iceland so
it's fitting and it's a really cool
animation where whenever you scroll did
you see how the background image store
faded out and disappeared and it also
scaled in a little bit and also when
they click the horse when they drag it
it moves up and the text disappears so
think in your mind's how am I gonna do
this with just JavaScript probably
involves a lot of code a lot of event
listeners but turns out that we could do
it with using arc CSS or defining those
variables in JavaScript and sending them
to CSS variables so this is what it
looks like
and this is Harper where we are right
now and so as you can see a lot of
things are happening but not a lot of
JavaScript is happening over here all
I'm doing is sending to observables you
could see that we're doing the photo pan
which is whenever we move our finger on
the photo and we're also adding a scroll
event so that the background image
changes whenever we scroll and it's
gonna be dynamic and it's going to also
be performant I tested this ran in a
smooth 60 frames per second so yeah it
seems it's so why use CSS variables well
there's a there's a few reasons first of
all you don't get excessive Dom
manipulation you might be familiar with
if you're applying transitions to all of
your to all of your elements on your Dom
that there's gonna be a bunch of purple
over here thankfully with CSS variables
the only thing that's really being
manipulated is that top root element
over there that's what's changing and
there's also a bunch of really good
reasons such as you could debug it
you could change CSS variables right in
the debugger it doesn't care whether the
notes there or not and you could think
of a bunch of other cool uses - such as
theming based on selectors progressive
enhancement using calc and CSS variables
work in SVG as well so your options are
you know really limitless so what's next
with CSS variables we could now do many
things that that mobile app developers
already can do such as constraint
layouts which is laying things out based
on where other things are or saying hey
we need this at least 20 pixels from the
right and other things such as physics
modeling choreography making animations
happen together in sequence and
observables also play nice with canvas
and WebGL so what this means is that
when you do animations in CSS
you could have those same values
dispatched to both canvas WebGL anything
else that could subscribe to observables
which by the way there's a lot of things
it's just JavaScript so this all
happened based on me asking what if I'm
not telling you to do this I'm telling
you that this is just you know something
that you could think about in something
that you could experiment with because
we all like experimenting and that's you
know one of the great reasons that you
know we do what we do so thank you James
pump Iceland it's all the time I have
and I'm David Cay piano on everywhere if
you want to talk to me</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>