<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Matt Edelman: Nemo. The natural nodejs automation solution | JSConf US 2015 | Coder Coacher - Coaching Coders</title><meta content="Matt Edelman: Nemo. The natural nodejs automation solution | JSConf US 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Matt Edelman: Nemo. The natural nodejs automation solution | JSConf US 2015</b></h2><h5 class="post__date">2015-06-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1DoveeFXptY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thanks everybody thanks to jay s comp
I'm going to try it the first part of
the slides hopefully is going to be
somewhat entertaining it's kind of a
reminiscence of this conference and some
other just some sort of getting started
stuff so first of all a great big thanks
to John Charles Sisk who's a teammate of
virus on the kraken team who got this
slot and then gave it to me he's not
here he had to leave early and he sent
us this picture in slack and he actually
was not wearing a shirt so I did
everybody a favor and just really
quickly put a put a shirt on him he's
got so much chest hair it almost looked
like he had a sweater on but still it
was ok also it's been a long conference
and at this point for those of you who
have families that didn't travel with
you I'm sure you missed them i miss my
daughter the movie star and my son the
movie star it's unfortunate max max gets
two pictures because he's he's something
so that's him trying on my shorts I took
a while right ok so another kind of
reminiscence is that I grew up in the
80s as a lot of us did and there was
aspects of the 80s that still today seem
like they didn't ever happen and they
might not ever happen but they happen or
they seem to have happened and that's
the thing about nostalgia is that you
know when something's happening it's
hard to tell that it's this magical
thing it's only later on you look back
and you kind of pick that out as a time
period and say you know this thing this
thing was pretty special in fact when
during the 80s I was spending a lot of
time trying to pretend it wasn't
happening because some of that you know
some of the culture was felt you know we
kind of felt wrong in a way but any case
in the future keyboards will be held
like guitars it's hard to imagine but it
will happen someday cops will wear toms
so no socks and they'll drive Ferraris
there will be a media channel devoted to
music videos and cars will have gold
wing doors and people will dress up in
the desperate Star Wars movies will be
good got to look forward to that okay my
point is it sort of made it part of my
point is that when I when I get a few
drinks in me all pick a ridiculous
premise like the 80s is the future and
I'll try to defend that while everybody
around looks at me like I'm crazy so
just wanted to bring that to that
happened a couple of nights ago so let
me move on into what's happened to
paypal since we started using nodejs it
came in as a prototyping framework so
some people came over from netflix bill
Scott Jeff Harrell Eric Toth and they
basically said hey we want to transform
you know what's going on at PayPal in a
lot of ways and part of that is the
technology so let's see if we can build
you know product faster with nodejs then
we were able to with job and that's
something that happened and there's some
talks around that Jeff's given some
talks about that so I'm not going to go
into great detail but the result was
that we started developing all of our
products all of our web and mid-tier
products on crack and jas which sits
over expressed so what that left us with
was people writing applications in
JavaScript but still writing the
automation tests using Java using the
framework that we use to write tests in
Java so before I get to that if you
weren't here for Dave cadwaladrs talk
earlier he showed the testing pyramid
where UI tests it at the top that's a
great pyramid and some people at PayPal
flight like to use that analogy as well
it's not in my slides but I just wanted
say you know I agree with that as well
that UI tests you know are important and
they sit you know on the top they
shouldn't be everything you rely upon so
why should you test well let's take an
analogy so here's John Charles Sisk
again and this is from a golfing
excursion that I wasn't on yesterday I
guess but we'll use golf as an analogy
for web development or product
development and these guys who went
golfing
are some of the best developers we have
at the company so let's say they're the
best golfers that you could possibly
have so they went to the golf course
with their golf sticks to knock the ball
into the into the goal so here here's
them starting out there having a great
day their developers look at that that's
beautiful form right so you know they're
great they should never make any
mistakes because you going out your
golfing everything's fine you know how
to golf you're a great golfer okay well
but sometimes you don't have your best
day sometimes you know maybe you stayed
up the night before or you're just
you're a little bit distracted so
mistakes get made and sometimes side
effects get introduced into your code so
call that the side it back anyway okay
and here's here's Jeff taking a swing so
why test well even great developers have
their days when something gets through
right so that that's why test oh and
sometimes turtles end up on the golf
course as well moving fast for a turtle
right okay so let's test finally
selenium 101 for those of you who don't
kind of use it on a day-to-day basis or
have a lot of familiarity with it is
this fairly complex system whereby
you've got your language binding on the
left there where you write your test
whether it's in Java Python JavaScript
and then you've got JSON wire protocol
that communicates with some sort of
intermediary like a browser driver so it
might communicate with the driver on
your system itself or it might
communicate with the cloud that then
opens up another target and does some
stuff so this is this is just kind of
again kind of 101 and there's the rabbit
in the Hat because to me this stuff to
the right is magic and it works or
there's bugs and sometimes you have to
kind of figure out what you know which
of those components has a bug and report
it to the selenium team but for the most
part we're going to be on the left side
so where does Nemo fit it fits on this
left side where the language bindings
were so selenium webdriver is an NPM
module that has the JavaScript bindings
and it starts a you know a server if
necessary it sets capabilities it
provides the webdriver API and it you
know gives you the tools that you need
to execute commands and control browser
or device so what Nemo does is it sits
around that it's a rapper that basically
gives you some tools for configuring
that webdriver and also gives you a
plug-in capability so that you can kind
of make the system that you need it's
it's nothing but giving you the tools to
make the system that you need and and
you know we're going to look at some of
the plugins that I've made that I think
makes the most sense but the idea is
that anybody can come and make their own
set of plugins to do to do the things
that they need to do so the the plug-in
that I use primarily is called Nemo view
which we're going to go into and you
know other plugins so whatever you want
to put in there whatever you need kind
of a thing on top of that so at this
point we're just launching a webdriver
we're just launching a browser and
running commands but you still have to
have some sort of a test run or like
mocha or cucumber or jasmine or whatever
so that's something but again Nemo isn't
prescribing what you use it's just
saying here's here's this piece of it
now you know you use your test runner we
like to use mocha so all of my examples
use mocha and then on top of that you
need a task runner usually and at PayPal
we've been using grunt a lot people are
poking around with Gulf and obviously
for private projects people are but it's
not at least within paypal it's not
being heavily used yet and then I heard
of one called broccoli but I haven't
looked into it yeah so you need kind of
all these components to make a full
automation solution and if you look at
the selenium webdriver example script
for how to get started in JavaScript
this is the basic script that you see so
what we want to do was to take it from
here to here so that all this all this
other stuff like you see a lot of
configuration here is put somewhere else
so this is basically what an emo you
know installation might look like
and then of course we want to add some
error handling into the end of the call
back because it's often you know with
the configurations wrong you're going to
get an error back and if you don't do
this you're not going to see it okay so
again we're going to research back what
is Nemo do it loads JSON configuration
using a module called kind of fee which
is used within Kraken as well it
basically does JSON but it does
overrides and it also has something
called shortstop handlers which makes
the it just gives you a lot of
dimensions of control when you're when
you're doing your configuration so Nemo
also takes that configuration and it
starts the webdriver it initializes your
plugins and provides you access to that
to that whole API of the Nemo API so
first of all it gives you the webdriver
API on the namespace that it gives you
back you get the driver and WD which are
the two major components of the selenium
webdriver API so let's talk about confi
for a minute just to explore how the
configuration works so comfy gives you
something called the the node n override
so the value of the node n variable in
your environment can determine sort of
what overrides get used in your in your
configuration and on top of that it uses
something called a shortstop in
shortstop handlers which was also built
by the Kraken team and these would be
values that you put in your JSON where
if a handler is encountered so let's say
that a JSON value has this handler n
then shortstop's going to look in the
environment for this this variable foo
and replace in the JSON that value so
these shortstop handlers do various
things there's n path RV and config that
that basically take your JSON and make
it a lot more intelligent and again give
you more dimensions of control over your
configuration so what what your
configuration directory might look like
if you're using Nemo would be that you'd
have your main config JSON and then
you'd have other environment specific
override files like here we've got a OS
driver local perfecto mobile
Labs it just it depends on what you're
doing what those might be and to give
some sense of what the configuration
would look like just your basic
configuration tells the driver to launch
this browser and then there's the
plugins and the data properties which
which are optional but we'll get into
those a bit later and sauce labs might
look more like this where we're telling
the webdriver some other stuff like you
know what's my sauce username what's my
sauce key and you can see that we're
using the end of shortstop handler so
that our you know on your local machine
you've got your key you know there but
it's not checked into source control so
there's like a sauce labs kind of config
and perfecto mobile is another another
cloud based testing service and they use
a different set of capabilities iOS
driver the same thing you're just
basically giving the webdriver different
stuff to contact a different driver so
really quickly we're going to do a
screencast which hopefully you can see
if you're sitting a bit far away i'll
try and zoom in if it makes sense at
times so this is an example that comes
in the nemo repository if you clone it
there's just an examples directory and
here we're giving a base directory into
the nemo constructor which isn't
standard but just in terms of showing an
example this is this is one way to do it
and if you look in that directory that
it's pointing to there's this config
JSON and it's got a the driver section
in a browser section and we're just
going to go ahead and run that and see
what browser we open the Firefox opens
up we got a little printout that says
successfully launched Firefox
so if we set the node environment
variable to special a little bit so this
time we launched phantom j/s just by
resetting the the node environment
variable and that's because in this
special JSON and the driver section were
specifying phantom jas so that's to
illustrate the the environment variable
type of override so the next thing is
that notice that there's this shortstop
handler here that says config colon
browser so that's at the shortstop
handle that saying look look for this
browser configuration property and get
that value and another feature of
shortstop is that if you have something
at the base of your JSON you can
override it with an RV or an environment
variable so we're going to show that by
specifying RV to Chrome and launched
chrome instead you can also set an
environment variable of browser and do
the same thing so this is this is just a
little confusing phantom jas in the
environment variable and that should
launch phantom j/s so we won't actually
see a browser open
and then just to kind of drive the point
home if you use both at the same time if
you use an environment variable of
browser and an RV of browser which one
would would take precedence and I think
most people would expect that the RV
would take precedence which it does so
we launched chrome in that last example
so that is just a quick intro to
basically how you can do file based
overrides in a little bit of shortstop
handler business within within Nemo the
second major component of Nemo is plugin
so let's talk about those what would be
in a plug-in you might have webdriver
abstractions so some combination of
things that make sense together you
might put user interactions together in
a plug-in because you want to share it
between projects or you're a company
that does stuff internally for testing
you might put proprietary sort of
functionality in a plug-in and a plug-in
basically looks something like this
where you've got a setup function that
gets exported from your module and that
setup function just has a simple
signature of taking the Nemo object and
a callback and then you add something to
the Nemo namespace so for example sorry
example Nemo dot log in is saying that
when the Nemo object gets resolved now
we've got this Nemo dot log in namespace
in this case it's a function that that's
going to log you in so I just you know
put a comment in there and said this is
webdriver stuff that will log you in so
that's basically what what a plug-in
looks like and if you want to configure
a plug-in you just add it to the to the
configuration you say my plugins called
log in and the module is either
somewhere in my file path or it's
actually module in my dependency tree in
this case it's in the file path and to
use it once you've got an emo resolved
and back to you you just call it an
emote log in and you pass whatever
parameters so that's how you author
register and use a plug-in and the
plug-in that I authored to be sort of
our you know favorite or promoted
webdriver abstraction is called Nemo
view and if you look at that here's sort
of three levels the first
level is what you would do in basic web
driver to find an element and click on
it the second line is what you do with
Nemo view if you use these underscore
methods that just take a simplified
locator basically we're providing a CSS
locator and then you can click on it and
then the third level is if you use the
locator abstraction which will namespace
sets of locators so in this case Nemo
view Nev bank is just going to give you
back your web element and then you click
on it see these are sort of the three
layers I think you'd probably agree that
the third is more palatable than the
first so what we'll drill into that a
little bit first of all this is how you
would register Nemo view it's a module
from NPM so it would look like this you
you say I have this view plug-in with
module of an emo view and what it gives
you by default is it gives you these
basic abstraction methods that you
supply just a string to and then you get
you get your element back so there's
fine finds present visible wait wait
visible and first visible the last two
are kind of the ones that I use a lot
for asynchronous testing that way you
don't do stuff like put you know ten
second time outs between this command
and you know wait for the next thing
because that's always going to be
brittle so for example this is adding a
bank in the sample application that
we're going to see in a minute and I'll
just kind of leave it there for a second
so you can take a look
okay so the next layer if you're not
just using the the generic abstractions
is to say I want to have a set of
locator files to store my locators in so
that they're shareable across files and
locations so I'm going to specify this
argument to Nemo view that says look in
this directory there's some files there
you should be interested in so there's
this locator directory that you should
look at so here's an example of a
locator file it's just simple JSON and
you can see that it's got a type and a
locator so this is just defining
elements for in this case a bank a bank
form so there's a number routing button
and then success and failure and we see
how those are used in a minute so what
happens is that Nemo view is going to
generate functions that something
javascript is great at its generating
dynamic functions for each of the
locators so look at the number and for
the number you're going to get all these
functions back you're going to get the
basic one which returns the web element
and then all these other ones that can
do different things so this is what it
looks like to add a bank using using
that view so you're you're we're setting
a couple of convenience variables and
then we're using the the Nemo view
methods to work through that that you I
okay so let's really quickly this is
about a five minute demo it's going to
basically cover those points that I
covered and we'll just do it again using
the sample app this is something you can
clone right now and an NPM install and
just get it running what it is is it's
called pay friend so it's like a little
mini kind of PayPal type of application
with with a sink it looks like one page
application behavior so it gives you
like a three-second weight between each
activity so you can say fail at fail
calm and it will fail log in and
anything else would be success and then
there's a couple of forms who's adding a
cardan adding a bank and both of those
also have the sort of success and
failure scenarios
so 100 100 1 is the failure number and
anything else is success for these for
these performs and you can log back out
so what we're going to do is we're going
to walk through sort of the timeline of
how you would test an application so for
example and this is just the
configuration again but when you first
start testing an application you're just
kind of writing the test on the flyer
just throwing the script together so it
looks something like this generic spec
where you know your locators are just
right right in the file everything's
just kind of like a big script literally
it's just a big functional script so
this is kind of what it looks like so
you're using the generic methods to to
run through the UI to to login add a
card at a bank account
okay so we're going to run that and it's
using the mocha runner on webstorm
and it just runs through all those
scenarios and you can use any you don't
have to use CSS locators you can use ID
locators or any of the other available
selenium locators
okay so the next step of testing an
application once once the UI starts to
harden a bit is that you say well I want
to start taking these locators out and I
want to start putting them in a
shareable location and that's where we
would start using locator files so again
we're telling nemo or an emo view rather
to look for these JSON files in this
directory so we've got this is bank card
login and nav so these are basically in
my mind when I when I split this
application of those were the four parts
of it and here's all the locators that
you would need and and this would be the
next step of the testing process where
now we're using the locator files
instead of the the generic methods so
we're using the login view the card view
the nav view and the bank view to run
the test now so I'm just pointing out
that there's the email locator and then
there's all these functions that are
built off of the email locator like wait
visible so if the page is loading it
will wait until it sees that element
before it moves on and does these other
things
and just to compare back again that's
the generic spec so we'll run the view
based one and I didn't mention it but we
did mention if we're using mocha to run
these tests so you'll see mocha syntax
around the webdriver commands
okay so the final step in cleaning all
this up is to say now I want to take
similar functionality and group it
together in different modules so for
example i made this file navigate j/s
that has all my navigation commands in
it and is using the navigation view and
some of the other views to do its work
so this is this is you know you could do
it however you want in your own project
but this is the pattern that i recommend
to people which is you know create these
these flow files i call them and and
kind of group similar functionality
together and then when you write your
tests the the actual code that you write
is going to look very semantic and it's
going to be pretty explanatory as far as
what your test is doing so here I'm
pulling in these three modules I'm
puffing them up with the Nemo object
when Nemo resolves and then in the
actual test itself you can see again
this is very I mean it's almost I mean
you could read it even if you didn't
know JavaScript okay we're logging in
failure success for card adding success
and failure Bank success and failure
and as you can imagine it's all going to
work because it's a screencast and I
like to stay away from the demo you know
the demo demons
so that's basically a walkthrough of
nemo view and the way that you would go
from the first writing of your test to
the third where everything's packed away
in a nice way and and reusable okay and
just a reminder at this point is that
this is this is how I train people to
use Nemo within paypal that doesn't mean
this is the way that you would have to
use it Nemo again it's just a simple
webdriver abstraction that allows you to
to add plugins and do the configuration
using can feel like we talked about
before so I'm I have seen and I'm
looking forward to seeing more examples
of how to use it from other people who
start to add their favorite modules in
their favorite you know task and test
runners around it and to get started to
look at that stuff and to play around
with the code that we looked at today
you just have to clone the Nemo example
app and we're looking for contributors
and I didn't I didn't mention it at the
outset but Nemo was actually named after
Captain Nemo the scary sea captain guy
and not the little fish so here's
captain nemo looking for contributors
and what we're looking for is help doing
stuff like fixing the generator that we
have a yeoman generator but it's not
generic enough so i didn't really want
to promote it today it does it does do
some things but not to the point where i
really want to talk about it some golf
examples some mobile examples would be
nice and we heard about Magellan earlier
today so maybe that's something we can
integrate in the future as well but we'd
have to we'd have to look into that and
i think that's my last slide asked me
for a sticker I've got I've got stickers
up here with the little guy on them so
that's it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>