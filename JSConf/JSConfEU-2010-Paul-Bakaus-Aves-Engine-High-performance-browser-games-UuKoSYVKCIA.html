<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[JSConfEU 2010] Paul Bakaus: Aves Engine: High performance browser games | Coder Coacher - Coaching Coders</title><meta content="[JSConfEU 2010] Paul Bakaus: Aves Engine: High performance browser games - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[JSConfEU 2010] Paul Bakaus: Aves Engine: High performance browser games</b></h2><h5 class="post__date">2013-06-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UuKoSYVKCIA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Paul becos um I actually had
to change those slides yesterday which
is really hectic because yesterday we
just announced our Equus the acquisition
which was Zynga actually bought us
yesterday and and yeah all right thank
you so basically we're not text us
anymore those slides were all based on
dextrose branding and all that stuff so
we're not direct textures anymore it's
it's really good that I'm not talking
about the others engine itself today
because the Ava's engine will likely not
be like sensible anymore anymore soon
but there's a lot of new cool stuff
coming up and I still want to talk about
how to develop fast browser games so
it's still fitting into the direction
that we're heading um so yeah just just
on this I'd sorry we were opening a new
office in Frankfort which is called
singha Germany so basically singers
coming to you rope and and that's it
yeah that's the whole like position
please read about it in tech with
TechCrunch if you want to so who has
seen some video on the others engine can
you raise hands a bit ok quite a lot ok
nice so with the other having success
and V wasn't over having success of the
artists engine prototypes lots of people
actually ask us questions and questions
were like how do you actually get this
stuff's done yeah so we are showing
stuff like this is my 27-inch imac and
another screen attached so we were
testing all our prototypes on over full
HD resolutions and people were asking
all the stuff and I've been trying to go
to conferences and talk about it but
there's always not enough time and then
you know I always try to pick up stuff
that's really interesting so and you
know also right now is the perfect time
to talk about it because only very
recently we got powerful enough hardware
to run a lot's of crazy JavaScript um it
depends on whether you go mobile or
desktop obviously new advanced
technology sees three html5 you all know
that highly optimized rendering engines
v8 nitro there's a lot of crazy stuff
coming up from Mozilla as well now so we
figured out early this year that right
now is the right time to do to try to do
gaming too because gaming is really just
a just a very new field in the web in
general and then an untested field so I
still think we were probably the first
company who try to do our JavaScript
gaming like a real commercial game
engine plugin less and so additionally
and why wasn't that happening before why
why was not happening because you know
we're figuring and we were talking to a
lot of companies and we realized there's
lots of knowledge needed to build
sophisticated games but many of those
game companies even in Germany like
gameforge big point lots of those
started as a hobby and extra web
developers and I'm one of them like I'm
not a game developer by heart I'm I've
been a web developer for years now actor
web devs are seldom good game developers
and vice versa and that's a huge issue
so there's very few around us who know
both worlds and really it's a whole
training process and it's a self
training process for me as well I've
been developing all those techniques who
are unique for the web so that's why I
really want to share them so let's
before digging in into the hot sauce
let's first talk a bit about the open
web stack and so html5 okay yeah
everyone loves html5 and everyone loves
a buzzword and the other hand you know
people are talking about this html5
html5 game engine coming up and I was
like well year it's not really html5 and
since you no html5 we're actually not
using anything of the html5 standard yet
which may be the possible exception of
video and audio which are two things
that we are using but other than that
like
all those new nice switches and controls
and then the new stuff coming up we're
not using any of it in fact and we're
not even canvas we're not even using
canvas for rendering which I go into
detail right right away so it's really
not an html5 engine and such HTML
Javascript CSS engine it's using autumn
and it might be using html5 and a lot of
those features in the future but really
it's just using the open web stack so
our pig really is vanilla HTML CSS for
rendering JavaScript for scripting
client and server canvas but only as a
tool and not for rendering and CSS
transforms and both of them
cross-platform I go into detail about
one of them in a bit so and then jQuery
and jQuery I so on I've been a core team
member of Jake we for some time now and
it did it really made sense to use
jQuery and why didn't make sense it made
sense because jquery library focus on
certain tasks the effort doesn't get in
our way so we cannot afford a framework
that restricts us that's really the
difference between framework and library
so we needed a tool that can eat some
task force like doing selectors so I'm
also what we need it and that's really
important Jake Lee comes with great
event support and they did a lot of
overhaul recently on event triggering
and binding performance so that's that's
really sweet yjp I um Jake we arrived
really there's a different use case
because we actually can't use any of the
widget subject lets you build richer
interactions on top without restrictions
for instance panning a world map is one
of them since it really requires
drag-and-drop but it's a different
interaction and the bonus really is a
patch by me to support touch events so
basic by using that Mouse interaction
widget that support static touch avenge
the events on mobile browsers like iOS
um I had that whole new abstraction that
really does it all for me so that's
that's really good um you also need to
think about cross browser if you think
about open web stack you do need to
think about cross browser does your game
engine
your game really does need to be
cross-browser i really find out that
usually it's not the case because
sometimes you just want to do a mobile
game and you just want to do it for
WebKit browsers so if your engine is
platform-specific there's no real need
to care about cross browser and
obviously the pro is that it's really
extreme development speed up so if you
if you do an iphone game really try to
only do iphones specific stuff and
sometimes you don't even need to use a
library for that also if you start
working on the game today chances are
very likely that will not be out in the
upcoming months so don't worry about
today pick technologies from the future
obviously it's a bit of you know risky
to to to think about what will happen in
the future but your game really won't be
ready to mow on predict wisely so let's
stick into architecture and API design
what you want to keep in mind first of
all there's a couple of impossibilities
that rediscovered first of all this
journalist that cannot be implemented
soon but pretty soon for instance casual
3d games you'll see in quake 3d in the
browser simple shooters using WebGL I
think that's fairly possible anytime
soon I think WebGL is not stable enough
to do it right now but please prove me
wrong you know also WebGL needs to you
know there's a lot of work and needs to
be done like a nice shaders and top of
it nice libraries on top of it I know
that Google's are converting Oh 3d which
is really nice but it still takes some
time also genres that cannot be
implemented for many years to come
includes next-gen 3d games like if you
think about doing final fantasy 13 like
a big-ass console game for the web
that's not in my opinion not going to
happen anytime soon I've seen really
like a lot of games unity based WebGL
base that are upcoming from the big
browser game companies and most of them
and this is really unfair
most of them look like quake 10 years
ago which is not the impression that we
want to give with our games like really
if you think about online gaming you do
want to have something that lives for
years to come because most browsers tend
to have a really long lifespan and most
browser games so if you're looking at
popular German titles they tend to have
a lifespan for over 10 years people keep
playing them for 10 years so if they
look bad after 10 years like which which
happened to most PlayStation titles
that's not good if you're looking at
Super Mario from 10 years ago it still
looks som some kind of nice it still
looks good so on that's just our
decision we made a decision to just do
to DN to that 50 so what is left to diab
viously puzzles adventure board games
card games platformers German runs all
that stuff to 25 D which is RPGs
strategy turn-based real-time simulation
and there's a lot more use cases and
really what we choose for prototypes if
you haven't seen it yet we choose
something like that so this is our
newest prototype that we release that
III earlier this year and this is kind
of a Sim City world community so you
have those houses and and you can walk
around and check with your friends and
do crazy stuff it's all in real time
it's all graphical and it's all
JavaScript and plug in us so um what we
really wanted and that's just a really
quick feature list free Mouse planning
obviously infinite realtime worlds
non-rectangular objects animated
characters chat bubbles collision
detection pathfinding walking into
houses mashups a sound effects scalable
viewports and obviously MMO readiness so
it scales to thousands of people and
people were asking me this is all nice
but you know this kind of sounds like
the Duke right this is really a huge
featureless and there right there right
if you try to develop a classic game
engine that might be the case but we
aiming for the web so let's dig into the
special sauce now I know you're waiting
for it probably
so that sets come up with some of the
things that we discovered the first of
all rendering we had the question of how
do I actually rendered 2,000 objects in
less than 50 milliseconds because that
if you're looking at scaling viewports
to full HD that's some test case that
really might happen and where we what we
thought right was obviously I use canvas
because canvas is the hot new thing and
and canvas is sexy and canvas is
hardware accelerated now so canvas is
really the way to go and you can load
images in canvas all nice so here's what
happened we figured out that canvas in
fact is a lot slower than everything
else so if you're using a lot of images
canvas really drags you down because
canvas image API unfortunate since you
always have to initialize the image
using the Dom then you have to wait for
it to load until you can actually render
it out to the canvas um which means if
you're working with lots of graphics is
actually waste lowered and just do DOM
and just have dibs all over the place
and work with images so that was
frustrating but you know I really just
want to get it fast so i didn't use
canvas ruining rendering after all but
um that actual explanation was kind of
not enough for many people they were
talking like okay I can kind of
understand that and but you still you
know you're still constructing Dom
elements with tips to and images and
whatever it's not like that it should be
a huge difference so why can it be that
much slower so canvas best redrawing and
that's another big point it's also
extremely painful as we had any talk if
you've attended the talk right before
that they were talking about this little
bit so I feel if you're working with
canvas what you have to do is if you
have something on the screen happening
and and the character fences is moving
on the screen and moving its position
what you usually do
simply wipe out the Holts hold scream
the whole frame again and rendered once
again all the stuff that goes in it and
that tends to be really really slow if
you're looking at operating systems and
browsers in general what browsers do and
what operating systems do is partial
redrawing so really what you do have to
do if you want to do a scalable game in
canvas you have to implement your own
partial redrawing algorithm so what you
have to do have to analyze the areas
that really do change and basically only
read or those areas and this gets really
reach tricky believe me okay you have to
invest a lot of time into getting this
right and impulsive vendors we're doing
it and you know if you're working with
thumb the browser vendors are already
doing it for you so I figured it might
be really good to just do dham for our
prototypes so really the basic message I
want to give you don't just go for
feature because it's hot and because
it's new um really try out what you want
to do and test my testing is key test
until you really are confident that it's
the right solution for your case and the
right solution for my case was pure
vanilla Dom so our next one delegation
as i mentioned events is really
important for all kinds of stuff we're
doing so what we came up with with was
really one event to rule them all that
is actually three events one of them is
mouse move but those are the three that
are most important to control the game
obviously can you can have keyboard
control as well but for our prototypes
that were that were the three events
events that we need it so if you think
about clicking on objects for instance
since its using event delegation yeah
obviously like you have that you know
that's that's a diff and you just put it
somewhere on your map and what happens
now well obviously it's using a
background graphic some P&amp;amp;G with alpha
transparency and well you can click on
it but you know you can click on the
alpha transparency to which kind of
sucks because that that's really not the
kind of experience that you want
I go if for instance if I have another
house behind that one and I click into
that transparent area I'm not expecting
that house to actually be lounge at
whatever opening pop-up so this this
really kind of sucks so what we came up
with was something really creative and
that is click food maps this is well
maybe not that creative but creative web
in the web and creative in the way we do
it so um the game industry was doing
that all over again they were doing it
for years but I haven't seen this in the
web any anywhere so what it means it's
build up pixel map for each object that
tells us what it turns when pixels are
so if it's transparent then check behind
until you find a valid target so this is
pretty easy because if you if you do the
event delegation from the top you always
know you always control your viewport so
you always know where your stuff is in
general if in your JavaScript so
checking behind is really not that hard
and this fixes our issue which is really
nice however there's one issue with that
building up those pixel maps is
amazingly crappy work it's hard and you
have to automate it somehow so what we
did is we lack canvas to it so this is
what I mentioned when I said I use
canvas as a tool I'm not using a
rendering I'm just using it to actually
read pixel data of the images then we
check if our pixel is in fact
transparent and then save this value in
a new optimized array and basically use
this whenever we need to check and it
actually scares really well so EXCI
works really well you have to be careful
if you want to support IE six but other
than that it's nice so that's just one
of the tricks next one exit surfaces I
was talking about this a bit in our
videos but I might be going a bit more
into detail to today which is really new
content so action surfaces was something
we came up it's basically drop of over
widgets or other objects so if you look
at that TV right the
black screen basically would be an area
where you could drop generic content for
instance I frames or whatever so they
transformed to isometric projection in
real time using CSS transforms since by
using CSS transforms you can transform
to isometry on the fly and its really
way cool and that's also something by
the way that could not be possible if
you were to use canvas because if you
were to use canvas obviously you have
one surface and there's no way to
actually stick something in the weed so
if you were to use canvas for rendering
you would and you wanted to support
action surfaces you would have to you
know Annalise if there's any action
surface on the screen and then and then
generate multiple canvases that lay on
top which is also kind of frustrating so
since we're yeah if we are using the
domain and the whole layering is
controlled by the browser that's really
easy so on how would you do it that's
just a code snippet just I might be
releasing this somewhere so it can
actually copied so those are that CSS
transforms needed and it's really not
much it was really hard to come up with
this crap but um and I don't know how
the numbers how I actually got two
numbers to be honest but it works so
it's busy i think i read it up on
wikipedia and figured out how to do the
isometric projections and so if you're
using those classes on any of your
elements it basically transforms them to
the right angle to the right isometric
projection and it's really a nifty but
of course you know if we want to build a
game we want to support into exploring
even with ie9 and i'm really happy about
iodine by the way I'm not so happy that
it doesn't support CSS transforms which
is kind of bad but in Thai explorer
really obviously is if you want to do a
game that's guys well you need to
support in an explorer so what do you do
I found out that I II actually owns so
if you dig deep into the source of a
dick into the msdn you find some
interesting stuff so one thing that many
people don't know who is who has heard
of the
mattrick's filled up before race your
hands okay there's a couple of them nice
so on if you dig into the amis end and
really deeply and then it's painful but
it's worth it you find the matrix filter
and the madrix filter really is very
very similar to the matrix function in
CSS transforms except for two things
there's no translating in the matrix
filter if you well there is but that's
an anecdote by the way but if you want
to rotate an element for instance right
you rotate it and then the actual box
changes its size obviously since if you
rotate it for instance the Box gets its
higher and in inter Explorer you can
actually have it either set to clipping
so we'll actually clip that content and
base you not see parts of the box
anymore which is usually not what you
want and only if you use that clipping
method the translating works if you are
not using clipping and if you knew if
you use the auto scaling feature of
which luckily into x plus reports
somehow translating is broken so I don't
know why but this is just something you
have to work around so the matrix is
really working very similar to CSS
transforms so what I did I came up with
a plug-in called transform me which
basically does the following it parses
Tai Chi's and inline styles in IE tracks
them using the I only on property change
which is really nifty by the way and it
creates a custom metrics for every
function like rotate scale skew because
CSS transforms has all those extra
functions as well then multiplies our
mattresses using Sylvester jas which is
really nice and creates the I metrics
failure in the end with the combined
result on the element and that works
amazingly well and since I've once done
a cover flow with CSS transforms which
really had a lot of interaction so you
had to actually do it like every
millisecond and something like that and
it was working fine on I six on i-55
even which was quite interesting so I
transform it really does it all for you
you yeah amber transform me like X
canvas
and you don't have to care about it
anymore it really just works hopefully
not in all cases by the most cases so
that's one of the one of the things and
if you want to check it out this one is
actually open source so go grab it on
github if you want to so our next one
hardware acceleration one of the key
things about browser gaming in Java
JavaScript and that is something I had
to realize the hard way you know last
year when all the nice browser engines
were coming up with like then all the
nice javascript engines and always like
oh I never have to care about
performance anymore nice but you know
that's only a few work on the desktop
really it's just it's so frustrating
even on netbooks most of the engines
work nicely today but if you're looking
at mobile phones and we wanted to
support mobile phones and tablets the
story is really interesting and install
really is different so if you if you're
working on games that support multiple
platforms you do have to care about
performance and you do have to care
about performance a lot so how do i
acceleration really is one big example
of how you can prove that first of all
and that was in the other talk as well
how do you accelerate the open web stack
there's basically two areas that work
right now which is canvas and 3d CSS
transforms people like the the marketing
departments of ie9 and things like that
tend to say their Hardware accelerating
the whole browser which is simply not
true so there's only certain areas where
hardware acceleration is in place so
cameras and CSS transforms for canvas
really good news you actually don't have
to do anything additionally so that is
if you're running one of the following
browsers which is i 95 fox 4 and chrome
nighty I don't know if there's any other
browser that I've forgot anyone okay I
guess not sorry
oh yeah that's true way too yeah so um
you also have to care about the platform
it's running on but in general if you
are on a platform that is Hardware
excellent can hardware accelerating
canvas you don't have to care about it
anymore just working for CSS transforms
it's a different case because you see
you are using 2d CSS transforms for
instance if you want to rotate an
element you're just using the rotate
function which is basically 2d CSS
transforms but unfortunately those 2d
CSS transforms don't get how we
accelerated so 3d CSS transforms on the
other hand our all GPU has accelerated
on browser to support them for instance
safari in Chrome for instance they just
map to the 2d functions so they won't
get accelerated but if you're using
safari I should work so 3d transforms
are all accelerated but on the other
hand you know I mentioned again we are
just doing 2d gaming so we don't really
need 3d so what do we do um it's really
easy if you think about it and the
solution is mapping so just simply do
alt 3d all 2d animations that you want
to do you mapped into 3d animations but
not actually i'll change the layout you
actually transform it to translate 3d 10
pixels and pixel and simply leave the
set Z access so that's just what you do
and all in all it just works so and
bonus and this is what we're doing a lot
to you can use this for repositioning
and animating so if you're moving a
character on the screen don't actually
change left and top but use translate 3d
and it will be a lot faster on iphone
and ipad and lon android so that's
really something worth to consider
server-side javascript i mentioned
before they were using javascript both
on the server and the client i'm going
to check really quickly while my time
looks ok i have to go quickly now so
on people are asking me this right I
like the gaming industry guys at least
javis could pay for nothing ready now
you want to work with it in the back end
since most of the guys were released C++
guys so why did we choose JavaScript and
I think it's pretty obvious for many of
you but still single scripting language
but project dramatically speeds up the
development really like if you if you
have a single language in your team
that's just insanely off some and
insanely effective and create portions
simply can be reused so there's a lot of
lot of like the isometric functions that
we can reuse on decline in server so
chaves cannily i love javascript i'm
really a geek by heart so javascript is
awesome um no chance I'm going to skip
right through this because everyone
knows no chase I guess search asking the
browser javascript in node great
innovation obviously is event-driven
it's non blocking and this is a lot of
the adventures that why we why we were
using no chairs for the prototypes io
API is also non blocking blocking roads
non-blocking well we got that modules
atma script and now really cricket bonus
time if you do animating a lot of stuff
there's a new property there's a new
method in in Firefox Firefox nightly at
least which is called most
requestanimationframe it sounds really
crazy but it's actually pretty useful so
usually if you're animating in
JavaScript what you do is you're using
intervals and timeouts and if you're
animating 50 people you're using 50 and
develop and timeouts and chances are
dead for instance every second you're
doing 500 of those rendering
calculations but you don't need to
because the browser doesn't update in
500 frames per second so if you're using
Mosul requestanimationframe you're
basically doing it through events you're
waiting for an event to fire and then
triggering the next event so the browser
is actually controlling how much you can
render at a time
so using those using that that interface
actually the browser is simply scaling
for you which is really nice mega bonus
time CSS animations well there CSS
transitions I think most of them most of
you know them already which just animate
from one state to another support timing
eating CSS animations are really more
effectively because you can control them
they can have keyframes and you animate
from 11 certain value to another one for
instance they have unlimited steps and
you can use any CSS you can also trigger
them like a repeat them and start them
and stop them and they're really useful
for position animations or pacity
animations color animations and size
animations they're not useful for single
one and that is sprite animations so for
sprite animations and we were using
those a lot like for instance if you if
you're animating a walking character you
actually have to do that through spite
animations and 2d games so sprite
animations you can't actually do because
if you if you try to do spite animations
with the key framing you define a couple
of background position values through
keyframes and then unfortunately
everything between the keyframes get
interpolated so you see the background
image sliding right so it's not just
jumping from one position to another
like picture picture picture is actually
sliding through it so that kind of sucks
and not that's not the impression that
we want and luckily this is really
really hot and this is really really
knew this just went into the specs
recently like a I think two weeks ago
three weeks ago it's not implemented in
any browser which is which is
unfortunate but it really steps it's
nice steps there's a new eating property
is a new timing function so basically
what it does it it's not eating at all
it's actually disabling easing so if set
keyframes are in fact behaving like
individual frames so with that you can
actually control it you can actually
control signal framing and I hope
you can see some implementations soon i
know there's tickets already and then
hopefully something is coming up so
that's it i think i'm right on time
almost i also wanted to mention on
follow me on twitter if you want to see
new stuff coming up and also i'm here
for recruiting as well so if you're
looking for an hour awesome javascript
job in in frankfurt and alongside me and
another couple of guys we're hiring
we're looking for the best javascript
engineers and we have a lots of exciting
opportunities now thank
are there any questions left i think i
forgot to ask yeah one the engine oh
well you know the engine is coming along
quite well we're starting to do the real
coding but as I mentioned like
unfortunately we will never see the day
off light for other vendors and other
companies because it will stay in zynga
internally to build all the singer
platform and single gaming experiences
so if you're looking at middleware you
probably have to jump on some
competition can you move a bit forward I
guess someone repeated which one impact
is um oh yeah I've seen that one I've
actually talked to the guy behind impact
joyous and I actually wanted to hire him
he wasn't interested um but I love it I
guy I really want to see competition and
growing and I and I think that's the
best I can happen right now I always I
always mentioned that in my in my in my
talks before like I want to see
competition I want to see the web nature
on gaming too like I want to see people
jump on it and develop great games which
is really all about I'm for so
competition is awesome and I if you want
to do game engine please do so yeah
um i think i think i could get the
question
you
you
yeah I wondered about that too I I don't
actually have a have an answer for that
it sounds silly ain't but you know I
know there's a nun q webkit I think
there's some some some guys who are
experimentally trying to to you know a
hardware accelerate more than what is
available right now like also the 2d
transformations and and animations as
well I think it's coming I think it will
eventually come and and yeah I guess so
yeah yeah so I hope it will change soon
yeah it's all very fresh stood alright
thanks again</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>