<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Brian McKenna: Roy | Coder Coacher - Coaching Coders</title><meta content="Brian McKenna: Roy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Brian McKenna: Roy</b></h2><h5 class="post__date">2013-01-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/w3ML8wlt1oU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everyone I'm here to talk about Roy but
first I'm gonna talk a little bit about
myself so I'm actually hired as a job
developer atlassian who here likes Java
couple okay so full I've been working on
a scholar project so I've been working
on that for a couple of weeks now who
here likes collar I love scholar at home
I'd like to do a lot of haskell who here
likes high school awesome that's awesome
for a javascript conference but really
at home I do a lot of JavaScript I do a
lot of web based programming I do a lot
of nodejs programming who he likes
javascript only a couple only a couple
but basically while I've been working on
a scholar and Haskell projects I've
really loved the language but when i go
back to javascript there's part that I
don't like so I kinda wanted to make a
language called Roy and I want to be
here unless it's a ljs language right so
we've heard about coffee script for
we've heard about closure script
yesterday we've heard about things like
in script to mention yesterday and
pajamas which is a Python to JavaScript
compiler there's a lot of cool ljs
languages but not many of them do what I
think Roy does which is types so I
really believe in statically checking
your program I think so i'm paintin
Jones puts tice best he says that types
are the world's most-used formal method
by six orders of magnitude so if you
think about that we are verifying parts
of our program we are making sure that
putt some some errors don't occur in our
program which i think is an amazing
thing and also Roy's a functional
language and functional means a lot of
things to a lot of different people some
people think that functional means are
you just computing with functions or you
think ma nerds the way I think of Roy's
a function language is that it's
completely immutable if you just right
Roy code you won't be able to mutate
values if you start calling out to
JavaScript or you let JavaScript start
calling into Roy then you can start
mutating things so
but if you stay inside of Roy then you
can have an immutable program which i
think is a lot easier to reason about so
I like to think of Roy's a bit of a
coffee script across with a camel high
school so we're taking the type systems
of a camel but we're compiling to clean
JavaScript like JavaScript us here's an
example of a road program let hundred
equals 100 so you don't see any types in
this program we're not saying number 100
equals 100 but this compiles into
untyped JavaScript so 500 it 100 pretty
simple but that means this won't compile
so we've got a string and we're doing a
plus plus means add two numbers together
and then we're doing it too so we're
adding trying to add a string to a
number that doesn't make sense from type
theory perspective so Java Roy will just
reject that program and say you know a
string is not a number I can't do
anything with this here's our we define
a function we do let F then we give it a
argument and then we type it to return
number and then return the X so it's
returning an accent is returning a
number therefore X must be a number
right now we can pass 100 equal into
that F and it will work will compile
that and i'll just print out hundreds of
screen but if we try and pass a string
to it we've typed it to return a number
that won't compile that's JavaScript
composing to via air fixed function
return the X easy so structural types
are a really interesting concept that I
think should take off a lot more than
what they have they're pretty much a way
of statically checking duck typing so
here we're defining a function called +
+ XY we take an a then we return the X
property and the y property added
together so we can infer that the a is
an object with a excellent and a wire on
it and that they must be numbers because
we're adding them together if we pass in
obj this isn't in the program so I must
be coming from JavaScript right so Roy
just thinks ok well I don't know what
this is I'm just going to emit a warning
and accept and coerce this to be what
did it what I expect it to be if we've
got a literal in Roy so we've got an ex
that's a two and a why that's one
it'll compile because that's exactly
what it's expecting if we try and down
the bottom for try and pass the said in
civil Y Z in civil way it's not going to
compile because it doesn't have the Y
property so it's duck typing but static
this is JavaScript no types just normal
property access on an object and a JSON
data down the bottom so some types are a
way of encoding alternative values
inside of a data structure so here's the
famous option type so a is actually type
parameter so I could be a number could
be a string then we've got two different
alternatives so we got some of an a so a
is any value that's part of that a type
and then a nun nun doesn't take any any
value so it this is a way of encoding an
optional value in the type system this
is what can balls into it's just a
JavaScript constructor and we do the
this instance of check so you can call
this sum as a function and it'll
actually construct a new object for you
it's pretty nice trick and then we can
just assign the parameter that's getting
passed in to to the object none doesn't
take any parameters to it so it just
construction new a new object with that
name now we can patent match on these
subtypes this is creating a function
called non zero it takes a no it matches
on that Oh for a psalm of s so s is a
value and it returns that value it
matches on the nun and then return 0 so
it tries to unify the s in the 0 so it
figures out that hey s we're returning a
0 which is a number when we're turning s
therefore s must be a number so this
function returns a number and it takes
in an optional value of a number this is
what it compiles into it does an
instance of check to check if it to some
extracts out the value and returns that
value otherwise it checks if it's an
island return 0 this is how you call it
from rowing
just construct a new value cool man or
construct a new value could some with
the value if it's an annual just print
out 0 if it's some it'll extract the
value out if it's a number otherwise if
it's a string it will actually give a
typeerror this is josh compiles into
pretty simple stuff we don't actually
have to put new even though the
constructors because the din since this
instance of check so while ago I wrote a
blog post about escaping something
called cool back hell by using closure
script macros I think the problem is
actually more well suited to 2am on add
a solution i'll probably just for them
by saying one at a lot of JavaScript
people but I think someone said ma nerd
yesterday probably David but it's pretty
amazing how at a JavaScript conference
we were allowed to talk about assembly
and we're allowed to talk about
compiling down to GPU code but we're not
allowed to talk about my nads so I'm
going to do it so this is this what cool
back hell looks like so we do an appt
get then we do a user get then if
there's an error then we return the next
error then we do a database fine for
that user that if there's an arrow then
we return the error go through the curse
if there's an arrow then we return the
error and then we finally send a
response that's a huge cyclomatic
complexity gotten nesting all the way
down to the right it's really hard to
read it's hard to reason about there's a
type over so be good if we could make
this look like synchronous code instead
of a lot of nested callbacks so I've
implemented a monad well actually this
was contribute to the road project just
a request it basically uses the jquery
deferred object to implement i'm honored
so we do a jquery when so you can think
of from one it as a as an interface with
two methods on it one's return which
just takes a value and wraps it up in a
deferred the other one it takes it
deferred and a function and then somehow
rap rock
runs that deferred through that function
so with return we take the X and then we
just wrap that up in a deferred object
easy with a bind we create a new
deferred when the past in deferred has
done we unwrap that value we run that
through the function and then when we
say when that's done then we resolve the
deferred that we've created before and
we return the deferred that we created
before as a promise so it's basically
sequencing out deferred that's what it
comes down to JavaScript pretty easy
just normal jquery calls and this is how
we use the nail so it looks very
synchronous it's just line by line but
this arrow is actually doing the blind
operation so we've doing an AJAX call
and we're getting help the content of
hello world boy then we're doing another
ajax call and we're getting out the
content of a Leo story and then we're
concatenate in both those contents
together and we're returning that so
returning is going to wrap it back up
into a deferred object for us and those
arrows are going to unwrap the value for
us that's what it compiles down into
so-called back it compiles down into
callback hell but a make but we've got
synchronous looking code which is pretty
awesome solution to the problem and it
looks like just a normal property
accesses on the deferred one ad so that
was how to solve call back help with my
notes in taxi in Roy let's talk about
how we do modules in Roy so there's heap
of different ways to do modules in
JavaScript probably most common and the
most awful is assigned to the global
object in the browser so you know just
normal jquery just signed to the global
object you know problems occur when you
start having conflicts with that common
j/s is the solution for no Jas it makes
it look really well it's implemented as
a synchronous cool which works pretty
well from ajs but in the browser we
can't really do that so we need
something more like a single module
definitions
which to find a call back when modules
are loaded so we can do it
asynchronously basically I thought each
of these solutions are better for
different things so Roy should be able
to just take all the commonalities
between this and compile down into each
one because you've already got a
compilation step why not compile into a
different module standard so this is how
you write a module in Roy you can import
another module so i've imported settings
here and then we can access the settings
object plus pluses concatenation and
then we can export an identifier in
browser mode we can boil down to this
you'll just leave a comment saying hey I
expect there to be a settings in the
global object and we'll just access the
settings object then we're all assigned
to the global scope by just using this
and then the identifier name income Jes
mode or just duel require and then
assigned to the exports in a synchronous
motor definitions will define a call
back or to find the name of the module
as well save the dependencies define a
callback that accesses the the module
that we've imported and then export the
properties sells modules what we're
going to work on in the future source
map so I'm trying to make debugging
easier than coffee script because cough
script doesn't currently have a source
map support I'm aiming to be coffee
script in implementing source Maps but
I've actually got Jared in the audience
to start looking into that and he says
it's kind of hard so I don't know if I
better make it but I what I really hope
so and I want to make immutability
easier than one of these in high school
which if you think about is really
interesting since Haskell has to be
immutable but basically a school if you
want to use something called a
functional lens in high school you have
to write a lot of boilerplate but Roy's
going to generate this for you
automatically so here we define a
structure called me so i get i have an
age and i have a name so i can create a
lens from my age property so i do a dot
age that that's just creating a new lens
for me then we can do a get and then
passing that lens and then we can give
the structure so basically that's this
lens has got together in it so we did
get and
that so it just defines them to me it
just composed into a media age and then
gives me back the answer so that's
pretty simple but the age lens also has
a setter on it so we can do a set age
lens and then give it a value and then
give it the structure and that'll
actually copy that structure for me
update the value and then return that
back to me so it's a way of using
immutable structures and being able to
have a getter and setter as the lens and
pass that around two functions and that
so it's a really cool way of having
mutability and it should be easier than
Oscar which i think is a pretty good aim
and I'm going to copy Haskell when so
i'm paintin Jones with down in Sydney I
was talking to him and he's thinking
about well he's actually working on
deferring to some type errors to run
time if you ask the GF c compiler to so
i'm going to copy that so if you add
this flag into roi de fer type errors it
put into a mode where programs like this
will compile so at the moment how's
school programs will look at that and
say to do plus one that doesn't make
sense that's this programs undefined to
JavaScript programs we see that and go
02 that's the answer right because it's
got a true it's going to it's just going
to run that true every time housing
programs will let the compiler to try
and verify the program and that won't
compile so so they say this program is
undefined but if we put into this mode
it'll actually instead of putting it
instead of giving us a type error at
compile time it'll generate exception
code so pretty much compiling to
JavaScript like this so we wrap it up to
make it look like a to make it an
expression so we throw a new era so this
is a runtime error saying that string is
on a number so instead of showing that
at compile time we probably still show
what I can put a compile-time and we say
you know this is a warning now but the
benefit of this is that we can debug the
program we can test the program without
having to make sure that everything
makes sense the program one might not be
in a state to make sense we might be
still actively working on it we might be
able to test one part of it make sure
we're going in the right direction
before before we actually finish the
program
so I think that's going to be a really
useful thing for statically typed
languages in the future so if you want
to try Roy I've got a website Roy
diploma Kendall org I've got a online
editor so you can just start typing Roy
code and playing around with it there's
heap of examples that you try out it's
also one rappelled diet if you're at the
talk yesterday which is also a cool
service I've also got documentation on
there and links to source code on
bitbucket and get up if you can get up
and also a license hiring so we're
hiring two developers in San Francisco a
couple more down in Sydney so if you
wanna work with me apply for that that's
the URL just go there and apply thanks
follow me</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>