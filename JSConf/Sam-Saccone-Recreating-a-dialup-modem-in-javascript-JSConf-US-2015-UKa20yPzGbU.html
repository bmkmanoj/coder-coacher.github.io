<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Sam Saccone: Recreating a dialup modem in javascript | JSConf US 2015 | Coder Coacher - Coaching Coders</title><meta content="Sam Saccone: Recreating a dialup modem in javascript | JSConf US 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JSConf/">JSConf</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Sam Saccone: Recreating a dialup modem in javascript | JSConf US 2015</b></h2><h5 class="post__date">2015-06-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UKa20yPzGbU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so today we're going to talk about
something that's totally practical and
you can use daily in your job we are
going to recreate the dial-up modem in
JavaScript so maybe you guys have a
memory of this oh we've audio bring back
great memories
that's not that
so once we were online our experience is
something like this yes wonderful
progressive loading slow connection a
beautiful thing so Who am I my name is
Sam saucony i'm a developer at a
consultancy in rhode island called mojo
tak i write software by day and
typically make problems on open source
projects at night so let's start off
with the question what is sound so sound
is vibrations that travel through the
air and for us we pick up those
vibrations or pressure changes with our
eardrum and that's converted to an
electrical signal that our brain
interprets and then we perceive sound
but in this case my computer microphone
is picking up the sound and then I'm
plotting that raw PCM data onto the
screen and this is how most of us think
about sound when we see a waveform we
see audio a visualization of it
so what is data these are the sound and
data are the two components that are
going to help us put together a modem so
data for computer is zeros and ones it's
binary data its state encoded but when
we use a computer we don't see zeroes
and ones we see images mp3's zip files
get repositories so we understand the
binary data through a program which
decodes is binary information into
formats that we're familiar with that we
can perceive so how do we get data into
audio we have our waveform and we have
our binary information well obviously
it's an encoding problem so we need to
figure out how to do that humans are
pretty good at encoding data I'm
speaking to you you can understand me
you can understand language you can
understand what I'm saying I'm
communicating ideas however
communication breaks down when you don't
speak the language if I was speaking a
different language that you didn't know
you wouldn't understand what I was
saying you wouldn't get any information
so language becomes the data encoding
for speech meaning this noise that I'm
making would mean nothing unless you
knew English just be noise so how then
do computers speak how do computers talk
to each other computers don't have a
voice computers don't know how to say
things computers need a way to verbalize
they need a language and a mechanism to
transmit information so how do we do
this I have my two computers and I have
a wire in between them how do they talk
it's a good question so to understand
this I want to step back in time in the
early days of communications
are three primary drivers for modern-day
communications need to be fast need to
be easy to use and need to be cheap to
implement so obviously these three have
been optimized over time but anything
initially was great so in 1792 the sky
Claude and his brother were hanging out
in France and they were out in the
fields and they heard the Bell the
church ring I said wow that's great that
tells me what time it is I said well you
know when I'm at the house and you're in
the field and i want to tell you to come
back we should figure out some bell so
we could communicate so they went inside
and got these pans I said okay well
you're in the field i got this pan i'm
going to bang on it and when you hear
that you know to come back so it's
communication over remote distances
people didn't have to be face-to-face
they didn't have to walk up to each
other and say something they could hit
this pan and they have this code that
they agreed on so for a while that's
what they did they hit these pans they
said hey great we can talk from great
distances said well you know this our
neighbors are getting kind of mad it's
kind of loud so we need a better way
said well okay well I have this
telescope so how about I look at you and
you could make some symbols and I could
understand it so communication over a
great distance so this idea evolved and
evolved and they came up with this idea
of an optical Telegraph and sounds fancy
but it's not it's this tower you can
sort of see with these these needles on
either end and there was this code that
one has pointed here this meant a and
then the other side they would then
point that there and so the next station
would look with their telescope and say
oh well hey oka so it'd be able to
communicate a message across vast
distances however it had some downsides
if it was foggy didn't work if it was
nighttime didn't work it took three
people to operate so it's kind of
expensive
and it was kind of error prone if you
can imagine if you just had the angles
like oh that's a B now that's an a so it
was very lossy but this was used in
France widely up until around 1837 so
this was a revolution there are these
lines all over the place in France we
were like this is modern-day living
along comes this guy Samuel Morris so
France you know they were cutting edge
they were leading the front on remote
communications and the United States was
still in the dark ages they didn't there
was like one optical telegraph line but
it wasn't really used so Sam Morse was
hanging out in a show in New York is
used you know a painter of course and he
got a letter from his father that his
wife had fallen ill so horse guy and
horse came up and gave him a letter and
said oh your wife is failing says oh oh
I better get home and so he wrote a
response and Senate and then before he
even left another horse actually two
days later another person came and
delivered another letter that said his
wife had died so he said wow I hadn't
even had time to like send a response or
get home because there was such a delay
in this communication so he was
distraught he went back to Europe for
his wife's funeral and he met someone on
the boat who said hey heard this thing
called electricity and at this time
electricity was a parlor trick people
didn't understand how it worked it was
viewed as kind of magical said well look
if I have this magnet and I pass a
current through this wire this magnet
changes and this concept of
electromagnetism and he had this idea
that I can create a communication system
using this electromagnetism concept
where I pass a current through the wire
using a rhythmic tone so it's both
on/off Morse code and also temporal so a
long dashed short dash and he pushed
forward came back to the United States
eventually convinced people that this is
a real thing and people didn't want to
believe them because it was still like
kind of weird so
actually would run wires from one room
to another and have people in both rooms
and send a message and then a third
party would since verify that the
message was real because they thought it
was some magic trick so Morse code kind
of swept the nation everywhere was
connected in a matter of 20 years 30
years there were these telegraphy lines
that ran all across the world so it made
it possible for people to communicate
from one side of the world to the other
immediately so you could know the price
of alligator skin in New York every day
versus once every six months so people
loved it it made communicating to
relatives in California not take 10 days
because that was as fast as it could
happen before this was invented so it
also put out of business the Pony
Express which is unfortunate so okay
here we are we have these telegraph
lines running across the country across
the world these lines are kind of
expensive to run they have them running
under the ocean it's crazy we can talk
to Europe everywhere so this guy meo
comes along and he says hey these Morse
code operators they're really expensive
to hire incredibly expensive they're
like modern-day software developers like
I can go anywhere they want like wow you
can transmit it 90 characters per second
you're amazing but he said well you know
this is I need to make this easier for
normal people so he came up with this
new code so not Morse code it's this
baudot code and came up with the
keyboard it's a corded keyboard so
people could be trained on it a lot
faster and didn't have to be highly
skilled to send information so it became
cheaper it's like high sought after
Morse code operator not necessary
anymore and an interesting note is the
term bought actually comes from this
guy's name which is pretty interesting
so a bawd is a single bit of information
how many bits we can send per second
so up into this point we were still
using one line for one message someone
an operator be on the line you would
actually be connected to another place
through patch series or a single wire
and one person could be operating out of
time so obviously as people want to send
more and more messages this didn't scale
very well so he came up but Oh came up
with a way to multiplex sending
information and this was a temporal
multiplexing so you realized hey when
people are using these lines most of
it's just empty space because the person
has to read the message and transmit it
and there's just a lot of blank space so
the way this works is there were like
four or five operators at a time and
everyone would hear this tick says okay
the second tick is yours third take his
ears and people would send and on the
receiving end they'd hear the tick so
they'd know how to split the messages so
people would send at 30 40 words per
minute and then hear this tick okay next
person next verse the next person so it
allowed people to send up to like 240
bod so we were really cruising 1855
that's great in parallel this guy
Alexander bell he made the telephone
actually he was working on this thing
called harm a harmonic Telegraph or
audible telegraphy he figured out that
hey if we changed the resistance in the
signal that we're sending we can
actually create tones and he figured out
that we could use tuning forks on both
ends and we could use sympathetic
vibration to actually send information
between two modems and then stack those
tones on top of each other so this one
was sending at a then b c d and it
allowed 10 signals to be on one telegram
line at a time which was crazy because
it means we didn't have to run more
lines and it was cheaper so obviously
this was adapted pretty rapidly by the
Morse code community because it meant
that more operators could operate on a
single line so send more messages higher
throughput it was great and also this
eventually led to phone lines dedicated
phone lines being
as well so audible multiplexing was that
mean okay so if I so if we play this
town right here he doesn't pay attention
that's one and then I come in with this
if you're listening for one town you as
a receiver it doesn't matter what else
is going on as you can hear one piece of
it just like the cocktail party effect
you can focus in on one thing and ignore
all the noise so audible multiplexing
only meant that the receiver could
listen to an individual tone and then
transcribe it now this was automated
obviously but this was the basic concept
that made multiplexing possible people
didn't really understand that they were
stacking frequencies and then could
extract it but it was based on very
basic concepts so let's step back again
how's data encoded into audio well we're
using this thing called frequency shift
keying so we have our frequency let's
imagine that carrier signal and pop is
our carrier is our base signal and we
modulate that carrier signal and we
create higher frequency sections so your
tone goes from low to high low to high
and if you look at this graph on the
bottom you can sort of imagine that the
the wider frequencies right there lower
are 0 and then 1 so we can encode encode
state into this frequency using this
modulation scheme so we have this idea
of audio frequency shift keying so an
FSK only means that we're shifting a
frequency but we could shift a frequency
that we can hear so to transmit this
over phone lines for instance we need to
make it in the audible spectrum so
something we can hear so
a 10 behind modem might sound something
like this
okay so slow but you can hear the
individual tones the frequency is
modulating from low high low high low
high and you could mainly write down 0 1
0 1 1 0 1 and then you could turn that
back into information according to
whatever encoding scheme you're using
now as modems got more and more powerful
we were sending at a higher baud rate
which a human couldn't decode so that
probably sounds a little more familiar
to you that sounds more like a modem and
that's only six hundred odd as it got
faster and faster it just sounds like
static so in 1908 I think we sort of had
this breakthrough those three points we
had these teletype machines it allowed
for non skilled operators on both ends
to send and receive messages so I
actually brought a version of a teletype
here today so here it is this is
actually a telephonic device for the
deaf that's still in use today it allows
for deaf people to type and put a phone
on top and then send and receive
messages so it up so you guys can hear
us there is alright so what you're
hearing there if you pay attention you
can actually hear at the beginning you
can hear the low and height so this is
transmitting at forty 5.45 baud using
Vadam re-encoding so things that were
invented in the 1800s are being used
today without any change just pretty
crazy so that's a teletype machine we
can send information over a phone line
it's great so well why did we have to do
audible frequency shifting shift keying
and why why does any of this make sense
well okay Bell had established these
phones and people had phone lines
telegraph lines or proprietary people
companies will pay for them and then to
send a message would cost money but a
lot of people had phone lines so someone
said oh I hate having to pay for these
companies to send my information when I
already have I can talk to someone so
why can't i send information well I can
hack the phone system so an audio FSK
worked on the existing infrastructure
and the modem was a way to connect I was
a way to connect teleprinters over
regular phone lines it demodulates and
modulates data to be sent over a normal
phone line so this might not make sense
so let me explain it what the phone
company does is they're smart and they
say okay when a person talks into the
phone they use this much of the
frequency spectrum and you know we can
drop out individual chunks and we can
shift that entire voice transmission
over to here so you can't hear it and so
we can take all the phone calls that are
happening and jam it onto a single line
or three or four lines by shifting the
audio so when people are trying to send
information over phone lines if they're
trying to send at frequencies that the
human voice doesn't send in the phone
lines have determined that whoa now
humans don't talk to us
are these frequencies so we're just
going to drop them then your data
wouldn't send so the modem shifts it to
act like a voice so you can actually
hear it and it sounds like if someone
was talking and then the phone company
shifts it and then on the receiving end
the phone company unship sit and the
modem takes that frequency and shifts it
over where it's supposed to be so in a
way a modem is making it possible to
send information in a way that maybe you
weren't supposed to alright so history
time is over let's talk about some
JavaScript so recreating a modem in the
browser with javascript there's a few
pieces that we need to do this the first
is oscillator node and it's pretty
simple it allows us to we made some cool
music but it allows us to shift the
frequency over time frequency and time
and shift ok those are the words that I
said before and now we can just apply
that to put some data in it I think so
now we can shift this frequency and now
we need to do some processing of this
audio data so the API is in flux still
but right now it's called the script
node script processor node and what it
allows us to do is process chunks of
audio just in time with like giving bin
size and sampling rate and those are
just words doesn't mean anything fine
but it's important it allows us to look
at the raw PCM data and you know runs
the math on it all right okay so if we
have the first two pieces we can shift
the frequency and we can look at the
data okay so now we need to take a
string say hello oops right ok cool so
string to binary that's not so hard just
a little bit of JavaScript cool all
right so we have our binary and we know
that we can make noise so now we have to
take this binary and put it into our
waveform so we know that we you need to
do that by shifting the frequency and my
ability in the frequency to high and low
all right so okay oh I should have
played that nothing good here let's do
we do this one okay okay sweet so if we
look at this visualization of the data
you can see dark patches and light
patches the dark patches are higher
frequency and the lighter patches
obviously or lower frequency so Leo's
here at 11 okay and you heard it so okay
we've made another step we can take text
to binary and encode it in a waveform by
shifting the frequency using the
oscillator node over time sweet so the
fun part comes next which is data
extraction so I drew a perfect wave form
for you guys so you can get a sense of
what we're working with this is the hard
part because we have this waveform but
how does this relate to binary data
because I just see a waveform well
remember those words that I said before
a bin word it's weird so we have our
bits 0 1 great and we know that we're
sending at a certain baud rate which is
bits per second and we know how many
bins that we get per second and so we
can take our bins which come from the
script processor node and we can combine
them together okay okay the sum of these
bin bins or sum is equal to a single bit
and then that bit is 0 or 1 now we can
pass those zeros and ones tour decoding
and then we're good all right with me
still or good okay so how do we get from
a wave to frequency intensity so we have
these bins and I don't know how to tell
you what frequency is happening inside
of those bins so I went to Wikipedia and
I searched and then I was scared so
there's this cool algorithm that this
guy made that was on the Manhattan
Project he's like hey this is an
algorithm for extracting a single
frequency it's called the gorse Hill
algorithm and all it does is you tell it
what frequency you're looking for and it
tells you how intense that frequency is
that's it and it was made to run on low
powered system so I'm like yes perfect
for JavaScript and so any web body of
people out there right now our audio
people might be like well you should
have just used the baseband filter with
a high Q value and I'd be like you're
right I should have and I tried it
except for it was too it was not
specific enough basically so I need
something really fine grained and so I
had to implement my own so gorzil you
didn't understand what i said it allows
us to attract a single target frequency
intensity over time so we have our bins
we know that they relate to a bit we
know that the bins if the frequency is
high is a one and if it's low it's a
zero all right so we're going to look
for the occurrence of our high frequency
and if it's not there we're going to
assume it's a zero perfect so I do
another great picture for you gorzil
results in something like this we have
our waveform we run over chunks of the
wave and we get these purple circles low
or high and from there you can almost
say that okay this is a zero this is a 1
this is a 0 this is 1 then we get this
weird like bleed through and it's like
what is this a 0 or 1 i'm not sure so
it's still not working at and i was
really
add so we want to get this analysis to
as close as binary as possible so I did
some more googling and I came across
this thing called a Hamming window or a
windowing function so since the audio
that we're analyzing is non periodic we
get spectrally leakage I mean obviously
come on so by applying a Hamming window
we're able to remove noise and loeb
leakage because like can't we have in
any of those lobes in our audio and we
use a Fourier transform and then it
works is okay cool so really it was like
a formula and it sort of made it all
work I was happy about okay so let's
look at what happens when we look at the
frequency intensity of our audience cool
let me run it again okay that looks
better so the red is our high bits and
you heard that lead in the high and then
leaving at the end those are our marks
and our squawk which is our data happens
in between and you can see that we have
this nice gap in between so 01 perfect
so now we just need to take one more
step of course one more step
so let's put it all together I'm gonna
send this out 300 baud some crazy okay
that one didn't work what's wrong with
up still got some there we go great okay
so it worked so I'm sending text
encoding it in audio getting that audio
decoding it while getting it out of the
waveform and then decoding the binary
and putting that back to text on the
strip on the screen and it works so
pretty cool so obviously that was too
easy come on so what if there was noise
on the line like a telephone your mom
would pick up the phone when you were
connected to battle mat and you were
like doing great and warcraft to and
you're like mom you'll pick up the phone
and then your connection dropping you
lawson's like yes so we gotta handle
that noise online ok but remember
remember that gorgeous will fill court
cyl you thing yeah we could extract
single frequencies and it ignored
everything else in that Loeb spectral
stuff I think we're going to be okay
let's see so what this is that I've made
some noise on the line you'll hear okay
so we got a little issue here so Web
Audio is a little flaky sometimes
believe it or not specially doing this
hey okay that's better so if I so what
you're seeing here is some of this
random noise is interfering with our
with our signal the frequency is
matching up but at the same time we're
still able to reconstruct quite a bit of
the information so with some more
advanced methods to look at the data
reconstructing it would become trivial I
was running one more time because it
works sometimes I promise oh okay who
cares
alright so we're at 300 baud now works
pretty well what if we wanted more speed
because 300 baht is incredibly slow well
of course we can multiplex it and so
multiplexing in our cases we're actually
stacking the frequencies on top so I
have one oscillator that's or one
Hightown that's at 2200 hurts and
another one at three thousand Hertz and
then another on it so on and so forth so
at 300 baud with to multiplexer is we
can go 600 baud and that sounds like a
good number let's try that sweet it
worked all right let's be crazy let's go
up to like 1200 baud maybe okay still
okay there we go that's better alright
so still good that's 1200 uh yeah let's
go little bit faster let's have eight
multiplexers so hey all right cool so we
we are cruising 2400 baud alright so all
this basically showed you this is how
modems work and I made it work in the
browser works alright but what's
interesting to think is how our Wi-Fi
works and how bluetooth works doesn't
use frequency modulation uses phase
modulation but it's the exact same
concepts obviously their algorithms are
way better than what mine are and things
work a lot better but the same
principles apply so we take this concept
that was originally invented in 1830s
and we can trace it all the way up to
modern day and how this is all working
right now so like okay well obviously
that was so boring you need to do more
so like what else could we do well air
gap communication with this actually
works Google actually came out with
something the other day called Google
tone and I was like ah really but
they're using this private capi that
they didn't tell anyone about so they're
actually offloading it to Hardware more
than I am so it's cool but this code
actually works which is nice but imagine
this like imagine you had a modem
running on your browser and someone's
like hey I wrote a better version of the
firmware for your modem they could just
send you a JavaScript payload and you
could dynamically reload your modem like
the actual firmware on your modem which
is kind of crazy to think about or you
know like why not use WebRTC so all
ideas things that maybe I'll do some day
so all this code is online if you want
yeah hopefully this shows like what's
possible in JavaScript and how we can
step back in history and kind of
understand where the things that we take
you take for granted have come from
which i think is cool so thank you for
listening to me</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>