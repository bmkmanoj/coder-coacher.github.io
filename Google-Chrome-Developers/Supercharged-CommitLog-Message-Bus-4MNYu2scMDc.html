<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Supercharged CommitLog: Message Bus | Coder Coacher - Coaching Coders</title><meta content="Supercharged CommitLog: Message Bus - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Supercharged CommitLog: Message Bus</b></h2><h5 class="post__date">2018-04-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4MNYu2scMDc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so this time I want to talk about the
message bus it's something that builds
but you might be asking yourself why do
we need a message bus or Surma what
actually is a message bus that's what I
want to figure out today so a message
bus is something that I have seen game
developers use to write more decoupled
code and I looked at it and I thought
this could work really well on the web
and so I gave it a try and it turned out
to be quite effective so let's talk
about how a message bus actually works
so the message bus is basically an
entity in your system I implemented
using a class but it could also just be
a standalone function and it offers two
methods one of them is subscribe and the
other method is called dispatch if you
call subscribe you can say that you're
interested in messages of a certain type
with dispatch you can publish a message
on something is called a topic or a
channel and if you do that all
subscribers on the same channel are
gonna get a copy of that message so if
you look at this you might think that
this sounds somewhat familiar because it
is a very similar concept to events so
why did I reinvent the wheel instead of
reusing events and the answer here is
that events are mostly tied to Dom
elements which is something with a
visual representation this however is a
purely architectural element and it
didn't really make sense to me to tie
that to a visual elements I wanted this
to also work in a node.js environment if
I needed to and I know Jess we don't
really have a Dom so I wanted to write
it from scratch instead so that can work
in both notes yes and on the web so when
do we use our message bus I want to talk
about two examples and the first one is
the ruler that we built in the last
episode of commit lock if you remember
the rotor intercepts clicks onto links
and turns them into these really nice
transitions from the main page to
post and vice-versa and now like with
every blog post we have some analytics
module installed so we can see if our
users are actually interested in the
content how long they spend reading it
but also since we now have a ruler and
basically have a single page application
analytics doesn't actually know when the
user went from one blog post to the next
one because there is no actual
navigation happening so one thing we
could do is to load the analytics module
as a dependency of our Ruta and whenever
a navigation happens we could tell
analytics about that but it would be
much better and much preferable if these
two modules didn't know anything about
each other and this is exactly what the
message bus comes into play if we look
at the code of our navigate function in
the router you can see that at the very
last step we publish a navigate message
on to the message bus and that means
that every module in our entire app can
subscribe to the navigate event if
they're interested once the user
switches to a new blog post so if we now
look at the analytics module you can see
it's the normal Google Analytics snippet
thing but the last couple of lines we
subscribe to our message bus to the
navigate channel and whenever a message
comes in we tell Google Analytics that
the URL has changed and that the view
counter should be increased by one and
that means we are now tracking views
correctly even if it is a single page
application without these two modules
knowing anything about each other so the
advantage here is that now the Rueter
and analytics can load completely
independently the router can come first
and whenever any of the other modules
load they will just start working
together as soon as they can without you
having to do any kind of linking them up
now I promised you a second use case but
that second use case actually involves
serviceworker so I'm gonna wait with
that until the next episode where we are
finally going to talk about how we make
this block work offline so if you're
interested in that you should click the
subscribe button so we get a
notification when the next video comes
out and I will expect to see you here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>