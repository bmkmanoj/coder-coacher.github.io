<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building and deploying a Progressive Web App at scale with Flipkart (Chrome Dev Summit 2015) | Coder Coacher - Coaching Coders</title><meta content="Building and deploying a Progressive Web App at scale with Flipkart (Chrome Dev Summit 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building and deploying a Progressive Web App at scale with Flipkart (Chrome Dev Summit 2015)</b></h2><h5 class="post__date">2015-11-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/StdKz32M1RM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">graphing everyone we are excited to be
in this conference in fact this is one
of the best conferences we've ever been
to not many times your work gets
showcased in the keynote so and on top
and to add to it incredible audience I
mean everybody we ran into yesterday and
today had so much stuff to tell us about
Flipkart Lite all the positive feedback
we got thank you thank you so much we're
really honored to be here in fact there
was so much stuff on Twitter we were
actually spending all night to go
through all that stuff there's so much
stuff going on and especially the
feedback right I mean this is just the
beginning there's a long way for us to
go and a lot of feedback we were getting
it's incredible but truth be told it
wasn't an easy journey for us still here
as many of you know beginning of this
year we shut down a mobile site and we
kind of actually committed to one thing
and one thing only and that was like we
wanted to give the best experience on
mobile to our users the challenge is to
actually make this happen in a country
like India towel from heart our guest
today was giving out some astonishing
numbers about emerging markets in India
in particular like a typical device in
India is at least six times inferior to
a normal device you would find here in
terms of memory CPU storage on top of it
you have eighty-seven percent of your
internet users on 2g network if you
actually kind of put this together it's
almost impossible to give a compelling
experience on a mobile device and we
have one more challenge on top of it we
are an e-commerce application users
don't come to e-commerce application
every day so when they come to you you
better be getting their attention you
cannot afford it through dinosaur said
them this really God has started on a
completely different journey a journey
that we have never taken before in fact
it was such a soul-searching journey for
us we ended up with an awesome product
that we are very very proud of in fact
we have so proud of it I would not miss
an opportunity to show it every time
like in fact I was showing it to a lot
of you guys yesterday when whenever I
ran into you guys and I'm going to do it
one more time
I'm gonna show a video of how flip card
light actually works so okay there you
go so you fire it off from the homepage
that's like an a2 page there's a splash
screen you slide up the categories look
at how fluid the animations are
everything that expands this is actually
a live app I mean you're looking at a
live ecommerce app look at how fast the
products are loading in the search page
and this is actually coming from our
thirty million product catalog now the
product base almost loaded
instantaneously I mean all of this
actually happen in a matter of two to
three seconds this is incredible in fact
what I'm going to show you next is most
increase the most useful feature that we
build in Flipkart light we just switch
to offline mode and see what happened to
the app it is visually different to the
user it's not no longer showing the
dinosaurs the user is still able to do
whatever it he did in the last session
in fact if you look at all of these
products everything is grayed out except
the product he was actually browsing
last time so this is the offline
experience on Flipkart lite
there you go online and it's back up so
how do you get this you go to a flip
card gum on the latest Chrome or opera
browsers on your Android device add to
your home screen and boom
you don't have to install it or anything
that's it
I actually have a funny story to share
here when we were actually working on
this internally not many people in
Flipkart actually knew about it so when
I was actually showing this demo to our
leaders and all of the other flip stirs
I was actually showing them a so yeah
the colossal flip stairs I was actually
telling them hey here's the light app
that we were working on what do you
think oh it's cool it's it's fast it's
light yeah how do I get it I don't see
it on the Play Store oh you know you
won't get it on Play Store you just have
to go to browser and type in the URL and
this is after we shut down our mobile
site so everybody's jaws dropped oh this
is incredible so yeah I mean we've had
an exciting exciting journey and coming
up to where we are today but we
sincerely believe if behind every
product there is an incredible team to
make this happen and this product was no
different it was five engineers 42 days
and we got it
in fact I'm gonna ask couple of this
engineers to come up on stage today to
talk about what really happened in those
42 days when I know I I was getting
requests for too many Red Bulls but a
lot more happened than Red Bulls so I'm
gonna actually ask Jay to come up first
take us through what really happened and
thank you
good afternoon everyone I'm Jason Tosh
I'm part of a Flipkart team I work as a
UI engineer there so we are incredibly
excited to you know take you through
what our journey was what our
experiences where when we were building
this flick at light app so when we
before we shut down a mobile website
this is how the rough flow of the
application was so the browser fires
request to the web server which I know
in turn calls other API services gets
the data I mean it sends back a very fat
HTML and then from Syrian we load
further assets' this approach actually
worked for I mean no J's roses that we
had if you see like back in India we had
like about 60% that was coming from no
JS browsers supporting all of that was
difficult and all that but we wanted to
ensure that we wanted to give a very
good experience but the page load times
in this approach really suffered a lot
so we had to trash this approach out so
what we changed now so we thought
probably once the application is loaded
we can actually do a nice client-side
application of whenever I like on the
client side so for the first page load
you actually contact the web server get
the HTML bootstrap shell which loads up
your single page application then we
went ahead and added something called
service workers so this acted as a proxy
for further requests to API or push API
or CDN so we cache whatever we could and
yeah boom this gave us a lot of
advantage so a little more on the
client-side what we did we use react to
build a single page application
navigating through the various pages
with react router we also built a
lightweight flux implementation for all
for fetching beta for our application so
we built something called front-end Jas
so the github link for the library is
available in flipcard slash front end
yeah but still the first plain time
still suffered because we had to to load
up fully the single page application so
that it's intractable for the user it
still took a lot of time so what we
wanted to do was enter HTML page shells
how many of you I mean I think through
the dev summit you've heard a lot about
what page shells are what you can do so
we just go into a little more detail
about what we did for you know what
rendering our HTML page shells so we
divided our application into two states
one is the loading state which is for
before you even fetch the data you know
what your state can be so that is what
we call as the loading state then the
rest of the application moves on to the
loaded state which is after you fetch
all the data that you need so a typical
loading state would look something like
this so this actually like you can
actually give the user we shall cues in
to how the application will look like
once the data is fetched so you can
actually render whatever you need up
front and before I mean much easily than
after then only rendering after you
fetch all the data so if you move on so
how did we achieve these HTML page
shells one thing that we wanted to do
was minimize the server processing time
as much as possible so that meant we
wanted to do we wanted to generate this
HTML page shells upfront during build
time itself
so whatever J's
CSS images that you write for your
application we ran it through web pack
we generated bundles so once these
bundles are generated we process them
through another render cycle which
allows you to know generate the final
HTML page shells that you wanted in the
loading state because you can predict
what the loading state can be for each
of your pages and you can generate them
at Build time to give a little more idea
into what we call as pages in a single
page application is I mean you have a
lot of like logical pages in your
application and each of these can be
generated as a static page shell for you
to load them really fast so this is now
the new state of the application that
changed so during the first page load
you actually I mean when you load up
your single page app to load it you
first make server requests get the HTML
page shell back and this is something
with like very less processing time on
your web server I mean this is not like
generated at runtime so it's like we
were able to optimize a lot on that
front so once you get the page shell
back on the document it's ready for
rendering because you have all the HTML
that you need to put the loading State
on the browser and you also have to
fetch the data now to fully render the
application so we utilized service
workers we also utilized
worker to know once it's installed we
were able to fetch the rest of the
pictures that are there in that single
page application because what you loaded
up front was only the first page of your
single page application right we also
used service workers extensively to
fetch all our data endpoints I mean data
from our endpoints so be like if you see
the code a little you have like the API
endpoints that we call we we kind of
went with cache first strategy so you
can seize for most of them we have like
what is the force fast SWT fastest in
raishin for tool box to face the data
but yeah for fetching all the static
assets etc views like cash first just to
reiterate what cacheable HTML page
shells are like your page components are
rendered in the loading state up front
when you load the HTML immediately with
all the critical CSS in line so that it
will allow us we thought it will allow
us to get to the first paint time really
fast so once you load this loading State
now you have to fetch the data or you
can also utilize whatever data you are
pre fost using service workers and re
render your application this is one
thing that I want to bring to your
notice that in this kind of an execution
you can actually have partial rear
Enders compared to native world you can
so whenever the you need to change
something on the screen you need to
render every pixel of it so I mean
everything on your page on the native
web but here you can actually have a
partial read in disposable since we were
using react it allowed us to do so
another thing is we get too excited
about page shells we could go ahead and
generate lots and lots of facials if
your application is like really complex
I mean you could end up with a lot of
patience which when your prefetching
after your serviceworker is installed it
might you know consume a lot of
bandwidth for user so what we thought of
was maybe this is not the right approach
so what we did was you know if we
analyzed our product we went back we
analyzed like what are the product flows
so there are if you look at our
e-commerce product there is a face where
the user you know browsers from the
homepage searches for a product goes
under the product page and then goes on
to the checkout face and then completes
the payment flow there is another flow
called order management flow where he
can manage this order like the returns
and cancellations of his products we
also have like an account management
flow for the user if you analyze these
flows they are not
like very interconnected they are like
you can kind of say they are mutually
exclusive so there is not a lot of back
and forth between these flows so what we
did was we broke our application down
into these product flows which are
mutually exclusive and I mean instead of
going with a one big monolith single
page app what we did was I mean we broke
it down into smaller single page apps so
that way what it allowed us to do is we
were able to build and deploy this
separately we separated out the service
set of service that these are deployed
on and this gave us much more enough
freedom into you know pushing whatever
effects to only one set of servers and
not all of them at the same time since
we bundled them separately we when we
also decided that since all of the
single page applications behave in the
same way there is a possibility to share
whatever common libraries and unities
that you have like for example our
front-end JS implementation the react
library we were able to you know make it
all common for all the applications and
what was needed to make it work as a and
it almost made the whole application
work as and know kind of a big single
page app so what was sw-toolbox has this
another wonderful thing which which is
like it supports expressed J's style
routers routes so yeah so you can
actually model your application and you
can put in logic in your service worker
code to you know manage your routes of
your product flows in such a way that
you can actually whenever you needed an
app to app navigation of all your single
page apps it meant you only need to
download app specific files because you
had all I mean you can actually because
we had already pre fest and pre cached
the common libraries that were needed
for I know loading the single page
application so the results of what
here is like we actually tested on a 3G
connection first and after the page load
these were this I mean this was a time
line that we could achieve so we could
actually get to the first print in like
30 milliseconds time and that's and that
was something phenomenal and this way
like I mean we then went ahead and
tested it on 2g and wallah the results
didn't change we were able to achieve
the same pain first pain times as that
was possible in a faster connection 3G
or Wi-Fi so this was really like made us
really happy and this is where like the
power of service workers comes in for
you where even in flaky networks you can
actually load an application state for
the users a friend with really faster
times so I'll go ahead and hand over to
AB enough he's my fellow teammate he'll
walk you across the rest of the journey
that we had thank you hello everyone
introduce me my name is Evan Everest oh
we know I'm a UI engineer Flipkart in
the same team so yeah I think they
established yesterday that you guys are
pretty comfortable with British accents
let's see how it goes with Indian
accents we'll find out alright so the
first thing I want to talk about is the
active homescreen feature and how we
utilize it so it is a very important
feature you know and you are progressive
web app and especially for an e-commerce
channel like flip card it becomes very
important to reengage the user are very
easily with very less friction so when
we went native only when we were only
apps the app installs a very important
metric for us at all times how many
people are installing it was the current
active user base the same thing happened
when we went as a progressive web app
the Add to Home screen tends to be at
least it seems it is an important metric
because people who come from the home
screen tend to be you know it's easier
to convert those users
so at at to homescreen as we discussed
as it was being discussed yesterday has
a certain heuristic that the browser
implements before it allows the website
to show pop up to the the native browser
a pop up to Add to Home screen
which for a very good reason doesn't
happen on the first time now when a user
lands on our website Add to Home screen
is something that is a very new feature
and especially for an audience like like
the Indian audience we may need to we
realize we may need to train the users
of what this feature is and what are the
benefits and so for that what we did was
we created a first-time user experience
which trains the user what what Add to
Home screen brings to the table for him
so let me show you a quick demo of what
kind of a experience we built so this is
a loading State and this is the
experience that we build we give a brief
explanation of what Flipkart brings to
the web and this we give we tell the
user that it's just a tap away and this
is what you get when you add to the home
screen and it's dismissible and you use
you continue using the web site like you
would and it's only for the first-time
first wizard where anyway the new home
screen native pop-up will not show up in
any case but going further we again need
to prompt the user not prompt but we
need to give some way to the user to add
to home screen whenever he wishes to do
so for that this is what we did we add a
small we added a small active home
screen button at the corner which again
guides the user of how we can add to
homescreen manually so if you look at it
carefully to drag to get his attention
to the icon and again this happens only
once or twice in the first few visits we
shake the icon a little bit and we also
tap into the hardware access that we
have and we trigger and navigate a
vibration which immediately brings the
attention to something that is shaking
on the screen so the next thing I want
to talk about is the splash screen now
again this is a very cool new feature
which may
is it very difficult for a layman to
distinguish between a web app and a
native app so what happens is when you
add a you add your manifest you add your
theme colors and you know you add your
icons and text your splash screen shows
up well in good another thing what we
saw after this is that the splash screen
shows up which prevents the user from
seeing a blank page you immediately see
a splash screen and you go to the
application what happens after this is
some of our data still loading at least
on our homepage right so we added we
added another layer we added another
splash screams you could say or a
loading state for our home page which
triggers for both when you launch from
the home screen or when you directly
open from the browser and as you will
notice I will just play this this is the
native apps load this and this is what
we added over that so we tried to reuse
the same experience and but add a loader
over that and when it fades out the
experience is ready to use this gives a
very seamless experience to the user
there is no Jang there is no jumping of
content as it loads or things like that
another thing we talked about yesterday
was the custom navigation UI so Alex
pointed out yesterday that you need to
have a cust
you need to provide a u you need to
provide the user with some way of
navigating right so when you go to full
screen you lose the browser traits that
are there and the browser brings some
very useful features to the table it
brings you the I believe it it brings
the ability to go back for a user to
refresh to go to the home to go to your
home page and things like that so when
we go fullscreen we need to build this
and this is exactly what we added so as
you navigate across the app we have a
dynamic header which adds the back
buttons and home and search and things
like that right and it's dynamic okay
now we can customize it so across
different pages it behaves differently
so if you load a modal the same header
can show up close buttons and things
like that now as we've been talking
about serviceworkers quite a lot right
so let me also add a little more to it
so the next thing we
it was a great offline experience some
examples that we saw so far that if you
know if you go offline instead of
showing a dinosaur one thing we can do
is show a custom error page which at
least is the user that you know we know
what happened that you know something
went wrong we are not able to access the
Internet we went a step ahead and as we
showed you in the demo earlier also we
built an experience that that is
delightful to experience so as you will
see here when you go offline now we are
just going to a pen mode to demo that we
change the color scheme of the
application which guides the user
without any annoying pop-ups or modal's
or you know popovers and things like
that or consistent banners that you are
offline looking on like in-your-face
error messages we avoid that and instead
we give a delightful experience no
matter what the situation is the next
thing I would like to talk about is what
we did with some hardware API is now
that we have good access to really good
hardware API is the first thing we
decided to do was try out geolocation
which gives us a very easy win we just
pick up we just the we are just one type
away for the users permission to access
his location and we are able to
accurately and easily predict how much
in how much time can we get a product or
is doorstep this makes it very easy and
delightful for the customer another
thing we did was added an easter egg so
the the API that we used here just to
give you a hint is the accelerometer API
I won't tell you what the Easter Egg is
but I will tell you how to trigger it on
the home page you can simply tap the
logo twice and you should see something
happening based on the extra meter data
you can try it out at flipkart.com
now with all while we are doing all this
we needed to make sure that we always
made sure that a performance was always
the first benchmark the the most
important feature of our application yes
we treated performance as a feature and
not a side-effect so we have been
talking since morning about rail right
and it really does help if you follow
these principles it really does work
the one I thought I want I won't I won't
go into the detail of all four but one
that I want to talk about is the
animations and yes since I'm talking
about animation I had to animate that so
the animation part of rail says that you
have to render each frame in under 16
milliseconds right so as some of you
might know there is a project called
project Ganesh which is name of an
Indian God but no this is so this is
something that allows a rationalization
to happen on the GPU what this brings to
the table is a lot of performance
benefits plus a lot of benefits in terms
of power consumption right so you enable
it we enabled it using us some hacks
like a meta tag which which enables EPA
rasterization for us and it gave us huge
amounts of performance benefits but
there are a lot of gotchas there right
it's not just easy sailing all the way
one thing that we figured I will give
you one example one thing that we
figured was that animating SVG's is
costly right so we figure that SVG's are
actually vectors right and right sizing
them on GPU gets quite costly sometimes
and it goes into a specific rendering
mode which currently with the current
technology is didn't give us equal
performance in all the phones so we say
so what we did right now is that we can
either remove those or we can you know
replace them with PNG s and one of
course the obvious thing is that you
pass 80 and transforms instead of height
within those kind of things so that you
avoid unnecessary layouts and paints
prefer compositing so here you will see
an example that this is a website this
is a web app which is able to give a
consistent 60 FPS performance on these
kind of animations across devices
because of these kind of optimizations
and here is some proof
all right um one last thing one more
thing that I want to touch upon is
security that we talked that Emily
talked about yesterday HTTPS is really a
baseline now we achieve the shiny green
lock as she said and we have to tell you
that it brings perceived security which
is very important in a country like
India and it also brings a very real
security benefit we implemented
end-to-end HTTPS and made sure that
there is no mixed content in any of our
pages this also gave us the benefit that
it is future friendly what I mean by
that is that I can think of at least two
use cases like for example we heard
yesterday the hardware API is because of
privacy reasons might become some
hardware ApS might become restricted to
HTTPS access only for example your
camera or your location we are ready for
that
and the second is HTTP two it can give
us great performance benefits and that
is on the cards for this very soon and
HTTP allows us to proceed on that
without hindrance
we also heard yesterday about content
security policy which allows us to set
up a specific response header which
tells the browser to very specifically
allow only certain certain types of
assets to be loaded from certain types
of domains so the simplest form of a CSP
is that you just give a default SRC and
that's it it works but for a complex
website it might be that you have a
variety of different domain origins for
your different kinds of content so you
can configure all of them separately all
right so this covers a lot of the basic
stuff a lot of the modern web
technologies that we are using in
Flipkart Lite but this is not the end of
the story this is just the very
beginning we are just getting started we
are deeply committed to the open web and
we would like to see this on all modern
browsers and definitely giving the same
experience across all modern browsers so
currently what you see is the minimal
experience it's just the quick buy flow
that the user is able to open the
website search for a product and buy it
right and the rest of the page is like
your accounts and your orders and things
like that which are of course necessary
we want to add a lot more things we want
to enable things like push notifications
which brings users back with and we can
tempt them with great offers as and when
needed with this I will hand it back to
OMA I don't know what was harder doing
all of this in 42 days or talking about
in 30 minutes
well yes like Amina said we are excited
about what's yet to happen in in this
space and we are deeply committed to
this I would actually like to take a
moment to call upon the awesome Flipkart
light team guys please
so those are the five engineers is our
engineering manager and product manager
so thank you guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>