<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>From AMP to PWA - the best of both worlds (Chrome Dev Summit 2016) | Coder Coacher - Coaching Coders</title><meta content="From AMP to PWA - the best of both worlds (Chrome Dev Summit 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>From AMP to PWA - the best of both worlds (Chrome Dev Summit 2016)</b></h2><h5 class="post__date">2016-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/M_ZCgbEGyHY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah my name is Paul I work on amp and
I'm also on a deaf rail team at Google
and I'm really gonna skip that mostly
right I mean unless you literally just
arrived you've heard about progressive
web apps they help you turn your site
into reliable fast and engaging engaging
experience but what if you built the
most amazing progressive web app and
nobody discovers it I doesn't wait long
enough until the service worker has
installed your app shell to make
subsequent load snappy keep in mind that
the serviceworker is awesome
but doesn't help at all with the first
load even though the serviceworker api
allows you to cache away all of the
site's assets for an almost instant
subsequent load like when meeting
someone new it's really about the first
impression that matters
the first load takes more than three
seconds then our latest double-click
study has shown that more than 53
percent of all users will drop off so
half of your audience will never ever
get to see your content now in three
seconds let's be real it is an already
brutal target on mobile connections that
often average around 300 milliseconds
latency and come with other constraints
such as limited bandwidth and
establishing a signal and so you might
be left with a total load performance
budget of less than a second to actually
do the things you meant to do to not
initialize your site or app but don't
worry it gets worse
by the way you really want to load in
under one second
says rail the rag net number itself from
a book and usability by Jakob Nielsen
aside does more than seas round trips to
server well sorry you probably failed so
don't feel too bad though the oval
landscape of today's web looks a lot
grimmer the average mobile page loads in
about 19 seconds with 77% of those
taking more than 10 seconds to load now
the crazy thing about the 10-second mark
is that
at ten seconds actually a hundred
percent of all your users pounds so at
ten seconds no one would ever get to see
your site and then it's 214 so ever
requests of 50% of which are at related
requests so at first click that first
impression is what matters we wanted to
get rid of slow loading pages but also
solve runtime performance so you can
scroll really efficiently and other
usability issues at the same time and
fortunately we have a solution for it or
we think we have solution for it we call
it accelerated mobile pages am short for
accelerated mobile pages is an ecosystem
consisting of a web components library
but allows you to declaratively write
HTML we call em HTML because it's both a
superset and a subset and amp caches
basically see the ends are more
technically correct reverse proxies next
accelerate the delivery on top of that
and then so you can do it in two ways
actually you can you can either just
build one you know use amp like a
library build just one page and you have
one canonical page for everything or you
can use a link Meditec in the header and
then just generate two pages and your
CMS and create one HTML page and one amp
HML page but that's really up to you
whatever you prefer in a nutshell it
turns other pages into a highly portable
fast and user-friendly units that
platforms then like Google Bing or
Pinterest can safely and quickly embed
and so it's a really rich and growing
library of web components now a lot of
the bait in performance optimizations
you could probably do yourself if you're
an experienced developer but the amp
cash onto itself is actually a very
important component not just because
it's a free super-fast CDN the am cache
works tightly together with the
paralyzed loading and Static layout
system of amp document served from the
amp cars are much cheaper to pre-render
because em
where each page element is positioned
even before any assets are loaded so
allowing you to float the first viewport
without any low priority third-party
stuff and the actual site owner won't
ever know about the preload which is
another very interesting point super
important for privacy reasons as the
site could otherwise write cookies and
mark the pages scene you know if you're
searching for diarrhea on Google you
might not want everyone every of those
pages to actually write a cookie on your
behalf and and give you diarrhea that's
everywhere sorry for putting that image
in your hat by the way
so amp pages are really just html/css
there's no you can't have any user
author jobs with on the page that's one
limitation instead a lot of custom
elements and sandbox iframes allow you
to still do everything if you want to do
something like a you know crazy animated
craft or something that is really custom
to your page and in the amp open source
library is the same everywhere so it's
just one it's hosted on one CD on Earl
and and you include it from there and
that means it's evergreen it's highly
cacheable we can upgrade all amp pages
unless you know then a couple days a
couple hours maybe even if we have a
important fixed view and it defines the
behaviors for those custom elements and
manages rendering and resource loading
to optimize performance now the
important question that you might you
might it might come up in your head is
do you want to go amp or PWA you know
you learned a lot about progressive web
has already in the last couple sessions
and we've been hearing that question
constantly but in order to be reliably
fast you need to live with some
constraints when implementing amp pages
so you want to go amp you won't get the
biggest progressive web benefits and I
first click write as your so from the
progressive web app you won't get that
first click experience but with amp you
don't have a custom serviceworker when
it's loaded on your ham cache so you
can't do anything fancy in there it
means no post not much push
notifications no web app manifest when
served from the cache and so if
something isn't available as a component
you can't just hack a script together
for instance to support web payments or
push notifications now those of you that
already read about the individual
advantages and disadvantages of
progressive web app versus amp have
surely struggled with this question
before and on one hand now you have
instant delivery almost instant delivery
optimized discovery but then again no
user scripts and mostly for static
content on the other hand you have
and the PWI side you have advanced
platform features of course you can
build everything you want really highly
dynamic but it's a slow first i'll live
delivery and really again the first
delivery is highly important and it's
not easily embedded in into party
platforms as well as amp so what if
there was a way to combine us two to
really reap the benefits from both in
the end what what I think is what
matters is the you the journey the first
hop to your sites you feel almost
instant and the browsing experience
should get more and more engaging
afterwards
now amp and progressive web are both
critical components to make that happen
mmm pages for the first navigation and
then your progressive web app for the
onward journey now let's first talk
about amp s progressive web app because
I won't cover this in detail in this
talk but it's important to note that
many sites won't ever need things out of
the boundaries of amp m pi example.com
for instance which is an examples page
that the amp team uses to showcase a lot
of M components it's both an amp page
and a progressive web app at the same
time so it has a serviceworker therefore
allows offline access and more and it
has a manifest prompting the add to
homescreen banner now you might have
heard me saying well you can't have
those things but that only means you
can't have those things in amp when it's
just from the amp cache meaning the
first time you might click on it on a
platform like Google search you won't
get those benefits but the next time you
click out you actually get it so once
you arrive on the origin the service
worker installs and does a lot of fancy
things so when a user visits and by
example that come from search then
clicks on another link on that site you
navigate away from the amp cache to the
origin the site still uses the amp
library of course but since it now lives
on the origin can use the serviceworker
prompt to install etc and by example
uses that technique to do just that but
i had some fun and projector or at least
on a local branch i thought what if you
we have a service worker intercepting we
insert more random stuff into page
how about things I mean we can pretty
much do everything we wanted at sech
event right
how about things that amp doesn't like
because the cache does doesn't see the
service work it doesn't really care
about the service worker so we're gonna
pretty much everything we want so I got
a little nostalgic I'm like hey why not
throw in some 90s dhtml magic
I found this fancy cursor that I think
improves my page so here we go yeah we
use the service which panel I reload the
page and yes I got a JavaScript and he
made it backdrop I had a really fancy
cursor and I think it dramatically
improves the experience of our
documentation pages the first gig got
what have I done second please don't do
this at home but it's it's a technique
that allows you to make amendments you
know change what you can do on the home
page just insert more stuff so now more
interesting they're transitioning a user
smoothly from an page to progressive web
app there are two ways I'm combining
two-step steps I Percy call amped up and
amp down amp up is the background
bootstrapping of your progressive web
app shell while the users enjoying your
ham pitch and I'm down describes reusing
amp pages as a data source for your
progressive web app the basics with em
up are that the first click will be an
amp page usually served from the amp
cache and in any links on that page will
navigate to your progressive web app so
normally that second click would still
be constantly slower than the instant
feeling pre-loaded first click on your
home page but it's a powerful component
bacon bacon to amp the amp in-store
service work attack that without writing
any custom JavaScript allows you to
install your serviceworker for your
origin so yes even when your amp page is
served from the amp cache
it insults the service worker from your
origin downloads an app shell and
bootstraps your progressive web app
which means at the time the user reads
your article your progressive web app is
already loaded and ready to go and the
Washington Post actually does this I
mean while the users reading your
article yeah actually I just said that I
can warm up so it's working warm up in
precache when I use it now click on any
link on a page or call to action at the
bottom your progressive web app shows up
instantly and Alex Russell call it this
pattern start fast stay fast this is
what I call amp up but now you're in the
progressive web app and chances are most
of our using most of you are using some
HX driven navigation that fetches
content via JSON or some other data
backend now you can certainly do that
but now you have this crazy
infrastructure needs so you have two
totally different backends one
generating amp pages and one offering a
JSON based API for your progressive web
app but think for a second what amp
really is it's not just a website it's
designed as an ultraportable
content unit it's also a data format the
Ann team has asked themselves the
logical next question what if you could
dramatically simplify back and
complexity by ditching the additional
JSON API and instead reusing amp as a
data format for our progressive web app
we started with a proof-of-concept many
months ago and iterated on it for a
while to see if this pattern actually
works rewriting many parts of amp to
make that reality so how did we do it
well of course one easy model would be
to simply low amp pages in frames but
iframes are slow and now you need to
recompile and reinitialize the amp like
radium JavaScript library over and over
today is cutting edge web - the
technology offers a better way for that
and it's called shadow Dom in the old
world our world view was simple one
window one instance of the amp library
in one document but in that new world
there's one window one instance of the
amp library and multiple documents
so this results in superfast transitions
between amp documents as the live free
only needs to be compiled once so you
only got the one
amp blood library compile once the
process looks like this the progressive
web hijacks navigation clicks then
doesn't Ajax requests to fetch the
requested additional amp page and puts
the content into a new channel route and
tells the main my Bri hey I have a new
document for you check it out and do is
does that by calling as Hat shadow dark
on on the runtime the runtime which is
what we call the amp library so even
cooler we have added a conditional CSS
class on shadowed amp document so you
can automatically hide stuff like
headers in embedded mode so the am
shadow class does that and shadow slots
which is coming pretty soon allows you
to insert advanced widgets and
functionality into your pages that live
in the shadow root in your preview a and
so of course you can do that last step
and the step here so you can insert and
remove things also manually because it's
really your xhr call by just rec seeing
the source of the amp page like i
previous shows what the service worker
sample but the keys that the above is
really easy for everyone and the classes
also makes it super super simple and so
is something finally after amp up and
amp town is like am sideways up down
whatever Konami code right so time for
an advanced pattern to wrap this all
wrap this pattern up so we have a pretty
good experience now but if you're in the
progressive web app copy a link and
share it on Twitter that link will open
the progressive web app directly right
because you you're not on a nine patch
anymore and for a new user who doesn't
have a warmed up serviceworker precache
it won't feel instant so that problem is
also a problem we can solve and the
final step of our development journey
instead is instead of creating a
separate world space for the progressive
web app so for instance PWA dot your
domain comm
like we did before
we just reuse the existing amperes to
load the progressive web app on your
site's origin and so we're doing that by
having the serviceworker simply
intercept the navigation request all we
need to do for this is listen for that
navigation request in the serviceworker
and then instead of serving a cached amp
page we serve the cached PWA shell which
then does an xhr to fetch the requested
amp doc this means that in just one
request your progressive web app will
show up along with the requested content
so you got one amp
one progressive web app and one request
now best of all we now progressively
enhance our amp pages with our
progressive web app ensuring that no
matter what you users we get a
super-fast experience regardless of em
or PWA but browsers that do not support
serviceworker they simply c amp pages
and even here if you don't if you think
well I still want my progressive web app
even though it might not have all the
bells and whistles to work on browsers
that don't support serviceworker and we
have solution for that too we have
something we call fallback or rewriting
that literally just landed this week in
in the latest cannery version which is
sort of our beta channel for amp and it
means that if you arrive on an AM page
with a non serviceworker browser we
would realize that in amp and rewrite
all URLs or outgoing urls on your page
by pattern matching based on a pattern
that you can select to redirect your
fallback pw8 row so you can have four
process of support it you just use one
Earl space but in browser that don't
support it will still go to the
progressive web app and we even load an
hidden iframe that warms up the browser
cache right it's not as good as having a
serviceworker but it's still better than
nothing and so now we have it's time for
demos but this is actually one demo that
the amp team is built and it's a pretty
cool react based demo for you all to try
out and get inspired but I'm not gonna
go talk too much about it
because I thought it'd be even cooler to
show you a real world example
in fact the first real-world example
that we know of and that's Mike who've
done a heroic effort in the last week's
to get this to its current state please
welcome David Bjorklund lead engineer of
Mike to show you the new progressive web
amp experience a lesson learned on the
way hi everyone Karimi yes awesome
so let's go to the demo yeah so I wanted
to start with loading the Lybian article
so this is an amp article as you can see
in the in the source code on there on
the right side we're using the the amp
tags tags so if you would what come from
start for example this would be the
instant experience this one I used to
sees when they come to this site for the
first time we didn't ever been here
before bit before so let's go here and
navigate to to the menu so I don't know
if you noticed what happened here but
when we loaded the menu we actually
reloaded the page because we want to
take you from our amp article to our PWA
as quick as possible and in this case
since we've loaded the serviceworker in
the background on the amp page it has
loaded all the data that I would need to
show the PWA and since we share into
your URL space the URL is still the same
so we now we're now in PWA so I don't
want to talk like briefly about how we
built this so we set up to do like a
proof of concept we give herself two
weeks and we had three engineers that
could work on this and as part of the
team we talked we knew of PWA like we've
seen the videos we had a couple of
articles but we didn't have any like
handles hands-on experience on doing PWA
but since we could reuse our existing
amp rendering pipeline unchanged that
really like jump-started our amp journey
like it was just a few days in into the
work that we could like we could start
working with the fun stuff just I reckon
about the serviceworker we start working
all these peel away features
because we had already am stuff in place
that means the bantha we had time to
work on on performance improvement so
like we did what a lot of others have
talked about today like we made sure
that our JavaScript bundler was as small
as possible but it's also also made us
gave us time to like experiment the play
around a little bit with Eurex
improvements like the menu that I showed
earlier what we do is like this is this
reload and it also gave us time to like
really dig in and try to like learn as
much as possible about the serviceworker
so we could like we could feel that we
could come closer to something as a
perfect cache and yeah as I said earlier
it gave us time to implement web push
and like didn't end up the time frame
that we had with useless we had we'd
never would have time to do any of this
if it hadn't been because of the
simplicity that empty empty
embedding amp in PWA gave us so I when I
when I did the slides paul asked me to
like be honest with you and talk about
the pain points so I went to route
through and I tried to do a list and I
talked with my team and we talked about
like what has this how has this
experience been but like it was actually
sweet like it worked it worked as
advertised like of course we had certain
pain points doing PWA but like everyone
that's that's what we've been talking
about for the last few days when it
comes to actually embedding the
embedding amped inside of the PWB I just
worked at advertising no test with that
Paul I'd like to bring our Paul again so
you can prep
so wrap up now there you got it we
successfully combined em with a
progressive web app another user always
gets a fast experience no matter what
the site is progressively enhanced
you have less back and complexity
because you just have one data source
and profit from the building performance
of amp everywhere even than your
progressive web app and that really
reduces the overall investment now
before I leave you keep in mind that
this is just one pattern to build site I
want work for everyone
you probably shouldn't build the next
airhorn or Gmail with it but focus on
sites that have a lot of leaf nodes
individual sites with lots of static
content by all means find out if that
pattern is the right one for you and
feel free to get in touch to get to
discuss so check out our react based
demo check out better mic come to
actually see a live experience and also
learn more about progressive web apps in
a developers at Google at come slash web
and of course more about amp on am pork
and I really can't wait to see what
you've built thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>