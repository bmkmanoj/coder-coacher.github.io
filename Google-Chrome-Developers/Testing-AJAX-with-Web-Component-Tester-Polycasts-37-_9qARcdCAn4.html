<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Testing AJAX with Web Component Tester -- Polycasts #37 | Coder Coacher - Coaching Coders</title><meta content="Testing AJAX with Web Component Tester -- Polycasts #37 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Testing AJAX with Web Component Tester -- Polycasts #37</b></h2><h5 class="post__date">2015-12-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_9qARcdCAn4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey there polycasters rob here today on
the show we're gonna be looking at how
do you test elements that require Ajax
to talk to their back-end using a web
component tester that made no sense let
me back today on the show we're gonna be
continuing our series on web component
tester by looking at how to test
elements that require Ajax now if you go
check out the documentation for web
component tester you'll see up there at
the top there's a list of libraries that
come with web component tester itself so
we've got mocha that is our testing
framework we've got chai which is our
assertion library and we'll be talking
about that in a bit we've got a sink and
Lu - these are libraries they're just
sort of like utilities they help us do
things like manage callbacks and do
fancy functional stuff and lastly we've
got sin on and sin on is a little
library that lets you mock xhr requests
create fake servers do really anything
you'd want to do if you wanted to
simulate an actual server and rather
than like create some brand new
component or anything like that I'm just
gonna write unit tests for a
pre-existing element so I'm actually
gonna use one of the polymer teams
elements iron Ajax and I'm just gonna
write tests against that so that way I
don't have to come up with like a weird
contrived example because I'm lazy so
what would I do in my test file is start
off by importing iron Ajax and then I'm
gonna write a little test fixture for it
so inside this test fixture
I'm calling iron Ajax or I've got a
little iron Ajax tag I should say and
it's URL is set to responds to get with
JSON all right and then after that I'm
going to create the sweet that's gonna
hold all of my unit tests so I'm just
gonna call my sweet iron Ajax just so
it's kind of like a nice general thing
and I'm gonna create some global
variables in here these are just gonna
keep track of the iron Ajax tag of the
requesters we're sending it out of the
sent on server we're gonna set up
nothing too fancy here after that is
created I'm gonna call a setup function
and this is where I'm gonna go ahead and
start to build my sin on server so I'll
call sin on fake server create that's
gonna
an instance of the server and then I can
call this respond with method and what
that's gonna let me do is basically set
up routes that I want the fake server to
respond to so what I'm saying here is
when there's a get requests for the
route response to get with JSON I want
it to respond with a status code 200 I
want it just send back those response
headers that I created up at the top and
lastly I want to send back this little
JSON payload that says success true so
I've got that squared away next thing
I'm gonna do is create a little teardown
function and in this teardown function
I'm going to tell the server to restore
itself which basically means like clean
up after yourself you know if you if you
created global variables if there's any
shared state anything like that just get
rid of that so when we run the next test
it'll be a nice clean slate okay so I've
got that squared away now I can write
the suite that's actually gonna hold my
unit tests inside of here I will call a
setup function I'm going to grab my test
fixture and saw it in that Ajax variable
that I created and my first test here is
just going to verify that the iron Ajax
request is going out and that I'm
getting a response back and that the
data and that response looks correct the
test message is gonna be has seen
defaults that love you because it does
love you so my request object is going
to call Ajax generate request and then I
can just call server dot respond and
this is kind of one of the cool parts
about working with Centon normally you
would have to if this was like a real
server you'd have to wait some amount of
time set up an event listener do some
sort of like async test thing to get
that response here we can treat it like
it's synchronous and that's really nice
and means our tests are gonna be really
fast and after that I can use expect to
inspect the response object that I got
back now in the last video I used assert
to inspect my objects this time we're
using xpect and basically because we're
using chai we have a few different
assertion types that we can use a few
different assertion libraries if you
will I can go check out the
documentation for a try maybe I should
like clewd a link to that or something
expect just another flavor of assertion
really not too different what we're
doing here is we're first checking that
the responses Oh
okay and that means that it wasn't an
error it wasn't no we got something back
we're checking that it's an object right
that's what we're expecting to see and
lastly we're checking that the success
property is set to true okay this looks
okay to me let's switch over to the
terminal and we're gonna run the WCT
command all right things are happening
things are happening and we got our
chests back awesome all right
everything's green
good I want to do some more testing
though I want to test a post request so
I'm gonna create a brand new test
fixture and this time I'm again using an
iron Ajax element I'm sending the method
to post and the URL is response to post
with chaise longue just like we did for
the get request we will set up a route
in our sin on fake server so we're gonna
say that we wanted to listen for post
request on the route response to post
with JSON and when I hears that it
should send back a 200 same response
headers as last time and this time the
object it sends back is gonna say post
request is true over here on our test
I'll write a brand new suite mm-hm
for making simple post requests the
first test I'm actually just going to
verify that when I set that method to
post that that is actually setting the
xhr method so I'm not even calling sin
on here I'm just verifying that under
the hood the element does what it
expects after that I'm going to go ahead
and actually ping the sent on server now
I'm going to test that the response is
okay I'm going to test that it is an
object and why don't you test that post
success is equal to true right let's
switch over to our terminal we will run
web component tester and we will wait
waiting on things to happen great so
we've got all of our tests are passing
everything's green
now what if those tests weren't passing
them what if one of them would failed
what if it was just like one browser
that failed or something weird like that
what would we do this is where I'm going
to show you a little trick here when we
run the web component tester command we
can actually pass
the - PFLAG and what this is gonna do is
it's going to leave all the browser
windows open and this is really useful
because it means we can open up the
console for those different browsers we
can inspect them and if there were
errors they're gonna show up there so
here I've got Firefox I'm gonna zoom in
I'm gonna open the Firefox dev tools so
I'm going to enhance this and you'll see
that I've got my tests listed here but
if there were any errors they would show
up there as well so pretty pretty
helpful little feature there all right
that covers testing with Ajax with sin
on there's actually a lot more you can
do with sin on but I've definitely given
you enough to get started there's a lot
more that I want to cover with web
component tester though so if there's
segments that you are interested in
seeing please leave a comment down below
that way we can try and make some of
those episodes happen also consider
clicking that like button or the
subscribe button if you truly love me
and if you have some questions you can
ping us on a social network of your
choosing at hashtag ask polymer as
always thank you so much for watching
I'll see you next time turn your phone's
off Gotham needs me</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>