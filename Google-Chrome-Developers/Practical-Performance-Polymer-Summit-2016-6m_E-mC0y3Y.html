<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Practical Performance (Polymer Summit 2016) | Coder Coacher - Coaching Coders</title><meta content="Practical Performance (Polymer Summit 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Practical Performance (Polymer Summit 2016)</b></h2><h5 class="post__date">2016-10-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6m_E-mC0y3Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone I'm Sam and Paul we're
talking about performance and we're
gonna reconsider kind of how we fix poor
performance oh this is really timely for
me oh yeah because last week I was
looking at a website and it's like I
think my websites kind of slow sure just
feels weird and I wasn't sure what to do
to really fix that like bad load but so
I did the normal thing I think that we
all do we went to Google and I looked up
your email address okay sure you okay
that's fine and then I sent you a
message Paul I need your help
right and then you didn't respond yeah
that's rough but it's okay it's okay cuz
you know I was like I am going to fix
this myself
yep yeah so I went to Google again and I
typed thick slow page load time and I
got like all these results on Google
there was like these top 10 list top 5
there's a lot of things that I think we
all know this like when it comes to
performance
there's a million techniques and we kind
of keep them there in the back of our
mind these checklists and well it's hard
to know like what's effective or not so
actually we wanted to turn this into
something a little bit more interactive
turn it into a little game so we're
gonna play a game it's called fact or
fiction proof trials and my mom yeah
Mary practices oh yeah okay so we're
gonna play a game
it's called fact or fiction public
trials
so his name it's pretty good and you're
gonna participate like this you can go
to this in your browser your phone
laptop whatever and we're basically
gonna try out a few different Leino
techniques for just make it website
faster and we want to get your ID on if
what we're gonna what we're doing is
gonna be effective or not
yeah like is it gonna have a lot of
impact or not so you can just use the
slider they have on your phone and drag
it up or down
let's everybody just practice everyone
go up
it's like positive it worked I want to
go down there this is like like the wave
its signature okay cool alright so the
website that we're gonna be looking at
actually your mom's whoops I was website
so my mom is an author and I was
building a new website for her the
summer and it's just wordpress yeah yeah
it's a wordpress site like it's a it's a
really just like the kind of site that
you end up with like normally so just a
bunch of like plugins for for events and
things like this and but I didn't like
do any optimization to it yeah yeah and
so we're gonna take this as our baseline
site and see if we can make it faster
sure so let's just get a feel for what
this site is like when we load it yeah
so if we go into dev tools and we just
turn on 3G throttling to emulate what
it's like on your phone and yeah let's
just load it okay so that's going seems
I'm not terrible since I okay there's
real from Berlin there's an opportunity
opportunity that's what we like to call
it okay so I recorded it using the
network tab and it looks like our final
load event happens in around nine
seconds we send out 39 requests and this
is on again it's like a 3G network okay
okay that's where we're starting
somewhere sure so fixed number one that
I found on the Internet yep people seem
to think that bundling all of your
JavaScript together was a good idea hmm
so taking all your individual JavaScript
files sort of catting them together in
one file and then shipping that okay so
this is
just like all the scripts and you can
cut into one file pretty much yeah so
what does everyone think is this like
gonna be a improvement to our page load
time or gonna hurt it all right so I did
this and our load went nine seconds to
eleven point seven whoa whoa but this is
counting which is like less requesting
the good thing
yeah we're slowly requests we we made it
slower interesting and so we looked at
this some more and it turns out that
since we're shipping one JavaScript file
I'm like versus lots of individual ones
it sort of pushed out that initial pain
time right because you'll just have the
one big render blocking request and now
it's a very sizeable thing in the
download especially in a throttled
environment yeah it's not so good okay
so uh thumbs down on that one yeah
unfortunately fix number two you told me
about this one
add the defer action my script tag yeah
so differential Butte kind of like the
cousin the brother of the async
attribute a little different it does
basically the defer is essentially a
contract saying I'm not using document
right in this script but in addition to
that it allows the browser to continue
to parse HTML as it just continues on
the page and you usually end up with
like a faster thing and you guys think
it's like an improvement gonna help at
all with our load time it's climbing up
okay I'm gonna say people think it's an
improvement so what what what flat just
nine seconds okay that's but you know
the Internet has lots of lists and there
are more options for it okay great fix
number three group the style sheets
together in the head above script tags
so the idea is that you put your style
sheets above any script tags because the
browser can only send out like six
requests at a time yeah yeah yeah yeah
so like you wouldn't want to interleave
because style sheets are gonna be more
when it comes to like the rendering and
what things look like so if they're the
most important things you want them to
be the first things to start because if
there are a lot of requests like there
are 40 on this page then we're gonna hit
our maximum of six requests per hostname
ten requests total and then like all the
next requests get queues like I have the
spec reading to me right now it's
actually the this behavior of six and
ten is unspecified however all browsers
do implement the same way so today I
learned hmm thanks Paul right
there you go okay flat again flat
hmm seems like everyone kind of agrees
with us just like this doesn't really do
much yeah I mean was the like did the
load just change it anyway you know it
was interesting when I did this I sort
of saw this like flicker of like half
painted things and then it snapped in
again and so it definitely affected
something but our load time didn't
really move at all
Oh interesting yeah okay all right yeah
one more fix number four I really like
this one
minify our JavaScript and CSS classic so
use something like uglify and like a UI
compressor for our CSS and shrink the
file size and then send it down oh wow
people are reaction you're really
thinking this is good wow it's really
going up okay hmm I mean the gym yeah
it's good hey okay I worked and it did
something so we're down to seven point
six seconds on that load thumbs up
that's pretty solid
yeah yes and this is without any of the
other fixes we just minified the sources
so we're still shipping the same number
of files which is like 40 39 cool and it
dropped us like a lot it's good what if
we took all of them and we put them
together good question okay so all four
fixes at the same time like what do you
think effective I think we'll be more
effective than then fix for on its own
No
somewhat positive positive okay turns
out we basically hit the max when we did
the compression
yeah I like marginally better than the
minification that we're just looking at
yeah so it took like the best caseload
time that we had and shipped less
requests I mean we had an improvement
yeah and in fact before I move on this
is the end of the interaction okay the
screen cute I guess before someone
figures out how to console and start
doing loops real quick okay okay good so
we were using unload as like are just
measurement there are metric that word
is like for all those yeah right but you
also point like unload is kind of a
crude metric you were pointing out that
in the style sheet one you actually that
number didn't change but you saw things
we're rendering like starting a little
bit earlier even though it ended at the
same time right right so like there's
this question if we're really trying to
evaluate the load time like can we use
something a little bit better like can
we use better metrics than then unload
and so Sam and I have worked on a
project with some other folks called
lighthouse lighthouse does a lot of
things it does auditing for best
practices of web development and
especially around forgets of Web Apps
what else it does a nice job of
measurement and delivering high quality
performance metrics and so this is just
a screenshot of what lighthouse looks
like on the command line so it's
available just on the command line you
can run in continuous integration but
also in a Chrome extension and a node
battle like we use the node module okay
yeah so actually if you took the node
module and then just put like a little
charted module in front of it and a
little tool called PW metrics and so it
just passed a URL it runs it through a
lighthouse takes the numbers out plots
them and these are all like more
meaningful metrics for us when we're
trying to measure this page loading and
when it's interactive when it paints and
when a user can start to sort of use the
Site yes excellent exactly so we ran
this on the site with yet for and after
so top is before the baseline no changes
at all and the last one is
yeah yeah so you can see that we shrunk
that time to interactive which is
basically when the user can start using
your application
yeah and in this case the website so we
went 3900 milliseconds to 3300 so it's
faster
16% faster yeah it's not bad
that's yeah let's took some techniques
that we found online and we applied it
to this very specific site yeah we did
get some wins yeah totally
but also like just going through this I
just kind of wondered I'm looking at it
you know 16% like that feels good and
that's that's that's worth something but
also like how fast could it be like are
we anywhere near close to like bottoming
out at like the point of diminishing
returns or like plenty of her left and
so the way that we did this was we just
basically take these techniques that we
saw try them out see if it works reload
the page like seems faster maybe try
some more yeah yeah you keep stacking
and so I want to like think about what
if we could kind of invert that process
instead of just going right at it and
applying fixes kind of would it the fix
is the last part that we do so starting
in kind of the first place what you
really want to identify is the the user
perceivable effects now here we're
talking pretty much about just page load
right and just that kind of narrative of
going from a blank page to things on it
but we could be talking about scroll
input latency other interactions like
that
after that you want to kind of look at
what is happening identified that kind
of the critical path and figure out what
is the primary cost what is consuming
time from there you're gonna like
something looks interesting it looks
like there's some behavior that's a bit
optimized yeah like the cost is going to
be because of a reason so you're gonna
drill in and ideally you're gonna find
the reason why it's slow yeah and so the
reason why slow is is the root cause
this is the thing at that point that
point is a good time to try and apply
some fixes so we kind of just go through
the measuring and profiling diagnosing
identifying and then we attempt some
fixes and then a good place I like that
that's good like you measure your
profile ya know it's like MIT dia it's
like nip dia
nifty it's what lip-to-lip dia you
measure you profile you diagnose you
identify and you account oh you're
making it mithya nip nip dia
mitya it's the new framework for
performance diagnosis there was rail and
that was cool but that's so like 2015
sure mithya is so 2016 yeah totally
right you know people are shouting it I
hear it alright fine what Diskin alright
so first step in magic and mithya and
repetition you need to measure and
measuring is important because you don't
measure can't do the rest
yeah right so we're going to use this
really cool JavaScript API that's
shipping everywhere
performance mark and measure them and
what this is gonna let us do is actually
in our JavaScript code put these
performance marks so we'll be able to
say this is when I'm in San shading this
jQuery plug-in this is when this view
shows this is when I fetch the data and
this is how long it takes and like
requires a little bit of work and go in
instrument your code but it's really
useful to be able to talk about times
and durations and things in your terms
rather than the browser's terms and so
like we applied it on on the site and so
in addition to just getting the
information out in inclined side
JavaScript it also kind of augments the
chrome dev tools so in the timeline you
know you could kind of look at this
flame chart and like try and diagnose
what is actually happening here or it's
got a look up at your performance
measure because everything is kind of
labeled here yeah so I mean this is the
shows up right in dev tools which is
really handy when you're trying to
profile what exactly is taking a lot of
time so should we profile this it's good
to go all right all right so bring up
the site and we're going to go look at
it over in the timeline
they will keep on network delicate
profile shots good 3G networks still
enabled catches it easy yep reload when
you hit command are here it's gonna
reload and it's gonna wait until 3
seconds after the unload event fires and
then it will just stop recording
automatically but if you want you can
just stop yourself
protip Sam for you that's a nice one ok
so this is just the overall look of
everything that's happening it's a lot
of network requests yeah yeah exactly so
we've got a lot of network requests all
up in here the purple requests are style
sheets and these guys are scripts images
here those go out quite a ways and then
down here is the main thread here is
those marks good stuff so there's a
little bit of JavaScript activity down
here but yeah no reduction so we're
really looking at like when do we paint
something on the screen that's what we
want right exactly so okay first step
measure really so we can just drag this
and kind of see the film strip of
screenshots and the first paint is right
in here right when we get that painted
and then later images in two seconds yep
so we're not about two seconds here and
if I just kind of zoom to that area
all right down here main bread not doing
a whole lot it seems pretty empty which
is like confusing because usually you
see a lot of stuff there and that's
what's preventing the paint right in
this case we're not really doing much
JavaScript right now I will point out at
the end over here this stuff if I
actually just zoom in a bit
we do see a recalc recalc a layout green
guy okay that's not something I care
about and that isn't actually our first
paint and so that's our first paint
that's nice right there that's nice but
so it actually here's so what I want to
do at this point is make this being
happen sooner it seems like we should be
able to push that way back so it's not
at 2,600 milliseconds for our first
frame yep okay so optimized for Spain
yeah their goal now the thing is there
is actually a relationship between
what's happening
here and stuff up here check this up
it's kind of kind of cool so I'm just
holding down shift to get this little
selection but if we look at when this
paint happens what just finished Oh
jQuery yeah actually yeah so check it
out so jQuery that is sorry about that
wait so you you have like commits in
jQuery right yeah so it's basically your
fault
on your own website that's nice what
makes your he'll fix it yeah thanks okay
so so jQuery just does finish and
actually this is the reason why more the
concat never how can cut right lower I
imagine that like these all these other
scripts are also just tacked on so this
one request is much bigger right I like
that sound like that's what I imagine
that's the sound of the network it is
okay now the other thing I do want to
point out here is little tiny red
squares that's easily like it's
important yeah it's actually the network
priority and a medium higher highest
network priority is a pretty strong
indication that it is render blocking
now that's not like 107 at the time but
generally that rule works pretty well so
render blocking requests is exactly why
you can see like you know these images
not render blocking but pretty much
jQuery render blocking the paint can
render happens right wins solved jQuery
jQuery jQuery the last render blocking
request finished it's fine I know you're
trying to like push off the
responsibility but clearly it's Jacob
thank you okay so so right render
blocking resources and we don't want
them to be render blocking now it should
like make less things red exactly so now
that we've kind of figured out oh I know
where you're going yeah so actually
first thing that we want to do is take
the scripts make sure take all the
scripts make them not render blocking so
we're gonna my fix why yes the defer
attribute to all the scripts so sorry
yeah that's your awesome
now in addition to the script tags I'm
also going to apply it to do so
sorry what that's so nice of you I I
don't have to look up your email address
cuz I just have it right here now
thank you so much all right go ahead
sorry sorry I don't know why we didn't
catch this okay
snow sheets moving to the bottom so
we're gonna move them to the bottom and
actually this is pretty cool movies now
it's at the bottom kind of we've always
thought that like that might be better
if you don't if they're not super
important and since some of this
actually changed recently I'll explain a
little bit of what happens so previously
and previously especially in chrome this
is the behavior that would happen like
let's say response in HTML doing some
stuff we find some of these style sheets
in the body so we kicked those Network
requests off and basically we just wait
until all of them are done downloading
and when all of them are done
downloading then we do style layout and
paint that seems not great right because
these are we treat them out of it as
render blocking and we just don't do
anything so as of this summer chrome
changes behavior and actually falls in
line with the rest of the browsers so
the new behavior is if we find a sheets
in the body we will kind of like flush
what the page should look like at that
point and then also when they're done
we'll do it again okay so now it seems
like it's a good idea to put
non-critical CSS into your body yeah so
you get this win right so the browser
will be able to paint the page at that
point but also like as it moves forward
it'll pick and pick them up and apply
the rest seems good yeah so in this case
kind of what it looks like and there's a
lot going on here but at the top we have
these purple style sheets these are the
guys in the head now the scripts that we
applied defer to thank you these are now
green nice so they're down here and the
style sheets down here these ones are
the ones that I moved to the to the
bottom of the body they're down here so
check this out the paint that we were
looking at before it's right here and if
you look we have all these other style
sheets right now before we wait until
all of these finished and also these
scripts too but now like we're able to
get that first initial paint out much
sooner and then
the restaurant associates it seems like
a major win yeah this is good so pretty
good now that we went through this
process like a pretty good win and we go
back to measure yeah take another look
at just the overview so if we just took
a screenshot of the timeline in this
case and since we have those performance
mark and measure in there you sort of
get a feel for what's eating up the most
of your time and what's weird is the
slip nav it's like so like i zoomed into
this stack and it's actually taking my
phone 60 to 90 milliseconds to build
this and what this is is the navigation
element on the top yeah it's hidden by
default it's the yeah it's just the top
now it's just instantiate and some stuff
on the top nav which like shouldn't
really take 100 milliseconds seems
really weird right so that's that's
awful alarm bell and then you looked
into it so what's happening let's just
like go through it here so in my
timeline here what I can do is I can
zoom right in to where we're evaluating
this look nav which is all the way over
here and I know because I looked at it
before
above that work real quick yeah I know
by looking at it before that a lot of
work happens in this plugin visibility
hoggle oh look at that
yeah even like the forced layouts and
stuff yeah it's like a whole bunch of
work way down here how much there's oh
because it animates right after yeah it
animates I guess here yes weird I didn't
like to see an animation when it loaded
yeah neither let's look at the source
code um and like I know what this code
does is it just sort of hops into this
block here which is calling this slide
up right here and adding a class of
hidden so this is just the jQuery jQuery
slide up you know that holy
effect hmm so we should get a better
idea of what this feels like so what I
will do is we'll just put a breakpoint
right here and we'll reload the page
okay cool
and so here we are at our break point
and you can see that our menus actually
open here Oh hasn't been lit up yet so
here we are and let's just look at what
happening wait wait wait duration zero
so that's the first argument of jQuery
slide up is the duration yeah and
specimen zero zero but a zero and a
lengthen emission is like no animations
like display:none but yeah but he was
doing like 90 milliseconds of work yeah
like a whole bunch of it from the tweens
and yep and create jQuery deferred
objects but so but wouldn't there be
like like a fast path where they're like
okay if it's zero
we'll just like immediately hide it and
skip the whole life creating animation I
agree I agree seems like it would make a
lot of sense it doesn't so we're paying
the cost they're creating the tween
object yeah and then creating the jQuery
deferred wrapper to tell us when it's
done yeah and then animating it for zero
duration and then and then doing that
each time flowing every single time we
do this it's expensive okay so as you
would say there's an opportunity here to
make this a lot better there's an
opportunity so what we did is we just
switched it to display:none
if duration equals zero no basically fix
the entire problem so that was good
straightforward fix so yeah going
through this
identifying the height that slick nav
was it was pretty costly and was pushing
out this time to interactive because we
really want the main thread to settle
down so that when the user you know
starts to work with the site it's
available for them and we were able to
identify this because we had those
annotations made it really easy nice
stuff
so in total we did a few things in this
in this case the scripts and the styles
were moving them down those are the
images I didn't mention this they but
they were taking quite a while and so
just really basic compression and fixed
one the sizing of one really boring and
the top one did apply a link rel preload
to get that request going out really
really early lastly add that slick now
all right so we didn't do any like
bundling and it can catch any minifying
and didn't like figure out what else we
can remove from that site I'm sure that
all of these things would also have
impact
but going through this process like
these are actually are not the highest
impact things for the site right
so we should look at the results now do
it so this was before we did anything
first baseline yep
then this was after my fixes stuff
pretty nice that's good then these are
with the earth yeah so a few things to
point out the content pool paint that
first paint where there's actually stuff
on the screen that came in quite a bit
and a lot of that had to do with the the
defer and they sink and all that stuff
and also but the time to interactive
also slid in quite quite a bit yes we're
able to drop that a lot yeah we went
from 24 hundred milliseconds to 15
hundred milliseconds which is great
pretty good this is on a 3G connection
too yeah really good and then our time
to interactive went from 3900 to 2700
again really good feel solid about that
I mean still plenty of more opportunity
but it's a good place to start so okay
so in total a few things that we we are
left with applying just kind of generic
performance techniques blindly and just
gonna get seen like expect it's gonna
sometimes be better sometimes be worse
that bundle thing I mean I did not
expect that but really that made it a
lot worse and that's you know that seems
it's very common to do right so I always
just measure go through the process of
understanding the critical path and and
diagnose in that situation before you
get into the things that also the last
thing just use great metrics pretty long
to work into movie in one metric if it's
the wrong metric is is not gonna work
out well so use a nice use tools to help
you with good metrics you're missing one
I think the most important one really
listen yeah nip the appalled oh yeah
forget about okay yeah I like it
okay that's it thank you thank you guys
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>