<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Class-based Tree Shaking - HTTP203 | Coder Coacher - Coaching Coders</title><meta content="Class-based Tree Shaking - HTTP203 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Class-based Tree Shaking - HTTP203</b></h2><h5 class="post__date">2018-04-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lsd2-TCgHEs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm supposed to be me suppose to be
doing this now all right let's uh intro
okay excellent YouTube comments there
sadly a thing they are sadly a thing but
we have been listening to them some of
them the ones that actually have a point
well not all of them do there's some
good points that are being made you know
recently increasing so people have been
noticing my impending baldness that's
something that has been coming up in the
comments thank you for everyone who's
noticing me that I don't ever let you
finish a sentence is that being noticed
yes
oh whoa whoa could we talk about that in
a bit but one of the things I'm you know
we have noticed and listen to those
people saying let me talk about code can
we show some code yeah might be helpful
so it would be nice we fought like some
code so tree shaking oh let me guess
you're just doing this so we can put a
nice buzz word in the title yes you all
think you didn't know about tree shaking
oh yeah blow your mind class based tree
shaking so so here we go we've got we've
got a code example here I'm importing a
load of stuff plugging your own library
are we it is based on a true story like
all good stories are i importing a load
of stuff this file has a lot of stuff in
it
I'm only using two of them and like
modern tools like roll up and we're
porting the other ones well just to show
that they're there yes technically I
wouldn't have to import them I mean
commonly I guess you would import this
as import ID beaky ballot from like put
it all of them in an object so you have
you know no no you know you were that
good cuz it so in this though each of
these methods is individually exported
and that means that tools like roll-up
and wear black can go ah you're only
using two of these or free of these and
it goes well I'm just going to take the
ones you're not using and delete them
and it's tree-shaking and that's tree
shaking and that's good because the tool
can figure out what you're using because
if you don't import them you can't use
them then I set how mauryans work right
right so like in
the days where we would import jQuery
yeah you've got like 101 methods in your
own using three of them tough you were
taking the full weight of jQuery and
with trace shaking that's not true
cuz you're only using the stuff for you
actually import and use so yeah this is
great this works fine but I ran to this
problem so this is a library real
library and someone said well it's all
fine having you know set and get and all
of these things but I want to create my
own store with that doesn't clash with
another store I was like well I know how
this works so I made it happen and you
know I thought well it could be like
this right so they got no you're
importing a store
oh yeah that's like that the comment you
now wouldn't just how could a thing what
you have to instantiate the whole thing
first and it knows all of its stuff
about where the database connection is
and all of that and it can go but the
problem is classes can't be tree shook
and I'm sure that's the right way of
saying that oh so okay so you have a
class it's called store mm-hmm in the
constructor as we can see here it gets
the backing store name the IDB but it
call the store and ITB yeah objects and
then the class of it has all these
methods like get and set but also the
other ones we saw previously keys and
whatever there was yeah okay so but if
you don't use one of them ideally you
wouldn't load the code right but it's
not statically analyzable yeah same way
a function is so they you know here I'm
using dot keys but I'm not using like
the delete method I'm not using any
clear method but it has no way of being
sure about that because you know keys
like this it kind of looks like yeah
that's statically analyzable but they
there are many other ways I meant you
can do very weird things right exactly
so you can do as a string that that
string could be like two strings added
together or it could be some sort of
functional if I ever see anyone writing
code like in the last line I will but
there are legitimate reasons to do that
you might have a series of method names
and you want to append on to the start
or remove yeah I've done it myself like
some you build your own little meta
programming thing where you like
generate event headers on the flight at
this this can happen in real production
code this is not you being stupid this
is this couldn't happen it can happen
and so my
my question really is how do we solve
this problem and spoiler alert I don't
really have the answer but I've seen
what other libraries have done and and
so like one example is this this is a
style of rxjs they stood sorry so here
we're importing the the store so we go
our store it doesn't have the keys
method on it cuz that's let's say a less
common method to call sure but you
import another JavaScript file okay
which has the keys implementation in it
and that just mutates the prototype it
mutates the prototype exactly so this
would be the implementation I mean it
works I totally get it
yeah I'm always wary when suddenly the
order of imports matter I feel like
that's a dangerous path to go down and
generally like mutating the prototype is
I mean it's been done for years I'm not
saying it's bad or stupid it's so saying
I it feels dirty it feels like there
should be a better solution absolutely
and and and part the problem with this
as well is if you import it but don't
use it tough because that's not
statically analyzable
again your roll up or web pack so it
shifts the burden on the developer
rather than just being a tooling issue
yeah and it means you end up doing this
import for every method it's the kind of
long strings it's a bit messy so yeah
so thinking about other ways of doing
this and there's a JavaScript proposal
which I really like I'm a big fan of
called the bind operator yes I remember
the bind operator so here we're
importing store and the methods so store
basically just in this specific level
would threating moreless be an empty
class right that's not much in there
exactly and you will call it like this
so store colon colon set and that's
essentially saying call this set method
as if it were an instance it's a store
if you have a function in JavaScript you
can use call you cannot just use
parentheses to invoke it but you can use
dot call and then you give it what
should be this inside the function like
this what is this supposed to be and
yeah here have it and what the
parameters are so in the bind operator
says take my left side as the this and
the right side just do a normal
invocation and this exactly so let's
or set function kind of things that's
been called on story even though it is
there is no tight coupling between those
two things exactly so you use this just
as you would in a class and this will
refer to the store as it would within
the class and this can be tree shaking
and all of that stuff if you don't use
it it i've users in babel a couple of
times but i don't think such has shipped
yet
anywhere no and this makes me sad that
it looks like the whole proposal is dead
that is sad that it does make me sad do
you know why well because another
proposal has started taking kind of
caught people's attention about doing a
lot of the same stuff and this is the
direction that the RX folks have been
looking at so same again you import the
store and the separate method in same as
before but ok so this is the pipeline
operator what's the difference well so
what this is saying is call they'll take
the right hand side mm-hmm
treat it as a function ok and pass the
left hand side to it mmm so it's so set
right now it's a function that you
invoke and it returns another function
yeah great in it
so that's yes so your implementation of
set would look like this so here we've
got a function which returns a function
the first one takes the key and the
value
and the second one takes the store I see
I mean the ugliness is hidden but it is
ugly yeah yeah and this is the way the
sort of our ex folks are sort of looking
at it's I think it's ok I think you're
right like writing it is confusing
explain to someone that oh yeah this is
a function that returns a function
that's how it works so I think I've seen
this operator before the exact same
operator in F sharp yes it works
differently there though because they're
basically what's on the left-hand side
will become the first argument of the
function of the right-hand side so in
this case it will become the first
argument but it will be like but of the
fungi didn't return I see injected in
front of the other argument so you don't
have the necessary to it to create a new
function first before you can start
using this
so there is an alternate proposal which
looks like this here you're using a
question mark to say where store would
be passed into I seem necessary that the
hack style of it so where it's this ad
it's this so this is stage 2 okay there
are like two main competing proposals
for the pipeline that has spawned like
another 12 t7 variants of the 2 or what
ways of trying to combine the two so
that's yeah it's very much kind of
experimental still discuss the futures
land but I keep my bag yeah I keep going
back to bind for things which are
instance methods and I feel like even if
this ships I feel like I would end up
going for something more like this
oh that's actually not too bad like
where I have a do method that it's legit
another hood probably switching it
around
right which legitimately under the hood
is just going to do yeah it's just going
to take on the arguments this exactly
that and I like this pattern honestly
because this we can do you today and it
would allow you to the tree shaking
exactly the downside to this pattern is
I don't think it's possible with
typescript which I know it shouldn't
hold you back from JavaScript but
because the in the do case the second
and third and to infinity arguments
there types are depend on the kind of
thing you can but then then the type
would have to know about all possible
functions exactly it's likely to do with
event listeners where they define the
type depending on the string value of
the first argument and then that's
really what the event type will be so
you can do that with a string I don't
know if you can do it with an object
you maybe can good question I actually
don't know but it's definitely more
complicated it should be so yeah so
that's that's the problem as I say but
that's that is probably the best
solution I've got or just a function
which will take the store object and
Martius able the bind operator or just
be able to bind operator but still ended
a plug until exists yeah but to go for
something which is not going to be you
know pursued in JavaScript maybe at
feels like the wrong direction to go and
that the wrote there's one more proposal
which it's kind of just being talked
about which I kind of like and it would
be a way of having an instance in a
declarative way of saying take these
extensions and apply it to this class
mm-hmm but only in this scope okay and
so it's a kind of way of you know it's
very specific to this problem then
though because I feel like absolutely
bind up and it would be more powerful
generic even that like or or a better
solution of the penumbra would be more
generic more powerful tool to have and
that is that's my worry about it as well
is its solving that specific problem
whereas bind solves that problem and
lots of other pro yeah so yeah I'm here
to see where it goes we've got a hacks
we can use in the meantime yeah but I
just again I want bind or a way to do
this in typescript which might already
be possible and if so someone should
tell me in the comments and this is me
farming off my work to other people
shall we introduce zero HDV codes
negative what if you reach 100 what do
we do when we actually shoot HB two or
three</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>