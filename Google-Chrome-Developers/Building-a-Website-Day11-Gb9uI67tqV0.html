<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Website #Day11 | Coder Coacher - Coaching Coders</title><meta content="Building a Website #Day11 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Website #Day11</b></h2><h5 class="post__date">2016-10-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Gb9uI67tqV0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well aren't we just finishing up their
site that's pretty much where I'm at I
think sort of okay well let me let me
list what's at least to do there's
basically putting in the final sessions
and I'm still waiting on those there's
push messaging and notifications if I
can get to it in time and I think there
might be one other thing that's scaping
me at this exact moment if it's
important I'll remember it if not I want
our to-do list somewhere it'll probably
be on there but since I last recorded a
video it's been a few days and the
reason has been a few days is because i
have been working on the serviceworker
part and i wanted to try and get that
just right and it's always working I
mean I've had a service worker in place
from the start but I don't know if you
remember but it basically was like a
pass through service work it didn't do
anything particular all requests just
went through it and it was a fetch to go
and get the resources and the next step
for me was to actually have it populated
cache of items and you know actually
respond from the cache and do a couple
of other bits and pieces so let's
actually have a look at the code because
I think that will illuminate things
firstly they will go into the Python
because I I've got to the point now
where we basically hot swap the homepage
I'll actually bit well hot swapping the
homepage is related to this item I now
have a Jason file of the the actual
sessions which is great filled out with
nonsense sessions that I have just made
up for now and you can see that it's
sort of the date is the first key and
then each the time of each in and this
is in PST
because that's the time zone of the of
chrome dev summit it's in san francisco
which will be PST which means it's i
think seven hours behind UTC gmt is you
might call it depending on how you refer
to time zones I mean who doesn't just
sit there referring to times as I know I
do so I've got the JSON file and the
JSON file is loaded in by the Python and
that's actually important because I do
things like I basically start to kind of
set their step through and I basically
this is the the sessions file is now the
kind of source of all sorts of bits and
pieces in the in the site for example
I've moved the filters out as well out
to their own file so we've got things
like getting the current session and so
we get the the current UTC time and we
step through all the individual sessions
from that JSON file after had seven
hours on she's that there this is a bit
of a funny way to do date parsing
normally you'd pass it things but
because I need to adjust the time and I
might go back to this now that I've
actually got it working and just tidied
up because I could ask to pause it based
on you know I could make it string and
then ask it to pass it properly rather
than doing it this way it's a bit of a
funny way to do it but we have things
forget the current session getting the
next session and there are some
interesting bits and pieces in there
like you have to make sure that the next
session is has a different day to the
current day and bits and pieces like
that but it's all dynamic and also on
the when it comes to the actual home
page which is this if templates non as
in the home page we have to make a
decision based on the time are as the as
the server thinks it is but that's okay
because all these things are in UTC
anyway mostly basically if the number of
days between the first day of the
conference and today is zero adjusting
for PST then it's the live day one if
it's the second day live day too because
these will I think have different
YouTube embeds so I have to have you
know different effectively different
files for those different templates and
then the final one is it will nom
neither day of the conference so show
the home page this works just fine in
fact let me just show you what happens
I'll do this without any service worker
so we're just directly if you hit
command shift our if you're working on
service works off command shift our will
actually cause your page to loading see
it in the network stack cause it to load
without any service working though none
of those requests are going through the
service work and so that's kind of can
be a really good way to sort of test
that is my server actually responding
with the right things before I introduce
the service worker now let me also while
we're here let me just change the date
and time so I've set it to yesterday if
you like so let's send it to the first
day of the conference and then hit
command shift our and you can see that
it's not only is it we just move this
out the way I'll do that actually we'll
come back to that in a little bit so you
can see that's I've actually chosen the
developer diary day one so that I know
this is actually the day one it's just
like it okay it's definitely doing the
right template stay one and you'll see
that up next and this has been adjusted
for local time if i disable javascript
for a moment
down here up here disable JavaScript
playing on clown shift are you see it's
8am PST or it doesn't have the title in
there oh I'm gonna have to go back and
fix that and if we r Ian able JavaScript
it's the same content once I've got the
title back in there but it's been
adjusted for the local time which is
just done in the JavaScript I have a I
have a better JavaScript that constantly
or not constantly but kind of watches
for changes in the schedule home which I
can I can show you if this video doesn't
get too long and anyway the theory then
is this is day one and you can see that
coming up at four o'clock local time for
me which is in about what five hours
there are there abouts five hours it'll
be registration of breakfast you know
obviously as we get into the other
sessions it'll make more sense open date
and time so let's say it is in fact six
o'clock in the UK you can see now we've
got the current session is Alex Russell
I'm no good we've gone we've gone from
breakfast pretty much straight to lunch
I at this time travelling thing is
working out just fine so anyway there's
you see here I've got this refreshing
listing in all just less than a minute
we could we could wait see what happens
next didn't I might give them to
time-lapse this mmm still waiting there
it goes I happened you can see that the
the one that was up next becomes live
and and now the next one has appeared in
the listing so that will be you know as
the videos playing will be I'll be
basically be swapping the session so
that's kind of what happens with the the
live stuff which is she's all very very
cool and the code for that is kicking
around in components there's a live
session info which basically goes
through its kind of sort of in in many
ways it's a duplicate of those filters
on the server side because it's got to
do similar kinds of things it's got to
look through that session Jason so they
share that Jason
the server side and the client side both
look at that same Jason and make some
decisions on you know what the the next
session switch time will be which is
basically looked for the next session
and find out what the time is and then
set a time out to basically go and do a
check for that which is it works just
fine well what it seems to work just
fine anyway so fellows all working if
you you know JavaScript it swap sessions
all that now if we reload and look at
the network these all these requests are
actually coming from the serviceworker
let me show you the service worker the
service worker from the top import
scripts and then and I'm sure you recall
the odd hash have remarked filter thing
that basically is going to make sure
that if this file changes that this
import scripts line is going to actually
be different so if we look at the
serviceworker itself you can see that
it's cashed-up manifest and then there's
a there's the long alphanumeric hash
string that goes in there so if i change
the whatever the contents are of this
cache manifest then this will get
updated the serviceworker will update
it'll run its install and its activation
and go through its life cycle if by the
way you have not come across the
serviceworker lifecycle there is a brand
new document guide article thing on
google web fundamentals which we will
link to in the description and possibly
they'll even put one of those fancy
annotations on this video as well who
knows so what goes into the cache
manifest glad you asked the cache
manifest is here and you'll see that
it's basically a list of all the things
that I want caching and good news I
don't create those myself
or this myself what I do is I go to I've
made this file called build resource
list and I have a bunch of things that I
want it to ignore and I have a bunch of
resources that like URLs that I know I
definitely want like the various
sections of the site this partial flag
means that i actually don't have the
server baked in any of the session
information it just means that those
they come through empty because I know
the javascript is going to populate them
later on I also get the session
information and I go through each
session and I get its URL because I know
I want to cash that offline and then I
walk through the static file so i go
through dots that dot slash static so
basically the static file here which has
the images the jason javascripts
excluding the serviceworker itself the
styles and any third party stuff and
manifest and whatever else that as I say
results in this big long file here and
in the serviceworker once that seem that
gets imported and whatever else the
install essentially steps through each
of those and it makes a request for each
of those and it will wait until the
caches have been opened and we've added
all those items and then it does the
Skip waiting which basically means go
straight to the activated stage so the
life cycle is sort of its installing and
then it waits until all the clients that
are connected to the serviceworker of
disconnected us and you do like a force
refresh where you close the tab when all
that those in all the tabs to the chrome
dev summit site have closed it would
normally then switch the serviceworker
across to activating but in this case
I'm telling it to just go straight to
the activating stage don't worry about
anything that's already connected I'm
hoping that will work out fine I'm
hoping there won't be any breaking
changes by doing that the activation
itself looks through previous
installation caches so every time we
install the service worker that
populates the cash I'm saying find all
those although other caches that aren't
this one the one we've just populated
through the install and get rid of them
delete those caches so that we're not
building up space and spaces in space
over time
this probably could do with a little bit
of an improvement in that I think it
should possibly have a couple of caches
caches for things that are less likely
to change and cashes it for things that
are more likely to change like the
JavaScript or the CSS I'm likely to find
minor things in their minor bugs that I
just want to tweak or change or whatever
and so rather than in validating the
whole cache and downloading everything
every time a better version of this
would be the things that I think are
likely to change those should have their
own cash that I can just delete and
repopulate and the things that I think
are pretty static and unlikely to change
put them in their own cash as well again
this is always a function of time to see
how you know how we get on and this
clients claim if I understand it
correctly on activation when this is the
service works has been activated it
basically says okay I will now respond
to all future requests from this point
on so the page then asks for an image or
a URL I will handle it and it basically
pushes the old serviceworker after
wherever service who because go when
they're not need it anymore Oh on
message this is an interesting little
thing I mean I think it's an interesting
little thing I wanted to do this I was
like how do i how do I decide whether to
notify somebody like if the
serviceworker changes it might be a
minor change and I don't really want to
kind of put a little thing that's like
hey new version because they might just
be really my niche might be like a typo
or something and I'm like add it can
cope for next time what I do is the
version that's baked in here which is
from the package.json if it gets a
message asking for version and that
message will come from the page i'll
show that khodamam it basically posts a
message back saying here's my virgin in
the serviceworker install
the where are you where are you yeah if
we've got an active service worker we
post message going what's the version
when that comes back if we've not
already kind of had a version then we
store that and then if there's one
that's updating as and we get so you've
imagined the situation you've got one
service worker it's installed it's
running it's activated it's doing its
thing and then a new one comes in and
it's like okay I'm taking over well
we've asked the first one what's your
version and it said not point 1.0
because it's Ember let me just do that
let us say one point zero point zero
that would have been a better one and so
we've got that version back and then the
new one gets installed and we ask it
what's your version and it comes back
and says I'm 2 point 0 point 0 I've
basically said I split the current in
the new version on dots and I basically
said if the major version is the same
just log it out to the console going
yeah I updated the service worker who if
it's a major version change like 1 point
0 to 2 point 0 then we push this toast
that's like really you know you should
refresh the site and again these are
things that I might just improve over
the coming days we'll see how we go so
you can see actually if i go to packaged
up Jason and I change that to two point
nine point three hopefully when i
refresh the page but I see site updated
refresh to get the latest whereas if I
do two point three point two point zero
point four
but I look in the console you can see we
just get this service working move from
two point nine point three to two point
nine point four so it's a way for me to
kind of decide how much do I want to
bother the person at the the other end
okay I don't want to wait take up too
much more of your time but I do think it
is worth looking very finely at the
fetch itself this is the function that's
going to be cold whenever you make a
request to the page one thing is if the
image ends in at 1x i always respond
with a 1.5 x this means that i can i
only have to catch the 1.5 x and i will
just hot swap it it doesn't matter
you've asked for the one actually get
the 1.5 x it's in my case it's always
background size cover so i can respond
with a bigger image and it means I don't
have to cash the One X and the 1.5 x
offline honey if the request itself
doesn't end with dev summit then I just
say stick to the current request but if
however you have asked for the homepage
I go through the sessions and I
basically look at each day and I just
four PST and then I say if you're inside
the first day respond with live day one
from the cash if you're inside day to
respond with live day to from the cash
and if not you're going to respond with
the dev summit / home and then there are
any errors just respond with the dev
summit / home so that means that what we
get is we basically call this first so
we was saying either we're just going to
leave the request as it is or if it's a
request for the home page we might remap
it just like the server was doing in the
Python we have to replicate that that
behavior in the service work and I guess
if you had a JavaScript server you might
actually use the ISO moss isip and as
bad as Jake he couldn't say isomorphic
either isomorphic JavaScript there we go
to do the same logic here of going kind
of going is this on conference day 1 day
2 if not respond with whichever pay
age whatever so we're doing the same
kind of remapping and rewriting and if
we didn't do that then on the conference
days you might get the old home page and
you'd have to kind of force refresh to
see the live stream which we don't want
so we potentially remap the request if
it's needed if not we'll just leave it
as is check for the cash if the cash has
got that request which for all of the
files apart from say like YouTube
thumbnails anything for analytics or it
basically any third party stuff it won't
exist in the cache and we'll just fetch
it and for everything that we we do have
from the cache will just respond if
we've got it so goodness me that was a
lot of information wasn't it but it has
been a few days since I've had chance to
record a video so there you go that's
what happens if I don't record them
often at this point I think the site is
pretty much shippable and this will
probably probably be the last dev diary
that I'm going to record and maybe if
there's something that comes up in the
next little while that's like oh I must
tell you then I'll be back but for now
all I want to say is thank you so much
for coming on this journey with me thank
you for all the comments all the
feedback all the chatter and I hope
you've enjoyed coming along this journey
with me I've enjoyed having you along
and you know what let's do this again
sometime but maybe you can do the coding
yes what a concept ted lieu
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>