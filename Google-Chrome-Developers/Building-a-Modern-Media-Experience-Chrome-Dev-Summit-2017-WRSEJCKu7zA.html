<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Modern Media Experience (Chrome Dev Summit 2017) | Coder Coacher - Coaching Coders</title><meta content="Building a Modern Media Experience (Chrome Dev Summit 2017) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Modern Media Experience (Chrome Dev Summit 2017)</b></h2><h5 class="post__date">2017-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WRSEJCKu7zA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I am part of the chrome media team our
job is to make video and audio on the
web just fantastic and we want as many
sites delivering media to as many users
as possible to that end there's been a
lot of new web api's over the last few
years especially lately for mobile media
playback and it's really exciting for us
when we see sites using these api's for
example Forbes launched a progressive
web app and when developing their
narrative for this for their progressive
web app they made video an integral part
of the experience I Heart Radio launched
a web streaming experience in using
media session API and service workers
they were able to give their users the
experience that they expected and then
at the beginning of this month geo
cinema launched a PWA for media playback
it's only been a few weeks but they're
already seeing 10 percent more session
time in their PWA
on average than in their native app so
there's a lot of activity going on in
web media and especially mobile web
media right now and we've seen a growth
in mobile web media watch time in fact
per user media session time has
increased by double digits over the last
six months in chrome on Android so what
are we going to talk about this is the
last talk of the day and we're gonna do
it in three sections the first thing I'm
going to do is give you a few updates
from the chrome media team and next
francois is going to join us and he's
going to talk about some practical
applications of media and how to get
things done and finally the team behind
the vote.com progressive web app will
talk about their PWI experience and
they're also going to talk about some
new work they're doing for offline media
playback the bus icon will make a little
more sense once they start talking about
what they're doing but it's really
interesting because it even is providing
media for users who have no internet
access at all so stick around for that
part is a really neat application of the
web so let's start with a couple of
updates first let's talk about autoplay
it's probably not a big secret for
anybody in the room that one of the most
common complaints with chrome is when
audio starts playing and the user didn't
want it or they didn't expect it
and it is just it's a common complaint
and frankly it's one of the reasons that
users install ad blockers and it's also
been difficult for developers because
the policies haven't always been
consistent between desktop and mobile
now the fact is that autoplay has a lot
of great applications when users are
expecting it and so the team has been
working to try to unify everything and
make it easier for everybody so you're
looking at what's best for the user and
what's best for developers the primary
goal was to unify everything across
desktop and mobile so as we talk through
these policies these apply to both
desktop and mobile to make everything as
predictable as possible on all platforms
muted media will always be allowed
including media and iframes
you can always ought okay muted media
unmuted media will be allowed in three
situations first if the user is already
interacted with your site and what we
mean by that is a tap or click and when
we say that what we mean is that if they
go to one page and they tap or click and
then they go to another page on that
page the media can play with sound
second on desktop if the user is
interacted with the site a lot with
audio we're going to assume that audio
is allowed for the site and finally on
mobile if the set has been added to the
home screen that's a pretty good
indication that the user doesn't mind
autoplay with sound in terms of code in
terms of how you detect whether or not
autoplay is allowed you can do this by
checking the play promise after you try
to play media with audio if the plum
promise fails if it's rejected then you
know that only muted autoplay is allowed
one of the things that's important to
know as well is that iframes always can
do muted autoplay but the site can grant
permission to access the site policy and
that's going to be done using an
attribute the attribute name is not yet
finalized but it's going to be something
like gesture equals media or something
like that and so two things to know
about autoplay before we move on number
one what is the best approach what we
recommend based on our conversations
with users in the work that we've been
doing is muted autoplay allow users to
self-select into the audio audio
experience now that's not going to work
for every site in some cases
click-to-play may be more applicable but
that is our recommendation in general
the other thing that we recommend doing
is because there's a lot of technical
details to this keep an eye on the
autoplay policy page the bottommost link
there that's where you'll see updates as
the dates and the details around things
like the attributes change next let's
talk about shaka player for those of you
who aren't familiar with Shaka player
it's an open source free player that
allows you to do adaptive bitrate stream
fairly zli it gives you smooth playback
for video
instagrams gonna go into a little more
detail about how they use Shaka tomorrow
in their talk but for now what I'm going
to talk about is things that are new in
the latest release Shaka 22.4 was
actually just released within the last
48 hours and it includes all of the
features here it includes support for
Apple HLS for on demand that's with
fragmented mp4 it also allows sites to
customize the rendering of webvtt and
ttml and finally it allows offline
protected media playback that's today
something you can try in chrome on
Android 62 and later coming soon will be
appalachia less support for live video
including support for mpeg-2 transport
stream files that's a fairly common HLS
format they're also working on adding
background fetch for offline and that's
really going to round out the offline
story by allowing users easier
downloaded flows and finally Shaka has a
demo player and the player today had
includes examples on how to do things
like fullscreen and rotate which
Francois will cover as well as they're
working on adding progressive web app
features to the demo to give you
reference code so those are the updates
so now let's switch over to what sites
are doing today the web is really great
for media you can write of great media
experience once it works on web it works
on mobile and typically what you want is
you want fast playback you want a great
UI and you want people to be able to
access it anywhere including offline not
everybody knows how to do that
especially on mobile so what I'm going
to do is hand it over to friend SWA he
spent the last six months working on
articles and examples on how to give a
great media experience on mobile
you Johnny hello so here's a fact after
two seconds of buffering user starts
dropping off at around 6% per second in
other word faster playback starts being
small people watching your videos so let
me walk you through two techniques you
can use today on the web to accelerate
your media playback on first load by
actively providing resources first if
your video source is a unique file
hosted on a web server you can use the
video pre-roll attribute to provide a
hint to the browser as to how much
information or content to preload
resource fetch each resource fetching
sorry will start only when the initial
HTML document has been completely loaded
and passed while the window load event
will be fired when resource has actually
been fetched setting the pre-roll
attribute to auto indicates that the
browser may cash in have data that
complete the back is possible without
requiring a stop or further buffering
there are some caveats though as this is
just a hint the browser may completely
ignore the predella tribute when user
has enabled data saver for instance
Chrome won't preload anything and on a
SATA connection Chrome will only fetch
media metadata such as dimension track
this duration and so on so here's the
second technique my personal favorite
link preload link preload is a
declarative fetch that allows you to
force the browser to make a request for
resource while the page is still
downloading without blocking the window
loaded
resource studied with link period are
stored locally in the broader and are
effectively sorry in our act effectively
inert until they are explicitly
referenced in the dom javascript or css
so this code shows how to build a full
video on your website so that when your
JavaScript ask to fetch video content it
is read from cache as the resource must
already been cached by the browser if
the preload regressed hasn't finished
yet a regular Network fetch will happen
not that I'm using as video here in the
link preload as I'm going to use that
resource as a video if it were a nodule
amount I would be using
as audio so what about reading a chunk
of a video you may ask in that case I
would use as fetch this is how to
preload the first segment of the video
we've linked period and use it with
media source extensions also known as
MSC if you are not familiar with MSE
that's okay let's simply say that this
API is what makes adaptive media
streaming possible today on the web
netflix twitch and youtube use it
extensively for the sake of simplicity
the entire video has been split into
smaller files like v 1 v 2 v 3 extra the
goal is to feed all these junk files to
a video so that playback is smooth so
here's what happens when the media sauce
is created and ready I'm fetching the
first segment of the video that may
already be in the browser cache by the
way thanks to link period and appending
that data to a buffer belonging to the
media source of a video element and that
is pretty much it last thing as link
preload is not supported everywhere yet
you should detect its availability with
Disney bets in order to adjust your
performance metrics now it's not because
you know how to fill out content to
accelerate media playback that you
should do always do it no matter what
there are many many singles in the web
platform you can use to provide a
delightful media experience to all users
including the one we have limited or me
to network connections include the
device battery memory network connection
type where they are not a video as a
poster image the available storage left
and whether or not the receiver is
enabled I have created a tiny demo page
that takes advantage of all these things
all at this URL and if you're trying it
now you'll see that the video may not
preload for all of you and that's
because we are all different and
beautiful by the way
so let's start with the first signals
the device battery as usual now this is
a progressive enhancement if the battery
is too low and not charging let's not
assume blindly that providing a 1080p
video will make user happy we could
either lower the quality of the video or
even better in my opinion not brittle at
all if user is on a low-end device you
may want to be kind there and not
preload any media just wait for user to
ask for it as the device may not be able
to handle everything smoothly
I assume user is on a low-end device if
it's device memory is less than one gig
and as you can see it is pretty easy to
get in that information not that a
device memory HTTP header is also
available in Chrome that means if your
web server knows how to end all this
HTTP error also known as clients in
terror you can serve an appropriate
response rest on the device memory
estimating how much available say space
is left on the device is crucial and if
you know there's not enough to preload
or store your video you should stop
right away you may also use that
information to gray out make available
offline button that is why I recommend
you always provide a way for users to
clean all their stored data on your
website now if user is on a cellular
network connection you should assume
that network that Allah is not infinite
and they may even have to pay for it so
please be mindful use the network
information Web API to detect user
connect where connection type and act
accordingly hopefully a dedicated
metered property will be added to
disappear in the future to make this
even more reliable and finally here's
one way to detect in JavaScript if user
has turned on the data server in Chrome
all you need is to create a video
element set the privilege tribute to
auto and check that the reflected value
is not none I know it could be better
and it will save that a boolean
attribute is in the process of being
added to the network information API so
finger crossed by the way there is also
a save data HTTP header also available
in Chrome so you might want to check the
if your website built if she web server
supports it once again and serve an
appropriate response now a great media
user experience relies on many
progressive features and I'm here today
to tell you that the web platform is
ready and I'm really excited like I am
actually minute that's a simple there
are a lot of cases where user may simply
want to listen to audio and if there is
a primary use case for you you should
definitely use the media station Web API
this API allows you to put some custom
media metadata and an image in the
notification accessible from the lock
screen as well as on wearable devices it
is also nice in journals because users
can tell what's going on on their device
and easily control media playback one
cool thing I've noticed recently is that
it also works with the Google assistant
on Android user can simply say ok Google
pause music or fast-forward and it just
works so let's have a look at how to use
the media station web api ful as I said
before this is a progressive feature so
it's stuck with an if statement if the
browser supports it you can provide some
media metadata like the title artist
album and a list of artworks you can
specify many more artwork sizes than I
did in snippet the browser will always
pick the one that is the best for the
users device I would suggest though you
always provide 256 and 512 pixel squared
images as they are the most common ones
on Android
once you've provided some metadata you
may also want to response to the media
controls exposed in the notification
such as cig backward and forward play
post next track and previous track and
for that all you have to do is set up
some action handlers so that when these
action happens you can take care of them
now if you have some custom media
controls in your webpage you can make
sure the state of the UI is reflected in
the notification by overriding the
playback state to playing a post I
personally really dub the CPI because it
is simple and powerful at the same time
let me show you for instance some custom
action lenders for sig backward and
forward
this code is pretty simple to understand
right these one-liner functions are only
about contouring the current time
property of a midi element and that's
all i'm sure you would love this feature
on your favorite podcast web
now here's another key part of a perfect
media user experience and we call it
what site to full screen as user rotates
device in it kappahd let be smart and
automatically request full screen on the
video to create an immersive experience
note that video we have no custom
control get this for free like global
play for instance so how does that work
let's use the screen notation Web API
which is suddenly not yet supported
everywhere and still prefixed in some
brother at that time does this will be
another progressive enhancement as soon
as you detect the screen agitation
changes the video is full screen if the
browser window is native mode if not
exit full-screen that's all eight lines
of JavaScript and all of a sudden you
can make the media user experience
significantly better on the mobile web
what about out-of-focus media playback
when you detect your web page or PT on
your web page is not visible anymore you
may want to update your analytics to
effect this or pick a different video
track of a lower quality pause the video
or even show some always on top custom
controls the user and to illustrate this
let me share with you two API you can
use today with the page DBT Web API you
can detect the current passivity of a
page and be notified of BCBG changes
this code simply paused the video when
the page is hidden this happens when the
lock screen is active for instance or
when user switches tabs as mobile
browser now offer controls outside of a
browser to resume a post video I
recommend you said this behavior only if
user is allowed to play media in the
background the foreign fall when the
page is hidden video with no custom
controls are automatically paused on
Chrome for Android with the new
intersection of Java API you can be even
more granular at no cost
this way BPR lets you know when an
observed element enter or exit the
browser view part in this code
the visibility of a small mute button is
toggle based on the video BCBG in the
page if the video is playing but not
currently visible the button will be
shown in the corner of a page to give
user control over videos here's the tip
for you if you have a lot of video in a
page and it is using an intersection
observer to pause on mute off-screen
video you should consider resetting the
video source to null instead as this
will raise significant resources in an
influence called case fool we've covered
a lot so a great example of all these
features is vidcom was launched earlier
this year a really cool media PWA so
please welcome on stage Raj Neil will
share with us Heights gun and the future
plans are near the earth
Thank You Francois hi I'm Raj Neil I am
the head of product and technology at
Wycombe 18 in India we've had a great
journey we launched in May last year our
OTT product which is called boot today
we are at about 26 million monthly
active users and everything they spoke
about about how to use the various API
is they've been releasing this year we
have been able to use it and I think we
have seen some significant improvement
to a progressive app experience by
itself when we launched woot for the
progressive web app we actually called
it a boot light and that is a product
that we are now focusing on extensively
the business metrics of what we have
seen as an uptick has been phenomenal
but I want to share a little bit about
why we thought it was important to make
a progressive web app there's a large
country and as we reached you know the
26 million scale which we have reached
right now what we realized was that
there were a lot of devices which were
underpowered they did not have enough
money a memory on them and they still
wanted to access you know the videos
that they wanted to see and we realized
that one of the best way to do that was
to be able to do something which does
not require them to take space from
their phones from an app and that is
where the progressive web app came in
one metric that I wanted to point out
here was how our entire distribution
across the web ecosystem has changed
after we got the progressive web app on
it has gone from about 20 percent of
daily actives to 50 percent so that's a
number we see that has helped us get you
traffic in and obviously the marketing
guys are really happy because the cost
of acquisition has gone down I will be
speaking today about two different out
life or offline examples but the first I
want to speak about is the one that
we're doing on progressive web app India
has about 1 billion phones but only
about 260 million 4G and 3G connections
offline is a way of life for users to be
able to access content and be able to
play it later now the internet access
might be available to these users for
various parts of the day may be at
office may be when they are at a
friend's place or a coffee shop so we
have taken the experience of offline in
from the apps and really brought it to
the browser so user can set something to
download and when the download is
complete he gets a notification
and he can go off and be able to watch
it at his leisure how to to explain a
little how we have achieved this I would
now like to call Eric from our Cara from
a technology partner Kaltura thanks Eric
hi my name is Eric I've learned I'm the
VP technology at Kaltura Kaltura is an
end-to-end service provider for OTT
experiences powering large media
companies such as boots boots OTT
platform a Kaltura engineer you
basically have three pillars on which we
measure our success first off is
performance providing a top-notch
performance across any device across any
platform for all of our customers users
seconds accessibility providing our
customers and users the power to access
content wherever they are across any
device whether you're online or offline
insert the user experience provided
providing a consistent feature is
feature-rich a user experience for our
customers across any device across any
platform all of this while keeping in
mind that most of our customers such as
bhoot require us to support premium
great great content which usually
requires some form of content protection
as such PWA is a natural component for
us to use to provide all three pillars
for instance up until now providing
offline content support for content
protected content for premium great
content usually required using a native
application on top of exoplayer by
utilizing PWA capabilities we can offer
the same experiences using a simple web
application mobile web application so
now let's let's look at a typical
download experience on a mobile web app
so first off of course the user will
request to download a specific piece of
content from the web app the web app in
turn will go to the CDN or Origin
download and the respective manifest if
the content needs to be called in
protection there will be another request
to the license server providing
information on the user account in the
device for the license server to make a
decision regarding what kind of license
to provide for that specific piece
of content and now comes the interesting
part will the application will pass on
to the service worker basically a list
of files to download in the background
and the service worker worker in turn
will start downloading these files from
the CDN origin while not blocking the
application at all
once this fetch is completed a
notification will go out to the
application which in turn will of course
notify the user but now the content is
basically available for an offline
playback so now let's look a little bit
and at some debugging tips and some
experiences we've had along the way
developing the PWA app so first of all
keep in mind that if you check the
bypass for network check box this
basically means that the fetch event on
the service worker will be spit will be
skipped it will not be invoked another
thing to remember is update on reload is
very good for development mode it's very
helpful just make sure to uncheck this
when testing of course specifically
regarding background fetch today you
still need to use a flag this flag is
the experimental web platform features
flag another thing to remember I'm going
to keep in mind while while writing your
code and will see a snippet and
explaining this in the next slide is
basically if a single fetch listener
fails the rest will basically not be
invoked you need to keep this in mind
while developing developing a progress
bar is very easy very simple basically a
server or service worker can update the
application on its progress within the
app basically telling the application
how much of the content itself was
actually downloaded already so this
together with the total file starts
basically you can create your own
progress bar basically telling your
users how much of the content was
already downloaded now let's look at
some code the first snippet is basically
an invocation of the background fetch
fetch API you can see a very simple
wrapper function the first thing we do
is we will insert into the
indexeddb the ID be basically an entry
representing that downloaded asset that
asset that is going to be downloaded
this will be used later on and
a service worker gets torn down or
failed for any reason basically we still
have a record of that downloaded asset
to reinvention to the user the next call
is basically the very simple invocation
of the background fetch fetch API
providing an ID and providing the list
of assets of course this next NIP it is
basically this is the event that gets
fired out once the background fetch is
finalized this is the event the first
thing we will do of course will retrieve
the indexdb metri that we just put in
the and we just stop putting inside the
IDB then we basically correlate that
back to the background fetch to assets
in order to make sure that we're talking
about the same assets and the next steps
is basically putting the downloaded
fetched asset into the cache and this
basically means that now the content is
available for offline playback for the
user basically what will happen now
after these functions basically the
serviceworker will notify the
application that the background fetch
has finalized has finished the indexeddb
will be cleared of the entry that we no
longer need and the serviceworker will
be cleaned up you can see a very simple
workflow for a very cool experience
now I'd like to call back rich Neal
basically to talk to us a little bit
about another very cool PW experience
for route
now I want to tell a different story
about offline
India is a large country and we know
that you know there are about 1.3
billion people one of the main
challenges is that because of the
geography a lot of places still don't
have stable 4G networks that people can
really stream content from the other
challenge of course is that the data
costs have been really high over the
last year the the costs have come down
with the launch of a new 4G network but
still data cost money we looked at
solving the problem in a different way
we said what if we did not use Internet
to really get the content to the people
Maharashtra is a state which has about
112 million people and we tied up with
the state transport cooperation there
and they have about 17,000 buses what we
looked at doing was launched a paraquat
would go so what you see here is
essentially a bus station where you can
stick her out and sale or log on to
would go when you enter the bus inside
the rusticles telling their users to be
able to access by typing would go what
would happen is that they would find a
Wi-Fi network and we created this
proprietary boxes which were placed
inside the buses these boxes can store
about 200 hours of content and can be
refreshed you know every time the bus
goes back into the Depot and the users
launch would go we customize the UI to
make it extremely multilingual and easy
to understand for people who might find
English as a challenge which which is a
lot of times so we launched with two
languages one is in Hindi and another
column Bharat key and we created a
dedicated space for kids content also in
this and when today we are running this
on about 10,000 buses we have seen some
amazing results we have about 40 minutes
of content consumption per user
happening and we see about nine
users per per trip connecting onto the
platform and using it what's cool thing
about this is that when we reach scale
of about 17 thousand buses will be
servicing about 6.3 million people every
day it's 6.3 lakh people every day which
essentially means that we will be doing
about 2.3 billion passengers will be
coming onto the bus now that's a
large-scale deployment of a product to
get content out and this of course
remains completely free for the users
because this is advertising driven so
what we excited about is
creating the best of Internet in a non
connected environment being able to
deliver content at scale and creating a
completely new business model for the
media so that's what I have to share
about something that you're doing on
would go with that I'd like to call John
back on stage thank you
thanks Raj Neal well as you can see
there are a lot of great opportunities
out there for mobile web media and we've
listed some of the key api's on the
screen right now for those of you taking
pictures in the audience those of you at
home hopefully this is a good reference
for you a couple of notes on the api's
background fetch is still in development
it is available in canary right now
aiming to release early next year and as
mentioned it is something that you need
to turn on the experimental web features
flag if you want to try using it offline
persistent license support is in chrome
62 for Android and it's coming in canary
64 soon for desktop as well so if you're
doing protected content offline you'll
need that feature a couple of things we
didn't mention this talk but also worth
looking at if you want to send media to
a television please do look at the cast
API it's easy to add to your site and
for anybody who is not yet seen HDR
video vp9 10-bit tomorrow at the demo
pod we will have that playing on an HDR
screen so that you can actually see the
future some of the great video quality
both in terms of dynamic range as well
as wide color gamut so this is all
coming it's really exciting stuff
ultimately the web is more ready and
more capable for media playback than
even a year ago and so it's been great
for users it's great for sites because
it makes media just a single click or a
URL way we're excited to see continued
growth in this area so with that thank
you for your time myself francois will
all be available to take questions
afterwards and we look forward to seeing
you there thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>