<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Polymer Butter and Firebase Jelly (Polymer Summit 2016) | Coder Coacher - Coaching Coders</title><meta content="Polymer Butter and Firebase Jelly (Polymer Summit 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Polymer Butter and Firebase Jelly (Polymer Summit 2016)</b></h2><h5 class="post__date">2016-10-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/f7ODNJKh3Yg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone I'm Michael blyve with
firebase and I love using the platform
to build web applications it's amazing
the way that you can compose simple
elements together and it becomes a fast
responsive fluid front-end for your web
application but on the back end the
story is a little bit different sure it
starts out easy I think I'll just throw
some code together plug it into my front
end and everything will be good to go so
let's start with something like auth
right well let's see I want to have sign
in from Facebook so that's o2 but I want
to support Twitter as well that's a auth
one then I won't be people to be able to
link both of those accounts together and
I guess I'll need a database so let's
see Postgres or MongoDB let's see then I
need to build API servers the tops of
the database and then the clients can
talk to those but my API servers have to
scale as my application grows okay so
that's the database oh wait but I want
it to be real time so that means that I
also have to run socket servers that
sync the changes from one client to
another client whenever a change happens
and yet CEO and I need to build an
administrative back-end so that I can
look at the data in my system and make
changes and yes so there's my back-end
it's great except actually that's not my
back-end at all
that's just all of the scaffolding
that's required to start building my
back-end so I know what you all must be
thinking there has to be a better way
right well thankfully there is firebase
firebase is an integrated suite of
products that helps you develop your app
grow your user base and earn more money
now with firebase you can do more than
just use the platform you can use the
platform and lose the back end are you
tired
thank you are you tired of implementing
the same authentication system again and
again
firebase off makes all that go away with
one step you can have authentication
with Facebook Twitter Google email and
password it all just works it's 2016 and
users expect more from their
applications pull-to-refresh is
unacceptable
polling is slow and unoptimized if you
want real-time you have to build a
complicated back-end right not anymore
the firebase real-time database takes
all that pain away connect to the
database directly from the browser sync
class sync changes in real time to every
connected client take all of those
refresh troubles and throw them away now
have you ever been in the situation
where you spin up a server just a proxy
traffic from file uploads from the
client to your server and then to a
cloud storage bucket
not anymore firebase storage lets your
users upload directly to Google Cloud
storage from the browser and you still
have total control over who uploads what
and where so now we've got firebase off
firebase real time database and firebase
storage we've replaced our entire
application backend and that's pretty
great right but we still need to deploy
our app somewhere if only there were a
way firebase hosting firebase hosting
allows you to deploy with a single
command line with a single command from
the firebase CLI and in seconds your
site is deployed to a global CDN with
HTTP to support if you've heard of
purple firebase hosting is one of the
easiest ways to get started with purple
so this is a pretty great platform you
know I I started I started working for
firebase a little bit more than a year
ago and if I weren't working for
firebase I'd still be using app building
apps using firebase cuz I think it's a
great platform so this is like all we
need right we have everything we need to
build an app but wait there's more I
first heard about web push and I was
really excited because to me web push
was one of the biggest gaps in
capability between native mobile
applications and web app
locations those push notifications made
it really easy for people to get right
back into an app really quickly so I saw
web push and I thought great I'm gonna
dive right in I'm gonna implement web
push and it's gonna be really easy and
then I read how you actually do it and I
gave up almost immediately I think it
was the elliptic curve digital signature
key pair where I just really threw in
the towel so again there has to be a
better way right so now I'm pleased to
announce that firebase Cloud messaging
the same service that powers more than a
million applications and sends messages
to more than 2 billion devices worldwide
on Android and iOS has come to the web
we've taken that 15 step process and
we've distilled it down to 3 install the
firebase messaging service worker ask
the user for permission to send
notifications and then listen for those
notifications it's really that simple
but why are these push messages so
important well we've been trying out
firebase Cloud messaging with a few
early partners like Aliexpress and
alibaba.com
and what they've seen is huge uptick in
engagement in fact they've even seen
some engagement that surpasses they're
the same conversion rates on their
native applications and that's a huge
difference because with web push you can
just engage people where they are you
can get them back into your application
faster and easier so that's a complete
platform 5 features that all work
together to deliver a comprehensive
platform a comprehensive back-end for
your web application but wait Michael I
hear you saying this is the polymer
summit what does any of this have to do
with polymer well that's where polymer
fire comes in polymer fire is the
official set of custom elements built by
the polymer and firebase teams together
to support firebase and and web
components being used together and I'm
happy to announce that with the ODA 10
release that's coming out later today
you'll be able to use firebase messaging
in polymer fire directly now this all
can be yours with one easy step of Bower
install save fire base polymer fire try
it today ok ok sorry
all right I get a little bit excited
when I talk about firebase I think I
think maybe I got carried away but I am
really excited about firebase and I'm
really excited about web components it's
two things that I think just fit
together really naturally and now I'm
gonna take a step back and I'm gonna
look at how you can actually integrate
these two things together and how you
can build a full progressive web
application using polymer and firebase
together now I'm going to start with a
demo so I built a little app called PB&amp;amp;J
it's a restaurant and it's a restaurant
delivery app where you can see a
restaurants menu you can order some food
and then you can watch the order status
so let's go ahead and switch to a demo
so here we have the beautiful website
for my favorite restaurant that's my jam
and you can see on it I have a link that
says order on PB&amp;amp;J so I'm gonna go ahead
and tap that and here's the menu I've
just got some different peanut butter
and jelly sandwiches and so I'll add a
few of each of those although I mean
maybe okay I don't need six sandwiches
let's I'll just go with two banana PB
and J's that sounds pretty good and
let's see now I need that says I need to
sign in so let's go ahead and do that
and of course I'm talking to firebase
off here quick pop over to Google tap my
username there we go I've already got my
address stored with my user account and
now you can see I've got a checkbox for
order update notifications and when I
tap that you'll notice that it
immediately pops up a permission dialog
that says do you want to be able to take
notifications let's say yes and let's
complete our order so now the order is
received and hopefully my delicious food
is on the way now I'm just gonna step
over here to my laptop for no apparent
reason
and oh what's this now my order is on
the way and you might have noticed that
a little message popped up at the bottom
so that is actually firebase cloud
messaging at work it went from the cloud
to my device and popped up a
notification but hey there's a million
ways that you can do that right you can
do that with the firebase real-time
database so let's say that I am NOT in
the app anymore in fact let's say that I
exit it completely and now it's been a
little while longer and I'm thinking I'm
really hungry for some PB&amp;amp;J and bananas
when is that food gonna get here and oh
look at that I have a notification on my
phone what a surprise that I was not
expecting
and you can see PB&amp;amp;J is arriving now
your PB&amp;amp;J food is arriving I tap the
notification and it brings me right back
into the application and you can see hey
my orders are arriving soon
so that's PB&amp;amp;J it's a really simple app
but it shows the power of firebase we
use the database to store this data we
used off to sign-in with Google and we
use firebase Cloud messaging to push
these notifications out to the user when
they were relevant can you imagine how
easy this flow is compared to installing
a native application for every
restaurant or for ten different delivery
services that are all competing for the
same space this flow is a game changer
and I think that it's really cool and
really important so let's go ahead and
switch back to the slides and talk about
how we built this so with polymer fire
everything starts with the firebase app
element the firebase app element is
essentially just a way to bootstrap the
configuration of your firebase
application aptly named and if you've
used firebase before you may have seen a
snippet that looks something like this
and firebase app is just literally
executing exactly the same code in fact
if there's a reason that this is more
convenient for you to do just because
you can copy and paste it from the
firebase dashboard use this instead it
really doesn't matter
they do the same thing and the fact that
they do the same thing is actually kind
of handy because that means that you can
use the fire based JavaScript SDK
exactly the way that you do in the docs
from anywhere in your polymer app so
sometimes elements are the right way to
go but sometimes you want to drop down
to the JavaScript SDK you don't have to
pick and choose this isn't some sort of
buy-in to everything and it all works
this way just use the firebase
JavaScript SDK where it makes sense and
use the custom elements of polymer fire
where it makes sense so in this case
firebase storage which we're still
working on for polymer fire can still be
used in my polymer app just by dropping
down to the JavaScript SDK so next let's
talk about firebase off firebase auth is
an element that lets you synchronize
your current user state and also gives
you easy hooks to sign in your users up
into your application so let's take a
look at the firebase off element here
you can see that I gave it an ID and I'm
binding to properties from the element
I'm binding the user property and status
node status known is basically saying
hey I've you know firebase has done the
due diligence it needs to do to figure
out and now we know whether or not the
user is logged in and user is going to
be the currently logged in user if there
is one or it's going to be null if there
isn't now one feature of firebase off
that I want to highlight today is the
idea of anonymous authentication because
when a user visits your website for the
first time they're not always looking to
just immediately hand you their email
and create a new password or even sign
in with Facebook or another social
authentication provider but a lot of
times you still want to be able to
associate data with them as they go
through and add items to a restaurant
order or anything else that's what
firebase on on off anonymous
authentication allows you to do so here
I'm setting an observer on user and
status known and I'm calling a method
called Auto auth and what Ottawa does it
just says if we know that the user is
not logged in then let's go ahead and
automatically log them in with an
anonymous account we don't need any
credentials from the user we don't need
anything else the the account is stored
on the device and now you can sync with
the real-time database you can do all
the things you would do
the user and you know that this is
anonymous user in the in the security
rules in other places you can see is
anonymous is true and what's really
useful about this is that later maybe a
user has become engaged with my
application and now they're ready to
upgrade to a full account and that's
really easy with firebase off so all I
do here is I say okay I'm gonna use a
Google auth provider and then I take my
user which is directly pulled out of the
fire base off element and I say link
with pop-up and the Google provider and
that's exactly what happened in the demo
app that you saw it takes you away to
Google it comes back and it actually
authenticates you with the same UID that
you are already using from your
anonymous account it links those
accounts and it's not just one-to-one
you can link all of you can link as many
providers as you want to the same
account which means that if you want
somebody to be able to associate their
Twitter their github their Facebook all
of those accounts with the same user you
can do that with firebase next let's
talk about the real-time database and
the first element that we use for that
is firebase document so firebase
document is essentially just listening
to a path in your firebase database if
you haven't worked with the firebase
real time database before it's
essentially a giant JSON object it's a
tree of data at which you at any point
you may have leaf nodes that are just
JSON values so it could be a string or a
number or any number of things well
actually not any number of things
because JSON is pretty limited that
number of things so with firebase
document I can just bind to a path in
the firebase database in this case I'm
binding to a user profile and you'll
notice that the user UID is bound into
the path and firebase document is smart
enough that if you have a path segment
that ends up with two slashes in a row
it's not going to bind that because it
assumes there is a missing binding there
so you can safely add this element into
your project you can bind it with L with
attributes that aren't or with
attributes and properties that are null
and as soon as they're populated the
firebase document will say okay now
everything seems to be here so I can go
out and I can actually fetch the data
and that data is being synced into a
property called profile and of course
because this is a this is a polymer
element it's built to work with the
polymer binding system so if I have a
text area for instance I can just
directly bind that into profile that
address as I type into that text area it
syncs in real time to the database
anyone else who's looking at that same
data will see all those changes happen
in real time it's really easy
it's almost stupidly easy to do but
sometimes you have data that's a little
bit more complicated than just a simple
document and that's where firebase query
comes in let's take the menu from the
PB&amp;amp;J app for example the data for that
looks something like this you have a
menu underneath that you have URL
friendly names for each of the menu
items and then underneath that you have
the description image name position and
price so how are we going to get that
into a into something that polymer can
look at because if we used firebase
document for this we would just have an
object and it's kind of hard to deal
with like objects and turn them into
lists and there's kind of a lot of work
there so that's where firebase query
comes in with firebase query again I
just have the simple path and data so
I'm binding to a path in the firebase
data real time database in this case
that menu and underneath that menu there
were nodes for each of the items and I'm
again binding the data into a property
called items and the one extra thing
that I'm adding here is ordered by child
so this is one of a few different query
of a few different querying attributes
that you can add and in this case I'm
saying that this let me go back there we
go this position property that's in my
data is what I want to order by so if I
have position 1 2 3 4 5 then it'll order
by that and then below this I'm just
using a standard iron list and I'm
binding it in there and the only
difference that you'll see is that
there's an item dollar sign key and
that's automatically added by firebase
query to tell you what the key was so in
this case classic PBJ or whatever else
it is so that you can turn this object
into an array with
losing any data or granularity so
firebase query makes it really easy to
read collection based data out of your
firebase real time database next let's
go into firebase messaging a little bit
because it's the newest thing and I'm
pretty excited about it
so essentially what firebase Messaging
lets you do is send messages to your
application whether or not it's open and
so to start you're gonna need to install
the firebase messaging service worker or
use a Service Worker that you're already
using in your web app and it's really
not very much because service worker is
required for doing any kind of
background action while the site is
closed we have to have a service worker
but we've done a lot of work to make
this as easy as possible and so all you
have to do is import the firebase SDK
initialize it with your messaging sender
ID and then initialize the messaging SDK
by calling firebase messaging now
optionally you can set a background
message handler in the service worker
that allows you to manually handle any
messages that come in but in general you
won't need to do this for reasons that
I'm about to go into so this is there as
an option for advanced use cases but
most of the time you probably won't need
it now let's talk about the fire based
messaging element a little bit because
there's a couple steps that you have to
go through to get fire based messaging
working first you have the element
itself obviously and Here I am binding a
property of token and I'm Lynn and I'm
adding an event handler for on message
and so let's talk about the token first
notifications require permissions
browsers don't just allow any site that
you visit to send you push notifications
and that's a very good thing but
obviously you need to request permission
then if you're going to do it that's
baked into both firebase messaging and
the firebase messaging element and so
all I have to do is take my messaging
element and call request permission on
it and that's gonna pop up that little
permission dialog just like you saw in
the demo but of course if I already have
permission then it's not going to pop up
that dialog and it's just going to
return a promise that will automatically
resolve and the fire based messaging
handler will automatically set all this
stuff up so I request permission and in
this code here
I'm doing it on ready in my element but
that's not actually what I'd want to do
in my application I'd want to attach it
to a user action like you saw in the
demo because you don't want to just have
somebody visit visit your site and then
WHAM immediately they're hit with a hey
allow me to send you notifications
that's a pretty bad user experience and
people are probably gonna hit back as
fast as they can
so instead tie this to user action make
it something that's really clear like I
want notifications and now I have
notifications and that's pretty easy to
do so how do we actually send messages
well we need a token so when fire based
messaging registers successfully it gets
a device token that you can sync to the
real-time database or anywhere else that
you can access so that you can send that
specific device a message so here I'm
syncing it to the real-time database
under prep stop push token you can do
anything you want with this data but you
need to have this token to be able to
send messages to that device and so what
the sending a message to a device look
like it's a simple HTTP request you just
post to FCM Google API is calm / FCM /
send there's a server key that you have
to paste in from your firebase console
and you need to specify a Content type
of application JSON and then the body
just says - and then you specify the
token so that's pretty easy but then
what's the actual payload so there are
two different kinds of payload that you
can do you can add a data payload and
this is just basically a silent push so
this is going to be sent to the device
but isn't going to trigger any kind of
visual notification unless you decide to
like write custom code that does that
and so this can be useful for sending
this can be useful for sending something
to the service worker to let it know it
needs to update something or just other
actions that do background processing
but don't necessarily pop up a
notification but where firebase Cloud
messaging gets really smart and really
shines is with the notification payload
so you can specify a notification
payload with a title a body a click
action and an icon and that gets turned
into that native notification that you
saw in the demo but more importantly
than that it's also smart
about what
is the current state of the application
now you'll notice that the first time I
sent a notification it just popped up as
a toast on my in my application and I
wrote code to handle that because what
happens is that firebase Cloud messaging
assumes that if your app is in the
foreground then you probably don't want
to push notification to show up in the
notification tray because you're
literally looking at the application
right now
so rather than popping up that
notification it will instead send
through a message to your firebase
messaging event handler and you can
decide if there's some kind of UI that
you want to do or you know if if
whatever state the notification is
telling you about is already represented
on the screen maybe you'll do nothing
but if the the app is in the background
and that could be that you are you know
switched over to a different app that
could be that you're on the desktop and
the tab is no longer in the foreground
that could be that the app is entirely
closed then it's going to pop up that
native notification and you're going to
be able to jump right back into the app
and pick up where you left off based on
the URL specified in the click-action so
this is a really simple API but it's
also really powerful it lets you
reengage users at whatever it seems like
the right level and it's not going to
bug them with incessant notifications if
they're already looking at the app in
addition because this notification
payload will automatically pop up a
notification you can do this without
changing your code so if there's some
new kind of notification that you want
to try out and you don't want to have to
deploy new code for it and you're just
testing things out you can send this to
devices exactly as is with no extra code
and it will pop up a native notification
and that's pretty cool so going back
into our code we're gonna actually
handle this message now so you can see I
have an on message and I'm calling push
received and that push received then
just gets an event the detail of which
has a message property in it and of
course message is exactly what we said
it is the message it is the message
payload from this slide so you're going
to have that notification title body all
of that is going to show up in the
message notification if it's a
to push them it'll show up in data and
that's all there is to it so with just a
little bit of work and a really simple
API you can integrate this push
messaging into your progressive web
application using firebase and polymer
together so that's kind of an overview
of what you can do with polymer and
firebase polymer gives you amazing web
component front-end technology that
makes it really easy to compose apps
from to compose complex apps from simple
components and firebase does the same
thing by letting you compose complex
apps from simple back-end components so
that you don't have to run your own
servers this isn't what we want to be
building we don't want to spend all of
our time connecting together and
re-implementing the same things that
have been reimplemented a hundred times
before a thousand times before we want
to concentrate on the things that make
our apps great that make our apps
different and every minute that you
spend writing a bunch of boilerplate
that doesn't really need to happen is a
minute that I wish could be spent
building your app instead so do yourself
a favor
make yourself a nice polymer butter and
firebase jelly sandwich use the platform
and lose the backend thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>