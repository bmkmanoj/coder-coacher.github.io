<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Adapting to the Mobile Web F̶u̶t̶u̶r̶e̶ Present (Polymer Summit 2016) | Coder Coacher - Coaching Coders</title><meta content="Adapting to the Mobile Web F̶u̶t̶u̶r̶e̶ Present (Polymer Summit 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Adapting to the Mobile Web F̶u̶t̶u̶r̶e̶ Present (Polymer Summit 2016)</b></h2><h5 class="post__date">2016-10-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/K1SFnrf4jZo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so that last thing about the glee club
is completely true that was called The
Ambassadors it was in Carmel Indiana if
you've seen the the TV show Glee it's
basically that the joke was it was 30
suburban brats and a perfectionist that
was completely correct so normally when
I get up to give a talk sometime this
year I kind of put this slide on stage
and I'm really surprised not to be
giving a progressive about talk today so
Francis Berman and I named progressive
web apps last year that sort of taken
off since then and we've been working on
a bunch of technology behind that and
then starting about 2010 I guess four or
five years ago I worked with Alex
Komarovsky and Dimitri glazkov and we
started the project that created web
components it was a we added a bunch of
new features to javascript the language
too and so I spend a bunch of years
working on the platform kind of from a
lot of different angles with a lot of
folks who are actually here today it's
kind of great to see everyone out um but
since 2012 I've basically been working
on other stuff I haven't really been
involved in day-to-day web component
development and so this won't be that
talk I won't be talking about
progressive Web Apps I won't be talking
about web components I won't be talking
about es6 I won't be talking about any
of this stuff basically that I've been
working on for the last couple of years
um and yes you should probably make a
progressive web app you should probably
use the purple pattern you should
probably adopt the polymer app toolbox
but what I want to talk to you about
today is why the purple pattern is so
critical to mobile and I know that
mobile isn't everything yet it's about
to be everything Mobile is basically
about to be all of computing and if you
go to emerging markets it is basically
all of computing the next billion users
who come online will probably only have
phones they'll have devices like these
actually they won't be devices anything
like these um these are $700 phones this
is an iPhone 6s this is a pixel XL these
are 700 700 $2.00 phones basically
nobody has those
and what people do have though our
phones like this is a bag I carry with
me everywhere we'll talk about this in a
second
they'll have they'll have phones like
these this is a hundred-dollar phone
from last year's Android one line up in
India it's dual-core we'll talk more
about that phone in a second um and so
because people are running the software
that we make on devices like these what
we're finding out is that we're not
succeeding on mobile we basically aren't
and so I've been having to say things
like this to the JavaScript community
and it hasn't made me any friends in
JavaScript land and in fact I'm a little
bit surprised that Madden company
invited me to give this talk at all
because I have been making the polymers
very sad to Scott Steve Monica Frankie
and the rest the team will tell you that
this is basically the PG version of a
bunch of conversations that we had where
I would walk up with say well one of
these over to their desks and be like
why is this slow and I would do that
sort of continuously once every couple
of weeks I guess and and then eventually
we had a bunch of really uncomfortable
meetings where they would show me an
awesome new thing and then I would pull
out a phone and I would plug it in and I
would say this is really slow why is
this so slow um and at some point I
think it was Steve who you who you heard
from yesterday talked about being lazy
and I would say things like you need to
be more asynchronous you need to like
stop doing so much work upfront like you
need to like split these bundles up and
he would say stop telling us what to do
just just stop tell me what I need to
hit and so put a finger in the wind and
came up with it you need to be
interactive in about three seconds on a
simulated 3G connection on a call it a
$200 device and this next time that I
visit that same application I need to be
able to interact with that application
in less than a second okay so the one
way the stages of grief happened nobody
was very happy about it and eventually
what they came back with was the purple
pattern and we'll talk about why that's
so important and this is pretty
desperate stuff coming from me like I am
not the sort of person who generally
would be saying that you need to stop
loading a lot of JavaScript I've spent
years of my life trying to make it
that you have more power when you have
JavaScript inside of the browser spent
years working inside of tc39 I've
persistently advocated for extensibility
so that the bits of the browser process
the threads that you haven't had access
to like the network thread bits of the
UI thread the compositor painting layout
obviously the parser with web components
that you would have access to those and
you'd be able to plug into those with
script yourself and in a past life I
even helped make JavaScript frameworks
with Scott and Steve so to get to this
point takes a lot it takes a lot for me
to say you need to stop putting so much
script in your apps you have to have
really failed pretty badly to get me to
be sending this message so how do we get
here well I'd say that we've pretty
persistently failed users on mobile
devices and I think if we put the rail
model back in our heads we can sort of
understand what that means obviously we
talked about the rail model a bunch over
the last couple of days but we want to
respond to user input in less than 100
milliseconds we want to animate
everything in that 16 millisecond budget
to hit 60 frames a second but that means
that we probably have to do our work on
the main thread in less than 8
milliseconds per frame because we have
to wait for the browser to do the rest
of its work and we need to make sure
that we're chunking up our idle work
into relatively small chunks so that we
can remain responsive and get input
processed so we can respond in under 100
milliseconds and when we load when we
start to take an action inside the our
application we want to get back to that
interactive state in about a second so
this is long term user research been
valid in lots of ways
a thousand milliseconds was a really
hard limit to hit getting to a second
interactive in a second when you load a
document it's a really really really
hard thing to do on a fast network
connection on a desktop mobile is so
much harder than you think it is um so
how fast could we get like if we
probably can't get something loaded in a
second what's realistic well I think
three second
it's on a 3G connection history is
realistic for something that you can
interact with and this is sort of
buttress by some data that the
double-click folks went out and
researched and they came back and they
said there's real money on the table
this really caught my eye 53% of visits
are abandoned if a mobile site takes
more than three seconds to load and in
the same report they said the average
mobile page takes 19 seconds to load
collectively as a community we are not
succeeding on mobile we are not
succeeding on mobile ok let's just let's
just accept that we can be sad about it
and then we can figure out what to do
about it we have to accept that we are
not succeeding on mobile and so I think
it's worth asking why we're not
succeeding on mobile
we're smart thoughtful intelligent
people who are trying to build good
interfaces for users we don't want to do
bad things we don't want to make slow UI
we want to make something fast and
beautiful we want we want to really
actually deliver great user experiences
no one's trying to fail so that means
that it's can't just be that web
developers are evil and hate users I
don't think that's true I don't think
anybody hates their users maybe if
you're doing what support but you know
my first hypothesis though is that we
have failed at mobile because we have
allowed ourselves to only run our apps
on desktop so you open up dev tools you
see that inspector mode you see the
responsive design thing it emulates the
viewport of some mobile device and you
do your development then you're like oh
yeah this works great on the phone ok oh
who has used chrome inspect hey I like
you all right
who's using webpagetest ok cool cool
this is a good crowd I like I like this
but I think that most developers aren't
doing that because a lot of the traces
that I see are people who obviously
haven't tried this stuff out and so I am
a one-trick pony the reason that this
bag is in my backpack at all times and
it includes all of these phones is so
that when I go to a partner meeting
which happens a lot these days I can sit
down plug in a phone to Chrome inspect
and show it to them on a real device
on a 200-dollar device because that 200
ollar device is ground truth so to give
you an example of what I'm talking about
this was the aya website from 2015
this was a super cutting-edge
progressive web app it did push
notifications we had we barely I think
we had just launched push notifications
for the web in the release that was cut
and sent to users the week before i/o I
mean this was like this was bleeding
edge stuff they had a serviceworker and
on desktop this thing was punchy there's
this nice intro animation the whole bit
gets loaded Dom content loaded in 700
milliseconds pretty good get the on load
at about a second and a half at which
point that nice animation kicks in we
get smooth frames through most that
animation and the whole time spent for
all of that work to get the application
booted and get that sort of nice fade in
animation in specifics under
milliseconds in JavaScript so this is
this is a nice feeling app I do the
exact same thing which gets me to
interactive at four seconds on a nexus
5x using chrome inspect and it looks
completely different that big chunk of
JavaScript there that balloons to two
and a half seconds of straight line
script eval that is just a slug of
JavaScript at which point you can't do
anything with this thing
it gets onload at five and a half
seconds roughly the script locks up the
UI thread for two full seconds we spend
four seconds in script overall and we
aren't interactive till very late but at
the same time for having done all that
work we still get janky frame slow janky
frames um this is this is not okay right
we have to accept that this is not okay
and I think we're enabled because we are
one of the few software ecosystems where
we're running the same binary on the
desktop as we are on a mobile device
nobody runs a win32 app on their phone
you can't take an OS 10 Universal binary
and run it on your iPhone right nobody
takes a Java jar with the swing or AWT
or SWT app and runs it on their Android
device that doesn't happen everybody
else switched their tools when they
switched form factor we didn't do that
so we've been stuck in this world where
we sort of think that we have to build
everything or can build everything for
this desktop world and that it's okay so
traces from mobile devices are really
harsh masters and most the teams that
we've worked with over the past year
start looking at their thing on mobile
and they wind up like I said they do the
stages of grief mobile is really really
really hard and there's prof. Lee three
three major areas that make this so much
worse than it looks the CPUs the storage
and the networks so let's talk about it
because I think we don't really I think
most of us sort of have an intellectual
understanding of why mobile phones are
different to desktop class machines but
I don't think we really have thought
hard about the real practical
implications of that I say all the time
pretty much in every meeting that the
truth is in the trace the truth the
ground truth for your users is something
that you can go and you can copy a take
a snapshot of and send it to someone
else in your team and have them look at
it and so if you're not taking traces
and you're not inspecting your traces
you're not really going to understand
what's going on in the real world but
you can get tracing from webpagetest so
you can get them from dev tools so this
is my desk these are almost all of these
devices wound up traveling everywhere
with me including that 15-inch MacBook
Pro and almost every phone on that desk
aside from the pixel excel on the right
is about $300 or less and that matters
because these are the phones that most
people have I don't mean most wealthy
people I don't mean most of your
customers potentially I mean most of
your next set of customers probably have
phones that are not a $700 iPhone or
$700 pixel they probably don't so what
makes these things so different well
that 15 inch MacBook Pro has four
symmetric multiprocessing cores there
have got very deep pipelines they can go
from 2.8 gigahertz they can actually
scale much further than that in that
process and that process node it's got
16 gigs of ram but it cost $2,700 the
pixel XL has 4 cores same number of
course obviously the the
go with the i7 has hyper-threading but
that's sort of neither here nor there
it's got two of these quarters which can
go to 2.1 gigahertz and two of them
which can clock up to 1.6 gigahertz
which sounds a little bit weird right
it's not sort of the thing you would
have bought if you're putting together a
gaming rig
you wouldn't like pick different speeds
right it's got four gigabytes of RAM so
it's pretty good it costs 750 bucks it's
a real computer but you know it's
limited the Nexus 5x has two more cores
than that some of them even scale higher
than the pixel XL scores it's got less
memory but it's only 300 bucks and that
motive for G the $200 device is the most
in doubt in terms of number of cores so
why is JavaScript 10 times slower on
that moto 4G than it is on my $2,700
MacBook Pro what the heck is going on
these things like core count doesn't
doesn't predict anything right at this
point it's really hard to understand
what's going on here it's not the number
of pixels that you push right the
MacBook Pro has a very high density
screen the pixel has a very high density
screen too right 400 dots per inch on
that moto 4G right there all pushing
these things they've all got GPUs
they've all got flash-based storage I
think it bears repeating that if you
think the $500 500 pound iPhone that you
may be carrying with you is a stand-in
for a real device you're not looking at
ground truth because the top of that
line and the bottom of that line between
the pixel Excel and the iPhone class
performance and the motive for G is a
different world entirely worldwide
phones are getting slower more people
can afford phones now and when they buy
their first phone they're not buying an
iPhone they're not buying a pixel
they're buying $100.00 $150.00 $200.00
phone maybe maybe with financial
incentives and with pay-as-you-go plans
and the average network is getting
slower
most people are coming online on 3G
connections and many of those regions
feel like 2g connections
thanks to carriers let's not talk about
carriers it'll all make this even sadder
so this is the this is some code this is
a benchmark that the WebKit team put
together it's called notion mark
on my 15-inch MacBook Pro was between
Safari and a local build of chrome
chrome is in the hunt like we get
roughly the same performance sometimes
we're faster sometimes were a lot faster
sometimes we're a little bit slower and
it's a graphics Orion in benchmark but
the main thread is always busy this is
basically apples to apples on OS 10 we
can take the same version of Chrome run
it on the Nexus 5x and as you can see
that the desktop version is 25 times
faster right it's not 25 times cheaper
it's a $300 device but this is dramatic
this is a huge difference so I changed
just one thing and re ran this benchmark
a couple of times and got a
significantly faster result I think
you're gonna be really interested to
know what this one thing is across a
bunch of different runs I got this thing
to be 15% faster overall so what did I
do
what I view differently in the same
hardware in the same version of Chrome
right in the same benchmark is it magic
did I decide that I figures could be but
probably not instead magic isn't really
a thing right magic doesn't exist
instead it's science what I did is I put
this thing on an ice pack my colleague
Victor sort of figured this out that
this was the issue when he was trying to
picture in it and his team we're trying
to figure out why we're gonna use wildly
varying results out of this benchmark on
mobile devices and so they put the phone
in a fridge and then ran it again and
got a significantly faster result what
you're seeing here is thermal throttling
so the guts of a modern desktop style
computer looks something like this
there's gonna be a heat sink a big chunk
of copper or aluminum sitting on top of
a chip which has a metal top on it and
between those two is going to be a bit
of paste the same thing is true if you
open up a MacBook Pro there's gonna be a
fan that's evacuating heat out from a
heatsink which probably looks like a
thing with a lot of fins on it and
sometimes you see like these weird pipe
things these copper pipes connected
these aluminum fins but that's what that
is right we're just trying to take heat
away from the chip as
fast as we possibly can copper moves
heat away aluminum is heat away very
aggressively fans move that heat out of
the area and then we can continue to
dissipate power without burning out the
circuits in the chip the result is that
a desktop-class chip like the one in my
macbook pro rated for about 45 watts of
total power dissipation it can scale up
to about 60 watts of power dissipation
that's a lot of that's a lot of power
this is what 60 watts looks like if you
were to hold this in your hand I think
you would get very uncomfortable very
quickly maybe you're not as dumb as I am
but I've tried this so you probably are
going to be dissipating 60 watts in your
hand and your phone right the that's
going to be very uncomfortable we're
talking about heat transfer here right
like the back of your phone felt like a
light bulb you probably wouldn't use it
for very long so this is a major reason
why mobile devices don't have desktop
class performance for the same process
node in the same architecture it was the
same number of transistors the CPU that
turns more power into heat is the CPU
that does more math right so we probably
need to figure out a way to do a lot
less math to turn a lot less power into
heat if we're going to keep our hands
from burning on a day-to-day basis so
this is the inside of a nexus 5x this is
one I gave up the blue smoke a couple of
weeks ago I took it apart and this was
my daily driver phone for about a year
what you can't see here is that that
little round circle is where the
vibrator goes that blue that sorry that
square cutout next to it is where the
camera assembly goes that's one of the
hottest components in a phone below that
is the power supply and on the other
side of that power supply on the on the
same PCB on the other side of it is the
system-on-a-chip which is the CPU GPU
baseband processor all that stuff the
memory and the radio all in one assembly
so let's flip it over take a look at it
um there's no thermal paste on top of
that CPU there that's interesting
there's also you'll note I had to take
that little like a aluminum assembly off
that you saw on the other side but it's
not connected there's nothing to connect
it it's not actually a heatsink in the
normal sense and if
the CPU module you don't see it here it
says Samsung on the top but it is a
Qualcomm chip the CPU module is sitting
underneath that Samsung chip because
that Samsung chick is the RAM so think
about that for just a second to get heat
out of the CPU back out to the outside
world it has to go through one layer of
ceramics and then another layer of chip
and then another layer of ceramics to
air not assisted by anything else to
draw it out no fan there's no fan
anywhere in this in probably in any
phone you own thank goodness right and
this thing backs onto plastic two layers
of plastic two layers of plastic that
plastic is a terrible thermal conductor
the thermal conductivity of plastic is
about a thousand times lower than
aluminum right so in order to prevent us
from burning up our hands we actually
have to make sure that we don't run this
thing to actually draw that much power
it can't do that much math all of this
reminds me of a paper I read a couple of
years back if you have a couple of spare
moments I recommend it highly
it wasn't perhaps intended to be a
prophecy about mobile devices but it is
it tells us why so many of the
transistors that are now in those eight
cores that I'm carrying around on that
mode of 4G are dark most of the time
while they're not lit up why they're not
actually doing useful work for me and
that the reason is thermals and power in
fact the reason that everything is slow
is this I can hold 2,700 milliamp hours
in the nexus 5x battery or 10 watt hours
roughly think about that in terms of
power in the light bulb you get a couple
of minutes of light bulb power out of it
if you could actually draw that much
current at once which you probably can't
it would blow up the battery insert
exploding phones joke here so this is
why everything's slow because this is
the primary limiting constraint on a
mobile device this thing has to power
the Bluetooth radio the NFC radio the
cell radio Wi-Fi radio chips and screen
and you want it to last all day
on something that can't power a light
bulb for more than a couple of minutes
so everybody has an incentive to make
sure that you actually aren't clocking
those CPUs very high that they aren't
running very fast you're not drawing
that much power and it's it's much more
complicated in this these days what
you're seeing is something called
big.little architecture inside of these
phones what that means is that there's a
couple of big cores and they have deeper
pipelines they have more transistors on
them they have more cash not as much
cash as say the iPhone the iPhone has I
think something like four megabytes of
l3 cache one megabyte of l2 cache it's
pretty beefy device my macbook pro for
instance has six megabytes of l3 cache I
think the part that's in the mode of 4G
might have a megabyte of l2 and l3 cache
total right so spending power and
spending transistors on power power on
transistors is a big deal and you don't
want to do very much of it so these days
were aggressively moving computation out
to these little cores smaller power
lower frequency cores which can do a lot
less math but they are much more power
efficient because the amount of power
you burn at frequencies is nonlinear if
you scale up the frequency in a modern
semiconductor if as that frequency
scales up you burn more and more more
power per Giga Hertz over time and so
schedulers do a bunch of things to try
to make sure that this all works out
they try to aggressively move work
around they've got a lot of different
strategies for this your desktop is
going to use symmetric multiprocessing
your phone is going to use something
like clustering or if it's very clever
it'll have multiple ways of thinking
about each of those individual chips
powering them up and down and moving
work between them um we're finally
getting to energyaware scheduling
there's something called touch boost as
well touch boost is sort of like you put
your finger down and then the phone
spins all the CPUs up as fast as you can
the big ones in order to give you the
ability to do things like animate stuff
very very quickly and then it as soon as
it thinks it can it spins it all right
back down now the normal way that you
load a webpage looks like waiting on the
network to do some stuff and then a
couple of seconds later you get the body
of stuff you have to start processing
you might have scaled the CPUs back down
by the time you get that big bundle of
stuff back right when you launch an app
we spend a lot of time
os has spent a lot of time trying to
make sure that that app launches quickly
so they are primed to give you a lot of
juice at the moment that you decide to
launch a new activity or launch a new
application the web doesn't work that
way
our schedulers actually work against the
web's basic workload or at least the way
we've built them to do until today and
bench marketing is really a thing you'll
see benchmarks floating around about
like oh this mobile processor is almost
as fast as a desktop processor maybe but
you can't keep it spun up very long it's
not gonna be for very long you're gonna
be a good thermally throttled that
envelope is gonna close over you and
then you will have to scale it right
back down again
else you're gonna be holding a light
bulb in your hand right so all of this
should make us sad but it's worse than
that because storage isn't actually even
that good either when you look at the
read performance on my macbook pro again
I get about two gigabytes a second at
you know maximum theoretical transfer
across the storage my Nexus 5x even
though it has a nice flash storage
component can only get 400 megabytes a
second across that bus what's going on
well in SSDs parallelism is king it we
don't have to like wait for the platter
to spin around again after we move the
head to go get a read so our latency is
persistently low which is awesome but
our throughput is based on the amount of
chips that we can put in parallel and
then distribute reads to because they're
all gonna have a particular size for
each of the packets if you will that
they're storing so you can get a lot
more read throughput if you can actually
have a fast bus and then parallel wise a
lot but on that Nexus 5x mother bore
there isn't a lot of space for extra
chips
you can't parallel eyes so you have mlc
or TLC which is to say cells on top of
cells in like three dimensional chips
now are very popular for storage
technologies because they allow you to
pack more transistors in they allow you
to run them at effectively lower power
but that pen eliza's you in terms of
parallelism which means that unlike your
SSD where you can spread out a lot of
chips you don't have that ability and so
everything feels much much slower
especially when you're trying to read
sequentially or large chunks of content
the can
rollers aren't as good you don't have as
much free memory to throw the
controllers you don't have as much power
the file systems are now optimized to
some degree for this stuff but even when
they get full they still feel slow
basically a way to think about a mobile
storage device is that it's probably
about the same speed as spinning metal
from about 2010 that should make you sad
okay
then there's mobile networks if you
haven't I recommend checking out ilya
grigorik high performance browser and
networking they will also make you sad
the TLDR as a mobile networks hate you
they hate your guts they really don't
like TCP they don't like what the way
you use them especially if you're in 3G
they have wild variants underneath your
high-level protocol stack which your
head level protocol stack is not tuned
to understand you know the reno
congestion control algorithms the stuff
that's built into the our current modern
TCP assumptions doesn't work well with a
physical layer that we're assuming so we
see why hello variants in packet loss on
mobile networks in ways that simulated
networks don't really explain as Ilya
said a 4G user 4G user isn't a 4G user
most the time they're probably going to
start from a lower power state and radio
resource control means that you may be
spending seconds just getting that first
packet across the wire if you come from
that low-power network state this is
really bad okay I think it's only
reasonable to be sad about this the
tools and techniques that we've brought
over from the desktop area don't serve
us in this environment to make really
great apps we need to do things
fundamentally differently we need to
match the expectations of the OS and of
the underlying networks and then of the
underlying hardware capabilities we need
to load less script we need to load it
better we need to make sure that we are
doing work on demand and that we are
able to meet the CPU when it's spun up
so Paul Lewis characterized this in a
couple of graphs earlier this summer
today we wind up with these big
JavaScript bundles and then frequently
they they wind up feeling very slow if
you render block with them or you put up
a loading bar like Gmail does and you
feel like you've got a bunch of wasted
time at the front
when it finally evaluates you get a very
fast application now I've heard a lot of
application authors and framework
authors tell me that this is okay
because people then have these instant
applications but maybe your interaction
depth isn't very large and you're
probably gonna bail on that site that
double-click date is kind of compelling
you're probably going to bail if it
takes longer than a couple of seconds to
get there so we're seeing framework
authors do something that they think is
very clever they're saying I'm gonna
server-side render this I'm gonna do
universal JavaScript I'm gonna start
running this JavaScript on the server
spit you some HTML and then I'll load
that giant pile of JavaScript well that
sort of sleight of hand only works if
you actually get that JavaScript loaded
quickly enough but you don't so instead
you get a UI where you tap the glass and
then nothing happens because the main
threads lock now maybe we can scroll for
you because browsers are magical I do
threaded scrolling these days but um if
you tap on it and it doesn't work I
submit to you as a web developer your
thing is broken it's broken it doesn't
work so this doesn't work what we really
want is something that looks like this
we want to be able to load and run
things at basically the time that we
want to interact with them we don't want
to pay too much upfront we want quick
interactivity for all the components
that we can see and we don't we want to
be paying for stuff that we're not
currently using this is why purple is so
darned important because it actually
does what native app frameworks do they
delay view loading to the view
transition moment so this is the shop
app which I'm sure you've seen a dozen
times in the last couple of days on a
desktop class machine interactive before
in a milliseconds we've seen this story
before that's pretty good 200 seconds of
JavaScript yes so what it's gonna be 10
times slower on a mobile phone but here
were interactive at one point seven five
seconds on a 3G connection this thing is
interactive in less than
three-and-a-half seconds this thing is
amazing
um and it's 1.3 seconds of JavaScript
overall except if you look at that right
hand side all those little slices are
joint that means that I was interactive
at the end of that first big yellow slug
I was interactive so much faster because
of HTML imports in the way they do small
chunking they allow the browser and the
platform to schedule work in such a way
that you can remain interactive much
earlier so the other thing about the
purple pattern is that it adds a
serviceworker people send tend to think
that when we added service workers we
were trying to solve offline and we were
but the thing that I'm most excited
about them for is getting to reliable
performance the purple pattern and the
polymer app toolbox give you the ability
to always respond for a navigation out
of the local cache you never have to
wait for that radio resource control to
spin up the radio maybe over a couple of
seconds to go do DNS and then TCP and
then TLS and then HTTP handshaking to
finally get you some content instead you
can pull it out of the local cache and
boom the variance goes down and it can
also be faster this is why service
workers matter low variance high
performance reliable UI and you can see
this this is data from this year's aia
web app the light green is that first
load experience you can see it's a long
tail networks suck they hate you that
dark green that's spike up there that's
with the serviceworker it moves all of
that work to the front of the pack that
is reliable performance that's where we
have to be in order to be able to build
compelling native competition mobile
apps on the web so how do you fight back
please implement purple or as much as
you can mónica yesterday had ripple get
as far as you can please only load
things that you need for the current
route install a serviceworker to
prefetch things for your subsequent
routes break up your work to the best of
your ability push if you can and then go
buy a 150 quid phone please if you can
if you can afford it please go buy a
medium-price unlocked android device and
then use chrome inspect to see how it
works use lighthouse lighthouse will
tell you whether not your things at PWA
and it's gonna have an increasingly good
set of performance inspection tools
webpagetest.org is your friend you can
take traces from it um use chrome
telemetry inside of your continuous
integration if you have continuous
integration I hope you have continuous
integration and dev tools networking CPU
throttling are really important ok so a
lot of people haven't seen how to use
Chrome inspect so let's go take a quick
look very quickly I know I'm over time
but just very quickly this is a the UI I
plug in a phone that has been unlocked
for USB debugging and now I get a view
of this if I go to the network tab I can
throw
whatever connection it's on regular 3G
is a good a good starting place and then
if I go back to the time line I should
be able to hit ctrl R shift open Apple R
to do a hard refresh I'm gonna select
also capturing the paint stuff and then
it'll start recording it'll start
running this thing there is some
recording overhead but remember that the
emulated mobile network is actually
better than a real mobile network
because it doesn't have the same
variance and so now I've got a trace and
I can inspect it I can start to look at
where things actually started to show up
you've seen Paul and Sam navigate dev
tools you can go back to the videos and
see how best to learn about all of the
things that are causing this to be fast
or slow but the most important part
about this is I can now right click and
I save this and I can send it to my
teammates and I can share it with Drive
or Dropbox and we can start to
understand our performance over time ok
we can then go back into the chrome
inspector and we can load it back up any
chrome dev tools can load a trace that
I've saved this way I save this one on
the desktop so let's go there great and
then slow me from yesterday loads it
back up and there we are on any computer
with dev tools I can see how this thing
performed on a real device this is
pretty awesome
okay so there's also chrome tracing but
for chrome inspect but for tracing now
tracing is the dev tools equivalent but
it's a power tool it is the thing that
browser engineers used to diagnose the
performance of things when I use Chrome
inspect question mark tracing it gives
that little trace button there and now I
can record this is a UI that's again a
power tool but it'll let you see every
process and every thread of every
process that the browser is running
including all of your tabs and
everything else that's happening inside
the browser and it instruments it now
Chrome is a multi-process browser the
render process in the browser process
are different they talk to each other
over IPC this is the way that if you
start working with a browser engineer
we're gonna ask you to go instrument or
take a trace for your application and
then we'll dig in using this it works
almost exactly the same way
I've started to refresh the shop app
here I'll stop my trace when I'm finally
done loading it I can explore it it
feels very much like a videogame
WASD get you around you select stuff it
shows you what's happening takes a while
to open but again the important part is
that you can save your traces and you
can load them back up um and this is
everything this is everything chrome is
doing basically it'll show you the CPU
usage this is the resources that I'm
starting to pull in this case out of the
serviceworker and this is what's
happening inside of the renderer process
we can go select an area and see what
was taking so long here and this will
actually trace through HTML parsing via
execution and an ever richer set of v8
instrumentation lighthouse is amazing
please use it it's a Chrome extension
you can use it at the CLI Paul showed it
yesterday
please go install it and thank you so
much for making fast websites that are
reliably performant</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>