<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Polymer @ YouTube (Polymer Summit 2017) | Coder Coacher - Coaching Coders</title><meta content="Polymer @ YouTube (Polymer Summit 2017) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Polymer @ YouTube (Polymer Summit 2017)</b></h2><h5 class="post__date">2017-08-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tNulrEbTQf8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everybody my name is Mike and I'm
doing uh I'm a software engineer at
YouTube I work on features and cool new
tech and I also work at YouTube then I
work on web architecture and
infrastructure so we're going to talk
about how we use polymer at YouTube but
before that let's talk about just
YouTube just for a second so I know it's
kind of obvious question what is YouTube
you can ask anyone and the person will
say well it's where you go and you watch
media and it's a popular website and
everybody using that kind of makes sense
but so we know that YouTube's popular
but how popular we went to a lecture to
check and apparently we're number two
and unsurprisingly it means that we have
a lot of users who actually have 1.5
billion logged in users that are using
our website every month and not all of
these users are just abusers and
actually some of these users are never
using desktop at all but still dip dip
is one of the largest and one of the
fastest growing platform that we have
unsurprisingly people come and watch a
lot of videos how much 1 billion hours a
day and again this is across all
platforms but what is it billion hours
well it is 114 thousand years it's not
114 which would be a time before the ice
cream cone was invented or a namkyu it
actually enough time in one day to go
back all the way to the Stone Age
so every time you talk about anything
that we do you have to add that we are
one of the largest at doing that be it
just pushing bytes through the inner
tube or maybe huge hosting or
social network or even a search engine
so hopefully give the idea we're kind of
really big website so our motto is
broadcast yourself and that means being
inclusive so we right now offer
ourselves in 80 different languages and
this continues to grow
additionally we're accessible and we
considered a first-class citizen that
means even if we're building a website
from scratch it has to be accessible
from day one also we have to deal with
all kinds of weird browsers we have a
lot of extensions that are specifically
targeting YouTube and what are we
dealing with this crazy world that's
happening outside of us we do the main
thing that we want to do on YouTube we
serve our videos and we do it pretty
efficiently thanks to all the amazing
job of many engineers that spend a lot
of their time making sure that we do it
really fast actually it takes us less
than two seconds worldwide to start
video playback in Denmark
that's 1.5 seconds on the median way to
go then mark anyway YouTube is a very
huge and a complex project and by no
means it is a monolithic website we have
dozens of internal and external mini
websites that fulfill different roles
within the YouTube ecosystem and also
YouTube is I think 12 years old right
now which means that we have over a
decade of engineering decisions we have
over a decade of codes that we have I
mean we rewrite the code from time to
time but still we're talking about more
than a decade so we found this post on
reddit that we want to share with you
I'm fairly certain that in the eight
years since Google bought YouTube that
very little original code remains this
guy has a lot of faith in us so the
thing is when you spend 12 years working
on something you end up optimizing the
product and despite having this very
large code base despite working on it
for so long it is a very highly
efficient platform because the lot of
clever engineers spend their time
working on this platform yet we realize
that this platform has limitations and
at some point these limitations became
too obvious for us we're hitting some of
the performance limitations that were
unable to overcome with stacks that we
have and we're hitting some of their
engineering problems that were unable to
move as fast as we wanted to do so we
started to think how can we make things
better how can we move forward and what
will be the next thing that powers the
YouTube so what did we have what was our
starting point we have a server-side
render a plication and we always render
and server-side this happens even when
you go through pages and when we do in
Ajax navigations all the magic still
happens on the on the back end we built
a lot of homebrew frameworks then those
real frameworks it's more like tools
that we build for our products we do
have homebrew framework for JavaScript
we do have them for styling would you
have them for layout so basically we
build things that fit our needs at
specific time frame and the thing is
we're looking for something that would
be a little bit more more than that what
we had before and we had a couple of
goals we had a couple of restrictions of
what we wanted we have a couple of
requirements from the framework that are
going to we use the framework or library
we wanted a lightweight framework and
both in terms of the sizes it will add
to what we have and in terms of the
footprint on our ecosystem we wanted
something flexible we didn't want the
framework that would force us to do
things we have a lot of unique
challenges a lot of have we have a lot
of unique business reasons to do things
what some specific way so we didn't want
the code to be in our way we knew that
component model is what we really really
want there are a lot of benefits of
using components and you can look at
this benefit from different angles there
are benefits of organizing your code as
a component just because everything is
very localized there are benefits of
deploying and building application as a
set of component because by doing that
you create clear boundaries and then if
the framework can provide you with
encapsulation that happens on the client
that's even better
so we want a component we wanted to each
rate fast and at some point we realize
that what
we had was good enough the way our
engineers work is not efficient who want
to be faster want to build new cool
features and when new engineers join our
team will want them to be able to get up
to speed faster we don't want them to
spend a lot of time learning also we
didn't want to stay with a stagnant
technology and we wanted to do as few
infrastructure work as possible
it's always very beneficial when you
have a team of specialists working on
the platform that you build your
application on top of so we wanted to be
able to work with the platform and build
relationships and feedback loops that
are beneficial to everyone after all you
two calm runs on the web platform and
the health and growth of that platform
is good for YouTube also this is kind of
big surprise but we had a very direct
and simple order from our president to
make YouTube great again and that is a
real tweet we don't know why but that
was pretty obvious and we did anyway
back to reality we had a lot of
requirements a lot of features a lot of
processes at our website we do things
specific way because YouTube is an
existing product it's been live for a
long time we had to make sure that
whatever we do next will help us to
transition in the new world not break it
and we looked at polymer we actually
looked at many different frameworks and
now because we are here at the owner of
conference and we're talking about
YouTube at polymer it kind of makes
sense we pick polymer it wasn't that
obvious when we just started because
polymer was actually not the first
choice on the list but as we went
through this list that we check the
check boxes we realize that now other
frameworks while great and sometimes
fulfilling a lot of the checkboxes that
we had not necessarily give us the
flexibility and the full picture that we
wanted
and also the polymer at the time was
just maturing enough it was going from
0.5 to point a I believe so it took some
time for us to get used to the idea that
we're going to use polymer potentially
and just going and rewriting YouTube in
polymer that would be too crazy even for
us we didn't want to do something that
big so we wanted to something I wouldn't
try something smaller we started with
some tiny experiments some tiny internal
tools and then after that we launched
YouTube gaming this happened about a
year ago it's a variation of YouTube
that's focused on videos and livestreams
of games afterwards
we launched YouTube TV this is recent in
the last few months YouTube TV focuses
on TV streaming and DVR these two are
both complex projects with a large user
base but they're not on the scale of
youtube.com also known as one of the
largest vulnerable immens in the world
because again YouTube will do everything
at this crazy scale and building all
this amazing websites give us an
opportunity to learn it gave us an
opportunity to polish our infrastructure
develop best practices and at some point
we finally realize that maybe it's now
the time to do what we plant all along
right from the beginning and we
announced that we're launching or we're
building YouTube on polymer during the
last polymer summit and we're actually
launching YouTube on polymer and I don't
have an exact date but we're this close
to doing like this close to doing this
have very excited about that and this is
going to be the largest polymer
deployment in the world obviously right
because this is YouTube and we do
everything at scale I mean we're pretty
confident is going to be the largest one
I really hope some of you may have
already seen articles or have even tried
it
the important thing is YouTube is
available for opt-in right now yep you
just go to youtube.com slash new there
is a big button right in the middle of
the screen you press it
against the new experience and also
please there are a lot of articles from
our internet talking about how you can
edit cookies and everything will be
great
everything will not be great don't do
this it's not the right way just go to
just youtube.com flexion you so what is
it made us well the site is 100% polymer
and by that I mean from the app tag down
you can inspect the site and you can see
all the components right there
we have about 400 components there are
just YouTube specific more than 1000
components across all the code bases and
we are happy that we can share a lot of
our components across different projects
so let's talk a little bit more about
how we use polymer at YouTube but before
I go into that let's take a small step
back and let me explain to you that we
have this thing called it's our
universal data API and it kind of shapes
all the applications that we build keep
in mind that YouTube runs on everything
also following a very sophisticated
naming process we internally called it
inner tube so here's a small set of apps
that run on this universal data API and
we're not just talking about web we also
have apps on iOS Android game consoles
TVs and of course different verticals we
have apps for kids apps for creators
apps for TV apps that replace your TV
that run on TVs and all know everything
and all of these run on this universal
data API so what does it look like well
what we ended up with is a
presentational API which is an API that
structurally kind of defines how your
page structure will be based on the you
know data response in JSON and we found
that this structure Maps really well to
web components as each web component
receives data that data defines the
children that that web component will
render underneath it and then in that
component it takes a subset of data some
subtree and passes it down to the child
this continues until you hit a leaf node
and while doing this we realize that
what we do is bender a lot of lips
in fact YouTube YouTube's a bunch of
lists you may think that we serve video
but from a web framework side of you
what we do is draw a list over and over
and these lips are super dynamic the
machine learned experimented on the rink
in their massage and every single time
that you come to YouTube these lists are
e ranked we experimented on and it's
going to change also if you're a list
fan this is I told you so moment so this
is a standard YouTube channel page
there's some obvious list here you think
about it but I'm going to highlight just
a few to make it a little bit more
obvious there's menus they got
navigation bars search results
subscriptions or is also shelf video
lists list of horizontal shelves video
is and again these change their dynamic
and every time you come to a site we've
got to redo it also we have to stop at
some point and this is not all the list
we have but the screen shot became too
crowded to actually show all of them so
because this is so important we spent
some time and optimizer list rendering
we do some of the basic stuff that's you
know pretty well known now Dom dissing
efficient reuse of the Dom but we also
do other things like signal based
deferral that means that we can block
some of the content rendering and you
will get a specific signals and to name
a few we can wait for the content in the
viewport to appear or we can wait to the
video to start playback as well as doing
that we also do lazy and budgeted
rendering to explain that I have kind of
a simplified view of how the vendor
thread works people think you play video
you know if you go fetch some video
bites you give it to the put the browser
and video plays but YouTube's not that
simple
we do adaptive bitrate we use - that
means you have to use the media source
extensions which means the render find
of looks a little more like this this is
still a simplified view but you got to
fetch the audio bytes the video bytes
you got to initialize the video API you
got to pend those bytes and then at some
point video starts playing
and so you can see that the render
thread is actually fairly busy handling
asynchronous events and then you
introduce UI code UI code can take a lot
of render thread time and so in this
case you get these squiggly lines and
what those curved lines mean is that
we're not able to receive an event on
the render thread as fast as we would
like it to be so how do we solve this
well with the scheduling system that we
have with lazy lazy rendering and
budgeting we try to break up our tasks
our UI code into small chunks and sit it
in between the time that these events
come back also we're cheating a little
bit on screen shot because this green
shot well there are no user interactions
here and our users tend to do all kinds
of weird stuff like typing or scrolling
or sometimes resizing the page and while
that obviously can affect the
performance splitting our UI into
smaller tasks allow us to have as high
FPS as possible in this cases also I
mentioned scheduling we have a global
scheduler on the YouTube website and it
also deals with priorities this is very
important because not every single piece
of code and not every single piece of UI
is this has the same importance so let's
say you come to the YouTube watch page
the most important thing for us is that
video this is the thing that we want to
prioritize over all other elements on
the page but following that we have
things like the watch next this
generates a lot of watch time on YouTube
so you want to render this next and we
do this in the lazy budgeted format some
things then are actually extremely
deferrable
like my comment here also we know that
YouTube comments doesn't have the best
reputation but they're kind of still
important we've gotten a lot better
basically this rendering it's a
foundation of performance at YouTube so
let's talk about the development process
how does it look from inside for
engineer working for Google well the
cool thing about heading components is
that as long as you can render this
component as long as you can create it
separately from the rest of your
application you can bypass a lot of
issues that we have before
again YouTube is very large bringing up
the development environment to work with
YouTube takes time and takes resources
and being able to just take one
component and then test it separately or
create a demo or feed it with some data
to put it into a specific state is
critical for development process so this
is an example of a component and this
the kind of image on the left is what
the engineer created this is components
that consist of some other components
but the pictures in the center and on
the right is the two special flavors
that are created automatically unless
the engineer wants to change them in
some way and the middle screenshot is
the dark node also I will highly
recommend trying it on the new YouTube
and the right image is the RT also right
to left version of the website and all
of these versions of the components are
being tested screenshotted separately so
you can see here there's some changes on
this on this component it's not very
obvious just looking at it but once we
add screenshot clipping we can tell the
things have shifted down some padding
has changed this is a level of testing
that has never been possible at YouTube
before but we've really embraced it in
the core part of how we developed now in
addition to that we took this granular
component and testing approach and took
a little bit further and we created
something called storybook and what
storybook is is a way for you to
interact with the component during
development we have here a storybook for
something called the video list cell and
on the left of that storybook or the
component is a list of stories that have
been generated this is either a fixture
that we saved before or some data that
was automatically generated and this
allows you to kick up a storybook and
then click on any of these stories and
you can see your component rendered in
that state and this is the pretty much
one of the best ways to interact with
the component during development but
moving further we integrated storybook
into our internal polymer catalog which
is
another way for you to bring up a
component without needing to type
anything on the command line you can
search for a component and bring it up
at any time and let's commit history
because we've integrated this with our
version control system you can browse
the documentation bring up the story
block the unit test and look at the API
and all that stuff also all of these all
these tools are polymer projects so
welcome to the component inception
because the polymer dashboard is a
component or set of components rendering
a storybook which is a set of components
rendering a component which renders a
lot of lists so what's a state of
polymer at YouTube we mentioned that we
have over 400 components on youtube.com
and over a thousand components across
all properties so we have a data model
that Maps really well to web components
we have a highly optimized list
rendering system and we have a suite of
component level testing and debug tools
but there are a few things that we're
still trying to bring up to date which
probably not a big surprise from a
website as it just drove ie9 support so
we're still on polymer 1 dot X we got a
lot of stuff to migrate and we're moving
to hybrid elements which have made it a
very easy migration path we're really
excited about polymer 2 it has a lot of
increased flexibility and extensibility
that we're looking forward to and we're
still on shady Dom so YouTube's a little
bit more conservative when using these
really cutting-edge api's so we're still
relying on polyfills but we're really
excited about shadow Dom and we're
moving our tools and our infrastructure
to support this in the future so to wrap
it up we feel like we're building for
the future
we finally have modern tools and we're
working with a web platform and we help
push the web forward the site is now
faster to iterate on and we had much
better test coverage than we ever had
before and while this is partially
thanks there's a major rewrite a polymer
played a major role helping us organize
our internal workflow overall the site
is faster that's up to 15% faster
depending on the page
and developers are happier we finally
share components across our projects and
we're using a standard stack instead of
developing everything by ourselves and
we can't wait to start shipping all
these cool new features after we launch
thank you to everybody</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>