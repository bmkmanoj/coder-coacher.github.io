<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Router: Live code Session - Supercharged | Coder Coacher - Coaching Coders</title><meta content="Router: Live code Session - Supercharged - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Router: Live code Session - Supercharged</b></h2><h5 class="post__date">2016-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Sw-ICM_V1eQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello and welcome to the supercharged
livestream I'm Paul and I'm Sarah he's
my favorite of all the servers today
we're gonna build a router now strictly
speaking a Rooter well it's not a UI
element is it really typically but it's
in control of you transitions
particularly and something like a
progressive web app and somebody
recommended this have suggested it on
Twitter and we talked about it we
thought yeah why not let's give it a go
and actually I realized as I was
thinking it through that there's plenty
of opportunities to do some some fun
stuff in there not least of which will
be some custom elements so we're gonna
give that a world today I haven't done
much with them they have just seemingly
landed
for reals in a bunch of places anyway
we're gonna give it a go what happens
who knows that's why we watching it I
suppose because anything could happen
cool right
as usual couple of caveats firstly the
code will be prototype style code it
won't necessarily be like production
ready always worth mentioning there may
be accessibility issues and things like
that that would also need to be sort of
dealt with before taking it further but
I'm going to be mainly focusing on
something that hopefully will be
performance and some there will be a
good first iteration all right so that
out the way as always I'm gonna be here
in the chat and on Twitter
looking for other questions that you
have because as always you have the
chance to actually influence where we
are going with this and interrupt us and
maybe confuses and make us more bugs
yeah then you intro Tim here interrupts
me it's oh good it's like real life
she's fine it's fine it's fine I'm gonna
code now right so what we get on screen
yes so one of the things I want to say
is that I'm gonna be building this
router as though it was a single page
web app where all the content is going
to come into the page on the start and
the reason for that is purely for
simplicity at this stage so that this
live stream doesn't run for like hours
and hours and hours so bear with me
right so what I'm gonna do is I'm gonna
drop in I'm gonna drop in a custom
element
I'm gonna call it up did you know what
we could have come up with a nice to
call it tell you what super knows you
can I'm gonna call it super rude here
super rude I'm gonna call sc4
supercharged there you go and see oh we
got some branding in there why not
that's great it's a really good start
script why not
source equals static to do this static
SC Rooter is this it seems like a think
that I would want to do right let's drop
in this father a new file s see that
just like that I'm gonna be jeaious so
recently I told you about my project I
was building a route and also be proud
of not told you about it and how I used
all these fancy techniques and you were
like I totally did that half a year ago
and I have new ideas so thank you for
making me feel like it is actually
hoping I will make me sound like a mean
to you you are the nicest I'm the nicest
something fine anyway you're a decent
work colleague decent you are a possible
work colleague Paul I put up with you
most days so yeah good right document
dot register register element and we
were going to call that what we call it
we called SC Rooter and we'll go SC
Rooter now if this works
we'll do a touched callback which I love
the name of that because that's like
don't need extense yes Adobe and extends
HTML element thank you
extends that and we'll do console.log
attach look at that all being well let's
see myself that one expected number what
did i do a number in line two hmm that's
weird
hmm wow we have an issue you know stat
stat static there we go let's try that
yay it's because I'd so what I've done
is I just so you know because I'm
expecting that we'll have deep links
like you know / about / whatever we for
our different sections we're gonna route
between I want whatever URL I go to when
I hit refresh I wanted to come back to
the same index.html I'm going to route
to the same index.html and so I've set
up a an app engine like single file
Python kind of thing they're just routes
does that reason for me so what happened
there was it was sending me into the
wrong file so that's good I think the
whole thing is called html5 routing
which is something that on the front is
very popular using push thing and
actually using proper URLs but all the
development servers don't necessarily
have good support you always end up
writing like a three line Python file or
a go file to actually and relate this
entire behavior yep okay so in the
attached callback so what we want to do
is we're going to do let's see window
dot and event listener so we know that
we're gonna get pop state I'll do this
dot unchanged I guess that's the change
here unchanged there we go and then we
can do detached callback so if we remove
to remove this Reuter element could do
window dot remove event this and you
know what I've realized I'm gonna do
this stuff on changed but I'm gonna have
to do it like this I'm gonna do the
special because otherwise it will be it
will be run against the event so we
should be created callback um there
might be but we found out created
callback otherwise it would be binding
or like creating new bindings every guys
attached sorry fine
yo-you here to help hello let's find out
created callback oh there is one let's
do that then that's like C in classes
world that would've been the constructor
right true so there we go so we created
so every time we create one of these
will create one of those when you attach
it great when detach it will get rid of
that that seems good
so other
we'll probably want to do I should
probably ought to call the on change so
my on change is going to be the thing
that I think is going to be watching for
whatever the current path is and then
it's going to be the one that decides to
know what to do with the views I guess
interesting question for this is where
do you draw the line what the job of a
ruler is hmm what what is it supposed to
do and what is outside of its scope what
are you planning on putting into this
route in particular okay so yeah that's
really good question because one of the
things that I've discovered over doing
routes is for a good number of years is
that oh let me let me put another way
the mistake that a lot of people seem to
make as they make their routes are kind
of only passive so it's only ever
watching the URL change oh yeah I I felt
the pain so then what you do is like in
other parts of your code you like I'll
change the URL change here change it
again tint it here and the route is kind
of going do I now control the view and
switch you know switch that out would
who's doing what here and you get this
is really uncanny valley if everything
goes through the router it's active as
well as passive doesn't it's the one
that changes the URL and it's the one
that controls everything that one tends
to work out much better so that's the
model I'm gonna go with today and I feel
I agree like it feels a little bit weird
that's the ruler should influence
certain visual aspects like changing
classes or actually triggering
animations but once I get over that it
feels so good and it feels very robust
so I think it's a very valid concept for
okey doke
so what I want to do is I think let's
assume we've got so like I said this is
gonna be like a single page app where
all the contents in the HTML so we're
just going to switch between these views
inside the HTML a better version of this
would be something that loads those
views you know over fetch or something
like that and then populates dynamically
but for time I'm not gonna go with that
today I'm just gonna do something else
so let's just do call app view something
like that super charge of you know that
make you happy let's make you happy
they're super charged view let's have a
few of those and let's say this is like
the about and this is the
and actually let's make this the like
the home view it's gonna be about
contact and some kind of Miss risk
that'll do it right so we've got home
about contact and misc and what we tease
is we're gonna do I suppose is we need
to have a route for each one of those
views so I'm going to put like a route
attribute on here and I'm gonna be like
I'm gonna make it as a regular
expression because that might be helpful
so if we say it begins with home in fact
the home we'll just do is the forward
slash and then it should end with yeah
so that will be fine root equals about
that should have the slash gone you'd
sound like you're about to interrupt
yeah we have we have a question yeah so
which is kind of mean because I make you
use the creative callback and now we're
being asked no constructor but create a
callback I know and I think it's just in
the in terms of custom elements it feels
like you should more rely on the actual
lifecycle callbacks then the constructor
because the the good searcher doesn't
get cold at all no so if I tell you what
we'll do is let me just finish this up
contact and we'll do a misc here let's
do this
where we do constructor at the top
constructor console.log hello well and
the reason is as far as I understand it
this the register arm is going to take
the prototype and all these functions
are going to be on the prototype the
constructor is the instantiate er it is
going to be on the actual as it were the
function in old-school terms so this one
should never be called all being well
see so we have our thing so since the
Constructors never called you do
actually have to rely entirely on those
lifecycle callbacks so in terms if
somebody doesn't know classes are just
syntactic sugar on top of functions so
all the code you have in a constructor
is in that function that you can use
with a new operator in this case this
has never been used because we are using
custom elements API so it will take care
of you ripping out functions from the
prototype and actually putting it onto
an element to the constructor is just
being thrown away effectively
yes at this point SC view so I'm going
to make a new one for the view
DJ us and we'll do SC view and then
we're gonna do document dot register
element and we'll do SC view and then
we'll do SC view here like so and we
don't want to construct anymore we want
let's see we do get root and we will say
return one of the reasons I like this I
need to extend HT next and HTML element
again return this.getattribute so
because it's an actual HTML element it's
actually really quite nice well done -
Rob Dodson for suggesting that I do this
bob-dad the donator
also known he suggested use like when
you use custom Alice so good on him all
right so get out to be root or not and
it's actually viable to use custom
elements if the polyfill is 66 kilobytes
gzipped yeah and it even works in Safari
so and it makes your app so much more
structured yeah I think I think it's
like ie 10 plus as well so it is fairly
well supported I'll drop a link in the
chat good man right so when we attach
what we want to do is I think we want to
do this starts create routes or
something like that
let's do that and what we'll do is we'll
do documents I'm going to do this kind
of a decorative way query selector all
or SC view I could do for let view of
that so because it will give me that and
I can do
if view dot root that should work I can
do it if not continue
continue so if we don't have a root for
some reason view dot root and I can say
new regular expression because I want to
make a regular expression around that
and I want to make it case insensitive
and then I could do let's see so we need
it okay so this dot oh I tell you what
I'll do this stop create yeah create
root that and then view and you need to
actually make this right which will be
the root and it will be the view and
then we'll say this dot roots dot set
root view and we can say if this start
roots because I'm gonna do a map here
has look at you
I know return console dot warn roots
already exists because we don't want
multiple roots being handled by the same
thing here at this point I mean again
you could an improvement to this would
be something that's a lot more nuanced
in terms of the roots it supports and
stuff but I'm again I'm not going to go
there just at this particular point
let's do that actually I made my root so
let's do that if we've already got the
root otherwise do this so we need to
actually create one of these so the
created callback we're going to do this
dot roots equals new map and what we'll
do is when you attach it we will do this
dot yeah do it here
I see we keep it in the create routes
mmm now they're here this dot roots if
we do clear let's do a clear roots
function there you go that'll do it
create root clear roots there we are
this dot roots clear should clear them
up so just to summarize this you're
grabbing all the SC view elements on the
page you're grabbing the records out of
the attribute and building a map that
maps from the root to these individual
yes I am exactly exactly what I'm gonna
do and let's just make sure that this is
actually working
console IC working we're just gonna just
I mean you could use the debugger
statement here but for me this might
just be faster I was gonna say faster
but maybe not of I don't know if
coastguards iterable maybe we need to do
area from mmm on area from take sniff
herbal as well that's really soft let's
do chrome chrome see which version it's
up to date let's see whether it's
localhost:8080 yeah you see it's in the
it's in the nor new chrome I wonder
whether the chrome I had there was a
little bit on the older side that make
them very well have happened let's
switch the canary then or we just do a
radar from which would also work I mean
zoom in on all of the panels on all of
the things there you go
good man good point well made sir so
since that didn't actually fire though
let's just let's just find out what's
going on console that log view because
we expected something from that we
definitely get though we get all the
elements it's a nice view dot root so
let's see if oh I know why I know why
because I have the Rooter but I don't
have we don't have any JavaScript for it
there we go so now they're actually
they're actually being instantiated and
handled nor that kind of stuff and
that's great news so now we've got a map
with all the routes and the views what
we'll do is let's throw in again you
would probably component though this a
little bit better than I'm doing
s-see let's just do style super styles
super styles that CSS why not
and we'll do a link so we have a couple
of people in the chat who apparently are
not that familiar with the es2015
updates on the JavaScript language I
encourage you all to located and and use
it because it makes JavaScript so much
better of a language yeah the amount of
pain reduces in in just addressing
certain prompt that you usually
encounter when writing apps it's so good
I actually love my body padding:0
hopefully you can still read what I'm
rutted typing you know I know it's a bit
different but hopefully yeah that's what
I want that's the old one it's old
Chrome let's switch across there from
there to there okay so that's working
and your information
yes 2015 used to be called es6 es2016
was year seven yes and now we might we
have since they're planning to do a
release every year they're sticking to
the year based yes yes there'll be no
yes anything below 2015 right yes yeah
we just skipped two thousand versions
yeah it's good that's fine all fine it's
fine
there's nothing wrong with that but it's
actually really helpful I think because
it kind of puts people in the mindset of
it's not just this major release version
no I don't know why they chose it but up
I here and I'm like it just kind of
gives you a rough idea when this thing
actually landed you know not necessary
and the support foam is amazing like a
cross browser now like even a year ago
it was like oh you need a transpiler
now you know if you're on an evergreen
it's something really good and if you're
not you've still got the transpilers
most browsers have like 99% support or
Eevee carries off years 20 yeah it's
really solid
right back to the code then so what I'm
going to do is I'm going to make each
view I'm gonna do like position:fixed
top:0 left:0 right:0 I'm gonna do the
the right and bottom zero thing I'm not
gonna do with hundred homes and I've
improved as a human okay so that would
in theory place all the views on top of
each other like that which is fine let's
see so
I'm going to do opacity:0 and I'm going
to do
let's see personally I'm gonna do
pointer events and I'm going to assume
that we'll have some kind of visible
this is the active view class so let's
do a visible visible anybody who's seen
my IO talk knows what I'm doing here
about using point I'll pass t0 and
pointer events and on the reason there
is when I want something to be primed
and ready for animations it's not always
perfect but basically if I set
visibility to hidden or display to non
they'll be remove from the render tree
this way it should be a little bit more
prone and really touchy might bring the
view in but again this will be a
trade-off because you potentially got
all these views ready to go and so if
you have lots of them again it's I think
a more advanced version and we can come
back this if you're enjoying the the
Reuter when we're done we can come back
and we could do a under the live stream
where we take it on and do like the more
advanced stuff that we probably won't
get time to do refine the entire thing
you may have been requesting Twitter for
example yes which is why you should be
on the chapter in the whole hi I have
ideas because that helps us a point
about Auto right so when the the view is
there and when it's visible we'll do
that so that's fine so we don't actually
have nothing on screen because they've
all been set to hidden which is fine
what I'll do is I'll just do like in
class equals home some time maybe just
like view home you about you contact
view misc that's good so what I'm gonna
do is I'm just going to color code these
so that it's kind of a little bit more
obvious background red that's gonna be
bright contact is gonna be a blue let's
see what else did I have at home easily
I admit that was the last one and about
about okay I think yeah I hope I'm not
screwing you over right now no I'm sure
you know it's black color
white and background green wow this is
gonna be really horrible oh well
Paul writes tremendous code once again
24 pixels let's do font family family
Arial there we go okay so we're all
kinda set except for the fact that now
we've actually got to make the Rueter do
its thing and for that I think we're
gonna have to have a nav so I'm going to
create a nav so we can actually kind of
toggle between these various sections so
let's see the URL Oh
all right and this is the point where he
goes use Emmet because you're being so
slow Paul it's like fair enough and I
still haven't got to doing that you know
yeah so we've just been asked that you
very prominently keep saying as long as
you do all your stuff in 100
milliseconds it's fine if you want to
start animation or something yeah so and
apparently and on a desktop obviously it
works in under 10 milliseconds to just
attach something new to the Dom have it
rasterized yeah so keep in mind that
this should also work on mobile and
mobile devices are not as fast at
rasterization so that's why we have to
resort to actually keeping it not only
in the Dom but actually having to keep
it painted yeah and actually opacity
zero my age TV there might be an
optimisation I think in chrome that
basically would stop that being painted
so we might have to work around if we
see a big sort of kind of a big green
flash when the view first shows up I'm
hoping we won't see that today but we
might but yes whoever let's get that
question absolutely so we have this
performance model called rail if you tap
something and you expected something to
sort of happen on screen in response to
that tap you want it to happen in a
tenth of a second otherwise it doesn't
feel good it just feels like and that
kind of upsets users but whoever's
saying is like when you attach something
it takes a long time to kind of get from
zero to something that you can show is
absolutely right and that's why you've
got to be really tactical about kind of
attaching and detaching things and it's
a trade-off because you've got memory
constraints and all that other stuff
right so we have
if I'm not confused yes we've got an Ave
with the bunch of links to the various
sections and let's see what do I want to
do I want to actually style that I'm
just gonna go go ahead and just star the
nav directly today now I'm gonna do
position fixed oh right
10 top 10 pixels and I'm just gonna say
background data and I'm gonna do a box
shadow because why not not 2 pixels 4
pixels RGB a 255 255 255 not 0.3 I enjoy
that one part white shadow 10 oh you're
right no I meant 0 you've written that
particular line of Boxford I think a
million times
no just what's going on with me today
dude border-radius that's what I mean
yeah 3 pixels all right it's all being
well we end up with some kind of yeah
okay so look at that is not the
prettiest top right bottom left just do
you have a mnemonic device to remember
in which order top right bottom left is
so it's a compass north east south west
clockwise the mathematical order would
be counterclockwise I don't know but I
just remembered as north east south west
so there you go anyway so it thinks I'm
there now by default as I say this would
actually take you to these various
sections which is absolutely what we
want so you can again in the kind of the
perfect world scenario the server would
actually just respond with the HTML for
each of these pages in my case it's
responding with the same HTML which as I
say is just to keep things simple so
it's not very available but right now
it's an actual link with an actual
complete site reload yeah and that's
really it is actually an important thing
that we progressively enhanced
especially if you're making a
progressive web app with the kind of
clues in the name
and again part of this is like taking
real links and then we're going to
hijack them but it means that you can
actually get to the various sections if
javascript is disabled or there's some
kind of error or just something goes
wrong you know it should be that it's a
link
should work so that's what I'm trying to
do at least trying to maintain it at
least in this simple version as I say
you could be a little bit more advanced
about it right so the other thing I need
to do is I'm just going to this is going
to be pretty raw this bit I think so
what I'm going to do is I'm going to say
document dot query select a role and ask
for all the anchors I'm going to do for
let link of that I'm going to do link
dot add event listener on click for
clicks and unclick function unclick this
is one of the bits that is not
production quality code properly
we're hijacking all the links yeah and
we don't care we just write prevent the
default and then we're going to do see
what we need we're gonna say Const
Rooter equals so far the people yep
gained a lot more viewers in the
meantime so for the people who's joined
a little bit later hi hi this is Paul
hi this Irma and we are building a
Rooter so we open the component actually
handles transitioning between the
different views in your app and
hopefully it will do it in a very nice
elegant way and we're actually using the
custom elements API the same rounds
we're building our own elements I mean
it's all new to me but that's the point
of being a web developer sometimes isn't
it you know try new stuff I mean there's
always new stuff to try we're never
short of new stuff to try and so far
yeah we basically got ourselves some
some views that we're gonna transition
between got ourselves a non-visible
element for the router and we've got
then some JavaScript that we're kind of
working our way through and at the
moment I'm just hijacking these anchors
here in fact I'll tell you what I'm
going to do is I'm going to grab the
let's see the nav anchors so it's just
the anchors there so question question
with another question we had in chat yes
the question was what does defer mean on
escape and I actually know the answer to
this one myself go go go go so deferred
means that the evaluation and execution
off the JavaScript will be postponed
until the entire HTML document has been
parsed and put in
to the Dom so that this way this script
tag becomes non-blocking so if you have
script tags at the top and you have to
defer you won't block until this job is
run but it will continue parsing the
HTML put everything on screen and then
execute the JavaScript and into that I
want to remark that you have referred
your custom elements JavaScript but not
the one that X is but you've used the
API of the future will that work good
point
the defer I don't know we'll find out
the defer also means that these should
be executed in order as well that's the
other thing that's important it's very
important to know there is there are
bugs in all the browsers where that
doesn't necessarily end up being true so
you've got to always be careful you
might need a script loader again
I'm just operating with a certain bunch
of assumptions but for production yeah
you'd have to probably figure some of
that stuff out should we find out
whether it actually yeah that would
actually be very interesting well I
don't see any errors that is amazing so
I'm gonna call that and it says rooted
octo is not a function because I haven't
actually written it so we should add
that so when you call go this would be
the active part now so I'm gonna give it
a URL and I'm gonna do window dot
history dart push date and I'm gonna say
no which is the state object or is that
the title oh well it's a state object
then title then the URL yeah so we want
to do that and then we want to say this
dot unchanged so we're going to push the
URL and we're gonna basically in the
same way when you pop state here we're
going to check what the current URL is
so then we will now need to go in here
which is our unchanged and we'll say
this dark roots going on what we need to
do at E what we'll do is we'll say Const
path yeah window dot location dot path
name how exciting we're going to ask at
words ball words here we go yeah yeah
that's the one we're going to actually
ask what the path name is and then what
we're going to do is we're going to
let's see before watch do we want to do
a four no I think what we'll do
const routes equals array dot from and
we're going to do this dot routes dot
keys so this will be all the different
regular expressions right yeah so I'm
going to do that and then we're gonna
say const routes equals routes dot find
and we give that a callback function so
if the route is if we test it against
path so that works that should be there
if we don't have a route we can return
so basically this is if we don't find a
match now if we did find a match this
would be the bit where we now need to
kind of kind of start toggling views and
so on so let's have a think about this
so we need to sell we need to find out
which view it is so so const view is
going to be route this dot routes dot
get and then we're gonna get the from
the root and that will give us the view
back and oh we're probably going to want
to keep a track on that so it's the
current view so if it's the current view
then we are actually not tell you what
we'll do with a const new view and so we
can say if there is a current view just
bear with me i think this is gonna work
so we know when it yep yep okay so
there's a current view mmm thinking it
through okay let's see what we need to
do so the new view by default what we'd
want to do is we want to say new view
dot in let's say we've got a function
that's going to do that but we know that
if there's an existing view we have to
transition that out right so let me
guess there's an outer function there's
an oh yeah I'm sure I'm assuming by the
way I'm gonna put let me see there's
going to be an in function here there's
gonna be an out function as well when
this view has to leave and we're gonna
do an update function in case you kind
of go to your in slash about and you go
about something else we're just gonna
tell the current beauty like update
itself so we'll assume they all take
some kind of date
which I think we can probably figure out
from the regular expression right so we
get the roots and let's see so we want
to know if there's a current view so
okay so let's do this
if this dot current view yes do that if
there's if there's a current view and if
the current view is the same as the new
view then we tell the current view to
update and I'll tell what we need to do
as well let's do they get the data
Kant's data equals you see a B root duct
yeah B root dot exact against the path
that would then there execute against
the the regular expression against the
path name so cuz I in my in my code here
I've got like capturing stuff so that in
theory that can get passed through and
then the view could decide what to do
with that data when it's got it so
that's kind of kind of handy so we need
to pass that in there so if there's a
current view and if the current view
match is the the new one that we've
tried to bring in then the current view
can just update so we cannot we could
return there so we can return that here
we're gonna do this dot current current
view dot out which gonna pass the data
as well and we need to wait for that to
finish before that one comes in so why
do you need data in out you never know
you never know because I so let's say
for example you're going out from your
current view and let's say for example
you're doing a fancy transition from one
section to another let's say you got a
fancy transition from about to get to
contact and that's different from your
standard one and what you might do the
the date is going to contain the new
path so you're going to be told you're
gonna be telling the about view whose
incoming yeah which in this case will be
contact amigo oh I've got a special case
for that I'll do my animation for a
problem that I have run into right now
I want to have a special animation for
an overlay there you go and it just
looks stupid right now so I might have
to actually add that to my there you go
you see handy alright so we've got the
this so what I'm gonna do is I'm going
to say so let's say out view promise so
I'm going to use some promises here if
you're not use promises this might look
a little bit strange and hopefully
you'll follow along but if not you know
there's plenty of stuff that we can read
you can read and I'm sure if you asked
the question so here we'll pop in some
links so we're gonna say that and we're
going to assume that by default there is
no out animation so we'll just resolve
the promise immediately however if we
had to do the out we're going to update
the out view promise to that which means
we'll have to code that into here and so
we'll say out of you promise start then
and then we can do that so this really
is the power of promises that you can
just write chains of promises that will
execute one after the other and it can
be about transitions it can be just
loading data and you know all the steps
beforehand will have continued when your
code is being run all right so what I
want to do is I want to do this thing
where each of you is just going to sort
of kind of push back and fade out and
the other ones gonna pull in and fade in
I'm gonna fade one out immediately like
fully and then I'm gonna bring in the
next one so kind of gives us this push
push pull kind of feel for my
transitions it's just our transition
this could be anything what I'm going to
do is I'm going to do a transition on
transform people keep asking how they
can be notified if we're going live and
it's first of all you should be
subscribing to our channel because we
send out notifications when we go live
not true and also go to the Twitter's
and follow us now that's also true I
tend to be Thursdays at 2:30 roughly
speaking once a month I'm so expected
from now but you know what we can always
do more
lists at the Summa will let you know
yeah that's the ones we appreciate you
asking because we're enjoying doing them
so there we go alright so I'm good what
I'm gonna do is gonna make these
animations super slow to begin with just
so that we can actually see what's
happening and
any issues if there are any so
not-not-not 0.31 just you know we want
to do the same for opacity opacity oh
don't take that poll take there so there
we go and we need so we need a transform
transform scale not point 95 so it's a
little bit push back and then we'll do
transform no no there we are
transforms an opacity super-duper stuff
so in our view what we're gonna do is
we'll do return and a return and you
promise and that's going to resolve or
reject and we're going to say Const on
transition and is going to be that I
should really be and fight up this
coding in quite a while now it's
becoming the the danger zone where it
will most definitely not work but you've
written so much of the on to actually
know what is the cause
yeah and I'm gonna not believe it if it
did work so this class list we're gonna
add a visible class because we know that
that's gonna wear as it where is it
where is it
that's the visible class here that we we
added on so we're gonna have that added
on okay so we're going to do that and
we're gonna ask for the transition and
so this the eventlistener transition and
on transition end and we're gonna do
this stop remove event listener and then
we're gonna resolve the promise at this
point so when the we're gonna add the
visible class and when the transitions
ended we're going to resolve the promise
which would allow anything that was
chained against that and the same will
be true for the out let's do that as
well so let's do that
and here we're going to just return
promise dot resolved one thing to keep
in mind when you do these assistance
where you have promise as a chain on to
each other if one of these promises
fails all the subsequent ones will not
execute series will have to add handlers
if you want the other subsequent chains
to be executed anyways yeah so think
about your error handling
just always good advice actually but in
this case it's even more important
because suddenly you will just have a
system that doesn't react anymore
because it compromises handle just
dangling in the air not being resolved
or we go wrong okay so let's see so
we've got in theory we've got something
that when it comes in it's going to
return new promise it's gonna add the
visible class it's gonna wait for the
transition end when that happens it's
going to remove that and resolve same
out except that it removes that class so
we could probably if we were being a
little bit dry we could remove some of
this stuff here but all the same we've
got it and then just the update is not
going to do anything immediately I tell
you what we'll do is we'll just console
that log data for now just so that we
can see that there is some data so let's
see the view promise if their current
view is the new VR the current view we
haven't done anything with the current
view so the first time through current
view will be set to nothing so let's see
it so the new view let's see it's gonna
be that and we could say right there we
could just say this current view is the
newbie right I think that will sounds
about right
work for probably laid it out the old
one and so the newest current view is
there so we're in slash misc ooh now
that nervous disappeared yeah we don't
want that you know we don't want that so
let's see if we can just put his own
index of one on that and bring that back
okay okay so this is already starting to
work incidentally because we've gone to
slash misc as in we've deep link to the
slash misc the route has picked it up
it's added the transition in on the misc
view all the other views so if we look
at the elements you can see that misc is
visible a contact and about and home
aren't so let's go to the contact so
that's gonna fade that out and brings in
the visible it is literally working as
intended oh that is amazing
ah alright that doesn't normally happen
normally when I write code it's normally
a massive panic because we need a buck
for this live stream yeah so we need
something yes I'll write some code don't
worry somebody actually remarked they
were like I see you've had your
customary one bug for this episode and
it's like you're giving us way too much
credit like I
cohdon as bugs I'm a developer we write
bugs don't we we were kind of a mace or
a seller we hit like the one hour mark
on the last two episodes we're just
waiting for it to go wrong horribly
horribly wrong very wrong anyway so this
is actually working as intended but one
of the things that I think we'll need to
account for is this if you go like let's
say home about contact misc right we
want misc to come in but did you see in
the background there there was a weird
mixture of color yes and actually look
home about an contact and misc are all
deciding that they're visible and I
think this is because of the fact that
those promise chains are all kind of
we've got a few but every time you you
call on change we create that promise
change yeah and so it's a bit like a
call order thing almost usually kind of
goes that last one wins its last like
the other ones are still happening in
the background yes so let's that's
that's something to fix in the situation
which is why if you're going to do
something like this so he's useful to
have your transitions run slow and to
like mimic that sort of fast click or
just kind of click back and forth in the
browser the history controls so you can
kind of find that out so we have a
question yeah in production would you
load each of you at a later time and I
think that is some that we would
actually implement in one of the yes in
Ruta episode two so to speak yes if
people want us to do that if want to
come back and do like the more advanced
Rooter I think definitely so the fact
that I've got one HTML that's always
serving the same content for every deep
link I think is not what you'd want
I think you'd want each of these views
here in my HTML I think you'd want each
one of those to be its own separate
document you do a fetch treated as a
document so what we probably do is we'd
probably have a container element
something like that in the app that
would be like here's where that view
needs to live when you've loaded it and
then when you click it we probably do
something like a race where we put up a
spinner if it takes too long to fetch it
in and then you know get the book
actually write a custom Anna there's an
SC remote view that instead of having
natural contents inside just takes a
content URL that it fetches and you know
stuffs it in there and then it works
yeah and I think would be better and
certainly as I say what we're doing
right now is we've kind of got all these
elements
and ready to go and that isn't gonna
scale very well it's going to mean that
you have potentially huge documents but
that kind of handling of attaching and
detaching and so on can get quite
convoluted and this is the simplest
possible version of a Rooter that I know
about so that's why I wanted to do it in
this so that we're not spending forever
on your time as we go through it so I'm
going to try and fix this this issue
with all of them being visible and I
think the easiest way to probably do it
would be to add a kind of block around
around this here with their code around
the promises and I think the probably
the way to think about this is that when
does animation going on we want to store
so if I was to click no wrong browsable
if I was to click you know 1 2 3 4 very
quickly when whichever one's going out I
would want it to be the last one that
clicked that kind of came back in yeah
ok so since that's the case if somebody
clicked while it was coming in it would
still finish and then go back out right
right right right yeah exactly so so
let's see what we can do here this is
gonna this always a bit fiddly and I
think this through
so let's say we want to do so we're
gonna do mmm so this one we should allow
them to do this and then we say it so if
if it's not animating if it's not
animating or if it is on a meeting let's
do that if it is animating return so we
don't let them do anything like that
that by default will be undefined so we
can now say that that's true
when the when the current view this got
out has gone we could do
this the animating is false we can we
can reset that so now we're going to
allow interactions back in so this code
should run I think that would that work
this is where yeah as I say this is
where it gets complicated now so well
what do I want to do it so we have this
flag when we are basically in a
transition right now that is what
animating is supposed to mean
right yes and when we are in an
animation in the out animation more so
we want to overwrite the buter is
supposed to come in and set off yes so
this this new view here would be no good
to us so we want to set where we've got
a new view so let's get rid of that and
make that's this not yet a class
variable yes we can store it for kind of
future so if the current view matches
the new view blah blah blah and then
this new view whatever that current
value is so let's see so that is fine we
get we get a promise for this but this
oh do we even want this I don't know Oh
we'll see how we get on here let's see
what happens so we'll do this the break
here broke okay we broke things here's
our crystal book that is so relieving
new view is not defined so where's new
view on our new view that should do it
yep yeah so this would only apply wait
wait wait it's not gonna work yeah
that's fine no it's not gonna work it's
not no because what we want to do is we
say the new view and we want to I think
we want to do it here no no you want to
fade out the current view afterwards and
once we were right I think you might
want to put in the promise right mmm
let's find out let's find out let's fail
so that ya know just doing the right
thing
oh no it's not so it kind of closer
right because so what's happening here
as you come into misc and so you're
going to about like that and then you
click home you'll bring in home but when
I click on 'contact that should allow it
to disappear a particular point this is
always fun code isn't it right so let's
let's do this step by step then right
figure out the new view so that's fine
and then let's see so I have to write
sometimes I write out my code in English
so that I actually can understand
because I just sometimes look at clothes
don't have had any more you can actually
yeah myself so if there is a current
view so if there's a current view if
it's one we already have just update it
so that's fine
otherwise we animate it out right yeah I
think they're pretty confident of that
particularly if branch of the thing yeah
and now this is a bit where we actually
we want to so we could we can call out
potentially a lot of times here which I
don't like that feels oh no it feels
okay feels okay but it's not great
should you be setting animating there
because once you actually start calling
out it will actually be faded out yeah
so that's that's what I was wondering is
whether we we need to we shouldn't be
blocking where we are so we'll find out
but let's see did he mean I'm gonna move
it up here for now because if there's a
current view but we're animating we
don't care yeah right so and then set it
yeah so do that here come on Paul there
we go so we need to see that so that's
fine but the only thing is now the I
know the new view that should work she
find out goes to contact contact and
then home yep contact see we're still
not allowing that to happen does that
work now so now it's kind of locked
itself out which is never fun because is
because this presumably noticed never
unset yeah so that's probably the
problem let's just find out
also by the way a nice thing about
custom ellen's is that you can just
inspect the state by selecting the Dom
node in the inspector and look into the
internals those are not fully for free
floating objects anymore nice yeah so we
never get to that point and I assume
it's because of this she's no fun at all
right I'm getting myself into a bit of a
pickle over this one so take a breather
anybody else do this you have a stock go
for a cup of tea well you might not go
for a cup of tea that's a probably a
very British thing to do isn't it let's
be honest we all we need a good cup of
tea right helps to think things exactly
right so the new view figure out the new
view maybe anybody on the livestream if
they can see the bug they'd be very
welcome to say what they see I'll let
you know
Thanks appreciate it
right alright so unchanged here we go if
you're animating what I'm curious about
is I might actually just delete the code
and write it again no longer animating
so there you go
pop that that's doing that that's doing
the correct thing right well I guess
although the image comes a little bit
early because it it says I'm no longer
animating out I'm okay so I put a
terrible debug I'm mulling it what the
semantics are third variable is supposed
to be but I guess it is about I'm no
longer animating out it's a sort of it's
kind of like actually you're right it's
more like should block should not make
more I don't promise this is what it
really is quality code hey there you go
which if that's true there you go should
be there maybe shouldn't make any any
more out promises there you go well you
know as I say it's just to try and get
the kind of meaning but the question is
then with that in place that goes to the
home
it calls out but it's calling out they
also make the route I'm wondering if
that is actually still true they should
not make I think I know why oh do you I
think so I think it's that I think it's
deciding to call the out against the
thing that's animating in that could
very well be true and oh yeah that is so
I think let's try that it looks so much
better we have had our customary one
vote per episode yes it happens every
single time this is so not what we
intended no this time I was like it's
fine it's fine
so I won't do the customary one bug okay
anyway right well since that singularly
failed yeah here's what we'll mail do so
this yes we're going to keep that
variable yeah should not make more out
promises well okay we know Java it's
really long isn't it it's called
JavaScript for a reason they're just
well in which case you'd be like oh I'm
gonna minify this or disclose this
thought I please done now so if so is
transitioning between at least you
should be able to read this right so
okay so we don't want to create more
people asking you to reiterate what the
actual bug was okay so the the actual
bug was that we'd move it back out here
I was doing this here so what I was
assuming was that if there's a current
view you'll want to and it matches the
new one we want to update its contents
we just want to pass through so you're
on the the About section and we do we go
to about slice something else yeah okay
what we wanted to do though is just
update it okay that's fine that's that's
a relatively straight for bit if you're
going from say about to contact we want
to call the out on that but what we want
to do is we want to hold on to the
current view
because if somebody then clicks again we
still want to tell the about view or
whichever view that was the current view
we still want to tell that go out you're
supposed to transition out out out out
out what I was doing is I was updating
that variable to be whichever one was
expected to come in but we don't do that
just yet because otherwise we'll tell
the new ones about to come in
you should go out so it's like we're
updating the reference to the active
view we don't one yeah we're doing it
too I was doing it too early you see I
was doing it straightaway what we want
to do is we all only want to point our
you know what is the current view when
the the current one that's going out has
disappeared and the north
yeah the new one's about to come in so
we could have done it I could have done
it here or we could have it here I mean
to be honest we could just you know so
the lesson you learn from this is when
you use promise chains and you know to
bridge over certain time gaps think
about what the state is that you're in
yeah and since this is a promise we can
return it here and that would then allow
us to then dock then if we wanted to and
be like console.log dun dun dun right
let me just say that still working after
me messing around
so the goes out anyone comes in and at
the end of it dun dun so you know that's
a kind of useful thing about having the
promise chains here boo
so that is working as intended which is
really really good so we can now speed
things up a little bit like not point
three so remote from my site actually I
have I returned the promise in my go
function on the Ruger Sevilla I can
external court can latch onto the
promise chain and started working after
everything has been done by the Woodard
so yeah we could totally do that I mean
I think in this case we would return
that from there and then we would return
that from exactly so we return whatever
on chain unchanged would return which
will be the out view promise however in
this case we'd also have to do something
like that here
an empty like promise that resolved yeah
so that we're just saying you get a
you're always going to get a promise
back but it might just immediately
resolve or will resolve when the new
view has come in it results meant the
view that
is on screen immediately or later let me
show you something else that is
brand-new and this actually does relate
to views and the like since we are we
have about five minutes if you want to
keep some of the usual customer hour
we're doing an hour of weather we do
then this is not fair because we're
actually not trying to do this but
anyway okay what I want to do here's
what here's something that often bites
people you've got these four views right
and notionally they're separate right
there's in you want to lock things like
layout and styles and so on to be
completely separate but things like
layout I mean I talked about this quite
often when I'm doing perform stuff but
layout is normally scoped to the whole
document right so if you trigger family
yeah and so people kind of go ah this is
bad let's see about this let me show you
this so let's say I'm in the home
section what I'm gonna do is I'm gonna
add myself a box which is okay it's just
the box right so that's fine and I'm
gonna do I'll do view home this is where
I find out that I can't remember how to
do this but here we go
so let's say width 50 pixels height 50
pixels background what causes the home
let's just do white and then we'll say
position:absolute Oh absolute right and
what we'll do is we'll do keyframes
slide okay and we'll say frog and then
too
now what I'm going to do is I'm going to
trigger layout okay so I'm gonna do is
I'm going to do an animation of
something like width and I'm gonna go
from a hundred now like three um kids
don't do this at home definitely done
this one at home I'm just showing you
two in case for some reason you are
actually triggering there which is there
are valley times like you append child
or remove child you're gonna be able a
up for example so let me show you this
so with from 300 to 100 and so I guess
I'll do animation
animation name will be slide in not
slide slide animation duration three
seconds and then animation iteration
count infinite so like like say we've
got that how it would ruin your battery
and well yeah so if i refresh that so
you see I've got this animation right
and let me just put a left on it so it's
like left 100 pixels okay camera right
so we've got this and if we do a
timeline recording and this will be fast
because it's a decent MacBook yeah so
it's different phone things will look
different yeah so but what you can see
is during this animation if i zoom in on
any one of the frames and admittedly as
I say this is comfortably 60 frames a
second right there's no it's Abby
there's no Dom trivia that needs to be
relay out it yeah this is a small Dom
there's no issue here but if you did
have an issue I'm just showing it for
the sake of showing it really because I
think it's really interesting see the
layout route here is that is the
document and the number of nodes that
need layout is three see you at the box
you've got its parent which will be the
SC view and then the body above it so
that's why yeah so that's why you've got
those three I think and so you can see
that it effectively it's document scope
right because the layout route so if you
think about it would have like a
navigation drawer that we wrote last
time outside that would get real layout
it even though nothing changed yeah and
so this is this is a brand new property
that's coming in because on my view I've
got something like position fixed and
I've actually set to I'm going to switch
that across to width and I because I
think it might need it
width 100% 100% but if I put contain
strict now if you've not come across the
contain property basically it would let
you say layout styles paint or strict
and there's also content and that will
what it'll do is a lock off some of the
calculations I put strict on which is
like the key word for all of them so
styles paint layout and content as well
in any case what we should see now or
being well if I do this stop recording
stop it stop we zoom in we're still
gonna have layout but you can see now
the layout route has actually been fixed
to that particular view which means
we're no longer potentially affecting
all these other views that have nothing
to do with this particular one we're
saying essentially this is a layout
boundaries that it's the route of this
calculation so you can find this in the
current canary I don't know what these
support status is generally outside of
chrome but it's something that's
incoming and I wanted to show it because
as I say I mean in this case the the
layout time is so minuscule it doesn't
matter but I'm a big app we've got a lot
of views going back and forth and you
potentially trigger layout which
historically might be really expensive
to deal with with contain streets you're
gonna be a lot better off so with that
said I mean I've got a ridiculous
animation which I'm just gonna I'm just
gonna remove it after this what we're
gonna do all right what we're gonna do
we are going to call this a day because
we've hit pretty much the hour mark we
had our customary bug don't forget to
subscribe to the channel if you can't
believe I've done that I can't believe
it either
thank you so much for joining us thank
you for your questions I hope you've
enjoyed it
don't forget you can find us on Twitter
you can let us know what you want us to
cover next we can cover a more advance
route to next time or we could do and
expand and collapse view or something
like that you let us know what you want
us to do and we will try and get it done
and thank you so much for tuning in and
we'll catch you next time see you then</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>