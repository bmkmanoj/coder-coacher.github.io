<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Deep Engagment with Push Notifications (Progressive Web App Summit 2016) | Coder Coacher - Coaching Coders</title><meta content="Deep Engagment with Push Notifications (Progressive Web App Summit 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Deep Engagment with Push Notifications (Progressive Web App Summit 2016)</b></h2><h5 class="post__date">2016-06-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Zq-tRtBN3ws" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is Owen and I'm a product
manager on Chrome push notifications um
so just before we get started
I feel like now would be a good time to
clarify that we actually have two new
features in browsers both with the name
push I think it said that there are
three hard problems in computer science
caching no to two hard problems in
computer science caching naming things
and off-by-one errors and so I think
we've fallen into the naming things trap
here so there's HTTP to push which
allows servers to send down data to the
client before they even expect it when
rendering a page and then we have web
push notifications which are about
sending notifications to our users and
that's what we'll be focusing on today
so I'm super excited that we're all here
in this room full of amazing web
developers and I think at last count
five different browser vendor teams to
talk about progressive web apps these
are web apps that are reliable fast and
engaging and I'm gonna be focusing on
the third point today engaging
specifically sending push notifications
to your users so push notifications on
mobile aren't anything new but I'm
really excited that we finally have
access to these as web developers I'm
sure there are a number of you out there
that have built great mobile web
experiences and then had to wrap it in
some kind of Cordova wrapper and suffer
the friction of an app store just so you
can get that notification capability so
our shackles are now free we can now go
ahead and do this I think that's really
exciting especially when you look at
when you look at the services and apps
that have been successful on mobile and
just look at the top ones and think
about how many of them are fundamentally
successful in part because of push
notifications when we now have the
ability to take advantage of that in the
web and so there's a bunch of new
opportunities that have emerged here
that I'm excited about and this can be
really huge for business as well for
example if we take a look at Junior
which is a leading e-commerce company in
Africa they had a problem and the
problem was that one quarter of their
users were adding items to their cart
but they're not actually checking out
they were abandoning that cart and the
site tried to deal with
by sending those users emails and
reminding them but getting a user to
type that email in on a tiny screen is
really difficult and then the open rates
on those emails were extremely low so
it's still early days but Junia have
implemented pushing a vacation on the
mobile web and they found that their
notifications get a 38 percent open rate
by users and that users that have
enabled web push notifications convert
on those previously abandoned carts at a
nine times higher rate and so I think
these kind of our results are really
exciting okay so push notifications is
this an amazing new superpower that we
have on the web but everybody knows that
with great power comes great
responsibility so this begs the question
what makes a great engaging notification
and so we believe that great
notifications are timely they're
relevant and they're precise and so for
these penguins here a push notification
letting them know that there's a leopard
seal behind them would really change the
course of that day and so as you're
designing your push and Vacations flows
just think about whether what you're
sending is important enough to warrant
an interruption would you want to be
walking down the street and fill your
pocket vibrate and really use that to
guide you and so let's break this down
further
I said notifications work great when
they're timely so try and use
notifications primarily for
time-sensitive events especially if
these are synchronous events that
involve another user for example are
being sent a chat message there's
another person out there waiting for you
to respond and it's something that you
care about and it's important that you
see it within the right time so that's a
great use case calendars is another
fantastic use case you know you're about
to be having a meeting you need to know
where you're going and ah and be
reminded to go there
so timely is really key secondly being
precise notifications should contain all
of the information that a user needs to
understand what just happened and to
take action on it if possible and
thirdly relevant it's important to users
that the notifications they're seeing
from people that they care about and
about things that they care about
okay so let's give this a go here's one
example note of
Kishen what do we think about this I
think this is pretty good
right it's timely you know I'm probably
at the airport and I'm about to get on a
plane it's precise it tells me my flight
number it tells me when the flight has
been rescheduled to and it's relevant
it's my plane it's my flight it's super
important to me so I think that's great
how about this one your credit card has
been compromised
well I think this could have done better
you know b-minus on our on our scale so
it's timely it probably just happened
and it's relevant right it's my credit
card but it's not very precise which
credit card why was it compromised
what's going on have what action do I
take and so if we reimagine this
notification we can add some make sure
information let the user know that a
suspicious transaction has occurred and
give them buttons that let them take
action and provide feedback to the bank
okay how about this one awesome chat app
you have a new message so awesome chat
app your notifications are not so
awesome it's probably timely I expected
a message was sent to me but it's
certainly not precise and who can say if
it's relevant right who knows so we
redesigned this and we get Jake says I
heart serviceworkers instantly I think
that should be an award for getting his
profile picture in the most number of
talks today I think he's maybe at 3 or 4
so far so that's a great way to redesign
this how about this one as a side note I
think if Google does launch a
self-driving car service we should
definitely call it goober and so this
one is great it's timely you know my car
is arriving it's precise it's telling me
where it's arriving at and it's relevant
it's my car I'm gonna get in and drive
away and then here's probably the worst
possible example I could conceive of
this is none of the above and the risk
here really is that if you send
notifications to your users that don't
provide them value that distract them or
spam them they're going to turn off
notifications and then you're gonna lose
the ability to get the value from that
interaction in the future okay so we've
talked a bit about the kind of
notifications which are good for our
users so now let's take a look at the
flow and really how this works on a high
level
so push notifications on the web is
built on service workers this is
probably a theme that you're seeing
emerging throughout the day and I think
it talks too it talks to how service
workers are becoming this fundamental
capability that are allowing us to
extend the platform and all these new
and interesting ways and so once you get
everything set up which will go into
sending a push on a vacation the flow is
roughly that your site first makes a
network request to a push of a bush of
scription endpoint and that's managed by
the push server which then magically
wakes up the users device and manages to
fire an event into their serviceworker
and then that serviceworker run some
code and it uses the notifications API
to show a notification to the user so
let's break that down a little more the
first thing that happens when a user
land on your site is you have to check
if the users already subscribed so you
know whether to show them the opt-in
flow once you've checked if they haven't
ready to opt it in you just wait until
it's a good time maybe the user has just
done a search for flights and you give
them a button that says I get notified
when the price drops and then once the
good time comes you ask the user to
subscribe you explain the feature to the
user that they're opting into and then
you eventually show them the permission
request and then once you've subscribed
the client it generates a subscription
object you'll then pass that
subscription object up to your server
and save it somewhere in a database and
then on your server when you're ready to
send a message you just generate the
message you send that message to the
endpoint that you were given previously
and that endpoint are essentially the
push servers keep a persistent one
persistent connection open with the
device and then they use that connection
to tell the device to wake up the
browser wake up the service worker and
so this part is special because it means
that we're sending push notifications
but the browser doesn't even have to be
running on the device the site doesn't
still have to be open it doesn't use
much power and so it's a really great
performance
feature as well and then the push
message is received by the browser and
when the push arrives in the browser
wakes up the service worker and fires an
event into it your code then handles
that event and decides what to do and
shows a notification to your user easy
right okay so now let's take a look at
subscribing for push and when you should
prompt your users to opt in to get push
notifications so I think that this step
is super important because if you're
going to be successful with push
notifications you have to get users to
turn them on in the first place and so
it's really important to focus on this
step in the process and I think it's
important to be clear and intentional
and treat this like any other part of
your UX process the key is not to just
add a permission prompt on page load
without thinking about it so make sure
that the user understands why they're
being asked make sure that they
understand what they're opting into and
so we'll take a look at an example of
The Weather Channel so The Weather
Channel have built this page where you
can choose to enable push notifications
and control some options so I think this
is great because it's specific you know
you have this page where you know what's
going on you have all of the context
that you need and the permission
requests itself is user initiated so
when the user goes ahead and check set
box saying activate browser
notifications they see a permission
request no surprises right they're very
likely to click through at that point so
that's great
and we think it's really nice how they
give users options I can opt into
breaking news or government issued
alerts if you're never sure about what
users going to want to enable just give
them options and let them decide ok so
we've talked about this on a high level
and we've talked about UX they said take
a look at the code and how we actually
are subscribed for push notifications so
the first thing I said that we do is we
check whether the users already
subscribed and because these are
progressive web apps the first thing
that we do is verify that service
workers are available on this client if
the Service Worker is available we go
ahead and register our service worker if
a service worker is already registered
this will just return with the
registration object of that Service
Worker and then we can call push manager
get subscription to get a push the
existing push subscription for the user
if one exists and so now we know whether
that's
I've done all we can still this in a
cookie use it later or use this to
decide whether to show them an opt-in
flow okay now we're deciding to
subscribe the user for the first time so
again we're going to get the
registration of the service worker that
we've registered and then we call push
manager subscribe essentially this is
setting up that connection with the with
the push server so it knows how to talk
to this client it knows that this
service worker wants to be able to be
woken up and then there's a option here
which has user visible only true
essentially what we're saying here is uh
we're promising to the browser that when
we send a push message down to the
device and our service worker runs in
the background that the user will see
something so what either show them a
notification or maybe if they're already
looking at the the web app then we don't
need to do that and the idea here is
allowing making sure that browsers can
show that permission request saying this
site wants to send you notifications not
this I wants to run in the background
permanently on your device silently and
use all of your battery so that's why
that exists and then once you've
subscribed actually when you call
subscribe that will the be the point
where that permission request is shown
to the user and if they accept that
request the promise resolves and we get
back a subscription object which we can
then send to the server and of course we
catch the case where they deny and we
can decide what to show them in that
case so I recommend you all check out
the propell sample code up on the Google
Chrome section of github and this shows
some great sample code to manage those
subscription States gives you a really
nice API to manage them okay so next
once we've subscribed I said you get
that subscription object what is that
what does that look like so this is how
it looks it essentially gives you all of
the information that you need to
identify the user to the pusher so it
can wake up the right device it starts
with an endpoint this is like a magic
URL it acts kind of like the user's
phone number or email address but for
push notifications is a way of
identifying and reaching out to them it
starts with the URL of the push service
that this operating system uses in our
case here Google Cloud messaging and
then it has a long
string of random letters that identify
the current user to that push service it
also includes a bunch of encryption keys
and this is so when you're sending data
down to the user's device so you know
what notification to show that message
can be encrypted and can't be read by
anyone in the middle okay so let's take
a look at sending that message from the
server there are two ways that you can
send a notification firstly there's what
we call a tickle this is essentially a
push message which arrives with no data
so the service worker gets an event that
says a push message arrives but it
doesn't get to find out what happened
and the second kind is push with payload
this is where you include data you let
it know what happened on the server and
why it's being woken up and if you're
sending payload it's encrypted with the
keys that we talked about earlier and so
let's take a look at actually sending
those just before I do it's worth
calling out that the sample code I show
here is for using the web push protocol
so the web push protocol is about to
start walking around now in Chrome but
as the standards been evolving in the
implementation has been evolving it
hasn't been the exact same
implementation in older versions of
Chrome so there'll be a link at the end
which shows you how to do a backwards
compatible implementation but I'm going
to focus on the future facing and what's
really going to be happening from now so
when your server wants to send a push
message to the user the it sent a
request which looks roughly like this
it's a put request to that endpoint we
were given earlier it has a time to live
which essentially tells the push server
how long should you keep trying to send
this to the device for and you know give
up if it's taken more than two minutes
it includes a content type in encoding
and then it includes the public key in
salt used to encrypt the message a vapid
signature and the encrypted payload I'm
not going to go too much into the
details on those last encryption aspects
now but again there'll be a link at the
end which gives you the full breakdown
of how this works and at this URL you
can find sample projects to handle the
encryption and message sending on the
server side we have them in Java in in
nodejs in Python
so go and take a look this is kind of
contributed by the open-source community
there are contributions also from
Mozilla and from Google and there are
really great set of libraries that will
get you up and running okay so now we've
worked out how to subscribe the user and
send a push message but how do we
receive it on the client what is the
service what could do so in your
serviceworker you just add a new event
listener for a push event when that
event fires you call this magic this
magic method called wait until so wait
until I had to look at this a couple
times the first times I was trying this
wait until essentially says I'm gonna
run some code for a while it's kind of
asynchronous and I'll let you the
browser know when I'm done and when I'm
done you can go ahead and kill my
serviceworker I don't need to be kept
running so this allows us to be very
performant and efficient and you
basically pass into wait until a promise
and you resolve that promise when you're
finished doing the work when you've
showed the notification so here we go
ahead and we just generate a
notification and this returns that
promise that will resolve when it's been
shown so the browser can kill the
serviceworker at the right time but
actually if you look here this
notification I'm showing basically
breaks all the rules we talked about
earlier right it's static it doesn't say
anything useful so how do we read the
payload how do we know what was supposed
to be showing the user it's pretty
simple so you just check if event data
exists if it does you call jason to
convert it into a javascript object if
it doesn't exist then that's the point
where you want to make a fetch request
to your server to ask hey what happened
what should i be showing the user and
then once you have that data you again
just call show notification with the
correct title and the body and note in
this case that we actually need to
return that show notification to the
event or wait until to make sure that
the browser knows that were that we were
still doing work if you don't do this
you might notice in chrome that you get
a little notification saying this site
updates in the background that generally
happens if you are resolved a promise to
wait until before you show the
notification because that's chrome
checking and saying hey did you show a
notification oh they didn't will show
one on their behalf to make sure the
user knows that's the user visible only
true thing coming into play so we also
have support for action buttons on web
push notifications these make it easy
for users to complete a task without
even opening the app here we can see
that a user can confirm their
reservation you could also use this to
have users like or retweet something to
pay a bill increase their bid on an
auction as many interesting
opportunities there and using action
buttons is super easy in the show
notification call you just pass in an
actions object and you give the title
the icon and this action string key
thing that we're going to use to
recognize when the user taps on one of
those buttons so then if you use it does
tap on a button or on the notification a
notification click event will be fired
and that's why we'll say hey if the
action was like then we'll reach out to
the server and let it know that it was
liked and if there's no action then we
know that they just tapped on the
notification in this case we're just
going to open a new tab to the
notifications page on the server ok so
we're almost there
we're just gonna wrap up now and I don't
think that we can do this talk without
talking about browser support so it's
worth noting that web push notifications
are already supported today in Chrome
and Firefox I was excited to see the
Opera shipped web push notifications
last week samsung browser shipped web
push notifications earlier in their
browser 4.0 and i read last week that
the edge team of just announced that
they're currently implementing push
notifications on the web and at this
point you might be looking at that and
saying that looks great but there's
maybe one missing that we care about you
know what do we do and I think that
there's a big takeaway here which is
that progressive web apps are
fundamentally progressive so when you
invest in your web experience you make
the experience better for your users
everywhere and if you use progressive
web app features in the browsers that
support those features it's going to be
even more awesome and this actually
turns out to be true when you look at
the data earlier this year
Aliexpress a very big ecommerce company
rebuilt their site as a progressive web
app and in Safari
they saw an 82% increasing conversions
on average and that's a browser that
doesn't currently support service
workers and these new features but I
think it just goes to show that there's
a huge opportunity in investing in the
mobile web and if you build a great
progressive web app like they did you
can get that value across all of the
browsers and even more value in the
browsers that support these features
okay so we're going to build better
engagement on the web using web push
notifications we're going to send
notifications that are timely precise
and relevant just think about these
things and ask yourself would I want to
receive this notification and my users
going to be delighted by this experience
we should make sure to ask for
prevention in context so the user knows
what they're signing up to and they're
likely to click through because they see
the value proposition in what you're
giving them and be awesome
you know we have these new amazing
superpowers use them to build awesome
amazing new experiences for your users
that you're going to love your company
is going to love and that they're going
to love and with that I'm going to leave
you with a few links where you can read
more about this we have a guide for
getting started with push notifications
and then some details about the
encryption aspects tomorrow we'll have
some code labs where we'll go through
some of this stuff and coming soon on
Udacity there'll be a course there so
you can learn about that if you're
watching from home so thank you very
much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>