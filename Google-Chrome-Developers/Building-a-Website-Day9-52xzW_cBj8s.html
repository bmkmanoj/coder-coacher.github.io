<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Website #Day9 | Coder Coacher - Coaching Coders</title><meta content="Building a Website #Day9 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Website #Day9</b></h2><h5 class="post__date">2016-10-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/52xzW_cBj8s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello again and so somebody on YouTube
remarked well they won 2-6 seem to be
like messing around with a header in day
seven it's like all done actually you're
not far wrong when there was a lot of
setup for it but actually the styles
that got onto the page were done pretty
quickly it was just a lot of flexbox and
I'm not actually that interesting
there's no there wasn't actually a bunch
of challenges in there so they really
made more sense the kind of record and
she's fat but as you might recall we've
done all the accessibility self at least
for the static version and the next step
is to now going to progressive
enhancement mode and that's exactly what
I've been doing and I will show you
exactly what what what really so if you
look at the screen you remember that
before when we clicked on a link it
would take us to a new page what still
does that but now it goes and actually
hot swaps the content for us so it's a
lot to lot cleaner if you like it's a
lot sort of up here I had I don't know
what the it's good I think it's nice
it's nicer than reloading the page and
that's that's working out really well
for me here's one of the things that
people were saying in the comments they
were saying why would that the the
massive why are you so obsessed with
clipping it rather than just overlaying
a block and here's why when we go to the
livestream section watch what the yellow
strip just below location well that does
see how it slides down and reveals that
content the live now in the up next and
also when I leave that section let's say
go to the code of conduct it slides up
and so for that to actually work the
photo at the master has to be clipped if
I don't clip it then it basically it
would just that Hall effect wouldn't
work so that's why I wanted it so that
it could slide out the content from
underneath so that's basically it now in
terms of the actual code that underpins
this let me show you around a little bit
it's all in the CD sjs right now and
there are some challenges shall we put
it with the fact that I'm not supporting
say just chrome
so I can't use const and let and a bunch
of es2015 type stuff I didn't really
want to transpile it I'm road rather I
think just because there's not that not
much code I think I'd rather just right
there es5 myself and be done with that
it's not like it's a you know it's a bit
of a shame and it does cause me a couple
of challenges in a couple of places but
oh well so when you click on a link I
hijack all clicks with
document.addeventlistener I'm not a big
fan of delegating all clicks to a big
hand below humbler like this but it's
not a big site and it's something that
we can get away with I guess and we got
we basically call this on click and the
target we start there and basically I
work my way back up to find the nearest
anchor there is element closest which
you'll find if you google for it but
it's not supported everywhere yet think
it was edge that didn't support it so I
have to basically write a little do
while do while it's in there do whales
are the funniest because I only ever use
one probably every six to twelve months
but when I need it oh it's the best
little construct ever find the nearest
anchor and then basically decide if it's
in an internal link as it's got / dev
some in its href great I basically go to
that and we'll talk about that in a
moment and then if it's YouTube I tell
the video handler to begin playback and
I'll talk about the video handler
probably in the next entry because I'm
still working on that still refining
that a little bit not quite sure where
that's at in my own mind anyway for the
internet anything that's not internal
will basically just do what it's
supposed to do just won't prevent
default but if it's an internal link we
prevent default and we go to that URL
which basically involves pushing State
on and then calling this unchanged and
the unchanged is basically going to be
fired when we go to the URL or when the
pop state happen so all it's going to do
is fairly we puts the kind of this
routing code right into the middle of it
it basically says if you fight either
actively thought to go or if I passively
find there's a pop state as in the URL
changed tell me about it and this
unchanged will fire and we'll decide
what to do
if you've come across the supercharged
Rooter episode that's exactly what we
did there and that's why I'm applying
the same concepts in production because
I know that they will work just fine so
what does the the unchanged do well it's
actually all the way up here it grabs
the path makes a new xhr and loads it
and some people sort of would say why
are you not using fetch well fetch won't
let you set a response type of document
there's good reason for it it's because
you can fetch inside a service worker
and service worker like every other
worker doesn't have any notion of the
DOM and therefore it doesn't support
getting things back as documents so I
have to make a request as an xhr I don't
have a problem with that person because
X hr's are still completely valid
they're not deprecated okay they don't
they don't return a promise but that's
okay i can never that and so we we
basically load the whatever it was that
you were going to whichever page you're
going to we update the nav and then i'll
show you the small player or there's a
fun thing maybe you leave you a little
hint at that at the end of this right
the onload what we do is we hide and
swap area contents so that's the bit
where everything kind of fades out so
let's do it let's head down there a la
la yep I'm basically going to watch the
masthead graphic transition out so the
masthead graphic is the longest-running
of the fade out so I basically apply
this hi Darius class to the body and
underneath in the Styles let me show you
the masthead style since we're here
masthead in line there we are if the
page is animatable and i have a separate
class for switching on and off
animations and I've told you to hide
areas then the master graphic should
turn to opacity 0 and it should take
half a second to do so at the end of
that the transition end will fire and
that's where everything everything kicks
off because we at this point we've got
the new contents we've we've loaded in
hopefully all the
all the content from the new page and we
get the title on the new graphic and the
new everything about the new page and we
swap it in for the existing one so
everything that we are going to swap out
has been faded down we also we swap
everything here out and then we
basically wait a couple of frames and
that's it's a slightly bizarre technique
this one because the event could fire
somewhere in the middle of the frame you
actually want to typically wait two
frames so you wait for the start of the
next frame so that anything that
spending happens and then you wait
another frame and then you actually do
your your actual animation it's I would
prefer it if we had some mechanism to
say let me know when this work is done
whatever the work is when it's been
applied and rasterized and put to screen
and then do my next step but at the
moment the double ruff is what I'm
having to do and it's a bit because I'm
am to bind it because I can't use arrow
functions yeah I would like it if I
could anyway so at the end of that so we
basically fade out swap the content fade
back in and then there's just a bit of
tidy up about toggling a couple of it's
very hidden I'm going to have to when
this is done I'm going to have to go
back and do some of that accessibility
checking again because I want to make
sure that we don't completely lose focus
on the page so we're feeling that in
some context we actually will and I
probably want to take you to the header
of the new page that's what I understand
is normal talking accessibility bit of
an update for you I show Rob Dodson the
accessibility work that I did and he was
like yeah that's already good the only
thing you probably wouldn't do is that
that thing that you are really proud of
Paul with the SFJAZZ thing where it said
SFJ is easy you don't really need to
adjust what the screen readers going to
say people who use screen readers
apparently are fairly comfortable with
the fact that content won't necessarily
be announced correctly in all cases but
it's good enough that and they're used
to enough that it's not really a big
deal so you're saying you don't really
need to go out of your way
to kind of corona stuff on the other
side of it I was like well I'd rather it
said sfjazz because that's what it is
but I kind of understand his point that
you don't need to kind of go all the way
to 10 out of 10 on making sure that
everything sort of sounds absolutely
perfect that's not necessarily the sort
of ideal or practical approach but I
said it was a journey like all of this
stuff I'm going on so that's essentially
what we're doing right now for the hot
swapping of sections at least on desktop
it's nice and fast let me show you a
timeline profile schedule and and so you
got this animation out here so you
basically this is the click handler here
and then we have an animation out with
admittedly one long frame in there then
this is the swap over section here and
psychologically there's a Break for four
people because you've faded out the
content and there's a break where
they're like there's evac by they're
doing that initial animation you've
acknowledged their action so that's fine
so you like okay you've got you sort of
you've responded instantly to my click
and then there's this sort of the swap
over moment where we buy ourselves a
little bit of time so we can afford this
gap in the middle is what I'm saying cuz
not one continuous animation and then
the secondary animation where it's
coming back in again very similar couple
of long frames not disastrous but
broadly very convenient and once a
convenient broadly very performant and
the reason it's performance because i'm
sticking to opacity and transform which
if you've followed any of the
supercharged videos is something that
server and i talked about very often so
there you go that's essentially what
i've got for now but from going page to
page to page we've enhanced if the
javascript fails or isn't running we
know that we will be falling back to
link to link to link to link so that's
not a big deal so we've kind of
progressively enhance into something
that hopefully should work that's it for
now I will quickly show you the video
stuff let me mute my my screen there so
this is what we got and if we at the
moment if we go to a different section
it goes down to a small video in the
corner so you can continue watching and
if you're going to say another another
thing with another video and you click
on that that it replaces it and then
bauble bar and if you go back into let's
say go back it brings the video back up
to full screen if you go back to the
place where the video originated more of
that in the next video about the videos
right check out the code subscribe if
you haven't already keep on commenting
keep on saying hello keep on throwing in
your ideas and suggestions I do really
appreciate them they're often very good
and it's lovely to read them all so
thank you for that and I will catch you
in the next entry diddly</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>