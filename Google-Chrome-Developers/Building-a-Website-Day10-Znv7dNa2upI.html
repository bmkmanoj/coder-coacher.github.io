<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Website #Day10 | Coder Coacher - Coaching Coders</title><meta content="Building a Website #Day10 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Website #Day10</b></h2><h5 class="post__date">2016-10-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Znv7dNa2upI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello again I do believe in the last
video I promised I would show you the
video player the well there's not
massive amounts to show you but I
figured I'd show you anyway because it's
a little bit different I suppose if you
look on screen I've got the video player
or I have a video player and it's it's
gonna play oh good we can't hear me
thankfully and when you go to a
different section it's squishes down
like that and if you go back to the
section you were on it kind of restores
back up to full size or if you go
somewhere else and there's another video
when you start that it replaces the one
you're on and that behaves in the same
kind of way and do that and go back
whatever okay so i shall show you the
code for that which is as I say it's not
a massive amount of code in CD sjs when
I go to a new section on the unchanged
if you remember that unchanged I
basically call this toggle small player
if needed in the video handler which is
a static function on the class toggle
small players needed there we are and
i'm basically looking for an iframe
because if I see an iframe then I know
that you've you started the YouTube
video or at least you've gone past the
picture with the button to press you
know we've we've embedded the iframe and
if there's so I treat that as a kind of
a fairly strong signal on mobile it's a
bit different because even if you I can
embed with autoplay and that will work
on desktop but on a phone it just puts
the video player there again it's not
great but at the same time it's not a
disaster either it's I don't know I
don't know at this point with how many
people are going to be visiting the like
watching the live stream on the phone
versus on desktop and if they're on the
phone is an extra tap she's not great
it's also not disaster so anyway if you
have an iframe this is where we got to
if you have an iframe then it is playing
and it's basically if they there
the current window.location matches the
href on the playing video container so
when I embed the video and I you kind of
pressed play I stamp into the data
attribute on the video container let me
show you know let's do inspect and over
here in the video player there we are
you see this data YouTube ID which is
the YouTube ID and data href which is
the location the href of the page where
that player was started so if the to
match the current windows 8 ref and the
href that I set then we disabled the
small video player and if not then we
enable the small video player and if
there's no playing video then this will
just do an early exit so the I think the
interesting thing though is the
technique of the animation I have
mentioned on many occasions before and I
probably will continue to mention it
while it's still relevant that animating
transforms and opacity is typically the
way to get decent performance out of
your animations if that's news to you
then you should have a read of the
google web fundamentals rendering
performance section or take the Udacity
course that is also linked on there and
I'm sure we can pop it in the notes as
well but what we don't know because it
is a dynamic animation it's a responsive
site so we don't know what the transform
needs to be because it could be you're
going from wherever the thing is on
screen down to the bottom corner but we
don't know specifically what that
transform would need to be if we were
going to use the transform so I use a
technique called flip and we have a
supercharged TLD w on flip the idea is
that you can you can calculate the
transform dynamically by saying well
where is this thing now and no probably
in that kind of big masthead area but
what were those where it is and where do
I want it to be well I know that because
I wanted to be like 24 pixels from the
bottom right-hand corner of the screen
or 32 weeks or whatever and it said 32
pixels yay
and I wanted to be a 40-percent to its
actual size so you see what I do is I
call here get bounding client wrecked
which is the get me the current position
of this thing and get burning plant
wrecked has been around for ages like IE
five four five six I been around forever
it's been ages and you get back this
object with width height left right
bottom all that kind of stuff and then
we basically make all the mutations that
we need to put it into the bottom corner
and then we ask the question a second
time where are you now what size it and
everything have you got and so we know
where we were and we know where we are
we can now figure out what transform we
actually need to apply which is like the
right position from the first to the
right position of the last and so what
we actually do is we've left it in that
smaller bottom corner position but we
transform it back and up and out again
so that it looks like it's still back in
its first position and we do all that
really quickly like this all happens
synchronously so you won't actually see
a frame being shipped in between these
steps and the danger point is actually
this the second time we call get
bounding client wrecked there's a moment
where the browser goes well you've just
changed a bunch of styles here I don't
know where it is so i have to go off and
apply all those styles which we call it
forced synchronous styles forced i think
that's it forced yeah for synchronous
styles yeah and then the forced
synchronous layout pass which is like
okay I've applied all those styles
synchronously I couldn't do that when I
suited me I dare do it on you know right
now and I have to do layout like figure
out where everything is and what size it
is so if it's a big Dom that's this
point here the second time you call get
bounding clerics could be very expensive
in my case it's a small DOM and it's a
calculated risk on my part anyway so
we've transformed it now back up right
so it looks like it's in the start and
then this is the bit I actually really
really dislike about the the platform at
the moment
that you have to wait frames so you make
all those changes and you apply that
transform that brings it back up to look
like it's at the start position and then
you think okay I could switch on
animations and tell it to go down to the
bottom but that doesn't work because
browsers defer all these calculations
until then unless you ask for something
up front so the polite version which is
what I'm doing here polite is to call a
request animation frame and be like okay
I'm just gonna wait one frame while you
apply all those changes that I just made
it in this case it's just that that
transform and wait one frame for that
and then I'm gonna because this could
have happened partway through a frame I
wait one frame for that to take hold and
then I'm going to wait another frame and
I'm going to switch on animations and
then I'm going to wait another frame and
I'm actually now going to transform the
the like basically get rid of that
translation and the scale to put it down
back into the corner where I want it and
that kind of way to frame do a thing way
to frame do a thing wait a frame do a
thing is just it's an artifact of of the
web which I find a bit bitter and I
think I think web animations would
probably help here because the other
thing I have to do well there's it the
other way to do this rather than just
kind of waiting a frame is to force it
by saying asking for offset width offset
height because that will force the
browser to kind of apply the change and
then I could make another mutation of
that and then I could ask for offset
width again and it would force it to
make the change so I could force it into
their kind of reflow sort of that
readwrite mutation reeded thing cycle
I'm not doing a particularly good job of
explaining that but the idea is that I
can force its hand if I do if I ways a
frame with a request animation frame I
know those tasks will happen anyway
because they'll happen at the end of the
previous frame so i can sort of i can
wait a frame a frame and then a frame to
do it or i could have been dispersed
kind of faux read calls in the middle
and because of the fact that you could
say save it after this first frame this
first requestanimationframe you could
actually go back and that could then
restore we could switch across the
setting the player back to
large again rather than small so I
actually have to manage state a little
bit here and kind of go if for some
reason they've gone back to the big
player during during like waiting for
these few frames every time I have to
wait a frame I basically go if if things
have changed in the interim it just
canceled don't worry about setting these
next things and that's I mean it this is
not code that I like writing and I might
I might go to the less polite version
where I don't use requestanimationframe
and I just intersperse read calls to
kind of force the browsers and i don't
like this very much so yeah I'm
obviously probably being quite clear
that I don't particularly this is
probably the the bit of code in this
whole thing that I'm like I'm like oh oh
really now also at the same time it's
not the worst code I've ever written I
have written some awful code yeah well
all going to move on haven't we right so
there's that's taking the video down to
the small player probably won't be a
surprise that you pretty much going to
see the same thing in Reverse when we
disable the small player and go back to
to the big um which is again you sort of
take a take a reading of where this
thing is remove everything that made it
go down to the small player in the
corner ask the question again where are
you now and then there's a little bit of
a dance asking for existing transforms
because of that and then its frame frame
frame the frame dance dunt dunt them and
then we are done so there you have it
that's basically it in a nutshell then
there's a lot of boilerplate II stuff
about making sure that we can embed a
link and that we can when we begin
playback we do an iframe and we you know
embed the YouTube video and stuff like
that so there's not most of that is
boilerplate I think it's just the
technique of the of creating the
transform on the fly that's quite
interesting so there you go uh I think
probably in the next video I might
talk a little bit about the side now
maybe because I've done a little bit
more work on that you might be noticing
that I do a little bit i bounce around
when I'm working on these things though
so that what takes my fancy today
because that's it's one of the freedoms
i have in this particular project that
the deadlines are there but within that
i can still decide which direction I go
and at what point and I'm feeling pretty
okay about it I've been actually very
okay about it i'm actually really
enjoying this this this bill that's been
a good build so far oh I wanted let me
show you this little little thing here
if I just enable this scroll to when you
go from section to section to section
let's say you go back to that I pop the
the screen to the top because that's
kind of more what you'd expect from the
behavior of it from a site but on the
body on the body here i have scroll
behavior smooth which you'll notice is
currently an unknown property name in
canary if you switch on the flag it
switches on the smooth scroll which is
already enabled in firefox they've
already got it oh you need ants don't
mmm i don't think i am going to set it
as my main browser thank you tempting
okay let's see if that works well
they've removed clutter so I can focus
on what I want to read a that's kind
right when we go to a section oh it's
not working do I need a new version of
Firefox let me see Firefox is up to date
interesting I'm wondering why I'm not
seeing the the smooth scroll maybe I did
something different than in which case
i'll save that for another time huh just
goes to show don't do a demo on the fly
when you thinking hey that all went well
why don't I just show them a little bit
of extra stuff hmm don't forget that you
can subscribe don't forget that you can
check out the code is on github as
always comments and all the usual stuff
below and I will see you next time
Oh</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>