<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Server-Side rendering with Firebase: Live Code Session - Supercharged | Coder Coacher - Coaching Coders</title><meta content="Server-Side rendering with Firebase: Live Code Session - Supercharged - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Server-Side rendering with Firebase: Live Code Session - Supercharged</b></h2><h5 class="post__date">2018-02-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8VDxX8vw988" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">it is 2018 and it's the first
supercharged of the new year hi I'm
Surma now I'm David East oh just made it
alright we're ready to go let's go did
you hear that new intro it's pretty good
you didn't hear it because we don't know
I didn't hear it good acting though I
always play welcome everyone
supercharged live stream live coding
it's back and we have a guest from the
Americas
I flew min so he can talk to us a little
bit about what is it that you do as you
put it I work on the fire bases a fire
basis and so you have the honor of
basically breaking a long tradition of
doing just vanilla only local everything
is on here for the first time we're
gonna use firebase and I'm okay that's
not my first time using firebase
no no but yeah on this note in the scope
of this show right that's pretty cool we
taste about a little bit in our little
videos that we put out and apparently
lots of people saw it because we have a
lot of viewers right now hi to everyone
very glad to have you as a humble brag
maybe we should what what is it we were
building so we talked about a real-time
comment section but there's surely
there's more to it than just that
so what is that your plant so we're
going to do some custom elements not
like the full web components model
because I'm gonna use shadow dome we're
just gonna use you know custom elements
to have a nice organization to our code
and we're going to plug in firebase
authentication to sign-in with Google
and then once you are signed in we can
then start adding comments we'll get
your profile picture and your name and
then whatever comment you put in and
it'll be persisted with cloud firestore
so we'll also have some really nice
offline flaky Network resiliency nails
in me pretty good all right I'm looking
forward to that um to everyone who is
see for the first time this is what the
show is about we're gonna like it or in
this case you are going to live code I'm
going to monitor the chat that we have
on the live stream you can ask questions
I'm going to try to either answer them I
self's or forward them to you and try to
confuse you make you stumble so if you
have any questions didn't understand
something feel free to ask I'll try to
weave them in but without further ado I
would say that's good coding alright
let's do this so what are we starting
with I hope nothing well I I did the
liberty of you know downloading the new
modules because like you know we didn't
want to waste time with NPM install
right that's a good call I would say yes
but we can peruse the packages out JSON
alright to see what's going on here and
so effectively well ignore the scripts
for now we'll get into that later but
we're using gonna use Express for our
little server frame before here so I
hope hopefully most people are familiar
with that one that's good use firebase I
see and then firebase functions to do
that serverless so firebase functions
cloud functions for firebase it's hash
like branding when you say the four it's
when the hand comes out Oh for firebase
okay oh that's how you know I'll learn
the waste and then as dev dependencies
we have babel in the transform es2015
month you're in but the goblin can't
look at the babel camp oh I didn't know
that was a thing
it's a thing okay I think babble is
technically correct should ask everyone
if it's babble or Babel so if you want
to use Babel you will have to be um loud
Babel or Babel yes but this is very
simple just to transform any es we're
actually gonna use yes 2015 modules in
the browser but not on node we're gonna
use common Jaso it's just gonna be a
really quick so that's the only thing
you're using and just using app 42 right
modules and for the server side with
transponding them to college it's not
even down level any like consulate class
okay and then CPX just cuz it's an old
trusted tool for of mine to copy and
paste things what does it do because not
everybody knows what he knows I already
have a question what a CP excellency px
it is basically being able to copy with
like you know
splats and specific like j sh t ml so we
like a recursive copy but you can filter
by extension or by utterance in the name
you can you can do a curse and you do
not recursive you could do patterns it's
a more powerful yeah copy yeah more more
Devex copy Devon experience okay and
then firebase tools which is the CLI for
firebase
during deployments local emulation all
that fun stuff so all right I'm gonna
start by creating my source folder I'm
like a source source I'm a source folder
kind of person where it's like write
your stuff and then be able to just like
totally clear out any of the built
directories so I'm gonna start with I
have a client so that's gonna be all
static assets anything we're gonna serve
over firebase hosting CDN and walks
you're gonna serve everything over
firebase hosting CD on but it's not
gonna get generated I see okay well
we're good talking about the CDN stuff
in a bit we're gonna have a server so
that's gonna be all of our generate our
HTML for our server rendering and then
the last bit we're going to have our
components and this is where all of our
custom elements are and they're not in
the client or server because they're
going to be built into both because
we're going to need to render it on the
server and we're also going to have them
run on the client so okay that sounds
interesting having it to run them both
so we're gonna get started real quick a
nice little index j/s and so we're going
to require from firebase functions
people have now started arguing off and
about gif where's Jeff good which camp
are you in oh I am the gif get out oh
wait no sorry gif gif good I couldn't
remember which one I was trying to like
say it and then I was I said it
I'm the GH i f do gif yes I agree I
think jiff is it doesn't doesn't mesh
with me but it's but it's fine it's fine
so we're importing fibers functions
because we're gonna use firebase
functions yes and we're also using
Express and we're going to need to
eventually require firebase and I'm
gonna actually require firebase as far
base slash app because that only is
gonna pull back one bit of it it's you
know it's notes so it's not as big of a
deal but it's so nice to shave off bytes
where where you can wherever you can and
then that's good going to do our
firebase slash fire store which this is
required to do because fire store is not
loaded by defaults into a like if I just
said require firebase this would bring
in a bunch of firebase F button
not firestore so you need to do this
sort of like okay that's good to them
little like side effect require that's
fine all right so now what I can do is I
can create a Reuter or is it a Reuter or
a router we can just keep this going all
route overall two people leave a
comments in America we say router but a
friend of mine who's in London he made a
very strong argument for why it was
Reuter alright and it was basically he
read the definition of Reuter and it was
what we called router and read the
definition of router and it was not what
we call router so there you go they
settled it is Reuter but I'm gonna say
router alright so I have my router let
me say router dot get my home route so
we're going to build a comment section
right yeah so you're going to have one
endpoint that surfs I guess the HTML
it's only gonna have one endpoint for
these oh okay that's it because
everything else we're gonna be able to
do on the client side with our very
store gotcha okay so I think I do before
we gonna do server-side rendering at
some point so that's probably gonna go
way to do right now look Oh we'd see
look we're gonna do oh nice little
Austin aren't the Marky Mark II still
works blink sadly doesn't I know all set
I don't know I don't know if that is
said that'll be custom element bring it
back yeah we could bring it back so we
want to set up the firebase club
functions for firebase so to do that you
export out a function so we're gonna sue
exports dot supercharged you've actually
call this whatever you want I'm just
going mine that and say functions dot
each TPS cuz there is plenty of things
you can trigger off of look at Auto
completion nice yeah that's good
and then on request an on request is
actually just like this kind of callback
right here so it's a request response
like Express style handler oh cool and
what we can do is actually pass back the
full router yeah so the cool thing here
is if you have any existing express apps
and you want to throw them up on the
chrome in just just one line of code
just so what we're expecting to see now
it's been going to start the local fire
Klout always functions and not not see
that we're still on source so we need to
build our built things yes right so
we're gonna build so actually I'm gonna
set up firebase so to do that not yarn
lock that's a scary file I'm going to
make what is it
firebase JSON and so I could do this
through the firebase CLI but this is
just gonna be a lot your elite enough to
actually do it by hand I don't think
anyone's referred to me that way all
right so everything create a hosting
configuration and I'm gonna say my
public folder so like what I want to
serve my assets from is called public
you're so creative it is it's very
creative and so now but also one of the
things I need to do is since I you know
have these I need them to serve from
functions so if ya collectively you have
this public folder and you have a
functions folder so public is like
straight on the CDN like surf from
washing everything does not go out to
Club function yes yeah Club function is
if you have something with Club
functions it actually by itself has
nothing to do with firebase hosting but
we can write something to link and so we
can do that through a rewrite so we can
say like whenever firebase hosting sees
this URL we're gonna call out to this
cloud function smart and store its
response all right so I just got a
question if this is gonna be available
and github later on yes of course like
every Arlette seems we're gonna put the
code on github later on so you can play
out with it run it locally see if you
get the same results hopefully you will
and just oh I will put the link in the
description once it's there on the video
on demand because you can really watch
this video multiple times there on all
right or send it to your friends I mean
who knows should I explain what I'm
doing so all the wee rights thing I am
doing a rewrite or basically you're
saying whenever you see anything in this
case and in this case it's okay to do
that because when we have one file we're
getting outs I could just say like slash
but for superstition because that's how
I've practiced it I'm gonna do the star
star just reword everything yeah I'm
cool with that we just doing whole new
topic so star stuff that means it match
everything even if it's in a subfolder
because I think one star would not yeah
match a subfolder but this much whatever
anything
I'll get anything the cool thing too
is that if you have a static file that
always takes precedence over the club
function so you don't have to worry
about skipping over static files
I see so if I have an index that HTML it
will not serve this route of mine it'll
prefer the index that each team that is
cool yeah all right so you can see we
have everything's called super charge so
our rewrites are good we just actually
need to set up firebase the firebase
functions SDK and so to do that I'm
gonna tap into my node modules so I've
installed locally I'm gonna say in it
functions Oh before I do that I almost
messed up I want to create a firebase RC
file which by the way isn't it's so cool
you just make a file and a little logo
that's hashtag branding yeah just it
just disappeared one day I like we
didn't do it someone just like hey put
it in there right you didn't do it
mm-hmm and so firebase RC is your
configuration for your project so you
can like use aliases for projects to say
like deploy to my Beijing Beijing
production people I just set this up
from scratch because I knew the name of
the project and so ours is gonna be a
default and the default is gonna be
called supercharged comments nice all
right so that's what hash like branding
everything is on brand today so now I'm
gonna initialize the functions SDK this
is my favorite part right here it's like
fire bears you know this nice little
emoji art ooh yeah that's good that's
legit yeah all right so it says okay ICU
a firebase RC you're good you use
JavaScript or typescript because there's
actually out-of-the-box type script
support feeling nice I do love
typescript but I'm sticking to
JavaScript here okay we're gonna do the
untyped root yeah and so you can even
set up es linting which I'm going to say
no and probably regret and right here is
it's written our functions package JSON
and our functions index J s and so this
function is packaged up JSON is just as
Furbies admin which allows you to do all
this ad
administrative type operations and then
functions as well so we can do the
serving and this right here your
functions have to have their own node
modules so while so I'm gonna CD into
the functions and I'm gonna just kind of
like yarn install it it's gonna take
part like 20 seconds or so so while
that's happening we can kind of go
through and look at our script all the
secret scripts secrets because we are
skipping over anything like gulp or
grunt all these puzzles we're gonna
write some simple note commands I like
that when it's like up to a certain
level it doesn't scale but for like
small project like this one like if I
had to leave I had two and an one more
time in here I probably yes that would
be my limit but what I like is is I can
say okay I have this big build command
where I can say build server which all
that says it's copy everything in the
server folder to functions client
everything in the client folder it's a
public components has copy everything
from the source components to public
components Cobo components run our babel
configuration to function slash
components and this is because those
need to be in common J's format for the
server side exactly so for the front
ends we just stay on the module we don't
change our code at all really we legit
one-to-one take it from source table but
for the server side we need to comment
yes we need some module transform that's
all and then we have this nice little
serve well this was what we're gonna be
using so far base serve - - only
functions hosting will emulate a hosting
and functions environment and it will
even read the rewrite for us and so we
just run it all in one go so now that we
had we're going to try will actually
work did you write all these
configuration files by hand so in a
normal case you could use firebase you
need in it right and it will just do it
for you yes as you did this or you did
this I guess to explain what is actually
happening under the hood yeah and what
it means which is good so you'll learn
something hopefully so we're gonna run
this and all the commands that we took
as a little script understand run here's
our our nice little sense and I'm going
to say a yarn serve oh it seems to be
working well see that's the moment we
switch to the browser isn't it yeah it
is well so it's gonna prepare to emulate
functions and then it's gonna serve on
localhost 5,000
this is all steding and now the
functions you can see it's on 5,000 won
but because we have the rewrite the I
don't know okay put them together so now
we have a local host 5,000 and looking
and the Marquis works I saw a question
and when we're done ship it
that's our comment section ladies thank
you for watching I saw someone asking
what is Marquis and it made me it's it's
been a running gag in the 90s I think
that was on the web it does this it
makes some content so I cut around from
left to the right and it's been removed
Marquis is a is a very complex tag you
can even use like properties controlled
screen yeah I don't use it I built an
entire website when I was like 15 where
everything Marquis din you want you want
it tomorrow beautiful because yeah great
times with anyway that gives so what so
now that we have our serving running
with our server side rendering what I
want to do is I want to just build like
kind of a static version and so in
server I'm going to do index dot HTML
and I'm going to actually read from this
file and serve it and so I'll end up
doing okay Lisa mints and stuff so I'm
doing a little each tml snippet to look
how fast it can type that's pretty good
I need an HDPE equiv meta tags I'm gonna
drop that and then in title College
supercharged comments nice yeah always
use your title and I'm gonna drop a
style tag in because we are gonna be in
lining some styles I agree I approve
well we only have one page so yeah
that's why yeah then topped with the
first frame we don't need to fire off an
additional request just to get the Stars
if it's a single page thing so since I'm
not using shadow Dom I'm using the cheap
version of shadow Dom which is called
append a prefix before your classes so
this is basically shadow Dom you're
showing that isles by a pet by
prepending
SC yeah super running yeah we're gonna
do like a container because we're gonna
put everything in the middle so what
we're gonna build here is you're
building the UI for a comment so it's
probably gonna consist of a form where
you can if you're logged in write a
comment and submit it and it will appear
and probably the list of the existing
comments as you would expect from a
comment section so just so you know what
David is working towards while writing
this because
right now it's just dip soup we're gonna
we're gonna make pull it up we're gonna
make sense from this div soup but I like
I like making the div soup first and
then like refactoring it into custom
elements so what I'm doing right here is
we have our I have another container
inside of that so we're gonna have sort
of like an outer container
inner container and then we're gonna
have this SE login which will become a
custom element so okay I like to ID
things I feel like it's a little
old-school to do that gives me a nice
little confidence and I go to get sign I
know where my elements are yeah it's no
shame in that
some people prefer the get element by ID
oh yeah vector and that's you know I've
perfectly fine it doesn't make a
difference it just kind of stopped using
get element by ID but I don't know maybe
today we'll see you I've only used quick
shout out to get element by ID the
original the original starting with an
h3 because why not yeah putting into h1
and h2 I don't in the middle yeah yeah
h3 it's unoffensive neutral and so we're
going to create a comment form because
we got to be able to it want to send a
comment right moment so I'm gonna call
this a sea commenter form it's sort of
the mindset I'm using here is that all
these this class right here will
actually be the element name when I
refactor it and so what is this so we're
at a text area oh I do not need that
much that that's a little possible
extreme alright so we have a text area
and then we're also going to have a
button so that's gonna have a class of a
CVT as we're calling it so for everybody
who maybe joined a little late welcome
this is supercharged life coding it's
it's back we're doing it this is David
eat east david me - sorry David East
from the firebases
and we are building a real-time comment
section where you can leave comments as
a user and they appear real time and
also appear in real time for other users
and it uses web components and the
certified rendering and it's resistance
again it's like networks resilient we
had like 8 takes a time we trying to say
that word word it's it's not good yeah
but so we have a lot of buzzwords to
cover today and I'm really excited about
that
and we're now just building the forum
where users can hopefully later on leave
the comment I mean we're not gonna host
this publicly so you're not like we can
all go on to this and start the
commenting but the technology will work
so you can later on grab it from the
repository run it locally and play
around with you know how airplane mode
interacts this thing and all these
little things will get there for now
we're building the now that we've done
the form I think yes as a secretary and
a button that's all you need for a
comment I think this is all just to get
it on the page and scaled and then I'm
gonna start moving the pieces into
custom elements so this will obviously
the part where all the comments from the
other people are listed where you can
reply to or laugh about how weird some
comments are that sometimes get left on
these comment sections on websites all
right
so thing this is all of our give stuff
and so what I want to do at this point
is right since actually I want to serve
this you know beautiful looking page so
I'm gonna open up a new little bash
thread that there and I'm going to
require the file system and what I want
to do is I want to pull in this
index.html file yeah so now that's the
thing you said where every somehow
linked up the aesthetic content with our
functions code yes and I am reading at
sync which you know luckily you're only
doing it once and not per request so
yeah I'm gonna I'm gonna let that have
it that is where that is actually how I
like rationalize this I was like well it
happens on startup so no better good it
be somewhere somewhere there's some node
expert who's just like hah alright so
now we have oh yes I mean you just come
back as utf-8 verse seven isn't the
default I know one comes back as a
buffer oh right you want a straight yeah
Oh mr. had that that is a good call yeah
and so now I can just send this back and
we're eventually gonna be doing some
manipulation to this for the server-side
rendering but I want to make sure it
just serves up some time gonna
people say you misspelled SC author name
that is good I said yeah use the German
spelling yeah well there's no styles yet
so doesn't matter but thanks for that
I'm glad that a lot of people are paying
attention and catching these typos all
right do we got error so what I like to
do let's go here and says unknown
encodings I probably spell the encoding
wrong as well oh I didn't see that
that's very hard to spot yeah oh I feel
like now I really want to start as an
encoding called f28 and just confuse
people it does like everything backwards
like in a good old days when you would
have that copy over what is that I don't
like reading it in the browser because
it's like not formatted unknown type
encoding moved 8i I spelled moved 8
again oh I know what I did I'll go to
editing I know I usually have a git
repository initialized and these are all
grayed out because they're getting so he
was editing the thing the target of the
copy operation the source I'm glad I did
that early and not later or not after I
wrote a ton of code because it will just
destroy everything alright now we
refresh and it's beautiful that ship it
we are done that's a comment section
alright so now I'm gonna write the
styles this is the part that I've been
like mostly oh man I love this bit
because I have started to do it on
practically any project the first thing
I do is a star sector which measures any
elements but at the lowest specificity
is there any other styles will override
it and setting box sizing to border box
yes that means that the width that you
define on the element will include the
padding so you can change the padding
basically indent the text or move it
inside without making the element bigger
or smaller
by default changing the padding will
make the element bigger and that can be
really confusing so I do recommend
setting box sizing to border box it's a
really neat trick yeah I learned that
one from mr. Paul Irish back in 2000 and
whatever is when he published the blog
post it was like one of those
mind-blowing moments I'm gonna drop on
this there we go so we're gonna do the
SC container and so we're going to give
it like a man
with like a hundred and forty pixels
that sounds right that's a good number
yeah why not and we have to make sure to
margin:0 auto ha that's basically
centering it bring it in because like
the comments are gonna have that much
text so I can't I really want them like
pushed into the way I don't want you
want text line to go all the way from
the left of the screen all the way to
the right side and oh yes I want to add
padding on the sides so when it is less
than eight hundred and forty pixels you
get twenty pixels on the side and it
doesn't just like stick to the side of
the screen padding's there are a go-to
aesthetic tool to use yes I can do more
Airy and then in the SD comments section
I'm going to constrain it even a little
more say alright we'll only drop it in
so the inner container we also want to
margin twenty pixels 20 pixels Auto it
so it has some some spacing between
Commons one question we got what can you
explain again why we use two tf8
well-known returns everything is a
buffer okay by default which is most
buffers on a string so it's really hard
to work with that and since we want to
do some information because server-side
rendering is gonna come up next we want
to work on strings and so we have to
tell you to f8f we have to tell note
you'll get a buffer but decode it for me
using this text encoding which in our
case is utf-8 so this is how Note knows
how to turn this buffer into a string
and gives us a string which is much more
convenient to handle or think about see
it's already working
or we're cooking alright so now bring
the back down and I want to I will do
the button now so a see BTN so I'm going
to give that a border interesting
question somebody asked why is this star
boarder sizing thing not a default style
well the thing is we can't just change
that we would break the designs of a lot
of websites if we suddenly change to the
fall styles of a browser that's one of
the Bane's of the web that one thing has
shipped you're pretty much guaranteed to
always have it there and no way to
actually change unless you think about a
good way how old signs remain functional
and new size can get the new behavior
and to repair it's like what 18 20
characters
you add to your stylesheet it's not that
big a deal and definitely worth breaking
out of existing existing sites over yeah
and the second questions regarding this
was a shadow Dom I mean it does work
with shadow Dom but the style of there
won't affect the elements inside a charm
that's the exact purpose of shadow Dom
to give you proper isolation so there is
no way for outside styles to style
something else inside a shadow Dom and
vice versa styles from within a shadow
Dom won't leak outwards but to not you
know twist our brains and not I mean up
using shadow Dom today just to keep
things simple at some point you probably
should but for now
that's a nice button it's small but I'm
going with it that's good you can zoom
in exactly right
command ctrl + whatever you have all
right so we have our button now I want
to do the form so the form is actually
going to be kind of overloaded because
I'm gonna use it for the form in the
comment sort of like this container yeah
so I see comment form in a seek comment
and then also what I've been doing too
is I know I'm going to turn these into
custom elements so I'm just already
specifying it I see what you did there
so I mean you could probably class them
since I'm not using shadow Dom yeah this
is effectively if I was using shadow Dom
I could turn this into a host yeah that
would be like the default style for that
element but let's keep it simple for
today we're just gonna use one style
block at the document and this is legit
more about how can you make server-side
render happening with firebase how do we
consume our own index HTML and render
into it all these little questions you
usually end up having when you build
services running for the first time
that's what this episode is supposed to
be about and if you have questions about
how and when to use head it on there's
actually some good guidance on develop
receptacle come slash web where we have
loads of articles so if you're
interested or have questions about that
go there read up and if you have
questions you can I mean you can send us
questions on Twitter or leave them in
the comments later you're just really
solid power nice frame around it
all right and I'm fairly certain I'm
missing some styles but I can always
learn that by seeing how it looks so at
some point you would probably also
define a watch task for this it would
just Auto Bild whenever you change the
file but keep it simple that's how we
roll
yep margin bottom I don't want to
implement like a live reload server like
that's what I like if I'm using like web
pack dev server or something like yeah
something that does it for me I will
take it but if someone's like hey you
want to build that I'm like no I can run
my command alright so now we have could
we use web assembly not today
web assembly is super interesting I just
started working with it but um it's
usually more relevant when you do really
hard number crunching and have to go
have a really tight budget in terms of
execution time so for like gaming
applications or stuff so for this
webassembly would probably be overkill
yes so we're gonna touch on that today
so now I'm doing the text area and I
want that to like kind of full-out blend
in so it kind of feels like it's part of
the cupboard for meeee Oh
so I'm going to background color after
ye it so it's the same as the comment
I'm gonna give it a height of 150 pixels
so it's kind of constrained so I don't
have to implement auto grow because you
don't have another yeah that's I can
resize nothing yeah he says none so
there's another little drag I did not
know that's the thing oh yeah today I
learned resize nothing and we're done
cool all right and I want to give it an
outline of none and a border just make
sure nothing creeps in there and that
should oh yeah
oh there is one there's like I like the
aesthetic you already have oh yeah the
original one was good you know but I
like to give a good large font size to
these I'm an updated it but it just
feels better so now we only have one
more thing to style and that's the SE
author so SC author right now they're
kind of like you know on top of each
other yeah actually we can't see the
there's
to be like a little circle I know about
the circle and then the name so okay I'm
gonna use flexbox for that Oh touching
into the modern layout hangout is
flexing great if you don't know about
flexing great you should it's it makes
your life on the web a lot easier and
especially flex no flexing would
actually have been shipped to all major
browsers yes at the same time so we
actually can use them in all major
browsers right now which is really cool
it is very cool and so now another
circle other circle avatar and so this
is gonna be like little circle profile
picture and it's going to constrain the
heights to 32 pixels as well as width
and then we're going to do a background
color of that one
so we even gonna do a little avatars
yeah yes
with Google sign-in you get the little
avatar picture so OH given given the
comments a bit more identity
yeah that's pretty pretty neat and I
like one of my favorite CSS tricks for
making circles is that you can set the
height in the width and then you can set
just like the most egregious border
radius and it will just turn into a
circle you don't actually have to know
the real number so you could be like I
do 50 pixels maybe 500 pixels just turns
into a circle it's nice somebody just
said like resize is not supported by at
Chennai or Safari that's probably good
to know
and it's good to know we haven't called
it out in we probably should this is not
production-ready code as always it's
about the concept so yeah this is
probably not something you should just
take from the repository and shipping a
production and call the product because
we didn't we're not gonna even do
testing there's gonna be no tests and
you should have tests for these kind of
things so yeah this watch it cause all
these things but we're gonna take some
shortcuts for the sake of brevity and
making it easier for you to follow what
we're doing
yes or what you are doing what is a Kiwi
I'm trying to take credit for your work
it's nice just like always and they're
making a little utility function that
I'm gonna use later before I forget
alright so it's built and I do a refresh
and look at that oh yeah I like somebody
just asked is this really life yes this
is really life
yes this is live good good job
undermining my authority that's one we
had not pre-recorded I feel like I
should do something that really proves
its live it is it is we have people here
that do the cameras and stuff all right
all right so yeah so we have our CSS
done nice I see you you you didn't just
have this black circle oh yeah I'm gonna
well it's gonna be the placeholder for
when so it's like someone does actually
someone doesn't have an image you
usually get that like broken image thing
and all shows up so somebody just asked
I find interesting is there and your
resources for bundling or minifying
firebase server-side code you usually
don't need to bundle or minify
server-side code well you can web pack
you can't your server code up and it's
kind of nice is is that then if you're
doing any type of like deployment on the
server you don't have to do run through
like an NPM install on the server I
guess I like salute
he just is just that big bundle yeah web
pack works really well for that
that's a decrease startup time as well
yes and you also can like hot module
swap your server code without a read
Emily but and definitely bundling it's
not as important on the back end as it's
on the front end because you don't have
to worry about runtime trips or slow
network connectivity it's all on one
machine so um what when you get to
bundling and chunking and all the things
on the front end first it's more
important they're much more important
all right so styles are done I'm gonna
go through I'm gonna create this I see
login so that's gonna be in the
components folder so it's called SC
login yes and what I'm gonna do here is
to start using yes 2015 modules and
classes and stuff create a class call it
login button
extend HTML element and then what I I'm
gonna do here is actually a little trick
that mr.sarma taught me is I like the
static oh yeah I do it a lot yeah it is
it's really nice because now I can
return you know do like a little literal
inside here and just a nice way to
associate a template with an element
it's just aesthetic
property in there so you can and I just
now I'm just going through and I'm
copying in the inner HTML of all this of
these divs that I wrote and what's kind
of nice is so now I have this but I
would prefer to have syntax highlighting
so if I write HTML because of the litt
HTML vs code extension that I know that
this is no HTML that's like syntax
hiding yes eat but I not I'm not using
with HTML so I mean you could here but
we don't we could and and if I was
continuing to refactor this I would
probably this was a production writing
code I would move to so here's a little
trick so I'm going to say Const hTML is
string dot raw which is the however
actually tells you it's intended for use
as a tag function of a tag template
string and it does the default thing
that you also get to have no tag so this
basic it makes HTML behave it if it
wasn't there which is exactly what we
want in this case it just turns into a
string which is cool before you connect
it come back I'm going to create my save
foo bar if this is life
foo bar there you go we now have
established that this is life that was
not asked from someone to say beforehand
we did not read that let's get back to
HTML element all right so we're doing so
we're turning the thing that you wrote
as a little different it now into a
custom element just to encapsulate all
the logic that it comes with logging in
into one element that we can just reuse
potentially in other projects later on
yes so it's legit just a button yeah all
right
while we are server-side rendering this
right here is not going to be
server-side rendered because it's the
login button it doesn't bother me that
if that's not in the document for server
rendering I want the comment content
yeah to be in the document like this can
be added on you have to have JavaScript
to log in so it doesn't really matter
that a blogging button isn't server
rendered true so templates I hope most
people know this a template tag is a way
to pre parse HTML that you can then
instantiate a lot quicker than yes using
dot
HTML because that will go through the
parser and the notes we got created well
in this case it's already in a tree form
that consists of notes and it just just
doesn't deep properly you get a copy and
you can just use that which makes
instantiation off the same template
multiple times much faster than it would
be with inner HTML correct so I created
this element we're going to come back
and actually make it do something but at
first I'm gonna create this index
jeaious which is the entry point of my
clients I'd like you know codes so what
I need to do is I need to import from
components
/sc login dot J is very important yes so
that you're now importing your own
elements into your main JavaScript file
and then I'm gonna use the custom
elements API to define
SC login that's the standard way of how
you define a class as a custom element
yes so now it will be available as SC -
loggin between angle brackets we just
made an HTML element so what I can do
here is I can actually delete this and
just say I see login so let's just see
login all right and so at this point
it's me - David why not use vim well
I've gotten to them once and then I
couldn't get out of it so I just took my
computer and just mash threw it away I
bought a new computer I have to admit I
have been mode enabled in my views code
actually of both worlds I use them all
through school and then when I
discovered what IDs were I just never
went back yeah I can I can see that you
know you did c-sharp in your previous
life that's if you've ever done c-sharp
there's some amazing IDs and you
probably never want to go back yeah yeah
this is it's quite true alright so I'm
gonna say script type is module which is
also very important because that way
your import all your stuff love it well
it's cuz when you fail pretty hard by
not putting type equals module then
remembers a syntax error you're like
what yep
that's actually I think that's one of
the one of the more confusing error
messages that import the import work
just becomes a syntax error
yeah you're like wait I guess my browser
has
for support what what is happening well
it's a different parsing engine
apparently or something on those lines
so type module and able to the power so
to understand the import or without it
it just doesn't okay so we have SC login
but it's not appending to Dom so oh well
that I'll explain it I know why cuz I
only built on the server and I need to
start doing a full bull now David's pay
attention alright so now we're building
now do a refresh and then we have our
login Bob yeah as you can see if we view
page source it's not the actual button
itself is appended client-side which is
fine because we're gonna make sure our
well as well login we need JavaScript
anyway so there's exactly no point of
trying to make the button work without
JavaScript if then it's like doesn't
work afterwards speaking of making it
login that's what we're gonna build
right now so we're I just did a nice
little script that all does is grab the
firestore in firebase app in firebase
off SDKs and these little like nifty
double underscore this is like a
reserved directory for firebase hosting
and so you don't actually to bundle
those files yourself but it comes like
oh that that's already on the CD and I'm
pretty sure because there's as firebase
it's served on your you know under your
project yeah and then once someone hits
it then it's on the CDN yeah yeah sure
but but the cool thing here is this in
it and so you usually have to say like
firebase not initialize app with your
credentials this one does it for you we
generate which project it is so it
already records wow that's smart
I'm yes that and it shall show to make a
comment that we've deferred all these
scripts because modules are deferred as
well apparently 4.10 of the SDKs own
yeah well I haven't tested this on 4.10
so deal with it
feel free to later on grab the project
fix it for for 2.80 but hopefully she's
just worried it should just and then and
then give us a PR alright appreciate
that so what we're gonna risk it we're
tight on time so we're going to get
firebase is on the window right now
we're gonna work on making it more like
you know
yes module like compatible but right now
we're just gonna grab it from the
so I'm gonna say firebase dot as a
function and then what we want to do is
we want to say okay when someone gets
this BTN login this dot query selector
hashtag BTN log in and this BTN login
we're gonna add an event listener on its
click ok and so when someone logs in or
someone clicks this login we want to log
them in with GUP absurd it's a quick
question I'm going to answer in between
why defer on the scripts so we have the
script in the head right now and if you
don't put any attributes on a script tag
those script tags will block that means
nothing will appear on-screen until the
script has been both downloaded and
executed but we want to be on screen the
page is already there we and we don't
need those scripts to execute beforehand
so we're just putting defer it which
means just do it later
do it when we're done running those
modules rd4 by default so we know these
will execute in order as we declare that
just after the HTML has been completely
parsed which is pretty essential in your
server-side rendering because you're
kind of saying I have all this content
on the page you can defer all this Java
scripts yeah that will you know
eventually create content or allow you
to log in so the user actually gets
something immediately so you can kind of
get away with having like larger library
sizes if they are not involved in the
rendering exactly your of your first
initial if you're looking into
server-side rendering make sure to
either defer all your JavaScript or use
modules yes very important otherwise you
will just undo all the hard work you
just put into a server that server side
rendering is good for performance when
you can defer rendering scripts if you
can't defer the rendering script there's
no point yeah exactly
all right so what we just did right here
is when someone logs in we create a
Google auth provider and we just call
sign in with redirect which means when
the very descriptive name yeah it is
it's very descriptive and so when you
sign in with redirect it will move to
another redirect you to another page
then from there it comes back so what a
lot of people do is is they want to like
return this as
promise and say Oh after I'm done with
my redirect that's how it works and they
just gone pages gone so you can't do
that so there's actually a couple of
ways of handling this but my preferred
method is to use the on/off state
changed method and this will actually
fire off if your users not logged in the
user would be null but when the user
does login your use will be populated
with its data so what I'm going to do is
I'm going to kind of abstract all the
auth stuff into this custom element
because that's one of the nice things
about custom elements and I'm going to
fire a custom event so new custom event
of call it on/off and the detail which
is that it was just a property for you
to store custom data and it's sort of
like your your grab bag we're gonna have
to detail be the user and then we'll say
this dot dispatch event and then page
will reload when it comes back and then
we'll dispatch an on/off state changed
again so that we can switch it back into
okay so there's nothing is on it like no
login has been happening you click the
button you're redirected to Google your
page is not alive anymore
right user clicks which account do I
want to login with maybe type in a
password if necessary comes back same
thing happens you're not logged in but
then the firebase our module realizes
actually we just did the login thing
exactly and then fires an on/off changed
event on/off state changed event and we
can react it and we store the user as a
property because then we can actually
access that from the IC log and I want
to show gas under what name you're about
to post a comment right exactly so we
have this defined it's another we
haven't defined we're going to grab it
from the Dom so document query selector
and that's going to be a C - login and
now that we have it we'll add the event
listener of the custom event we just did
on/off and what's cool about this is is
now what we can say is like well if I'm
logged in I don't need to see a locking
button so what I'll say is if a dot
detail and so if it's if we have any
detail at all it's not null what we'll
do is we'll take a seat login and we
will go to the class list and we will
add SC hidden because if we're logged in
oh don't you see logging much
at the hidden attribute if I'd hidden to
true well that would keep it in line
this will give it display:none
so well hidden and hidden hidden hidden
is visibility
none right is it I thought it was well
now with someone in the comments yeah go
check it out well said it's an element
to hidden equals true will it actually
move it like properly or will it just so
be an invisible rectangle yeah I'm very
interested because I would like to not
do this if I if I can alright so now
what we'll do is we'll do a yarn build
go and once it has gone through great
all right that was a dictionary lookup
for some reason and now let's let's see
well we have well let's make sure we
check something first sorry so it does
not have it does have se hidden because
I have done this in the past where it's
check out the styles every time I meant
to say I said display hidden and I
really mean display known display
because I've already logged in I'm
actually logs and on this browser
because you have test runs I've done so
it's gonna pick up that I'm an existing
user our bracelets not smart huh yeah
it's you know amazing so what do you do
is is not display hidden I do want it to
my own after that conversation of what
it does and I don't even write that
syntax all right so now let's build that
apparently display that hidden does no
didn't mean visibility hidden right
that's what I was think I meant the
attribute hidden to true it doesn't
display none yeah ah that's much better
than what I'm doing I thought that did a
visibility:hidden no and I chose removes
it from screen readers and whatnot quite
nice but isn't there and every custom
element hasn't my default well I've
already written that code so it's okay
take it it's fine it works and that's
what's most important so the docking
button is gone it's gone you're logged
in cuz I am logged in its se hidden
which are shouldn't have to grinding so
now we're going to do our first bit of
server-side rendering with the SE comet
form so we're gonna create a new element
s-see comment form je s and i'm going to
do some copy and pasting that's what
real developers do really well this
video be available later on yes it will
be available as a video on demand on the
chrome Developers YouTube channel which
you're on right now because you're
watching this so while you're at it
subscribe alright good stuff here so now
we have our comment form and I'm going
to just go in I'm gonna take the insides
of this this inner HTML of this div
there just going to paste it in here so
now I have a nice little template and
for the server I'd want to not just
render the the inner HTML kind of wanna
render the outer HTML tag included so
what I'm going to do is create another
static method called component ah and
that is very similar but the difference
is is I'm actually going to include the
tag an own tag name yes alright and then
you can you could even reuse the other
function inside so you don't have to yes
you're way ahead of me aren't you you
know you also taught me this one a lot
of parts of it I would assume yes so
this right here we'll just call that and
put it in the comment form so we have
our full component and we also have the
ability to just say that template so
it's a little bit of flexibility so now
what we're going to do with this one is
we want to serve a render but we're not
going to be able to serve a render this
as is because while this is gonna be in
common j/s know doesn't know anything
about the HTML element like it's just
gonna write it doesn't exist because
note doesn't know about the Dom or
anything so there's no HTML element base
class
so if it sees this the browser will be
just happy node will just error out and
you won't be able to do anything so
we're gonna do a nice little trick that
you also taught me I did for teaching
that I'm actually part of this one
because some type for circuit rendering
you need these template bits because you
want to render this template on the
server side and so ideally you just want
to reuse the class you just wrote on the
server side but you can't because HTML
iment doesn't exist so so we need a but
this conversation we're gonna say
are you node and then nodes gonna be
like yeah everybody like really use this
H you know this HTML element class I
made and then no it's just gonna be like
okay sure and then but we also say like
are you burn me the browser and the
browser is like yeah and then we're
gonna be like um use your HTML element
class and it's like okay well obviously
anyways thanks and so that's effectively
the code we're gonna write this is
called comment driven development I mean
I would prefer to see comments like this
in my codebase cuz I would be like oh
that makes sense so we're gonna create
this little placeholder variable and
we're going to say if the type of
process is not equal to undefined which
effectively says if there's a process we
know that we're in node and at this
point we can say alright if we're a node
we're gonna have to make a sort of like
a blank HTML class so we'll assign this
placeholder variable to class HTML
element it actually doesn't even matter
what you name this but for readability
sake else we know we're in the browser
and we're going to say that HTML element
is the existing HJ but that's so smart
and then just just sort of make things a
little nicer we're gonna say export
class SC element because it's branding
its hashtag friendly extends from the
underscore HTML element so yeah in my
comma form instead of using HTML element
we're gonna use SC element right because
with a note it's just gonna be a normal
base class because we didn't actually
need the callbacks and note we just want
to have access to our aesthetic
functions or methods that we defines and
in the browser it will still be a proper
custom element it's like win-win it is
it's look like two extra lines of code
however you do lose some of the
autocomplete with envious code because
it doesn't well what if you'd be using
typescript
that's yes it would know the chain you
are correct well that's for another time
today
we're keeping it simple all right so we
have a C element and this is good so now
what we can actually do is we need to
set up our babel building i'm gonna say
that ten times fast
and so babel building battle booming
babel building
alright so babel RC and i have a little
snippet for this this is all my babel
set up like usually you're you hear
about like big webpack configs or crazy
babble setups like this is pretty simple
all we're doing is you're just taking
anything that's es2015 and our
components and we're gonna copy them to
the functions directory but make sure
that they're in common Gs format so that
way they will run right so why but I
thought that note already has imports
and stuff they do but that's in only in
node 8 and it's also only available
underneath an experimental flag and
notate and but I mean we are in at no.9
no.9 I think no 9 I don't know what the
experiment wasn't for well so what node
version I'll be running on firebase 6.11
dot one that's a bit old isn't it it's a
little old we're working on getting
innovate we're gonna corynna cope the
only we're only place where it really
hurts us is when we have to call dot
then which we'll do here in a little bit
otherwise we could use a single wait
what Jason Miller just said he would
give us one dollar for pre-act reference
he has a pre-act reference I actually
almost used pre AK for this all out but
interesting yeah sorry ok not I it was
very close staying vanilla all right so
now do refresh and I didn't register it
or do anything with it but it's still
page still work so that's good so what I
want to do now is I want to actually get
the component on the server so I'm going
to require from dot slash components /
SC comment form okay and so this is
gonna be a comment so it's interesting
because what we're used to from the
import syntax works exactly the same but
require yeah so it almost doesn't change
anything except
syntax we can even see we have our
components here and our SC form like
it's exports common form support common
form all this this babble e stuff I'm
glad I don't have to do it alright so
now what we want to do is is we want to
effectively be able to say alright we
know we have common form has this
component method that will spit out it's
you know it's HTML its outer element so
what I'm gonna do is I'm gonna go into
the thing and I'm going to actually
create a comment so I could and probably
should use a templating language like a
JSA not I should that have years and
years of work and a develop a community
development ecosystem but I'm gonna use
HTML comments and back to the base exact
tomato you're gonna replace those right
you just gonna use them because we're
working in the back ends is that we are
using strings yes we taught used utf-8
encoding to tell notes give us drinks so
we can manipulate them so now we have
comments in there so and I'm gonna make
a function that does this for me and a
more readable way and I want to be
really simple and what I think simple I
think Java so I'm going to have it be a
part of the Java builder pattern Oh Oh
fancy so now I'm gonna say add comment
form and the way this will work is
you'll be able to say like ok
everything's going to return this but
we're going to do a replacement up here
and then we're also going to have to add
all the the comment list and all those
comments and so the builder parent is
really nice when you want to if you have
objects or instances that contain really
complex and lots of optional options all
these things yes because this way you
can like iteratively build up the object
with a data that you want and then in
the end you say like build this for me
and then you get out your created object
at the end without having to overwhelm a
user with like a constructor that takes
a massive options object which I often
see in some JavaScript API is
this is a really nice way around that
issue so basically we create a little
helper function that says alright we're
gonna replace the page value with a
holder and a replacement and so in this
case we're gonna say this dot replace
we're gonna take this comment form one
yeah and we're just gonna as a string
and we're gonna say alright now I'll
take the comment form dot component
that's neat so bend them in the HTML we
just have little Marcus put the comment
stuff here put the what is the other one
the comment list here the comment form
here put the comment list here and then
we can actually reuse the template we
already written for from our elements
and inject them using the Builder
pattern yeah so now passing in the XHTML
that's the original page we're going to
do all the manipulation on and then
we're just going to build the page and
send it back down so now let's do a
another build you know one thing I like
about using yarn oh I did that thing
again where I modified the I didn't even
have that file open I know all right I
got to write that again all right I can
do that quickly you entertain everyone
yes I actually just saw a question I
found interesting David I think it
confused simple with the bows I don't
think that's right because the same same
word there those two things are pretty
much orthogonal in my view like
sometimes verbose makes things simpler
for the rear and I feel sometimes as a
misconception that people write code for
the computer or for other humans most of
the time the people who have to read
your code or humans computers are just
you know they've have an engine
they will always read it the same way
but humans have you know like a human
background will interpret your code and
will try to guess what your intention
was and so verbose can be a really good
thing but both are expensive we have
JavaScript minifiers and very smart
tools that squashy code down to a small
size I'm not saying you should not write
elegant code and just do it do
everything super explicit like always
make a variable 15 characters long when
one character would have been fine but I
feel fine with this page builder hat
does a really good job at commune
caring what the intention is you're not
just doing string don't replace two
times and you're replacing a somewhat
cryptic Commons with some other content
but you actually know
oh I'm injecting and adding a comment
form I'm adding a comment list
it adds semantics and it's also a very
extensible pattern so that means later
on if you want to suddenly inject more
things if we're gonna build a more
complex page we can just add new methods
of the Builder without having to
manipulate a cryptic HTTP GET or
function so I think it's actually a
really really nice pattern to use and
yes it's more robust but usually it's
helps other people understand your code
and that's a good thing all right so you
called pick up again reading the right
file now I am well I actually copy and
pasted it before copying it before I
built if you mess up once you're you're
probably gonna probably mess up again so
hedge my bets all right so this should
you know should work all right this is
good
copy that now I'm all superstitious and
I'm fairly certain it's highlighted down
there it looks good to me it looks like
you're editing the right file all right
all right we built now what I'm gonna do
is do a refresh and it looks and looks
weird in this way it looks like more an
art almost I know why that cubist you
know why that's good because custom
elements are not display:block they're
not display:block but even let this play
in line if you ever see your element all
messed up it's probably because it does
not have yes poor lighting with divs
then move to custom elements and those
are display:inline so there is my here's
my overloaded one just display and
display block all right so now that'll
work the next time so we have this form
and so what I want to do now is is now
that it's on the page we need to first
define it because that is something that
is easy to forget to do and so we're
going to comment form a seee comment
form custom elements that define a see
comment form and we have a new element
so that should
be back to working so what we want to do
let's go to the connected call back
inside of this this is we're gonna
actually say when someone types
something into the text area and clicks
that button we're going to admit our own
custom event that we can then listen to
to add to the actual firebase tour
yes so now to do that we need a handle
on BTN send it's that query selector
hashtag DTN send and then what we'll end
up doing is say this BTN send add event
listener of clicks onn or somebody
clicks inside of our element we're going
to create a an event so a new custom
event and we'll call it comment sent why
not and we're gonna end up sending and
detail a detail object that I'm gonna
make right now and so we want to get the
value or just say the text and that is
from this yes we want to have all the
data we need inside that event so we're
doing our own event say yo a comment has
just been sent meaning somebody press
the send button so in that comment
op event it should hope so it should say
what was the comment because we want to
edit our database so it should be in
there so now we have our event dispatch
it and one thing I like to do too is
take the text areas value and clear it
so they sent it that text doesn't have
to remain so now inside of index we're
going to grab this from the Dom so SCE
form is document query selector of SC
comment form I believe yes and then we
can say add event listener and we could
say when a comment is sent I love this
feeling when you write your own event
name into add event listener it just
feels like you build a browser ya feel
very powerful I just did moment
it is cool and so now what we'll do is
we'll get a reference to fight restore
so we're gonna say we're gonna grab a
reference to a spot in your fire story
database and we're going to add data to
it and in this case we've basically
maintaining a list of comments right
it's not a very complex database now
this is fairly simple so say firebase
dot fire store dot collection so a
collection is a list and we'll create
one that comments have a collection of
columns in our database and that's what
we want manipul what we want to
manipulate and so we might Mouse's got
detailed text and now it's cool as we
can actually say all right let's store
the photo URL of our users because we
can get that from SC login user dot
photo URL and we can even do the display
name that's just a C login product D
structured this but ok oh and this is
actually called author name with an H
with an H user display name so this is
all information at you were adding a new
entry to the collection because it's a
new comment and you want to have the
text photo the user name I also want to
be able to restore dot you know the
value dot server time stamp I tend to
have Auto completion for this so
basically what this is it's a
client-side placeholder that when it
gets updated on the server it gets
inserted with server time rather than
your clients time oh that's interesting
yes so that basically means whatever
even though it might take two hours to
reach the server because the person who
sent the comment wasn't online you will
get the timestamp of what is act when it
arrived on the server side actually it
will know when there's latency
compensation between the client my
server and it understands any clock skew
between your device and your server and
so they'll know how to compensate that
time when it gets updated not bad yeah
here's a question are you using kpop
case instead of camel case to
differentiate native events from your
own events I don't I I want to imitate a
platform as closely as possible so I try
to
look at how native elements do their
things and try to imitate that because I
think browser engineers probably know
best we have data we do have data in a
little maybe so this is the firestore UI
dashboard console data viewer like the
deterrence work please work if you are
nice to your code it's sometimes it's
nice back so we can now add and so now
we can add we need to lender so what we
need to do is go back to our static once
close out here and and for reference
this is David trying to cope on an UK
keyboard when you're used to an American
keyboard this is very true it's it gets
just as bad the other way around because
I'm so used to the big Enter key and the
Americans have the smaller Enter key and
I will keep hitting backslash I keep
hitting backslash because of the way Oh
yours is wider ours is taller right it's
just wrong on both sides both sides
everyone's wrong all right so now I'm
going to make a comment list in the
comet list component use make sure I'm
in the right folder
come on this component is really
interesting because it doesn't actually
have a template it's just a holder it's
basically if we were using shadow Dom
this would be a slot but we're going to
fake the slot really mmm so do some copy
pasting yes copy pasting always always
necessary and got a comment list and so
I don't need a template but I do need a
component because I'm gonna render this
out on the server and that's gonna have
some state and I'm gonna return HTML
there we go and it's going to be a
string go to raw heck we're gonna get a
mileage out of that one okay nice se
comment list and a/c comment list and
then inside here I'm just saying stick
so it could be it's basically a slot
okay
so this is I don't want comment form I
want to call this comment little list
and I'm gonna make sure to register it
before I forget to register it alright
and say comment list list and see
comment list is comment list alright
great so now it's defined what we need
to do the server rendering part of this
oh and before I can do the server
rendering part I need to actually to
make the SC comment so I'm gonna go into
my components and do a see comment dr. J
yes and we're gonna do more copy and
pasting people like people expect
sometimes that professional front and
engineers do something else I think we
doesn't you become better as a developer
when you know when you copy and paste
what you have to update after you've
copied and paste to make less makes a
mistake maybe what the copy and paste is
the central skill yes especially in web
development inlining I'm just gonna do
with myself
exactly alright so now I'm going to
paste in the insides of the comment and
it totally didn't format it for me
that's fine that's fine
it's formatting I can tab and so what
we're doing here is is we can actually
change this div to an image because we
will have an image source and we can use
that state variable and say state dot
photo URL oh so this is where you make
the template kind of yeah mutable by
saying like give me the data that I need
to put in here and I'll put it in the
right slots yes this is actually still
what still b12 unusable with HTML right
which is what I because what can do
things when we're performing a wave like
they that's way more complicated things
to they're in a good washing and yes and
sensation and reusing I've already
instantiated templates yes we're not
doing that now so I like to keep it in
line with that and then use it to when I
- all right so now we have our template
I need to create the static component
that's gonna return HTML this is the
last of the components oh that's
exciting to have to setup so I'm very
excited so you're saying after that we
are done with some effect rendering we
have it
Oh after I server-side render these
components sure but it's simple so this
is the base work we're defining how our
elements are supposed to be rendered and
then we can use that logic on both the
client side and the server side and then
we can render our our components on the
server side which is called server-side
rendering Oh demystifying the buzz words
of 2018 what year it is all right you
know yeah all right so now we have this
comment as this one and so I need to go
to my server and in my server I need to
import two things actually need to
import the comments that we just said
this looks like a good cross-site
scripting attack vector yes yes you're
right we didn't do any mm-hmm that's why
we're not deploying it this is my
production ready cause you're definitely
I'd this is basically taking user inputs
and rendering it into a page there
should definitely some mechanisms in
sanitize
that's user input but we're not doing
that yeah all right so we have a common
list comment coming form
all right it's a now inside of comment
list we're going to pass in we're gonna
say like add comment list and we're
gonna give it some state so we can
render out the comments so at this point
what we need to do is is we need to go
into our we need to create a firebase
app and so it's a firebase dot
initialize app and what we're going to
do actually is we're gonna go into our
dashboard but our project overview add
fire basis and gives you your
credentials which will basically
initialize your firebase project to your
actual firebase project so we need that
now for the server-side yes not because
on the client-side we did the magic in
ejs import yes yes so for the server
site we still need our credentials
obviously yes so there is some magic in
the cloud functions SDK
I just don't think I'm using it right
right now I'm gonna do it the safe way
the old way so now we have all of our
credentials and we don't really need
most of this like I don't need a
messaging or storage bucket but I'm
gonna leave it all in there for now
because why not
and what I need to do is get my comments
and so now that I have a firebase app I
can say Kahn's comments rough and this
is just like we did on the client so far
based okay our store doc collection of
comments and now that I have this I can
get them but first I'm going to order
them by a timestamp so that way they all
come in sequential order because we're
adding them with generated IDs and the
generated IDs are not guaranteed to be
sequential so okay you just read them
they'll come in random order but if we
add that timestamp we order by the
timestamp we're gonna them let me guess
it's ordered by the time step pick up
fast handshake and then we're going to
call it duck yet which is just a one
time get not a real time because we're
just want to end it all
snapshot snapshot yes it's a snapshot so
we want the snapshot which is not is
your data but plus other very useful
things so very useful things we're going
to discard yes there now well we use you
can get your data back in different ways
which Andy will use and versus the
client the server so like right here we
want to get back this recreate our state
variable which are passing in and we're
going to say snapshot Doc's and Doc's is
the materialized like state of your
collection so if something gets added it
gets added to something gets removed it
gets removed from the array which is
different than like an event stream or
if something gets removed you would want
to the event of what was removed okay so
it's an array so we're going to map over
it and we're gonna use objects not a
sign because we want to merge in the doc
dot data with the ID so cuz their data
is not part of the ID because unless you
persist the ID or self you know we you
know let you do what you want to do Paul
just asked me what the German word is
for server-side rendering I want to know
that Dean slice is like to get old fool
I don't know if that's real so if
someone speaks
in the comments this is how we'll know
it's live all right I need some water
alright so we're we got the data yep
you're augmenting it with the ID all
right
and what we're gonna do here is actually
do the replacement and so we have the
array of comment with the ID and so what
we're going to do is we're going to
create the comments as one big string so
all each we're gonna create into an
individual string comment and join them
together that seems like some good
old-fashioned JavaScript yes it is it is
very very old fashioned so now we have
state which is an array of comets and
we're going to return a new comment dot
component and pass in our C and our C
dot ID so we can ID it with its
firestore document ID and then now this
is going to be an array of strings and
we just want one big showing
join with nothing because we don't care
about anything in between but just one
then concatenate it basically yes so
let's go grab the replacement token we
didn't actually lead all this now go to
the comet list we're a place comment
list with actually not just comments we
need the comment list component pass
through that's like the slot the
comments alright so now we are calling
that on both places so now it's time for
a build that's like this this is the
exciting moment yeah and I call pressure
to myself on the student link this is
not the hard part zoomed in more than I
okay there we go alright it's alright
don't need that refresh refresh so how
do we know if it's summer side rendered
because we can view page source that's
true still watch nothing happening okay
I did build did I you did but are you
actually I probably have an error then
yes unhandled promise from comment is
not defined that seems like something
that makes sense because let's see here
if we go into oh yes comments this is
why I use types keep you plurals right
it's something I run into very often
also the winter that I neglected to set
up would have called that out for me Mac
refresh might have to rerun the server
whoo I did something weird but we got
comments their server site rendered and
you know I like I probably put them
outside of the document let's see here I
see comments come a form comment list so
the comments are running outside the
comment list for some reason so we have
this one outside and then this one also
outside so that's that's interesting
that is interesting
I like this cuz I haven't seen this one
yet so I get to probably wait all right
so we have we're gonna replace comment
list with comment component and comment
list dot component let's make sure oh I
bet you I know what this is all right
where is comment list okay so we close
out this tag sometimes you don't close
out your tags let's have an H source
though maybe is it I close that out okay
all right so this is actually weird in
the page source it isn't the page I
wouldn't hear occurred just well that is
not good
so fire oh now we're all broken oh it
didn't close out of me let's see here
oh this looks oh your timed out probably
because of all the errors we've had I'm
just gonna restart the server right yeah
probably yeah somebody else is also
saying unto unclose tag somewhere the
question is where yeah if you can see
that I mean it's like um page source
should hopefully yeah tell us that okay
cool yeah looking good thing again got
our we're still weird you know what kind
of like it's like yeah pyramid yeah you
know it's nice a nice data flow maybe
it's a feature not a bug
all right let's scroll down so we have a
see comment form slash just a see
comment list you know what it is I don't
see the end of se comment list oh there
it is okay so that
you ever seen comments zoom in a little
bit so that our viewers can help
potentially actually oh I'm just doing
an low and div tag after image tag if oh
yes yes
that is completely true yes there it is
whoever that person is thank you viewers
you're always helpful like legit this is
amazing yeah
and once they said it I knew exactly
that I had done that because I switch
this to an image when it was it's why
you don't have line so longer than you
screen I know I actually felt like that
was a no-no and only yeah whatever and
then it comes back and bites you yep
all right so we get out the server
running and let's build again also the
new sets just play block on all your
custom elements I did good we thought
about that because that was not comment
list but doesn't that's fine because yes
it's now a refresh and every day sorry
ups this is sort of like rendering is
this server-side rendered there's only
one one tiny bit left to do and that's
to have the client pick up on
client-side rendering for the real time
this
true that's one bit we promised to do
are we gonna do that and that's it and
this is the quick part so this is easy
so now what we're gonna do is is inside
of our comment list we're going to go to
the connected callback alright and we're
gonna say when this element gets
connected I'm gonna create a comments
ref which is just like what we did on
the server so firebase dot firestore dot
let's see collection of comments and say
this dot comments ref dot order by
because we wanted to have yeah order
timestamp and we're going to say on
snapshot get back a snapshot so what
this will be the first time it will be
the full snapshot again right yes so we
are gonna get everything again because
we this also took on every new on every
new change every new change okay so
there would be a new snapshot and we'll
get a new snapshot and we could we could
do like limiting and stuff like that so
it's not just like everything we have a
lot of data right now this is no
production ready Co but it's possible we
can do this so at this point we actually
want to get the matcha don't available
variable we want to get the doc changes
because the doc changes are the events
as they occur not the state of your so
basically firebase does biffing for you
yes you have a local state you get a new
state and you can just look at the new
trade or you can also just from this
event look at the differences it will
give you basically I think a list of
items that have been added added items
have been removed and items that have
changed yes so that way you can go
through these three lists and handle
them appropriately fade out things that
are removed fade in things that are
added and just update updated items it's
up to you really
and that's the cool thing so you don't
have to implement some kind of this
thing engine yourself you already get it
so we all we're doing here is maybe you
change over the type of you switch over
the type of the change so if it's an if
the type is edit means this is some data
that has been added to the collection
and you're probably gonna handle that
with red bring in new comment elements
correct with removed we just removed the
old one and now this is where yes funny
ID so like we have already been storing
each comment on the server yeah it is ID
is gets inserted to its firestore ID and
we use the underscore so there's no
possible collisions and so at this point
we can say change you likely impossible
so this may mean you can just take the
document unwrap the elements and then if
the type is removed throw it away so now
we can actually say if it's if we get an
added event we get to see okay is the
element in the Dom because of the
elements in the Dom and it's added we
don't want to render it as a service we
already service ID rendered it or since
skip over it yeah so probably I guess
the first snare you get everything is
going to be of type at it right cause
fire by sosuke that you know nothing but
the we did server-side rendering so we
know some things already that are
already rendered so we don't need to
re-render them but if it's not on the
Dom then we can tell it's been added
afterwards often we need to so we're
going to actually pass in there
and we're gonna say constant so we're
gonna say a good old document create
element of an SCE comment here we're
gonna say element ID is the where's my
tip backticks underscore doc dot ID and
then we can say element dot inner HTML
which if we were using lit or shadow Dom
we could this the production ready code
yeah we're just gonna use inner HTML for
simplicity right now import are common
here in a second and say comma template
because we already have the element and
we're gonna pass through the doc dot
data because that's the state and then
we can say this dot append child of the
element now up here I need to import a
seek comment or it will break comment
see comment excellent and then now I can
just say this dot add comment of change
dot doc because it changes the type and
it condemns a document so yeah this is a
new item and here's the item that it's
new and that's what we're going to use
as the data set for the new comment item
and then if it's removed right now I'm
assuming the elements in the Dom which
is probably not you know probably should
do some if checks but this is not
production already code and did we
define before I run everything I make
sure I did when we did not define a
comment I don't know will matter but
we're gonna do it anyways
wait we're good register 8 well it does
wool it doesn't have any interactivity
oh yeah
so it will look right but it will not it
just won't be right though you know you
know I'll no look at it and just won't
be the same you know refresh all right
all right so now nothing will change now
because if we have to leave a comment
for it to change now I hit Send like
that so this is actually kind of cool
because what happens is we send the
comments and our SC comment form element
dispatched an event that was picked up
and we put a new data set into firebase
and that's all we did because all the
rest
firebase her into a new event that said
a a new item is in your collection and
that was picked up by the comment list
element and rendered it as a new comment
so that we didn't even do it ourselves
it was done through firebase and if I go
onto my dashboard and I delete it or
please work is gone amazing and we did
talk about network resilience so we're
gonna demo that if we say offline so now
we no longer are connected yes
so if I'm right in a comment and I was
like hey I'm in a tunnel I hit Send I'm
offline but it still appears so appears
so basically the firebase SDK takes care
of that and there's only four whereas
there's five here yeah automatically and
then now if I go see you even getting
some that were crying like let me talk
to my server please and once it can
there it just appeared and if we had a
service worker and we enabled
persistence which is an option you have
to do it all let's think just DB and it
will actually do full offline data
persisting across refreshes damn and
that's that is your we server-side
rendered web component real-time Network
resilient comment section flaky Network
resilient flaky now one word was missing
I was caught well done so we built the
thing that we thought we were going to
build and we build it and you OH
should live and we a lot of people were
watching I'm really happy that you all
were talking in the chat and helping
each other out
great to see as I said we're gonna put
this on the github a link is a link is
going to be in the description on the
video that you're on I'm also going to
tweet it out you should follow theories
on Twitter underscore David East or me
that's Erma I do these kind of live
streams around every month so subscribe
to this channel you get notifications
about our announcements and new videos
because we also do supercharge micro
tips and other things
thank you so much for everyone who took
the time out of the day to watch us
fiddle around
I hope ya I hope you had a good time I
did it worked so that's the best
possible outcome it works so that's
great thanks everyone so much and I will
see you all next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>