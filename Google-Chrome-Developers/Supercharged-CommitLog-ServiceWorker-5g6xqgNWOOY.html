<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Supercharged CommitLog: ServiceWorker | Coder Coacher - Coaching Coders</title><meta content="Supercharged CommitLog: ServiceWorker - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Supercharged CommitLog: ServiceWorker</b></h2><h5 class="post__date">2018-04-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5g6xqgNWOOY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the time has finally come
we are bringing our blog to the offline
world we are going to write a Service
Worker for our WordPress blog it's going
to get a little bit weird at times
because WordPress doesn't yet have
out-of-the-box support for serviceworker
so we will have to do some shoehorning
ourselves but in terms of caching
strategy I took a fairly simplistic
approach because I'm just using stale
while revalidate for everything if you
remember a couple of episodes ago we
made sure that our caching headers are
really really sought and that means that
our revalidate step is going to be
really cheap so if you want to catch up
on that I Allstate a micro tip on stale
wire invalidate a while ago which I'm
going to link to in the description in
the context of a blog though content is
usually fairly static and doesn't change
a lot so I thought it's a good trade-off
to push more towards being on-screen
fast rather than waiting for a fresh
response from a potentially very slow
Network so to see how that works let's
look into some code serviceworker is
part of my theme on install it just
downloads and caches everything that I
need to get on screen very quickly it
won't redownload all these assets
because most of them are already in the
cache from just loading the initial
index.html but since there is no
serviceworker yet it will have to
revalidate those with the server so that
means that the install step of our
serviceworker is going to be very cheap
but not very fast but that's okay
because the user is busy reading our
blog post interacting with the page so
this will all happen in the background
and the sorcerer boot up and at some
point just take over when it's ready to
do so the fetch Handler and myself
serger looks a bit messy but essentially
it just uses stale while revalidate
there's a couple of if statements at the
top because I wanted to implement a lot
of exceptions on this for example we
don't want to cache WordPress's admin
pal
we don't want to cache some sort of
wordpress plugin or some
assets from different domains and that's
basic just what these if statements do
the actual response is built on the fly
we are already caching the header and
the footer independently so that means
that if the user navigates to a new blog
post it really only needs to download
the content without header and footer
because we already have those and then
we stitch those things together and send
them off to the browser that also means
that even if these are is on a very slow
Network they will almost instantly see
the header on-screen giving them the
feeling of a progressively loading page
while the actual content rolls in over a
much slower Network so you might not
believe it but that's all we need to do
to make our blog work offline this is
all the sauce Walker does seriously but
also last episode I promised you a
second use case for our message bus
involving serviceworker
so let's look into that so I augment it
my message for us to not only live
within one tab but to actually span
across all open tabs and the
serviceworker and that means that if the
serviceworker dispatches a message onto
the message bus that it will get
distributed to all open tabs at the same
time and that actually turned out to be
really really useful so here you can see
my implementation of stale wire validate
if there's something in the cache I'm
gonna use the cache response
straightaway and if there's not I'm
gonna wait for the network to give me a
new response but even if there is
something in the cache I'm gonna send
something out to the network to check
with the server if there is a newer
version of this resource by comparing
attacks if the attack has changed I
update my cache but I also send a
message to all open tabs using my
message bus now every open tab can check
independently if that new resource is
relevant to them or not and if so they
will show a banner where the user can
click to reload I found this to be a
great compromise between being on screen
as fast as possible and informing the
user that what they have been served
actually turned out to be stale data and
when this we actually conclude the
commit lock series for my WordPress
project I hope you enjoyed it I hope you
learned something if we're
take a look at some details of the code
the entire project is ungettable and I
will link to it in the description of
this video if you have any questions
feel free to put them in the comments
below or over on Twitter if you find it
interesting you should consider
subscribing so you know when the next
supercharged is coming out and with this
thank you for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>