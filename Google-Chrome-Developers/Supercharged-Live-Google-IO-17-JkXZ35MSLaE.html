<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Supercharged Live (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Supercharged Live (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Supercharged Live (Google I/O '17)</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JkXZ35MSLaE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">how's everybody doing you okay it's much
better I'm Paul I'm summer and what we
normally do is we do a show called
supercharged where we live code things
for people and at polymer last year the
polymer summit we did live live live in
front of people live and we thought
let's do it again
and so that's exactly what we're going
to do today but what we normally do is
we only have one of those code and one
of his talk but today we thought we'd
have both of his code so not not at the
same time and we could see we probably
shouldn't we shouldn't nervously we
shouldn't do that so something's going
to code first and you want to tell them
what you hear what we gonna do all right
so I I had the idea that or actually I
exported my twitter archive because I
wanted to have it and look through it
and it turns out that the file that
contains all my tweets I've ever done is
about 16 megabytes worth of baseball
which is a big file I'm not going to
omit because this code doesn't like big
files apparently but I have the first
four tweets and an extra file so that's
basically what we're looking at in again
my first tweet apparently was in 2008
where I say something fundamentalist got
an account on Twitter yay that's like
that's everybody's first the universal
first tweet I think like the hello world
like shouting into the empty echo
chamber yeah nobody cares though and
what we wanted to do is how would you
use this file in a web app bring that
book file back because it's something I
noticed here this isn't an array of
objects exactly it's not an array it's
literally just concatenated JSON objects
they end here the next one starts
there's no commas in fact is adjacent
the pause is kind of if you get rid of
the selection it's got red cool Wiggly
under there because it thinks well it's
not real Jason yeah it's not adjacent
side because there's mostly one JSON
object in there so there's going to be
some difficulties so I guess before we
lose more time we just yeah it don't
start it and the first thing we always
have to do is type really fast and
suddenly we have copyright
we like snippets too so I'm going to
work with some scripts so what we're
going to do is I'm going to work with my
part of the program and I'm going to use
the new death which Lloyd rjs that's me
brilliant okay well it's fine fine
that's again you want to place I should
call it death so no because that's my
Twitter handle okay like it follow me
yeah well always branding I love it well
I'm going to use a module which is a new
thing which a allows me to be defer by
default which is something you should
always be doing but also we get to use
the new fancy import which we're going
to use later so let's write a new file
and look at the tweet and and fetch the
tweets dot JSON file so I'm not going to
put anything else in here I'm just going
to put this here in color dust Surma jf
and go and here go to the network's tab
and if I load this you can see I just
downloaded 16 megabytes of arrays which
provide a bit this was really really
fast because I might have a server
running locally the second you actually
are on the internet this is going to
take a while you would have to wait
seconds if not minutes before you could
do anything with the data and that's
such a really important point we the web
is the streaming medium and we actually
want to treat it like that rather than
saying I'm going to hold everything back
and then so what you would usually do is
official sound the official I received a
response and yes everybody what usually
want to do is you want to take respond
and then call the JSON which turns the
response into Jason this wouldn't work
to you because as we have established
it's not actually a JSON object it's
just it's a bunch yeah objects will fail
with there's like training data please
take care of this so can't use it the
next option that most people probably
are aware of is not that well text which
would give you a 16 megabyte size
JavaScript string and I'm telling you on
mobile you're not gonna have a good time
so we're now going to go into the new
territory and use something that
probably is not as well known because
namely that response that body is a
stream what kinda stream thank you I was
waiting
line it's a readable stream meaning it
is a stream that you can read okay so
let came in for the education you get it
I'm going to explain it more so a
readable stream is an asynchronous data
structure and some people going to
school it's a little bit like a promise
but that can be recalled multiple times
so every time you get a new result back
it's a pipe of data right yeah it's like
five days like we assumed data off it
right and every time you get the next
chunk in the network delivered but
because it is from the network or
because it's a stream once you get a
chunk it's gone it's been consumed and
therefore they can only be one reader at
a time okay and so what we need to do is
we need to get a lock for this reader
which you get by get a reader which
means you have now real object and
you're the only person who can read from
the stream and if you want to what do
you do if you want to get rid of the log
is that like I'm there
get rid of reader release lock okay I
knew that that seems really ok get read
only we don't need a ton so we have a
reader and as I said a reader is an
asynchronous data structure and so I'm
going to make use of async functions
because otherwise this is going to get
weird because with async functions we
can write code in an linear imperative
way even though it's a synchronous so we
can do stuff that is very old-school and
usually very hated upon a job is well
true oh really yes oh this is in
production code by the way yeah it's not
production code it will work yeah we
hopefully but there's yeah so what you
get so why do you want to read from a
stream you would call your reader and
say read intent is asynchronous we have
to await that it's basically a promise
but the way it just in lines all the
handling and it makes much nicer and
what we get from there is a value and a
done flag over the D string going on
there all the new features manually so
so if we are if a stream is done its end
of stream then then it's done so done
it's true and we can just return which
is file a while true loop is okay
because that is our cancer condition
this is how we break out of it
I'm still really iffy on it seriously
anyway what its value let's just try out
what value actually I now console.log
the value thing I'm going back here
going to open the console and we can see
we just get a whole bunch of you and
eight arrays this is literally the raw
data from the HIV response packaged and
nice typed arrays in JavaScript and you
can see that they're all pretty much 32
kilobytes big but that is more of a
coincidence than anything else so for
example the last one is smaller there's
probably some smaller ones somewhere in
the middle I don't know but it's a
number you can't rely on this might be
an implementation detail of Chrome or my
ghost server it doesn't matter the
number not really relevant okay so now
we are receiving these chunks and
they're 32k big coincidentally but the
problem is really that we have these
whole series of JSON objects in my tweet
file and now a tweet could be there
could be multiple tweets in one chunk or
there could be one tweet spanning
multiple chunks and that's not really
helpful what we're going to do is we're
going to write it so called transform
stream which is going to transform our
stream in a way that the chunks and the
JSON objects align so by the every chunk
after the transform we can be sure it's
exactly one JSON object got it so you
can pass that to Jason got pause and you
would get a JSON object in the end we
should be able to do instead of just
arbitrary splits at 32 K we want it per
object exactly so now we're going to use
we want to use the reference
implementation with transformed streams
they're gonna be in the browser at some
point so transyl seem to explain it's a
readable stream as stream as you can
read a writable stream a stream that you
can write put together into one object
where you put things in at one end to
transform and get it out at the other
end so but they have not landed yet so
outgoing I have to rely on the reference
implementation so I'm going to import
from transform stream jf and now we have
it and can use it and let's see how to
actually use it so ever said response
that body is a stream and if you have a
transform stream you can use pipe
through which means here's a transform
stream pipe that data through the
transform in
gives me the result so here we would
create a new transform stream and that
transform stream takes a transformer not
to be confused to the cars so what so
what we have to write is a JSON
transformer you sure you don't another
new inside there as well let's go three
deep amigo or I can I can give you a
variable so this is going to give us the
jason stream so as a return we get a
transform stream which is now a stream
of individual JSON objects recurring so
afterwards we're not going to get the
lock on our body button or adjacent
stream and that should work so let's
take a look at the actual juicy bit
which is the JSON transformer so claps
Jason transformer it has a constructor
which we are going to need but not right
now and a transformer has to have has
three methods it's a start which is
called at the start we don't need that
there's flush which is called at the end
and there is attention transform oh
that's what we need right that's what we
need and the transform you get two
parameters the chunk that you now have
to transform and the controller and the
controller is something it allows you to
control your stream that let me explain
the code
I think code is always better than
trying to hand wave all the things it
allows you to do stuff like to define
what is the output of this chunk you can
have set all kinds of different signals
like back pressure and your cache is
full and we don't need any of that we
just want to feel your feeling if you
google for Jake Archibald streams you're
probably going to get a really good arc
I think it's going to appear it's just
yeah well that's the worry if you say
streams due any time I'm going to stop
mentioning the word now but do we take
the controller and with NQ we can put
something on to the output queue so just
to show it works I'm just going to not
do any transform whatever comes in I'm
going to take it and put it into the
output if I can no transform so do
nothing
ideally everything should work the same
yes so it's still doing nothing just
downloading this file but now we have a
point where we can inject our code to do
all the transformation II bit
so um how do you do that
and the thing that we have to do now is
we have to kind of write our own little
jason powder really it's not as
complicated as it sounds okay so what
what we will do is we will collect all
the chunks that belong to rot one JSON
object sure and once we have those will
squash them together get a string oh and
then you're going to the ALU and cue the
right phone and then we start over okay
so in this chunks array we're going to
collect all the chunks that belong to
one JSON object and now we have to
figure out how do we know when we've
reached the end of a JSON object and we
do that by Counting curly braces so what
we're going to do is whenever we get a
chunk byte of check so we're going to
loop over all the bytes in our chunk
that could becomes that could be caused
sorry or sorry
in adversity ring from genetic review
sorry carry on we've got to convert it
into a character because we know jason
is always asking so we don't have to
worry about oh your hero age unicode
shenanigans yeah okay well i'm and then
we going to switch over whatever
character it is and we care about it's
either an opening brace sure or closing
brace closing go ahead well done wait
off so and we're going to start and
we're going to try to count how deep in
STR so whenever we encounter an opening
curly brace we increase it and whenever
we encounter a caps lock is in the way I
mean this does not feel brittle to me it
stopped it
I'm cool with this so when we decrease
the depth we will hopefully at some
point reach zero which means we have
found the end you can alpha JSON object
so what we're going to do here we're
going to emit and we're going to talk
about that later if we have reached the
end of a chunk without having reached
zero you want to know that we have to
continue into the next chunk and this
act current chunk it is harder iliza yes
I'd like you this lets dance my
programming do the chunk okay fine okay
it's going to help people understand
sure I get it it's great
so when we've reached the end of a chunk
but not emitted it then we need to chunk
push push this is like when I type I
know that's not anyone with other
guidelines he's the one that's normally
really good at typing and it's really
annoying to me because he's right
good so we are now in the middle of some
chunk we have reached zero we know the
start of the chunk or as part of the
JSON object the rest is part of the next
JSON object so we're going to split that
apart so we have the tail you into eight
array so that's actually interesting
thing because the all these typed arrays
in JavaScript are basically just a chunk
of memory and you can have different
views yeah so we can look at the same
memory as a series of floats or a series
of in yeah but also you can have them in
different positions so we're going to
split it apart by just creating new
views on to the same memory so to be
clear rather than say copying this array
into two separate arrays you're just
creating two views on to the same memory
underneath and that one becomes the end
of the object and the next one becomes
the start of the next object exactly
okay I know what I just realized though
that for this we need to know that
positions the index where we add so I'm
going to rewrite to do the old so I was
really really smile it was nice but you
know length five plus plus done all
right so the tail goes to I plus one
because I died we have the closing brace
so the next one is where we want to cut
and we have the next object where we
kind of do the same me and we start
after it if we omit the last parameter
it means with all the rest of it so I
because I is the curly brace I plus one
is the next character fine so and
because it became after this we want to
continue working on the remainder I'm
just going to get a little tricky and
just say we're just going to overwrite
our char that's the next thing we can
work on all this kind of stuff really
ruins my head well so tail is as I said
part the last bits of our JSON object so
it's part of the chunks array so now at
this point we know that the chunks array
is our next JSON object but potentially
split into multiple chunks we need to
convert this into a string so you've got
several potentially UN
a to raise the need flattening down to a
string yes got it and sadly like to
convert a buffer or an array it typed
array to a string we need to use a text
decoder sure we do sure so it's it's a
little I said sometimes I wish this
would be simpler but it's just now it is
well yeah and what we can do is we can
use this dot chunks
reduce whoo we're going to start with an
empty string and we're going to take the
string and set chunk and we're going to
concatenate the string with a decoded
version of the chunk and that is going
to be our JSON string sure is this
correct I think it is and now we have
adjacent thing which you can if there is
there is there a German word for the
feeling of sadness you get when
something is really convoluted I think
you could say something like simply
Christmas among a subspace long bobby's
simply Christmas magnetized oh I love it
then my favorite ESS Almo CSS is and
wait it was Cascadian definitive on
sonar yes most of should be German
always has a word all right all right so
we have Jason string which we can omit
so we now have actually turned into a
string we can push that out and now the
only thing left to do is to reset our
state so we have to say this chunks is
now empty because we're done processing
it that's true you could also set the
length equals 0
can you yes you can I can do this is
really yes you can
I did not know length off readable I'm
trusting you awkward awkward and and now
this is Andrew cast on the next loop we
want to start at 0 but it's a for loop
so I plus plus was going to happen we
have to set I to minus 1 know a little
where it grows all right oh you're not
shipping that are you yeah I'm okay all
right shows prototype I'm not going to
run this code on my big treat file I'm
going to take it on for because
otherwise it's going to take a lot it's
just no okay so if this goes right we're
going to see four tweets no we're not
line 13 people are paying attention I
like it
what is on line 13 oh I just want to
find yes so bite kill our Chung
hi these is judging you because you
changed my for Const to that it and I
type out decode yes I guess a bit bigger
so we can out-compete if we have four
individual console logs which contain
exactly one JSON object which means the
alignment works but and there is always
a but so let's show you why what if
there's an opening brace in a-c-c I see
that what I was led if I tried on it we
would see nothing because the parser
would see opening curly brace an object
started but it's in a string and we
didn't know that what we have to do is
we it's actually hard to fix
we just need to track if we are in a
string are you kidding me oh come on
so it whenever we find a double quote
we're just going to go in string show
this sure and string yeah and whenever
we are yeah in string you don't actually
care now I'm getting out that word stop
feeling the German what about it does
make you less brittle now isn't it nice
no okay yeah though it feels perfect
great this should work now backslash
double quote backslash double quote oh
yeah he's right
got that so it's right so I guess if I
do this it wouldn't work yeah let's fix
that
easy easy or she'll go the great show so
if we find something at his escape which
we have to escape because it's this time
you must we have to skip the next
character sure aim it next and it's fine
can I revoke your programming license no
Andy so if you have to skip the next one
we have to set it to your folder for
them yeah
continue sure yeah yeah right and just
just the ultimate test is going back to
the full file and make dev tools grind
to a halt all right but hey I'll scroll
because we are not locking the magnets
right to Bradley because
it's actually kinda okay kind of
important actually you've gone I've got
a 16 Meg's file that's being handled on
the flights being streamed and
transformed on the fly and you got was
the most recent one there is that must
be German in German okay I was hurrying
how fast is actually I mean yeah that is
processing going on but it works pretty
well I mean yeah all right and now Mike
gone on move it right because normal
people I don't think would sit there
going oh yes I am enjoying your Jason
coming down and watching it arrive in
the the console there well I certainly
do I know right I mean know your
audience
um so we thought the the better thing to
do might be to actually create some kind
of progress style that's my job better
always you do the visual stuff oh how I
roll
so I'm gonna make a SC doll cuz are
these our Charles I think I might just
roll it arrows with style so my branding
is okay can't believe you did that
I wonder if you want to call it digest
or Lewis Jess I want to call it or arrow
twist cherry call it stick to the script
um arrow twist on Jess for us I proven I
know you do
it's not not what I expected from today
okay so I've got an se dial I'm going to
make something called arrow twist jf and
you know what I have custom elements I
don't like writing these out with with
type in by heart I just choose not to
uh-huh with all those lifecycle
callbacks already filled out for the
cursor moments 1.0 what's the German for
custom or lifecycle callback functions
Surma limbs super slick cool funky on
they near that would be one we all work
normally normally we have I'm actually
going to call it SC dial normally I go
with like an unnamed class but today I'm
not going to that's going to apply to SC
dial all right speed dial
and I don't need attribute change
callback you just did that just really
have a name for the class you guys want
to refer to it later I'm going to yeah
I've got a fake ID yeah we're going to
need some constants in here and I am
referred to as static members of the
class so now let me see what I'm gonna
do first of all is I'm actually going to
get rid of this here because I
like my log I know well tough I'm in
control now I'm the one doing anything
right now normally you could do
something like this with SVG but today
I'm going to use a canvas because I feel
like not a lot of people like the
cameras you talk to people they like you
know I did it but usually you're not
going to use the canvas so you're not
going to bend over backwards and try to
make it give and no I'm gonna use all
right Carlos Congo canvas is blazingly
fast and I think it's heavily
underutilized on the web and when you
use a canvas you get the context from
the cameras like this WebGL no I'll just
too deep okay okay so Ben you can pick
up the can of the context as your pen
that you move around on the canvas
because you give command like move to a
line - and you draw on sorry see I told
you I was gonna do some constant yeah
fine like that makes you a good citizen
because you avoid magic numbers I know
right
I feel really good they start
appendchild cuz there's a custom element
I can just call appendchild
against it rather than something else
it's expending HTML element but but what
hey like it's a book that it works in
Chrome which I always love is hilarious
you are per spekt not allowed to
manipulate the Dom in the constructor or
the custom element you have to do it in
the works it's a bug works move it move
it to the connected car back because
that's are supposed to do it because
technically you cannot rely on the fact
that the DOM is already available in the
constructor it was still like floats in
the ether of custom element works and
then you probably should remove it but
whatever in the height sure so the other
thing that we probably to do is so what
I want is an API where we can set a
percentage value for the dial as the
file come down as we get a 16 Meg's down
we should set a value I'm going to say
between 0 and 1
I'm for some I didn't we kind of need a
way to put that value in from the
outside exactly right now I'm going to
set percentage headers persons I guess
the reason why you're not just using a
straight-up property is because we want
to tail logic to the stack when somebody
changes the value exactly right so it
feels like no
but that is me I can never get that
right percentage you could just be like
no no well if we like that throw new
error no see see people that people
don't mega validation and also helpful
error messages modem hey I am all over
this don't worry I'll tidy it up before
it goes onto the github repo which it
will we're good at repo by the way it is
Google Chrome slash UI element samples
all our previous code is under this one
we'll get up there at some point today
when we're done right and feel free to
use it to play around yep
so when you set the percentage value so
we're going to get a reference to the
dial from outside we're going to say
percentage equals 1 or null point 5 we
don't want to draw which will draw with
on the canvas I wonder what the drop
function does oh I don't know let's see
so what we'll do is we will begin see
always operate against the context so
we'll begin pass and then I always say
if you're going to do something like
begin pass or a path always use or is it
closed path always put its corresponding
because the opposite of begin is closed
it's closed namaka welcome to the web
and alright so we want I'm going to do
like a circular dial right so I want an
arc so like a normal progress bar but
bend into a circle yeah all the way
around um so I love this I'm so I'm
going to do XY radius okay fine so I'm
gonna say mid mid and mid now I haven't
defined mid yet so that's fine 0 let me
guess it's the middle oh you're so good
at this line fine fine not point four
I'm just made I'm guessing an angle
which is in radians just because I want
to check that it draws something because
when you're working with the canvas
sometimes it draws nothing and that's
fun to debug yeah
so come mid equals SC dial so we're
going to go for the size gonna hunt you
getting some good mileage I by 2 then
what they're getting some good mileage
out of a constant I know right all over
the place ago it's going to be great
this don't you also want to do like like
a half shush shush
that didn't draw anything you know why
because after you've closed the path you
actually have to say to the context to
fill the path yeah because
just defined the path and you have to
say well you can stroke it or you can
fill it or you can probably do both I
think don't need to do as well but you
actually need to call draw oh what a day
oh there we go hey we got something
drawing at least I mean easily excitable
now another thing is that's not really
what I wanted because I want to kind of
pie kind of I mean it makes sense
because you just say fuel here draw arc
and then go back to your start yeah
it's correct as always you did the
mistake not the computer Thanks so the
fix for this is to actually move your
pen to the middle middle look at you say
before it's like you think that the
context is like a pen so you move the
pen as it were and you say move to
inside of the GIMP and you say mid mid
it draws the kind of pie chart kind of
like that's good oh it is good so now
that that's pretty good so what else are
we going to do let's see let's call this
the outer I mean I find it a little
weird and it kind of starts to the right
because you know we all learn to read
the clock so I feel like okay fine you
know yeah that's fair enough right so
yeah he's right if you wouldn't only go
out to the side with you if you're going
to start progressed you start at top
middle now one option here would be to
take this start angle is being zero and
just do like minus 90 degrees but it's
in the interest of showing something
else to do with the cameras I thought I
would do it like this we do a rotate we
rotate the canvas which you're going to
rotate the coordinate system and I'm
going to be in the corner it's in beta
get turned minus SC dialed up obviously
I'm such a grown-up 90 degree really cut
out a 90 degree Aloha I was like a
proper but half doesn't get it on coms
no no um return math dot pi times by not
0.5 right didn't we just say sometimes
the canvas draws nothing yes I know what
this is I seen it before it's because
we're actually rotating around the top
left hand corner irrationally rotating
around the origin
topless I'll be loyal tenant we have
this thing here and because running it
out of those so we're drawing up their
word method oh cool so it's nice to help
people
oh so your basic is just going to move
the origin yes and then go we're going
to so yeah if you move the origin with a
translate and we move it to the middle
middle so we move it to the mid and then
we rotate and then we move it back again
it sounds odd but it will work it makes
sense but otherwise you would have to
well I don't know how you do it
it is it is right but now here you go us
that like it here's another thing I
think what we'll do is we'll do an inner
arc while we're here and then we're
going to actually wire it up to your
code for huh which is now legacy code
you we started out a bleeding edge and
it's already obsolete no kid in there
yeah right so math dot pi times by two
so we want to full I want to full sort
of survey then it's also go oh this will
be fun this won't get anybody upset I'll
call it cow you flame blade apparently
has her support in this room yeah that
matters are like yes you should use
towel much it's the same as two times pi
trolling right so do this dot C T X dot
fill fill style equals let's do white
let me go okay I'm going to your fill
style here so for now I'll set up two
back to the black alright now that
doesn't look great because ya know same
r-18 know but if I do made times by
naught point eight but look at that nice
so we get like a little really we dead
we're good we're good now let's wire it
up to your stuff type in actual the
loading percentage so do percentage
which we evolved between zero and one
times by st.com
okay which should we will disappear
because the value is zero which is fine
so actually this time it's working its
intended even though we don't see
anything absolutely so over here in your
thing I'm going to get reference dial
equals document dot and this is where we
can say this is not production code
because now we're kind of mixing
concerns it's my module are supposed to
take care of loading for now we're also
kind of like patching UI stuff in there
but I'm you know for the sake of how to
do this
it's
and I think sure keep going keep that
exciting stop okay so if it's done well
we know that dial dot percentage is one
that's fine that is correct and for
everything else we actually want to know
how many bytes have coming through the
wire so we need the total bytes so let's
say bikes total and GDP protocol can
help you with that yes it can where's
the headers get and then we're gonna ask
for the content links and then I'm just
gonna pass in on that then we go back
here I have a string and if you divide
by string not gonna be none in
JavaScript right so we know the total
number bikes if that had to come through
which I'm relying on let bytes counted
zero
sure now if we get down here we're going
to we're going to other so we can just
increase by the number and string
lengths because it's because it's Jason
that is equal to a number fight because
there's no unicode things yeah where
it's counted over bikes total yeah
should go ahead between literal on it
yeah that's not and in kinds are just
for that just we could should say this
is intended and ship it sure you know
what's going on in the the canvas is a
state machine
effective least home every time we call
draw it straight it's rotating the
canvas by 90 degrees also we keep just
rotating and drawing yeah that's
obviously the drawing effect so what we
can do here is we can actually ask
before we do that the the rotation and
so forth we can actually ask the canvas
to save its its stuff estates basically
like what's the fill style everything
like that we can save it and this is
another one of those moments where if
you call dot save you immediately figure
out where you're going to call this
stopped GPX don't restore where you're
going to bring it back because otherwise
you're going to push something onto a
stack and you're never going to pop it
and that won't be fun for you oh so this
will basically reverse to the previous
state except all the drawing is has
happened in the meantime before sure yes
so here we should now go around
ah that was definitely better but it's
actually you probably can't tell I'm
going to zoom in you it is all that so
pixel
it's really jagged and the reason is
because you also have to clear the
canvas it is all panel by default
drawers actually smooth which is why
this is surprising but we keep drawing
over and over the edges so it adds up to
not smooth so we'll do the size and
we'll do the sides we really one of the
most efficient constants ever created
see right much smoother now while I'm
here since it's not in the middle of the
screen I'm going to move it to the
middle of the screen and I do all right
doing this style style there you go Hey
okay ml buddy
see why I do it all the time ah you want
to how are you going to do the the
discipline of skill set of vertical
centering yeah that's good I mean people
like you can't do vertical centering in
CSS you can say she can display flex
it's online items center justify content
center smile a happy smile hooray right
next up I am going to go back and I'm
going to change this color from black
and I'm going to say it looks a little
bit on a crawl right now as you may want
to eat there we go that's a blue color
but let's make it nicer by let's see
well let's do this is a template string
oh oh stop it Paul there we are
soldier made typos let's do so will do
well this stop because then whoa
that will be interesting yeah that would
be weird times by 255 oh so we're going
to go from like blue and no red to blue
and full red except we're going from
black to pink
it was RGB values have to be rounded
also once you have decimal points please
escort like no little okay okay so way
we're doing all right here are women
okay no thinking else can we do oh we
could put an actual number in the middle
so to tell you how far we've actually
got through the downloading yeah let's
do that
we'll do that here to put label label
label labels you know I'm actually doing
actually doing comments because I know
when you come back to canvas code in
just like a half an hour after this and
we want to try to upload this we will
how you've gotten what it is about yeah
it's right after
regular expressions were you like really
it's like just faith on keyboard and
it's still kind of work things out my
prettiest face is that one right okay
I'm going to do fill text so we know we
want to do that oh we should set the
color for that oh yeah about fill style
here equals let's do it as a kind of
gray color all right bill pecks written
what prefer three three three honestly
really okay fine fine email normally
that bothered by this kind of stuff on
23 slightly darker percentage times by a
hundred and we'll do it at mid mid in
the middle of the Nile sure sounds good
I mean I don't ship it sure ah do you
know what this is actually a great
opportunity to talk about the restorer
because if we do the restore before the
lathe it's still turned it's still
turned so we'll do that that'll put it
back where it needs to go it's a start
and then we can do let's see miss
probably around this to mascot round
yeah I think you're right I don't people
don't care about like the 15th decimal
place I know right
there's tiny tiny buddies okay let's
make it bigger then yeah z TX dot on
equals let's not look we would want to
do let's make it as one of these and
we'll say oh oh no ASD dial dot size
please
I'll because we'll make it dependent on
D that is good quarter the size T X
Arial sure that's going to be fine okay
sounds good symmetry I mean and the
thing is you don't handle negative
feedback very well some the things I
feel like the bottom left corner of the
one is actually perfectly centered yeah
it is actually
it's because the the text baseline and
the text alignment it will mean that it
is for the bottom left-hand corner which
we can change by saying this though I
thought we have to like measure
ourselves or something like no no doable
that will be awful imagine no we're
going to do this text baseline dude off
because like how one out middle the
other hundred and whites would be yeah
what did you eat
so flexbox is the center center SVG yeah
sure not talked about
there you go right but I think what we
can do is it design dissolve another
label because we can I'm going to do
this one it 777 is that okay alright
I'll let you have it
okay let's do this it like oh no no
point no six I love just guessing
numbers I don't think it yeah you can
write like number fishing is great fun
you like not point six nope why did you
stop using like constants now huh huh
don't we mean all right percent that's
rubbish right that um let's do minus 20
plus 15 sure all close but not quite
minus 20 plus nothing but no cigar there
we go that field now don't like that
looking goodness 15 when is 14 gone then
plus 26 sure why not why not I mean it
looks good
I feel pretty good about this can we do
this with network throttling just to
have like a limit with what network
throttle oh sorry I took more time to go
yeah yeah because at the moment this is
no throttling so imagine then we were to
click on that and it was regular 4G now
this is actually really important
because we're now not blocking a service
code showed you we're not blocking on
this stuff coming down before we show
anything and we're actually able to give
the user some kind of information and if
you needed to do something with those
tweets like Jason piling them shoving
them in IDB something like that you
could be doing that kind of work here
too we could already be rendering parts
of the tweets because every chunk
contains one tweet so we could start
listing things while there's a progress
bar in the top and yeah the main thread
is still available as you can well
because it can draw let's do that in
fact let's we have just about enough
time I think to get away with this so on
the connector callback we couldn't call
draw I'm going to do a request animation
frame to call this draw and I'm not
going to call it anymore so it's going
to go into this kind of busy it's just
always going to draw and it's going to
probably break I'm not going to spend
ages explaining why it's because the
requestanimationframe the when it's
called
this stops referring to the class
instance and starts referring to window
so the way to to fix that it is the
losing find as I call it yeah dot bind
it's weird but it we cover it is every
single super judge because I always come
in it right and since that's drawn
during every frame now we should be able
to do a recording here and we should be
able to see that so it is this is if it
was it's possibly at 60fps we have loads
of headspace Headroom in our per frame
budget but we're getting something to
our users really fast and we are out of
time but just a reminder we've covered
streams transform streams we've covered
custom elements we've drawn canvas stuff
we've got you something which is taking
16 Meg's of Java takes and I think we're
in under 200 lines of code or something
yeah let me just check we are in not
that this is a reminder just how awesome
the web platform can be because you've
got what about 110 from me and you've
got about 70 or so from you so that is
about 180 lines of code and we've got
something that I think is reusable and
quite interesting so there you go thank
you very much for joining us today I got
a great time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>