<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unit Testing with Web Component Tester -- Polycasts #36 | Coder Coacher - Coaching Coders</title><meta content="Unit Testing with Web Component Tester -- Polycasts #36 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Chrome-Developers/">Google Chrome Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unit Testing with Web Component Tester -- Polycasts #36</b></h2><h5 class="post__date">2015-12-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YBNBr9ECXLo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey there polycasters rob here a lot of
you have written in asking if we could
do a series on unit testing so today on
the show I want to show you how to get
web component tester set up for your
project and also going to demonstrate
how you can write your first couple of
unit tests let's check it out
to get started we're gonna need to
install the web component tester test
Runner the polymer team has created this
test runner because we want to make sure
that when you're testing your elements
you're doing so in a real browser so
that's kind of the benefit of web
component tester to get it set up we can
just run npm install - g web component
tester and that's going to go out and
install all the things and then we need
an element to actually test and instead
of having to set this up myself what i'm
going to do is go ahead and clone a
project that we've created called seed
element a c element is just sort of a
boilerplate element which you can use to
sort of as a starting point if you will
for any sort of element that you're
writing the nice thing about it is that
it already has a test directory with
some dummy unit tests set up so once
we've got that pulled down we can just
run the web component tester command
which is just WCT and that's gonna try
and kick off our test runner now if this
is your first time running web component
tester there is a possibility that
you'll see something like this where all
your tests fail and it says that
selenium safari driver was not working
just then so what we're using under the
hood to actually control all the
browsers is this program called selenium
for safari you've got to install an
extra piece of software to make sure
that it works you can see that there's a
little URL inside of this error message
so if we go and open up that URL up here
at the top there is a link to a piece of
software that we can download it's just
a little jar file so it's a little Java
thing and it tells you then to unzip the
file and if you're not familiar with
jars they're actually secretly just like
zip files so once you've got it
downloaded you can just change the
extension from jar to dot zip and then
double click on it and that will let you
unzip it and then inside of here inside
of this directory we're going to be
looking for this thing called Safari
driver dot Safari ext Z so we'll
navigate a few of these directories
buried in here somewhere and there we go
alright so we're gonna open this up
double click on it and it'll actually
boot up Safari and it'll say hey do you
want to install this web driver
extension heck yeah and now we should be
able to control Safari using selenium so
make sure you close Safari and
everything like that and then we can go
back to our terminal we can try again
we'll run Bower install and make sure
we've got all our components set up
that's good and then we'll run web
component tester and what you should see
after a moment or two is yes green tests
okay so all the tests that came with
seed element are now passing so let's go
take a look at those tests over inside
of C element in the test directory there
are two files index.html and basic
test.html index.html is where we can
create our suite of tests so all of the
individual tests that we were going to
want to run in one big group and to do
that what we're gonna do is we're going
to set up an HTML file we're gonna
include web components light J s we're
gonna include this browser J s file up
here in the head as well that is the
JavaScript that's being used to control
the different browsers and then we've
got a script tag down here which calls
the web component tester load sweets
method and there we can pass in an array
of files that we want to kick off and
each one of those files is a document
that contains some unit tests so we've
got basic test HTML and then there's
another copy of basic test HTML but this
time with a little query string for DOM
equals shadow and what we're doing here
is we're saying that we want to test it
first
under polyfill and in the second time we
run basic tests we want to turn native
shadow Dom on and so for browsers that
do have support for native shadow Dom
like Chrome and opera that's gonna kick
that off and that way we can verify both
the polyfill and the native shadow Dom
version of our element is working so
let's take a look at basic test HTML so
inside basic test HTML up at the top
we're also going to include web
components like jsm browser j/s and
that's because we could just open this
file standalone by itself if we wanted
to you
then we're going to import seed-element
right this just is how seed-element is
already set up but when you switch to
your own element you can replace this
with your own markup below that you'll
see that the actual seed element tag is
just sitting there in the body and then
underneath that we have a script tag
which contains our unit tests so we're
selecting the seed element we're
grabbing a reference to it and then we
have this sweet method and that's how we
kind of create like a context for our
test so we're saying hey we're going to
create a bucket full of unit tests right
here and you can see there's a bunch of
test methods inside of here they're all
asserting different things so what I
want to do is take this first test up
here that says the author's name is
Dimitri glazkov and I'm going to change
it so that it says the author's name is
Dimitri with a bunch of Z's at the end
glass coffee and this should break
things so see let's go ahead and we'll
give that a shot
switch over to our console and run web
component tester and yes we do see a
whole bunch of errors right it was
expecting the name to be a term treet
glasgow of instead I got Dimitri with a
bunch of Z's glass cough so we can go
back and we can just delete those C's
run it again and now we can verify
basically that yes these tests are
working when we modify them things break
right so everything is happening as we
expect it to so the seed element is
great but there's also a lot going on
inside of here next thing I want to do
is just kind of clean it all out create
my own element and that way I can
demonstrate how you can write your unit
tests from scratch so now that I've kind
of cleaned things up a little bit I
deleted a lot of the stuff that was
already inside of seed element it's
useful as an example but I want to you
know create my own element here so I
changed the name to wait button and the
element that I've now morphed seed
element into basically it's just this
little button and when you click on it
it displays a paper spinner right pretty
simple so that's the behavior that we're
gonna test so looking at my elements
definition you can see inside of the
template I just have a paper spinner
whose active state is bound to and is
waiting variable and I've got a button
which has a on tap listener which is
listening which is going to execute a
weight method so let's go down and look
at our source here and you can see that
is waiting it's just a regular old
boolean
starts off as false and the weight
method is gonna do two things it's gonna
fire an event called waiting that passes
along a little bit of data and it's also
gonna set is waiting to true and that's
gonna cause our spinner to display so
these are the two behaviors that we're
gonna be testing in our unit test I
realize this is not traditional
test-driven development where you write
the test first and then you implement
the behavior that is one way to do
things but this is just the way that I
happen to do things today either one is
totally valid but I'm gonna be you know
I wrote my behavior first and then I'm
gonna write some tests for it so over in
my basic test HTML file you'll notice
that instead of just putting the element
in the document here I've actually put
it inside of this thing called test
fixture and test fixture is a really
neat feature of web component tester and
what it does is it takes whatever is
inside of its template and it's stamps
out a brand new instance of that content
for each unit test and so what this does
is it ensures that each unit test gets a
completely clean slate version of the
element and that way if a previous unit
tests had maybe modified the element in
some way you're not accidentally sharing
state between your tests and perhaps
confusing them and causing things to
appear broken when really they shouldn't
be so this way we're just creating a
brand new fixture each time and each
test gets its own instance of the tag
now to use the test fixture I'm going to
create a reference from my element and
then what I call this setup method and
setup is gonna run before each unit
tests and so inside of setup I'm just
going to say that my L equals and I'll
call the fixture method to grab all the
content out of that template cool so now
I've got it you know stamping out a
brand new instance on my tag the next
thing I wanna do is just write a really
basic unit test so I'll call the test
method and in this test I'm gonna say
that when the user clicks on the button
inside of the element we want to see if
is waiting gets set to true now I need a
way to poke around inside of this
element to actually click on that button
because it lives inside of the local Dom
or the shadow Dom however you want to
refer to it so I'm gonna use polymers
API for the Dom I'm gonna grab my
elements dot root property so that'll
actually let me get access to that
shadow root and then I can query
selector around in
side of their and call click so I'm kind
of poking around inside of there but I
know what I'm doing in this case I
really need to click that button and I
can't quite do that from the outside so
I got a Pierce the shadow Dom to do that
now once that's done I'm going to assert
that the is waiting property matches
true so so far so good this looks
correct let's switch over to web
component tester fire it up after a
second you do yes okay we see that our
tests are passing both for you'll notice
that it says two tests are passed so
both the the polyfill browser and the
native shadow Dom version we're passing
cool all right now that was a
synchronous test let's try an
asynchronous test so you know sometimes
your you'll have some action that takes
a certain amount of time you know it
could be just the next frame it could be
a thousand milliseconds whatever and in
those cases you need a way to signal to
the testing library which in this case
what the Honan tests are under the hood
is just using mocha so you need a way to
signal to mocha hey my test is finally
finished and now you can move on to the
next test and to do that mocha actually
gives you this little method called done
which you can call whenever you've got
an async test so what I do is inside of
this next test I'm going to be listening
for the event that my element fires and
you'll see that in the function to kick
off my test
I've passed a done argument and that's
actually a little signal to mocha that
hey this is going to be an async test
and then inside of that test I've just
added an event listener to my element
I'm listening for it's waiting event and
then I'm asserting that the detailed
message that comes from the event equals
time for some meditation and after all
of that is finished I finally just
called done and that will allow the
system to wrap up the unit test and move
on to the next one if there is one and
just like the previous test I'm gonna
use Palmers Dom API to actually click
the button that's inside of my element
alright let's give this one a shot so
we're on web component tester and dude
fires up all our browsers
and yes we're done all right so now
you've got your first couple of tests
passing but there's a lot more that I
want to cover on this topic so leave me
some comments down below
let me know what you want me to cover
next also if you have questions you can
ping me on a social network of your
choosing at hashtag ask polymer as
always thank you so much for watching
and I'll see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>