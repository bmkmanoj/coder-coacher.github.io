<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What happens when...? - Tatham Oddie | Coder Coacher - Coaching Coders</title><meta content="What happens when...? - Tatham Oddie - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>What happens when...? - Tatham Oddie</b></h2><h5 class="post__date">2016-08-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Ko1zzs9K9dk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright good morning everyone thank you
for coming in and joining my name is
tasty
for ratify you probably see one or two
or three of us just here in the audience
and a lot more outside so this cut the
concept of this talk here what happens
when I mean it I saw an interesting
essay it's a common interview question
first of all of you know what happens
when you type google com into a browser
and I saw an interesting essay which
I'll reference a few times through it
that made me think about just how much
stuff happens in that first sort of 50
milliseconds and I thought that was
interesting first of all what I don't
want to do is do a networking 101
end-to-end or something this is not
going to be that sort of crash course
it's very dry and also trying to
actually put all of that into an hour
even though it might only be 50
milliseconds or less in in real time is
kind of hard what I do want to do though
is talk through some of the things that
are relevant about what happens at that
network layer that we might care about
more as developers because the other
thing that I've seen a lot of is as
we've gone and have the advent of the
cloud and all of that we have more and
more of us as developers now dealing
directly with some form of
infrastructure right we go and deploy
our web app and off we go and then I see
people going and getting frustrated at
what do you mean my dns isn't working or
the server's down and i'm looking at
going no no that's really not the
problem there and we need to start to
care more about that network layer what
i do want to do is make sure you get out
of each of these sections of the talk
here some kind of little tidbit of
something that's useful that's also be
on the web world and i'll share some of
those stories as we go i guess just get
a sense with most people here identify
as a web developer something else cool
all right the other thing that really
struck me out of there's an essay it's
called programming sucks and it's up i'm
still drinking dog and i'll put the link
up it was one of these comments here of
why do we tell you to turn it off and on
again because none of us actually know
what the hell's going on and that's kind
of computing in general these days
nobody in the world actually knows
everything about that surface book right
there's somebody who'll know how the
graphics driver works there's somebody
who knows how the the Wi-Fi works
and some of us that know how this little
thin little veneer at the top works and
kind of all gets too hard and I turn it
off and then back on a log boot back up
but I wanted to kind of peel those
layers away that's that sa i'll put the
link up at the end it's quite a
disappointing read so some of those
layers what do we think happens when we
type google com into the browser start
off with HTTP pretty common protocol any
others nothing else Dennis
tcp
they're kind of the common ones so we
started to build this out and I started
the player of this talk this was the
list I so found this I started to think
about and all the supporting elements of
it and that's kind of a scary long list
and they're just some of the most common
protocols that we have pop up and for a
lot of developers we don't typically
deal with many of these when was the
last time anybody dealt with arp a lot
of people think they're going either
don't know don't care not relevant to me
as a developer magical network stuff
right today i want to show you why we
should care about that and find that
interesting so let's start off with I'm
going to jump out of power point and i'm
going to do pretty much everything today
in powershell because sam DS dead to me
bring out that powershell window there
by the way really quick way windows x I
then you get a PowerShell window if
you've enabled developer mode in windows
10 so useful a little setting under
there now gets rid of command prompt
let's start off by having a look at DNS
so DNS most people think of it as the
phone book of the internet the most
common explanation right names to IP
addresses kind of critical that not
generally that interesting I where I
find it useful to describe DNS is that
it's a distributed key value store aka
the first no sequel database that was
around we have trust we have eventual
consistency and we can store lots of
interesting information you know
one of the common jokes and computer
science we talk about as always there's
two hard things there's the patient
validation naming things and off by one
errors I quite like this slide look
sorry the whole la slide swapping not
working too
why could this possibly be hard so let's
go have a look at how we actually go and
resolve all this and what can we do with
it that's interesting so first most
common sort of thing I'm going to do is
just come in and say I want to resolve
DNS name and we going to start off with
microsoft com delay you and i'm going to
ask for the name servers for it and this
comes back and we have our authority of
nameservers don't really want to drill
into that too much further here I assume
most people have a level of familiarity
with dennis as we go up through these i
can resolve where the name servers for
com au and eventually i can get all the
way up and i can resolve where the name
servers for at you it's not used to that
as a format though
skip on my PowerShell there for a second
and then we get up to the top of the
tree now one of the interesting things
about this and I'm going to jump down to
Wireshark in terms of how we actually
look at this some of the other day said
if you end up in wireshark you've gone
too far if we look at the underlying
format for this I'm going to go and say
bring up an existing DNS query and if I
follow the packet stream and I'm just
going to say show me this is a hex dump
what we see in here so this here is
actually a lookup first looking up a 406
ml com in those kind of buckets as we've
gone up there actually referred to as
labels and where we have the dot-com
here see at the end there's these two
bites and then this one of the com the
actual underlying protocol starts off by
writing each of those labels as a bite
which is the number of bytes to follow
it in the next label and then another
bite and the next label and so on so
here the it starts off with there's
eight characters is the number and then
it says Bay 406 dash M and then we'll
get to 7 characters and then hotmail and
then three characters and calm so why is
this particularly interesting to us it
means that because the concept of a
label is not actually part of the text
we can actually use things like
localhost is the same as localhost dot
they're exactly the same thing from a
name resolution perspective because the
dot just indicates a blank label at the
end which is exactly how the protocol
finishes why is this interesting it
means that we can trick sometimes when
we're working with local web servers
into whether we want to have a local
connection or remote connection and we
can make things behave differently a lot
of software goes and tests is the
hostname localhost or we can make the
hostname not localhost and it's still be
the same thing something I found
interesting from the underlying protocol
something bit more relevant to us though
Scott was talking this morning about web
farms and scaling up and round robin and
all of that if we go and have a look at
if I go and request outlook a you office
365 oops calm where we host all of our
mail and I'm going to go out and
explicitly ask Google for this so I know
I get a fresh result i'm going to ask
for the a record i get it's that eight
different records back for google sorry
third outlook and what's happening as i
request these is they're actually
reordering those ip's coming back this
is just that round robin distribution
this is exactly what asia traffic
managers essentially doing for you when
it goes in has a bunch of different
underlying web applications that you're
running on different server farms and
then it's distributing the traffic
between regions and letting you re route
it is it's actually just dynamically
responding with different responses of
what's most relevant to you and where do
we want to send the traffic now this is
very efficient because it happens at a
dns level but it also means that is a
number of limitations on what it can do
in terms of managing that traffic and
inspecting it and redirecting it in
different ways and i find it useful to
understand how the underlying dns
concepts work here versus a number of
scenarios i've seen where people feel
they're hitting limitations is only like
traffic manager and you go and look up
the user voice page written there's all
these feature requests and he said there
any like that doesn't actually work in
dns and this is that peeling back some
of those layers of magic that we're be
able to build on top of with the cloud
one of those constraints is around the
concept of see names how many people are
familiar with see names most their own
cool and we can't put a cname on the
root of our domain name and that annoys
us right people know why got a few
shaking heads so what a cname does is it
says as a canonical name so i'm going to
go and ask for outlook Dolphus 365.com
and i know that they respond with a
cname what they're saying is when you
want this basically redirect the
canonical name for this may
my real name is lb geo geo geo based
load balance that they on redirect you
off to DNS as that distributed database
that we have is essentially saying don't
look here for the results go and point
over there instead it's not pointing at
another IP address or anything like that
so it redirects the entire record for
that so if we did that for something
like ratify dotnet say we wanted to run
ratify dotnet in many different
locations and pointed to as your traffic
manager and all this sort of stuff that
would also say if you're looking for my
mail delivery or you're looking for my
name servers or any of these other
services that run on that root domain it
redirects all of them away as well so
it's why that concept doesn't work and
I'll show you an awkward scenario around
that too with ssl shortly as well job is
just updated on this machine don't tell
scott so when we get into other
providers then like section i/o is a
local one section I oh what they're
having to do to do traffic management is
actually take over dns so that they can
dynamically respond from the dns server
with those different results or we're
also seeing newer providers like DN
simple as a DNS host where they have a
record called an alias record which
you'll find which is not actually a real
record in DNS at all what they're doing
is giving us the mechanics of the cname
but they're doing and resolving the
record and then returning the response
for us so that we get some of those
benefits of being able to have our
dynamic a records without going and
redirecting everything else off so that
geo load balancer there we'll come back
to in a second we use Visual Studio
online quite a lot more visual Co team
services at ratify and quite common for
a lot of sass apps they go and have
resolve DNS name and we sang like
ratified visual studio com we get our
own tenant name and what they're doing
under the covers here is they go and see
nain that off to a particular scale unit
so the result there TFS prod SCU SSU 3
is we're on scale unit 3 in the US
region for our visual studio hosting so
what they're able to do is very very
cheaply and very early on in the request
direct us to different scale units so
when you sign up for an account and they
provision your tenant somewhere they go
and actually post a new dns record in
just using an API to whatever they're
using as their dns service so that's all
well a nice it means that my laptop here
will go and all the intermediary network
devices will cache that for a period DNS
is cached a lot so then I just go
straight to that scale unit so even if
other scale units all go down totally
isolated it's very efficient local
routing one of the problems with DNS
though is also that it's Casey a lot so
when you go to sign up for a new account
what you might do is go and look for is
this account name available right so I
go and type in ratified at visual studio
calm and I get it does not exist put
that in my cash and then go sign up for
an account and I can't access it so the
technique that they use for this is if I
go and resolve google to go I'll take
the type offf it what they're actually
coming back with here is they have an
answer so they're going to put a wild
card record on the route as well so if I
come in at the top and they go yet we
know who your account is they use DNS to
direct us off to a scale unit using a
cname if we fall through that we just
get a wild card so then what I'll hit
here is a server which acts as a proxy
where they then take the actual 443
connection and proxy that through for us
so I incur some extra latency initially
before all of the provisioning kind of
flow through from Dennis but i have
always accessible accounts we hit an
interesting bug with their particular
DNS host at one point when we were
renaming some accounts where the
underlying DNS system when they removed
the cname record it actively removed the
cache entry it didn't repopulate it with
the wild card entry and then we're
actually returning non-existent domain
results I was pretty happy with that day
because we managed to
an engineer in Microsoft you said that's
cool I'll just dump the DNS cache for
Microsoft you have the keys to do that
so when we start to develop applications
like this SAS applications with these
tenant-based hostnames reasonably common
than or where we have say different
domain names for our core website and
static assets and things like that the
most common thing that I they still see
around a lot of the place is somebody
goes and gets notepad they have to run
it as admin and then they go and open up
see windows system32 drivers et Cie like
when you this deep in system32 you know
you've got a problem and you should not
be here people going to wrap this in
nice little bits of PowerShell and
things like that to configure your dev
environment but not particularly ideal
right I don't really like it from our
people mucking with my machine scenario
the hosts file is not there as an
override for DNS it actually existed
before dns it was the concept of before
we had dns how would you go and remember
where all the servers were on your
network so you'd find out Tim
berners-lee's running the dub dub dub
server so you'd go to your hosts file
and you go dub dub dub is at this IP
address save DNS is a later concept
right but a lot of people treat it as an
override the thing about DNS though is
we can go and return whatever response
that we want it doesn't have to actually
be on the internet or local so what some
of us did was we went and bought a
domain name and we set up dns for it and
we put it on the public internet and i
can do something like NDC sydney local
test me and we return 127 001 so we put
a dns server on the public internet and
said wild card and root we just returned
127 001 it's no reason it doesn't work
right it returns the result and that
will now loopback locally so what that
allows us to do is in our development
environment so i can have dub dub dub
local test me static local test my
assets or whatever i want to do or
account a or account be all those
concepts without actually having to go
and muck with my hosts file for the
application to work in terms of
background reading on that we the one
that we do respond to differently is
read me local test dot me if I can type
which explains how it works who's behind
it we did actually this is a couple of
years ago we did actually go on then by
a real ssl certificate and publish the
private key so you could run local ssl
and then the CIA found it and revoked
our private key for us because they're
like it's been compromised like that's
the point they didn't really agree with
that but we don't need that anymore
anyway and then somebody else came along
and I saw this week and they've kind of
trumped us a little bit because they've
got an even cooler domain name because
tildy's are all the rage now so they now
bought local computer okay they got that
one as well same concept so I find that
a particularly useful little tool one of
the reasons I particularly hate the
hosts file is if I'm going in doing
something so if I looked at evil that
local test at me it's going to give me
one two three dot for but I just said
that the contract was that we always
return 127 001 and it's the host file
doing unexpected things a particular
story there there was a project that I
was working on a couple of years ago and
Sam down he was on the same project and
we were logged on to some web servers
and the architecture for the application
was there was the web app and there were
some services that it needed to talk to
and they would run on the same box but
there was this multi tier architecture
and deploy it on the same box deploying
the boxes this is in a bank about four
years ago / 1990 Tech and the the
approach here was well you can always
just know that it's localhost colon some
port number and that's whether the
services are really simple but we
couldn't resolve the services for some
reason we couldn't connect to them we
looked at IAS and it's bound to
localhost it's bound to the right IP
night 127 001 it's all fine what
somebody had gone and done they've gone
into that hosts file and this was a
secure
the thing apparently and to get in the
road of our potential attackers this is
what they're done they changed the IP
address of local host on us do you ever
expect that actually happen on a real
box and that took us quite a while to
find they determined that you know what
local host we're going to know route
that to 127 00 to an IP that doesn't
exist so one of the things that a couple
of the switches here when we're running
resolve DNS name whenever I'm in a new
environment I don't really trust that so
I also run that with dash no hosts file
and you can actually say ignore that
give me the real result so jump over to
Wireshark again before we saw that LBG
office response coming back so what I'm
going to do is DNS query name out looked
at office 365 not linked local and if in
here there we go sorry Hanna run the
filter I look at the response here many
people are comfortable in wireshark okay
not many Wireshark is awesome it records
every bit of network traffic under the
sun by the way network traffic includes
USB ports because they're a serial bus
that acts kind of like a network and
bluetooth so you can find out how
anything's working what I'm looking at
here is a particular response for DNS
and it's showing me all the different
layers of protocols it's showing you the
frame the ethernet the IP UDP and then
eventually we've got our DNS response
now what I've asked for here is out
looked at office 365 com got it but then
I get many answers all back in one hit
and this is because outlook says no you
need to go to the Geo load balancer and
the geo load balancer says you need to
go to outlook to office 365 com geo load
to DNS two and then that sends me off to
somewhere else then eventually it sends
me to Australia and eventually it gives
me some IP addresses imagine if I had to
do all those round trips to work that
out not going to work right so what's
happened is an upstream network device
from me probably my ISP or otherwise my
router at home or something it's gone
and done all of that recursion and
worked it all out and I've got multiple
responses back in one hit your DNS
servers whenever you use see names will
typically go and send these other
records back and these are called glue
records its kind of hey go look over
here but I already know what that answer
is I'll give it to it all in one hit so
the other thing we can do with this is a
little trick for whenever we are
building something where we know that we
need to talk to multiple hostnames say
we've got dub dub dub my site com and we
know that everybody's going to need to
request something from say images my
site com what I can actually do is say
that's a cname to images and then that
might be the a record or the cname or
something like that and I can actually
push down multiple records in the one
dns response kind of cool stuff you can
do for a really high performance sort of
focus alright let's get out of DNS land
and oops get up to actually we go
further down and have a look at some IP
and arp scenarios so IP the internets
here do work I've been trying to train
myself out of using things like ipconfig
ping all those sorts of tools and using
all the PowerShell command looks instead
because they give me nice objects and
things I can work with and I'll show you
some advantages of where they do things
that just can't do otherwise so if I go
and get a list info out we're used to
seeing things like IP addresses subnets
all of that and if i look at get command
and i want to say show me all of the net
commands then oops i do you measure
sorry there's a bucket loader commands
behind all of this stuff as well
how do we use all of this then we go
over to
screen swapping
I've taken my subnet mouth okay so
subnet math as a concept if I've got my
IP address 123 got brought up something
dot something else and we just go and do
masks against it right so we see the 255
0 or whatever it's a binary math tells
us whether it's on our local network or
not so doing this across the Internet is
going to be a pretty big scale problem
of working out all of these different
routes and how do we get between subnets
and this is just kind of nerdy fun this
was how many active BGP routes there
were back in April or so and if you can
imagine looking up all of those routes
through random access memory that's
typically the fastest thing we think of
how do we query something quickly we go
and look up RAM that would still be very
slow what are you done binary masks bit
masks against every single one of them
and it's the random part of that slow
because we don't know where we're
looking so there's actually a special
type of memory modules which they use
which is this concept of content
addressable memory if you never have
content addressable memory and then they
have ternary content addressable memory
so what they do in ternary content
addressable memory is they store 10 s
and question marks blanks and what
happens with this is you can come along
and say give me one 101 and it will find
the indexes of all the places that match
and it'll do that in a single clock
cycle yeah up to the memory in you
here's what I want go and it goes
instantly here are all the addresses
where you'll find that and the types of
chips that do this they pretty much you
only use them in Internet routers this
is one of them it's pretty amazing
300 million searches per second per
table that it holds 40 gigabit per
second transfer rate massive keys it's
got four different search engines on it
that you can be running simultaneously
on top of all that as well and that
thing's only two point seven centimeters
square the name of it sounds kind of
more like a Genesis type thing you put
in a terminator what's kind of sad about
it though is even still in 2016
that thing there is two point five
megabits of storage because it's
insanely expensive to actually build so
it's about 300 bucks as well for that
tiny little chip for 2.5 megabits and
one of the things that this is causing
is the Internet's growing and we've got
more and more routes and ipv6 coming
through and this is our our growth rate
of routes back to 2015 is that we
actually started to hit points
especially when we added ipv6 where the
routes wouldn't fit in the memory and
the core routers the internet anymore so
there's a whole bunch of people in the
background that we don't even think
about who sit there swapping out these
routers and upgrading these super
expensive Cisco boxes to to actually
store all of this so if like they're
locally why do we care about routes as a
developer there was a reason we ought to
talk about VMs this morning sometimes we
still end up in a position where we need
to run a vm locally or more often where
we want to jump on a VPN to go and
connect into some private network
segment and quite often I see people
going my internet is really slow because
it's going out through the VPN or I just
not want this to go to the VPN or not or
so on and routes the way we can control
a whole bunch of this so I'm just going
to start off by saying get net route and
this shows me all the routes of my
machine so it's saying for a particular
interface if you're looking for a
particular network segment where's the
next hop and how do you go and find it
and the the most kind of interesting one
here is it saying if we fall all the way
through for any IP address any open mask
the next place that you go and find it
is one of these and actually I have two
gateways at the moment because I've got
cabled internet and i have my hotspot
turned on so then chooses which one to
use based on a metric this is actually
really quite easy to sort of manipulate
as well so these numbers that start here
52 and for their the interface numbers
let's say get net adapter and if I if I
just start with that we can see the
different adapters so I've got my
interface index there 52 and 4 is my
ethernet and my wireless
and if I go include hidden you'll be
amazed by the number of underlying sort
of fake network adapters there are on
the machine I can ask it to go and find
me a net route oops if I'm interested in
working out how we're going to get out
to somewhere like oops sorry that II
remote IP so I can say if I want to get
to Google's DNS which way out you're
going to go and why and all tell me but
what I can also do I didn't elevate to
do this because I'm redirecting a bunch
of stuff is I can say I want a new net
route and when you go to somewhere like
66 242 for 10 / and then 24 bits another
way of describing the mask so the first
three parts I want you to go out over
interface 52 and I want your next hop to
be 192 168 01 or something like that so
I can go on put in a route and tell my
machine when you're going to this
particular segment go out there so what
this actually allows me to do is go and
connect to potentially say multiple VPNs
into different cloud backends and route
my latent route directly to wherever I
want to go control my latency or it
allows me to connect to a work VPN and
say I only want to send this tiny little
bit of traffic to that keep everything
else local all of that one of the
projects i was on we had an issue
whether the customer working with we had
the VPN in they didn't supply dns over
the VPN which is kind of annoying they
didn't run dhcp properly on it and all
these sorts of things and one of the
guys in the project came up with this
way every time you connect to a VPN in
windows there's a vent log that gets
written by the razz client to say i've
connected and you can also set up
scheduled tasks in Windows that are
triggered based on certain event IDs so
all we did was how to script locally
that whenever we connected to the VPN
and just kind of fixed all of our
routing for us so we never even had to
think about actually going and swapping
all that in I'm going to now I can leave
that that route there
one of the things that I find useful
sometimes testing different things
wanting more endpoints to attach things
too and not just using ports to do it is
to actually have multiple adapters or
IPs on my own machine and one of the
ways you can do this is if I jump into
device manager one of the things that is
still hidden hearing windows is I can
say add legacy hardware and I can say
install the hardware i manually select
from a list network adapters what I'm
going to get in the list here under
Microsoft is Microsoft km test loopback
adapter you can add as many of those as
you want and you'll just have more fake
local network adapters and that's when
you can go and do things like bind VPNs
to them bind applications to them give
them IP addresses and go and set routes
all over the place
alright let's get out of elevated
powershell for I break my machine too
much so we've we found an IP address and
let's say we found something on the
local network AARP is then how we go and
find where that machine is so ARP is
address resolution protocol and this is
the I've got a name and maybe it's the
name of my nails at home or something
like that how do I actually resolve that
into sorry not I've got a name I've got
an IP how do i resolve that to a mac
address being the physical address how
do I find the device to address the
frame to on the network and the way this
works is fairly simple everything about
networking is stuff that was built on a
ski or very small binary and written in
the early 80s but most of it so what
happens along the way is that we get
these broadcast packets that go out so
I've just done an ARP filter in
wireshark this here is a Wireshark
recording from me connecting to a Wi-Fi
network from scratch so I've got all
that boot up time what's happening here
in this sauce so this is actually my
machine is its thing going out and
broadcasting to the whole network just a
multi cod cast and it says hey who's got
192 168 01 is that is that you if so can
you please tell tell me so it's
advertising that I'm 192 168 0 4 and
it's asking who is this it also goes out
and has a look for is anybody else 192
168 0 4 and if you are just tell the
whole network that'd be great please and
if something else comes back there
that's when you get the IP address
conflict little pop-up comes up somebody
else has gone yeah that's me and you're
like yeah that's me doesn't work so sort
of bounces this backwards and forwards
and essentially then over time your
machine builds up a table of what IP
address matches what physical address on
the network the mac address you can you
know actually if going to ask this every
time though because every time somebody
new pops up on the network they gonna
broadcast this information for you so
you can just sit there on the network
and just slurping this away which is
exactly what windows does for us so if I
go and say get net adapter
I want to find my let's start with my
wireless adapter so that's interface for
I'm going to now say get net neighbor
sounds so friendly when you do that if i
connect to the conference Wi-Fi it's not
necessarily neighbor it's troy hunt
don't connect to him and i can say for
all of those give me them back where the
interface index is for and it's gone and
found a bunch of them and what it's
doing here I've got a mix of ipv6 at the
top and ipv4 at the bottom but it's
saying that I've got a neighbor that
I've heard ARP from who's saying that
they are 192 168 1 37 dot 1 and that's
their physical mac address and right now
our belief is that they are currently
reachable because we've seen them on the
network recently why would we care about
this there's a few interesting bits of
information that gets leaked out here
those mac addresses the first few bites
of that are dictated / manufacturer for
each chipset so first of all I can
identify what type of device it is
what's interesting about that is when i
go and launch a tool like the iot
dashboard click once skip updates this
tool here which goes out and finds all
my windows 10 raspberry PI's and arduino
xand all of that the way this device
discovery here is working is exactly
that so I've been working on an IOT
project at home I have a raspberry pi
it's not plugged into a fancy screen I
don't want to configure it with having a
static IP I want it to just exist on the
network and it goes out and gets the
info it needs and connects to the right
services but every now and then I want
to say deploy to it from visual studio
or I want to debug something on it how
do I find it rather than going in
logging into my netgear router and
looking for the device list in there or
setting a static IP or something like
that what I'm able to do is I can run
this tool because it picks up that
specific scenario or I can actually just
look for net neighbors where I over know
the mac address or at least know the
first few bites of it or my home network
there's only like five devices so it's
not
the router it's not me one of those
three and off I go very useful way of
just discovering what's around you if
you know that that device is there
somewhere it's also a really good way of
seeing who else is certain around the
conference all right so that gets us
down to AARP I want to come back up a
little bit and oops powerpoint is not
good at in and out of slides all right
Wi-Fi and I'll will get to the relevance
of this let's say that I want to you
need to say something on the network and
you need to say something on the network
and you've got a limited period of time
to do this and you need to do it before
I get my hands together shout out okay
we got hello and hi now if everybody in
the front row has to say something well
43 and you spoke at once right that's
exactly how Wi-Fi works so what happens
is we go three of them spoke at once
crap try again and then you wait for a
random time and it tries again and then
you wait for a random time and then it
tries again and this is what it does on
every channel of Wi-Fi does it sound
like a mess this is why Wi-Fi tanks
really quickly with lots of people on it
this is a screenshot from one of our
cisco Meraki routers for our office in
Melbourne it's saying that on average
this router see 756 password by devices
every day even if they don't there's
only 50 for that connect to the network
on average our Brisbane office which is
on a five floors up but it's above an
intersection in the brisbane CBD gets
four and a half thousand devices that
actually hit it every day and even
though they're not connecting to our
network they're scanning that channel
they're trying to say hi there trying to
do something and all these devices is
just shouting over the top of each other
so that's one of the reasons that Wi-Fi
is a terrible protocol that falls apart
very quickly what we do instead though
is when we start to look at networks
like when you Wi-Fi falls over like here
I go and use 4G on my phone the
advantage of saying like 4G is that it's
actively managing the frames who's
allowed to talk when so what it actually
does with 4G is you put your hand up and
say I've got some data which is a single
bit that gets sent on a separate control
channel and then at some point the cell
tower goes you talk now and it tells you
when your slot is so the big thing with
three and four and five G and onwards we
go is about the network's being able to
get a lot better at cramming more people
into that small amount of bandwidth you
think of a stadium environment 100,000
phones all just shouting at once on the
same channel right how it used to work
so the networks are trying to get us to
upgrade to these newer platforms and
incentivize us to do that is obviously
benefits for us as consumers around we
get faster speeds and all of that but
the incentive to them is better
management of that bandwidth because we
need to fit all these devices in that's
why we keep pushing for 4 and 5 g is two
interesting things here one is that as
developers anywhere that we can send a
lump of data in a single hit will always
win even if it's not the latency of the
round trip scenario if we can send
things like sprites CSS files jam
together all those types of concepts
anywhere we can send a single block
we're more likely will be more likely to
get airtime in a single hit which means
the Wi-Fi wakes up pulls the info down
and stops and that actually gives us
benefits with battery as well
particularly in mobile environments even
with 4G because you have to don't have
the radio waking up and going back to
sleep to move lots of stuff backwards
and fords but the other thing with this
is we've had this massive push to these
newer networks which is great and there
is forty fifty hundred megabits per
second but in order for chipsets to
actually keep up with that the think of
the clock cycle and what these chips are
having to do and what the radios and
that are having to do now it's actually
driving the cost of those chipsets up so
one of the interesting things and this
is kind of like hipster networking is
actually going a little bit backwards
something that so telstra announced this
on a second in their investor day
briefing there's two particular
technologies that
Telstra's rolling out across their
network through 2016 the first one is
called LTE cat 1 and this is a one
megabit per second LTE channel and the
other thing is narrowband IOT and the
idea of these is actually at the network
layer we've done so much work to get
people up to 4G and 5g and 5g coming but
get there up to for Jillian 4G eggs and
then go and turn off the 2g network that
for our IOT devices the chipsets are
actually now getting really expensive
when they don't need to be and we don't
need that speed of connection so what we
going to start to see is actually new
forms of network connectivity for these
type of remote scenarios coming out as
well and interesting for us to think
about from a bandwidth perspective of
what we actually need all right one
little story I want to share about TCP
to start to carry us out towards the end
so we've jumped a little bit between DNS
lookup ARP IP Wi-Fi frame aggregation
TCP is that core protocol that we carry
HTTP / typically as I can show you a
scenario in a second where we actually
carry HTTP / UDP this here is a chart
from a real production environment it's
from 2009's oh it's a little bit old in
the tooth now but I like this story as a
project I was working on how to stumped
for a little while this is a large
Australian website and this chart here
is the response time in milliseconds
across different times of day and you
can see that some of those up there get
up to 120,000 so that dot top right is
over two minutes for us to respond to a
network request we had a really really
scattered performance problem and what
we were finding was we end up calling it
I PDP the intermittent page delivery
problem because users would be browsing
the site really quick really quick
really quick they click a link and then
just stop and all just stop the whole
site would just freeze and then 20
seconds later BAM the page would turn up
for them and it was taking us a while to
get to the bottom of this problem and we
learnt a lot out of it
this chart here is not particularly
useful can't actually see what the
problem is there's two problems with
this one was that when we were looking
at our performance we were looking at
the time taken is the series name there
we pulled the IAS logs and that turned
out to be a really bad idea because time
taken includes the time to serve it back
down to them and you've got every
different connection Under the Sun so
that's why a lot of your performance
stuff you'll see everything focuses on
time to first byte when do you have the
first bite of the response going back to
the user because that's something you
can at least control to a reasonable
degree so we took that out then we also
took out the time axis across the bottom
so we plotted the time to first byte and
this is in seconds and we didn't care
about anything on the x-axis and there's
some really interesting clumps in there
and this eventually led us what the
problem was the the background here is
we had a pool of web servers talking to
a pool of search service even in a cloud
environment now we'd probably still have
a pool of search service because it was
a custom search platform we were using
and they were was all aggregating
through a load balancer and then out to
the search service so we could pull them
in and out of the farm and we needed to
update the indexes on those servers and
it was various complex update processes
and we couldn't for various reasons to
an online index update so what we did
was we set on each search server those
two indexes and we're all toggle between
the which one's the current primary and
then we keep them all in the farm and
we'll just chop them off we go and what
we were expecting to happen was that we
would from the web server we'd send a
sin which is a high I'd like to open a
TCP connection and if we connected to a
search index that wasn't around so I'm
port 16 100 it would send a reset this
ports closed sorry not going to open
your connection the application will go
ah that's cool I'll go to the other
index failover we'd open the connection
to 16 101 it would act and off we go and
we'd start chatting really simple so our
code literally had like try connect if
they'll fail over quickly this is all
like 2 milli second response time on
network organ what was actually
happening once we got to the bottom of
it is it went sin
and TCP was designed in 70s early 80s
late 70s somewhere when networks were a
lot slower than they are today so and
the heuristics around it haven't changed
so it said sin and it waited three
seconds and then the definition of in
TCP of what it's meant to do is it
doubles the timeout and weights again
and then doubles it again so it's
literally waiting three seconds six
seconds 12 seconds so you know when you
go to connect to a website and it takes
like 30 seconds before it eventually
fails that's all these times adding up
and then eventually we got a knack back
and we kept working because what had
happened was in that 30 odd second
period 21 seconds sorry in that 21
second period we'd actually done our
successful failover the index had gone
down come back up and then went yeah
cool I can respond to requests we never
had a failover event actually happen
we're always hitting the primary index
and we were just positing while the
index was down and eventually responding
and that correspond did to this chart of
36 11 all stacks up right so the the
things we what we ended up finding was
that the load balance that was sitting
in the middle somebody'd also enable the
firewall on it so it wasn't passing the
reset packets back in order to not
expose whether the port was really open
or not to prevent port scanning as a
default configuration the big lesson
there for us was a don't place network
assumptions into the application so we
started to actually actively failover so
we'd say we're taking this index down
now talk to that one then we'd pull it
out make sure we blowed the traffic off
properly but the other one was just this
technique here of any time we had a
performance problem then now the first
thing I do is take the chart rip the
time axis off the bottom and just squash
it all together and look at what are the
hot spots of the distribution and it
tells you straight away usually where
there's a TCP problem in there or not
some of the useful things I've found I
was talking before about the the
constraints with the older tools of ping
and ipconfig and why I use some of the
PowerShell ones common or less common
these days used to be a common problem
of skype would always take over port 80
on you and start listening on port 80
and you're like why can't my web server
run I can jump in and go get net TCP
connection as an approach and say show
me everything that's listening on this
machine and then what I really like
about using the PowerShell command
what's the first thing is that I can
then go and take this and go and say I
want to format this as a table and I
want various properties or I can do that
in shorthand and say I care about
everything that's local remote and the
owning process and it goes and dumps
that out as a table for me a little
tidbit with working with all these
various tables Oh lots and lots of data
one of the really handy aliases that I
find is OG v what are people not sickly
aware of which is out grid view and what
this does is it actually just goes and
spins up a fully interactive WPF window
with filtering and sorting and all sorts
of stuff in it so rather than sitting
there running something in CMD and then
scanning up and down and trying to copy
the text at bat' you can filter all out
that's finding stuff that's running in
terms of getting out and testing
something the most common thing that
everybody goes and does is is my
internet working do I ping Google right
when we do a ping it's sending a ICMP
packet which is not really what we do
when we're actually trying to connect to
something for real so if I've got a web
service I'm connecting to it of HTTPS
hopefully I'm not sending icmp packets
so why would we test it with ICMP now
it's a useful thing in some ways to go
and say can i connect to that box but
it's also sometimes a furphy of goes
well know the ping failed is that
because thanks dropping icmp packets or
because there's actually a problem one
of the other command lets that they've
got is test net connection and
I can actually just run test net
connection on its own and it goes out to
internet beacon ms edge net it's a
Microsoft operated service and that goes
yes your Internet's working and here's
your round trip time and i pinged it all
of that sort of stuff or i can come in
here and say test net connection google
com and they'll go out and test it so
I've gone and done the ping for me so
they're doing that part or the other
thing I can do is say common tcp port
and then the options I've got here I hit
control space then by the way what'll
people hit tab in PowerShell control
space gives you this autocomplete an
enum here of HTTP rdp samberg winner em
if i do HTTP what it does there instead
of saying pink succeeded at the end it
says tcp test succeeded so it's actually
gone and opened a connection to port 80
and made sure that we can get all the
way through to port 80 no icmp packets
were harmed in the process of this test
especially if you then also working with
things like when RM from a remoting
perspective who knows the winner Emma
report port like you don't need to
remember this hopefully google is not
exposing a winner m connection to the
internet and i can't even control C
because it's sitting there going that's
all right I sent a packet I'll wait six
seconds oh no no no I'll wait 12 we'll
get there eventually test net
connections obviously reasonably long to
type so there is also an alias which is
tnc let's get name there is just me tnc
google com and that'll go and do your
test for you as well there's a lot of
smarter things like that coming through
especially in the context of as we get
up into HTTP to which I'm just going to
gloss over today and ipv6 which I'm also
going to gloss over a lot of these
protocols are now getting more complex
HTTP two is a binary based protocol
which has all sorts of benefits and
threads and streams things together but
it means that the days of being able to
go till net hostname 80 enter and ever
HTTP conversation are gone right and
since when do you do that in your error
use the debugging tools in the browser
but it also means these types of test
tools or get
smarter about the different protocols so
the one thing that no one of the proud
many protocols that we've mentioned
today that we haven't talked about yet
is HCPs how many people are familiar
with let's encrypt all right you need to
get a let's encrypt org those people who
don't know it's free ssl-certificates
and they're also very short lived there
automatic issuing so there's an agent
that sits on the server and it does all
the proof via an automated protocol and
puts the ssl cert on the box automatic
rotations all of that very very cool
project i have my blog and a you and I
don't bother running this I don't want
to actually go and run any applications
or host anything or have working
internet do you think we could test that
somehow that works oh there we go so I I
defer my blog hosting out to wordpress
com so what I do is because i have my
custom host name is the type of thing
that might reasonably expect baidu
resolve DNS name blog tatham do a you
it's a cname that goes straight off to
wordpress and a load balancer now I have
never gone and created an ssl
certificate and i've never gone and
handed it to that domain name and i've
never gone and handed it to wordpress of
the private key or something like that
so i was moderately surprised the other
week when i went to my own blog and went
hold on it's now ssl this is one of the
things with see naming stuff off to
people because i took blog tatham dadada
comdata you and said that's actually
wordpress com I handed control of that
domain to WordPress so they could prove
they owner so they went and issued an
ssl certificate on it and deployed it to
their servers without me doing anything
so you actually hand over proof of
ownership of that domain name
same time basically as you do a senior
what's kind of interesting about these
certificates is that edge doesn't show
you anything useful about the
certificates let's get everyone's
favorite browser anyone anyone know
because they're hosting multiple people
on the same and you even see certificate
information these days oh there we go
thank you they're hosting many people on
the same unit so they've got a
certificate here issued to TLS automatic
com that is not my domain name and when
I go into details they've got the
subject here we go they've got alternate
names and here they've issued one
certificate that they respond to and on
that scale unit they've shoved in all
the different alternate names of all the
different blog blogs that are hosted on
that same server that's kind of
interesting I don't know whether that's
a problem or not but I was little bit
surprised by that so all of these domain
names have delegated and some of them
the root proof and ownership of that to
WordPress kind of cool for an SSL
perspective interesting from a DNS
ownership perspective
right so I guess what are you going back
to the start some of the things I want
to really focus on today was that a
whole bunch of this is actually just
very simple ascii level protocols it's
very simple bit math it's not that
complex and there's always another layer
that you can peel away I've learned most
of this just by staring at Wireshark and
looking up rfcs occasionally and not
reading all of them but reading the
important headings that get me to the
information and what gets to the end of
that is that it's actually all fairly
simple but when you try to explain to
someone that when you type google com
into your mobile phone all this amazing
stuff happens that sounds like
witchcraft and magic the magic is very
simple and understandable so that was
what I wanted to leave you with today
thank you for coming along if I can
please ask if you can do your evals
speakers live and die by eval data it's
very useful to us also if you want to
pop by the ratify booth say hi come and
play mario kart if you get the fastest
lap time on the leaderboard then there's
drones to win and it really loves a good
drone I'd highly recommend reading that
sa link at the bottom left there still
drinking dogs / programming sucks it's
very very comical comment on the
complexities of what we we do at work
every day and the other one there that
github repos / alex / what happens when
this repo here is a markdown file that
started out as essentially google com it
does a DNS lookup and it does ARP and so
on and everybody slowly jumped in and
added more and more information and now
it's really fascinating read because it
starts with the finger approaches the G
key and this character code is loaded
into this buffer and there's the
character set and then there's also the
encoding and this is how it gets through
the USB buffer and then it triggers an
interrupt in the operating system if
you're on Windows it does this if you're
in the links this it does this and it's
an amazing level of detail of the entire
process end to end of learning some cool
stuff so thank you for coming on
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>