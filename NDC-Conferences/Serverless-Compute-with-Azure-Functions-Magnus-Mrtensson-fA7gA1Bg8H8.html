<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Serverless Compute with Azure Functions - Magnus Mårtensson | Coder Coacher - Coaching Coders</title><meta content="Serverless Compute with Azure Functions - Magnus Mårtensson - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Serverless Compute with Azure Functions - Magnus Mårtensson</b></h2><h5 class="post__date">2017-05-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fA7gA1Bg8H8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's let this load I'll fill this
simple thing out and when I get when I
hit create
I'll get almost this right this is a
little bit custom but I'll get this
basically which is the deployment of
functions so that middle one here and
this is the function resource this one
with a little lightning there and as you
can see it's a pipe app service which is
kind of funny and I'll tell you how that
is I'll tell you what this beast is
later on in a demo I'll sort of dig into
under the covers here what I want to
what I wanted to do now is like everyone
can just walk up to a sure and say new
function app and you'll get this and
then what right well then what you will
click on it typically and you will come
into the UX for their function app and
in here you can just choose whatever
scenario is that you want to choose and
sort of click on things the internet is
there but it's kind of slow so you guys
stop downloading those ISOs on the Wi-Fi
right now it's not even funny the one
thing you need when you're doing a short
talks is like I kind of need the
internet alright so you would be able to
just pick and choose a scenario let's
say data processing and let's say the
language would be C sharp for instance
and then you can say I want to create
this function so I already did that and
I just created the the baseline thing
and I did a few tweaks to it because I
couldn't just stand using the baseline
one so when I click on my function I
have here a c-sharp function this is
just a function just a few lines of code
it takes some input and it writes it to
some output really does super simple you
can see there's a c-sharp code basic
stuff and I can actually execute this I
can run this I can run it from in here
I can edit this function in here and do
you know more fun stuff I can just do
any edit it I want I want in here and
make some changes and hit save and
immediately my function is updated right
so that's I can just change my little
function and that's it so this input and
output thing is
interesting because it's something
called triggers and you get those when
you hit the integrate button and you can
define what triggers you and in this
case I have defined that there is a cue
somewhere in Azure storage and when a
message appears on that cue
I want my function to be called so
behind the scenes some code is if
pinging the cue to check for a message
I'm not writing that code I'm not
responsible for that code at all my code
is just c-sharp just one method and then
I also output to in this case to a blob
I write some output to a blob and that's
called a binding I bind in this case to
a blob I can bind to move to multiple
different things I can go to another cue
I could go to a table storage I could do
you know lots of things but in this case
just super simple get a message from the
cue and put it in a blob right so um
that's all I do and I'm not writing any
code here which talks to Azure storage
my code is not aware of azure storage
it's just a method and really just takes
a string input and has a string output
so really there has to be some kind of
magic behind the scenes because
otherwise this would not work and the
magic you need to have behind the scenes
is this file called function JSON where
you will define your bindings and define
with it this is an input bind a trigger
it's it's type cue trigger and the
output is a is a blob type so I'm
outputting to a file you know you can
define these specifically in here okay
so now all I need to do to get the
result is actually put a message on a
cue right so let's go to actually I'll
use Visual Studio for this use the cloud
Explorer and I'll go down to my vanilla
functions deployment and I have my
storage account there you'll see should
i zoom that there we go so I have my
storage account there the one which is
connected to my function the one that I
have had configured to use for my
function if I open that up and you'll
you'll notice that there is actually I
actually had an error before and there's
a poison message handling automatically
which is good but that's why there's a
queue called vanilla poison which is
pretty strange anyway
the queue that I need the queue called
vanilla is not there I need to actually
create it
my function is let is is there and the
it's it's compiled and behind the scenes
that the implementation is still polling
to see if there is a message on the
queue but it'll notice that there isn't
a queue and I'll just okay I'll I'll
wait around so it's right there it
should be able to execute but you know
it's not nothing's really happening at
this point so if I create my queue
vanilla and we can see also in the
output the output will be here and
there'll be a an output here called a I
think thick will be a blob container
called vanilla as well I think but
there's nothing here right now so if i
zoom out again
and go and add a message to my queue
this is the visual studio interface for
interacting with Azure storage so if
I'll just say hello Copenhagen something
like that and I'll put that message on
the queue it should actually be picked
up pretty quickly in fact this could be
a sleeping right now because I haven't
configured the polling frequency or
anything I didn't do anything on this
the deployment I just this is plain
vanilla and actually if you don't use it
for a while it'll dial back and just go
napping for a while and it should be
working so now it's picked up the
message after a while and it's there but
now that there was a message is actually
going to pull more frequently and then
gradually just dial back if there are no
messages to be processed it will go back
and check again after finishing one just
to see if there's another so anyway now
something happened let's go and see what
happened well in my vlog containers here
I should be able to refresh that and see
yes there is indeed a vanilla container
now and in my vanilla container if I
open that up it has a file it's called
vanilla duck text so if I go and say
open on that file it downloads the file
and I will indeed
have hello Copenhagen right so the
message was pulled off a queue it was
processed super simple I was just
logging the message and outputting it to
a blob file and and there's the result
so that happened you know I didn't have
to write any boilerplate code I didn't
have to host any application I don't
actually have an application I have what
is it three lines of code that's what I
have that's my whole application so
that's what this thing is or rather that
thing right it's a little bit of
definition on the side the magic dust
right to make sure that it exists has to
have a specification in JSON and then
there's my few lines of code that's it I
think it's pretty powerful and kind of
handy I wanted to show you first like
sort of just get it or get a feel for
what that is let's do some more advanced
topics now yes screen resolution
everything is okay let's talk about
compute in the cloud and I'll try to be
as quick as possible but it's
interesting stuff in the cloud you have
the cloud service that was originally
known as the hosted service how many
have deployed a cloud service I know
some people in this audience have yeah
so you guys have been around for a while
you know this pattern of course it's the
architecture the original architecture
for the cloud so in this picture you
will have your front-end API web
application something and you would put
messages on a queue to the backend the
back end that's where compute kind of
happened you could do compute there as
well but I mean if you had some
background process that would run in the
worker role in the background right so
the problems with worker roles is that
they're kind of slow to deploy and and
you kind of degrade a server by giving
it a menial simple task you're actually
running most of that server time on thin
air nothing's really happening you're
underutilizing still even though you're
using the cloud even though it's
probably a good deal for you rather than
hosting it yourself and maintaining it
yourself you're still under utilizing
your resources and you kind of have to
understand some things in order to do
this but really was cool because this
was kind of
first true past service just deploy your
application package and off you go you
don't have to maintain a server you
don't have to upgrade anything or do
anything at all it's just there for you
to run so that's really cool and and and
it has had some really good features I
think this is funny though Microsoft
felt that you know platform services
that is the best
they said that back in 2010 and it's a
pretty good statement to say back in
2010 when you don't actually have an is
offering right they only had a pass
offering to begin with so I would assume
they would think this is good but the
market said you know it's what the
market is and and they forced kind of
Microsoft to add virtual machines
because Amazon right Amazon are awesome
with virtual machines and the market
kind of required it big reason for that
is that the market wasn't ready to do
platform services later down the line
they added website so now you could
simply host websites that would be much
quicker to deploy and everything much
more speedy and and awesome and probably
most of you have used websites um now
how about that compute again well you
still if you had if you wanted to do
compute you still kind of need to run
that in that worker role even though you
had websites like come on so all these
people started running their you know I
can do thread queue new worker item and
kind of thing in the background of my
web application you know I can probably
write a decent management system for
that in like 150 lines of code and it'll
work you know if the process dies I'll
rebooted something like that no problem
there so really people kind of wanted to
break out of this ceremony out of
underutilizing paying for a server 24/7
when you actually didn't need it all the
time
so really what we wanted to do was just
run like I showed you a few lines of
code I don't want a whole server for
that you know just give me a way to run
my code please so Microsoft did that
they created a project called simple
batch which is web web jobs originally
called Microsoft Azure websites web jobs
I know it's a mouthful and then they
renamed they've rebranded because why
was kind of probably not cool enough
right so it's all about the app so they
rebranded websites into web apps and so
now of course web jobs is called
Microsoft Microsoft Azure Web Apps with
web jobs so that's kind of funky still
web jobs is then a simple
low-maintenance highly agile low
ceremony and highly efficient way to run
your business functions in the Azure
platform that's the elevator pitch and
and so that gives you a way to just run
a second process together with your web
application you have your web
application front-end deployed and then
you have an additional process running
in the background one thing to note
there though is if that background
process is really hungry it could
actually starve your web deployment but
you know at that point you can just
simply break them apart and have one web
application deployment and have a
separate deployment for your web jobs
that works as well but it's a way to
really really simply and easily run
something in them in the background so
that not everybody has to go and rewrite
that boilerplate code to run a thread
dot queue new worker item kind of thing
no don't do that
instead just use web jobs so time goes
by and Microsoft comes out with both
support for containers in Azure cloud
and with this thing called the service
fabric which is pretty cool I love them
both and you all know that of course
that this is micro services and micro
services is kind of cool so there if you
want to be really cool you'll be doing
two things right now you'll be doing
micro services and serverless right hey
yeah if you do that and you're awesome
so really the thing about micro services
though is kind of interesting micro
services is not a technology it's not a
specific exact definition it's more like
an architectural spire like a paradigm
if you will like just kind of do micro
services and what's that about well it's
about a couple of things if you have
some logic in some states that you can
independently version and deploy and
scale just on its own and run that code
it has a unique name so that you can
talk to it has to have
that okay and you can interact with
other micro service as another code
around you just as you normally do VCF I
don't care what you talk you know it's
fine now if there is a failure this
thing will kind of stand up on its own
again it needs to be logically
consistent have high availability have
failover and have these things because
that's that's kind of the features you
want to get to when you're building
something using a micro services
paradigm and then you'll host this
inside of some kind of a container okay
and probably just a small engineering
team are building this thing so this is
my sort of run-of-the-mill standard
definition of what a micro services why
am I talking to you about what a micro
services well because if you do deploy a
few lines of code and as your functions
that actually takes off all the boxes
all of them so deployment of your few
lines of code to Azure functions is a
micro service it really is so there's
not really much of a difference there
micro services again is sort of a style
so by doing functions you can actually
do both of the cool names at the same
time pretty awesome all right so finally
finally we arrived at a Shore functions
that was added to the platform and how
is that different from web jobs there's
a specific difference it has to do with
the actual word serverless
first used the first trace of that is by
a guy called Ken from who wrote that
server list compute word combo in some
sort of paper you can go and find but
then it became popular when Amazon were
started talking about this how many
people have heard about AWS lambda yeah
most of you lambda is awesome amber is
really good and then they have their API
gateway and stuff and they're kind of
pulled up the words server less and made
it meaningful based on this the big
promise of course of serverless
is that you will be paying only for what
you use that's the big promise if your
code is on X
shooting is not costing you anything at
all when your code is executing the you
know CPU minutes or whatever it is is
the baseline for the consumption model
and the payments that you make so all of
the players AWS came out with their
lambda Google came out with their cloud
functions and IBM bluemix even came
along with an open source called a
project called open whisk so all of the
players were in the field of server
lists all of the players know where is
Microsoft right they didn't have
anything so they had to like quickly
scramble and build this thing called
Asha functions and what actually sure
functions is sort of the child of web
jobs it's the version two of web jobs
and the big difference so literally
Microsoft kind of had this already but
it wasn't serverless
because when you deploy a web job you
actually have to deploy it to a web
application host and then if you want to
have your for instance the thing I
showed you with a queue polling thing if
you want to have that running all the
time you want to make sure that your
code is active and pulling the queue
continuously until there are some you
know at some point there is a message
you have to actually flip on the little
feature called always-on and if you flip
on always-on you're paying for something
all the time and you have an application
deployed and that's not serverless right
it's almost there but it's not service
so kind of like Microsoft had web jobs
they had gone in the you know simple
batch direction a while ago and I don't
care who was first lambda again I said
it before I'll repeat lambda is awesome
right min so it's functions so so
literally that's what Microsoft did when
you're doing server list you'll get this
reduced development cost it'll be faster
it'll be quick and and there's really no
operational cost you're just deploying
some lines of code there's nothing
really to operationally maintain or take
care of you know there's a little bit of
monitoring that you can do to see that
everything is going okay and that's
that's basically it and really if your
code is called no x at all
it's not executing it's not costing you
anything and nothing is you know you
don't have to have any scale or anything
but when your code is called all the
time let's say that there's a you know I
guess zillion messages coming into your
queue and you need to process all of
these messages then your code will
automatically scale to handle that
demand that's the scaling optimized
version there and of course at that
point hopefully you have a good business
model on the back end there now you're
paying for your function but hopefully
it's also making you some money one more
thing this is green I like green green
you don't forget about green when you're
kind of kind of pitching this to your
like boss or somebody or a customer
seriously guys this is really green and
and this is it's a very very highly
optimized way to run there's no or very
little as little as possible waste with
running this compute and I like that I
know it's a good it's a good a good
motivation so function as a service I
don't know that it's a name or a thing
yet
fast I don't know and I don't know that
I care but you know you have is past SAS
my why not even that way why not have
fast but the point here is that you are
not running a server you're not
maintaining a server you are not even
running or maintaining an application
you only have some lines of code so
gonna write all you need to do is deploy
a few lines of code that's what you
wanted to do so literally then functions
is what well it's the combination of
your code and your events and data to
get this nice logo and animation I stole
the slide for Microsoft so he gets this
beautiful thing right and it's generally
generally available functions is GA
since November and that was announced
around the time Microsoft had their
connect conference in November so it's
GA supported product and there is
tooling for Visual Studio I'll show you
this tooling in a bit in a bit but it's
still in preview unfortunately and it's
for 2015
as well so very soon Visual Studio 2017
will be out and of course they'll
upgrade the the tooling for 2017 but
actually I actually only had the release
candidate of Visual Studio 2017 on my
machine so before this presentation
today I had to go and install visual
studio 2015 and but hey I wanted to show
you the tooling there's not a tooling on
the way and there will be lots of more
there will be a framework for you guys
to build any connector any trigger or
any binding that you want you can build
your own custom things to connect and
bind like I just I triggered off a black
you and I was binding to a blob you can
go and bind to Dropbox or you know where
where have you right so that's coming as
well so that's sort of on the roadmap if
you want to look at this code you can
it's open source so you can go and check
it out and right there in the repository
everything that they execute to run
functions is right there and then open
repo you can do a pull request button if
you if you want to fix something like go
ahead and efficiently they take pull
requests I don't know that I don't know
if it's happened and I'm sure it has and
so basically if you have one function if
your code there's probably some input
and there may be some output not every
time there is an output but there can be
you know some sort of result of what
you're doing and then if you have many
of these you get a function app and
that's the thing that I showed you
before the function app and that's the
thing that you provision in Azure it's
funny how it's an app right it's this is
supposed to be serviced why did you have
to go and say that it's an app again
that's the thing we didn't want but then
marketing right so we had the web app we
have the API app we have the mobile app
we have the logic app so therefore we
have the function all together app right
so we have a function as it's such that
they had to go name that function app
but they did anyway they didn't ask me
so this is the unit of deployment to
Azure and you can put multiple functions
inside of your app and so what people
have done and actually this is from
yesterday so if you go in and have a
look at this blog post from yesterday
I stole the image from there and I can
show you in the portal as well what
they've done is they have something in
preview called proxies for a wild Lyle
they have supported routing so you're
you were able to like assign a route on
your function app for your your
functions because your functions can be
like I triggered off a queue but your
functions can also be HTTP in vocable
using just you just like a web hook you
can call in to them from from the
Internet and if you have many functions
you kind of want to decide the names of
them on your on your application you
want to give them a route and now what
you can do with this preview thing here
is that you can proxy them onto a
different domain so that you can like
have multiple function apps and multiple
functions being kind of pulled together
into one API yes of course of course
people are starting to build api's with
this it's it's code that you can call
and and make requests from somewhere and
that's an API right so so in order to
help this along and make it easier for
you to sort of kind of break down
whatever hierarchy of function some
functions and function apps that make
sense to you and still be able to
combine them together into an API you
can have a large API with many functions
and many function apps and just the same
thing right so now you can do that and
it sits in preview now and I am not
applied this to a working project ret
yet it was yesterday literally so but I
think it's cool because it's kind of
obvious if you have HTTP in vocable code
and and then you know pretty soon that
turns into an API so you can have all of
your API hosted in functions and sort of
have defined routes like that you know
they have slash API slash hello in this
case right so you can have whatever you
like yes
is it possible to deform defined as an
arm template I love that question
that's a fantastic question that's in my
deck later no no you don't have to shut
up
I love I look Wow arm question brilliant
so just to be clear in the last session
slaw today I'm doing my second talk at
this conference
it's about arm and if you don't know
whatever whatever he's talking about you
definitely come to that session and
still if you do now you should come to
that session anyway it's a really good
one the content is really good you know
I'm not talking about me I'm talking
about the content there's stuff you need
to know if you don't know you should
come to that session I've repeated it
enough now and I'm actually opposite
Michele Bustamante is kind of bumming me
out a little bit and I know it's like
Friday afternoon so a lot of you folks
will have gone home already but don't do
it because it'll be a good session so um
let's see next slide are you ready for
it BAM and then awesome I didn't even
pay him to do that all right so yes
indeed let's first take a look at the
resources that that I provisioned the
vanilla deployment thing and then I'll
come back to explain to you what that ll
actually I'll go and explain that and
I'll come back and we'll compare notes
so going back to that's cool not how you
did that brilliant brilliant man so
we'll go back to Azure and we'll go to
this so this now if you haven't if you
never been there you should go there
like immediately or you know when you
get home resources that Asscher calm how
many have seen this only a few yeah most
of you have not dislikes five hands
showing up cool so most of you have not
seen this so on resources that are calm
you can sort of drill down into all of
your resources and see what you have
exactly what's deployed and I'll
actually share with you now because we
have time to do that I'm working pretty
quickly here so we have time I have a
half hour more so it's cool I'll show
you the secret of azure you want to know
the secret of a sure you don't know it
yeah yes
got you riled up now and so I'll open up
my subscriptions here these are all the
subscriptions that I have access to
right now with this user I'm signed in
right so I'm authentic ated as me here
so I this identity can can see all these
things so I have my vanilla functions
they're my resource group for the
deployment that I showed you recently if
I open that up I can go sort of go down
and can see that there's a web
deployment there and there's a website
hmm
there this banila functions okay so I'm
gonna zoom zoom out and show you the
fullscreen honest so I can drill down
all the way down to my specific resource
in Azure right so I'm now I'm now drill
down to a resource and this thing here
is the template which creates that
resource this is the definition the
specification of that resource and it's
funny how that's a website isn't it
so um the type of resource is a
Microsoft web sites so remember how they
rebranded web sites into Web Apps
well the resource underneath the cover
is still called a site so you know when
when marketing says web app techies just
go yeah I know I know
a web site I got it and and and it's
even more funny when you go to you know
that all the web and the web
applications in Azure they have to have
associate be associated with a what with
a with a ah you guys do you guys even
know that name app service plan that's a
crap name app service plan nobody
remembers it but yeah there's that as
well so I can I can go to my resources
here and I can find where is that oh
sorry
its web server farm yeah yeah laughing
no you know where I'm going with this so
the thing that marketing calls an app
service plan is underneath the covers of
Microsoft web slash server farms so it
is a server farm so literally tech guys
were like yeah so we have the ability to
run server farms and
with our websites and marketing was like
wow what do you mean farm really no we
got to have a cooler name than that you
know better sounding names so it's all
about the app so it's web app and app
service plan and now tech guys go what
the huh I don't even know what that is
but underneath the covers guys this is
web app websites running in server farms
but here's here's the secret of azure ok
I'm going to show you two right now so
here's the management endpoint that we
are communicating with right now
the management endpoint of azure and
you'll see that it says black
subscriptions and this is the
subscription that we're running on right
now the unique name for the subscription
it's not a secret or anything
all of them have a unique ID and then
black resource groups and my resource
group name is vanilla functions that's
the name of the resource group you saw
that before in the portal and then we
have providers so it's Microsoft up web
slash server farms that was the type
right and with this one more thing I'm
going to show you later but the name of
the thing is vanilla functions okay when
it's actually vanilla functions func
form but that's the name of it that's
the unique name of this thing so this
whole thing here this this whole string
here what is this what is this thing
well it is a you are I it's a unique
identifier globally unique identifier
for my resource no other resource in
Azure has this unique identifier
moreover since this is the management
endpoint it's also a URL that I can talk
to using rest so I can do stuff with
this if we go back to the web
application again go back to my little
functions again web site so if I go back
to my web site I can literally edit the
template right here in the browser and
make a change to my site I could I could
do that I'm not going to do it right now
but I could what else could I do well I
could do like actions on this endpoint
it's a URL I can talk to that it's a
rest-based URL and I can do stuff like
start and stop so if I do a post to this
URL here
all the way down the same URL long long
long URL all the way down to my name of
my site it's vanilla functions funk
then I do a wax top or wax start that
management endpoint will respond to that
and stop and start and restart my site
so I can talk rest through the
management endpoint of this thing so if
we kind of zoom out of this again just
for a sec I'll actually zoom out and so
if we zoom out of this again and take a
look at this what do we have well so all
of the things you know all of the paths
down to each resource that's kind of
like branches on a tree and the
resources hanging off the ends are Leafs
right then if if one subscription kind
of becomes a tree with which rooted in
the subscription if you have a bunch of
a bunch of the subscriptions like I have
here you have your little forest going
you all thought that that Asscher was a
cloud right well the secret is the
secret is out it's not a cloud it's
actually a forest because all of us can
understand what a tree is
and now that you know that they all have
pasts all the resources there right
there they're kind of now it's not so
daunting and scary anymore is it like
I've seen a lot of people like I see you
guys are like I actually thought about
that that's interesting
all right so I wanted to show you that
and let's also look at the other bit
which is the template the our actual arm
template my arm template for deploying
this thing looks like this it's actually
a little bit redundant and then there's
a special thing at the end that I like I
define for resources here I could
actually go with just two but I do it a
little bit more thoroughly to sort of
give you a few more hints here I have my
website defined in my template and
that's that's the definition of my my
application and with here's a legacy
from from web Jobs and the data the cue
and the blob stuff that I had that
was to a storage account and also the
log output that I was able to write log
output and that stuff goes to also to a
storage account if you provision
functions in the portal you will get one
storage account and will be the same for
both your log output in your data output
but it defines actually two connection
strings in code one is called a sure web
jobs dashboard an azure web jobs storage
so here you can clearly see that the
azure functions is a child of web jobs
because they even didn't even bother to
rename the connection string so it's
actually still the old name so you can
see here that I can define not one but
two different ones one for the dashboard
one for the log data and one for my work
data if I have you know queues and blobs
and stuff so I can define two but if you
provision it from the azure portal
you'll get one storage account with the
same connection string two to one
storage account which is why my template
actually defines not one but two storage
accounts down here so I have there's the
server farm I have I have my storage
account for my data and then I have my
storage account for my logs so those are
the two ones defined right there so one
more thing before we leave this place
server farms my server farm is a kind of
special it's a special kind of server
farm I want to show you first first of
all I want to show you up here this is
this is a this is a little bit funny as
well and my my web my function app is
hosted in a website so the type is
website but it's not a normal web
application website it's a special kind
it's a function app kind so since the
word type was taken you had to get
another name so they use they had to go
with the word kind it's another kind of
a web app or sorry website so there's
one kind of web site for web app there's
another for logic app known well and
mobile app an API app and then there's
an additional kind
dov a website called a function app okay
so that's how they had to guide roll
with the arm templates underneath the
covers and if you go down to this thing
here in order to make this deployment
server less it has to have a special
billing model it has to have this
dynamic billing model when the code
executes then you are built so you can't
just be any old server farm that you can
scale and do stuff with which you can
with your you know your normal app
service plans so it's a special one it
is a service server farm here with the
kind function app and then it has a
special SKU called I won and the tier is
dynamic so underneath the cover there's
this this is like we're down weighing
like this is not some bowls now I'm
showing you exactly what's underneath
the covers this is like the equivalents
of openness opening up the engine and
kind of like diving in and rooting
around right so that's what this is so
now you know how it runs so let's like
let's go you know go all the way from
the bottom all the way to the top there
is somewhere there's a VM in Azure on
that VM I don't know this is a big
secret or anything but on that VM cloud
services is running good old cloud
service on to the cloud service
Microsoft have deployed 1ku do the
engine which runs under Web Apps it's
also an open source project you can go
and watch that so they deploy the
workload of kudu onto a cloud service
based VM and then into that they deploy
this special kind of a website called a
function app with this special
implementation and into that host you
deploy your in lines of code the
resulting scenario here is that you
don't maintain the hosting layer you
don't maintain the app player you don't
maintain the OS you don't maintain
anything you don't handle anything at
all you just say function app lines of
code do right so you don't have to do
anything that's that's the beauty of it
but now you kind of know what
need two covers okay you can actually
know that did you or all of you did you
all of you know that web apps are
running on on cloud services they are
I'm just saying it's not a big secret or
anything but you didn't know
hah okay cool so back to slides and
that's why I wanted to show that
screenshot thing there when you deploy
that app service plan with your function
app you'll get this and it will have
this green cloud and will be like grey
the symbol the logo that's the special
dynamic type of app service plan if you
just go and create a normal app service
plan is going to be you know a dark grey
with a blue cloud right so that's that's
the difference between them now for
tooling we're doing on time we're doing
great on time perfect tooling so
functions tooling is in preview you can
go and download it and install it and
look basically like this it'll be there
Microsoft Azure app service tools two
point nine point six functions preview
for visual studio 2015 that's the thing
right that's the thing you'll be
installing I've done that it works
pretty well it has a few known bugs but
not much and then again I'd like to say
that maybe like free if you have an
enterprise scenario you kind of want to
have tooling which is not in preview so
if you kind of want to deploy functions
to an enterprise big scenario right now
you can still do it well you have to
realize that the tooling is in preview
and it also comes with these Feli tools
that you can actually download I think
it's like chocolaty or something that
downloads it and install on your machine
a little hosting environment so that you
can f5 your functions on your local
machine
so let's actually want to start up a
separate instance of Visual Studio in
the background here and so if you want
to run
here we go
full screen if you want to create your
function app with the tooling you can go
and say I want to create a new project
and you can get a function and I have a
folder for some throwaway samples so
I'll just say yes to that that will
create me a function app project inside
a mission studio so with this tooling
now like before we didn't have any
tooling for it and I would definitely
not call that enterprise-grade
but um you know we do have some tooling
now and then it's getting much better
all the time and see I'm not showing my
solution Explorer there we go so you
basically just get a little empty space
like that with a host JSON where you can
configure some configuration settings
for that if empty and then some app
settings you can go and define your
connection strings if you want to work
with storage and then you'll go and say
I'd like to add I'm going to go add you
can't actually say add new item doesn't
work in the preview but you can go add
new function and then you'll get to
choose which language you want for your
function and actually that's on a
separate slide that I have official
supported languages right now are a
c-sharp and JavaScript but as you can
see they're working on quite a few more
languages and scripting since you can
literally just take a piece of
powershell a few lines of powershell and
throw them into an azure function and
have that execute on a schedule every
morning at 7 o'clock or I don't care you
know a schedule just run that you know
at any any time that you like and so
there are lots of different supports
there I mean F sharp is the obvious one
this is a function right so kind of
makes sense to have F sharp and this is
one place like lambda is still awesome
but doesn't have all of this language
support I don't know that they will go
there and or they won't I don't know but
Asher is a head in that department at
least actually I think that's not my
next slide in the deck but anyway so I'm
not going to
I'm not going to stay in this demo here
and sort of recreate the stuff that I've
already done we're going to go and talk
about how to make this a little bit more
sort of enterprise-e and more corporate
and that is in my slides so why don't we
go there and oh by the way I could have
done the f5 thing and I'm not going to
demo that if we have I don't think we'll
have time but I can yes a write a
function in my function app I can hit f5
and I can execute the function on my
local machine that's also in the preview
tooling that was not there before so you
kind of had to run them in the cloud and
you know we have Visual Studio we're
used to be doing f5 debugging and also
yes before anyone asks I can also go and
attach my debugger to a function running
in Azure so I can find the function in
my cloud explorer I can go to the
function I can right click on it and I
think it's the function app I don't know
I don't remember and you can right-click
on that and attach debugger so you can
debug remotely into the cloud with your
local visual studio set session so you
can do all those things you know that's
I think honestly I think that's what we
expect as developers using Visual Studio
we expect the tooling to be all there
let's talk about continuous deployment
let's make this a little bit more
corporate because yes I can right click
on my function app in visual studio and
I can do publish which will do a web
deploy of my files up to Azure you know
that's that's easy web deploy is
standard but of course I can also do
continuous integration and yes I haven't
had a demo of that if I go up to a sure
I have my vanilla function set up here I
can you see there's the proxies by the
way it's right there preview if I go to
continuous integration
I can easily from this side pull in code
from a repository and I'm not going to
do it all the way here because I already
have that deployed in a separate demo
and I actually did it the other way
around
to that in a second but yes I can go in
here and I can pull my code from like
all of these sources you know because of
the Azure platform this I would say is
another place where as your functions is
ahead of lambda where they have like all
of this native integration to all kinds
of crazy things because of the support
of the platform so that's I think that's
pretty cool I like the login features of
lambdas though they're better but anyway
you can choose your source and I've
already set this up with visual studio
team services when you click on that you
can go down and pick you know you can
pick your project and a bunch of demo
projects here no secret thing no
function demos and I can choose my
branch and stuff and I can say set up
continuous deployment so whenever I push
code to this repository there will
automatically be a deployment into this
slot here into this production space ok
so instead of me doing that I was
fooling around with a demo and and I was
trying stuff out and I was messing
back-and-forth with things before like
this morning and then when everything
was working I was like oh it's working
don't touch it and so the name of it
it's a it's the funk demo CI test but
yeah the name doesn't matter and here's
a separate deployment that I have and
this deployment is connected to my
repository so if I go and click on that
I get all of these
functions so I get all these functions
that I have in a sample library that I
copied somewhere just so I can show all
kinds of crazy things and and if I go
into team services mr. studio team
services if the one that I use you know
you can choose whatever you like but I
use that one and and if I go into this
you see I messed with it a little bit
there so I had a few deployments that
didn't work but but now they're working
simply what I'm doing from in here I set
it up from inside of Visual Studio team
services you can do the integration from
the portal that I showed you but you
could also go in here and basically do
this get the source code and do a
deployment that's it of course I could
do like unit testing and other stuff in
here as well but really what we're
talking about now is copy the source and
put it on the machine
because that's what we're doing we're
putting the source code files on there
when when it's c-sharp that we're
running for instance that runs in a dot
feeis CSX file a c-sharp scripting file
so it is a c-sharp file with c-sharp
syntax with c-sharp code but it's not a
program it doesn't compile to an XC on
my end
I'm just deploying it the portal or
sorry the function app in Azure is then
of course taking my code and using the
rosslyn compiler to compile it and do
some stuff on my behalf but I'm not
doing it right so literally that's my
whole deployment scheme right there two
steps yet put that's it and so with this
I can do I can go to my other visual
studio this one function demos where I
have all of my code here's my function
demos app and all of these folders is
one folder per function so if you add a
new function you get a new folder and
and if we like to look at my hello world
there it's going to look exactly like my
vanilla and that I showed you before a
folder called a oh one hello world
because that means that it's from the
top of the list so you guys can see it
and then the student there's a run run
dot CS X and the function JSON so I add
a new folder here and I give them you
know I can copy this copy paste and give
it a new name and the name of the folder
is the name in the function and simple
like that so if I make any kind of
change here and I push that code to my
server my source control repository
that's immediately going to trigger the
deploy into production so at this point
with tooling inside of Visual Studio
which continuous delivery on to whatever
it is right I don't have like it's
hands-free deployment I'm just pushing
to my repository at that point I think
we kind of have Enterprise like we're
there and I think that's pretty cool
we're starting to run out of time but I
am nearing the end of my slides so
that's good and I showed you language
support already so we'll skip over that
just in case we had time I actually can
show you some more of that and you can I
just want to mention you can deploy
functions as part of the app service
without having this dynamic deployment
model so if your company is already
invested in maybe using for instance the
app service environment like say your
enterprise and you're using app service
environment you're already paying for a
bunch of resources in Azure a bunch of
web apps you're already running that
stuff you can just add your functions
into that pool which you are already
paying for at that point it's not server
less because you're deploying to some
service that you're allocating but since
you're already paying for them that's
fine but you can also do the dynamic
billing model as you want to so you have
the two options there and I think that's
pretty good so in the dynamic deployment
model when nobody's calling your code
your code is not running then you're not
paying anything at all but if you're
already paying for resources in Azure
just go ahead and co deploy with that
those resources that you're all ready to
have in your RM in your payment right
you're all doing for that so let me go
to the cool Asha functions demo the last
one that I have and it's cool because
it's kind of well I'm doing all the hip
things now
I'm going to show you this and using
Visual Studio code and and we're going
to go and show you a bunch of features
so here's the it's actually called
several features like I think I kind of
need to rename that and to into the cool
demo and if I go and check my code here
it's a little bit more oh sorry I have
to switch thank you
so if I go to my there here's here's my
code now it's a lot more code and stuff
but as you can see here this is an HTTP
in vocable method I can call that from
the Internet and it's asynchronous first
of all right so it's a think it returns
a task of HTTP response message and the
the input is an HTTP request message
right so it's asynchronous which means
that I also have a cancellation token
and all that stuff going I am calling
into this code here called hello dot Lib
greeter I'm creating an instance of a
class while we're in that code well that
code is in my reference hello that lived
up dll so I can reference external code
that I have written in here as well and
that code is deployed in the bin folder
my DLL I can copy that file into my
deployment and copy that DLL over to the
server and it'll be referenced into my
little project when the code executes
another thing that I did so I'm calling
that code I'm doing a sink here so I'm
doing you know a weight in my code so
that's good I can what I wanted to do
was my code was I didn't want to output
JSON because you know Jason is kind of
for the new kids on the block we all
want to do stable good ol XML so if we
execute this method you'll get XML
because that's really cool so I went and
I did I used a nougat package called
something XML and I do an XML conversion
of my result here I'm serializing an
object into XML and I'm outputting XML
Jason you know because really what you
can do if you want to reference nougat
packages I'm just using XML dotnet there
instead you define your function no your
project JSON and in project of JSON you
can put nougat packages and that will
actually pull in the proper nougat
packages and compile them into the thing
as well so you can do that and so I'm
showing you now like a bunch of features
of functions that you can do which means
that you can you can literally you know
write anything here you can reference
from this to other functions in your
library you can have shared classes
defined in other other files here you
can have like maybe some domain objects
like a person or something a class you
can do that you can write them in here
as well so all the things that you kind
of need to do are here available to you
um but we my friends are now finally
running really running out of time so I
am going to start really wrapping up now
and say first of all I'm going to ask
you guys if you have any questions yes
the craziest thing I've seen people do
with functions what is the craziest
thing actually most people that use
functions are kind of they have a head
on their shoulder they know what they're
doing so I haven't really seen very many
crazy things but if like I'm going to
just inject you should be you you should
be doing asynchronous and and people are
not treating their functions properly
they're doing dumb things with the
things that they're calling into and
they shouldn't be doing that they should
be doing smart things which is async and
that sort of stuff it's not a good
answer
so yes boundaries
well so I think so I think that when in
terms of boundaries I think that people
are maybe not they're getting lost in it
like they're doing all kinds of
functions and all of a sudden nobody
knows what you know how it hangs
together so this is very decoupled this
is just a little bit of code there
little code there and once you have like
a whole forest of different little bits
of code it could become messy so I've
seen some people sort of entangle
themselves the point of functions in my
mind is to keep it very very simple and
straightforward and focused and if you
lose focus you can get into a mess and
that's you know a standard it's the same
for any type of coding really you don't
want to do that there's one more
question and then we're out of time how
is it scaled it's basically
automatically scaled if you run the
dynamic plan you can tweak a little bit
on that and we even remember how it's
done at this point see if I can checking
in the background I don't know that I
have a good answer on that one
so hang on there are a couple of
settings I'm looking on right so I'll
just it's not a complete answer but
typically it should be dynamically
scaling to meet your needs basically
just if a lot of people are calling your
code then you should get more power and
but you can sit a couple of you can
tweak a couple of settings in the host
JSON file and you can fiddle with some
stuff there to see how many concurrent
calls am I am i allowing here so that i
maybe don't do too many maybe my
underlying resources can't handle too
much load and i'll have to like queue up
it might choose and and when work is
slowing down you know it will it'll even
out over time but you can sort of set
constraints on it and there's a setting
inside of the portal as well where you
can
go to this and and set at least maximum
amount of this is how much I'd like to
spend in a in a month and like there's
the quota I don't want to spend more
than this so you don't get run away
functions like somebody decides to call
your function 46 million times and
you're paying for it right so that's not
a good thing so there are a couple of
tweaks that you can do but but there's
some yeah I don't have a really you know
complete answer on the scaling thing it
does scale really well to high demand
and and if you are sniffing about on the
top level they're a really really high
demands of throughput you can run into
some boundaries because it's not
infinite but I have yet to see that
actually happen
most people just scale it's just scales
and things like this is awesome
it just what basically so to summarize
and to end things were over time even
I'm going to stop right now by saying I
think that we will kind of we're going
towards a place where we're not focusing
on the CPU Ram hard drive and that sort
of stuff we kind of expect that there is
capacity for what we want to do and we
just pay for exactly what it is that
we're using and functions is still kind
of young but it's very competent already
and it's getting better and better so I
think it's a very well worth thing to
take a look at so but with those words I
want to thank you guys for your
attention today I hope it was useful to
you thank you for being</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>