<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>​Beyond the OWASP Top 10 - Modern web application bugs - NDC Security 2018 | Coder Coacher - Coaching Coders</title><meta content="​Beyond the OWASP Top 10 - Modern web application bugs - NDC Security 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>​Beyond the OWASP Top 10 - Modern web application bugs - NDC Security 2018</b></h2><h5 class="post__date">2018-02-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/k12u-76CarE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay welcome
I call this chalk modern web application
bugs although in the program it said
something else
it said also or beyond the OWASP top 10
and I'll get back to that why I removed
it but a little bit about me first my
name is Alan after all I work at a
company called Blanc I do all kinds of
security related stuff development
security testing and I'm also starting
doing quite a lot of bug bounty hunting
I also built open-source security tools
such as retire Jess and I'm head of the
last chapter here in Oslo and there you
also have my Twitter handle so while
doing these bug bounties I was sort of
looking at the OS top ten and this is
the older was top ten the one from 2013
and I was looking at it and I thought
well there is quite a lot of stuff
missing here because I see a lot of
these things that pop up in this bug
bounty program that's not mentioned and
then when the the the BRC one of the
newest top 10 came out I thought well
these things are still missing
which is odd sounds like I have some
weird noises coming from my microphone
sorry about that and you can see here
the the blue ones
those were the new suggestions and the
green ones were merged so we had a 4 and
a 7 were merged into a 4 and a 10 was
gone and these new ones they created
quite a bit of controversy and and
especially the last one a 10 under
protected api's that sounds a bit odd
but never mind like this at this time
this was the time where I suggested this
talk for this conference but then of
course something happened the new OS
top-10 ended up looking like this
instead so they really changed things
around and they they moved some some
things have just moved places but we see
we have a new a 4 and a new a a a 8 and
a new a 10 and unfortunately for me a 4
and a 8 were supposed to be in this talk
and now they were in the u.s. top 10 so
it's no longer be on but and and I was
now thinking what should
do about this because or I could cheat I
could pick the ones that were removed
and then instead of those that I
intended to talk about but I decided
well I'm gonna go with my original plan
because I think think these things are
important and I'm gonna go beyond what
it says in the ORS top 10 I'm gonna show
you a bit more and I think it will be
useful for you anyway and not everything
here is in the top 10 either because I'm
gonna show a lot of different things if
we go to these bug bounty programs they
often publish statistics so this is from
bugcrowd from 2017 and we see sequel
injection is still one one of the the
most common ones here which kind of
reflects the OS part 10 the 63% for the
long one 18 for the almost as long the
numbers don't really make sense but
never mind that
and if we go to hacker 1 which is
another one we see that the most common
ones are still the same things like we
had process scripting on top we have
improper authentication we had
cross-site request forgery which was now
removed from the u.s. top 10 and we have
a lot of different things like we have
all the injection attacks down here so
obviously we have some we see the same
things kind of as always top 10 but
there are still a lot of things that are
happening that we don't necessarily see
in these statistics so let's start with
with XML because XML is fun or something
like that so we have this simple
application here I can I can send it an
XML and of course I get the XML back
nothing really spectacular about that
and I can of course get some XML so the
top window here is the stuff that I'm
sending and the lower window is the
stuff that I'm getting back so I can I
can get something back something that
I've sent so how many of you are
familiar what an XML external entity
attack is not so many ok good so what we
doing with an XML entity attack is that
we are defining new entities so in this
case we are defining an entity here and
we're saying that this empty
tea will be the contents of this file
and then we're using this entity down
here so let's try to send this one and
now suddenly the contents of the file
appears down here there are some cabbage
though because the file needs to or the
collective file needs to be valid XML
but there are some ways around it but
this is kind of the basic example of XML
external entities we can steal files of
the system but what if we move a bit
further so in this case the application
will allow me to post an XSLT and it
will take an already existing contact
which was the contact number one and
would create HTML by applying this XSLT
to the XML and I mean the normal example
would be I get something like this back
like I've I'm creating an HTML body a
table and then some some table elements
and everything looks like this done here
everything is fine but XSLT has some
functions so first we can start by kind
of grabbing information about what's
running on the server so you can see
we're using system property and then x
SL version x SL vendor blah blah blah
all the way down here and I'm getting
back what product is actually running on
this server so now you can see that I
have version 2 of XSLT which is
incidentally a very nice attack surface
so but the first thing here is a
standard standard from for XSLT one
feature which is called document and the
document function is used here so I'm
gonna just grab another XML document off
the server and include it in the in the
output so now I'm stealing like the the
pom file the the the deployment
descriptor or the bill descriptor of
this system that's on that's running
this disponible website so I'm just
stealing stuff and I can figure out what
kind of what kind of libraries is being
used there are some of them may be
vulnerable etc so that's that's nice
from an attacker perspective I could
also do ecstasy in the XSLT
a lot of people now they kind of protect
the XML parsers from from xxe but in
this case I'm doing it in the stylesheet
instead of doing it in the actual XML
Durham's that I sent in earlier so in
this case we're gonna see the exact same
thing happening I'm grabbing the content
of the file and just pushing it down
here but also access XSLT to has a
different function which is the nicest
one of all it's called unpassed text and
it does exactly that it reads unpierced
text it doesn't try to parse it just
grabs the contents of the local file and
pushes it into the resulting document so
if we send this one we get the same
thing so now we've kind of stolen some
stuff here maybe we could go even
further we could use this to connect to
other systems so in this case I'm gonna
go and do a back end request to some
system that's not available from the
outside so so now inside one server I'm
gonna try to pivot and try to access
something else and those of you familiar
with or actually the name of the system
is here so you see this is an elastic
search instance that I can reach by
doing this so this elastic search
instance wasn't available from the
outside but now I can attack it because
I'm attacking it through another system
also there is something called blind xxe
and we can use this to to steal files
where we can't immediately see the
results ourselves like in the examples
that I just showed you you could see the
XML coming back you could see the
contents so what this thing does is it
creates an entity that contains the
contents of this file and then it loads
a DTD from this location and this DTD
looks like this so it takes this data 3
here which contains the contents of this
file now and it pushes it to the end of
a URL and this one becomes a new entity
that's pushed in here and it's kind of
back in forth a bit but this allows me
to kind of send up an XML and somewhere
back in the system somehow I don't know
where this is going to
parsed and it's gonna read this thing
and then it's gonna publish the contents
of that file back out to my server so
I'm kind of stealing in a blind fashion
I don't have to see the result I just
have to be able to submit an XML and see
if something happens later
it can happen immediately and get happen
a lot later depending on the structure
of the application so an example from a
from a bug bounty this is from hacker
one and I find this this exact one to be
a bit interesting because if we look at
the severity here they say medium 5.3 so
this is a medium severity but they did
pay quite a lot of money for it
ten thousand dollars that's quite an
amount of money this was on a Twitter
endpoint alright so this was this was
XML external entities so off to the next
one and this one is is also in was also
included in the most of them 2017
serialization is something we often use
like we communicate between different
servers and we have to find some way of
converting or internal objects to some
wire structure and then convert it back
to internal objects so it could be
something as simple as XML it calls will
be binary protocols so we we see a lot
of like hey sub-caste and all these
kinds of caches they use binary formats
instead but it could it could be JSON it
could be XML as well this is used in a
lot of different place like I mean web
services are an example of this REST API
czar an example of this but also all
kinds of distributed caches distributed
databases etc etc and there are a lot of
places where we actually deserialize
things like in in cookies like in jvt
and things like that we also deserialize
things we've serialized it to something
we can transfer and then we get it back
the thing with this serialization attack
is that we can use this to do a lot of
bad stuff we can do tonight a denial of
service like take down the system we can
manipulate the state internally we can
compromise the integrity or we can even
get remote code execution which is the
most fun one so to be able to attack
something we need to have a gadget
so in on top here we have a simple class
that does nothing really I mean if you
if you deserialize into this into this
class you're just gonna get a person
object with a name the thing about the
lower one though is that it actually
does something so if you can if you can
desser lies something to this object
it's gonna do something in the
constructor which you might say well
that's bad practice why are you doing
this but it happens that we can actually
combine lots of gadgets that together
form a chain where we can do something
like this this is a very simplified
example but if I were to actually write
something and send it something like
this either JSON or XML uh and it would
be DC right into that class it would
actually execute it and this is quite
bad so but there are some prerequisites
we need to be able to tell the system
which object it's supposed to
deserialize to so luckily for us or
maybe not
some deserialize ursday allow us to
specify types so here is an example from
a dotnet application and in this case
you can see the dollar type thing that's
several places here that's a feature
luckily you have to turn it on for it to
book to work but in this case it allows
us to tell the deserialize of which
object it's supposed to deserialize to
so in this case we're kind of combining
a couple of gadgets so we have the
object data provider it's gonna
instantiate a process and it's gonna
give it count the calculator as an
argument and it then is going to invoke
the start method so in this case we we
build a process and then we invoke
starts so we have a couple of gadgets
that work together here here's another
example from a job application and in
this case we actually have a Roman or
application that we can play with so I'm
gonna I'm gonna send this in what it
does here is it it builds a proxy of a
contact and the contact was is what
we're sending back and forth and then it
uses an event tunnel and a process
builder and it basically will execute
ping three times against this IP the
problem is I get this back what is this
well I can't convert a
UNIX process to a string okay so this
didn't help me much maybe if I can get
it to do something that I could actually
see the end result of and luckily for us
we can so what I'm going to do in this
case is that I'm gonna invoke bash I'm
gonna tell it to create a reverse shell
back to my laptop but then I first have
to listen on the port so I'm going to
you set up my my laptop to listen on
this port and hopefully I get a shell so
now I'm logged in to this server and I
can invoke commands and incidentally I'm
also logged in this route because of
course they were running this
application is route which is not very
nice they should so now you can see why
why this can be a really really
dangerous attack so once again here's
something from from hacker 1 in this
case
Starbucks was the one that had the
program and of course the severity err
was critical and they said well I could
basically run code on your server so
that's not a good place to be in the
next thing we're gonna talk about is
something called server side request
forgery and it sounds a bit like CSRF
client-side request forgery but this
time it happens on the server so it
could be something very simple something
like this so let's say we have a browser
we can send it a request to our server
and that somehow makes the server make
some kind of packing requests it could
be like a reverse proxy but it could
also be like let's say we're uploading
an image but instead of uploading the
image we're just going to tell it this
is the URL where you can find the image
and then the server application goes out
and and grabs that image and pulls it
back in and then uses it for our profile
picture or whatever so we can somehow
influence the way that the server
application will make HTTP requests out
of out of the back there so a simple
example let's say we have a request
coming in from the router that looks
like this but we don't want to host the
picture
on our server itself because we have
this other host that are actually
processing the images and creating all
kinds of versions of them so we have
this nice little piece of code here that
takes the incoming URL and replaces the
first part with the URL of the actual
place we want to go so we can end up
removing the first part and then
building a new URL and then we we go out
and of course there are ways to attack
this thing because it's doing something
really stupid here so the first attack
is this well if we just do evil comm
it's gonna remove the first part and
then concatenate the stuff and then we
end up with going to image just
example.org evil comm which is of course
a completely different server than
example.org
we could also do something like this so
we do a colon and then some variable and
then at and then an IP well what happens
then is that the first part becomes like
images dot example.org becomes the
username and dummy becomes the password
and then the actual IP we're connecting
to is 10.00 that one but these are kind
of abusing a piece of code that's there
but sometimes we don't have to do that
often we see things like this well if
you want to import data just give us you
the URL and we're gonna go ahead and
grab something like like the image or
example for instance so in this case
maybe we could tell it like I go with it
go out and grab this XML data stuff and
just bring that back in of course we can
then start pointing this other services
internally so we could point it at in
this case a MongoDB we could point it to
every anything that runs internally and
we can access internal services because
of the way URL handlers work sometimes
we can also grab files because well they
that's a valid URL like file that blah
blah blah so they're gonna go out and
grab that file instead and then bring us
that back but if we move to - cloud
services it gets even worse because on
many of these services there's something
called the metadata host which is on
that IP there and on that we can find
lots of information about the server
itself and we can also get security
credentials
and of course we could use this to grab
stuff off of of MongoDB or Ravin DB or
any other things that has a web
interface that we can reach from the
system that we're attacking so okay
let's try to protect against this we're
gonna do blacklisting so obviously we're
gonna blacklist that URL because that's
a bad one what about this one hmm some
of you might wonder is that really a
valid IP I mean the numbers are higher
than 256 well a lot of URL parsing
libraries they do mod 256 so this is
actually an IP with an overflow this is
a numeric version of an IP address and
this is a numeric version of an IP
address with overflow this is a hex
version of an IP address hex with out
the dots hex will overflow octal IP
address an octal with overflow by the
way I stole all of this from a really
skilled guy Nikola Gregoire I have a
link to his PDF down there he's done a
lot of interesting stuff in the space
there's a really good talk from him that
you should look up where he's talking
about how he's used this to attack Yahoo
and all kinds of big companies which is
really interesting he has some really
cool ways of doing things but we were
we're not quite done with the the
blacklisting stuff yet
because we could add a DNS entry to our
sis to our own DNS and just point it to
localhost and something like this exists
already there's something called sip bio
so if we do 127.0.0.1 dot zip-tie oh
that's gonna resolve to a hundred and
twenty seven zero zero one you can also
do like a bit a little bit more
obfuscated stuff like this again it
resolves 227 series zero one and this is
like the base 36 of the number the IP
address and you can see it's kind of in
reverse order or we could do something
like this so W W Bank a no and then this
address and it will still resolve to the
same thing for a localhost weaker
so do just dot 0.000 because well that's
all the interfaces on the host or we
could do something like this because it
doesn't have to be serious everyone
that's just what we're normally using
and of course with ipv6 we get all kinds
of weird things going on as well so
again if we move to tracker one we see
one here from alienvault and this was if
you see what was what was happening all
the way down here you can see this is
the IP that I was talking about 169 to
540 169 to 5/4 and in this case they use
this hostname here method nicob dotnet
which is nicola Gregoire's own DNS
this is a kind of a nice way of
circumventing it it doesn't look like
it's gonna be resolved to something of
course they're protected against this we
have to always normalize the IP and and
resolve the IP and then look at the IP
address and to figure out whether we're
connecting to something we're supposed
to connect to or not all right
so this was a server side request
forgery the next thing is template
injection and this was kind of added to
the OWASP top 10 just as a single line
to the injection the a one but very few
people actually know what this is and it
can be quite dangerous so a template
could be something as easy as this so we
have a couple of HTML tags and we have
this these mustaches or curly braces and
then a variable name so what what some
of these templating systems are going to
do is something like this like there are
JavaScript things that does this exact
thing so they grab the stuff in the
middle and they do an evil and that to
figure out what's the value of this
thing so you might have JavaScript there
and that that might be perfectly okay
unless someone else can influence your
template but it's gonna is gonna try to
figure out what's the value of the stuff
that's going on in the middle there and
then put it all together and then there
you go so okay let's let's do another
example so in this case we have
and then the titlebar variable contains
hello and so the end result is an h1
with hello very basic stuff but then
we're going to build a bit more a
complex stuff so we're using an error
let's imagine that the dots there are
lots of lines of code in between so we
can't really see what's going on here
but we have two templates in this case
and the unfortunate thing that we're
doing here is we take one of those
templates and include them the result of
rendering that template in another
template because now we allow whatever
was in the title variable to influence
the template so a standard example would
be something let's say that the
variables contained title was hello and
body was world so in this case the first
one would be h1 hello and then we
include that in the second one and
nothing bad happens
but what if title was included curly
braces so would go in and what we would
get from the first rendition was h1 and
then we would actually get new curly
braces so we would try to create a new
template and influence template and then
we would put that in the second template
and now things start to go bad so once
again I really like demos so I'm going
to do a demo of this in this case we
have a simple server-side application
that's vulnerable to this so in this
case I I've put my name up here and if I
click send it's gonna send that in and
well in this case I've changed what the
windows means so at the top window now
means the rendered HTML and the lower
window is the source code of that HTML
so you can see I put my name in there it
ended up inside an h1 and a P for some
reason and then it says hello so that's
that's what we're actually seeing in the
browser so what happens if I changed my
name then to 2 x 3 like that I hope you
see it says hello 6 already down here so
I'm getting it's it's actually executed
what I wrote here and the the end result
a pair is hello 6 well that's kind of
boring like yeah I can do math but I can
do that with a calculator as well so
let's do something more fun okay
so we're gonna try instead of instead of
using two times
- we're gonna reference an object that
might exist see what happens okay now
we're getting somewhere I get a fatal
error and it says something about I
can't I can't convert this class to a
string and things are bad and I don't
like this but now we know that we have
template injection and we know we can
access infernal objects but that's not
fun either let's do something more so in
this case we're gonna do an attack on
something called twig
so what I'm doing here is I'm regular
registering a filter callback called
exec which executes stuff and then I'm
gonna get that filter and I'm gonna send
it ID so in this case it tells me well
okay this system is running as www
and IDs but I'm not done yet because I
want to properly attack this thing so
instead of this we're gonna go back to
the bash thing same thing that we did
for for the deserialization attack so
again we bring up our trusted console
we're still logged in to the other
server so we had to get out of that one
set up a new listener and hopefully yes
now we're once again back inside another
server this time we're not logged in as
root as you can see it says www dot and
we do that from the previous slide but
at least I have a shell on the server so
I could try to do previous from there or
something like that nasty stuff so this
was kind of server-side templating
section but it doesn't have to be
server-side so remember it says two
times three and then we got hello six
back what if I do it client-side so now
what now it returns two times three down
here but if we look at the result being
HTML that's being rendered it still says
six all right what's going on here well
the thing is now we're doing injection
but in a client-side templating
framework so in this case you can see
some of you might have gone sorry that
we have angular here and I have ng app
declared here so this thing runs inside
and this thing becomes a template hence
it tries to calculate this stuff and now
I'm thinking well I can attack this
because i can i can do alert 1 like
classic Exorcist cross site scripting
example but nothing happens because what
happens in a lot of these frameworks is
they have some kind of sandbox so both
on the the server-side templating
frameworks they have a sandbox sometimes
and also the client-side framework
sometimes i have a day of sandbox and an
angularjs in this version they did have
a sandbox which was later removed but at
least they did so this didn't work but
of course there are ways to break out of
sandbox in this case a bit of a weird
example but you can see it pops up an
alert box there and it pops up twice for
some reason so what i'm doing in this
case is i'm instead of invoking alert
one I'm gonna grab a string and I'm
gonna grab the constructor of the string
which is the string constructor and I'm
gonna grab the constructor of the string
constructor which is the function and
then I'm gonna create a new function
with alert 1 inside and then the end of
it I'm going to invoke this function so
I'm kind of I'm circumventing the the
sandbox this is a common exploit against
old versions of angular what's
interesting here that you can see is is
it did do some HTML escaping down here
but that didn't stop the thing from
working because this HTML escaping would
have stopped a regular across that
scripting but it doesn't stop it from
from because because of the templating
framework it's gonna see it as D encoded
and then it's gonna do its thing so this
works regardless the next thing is
insecure course and this is something
we've seen a lot of lately and much of
it is due to a guy called James kettle
who works at ports where they did a
really good presentation about this at
the OS tab sake you last year so we have
this
access control allow original what does
it actually do and to figure out what it
did
I asked Google Translate for help
so access control allow origin
example.com access control allow
credentials true well if I translate
this from HTTP to English it says if the
user is logged in and this is example
comm please allow that site to access
the users data all right
this is an actual actually Google
Translate of course but it would be nice
if it could do that the next thing is we
do access control allow origin star and
then allow credentials true which
translated means if the user is logged
in please allow any site anywhere on the
internet to access this data this is of
course not something we want and this is
not allowed so if we try to do this the
browser's will complain and say well you
can't have star and true that doesn't
work so please do not do this thing the
problem is the people find ways of
reintroducing this stuff so the first
one is the echo where people will do
they will grab the original header from
the incoming request and then they will
put that as the access control allow
region and then do access control allow
credentials true which mean basically
means the same as star because whatever
comes in you equate back and then you
reintroduce the problem a second version
could be poor validation so let's say we
have some code that looks like this so
we grab the origin and if it ends with
example.com we're gonna allow it which
means we allow not example.com of course
because we didn't have a dot in there
and there are all kinds of versions of
this where you have we have poor reg X
where dot actually means any need any
character it can be all kinds of stuff
and then this was this is a real example
by the way I'm gonna show you the the
right of it afterwards and the last one
is kind of odd it's no
access control allow origin no access
control allow credentials true what does
that even mean what does no mean let's
ask Google Translate once again if the
user is logged in please allow any site
the user visits to access the users data
as long as the site knows how to iframe
with the sandbox attribute that's the
gist of it so this is from from James
kettle if we do something like this we
create an iframe with the sandbox allow
scripts allow form and then we do the
the entire HTML document inside of it
that's gonna be in the iframe and in
there we do the actual x8 xhr or fetch
requests we see original that's what
we're sending so we're now in the nola
region and the nola region wasn't
actually intended to mean our distinct
origin for a in every case but in this
case it's it means any any it could mean
any site that exists anywhere which is
pretty bad because that means that if we
do a miss configuration of some kind and
we end up accidentally doing this maybe
it wasn't null maybe it was we had a
variable there but that variable was for
some reason not set so in in in in Java
for instance a string has the value null
if if we haven't said it so it would be
no and then that was that would be what
would be reflected back so there are
ways of where this can go wrong even
though we're not intentionally doing no
so I mentioned I mentioned james kettle
of quite a few times right now and this
is one of his write ups for hacker 1 in
this case for tomato and you can see the
stuff in blue there it would allow any
domain ending in tomato com including
not tomato com it's kind of exactly the
example I just showed so that's that's
not so good so access control allow
region or course that's a mechanism for
us to relax the same origin policy and
we need to be careful with what we're
doing with it
and not just blindly I or X
dentally allow stuff that we're not
supposed to allow the last one is
something called subdomain takeover this
is a pretty bad thing and it can happen
in many different ways but this was
there was a good really good write-up of
this from from a Swedish guy called once
was n at detective I and this is
something that that is it's new and I
don't think we can say well we could
probably claim that this is India was
done under a security Miss configuration
or something but it's this is one of the
the really new attacks that have have
started appearing in bug bounties that I
don't think we've seen much before if we
go back to X X X X II that's actually
quite an old bug it's the first versions
of ecstasy was back in 2002 there's been
one in a Norwegian guy called sputter
who's be he found an ecstasy in in
Acrobat Reader in 2005 so that's a
really old bug that kind of disappeared
for a while and then came back but I
think this is this is a rather new one
because it's it's kind of related to how
we're using cloud services so let's say
we're using a platform as a service
vendor for instance Heroku so we can
define an application running on Heroku
and we can customize the first part of
this so we can we can put our own name
there and by doing that we can we can
now have a kind of a custom domain name
but that's not good enough for us we we
want to have our own domain but at least
we we could do something like this same
thing goes for instance for for
infrastructure as a service type of
cloud services so for s3 buckets we
often can have our own name as a part of
the s3 bucket name also for a c3 you
have some IPS and stuff in there so but
I mean we have we have some name but we
don't like these names because we want
to have our own names so here are some
of the stuff that Detective I discovered
they've discovered over a hundred
services that are kind of vulnerable to
this thing including hiroko alias guitar
etc etc etc I think this has also been
used against typical male male systems
where you can send out a lot of emails
to your clients so let's try to explain
what what's going in it so so let's say
we create an application after okay and
we call it nd seed or taro craft table
and then we go into our DNS and we want
it to have the actual domain name of NDC
example.com because we don't like the
hero crap that come stuff we want to use
their own domain that's our brand so
what we do is we go to the DNS settings
and then we create a cname a canonical
name so we gonna point NDC example that
come to this NDC example come here okay
DNS comm thing so we actually instead of
instead of putting in IP there we're
gonna say well if you're gonna try to
resolve this domain name you're gonna go
to that domain name instead and ask that
because they and they know this stuff so
just on example let's say we do an
nslookup on embassy example comb and we
go to the rate registrar that's being
used and what we get back is NDC
example.com canonical name and then NDC
example.com dr. Aqua Net DNS calm so we
can see that okay this one points to
that one same thing this is an actual
DNS query so our browser if we try to
visit this site it's gonna it's gonna
look up first it's not actually going to
do it this way because it's gonna ask a
DNS server and that DNS service is gonna
do all the lookups but let's pretend
that this is what happens because it's
it kind of is so it goes to two let's
say n DC that hackable net dot network
and it's going going to DNS one dot hack
network because that's a DNS server and
it's gonna come back with well you
should actually go here instead okay so
we go to this DNS server instead let me
ask well can you give me the IP and then
we get back an actual IP and then we go
and visit our beautiful application
that's running on Heroku so these these
two lower servers are actually owned by
Heroku and the top one is our DNS server
now
have any of you ever deployed something
on a cloud service and then forgotten
about it do you think any company in the
world has ever forgotten about one of
their systems running there well
forgetting about it or forgetting about
one of these systems is not the worst
thing that can happen it could actually
be that we we kind of forget about the
system or we move removed the system
because well we don't really need the
system anymore so we're gonna go and
grab it and just throw it in a bin but
we forget to update the DNS so we remove
the application let's say we go into
Heroku and then delete this I don't need
this anymore but then we forget the DNS
setting so now the attacker he can go
back in and he can recreate the exact
same service the exact same name that we
had and the attacker now controls our
subdomain you get that that's pretty bad
like they could they now own a server
that has our domain name on it so what
can you do with that well they could do
fishing with a proper domain because
they now actually have some code running
on a server that has our domain name on
it so if they send out a phishing email
saying hey please login to our site go
to this URL and you look at the URL and
well it looks like it's legit so you go
there you enter your credentials and bam
they're stolen
you could steal or inject two main white
cookies so you could do session fixation
you could steal sessions you could do
all kinds of stuff you could do things
like let's say you have a self XSS which
means a cross-site scripting that you
could only you could only abuse this
cross-site scripting if you inject it
into the server because you can you can
kind of put a value in a cookie but then
and then it would be reflected and it
would be a cross-site scripting but you
because an attacker can't fool someone
else into injecting that cookie then
you're home free but in this case of
course if you own a subdomain all you
could do on that subdomain you could
inject such a cookie and then you could
change the self XSS to being an actual
exercise which is pretty bad of course
you could put all kinds of bad stuff on
there like defacement you could do
political messages adult material
name it malware all kinds of bad stuff
that might hurt the company if if it was
associated with it or you could go ahead
and create an HTTPS certificate so um
demos yes I love demos sorry sorry I
take the course yeah probably so the
question was if we could abuse course to
this and I guess we can so let's see I
have this service and I'm hoping the
internet will be my friend again because
it was a bit see here yes so there is
gonna try to stay still there is an
application running on this domain here
so what if I go to this domain and I do
this ah nothing there okay bring up my
trusted console oh I'm still logged into
the other server mm-hmm so let's clear
this I think I have it here if we do an
honest look up for embassy security day
one we see we get a lot of stuff back
but this one didn't resolve so let's try
mmm nothing happens nothing happens okay
maybe I lost my internet again sorry
about that
the thing is that this this this
hostname is now open for four attacks so
anyone could go in and register a system
that that would actually have that
hostname they just have to to to put up
a system there and then they they could
take it to take over my my domain and lo
and behold someone just did that sudden
reverb resolves okay what happened Oh
someone owned my system damn it and the
owner sits there by the way
so he no system because well he all he
had to do was go to lovely Marquis all
he had to do and deploy a app with the
exact same name and the exact same
custom domain name and now he owns my
site okay that's not so nice so it's
really easy and it's really fast as you
could see he he was sitting there right
now and he just took over my my my
subdomain here
so this is an example of this from once
again from hacker one this is a Swedish
guy Mattias Carlson he did a subdomain
taker for Shopify which paid him five
hundred dollars and in this case it was
an s3 bucket so you can see the you can
see the details down here he could he
could basically grab one of those those
buckets from them because they had at
the NS entry that pointed to them but
they no longer used them so and this is
an example one interesting example like
you have this thing which is the
certificate transparency log and where
all certificates that are ever created
by our legit CA they will have to
publish a log of what you're doing and
if you look at the in the center of the
screen here it says Sriman Gorsky has
hacked prod to do bruh calm SSL
certificate and I think this is because
he was able to grab one of Oprah's
subdomains and then he obviously used
some kind of CA hair started calm and
was able to then get a certificate
issued for this server and of course
when he owned this thing he could he
could add all kinds of stuff to it and
then he got some some certificates I'm
not sure if you were was so happy about
him doing it but anyway that's the way
it goes some resources here the first
one is disclosed h1 this is a Twitter
account that you really should follow
because they publish all all day these
hacker one reports that I just showed
you this this is a bot that just
publishes every time a new public report
is is is made available you can you can
go and read them and not all of them
have a very interesting amount of
details because a lot of them are
heavily redacted but there is a lot of
stuff there and there is a lot of good
stuff to learn these two next links why
so serial those are for serialization
attacks so those are tools for
attacking or they have gadgets in them
the gadgets for attacking different kind
of these realization frameworks the XX
LT for practical attacks that's where
you can find all these functions like
document and unforced text etc template
injection RCE for the modern web app you
can see once again if you look at the
end of the URL there is or at the first
line it says kettle so this is also
james kettle we just basically also a
guy you should follow his twitter handle
is albino wax and he is one of the guys
who works with port swagger which
creates Bert Swift which birds with
which is a common pen testing tool then
you have detective ice original blog
post as you can see it's it's not that
new it's one 2014 but we've seen a lot
of this happening in the bug bounty
space lately and then you have nicola
Gregoire's server-side browsing
considered harmful which is about server
side requests and then the course talk
from james kettle all the way to the
bottom and that's basically it
any questions nope everything is clear
so are you scared do you have to go back
and patch your stuff now no one all
right
if there are no questions I think we can
end it there so thanks a lot for coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>