<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Architecture in the Azure Cloud - Scott Hanselman | Coder Coacher - Coaching Coders</title><meta content="Architecture in the Azure Cloud - Scott Hanselman - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Architecture in the Azure Cloud - Scott Hanselman</b></h2><h5 class="post__date">2016-08-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/T5ZnqtXqJmA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now-ish no all right cool
you know how hard it was to get a
in this town it's not real coke I'm
diabetic but thank you for that painful
reminder of my lifelong disease
that's my brekkie right there yeah my
wife ready to move here by the way
everybody she's been around practicing
her accent and all she knows how to say
as wallaby so now we're having wallaby
for brekkie and it's just getting really
gross all right all right cool so my
name is Scott and check me out on the
Twitter and what I thought I would do in
this talk was to talk about how I think
about the cloud I'm gonna use Azure as
the example because of course Azure is
one of the clouds that I work on but the
stuff that I'm going to show you isn't
necessarily as your specific most all
clouds behave like this since there's a
reasonably small sized group if you
think that I'm talking about something
and you think it's crap or you disagree
or you think that the conversation
should go in another direction certainly
feel free to you know raise your hands
and we can talk about that because I
think that it's important this is one
person's perspective it's important to
also give a little bit of context I'm
not a Microsoft evangelist I've actually
never worked in evangelism I don't
necessarily even like that word
evangelism because it implies the
Crusades and and and like I'm walking
around like have you heard the news
about Azure have you heard the news have
you accepted Asher as your personal yeah
so I've always worked in in in
engineering but the problem is that I'm
just such an enthusiast I'm a
professional enthusiast that it often
gets it looks like marketing or it looks
like sales and that's not my intent so
the point I'm making is that I'm not
trying to sell you a sure I don't care
if you use Azure if you don't that just
means more Azure for me the other thing
that I want to point out is that
everything I'm going to show you and all
the different things that I've learned
are done running real Azure websites on
my with my money don't trust a Microsoft
person who is running with an account
that is free as err
this is really really important and I'm
serious about this I pay for all of my
Azure time with my own money and I
except for a couple of MSDN credits and
if you have MSDN you should hook up your
Hazzard and get some some credits and
the reason that's important is that if
you had unlimited Azure time you would
architect your as your sites differently
wouldn't you you'd make a large vm with
superfast disk and you leave it on
forever and you wouldn't think about it
but i have no money and i don't like
getting surprised and one time i left a
large sequel server VM on for a month
and it cost about twelve hundred bucks
and my wife was upset so I have a whole
series of my blog that's called
penny-pinching in the cloud where I talk
about specific techniques about how to
save as much money as you can with a err
this this had talked has had a couple of
titles that was one this is a good talk
title as well I think we can do that now
there's lots and lots of Azure diagrams
that express all these icons and all
these services and one of the things
that all clouds have a problem with
Amazon is even worse is that they have a
million different things that they could
potentially sell you and it's not clear
how they fit into the stack and each
thing has its own like exquisitely
designed icon and there's actually this
horrible slide that the hazard people
show sometimes that is just a wall of
icons and then they drew colored boxes
around it they go ash sure and it's like
I don't know which one of these I want
do I want as your bats do I want as your
compute don't want Azure this or Azure
that so I made a simpler boxes and lines
that expresses what I wanted to know and
the other stuff is just services and
services as a service that you can use
so the way that I think about a sure is
I go from the bottom up and I think
about storage first
I talked a little bit in the keynote
about this idea that it's more than just
lift and shift right in the old days you
would have a machine under your desk
that would run a bunch of VMs or it
would be a physical machine you would
make a VHD and you would then go to the
hosts and you'd say run this VM for me
my blog runs at a host
I like my host I don't they think
they're a cloud but that's adorable
they're not a cloud they're my host
right like they they change their name
to a cloud later but they're a great
host and I know that there's a physical
machine that I could visit does that
make sense so when I think of a
difference between a host or in a cloud
I could visit my machine if it's a host
er I could even roll a rack in if I had
a rack I could drive it over there and
plug it in I could more specifically
point to the hard drive that has my
stuff on it I could tell you that it's
either 5400 rpm or its 7200 rpm and I
have you know reliable disk access and I
know when it crashes and I also know
that I can remote desktop into that
machine so the one that runs my blog is
a VM that runs it a host with the cloud
whether it be a sure or Amazon storage
is this array of disks with this five
this virtual file system kind of layered
on top of it and the virtual machines
don't really have physical disks most of
them don't have physical disks attached
they have mapped disks disks over fiber
over this custom storage backplane that
are basically mapped to blobs of VHDs
that are sitting in the storage system
does that make sense and that completely
changes the characteristics of how these
things perform and it can be a little
bit confusing to folks one of the things
that I like to do is I like to go over
to computer manage the computer
management or disk management
I think it's disk management do you know
you can go to disk management in Windows
and you can say create VHD a lot of
people didn't even know that they think
of it as a hyper-v thing right a VHD is
a virtual hard disk that you can make
and you can you know pass around so you
can go and create a VHD and then you can
mount it and in fact I made one here
here's fancy dot V HD it is 25 Meg's
which is uh probably double the size it
needs to be in Australia because it's
going to take the whole talk to upload
but that's ok that's going to be the
talk by the way it's just me uploading
this VHD
and then declaring success so I'm gonna
double click on this and notice that it
immediately got allocated a volume
volume e and it's got a picture on it
okay it's a really good way to get files
up to Azure is that you know of course
you could have TP them up or you could
blob storage them up or you could put
them all into a VHD millions of files
and take the VHD upload that to blob
storage and then mount it there's a
really great article on troy Hunt's blog
about how he did that when he was doing
some of the the ingress of some of the
security data that got pwned the idea
being that if I'm gonna send you
millions of something or hundreds of
thousands of something that's gonna be a
lot of back-and-forth negotiation I
could just stick it all into a blob and
then mount it that's one thing to think
about now this particular image is from
a podcast that I did so that's the
podcast episode number 417 I've got this
podcast that I I'm trying to grow I feel
we're a little plateaued right now it's
a pretty good show and I've been doing
it for 538 episodes and when I put this
site up I recently maybe a year ago
changed the look and feel to even though
the new thing is called Hanselman it's
ID emphasized my face and tried to
emphasize the faces of the the people
who are on the show so I made this
archives page that is just filled with
these faces and it looked great and
everyone felt that the site was good but
then I noticed a few things people from
Australia started to complain about this
page any idea why lots of pictures 540
pictures in fact it's a lot of HTTP
requests okay and my web app here this
simple little web app ended up having
this new page that is a 9 megabyte page
right because it works great in Portland
alright it was naive design
I took a website that ran great at a
host and I threw it up into the cloud
and I figured it would be fine and this
machine runs in Chicago and I didn't
even think about it
so there's a couple of multi-leveled
things that I can do here I'm using a
thing called the azure storage Explorer
you can actually go to storage Explorer
comm this is free it's a really great
tool it's actually written an electron
as apparently everything is now and it
lets you go and connect to a j''r so I'm
going to go and click here to Hansol
minutes onto blob containers and images
okay and here are the images for the
shows for my podcast sitting up in Azure
storage now I show this to people when
I'm talking to like user groups i went
to the portland linux users group in the
average age of the people there was 65
they're always thinking at every
sentence so what right that's how that's
how old people work so what i was ft
peeing a long time ago you've done
nothing but reinvent ftp alright i point
out that with storage cloud storage s3
as your storage when you put a byte up
there that bytes being stored in three
different places right and if you do
like locally redundant or geo redundant
it can get multiple e redundant across
multiple places when i upload something
to my host via ftp those bytes go over
the wire and they sit on a platter and i
can visit that platter and i can kick it
and now those bytes are gone but with
Azure or with s3 that stuff gets spread
apart and you are supposedly guaranteed
that you can't hurt that right it's like
free raid in the cloud but it's even
more than that because if it were just
raid then it would be like well there's
two or three or five disks on a platter
in a particular place and if that place
burned down I'm still going to lose
those bits Asher is smart to load
balanced things not just apart from each
other in Geographic sense but they can
even keep machines away from each other
on different rows on different power on
different stamps within larger Azure
data centers so if part of the Azure
data center perhaps blew up you could be
rest assured that the software balancing
of the system is going to keep that in
another location so awareness of that is
important so I threw all of my
images up there and I thought that that
would be useful but then I realized that
this isn't really a web server it's just
storage I could put a couple of zip
files up there or torrents or whatever
and I could use Azure to serve those
things but what I really needed was a
CDN the CDN gets backed by Azure storage
so again think about this even though I
didn't put this CDN here it's just one
of those many icons it's gonna sit on
top of Azure storage so you put your
files and as your storage you go into
Azure and you check a box and you say I
want to see the end and it goes where is
it being pulled from and you say there
and now you've got to see the end so
that gets then copied again so you've
got your locally redundant storage of my
images and then I said I want to see the
end and now there's this an Australia
copy and a Southeast Asia copy and a
Japan copy etc etc it gets to be out in
the CDN and then it ends up showing up
in some kind of a crazy URL like now
here we go you know name of my storage
thing blob whore dot windows.net slash
whatever you've seen those before
you've even seen these URLs before from
Microsoft properties
I think that's sloppy because that
advertises the underlying stuff I don't
want to give free advertising for the
underlying stuff all right so what I
want is images dot Hansel minutes com
right and this is such an obvious thing
we've been talking about this for 20
years hey put your images on another on
another place hey use a custom cname
don't just use your own CDN brand your
CDN these operations in the cloud these
are 10 and 15 minute long things it
literally took me 15 minutes to go into
DNS simple which is where I post my DNS
and add a cname go back into Azure tell
it about the new name I waited for you
know an hour and then it was done and I
got that but you'll go to big
professional like you know Woolworths or
whatever and your view source and it's
just a mess of DNS lookups it's really
surprising how sloppy people are so
right now
this comes from the CDN so it's fast in
Australia but it's not always about the
cloud right it's not always about the
cloud do you need to load every image on
this page no exactly so you stick this
you do some client-side work let me
scroll really fast you see that what's
happening there
I only load the images that are in the
viewport so in fact I've got this great
rich page full of faces but we're in
this case only seeing the ones that
enter the viewport nothing to do with
the cloud but solved huge problems of
outgoing bandwidth because you get
charged on the outgoing bandwidth and
you don't get charged on the in on the
incoming so ingress is free address or
extra secret egress is expensive so I
was actually costing it was costing me
you know 15 bucks a month to serve this
page and then I added a little bit of
JavaScript you can go and view source
there and check it out and this suddenly
became a more responsive page it became
a page that was cheaper for me and that
would work better whether it was in the
cloud or whether it was hosted somewhere
else that makes sense it's just a little
bit of thought ahead of time that I'm
continually surprised that people don't
do now I could go and take this VHD
rather than dragging images one at a
time if I wanted to and I could go up to
azor and copy that into Azure storage
and then mount that VHD let's login to
the portal now the portal has been like
an ongoing bit of chaos
it sucks way less than it did last year
if you if you hated the azure portal and
I did believe me it's really it just
sucks less you know I mean I think it's
where did I put it I think it's over
here
the couple of things that they've done
that make me happy this is actually
written a knockout J
it's a big html5 application and Steve
Sanderson when the main architects on
this is here so if you can see him talk
check it out if you they add if you hit
a question mark
they added keyboard shortcuts like Gmail
so you like go to virtual machines and
things like that that makes life a lot
easier this dashboard here is entirely
configurable I can go and drag stuff
around I can resize things and just
recently they added multiple dashboards
so you can go and say show me cost and
then have dollar amounts for all the
different things or you know show me
bandwidth out or show me uptime you can
lay this out into any way you want so
we've actually been encouraging people
to set up like inexpensive 42 inch TVs
put them in the lobby of their place and
you come in and you see the dashboard
you can also show it to the boss and
then they can see you know server health
and all that kind of stuff all from here
they've also added of course fullscreen
and on my surface book here I'm doing
the little thing we stole from Mac which
is the four finger swipe to explore that
now let me go to storage so this is
scrolling left and right here so here's
my storage account okay we can see the
requests to the storage account as we've
been messing around and I'm gonna click
on files oops not files blobs pardon me
you can do file shares now like Windows
File shares so here I've got fancy dot
VHD and then I've got these other ones
here like see this my sequel data disc
these are different ones that I've named
and different ones that got made for me
I wanted to make a virtual machine and I
wanted it to host my sequel because I
was doing this newsletter and I didn't
know what I was doing I ended up making
two virtual machines because again I
didn't know I was
I made a Windows virtual machine and I
put my sequel on it and then I made a
Linux virtual machine and I put PHP on
it and it hosts this newsletter
application that I use and if I go over
to the virtual machines you can click
search now and find everything and go
straight to it which is a lot easier and
I can go straight to that virtual
machine or I can of course do this
action over here so this VM is windows
and I can click connect and it's going
to download RDP and automatically pop in
and I'm now going to remote into this my
sequel virtual machine when I put this
one together I did it very naively if I
go over to my computer I started out
with this default this you don't have to
see too close there but just there's
this C Drive and I created the VM and I
installed my sequel and I was like hey
this is cool and it was slow I was like
this sucks
Wow Azure sucks the cloud sucks and I
was ready to leave and and that's that's
a very common theme with the cloud but
then I read and this is the other thing
that I'm finding that people don't do
these days with the cloud right I mean
if you think about it aren't we
optimized for the first 10 minutes like
no matter what it is right you get a you
go to hacker news like show hacker news
I built a thing we worked on it for 6
months I couldn't get it working 10
minutes sucks it's crap
same thing with with with the cloud
right I mean there is the what they call
the pit of success where you want to be
able to fall into success but a little
bit of reading actually turns out he
solves a lot of problems I had my
database and my Windows stuff on the
same Drive on the C Drive and you have a
maximum number of I ops I think it's 500
on a small virtual machine so Windows
and the disk were on the endless
database we're fighting well then I went
in read the docs and it turns out that
you can have multiple disks for free
moreover the bigger the VM
the more disks you can have again for
free based on the size so a small gets
to the HDS and a medium gets four and
then eight and sixteen right so if you
remember in the in the keynote I was
talking about the problem where they
were spinning through all of those
Tiff's and going and OCR in them imagine
if you just said I'm just gonna make a
giant VM I'm gonna upload a whole bunch
of Tiff's and throw them in the temp
folder and I'm gonna for each over them
right you're gonna be limited to what
the disk can do but the same price not
changing any costs if I found that that
well that was a large VM and I could do
sixteen disks if I did the yellow yellow
pages style sharding right you know a
through L M through Z and then split it
up across sixteen disks and then ran
sixteen processes on each of those
different things I'm gonna get literally
sixteen times more perf doing it
asynchronously rather than doing it
synchronously and it wouldn't cost any
different but people will go and do the
first solution declare that the cloud
sucks and it's slow and then go off in
ignorance so this is what we're trying
to get people thinking about I'm sure
you already are thinking about this
you're a smart looking crowd but I want
you to take that message as an example
back to the folks at work that are
making that knee-jerk that sucks
kind of reaction and think about that
because sometimes it's just willful
ignorance or in my case it was just like
regular old ignorance what I ended up
doing was I made another disk my sequel
data again for free because it only
costs what it costs to store the disk
data
now again ignorant I made it five
gigabytes in size because I figured it
would never need to be any bigger but it
turns out that and also I don't want to
pay for the storage right because it's
like pennies a gigabyte it turns out
that it's charged on sparse storage so I
could have made it a hundred gigabytes
but if it was only using two or three I
would only pay for two or three so when
you go and say make new disk in Azure
you should just always make it as big as
possible there's no reason to make it
small unless you need to download it to
Australia
so then this thing gets fast suddenly
it's double the speed cost me no
additional money and gets double the
speed
I then remote into it and discover
there's another disc there's a 20 gig
disc here and it turns out that that
disc is physically attached to the thing
there's a scratch disk that's attached
to virtual machines that is a real
spinning rust disc that isn't storage
but it's temporary so then I change my
temp variables and things like that and
I throw it over onto there and then
things get faster again when I have
batch work that isn't durable batch work
I can do it on that disc and it's like
10x faster so that's simple realization
that AI can have multiple disks I can do
things in parallel which is a very
different way of thinking about it right
if this was a machine running under my
desk and I had a disc on it I'd think oh
it sucks it's slow get a faster disc the
obvious thing isn't makes sixteen discs
right it isn't run down to PC micro
Center by sixteen discs and to put them
in an array but it is literally that
easy to do that in Azure in a batch file
even more you could just theorize that
it might be faster an experiment and in
15-20 minutes answer the question is it
faster so this is my opinion scuse me
this in my opinion is the difference
between the host and the cloud right
with the host you would fax them a note
that says hey plug in 16 disks and let
me know if it might be faster but with
the cloud I can do an experiment hey
might it be faster with large or
extra-large I don't want to spend the
money well I'm only gonna use it for an
hour or two or five do it try crazy
stuff there's a virtual machine and win
in Azure that's called the Godzilla
machine that's all SSDs all local SSDs
and it's like three grand three thousand
dollars a month which sounds really
overwhelming but you just use it for an
hour to do your test and then you tear
it down so that just-in-time usage is
really really important that scratch
disk turned out to be very very useful
now this is that Windows VHD VM rather
I've got another one
which is this Linux one and they work
together and what I'm gonna do is bring
up bash anybody upgrade to anniversary
edition the dumbest name of Windows or
couldn't just call it 10.1 it's got bash
now so this is a boon too which is cool
and it has top which is nice and I'm
gonna go and I'm gonna ssh into that
machine which is my vm that's that
machine it's weird I'm running Windows
running Ubuntu SS aging into a boon to
running on Windows Azure so and then
running top so this is the machine that
is running up there and this particular
one is 2h top because it's prettier is
running one app for me now when I made
this app with this vm containers really
hadn't happened yet this was a couple
years ago so the whole docker kind of
craze hasn't happened yet but the idea
of a VM as a single tasking container is
still a valid one even if you don't want
to think about containers and by that I
mean you could make a large VM and fill
it full of applications and make it very
dense or you could make a bunch of tiny
VMs and put one application on them at a
time then you only have to deal with the
keeping them updated
alright the the like as I said before
apt-get update on the on the puppy this
applicate this is the smallest or the
extra small vm in Azure notice that the
memory is six hundred and seventy Meg's
and even this is too big the tiniest VM
in Azure is fine for my newsletter
application which means it might be fine
for your expense reporting app or
whatever but I sent out my newsletters
maybe every couple of months so then
this isn't enough for a day or two every
couple of months so I leave it like this
99 times out of 100 and then for a
couple of days I upgrade it to a medium
it does it
job and then I bring it back down does
that make sense
panty pinching in the clouds this cost
me seven bucks a month to run this now
the pricing calculators and stuff on a
jurors suck I mean it's just you know
you go into the slider bar and you say
well I think I need this much and it
looks expensive and then you leave and
then you never come back right but
people think about the amount of
headroom that they need on a VM or on a
web server the way that they used to
think about it I used to always keep the
CPU under 50% that's what we've been
told all through the 90s right it was
like oh it's 30 40 percents running
pretty hot something could happen and we
wouldn't be able to move fast enough we
wouldn't be able to get that machine up
fast enough I say you should be running
your VMs hot get him working if it's not
working what's the point you don't get
charged for 60% CPU differently than 30
or 90 if it's working it's working if
it's up it's working so in this case
this machine is doing nothing but it is
a single tasking machine it is an
extra-small it is the seven dollar you
know version of azor in the future I
would move all of these workloads into
Azure container service and have it
handled by docker and then I wouldn't
even have to think about logging in
occasionally but the point is I don't
think about Headroom as much I try to
run these things that maybe 80% CPU and
about 80% memory and if they go hotter
than that I scale them up that's how we
save money in the cloud that makes sense
one thing per VM so these are still
virtual machines and by the way again
all of this is configurable and that you
can you can even write right-click on
this particular thing so here's the CPU
percentage of this individual virtual
machine and I can then you know pin that
and layout this however I want to so
here's the CPU percentage I can go and
say edit and lay it out any way that I
want and it even they recently updated
it for giant monitors so you can go
vertically now and do 30 inch monitor
and these great dashboards so it's good
but that is still virtual machines which
have their place but some
times stressed me out a little bit by
weight how long does this talk go Joe
eleven and twenty eleven twenty tomorrow
all right so just another 23 hours
that'll be fine
let's go back to this slide this is why
I don't do virtual machines virtual
desktops cuz it's somewhere here there
is now there is this thing called worker
rolls and then what's called cloud
services but it's it's this thing that
is not quite websites or web apps and
it's not quite virtual machines if you
think about the problem of a virtual
machine it is maintenance once you go
file new it's your problem
but you want full control so how do you
find the balance between I want total
control but no responsibility right or
the the website which is I feel like I
don't have any control at all because I
can only do this one thing people
usually look at web sites or web apps
that are platform-as-a-service the
purple went up there and they say it's
far too constraining I have no control I
can't see what's underneath it
but I don't want the responsibility
virtual machine so they made this thing
called cloud services or worker roles
and the idea is what if you have a
virtual machine that is stateless that
can come and go without warning and you
have full control over it so when it
starts up they go and they and they
inject whatever code you want onto it
they run your setup scripts they get it
already
and they could have one or three or five
or whatever they automatically have them
come and go but you can't store any
local state on that C Drive because the
disk will just disappear all of your
work has to happen somewhere durable and
where is that durable place storage or
queues or whatever makes sense that was
really confusing to people because you
think about what we just said right it's
a commercial machine but just pretend it
has no disk and you can't ever put it
right anything to it and you have to go
and change all your code to not write to
the disk like it used to but to write
this weird as your SDK thing that you
don't understand so people kind of
reject it for those people who read the
docs they built giant things like the
Harry Potter Potter More system which
scales to you know hundreds of these
virtual machines and manages millions
and millions of of users things like
Halo you know like major big systems but
it is it is in this weird state for most
people I believe websites or web apps is
the way to go and the way to go because
you actually have more control than you
realize it's not just you know do it get
deploy and this thing shows up so let's
let's do it get deploy and see what's
underneath it though real quick so let's
go out here I never I might have liked
other say I already have another folder
called super fancy pants so that one's
empty
and I'll say dotnet new web ok so now
I've got a dotnet core web app here and
I'll type Asher which is the azure
command-line okay and I will say just a
point make the point as your site list
and that's gonna go and make a JSON call
the exact same restful call that the
dashboard makes we don't get to call any
secret API so that's really important
another cooler way to look at this is
you say as your site list - - Jason to
see the under the underneath see that so
that's all the other stuff that you
could potentially get so if you don't
like some aspect of it write your own
you know your own front-end so as your
site create super fancy-pants 3 - -
location I don't have access to
Australia East so I'll say Southeast
Asia - - get so getting sites to see if
someone else created super fan Spanish 3
they're not getting locations hopefully
that's the correct location creating a
new website at super fancy pants 3 - web
site
on that sending site information this
will probably take an hour
don't worry we'll be all right okay
initializing remote as your repository
giving user information a new remote
azor has been added to your repository
get remote show a sure
and internet right so there's a git
repository up in as you right now that's
empty that's waiting for me to do
something about it
okay so then I'll go get ad went get
commit hey get push as your master and
that's gonna start pushing that up I cuz
get is FTP for code so see what says
remote as you're doing that now while
this is happening I am going to switch
over it's building in the cloud now I'm
going to switch back over to here and
we're going to go to app services and we
called it fancy-pants you see how this
is subtle but you see how there's
different things that are going on in
here where it's automatically scrolling
correctly a lot of the annoyances of the
azure portal have gone away because they
know what you want to keep in the portal
I'm spending a lot of less time moving
around you saw how I was able to get
exactly where I wanted to go very
quickly
I hit app services I type fancy I
clicked on it I was there okay I could
have done it with a keyboard as well now
I'm gonna go and say tools log stream
are they gonna turn those on for me
application log this usually gets turned
on automatically if you turn them on
diagnostics log settings you can
actually go and see a bunch of stuff
inside of here this is super fancy pants
3 that's automatically uploading that
will turn on in a second what I wanted
to show you is that these things that
are happening here can be said that is
part of the log spew you see it says
remote : it's not happening on my local
machine the remote is doing it so in a
minute when log when log streaming turns
on on the other side I can go and and
see that now notice here I'm restoring
packages D : home I don't have a D drive
right that's the D Drive that's
happening up there so they're using a
thing called kudu which kudu kayuu
d you and this is an open-source tool
that you can run as well there are
people who have taken it off of github
and they run it internally it's the
thing that it listens as a get
repository and the other end collects
all of your stuff builds your code runs
a deployment script and then puts it
into iis that's what kudu is that cool
so this would this kind of style of
deployment was popularized the number of
years ago by Heroku right and now
everyone does this so I have a git
repository locally
I added my stuff to it I pushed it up to
the remote here it's automatically look
see see : DW a s files site's
fancy-pants three app data it's going
and it's running new get up there and we
also are doing mirrors of nougat and NPM
such that we don't have to go all the
way out to those sites and we'll go and
grab them locally we're also working on
making this faster notice that there was
some work happening on D D home site etc
and then there was some work happening
on C we can change those deployment
scripts and you can - you can totally
write your own deployment script to
optimize these deployments for speed
this one is not currently optimized for
speed but if you watch the asp.net
community stand up we discovered that
and started working on it and we've gone
and in between doubled and tripled the
speed of this by making sure that the
new get packages that are coming down
and then the compiles that are happening
are happening on disks that are local
rather than in storage that makes sense
because we're on real hard drives we're
doing platform as a service but we're
there is a V there is a VM there you
just can't see it what I'm trying to
show you is that you in fact can see it
there's hints there's a moment there
where it said C and there's a moment
there where it said D so I can go back
over to while it's still doing that to
here and let's see if the log streaming
is going to work I can turn it on later
but I want to see it yeah it's still
turned off I can click console now I'm
inside of Chrome here okay there's no
nothing tricky but look I'm in crawl
on D and I just did a dir so I know that
there's a VMware out there somewhere
that is handling super fancy pants for
me and it's D home site ww root and
hosting start you know when you visit an
azure page and it shows you that blue
thing that says this site has not yet
been created that's the file now you
don't need to like revel in that or
anything but just that moment where it's
like oh well there would have to be a
file on a disk somewhere to do that it
just makes me happy when it's like oh
that's how it works you know
it's like when I watched that that video
on YouTube that shows you how a
limited-slip differential works in a car
and you go huh and then you just forget
it for the rest of your life but there's
a moment there where you feel comforted
I feel comforted when I see stuff like
this because I realized that like a sure
isn't this crazy foreign thing that I
don't understand it's like oh there is
AI is oh it is Windows oh there is a D
Drive now I'm hitting dir notice how
this is empty right what's going on why
is it empty it's empty because this work
here is happening in a separate place
because it wouldn't make any sense for
us to do all that build in place and
production because Kudo is going to get
it already and all perfect and then it's
going to swap and those files are going
to instantly show up some of the other
things that as your web sites can do
that is really significant is doing slew
that C so there's my tol s deployment
successful so now I can go and say as
your site browse which will launch the
browser cuz I can't remember what the
URL was it launches edge but you can't
win them all so that's hitting that
particular website as your website's
dotnet the very first time it'll do a
little compilation of the razor pages
plus I think there you go and now
there's my deployment so yeah so other
than the fact that it took three or four
minutes which is too long I mean I would
like it to take 90 seconds but we know
why right we know why I can go back over
to
here and I can poke around at the
console and I can do stuff and I can
even run get right like this is HTML but
it's it's a reminder that this is a real
computer and I can really do stuff with
it see where my why my log stuff isn't
turned on diagnostic blog said I'm gonna
I'm gonna take a moment of your time and
experiment here this turned on yesterday
application logs are switched off you
could turn on diagnostic law settings
okay these are all the different kind of
settings you can set here's another
example of people doing stuff without
thinking I say we need 64 bit gotta get
64 bit remember the thing we talked
about a minute ago about density right
64 bit for little applications it does
nothing huge waste of time
additionally that slider bar right that
Azure slider bar that helps you with
pricing that's very confusing looks like
this as your pricing calculator
sometimes I just visit it because it
just it's just so bad they've changed it
now web and mobile app service view
estimate here we go this is better so
number of instances 55 bucks a month and
I go that's too expensive and then I
leave right but they've also got this
one called shared that they don't
advertise for nine bucks a month and
suddenly things got better right when
you are figuring out how to do things in
the cloud well and cheaply and densely
you got to think to yourself about what
do they offer for 10 bucks you get a gig
of storage and a half gig of ram but you
get a shared core which means you don't
get a dedicated CPU right you share your
TP with others so what can you do with
that you have minimal CPU but you have a
lot of RAM you can cache a bunch of
stuff so my podcast websites when I used
to go to the database on every page call
it would exhaust the CPU and then it
would get shut down for five minutes and
as you would say no you know you're
you're not important you're not on the
super premium plan we're going
pause you for a while you know you've
seen that when you go to an azure page
and it's like this one's really you know
hit its quota but then I just cashed
everything in memory because it's a
balance like what is the resource that
they are giving you and how can you
architect your app to save you money
okay so I cast everything in that half
gig of ram and things got better that
one so that one is nine bucks a month
but then you go up to basic and what
they don't do in my opinion here is tell
you do they bury it in here yeah this
sucks so that means that you have one
core ten gigs of storage it means a
dedicated processor and almost two gigs
of ram what they don't tell you is that
you can run as many websites as you can
fit in there I've got 19 websites that
are running in one standard I'm not
going to pay fifty five bucks a website
but as soon as I figure out that an app
service what it is again you have to
read the docs there's this thing on an
app service plan and then you can go and
add these websites into these plans and
then if you go into a standard which is
what I ultimately ended up doing within
standard there are other subgroups so
for seventy-five bucks I can have one
two cores four cores but you get ssl and
etcetera etc etc so I basically run
everything except my blog all of my
properties in one standard that makes
sense then I just have to go and keep
track of the memory usage and make sure
that things are you know working out
okay so if I go back here and show you
my actual sites these are all different
sites you see here it says West us West
you know default server farm all of
those are in the exact same place let's
look at this one here this is in
resource group West US default servers
Farm standards small ok look at this I'm
keeping my memory at 60% CP
you is very low none of these sites do
much right these are small cache sites
for me I didn't want to be going to the
disk all the time so a little bit of
code that would go in cache like with
the podcast do I need to go to the
database every page call no I just put
in simple caching code that said go to
the database every four hours and that's
that's freshness was four hours even
freshness checks of five minutes you
have to ask ourselves you know what is
real-time I used to work at a DVD
reseller and we they would insist it has
to be real-time your inventory has to be
real-time it doesn't really you know
five minutes is real time ten minutes is
real time that's that's real time enough
and doing that can completely change the
scaling characteristics of your
application so here I can go down and
say scale up the app service plan and
then go and say you know medium or
whatever or I can go and scale out and
that's where you get your web forms this
is cool because now I can go and do it
manually or automatically I can Auto
scale so if suddenly someone gets you
know I don't know I don't get slashed
dotted anymore what do we get reddit it
or we get hacker news writer Scott
Guthrie tweets you or something I
haven't got that set on because I'm only
at sixty percent but the other fear is
that you're gonna wake up the next
morning and it's going to cost you a
thousand bucks that's the other fear but
but as er so in this case here if I got
reddit it or slashed on it or whatever
the site would either become
unresponsive or would go away and then I
would get an email I can actually show
you some of the emails that say your CPU
has been over 80 percent for the last
five minutes or whatever you can set
those alerts up yourself so you can be
alerted if it's gonna be a problem or
it'll automatically scale but then you
can max out where it scales you can say
well I only want to max it out at two
instances and no more and I don't want
to pay for anything more than that
so with this Kudo thing let me show you
a trick we had that page was at super
fancy-pants 3 . as your website's net
correct
there it is I'm gonna go and change that
URL and I'm gonna say dot SCM source
control management I'm just guessing
we'll say that that's what it means it's
gonna try to log me in and now look I'm
at this magic hidden page
I like web apps websites because I know
that there's a VM but I never have to
remote into it I never have to run it
updates but I still have power
okay and when I got here I realized
exactly how much power I had every as
your website has this sidecar website
you have this site and you two may not
even know it you can click on process
Explorer check this out there's the
website there there's the sidecar above
it and there's dotnet running my dotnet
core application I can then go and say
properties find out exactly where it is
on disk I can see how much memory it's
using I can download a memory dump from
production right and you're like I don't
want to use Web Apps I don't get any
control go here to modules see the exact
versions of what got loaded into memory
in case there's any concern the exact
versions of the dll's
this is entity framework coming from a
particular location I can confirm that
it is in fact the RTM or the released
version of that if in case I was maybe
concerned that there was an older one
okay but this is the best part because
it's the cloud you see where it says
rest API I'm gonna click on processes
now this looks like crap so let's go and
turn on JSON view and then hit refresh
this is a restful api I'm hitting slash
API slash processes slash the pid' right
the process ID okay
and let's look at the dotnet one that's
live I just made a RESTful API call to
see that dotnet process I can see the
states of each individual thread within
that process and debug that stuff that
cool so think about this from a
validation perspective you could write
code that could go and assert your
assumptions of your websites that would
then go and say make sure that
everything got updated to such-and-such
a version or that that DLL is correct or
are you still seeing problems with that
thread being stalled etc etc you can do
that programmatically you don't always
need to remote into a machine to have a
great deal of power with it these are
just process REST API s but you can go
farther to see individual deployments
you can confirm the sha hashes of those
deployments and there's also an oh crap
button my son's here so I wouldn't say
there's the you know the oh they've made
a mistake button so like if an evil
person went and did a deployment you can
just hit that button and swap the
deployment back additionally because
we've paid for that basic or the
standard app service I can have sidecar
sites like super fancy pants dev staging
production testing I can have slots
deployment slots and we can go over into
the azure portal set up the duty to do
where to go we can go and make those
those deployment slots we can do all of
that programmatically if I want to and
then we can actually do a/b testing in
production so you could basically say I
want you to do 10 percent of the traffic
to staging 90 percent to production and
then over time ramp that traffic up and
then if it looks bad or an error occurs
bring it back down now this is really
significant if you think about it from
us
small business persons perspective
because again in the 90s there were
people whose whole jobs whose entire
companies were to do what we now think
of as being simplistic a/b testing and
ramping of traffic between staging and
production and now one person can do it
with a slider bar in the cloud now again
you could do this with VMs but I just
want you to understand that it's more
than just get deploy it's more than just
not thinking about web apps it's about
all of these things as a service that
you could do so last last demo this
hasn't even actually on the on the list
but I want to show you this because if
it works it's kind of a neat a neat demo
this is my my iPhone let me see if I've
got this this app that I want to show
you one second it'll be worth it
don't leave yet almost done talking to
myself it's all good
oh the internet here is so good I'm
gonna go ahead and get off the internet
here and go and spend my data plan my
valuable data plan on you people know
the App Store it's a piece of crap
hang on yeah there it is see if this
works
okay so my buddy and I made a startup
called my echo because we have iPhones
and we like our iPhones a lot and Siri
is really good at dictation right in
Cortana doesn't do dictation yet so we
wanted to make it so you could talk to
your iPhone and have the text show up
here now if I click hub my echo app comm
it's gonna say North Central probably
because I'm VPN into work but I've also
got Southeast Asia and in Europe so
that's why it's saying north to Central
some of you will hit that and you'll
probably depending on what network
you're connected to see differently I'm
gonna hit try it online this is the only
valid reason to use a cue
code and I just scanned it with my
iPhone here see if this is going to work
your connection was lost do I have a
data plan this is embarrassing
good lord the internet here you guys let
me try this again trying another Wi-Fi
network
so basically , I just talked to my
iPhone and make sure to use punctuation
period
it's hashtag awesome period so this is
me and another individual
we made the app with C sharp and xamarin
we send the stuff up to Azure but we
have servers in three different regions
we have a backplane which is the azure
service bus if you go to hub my echo app
you see our internal debug thing that's
using Azure Traffic Manager that
automatically picks the fastest location
based on what it knows about your
machine and in my case because I'm VPN
din to Redmond it picked
North Central again you'll get Southeast
Asia if I'm in Japan I'll get Japan and
that effort was minimal when I went to
Japan to demonstrate this it took me a
half an hour beforehand to fire up the
Japanese arm of our startup which is me
and this guy from Brooklyn it was really
really easy so if you think about the
layers of abstraction that we're dealing
with in the cloud the idea that two
people could have a little startup to go
and do something like this and and and
have it just work and have it work
globally and look like a real company is
really significant and if it gets
popular like for example we got written
up in a German newspaper and we started
seeing errors and I used this tool
called ray gun here use ray gun IO
absolutely brilliant they're out of New
Zealand they're fantastic and ray gun
started sending me notifications about
exceptions that it was getting I login
and I scaled the site up now we have the
site set to auto scale and then when we
were popular in Germany we had two
instances over there and then we scale
it back down and that in Azure is
handling it all so I think that's pretty
cool
comma that's my demonstration of the
cloud comma let's do some Q&amp;amp;A question
mark
thank you so we are down to no time at
all but we got David here it's got the
microphone if you have any questions you
want to have any thoughts or anything
was that useful with that okay tell me
that was okay okay now I feel better now
I can sleep at night yeah you know no
questions at all you just gonna sit
there and think about it and Stroke your
beards thoughtfully yeah all right thank
you all very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>