<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ASP.NET Core for Angular, React, and Knockout developers - Steve Sanderson | Coder Coacher - Coaching Coders</title><meta content="ASP.NET Core for Angular, React, and Knockout developers - Steve Sanderson - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ASP.NET Core for Angular, React, and Knockout developers - Steve Sanderson</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9sxfV67zCDE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright then well I think we're just
about coming up to the time that I can
legitimately start so let's do that yeah
it's really nice to see you all here
thank you for coming to this talk oh
it's always a pleasure to be here at NBC
Osler's definitely one of my favorite
conferences it's a special treat to see
your happy shiny faces all smiling down
from the steeply inclined slopes it's
great and so yeah so what's going to
have this be about them so my name is
Steve and I work at Microsoft I'm on the
asp net team and i do a bunch of
different things there i did spend about
half my time just working on the regular
traditional server side parts of asp net
but I also spend about half my time
working on trying to make the platform
as good as it can be support for people
building client-side applications so
whether you're doing stuff with angular
react knockout view or really or
wherever it else is that you like
hopefully we can make the framework as
good as it can possibly be for you now I
think that that will probably be were
relevant to a good proportion of you you
probably wouldn't be in this talk if you
didn't think that was relevant to you
but I just want to get a quick sense how
many of you are already using some kind
of single page application framework in
your day-to-day work Oh like vast
majority okay great and and I assume
that your user name is peanut core as
well otherwise you wouldn't be here is
that right hands up if you are or just a
SP nut in general yeah that's like the
other half of the people okay good that
makes sense all right so I can
understand why you're here then so let's
talk a little bit about that I'll tell
you about what the status is presently
and then we'll spend most of the talk
going through some demos of some cool
stuff that we've got to make your
development lives better okay so we've
got a SP net core developers and when we
talk to them they basically always say
to us at least about half of them or in
this room it's like 98% yeah we're using
your product we're also using these
other client-side frameworks as well and
generally people like them people are
generally positive about whichever one
of these sorts of frameworks they have
chosen to work with that they also say
to us but you know there's a lot of
other stuff you have to know as well
it's not enough just to know the
client-side framework but there's other
things you have to know for example you
need
you know about various different
language options you know there's all
these different versions of JavaScript
going around now ES 2016 and 2017 the
typescript which you know adds a whole
extra level of concept on top of normal
JavaScript so you need to know all that
stuff and then there are other concepts
as well like you need to know about
different styling technologies whether
you're using sass or less or something
else which is going to compile to CSS
and then there's more in order to
actually do that compilation you need
some sort of build tool in order to
build your client-side code it's not
enough just to ask script tags and links
to style sheets and stuff anymore
no no we have to make it more clever
than that now so we've got all these
different build technologies and most
people are probably using webpack by now
then maybe some of you still using grunt
or gulp they're quite different I'll be
talking about web packing some detail in
this talk giving you some idea about how
exactly it's different if you're not
sure but there's more than that as well
there are various different client-side
architectures that are getting a lot of
adoption now and you may never have even
heard of some of these I hadn't heard of
mob X until fairly recently and these
are a whole other level of things to
know about and if you don't know about
those just don't worry about it I'm not
going to talk about it particularly in
this talk but you know those things are
there as well and then finally there's
various different testing technologies
so when you think about what it takes to
actually make a project with all this
stuff it's an enormous piece of work
even just getting started
you could spend weeks trying to put
together something that actually links
all these things together in a working
way so what people tell us is can you
make that easier please and how can we
actually improve on that what can we do
to make that easier for you well a thing
that we've been working on for a little
while and we'll be rolling out in an
even bigger way soon is providing a
really clean out-of-the-box experience
for you if you're trying to build an
application with these kinds of
technologies so we want to make a nice
prepackaged environment that allows you
to create new projects with all that
stuff ready to go for you and we've been
shipping these things for a little while
now you might have seen that originally
we shipped some project templates on
yeoman and then about six months ago we
started moving these templates over to
net new which is the command line based
way of creating new asp net projects
and finally please to be able to say
that we're going to roll this stuff into
the core product as far as asp net core
2.0 is concerned so with etiquette or if
you're using Visual Studio as soon as
you go to file new project this stuff is
just going to be right there and ready
for good to go for you without having to
install anything special so that's good
for a lot of people but there will be
some among you who say well that's nice
but I don't really want to use your
project templates I want to do some
crazy advanced thing all on my own
and that's fine too so for you people
we're making sure that all of the
technologies that we're using to
construct these fancy project templates
are available in the form of packages
we've got net packages on NuGet we've
got NPM packages so JavaScript packages
on NPM and you can use those as part of
your own projects even if you're not
using our templates to do some fancy
stuff but what fancy stuff well that's
what this talk is about so let me tell
you what we're going to do in this talk
the idea is to split the time that we've
got into three parts and in the first
part we'll talk about building a single
page application with all these
technologies we'll have a strong focus
on the project templates and the
functionality that they make available
to you out of the box then we'll move on
and we'll look at web pack a little bit
because that's really central to a lot
of the functionality that I'll be
showing you and although some of you may
know one pack well a lot of you will
probably not really know how it works
internally and what it's actually doing
and how you can configure it and I want
to make sure that it doesn't seem scary
to you and that you can understand what
it's actually doing and how you can use
it to benefit yourselves and your
projects and then finally we'll get
really deep down into the underlying
technologies and we'll talk about some
of the more advanced stuff you can do
that's totally separate from these sort
of standard project templates okay so
for the part of the talk we'll look at
building single page applications
there's a bunch of different features
that I want to show you and probably the
obvious place to start well would be
with with getting started so we'll start
by creating a new project with ASP net
core and angular or reactor that sort of
thing now like I just said this is being
rolled into the core product at the
moment so when you get the next version
of SP net core even if you get the next
preview version of it you'll find when
you go to create a new project
if you're in visual studio that you've
got some useful new options that pop up
there so you can just choose that and
and you're off and away if you're on a
spinet call 1.0 you do not have those
options and so you will need to go to
the command line to do that or of course
if you're working on Mac or Linux and
you're not using Visual Studio then
you'll need to go to the command line as
well so let me show you how we can
create these projects on the command
line so the first thing you need to do
is you need to install the template
packages if you're in dotnet core one
one if you're onto oh then they're
already installed for you but let's say
you don't have them installed so the way
you can do that is you can say dotnet
new now that's the way to create a new
project but we can also install extra
templates by pressing this install flag
to it and then we can give it the name
of the package we want to install and in
this case I'm using Microsoft pasting at
course spar templates and then I've got
this really bizarre thing on the end : :
star which is totally crazy syntax to
mean get me the latest version of that
template okay so you would run that and
it will install the templates for you
and once you've done that if you run
dotnet new again you'll see there are
some new options in the list so that's
just added these extra options we've now
got the option to create projects with
angular or really a knockout react react
redux and view so you can use any one of
those let's have a go at using the
angular one so let's do I'll make a new
directory called my Super app and I'll
then I'll go into that and now I can run
dotnet new angular and that will set up
a basic project template sorters with a
bunch of nice features in there and so
that's laid out a whole load of files
it's quite difficult to make sense off
in the command prompt so I'm going to
switch over to visual studio at this
point where it's a little bit easier to
show you the project structure okay so
what's in there let's have a look so if
you are familiar with regular Espina MVC
coding you will be familiar with a bunch
of these things so we've got the
dub-dub-dub root directory which is
where you can serve static content from
we've got other familiar stuff like
controllers and views and we've got the
program and startup files that you would
get in a regular MVC application the bit
that's really different though is that
we've also got this client app folder
and inside there we've got loads of
stuff to do with the angular applique
I'll show you that in a second but let's
just start running this application so
you can see what it looks like and what
sort of a structure it creates for you
so that's going to start that
application up and when that comes up we
will see that it looks a bit different
to a normal file new SP net core project
because it's using this bootstrap based
layout and it's designed more for sort
of dashboard or control panel type
scenarios but of course you can change
it in any way you want you can change
the layout completely the styling you
can take out bootstrap completely do
whatever you want but you know this is a
useful starting point for most of the
types of application that people would
build with these technologies so what is
in here well there's a few examples
firstly we've got routing setup so you
can do basic client-side navigation
there that's using the angular router to
change pages there and we've got a
couple of example components there is
this very simple counter example that
just counts how many times you click the
button and then we've got this fetch
data example that gives you a sample of
how you can make a call to your API
back-end get some data and render it
into the UI but how does that look in
terms of code well let's have a look at
an example I'm going to open the counter
example you just saw me clicking that
button so here's the implementation for
that firstly notice that it's a type
script class so all of these templates
are built with typescript which
obviously has many benefits like giving
you strong typing and such and the way
it works in this case is we import the
angular core library or a particular bit
of it that we need here and then we're
telling angular that this typescript
class should be understood as a
component that it can render and it's
got a bit of behavior like it's got this
count value which starts off as 0 and
increments when we call this method and
we're associating it with this HTML
template file and if we look at that you
will see that it uses angular view
syntax to display the current count
property and we've got a button that
when you click it it's going to
increment this counter okay so pretty
straightforward stuff and that's how
that works but we are not limited to
just making angular applications we can
also make applications with various
other client-side technologies so I just
want to quickly show you the react redux
applique
raishin anyone using react here
currently smallish number like 5% of
people of you people with your hands
just up how many be using Redux almost
all of you okay so Redux is is very
common and popular among react
developers it's an application
architecture it's a way of structuring
the way that data is stored the way that
state is managed in your application
it's often called a state management
library I'll give you a quick indication
of how that works but I won't really
have time for a full tutorial let me
just start up this angular so this react
Redux application and I'll give you a
quick look at what the code looks like
in there and when that pops up you'll
see that it looks almost identical to
the angular one so we're trying to give
a fairly consistent starting point there
it's got the same examples in our same
counter type thing and if you want to
see the code for that let's have a look
at that it's quite different because
it's a very different architecture so
we've got a class again another
typescript class this time it's a react
component and all it's responsible for
is rendering this bit of the UI doesn't
contain any behavior besides rendering
and it's got it displays the current
count value and it's got a button that
when you click it it's going to raise an
action called increment this is where
Redux comes into a Redux manages the
state of the application and how that
state changes over time and it stores
those states in things called stores if
we have a look at the store for the
counter data you can see it's storing
this count property which is a number
and you can ignore all the other code
because it's all just boring boilerplate
the only bit that's really relevant to
us is what happens when one of these
increment actions occurs we change the
count to one more than it was before so
that's how the Redux stories updating
its internal state and then the counter
property will rear end so the counter
component will rerender and the UI will
update
but don't worry about if you're
unfamiliar with redux it's not really
central to this talk ok so that gives
you an indication of how we can get
started with just creating file new
projects but what's the point of that
what benefits do we get from using these
particular templates as opposed to if
you just set this up on your own well
there's quite a number of non-trivial
bits of functionality in there that are
designed to make your development
experience
more fun more productive and generally
make you happy in all possible ways that
software camp so let's see the first one
of those features which is a feature
called hot module replacement and we get
this from webpack which I'll talk about
in more detail later but let me just
show you the hot module replacement
feature so what that feature does is it
gives you a very quick way of seeing how
your changes to the code effects your
application so it saves you a lot of
time basically these applications are
all written with typescript and normally
typescript has to be compiled and after
it's compiled you would have to reload
your page in order to see your changes
and that's all boring boring work that
just interferes with your happy flow
state and prevents you from getting on
with your job so wouldn't it be nice if
you didn't have to do any of that if you
just changed your code on your
application was just updated immediately
without even having to reload the page
so that's what the hot module
replacement feature does and I can show
you that very quickly by just making a
change to the application code so you
can see we've got this counter there
right now if I come in here and I change
this to let's say super counter then
let's just move out of full screen mode
and I'm going to press the Save button
now and when I do press that Save button
we should see in the browser that it
updates immediately I didn't have to
switch back to the browser or reload the
page and the best thing about it is it
haven't even lost the application state
you're still you see we're still got
this current count property of three and
I can just carry on working with my
application even though I'm changing the
code so it's not just the markup I can
change I can also change any aspect of
the application I could change for
example this so that instead of
displaying the count normally will
display the count times two so when I
press save on that we should see that it
changes from four to eight now okay
that's good or I could even implement
some entirely new functionality while my
application is running so let's say I
want to have a decrement button as well
okay that should be pretty easy I'm just
going to copy this line for the
increment button there I'll change the
text line to decrement okay and then if
I change the method that it calls to
decrement then when I go back to my
browser I should be able to now make the
count go down as well so I can modify
the application and add and remove
functionality while it's running and it
updates very quickly without me having
to
compiled anything and even works okay if
you make a mistake
for example if I go in here and I try to
call a message that doesn't even exist
like this then what's going to happen in
the browser is it's going to say oh you
just made a mistake there I can't find
name blah okay so you can come back to
your code and you can just fix your
application code there save it again and
then hopefully the browser will pop back
to life and our application will be back
there and it's still running and it
hasn't even lost the state that it had
and this ties in really well with redux
if you're using redux one of the cool
benefits of it is that it tracks all the
different states that your application
progresses through and so let me show
you a cool sort of debugging thing that
you can do with that let's say that I've
got a user who starts off here on the
home page and then they move to the
counter page and let's say they move
back and then they move back again
because they're just really indecisive
and then eventually they start clicking
on these buttons up and down and up and
so on because I've used Redux
it's tracked all the different states
that my application has been in so if I
use the Redux debugging tool I can see a
list of all these different states that
it's moved through and I can even use
this timeline to move backwards and
forwards through time to replay all the
events that have taken place so I can
replay all the different states that the
application has moved through and this
is retained even if I actually change my
application logic so let's say that
we've just realized there's a bug you
shouldn't be allowed to move the counter
past five but I look I've already moved
it to eight so that's a bug I shouldn't
be allowed to do that so what I'm going
to do is I'm going to change my
application code I'm going to say okay
if the count property is less than or
equal to five then I'm going to display
that otherwise I'm gonna display this
message stop clicking now okay
so when I hit save on that we'll see
back in the browser it's going to change
to say stop clicking now because the
user has already clicked too many times
but we can even replay how it would have
behaved if they were in different states
I can go back in time and see what the
application would have done with the
same set of user actions but with
respect to my new code so I can check
that I've effectively fixed this
you know I fix it in a really bizarre
and dumb way but you can see that the
changes I've made have taken effect and
we've still got this whole history that
the user has been through so that is
pretty cool and not something that you
would have normally been able to do but
that feature comes to us courtesy of web
packs hot module replacement and redux
ok so that's good
now next features I want to show you pre
rendering this is quite a technically
advanced feature but it's a again it's a
pretty cool feature and I hope you'll
find a good use for this sort of thing
now the best way to understand this
feature I think is to see what happens
if you don't have it so what I'm going
to do to demonstrate this to you is
remove the pre rendering from my
application show you what problems can
occur and then how they get solved by
adding pre-rendering back in so let's go
back to full screen here and I'm going
to switch back to the angular
application for this demo just so that
we can keep moving then show you all the
different applications so let's close
this one ok so when that comes up you'll
see my applications here and it's
behaving kind of normally but now but
I've already got the pre-rendering
feature turned on by default I want to
turn it off so I'm going to go to the
razor page that hosts my application and
I'm going to remove this tag helper now
I'll put it back in a minute and explain
what it does but let's just pretend that
you never had that and you've never even
seen it ok and I'm going to reload my
page and see how it behaves so it
behaves perfectly normally it comes up
and it works great but every time I hit
reload can you see up in the top left
I've got this word loading and that last
saw how long like half a second or 1
second or something like that and what's
happening during that time is that the
browser is fetching all the JavaScript
from the server
it's pausing it all it's executing it
all it's building the initial Dom
structure it's setting that as the
current down and finally is painting it
all to the screen so it's doing a lot of
stuff and it's taking about I don't know
three quarters of a second or something
now you might think 3/4 of a second is
ok it's not too long for your
application to spend loading and people
can afford to wait that long but in the
real world it's probably going to take a
lot longer because this is a very
artificial demo I've got a fairly fast
laptop here and I've got an insanely
fast connection to the server because
it's actually running on localhost
so that's not very reflective of
real-world conditions if we want to see
what it's really going to be like for
our end users let's simulate a slower
Network so I'm going to simulate let's
say a 3G network because we want mobile
users to be able to access this and of
course mobile devices generally have
slower CPUs as well so I'm going to
throttle that down by a factor of 10 to
represent a fairly mid-range mobile
device and we'll see how long it takes
for the application to come up now sign
from a blank page I'm going to start
loading the application now and we'll
see how long it takes well we've got the
word loading that's good that's a start
but we're still waiting the browser's
fetching the JavaScript is it might have
finished fetching it now it might have
started passing game I started executing
it I don't know but the end user is
probably all finally it's there okay so
if your end user could be bothered to
wait that long then didn't just click
back they've finally got to your
application but it took a long time and
of course in the real world it might be
even worse still you know not all
networks or as fast as 3G and not all
devices are as fast as whatever I just
simulated and in fact there are even
worse scenarios that could occur okay
the absolute worst thing that we can
imagine the nightmare that keeps us all
awake at night what happens if they
didn't even have working javascript in
their browser what's going to happen
then well let's see what the user
experience is like now so I'm going to
hit reload and what am I going to get
well I'm going to get the word loading
and that's all I'm going to get it's
just going to stay on screen forever so
it's lying to the user and it's just not
a great not an optimal user experience I
think we can probably agree but you know
what you expect it's a JavaScript
application it's written an angular of
course it requires JavaScript to yawn in
the browser you can't expect it to work
otherwise can you well that's this is
where it's useful to introduce
server-side pre-rendering let me turn
that on okay so I'm putting this tag
helper back now and this is saying
everything that I would like you to pre
render this JavaScript module here this
mock JavaScript module called main -
server and that is something that has
been compiled using webpack and that
contains all the code needed to execute
the angular application and this
is that we can now execute the angular
application on the server to produce the
pages of initial HTML we can send that
initial HTML down to the browser just
like a normal traditional server
rendered application and it can display
immediately without having to fetch any
JavaScript and then it can load the
JavaScript in the background and then
the client-side applications can take
over so let's just check that works now
I've still got JavaScript completely
disabled in my browser but I hit reload
and what happens my application shows up
so I still get to use my angular
application even though I don't have
JavaScript in my browser all kind of
anyway it's not really designed to work
without JavaScript all together because
many things are not actually going to
work for example if I click on this
increment button nothing is going to
happen because that's just wired up to
some angular code which obviously can't
run right now in fact the only thing
that can work is basic loading the page
and navigating but anyway that's not the
point the point of it is not to work
when javascript is disabled the point of
it is to make the page initial UI come
up much much faster because we don't
have to wait for fetching the JavaScript
or for pausing or executing it at all so
the normal scenario that this is
designed for is the page comes up very
quickly the client-side code then loads
in the background and then that takes
over execution of the page and it
becomes interactive and if you're
wondering how long that actually takes
or how long it takes to do that initial
rendering of the HTML let's load that
and we'll see and we'll see in this
specific example it's taken 49
milliseconds there to render the initial
page on the server and if you compare
that with how long it might have taken
otherwise for the browser to fetch that
JavaScript and execute it and everything
like that the initial view I might not
have come up for five or ten seconds but
we've been able to render it there in 50
milliseconds which is quite an
improvement I think you will agree ok so
that is the server-side pre-rendering
feature next thing on our list is
deployment now I'm not actually going to
demonstrate deployment to you because
it's way too boring but I just want you
to know that we do have a feature here
and the feature is making a nice compact
to production build so at the moment if
we have a look if I do a reload you'll
see this application is currently 1.4
megabytes
that we're sending down to the browser
which seems like a lot but it's
okay because that's just a development
build that contains all the unmanifest
maps and stuff so yeah it's going to be
massive but you don't want to serve that
to the end-user in production and that's
a feature that's built into the
templates when you do an actual publish
of your application will produce a much
more compact minified build for you as
you would want okay so that's that out
of the way next thing on the list a
little bit more interesting debugging
now we always love debugging writes one
of our favorite activities we'd spend
all day doing it if we could and
definitely we want it to be the nice
nicest experience that we can now how
can you debug an application like this
well it's written inside script but of
course in order to execute it needs to
be converted into JavaScript so does
that mean that we have to debug the
JavaScript code no because as I'm sure
you've probably heard there's this thing
called source maps that allows browsers
to show the original source code rather
than the compiled code in order for you
to do your debugging and just to show
you that that's all set up and working
if I go in here let's say I want to
debug my counter code I can do a control
oh and I'll search for the counter
component the type script and because
the source maps are already set up for
us we can see the original typescript
code there even though the browser
itself doesn't understand it and we can
do things like set breakpoints on that
and I can click on it and the breakpoint
will here and I can inspect my
application state and everything and you
get a fairly reasonable and satisfactory
debugging experience as much as
debugging over can be satisfactory but
that's not all sometimes people say to
us well you know that's all very well
but I don't write my code in the browser
I write my code in the IDE and I would
like to do my debugging in the idea as
well thank you can I do that now
normally that would be quite difficult
because your IDE is not the thing that's
actually running the code but it is a
thing that Visual Studio can do we can
communicate with chrome and negotiate
all the source map stuff or with other
browsers as well edge presumably I don't
know anyway if we actually want to make
this work we don't have to do anything
clever because it is already set up by
default so if I just set a breakpoint on
there and I hear f5 then what's going to
happen is it's going to pop up a debug
instance of our application it's going
to set up the connection between visual
studio and chrome there and when
this comes up it's going to do all the
stuff with the source maps to negotiate
between these two different
representations of the application and
so now if I come in here and I click on
this increment button we should see in
visual studio that the breakpoint is
here and again I can inspect the state
of my application and carry on with that
so that just works out of the box and is
all very nice so let's stop that and we
can say that we've seen no comeback we
can say that we've seen debugging all
right last thing on our list now writing
tests how many people write automated
tests for the actual UI in the browser
code next to nobody okay fine now I know
that there are good reasons for writing
tests for your code in the browser
sometimes and they're also good reasons
for not doing it sometimes the
cost-benefit analysis is not conclusive
one way or another whether or not it's a
good idea to do depends on your exact
nature of your business and how
important is and how fast you need to
write your code and so on but for people
who do want to write tests we've got
that set up out of the box for you so
let me show you how that could work now
as an example we'll use this counter
again and inside the project template
there's an example specification for the
counter counter component spec yes and
if we look in there you will see that
this is set up to work with the testing
framework called karma now karma is the
most popular of the automated testing
systems for angular and that's what
we're using here that allows us to run
our code in a real browser and make
assertions about what is actually
happening over UI level rather than at a
pure unit testing level so we've got
some code here that says before we run
any tests we're going to create an
instance of this counter component and
then we've got a couple of
specifications we're going to say
firstly it's supposed to display a title
which is an h1 element with a certain
bit of text inside it and then we're
also saying that the actual count
element has got certain behavior so we
will get a reference to that strong
element that displays the count
we'll say its initial value should be 0
and then when we click on the button
here wait for angular to do its stuff to
up day and then we should be able to see
that the actual text in the browser
changed to one supposed to run that so
we can see it working I can do that on
the command line so I'll go to my
angular application and I'm going to run
MPM test which is configured to start
karma so karma is going to start up and
what karma does is it creates a real
instance of an actual web browser you
can configure which browsers browser
users you can have it connected to
multiple browsers simultaneously if you
want to test across multiple types of
browser and what it does is it uses a
WebSocket connection to send your tests
into the browser and get the results
back out very quickly and we can see on
this occasion its executed those two
tests and the birth past that's great
but another cool thing that karna does
which is built like the web pack hot
module reloading feature is that it
watches for changes to your source code
and when they happen is going to rerun
your tests immediately and that allows
you to work in a sort of test-driven way
if you want to so let me give you an
example of that let's add some new
functionality to our application and
we'll drive that by writing some tests
first so I'm going to keep the karma
window down there at the bottom so we
can keep an eye on what it's doing and
I'm going to go back into visual studio
and I'm going to write a little bit of
extra code now what functionality can we
add well probably the simplest and most
obvious thing that we could add would be
a decrement button to go next to the
increment one you'll remember that I
implemented decrement for the Redux
application at the start of the talk but
I haven't done it for the angular one
yet let's do that but first we're going
to write a test to specify how that
should work now like all good developers
we're going to write our test by copying
an existing test pasting it and then
modifying the behavior okay so let's
just put a header test decrement okay
now we don't have a decrement button
yeah but that's quite a variable for it
and we'll say we'll look for a button
that's got a CSS class of deck on it and
then that decrement button we're going
to try and click it and then we'll wait
for angular to do all its stuff to
update and then we should check that the
text value has gone back down from one
to zero okay makes sense I'll hit save
and then karma will jump to life and it
will say I've run all your tests for you
oh by the way one of them is now failing
that's bad isn't it and you'll think
okay why is that failing
how can I possibly have done something
wrong let's have a look cannot lead
property click of No okay we are trying
to click a button that does not exist so
it's quite reasonable that that didn't
work let's add that button I'm going to
go into my view here I'm going to go and
copy and paste again and I will change
the CSS class there to Dec and I'll
change the texted decrement and I'll
make that call a method called decrement
counter sounds like that should work
right let's try it I'll hit save and web
pack says no it still does not work you
have not done your job right what have I
done wrong this time decrement counter
is not a function oh yeah that does make
sense because I haven't implemented this
decrement count function yet so let's do
that get more copy paste we'll change
that to decrement counter and we'll do
current count - - I'll hit save again
and this time yes finally we are
successfully implemented this excellent
bit of functionality ok so we can even
see in fact that the hot module
reloading thing has been working in the
background if we go back to the browser
I don't even have to reload the page but
my decrement feature is already there
and working for me and we knew it was
going to work right because we do it in
a test right and tests don't lie ok so
we have checked that application works
we've built a nice little single page
application and we've walked through a
whole buttload of the different features
that are going to give you a good
experience as a developer but along the
way I've repeatedly been referring to
web pack as having done quite a lot of
the magic floors behind the scenes but
what is web pack more hands please who's
using webpack that's okay that's good
that's at least a third of you that's
well up from what I'm used to okay web
pack continues to gain ground and in
fact web pack is probably if you look
across the whole industry easily the
dominant front-end build system now you
may have used other things like grunt or
gold in the past it is not like those
people often get this misconception that
web pack is just yet another thing like
grunt or gulp but it's not it's
different and I'm going to explain why
okay and to understand how it's
different we need to start looking at
how you configure web pack and what it
actually does and at first if you
haven't seen this before you might find
it a little bit over
mingori intimidating but don't worry
you're not expected to understand
everything firstly I just want to show
you a couple of key things that are
going to give you some insight into what
this thing is actually doing okay so
here's my web pack config that we get
out of the box with this Templar and
it's kind of scary at first because its
massive it's 71 lines long and you'll
think one earth is all that stuff doing
well the only thing that you need to
know right now are three things okay the
first thing is that we've got an entry
point the entry point tells the webpack
Impaler where to start building the
application and in this case is starting
by building a file called boot client
type script and that is the entry point
to my whole application now the second
thing you have to understand is that
we've got a list of rules and rules tell
webpack how to process each different
type of file and so we've got rules for
different types of files like typescript
HTML CSS and for each one of those and
configuring a loader I'll explain what a
loader is in a minute so we got an entry
point we've got rules and the third
thing is that we've got plugins
I've got plugins for various different
things for example doesn't matter what
we've got okay we've got various plugins
but it's not important what they are
okay now what is that doing
what are those three things actually
doing to build our application okay let
me talk you through what my PAC does is
it starts with your entry point is fine
flat files which in this particular
example was a typescript file now web
pag does not know about typescript
natively doesn't know about any type of
file natively pretty much so for each
type of file you have to have a rule to
say what am I going to do when I see a
file with that particular filename
extension and you configure which type
of loader it's going to use you'll
install each of the different loaders
that you want to use and that gives
typescript the ability so web pack the
ability to work with that type of file
and a loader does two main things
firstly the obvious thing it tells web
Pyke how to compile that type of file to
produce javascript or whatever other
type of resulting files you want to be
so a typescript loader is obviously
going to work by calling the typescript
compiler to produce JavaScript so that's
one of the things it does
the other important thing it does is it
tells a web pack how to find the
relationships with other files so in the
case of ties
you've probably got a reference to
another type script file because you
have imported some other file and that
other file probably imports some other
files still and the loader tells webpack
how to explore that chain of
dependencies now thyme script can also
refer to other types of files you can
refer to a JavaScript file and that
JavaScript file might even be inside an
NPM module and that's how we're
consuming all the different third-party
libraries here for example angular ships
is a set of NPM modules and our
typescript files contain references to
JavaScript files inside those modules
and then web pack is going to use the
JavaScript loader to discover the
dependencies on other JavaScript files
which might be in the same npm module
there might be in a different NPM module
it doesn't matter
but web pack is going to explore that
chain of dependencies and so you can see
from this the web pack is not just
processing all the files in a directory
but rather it's understanding the actual
relationships between your files and
it's not just code as well you might not
have expected it but you can have a
reference from a typescript file to an
HTML file and that is the sort of thing
that you're doing if you've got an
angular component which has a template
file which is itself HTML and the
typescript loader or the one for angular
is going to discover the dependency on
that HTML file and then what pack will
use the HTML load that you've configured
to discover the defenses on other types
of files as well maybe you've got a
reference to a CSS file which it can
load through the CSS loader which might
reference more CSS files which might in
turn reference some image files and
there are various different ways you can
configure web pack to process images
okay next and so far you can even go
crazy and have references to completely
custom types of files that you've
invented yourself as long as you would
promote your own loader for it and you
tell web pack you give it some code that
actually builds the compilation and you
also give it some code that returns the
dependencies on other files for example
to some typescript file you can do
whatever you want
so that explains how web pack is able to
discover all the files that are actually
being used by your application and the
loaders will tell it how to convert
those into what at the output format
should be such as JavaScript but there's
more to it than that because as I showed
you there are also plugins now after web
pack is built up this big dependency
graph in its memory that tells it how
your
application is bill it's going to pass
that through all of your plugins and
your plugins can do whatever they want
to it for example you might have a
minification plug-in that says anything
that gets compiled to JavaScript I can
take that JavaScript and then I can
minify it and that's how you can be able
to minify your typescript code even
though typescript doesn't know about
minification and minification doesn't
know about typescript it doesn't matter
you just get all these things working
together and then after all the plugins
have run webpack can actually just write
out the resulting files to disk and you
can control how that works you can
control what the file names are going to
be whether everything goes in one file
whether stuff gets split out over
different files or whatever it's
entirely up to you to configure that in
whatever way you want so as you can see
web pack is a very powerful and
sophisticated system and you can use
that to take whatever set of input files
are in your application and produce
whatever sort of output structure you
want with a fairly deep understanding of
how the relationships between the
different files works that under mine
under doesn't under my underpins various
features that web pack itself has for
example the hot module replacement it
knows when a certain target file changes
what are the things that might affect
and therefore what needs to be
re-injected into the page so got lots of
powerful benefits like that okay now now
that you know that hopefully it won't be
completely insane to imagine that you
could extend that web pie config to
configure it to do other things as well
so let me give you an example of adding
the ability to compile an additional
type of file in our application that's
not currently supported okay so the
scenario here is you've implemented this
application you're quite proud of
yourself because you know is a pretty
impressive application and you've
delivered this amazing new piece of
functionality called counter which you
think your customers are absolutely
going to go wild over and you're going
to make tons of money out of this and
you present it to your board of
directors and you say look at this
awesome thing isn't this going to be
great we should do a massive ad campaign
it's going to be awesome and they look
at it and they say that is a really
great feature we definitely like that we
want to ship it but we don't really like
the visual design it doesn't look very
good it's not very snazzy so we're going
to hire this incredibly expensive
designer and they're going to come up
with this astonishing design that's
going to make everyone love the
counter feature even more than they
otherwise would have done so you get
this designer hired and they say yeah
I've made this amazing design and I'm
going to send you a SAS file and you
think SAS yeah I've heard of that it's
some size that that styling thing is no
it compiles to CSS or something I'm not
sure about that but okay they're going
to send me this SAFF thing and I need to
somehow make it get compiled as part of
my build system so how can I make SAS
work in my application I don't know
let's start by just seeing what happens
if we've got a SAS file in the first
place okay so I'm going to add a sub
file to my application I'm going to do
add new item visual studio probably our
special spot for SAS or something I
don't know I'm not bothered I'm just
going to create a new text file called
Styles dot SAS okay and I'm going to put
a design in here now I did hire a very
expensive designer and they came up with
this design so they said that we should
have this variable called Michael and
the value should be red and then the
design is every single thing should be
my color okay so that's the design okay
now let's see if we can actually make
that work in our application I'm going
to save that and I want to somehow make
that apply to the counter component so
I'm going to go to my typescript code
here and if you know angular then you
will know that the way to add styles is
to use this style URLs property
style URLs and I can give an array of
different style files that should be
applied to this component so in this
case I want to apply styles dot SAS okay
not that that's the mistyping and that
would not work well okay so let's try
that now I'm going to hit save and then
I'm going to quickly switch back to the
browser and we will see what happens
okay it does not work why does it not
work because web pack has no idea what
this SAS thing is and it says you may
need an appropriate loader to handle
this file type okay fine all right so I
need to configure a SAS loader for web
pack how do we do that okay well in the
real world what we do is we go to Google
and we type in web access and what
Google tells us is you need to configure
the SAS loader in your web pack config
and it's very simple it's one line well
firstly
have to actually install the saucer and
you do that using NPM so you say npm
install SAS loader like that and then
you run that but I've already done that
so then you go back to your code and
you're going to your configuration here
that's not the config this is the config
and then you say okay I want to do
something similar to the CSS file so
it's copy and paste map
but for SAS files so when we see SAS
what we going to do well we're going to
use the SAS loader so let's put that
onto our list of loaders SAS loader okay
but we also still need these other
loaders because SAS is only responsible
for converting sass syntax into CSS
that's all it does don't do anything
else so we still need to have the CSS
loader which is going to tell webpack
had to understand the result in CSS how
to detect its references to other files
and so on and then finally we've got
this like weird thing called tostring
loader and that is specific to an
angular application because angular
components want you to give the style to
them in the form of a big string not a
file on disk but a string and that's
what the two string loader is going to
do for us so hopefully if I restart my
application now to make it pick up the
updated web package the when it comes up
hopefully will not get the error that we
had before but rather we will we do get
an error did I not save that let's try
that again not sure what I did ref but
let's just restart out hopefully this
time when it comes up it will not give
me the error but will rather do
something sensible with the actual SAS
file ok so my application is here and if
I go on to counter you should see that
my amazing new design has taken effect
and SAS is actually working there now
the cool thing about working with
webpack is all these different features
are independent of each other and they
all work together so if I for example go
and change my sass file let's say I'll
change this color here from red to green
and I'll hit save then what we should
see is that immediately updates in the
browser so again
SAS doesn't know anything about hot
module replacement but all these
different parts of web pack just work
together so I can make changes to my
code and it's all just going to flow
through immediately and we have a nice
development experience but you can't
read that so let's change that
okay great so that is how we could
extend our build system by writing a bit
of custom web pack config and I hope
that wasn't looking like it was a
completely insane thing to do okay now
last part of the talk and this is people
who really want to do something a bit
more advanced if you want to get really
deep down into the engine of how this
stuff is working then let me tell you
about what's actually going on behind
the scenes here because there's been
quite a bit of stuff here that I haven't
really explained for example we've been
running angular and react code on the
server which is a bit odd in there
because that's JavaScript code how can
we run that JavaScript in the middle of
a dotnet application and whether or not
you can guess this it is a fact they're
also all of the web pack stuff is
JavaScript as well web pack is written
in Java scripts and all the loaders are
written in JavaScript but we've been
running those on the server as well how
could we possibly be running JavaScript
on the server in a dotnet application
well the way that it works is that we've
got a couple of new get packages that
make this possible for you
so these applications a reference again
you get package called spar services and
that contains some logic for doing some
stuff that's generally useful for all
different types of single page
applications that you built for example
there's a general purpose implementation
of pre-rendering there's the ability to
do funky stuff to interact with web pack
which I've been using and various demos
so far there's also a feature that makes
client-side routing configurations work
with your server-side routing I didn't
demonstrate that because it's way too
boring but it's there and it's just good
to know that's in there okay but I still
doesn't explain how this stuff actually
works well internally when this stuff
wants to execute JavaScript code on the
server it users yet another new game
package which is a more low-level
package which just provides the service
of being able to execute JavaScript on
the server and as for how it actually
does that well you can guess on the name
it uses an instance of node J s so in
the background is creating an invisible
instance of node J s and it's got a very
fast remote procedure call
implementation that can send invitations
into node and get results out very
quickly very robustly and it deals with
all kinds of dull things that you don't
want to deal with yourself like process
lifetime management and what happened
different no process crashes and we have
to recover it and all that stuff you
don't have to think about that stuff you
just use the node services package and
then you can run JavaScript on the
server in your net environment now a
couple of things about that one is why
are we using node and we're not using
some other type of JavaScript runtime
like why don't we just have a standalone
instance of v8 or chakra core or
whatever well the answer is the a great
proportion of the third-party codes that
you want to use we'll assume that it's
running inside a node environment it's
just not going to work to you if you
don't have a real learned environment so
that's why we've done it like that
and the other thing that many of you are
probably thinking is why do I want to
run JavaScript on my server I've got
c-sharp are you somehow saying that
c-sharp is inadequate like why can't I
just write all my code and that well I'm
not saying that there's anything wrong
with writing a whole application of
c-sharp obviously but there are very
often cases where you will want to use
third-party code which is written in
JavaScript so obviously if you want to
use angular on the server well that's
JavaScript you're probably not going to
implement your own C shot version of
angular and in fact more broadly there's
the entire new package manager ecosystem
so NPM is the largest collection of open
source packages that exists anywhere and
everything that you can ever think of
doing exists as 15 different NPM modules
that's hard to pick between but when you
do pick between them and want to use it
in your application that's what this
allows you to do so let me give you an
example of how we can use an arbitrary
third-party NPM library in the middle of
an Espeon application to do a cool thing
that would otherwise be quite tricky to
do okay so let me give you a final demo
of that and for this final demo I'm
going to switch over to a different
application so let's go to my node
services example a startup project and
run that now this is not a single page
application not around with angular or
react or anything like that just a
regular boring goal server-side they've
seen our MVC application it's the same
thing that you get when you do a family
project the only thing that I've changed
about there is I've modified this about
page to put in this little request that
we've had from the marketing department
that for whatever reason we're supposed
to add a picture of some
in Oslo here now that doesn't sound very
difficult does it we're all very
experienced competent high end web
developers so we can add images to pages
I think we can manage that
so let's have a go at doing that we'll
go into our about page and we'll see
this is where they put that note for us
now we want to add an image and now
firstly we need to have an image of
something in Oslo here now I've already
got one so let me just show you that if
I go in here and look at my images
you'll see a picture of this building
just up the road from here it's quite
nice you having been leaded and I sort
of cafe in there it's all very lovely go
and visit and I want to put that picture
into this web page now like I said we
are very experienced skilled and
high-end web developers so we know how
to add images to pages we can do an
image tag okay good now does that
actually work let's see I'll come back
to the page and I'll hit reload and
we'll see if we get our other picture
and hmm that does not look right that's
a big blue rectangle so what's going on
there well if I scroll around a little
there you will be able to see what's
going on that image is somewhat too big
to fit in there
so how can we fix this well a couple of
ways the most basic ways we could just
put a width attribute and then we'll say
we'll have the browser resize that down
to be 300 pixels wide that works but
it's not a very good solution because
we're still sending a massive image to
the browser and if we look how big that
is you will see that this is a 7.9
megabyte file that is not what we want
to be sending on every single page
requests we want to resize that so how
can we resize this image well one day
one way that we could do it is we could
fire at paint.net or Photoshop or
whatever and just resize the image but
that is boring like I said we are
skilled high-end web developers so we're
going to do some dynamic server-side
image resizing just to show how you know
worthy of our salary we are so I'm going
to change the way this works instead of
referencing this file on disk I'm going
to reference a controller I mean a
reference a controller called
resize controller which I haven't
implemented yet and then I'm going to
pass it a parameter of how they go on
this image to be give it any number I
like there so 250 okay now if I reload
initially that's not going to work
because like I said I don't even have
this controller yet so the server is
just returning a 404 error as you will
see if I
here HTTP 404 that's an error okay so
let's implement some code that
dynamically resizes this image I want to
do that by creating this resize image
controller to cut an empty file there
right now I need to put some actual
behavior in there so first I'm going to
drop in a bit of code that finds the
file on disk that we want to resize and
a little bit of stuff here so let's just
walk through it step by step on this
line here we're telling MVC that we want
it to respond to all requests to start
with resize slash something and we're
going to capture the rest of the URL as
a parameter called image path and then
we're also going to accept another
parameter which could come from the
query string which will be the width I'm
giving a default value but you can
override it by passing a query string
and then the next thing is we want to
actually find the file on disk if it
exists so I'm using the web root file to
provider and that's a very easy and safe
way of locating files that are inside
the dub-dub-dub directory so I'm saying
let's find the file that corresponds to
that parameter that we've been given if
it doesn't exist we'll just return a 404
but if it does exist I'm going to return
this message we don't really want to
return a message we actually want to
return an image but we're just building
this up step by step for now so let's
see if that actually works firstly I'll
go back over there and I'll hit reload
and then in stone the 404 this time
we'll get the message that says yeah
that does actually exist as a file on
disk so now we can think about resizing
it now doing image manipulation in
dotnet core used to be difficult to
impossible it's not too bad now because
there's a couple of pretty good open
source image manipulation libraries for
dotnet core and as you might have heard
the whole system dot drawing API set
will be coming to Darnell core soon as
well so we can do this in dotnet but the
point of this is for me to show you that
we can bring in arbitrary third-party
NPM modules and use them to do
interesting things within our
application so I want to make a curl a
call from here into some JavaScript code
and I'm going to do that by getting from
the dependency injection services
provider thing an instance of inode
services node service says okay and when
I've got that I can use that to make
calls from my dotnet code into
JavaScript so I can say
known services that invoke async and
then just start telling it what I want
to invoke so to get started I want to do
this I'm going to say mode services I
would like you to asynchronously invoke
some code that's in this file resize
image guess and I'm going to pass to you
the physical path of the file to resize
and also the width and I expect you to
return a string to me and you're going
to do that asynchronously so I have to
await that and since this is an async
method I need to mark this as async to
make the compiler happy and then I also
need to say that it's going to return a
task to represent that so that's just a
bit of basic MVC coding there so now if
I run that it will try and make a code
into JavaScript does it actually work
like C the answer is no it does not work
because this file that we're trying to
call resize meas does not exist can't
find module okay so we better create
that file so I'm going to add a new file
add new item JavaScript file and it's
going to cut the call resize image j/s
ok and now I can put some arbitrary
JavaScript India and just to get us
started
let's return a hello world message from
this file here I'm exporting this module
exporting this function which takes a
callback and all I'm going to do is
create this message string here and then
I'm going to use the callback to send
that message back to SP nap MVC and I'm
saving no errors you've just got a
message and it's this string so if we
come back here and reload again then
this time it should find the file on
disk and now we're invoking the
JavaScript code directly from the middle
of our MVC action and I can hit reload
and it's going to update and do what you
expect it to do okay that's good
so now we can write R which we
JavaScript in there and since this
JavaScript runs in a real node
environment we can even pull in
arbitrary NPM modules for example I can
do some image resizing using a
third-party library called sharp sharp
is a pretty popular library in node
world it's very fast it's very robust
and it allows you to do lots of
interesting image manipulation stuff and
it's got a quite a nice API as well
what I'm doing with it in this
particular case as I'm saying okay sharp
I want you to load the image that's at
this physical path resize it to the
maximum to this width that I'm passing
in here as max width and then I want to
type the resulting data back as a binary
stream into dotnet so I don't have to
save it to disk I can just send a binary
stream back into by ASP map part of my
application and then back in the dotnet
side I can say well we're not getting a
string anymore we're now getting a
stream and we want to return that stream
to the browser so I need to use this
file result and I'll send that result
stream and I need to also tell the
browser what the binary data represents
and in this case it's an image JPEG okay
so finally if I come over here and I hit
reload then instead of that message it
should actually call sharp and it should
do the image resizing it took a moment
to come up the first time but I think
reload you'll see it just happens
basically instantly because this is it's
fast okay so that did in fact resize the
image and if I go back over here and I
hit reload then we should see that
instead of the 404 thing we now actually
get our image and to prove that it
really is smaller than before in case
you don't believe me we'll just have a
look and you'll see it's dropped down by
a factor of a thousand which is rather a
good improvement on our page weight okay
so what was the point of that well my
point is not particularly to say that
you should be using sharp to do image
resizing or anything like that my point
is just to say that you can without too
much friction bring in arbitrary
third-party mbm NPM modules and use them
in the middle of your application if
you've got any reason to do that and
that is a thing that underpins many of
your other cool things that I've shown
you such as being able to use angular
and react on the server so that is all
we have time to do in this talk as a
very quick summary we started off by
looking at these project templates which
you can get today from on dotnet new and
yeoman and like I said they're going to
be in Visual Studio in the Box when you
get the next version SC net core and for
those of you who want to go a little bit
deeper there are various packages
available on NuGet and an NPM that give
you access to the underlying
technologies there in case you want to
do some cool
advancing with it on your own so that
brings us to the end and if you want to
learn more about this stuff then you can
go to this repo on get up there that's
where all the code is it's where we
actually build all the underlying
framework stuff and all the templates
they're all there so you can see that
there's lots of documentation there as
well and last two things one is please
remember to evaluate the session on the
way out and secondly if you want to see
some more cool stuff that's going on in
the world of web I've got another talk
tomorrow first thing after lunch and
we'll just do loads of cool demos of
things that you probably didn't even
realize you could do in a web
application so that's all we got time
for I hope you have a really good rest
of your conference and I will hopefully
get a chance to chat with you other than
a couple days thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>