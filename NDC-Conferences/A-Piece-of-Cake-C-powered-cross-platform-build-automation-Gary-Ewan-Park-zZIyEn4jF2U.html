<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>A Piece of Cake - C# powered cross platform build automation - Gary Ewan Park | Coder Coacher - Coaching Coders</title><meta content="A Piece of Cake - C# powered cross platform build automation - Gary Ewan Park - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>A Piece of Cake - C# powered cross platform build automation - Gary Ewan Park</b></h2><h5 class="post__date">2016-08-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zZIyEn4jF2U" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so thank you very much for coming
along this morning my name is Gary park
my contact details are up there if you
have any questions feel free to reach
out I'm here to talk to you about a tool
build orchestration tool called kik and
my aim today is to help answer some of
the questions surrounding what is cake
why you would use it and also provide
some demos at the end as to how you can
actually use cake to achieve that
cross-platform build automation that a
lot of us are now wanting to achieve
with the advent of things like dotnet
core and platforms and environments such
as mac and OSX that we want to want to
target so the first question that we
really want to answer is what is cake so
first up for those of you who have come
here expecting actual cake I apologize
there is no cake trust me when I say you
wouldn't want any cake was baked by me
okay what we are hear talk about instead
is this cake so first and forth first
and foremost cake is a open-source
project it's been around since 2014 it's
hosted on github we started by a Swedish
colleague of mine called Patrik Svendsen
and then it was later joined by another
Swedish colleague called Mattias Carlsen
I then joined the project so yeah full
disclosure I am a member of the cake
contribution team if there is anything
wrong with cake it's probably my fault
now so feel free to pick me up on that
I joined the tail end of 2015 it's a
reasonably small project but it is
growing in popularity we have almost 400
pull requests into the project with 60
different contributors as well as over
now 40 third-party ident for the cake
ecosystem and I'll come to that in a bit
what that actually means we're happy to
say that as of today we've got about 55
thousand downloads on you gap so again
we're happy that it's a evolving project
and people are taking an interest in it
so trying to answer the question about
what is kick this is this is the
definition from the cake build dotnet
website and
have a look at so what we're trying to
say is it's a cross-platform build
automation system with a c-sharp DSL to
do things like the compiling of code the
copying of folders and so on but at the
end of the day what what does that
actually mean what we mean by that is
that cake is an exe it's just an
executable that you would run as part of
your build process and it will take as
an input a build cake file and that
builder cake file will have the
definition of what your build is it's a
script processing engine that uses
Roselyn and/or the mono compiler under
the hood to take that script compile it
down into an executable piece of code
and then I'll run that against the
platform that you're running on the
reason that we have boards Rozlyn and
the mono compiler just now is just a low
that opens a that cross-platform
utilization at some point we will be
switching to just Roslin once the
underlying Roslin scripting engines
become fully cross-platform we'll be
switching to that in favor of using one
or but that's that's a step down the
line in terms of the roadmap so before I
go too much further in to before I go
too much further into what that actually
means and what kick actually is what I
want to make sure is that we're all
talking about the same thing in terms of
what is a build so for me a typical
build workflow starts like this we have
we have a build we want to we want to
compile something whether that I of
Visual Studio whether that's a of
monodevelop whether that's a of some
other IDE we have something that we want
to build in order to do the build you
might have something like a package to
store step if you're doing if you have
NuGet packages within your solution you
have to first restore them as part of
the build in order for the bill to
succeed because you've taken those
dependencies on top of that you might
want to run unit tests because as
everyone knows there should be unit
tests in a project
not everyone has them but that that's
the ideal that you have some unit tests
to go with your project in order to
complete the build you might have
something like a clean step clean step
base that just tidies up the underlying
folder structure to remove any artifacts
as part of the build
because the last thing you want is a
build succeeding only because the last
one succeeded so you have a clean step
on top of that you might have some test
coverage because what's the point in
running tests if you're not actually
looking at the results of those tests
and making sure that you're either
improving or things are getting worse
then if you are depending on what kind
of developer you are if you're like me
you want to run some sort of stack
analysis on your code to make sure that
everything is meeting the standards of
your project team so you might use tools
like style cop or droop find our FX cop
or inspect code and those are all
utilities that will basically look at
your codebase make sure that all the
line endings are the same that you're
not doing anything is that you shouldn't
be and so on and you might have a
package step so what's the point in
building something if you're not
actually going to make it available for
consumption elsewhere and then there may
be a final step which is the publish
step so that's to take the output of the
build whether it's an MSI whether it's a
new get package whatever your output is
you might want to push that somewhere so
that other people can consume it
especially if it's a paid for a product
want to make sure that it gets there so
what I'm hopefully describing there is
something that is common to everyone
it's a fairly typical workflow obviously
your steps might differ but what I'm
going to show here is hopefully that kit
can help you to fulfill that workflow in
a common way because what cake is going
to do with once we get into the innards
of cake what cake is going to do is it's
going to create what's known as directed
a cyclical graph of all of those tasks
and it'll make sure that as part of the
build process that what each of those
tasks is run at least once as part of
the build okay so with that in mind just
a quick brief overview of what cake
actually is and what it does so kick as
I said there's an exe that exe takes as
its input this build cake file I'll show
you some examples of what the Builder
cake file is and what it means as we go
through this in addition to the build up
cake file kick accepts a number of
arguments
into into the the KTX ii as well as in
vitam variables and/or a configuration
file you can actually specify within
your repository as well what that allows
you to do is fully customize how cake is
going to work once you've got both the
the cake file and the arguments being
passed then it's part of your build
script you have the option of using what
we call preprocessor directives what
they are likely to do is to add any
tools or add-ins into your real water
flow because as I mentioned before if
you're using something like inspect code
you need to get that tool from somewhere
we don't recommend that you put those
tools directly into your source control
repository because one it makes your
source control repository big and you
don't need to you can get it from
elsewhere and so you can use the
preprocessor directives to pull those
from some source on the internet and
down it and make it part of your build
in addition because it's just c-sharp if
you wanted to reference just a dll or a
new get package to consume the ability
for instance for it let's say you wanted
to use something like JSON net you
wanted to parse some JSON as part of
your build process you can add up a
direct direct reference to the Newton
soft DLL and then within your cake file
you can just write the normal C sharp
that you would for parsing that JSON and
using it as part of the build process so
once cakes got all of those things what
it's going to do is it's going to spit
that out to either
Rozlyn or the the mano compiler it's
gonna take that script and it's going to
make an X cubed piece of code out of it
obviously at that point if there are any
syntax errors or any problems with the
script it's going to feel it's a
compilation step so it will fail as part
of the build but you'll get notified of
that just in the standard way with a
stack trace and some pointers as to how
to how to correct that once all that's
done it then actually executes the build
and the output of that build is
literally anything you can think of so
whether it's as I said there's an exe
whether it's an msi whether it's a new
get package whether it
a deployment to Asia to Amazon literally
anything can be done as part of this
build process so the world is your
oyster so I can't stress enough that the
familiar familiarity that you might have
in c-sharp also extends directly into
the build up cake file so whatever you
can do in c-sharp you can do within the
the build script as well okay so the
next question that you might be asking
is well you've spoken about all these
tools and how what you can do within the
build process so what tools can actually
be used with cake and I like to show
this in this form so the the items that
are appearing here in black are the
black text are all of the tools that we
have available within core cake so as
soon as you have a reference the cake
you have you have the ability to use all
of those tools the ones that are showing
up in blue are ones have been submitted
via our community members so they've
come as direct add-ins to the project
that's actually where I got started in
the project I'm also a contributor to a
an open source organization called and
get tools that have tools like get
version and get release manager I saw
that cake as a product didn't have the
ability to run those tools so I use the
initially I started using the extension
points within cake to have those as
third-party a dent into the product but
they've subsequently got merged into the
core product as well so what we've got
in here is the ability to do things like
we basically cover all the unit testing
projects or and the ability to run test
coverage we also have if you if you if
you notice in there we have things like
slack and get her because it's part of
the build process you need to know when
something's going wrong
and the with the the explosion and the
views of slack and things like get our
four communication channels you can push
the message directly into a slack
channel or a get a room to notify people
that something's gone wrong with the
build okay so although there's a lot up
there hopefully you'll see that there
are some that you're already using today
and you'll immediately be it will start
using within kick and on top of that as
I said if there's something that's not
in there that you actually require the
extension points
I make it really simple to to add that
in so the next question that you might
be asking yourselves is okay but why do
I need it okay so what I want to
emphasize here is that for me personally
cake is all about the familiarize ation
with c-sharp but on top of that it's the
ability to have a build system that is
both maintainable and consistent across
those different environments so what I
mean by that is if you're just in Visual
Studio and you're doing the control
shift B to build the solution and that's
your workflow then that's great the
problem stems from the fact that if you
go on holiday and someone else right has
to take over the project and it doesn't
build on their machine because they
don't have an SDK installed or they
don't have a tool installed then the
build fails then that's where the
communication channels break down so
having something like cake which allows
the build to be orchestrated in such a
way that it can run on any machine it
takes that concern or that problem away
by making it or kind of forcing you down
the path of making it work on every
machine but again the your it's just in
c-sharp and that's really the big draw
for it the other part of the process is
as we've mentioned is that within Visual
Studio if you're just doing a build
within Visual Studio you might use you
might be using a test runner like
resharper or n crunch to run the tests
but again you want to take that out of
you want to take that out of Visual
Studio you want to have that being
common for everyone to the point that
you can actually hopefully run the build
on a machine it doesn't have Visual
Studio installed you want to be able to
run the build just with the basic SDKs
and the tools installed rather than that
dependency on all of those property and
probably the final most important part
is that we want to eliminate the the
problems with human error we all make
mistakes but by putting it into a
scripted process then you're allowing
the computer to take over at that point
you're not worried about oh did Bob
remember to do this step when you did
the build or the bill remember to this
step it's all as it becomes a document a
part of your process because it's part
of your source control repository so
hopefully that
the question on why do we need it there
are kind of questions I want to
hopefully answer a day is are what are
the core philosophies of cake because
cake as a product has a number of ideas
about what the build process should look
like but we also don't want to force
those upon you we want cake we can make
suggestions but cake is flexible enough
to allow you to run the build however
you want but one of the core some of the
core philosophies of cake are it should
be non intrusive so some of the other
build processes are build pipeline
pipelines that you might have used
require modifications to things like
your CS proj files in order for it to
work
cake is fully non intrusive and what I
mean by that is it's a standalone build
up cake file that will rather reside
beside your code and that's it it
doesn't require any other tie ends to
the system so what that means is or what
we like to say is you can start using
cake without telling your project
manager about it and once you've seen
the power of what power kit can give you
you can then just slot it in because you
haven't actually affected any of the
rest of your process the other thing we
like to say is it should just work we
have tie-ins and aliases for all of the
most common tools they're being run on a
number of different built systems now
for instance we use cake to build cake
and so we like to we like to do that
because we can then obviously see any
problems that are creeping through so if
things aren't working there's nothing
wrong with cake obviously but we test it
to an extent every time we do a release
so we hope it just works we also want
cake to be highly configurable so what
we mean by that is as part of the build
process when you need to change
something you can do that it's highly
configurable and with the most recent
release of cake
it's actually completely modular risible
now as well so that if there's something
within cake that you don't like you can
you can rip that out and replace it with
your own specific implementation of that
particular part of cake the other core
tenant that we like to suggest to people
is that there should be no binary
checked into source control simply put
and they're not required you want to
have them coming from somewhere else and
that goes for cake as well and
we'll come on - as part of the
demonstration as will show how we as a
product suggest that you bring actual
cake the cake exe into your pipeline as
I said before we want it to be easy to
implement your own tools and I can vouch
for that because where I started and the
final tenant is that we want the build
to look and behave the same regardless
of what operating system you're working
on or what environment you're running on
and the the most easiest way to show
that is by showing you this so that is
on our github repo so within the readme
text we build cake with cake on eight
different CI servers and we run it on
across three different operating systems
so you might think that that's a little
bit excessive but there are certain
parts of the tooling that behave
differently depending on what CI server
that it's running on for continuous
integration server it's running on for
instance something like the unit testing
framework and unit it knows that it
might be running on something like team
se so it automatically pushes test
results into the team system via what it
calls service messages so we like to
make sure that cake when it's utilizing
these tools continues to function as we
as we wanted to be legalized amongst you
might notice that the travis build was
failing when I took that screenshot that
was to do with new get Travis and you
get aren't getting on very well just now
but I want to leave it up there just to
show that we're not infallible to the
build processes we're still subject to
external failures as well but we've
actually put some additional retry logic
now into our own build so that if the
travis build field will retry it again
this part of the build process because
typically it's the the NuGet package
restore that's failing
so we've just added in the poly
applicated poly tool which will
automatically we try that and you get
package restore as part of our build and
nine times out of ten it continues to
work as expected so the next question
that I'd like to address is can't I just
use
fake or make or see make or Manas build
or none or vaisakhi or buy or any one of
these other existing build tools the
simple answer is yes I'm not gonna say
I'm not gonna stand up here and tell you
that you have to use cake if you're
already using those tools then continue
to use them I mean I can't force you to
use cake I would like you to use cake
but I can't forced you to but what I
like to say here is that we've heard
through our community members and
various conversations that we've had is
that there's this concept of well if
you're doing a c-sharp development
project then using the build system to
learn another language is a good way to
do it so if you wanted to pick up
powershell for instance you might want
to use Sachi or if you wanted to pick up
f-sharp then you might want to use
fakest but as the build system because
then you're kind of being forced into
that different language and it's a good
way of learning and I fully agree with
that to an extent the extent is when
that build fails you then have to do a
mental mind switch into that other
language to fix it and the the problem
I've seen even with my own company is
that you become that one person who
knows how to make the build work because
you're the one who put it in place using
something like a thick cake makes sense
if you're doing a c-sharp project
because you don't then have that mental
mind switch between the two languages
you simply and have your you're doing a
direct port from one language to the
other and you're fixing the same
problems so what I would say is if
you're doing a PowerShell project you
sake if you're doing an f-sharp project
then use fake if you're using a c-sharp
project then use something like cake or
buy or one of the other c-sharp based
systems that are right there um but what
I try to avoid is that mental main
switch that has to happen as part of the
build process so without further ado
what I'm gonna then do is I'm going to
switch on to the demos because that was
just a very brief introduction I think
the heart of this talk is really about
the demos and what you can actually
achieve so what we're gonna do is what
we're going to try and do is part of the
demonstrations is we're going to take
that typical build workflow and I spoke
about earlier
and what we're going to try to achieve
are the ones in orange here so we're not
going to look at time within the time
allotted to do everything but hopefully
if we can get those ones done you've got
a clear indication of how you can start
building with cake and then start
plugging in the different parts of your
and the build process that you want if
you're interested and the demos I'm
going to show you you can get them from
there it's a very simple github repo but
it's got all the steps and my way at
work through so you can take them away
and work them if you need to so with
that in mind let's jump to demos okay so
just a couple of quick notes about the
demo mi we assure you I didn't want to
rely on the internet connection at NDC
although I was told it was really good
I didn't want to rely on it so what I've
done is I've used some of the things I
spoke about in terms of the
configuration and I'm running cake and
essentially a offline mode it doesn't
require an interconnect doesn't require
an internet connection
in order to run so I've used some
configuration options to make it run
completely locally for instance I'm
using Nexus repository so I've got a
local you get a repository for all the
packages that no wait pull in I don't
need to go out to Newgate org but what I
will say is that all of the all of the
commands I'm a way to run in all the
scripts and my way to sure you will work
in that obviously online environment I'm
just running them locally just so that I
didn't have to worry about the demo gods
making it not work okay so we're we're
gonna start as if we go back to our
demonstration here is we're going to
start the package restore step so why we
need to do that is that if we jump to
visual studio here what I've got here is
quite simply the most amazing project
you've ever going to see it's not really
it's it's literally the standard asp.net
web application template that comes with
Visual Studio out the box all I've done
is slightly customized that to make it
so that
I've got a test project that's doing a
few tests against some of the the home
controller and also I've made it so
there's a third-party library in there
this cake got sampled Oh common that's a
third-party library or a common library
that's shared between the web
application project simply so that I can
show how we're going to do some you get
packaging I'm going to get I'm going to
package up that sample or comment in
turn you get packages part of the build
process the reason that resharper and
Visual Studio are literally screaming at
me right now is because I've made it so
that none of those NuGet packages have
been restored so it's running
essentially with all the references no
not there so both visual studio and
resharper are saying to me you need to
fix this but again we're not going to
we're not in Visual Studio at this point
we're going to do all from the command
line using our cake script and we're
going to make that build work
effectively but I just want to show you
what's it what we're actually building
so the the tool that I use the tool that
I use for and I'm doing my build script
this is vs code what we've actually got
in here is cake has a vs code extension
which means we've added in some custom
functionality to vs code specifically
for cake one of those is these commands
so if I go up to here hopefully you can
all see that if I if I type cake here
what we'll see is that there's two
custom commands in there one is to
install what we refer to as the the cake
bootstrapper and the other is to install
a configuration file the configuration
file is what I spoke about before you'll
see that I've actually got one in my in
my project here already
that's simply controlling where cake
gets some of its core components from so
again I've made that local so it runs
locally against my local host
but that typically wouldn't be required
unless you wanted to change that
functionality so what I'm gonna do here
is I'm going to type cake again and I'm
going to install the bootstrapper so
what it's asking me for is whether I
want a bootstrapper for Windows or
whether I want a bootstrapper for Linux
or OSX in my case I'm on Windows so I'm
going to go ahead
and select that option so what we're
going to get there is a notification to
say that bootstrapper file has been
downloaded and as you'll see over here
we've now got a buildup ps1 file so this
bill dot ps1 file is the one that we
give you to get started with it's fully
expected that this bootstrapper file
will need to be customized by yourselves
because you'll want to do things as part
of your project setup that we don't but
this is the our best attempt or our best
suggestion as to how to get started with
it excuse me so I'm not going to go to
this and I'm not going to go through
this in too much detail but under just
just so you understand what's going on
here this bootstrapper is going to
ensure that we've got the dependencies
in order for cake to function so we need
to download the KTX e so for instance
you'll see in here we download cake yeah
so once we've got the cake though exe
installed which we do is part of the the
tool resolution we'll have that cake
dough eh si ready to be executed so this
is really just a setup stage once you've
got this configured you'll never likely
need to touch it again and it's the
exact same thing for the it's exact same
thing for the bash version but all we're
giving you here is the bash or the Linux
or OSX equivalent of doing that exact
same thing so the reason that we have to
is obviously if we're running are the
same building file on all these
different environments we need some way
of kicking that off so if we are running
our build on up there which is a Windows
CI system we will target the build up
ps1 file and if we're running on
something on Travis will target the
build a sh file so that it does the
bootstrapping for us okay once we've got
that bootstrapper in place what we'll do
is we'll just close that no we want to
save it we'll just add in a straight-up
build cake file this is just gonna not
know me right let's rename that
we're gonna add a buildup cake file so
this is obviously going to be empty when
you first start so what you want to do
is you want to start populating this
with the tasks those that directed a
cyclical graph that I spoke about you
want to start stopping at those tasks as
part of the build process so as you saw
there my typing isn't very great when
I'm signing up here so I've got a number
of code snippets that will help me enter
that into the into here so I'm just
going to start doing that so what you've
got here is kind of the most basic build
up cake file that you can kind of start
with so what we've got here at the very
top and line one as I'm accepting
arguments from the command line so this
is a cakes way of saying find an
argument called target from the command
line
if there isn't one default that to the
default target so if you wanted to call
cake with a target of say and you get
package to store then that would be the
task that it would target as part of the
at the entry point of the build system
at the bottom there we've got a between
on lines nine and ten we've got the what
is the definition of that default task
and all we've got there is a dependency
and is dependent on to say what should
run when that default task is started so
in this case what's going to happen if
we refer back to here we want as part of
the default build we want that package
restore to be to run so that's what's
happening here
we're going to say pass end the that or
rather we're not going to pass in a
target it's going to run the default and
then it's going to run then you get back
at the store step now if we just go
ahead and save that now what I could do
and this is another reason to start
using vs code is that with the latest
release of vs code there is now a
terminal and interactive terminal within
here so what I can do is I can actually
just say run that build up ps1 file and
you can see the build executes in there
I'm not going to use that because it's
kind of difficult to show you that and
also edit the code at the same time so
I'm going to just use a straight-up
PowerShell window here
so I'm gonna run that same build so what
you'll see here is that actually it's
going through the build process and its
output that it was successful green
obviously successful um but we haven't
actually done anything yet all it's done
is its measured so that bootstrapper has
ensured if we jump to this folder over
here that bootstrapper has insured
within this tools folder which is a
convention that we start with again
that's configurable it ensures that the
cake DXE has been downloaded so that
bootstrapper went often you get it
downloaded the cake DXE and made it
available in the in this tools project
and this in this tools folder and then
it's executed the cake exe passing in
the building again a convention and
there's executed the build so we haven't
actually done anything yet but we have
done is we've started that process of
making that all work so if we just run
that again obviously it doesn't need to
do that some of those bootstrapping
steps anymore so the build is going to
be that bit quicker this time but just
understand that that's already happened
for us so what we want to do now is we
actually want to do something within
this new get package restore step we
want to make a call out to new get exe
we want to pass in the the location of
the solution file in this case the one
that I'll go up in Visual Studio and we
want to join you get back to the store
so for those of you have done that at
the command line we all know it's just
new get restore past the end but what
we're trying to do here with cake is
we're trying to get to a point where
we're not worrying about the actual
command-line arguments we want a a type
safe way to make that happen we want to
do it in a way that we don't have to
remember all of the the specific
command-line arguments we want to have
it just so it's it so again it just
works so what I'm gonna do here is I'm
gonna go in my second demonstration here
so this is what it looks like so we've
got a command alias a method alias for
new get packed up for new get restore
and all I'm doing is it's accepting an
input parameter which is the location of
that solution file and that's literally
it that's all we need to do to take that
part of the process off to sort of show
that there's no kind of smoke and
mirrors going on I'm going to go to the
source folder notice it does not
I could just fold it at this point if I
go over here and run that build what
it's going to do you're gonna see this
wall of text and that wall of text R is
the 47 packages that the default asp.net
template needs in order to build so what
that's done now is it's taking all of
those NuGet packages again in my case
from my local you get feed and put them
into the system so they're now they are
available to us okay if I run the build
again we're not going to see that big
wall of text anymore because those
packages have already been restored so
again that incrementally the build is
going to get quicker but again if I were
to remove that packages folder and make
it a little bit harder for the build
system then run the build again then we
are going to see that big wall of text
because of that because we need to
restore those packages so again we're
scripting and I we're making it so that
one person doesn't have to remember or
do all these steps we do that as part of
our build process now don't get me wrong
this happens for you automatically
within visual studio when you do that
ctrl shift B to do it within visual
studio but we're stepping away from that
environment and we need to take
ownership of those particular tasks okay
so we jump back to here what we're gonna
do now is we want to actually run a
build now we want to run we want to
build that solution and look at the
output so again if we go back over here
and quick have a quick look in here then
there's no bin folder this project
hasn't been built yet so we want to
build it as part of our script so what
we're gonna go we're going to go back to
here and we're going to go at the top
here and we'll start demo too so what
I'm gonna do is I'm gonna add in an
additional argument up here because as
you know with a visual studio you can
specify whether you're doing a debug
build or you're doing a release build so
the same process or the same options we
need to come through cake we need to
specify whether we're doing a debug
build or we're doing a release build and
we can take that as an input argument so
again here I'm gonna look for input
argument called configuration and if
there's not one I'm going to default to
being a release build okay with that in
place I should be able to come down here
and do demo two and I'm gonna do the
exact same thing that I did before so
that's just a method alias again for
msbuild and all
doing as I'm passing in the solution the
location of the solution file now some
of you might be thinking well that's all
well and good but I need to be able to
set the treat as warnings error as part
of my build or I need to specify the
specific msbuild version that I want to
use so that's where the configuration
options within each method alias comes
from so if I rewrite that as this and
what we're seeing here using this
msbuild settings class I'm just mooing
up and you instance to that settings
class and I'm going to set multiple
properties some with extension methods
but I'm basically saying I'm on Windows
I want to treat warnings as errors and
I'm using that specific version of the
MS build tool and I want to set
verbosity the minimal and so on so all
of these things are available to be set
and where I would direct you to for more
information on that is the help
documentation that exists on kake built
net so what you're seeing here within
the MS build Alyssa's there's the an
example there of what you can do and
then if we jump over it here on the MS
build settings page we'll see all of
these properties that we can say on ms
build so all of those are then directly
translating to command-line arguments
that are passed to the underlying
msbuild or exe as part of the build so
with that in place what I need to do
before I forget is I need to change my
default task to now take a dependency on
the build task because as part of that
graph that we're building up we're now
wanting to run the build and then the
build tickets that take the dependency
on the new get back at restore and
that's what this line is doing okay now
if we jump back over here and have that
folder open as an example we're gonna
run the build it's not going to do that
in you get packaged the store now
because you don't need to but it's gonna
do the actual build step so you see here
that's doing the build and then we'll
see we've now got a bin folder so it's
now actually running the build ok so if
we let that finish out we've now got the
artifacts of that build are now within
here it's compiled all the xes and the
DL to go with that project now the
eagle-eyed amongst you or the concerned
amongst you might be thinking well in
this bold new world of
and dotnet core and asp.net core we
haven't quite yet got an MS build core
there is one but it's not quite there
yet in terms of what we need so the
further mediate question is how do I run
this on Travis because you're calling MS
built Travis doesn't work on MS our ms
Phil doesn't work on Travis so that's
where the flexibility of cake starts to
come in again if we use this example
what we're showing here is that within
this build step I might want to have a
simple if statement that simple if
statement says if I'm running on UNIX so
either Mac or OSX I want to use the X
build tool rather than the MS build to
Center the X build will work on those
platforms
so obviously kit can't do everything for
you and it's not going to know which
tools run on which environments so there
is going to be some element within your
build script of understanding the build
pipeline understanding which tools run
off which environment and then taking
the necessary steps to ensure that they
run in the correct instances so what I'm
showing here is with the addition of the
is running on UNIX method we can then
make an informed decision about which
tools we want to run and it's the same
thing you can do it in Reverse there's a
is running on Windows and there are
other steps you can take in terms of in
shooting that one particular build tasks
ones on those platforms as and when
required okay so if we just leave that
in there save it and then run it again
the exact same thing should happen
because I'm still on Windows so I'm
still running that same msbuild task and
it completes as required okay if they're
moving on the next thing we want to do
is we want to run some unit tests so we
want to run some unit tests so the unit
test runner that I'm going to use is I
think it was X unit let me just check
that so I've got some unit tests in my
project so I need an X unit task so this
is showing again we've got an X unit two
alias it's got it takes a number of
arguments so those of you are familiar
with X unit will be familiar with these
things so here I'm just setting a couple
of things like the output directory what
kind of report I want to be generated
and where I can find the dll to test the
URLs that I actually want it to execute
so what I've got here is I need to say
that I now want to run
this one as part of the build so I'm
going to change that over there so as
part of that graph X the unit test is
going to run the build and the bill was
gonna run then you get packaged the
store so if I go ahead and run that I'm
gonna get a failure and I hope I'm gonna
get failure I should get a failure yes I
got a failure
now that's expected so everything that
I've showed you so far then you get
packaged the store and the msbuild the
tools the underlying tools for both of
those aliases are already on my machine
because the bootstrapper download and
you get to exe for me and I have Visual
Studio installed so I will already have
MS build installed X unit I don't have
installed so this is where the
preprocessor directives come into play I
need my cake build process to grab that
tool and make it available for me as
part of the build so if I go over here
I'm gonna use the tool resolution syntax
so what that's saying is a hashtag tool
you get and then so I specifying it the
tool comes from you get and that's where
I can find it now again because I'm
running locally I want to have a
slightly different syntax I'm gonna use
this so this is just showing kind of the
flexibility of that URI syntax we're
using there I want to I want to have
that package come from somewhere else
the default will would be for it to come
from you get the org but I want it to
come from my local repository so I've
changed that syntax up slightly and if I
wanted to have a specific version of
that tool or to use a pre-release tool
then again there could additionally
argument so you can put on to the end of
it to make that happen so with that in
place if I run the build again this time
it will download the tool that is an
unit so we'll have the X in the X unit
tool console runner is now available on
my tools prod in my tools folder so cake
knows about it now and it's now
attempted to run the unit tests but
again it's failed and it's failed if you
we if you were to read the stack trace
here and do some googling as I needed to
when I first tried to do this demo
you'll realize that as part of the
output or the running of that X unit
tool we specified that the output
directory should be a folder called a
dot build
there's slash test results the xunit
runner actually assumes that that folder
exists it needs to exist on the file
system in order for it to output the
directory they're there they I put the
file there so what we'll see is if we go
up here we don't have a dot build folder
and we don't have a dot build test
results folder so it's never for field
so again we need to take ownership of
that as part as part of our process so
if I go up here and add in a clean task
and I so all that's doing is again it's
using a method a list we have available
so all it's doing is saying for every
folder that I put into this clean
directories method alias make sure that
two things happen one that that full
that exists and make sure that it's
empty because again it's part the build
process we want to make sure that there
are no artifact left as part of the
build so with that in place what I need
to do is now my X unit test is dependent
on two things so I'm just gonna say is
dependent on the clean task and if I go
back to here I go back to here what we
should get this time is I'll run through
the build it'll run X unit it'll create
that build folder as part of the build
and it'll put the output of the test
results into there so what we're seeing
here is I've got three tests and because
I'm an amazing developer all three tests
passed and I can go off go home knowing
that my build works ok so that's that
part of the process so we go back to
here the last step that we're going to
cover is the new get packaging so as I
discussed in my visual studio project
here I've got this cake sample dot
common DLL I want to wrap up as a NuGet
package so I want to share that with in
my project teams so I want to do that
using the new get package step so if I
go back down to here
I've got a new package step and what
I've got here and you might be
immediately thinking Gary's gone nuts
what is all this stuff
because this is meant to be really easy
and what I'm trying to highlight here is
that yes it is really
there is just and you get package
there's a new get pack alias that will
just take as an input the new spec file
that you want to package but what I'm
showing here is that there's complete
flexibility in terms of how kik operates
is that if you don't want to have that
new spec file or you know that that new
spec file needs to be created each and
every time that you're running the build
process you can have kik specify all of
those properties as part of the build
and then pass all of those new spec and
you get pack settings into that and you
get pack and then just have it create
the build so what you won't find within
my demo project I go up to here and look
at the source and look at the Cape
comment then there is no new spec file
in there so I'm fully running the the
packaging of that you get package from
the build process it doesn't rely on the
underlying system but what I'm just
trying to show here is the flexibility
and what you can get to achieve so what
we'll need to do here again I'm not
going to make the same mistake I did
before I'm specifying the output
directory of that and you get package
should be a new get and you get folder
within the build output folder so I'm
gonna go up here and I'm going to change
my clean task to include if I can take
demo I'm going to change it to extend
that clean task to include another
folder which is the building you get
folder then I'm gonna go down to the
bottom here to specify that the default
task now ticks at the pendency on
package so if I go over here and show
the output folder which is build I go
back over here and run the build and
what we're going to do is gonna do all
the steps we did before it's still gonna
do then you get package of store if
required it's going to do the build it's
going to do the X unit test and it's
also going to package up and in turn you
get folder I've now gotten an up cake as
they're called and if I open that bad
boy up what we're gonna see in here is
it's got the version number that I
specified it's got the release notes
that I specified is going to copyright I
specified so all of those things came
from the build script okay now the final
demo that I wanted to show before we go
back to the slides is it's a wife short
so far is sorry question
so the question is why do I not specify
a version number into the build I boot
so they it segregates on that way or and
you certainly can't do that I mean
typically I use when I'm doing a build I
use a tool called git version that
asserts the semantic version based on
the commit the commit history into the
repository so I'm always asserting that
if you wanted to I mean cake actually
does that so if you actually look at the
cake build script within our build out
folder we do take a version number and
append that into the build iboot folder
so you certainly can do that and again
it's flexible I mean you can do anything
you want so if you do if you what if
you're interested in that take a look at
the the build up cake file on cake
itself and you'll see that in its
artifact folder we do include the
version number so we can segregate in
that way so you certainly can do that
yeah I mean the question I would ask is
why we were running two bills in the
same machine in the same time that would
be a another question they checking in
but and if you've got a so the question
is what happens if there's kind of two
bills running at the same time on any
sort of typical CI server the build
agent is only running one bill this part
this in the queue at one time so your
your continuous integration server we
take care of that unless your because
unless you've got multiple agents at
that point the the files are all like
local to that agent so the queuing
system within the CI system would take
care of that we can talk about some more
afterwards if you if you still got some
question so what what I wanted to show
was as part of this demo what I showed
was that as you're creating the build
script you might run into issues you
might run into issues with the tools
that are missing or you might run into
issues with syntax or you might run into
issues where something just isn't
working as you would expect it to so
what I want to or what I would say is
that as you move these build on to some
sort of CI system you will want to have
some sort of logging and diagnostics in
place so that when you're running on
something like team say a or Jenkins or
Travis you can look at the build log and
see what's going on
but what I would like to show you is if
we we we have recently added in the
ability to do debugging of these cake
scripts so because it's just a c-sharp
script we can have that within Visual
Studio and step through the build using
Visual Studio so when you're first
creating the build it becomes easier to
figure out what's going on so what I'm
going to do is I'm going to go up to
here and twine you get package of store
step and I'm just going to use another
one of the preprocessor directives that
we've included which is just the the
break so what this is going to say is
run when you see that if there is a
debugger attached then stop at that
point in the cake build so I'm going to
jump to here and I'm going to I'm going
to jump to here and I'm gonna run cake
directly this time I'm not going to use
the bootstrapper and we use cake
directly I'm going to pass in that build
up cake file and I'm gonna pass in debug
so what that's going to do is it's going
to immediately gonna say attach a
debugger to the process it's just
started so it's instantiated cake it's
passed in or it's created a process to
go with that so if I jump over here at
Visual Studio and I go debug attach the
process and the process ID there was for
six to eight so it's that one I go ahead
and attach to that what it's going to do
it's going to attach the debugger to
that process that suspend instantiate
it's gonna load up that build up cake
file and it's gonna step on that
preprocessor directive that is the break
one so what you're looking at is it's
still saying break but in the compiled
version it's got the system debug
debugger attached or the launch debugger
so at this point I can just f10 through
the build so if I go back to here what
you'll see here that you're still seeing
the output as it's happening but we're
stepping through it within Visual Studio
so if I step through this again and do
the actual build so we've got that if
statement there so we're know that we're
running on Windows so we're going to run
msbuild
jump back to the parachute we see the
build happening but you've got the
option within Visual Studio to step into
that so the prime example of that is if
I go back down to this one I set a
breakpoint here
and I let that run until we get to the
NuGet package step I can set a very
quick watch on this and then in here
I've got access to all of those
properties that I've set so again when
you're first career in the build script
or you're trying to debug something
going wrong with the build scripts it's
not quite working the way you want to do
then you have the option of stepping
into it with a debugger within Visual
Studio okay that's one of the it's one
of the benefits you kind of get for free
because it's c-sharp okay so I'm just
gonna jump back to my slides here I did
that one sure then I control f5 there
let's do that again
Foster I go back to my demo slide here
okay so the last thing I wanted to talk
about before I take any questions if
there are any is I wanted to announce
some news associated with kik so as of
today cake is now a member of the dotnet
foundation so those of you are not
familiar with the dotnet foundation it
is a independent organization that's
trying to foster open development in the
dotnet ecosystem it's got projects
already in it
for instance identity server MV mm MB
mvvm light donate core in asp.net core
so we're very happy to be joining that
foundation because we think all
obviously bolster the the cake profile
ill people become hopefully become more
familiar with what cake is and how what
it does the blog post I've linked to
there might not quite be up yet because
it's getting there tying it in with this
with this talk that's happening here but
it will be up there at some point today
so we're I guess a we're very happy to
say that we're now a member of the
dotnet foundation so we've got about 5
10 minutes left so if there are any
questions I'll take them just now if
anyone has any no questions
yes
could could I just throw out my old
build server or built system and from a
from a purely personal standpoint sure
why not and I mean it's depending on
what builds us and you're using I mean
depending on so when we say if you're
using well okay taking us out or are you
using just now then so it so cake is not
gonna replace team say team say is the
CI server but what with in team say what
you will typically do is you will have
build steps so within your team city a
CI server you'll have steps within team
sitting and that steps may be the exact
same steps that I showed here so you
might have a step that's doing the new
yet package restore you have a step
that's doing the MS build you'll have a
step that's doing the unit testing and
none of that goes away it's just that
you've moved that into the build up cake
file so what you're effectively saying
is the team city you'll you'll then have
one step within team city and within
team city all you're gonna do is run the
build up ps1 file you're gonna run that
bootstrap or file and it's gonna take
care of all those steps because simply
put I love team say that's why I use
right I'm not going to throw a team city
away because I need and I want that
because it's still orchestrating the
build queue for me but what I'm doing is
I'm taking some of the way away from
team city then then just having it all
contained within my one script so in the
benefit of that is when you go fully
cross-platform right I want the same
bill to run on Travis so that's where
the bootstrapper comes in you'll have
the bootstrap or build or SH that will
run on Travis which is running on Linux
or OSX but it's still running the same
build cake file so it opens up that
option to run the exact same build
without having to recreate each of those
steps within those CI servers so no and
cake is in no way shape or form trying
to the place team say it because team
say it does a great job at what it does
and it does have those build steps that
will do some of the work that we're
showing here but it does mean that you
have to replicate those steps on Travis
or Jenkins or bamboo or whichever
see other CI systems you want to run by
putting it into the Builder cake file
that commonality comes in so you can run
the same thing across all of those
platform
so no don't don't throw away team say
you definitely want to keep using team
say okay any other questions okay if not
there's a couple of demos like a couple
of resources there just pointing you to
the the cake documentation there was a
there's a recent podcast that we did on
the MS dev show and we've got a couple
of blog posts out there that kind of
just show how you get started with kik
so I'd encourage you to go and take a
look at those and but if that's that's
it that's all I have to say so thank you
very much and thank you for attending
and there's also one for Chalkley I'm
also involved in so feel free to go and
grab some stickers if you want some</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>