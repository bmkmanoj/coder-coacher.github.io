<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Functional Techniques for C# - Kathleen Dollard | Coder Coacher - Coaching Coders</title><meta content="Functional Techniques for C# - Kathleen Dollard - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Functional Techniques for C# - Kathleen Dollard</b></h2><h5 class="post__date">2017-07-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rHmIf5xmKQg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello NDC you guys just had lunch and I
get to try to keep you awake wonderful
thank you so much for coming uh let's
get started let's not mess around my
name is Kathleen Dollard I'm from Denver
Colorado in the United States and the
United States West to the Mississippi
goes up like a table that's leaning and
then it hits the Rocky Mountains most
people in Colorado liver right in that
space between the mountains right next
to the mountains and so that's where I
live as well so I want to look at the
abstract maybe read the abstract like
one person here raise your hand please
just lie to me tell me that you read it
okay I work hard on this I actually if
you think about speaking of great ideas
to actually like write your abstract as
though people are going to read it
because it both makes conference
organisers happy and then when you go
write your talk you know what you're
going to talk about which is totally
awesome see I'm using a word here that's
quite unusual in English which is when
some when some you're the winsome smile
a functional languages thing so that
just means it's nice its pleasant its
attractive and it's also shout out to an
American blues singer one of my favorite
songs is when some smile by Chris Miller
so if you all go and download a Chris
from other song then we'll mess up all
that big gob of stuff on Spotify so
alright okay so another thing I want to
say here is highlighted there is some
stuff about actually seeing a lot of
code change that'll be a weak-eyed
minimal because of the time frame that
we're in you will see code change and
you will see some final code that's
going to give you a big picture of
what's going on and finally I want to
clarify that this talk applies to doing
things you could have done from c-sharp
3 and beyond there are new ways of
thinking and so there are things that
most people aren't doing today so I
think you'll be excited at the new ideas
but these are not new features so the C
sharp 7 features sometimes gets referred
to as sort of functionally but I don't
think they're quite there yet in future
versions were likely to see some great
functional stuff but right now the stuff
I'm going to
talk about certain c-sharp 3 can anybody
tell me why C sharp 3 matters what do we
get in c-sharp 3 lambda is in link and
its lambdas that I care about although
I'll also mention link but link is an
example of what what we can do so
c-sharp less functional techniques and
the great thing about where we're at
today's world is there's a lot of
languages taking different approaches to
functional ideas so if you look at
something like Haskell on one extreme
that's very strict it's very it's so
functional that for a long time it
couldn't do anything real and that means
literally it couldn't do anything real
and then we come across a spectrum to
some great languages like f-sharp that
meld two functional language work with
the the underlying dotnet framework or
in the case of Scala the underlying Java
framework so we've got this range of
things going on we see shops it's is
this incredibly solid underlying
language platform and ecosystem that
most of you are probably already
familiar with what we can do is we can
take that platform take that knowledge
you have and stretch it in functional
ways and that's what this talk is all
about it but to start I want to talk
about some functional ideas just because
they're scary words so let's start out
with a slaying the Dragons of a couple
of ideas that are very simple but you've
probably only heard of them in like
weird ways where you were going seeing
what's that lots of s they'll be one or
two F involved here today to this talk
first about currying currying oh my gosh
that doesn't mean going down to the
corner it to get some dinner it means to
actually do this Oh long definition from
Wikipedia oh my head hurts maybe we
could put that into like some sort of a
representation yeah so F true coma 42
can change to F G of 42 and that's what
all that all said and that doesn't help
you very much
but let's look at that c-sharp code
because this is going to help you
understand what currying means to you
now there are people in the world that
do provable algorithms and far out their
stuff and I can't wait til they get
further and we can use that more but
right now today what we care about on
currying is it lets you add more intent
and more understanding to your code so
in that first one get by ID true what
the heck does true mean we've made it
more clear by using name parameter in
the second one but it still is not as
clear as that third one where you can't
go on the third one says the intent I
don't care how you know what is active
and not active but just give me this ID
if it's active so the third one which is
currying which says we will take
something with two parameters and change
it to something with one so caring would
say we'll take three two two two one but
this is the idea behind curring and you
can use it you probably do use it today
to add intent second thing I want to
talk about is immutability Oh everybody
talks about immutability and I actually
want to do this because I want to wave
you off of something that I think people
are thinking too much about so
immutability is great it says that once
something is created you can never ever
change it that is a fantastic idea in
the right place so we when we consider
our systems we need to look across a
broad swath of the application if you go
into your application you say oh I want
that one to be immutable and that one oh
well this is new and that one's old so
this will be immutable and that one
won't be that doesn't help you in fact
it's probably just going to make a mess
of your application so when you consider
immutability
look at doing that well you can attack a
set of classes that are all doing
basically the same thing all of your
domain classes all of your entity
framework models all of something like
that this is going to be able to say all
these things together I can make work
this way although I said that wrong some
other models you could probably use but
not any framework it actually needs
those setters
so partial mutability is not very
helpful be careful about that as you
move towards immutability c-sharp
six and seven each have features that
make that a little bit easier to do tail
call recursion o as a really scary
phrase all that means is that we have an
array and we walk up to that array and
we want to do something let's grab one
item off of it usually off the back or
the front either one take one off and
then let's do something on what's left
and let's keep doing that till we get to
only one item and then let's build it
back up now I'm not talking about child
car recursion because I want you to do
it I'm talking about tail call recursion
because I don't want you to do it and
the reason is that that doesn't work
well and c-sharp because it's not
optimized for it every time you do that
tail call it puts another item on the
stack and that is probably not a good
idea for a large array so my point on
this is to say you don't need to know
all the features and things about
functional programming you shouldn't use
some of them but there's a set of
features that actually do make sense and
this is one of them higher-order
functions oh what a big long way to say
write a method that either takes a
delegate as a parameter or returns a
delegate from itself and I'll talk more
about what delegates are in a little bit
many of you have a general idea that
it's a safe function pointer so if a
method can take a delegate then it's a
higher-order function I think you've
already used some of those linked select
where or to buy all of those they are
higher-order functions this is
tremendously powerful tool for you and
writing your own as approach is what I
mean here writing your own here is a
tremendously powerful tool it's greatly
underutilized and this is what we got in
c-sharp 3 that lay the groundwork for
this I will tell you it's taken me a few
years to get some of these ideas to full
fruition the way you'll see today and
c-sharp is great at this c-sharp is
extremely solid and handling delegates
and working with being able to pass them
to functions and evaluate them at a
later time this is fantastic this is
what c-sharp does brilliantly
referential transparency only got two
more here referential transparency is
that you can take a method call you take
the method call and you can take the
parameters that you're passing to them
you can bundle that all up and you can
replace it with the return value so what
that says to people that do all that
prove ability stuff is you can optimize
what that says to us is that we have a
very important way to think about the
concept of purity purity is an idea that
I want to go into a little bit because
it is very nuanced and it is more
nuanced in our world than it is in a
world of strict functional programming
like Haskell so at this point we have
been here for all of 10 whole minutes
and you haven't seen code so we should
fix that let's do it mo what's the
purpose of demos it's to show you more
clearly something that you've already
seen so I'm picked this picture because
this is where I was on Monday night I
put this on Twitter and I said I had a
fantastic walk to that waterfall a few
of you might see the waterfall maybe
there's a waterfall so you need to this
is just a zoom in on this idea so let me
come here to a set of code and the way
they set this room up I've not yet been
able to go to the back to see whether or
not this is a good size so when you do
that does that mean it's good or does
that mean you would like it bigger I can
good ok good I'm going to leave it aside
something to yell at me if they want it
different
okay so purity is the idea that a method
is always going to return the same thing
given the same parameters not the same
scenario in the universe but the same
parameters
and also but nothing in the universe
will ever change the way what the values
are returned so those are the two claims
of purity so with that let's talk
through a few is this pure yes this is
the definition of purity okay this is
absolutely pure now I have a challenge
here because what would the opposite of
purity would be like impure not pure or
something that's truly horrible and
there's nothing wrong with things not
being pure it's just a concept that we
want to understand so we can pull apart
the apps'
parts of our application that are pure
from the parts that are not let's do
another one give an x and y return z as
the summation of x and y is that pure or
not pure it's pure fantastic okay so
let's do one more which is that one with
a very very slight change a few more
here to do how about this one is that
pure or not I heard yes
do I hear anything else I heard no I
don't know
I hear yes I don't know and that's a
totally reasonable thing to hear at this
point because if we are working with the
general concept of purity with the legal
definition what it means in Haskell what
it means if you're doing approvable
algorithms i said nothing in the
universe changed and something in the
universe has changed the console has
changed so this is something that is not
pure in the traditional sense in the
legal leaves sense in the formal sense
but it is pure in what we care about and
this is really important to us we're C
sharp developers we live in a pragmatic
world of trying to get code written this
is what we live this is what we breathe
this is what we care about is what
matters so all the people that thought
yes they're going well as far as I care
that is absolutely clear because I don't
care what gets written to the con
and that's the world that you need to
define within your teams when you're
using when you're using pure concepts
you make your development better you
want to make sure your team agrees on a
couple of pieces around purity and this
is the key one okay
there's two I'll talk about the other
one minute is it pure if you log in my
book it is absolutely still pure because
it will not affect any of the evaluation
things that you would do any of the ways
you think about the code and I would
never ever ever want you to be fearful
of logging anybody here think they log
enough raise your hand really high wave
it around will I give you applause so
it's almost nobody feels like they are
doing in a flogging now here's another
one which is the same thing I've no idea
why's that one twice this one is the one
I want is that pure no that is like the
definition of not pure it is affected by
the state of the universe every single
seconds you get a new answer so that is
absolutely not pure and what about this
one
is that pure your quiet nobody wants to
give an answer it depends I heard the
consultants answer thank you very much
it depends it depends on whether foo is
pure foo in this case happens to be pure
so foo is also pure and I try to come up
with an analogy for this because I don't
want to say that impurity pollutes
purity because if we don't have impurity
if we can't touch the world our apps
aren't interesting what we want to do is
take the ideas of purity stack them up
in one spot understand what we mean by
purity in that context only do the
things we're expecting to do no
surprises and then let our other code
also do its job and so rather than use
the idea of pollution or spreading or
anything like that
I thought about bee
I love beats bright-red wonderful beats
have you ever cooked with beats you had
done anything with beats at everything
that gets near the beat turns pink
everything turns pink or red or maroon
or some beautiful color so it's like
that except a little more neutral
because I think those beats are
delicious purity and impurity are not
good and bad they're just different and
when we pull them apart in our
application then we're better able to
write our applications in a way that's
maintainable and we'll be looking at
more code so with that I want to go back
to slides and if any of you have
questions you're going to have to wave
your arms around and have people just
dress the idea down to the front because
I can only see about thirty five of you
in these lights
okay so purity this is what we just
talked about no surprises
he has already think about that with
your code don't do surprises should
indicate all possible input and output
same input always returns results in the
same output wonderful that's if your
function we can do things with it
control flow should be entirely
predictable hey that's pretty good
here's a little nother little wrench in
the works here that we have to talk
about and that is what about those nasty
little exceptions can a pure method have
an exception I can a pure method be
allowed to throw an exception strictly
speaking no strictly speaking no and
what does that mean in net for us that
means that every single method to prove
its purity has to do two things it has
to have a try-catch inside the method
and then instead of throwing it has to
wrap it up and return the value which is
not in fact the value you were expecting
like an integer but is that value
wrapped in a container what call that
container a result that says I succeeded
and oh by the way here's the value now I
think that's a brilliant way to go
across layers myself it's how I like to
architect applications but can you even
imagine if everything
method you ever wrote had to do that
that would be insanity so we're going to
use net exceptions it's very hard not to
use net exceptions but we have to
understand that this is a second way
that when we talk about purity we do not
mean it in the same way that a hardcore
formal usage of it would mean I'll
mention I think right here that there
are got that okay it's not there either
side it comes up later cloth sight the
big library of videos has two extremely
good videos if you search for functional
techniques of c-sharp or something very
similar to that you will see two
different talks they both would be a
great follow-on to this talk one of them
I believe it's lattimer's talk talks
about the exceptional and non
exceptional cases so he talks about
exceptions are okay impure methods
because it's the exceptional situation
well that's a fine explanation except it
doesn't hold water in the the strict
formal sense if you're in high school
writing math papers that's not going to
fly it will fly for c-sharp as a way you
can think about this all right there's a
lot of code I mean a lot of slides we
have to do a little bit more slides
before we jump in a code I'm rushing a
little bit because this talk is 75
minute talk squeeze just a little bit
let's talk more about delegates I told
you I would do this and I would imagine
that if I took a poll you would all say
you know something about what a delegate
is which is wonderful because you're
right about you're almost certainly
right about what you currently think of
as a delegate I'm just going to flush
that idea out a little bit further so to
start with they are types of function
pointers that's the way we talked about
them in the year 2000 when there were
unsafe function pointers but now that's
more the way of the world so we have a
type safe function pointer which allows
us to take a piece of code and hold it
as data and I actually prefer myself to
think of it that way
so code is data when it's on the screen
in front of you in ASCII characters it's
a data when you pass it around as a
delegate it's the ability to run code at
some future moment so you pass this
around it's very natural now in our rule
because javascript is full of this and
other programs even in Java now supports
it and so now we've got the idea of
delegates all over the place
c-sharp is still a beautiful
implementation of this and it does it in
three ways one of which is probably
pretty much obsolete anonymous methods
are just another way to do lambdas with
a whole lot more code around it and I
wouldn't bother
so we'll primarily look at the idea of a
method that has no parentheses which you
run into when you get that beautiful
compiler error that says you can't add
an integer to a method group and you're
regret it's because you forgot the
parentheses so that's one way to build a
delegate and that is a simple delegate
it's a normal delegate Al and is
actually a lambda lambda is actually a
thing and it's different in a couple of
ways that I won't go deeply into but you
can explore the idea of closures is the
distinction right there lambdas can
capture values now we aren't generic
delegates which means we have
strongly-typed delegates we are not in a
JavaScript world we are in a different
world I said that c-sharp handles
delegates brilliantly
it's a beautiful basis on which to build
the kind of thinking I'm going to show
you in a minute and code generics are a
big part of that it's a critical part so
I want to make sure that a few little
methods don't look too horrible to you
but before I get there we've got this
thing about the multi-class delegate you
don't care about that that's just what's
going on under the hood these will mean
the same if I say that we're delegate if
I say the word lambda I will try not to
say lambda expression I'll show you in a
minute waters a little bit of a
distinction there and F if I show it on
screen means the same thing the code
fragments can be stored to execute later
their code is data
you've seen this before funk of tea
fantastic funk of tea is very boring
what is funk of tea to Frank you've te
can return an integer like 42 or the
time on your system which is it can do a
pure method can be handed of something
secure method which is very very simple
because all I can do is return one thing
being passed to nothing we have
different versions of this T t1 t2 oh my
gosh please don't write code like it
looks like this please I am using
numbers because I have no meaningful
words put in there when we start looking
at code you'll see that I make a point
of T result T data t context T whatever
this is the more interesting version
which is t1 and t2 where t1 is a
parameter that's passed then t2 is what
you're given back it's always the last
one is always what you're given back so
if it's T t1 - 2 - 3 - 4 - 4 so it's
return n t1 the first 3 or 4 I can't
remember how I counted was are going to
be the parameters here the parameters
passed something gets returned and going
when would you ever do this T t1 t2 that
seems too deep that sounds too crazy but
remember I talked earlier about the fact
that you at least across layers when
you're doing functional thinking and
you're working on purity and you're
working on making your systems be very
predictable you may want to have a
container we'll call it a result that
container contains a couple of things
it contains the value you want across a
pass across that layer boundary or
between those two methods it contains
whether success happens and it contains
information about the failure so that up
the stack somebody can figure out how to
report that whether it's logging or
something else so while T 1 T 2 T t1 t2
looks horrible not so much when we say
it's a task of a data result of a list
of a student which by the way is T 1 T 2
T 3 T 4 this for there okay so I hope
that as you work with functional ideas
you get what this is
completely comfortable as comfortable as
it would be for you to have a function
that have four parameters just like a
function or a method with four
parameters you want as many as you need
and no more so as you add parameters
type parameters - generics like this you
will get a headache eventually but I do
think out to about four you want to be
quite comfortable with in the same way
that you're quite comfortable with a
method that had four parameters that
don't have any questions somebody yell
if you've got a question no questions
all right this is a sum of four lambda
in c-sharp in if I how many VB
developers V V does all of this with
more verbosity so if your VB developer
and you want help kind of translating
these ideas to VB let me know in c-sharp
this tells us that we're going to create
a lambda expression and here is the
common way that we would do that which
is a func this one has two parameters
you pass something in and you get
something back in this case they happen
to both be in I'm passing in an integer
and returning to greater than that
integer pretty simple we're used to
seeing this there's two other syntaxes
that you see slightly less often some
people aren't familiar with which is no
parameters and multiple parameters so if
you haven't seen that syntax there you
go because you'll see it again in code
so I said that I will try not to say
lambda expression although we have all
gotten very careless about doing that we
say lambda expression when in fact we
just want a lambda meaning that it may
either be a lambda delegate or an
expression and you're going well I
didn't know there was a difference who
cares whether there's a difference and I
think it's actually I think it's
significant to understand this and it
gives me an opportunity to show you
something which f you haven't seen I
think you should get quite excited to
them so I'm going to go to the class
tracker repository in the sample and I
will post this sample I am working
towards making this a reference app on
github I'm not there yet
don't have enough written about it but
if you want to help me with that please
let me know but right now I will give
you this code I'm going to right click
on the class tracker repository and I'm
going to select initialize interactive
with project when I click that it's
going to wear for a minute because it
has lots of work to do and I will say
that visual studio is slightly less
stable with the interactive window open
and i have not tracked down a bug to
report yet but if it crashes we'll just
start over okay so it's set up a bunch
of is taken the references that I have
in my project and put them into this
window so that I'm ready to go and that
does include the project I right clicked
on so right here I'm going to say using
because I want to get to that project
and so kajan I still think it's a good
idea for us to have our first part of
our namespace be something quite unique
I own that domain so class tracker is
the name of this overall application I'm
working on and I'm going to say I have
an access to the domain so I'm going to
use the domain now I have a using
statement and it's just like any other
using statements you've done so now I
can say VAR x equals new course and I
owe it just needed arguments I'm not
going to fix that and we're still good
in the back on the side yell out if you
have a problem we're good back there
great okay so now what I want to do
instead is I'm going to save our funk
funk not var just funk funk of course
comma int now I can't do a VAR here for
a couple of reasons that will make sense
because expressions are going to be
expressions or funks depend on what
they're what they're assigned to a funk
is a delegate so I'm going to say that I
need to give it a name why don't we call
it F that'll be fine equals and now I'm
going to use a lambda I'm just I'm going
to create a lambda in this case it's a
delegate that takes X anything would
work there that's the course and returns
X dot ID
so all we just all I did was create and
that extra little red should go away it
was a mistake so all I've done is
created a delegate that returns the ID
when passed the course this is the kind
of thing that you might do in a select
in a link statement but what I want to
do here is make another one in fact I'm
just going to do alternate up arrow here
and I'm going to add a be lazy do that
first and go to home I have about six
keyboards and so it's always hard to
find the keys so I'll just do it Mouse
there we go
and now I'm going to type expression a
func what just meant longer that should
not have been that should have been it's
not there I'm trying to save too much
time get rid of that you knew where it
belonged
right here okay so now that should be
happy and I'm going to hits exactly the
same thing but one case of a func in one
case I have expression so now and
remember I'm just a visual studio I'm
just playing and I can copy this code by
the way into an application so if you
would like to especially old FoxPro
developers that did this all the time if
you'd like to write parts of your
application here in this interactive
window you can then copy it and put it
into your application and the copy takes
off the disk copy code and it takes off
the left little funny angle thing okay
so now what I want to do is I want
oh I I messed something up here and so
I'm going to do up arrow twice and so
that resets F so f is was assigned to
the first thing I accidentally assigned
it to the second I've reassigned it to
the first which is what I want I want to
come to come to this this one and I do
not want it to be called F I want it to
be called expr okay that way you can
tell the difference between them that
was my intent
I was just made a mistake okay now
you're all curious about this what's F
and what's expression okay are they the
same they're not the same they're
different they're different because
expression has more information it is
not yet compiled into a delegate it is
the code it is a tree of the code to
familiar with Rozlyn it is not rosin it
is something kind of like Rosalind
if you took a compiler course in
university and you know what the syntax
tree is you can kind of think of it as a
syntax tree although there's a little
bit of semantics tone in there so the
reason that I wanted to walk through
this so that you have a better handle on
expression versus delegate is because
with the expression I can do fun things
it has a body hmm a body actually can be
of different types so I'm going to ask
it what type it is and show you sort of
a little sneaky thing right here there's
something sneaky right here which is you
cannot find property expression you can
go search on the internet and you will
hopefully find a stack overflow question
that says to use member expression its
parent instead because property
expression is hidden so let's let's do
that let's say X PR that body as member
expression and let's just wrap all that
in parenthesis so we get the result and
now from that we now have a member
expression so we now have a member and a
member has a name from that we can now
get oops yeah I don't have a semicolon
at the end if there's a semicolon its
executed if there's no semicolon its
displayed for you so now I can get ID as
a string from the original expression
okay now why do you care about this you
care for a couple of different reasons
one of which is now that I can
understand that code you can actually
understand it as a tree as ax is
something real I can compile it and
create a delegate I can also hand it to
a different language and there is one
language we care about tremendously that
we'd be able to hand it to and that's T
sequel this is why link does the magic
it does because link takes this or
something very long and ugly that would
be much harder to show you and it turns
it into a sequel statement it says I
know what you mean you want me to say
select ID from course and this is how it
gets there
you can do other things with this and
when I show you some of the generic
hierarchies I have then a few of the
tricks in there
use exactly this so you can use it some
of you may know that razer uses this so
the razor when you put a statement like
this out and razor that's what it's
using I can also I can also compile it
and then I can invoke it any questions
on that okay so let's go back to slides
for a minute link link we already said
this select order by our higher-order
functions pure because they return a new
list there are some list methods that
are not pure because they alter the list
it was probably a bad design would
probably be done differently today
because there's no real value of
changing that list in place lambdas are
not free and the reason that I talked to
you earlier about the difference between
taking a method and removing the
parentheses taking a method I should
learn to do this taking a method and
removing their parentheses that is going
to give you a true delegate it's an old
style delegate which if you've been
doing dotnet for a long time back in the
day to build a delegate was a lot of
work we had to create a special classy
delegating thing for it this does all of
that automatically for you but it does
not create the extra overhead that's
going to be involved in the lambda now a
lambda delegate has very low overhead
but it's not zero so almost and perhaps
everyone in this room doesn't care about
that overhead but a few of you may care
if anyone here works on the.net
framework I would like them to care very
much if you work on Rosalyn which is our
compiler I like you to care very much
because these are massively compute
intensive operations that we as millions
of developers need to work very very
well and very very fast so if that's the
world you work in or something similar
to that
or your doing you really care about
microseconds nanoseconds occasionally
it's I don't know you could even get to
a millisecond I don't think you could
that very small overhead does exist and
so if you were to do a very tight loop
then you might notice it for almost
every single person in this room you
could not find the difference no matter
how hard you tried because you're going
out to a database and that takes half an
hour and it doesn't actually take half
an hour but from the point of view of
the day of the computer code it does for
comparing to a microsecond going to the
database is absolutely turna T so you
almost all don't care but I do want to
bring that up because it can there's a
few people that should think about that
so just a memory loops or faster
expressions contains the code definition
and not just a delegate okay now all of
you I hope understand the concept of
refactoring there's a way that you
approach your code that says let me make
it smaller and simpler and this is the
goal that you go to your code and do a
few kinds of refactoring one of the most
common is to extract a method I want to
explore extracting methods in a new way
so the first thing that I want to look
at is what's called I call inside out
refactoring because I've never found a
way to talk about this that's consistent
with anyone else in the industry so I'll
do what I can and if anyone's ever found
a better somebody who talks about this
with better words feel free to share
them with me
so what I want to do now is go down to
my inside refactoring section so here I
have a boring stupid piece of code I'm
kind of hoping I can get it almost all
on screen ok just a stupid piece of code
that we're going to use for this little
refactoring exercise the way you would
normally refactor which I'm going to
call inside out refactoring is to take
the inside part and take it out so
control period
I get extract method I hit enter and I
say what my new method name is that's
the Visual Studio 2017 experience for
extract method I think 2015 is similar
but that's not what I want
so I'm going to just hit escape ctrl Z
and that's the refactoring of methods
you're used to doing let's take a
different approach so let me come over
here to my slides and show you where the
tempted to do a drawing of this I'll
show you this both of these are also in
codes so you will see it both ways I
want to grab some code make a new method
and use it multiple places maybe use it
in multiple places at least use it to
make my code simpler so I've taken the
inside code this is just a little
graphic I've taken the inside of that
and I pulled it out into a separate
method and I've called it okay that's
pretty straightforward you do that all
the time what about the reverse what
about it taking the outside code that's
kind of bad white on yellow and then
take the outside and make a new method
so we're going to take this outside code
we're going to pull it out Oh am I now
what do we do we're going to create a
calling method which is a lambda
expression which is going to take the
inside so we're going to call our method
passing at a lambda expression to do the
real work we've created the outside
we've created the link like thing
without using link here and then we're
going to call it so let's see what that
looks like in terms of code so I'm going
to take this using statement right here
and I'm going to kill it and I'm going
to kill it by saying disposable I happen
to already have created this code and
I've created something called using and
that takes two parameters the first is
called a factory I appeared on new lines
of clarity and that's going to be what
is it that you want is using to be all
about and I'll say it's passing you
nothing I would like you to return
a new class tracker dbcontext so that's
my first parameter my second parameter
is what the work what is the work you
actually want me to do so I'm going to
highlight this we'll just leave the name
dbcontext as any other lambda expression
I can name the parameter anything I want
and it would be convenient to just call
it DB context so now I pass the DB
context to that I don't need the
semicolon here anymore
I don't need this although I do need a
close parenthesis and a semicolon here
and now I can get rid of not that I can
get rid of right now okay mr. control KD
control KD is what formats your entire
file and you can remember that forever
because it's my initials alright so I'm
not returning this right now I need to
say return here if I want to get rid of
the squiggle up there okay so can we
take this further we can and I have
another class which is called handling
because I've never come up with a super
good name for it because it does more
than just the try catch it does logging
does the try catch it does whatever else
I want to do in the future it does all
of that stuff in one place and the
common one uses a result so I'm going to
use something different I'm going to use
a demo version so I'm going to use my
demo handling one and I'm going to say
what is the work that you want to do I'm
going to come back to that squiggle and
now I've got all of the parentheses all
lined up we'll go look at that code in a
minute but I don't need anything else
now that's where we're going there's a
bug here which is that squiggle and this
squiggle can sometimes be hard to
diagnose so I created one so I could
show you this so when I do control
control period
it says actually let me let me just give
you the error says the type arguments
for handling with demo handling cannot
be inferred from usage if you do the
kind of
that you're seeing me do here and you'll
see in the larger application I'll show
you you will see this message I can
guarantee you'll see this message there
you go oh I shouldn't have to give the
type arguments here I know I shouldn't
have to but you get a different you get
a different warning you get a different
message from the compiler a different
error message from the compiler if you
go ahead and do it it's telling you to
do so what I'm going to do here is I'm
going to say oh this should be returning
an INT pretty sure that's what it should
return okay so now it gives me a new
error and it says yeah that's not a func
that's just a normal int there is no
func here there is no delegate here you
messed up you messed up because you
forgot that I need to be and I'll put it
on a new line for clarity I need to be a
delegate and so by putting it in there I
found out what the real problem was so
that's what you want to do just go ahead
put it in there you know you don't need
to if you've got Titan mismatch I'll
show you where it is if you've made a
simple error like the one I did it'll
show you right where it is and now
you'll notice that int is very it's very
light it's like oh you don't really need
me anymore and so all your control
period and I'll hit a simplified name
and int will go away foo has a squiggle
because I've not yet typed returned now
I've taken the code that I had before
and I have made it shorter in and of
itself who cares
in and of itself dropping out a few
lines officiated a little bit oh maybe
it's a game but it's pretty small and I
got new things to worry about and gosh I
don't even know if I like it that's not
where the benefit is and that wasn't
really where the benefit was and many of
your inside-out refactoring either it's
the fact that you can reuse it and you
can change it and it will be coupled to
every place that it was in use so let's
say that I do what I've got right now
I'll go to this I'll go to this code and
the only thing it's doing is a try if
I'm more time I go we'll keep your into
the
but you can see I'm just taking the
using step one step further that's what
matters here is that I can decide
tomorrow or next week that I want to do
logging or I want to do logging in a
different way or I want to do oh my gosh
I mean isn't really hard here
I want conditional logging based on
something in my compile step I can do
anything I want because I can call a
method and within that method I can do
anything I want literally anything I
want so what I've done is I've said the
way you call your code can be controlled
by a single method this is exactly what
linked us this is why I bring a link up
at the beginning is because if you think
about what the where clause but the
filter does in link it goes and it picks
up each individual item of the array it
does that every time no matter what and
then when it's ready to ask one single
question that one single question is
what is the filter then it executes that
filter and says you match you match you
don't match you match you don't match so
what we can do what you do with this
it's exactly the same technique except
that we've used it in a different place
so this is one of the core functional
pieces I'm showing them and show you
into a larger application I'm going to
show you it with some deeper generics
but if anyone has any questions this
would be a great time you're not to
shout them nothing I don't hear you okay
okay so let's pop back for a second two
slides and this just mentions four sites
that when you get the slide deck we
haven't yet put it up but I'm sure the
conference has a place I can put this if
not watch my Twitter feed and I'll put
it someplace you can find it but
Pluralsight has these two great courses
if you're listening to what I'm saying
today and you're saying man I'm
interested I just don't totally have my
head around it these are great courses
to take you a little bit deeper they
definitely take some different
directions than I do but this core what
can we do with functional stuff in
c-sharp they don't they cover in those I
want to take it one step further in a
slightly different
in ya NT of time oh great
it's wonderful so everything I've shown
you right now is kind of cool kind of
fun I'm going to not going to shake your
world up to you badly what I want to
show you right now is a different way of
thinking with this that may cause you to
rethink some architectures over the next
few years and when I say architecture in
my world that means something very
specific to me and I respect every
architect that does all the other stuff
that I don't do as well and that is once
you get down to the space that you're
working on if you're doing micro
services you've decided what the micro
service does if you have a different
kind of application you've decided what
you're going to do you've decided how
your layers are going to get to put
together you've decided what your
database looks like now you have to
write code and I want that code to be
exquisitely beautiful because not
because I'm just like Beauty although I
do I want it to be exquisitely beautiful
because exquisitely beautiful code is
easier to maintain I don't mean elegant
code I don't mean complicated code I
don't mean tricky code I mean beautiful
code which is code you look at you go I
know exactly what that does that's
beautiful code that could that's easy to
maintain but in order to show you a good
example I am going to show you some
broad or architectural ideas I'm going
to show you the way I think about code
and some architectures have been working
on for a while so three layers that's
pretty common Web API services
repository that's all pretty common
within each of these layers there are
separate calls to pure and impure
methods the pipeline through this cannot
be pure my goal in life is to change the
name of the course my goal in life is to
sign somebody up for a course my goal in
life is to create a new organization not
pure can't be pure don't want it to be
pure that's a central line central line
through there but from that when I'm
doing something complicated if there's
any possibility I want it to be pure if
I'm doing something that
be pure I want to isolate that from the
things that can be pure if I'm
calculating how many students will be
able to be in a particular class because
it's dependent on the request of the
instructor the room size the time of day
three other things I can handle that
information in and let a calculation do
it if I'm doing something that has to do
with something else where one object
needs to change another object and
something complicated that's along those
directions it's a different method it's
a different call now the next thing on
this is that this is just the jobs it's
not too interesting is that I do not
pass exceptions across boundaries I have
felt strongly about this for a very very
very long time and here's the reason has
nothing to do with functional nothing to
do with generics nothing to do with any
of this it has to do with the fact that
it takes your technology and passes it
across the wire or it's not really a
wire here most the time I'm talking I'm
not meaning that we're crossing like a
bus these are like two things they're
actually have DLL references so you
could say oh if you give me a sequel
exception I'm going to do this
I thought you give me this kind of
exception I this is what I'm going to do
but let's think about that for a second
what if I'm not using sequel what if I'm
using something different you just gave
me a single exception you didn't give me
some other kind of general exception you
gave me a technology specific exception
let's not do that
let's keep our technology where
technology belongs in each of these
layers that's why I don't use exceptions
instead I pass a result the result has
information inside of it including
whether success happened purely for the
sake of debugging because my team likes
it much better that way I actually do
include the exception in that but I do
nothing in terms of control flow from
that it's just a matter here it is for
debugging you wanted the stack trace I'm
not going to hide the stack trace from
you okay so it's like a little bit more
code
I'm going to open up the repository here
for the course okay so I have something
called a course repository it inherits
from something called a base entity
framework repository that takes four
count them four for generics the course
this is a course repository I'm going to
return a course one more thing I
separate out my domain for my enemy
framework models they're different
I'm EF course which is the ND framework
model and I have a course that I'm
passing across that logical boundary so
I need to have what am I actually going
to return the course fee of course
what am I actually going to be talking
to any framework with what dbcontext am
I going to be using and also what is the
primary key that's the integer okay
that's pretty cool now to the base class
constructor our hard code
this is a course repository it's nothing
else this is a course repository the
course repository says well gosh okay
once you get to that dbcontext how are
you going to get that particular DB set
so how are you going to talk to that
particular table is to have a different
table okay
great get DB set I kind of get that
that's another one of those yeah the
higher-order stuff okay and then we get
the primary key given a course we get
the primary key you've seen that earlier
I do go to 140 240 I hope all right and
then I need to map given a given and a
framework model give me a domain give me
given a domain give me any framework
model ok now I had those methods in this
I happen to put them in in a nested
class if you haven't seen those two
classes that's all I'm doing here and so
I've got those two methods and another
one that we don't care too much about
right now so I'm going to hide it but
I've got domain two entity and entity
two domain they're a little bit
different because the demands of any
frameworks okay guess what
I'm out of curly brackets I am all done
I'm all done every single thing this
needs to do for normal credit is now
complete I've done everything I need to
do and that's because above this in my
base entity framework repository I've
done all of the work it takes the things
that you've seen it names the generic
type parameters it has a property for
that DB set and then let's come down
here and look at one of these now if I
had another 15 minutes I would refactor
this to look like the next one but as it
is I would like you to just absorb this
understand where we're going and then
I'll just jump to the completed one
that's the piece I had to cut out so
we're going to simply get the DB set
we're going to do any filtering we're
going to get to the specific one we're
asking for and then we're going to map
that mapping here is a is a delegate
that's held in this base class because
every time we do a generic it has its
own copy of that so they each get their
own copy of these properties and then I
create the success result if there's an
exception I create a failure result now
I'm going to switch topics a little bit
but I think you're all going to be fine
I'm hoping your I'll be fine with that
that was getting won by ID this one is
get all and now this is all that that
needs to do so with rap DB set I'll show
you that there's different ways that you
can handle this again I'm saying that
every time I touch a DB set this is the
way I will get there so therefore it's
common code it allows me to have custom
code in a repository that needs it and
I'll get back to that point just as I
close so we want to look at that method
I'm sure I'm sure you're dying to see it
there's some funny things about the way
that that when link goes to the database
and back is why there's two lists in
case you were seeing that it's not
actually a typo it's needed because one
two lists happens on the server the
other two lists happens on the client so
with the wrapped DB set says though with
wrapped dbcontext give me the set with
let's get that one with the wrapped the
wrap dbcontext some
says give me a new one we saw this code
almost identical to this earlier in the
talk
give me a DB context and then run an
operation on that the DB context is
defined as T DB context as a type
parameter to this class okay
so jumping back over to the course
repository what I wasn't going to do is
I know you'd love to see this code but I
really want you to see this class in
total so I'm going to see if I can do
this okay there is an I'm going to yeah
let's just go ahead and collapse this so
you get the the general gist of this is
what I want you to have I know you can
no longer see the code but I want you to
just think about this in totality
this is a course repository this is
freaking simple there's nothing I need
to do courses are easy courses aren't
hard in my world courses are terribly
easy
nothing special ever happens oh but
students students are very complicated
students have a lot of work now a new
person walks up to this application they
walk up to the course repository and
they go up yep got it
nothing hard everything's easy oh I see
the mapping they go up to the student
repository and the student repository is
overridden some of these methods because
a student repository is something more
complicated to do the student repository
has more work and the person walking up
to this has no problem seeing this right
there in their face oh my gosh
student repository is complicated course
repository is easy if you think about
your application today and the ones that
do the code you have at home right now
if you could take every single thing
that was easy and make it easy dirt
simple
nobody can overlook the fact that it's
easy pull out the parts that are
complicated let the human deal with the
parts the human being needs to deal with
and take all this other junk that we're
doing I'm trying to tuck it away using
every single technique at your disposal
but I hope I've done today is showing
you one or two additional techniques in
the area of generic hierarchies and
functional programming
and some new ideas I hope in terms of
how you can do that or the ultimate goal
make the simple calls make the simple
code easy let the complicated code be
where the humans spend their time thank
you very much for spending the last hour
with me and I hope you have a fantastic
conference</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>