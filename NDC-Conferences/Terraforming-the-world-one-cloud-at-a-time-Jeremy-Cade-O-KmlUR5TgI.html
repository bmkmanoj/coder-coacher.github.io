<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Terraforming the world, one cloud at a time.  - Jeremy Cade | Coder Coacher - Coaching Coders</title><meta content="Terraforming the world, one cloud at a time.  - Jeremy Cade - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Terraforming the world, one cloud at a time.  - Jeremy Cade</b></h2><h5 class="post__date">2017-09-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/O-KmlUR5TgI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I apologize this is kind of a dumbed
down version of the talk that I actually
wanted to give this got sprung on me
yesterday so I put this
together in about an hour so if it sucks
come at me later and catch me outside
all right good deal
let's go she would think me is gonna
play nicely I'm not there we go all
right so me I'm this guy stupid all
right stuff this a week and if I have to
play nice all right yeah I'm this guy
this is my official title by the way I
am the chief trouble maker people come
to me and they have crazy ideas and I
say no and then business gets angry
which generally leads to things like
this happening so story when I started
at my current role they dropped me into
a place that had all of the
infrastructure right click deploy Visual
Studio all that great stuff you know
rubbing the dead post on it it was great
fun I loved it
everything was deployed to AWS in the
one region Telstra drops a connection
everything goes out we had 10 events on
them all the money disappears and people
start crying literally I had a woman on
the phone crying because her event was
going to explode because she couldn't do
tickets couldn't do this blah blah blah
and my ass is on the line and I'm
turning around to the other dev team
guys are there before me you said hey
what's the disaster recovery plan like
how do we get our infrastructure back up
they went oh you know like you go into
AWS and you get a new VM and then you
take the deployment package over here
your IDP and copy paste our Soccer
changing configuration you know all the
lovely stories like it it's the worst
case scenario that you could ever bloody
have and then I end up like this because
I've lost it I'm fallin off bikes now
because I'm going crazy because I can't
get my infrastructure back up and yes
this is the three times that I've fallen
off in the last six months so this is me
I'm sitting there going what the hell is
this this this is not cool we can't get
the infrastructure back up quick enough
because prior to that I come out of an
environment where if you infrastructure
goes down I click a button is back up in
15 minutes across six countries it ain't
that hard right apparently it is because
everybody can't get a
so that kind of went into a different
little journey I'm like okay I don't
want to go back to this situation where
I have everything that's defined in code
there's checked into source control this
version that I can run and get my
infrastructure back up as quickly as I
bloody well can so I started looking
around like okay we're on AWS cloud
formations the thing I don't like cloud
formation it's powerful I just don't
like it I don't want to deal with it so
I want something nice and terraform is
nice it is super simple and it's a tool
that's going to help you to manage your
infrastructure you can define everything
can card hit terraform apply it goes out
it is great I love it and it's really
simple really powerful you can be as
simple or as complex as you like because
it gives you a nice high-level
abstraction over the top of
infrastructure so that seam structures
service the the past offering said
things like Asia even software is a
service you can basically go out and
provision things in Salesforce if you
really wanted to if you're that type of
crazy I think it'll do BizTalk commerce
say it will do Commerce server but only
for you I hear they use that at ATS it
plays so that the best thing about is it
plays well with others so my pipeline I
love being on the command line I love
building tools together where I can take
the output of one thing path into
something else and you know I like I
like that whole UNIX II kind of concept
of do that one thing do it really well
and pipe it out for something else so
for me having a tool that plays well
with others is really really important
the other thing for me I said on this
single day and then I write software for
Windows and Linux so it's got to be
cross-platform on a Mac tomorrow I'm on
another devs machine I'm helping them
out and they're running Windows Ice the
ones you better run my infrastructure I
still got standard up I've got a I need
to be out of ship this to my CI service
that could be in Windows Linux whatever
I feel like running that day so if it's
not going to run everywhere I don't want
to touch it so this is kind of where we
get to we get to the the command line if
you see the command line and you're
scared of it I highly suggest you change
jobs because that's where we're going
back to this is our world we live here
now it is powerful like all things
as it is a powerful tool you need to
treat it with respect you gotta treat it
the right way because if you do
something crazy it's not excused to
shoot yourself in the foot right I grew
up in the states with people held like
you've got guns you can own a gun that's
cool you got a responsibility you shoot
yourself in the foot you're an idiot
it's the same with the tooling right
treat the tooling with respect it'll
help you out if you're actually per with
it yeah might cost a few toes now for me
again I love the simplicity of things so
the mantra that I take into everything I
do is keep it simple because I deal with
complex nasty solutions all the time and
I hate it
I love simplicity sorry the more simple
things can be the better for me
personally so anyway that's enough me
yapping on let's actually dive into this
stuff now I do apologize up front as I
said I kind of put this all together in
the space of an hour I've done a version
of this talk previously in Brisbane
where I basically steps are all these
different little things so what we're
basically do is I will step you through
standing up and provisioning some very
simple services now terraform is a has a
nice little DSL
again it's Jason like so you can treat
it like it's program you just sexually
and it has really three main constructs
that you need to worry about we have
providers and providers of things that
allow you to talk to an infrastructure
provider essentially AWS as a Google
cloud you know pick pick your poison
this what 68 of them at the moment that
it published that an Arn and you can
write your run that's the other thing so
for me one of the environments that I
have to deal with because I work in an
events company is ESXi hypervisor
alright we put them on a little Intel
milking we ship them out sometimes I
actually have to stand up vm's and put
stuff on that well I can use the same
tools that I use to provision my
production infrastructure in the cloud
to provision my books is that I'm going
to send out to the shows it is really
really powerful or so that's me we do
some cool things so that first construct
that we really care about is that
provider the second construct which is
important of variables because you have
different configurations right
you have different places you're going
to production might have a set of
variables
station might have a set of variables
basically allows you to take that same
set of infrastructure that same
definition of your infrastructure
Thrall a different set of variables at
it get a different environment super
super powerful I use it every single day
in my CI CD pipeline the other thing
that we then care about is this concept
of resources so we're gonna provide it
you have multiple types of resources so
in this case we're talking about
standing up a VM from an ami in AWS so
I've got to tell it what I need so I'm
asking for an instance right it's an ec2
instance so I want to AWS instance I'm
gonna give it a name it's gonna be
WordPress because you know WordPress is
easy to stand up I guarantee you I stand
it up I'll be compromised in about five
minutes that's all right I'll kill it
and then I'm gonna tell the size so for
me you know in this scenario we want a
nice little small box it's not gonna
cost us anything I'll just stand it up a
space what we can do stand up an ec2
instance from an ami and we're off to
the races
now the other constructor that I care
about because of the way that I
provision my pipelines and put my stuff
together he's getting outputs from this
tool because again it plays nice with
others so I'm gonna stand up a bunch of
infrastructure and then I may need some
information about that infrastructure to
pass to another service maybe monitoring
or maybe I need to send things out to
another DNS provider or something else
where I can't do it with terraform I'll
shell that out and then I'll throw a
bash cripple something out of go do some
other cool stuff so we're basically
going to get an output from this so when
I run this script it'll tell me where it
stopped with the DNA century so you know
ec2 instance let's take five minutes to
come up we can then go straight hit that
DNS entry get access to it so actually
let's take a look and see how this works
out if you wants to play nice for me
sorry there
so I make sure you do first because I
ran that earlier so well that runs I'll
just jump back over so just to recap
very quickly closed track that I care
about
we got the provider the other construct
that I care about in this case is the
region so our variable because I want it
to go into Sydney I don't want to send
it to Singapore the other variable here
that you see this AWS key name that is
going to come out of an environment
variables on my machine so this is the
other powerful thing about it plays well
with others so I can take advantage of
environment variables set up on my
machine or my CI CD pipeline then I'm
gonna get the thing that I care about in
this case which is that ec2 instance
stand that up and then I'm care about
what that DNS entries for that destroy
that very quickly come on so terraform
again because it's command line will
give you all of the help that you need
on the command line so what we're
actually gonna do here I'm gonna run
terraform plan to begin with what tera
phone plan is going to do it's gonna
tell me what it's going to stand up or
what it thinks is important for this
particular run it'll basically give me a
graph of what's going to be stood up
I'll then run terraform apply and that
will stand up and provisional the
infrastructure once that's done it'll
kick me out of DNS entry let's take
forever
that's why live demos always hard and
mine always exploit that's the fun part
oh yeah yeah alright stop it
this is what I'm gonna do terraform plan
actually okay that said stop screenplay
so at the moment because I've got stuff
running the background is telling me
everything is bad everything is wrong
that's cool so what happens when you run
these things tariffs um actually builds
out a state file and it stores it all on
disk I'm running tariffs on locally so
just a file is local to my machine when
you run this in a real environment you
have basically a back-end provider so
you might shell all of your store all
your terraform State in say yes three
that time whoo all right sorry you know
I was terraform what it thinks it wants
to do so what it's going to do a section
to go out to easy to its AWS it's
connecting to my account and it's going
well for my stuff what am I gonna do you
know do I need to stand something up do
I need to create something in this case
yes it gives me a nice little green plus
it says I'm gonna create native AWS
instance for me
he knows what ami is gonna give because
that's the information I gave it
everything else that'll work out for me
it picked up the key cuz this is the key
that I have on my machine this loop
staging this will go into my staging
environment so also now stand that up
terraform apply so what I'll do is we'll
go out again and stand up the instance
for me now normally depending on the
size the instances some of these things
take you know thirty seconds some of
them take twenty minutes just kind of
depends on what you're dealing with
generally I don't run this off my
machine I normally run it out of Jenkins
and I keep all of these types of
configurations and these these
infrastructure pieces close to the
application so I'll have a set of
applications that I need to deploy my
infrastructure code is with my
application code so this is run it's
created than your resource for me and
it's spat out the DNS entry where this
thing is that so given them that this is
a tiny easy to instance it'll probably
take the Linux box it'll take five
minutes to spin up if I then go and hit
that will get a bit Namie WordPress
hello world type deal now again the nice
thing about this stuff is is that as
simple like that for that infrastructure
all I've told it in a single file is I
want to talk to AWS I want to stand up
and an ec2 instance in a reach
that's simple right you can keep all
these files in line with everything else
it's not too bad but that's kind of like
the hello will
right how many you know do people
actually deploy hello world applications
is that part of your core business
because if it is let me know I can help
you out but what about something a
little bit more real-world like and
again for me keeping as simple as is an
important thing so you know you kind of
standard real world type scenarios you
start talking about having V pcs and
having you know public and private
subnets and there's databases involved
and all that type of stuff like it's
fairly standard into pricey type stuff
right
well terraform gives you the about it
gives you the power to be able to do all
that so again you're still working with
the same constructs you're still working
with things like resources and variables
so in this case I want to stand up a new
a WSB PC with public and private subnets
Internet gateway so I can actually get
some internet into the thing because
it's a V PC so you've got public subnets
in two regions or two availability zone
sorry set up some routing tables so I
can actually get some traffic from my
private subnet so your my public subnet
vice versa
might need an elastic IP Internet
gateways all this type of stuff so when
it's all contained here in the files if
at any point in time I need to go make a
change I can see what it is it's the
fight for me and I can version it which
is really important the other nice thing
about this is we also got access to all
the security groups and things like that
so I can set up the security stuff that
actually name right from the get-go so
in a lot of scenarios you'd be using one
arm or something similar to shell into
the box and provision things and running
configuration essentially if you're not
using the golden image approach RDP if
you still have to do things like that I
feel bad for you I'm sorry abandon
synaxis
sequel port stuff like that just been
honor to connect to things right the
nice thing about this is again if you're
in an environment where you have
regulation
and they come in and go what do you
security groups look like I look down is
this you hand them the file and go there
it is it's documented for you that's it
that is the configuration and that
configuration doesn't change because I
run it once if it needs to change I
destroy it stand up the new instances so
when you start getting to these real
mercenaries we start thinking about how
do we to separate these things out how
do we chunk them down into small pieces
because again for me keeping it simple
is kind of core to my ethos I want to
keep it simple so I try and keep
everything in this situation based kind
of on the feature idea well what's the
feature I'm dealing with all the feature
I'm dealing with is the V PC so all the
V PC information set or the feature I'm
dealing with these securities for a
private subject well that's all in a
private subnet file it's just how you
want to break that down so you can take
an engineering approach to this far to
describe your infrastructure which makes
this stuff really powerful so private
subnet
I've actually got something I want to
stand up and that's gonna be a database
now one of the cool things about this
DSL is it does have those programming
constructs so we can do things like
looking up variable sets and actually
looking in things into dictionaries and
saying well if you're going to go into
say Sydney versus Singapore we're gonna
have a different set of a.m. eyes or
we're gonna have like a different set of
things for each of the regions so what I
would tend to do again because I have
data sovereignty issues for some of the
work that I do we have different setups
for a VMs so there is a different
security requirement for my company in
Singapore than there is in Australia and
there's a different set of data
sovereignty problems that I need to deal
with now one of the things that I cheat
with in this situation is the actual
provisioning of the VM all the
configuration management in this case
I'm just gonna punch it in from a
PowerShell script when it runs well the
PowerShell script is gonna do is
basically take it back up and restore it
but again I've got the ability to do
that so if I need to stand up a copy my
infrastructure I go to terraform apply
it pulls all the backups down and
everything's great and the world just
works and it takes about half an hour
from start to finish a full copy of my
production environment done now in this
situation this is you know it's it's
kind of like a real wood case but we're
only dealing with one read one provider
for me my approach to the cloud is you
know AWS is really good at
infrastructure as is good at pass
Google is good at containers if there's
something specific that I need from a
provider I'm not tied into either of
them or any of them if I want to go to
digitalocean get something I can go to
digitalocean to get it I will use the
best provider for the best services
terraform gives me the power to do that
but in this case we're just caring about
that one provider right I have a public
subnet as I've said there's a public
cellmate and a private subnet in this
particular scenario what I tend to do
here set up or die scaling groups things
like that because I like horizontal
scale all of that configuration I can do
in here so in this case I'm setting up
in order scaling group telling what the
launch configuration looks like you're
gonna use one of my allies that I've set
up what the scaling policy looks like
because you know this is a fairly
simplistic view of the world saying
scale up alerts all those types of
things and none of this stuff is really
all that untoward but again I can define
it in the code which makes it really
nice for me set up my load balancers
same deal again in this case I'm being
lazy and importing or I'm terminating
SSL at the load balancer and then
flicking stuff back to the virtual
machines because it's a demo please
don't do this in the real world I will
hurt you
same deal again with the security groups
whatnot now the other thing that I've
gotten here is this concept of a tariff
on bass file now these particular things
things that get defined in a TFR file
are things that you can pass in on the
command line or can be read out of
environment variables so in this case
you know I want to have a V PC IP range
that's been a 10.1 3/16 I'm gonna get
some stuff from octopus deploy so at
least that I what marked its employee IP
addresses so I can
punch the right holes and you know where
I'm gonna set up the database nothing
too crazy and then again I've got a
whole bunch of availability zones and
variables and other bits and pieces now
there is a bunch of really nice help of
features in terraform and they're
generally their provider dependent so in
this case I've got this thing called a
data construct the data construct allows
you to get a list of information about
providers so in this case I want to know
what availability zones are available
within my region because anybody that
deals with AWS says you know different
regions have different numbers of
availability zones so in some cases
you've got to some cases you've got for
Australia we've got three whatever it is
at the moment but I don't need to know
that information off the top of my head
I can let terraform handle that for me
it's just some basic information about
what I'm doing with my Mis which ones I
want to use the BBC ranges keys the
other thing I'd like to do with
terraform and this is part of the way
that I like to work when we run our CI
CD pipeline we stand up all the
infrastructure we get the DNS entries
back out of where those instances stood
up and what they are we then go and set
up our routing through route 53 so what
we can actually do is take our routes or
take our zone definition the zone files
and we can actually do some really cool
split load toasting so okay I just stood
up a new set of features it's gone to a
brand new set of infrastructure I want a
sense 20 percent the traffic that so a
lot of people generally would do
something like have you know a feature
flag or something in their application I
take it above that level because I don't
have the application dealing with that I
just want to split some of the traffic
off so I can do that by setting up
things in terraform so one of the things
I do is they pass in their zone IDs so I
can actually then go and work against
other pieces of infrastructure in ec2
that aren't being managed by terraform
so everything that I'm going to create
when I do terraform apply here is going
to stand up brand new instances of
things but I already have some existing
infrastructure that I want to play with
so I'm going to make some modifications
to that and terraform will handle it
quite nicely so let's take a look-see so
again in this case I want to see what
Terra forms gonna give me so this
particular set of stuff will go out and
say I need to stand up a whole bunch of
things so as the Saint is checking for
the availability zone so it's going out
too easy to me saying what's there and
this case is telling me it's actually
gonna stand up 18 different little bits
of kit so anybody that's that's had to
stand up things by hand and ec2 knows
that you know you can get pretty
complicated pretty quickly when you
start talking about VP C's and things
like that it's very time consuming what
it took for me to actually write out
these scripts for the first time I did
all this was about 40 minutes and I
haven't had to change them too much like
this is again a scaled-down version of
what I used a and day out but it's
pretty much the same so we're gonna
stand up a bunch of things right
actually yeah one other thing we can
have two quick look at don't worry about
it later
so this will actually go out now and
stand up with that infrastructure for me
so what happens with these powershell
files they're actually getting
serialized well what Tara formal through
Tara phone will read that information
out of them will actually read the
powershell out and put it into where are
we typed into the user data okay so this
is this gets into this whole realm of
provisioners again in this situation I
mean quite lazy so I'm basically just
telling the box I guess the ami stands
it up and we're throwing some key
configuration information into the user
data so when that box finally comes
online because Windows images take 15
minutes for them to stand up I think you
guys got it dad's like 12 something our
box is taking about you know anything
from 15 to 17 minutes to stand up which
drives me insane but part of the reasons
they come online and then we need to run
some additional configuration against it
like setting up octopus tentacles and
things like that so I can deploy
applications through them we do all that
within the bootstrapping step so there
we go so just a a word of warning if you
ever see this particular person in any
of your demos do not put keys in them
because he will compromise your system
he's done it multiple times never to me
so this is actually if you if you tried
to you know if you do some basic googly
if you locked opposed deploy you'll
pretty much fine this script on the
Internet's this is kind of a standard
way of just installing the tentacles so
what that script does is it gets read
out put into the user data when the
Machine comes up on line I go out
install the tentacle talk to octopus and
say hey give me all the things that I
need for this box so again this is kind
of like the poor man's configuration
management if you have shell or
something like that
cool I just don't have the time or the
energy to set up more infrastructure to
manage infrastructure so it's flowing
tentacles that type stuff it just it
does the basic stuff that I need it to
do so in this case it stood up
eighteen resources if we go take a look
at AWS just to show that I'm not a
complete nut we see here this is
actually the development ASG that stood
up for me so there is a scaling group
that's been stood up you see that all of
this stuff a lot of these things for me
a very short-lived so pretty much all of
this stuff would have come up a died
today at some point it's a penny and
what's been deployed within the office
back at Brisbane the nice thing is they
again being short-lived if at any point
in time I don't like what's going on I
come back in here destroy it
if I can type
really really powerful kit for this type
of stuff does it run one that's the
WordPress one wasn't it it's got to go
anyway
before we do that now what I have it
really covered actually and this is a
thing that we should talk about the
thing that really does make this is
quite nice is the ability to to ship
things between instances and when I say
that we're talking about actually taking
some information about an ec2 instance
or a resource that's topical to another
resource and providing that information
back forward so what we can do with is
the private one what we can do with
things like this so I want to stand up
an ec2 instance now this instance has
some information or some property some
metadata that's actually really
important to me I could use that a see
two instances metadata
I'll show you this will be better we
could show you in here so ec2 instance
yeah there stand up for web box now it
has some metadata it's actually very
important to me what I need from that
ec2 instance is some information about
where it is
so what terraform actually will give us
is that metadata so we actually have
access to that metadata within other
scripts so I can say for this you see to
instance I need its name its DNS entries
private DNS entries a whole list of
things that I can go get about it and
pass that information off to another
resource within my terraform script so
it enables me to set up security rules
and things like that or you know pass
things through someone or e-solutions or
change the configuration somewhere else
without having to copy and paste and
everything else terraform will actually
work that out
what needs to be ware based on a set of
graph dependencies extremely powerful
now in this scenario we're talking about
that that kind of real word situation
public/private subnets a you know
they're kind of par for the course at
this point for me though again as I said
I like to have the ability to pick and
choose the best things from different
cloud providers so one of the things I
really care about is you know who's got
say a better thought of a solution well
unfortunately I have to run sequels over
some things it's stuff that I've
inherited sequel ash is pretty good it's
actually quite cost-effective for it it
is so boss comes in business comes in
and says we need to reduce our AWS spend
about $15,000 this month what can you do
I go kill the high availability sequel
boxes so I don't have to iron them
anymore please that sounds like an idea
what else can we do or we can use sequel
RDS mmm one region
I've already been bitten by having one
region what other providers out there oh
there's a certain sequel a is okay does
the job cool
I'll go get that it's cheaper does the
same thing that's close enough to what I
need it to do how can I do that do I
have to go and do the Microsoft where I
click to play for Visual Studio or other
DevOps on it to get a single box no
thanks so I'll manage it with with the
code so then I started digging into well
how do I get the Badger providers and
things to work well that kind of brings
you into this whole concept of and the
power the real power of terraform is
being cross plat across provider so in
this case I'm going to be dealing with
three providers I'm gonna be dealing
with AWS and I'm gonna be dealing with
that so that's kind of powerful
particularly if you need to be in an
agile environment where you need to move
quickly because it's a call can its call
competitive advantage these days if you
don't move quick you're gonna get eaten
right so I'm sitting there going cool I
can spin up stuff into clouds at once
and I don't have to open the azure
portal and I don't have to open visual
studio and I don't have to open the ec2
portal
that's kind of cool so when I call I'll
get a web box or stand it up but what
about standing up my resources and other
bits and pieces in a Joe well cool they
have stuff available for that so in this
situation I'm going to stand up a
resource group because everything's
attached a resource group to Nigel I
want as the sequel server so I'll stand
that up I want that in Australia rais'd
makes a lot of sense if I want to I can
also configure redundancy and the the
data backup to another location I can do
that in terraform so I can manage my
tight database infrastructure out of
this that's really cool
tell her what the Logans and the
passwords are because when you create
these things that gonna have admin
passwords can you speak to someone about
that please brillo thank you I need to
set up a database now the database here
is kind of important because I might
need some information about that later
and I've got to set up firewall rules
because I need to have my ec2 is there's
been out of talk to this thing in Asia
so this is again is where we start
talking about well this metadata
attached all these different things and
I need to get them from one provider to
another how could I do that
in the old days it would be some CLI
Monson's shell that out grab some other
stuff okay over here another set of
credentials the hot water pane here I'd
do it in two files it makes my life
really easy performance
to be honest it doesn't really matter
anymore and the environment that I work
in it doesn't matter if I was doing high
frequency trading yeah that would matter
but for my environment it doesn't
and again that's a business thing right
this is gonna go and set up some stuff
for me and to be honest like when we
start talking about stuff being across
cloud everything we built today is a
distributed system just about everything
like that's what we do we build
distributed systems whether you like it
or not so the whole concept of eventual
consistency and things will happen
eventually is a real concept so not
everything is ever gonna be as fast as
you want but then again we've got
companies that service Australia to set
up all their infrastructure in u.s. West
which even at the possible the best
possible speed is going to be terrible
so having the stuff in Australia and
making a call from ec2 to Ashley in the
same city same thing
mmm-hmm no it just worked it out so once
this comes off will actually generate a
little graph and we can actually see
what's going on sorry
what's the provider use the most as up
as I made an announcement today that
they're gonna throw a whole much more
resources at it so for me the thing that
I use the most and as your app services
and it's the one thing they don't
support so I write my own provider I've
got the ability to do that and again
it's open source so I can't do that one
of the reasons why I don't like using
say as a resource manager or
CloudFormation is that I'm then
dependent on Microsoft or Amazon to make
changes for things terraform I can get
around that I can do it whatever I need
to do and it's the same situation there
are new features that come out in Asia
that don't get dealt with a national
resource manager or there are new
features that come out for cloud for for
easy to that nor AWS that aren't in
cloud formation there might take months
and months and months so generally
speaking if it hits the SDKs so if it if
anything hits the the Azure go SDK or
hits the Amazon go SDK it will be in
terraform within about a week because
this is used by a lot of really really
big companies and there's a lot of guys
like me they contribute to it because a
lot of us care about this stuff this is
really important like for me this is
core to my business
yeah and this is this is where it starts
to fall over what I would love is to be
able to say I need a set of web boxes
just kind of go work it out for the
provider unfortunately everything is
provider specific so when you're pulling
a provider like ec2 you know you've got
an AWS instance when you pull in your as
a resource management provider you've
got virtual machines or whatever it
happens to be so for that scenario when
you want to be cross cloud and say I've
got this infrastructure and it needs to
look like this just go make it happen it
doesn't work it falls over and that's it
it's a sore point for a lot of people
like that that's that was the meant to
me the selling point is yeah where cross
cloud we can do everything mmm not
really
yes so there's a concept of modules that
allow you to do things like that
I don't do it personally it was one of
those things I started getting into and
then just the cognitive load that would
have taken to make it all work I just
decided I wasn't gonna be worth it for
me but it is it is doable there you can
share things across the providers like
that where it's common and it's a couple
of different approaches to doing it
modules are one way it's really just
gonna be up to you to do the reading and
again as with all these things that open
source stuff it's always you know it's
free except for your time right always
that's a cost everything has a cost in
the world this takes a while to stand up
which is great
so let me show you let's go out at ec2
and find one of these boxes what has
been stood up
yes yes you can't when I started doing
this you couldn't but you can't now
alright so let's do something silly like
well make make a simple change right
alright so I've made a configuration
change it's not a big one but it's a
configuration change nonetheless still
going as it takes forever this is one of
the downsides to these things too once
you start standing up some of these past
solutions like the sequel Azure stuff it
takes a while to come up it probably is
it was a great demonstration actually
earlier in this room of a young lady who
has robots that click things generally
speaking I'm across at least for it for
us Estrella southeastern Australia is we
deployed to both to production workloads
and as soon as those other regions come
online and we'll be deploying to those
as well yeah what terraform will do once
this still going so what what terraform
will do basically I'll type in terraform
refresh and it will go out to ec2 and it
will find this configuration changes
bingo so terraform will actually go out
and it will it will refresh the state of
what it's saving internally so if I then
changed something or if I type terraform
plan it'll go out and say well the
configuration is not the same
see it's telling me that something's
been modified so the number of tags has
changed so what I can now what I could
do
because for me I take the approach that
once the configurations there it
shouldn't change and nobody should be
manually changing my infrastructure I
would delete it and reapply everything
that's the way that I operate in my
environment
not necessarily case of everybody else
right but that's the way I've got my
stuff set up because I can nuke the
world today and I'll be back in half an
hour I'm pretty good to go
so we're gonna go from being the five
tax down to four and you're always going
to disappear because somebody changed
the configuration and that configuration
is not documented my terraform files so
we're going from having those five tags
back down to the four as per the
configuration that's in the file correct
so there is another nice little tool in
here yeah so terraform has this concept
of backends to store state in other
places
traditionally I just stored state and
get we're just basically I'd run
everything is part of a build target
check it in so everything was always
version all the time that way because
again I don't want my guys running this
directly off their machine I want it to
be part of a CI CD pipeline because I
care about those types of things
what we can actually do to answer your
question where is it import so if I run
terraform import it something's changed
right somebody's going into and manually
changed a bunch of my infrastructure I
go okay that's that's kind of okay I
want to bring that into my Tara phone
files terraforming port will do that for
me it will update the state and actually
update the configuration file so now the
other little thing that's very nice
we're gonna pop this in - yep yep so
this is actually gives me a dependency
graph of what was going on with needing
to stand stuff up so I'm basically
asking for where are we so we had the
provider that gives me access to all of
the as a resource stuff then I have
dependencies on the sorry schema second
so I have dependencies for this is
dependent allows variables coming in
down in front this is always happen when
I die so having that dependency graph is
very important for me because it allows
me to see across the board what's
happening what actually takes
dependencies when these things get built
out and if your command line food was
good you could actually reduce some very
very pretty graphs one is terrible today
it's closing connection to the provider
sorry all of this type of stuff you can
actually look into the source code for
this and see how it all gets built out
it is very powerful I've actually had to
use this before for PCI compliance one
of our customers came in and said look
we need to audit your entire
infrastructure do you have a diagram I
went sure here it is and they looked at
it went what is this I mean that's the
dependency graph of everything in my
environment this is where it all is this
vertical is set up with and here's the
configuration for it am i compliant or
not they went oh yes I went stuff falls
over let's go break something here the
failure story is terrible yeah it's it's
terrible so I and again this is part of
the reason why I run as part of a CI CD
pipeline because what can happen as with
all of the things and this happened to
me earlier today when I was trying to
make sure these would run properly
if something is broken this is where
again going back to don't shoot yourself
in the foot if something breaks in here
half the stuff will get stood up and
then it'll break it doesn't clean up
that's up to you so the minute something
happens bad and again part of my CID so
I see I seen your pipeline run run run
run run era crap crap crap terraform
destroy everything all of it now please
quickly because what happens is you know
multiple builds multiple features get
pushed out the door multiple copies of
my infrastructure all hot bill and then
we're going we need to actually run some
tests against this stuff and they start
running some traffic to it it's all half
build nothing works crap sorry
what can I break that'll break it it'll
throw a big red error message it should
I hope it will break and I'll basically
say oh this isn't right
I've stood up this other stuff but I'm
not gonna clean it up for you yeah sorry
yeah I want it to break but when
something breaks if it explodes in your
face
it is literally up to you to run the
terraform destroy style and that's
that's paint like that's one of the
again it's one of the sore points it
annoys the state right and this is a
question that comes up with time why
does it roll back because we don't
actually want it to do that we want it
to you know people should be using as
part of a CID pipeline and you know
that's a better way of doing it
most people like when you start learning
this you know learning celebrities
running it off their machine right and
you're breaking things and you end up
with a whole bunch of infrastructure
because it's fun to play with and then
you're oh crap I left that all running
my credit card just got vaporized that
happened to me twice when I was going
through and learning because I'm trying
to set up high availability clusters for
a sequel server would fail over northern
iciness that goes along with that
and I stood up five very large boxes
they were the very very expensive ones
with the database at the end of it with
the sequel licenses and all the other
nasty stuff and it cost me thirty
thousand dollars because I messed it up
so I like very quickly don't shoot
yourself in the foot right as I'm saying
treat the tool with respect because if
you don't you might lose some toes
destroy destroy roll destroy if you
wanted to roll back to previous state
what I do is I just go back to get but
it may actually be something they may
have changed this and a lot of this
stuff like it changes quite often the
the commands that I generally use again
with apply and destroy and that's pretty
much it I don't use too much else that's
that's the workflow they're all like but
again this is becoming more and more
powerful so workspaces are something
that are brand new that I still haven't
used I haven't had the need for but they
keep changing this stuff and it is
something that how she caught themselves
actively use it was built specifically
to solve an infrastructure management
problem that they had when they were
building vault so your definition of
production is probably a little bit
different than one then why production
is just wherever the DNS is pointing so
and again if everything comes up it's
all coming online and everything's okay
we can throw some tests at it and cool
it looks good
got the dearness whereas in any game
what I specifically built the
infrastructure that way because after
having AWS fall down and my but being
very sore for about a week afterwards I
made sure that if something's going to
explode I need to throw it a lot quickly
yep sorry yep no because that's part of
my CI CD pipeline so I like to do very
crazy things with all this type of stuff
so yep
No
so it's it's again it's a DSL but it has
programming like constructs but not
really conditionals what you do get go
commands was the
you do get interpolation night which is
the kind of the workaround for it oh
yeah so that's about as conditional as
you get what I tend to do though for me
conditional is more a case of which
environment it's going to so it's more a
configuration a group of configuration
settings so in that situation that's
where I'll actually start using really
again programming like so basic ste for
encoding my type of stock what I will
actually start using is Maps so things
like this this Maps impacts so I'll pass
in a different set of targets
essentially I'll say I want this to go
to staging or I wanted to go to
developer I wanted to go to UAT or
whatever we've got that week and based
on that we can pull out a different set
of configuration values out of it so
that works really well for it for my use
case yeah we done for time times I spent
to finish go so that generally that's
the way that I get around those types of
things
sir I use terraform to manage
infrastructure I don't use terraform to
manage my applications like that's
terrif own for me is just the tool that
I used the provision is stand of my
infrastructure everything else outside
of that that's something else that
belongs so different I mean no I eat
before I even guest articles because I
need the machines to be there before you
can deploy to them right so in in
the.net scenario again because I'm a
good little Queens ain't kid octopus
deployed orthodontia deployments for us
in order for us to do a deployment the
machines got to be there right so yeah
see I like our build will happen as part
of the build we build everything out we
stand up the infrastructure for that set
of builds tag it make sure it's got all
the right variables everything is good
to go once that all stands up as part of
our build step we're pushing a package
dr. must deploy that says this needs to
go yeah that environment comes up as
part of the terraform apply once that's
all online octopus guys hey that's kind
of cool will deploy all the things it's
part of the deployment step from octopus
deploys when we start checking for
health and things like that
so as I said with all of these things
treat them with respect because if you
don't you might end up starting a bit of
a fire because again
vaporizing credit cards pretty much
looks like that when the boss comes in
you guys hey there's no money in the
bank account because you've just done
that so it is the thing you got to treat
treat the tools with respect like they
are powerful they will get you out of a
bind but if you treat them poorly yeah
you're gonna be sore now once you start
getting into this type of stuff it it
pays to go a little bit deeper into it
so you start looking at provisioners so
and this is one of the things where I'm
really lazy I don't do the provisioning
side of things so I don't use chef and
all the rest of it for the configuration
management of my VMs because I'm trying
to get away from beams so generally I
just stand them up very quickly I'll
have a golden image going back to the
old school way of doing things where
I've hot in the image and everything is
okay and it works the way I expected and
I put that in an ami and stand it up in
the other cloud environments everything
is passed I'm getting so far away from
VM
funny but you can go deep into that in
its own right and in truth like it's
it's really its own talk because it's
quite in desktop it getting into the
module side of things that's the
reusable chunks that's really important
and again it that's one of those things
if you're going to use it take the time
and go deep on it because you can shoot
yourself in the foot now the other thing
too though I kind of touched on briefly
is getting getting into the backend so
they're storing your terraform state is
somewhere else again in this type of
scenario where i'm running it off my
machine
the terraform state is being stored on
my machine then the other side of it -
once you start really going deep if you
find things that you need sometimes you
can get them as the third-party plugin
there's quite a healthy ecosystem
otherwise right on yourself I have a set
of infrastructure or a service such as a
software service that I use that is
actually quite powerful and its really
good it's one little job and it has an
API cool I write a provider for it so I
just plug that in to terraform I use it
as a provider and does its thing so I
can run the setup and that sort of stuff
as part of a build CI pipeline it's
actually really powerful it's like I
said if you have any any questions
feedback please let me know I've got my
big boy pants on today so you can be as
brutal as you like I only accept green
cards out the way thank you yeah
questions would still be a little bit
time
there's a few but because I invested the
time in terraform we're ready I'm not
going to bother jumping try anything in
the name of it there is another one
that's it's very similar and it kind of
takes the same approach to things but
the syntax for it I looked at I didn't
particularly like it so I kind of pushed
it to the back of my head and I've never
looked at it again but there are you
know other scenarios where it's
basically you know and online
point-and-click type cloud solution
which is oh yes okay sorry
yes the nicely thing that I ever did
this is one of these you know it's 2:00
a.m. in the morning everything's on fire
we need all the infrastructures backup
please make it happen and I left all the
security side of things out and that
turned into a very very expensive day
because those boxes got compromised
because this is the thing right when you
spin up a Windows box it's an attack
vector and those sort of a.m. eyes
because I was still using the the
default ones because I was going through
a stage where I was looking at
provisioning so we're gonna go okay
PowerShell DSC or chef or something like
that so we're using the base images that
were available from Amazon at the time
and I wasn't really thinking about it
because it would be a long week and I
forgot the security side box ago
compromised luckily luckily it didn't
have anything that was you know - there
wasn't anything sensitive on it and the
services that were compromised weren't
particularly they weren't
mission-critical services but the Box
still got compromised that's still a
world of pain the minute you get
anything compromised it doesn't matter
luckily enough like because I've taken
this approach where everything's in its
own little contained VPC they can't get
access to the other services and things
like that it wasn't too bad it's pulled
it all dear crap that is a really stupid
thing to do start again
yep yeah plays well with others so if
you having a learning system that you
need to plug into yeah just tariffs on
playing tariffs on plan tariffs on
playing this has changed this has
changed its changed far fewer loads and
again from the compliance standpoint
that's really powerful really really
powerful I have worked in environments
where that is a real concern because
compliance comes through every three
months and they're going hey is this the
configuration change it's not documented
that's your ass run it every day if you
have to just plug it into our monitoring
system or a learning system that's the
thing plays well with others and that's
why I like it so much because I can get
what I need out of it for my
infrastructure and if I need to have
another thing that's coming at me from
like the business side of things we need
someone under this so we need to know
about that I can make it play well
because I could shell it out makes my
life easy depends on what you want to do
with your infrastructure for you guys
it's probably better just go
terraforming port and get a baseline
yeah this is the thing - you can
actually take if you're an if you're an
ec2 you can take cloud formation the
confirmation will play nicely with this
you can just import the class formation
stuff so it actually has
the as a resource manager starts lagging
behind a bit all of this stuff so the
first major provider for all of this was
the AWS one because that's what how she
caught needed BAM so you can tell what
your cloud formations stack is let it do
its thing so this is the nice thing
about it too you don't have to go whole
hog if you're stuck in an environment
where you've got a lot of cloud
formation pieces or you something
similar take a look at the providers
you'll probably find there's a way
around it and you can start piecemealing
again simplicity is great I use it for
that too
so one of the other problems that I have
because not everything for me is in the
cloud again events company we go on site
stuff like this we'll have a whole bunch
of devices that need to talk to a server
and because of the latency issues
because we're talking of a Wi-Fi
networks in a big venue with 50,000
people connectivity becomes an issue
very quickly and you get that many
people in the same room we started
shipping little Intel looks just spec
you might put them everything in the box
the reason to move around they're
powerful enough they have ESXi
hypervisor zhan i can manage that with
terraform because again i go back to the
provider side of things most of the
cloud like stuff for the hypervisor
stuff can be done through terraform it's
powerful it is really really powerful
and again there are there are solutions
for a lot of problems a lot of the
common problems if you google very
quickly you will find a somebody's or
you've got a terraform script that
handles that common problem that you can
learn from and then adapt
yes sometimes and that's that's an easy
to thing oh it's an Amazon thing more
than anything yeah you can't deal with
it
so for all of these things everything
that you deal with has attributes they
can be referenced so attributes are
things that you can actually get back
out again so this is where you start
actually passing information around
about the stuff that you're working with
so take a look at the providers they all
have things like this where you can
actually pull information out very very
powerful cool if there's any other
questions like I said catch me outside I
got my boy pants on today so I'd
appreciate feedback not from you though
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>