<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Head to Head #2: K. Scott Allen and Jimmy Bogard | Coder Coacher - Coaching Coders</title><meta content="Head to Head #2: K. Scott Allen and Jimmy Bogard - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Head to Head #2: K. Scott Allen and Jimmy Bogard</b></h2><h5 class="post__date">2016-07-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MzX0OnNl-AE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello baby hey Ron I think it's on
alright shall we get started today
hello everyone I'd like to start today
with a song Jimmy and Scott and I have
been working barbershop a lot of people
don't know this we've been working on a
Katy Perry song yeah that one Kitty
purse yeah so why don't you start us off
don't do it okay so welcome everyone to
our head-to-head case you don't know who
these people are or what's happening let
me just quickly introduce them this is
Scott Allen everybody knows Scott Allen
says Jimmy he's from Texas yee-hah Jimmy
Barger I'm Rob Conner actually could
have a horse - oh that's here's the idea
every year at NDC we try and do
something a little bit more fun and
we've been doing what they have been
calling cage matches where we do two
competing technologies but this year we
decided to do something a little
different so I go to stack overflow
I grab six or so questions today is
mostly about dot now we have an angular
question as well I give these two guys
the questions and they have to come up
with their own answers independently so
we're going to see answers to the same
questions they don't know what each
other each other's answers are and then
we're gonna mix and match and compare
and contrast that's it your involvement
is actually encouraged I know being in
Norway you guys are really really vocal
so I might wander I might wander around
and if you feel me kick you that means
ask these guys a question so this is
going to be hopefully fairly interactive
with that said Scott will you start us
off start us off with the first question
I'd know with a song please or with the
fall I'm sorry she keeps her up no all
right
well one question Rob sent out to us was
about the service point manager dot
default connection limit which maybe
you've never heard of this class but
apparently the fellow who asked this
question was had written in a web api to
service and dotnet core and he found
this piece of code that set the service
point manager default connection limit
in dot max value which increases the
connection limit by the way doesn't know
if it's for the computer of the
framework and he just wanted to know how
to do this in dotnet core and I had
never actually seen the service point
manager actually had to go out and do a
little research but I think I know what
was behind all of this I remember when I
first started with dotnet I actually
wrote an application server side and in
asp.net we were trying to make multiple
connections from our server to another
server and it turns out there is a
connection limit baked into the
framework where you can only make two
HTTP connections to another server which
makes sense from Microsoft's perspective
because they were following the HTTP RFP
the official specification that says you
should only make two HTTP connections to
another server but that might be good
for web browsers so that web browsers
don't overload a server but it's not so
good when you have two servers inside
the firewall that need to communicate
with each with each other efficiently
and they're handling all sorts of
requests from clients so I remember back
then we used to change the connection
limit using a web config file which
doesn't exist in core as yet it's making
a comeback
probably well there was a project JSON
file but now there's a CS proj file too
so we're yeah we're not sure anyway for
this one I did come up with a really
quick simple little piece of code that
appears to do what this gentleman would
like to do which isn't from a dotnet
core application like this you'll
probably be using HTTP client and if you
pass in a special message handler that
is a win HTTP handler
into this you can set max connections
per server to whatever you want
I guess the question there would a win
HTTP handler be available on a non
Windows operating system that I don't
know some of us have more experience
trying to port things to different
environments than I do but what was
Jimmy thing I actually I think of a more
elegant answer than yours obviously so
I'm a consultant so I'm I was looking
for the the question behind the question
and maybe the question behind that one
as well so this guy he looks like he's
our guy noble ah I don't know
person is trying to have more concurrent
connections in dotnet so I think that
he's his problem can be more simply
solved I got a gist here going here can
everyone see this okay okay so the
solution I came up with was use Phoenix
elixir and that'll solve this problem
it'll allow much more concurrent
connections at the same time
problem solved I think I just lost my
MVP oh sorry oh so so next question next
question alright so the next question
there's another poor soul here he wants
to know how to add to perform and
performing and typesafe collection I
assume the grammar is correct on that
question
okay so performing and to typesafe
collection of value types in the early
version of.net 1.1 so at one point in
one is pre generic so he's probably in a
world of hurt right now says he recently
got access to a very old c-sharp code
base meaning dotnet 1:1 and c-sharp one
two which I guess if John ski would here
would tell you exactly what that's added
closures and find places it could be
improved so I guess he he actually wants
to improve the code base not just throw
it away which would be my first reaction
it looks like a is like a window to the
past when a when a bow was the most
powerful weapon
I never had the opportunity to willingly
code in c-sharp version lesser than
c-sharp to before so this is the first
time he's seen C sharp 2 which is kind
of like singing like Java 3 for the
first time it's just a very bad thing to
look at and so his question is about
collections so the C sharp this version
didn't have any didn't have any generic
collections whatsoever and so he has a
lot of these generic array lists I'm
sorry not generic but already let's just
have everything as an object and wants
to know if there's a better way for you
to do this sort of thing without dealing
with a ArrayList directly now one
possible way he could do this would just
be to update his applications to.net -
oh and get generics like that's you
could just retarget it that would also
let you lets you do those sort of things
but that's not available to him so the
way he could handle this I actually
worked at a product team where we had to
deal with a bunch of a bunch of
collection types just like this so the
way I would deal with it there's an old
set of collection objects in the system
mage critical a public class foo
collection there's a really old set of
collection classes you can deal with
they come from the system dot
collections namespace most people these
days use like system dot collections dot
generic or something like that current
current whatever this is where you find
the old ArrayList but right above that
is actually the souther one called
collection base and this is the one that
we always had to use for our custom
collection types and because this is net
that means everything has to be a
subclass an override sort of thing and
so this thing has a bunch of over
rideable methods including things like
on insert on insert complete because I
guess that comes after inserting or
something like that and all sorts of
methods do all these sort of things so
these are the ones you would youwould
over I to be able to say and returning
this kind of object or that kind of
object that sort of thing so this is the
thing I remember us having to do I don't
have a funny answer for this one because
there's nothing funny about c-sharp 1-1
I'm sorry see sure please quite in the
audience thank you
all right so uh what do you got me well
alright so what I would do in this
scenario is think about okay he can't
this person cannot use generics
but think about what generics are if I
have a a class to find say we have a
public class su of T and its class not
just a food and inside my program I say
something like bar thing equals new foo
of int
what's the C sharp compiler doing it's
taking this generic type parameter it's
a parameter and anywhere where it sees a
T so that's the one that add a food to
something the C sharp compiler will
simply come through that thing and
replace the T with the type that you
have substituted here like integer and
it's very simple operations the compiler
does for us but what we could do is we
could go to a collection class that was
already implemented implemented that
could be very performant with integers
as just has a generic type parameter in
it and we could actually find the source
code to a Greek collection like this
just search github for a little project
called core FX which is part of dotnet
right and inside of source system dot
collections we should find a source
folder with the collections folder with
the generic folder notice all the
generic collections have disappeared so
things like a raela store are going now
which is probably a good idea I did not
want to go to structural comparisons I
wanted to go into generic and find good
ol lists of T and then if I click raw I
can now copy and paste this into my IDE
and it would take a little bit of time
but I could basically do what the
compiler would do for me so maybe I
rename the class list of int but then I
go through it and wherever there is a T
I simply replace that with integer and I
now have a data structure which can hold
a variable number of integers and do
that efficiently it will
do that in the back here you can see I
would have an array of integers and it
would keep getting resized as integers
were added to it and of course there
would be some other things you would
have to fix up to make the compiler
completely happy it's not just a simple
replace T with int you would probably
not implement a list of T just implement
a list and this one or just make it
ienumerable perhaps but there is some
interesting code inside of here
and we could get rid of code contracts
and other things that we might not need
in our application or keep them but if
we look at ad I was browsing through
this code earlier I just found it
interesting let me do a search for ad
and we will find add an item so what I
add item does is it will check to see if
that backing array is currently at
capacity or not and ensure that there's
enough capacity to store the next thing
if we look at so up to me that says oh
we'll call this method in short capacity
and it will expand the size of the array
and maybe copy new items into a new
array something like that just want to
do a quick search for insure capacity
which is right here and what confused me
at first was this method actually
doesn't do anything except recalculate a
new capacity and if I remember the new
capacity will be the current length of
the list times 2 so effectively list
keep doubling in size until they reach
about 2 gigabytes and then your machine
melts down but I'm looking at this I'm
thinking alright where do they actually
change the array where does the array
grow and it's sneaky because it's
actually done in this property setter
capacity yeah not good if we look at
capacity somewhere inside of here is a
lot of capacity I'm gonna have to zoom
out for a second to find it
there we go yeah look at the setter for
that thing it's inside of here where it
will now create a new array based on
this new capacity and array dot copy
items over so that could still hurt
performance but you know based it's
certainly gonna still be better than
boxing and I think that question said he
had sometimes thousands of integers and
or hundreds of thousands or something
and that's what he's got on numbers yeah
that's throwing garbage all over the
heap so this would still be a better
approach but still come through here and
every time there's a teen replace it
with int and you have a working dynamic
list of integers so keep better than
just finding a new job I guess that is
the question
all right I'm gonna wander over here I'm
looking at confused faces does anybody
have any questions because we really
want this to be fairly interactive oh
don't be so Norwegian come on come on
nobody all right anybody you yeah I'm
gonna pick on someone yes recursion yes
did you have a question yes yield thank
you very much I wish all right Jimmy's
up I asked the question Rob you're
screwing it up whatever Rob sorry next
question how are people unit testing
with entity framework six or seven let's
say or whatever should you buy I think
you meant to say if you need a framework
or 1.00 sorry yeah yes right that's for
you this person is just starting out
with unit testing and TDD in general
they want to add it to their workflow so
they can add better software but this
person was already roadblocked
themselves because they don't want to
abstract EF away in a repository wonder
why maybe Jim you'll know so II think
Sai queryable is a leaky abstraction
there's a lot of great posts out there
on this subject and then he shows some
code where he's basically
abstracting away and abstracting away
something that doesn't have the name
repository in it but it's easily could
and maybe I let Jimmy go first on this
game I read the question of you go are
you just googling how to do testing an
energy framework that's that's also
cheating yeah I can I see what you're
doing but it's an article that I wrote
that's why it's wrong oh it's my turn
okay well yes so the one of the looks
like one of the solutions he came up
with or write on online was to create
your own abstraction behind dbcontext
which is the the main Oh RM thing of any
framework and then that's the thing you
go ahead and mock outs and you're
they're not using repositories but I
think using things called services would
this looks almost exactly like a
repository so I think some terms gotta
get the mismatch or something like that
so the original question was how are
people you know testing in any
frameworks six and should you bother
actually I don't know how people are
unit testing in any framework sis I
don't really care how their unit testing
it because the second part should you
bother I don't think you should bother
at all unit testing with it whatsoever a
lot of systems I work with when I have
problems in production it's because my
tests didn't closely match how the
production was actually working and if
I'm trying to do something with
something like an in-memory repository
or some kind of in memory database for
things like that it's not executing the
exact same sort of thing that would
happen during production so the more
closely I can match I can make my I can
make my my tests match saying how things
actually work in production then the
more value I'm going to get out of it
so actually over here got an example of
a test not this ugly collection over
here that thing is horrible if I go look
at how I typically using any framework
let's see let me find a place where I'm
actually using any frame
behind the scenes here mmm that's a
boring one let's find one that's more
interesting
now here's we here we go that's a more
interesting one so I tend to split my my
my my code into commands and queries and
individual request objects so when I
have something that's doing a very
specific activity I'm having that
written one exactly one place and so
inside of that I I'm actually using any
sort of abstraction on top of an any
framework not even looking at DB
contents I'm using the actual the real
DB context object that I created with in
my application code and inside of there
I'm just going ahead and using it
directly so I'm pulling off in this case
courses doing some wear and ordering and
then using auto map or to project that
information to some object and then
returning some result if you were trying
to unit test this that means you have to
figure out what pieces you need to fake
out and that piece you faked out would
probably be something like that right
there a weight DB dot courses and so
instead of returning a real iqueryable
you'd return something like a database
back thing and and then the projection
instead of projecting against sequel
version of things it project against a
in memory version of things and so what
I found is that that the iqueryable
logic and nad framework is insanely comp
and Sandy complicated and I really want
to make sure that thing is doing the
right thing because I've wrote if I were
to you know test with this it would run
the projection and link against an
in-memory query Abul not against the
crazy queryable that is any framework
translating link into sequel which is a
seriously complicated thing to do so the
way my tests look and my application are
trying to test things at this level v8
integration test and so that's what I
have over here is I have a test that
tests my application by creating that in
this case it was a command object to do
something I send the command to that
handler right here and it runs the
actual code behind the scenes in a
transaction and then finally over here I
do in a separate transaction to go and
pull out to make sure I actually find
the thing that was actually saved so
this runs
the actual real stuff behind the scenes
so I can have the highest highest
confidence as possible to my code is
doing the right thing now and one system
I actually wrote all the unit tests for
these as well and I found that unit
tests we're doing basically the exact
same thing as the integration tests so I
just wind up deleting the unit tests and
key and keeping the integration tests
reserving unit tests for when I had
places that weren't trying to call it to
outside things whatsoever for the actual
domain model things like that so that's
how it would unit test in any framework
I wouldn't that is a tough thing so the
question is how would I know that the
state of the database was in the correct
state before anything started so there
are a number of ways you can do that the
main techniques I've seen are things
like user transaction across the entire
test run so that I wrapped the test in a
transaction at the end of the test I
roll the transaction back so it ensures
that at least it cleans up after itself
I don't like to test that clean up after
themselves
I like tests that start things in a good
state and so what I do is I use I
actually just delete tables I just
cleared all the tables before I run each
time so I have another tool another
open-source library actually it's called
did it do this one is called respawn and
what respawn does is it examines the
schema of your database follows the
foreign key constraints to see what the
right order in which to delete tables is
which is all the Leafs and then the next
level and the next level in so it's a
depth-first search of that graph and as
long as you don't do anything crazy like
have a table reference itself which got
healthy if you do something like that
then you should be able to have that run
and just before it starts the test just
deletes the tables in the right order
and from our profiling we found that
that banner is the fastest way to do
things besides we tried disabling all
foreign key constraints truncating all
tables in random order and then
re-enable in constraint
but that was three times slower than
just deleting things in the correct
order so this thing just figures it out
once builds up the list and then runs it
before every single test talking thank
you I remember you and I talking about
this when you came out this library cuz
you I think either asked me or asked
Twitter and you said how do I do this on
Postgres yeah and and just I just want
to throw this out there that Postgres
allows you to delete everything in a
schema and you can drop the entire
schema so if you put your tables or
views or functions or whatever inside a
schema you can say drop the schema
cascade and Postgres figures it out for
you the reason I bring that up as I was
curious if sequel server does that to
anybody No
so we tried that one as well yeah we
also found that creating when you when
we drop that when we completely drop the
schema yeah we have to recreate the
schema and that's still slower so when I
do these kind of tests where almost
everything is integration tests that
means tests are slower because if they
hit the database so I was trying to find
as many performance optimizations as
possible so that works really great on
smaller scenarios but when I have
hundreds and hundreds and hundreds of
these tests then every little like every
little second I shave off of it is less
time but it is a really cool thing I
like it yeah I just want to it oh yeah
one more question
go ahead the question is what data do I
test on whatever I set up so in this
case this one needs to have a department
ready to go so it gives the departments
this case from a tool called Auto
fixture just mix up a department with
junk in it and then I save it and then
I'm using that over here to say and my
department should be that thing that I
just saved over there
so my tests actually create the data it
needs if there's lookup data that's
another common question we look up data
like the list of countries or zip our
postal codes or whatever those things I
why I white list to say don't don't
clear out those table because it's just
look up data as part of that deleting
run yeah so I just wanted to take a
moment to apologize for sins of the past
it was about well it's exactly I got six
years ago Microsoft actually approached
me and they said we know
test-driven development we have this new
thing called entity framework for would
you take a look at it and maybe write us
a white paper about if you found it to
be testable or not and I said no but
they persisted so I eventually went
through with it and at that time the
approach that I took was very much like
that gentleman which was what we're
going to do is build different types of
abstractions around what's built into
entity framework so using a repository
to wrap the I forget whatever the object
context produced at that time it wasn't
DB set and using a unit of work to
encapsulate the object context which
would now be a DB context and showed a
couple different approaches about how
you could do this but it's all rubbish
now I don't like doing any of that
anymore
I completely agree with Jimmy that you
end up in a situation here where you do
one of two things the two approaches I
showed you either end up mocking stuff
and you're not really testing your
system you're just testing the
interaction and making sure that this
method got call with this parameter with
a big deal or you have in memory data
that link operators always work against
because if it compiles it will work
against a memory data but that's not
necessarily true when you actually send
it to sequel server so over the last six
seven years my viewpoints have changed
and I have to contact them and see how
to take this down thank you you just
have to click no right there at the top
that's what I think you should just
click no right there everyone in the
room go to this page
like No
so while Scott's typing there this is a
one of the reasons I picked this
question one of the reasons I picked
this question is I read a really
interesting blog post by a really
handsome an interesting guy about
repositories at the top of unit of work
and it was in response to a stack
overflow question and oddly okay so
here's the surprise I'm the one that
wrote that post but I know I gotta say
it anyway that is still to this day my
most popular post and I kind of rant it
a little bit but I want to ask you guys
about that because to me the bigger
question here is why are you rapping if
with the repository and does everybody
understand what that what I just said
like cuz you got any framework is unit
of work right you have a dbcontext
tracks your objects and then you flush
it at some point in a transaction to the
database all those objects get saved and
whatnot but if you put that into a
repository you're mixing your patterns
to the point where you're if you're
passing in the data context or the DB
context you got no idea what objects are
sitting on that waiting to be transacted
you know what I mean so I wanted you to
actually go into your example of command
and query objects ago I think that's
fascinating if you don't mind really
quickly doing that a little but okay you
know why if you need a minute to bring
it up I could oh you have Spain on this
topic just a little bit oh go ahead yep
so when I started developing with
angular 1 I wanted to you know test my
front end code and I found myself in a
very similar situation same situation I
had in c-sharp car with entity framework
I was in a situation where with angular
the idea was isolate your controllers
isolate your controllers unit testers
controllers so that they're not calling
into other services and trying to make
HTTP calls so the team I was working
with we tried this at the time what we
would do is a controller when it was
instantiate it would call into a service
that would make an HTTP call and so what
we would try to do is provide a fake
service or a mock service that
by the fake beta data back to the
controller and write a search that the
controller will put the data on the
right properties so it would presumably
be data bound to the screen but what I
found that what I found was that those
tests were completely ineffective we
were always having things breaking
because most controllers are actually
pretty simple they asked for data and
they get the data back and they put it
into a property and what we really need
to needed to test well it's not the
controller in isolation what we found to
be of a lot more value was testing the
controller and the services it
interacted with and actually testing
that that interaction worked and so
after a few months we switched our
strategy and said ok we're not going to
ever ever provide a fake or a mock
service to inject into a controller
inside of our unit tasks instead we're
going to inject the real service and
find out if the controller and that
thing actually worked together and
instead angular 1 had this has this neat
ability where you can mock out the HTTP
connection on the back end so a lot of
people would look at that we had this
discussion is it a true unit test
because the unit test is instantiating
the controller and it's using a real
service and the service is actually
really trying to make an HTTP call it's
just that I had this mock back-end that
would provide fake data but I can tell
you that after finishing that project or
looking at that project after we
switched the strategy we were probably
writing 70% less test code and finding a
lot more actual bugs in the software
than we ever had before so it was very
similar to this situation sure someone
from the BDD community would raise their
hand like I told you so that isn't that
me so you're saying something about
commands and queries something something
something yeah so one of the one of them
one of the journeys I've gone through
and the whole like DDD realization is
trying to take some of these patterns to
their to their logical conclusion and
one things we found is that one of the
good things from the the whole CQRS the
command query of responsibility
segregation movement was by breaking
things down our system between commands
and queries we can really
kind of rally around those patterns and
build out some interesting interesting
things from those things so what I'm
showing here is I've got even my my
application is is split and organized
based on the kind of features I'm
working with so as opposed to my mice my
application being organized by layer so
don't like a queries folder or a view
models folder controllers folder and set
them organizing everything together
based on what they're trying to do so
even here on the right I've got views
and the axial XI sharp classes that deal
with them right next to each other so
that if I'm working on some feature I'm
always working on those two files
together and not having to jump around
my solution a lot and then the actual
queries and commands themselves if I
actually look at the so this is the
instructor control oh no that's the
instructor you right there we go the
control that the controller itself
doesn't really have a lot of things
going on
it's just dealing with queries like this
and then down here commands and then
sending down to this this intermediate
or this a mediator object to actually
dispatch those to an individual function
that represents doing that actual work
and then the actual work is represented
by individual command objects and query
objects this query object represents a
query - well it's kind of funny because
it returns a command because that's the
form object and the validation is
represented here as well validating the
query things like it needs to have a not
an all ID and then the command itself is
represented as an individual object that
represents all the all the data that you
need to process that command so the
properties that you see in the screen
are all individual properties on here
that line up to the different form field
on the screen and then the last piece is
looking at the query the handlers behind
this the query handler is taking that
request and returning the response and
this one is actually somewhat
complicated or at least looks kind of
like it's complicated so it's doing some
getting something instructors projecting
out into this form object and then
populating some associated data down
here looks pretty complicated but
everything that has to deal with that
for that operator
is just in this one spot so if you're
one of those like store procedure people
you could call it out to a sort
procedure here as opposed to having it
all done through link and then the
command side it's separated out as well
so that everything that is required to
process that command is then again in
just this one individual spot so here is
all the whatever I need to do to
actually process that command adding an
instructor if it's a new one or getting
the one out if it's an existing one
setting the data whatever I need to do
again it's all just completely
encapsulated in this one method which
makes it pretty easy to test because now
I have this one sort of interface I go
through a passing any request getting a
response and making sure that that thing
did the thing I was supposed to do yes
go ahead
yeah that's kind of funny isn't it so
this is a this is an edit page an add
edit page so in any edit page you make
an initial request to get the existing
data and put that into a form and so
what I do is I model that form on the
screen as an individual view model
object so it turns out when I'm actually
making the query for the edit page the
result is the command that represents
the form and then when I do the form
post the command is then bound up from
the request information to that same
object and might be easier to see on the
controller because on here we go you'll
see that the Edit returns command object
and that command object is the view
model and that same command object is
then the input for the form post over
here so having that duality yeah I used
to call these like view models or
something and be like create edit or
created view model but I then renamed it
based on the intent of what it was meant
to be so it's that the query returns the
command for the edit page kind of funny
well the big thing the big thing when
going for here is that I want to make
sure that the the model being used to
build the form is the exact same model
I'm using to bind against the form
variables but having those two things
the same thing I don't ever get it I
don't ever get it off it's always gonna
be the same thing but as far what'd you
name it I mean I don't really care
didn't name it something else I mean the
important thing was that we wanted to be
consistent in the names so just
basically pick something and stick to it
and if you change it
fix it everywhere Scott did you have
anything yet all right so we move on to
the next question did you guys have
anything else to say about this stuff
okay so your turn yep take it okay so
this question is on angular 2 what you
think you know a little okay so this one
says is there no equivalent to dollar
scope to item it's or dollar scope dot
broadcast and angular 2 I know the event
emitter functionality but as far as I
understand that was just a minute event
to the parent HTML element what if I
need communication between the FX period
siblings or between a component in the
root of the Dom and elements nested
several levels deep it's fascinating
good question yeah so all right let's
bring up something
so I can tell you this an angular 2 and
this is also kind of true of angular 1
I think this fellow was talking about a
page that might have a little widget up
here that maybe represents the current
user status and then you've got some
complex UI where buried deep down inside
of here there might be a component where
the user could maybe login or select a
checkbox or do something that's going to
change their status or raise an alert or
do something and we need to communicate
that information back up to this
component and we really don't want those
to be tied together and in angular 1 it
was possible to use scope dot emit which
is sort of a broadcasting mechanism to
say I have this event and I just want to
send it out up the tree or down the tree
with scope dot broadcast and you can
have these events traveling through your
system and listen to them from other
controllers and that was one way that
two controllers that didn't know
anything about each other could
communicate but it never really was a
great idea at least for me actually I
tried using dollar sign scope emit scope
broadcast to do a few things and I never
liked it there's there's another way to
deal with this on both angular 1 and
angular 2 actually there's a couple
different ways but before I talk about
that I'll just show you a slightly
different scenario it's it's the theme
for angular 2 which is if you have a
parent component and inside of that or
child components it is very easy for
this parent component to own some sort
of model and it's very easy for that
parent component to take that model and
delegate pieces of it for sub components
so they can render small pieces of it
but we might want we might not want
those child components to mutate that
model we might just want them to display
information and then tell us that the
user interacted in a way that the model
should be mutated so in angular 2
there's a convenient mechanism for these
child components to essentially raise an
event just like we would have in dotnet
that the parent can listen to and then
the parent should be responsible for
mutating model and the code looks
something like actually I have to find
it's more specific file here which would
be that the time oh yeah this one so
here's a little component so imagine our
page that's going to display a few
panels with some movie information and I
want this one movie component just to be
able to display a single movie out of
ten or twenty or however many appear on
the page and angular now is angular two
anyway they really like all the symbols
different symbols that they can ever
find in the on the keyboard to use so we
have a an app input which you can kind
of think like so this is typescript and
but this syntax will actually be part of
a future equi script standard that's
known as a decorator now and you can
think of it kind of like an attribute
and dotnet except attributes and dotnet
are very passive they provide metadata
to a class and the compiler takes it
bakes it into the assembly but in order
for that metadata to be useful some
piece of code has to come along and
inspect it and act on it whereas
decorators in JavaScript are really
quite powerful and will be useful for
meta programming because essentially and
I know this is a tangent that input
decorator will actually be able to
execute during translation or at one
time when the browser's do this natively
and take its target so there's a target
here of that component target oops that
was not expected
it is component is attached to this
class component you can think of it a
function as a function that will
actually be able to execute and modify
that class so we could dynamically add
members it could remove things it can
add metadata whatever it wants to do
same thing with input but this is a very
explicit way of saying providing like a
public API from this component it's a
way of saying I want my parent to give
me a movie and I have an output to tell
the outside world that the user is
trying to change the rating of this
movie and it's almost like an event
handler of T so it's an event emitter in
angular 2 but I'm gonna raise an event
and pass along a number and then the
parent can decide what to do with that
value but this doesn't work at all in
this scenario I had over here on the
left if I'm trying to communicate
between the component way down here and
a component way up here so the solution
I think for angular 2 there's there's a
couple different solutions but they
almost always involve a service and this
is something that I did in angular 1
quite a bit hopefully there's angular
fans out here but if I have an
application and there's a whole bunch of
widgets patrollers components whatever
they are on the screen
and they have to coordinate somehow to
know when the user status is updated or
something like that the solution is
almost always a service because services
and angular are Singleton's which sounds
bad but Singleton's aren't too bad in
JavaScript because it's single threaded
we're not gonna have to worry about
fighting issues and there's stateless
too right so they shouldn't well so
that's where well that's where it comes
in interesting a stateful service which
does sound terrible but uh there's easy
ways and unit tests to just completely
reboot an angular application before
every test so that you're always
starting from scratch and I think what's
important for people to understand in
both angular and angular 1 and angular 2
is that a service we tend to think of
services as things that will communicate
back to the web server or provide some
sort of infrastructure
talk to the geolocation thing in the
browser all that stuff but in reality a
service can be anything a service could
even be a model so a model that I want
to share inside of the application so
you could imagine if there's a service
that exposes an API to add things and an
API to remove things behind the scenes
there's some sort of data structure in
here hopefully these drawings are
helpful
well this since the service is a
singleton I can inject that into any
component or any other service in the
application and they're all dealing with
the same object and therefore they
combine themselves to the same pieces of
State here so if all I need is a simple
mechanism to say let's say the user
profile has changed and the user is now
logged in if all I need is a simple
mechanism to be able to propagate that
information around well if everyone is
looking at that information in the
service they will know when the user
profile changed because of when
something happened and in angular 2 we
could also put the event emitter here on
the service and actually have a service
raised event that people could subscribe
to and so forth and I think that can be
an interesting architecture but there
does come a point where you might want
to take a slightly more formal approach
for the events that are flowing around
the system and use something more like
an event aggregator pattern and there is
another JavaScript framework not angular
that perhaps this person could consider
a framework called aralia that has this
kind of stuff built in if I flip over
here so this is an array lea application
and I just want to show you that it has
an event aggregator service and what I
can do with the service is actually
define classes like contact viewed or
contact updated if we look at them then
anyone who has used a message bus and
see Sharper and service boss or
something like that might start to see
where this becomes familiar right I have
types defined for messages that I went
to flow around so that when
well that was not the expected result
there there we go so that when someone
does something interesting like view a
specific contact and I need other
components in the application to be able
to do that then I actually would want to
go out to my message bus and publish a
message that this contact was viewed and
pass along some state information that
can be inspected and then some other
components let's take the one over here
can say it wants to walk up to that
event aggregator and subscribe to events
that are you know their specific class
instances or that class symbol contact
you contact updated I think that's a
nice approach to solve this - did any of
that make any sense
let's see Sharky where am I thinking of
yield a wait yeah
oh yeah I did I had an answer too there
we go I actually do remember using the
event emits or scope emit on one project
and it seemed really good at first and
then about two months down the road it
was late we could not figure out how
anything hooked up to anything else yeah
it was a global of an aggregator that
went off like on just a string key yeah
so yeah just in general not a not a
great not a great thing to use all right
that's all I got
why don't you have an example using it
react is well just really I kind of a so
here not know what react is I mean I
think at this point everyone should know
what a react is now okay so reacts is a
JavaScript library that really focuses
on the the view side and it really looks
at taking taking an input and then
building out of your HTML from that and
it really tries to be smart about things
so it will anytime the model changes it
will just ask itself to re-render and
then do some smart dipping to see what's
changed so that the Dom only gets the
new pieces of HTML in there it's kind of
funny too because the first angular app
I did we wound up building the building
the interactions and a very react flow
but react didn't exist so every time I
clicked a button on the screen I would
make her Ajax requests to the backend
the backend would return the new JSON
object but that was my model and I would
completely replace the old scope with a
new scope and then it would rerender
itself but that's actually a very bad
thing to do it turns out and angular
just a replaceable scope anytime you
want but it was the way I thought was
the easiest way to work with which was
the server is a source of truth for my
model and all I wanted to do is just
take the new model and just figure out
what needs to be changed based on just
rear-ending itself so how'd react
existed I would just use that but it
didn't so we had the janky way like
physically janking the screen because it
was rerender everything
I don't know I'm sure it's JavaScript as
memory leaks yeah I think you're next to
ask me two questions I ask a question
plants question all right the question
is right up your ballpark on my ballpark
indeed I'm using autumn a per which I
understand is a the most popular
open-source library by a non-microsoft
also non web version not Jason related
in the northwest hemisphere all the
mapper in an asp.net MVC application I
was told I should move the autumn appart
create map elsewhere as they or it has a
lot of overhead I'm not sure how to
design my application to put these calls
in just one place I have a web layer
service layer a data layer each of its
own project I use ninja I'll utilize all
the mapper and both the web and service
layers so what are what are your setup
for other matters create map where do
you put it how do you call it you just
take the text straight from there do
grammar errors an odd cat I think I
think you have enough rep to go fix the
grammar don't you yeah I could do that
okay well you work on the question I'll
try the I'll try okay so I get this I
get this question quite a bit about word
where should I put my configuration so
I'm I got a simple app actually to
switch sample app over here and most of
most applications I work with have some
sort of global startup piece in the.net
MVC core or ASP nut core there's like a
program main because that's not going to
be confusing where all the setup is
going to be Oh autumn a per I assume
everyone's heard of it just that kind of
person
it started off as a really dumb thing on
a project about eight years ago we were
we want to do this whole everything as a
viewmodel thing but I knew I was gonna
have to create all this code to map from
my domain model to these
dumb view models the DT OS so I thought
why why don't I just have something do
that mapping for me and just fill in the
data and to my surprise no one had
created this before so I could say oh
the first one to come up with Oh
actually not the idea because a lot of
people afterwards said I thought of that
but I didn't do it I'm like that's right
I did it anyway so yeah it's just a it's
just a dumb little library to map from
one object to the other really with the
use case of finding things out into DT
oh is that kind of thing
so usually an application there's always
some place that has all the startup
stuff like this is like application
start and you'll see that this is all
this is where it's it's configuring all
the other stuff in the application for
the first time so wherever that is for
your application that's where you'd want
to put this sort of initialize the
initialization as well they also asked a
couple other questions about how to use
it that sort of stuff so it's actually
pretty straightforward you just call
your initialization who's gonna start
with mapper dots
initialize now this is a very old
version we're have it deprecated it's
not anymore I promise and this is where
I put all my initialization so in as
part of this you can do config create
map to create the mapping configuration
from one class to another so if I have
class foo and class foo DTO and there's
some data as part of that
I my applications have a lot of Fuwa
beaks and them I don't know about you
it's yeah you okay then I would create
this mapping configuration between the
first one and the second one food eto so
where that's doing behind the scenes is
just a inspecting both of those types
figuring out those things to can map
with each other and then cashing some
configuration about how it should
actually execute and perform that
mapping and if I want to actually
execute the map somewhere else in my
application code I just do map without
me
I know it's lined out but that was a
mistake that I have atone for these
methods all still exists where I can map
from food a food eto food eto passing in
a foo object and then returns five and
this returns food eto objects from the
result and the food Ezio's value will be
five hopefully if everything's gone
right behind the scenes so if this gets
to be too much in some way allocations I
have a whole bunch of these sort of
things a whole bunch of these maps
around it would be a little bit of a
pain to try to put them all here so I've
created a way for us to gather specific
sets of configuration together so that's
you know you have different
configuration for different use cases
all kind of tied together so an example
of that if I go pull up in these feature
folders you'll see that not only they'd
include the C sharp command query and
view files and they also include the
auto map per profile and also the
controller itself so everything related
to that thing is going to be all of that
one folder so if I pop open one of these
profiles
you'll see that I'm using this autumn a
per a concept of a profile which
contains its own configuration so in
here I'm creating the maps for all of
the maps inside of this one individual
file for this one feature for courses
and I think what I want up doing to
automatic
pulling all these pieces together is to
do to do to do I go through and look for
all the things that are these profile
objects I go ahead and create them using
reflection and then as part of my mapper
configuration I just go ahead and suck
them all in and say go ahead and add all
those profiles all together this is
showing the instant space version when I
first create an automatic data it's like
oh that's a fantastic idea maybe you
should make it static though because not
everyone wants static and my reaction
was whatever I'll do static anyway and
then so just recently I was able to not
just have static a kind of instance
based versions that's what you see here
so I can instantiate one of these guys
put it all in there and I can use my
dependency injection to be able to
configure that to use dependency
injection to have those different things
so if I need to have different
configuration for different scenarios I
would just have different ones of these
objects that I would then create mappers
based on those different scenarios but
that's how I do it is like that that's
the way it is we'd have as much money so
I had walked DMC Bob sorry I had a
question I doesn't run under rc2 yet it
does all right yeah it runs on net
standard 1.1 which I will not go into
what that means yeah it runs on net
standard one one so they go up and pull
up no go to a new tab new nu J org slash
packages a slash automapper that was not
my term by the way that was Miguel de
Icaza the latest beta version which can
only be called beta because it depends
on pre-release packages of other stuff
Sportsnet standard 1 1 which will be
anything xamarin related not silverlight
5 sorry u silverlight fans out there
it'll support dine at 4 or 5 of course
and then just about anything else under
the Sun xbox feed love for Xbox I guess
it supports pretty much any of those
platforms
okay it's about time to drink beer we
have time for maybe one or two questions
let's go in the back row area anyone
have any questions for either of these
handsome gentlemen that have more hair
than me they want a drink beer - oh you
got one okay
the most common pitfall I well there's
there's two big ones one of them is I
only built it to do the translation from
complex domain model to stupid-looking
DTO a lot of people try to go the other
direction I just really wasn't built for
that scenario so it works in simple
cases like I might have a very simple
case like creates in this case creating
it will just map it from the form to the
object because it's very simple but for
more complex scenarios it won't so if
you find yourself having a lot of custom
configuration just like stop what you're
doing and just hard code it because
that's more obvious don't put a lot of
configuration in there the other one
that people aren't into a lot and I
don't know how to really get around it
is over in the profile object over here
they won't call create map they'll call
map or dot create map which is the wrong
one and won't work either so don't do
that - make sure you call the the one up
here the latest five oh and the new 500
released when it's coming June 27th
evidently because that's when net core
will actually are TM well for whatever
your definition of our TM means we
suppose the first Reap the money I don't
know then it will be fine that's
basically have to wait for dinette core
to be released because I am depending on
pre-release packages and so that means I
have to be labeled as pre-release as
well Thank You gentleman very much
appreciate it appreciate you guys coming
out and it's just on time we just
finished up if you have any questions
for these guys no we're going to go
drink beer so see you guys thank you so
much for coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>