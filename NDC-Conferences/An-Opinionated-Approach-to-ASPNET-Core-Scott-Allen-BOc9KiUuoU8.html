<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>An Opinionated Approach to ASP.NET Core - Scott Allen | Coder Coacher - Coaching Coders</title><meta content="An Opinionated Approach to ASP.NET Core - Scott Allen - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>An Opinionated Approach to ASP.NET Core - Scott Allen</b></h2><h5 class="post__date">2018-02-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BOc9KiUuoU8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">who's new to NDC London just curious
first time quite a few that's good this
is one of my favourite conferences in DC
so I'm glad to be back here lining up
Scott Allen what I wanted to talk to you
about were the opinions that I have
formed working with a couple different
teams building asp.net core applications
over the last couple years so I think
most of the opinions that I've formed
that I put into this talk are broadly
applicable but of course you can take
everything with a grain of salt and
figure out what works best for your team
if I were to categorize all these
different opinions I would put them in a
few different categories like how to
organize your solutions and projects how
to organize your startup code for
asp.net core some simple rules for
controllers for client code for c-sharp
code for managing views and for writing
the unit test so let's get started
talking about solutions and projects
basically when you start building an
application or a system with asp.net
core how should you organize your
solution where should projects go what
sort of file system structure should you
have because one of the interesting
things about Microsoft open sourcing so
many pieces of dotnet core and other
frameworks is not only that you get to
see the source code for a particular
framework weave but you know we've
always been able to do that with Addie
compiler we've always been able to get
to the source code well we haven't
necessarily always been able to do is
look at the bigger picture look at the
project structure look at how Microsoft
lays things out on the file system how
they organize their projects what they
actually check in to the source code
repository as well as how they write
unit tasks and even the unit tests I
found extremely valuable because then
you can read through the happy day
scenarios for the framework and see how
it's supposed to work and what's
supposed to break but if you go into
every github repository for a dotnet
core framework or a dotnet core
application you'll see a lot of
consistency in how that repository is
structured at the top level you'll
always find a source folder so yes all
of the projects will go underneath that
source folder they'll always be a
solution file by the way in the root of
the repository that makes it really easy
for a new developer to walk up and
get plone that repository and
immediately find a solution file or
sometimes multiple solution files to
click on and open that up and get it
running in Visual Studio it'll typically
find a test folder for your unit test a
build folder for build related scripts
and build related tools there's usually
samples there's documentation sometimes
there's also a folder for deployment
with deployment scripts and provisioning
scripts to set up something in the cloud
so I took that approach also on my
asp.net core projects and I found it
very valuable because it just becomes
familiar then when you're working in
this ecosystem if I walk up to something
that's built in net core I expect to
find a solution file in the root I
expect to see a source folder in a test
folder and I know exactly where to start
drilling in if I want to find this unit
test as well as typically a
documentation folder the one caveat here
those of you that have used visual
studio to work on asp.net core and a
huge visual studio for a long time know
that that solution Explorer window
that's currently on the slide is showing
it's a lie right it's not sure it's not
providing a faithful representation of
the actual file system if I right click
and solution Explorer and say create new
folder it doesn't create a folder on the
physical disk it creates a virtual
solution folder and stuff I put in there
it can be anywhere in the repository but
Visual Studio 2017 there is this nice
feature that not many people know about
in the solution Explorer window there's
a little toolbar icon you can click on
called solutions and folders which
switches solution Explorer into a
physical view of the file system so now
what you see is a faithful
representation of how you structured
your directories and where your projects
live and it's very easy now to
right-click and say add a folder and
that folder actually gets created in the
location that you thought it was created
so you use the folder view also include
samples so if you're building something
that is a library that other people are
using your new get package to consume
that library and they're trying to
figure out how it worked how it works
even its if it's for your internal
company it's very useful
be able to go into a sample just to see
some sample code on the expected usage
of the framework that you've created and
if you look through most of the
Microsoft repositories again if you're
trying to understand some specific
pieces of asp.net core dotnet core
you're trying to find out for example
how does cookie authentication actually
work underneath the hood what are the
different ways I can configure it if you
go into the github asp.net core security
repo there's a ton of sample showing
different scenarios for using cookies
and using dot tokens and using Open ID
Connect and those are all very valuable
to people that have to consume that
nougat package or those packages and try
to put them to work
questions so far
since the content you expected when you
walked in this morning yes okay at least
a few people in the affirmative there
I'm also a big believer in checking in
any scripts that might help during
development so for example if you're
using the entity framework or and you're
a developer who asked to always check in
some new model code entity code and then
create a migration and then add update
the database and so forth it's nice just
to have scripts to do those sort of
repetitive tasks that will take some of
the guessing and work out of what
directory do I go to to run this because
you know this particular solution you
might not run the might think the dotnet
executable to create a migration from
the web project you know someone might
have it set up for a different project
that actually is referenced by the web
project so you can check in scripts even
this simple that says okay I want to add
a migration so we're gonna change over
into the data project we're gonna run AF
migrations and add your migration you
just pass in a name then we'll do the
database update and then well thanks it
out of here and also there's another
script here a developer sits down and
just wants to start from scratch start
with an entirely new fresh DB so a
script to just recreate the database
from scratch and reseed it with some
initial data there's been very valuable
in development and the reason this sorry
to go back for a second the reason this
works so well is that the dotnet tooling
so command-line oriented but it's
actually quite nice to be able to
automate a lot of these processes a lot
easier without figuring out how to
create a visual studio extension or
something like that also I am a big
believer in including deployment scripts
and templates so if I'm building an
asp.net core application that gets
deployed in AWS or an azure app service
then I went to have some script or some
template as a developer that is checked
into source control that I can execute
to provision my environment in the cloud
that helps me the first time when I'm
trying to get set up and started with
the project but it also includes and
this is just a screenshot of exporting
and as a resource manager template out
of Azure that describes all the
properties that have to get set on an
app service if I'm a web developer who
let's say is building a asp.net core web
application and the communicate server a
service boss to some other application
and I know that I'm adding a new feature
that's going to require a new service
bus queue or it's going to retire
require a new configuration entry for
that app service then I don't want to be
logging into a portal or using a UI to
make those changes in the cloud that
only worked for me and then remember to
document that process for someone else
puts them in you have to think of most
of your environments now is programmable
data centers I want to be able to write
a script that I check in under source
control that someone can diff to see
what changes there are I'm going to have
that in source control and be able to
run that to be able to create my
environment in the cloud or to update my
environment in the cloud and provide a
new setting and those are I want to say
that they're great things to have
sometimes are not the easiest things to
write sometimes it's difficult to
encourage developers to stick with this
and keep automating every step that they
do but if you have a let's say our
script that goes out and randomly
deletes app services that developers
have created a random delete deletes
resources that encourages them to script
everything out so there's a number of
different build systems that people are
using for asp.net core some of us have
our own build server some of us use
services like a pair and visual studio
comm and both of those environments I've
worked with out there and visual studio
comm they're both great but the one
thing I would suggest is both of those
services try to give you provide you a
user interface where you can go in and
just click some configuration items and
say here's how I want to do my build the
problem I've had with those systems are
first of all if something goes wrong in
the build it's impossible for me to
replicate that locally so let's say I
have an app bayar build setup where I
just went into a player and clicked a
few things on their webpage and says
here's that says here's my repository
here's the solution to build and I'll go
build it and do these other steps when
that fails the only way to debug that or
to get it fixed is to log back into that
app the ER UI and fiddle with it until
you get things right which is very
frustrating but both of these
environments at Bayer and Visual Studio
comm provide some alternate mechanism
for you to do a build so for example a
player instead of going through their UI
if you create a yamo file that you place
into the root of the repository for the
project that you're building that yamo
file what they provide anything that
someone put into the user interface and
so now you have something at least in
source control that you can dip so if
something changed you can kind of see
what happened and what's wrong
and you could use the schema file to
kick-start some sort of build script
that you've written instead of relying
on app and relying on a pair and
hopefully that's a script that you can
also run locally for development so that
would be an example of a simple
PowerShell script that goes out and does
a dotnet restore dotnet build on that
test and then dotnet packaged or dotnet
published or dotnet pack depending on
what you're building
same thing for Visual Studio com
they provide this nice drag-and-drop
user interface where I can say let's go
out and do a dotnet restore net build
build a solution dotnet tests all of
this stuff well when that thing goes
wrong
or one of the paths relative past that
you have configured into there is
incorrect then you have to go around and
fiddle with visual studio comm to get
that working instead what I do with
visual studio comm is they have sort of
a marketplace for these tasks that
appear over here on the left hand side
they have a marketplace where you can go
out and grab additional tasks and
there's tasks there for nearly
everything to run Gradle and grunt and
golf and so forth but one of the tasks
or two of the tasks that are in there
are cake and pee sake anyone use either
of those there's a session coming up on
cake later today after lunch but cake is
basically a way to define a build for
your dotnet core or dotnet framework
project using c-sharp code and it's
something that you could run locally to
do a build and something that you could
check that into Visual Studio online
calm and use this cake task to do your
build the same build online in the cloud
so that's very useful and again it's
something you can diff and look at and
reason about when things change
let's talk about startup code for
asp.net core the typical convention is
to have a program dot CS that contains
the entry point for your application and
then there's a start up top CS that to
me only has three responsibilities or
really these days just two
responsibilities and that's whatever
code you put into the constructor the
code and configure services and the code
and configure and the reason I say
startup dot CF should only have three
responsibilities is because I've seen
people put all sorts of odd bits of code
inside of here so abstence ibly to me
these days
configure service the the two important
pieces are configure services that's
basically where you configure your ioc
container so you say i have this service
with this lifetime or for this interface
use this concrete type using this sort
of lifetime transient or scoped or
singleton and that's all you put in to
configure services for configure that's
abstence ibly where you plug in and
create your HTTP processing pipeline
by adding in middleware but sometimes
when I open up start up at CES I see
people configuring their logger inside
of configure I see people running
database migrations or seeding the
database inside of configure and it just
gets kind of messy I'll talk in a second
about where I prefer to see the sort of
start up activities because yes you need
to configure the log or somewhere where
do you do it to me not inside of startup
to me the logger would be configured
before the configure method and the
reason I say this is because in the
asp.net poor 1.0 templates if you did
file new application in Visual Studio
and go and look in the configure method
there was some logger configuration code
that existed inside of the configure
method so a lot of people just ran with
that and kept adding more logger
configuration code inside of the
configure method the asp.net core 2.0
template gets rid of some of that
because that code was hoisted out and
put into a default web host builder that
gets executed during program dot C s
inside a program FCS inside of your main
method so that's much better just make
sure you take your logging configuration
and specifying the additional
configuration sources do that if you
have to inside of the start up
constructor but these days I would
rather see it in program about C s the
configure services method there's some
projects where I've seen that method
grow out of control because people were
adding different types of services and
adding all sorts of configuration
options and an asp.net port 2.0 you
might know that they moved a lot of the
authorization and authentication
configuration out of middleware and into
services so configure services continue
to grow even bigger as people were
specifying how to use cookie
authentication and how to use open ID
connect when I go in to configure
services I'd prefer to see something a
little bit cleaner like this just
straight one-liners that say we're using
this thing and be
see yes we're using security we must be
secure reusing mediator or using some
data stores and then each of those
methods if you need to do some
additional work additional configuration
options just right extension methods
like add custom add a customized version
of MVC these are the things I need to do
I need to add to the conventions I need
to add some raiser options but by
keeping all that stuff out of configure
services it's much easier for me to go
into that method and see exactly what
the application is using or at least get
an idea of what method I need to drill
into to see what specific options are
being set otherwise like I say I've seen
configure services methods that are two
to three hundred lines of code and just
very difficult to read through same same
would be go for the configure method
where you are configuring your
middleware although in here I believe it
is okay to allow some branching with an
if-else statement to say okay if we're
in the development environment use the
these three pieces of middleware we'll
use the developer exception page the
database error page and browser link I
should get that out of the slide I don't
actually does anyone use browser link
yeah otherwise use our production
exception handler slash home slash err
so that's that would be inside of the
configure method of startup at CS and
other than perhaps branching with
if-else statements I don't want to see
anything else since how to configure
it's very important to be able to look
at that particular part of the
application and understand exactly what
little where is installed under what
conditions and on what order it comes in
because I want to be able to go in there
to see is this application configured to
serve static files is this application
configured to use MVC with a default
route or not the other thing I suggest
is what's interesting about that asp.net
core is what we're what we are building
is an application that I can execute
from the command line yes if I'm
building an asp.net web application that
thing will be fronted by some sort of
web server or it'll have
you're running and receive HTTP
connections directly but what I'm
building is something that I can execute
from the command line and it's an
application that knows everything about
its environment you've already told the
dotnet core framework and asp.net core
what are my configuration sources what
services am I going to use so it's a
very useful application that can do more
than just respond to HTTP and HTTPS
requests because if I run this
application during the startup since it
knows everything about the environment
that it's operating in that's where I
might place some logic to start
processing some database commands so if
I need to seed a database or run
database migrations or do any of that
sort of work to set up my environment my
development environment this would be a
nice place to execute those commands so
you'll notice this is your typical
asp.net core we're gonna use a web host
builder with Castro and a Content route
and so forth and so forth but before ho
stop run there's a process DB commands
that takes the command-line arguments
that are passed in and the host so it
knows how to get to things like a
service provider and what we can do with
that would look something like this and
hopefully that's kind of visible and
this is sort of just crude brute force
code to show you what's happening so I'm
gonna look at the command line arguments
and see if someone told me to drop the
database because again this this
executable has all the configuration
sources so it knows what database I'm
using ok I'll go ahead and drop the
database or migrate the database or see
the database and maybe you wanted to do
one or more of these things and then
just stop in other words I wanted to not
actually launch this application to
start processing HTTP requests I wanted
to launch this application because it
was properly configured to do all these
things and then I can stop it and start
doing my development work that making
some sense good
also another tip if you ever ever use
services by going directly to the the
service provider particularly if you're
doing it during startup make sure you
get an instance of I service scope
factory to resolve the service that
you're trying to get to so what I
service coke factory will do when I
create a scope whilst accidentally
clicked there I'm passing that scope
into some other methods and those
methods can say dear service go please
give me this dbcontext or give me this
ilogger implementation whatever it is
and the service scope factory will make
sure to clean things up afterwards I
could just go directly to host dot
services and do a dot get service to try
to get to those same things the logger
DB contacts whatever service you're
trying to get to but you just have to be
very careful if you do that because it's
very easy to accidentally create a
singleton even if that service was
Richard registered to be have a
transient lifetimes very easy to create
a single time that's just gonna live for
the rest of the process unless you do
this inside of a particular scope so you
use that if you're going to try any of
these tips that I'm showing you during
programmed up CS or inside a startup
about CS but don't do it inside a
startup about CS and then all those
parameters I can just feed them into a
script to a developer so if they want to
do something like recreate the DB all
they do is drop down main line switch in
that scripts directory run recreate DB
it'll go to the website and start it off
and tell it to drop the database migrate
the database see the database and stop
and poof now they have a freshman
database to work with
project structure let's talk about
feature folders anyone use feature
folders oh good it is very difficult for
me extremely difficult for me these days
to walk up to an asp.net MVC project and
work with the typical convention of
having controllers in this folder views
in this other folder and then models you
know somewhere else
I much prefer an organization where I'll
have some sort of top-level folder
called features that represents the
different pieces of my application as
viewed perhaps by a business user or
someone who's actually navigating that
application so for example this
application has an admin section inside
of admin section there's a place to
manage a seat a sporting season you know
and this sort of maps almost to the user
interface that I would experience if I
was using this application I go to the
admin menu and somewhere there's a pop
out that says do you want to manage the
season yes click on that and then inside
of the folder there are controllers so
manage season controller dot CSS and
views and perhaps even models everything
related to that feature in one location
because typically as a developer when I
go to work on an application I'm going
to work on a feature like someone wants
me to fix a bug in manage season or
someone wants me to implement that and I
don't want to go to three or four
different places to open up all the
files that I need to work on that
particular feature I would rather have
this one location and I'm sure you can
look at past histories of NDC's I think
other people have done talk specifically
about feature folders in the past but
it's the way I like to organize things
now but I have eaat that because I'm
gonna give you a one other thing to
think about and this is just an example
of how you might take the account
controller that gets generated if you do
file new project in Visual Studio and
ask for the asp.net identity features
anyone who has ever looked at that
account controller node knows it's a bit
of a mess the last time I look what
Visual Studio would do is generate two
controllers both with about a hundred
lines of code inside
and they were just very difficult and
unwieldy to work with break that
breaking that out into features I might
take just the log in log out feature and
move that into its own controller and
inside of there the views and the models
associated with that feature so very
easy to find and work with and I like it
so much that I created a nougat package
a couple years ago so you can just
install decode feature folders and
inside of configure services when you're
adding NBC can just do not add feature
folders and yes there's configuration
options you could pass in there to
change the name of the features folder
if you want to for example but it's just
that easy however that being said these
days with asp.net core to the pillow at
2.0 you know they introduced razor pages
anyone using razor pages heard of razor
pages yeah quite a few I've begun to
form the opinion that if I'm building an
asp.net project that is intended to be a
service so it's primarily there to
provide endpoints to communicate over
HTTP or HTTPS and serve up JSON or XML
so it's an API project that's where I
use asp.net MVC core controllers whoops
we're all do advancing again that's
where I use controllers it's like the
widget controller overcome the left and
I've begun to like razor pages so much
that I think they are the best way to go
if you're building something that is
rendering HTML so for those of you that
haven't seen feature folders sorry razor
pages I just want to do a quick
show-and-tell here I'm gonna create a
new project and you might remember what
the again what asp.net identity looked
like if you generated an MVC project and
you wanted individuals to be able to
authenticate and you wanted to store
their user names and password in your
database that's not what I wanted what
about 55 and put it in the temp
directory
and inside of this next dialogue I'm
going to pick not web application model
view controller but web application and
change authentication to use individual
user accounts store the user accounts in
my application and what I want to show
you is just a little bit of how razor
pages can be laid out and what their
features are because I know a lot of
people when they first heard about razor
pages the initial description was
something along the lines of here's
something you use when you just need to
build that about page and you you render
HTML and you don't really need a model
or a database access you're just trying
to you know basically write an HTML page
so in that scenario you use razor pages
but it turns out when they came back and
actually looked at them my selves they
had a lot more features than just
rendering HTML and they worked a lot
like the feature folder approach that I
always wanted with models and views and
controllers so over here on the
right-hand side instead of controller
multiple controllers to manage these
users I have pages for users for a user
to manage their account to do things
like change a password manage their
external logins set their password and
all these things used to be
features that weren't implemented in
those two controllers that Visual Studio
would generate so the first thing I
liked about this is now I saw oh there
must be easier to break things out with
razor pages which you know they could
have broken them out with controllers
too but what's nice about this let's
pick change password so a user wants to
change their password first of all
there's my view that's the razor page
change password dot CSS HTML this is my
let's call it a code behind page for
lack of a better term that's sitting
right there beside it so everything I
need very close together when I went to
work on the change password feature when
I open up the CSS HTML I'll zoom out a
little bit you'll notice an app page
directive at the top of the razor view
that tells asp.net core this is a razor
page you'll notice I still have a
strongly typed model I can still
view data render partials I can still
use asp.net or tag helpers so all the
features that you would expect from
Razer are still there and the code
behind file for those of you for you
know a lot of people worried this was
like the return of web forms it's not
there's no viewstate the B code behind
or the page model is a class where I can
still use constructor injection and
method and method level service
injection so I don't have any hard
dependencies and using HTTP context up
whatever I can inject everything I need
I'm not doing anything up I have these
bindable properties so I know the user
is going to enter in the new password I
can have that model binding feature
apply that directly to a property that's
on my page model class and then I can
implement methods like coming down here
a little bit on getting on post so I
know when someone is requesting me to
render this form and I know when someone
is posting back with an updated password
or new form values so easier just as
easy as a controller to test and work
with but I think it's it is a lot nicer
for managing HTML and working with forms
so that's my little plug for razor pages
if you are working with controllers
there's a couple tips first of all when
on the route attributes first came out I
wasn't a big fan I said wow people will
just literally just a route attributes
all throughout the code and that's just
kind of messy why can't we just stick
with the one conventional route that
says just send slash controller slash
action to some controller action well
what I've discovered is that these
routes are particularly useful because
it allows people to actually think about
URLs instead of always trying to cram
everything into that default routing
rule that NBC can provide so they can
think about things like hey this piece
is really in the admin section in the UI
maybe the URL should map to that and we
should have some sort of admin prefix in
front of the URL the other big
difference I've seen is you know look
through any NB C source code base and
will be int ID on 500 different methods
inside of that project right you look at
a method and you're not exactly sure
well is that an invoice ID or the
employee ID sort of foreign key ID I
don't know but if you encourage people
to use these route attributes they can
also name parameters a little better so
this route attribute
I'll sorry about that I keep
accidentally clicking this route
attribute since I don't have any leading
tilde or forward slash it's going to be
relative to whatever route attribute is
on the controller it's basically saying
I need to see an additional parameter in
the URL which we will call season ID and
so now I have code that has a reasonable
name for a variable that I used
throughout that method weight and I
really like that better than just having
into ID everywhere know what I mean yeah
okay some additional information
I like mediator anyone using mediator
pretty sure Jimmy Bogart is given some
talks at NDC and has some blog posts
he's the creator of mediator I'm a big
fan of mediator because it decouples
first of all it cleans up the controller
if you tell developers on a project
we're gonna use mediator and we're not
gonna cram logic into a controller
action makes your controller action
smaller which is good and it also
decouples the controller a bit from the
end abstractions that are going to
handle a particular scenario so the user
is gonna log in they'll post me some
forum values that I encapsulate into a
login user command model and I'm gonna
use mediator to send that off into some
other system that hangs off the mediator
bus in memory that's listening for that
particular command to process it and the
controller doesn't have to know who's
processing the login user command it
just knows it has to send that message
and wait for our result and the result
will tell it that they're at that login
was successful or not
makes things a little bit easier to test
just a quick tip I still know people
that are building projects asp.net core
projects where they include API
endpoints inside of the same project
where they're serving up HTML pages and
pages to users and people can be pretty
good about using the anti forgery token
validate anti forgery token attribute on
controllers that receive form inputs
because we're kind of programmed to do
that but just remember if you're using
cookie authentication that's where the
cross-site request forgery danger is so
if you have API endpoints you also need
to protect those against cross-site
forgery and one way to get a cross-site
the cross-site request forgery token
into your JavaScript so when your
JavaScript posts form values to you one
way to do that is to provide an API
endpoint that inject the I anti for jury
service and JavaScript can call this get
method on the xox s RF token controller
and use that anti for treats service to
get in-store tokens so that will send a
jayson result back that includes the
token and the token name the JavaScript
should use now also if it's not already
set set the C Cerf cookie that needs to
be present in the browser when a request
comes in that validates the anti forgery
token and breaks security policies so if
you haven't worked with asp.net core 2.0
security policies there are a really
nice way to program authorization rules
into your application so this particular
method right here is an example of
creating an authorization policy in
asp.net core by saying I want a new
policy builder so that just capsule
eights things like what some scheme name
is being used and San Shi AIT's the new
authorization policy builder and then
you can do dot require claims so I want
to make sure that this user has a claim
that says is admin and the value is true
or I want to require a claim that
they're from a specific department
whatever claims you might get back from
your identity provider you can basically
write assertions against them
encapsulate them into a policy which is
really nice because then you can write a
custom authorization attribute user is
admin and use that to decorate your
controllers instead of trying to place
authorized attributes or doing
imperative validation of the users
identity or the users claims it's really
nice just to be able sprinkle user is
admin on controllers throughout the
project and be able to change that
policy with if the claims are something
like that ever change without having to
change this change what's in the
authorized attribute or what's in your
imperative code that gets sprinkled
throughout views avoid HTML helpers I
know some people still use asp.net core
and are doing it the old way of using
HTML helpers like HTML dot begin form an
HTML dot text box for honestly they're
always the worst part of the asp.net MVC
so replace all of that with the newer
tag helpers ASP - for a SP - validation
summary so an example up here it's just
so much easier to read and also to
author and you still get intellisense
help and SATA ASP - bore for example if
you strongly type the model for that
view and it's very easy to write custom
tag helpers all you need to do is derive
from that tag helper base class override
the process method so you can create
your own tag helpers for interesting
scenarios that are specific to your
application
I like view components also so a view
component so where's the view view
component fit in in previous versions of
asp.net MVC we used to be able to render
partial actions as a way you could sort
of set up a mini request inside of
asp.net core and and do what it was at
HTML dot not partial but HTML dot action
HTML dot action until the Razr view
engine hey go out and call this go to
this controller invoke this action and
whatever it returns whatever whatever
HTML produces take that and place it
into my view so there's a way to sort of
build a sub component but it was always
a little bit
those child actions had some
difficulties there were conditions where
you could get into infinite loops it was
very easy to do that view components
fixed most of those problems so I can
create a view component derived from the
view component based class I implement
the implement a method called invoke or
invoke async if you have to go async and
then that mute component gets associated
with a view with a CS HTML file so this
is just returning a view but you could
also build up a model return a model
it's all encapsulated and I might build
a component for example to encapsulate
this bit of markup which is my main menu
and then it's so easy to use that
basically what I can do with Visual
Studio 2017 and asp.net core to point
out is just say VC colon and then the
name of my view component and he uses
that kabob style where mmm the name of
the class might be main menu view
component with to uppercase M's but
everything here will be lowercase and
there will be a dash in front of capital
letters that appear later in the name
what about client side code managing
things like angular and react I've
become a big fan of web pack myself I
try to use webpack to do everything that
web pack can to try to jettison any
other tools I've certainly gotten rid of
tools like Bower and some of the other
package managers I just use web pack in
a couple different ways this would be an
example of a web pack configuration file
in a project that's building my vendor
Jas file so it's taking all the react
modules react on reacts trap Axios and
es6 promise polyfill taking all that
stuff and outputting it bundled up into
a file called vendor Jas that would be
an example of a simple web pack config
file but what I have found useful with
web pack is using multiple configuration
files and using them for different
scenarios and the one thing to recognize
about web pack is it's not a JSON file
that just has configuration information
in it
it is a program that gets loaded into
node and gets executed so if you wanted
to do some fancy your programming inside
of this web pack configuration file you
can do things like build a list of files
by globbing stuff using expressions like
this so I want to go through my features
folder and I'm gonna glob up all of the
typescript files that have dot specs in
the name because I'm trying to build a
bundle that contains all my unit tests
transpile and bundle all that ups so I
can throw it into my unit test runner
but I need to also I have I have these
scripts that support that in teacher
from places under the features folder
and also under a client folder which is
more of like a shared border so that
would be an example of some of the
programming you could do in a web pack
config file that makes life easier
sometimes instead of trying to figure
out things like regular expressions or
something down here in module dot
exports anyone use Steve Sanderson's
JavaScript services it's a nice way to
encapsulate web pack operations behind
the scenes so if you I'll let you try
this on your own go into visual studio
do file new project and pick one of
those templates that says I'm going to
create an angular or a react application
so one of those last three options and
what you'll have is a project that is
set up with web pack and the framework
that you selected and does a lot of this
magic with like configuration files
behind the scenes so typically all the
projects I've worked on where we've used
angular or react we've had to have
another command line window open running
web pack so that every time someone say
is a typescript file a new bundle gets
everything is transpiled a new bundle
gets bill to get spit out on the disk
somewhere and it's just the pain of
setting those things up sometimes
javascript services tries to do all of
that for you and tries to do it
magically behind the scenes so that i
just launched the project from visual
studio or run it from the command line
like i normally would and in debug mode
one of the things javascript services
will do
is monitor your typescript files or your
JavaScript files so if a developer sees
one it will coordinate with webpack to
recompile andrey bundle all those things
and then just patch them into the
browser to refresh what you see on the
screen which is really quite nice it
looks kind of like this JavaScript
services will use webpack dev middleware
when you're in development and you can
turn hot module replacement and rope
owner off so it's a really nice way to
integrate some of these advanced newer
modern JavaScript frameworks with what's
happening inside an ESP down there core
and visual studio and speaking of
command-line the built in Windows
command prompt isn't that great I'm sure
many of you already know about con mu or
Commander those are just free
applications you can download to use
instead of using the windows command
window the nice I use Connie mu the nice
thing about it notice it's get aware so
when I move into a directory it
automatically can detect hey this is a
git repository and this is the branch
that you're on Oh IDC integration and
it's in red that tells me that I'm in
this folder and I haven't I have
uncommitted files so I may need to do a
git commit and get pushed to get things
working the other thing I like you'll
notice down here it has a you can open
multiple tabs so I could have one thing
open here with command X E and other one
with PowerShell another one with a
different path so I can run maybe a
Python program something like that or
open another tab with as administrator
if I need to do something to
administrative leave I'm gonna I'm the
next thing I like about Connie mu is to
split windows so if I need to run let's
say on the left hand side here I need to
run web pack to watch files and read
trains pile them when someone changes
things I want to be able to see that but
I also want to be able to see when my
specs change I want to make sure that
the compilation of my expect files is
successful and I also want to be able to
see once everything has been compiled
and the unit tests execute I want to see
if that has been successful and I don't
necessarily want to do that by docking
three windows somewhere on my monitor
I just want one window where if I see
red in any of those three things I know
something has gone wrong and the syntax
you would use with con mu to start those
three windows automatically there's a
little bit quirky but it would look like
this basically start Connie mu and in
one window do an NPM run watch in
another window that has been split
horizontally
that's the SH over here run my test
watcher and then in another console that
split vertically run my karma test
runner and if I remember you would not
actually be able to put line breaks in
that command has to be across a single
line for Connie Mew to respect that but
that wouldn't fit on a slide if I didn't
put line breaks in client code layout
I've become a fan of having a client
folder that becomes a location or all of
the code that's going to be used perhaps
throughout the application so things
like models and services that I rely on
CSS that are specific to that particular
framework like angular the CSS files
that I might have to know about can go
in that client folder but then some
specific things that are specific to a
feature you'll notice over here on the
right hand side there's a TSX file so
it's a react view written in typescript
it's actually inside of the future
folder right along saw aside a
controller and the view that is
associated with that feature and I've
again found that's a nice way to say hey
I need to work on this manage invoices
screen wherever that is or whatever that
is let me just find that folder I know
it's in the admin section here's the
manage invoices manage golfers whatever
you need to manage and inside of there's
pretty much all the primary abstractions
that I might need to work with yes I
might need to change a service over here
but I can deal with that all of all of
my entry points of where I start looking
at that code are here inside of one
folder
I'm a big fan of using just nougat and
NPM package managers so I know Visual
Studio over the years has kind of
encouraged net developers to use Bower
but these days NPM is quite good with
front-end frameworks so it doesn't
matter what I'm doing on the server side
with nodejs
if I'm using it to run web pack or what
have you and I don't care what I'm doing
on the client side if it's just even
jQuery is my only dependency I tend to
rely on NPM for all my JavaScript stuff
so I can npm install jQuery NPM install
angular NPM install web pack I don't
have to worry about Bower or other
package managers yes you might select
yarn but my suggestion is just use one
package manager for all of your
JavaScript don't make a difference
don't differentiate between front-end
and back-end JavaScript I'm a big fan of
typescript these days well I'd say a big
fan and to be honest I haven't done a
lot of client-side development over the
last 12 months kind of been on a break
from it but there was a period where
typescript first came out where I was
hoping it would succeed but I just
didn't feel like it would ever work in
the JavaScript environment because
typescript was being developed and yes
they're trying to be compatible to
JavaScript and yes every legal
JavaScript program was a legal
typescript program but it just didn't
fit in the ecosystem that felt like
every time I tried to use typescript
even with say like jQuery there's all
these weird hoops I had to jump through
and install these typing files and so
forth but over the last and 2016 it
really became remarkable I thought the
way the typescript team started working
with the angular team and actually just
became so integrated with the Java speak
JavaScript ecosystem that it became so
much easier to use and some of the
features that they added to typescript
made it so much easier to use and I'm
not I'm not talking about runtime or
syntax features I'm talking about
features like the module resolution
feature so I want typescript to work
just like no does if I have a nude
modules folder and I tell typescript to
import something it should go off and
use the same module resolution algorithm
as no js' and go searching through the
directories inside of new modules to
find that
the ability to tell about Talib
described to it the the libraries and
the features that i have by default so
don't warn me if I'm using promises I
guarantee you I've a library that will
polyfill or shim es2015 promises if need
be and the ability to subscribe paths or
where to find modules one of my biggest
frustrations developing JavaScript like
in 2015
trying to use all these different tools
was just trying to tell the tools where
things belong like what folders to look
in so don't look just inside of my nude
modules folders if I import some service
into a type script file that might be a
service that I wrote custom so where
should you look for that look inside my
client slash script folder and start
using your node modules module
resolution algorithm on my folders also
to find the files and things that I'm
using so type scripts come a long way
and works pretty well I still prefer
using Visual Studio code so the one team
I work with we always have the solution
open two ways it's open in Visual Studio
that's where we do all our c-sharp work
and we have Visual Studio code pointed
to the same root folder and that's where
we do all of our typescript or
JavaScript or echo script work just just
because the the editor seems to be a
little bit faster and the intellisense
is a little bit better and you don't get
as many false positives for errors
inside of Visual Studio code and I think
of www root is my bin folder for the
JavaScript application so that's where
web pack will bundle everything and
place it there's nothing really that I
own inside of www
now many people know this but you could
install the asp.net core static files
middleware multiple times pointing in
two different locations so my thought is
pick a folder that's going to be served
by static files little we're an asp.net
core that's going to be your flying side
bin folder that's reproduce all your
compiled or transpiled
output from tools like web pack and then
if you also have additional static
content that images that you need to
serve and so forth you could place them
in a different location a different
and also create another instance of
static files middleware to pull assets
from that folder some thoughts on
testing I have no problem using a single
test project across multiple projects
I've worked with teams where every
project that you create every CS proj
and head of a corresponding dot test CS
proj file and that was okay but
sometimes it became hard to find things
and just felt a little bit I don't know
unnecessary to me what is a project when
do I create a new project I'm creating a
new project because I have some
deployment requirement you know that
piece of code has to be deployed
differently than this piece of code over
here in a different project when it
comes to test code all I care about is
that it all gets compiled and it all
gets executed by a test Runner I don't
have to deploy them in different places
I don't have to share them differently
so just placing all the test code inside
of a single project seems to be a little
less overhead inside of tools like
Visual Studio and then everyone's using
X unit these days so I don't really
that's not a very opinion that gets a
lot of pushback but I know some teams
are still trying to use MS tasks but X
units the way to go I try I personally
try to avoid mocks and my actual take
wanna right now this bottom piece right
here to be a successful Marcus you must
dislike mocks so do I use mocks yes I
use mocks but I try not to I dislike
them I just so I've been trying
test-driven development since 2004 and
I've tried mocking and I've tried to
avoid mocking and just the problem with
mocking that I see a lot of people fall
into the troubles are that they do too
much interaction-based testing and it's
still possible to ship an application
into QA or into production that fails
because with all the unit test paths
because people were testing interactions
not trying to do state pest state-based
testing not trying to think about the
test in a way that would actually
faithfully test is the system meeting
the expected requirements so kind of
along those lines I'm a big fan of the
asp.net core test host so there's a
nougat package out there and Microsoft
that yes peanut
we're not test hosts if you look through
the asp.net core repositories you'll see
this as use and a number of their test
projects and this is just a little
example of what you can do with it so
what is it you know it's you can think
of it like an in-memory server I'm gonna
create a server so this this method
wraps the creation of Microsoft that is
peanut cordon test toes but what it has
the ability to do is create a host that
I can talk to that host uses the
middleware that I've configured and try
to start up at CS and use it as my
configuration and it knows it's gonna
work just like my application does when
I send it an easy to be message so I'm
going to create an instance of that
server and I'm going to send off a get
request that would look like it's going
to example.com slash protected query
string X requested with blah blah blah
blah and I'm going to start writing
asserts about what that server returns
to me because I'm hoping that the cookie
authentication options were configured
properly for me
so that it sends me a redirect response
to go to example.com slash login so and
here would be another example test a
little bit simpler maybe I'm going to
create a server send off a get request
to example about column slash normal and
make sure I didn't get blocked make sure
I got back a status code of okay so it's
a really nice way to do integration
testing and see if your applications
working end to end and to me these days
I'm a big believer in getting the most
bang for the buck out of test code so
the less test code I can write the
better because things are gonna change
and it's always troubles me when I have
to refactor test code but if you think
about this asp.net core test host
running your application which you know
you're probably using something like the
Edit II framework maybe to talk to the
database well there's also an entity
framework for in-memory provider that I
can get instantiated when I'm running
this test toast and now all of my
operations can flow through my system
from the very beginning through the
middleware into a controller into the
database and everything just stays in
memory nothing goes over the network
it's rendered X disk so EF court in
memory provider I can use it just like
entity framework for talking to sequel
server with a caveat that the EF court
and memory provider doesn't apply all of
the constraints that a the real sequel
server provider would provide so I don't
remember all the scenarios but you know
if you try to insert a record or insert
an object that references of another
object we're in sequel server it might
throw a foreign key violation the
in-memory provider won't do that so yes
you'll be able to get away with some
things your test might miss some things
but if you can run a request through the
asp net core test host that goes all the
way down and interacts with the
in-memory database that gives me with
just a little bit of code somehow a high
level of confidence that this would
actually work when it gets shipped into
production and I'll make these slides
available this is just an example of
configuring that in-memory instance and
the important part is this line that my
mouse is over use in memory database but
the combination of those two things I
have found that I've been writing more
integration tasks where people call
integration tests and maybe fewer unit
tests and trying to mock things out
because if I want to test that my
application let's say fails if I in try
to insert duplicates Seasonings where
season is of you know some sort of
sporting season this one's not using the
ESP dynacord test oath but i can
instantiate a controller and check my
mediator create the command the mediator
command that's gonna go into that
controller go to my in-memory EF context
tell it to go ahead and insert an
existing season and now tell my
controller to create this thing you know
user just made a request to create
something with the same name I should
get an error back out and model state so
did i I salute the controller from the
services it uses no so is it a true unit
test
no is it a decent integration test I
think so I get a lot of value out of
those what ten lines code
for c-sharp code so the biggest thing
about c-sharp paired with asp.net core I
know a lot of people find the ability to
run asp.net core on Linux very
compelling because Linux is obviously a
generally cheaper environment in the
cloud so I see people trying to write
and develop asp.net core projects inside
of Visual Studio on Windows and then
trying to deploy it on Linux and a
couple things that always come up are
things like hey I used backslash n
instead of using environment newline so
one a work environment if you use
environment newline instead of trying to
hard code characters into strings you
will get the proper new line string
defined for the environment that you're
operating in same thing with like
combining path paths together
is it a forward slash or a back slash if
I just use the paths that combine method
that'll combine two strings into a path
in a way that works on whatever
operating system I'm targeting the other
suggestion would be really if we're
going to create asp.net core projects on
Windows and just deploy them on Linux I
consider running docker because that's
one of the things that's really good at
I know I'm gonna work on Windows and
Visual Studio is gonna be running in
Windows but my aunt's peed on a core
application will really be running in a
container on a Linux VM and I'll find
out about these issues a lot quicker
environmental issues same thing for like
environment variables environment
variables can have different names on
different systems so what is home on one
type of system might be either profile
on another and just a personal thing I'm
not a big fan of the async suffix so I
tend to not write something as with the
async suffix on methods even though it's
an async method and it comes from a yarn
strip who said when one day in a lecture
or an article when there's new features
in a language people insist on loud
explicit syntax so when async/await
first came out I think we wanted this
loud explicit syntax in our c-sharp code
so that we really were sure that this
was an async method it would have the
async keyword and then the async in the
name
but these days when everything's going
acing for an established feature I just
want the terse notation I don't want to
type a sync at the end of every method
so to me sign out tenant user that might
fail some code reviews in certain places
might get picked up with certain tools
and with a warning that says hey you
have an async method without an async
suffix I say that's okay and that
concludes this part of the presentation
so I do want to thank you for coming out
any questions I'll take that as a no
I'll be up here because I'm in this room
for the next session so thank you for
coming out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>