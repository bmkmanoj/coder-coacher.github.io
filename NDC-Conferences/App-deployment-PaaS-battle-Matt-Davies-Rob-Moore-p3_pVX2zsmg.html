<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>App deployment PaaS battle! - Matt Davies &amp; Rob Moore | Coder Coacher - Coaching Coders</title><meta content="App deployment PaaS battle! - Matt Davies &amp; Rob Moore - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>App deployment PaaS battle! - Matt Davies &amp; Rob Moore</b></h2><h5 class="post__date">2017-09-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/p3_pVX2zsmg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome everyone to app
deployment as battle my name's Matt
Davies and with me is Rob Moore we'll be
your hosts for this afternoon today
you've got several options patrolling us
you control us in person from the front
we also have a hashtag encourage you to
use that but we're going to be we're
going to be looking through a few
different has options today I guess as
principle consultants that ratify we
spend a lot of time looking at all sorts
of different options for deploying
things we get some experience across
just about every type of a type of past
deployment option that there is and so
we've seen a lot of really cool stuff in
the last few years we've seen a lot of
really painful things as well and we're
we've channeled all that pain for you
today so that you don't have to go so
quickly in the last three days in the
last three weeks but yeah so so
welcoming and looking forward to going
through some of this stuff with you
today
so what we're gonna talk about is we're
gonna start up just just briefly on the
water and wipe as it's probably pretty
basic stuff for most people and we're
gonna talk about the comparison
methodology that we're using to actually
compare the different path services that
we're looking at we're going to
introduce an API example that we've
created just for the purposes of this
talk and then we're gonna go through
four different services and we'll
introduce them in a bit and then just
wrap it up for you alright good so as
Rob said I'm sure most of you know what
what pays is if we just take our our
standard under the desk bare metal
server that's that's running all our
critical systems it looks something like
this on the Left you kind of have to
deal with everything yourself from
storage networking and so on if we look
at virtual machines or infrastructure as
a service some of those concerns get
taken away from us and and dealt with
automatically by whoever is providing
the virtual machines if we look then at
platform as a service typically we're
only actually dealing with the
deployment of the application itself as
along with any data that's associated
with it and then lastly if we look at
software as a service that's purely
outsourced to whatever vendor is
providing the software as a service to
us so we don't have to worry about
support or anything like that of course
this is just comply
wrong because this isn't actually really
what passes because I mean it's an okay
model but it's just is it's just not
nuanced enough and in reality we think
that this is actually what passes a
continuum it's a continuum where on one
end you've got you know pure I as if you
want to call it that where you have a
lot of control and a lot of flexibility
and on the other end you've got pura Paz
or whatever you want to call it where
you have a lot of simplicity you've got
much more reduced maintenance but you
also have a lot less access to the
origin knowledge of the hardware that
you're running on so if we kind of paint
this continuum with a few examples
hopefully that will illustrate why this
continuum is so important so obviously
you've got Amazon ec2 and Azure virtual
machines they're you know typical kind
of I guess pets if you want to call them
that and then you can layer on top of
that things to make them into cattle so
you've got things like vm scale sets or
AWS auto scaling that allow you to just
define how to spin up a VM and just say
I want 20 of them now I want ten now I
want 15 so make things a bit easier but
we're still dealing with yeah so you've
got a lot of flexibility or a lot of
control about what's going on there and
then you start to get more into that
path spectrum and I think you know in a
rough sense there's been about three
different evolutions of paths the early
one is Zoar cloud services and AWS
elastic Beanstalk now these are really
in reality a very thin wrapper over the
underlying virtual machine hardware
normally they just add the ability to
deploy an application and they've add
some load balancing on top and there
might be a few other little features
like health monitoring and stuff like
that you can still RDP into the machines
themselves usually and get to the guts
of it if you really want it absolutely
yeah
now the second version of Hauser's
actually only really exists in Azure
it's a zero app service which is
something that's existed for the last
five years you you kind of know that
you've got virtual machines underneath
you can even see the machine names but
you don't have access to them they're
patched for you automatically and you
just give as or your application and it
takes care of putting on all the
machines load balancing and adding on a
whole bunch
area of extra stuff on top of it and
we'll dive a little bit more in and
later in the talk
the other interesting thing that's
starting to emerge is kind of two other
I guess types of parts the first one is
path services where you kind of need to
know about the hardware underneath
because you need to provision out the
hardware or at least describe the
hardware using you know scale sets and
auto scaling type building blocks I
guess but on top of that you then layer
in a platform that you then interact
with day to day so your day to day sort
of deployments you don't need to know
about the hardware underneath but to set
it up initially you do and that seems
like a dual service fabric and all the
container services that deploy like
kubernetes and swarm and that sort of
thing and there's a really good talk
yesterday by Michelle Buster Monta about
them if you want to go on look back at
the videos to get more of a feel of
those and then the other one is
obviously all of the service
technologies that are all the rage at
the moment and you know these ones you
don't know anything about the hardware
that you're running underneath in this
obviously well they call it service
now we're gonna as I said talk about
four of these services so the ones we're
going to run through today is elastic
beanstalk service fabric app service and
container instances so we basically
chosen one of each of those four kind of
categories if you call it that of path
services now the elephant in the room is
service right so I've been talking to a
number of people about this talk that
we're doing and one of the things that
came back a few times as well we don't
need to worry about pads anymore because
we can just put things on service and
it's a magic bullet now I guess the
first thing really with that is okay
when they say service what they're
really talking about is functions as a
service or light Landers and functions
and stuff like that it's an awesome
architecture you can do some really cool
things as evidenced by all the really
great talks that are you know in this
conference about that stuff but you know
that architecture it's not a silver
bullet it's not appropriate for all
scenarios there's a bunch of scenarios
where you just wouldn't use that
architecture for so in reality the more
important thing is how do you decide
what path service you should use in any
given circumstance and that's really the
point of at all
cool so a lot of the PAR things that we
described there were more your compute
person obviously just examples there's a
there's a whole lot of stuff out there
we wouldn't be able fit at all on a
slide but specifically talking about
like a wife has I guess there's there's
all these benefits that emerged on top
of just your ROI
infrastructure-as-a-service paper wanted
services that offered them a lot more
scalability out of the box not having to
manage specifically how many VMs there
were but just like sliding a slider or
setting some auto scale settings up
making things a bit easier it offers a
lot more benefits in terms of security
we can we no longer need to worry as
much about patching our virtual machines
we get firewalls out of the box that
cover a whole lot of stuff DDoS
protection except you've also got all of
the amazing security experts in the
vendor company that are going to be far
more you know I suppose skilled at
making things secure than the people in
your own companies well they've got a
lot more money to do it yeah I guess
then a lot more people yeah so so
security aspect is a pretty awesome
benefit it'll often take care of backups
for you depending on specifically which
has service you're looking at most of
the time things are JIRA replicated out
to different environments you don't have
to deal with all that synchronization
yourself which is usually a pretty hard
problem as a developer so kind of nice
that it solves that for you so it's a
particularly useful thing for all of
these there's sort of the more data
services Simon has like databases and
that kind of thing in terms of velocity
what we often say to people is that a
really core benefit is the fact that you
get all these developer services out of
the box so things like your sequel
databases and storage and and so on but
also more complicated scenarios like
machine learning where it would like
take you a pretty long time to build
that stuff yourself but instead you kind
of just get to use it out of the box to
speed up your development it provides a
lot in terms of simplicity but as we're
sort of saying before also then takes
away some control from you depending on
exactly what it is you're trying to do
and provides a whole lot of fault
tolerance type functionality so a by
making you think about how you're
building your applications because
they're going into a cloud environment
and you'll only get certain SLA is if
you do things in certain
but also by taking care of auto-scaling
taken care of automatic failover when
Hardware dies that type of thing which
which just like massive benefits and a
massive amount of save time alone things
like health monitoring and that kind of
thing cool so I guess that that's
probably most of the background the four
services that we want to compare today
we've gone ahead and tried to score
these based on just that specific
example of deploying a HTTP API
depending on what you're trying to do
obviously you're going to get different
scores for all of your different
services it's kind of a classic like it
depends cased and depending on your team
as well the sets in your team absolutely
so the they're really the most important
thing that we are trying to share with
you guys here is the criteria that we're
using to compare all of these different
things because the idea it then is you
can go away take some of those criteria
and apply them in making some of your
own decisions so we don't specifically
won't specifically pick a winner out of
these but but for our specific scenario
there might be one that clearly comes
there is top of the others that's why
it's the past battle royale okay so this
slide I think is probably the most
important slide in the deck and this is
the one that we really want you to sort
of I guess take away from from the top
and this is basically the criteria that
we've used to compare these services and
we've broken it down into development
concerns and production concerns now
most people when they look at paas
services from what we've seen tend to
look at production concerns they think
about things like what's the scalability
and what's the cost
you know maybe what's the Diagnostics if
they're you know thinking in the right
way usually how well does it scale one
yeah and these are all you know
obviously really important but the
development concerns are also really
really important if you
I guess force your development team to
use a technology that doesn't really
match with their way of working or the
type of application that they're trying
to build then you're gonna just slow
them down and you know in this day and
age our ability the ability sorry for
most companies to to be competitive is
leveraged on the fact that they can pump
out software faster
and their competitors like there's you
know time and time again we see
instances of this happening so these
development concerns are actually really
important so I'll briefly describe some
of them and then we'll go into more
detail as we go through each service and
you'll start to see real examples of
these to sort of really cement it but in
terms of development concerns we're
looking at things like ramp up and
learning curve both of there's the
development process but also the ability
to provision infrastructure the
frustration factor which is kind of like
once you're ramped up how annoying is it
to use that service for the type of
workload that you're trying to build
ease of local development if you can't
just you know f5 something locally if
you have to deploy it to be able to you
know see what's going on when you change
something for instance then you know
that's really frustrating it really kind
of adds a lot of latency to the
development process there's also the I
guess the the features in the in the in
the pads platform so there'll be some
core features like SSL and load
balancing and that sort of thing that
you would expect to be there although
there's slight differences in some of
those core features across the very
least the four that we looked at but
then they'll also be nice to have
features that may or may not be relevant
depending on the application that you're
building like service location health
monitoring stuff like that so the core
things we've picked in our examples are
core things that make sense for a web
api and and for whatever you're looking
at it it depends on on what you're
trying to deploy yeah language supports
just you know how many different
languages does it support are you
restricted in you know your programming
models and then you know what
restrictions are there about the way you
write your app like can you use things
like calm or JDI or for instance in
terms of production concerns we're
talking about once you've deployed the
thing how easy is it to find out what's
going on if there's a problem
how easier to diagnose what kind of
visibility do you get of your running
application what's the cost and density
of the path platform can I put hundreds
of applications in one node or do I have
to have a hundred nodes what's the
amount of scale that you can achieve is
it just tens of nodes it's a hundreds
thousands how easy is it to scale is it
a slider or do I have to do some like
complex PowerShell or whatever else it
might be and how easy is it to
the application and how fast does it
take to deploy do we have to wait for a
VM to spin up or is it instant and also
you know automated deployments obviously
incredibly important it's what all of us
should be doing for you know production
and testing that sort of thing but
sometimes getting started in a
particular posit platform or if you want
to quickly try something out it's quite
useful to be able to do a manual
deployment so you know what kind of
capabilities are there around that where
does it sit on the PA's continuum and
thus what's the support overhead of it
and also how easy is it to secure the
service and productionize and make it
ready to be consumed in production cool
so an argument I guess that we quite
often hear when we get to this point is
what about vendor lock-in how do you go
and go and compare all these different
powers options if that means that by
picking one you're kind of locked in to
that particular vendor for everything
that you're doing and we come up against
that argument of fair bits what we is
what we are trying to prove as a part of
this is that we can take one example in
this case just a simple web api and
deploy that with the same code base to
all of these different powers options
and that's something that we actually
are finding increasingly is is really
really possible if you take a little bit
of time to think ahead of actually
building your applications it is
possible to do things in such a way that
you're not taking dependencies on
specific vendors that are really hard to
break later so we'll show just a single
code base here and show you how that's
deployed to all these different services
and I think the nice thing there is it
almost allows you to sort of maybe dip
your toe in the water and try a couple
of different services out without having
a huge overhead and without worrying
like laboring too much on our we need to
choose the right one first go the one
thing I would say though is I guess some
of those nice to have features that we
talked about you kind of in some
instances do need to opt into a bit of
lock-in to get some of them so you know
I guess your mileage might vary and it
does depend on what you're trying to do
cool so we're both friend person and
back in Perth we run a conference called
day to day Perth you might know of day
to days in other states as well and a
common or I guess a problem that we have
back in Perth is coming up with an
application where people can pretty
easily submit
there talks that they want to do for the
conference we've got an applet that does
that but we've sort of been thinking
okay as an example for this why don't we
just try and come up with a really
simple submissions API that'll let
people submit talks there they're
interested in doing and and then we
could build a cool react front-end on
top of it yeah later
yeah so that's the example we gonna be
working with looks something like this
so this is kind of just illustrating the
fact that Matt just talked around vendor
lock-in so we've got one code base and
we've deployed it to container instances
app services elastic Beanstalk and we've
also deployed it to service fabric in
two different ways and we'll probably if
we have time we'll dig into a little bit
why there's two different ways but the
same code base works on all of them
we've had it running yeah yeah cool so
if we start with with app services from
Asia so it as Rob said I think before
it's been around for a number of years
now really mature service for deploying
web applications has a huge amount of
functionality out of the box and you can
actually do not just web applications
but also background jobs and even
content in its containers now so that's
actually a misnomer now is a service but
is the way I always describe it because
it's a good analogy so this is the the
rough architecture of app service none
of this is exposed to you though this is
all completely transparent behind the
scenes that's all completely managed by
Microsoft but basically what happens is
you'll get a number of virtual machines
that get provisioned and your
application will get deployed or
applications will get deployed to all of
them around that they've got some stuff
around metering they've got an ability
to deploy code into all of those
services service re and the deployments
are actually quite varied so you can
either use git repositories are the
hosted inside of app service or outside
and things like github and bitbucket and
VSDs or you can use Dropbox or onedrive
so you can drop a file in and then it
automatically gets published you can use
FTP and you can also use web deploy
which is what we normally use when we're
doing
deployment pipelines and deployment
automation and then in front of that
they've got various sort of load
balancing things to make sure that when
you come in from the internet that you
get put on one of the right servers that
has your application on it terms of the
structure of I suppose the the apps
themselves there's a concept called an
app service plan that basically is a
wrapper around a number of servers that
get provisioned so all the VMS they get
provision as I said before completely
managed and patched and all that kind of
stuff you just have a slider you say I
want three of them or whatever and then
you can deploy a number of web apps to
the app service plan and then each web
app can actually have a number of
something called a web job basically a
console app and one of a number of
different programming languages so
there's that I guess you know you could
call it a service worker type model if
that makes sense
so shall we show what that looks like
yeah cool so I guess to give context
let's dive into Visual Studio now we've
got our solution here we've got
conference API it's a dotnet core
application that's one of the things
that actually caused us probably the
most amount of pain in the last few days
and this has the the application so if I
just control f5 that in this case we've
got it running on kestrel it also runs
on is Express locally - if we switch it
out and you can see here the default
endpoint is API a slash sessions slash
submitted so we've got the submitted
sessions you can see I've done a couple
here before the talk and if we just pop
over to postman then if we just post to
API slash sessions this payload here we
send that we get back an ID and if we
refresh here the third item shows up so
that's basically ya know that's the time
that's it we're done so look super
simple right but you know you can put
whatever you want in here it's just a
dotnet core web app you can put as many
things in there is what hard-coded oh I
said sure this good question actually
eases cycle server so
by default in the app it's actually a
very relevant question because obviously
one of the things we've had to figure
out is when we deploy to each Passover's
how do we change this configuration
setting here so that it works in that
path service it was one of the more
interesting things that we had to figure
out but so when we're running locally
when we control there five is just local
dooby conference API database using a
trusted connection so it's just single
server and then entity framework all so
nothing too fancy if you're interested
the controller is super basic it just
creates a new session object adds it in
the context Save Changes and then pulls
all of them out you know there's no di
or anything this is pretty dirty code
don't write stuff like that and
connection obviously sorry right cool
every single one that's in Azure we used
as all secure database and the one in
AWS were used RDS so we didn't bother
looking at like we're more looking at
the computer stuff I suppose rather than
their data services cool turn around
till do yes so so this is what our
little scorecard looks like so you see a
few of these for the different services
that we're looking at so Deb ramped up
we we kind of explained from for an app
service it's really really simple to get
started just because you don't really
need to do anything to be ordinary apart
from just building a normal website
exactly as you as you would normally you
don't have to add anything to that
website to make an app service work it
all just works out of box we we have a
rating for our infrastructure as code so
our attempt to automate this and and
deploy it deploy the services as well as
the application app service you'll see
we rated that only a six out of ten so
the the reasoning behind those in order
to deploy it you basically need to
understand Azure resource manager and
you know like any kind of reasonably
complex automation software or platform
whatever you want to call it you know it
takes a while to kind of get across the
nuances of it once you're across
it's pretty straightforward and azure
app service is one of the more easy
things and Azure to deploy using it and
this is the file here that we use so
this is an AR M JSON file and this one's
to 300 lines of code
I'm not going to describe it because we
didn't really have time for that but the
basic idea is there's stuff like a
server farm which is the app service
plan so that's the group of VMs that get
deployed in this case there's only one
instance that gets to play by default we
can put multiple if we one there's a
napkin Seitz component up in cites is a
fair paid service in azure that allows
you to basically pull out diagnostic
information and we'll show that in a sec
we've actually got a service bus that
we're not using because we're thinking
of doing like a slack integration but
didn't really have time down
yep we've got zero sequel database which
is what we were just talking about we've
got storage account which we also not
really using and then we've got the
website itself along with a bunch of
configuration options around the you
know instrumentation key that SP net
environment and then all of the
connection strings and here's the
database connection string that and and
just doing this by the way overrides
that app settings one because it's names
database I know automatically just
overrides that so that's how that works
so that's basically the IAC yeah yeah so
from a from manual deployments
perspective again pretty simple it's
it's just like a right click publish in
in visual studio or if you aren't even
using visual studio you've got other
options like FTP don't normally write
I've actually lost but what I've done
before if I wanted to do something quick
guys I actually just pull up Windows
Explorer put the FTP endpoint type the
password in and just copy stuff across
yeah you can also do that with job box
as well the other really cool thing the
reason why we go about 10 out of 10 is
that you actually also have as part of
azure app service something called the
app service editor and this is and this
will look very familiar to most of you
because it's BS code they basically
deploy BS code into the internet and we
can we can just add like files I can
just be like new file like you know
older Jason or something like that and I
you know I can just start kind of like
coding stuff in there so what I have
done before is just going like in the
portal I go like a new website app
service editor and I start just popping
random stuff in there for playing around
for testing things out yeah and and then
then we Yolo and our interaction yeah
yeah yeah good so automated deployments
again think we said before just ms
deploy powershell we're straight for a
bunch of options pretty easy to do it's
also really really fast you don't have
to wait half an hour or whatever for
your instances to come up it's usually
as soon as soon as the files are there
then it's deployed yeah so pretty cool
you just wait for the app spinner
diagnostics might be another one will
show it's it's another one we gave 1000
10 because it's it's gotten to a point
that it's really really amazing what you
can do so part of the AR empower shell
implemented something called an azure
service site extension which adds in the
insights extension and that
automatically starts collecting
diagnostics and then we also add the app
insights SDK into our app itself and
that collects a few more Diagnostics and
then it's all just built in so this is
the the web app here in Azure and under
application insights here we can see
it's linked and we click on you know
view more and then we've got the
application insights instance here and
we can see all kinds of stuff in there I
mean it's got you know like failed
requests for instance we've got all of
the server response times just all the
server requests we can start to you know
drill down into this operation failed
284 times the reason being cuz it's a
404 and the the probe that's hitting it
is just getting a 404 as structured
logging as a part of it as well which
actually attaches to requests so you can
go and search on search on variables
that you've logged and and look up
specific reasons where things have
happened so there's a huge depth to it
yeah it's really easy to get it running
and you get lots of visibility so it's
really cool cool so in terms of cost
it's it's reasonably good you pay a
little bit more than you pay for like a
regular VM because of the extra stuff
that you get on top but it's still
pretty reasonable
density is pretty good as well in the
you can deploy a whole lot of apps to
the same instances or the same VMs that
are behind the scenes yes I think
there's depending on the tier you have
you have you can either deploy I think a
hundred apps to a plan in standard here
and I think as I'm gonna mention in
premium from memory yeah I'm like yeah
cool
so in terms of scaling Zizi yeah that's
a cool one show yeah so scaling yeah you
can actually scale vertically by
changing the VM size on the fly which
works and it's instantly you don't need
or like wait for the VMS to spin up
they've already got vans waiting for you
and they just transition you across and
then horizontal scale in this case I've
got a basic instance I can only get up
get up to three but if I have standard
it's ten premiums 100 so you can scale
up a reasonable amount you can't go more
than a hundred though unless you do
multiple app service plans and then put
like a DNS load balancer in front of it
so they're not really out of the box
that we own didn't count so that's why
we put seven out of ten for that called
so frustration factor not very
frustrating pretty easy to use the as
you kind of seen a lot of things they're
just part of the standard way you would
build websites anyway so I'm pretty
solid they're also fairly easy didn't
productionize another one to show but a
lot of things out of the box in terms of
the fact that you've got HTTP just on
the default subdomain that they give you
you've got a load balancer already so
that there that that's so it's got HTTP
is valid hey ship s it's green it's on
their subdomain as a website store now
you can add during custom some domain
and add in SSL on top of that as well
but it's just you know that's a
production-ready endpoint out-of-the-box
and if I spin out more instances than
that will get load balanced across all
of them so a pretty good a bunch of
languages supported you can
out-of-the-box you can run or all sorts
of stuff like your like your no js' PHP
if you're into that anything that
anything that's in there supported list
of apps but it's a pretty wide variety
of options so so this is the the
pre-existing Windows one there's a new
preview for Linux containers as well and
there's stuff like Ruby in that but in
the window is one you can use dinair
framework to different
versions of it use different versions of
PHP you can use different versions of
Java you can just different versions of
Python it's also got no js' installed
and you control the version of nodejs
that can install as well so there's a
lot of stuff in there by default you can
actually use by SAP EDL's as well but
but the fact it's got Linux containers
as well just obviously even further
opens up what you can get which is why
we go over to ten yeah pretty far to the
right and that has continuum there's
there's some there's some things that of
that obviously you're still restricted
on and but school is pretty well there
yeah and in terms of restrictions the
reason why we go over to 610 is the
there's a unique sandboxing model that
they've implemented this actually
doesn't apply to the containers but it
applies to the stuff that's in the
windows one and there's certain things
you can't use like GDI and common stuff
like that so it does actually restrict I
guess the way that you build your app
but to be honest 99% of the time you
would never come across most of those
things still remain once JDI so things
like PDF render is often don't work oh
it's all service fabric is that favorite
one that's that's because I've you know
been banging my head against a wall for
the last three weeks on this one
look there's also as bugs app service Oh
service fact I will get to that it's
okay yeah oh yeah don't get started
night so as or service fabric is look
I'll be honest it's an amazing platform
Microsoft have done just an incredible
job on it and you know the fact that
they use it to implement as all sequel
database Cortana Cosmo DB Skype for
business
the halo for backend and stuff like that
tells you that this thing is robust
right it's that's huge scale we're
talking thousands and thousands and
thousands of service spread all over the
world it's a very impressive technology
but with that it's also really really
damn complex and trying to get your head
around how to work with it it's painful
challenge it's painful but we'll get
into that when we get to the scores it
does a lot of things it's
quite a quite a comprehensive platform
you know you've got stuff in here like
rolling upgrades and were the other
interesting ones
yeah self-healing replication failover
automated roll bags yeah all kinds of
crazy things there's a few different
programming models on top of it in terms
of the architecture there's kind of two
ways to look at it there's design time
and run time in design time what you do
is you define applications and
applications are defined by an
application type and then they will get
deployed into a cluster the application
type has a manifest in an application
package manifest describes which
services are used in that application
and a few other configuration options
and the package is the thing that gets
pushed into the cluster that will then
get deployed and a service or services
underneath that application are or sorry
described by service types and a service
type again has a manifest in a package
manifest describes some stuff around
that service including what endpoints it
wants to expose to the outside world and
stuff like that and also what code to
run and then a service will have code
configured data packages and they're up
all all of them are optional so you
don't actually the code one might be
required I'm not sure about that
I'm sure me it doesn't make sense to not
have codes let's say the code ones are
quiet even if it's not and then you know
if you want you can kind of have config
data separately and that can actually be
separately versioned so you can actually
roll out a config change but keep the
code the same and kind of store config
and it like separate repositories and
stuff like that
and that's where you know Microsoft in
particular would be using that so that
you know when they're rolling out a
config change it doesn't take out the
entire cloud and the config change gets
rolled you know across the whole all the
clusters or the yeah sorry I get a rot
there along the whole cluster gradually
doing health checks the whole way and
then rolling back and self-healing if it
fails right so these are the sorts of
you know learnings that you get from I
suppose a vendor that's running a cloud
right now in terms of services is
actually five different types
you've got stateless services which are
kind of like just normal like web
applications
there's state full services where you
can actually hold a bunch of data in
memory and service fabric will make sure
that that that memory is I guess kept
highly
available and is kept live across a
number of nodes for you and the data is
in the right place so that all the
different nodes can access what they
need to and it's replicated properly and
so on yes pretty cool it's also got a
container orchestration engine so it's
kind of like kubernetes in a way and all
the other ones there's an actor model in
there and then there's something called
guest executable which allows you to
basically write any application that you
want in any language and just put it
there and tell service fabric to run it
and it will make sure that it's running
and if it exits out they don't restart
and all that kind of stuff
and this is why I actually implemented
the conference API as a stateless
service and it gets a guest executable
because in the stateless service I was
able to opt in to some of the I guess
programming model inside of service
fabric but it meant I had to write a
whole heap of extra code and actually
another project in Visual Studio that
wrapped the other one whereas the guess
executable I just took the you know
kestrel exe that is built and popped it
in there and told it to run it and both
of them work so yeah sure yeah the data
backup story for stovall services isn't
great and in fact yeah sure yeah yeah
just so obviously just because in this
scenario we're just dealing with the web
app kind of doesn't make sense but but
yeah it's it's it's certainly got some
interesting things to it yeah I think a
lot of people just avoid stateless so
stateful services at this point for some
of the reasons you describe in terms of
at runtime what it looks like the
cluster itself manages a series of well
the cluster has a series of nodes that
subscribe into the cluster and a nodes
like a VM and then the node itself will
have a number of service instances
deployed into it so for instance the
service favorite cluster might say all
this little red one I'm going to play it
all over the place and pop it and you
know and then if this one here goes down
and it will move it over here and stuff
like that that's kind of how it works
and you know from a density perspective
on the Left they you've got the kind of
traditional say cloud services or
whatever model where you only have one
application
you know in service fabric you've got
multiple applications per VM because
you're a level of abstraction isn't the
VM it's the cluster itself and in terms
of at runtime
you've got your application type will be
deployed as an application and each
service type underneath that will be
deployed as a service and each service
if it's stateful will have a number of
partitions so that you can horizontally
scale that data and then there'll be
three replicas within each partition to
make sure that you know it's highly
available or if you're using stateless
services like we are then you always
have one petition and you can have one
or more instances per you know
deployment basically but hopefully you
can see from that that the real value
comes in when you've got huge numbers of
services in in lots of different places
you're talking like a complex my micro
services type deployments where there's
a lot of them yeah because a lot of this
value just really comes in from like
helping you deal with that level of
scale yep yeah that bit doesn't matter
it was more just saying you know the
density is that you've got multiple
applications yeah absolutely absurd of
similar there's there's a density in
absolutely so terms of the scores look
it does get fairly badly panned but like
I guess it's not really built for this
type of app right and this comes down to
what we're talking about before the
criteria line up for Microsoft doing
something like AZ or sequel databases is
probably going to be a lot more a lot
different in there and things like dev
ramped up don't matter when you've got a
huge team that are going to be working
on this product for years sure you've
got like a few weeks or a couple of
months of ramped up pain to get through
but then once that's that's done you've
got that team skilled up and they can
really start using that platform so yeah
it was super painful it's super complex
and for 99% of the applications that I
see in the wild this is not the
appropriate platform to deploy right so
infrastructure is code okay this is
interesting to look at so I'm not going
to scroll through this like I did for
app service but
the AR M Jason and I do have this
working I can go from nothing to a full
service fabric cluster that works but
it's 900 lines of Jason and about 200
lines of PowerShell it's damn complex to
set one of these things up it was very
painful but it's very cool right
so manual deployments there isn't really
like you can right click publish in
Visual Studio but that's about it
yeah so you know 5 out of 10 that's fine
automated deployments it's there's a few
different steps it's not as simple as
doing like an MS deploy you have to
package up the application you have to
push that application and version into
the registry inside of the cluster then
you need to deploy or so I create an
instance of that application with that
version and then tell it to upgrade that
application so it's I mean it's a few
lines of PowerShell it's not too bad but
it's a little bit more involved in terms
of the speed it's pretty good the only
thing that would slow you down is if
you've got quite a number of nodes and
it's doing a slow rollout then you know
it can take a little bit of time local
development is actually pretty sweet
because now this is not going to work
this is the one thing that's really
annoying it's it's so you get this
service manager cluster manager locally
but every time you try to right-click it
nine times out of ten it won't actually
like open so yeah it's it's a bit of a
pain but it looks super pretty when you
actually you know like run it up and you
can out you can have either a one node
or a 5 node which is by the way the
minimum cluster size locally on your
computer and this is running the exact
same thing that's running in the cloud
and the bid I didn't actually point out
before is you don't have to run service
for a break in Azure you can actually
run it on Prem you can run it in other
clouds as well it's one of the kind of
benefits of it I think in terms of
diagnostics there's some kind of there's
some stuff in there and you get some
like logs out there it's using atw which
is super painful to be honest to use you
can kind of use app insights but it's
not anywhere near as easy as hooking it
up as it is for web
and some of the it doesn't really have
the kind of agent thing like like Web
Apps does so some of the data kind of
wasn't appearing in app insights that
you would normally get if using app
service in terms of cost right five out
of ten because the minimum so cluster
sizes five notes so you know it's you
can't just put some it up at one node
and then you know kind of scale it out
and down as you want it's kind of a
pretty serious bit of infrastructure
yeah so we obviously don't need five
instances for our little Web API yeah so
density ten out of ten you can you can
pack as many applications in there as
you want in terms of ease of scale you
have to deal with VM scale sets it's a
little bit annoying scaling the actual
once you've got the VMS provision those
scaling the services themselves is
reasonably easy amount of scale ten out
of ten there's a really cool video from
the last build conference from the
service fabric team and they had one
thousand node Linux cluster running I
think it well I could be wrong but I
think it was like 40 million docker
containers it was it was insane like my
mind was blowing while I was watching
this thing I was like that's there can't
be real that's nuts and they're like
let's add another 10 million f5 on this
PowerShell script is just like climbing
up and it's like well okay that's that's
what we're dealing with here right it's
it's amazing pretty good demo yeah
frustration factor is pretty high like
the tooling is pretty janky there's all
kinds I've got a Trello card of about 50
items of all the annoying things that I
found while I was doing this it was it
was really frustrating to use and even
after I really understood it it was
still quite frustrating there's still
things that would happen that would be
really confusing but hopefully that
changes over time yeah it's like for
example some of the bugs that you
mentioned get fixed and so show
production izing is not it's okay but
like you have to deal with all the load
balancer and the SSL Certificates and
all that kind of stuff in your AR m and
it's not it's not trivial to do that but
it's it's okay in terms of language
support I mean you can pretty much
deploy whatever you want on there but in
terms of the core kind of like stateless
and stateful services you're only really
working with dotnet and Java that have
first-class support so we put that down
a little bit tonight
sort of a six-issue on their pads
continuum because you're getting closer
to the medal at this point there's not
really any restrictions it's just a VM
under the covers right so there's a
service that you can deploy that they've
created that's a I think it's a
stateless service that coordinates
through all of the nodes in the cluster
to roll like OS updates so that you've
only got one or two at a time that are
doing it and there's if you're using AZ
or service fabric then there's like a
one-liner to enable that in the AR M but
if you're not using as all service
probably that's fine they give you the
service package and you can deploy it
into your classifier so they've got that
covered but really important to note
that it's opt-in so yeah you don't have
to so and do your why wouldn't you that
would it would be silly not to use that
but anyway yeah sure cool so as your
container instances so container service
has been around for a while now and and
that's not what we're talking about here
we're actually talking about the newer
release which has only been out for I
think like a couple of weeks or
something like that so container
instances is a way of really quickly
deploying docker containers where you
have no knowledge of the underlying
virtual machine infrastructure so
whereas in container services you need
to pre provision VMs and and orchestrate
them properly with container instances
you just have no no knowledge of what's
going on behind the scenes you just in a
couple of lines can deploy a container
get it out in a few seconds and you
actually get billed by the second as
well which is pretty unique amongst a
lot of the path services we've seen so I
probably don't need to explain what
docker containers are given like how
many doctors they've been in this
conference but there's a a real
distinction I guess compared to how you
would deploy things on a VM and and a
different way that you'd go about doing
things in order to get that faster
deployment and lower overhead and and
faster restarts in management and so on
so pretty powerful tools the container
instances support Windows and Linux now
the windows containers weren't there
straight away but they work now with
couple of little limitations so so
pretty cool little service obviously
very simple and and easy to explain and
so we thought we'd include that in our
in our list of trials so I might show
really quickly what this looks like in
the portal
that would happen so I'm just gonna
ignore that error and and hope that
doesn't affect anything so you can see
that we've got a race just a simple
resource group here called conference
API within that we've got a container
group and a container registry container
registries aren't unique to the
container instance service they actually
can be shared across app services as
well as container services too so these
are basically locations for you to
upload and store your own private yeah
so you can actually deploy container
instance that's straight from things
that are on docker hub but you can also
put your own private images up here and
that's all platform-as-a-service and
managed for you and you've got your
actual container group so a container
group can contain multiple containers
that makes sense the containers
themselves basically share a port space
with each other so they can address each
other's networks privately without
exposing that outside the container so
you can build up services just by
combining a few different containers
together which is pretty cool the
windows containers at the moment you can
actually the windows container groups
can only support one instance each at
the moment so that kind of makes them a
little bit difficult and creates a
pretty big limitation but the Linux
containers at the moment you can put a
number of different containers within a
group that's as I guess they're like the
general idea of it so we've gone through
and and rated these as well and def
ramped up pretty strong pretty easy
because it's all using exactly the same
tooling that's been out there for a long
time just with existing docker
applications the ramp up the ramp up is
pretty easy in that there's tons of
tutorials and QuickStart guides and not
a lot actually goes wrong in terms of
setting up your local development
environment the infrastructure as code
ramped up also pretty easy just because
it's actually a really simple service so
I'll show you the ERM that we did for
this one as well
so thank you and vs coach if I pull up
container instances so all I've got here
is a really simple AR M template to
deploy the actual container registry
that I showed you is only 67 lines
pretty easy to set one of those up and
I've also got one to deploy the
containers in a group themselves so you
can see you just basically give it a
group name a list of containers you
specify what each one should have in
terms of resources so I guess unlike a
traditional service where you'd say I
want an instance of X fixed size you've
actually got a reasonable amount of
flexibility here in terms of specifying
just exactly what you need per container
with with a few limitations that I'll
talk about a little bit later and then
lastly you can also expose the ports
from that shared port space that you
want to be out in the wild so pretty
simple and easy to automate and get
going so that's pretty nice cool so in
terms of manual deployments we've rated
that fairly low because there's actually
not a not much out there in terms of
manually deploying these you have to
write some kind of PowerShell or
interact with it mostly from a
command-line perspective you can
manually go into the portal and click on
a registry image you've deployed right
click that and say deploy to an instance
and it will go and do that for you
but you've got no way at the moment to
to manually upload an image to that
registry so something that I think will
definitely improve obviously it's still
a fairly new service until weeks old
yeah can't fault it too much for that
automated deployments pretty good the RM
support us I showed you is really easy
PowerShell via the azure CLI - is pretty
good as well again easy to continue
doing your local development once you've
set up your docker containers and got
things running it's it's pretty
difficult to break what's happening once
you've got those initial containers set
up the Diagnostics was not was not great
in our experience so far it's it's not
too bad you can pull the logs for a
canned
once the container is running if a
container doesn't start properly you
can't actually get to those logs which
is not particularly helpful you can get
to the logs for the container group
provider itself so the the object that's
that's deploying your containers you can
kind of see what it's doing see where
it's downloading its images from and
trying to deploy them and so on so
that's a really good Avenue to look at
if whatever reason you can't get
containers up and running cost and cost
and density both not great at the moment
it's this is more we think targeted as a
type of service that you would use for
development tests really quickly
spinning up a ketosis it works once off
cases batch processing things like that
that are relatively simple especially
that per second billing yeah so you've
you've got a lot of I guess flexibility
in that sense but the the actual cost
itself at the moment is each group of
containers you deploy will take up a
fixed amount of resources on an instance
and there's less certain minimum costs
associated with that so you don't get
the same density that for example you
got with service fabric which we just
showed you
Reuven up service or even app services
in terms of ease of scale you've got a
and amount of scale you've got a fair
amount of limitations so it's easy to
scale in the sense that you can just
deploy extra containers at the same type
but then it's nowhere that's nowhere
near as easy as just like dragging a
slider bar to increase your number of
deployed containers for example so you
can still have that level of control if
you need to your amount of scale is
fairly limited you can only use I think
at the moment for CPU cores and like 14
gigs of ram so like seems like they're
kind of deploying them on like a maybe
like a d3 instance or something like
that but that limits you can't use that
multiple machines at the moment if
you're trying to do something like that
probably better to look at container
services frustration in fact it wasn't
too frustrating use it's it's it's
pretty cool
you can just go into the portal run like
a line of PowerShell in the in the
portal console and just like deploy a
container somewhere with like one line
it's pretty amazing but in terms of easy
production izing again this kind of
doesn't quite seem like it's targeted
like that in that you have to do a lot
of things yourself if you want HTTP
standard docker right so you kind of
have to put like another type of
container in front to reverse proxy
through to do HTTP which is what we did
in this instance but every language you
can imagine is supported it's any Linux
or Windows container right so heaps of
flexibility pretty far right on the path
continuum the only the only thing I
think that it wasn't perfect on is that
you can still open up like whatever
ports that you need to and and so you've
still got some control in that sense and
the restrictions at the moment pretty
much just what I talked about around
multiple containers in a Windows
container group and and that's basically
all there is for the time being given
all that context around it not really
being targeted as a production service
cool
- my favorite path service we had to
have an AWS one in here so yeah look I
mean unless you're being sought is you
know it's sort of a path beyond right
it's a very thin abstraction over VMs
there are some cool stuff in there
around you know auto scaling and
application health monitoring and and
stuff like that and I think one of the
nice things that elastic Beanstalk has
over as our cloud service is the
equivalent in Azure is that it actually
has the concept of an application and an
aversion to package and it can roll back
and stuff like that which is something
cloud services never have store all that
history yeah yeah so in terms of ramp up
like it's it's not too bad like it it
was actually me so look in terms of dev
ramped up it abstract most of the kind
of complexity of like ec2 and the load
balancer and all of that stuff from you
so you know for instance if you go to
configuration you can start to dig in
and change some of this stuff but you
certainly don't need to worry about you
know writing cloud formation or anything
like that it kind of does it for you and
it can provision like RDS for you as
well and then puts the connection string
in environment variables and stuff so
there's
nice stuff in there in terms of em
structure is carried round pub kind of
put five out of ten the documentation is
not great once you kind of get how to do
it
it you know it's okay but yeah very
similar to what we found for app
services in that case it's it's kind of
complex to get your head around the
templating and how all that works once
you get it working it's one of the
simpler ones so chose a manual
deployments like that's super easy
because you just go there and you say
upload into play you choose like a zip
file on your file system and it will
deploy it for you so that's quite easy
to do it's not you know it doesn't have
like the IDE in the cloud like app
service did but you know it's still
pretty easy automated deployments aren't
too hard there's scripts that we had for
that one is reasonably simple so what we
did is we just created like a directory
to stage this stuff we called dotnet
publish into that directory we then
copied in this AWS Windows deployment
manifesto JSON file which if you're
doing dotnet core you have to use and
allows you to define a number of
deployments and this is actually how
elastic Beanstalk supports multiple
applications in the same VM because it
didn't use to but it does now because
that's an array you can also as well as
asp net core web which basically just
copies the file system sorry the folder
the folder in there it also has a ms
deploy one as well and that's for you
kind of more you know your ms deploy
packages like you would have with a sort
of a more typical old-school asp.net
application and you can also do some
configuration of the apples as well
which is interesting but yeah other than
that once we have that kind of published
as a zip file then we basically just
need to pop the zip file in s3 tell it
that there's a new application version
for that application name and oh hello
and their version label and then tell
elastic Beanstalk to just update that
environment and then it goes and kind of
does it for you so I mean it's pretty
straightforward the first time you
deploy it
takes as long as it takes for the van to
spin up which is kind of dependent on
the size you choose and I was choosing a
t2 micro first and took like half an
hour to play it was really frustrated
but I've got to a teacher' medium now
and that's not too bad that I think
that's about ten minutes but then and
that sucks still obviously but the nice
thing is that after you deploy once as
long as you're doing an operation that
doesn't require to refresh the server
which would be something like changing
load balances or something like that
then the deployment just keeps the same
VM and copies the the files onto there
and it takes between minutes I think so
still not like hugely fast boats like
it's okay from a cost perspective you
you can choose any AWS VM size you want
so it's you know 10 out of 10
density is pretty reasonable you can
deploy as many apps as you actually know
you shouldn't be 10 out of 10 should it
there should be there is a limit so
there's a little 75 red anything yeah I
don't know why that's 10 anyway there
should be probably like an eight or
something ease of scale it's okay you
can go into the configuration thing and
change the number of VMs and you can set
up auto scaling rules as well which is
quite nice a man of scale your limited
based on I think that yeah and it's a
bit confused about this it's it seemed
like you could only scale up to 20 ec2
instances but I'm sure that you can do
more than that but this could be a
documentation issue frustration factor
it's really frustrating to use because
whenever anything goes wrong the the
Diagnostics are pretty terrible yes good
point so the other problem was x-ray
which is the equivalent service of
inside insights doesn't work with donek
core yet so I couldn't use x-ray so you
have to request logs which takes it a
while then you go into this and then
you've got this god-awful text document
which has all the different log files
that is pulled from you just have to
kind of scroll and figure out which
document you want and you know there's
this stuff like CFN hop you know there's
like a there's an init one somewhere as
well there's there's all these different
random logs and you kind of have to
figure out which one's the
one and like what the problem is and
there you know it's just really
difficult and frustrating to figure out
once you kind of get what's going on
it's not too bad and certainly you know
there's this ability to define something
called EB extensions which allows you to
do things when the VM starts up its kind
of the extension what all I suppose and
so like for instance I was you know
doing I cackles to change the log
directory because by default that our
pool couldn't write to it but if you get
these slightly wrong and this is a yeah
more file as well then it doesn't it
just doesn't run it and it doesn't
really tell you why so you know this
there's definitely some frustration in
there yeah I was a good experience the
language support you know they've
they've got built-in alibi support for
like pretty much every language sort of
a5 in the past continuum you're getting
even closer to the amps there isn't
really any restrictions on them cool so
so I guess to kind of wrap that up
obviously once again all the scores that
we came up with they're just relevant to
what we deployed hopefully some of that
gave you some ideas on different
mechanisms that you can use to compare
different path services obviously the
the winners not that important in but in
the case of the web application we're
deploying my obviously app service came
up with the the highest scores and it is
probably out of all of them the one
that's most designed for what we were
doing so yeah it's kind of what we
picked up through through that exercise
yep cool and that is it and I think
we're like 30 seconds ahead thank you
very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>