<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Continuous Delivery and DevOps and Robots; Oh my!   Fabien Ruffin and Jason Brown | Coder Coacher - Coaching Coders</title><meta content="Continuous Delivery and DevOps and Robots; Oh my!   Fabien Ruffin and Jason Brown - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Continuous Delivery and DevOps and Robots; Oh my!   Fabien Ruffin and Jason Brown</b></h2><h5 class="post__date">2016-10-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/i-8tTI-TRQk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">cool good afternoon everyone thanks for
joining us today and thanks sorry for
that John Mackey entrance here we just
friend to get more people to get in here
so yes today we're going to talk about
continuous delivery and DevOps and
robots oh my so we're going inside
buildings journey down the yellow brick
road of continuous delivery we basically
had the choice between the wizard of oz
or Alice in Wonderland and going down
the rabbit hole we got this one sorry
about that so I'm feeling rotten I'm
technology director for the group
platforms at the main and I'm Jason
Brown I am I lead up the ops function at
the main I've been at the main fo x two
and a half years now I joined at the
start of the project that we're about to
talk about cool so first of all
congratulations everyone your project is
finished you're ready to push it to
production now if only you hadn't just
miss this release window now you don't
have to wait two weeks there really is
going to be on the sunday and you
already had plans for that day true
story we've all heard that we've all
been there but the thing is it doesn't
have to be that hard what if i told you
that you can deploy your code any day of
the week if you feel like it any size of
release what if i told you you can
deploy many times a day even if you feel
like it and what if i told you you could
depot in the first day of development of
a project well if i told you that you
probably think I'm crazy and more you'd
be right but with a bit of time and a
little bit of effort we actually got
pretty close so we're going to start by
I think a look at where we're at before
we start this process about two and a
half years ago so to give a little bit
of context this is the domain group
we've got about 15 different brains but
that's the major ones that say so first
of all without domain leconbury you wish
i'm assuming everyone knows here if not
domain is one of the leading
property platform platform important in
Australia now we get a decent amount of
traffic we also have commercial real
estate a Kundalini which is very very
similar with for commercial properties
so let's say if you're looking for
office space or something like that well
that's where you would go then about a
year and a half ago sorry everybody and
a half ago we acquired our homes here so
they're very similar to doing but that
are focusing on on a camera market then
my desktop minus stop their CRM for four
real estate agents so for them to manage
their adventure ii they're close to all
the different all the different
platforms and managing their leaves and
all these kind of things now we also
have awesome property monitors in price
find out what those guys are doing is
that the gathering a lot of data around
property sales in Australia so I think
they've got data going back to early
1980s oh yeah yeah so one of the core
product is to provide valuation for
every single property in Australia they
also provide services such as server
profile or market analysis or these kind
of things so anyway we've got a lot to
look after but today we're going to
focus on domain and commercial real
estate because that's where the story
started everything else after that is
following that the same principles so
we're wherever we have when we started
well we had about ten web applications
to look after about 50 on offline
services so what if line services mean
for us that's console applications
running on schedule so let's say to
email you are the new properties every
morning and all this kind of things or
windows services we had to secure rather
large sequel server clusters one
elasticsearch cluster to power the
search for domain in commercial real
estate and the deployment of all this
was all manual so as you can imagine it
takes some time so because of that we
were not able to add to deport very
often and our release is well yeah
fortnightly when we're lucky but more on
a monthly column is really at this point
and more often than not it would take us
a day or more to actually finish a full
release always very painful and yeah
that's time that there's like
he spent during that the deployment so
we decided that life is definitely too
short to deploy software or build new
service manually and things had to
change so we set up with a one this new
project with a set of goals first we
wanted fast deployments we also need to
be reliable otherwise what's the point
right we wanted everything to be keeping
my new interventions to a minimum and
the reason for that is so that our teams
can focus on spending the time building
great new features and delivering that
to our customers instead of spending a
day filling with configuration and
making sure that the application is
still running so yeah ambitious goals
but we've got a set of solutions for
that as well yeah noble goals so we had
to come up with some solutions to
fulfill them we decided we were going to
go on a micro service platform you're at
NBC you should probably know what Mike
reservist azhar by now but small
individually deployable units of
functionality loosely coupled to support
this we knew you're going to have quite
a lot of code being pushed out to quite
a lot of service so we have to put in a
full chain integration and delivery
platform we also knew we were going to
use up quite a lot of infrastructure
quite a lot of servers we were really
going to only do this with a cloud
platform we couldn't do in our existing
virtualized data center it was too slow
to get new service sometimes we have to
wait a full day for one new box so
climate it was going to be and to
support all this we're gonna have to go
with a full DevOps implementation now
where's my buttons not working baby all
right there we go so so you're so just
to show you where we got to at the end
and before we go to the details on how
we got there this is the buckle photo
application what it does doesn't really
matter what matters is that we used to
spend half a day to a day to deploy this
depending on how many times would stuff
up the configuration in the process you
know when people are involved people
make mistake what's important here is
that now it takes 46 seconds
consistently and so yeah we're not
afraid of raising that thing anymore
because
well we know that it's going to first
that it's going to work second is going
to be fast and then that we can move on
and this is not the only application we
deploying that way just to give you an
idea of how crazy it got this is the
number of diplomas we do to release of
new code we do to production every week
for the first half of this year as you
can see it's most week it's over 50
diplomas to production and every now and
again we get over 100 in our record is
sitting at around 150 yeah so so yeah
definitely deployment is not the
bottleneck anymore we do a lot of them
and yeah now the bottleneck is just as
fast we can write code really but yeah
you know that so yes so let's have a
look at some and how we've done that so
yeah so we started with some cultural
challenges dressing I think yeah I've
gotta talk about that I don't know okay
yeah that one thank you apologies for
the technical problems hmm alright so
the first cultural challenge we came up
against was fear obviously when you're
talking about day long deployments that
sometimes fail and you have to roll them
back and that can take half a day
there's a lot of fear of change what if
we make it worse I have to overcome that
and then we're gonna let the missions do
it so imagine that it's going to get
even worse isn't it machines you know we
should be going with like a matrix team
or something anyway we have to get
buy-in from our developers because I
developers are the ones delivering this
valley they have to kind of believe in
this new process that we're doing
otherwise they'd not really can I want
to do it and we also have to get buy-in
from the business now I'm sure if
Flavians got a disclaimer about this
picture yes so this is in no way
representative on how we think about our
business
we just had to use the characters this
is it and finally we have to get DevOps
ian has an actual culture that everybody
can have lived and breathed all right
and yeah you you really know that you
got to continuous delivery culture when
all of a sudden out of the blue you've
got people in the team rocking up at
work with this because on their laptop
ship it domain getting stuff done mrs.
is that stuff that stuff so yeah so this
is really cool actually every time
someone finished something you could
hear it ship it ship it and yeah they
would ship they were shipping it ends
and yes I definitely knew that yeah
we're onto something but for that we had
to go like Jason saying in a DevOps
world so what's a DevOps it's that magic
word again is now what's DevOps um every
every shot that claims to do DevOps
seems to have a different definition of
what DevOps is every vendor that comes
in seems to have a slightly different
definition of what DevOps is if you
listen to the big guys like Eugene Kim's
and these guys that go around get paid
thousands of dollars to appear at
conferences like us obviously how they
all say it's the application of lean or
six sigma manufacturing processes to the
process of delivering software while
your software software is a thing we
manufacture we ship it out if you don't
know what lean or six sigma are they
concentrate on things they call the
wastes or the mood as if you want to be
the pretentious japanese toyota
production system guy you can probably
see some of these wastes in your
business right now if you think about it
the talent if you're under utilized I
mean you guys are all geniuses right
clearly you're under utilized at work
yeah the ones we kind of focus on a lot
our inventory inventory is product that
is not shipped yet so code that's
feature complete there isn't in
production that is a waste that's not
making you any money it's completely
wasted motion and waiting they're common
things in software too if you've got
away on another team for say a server or
should get away on a dependency maybe
that's a waste an overproduction over
processing you know about things like
minimal minimal Viable products
minimal minimal lovable products is what
we're focusing in those days so yeah we
want to eliminate as many of these
wastes as possible and defects none of
you produce defects are good good we
think that's all a bit formal so we tend
to think of DevOps as kind of an applied
laziness now what do i what do I mean by
that Ops guys are lazy we've always been
lazy but we do it in different ways back
in the first generation we would put the
laziness at kind of the start we'd not
really think in advance and not put the
work in to make things easy for
ourselves we just log into a box
download a binary run a binary move on
to the next box this is terribly boring
and awful second generation we decided
we were going to write scripts for this
kind of thing so we write a bit of
PowerShell but we still sort of log into
the box and run the PowerShell this is
also terribly boring maybe we do
something like scum to push that out
sending on that a tool push out the
scripts yeah yawn third generation is we
provide an on-demand service to our
developers so in our case we write a
script which is just the same script
here we package it up in octopus deploy
and we tell the devs that is there and
the devs go oh ok I'll put that in and
we don't have to do anything anymore
it's great over to the Flavian for the
process I think yeah so I'm just gonna
give you an overview of our country's
delivery pipeline very quickly so first
we put our code in bitbucket let's get
everyone knows about it now then we were
using advice in bamboo at the time now
for for our builds testing packaging
basically getting everything ready for
the de Provence after that we were
shipping all our application packages to
private newgate gallery and why new get
well it's because we're using octopus
deploy for deployment and that's what
octopus ippo works best with one of the
things you get up there is really handy
having your your application packages
doesn't get packages is that you get
versioning out of the box submitted a
side of
box as well and it's a lot easier to
find out what needs to go where you want
to roll back now okay which one is the
right package well with that you know
and then eventually octopus deploy
deploys to Edo us so you might be
wondering why we are using something and
I cook to put deploy instead of using a
build server after all we're using a
Tyson bamboo it has some features four
and four deployments why not that well
it's going to sound really obvious but
both those systems have different focus
and yes for sure you can do your diploma
it's basically script everything
yourself and run it from your build
service just as much as you could run
your bills from a deployment to if you
wanted to buy just whining script but
really that's not what it's about you're
going to be fighting the tools all the
time so why not another difference is
well is that with build server
everything is going to happen on the
build agents right the build agency does
not wear your code is going to run so
eventually you're going to have to open
a lot of back doors on your on your
realtor your web servers to be able to
deploy your codes which make your
changes you is and all these kind of
things that's nasty you again you can do
it but to do it right is difficult we
look to post what we get is that
everything runs on the target directly
so we've got a small back door opens for
Christian to actually deploy the package
but after that everything happens on the
server itself much better and finally
yeah I guess the one of the points with
this as well as they've got different
failure modes really when you've got a
bill that fails you want it to fail and
fail fast so you can go fix the problem
and go again and move on when it comes
to diploma store and especially the
promise to production that's slightly
different if you've got a problem as
you'd approach the protein is web server
for example what you want to do do you
want to stop well yeah what's what state
is the server in do you know it's like
going to call this problem if we go
again so using a system like octopus we
can have guided failures or manually
conventions so that we can go and check
out and make sure that everything is
okay before actually going ahead again
now enough about octopus if you want to
hear more about this there is a talk
tomorrow morning at nine
by doing Brady Damon say hi so a nine
o'clock in room 3 he knows a thing or
two about octopus being one of the
solution architects there so yeah that
should be great that's done so now
obviously we know how we're going to do
the deployments we need to worry about
infrastructure oh that's right i need
that work i need to put our code
somewhere don't mean um right ok so our
general toolchain sequel server and
elasticsearch are two major data stores
obviously they run on windows and ubuntu
we use parish on the windows side for
our automation pison on the linux side I
don't really understand that and we push
that AWS and we orchestrate all our AWS
resources with cloud formation if you
don't know what cloud formation is its
adjacent based object description format
I guess you can basically package up all
of your I said basically you can package
up all of your AWS resources together in
this Jason document and deploy them as a
unit so you can speed things up quite
nicely there and that's that flashlight
yep so let's have a look at more details
that mom what things were like as we
started
so we got a little bit further along the
way as we started to do that we were
yeah we had a few cultural changes the
team was growing significantly initially
like three years ago so not that long
ago we had only seven developers in the
team and that was it we also decided to
try to becoming a bit more independent
so in case you don't know domain the
domain group is actually part of a
bigger group which is Fairfax Media so
we used to share everything with them we
needs to share an ops team we used to
share QA design UX mobile you name it we
were sharing it so just to be able to
move a little bit faster we decided to
bring everything back in-house so yeah
that's the additional challenge right
because we need to find the right people
we need to make sure that you've got the
right culture they understand what we're
trying to do and and that's it at the
same time we thought well it is time we
need to go and adopt a job but yeah we
were sort of kind of doing scrum before
but this time we're really going to do
it by the way this image has nothing to
do with that other know what's yeah so
so yes so you might have heard of things
like yeah we drink from but we're not
doing this or strong but we're not doing
that or things like fragile we're not
yeah we decided that this time we do it
right we follow agile scrum specifically
to the letter and actually worked at
well as Jason said as well we also
decided that okay it is time it is time
to move out of the data center embrace
the cloud it's looking good isn't it so
yeah so we knew that doing all this we
would be building a lot more
applications that we want to experiment
a lot more and that's something it's
always difficult to do on track with
your own data center obviously unless
you've got lots of money to spend on it
so we had to do some active
architectural changes let me just show
you what domain was like before before
we started this look at what we do it's
awesome it works well but every time you
change this little bit you don't know
what that
there is actually moving and you've got
impacts and everything so putting more
people on the on the team and touch
touching the code that's yeah we've got
really really challenging at some point
and we had to do something really it's
all about reducing the dependencies on
other people other teams and other
systems at the same time we needed to
find a way to fix this so firstly in
order to have the higher velocity V so
the way we fix this first is to split
out our big big 25 developer team into
smaller teams so each responsible for a
slice of domain so for example you would
have a team responsible for arm for the
search experience for all our customers
another one for the user customization
another one for let's say agent products
and finally it 14 look forward to look
after the platform and all those tools
that we're talking about today and so
yeah each team was in theory I meant to
be completely independent except that
when we all collaborate on the same code
base that doesn't work so then we moved
on to this next step which is really
acting and moving to microservices so
microservices if you're not really aware
of what that is that's basically service
oriented architecture meet domain driven
design or in other words everything we
build is an API and it has only one
reason to exist so that way it means
that each team can own a bunch of
services they can deploy it whenever
they like it doesn't matter they don't
have to coordinate with anyone because
they're the only owner of it and
everyone is much much happier the last
enable for this is 50 toggles so that
might sound a little bit irrelevant here
but it's actually very very important so
fix doggles really what they are is the
ability to turn features on and off on
the website or any of our applications
at any time without stopping or
redeploying the consider the application
so why is that important well because we
can then deployed much smaller changes
and just hide them behind a feature flag
even if the code is not one hundred
percent finished or maybe we're waiting
on another team for something right
maybe all the back end code is done but
we're waiting for the UI or with the
micro services maybe the UI is
on the website is ready but we still
have a couple of bucks to fix in
services so that way the front end team
doesn't have to wait for us they can go
and deploy their stuff move on their
code is not adventure anymore and then
when we are ready when the micro service
is there then they can just click it on
and that's it so the way we've built
this and that's that's a Fisher flagging
dashboard so sorry I have to hide what
the futures actually are but it's just
as simple as that really the list of
features this study is only enough and
that's it when we turn it on which is
tap very very simple rules so we can
decide to enable the feature for let's
say ten or twenty percent of our
customers or we can decide to turn it on
only for internal staff so yeah testing
on production in a way and that sounds
scary but it's actually very very
efficient well you need to do some other
testing first or don't just push your
code into production so yeah that's very
simple you can build one it takes
literally just a few days it's very
simple and we might eventually open open
source this this code so to summarize
much smaller teams microservices and
future toggles for us that means high
velocity and that's how we got to to
that child we saw earlier but if we're
going to go down that route and start
building a lot of micro services well we
probably had to standardize the approach
because yeah otherwise really hard to
maintain and really hard for people to
jump from one team to the other so this
is what we set up to do and we started
to do that at the very beginning for a
very first service it was very important
to get it right so it doesn't look like
much yeah okay so we're calling OPI on
ping endpoints in running this returning
home big deal right well it turns out
that it is important for our load
balancers to know if the application is
running or not we don't care if it's
working or not at this point we just
want to know that it's running so that
means that foil balances if you find
that this is returning 200 or not
returning poem for some reason that box
would just disappear and get replaced so
it's all good that's one thing covered
next we've got the health endpoint which
comes in standard so what that does it
helps us find out if if a service is
healthy now when I say service I don't
mean just the API but just a
brought a sense of the term so even if
you've got like back-end services or
things I live so in this case here we're
looking at our email service so he's
using a few cues on AWS that's where our
messages go first before they get sent
but what if the background processor has
actually sending me emails it's not
working right the API still up well not
with this it's not so we monitoring the
number of messages in the queue from the
web service directly so that means that
then from external monitoring we know if
anything in a service again the big
service is working or not not just the
API and so yeah that's that's a quick
way of mentoring background processes
and I've been really really effective so
far we've done that before yeah now the
next set point we've got in a standard
is for the documentation so we're using
something called swagger most of you
probably have heard of it so it's a very
popular standard at this point to
describe web services what is for us
we're using it for that the good thing
with this is that it means your
documentation is then extracted from
your code as opposed to coming from a
wiki so it does get a much better chance
of being up to date right because well
it's your product all so what does that
look like this is rather long but you
get a definition of every every endpoint
in your web service what the request
parameters are what you're going to get
as a response and also the the response
you should accept they expect of course
there is a people version of this so if
you want to know how to use an API or
something you can just go instead it to
this end points of swagger you I index
and that gives us the full documentation
of a service now obviously it's not just
the list of services we've got the
details here for example of the response
class but we've got the parameters say
it takes for for the request of a day
that's really cool all that in standard
and then for for most of our services
but not all at this point most of the
the most recent ones we're using a
framework called metrics net that's the
project of everyone github and you get
so what that does is just something you
plug into your application and it's
going to constantly monitor the core
made to your aterial service so it's
really cool with this is that you can
see our phone service is called or how
fast it is or like it gives you really
really detailed stats so you know yeah
most of the time is responding that
quickly but for a few causes that's well
so yeah that's always good to know and
we can also ship that tour to a
different system later on obviously so
yet again thrive along but we get
details for every single endpoints and
yeah that has helped us quite quite a
few times cool so we know what we're
going to be building now how are we
going to build that and making sure that
everyone follows this because there's
quite a bit in there well we started by
building a visual co template for those
projects again that's something that we
did for the as part of the very first
project so once we had our first service
really beside yet ok lock it in that's
what we're going to go with so yeah
we've seen a few iteration of this now
but basically what that's going to do
it's going to wire up everything by
default so that every time well each
team when they when they start building
a new service they're going to get all
this they're going to get ping health
docs and metrics we also hooked up our
with server automatically to this so in
theory we secure by default in theory
with security so so yeah so that's cool
we've got our code now application is
running on our death machines what do we
do after well we need to build it so we
design brand new countries integration
partner at this point in the goals were
to be able to run our test obviously but
also to generate test coverage report at
that point we want to know what's
missing when we need to plug the gaps in
order package our applications well yes
we want to deploy them run local builds
because I don't know if you've had to do
that before but have you had the case
where your bill is not running on on the
build server you have to figure out
what's going on you make a change hoping
that it's gonna fix it commit again and
then you're in the queue another 30
minutes before you can actually see if
anything works so yeah obviously that's
not good for troubleshooting so we
wanted to be able to run our bills
locally just one powershell script off
we go and also I don't want to have
everyone in the team so yeah the 25 days
we were talking
before installing all the tools that
they need to run a build and I wish
which version of this to any then maybe
for this project I need that so we
really wanted to wanted it to be
self-contained and we use new get for
that so yeah it also needed to be
reusable because obviously if you did
one macro service another 10 pop up so
yeah it's important to be able to reuse
the scripts everywhere so what do we
have in our build tool chain then so
using a protocol sakky for Bill
orchestration instead of a Miss fields
so sake is is yes is a PowerShell
partial framework really you got the
same concepts as with as with a Miss
bill so you get targets you get things
that you can chain and the advantage
though is that you've got the full power
of the dotnet framework behind it it's
actually usable not like the emmys build
scripts which are well all XML really so
to avoid the angle bracket tax really we
is we use PowerShell for this now we
still do use ms bill behind the scene to
actually build do the base build are the
applications but then all the packaging
tests testing and all that is done with
powershell we do support and unit xunit
nms test out of the box because yes
different teams have different
preferences of one framework or nada so
we just want to make sure that everyone
can use what they want we don't want to
be too prescriptive here okay we've got
our tests for the test coverage we're
using open cover which is pretty much
the only remaining test coverage
framework I think at this point for
dotnet and we generate test reports
achievement test report with report
generator which means that then once our
test one and once the bill is finished
we can go and see the details of which
test passed which meant didn't directly
from our bill too and yeah obviously we
package at the end so you get packages
posit files so there is a lot in there
the good news is if you want to follow
the same kind of principles you don't
actually have to read a lot of it as of
lunchtime today this is open source so
if you go to github.com / to main group
OSS / 2 min deals we've got a fresh new
project there is also on you get the
rogue well we'll be
the next hour or so Oh after this so so
yeah that's pretty cool and if you want
to see how we actually put this together
shameless plug here I've got a 30 cycles
on this continuous integration with
second Tim City getting started if
you're interested in knowing how we put
this together cool so we've got our code
we've got our packages now how do we
avoid that's a good question how do we
deploy I think we've already mentioned
we use octopus deploy good right yes yes
we do we defined a generic sort of
template deployment plan with an octopus
deploy this green shows ever so slightly
out of date sorry about that but you can
see what we do is in the middle we
actually do the meat of our deployment
we set up a few prerequisites first so
things like is URL rewrite if your
application needs that various other
sort of is prerequisites things like
things like this once we've done the
deploy we then set our Apple timeouts
and maybe do some stuff with the
security around our new at pool user and
then the actual deployment is not here
it's down here in the ultimate the is
multi-tenant hot-swap this is worth
going into a little bit more depth okay
so when we deploy in the deployment step
unlike just going immediately live we
deploy next to the current live
application these are two separate is
websites the new website will have a
dummy binding so it won't actually be
serving on let's say email dash API that
domain condo you it'll be on released a
shemale died anyway nobody can get
through at this point it's kind of
hidden away behind the scenes when we're
ready we've done all our prerequisites
and if necessary a little warm up we
take the binding in is and swap it from
the live application to the new
application now this is a little bit
like while you're driving along in a
manual car just crunching the gears
without using the clutch it'll work if
your time it just right
if you're revving pretty hard then you
hear crunching noise so occasionally we
modify this a little and we'll pull the
boxes out the load balancers before we
do the swap but that's only really for
the very high load applications that's
for you to make it as well and it's
footage fully entirely automate it just
takes longer it does take a little
longer once you've actually done that
crunch we let the connections drain off
the old application so all of the
in-flight connections they're dealt with
and we remove the old site and profit
the box is back to how it was before
it's just got the new version running
and we're done cool so so yeah now that
we've got all the pieces in place how
does it work for our dates right they
have to remember how everything fits
together absolutely bit complicated well
it's not so we've got for them three
branches 3d four branches that they've
got in every repository develop release
and master so typically developers would
work on the developed branch commit
commit commit happy happy and that would
deploy automatically to uat so yeah we
gotta hook come on get that we trigger
the build and the build what about the
diploma that's it once they help you
with it it would merge to release and
the release branch would trigger an
automatic deployment to staging when we
got comments that's really cool staging
at this point is yeah I guess we can say
identical to production anyways I
slightly smaller yeah so that's not a
problem we're fairly sure that if it
works there it's going to work on
production you might have a couple of
fixes to do about changes and once
you're happy merge to the master branch
and when we merge to master you guessed
it will you put in production so that's
pretty cool it's all automated it means
that from for others that's get driven
deployments really and that's the dream
isn't it um sir so yeah so how does it
work from how do we define the
infrastructure than Jason oh yeah well
we've done all this magic with our code
we need to put it somewhere so as with
the build plan we wanted to have a nice
generic standards-based sort of target
so we standardized a simple windows
cluster in AWS we defined a VPC if
you're not available yes
user VPC as virtual private cloud it's
your network boundary let's say we have
a VPC for production of epc staging VPC
for each of our environments within
their we've got to availability zones
which is if again if you're not an idea
we ask user that's like having two
separate data centers let's say if one
goes the other one is usually fine a
month or so ago I would have said it's
perfect but yeah with in there we put
public subnets this is where our load
balancers live sometimes you have
instances in there but these are the
bits that are accessible from the
internet we've got private subnets
usually our servers will be running
there that's out of the way nobody can
contact it some of our Ops guys can
contact it directly over to direct
connect but yeah let's not talk about
that we put a hae load balancer into the
public subnets this is just an EOB and
iced it load balancer all cloud services
have load balancers and then are
instances live behind that and this is
all standardized as a CloudFormation
template and will support you know
pretty much all of our simple workloads
on top of that we make sure SSL is
available by default we put a wild-card
certificate onto the load balancers so
it's star domain.com to au is available
over SSL will put is on to the instances
using PowerShell obviously we're mostly
serving web apps so we need a web server
we took a few supporting tools on there
because we need to be able to
troubleshoot them when they've gone
wrong so sis internal to live on their
things like that and you ask if it goes
well the octopus tentacle is are
supporting two very good insight there
mr. Rufford thank you ahem and this is a
fine baseline conferring for most of our
workloads and what we'll do with
variations on that if we've got an
application that needs let's say again
URL rewrite will push that through
octopus octopus is our engine of
variation if you like so what we
realized we were building was a robot
army these individual robots are
self-provisioning they are self-healing
they're expendable they are
a cheap simple and their robots not
people you've heard cattle not pets some
of the people in this room have got it
on the back of their t-shirts we don't
think of them as cow we think them as
robots they're not people we don't name
them we don't love them if one of them
goes away it just comes back this is a
robot army that will take you down yes
yeah one question what is important here
is that really we don't do snowflake
server as well do one of a kind kind of
server handcrafted it's really just
Phoenix servers now so if the service
stick chewed it and other one is going
to come back so the Phoenix is now as
well as robots that's what this this is
a mythological mess in terms of
provisioning these actual clusters this
is probably the third time I've
mentioned this but cloud formation is
what we use to orchestrate all I WS
resources together and we'll drive the
instance configuration itself out of
PowerShell will use DSC for that which
is desired state configuration if you're
not familiar with that it's the how do
you pronounce idem patent is it a den
patent or idempotent it that thing you
can run it over and over and over and
you get the same result it's a it's a
declarative make it so kind of a
framework and we push out the
application code under various a--'s as
we keep repeating with octopus deploy
now once this is all up we need to make
sure it stays up and we need to make
sure we know when it falls over because
it never falls over right we're perfect
we use Pingdom for the external
monitoring of the health endpoint that
fabian mentioned earlier on that will
hit a half thin point if something's not
healthy or 500 Pingdom goza we use new
relic to monitor our performance new
relic down there we use cloud watch the
AWS service up in the top right to
monitor the state of our area where
services they all tie together through
ops genie which calls us up in the
middle of the night sometimes not very
often because we're great and all of
these messages go into slack which is
our primary communication tool within
the team we get messages about robot
army boxes coming up robot how many
boxes going down load balancer status
changes pingdom
anything that can tell us something
interesting will pipe it into slack Oh
which is Fabian cool so yeah that's
pretty much the picture of our first few
iterations in that and how things worked
at the time so that was great good stuff
problem is that we kept growing the team
and I think we're just over 100 people
in the tech team now going from yeah
from 1700 of our just a couple of years
so yes some of those processes that we
just talked about anything actually
quite work so let's just go in and have
a look at where we are now the next step
sorry
hellooo so yeah so we thought well hang
on we've got more people we've got more
teams how are they going to know about
all this from day one when they start
right ideally we should be in a position
where when you're starting the team get
the laptop open it oh yeah I know I just
need to do this and then by the end of
the day they've got a new micro service
running in production again true story
we actually have one guy doing that just
a few just a few weeks ago so we thought
well hang on what we need is projects or
on and one script to rule them all so if
you remember that the video template we
talked about earlier so yeah we thought
let's push it a little bit further what
if as you create a new project we will
talk to an API and create the new
bitbucket repository what if what we
write it would create the three wrenches
we always use and yeah create the new
microservice solution as it already does
let's just push it a bit further maybe
create the bamboo build glam now that's
a mistake if you ever if you've ever
tried to automate bamboo well you've
probably not like it's impossible we had
to use selenium behind an API to do that
it's it's disgusting I just like
submission we actually got it working
the code is dead just put a nice if
you're on top and you're gonna be all
right you win some
alright so then at the same time what
about triggering the progression the
programming of infrastructure at the
time the first bill happens right or the
first deployment and while we are this I
mean we've done we've gone so far
already why not very straight with much
when you drink platform so Kingdom you
really cannot laugh we did it yeah it's
working huge mistake though so that's
that's one of our bad ideas that was
actually we were serious but it's the
first one way oh yeah we wanted to do
this but we've got a few less serious
projects to show you after if we if we
got time so yeah we basically push it
too far so at that point what happens
well because it's automated everyone
stops worrying about how things actually
work and as you know being here it's
really important to know no your tools
right well not everyone thinks that way
and we start having issues then what
about yeah i'm going to create a new
projects domain d om I n I steal the way
around well it doesn't matter I've got a
new micro class no running so so yeah
it's not ideal so we thought well okay
let's pull it back a few valuable
lessons here though we've learned that
yeah babe was good but for automation
tool not having api's is just not
acceptable or at least by the way
disclaimer that was about a year and a
half ago maybe things have changed so we
just decided to swap it out and yeah big
bucket was just collateral damage at
this point and we replaced with github
and Tim City guitar beer that was for a
different reason we wanted to use the
pull request stuff that works yeah a
little bit better at the time in github
then bitbucket so anyway it seems City
when we started using it we realize
overlaying on actually that works really
really well for that mint project so we
stuck with it and to this day let's do
what we're using we also had to make
some changes to the brushing strategy so
a few of you might have thought were
laying on you deploying automatic you to
production that's madness yeah it is
so what happened a couple of times not
very often is that someone thinks
they're on develop but not their master
they make a quick change like I don't
know Meg domain right like our
competitors for example push that as a
joke right yeah that's the joke that
just went to production so we can't do
that anymore so what we're trying to
avoid that was not that bad so what the
devs do now they've got feature branches
just as many as they want death death
death once they happy merge to the
virtual branch to the release branch
which we still have at that point yes
it's still deploy automatically to
staging because that's something that we
do often and yeah that's not trying not
to be too repetitive but that stops here
then if they want to push it your
production you have to do it manually
when I say manually is actually not that
bad we're using an octopus picture
called life cycle policy which means
that we can force have this to have
their code deployed at least one of our
testing environments before going to
production then they may just go through
it and not even test the application but
I want to drink we tell you that
something's not working at this point so
say yeah we need for production now
things are safe and you got your sanity
again okay have likewise so yes that's
cool yeah we made also some changes to
make sure that the devs because we had
to scrap projects on to make sure that
the devs could provision their
infrastructure relatively easily and
that's what Jason's going to talk about
now oh yeah this is my favorite bit so
we wanted to empower the developers do
ops why because as I mentioned earlier
on Ops guys are really lazy this is how
we used to do the cluster definition
back in robot army version 1 it's
horrible isn't it you needed an ops guy
that kind of understood the powershell
kind of understood the cloud formation
and store all these things every
individual cluster so let's say our
email service cluster had its own
CloudFormation template and had its own
set of provisioning scripts and it had
its own cluster deploy script that we've
talked to octopus and to build a new one
you had to copy all of these change some
things mess around in the cloud
formation which was nine hundred and
something lines of Jason which is not
really human read
let's face it you horrible so what we
needed was a sort of a domain-specific
language hey we're called domain that's
good isn't it our domain specific
language that our developers could use
to define the infrastructure that they
needed now it turns out we were already
using this within robot army just on the
instances we leverage the DSC engine
with in PowerShell which gave us a nice
clean declaration like this for our
clusters so a developer could go build
one of these off a very simple template
tweak a few things go happily I will
deploy the example service which isn't
in production let's face it and they can
put that in there build then when it
came to the octopus deploy stage we
could deploy the robot army bit of the
package on to a role called the PS
engine and we could run the
configuration and AWS would stand up all
the infrastructure so this is still in
the application deployment process right
this is still in the application
deployment process down here is a normal
application deploys for this in this
case the statistics Web API she probably
should have blew it out so mean well
this is great right we're deploying but
surely we're deploying to the
infrastructure that doesn't exist yet
this is magical bootstrapping nonsense
right but it's okay because we're
deploying to the PS engine role and
those boxes exist this deployment will
complete successfully and you get a
lovely little green tick in octopus
saying whole look version or point not
one is lies and everything's happy then
ten minutes later when the boxes
actually come up in AWS a script calls
out to octopus and says hey octopus I'm
new what code do I need octopus says oh
look version naught point naught point
one is available pushes it up to the
boxes so in one touch you've got you
infrastructure with your code on it
that's quite quite nifty you can't like
that it's good that is my favorite bit
okay so also at this time we saw some
gaps in our infrastructure we thought
look at this we've got magical nonsense
going on where unicorns were sparkly we
weren't really octopus was on one single
box and we were relying on it for all
our all the scale event
surf load increased on domain and we had
to add more boxes we had to call out to
a single not very high availability
octopus deploy server to do I deploys so
these heroes over here and that here are
there came up with a high-availability
version of octopus and said hey guys do
you want to try it out yes do we ever
you'll recognize this from earlier this
is the robot army sort of network
diagram if you like we just plugged in
some octopus on the back that
automatically provisions itself it knows
what parameters it needs it knows its
license keys and all that kind of stuff
because we've got that infrastructure as
code and that means we've got a lovely
open sourced octopus server DSC resource
that you can use to build your own
octopus service in moments it's quite
good and just for good measure because
we don't know when to stop we put an
octopus in our octopus so we could
octopus while we octopus meaning any
time I want to upgrade the octopus
cluster or change the size of it or do
anything like that I just do a commit
and get the hook goes to my hook server
the hook server goes to octopus octopus
deploys the code and we've got only walk
to person are pursuing octopus while we
octopus thank you at this point is why
we realized that testing was really hard
oops guys we're lazy we don't like to go
always this server up and go and log in
to AWS to check that all the servers are
there and things like that so
infrastructure is code why not test it
like its code there's a testing
framework for power shell called pesta a
catchy name right we plug that into all
of our robot army stuff it tests the
code that runs the robot army it tests
the configurations of the robot army
that the developers right it tests
whether the servers are actually there
when they're meant to be there all these
kind of things so we're doing
infrastructure as code like developers
do code right this is good this is
fantastic it does all get very very
expensive this is the terribly boring
bit so I'm going to skim through quickly
to save costs we turn off all our idle
instance
overnight you can do this when you're in
the club you know this you know this
you're smart people the dev environment
devs don't needed after seven-thirty we
turn it off there's not needed before 73
actually those done it before about 10
really so we turn it off anyway at
seven-thirty because 12 hours is a nice
round number that's fantastic we do in
AWS with tags and other cloud servers
like like zero or Google compute or
whatever you might do a different way
but we'll tag sleepy time equals yes all
of those instances go away there's a
second advance to this in that when the
instances come up in the morning we're
testing our deployment process straight
away at scale every bit of our
environment gets tested every morning
when sleepy time works the second costs
over straight is even put in place was
to maximize our utilization a
microservices purist will say that you
have to isolate your environments in the
year right reserved should be a single
unit in it you should have hosting on
its own or brilliant yeah it's really
expensive we've got 60 something
microservices 60-something clusters is a
really really costly thing to do so we
cram some of them together we changed
our robot army definition and we've got
an array there now you can put there's
many services in there as you want they
will deploy in parallel it's kind of a
half so we save a lot of money on our
staging environments with that and what
was the third one the third one is oh
yes price optimization pick the right
size of infrastructure don't use c4 X
lodges for a tiny Microsystems 10
request a day and all of your cloud
services will allow you to reserve
capacity up front in a dress it's called
reservations what's it called another
services don't know upfront reservations
and there's a thing called the spot
market which is probably worth quickly
calling out AWS auction off their excess
capacity really really cheap prices if
you want cheap service you can get them
for sub temp send the price so look into
spot if you're on AWS over the year so
that brings us back home
this sorry about that that's from our
CTO you insisted we put it in mark if
you're watching gonna get in trouble
flow and so so yeah just if I want you
to go with just a few things yes it's
going to take time yes it's going to be
hard but it's it's all worth it like if
you remember what we had at the very
beginning of this talk this one
application and that was just an example
that took ya over a day to deploy think
of the time we've wasted or we could
have wasted over the last three is if we
had to do that all the time or just
having people are like this yes scared
of deploying it all just a little bit
lazy and and that's all right the next
change someone can deploy it for me yeah
so yeah it doesn't mean it means that
that way we're not shipping value to our
customers fast enough so yeah invest in
this it's worth it when you look at
again I graph at the very beginning a
quickly we can debug think changes to a
to production it has changed everything
so yeah have a go so let's have a look
creepier where we are right now sighs of
as of monday i think this nut shot was
capsule we're up to 34 different
websites 64 microservices 133 offline
services averaging at 64 deployments per
week fulton production for to production
to the x4 that six month yes staging is
a lot more you see 620 service including
testing and prod so yeah we've got our
supposed to manage all that guess how
many people we've got looking after this
just because a huge team right Mastiff
team is got a big 620 servers so we've
got we've got ya to windows engineers 3
linux engineers funny that yeah no
comments and 2d bas so what our next
steps Jason what I look what are we
looking at um we're looking at the lots
of magic currently our Lennox stuff uses
a different pipeline to our window stuff
and we'd like to unify those two because
keyword generic we want lovely generic
standardized plans octopus now supports
linux so we're going to try and convince
the guys to put some other stuff in
octopus
what's next yes serverless you're gonna
hear a lot about this if you're not
bored with it already I got bored with
it before it even arrived lambda and abs
or a zero functions there's a lot of
scope for massive scalability at very
low cost and all those lovely things dr.
taka-taka-taka-taka taka-taka-taka-taka
Windows Server 2016 drops we're hoping
to start using docker on that platform
for cross-platform containerization and
yes I'm going to open source for over
army version for wish me luck v3 is not
actually ready for open source it works
really well but I'm slowly unpicking all
of the bits and I was hoping to have it
ready for today it's a dory guys domain
specifically it's a domain-specific
language can't have it yet but soon
maybe within the next month or so and
open source robot army before and I will
announce that in a me in a mains amines
yeah when Fabian will explain to you now
yes so if you want to hear more about
what we've done we've got a big blog I
think that's what you're referring to
that's what was your hunting cool so we
like to I'm blog about what we're doing
and what we think is cool have a look
check it out it's not just ops ii and
back and stuff we do have move our guys
and the product guys are contributing to
this as well but obviously the ops fits
the best bet so as mentioned here we've
got a couple of open source projects as
well we mentioned again just the up
spots but we've got mobile projects as
well Android team and I always seems
that been really really I've been
pushing quite a few projects over there
another shameless plug we are hiring
across all the splints if you looking
for a job or if you want to change come
and see us we're at the booth upstairs
and that's it follow us on twitter
follow us on twitter yeah I almost
missed this this is oh that one you want
to do oh yeah I'm doing I'm doing a
thing in in Singapore that's Singh
appointment yeah I'm quite tired 21st
22nd of October I'm appearing at
PowerShell Asia which is the PowerShell
oriented
thing for local parasail developers
because there are some of us um come
along it sir if you'd if you do Ops II
stuff or if you're interested in
automating in any kind of sensible way
come along it's a whole day in Singapore
it's very fun cool so yeah we still have
a couple of minutes five minutes
actually who wants to see the stupid IDs
yes alright so those ones they will not
see well actually this first one was it
with a serious one the domain train so
we thought as we starting this new
process of deploying new things well
usually we just screw it on the roof
yeah we're deploying the new domain
desktop site watch out price now we
thought well if we automate everything
well we have to let people know right so
that's what happens for at the beginning
of what what happened at the beginning
of every deployments all aboard
deployment in progress for released one
point 0.9 of email service in staging
and here we go it's fun right
noisy at all it's perfect yeah the thing
is as we started wrapping up our
deployments that got annoying really
quickly as your phone before staging I
mean okay production let me know but
staging really do we have to go there
were probably probably not so yeah the
trainees in the box now the next project
you want to talk about it sure I'll tell
the next project I don't want to take
any responsibility for that one I'll now
take responsibility for this this is
fine every couple of months video thing
called innovation day we call innovation
though some people call hack days
something that call it whatever a day to
do stuff we decided that our developers
weren't really committed enough to the
deployment process they weren't really
really getting ahold of it so we took an
Xbox Kinect and we stuck it over here
and we took a screen and we stuck it
over here and we got our developers to
walk up to the Kinect and in a loud
clear voice say hey deploy email service
to production please and the screen
would say dance monkey dance oh and
that's the monkey
as you can see in the background our
machine is analyzing his excellent dance
movements and looking for specific
movements we looked for things like a
clap or hip thrust or a bit of an arm
wave and we look for all of these things
and when the system decided that you've
done enough it would actually deploy the
octopus deploy would deploy what you
asked for not only that if your
deployment failed we're videotaping this
whole thing in 1080p and if it fails it
goes on slack and everybody sees you
dancing this my friends is my finest
hour thank you very much so yeah so
that's all we've got for today um I
guess do we start time for couple
questions or show questions alright
anyone yep some projects are in step 2
50 process intensive process has to be
wired up stay positive no so we do have
templates for for most things so yeah
the question was now that we've scribes
Iran does that mean that we have to
create everything manually so yeah in
Tim city we've got step templates for
everything so yes so for that for the
main build is which does everything
there is required but also to if we want
to run integration tests and all that so
we've got depending on the application
we're building we can have different
slightly different processes but the
core steps are fully templated is super
easy to a super easy to use yeah one
year we've come from one click to five
different one clicks and which isn't
really a big deal we don't think now on
the deployment side then for up for
octopus there is no such thing as a
template in octopus come on guys so yeah
so what we do usually is that we clone
one of a well-known project that we
already have four boys team make the few
adjustments that we need to make and and
that's it so it doesn't really take
pretty long and then on the upside as
you seen that's just this little snippet
of PowerShell push it in your solution
in SA and you don't need any more right
I'll dunno you mention it should we just
want to let him in any way no way you
density on your servers for information
draw a single declaration for your
service to an irate yep and you thought
about pushing that to scheduler or
pushing that out to some other means to
manage it because how do you leave that
up to a developer to choose that pretty
much yeah we trust our eyes they're all
really smart people aren't they yeah
well you hired them wait so the thing is
that we try to make sure that every team
is responsible for all of their all of
their upset obviously given the number
of apps we come to say hey check it over
the fence ops problem now it's everyone
has to really focus or to really be
responsible right so so yeah and who
knows better the applications then the
people have written it right written
them so so they know what the low
profiles for each of their apps what can
or cannot leave together what is really
critical and really should be on its own
so yeah yeah and we don't generally
tenon across teams so one team let's say
our trade services team will have our
cluster for their staging and they'll
have four or five different projects
running on that cluster and they know
what they all are they don't have to
rely on another team's goodwill for that
so we'll kind of silo the infrastructure
by team in staging in production the Ops
guys are kind of managing it so we've
got an eye on the low profiles and
things like that and we moved them
around a lot will move the cheese of the
developers quite often sometimes just
for fun but yeah we we handle the
production sort of load but staging go
for it guys II now
yep with all of the robot army
definitions for production are in github
there's a we've got a folder in just
call it production ps1 let's go all of
our main production stuff all the stuff
that isn't in the octopus thing I shows
and I will for staging I'll commit that
and it will deploy on commit for
production I will commit that and I will
double check that I did it all right and
then I'll deploy it from octopus yeah
whoops oh oh yes well that's pretty much
what we've got now so in that place
diagramming on let me just bring it back
up oh that's gonna be aged it's gonna be
a lot less yeah hang on socio so what
we've got now really is we've got only
two main branch as well one main main
branch so which we call release to
confuse everyone so that one really does
that start staging in production branch
at the same time I mean if the code is
good enough why should we need to merge
against somewhere else that's something
that we've learnt as well from from from
our time with it with the three branches
that it was yeah probably a little bit
unnecessary yeah there it is over here
so so yeah that's what we're left with
now so for this yes we might have a few
done because we might have a few
different features being worked on at
the same time but there's only one of
those and this one never ends yes yeah
so actually yeah that's another thing as
well with the old way we were well every
time you want to deploy to another
environment you had to wait for it build
again so those bills were quick that's
usually about two to three minutes which
is reasonable especially for the micro
services but yeah really do we need to
do that we know that the courts good why
not just ship it to program yes the same
me get packages it goes to staging and
prod once it's tested there wasn't the
case before it is now yeah
we'll skip we're not using Tim city for
a few different reasons first we found
out that well this is our IP right this
is important we Congress push it on
public nigga gallery I guess you know
that but so then we had the option of
using things like my gate which is yeah
public host it's all good and we can
have private feeds but the thing is for
the volume that we had like the the
desktop side the domain desktop site is
actually quite heavy as soon as you get
to a few a few builds that gets really
really expensive really really quick
what we wanted to do as well as have a
feed per team for their applications and
then one feed for our internal nuget
packages as well like class libraries
really so what we ended up doing is
building our own so based of the new get
dot server i think package and then it
just stuck on the UI or nation now is it
with thought of pushing that open source
but it's actually taking a quite some
time to maintain now with new get v3
coming up in all these kind of things we
don't necessarily have the time
committing this properly so we're
looking at all the solutions at this
point anyone else
change their environment the transforms
octopus takes care of it for us and the
Ops guys don't really have to do
anything then the devs will manage their
own variables in octopus we don't yeah
yeah so the cool thing without so
initially we started by using transforms
which yeah that works okay but it's
really hard to a dev time to see okay
what am I going to end up in production
with interruption so so yeah we use dr.
personality God it's got a good
configuration management the cool thing
is where our connection strings and
things are you can encrypt them and you
can't get them back so that's that's a
good thing like even if let's say our
DBS go to new database for new service
you can go and drop the condition string
in there that there's never know what it
is so if we were someone leaving they
can't yeah they don't know how passwords
they don't know anything which is
getting so I mean we'll put API keys in
there as hidden variables and stuff like
that and then an ops guy will drop a
variable into octopus and no one else
knows what that API key is what LastPass
does but yeah it's quite good to use
octopus as that engine of variants as we
use it to the engine of variance for the
configuration that the instances yeah
anything else cool oh let's go time for
a drink</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>