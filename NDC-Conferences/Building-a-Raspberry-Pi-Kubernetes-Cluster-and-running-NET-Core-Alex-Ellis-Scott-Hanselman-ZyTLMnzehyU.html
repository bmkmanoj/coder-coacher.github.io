<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Raspberry Pi Kubernetes Cluster and running .NET Core - Alex Ellis &amp; Scott Hanselman | Coder Coacher - Coaching Coders</title><meta content="Building a Raspberry Pi Kubernetes Cluster and running .NET Core - Alex Ellis &amp; Scott Hanselman - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Building a Raspberry Pi Kubernetes Cluster and running .NET Core - Alex Ellis &amp; Scott Hanselman</b></h2><h5 class="post__date">2018-02-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZyTLMnzehyU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you feel good yeah all right say this
hello friends hey we don't believe for a
second that anyone here is a real
developer because it's 9:00 in the
morning
real developers don't get up until at
least 10:30 but we got up for you how
are you Alex I'm good it's good to see
you all here slights about this talk yep
so I'm Scott Hanselman and this is Alex
Ellis and we are wearing open fast
t-shirts and if you're nice to us we may
throw one into the audience because I
know that developers go nuts when you
throw things into the audience
we will not be throwing raspberry pies
into the audience as much as we want to
because they cut your face really badly
we're not gonna do that again okay all
right so here's our agenda for today why
would you do this all right very good
question this is a totally dumb thing to
do but we did it anyway why we've got
the Raspberry Pi cluster here and I
would was I would like to point out one
thing you don't really know what what
your mail privileges until you go
through customs with a gun case with a
Raspberry Pi cluster and no one says a
word so I I'm very much feeling my
privilege right now because I brought in
all kinds of suspicious-looking devices
and things blinking lights and I was
screaming it's a Raspberry Pi cost of
using kubernetes and open fast and
they're like we have no idea what any of
that means go just go ahead so and then
also what clown what counts as a cloud
is just a class yeah yeah so what counts
as cloud we're gonna look at some of the
top and community clusters that have
been sent in practicalities of running
software on arm raspberry PI's on board
dotnet core and why doesn't cause the
right choice for on and then we're gonna
get an introduction into service and
koopa Nettie's which is actually quite a
complex topic but we're gonna try and
tackle that for you today and give you
some resources to get you to get you
moving on with that and we've got some
really cool demos - mm-hmm there is a
lot in this talk we're doing our very
best this is our first time giving this
talk and our first time working together
so please do pair with us it is arguable
that you could have Alex talk for two
hours just on open fast two hours just
on kubernetes I could go for an hour and
a half on the arm and dotnet core but
we're gonna try to shove it all into 60
minutes that's right
crossing fingers it's lower your
expectations nut I think is really what
we're trying to say all right so why
would you do this well it's the freaking
cloud in your house it's cloud it's a
little tiny cloud I mean when you think
about the cloud you think about
computers that are in some warehouse
somewhere that you can't visit right but
this is a real cloud you can visit you
can pull cables out of it yeah
you can also you know be your own boss
you're your route you're you make the
rules it is hardcore localhost route
stuff at us and you made a really
interesting point about UNIX heritage
that I thought was really good yes sir
we were talking last night as we're
trying to get this cluster working in
its cots hotel room and I said did you
know when you add a user asks for a room
number why would it do that so I wanted
to add user here on my Ubuntu machine do
they sudo make me a sandwich and I can
go in here and say cool password full
name room number yeah so this this is
the thing why is asking for a room
number well UNIX originally was designed
to be run in educate educational
institutions right in universities where
you'd have a room number so when I'm at
home I had to use all my recipes I'm
like wall lights in my bedroom it's in
the kitchen you know it doesn't really
make sense but what it does show is that
we've come from this very rich heritage
where one of these computers would have
cost thousands of thousands of dollars
would have filled a room and you could
only use it if you're at university
somewhere now you have that in your
house in your hand and we have what six
of them for what what did this cost you
a $300 I think I put three hundreds into
a total and that counts all the custom
cables the power supply the router we'll
talk about all of that stuff but there's
not more than three hours or the
equipment there and you don't need to
make one that's six it could be fright
for yeah so the great thing is you get
to own that you can run whatever you
like on there and we've got so much
freedom now compared to sort of 30 40
years ago completely different landscape
so you've got direct access to the hard
way you can unplug cables if you want
you can add new ones on if you need more
capacity all right so we're gonna back
up and think about what does the cloud
look like and there's been a lot of
great talks at NDC about learning about
how people learn and I have found it
difficult
to explain to people what the cloud is
older people will say well that's just
what hipsters call hosting you know the
I have a cloud I go and I can visit my
local hosting where I visit my server
you know and the way I describe the
cloud is that it is elastic it is
programmatic and you can't typically
visit your clouds hard drive when you
put your machine in a host you can drive
down there they can let you into the NOC
and you can say that's the spinning rust
that holds my application but with the
cloud you put one byte into the cloud
and suddenly it's in six places right
it's in six different regions but this
is really like a little portable
personal cloud when you teach people the
cloud often we say look it's the cloud
and then we teach them obscure command
line things so if they might learn
kubernetes and I find that hard to
visualize right very hard to visualize
see the cloud it's right here right and
there's lots of different clouds right
so this picture is your you know I
imagine would be my AWS or my Asha where
I'm running my my code at work you don't
really see you don't really get to ever
see this right you just imagine it looks
a bit like that right this is the only
time you see this is at the end of
action movies this is the last scene die
hard but actually they're being clouds
for much longer than that
this is IBM mainframe and this is what I
was talking about sort of 3040 years ago
we had these huge computers that were
shared out and we would just have a dumb
terminal and we'd connect into it and we
get access to this huge computer
resource and we're going to talk a
little bit about how service is a bit
like going back to the mainframe days we
have this elastic capacity and you can
sort of tap into it but you know this is
a cloud as well Scott this is absolutely
a bunch of raspberry PI's arranged in
the circle and if you sit in the middle
just like in the matrix and you get shot
will freeze in time and you get a 3d
picture now it's very different from
that first cloud I showed you but it is
actually a cloud and we want to say that
private cloud is what we're gonna talk
about today mmm this is your own
personal cloud and there's lots of
different private clouds that you hear
the names of we talk about you know the
the Azure cloud the Google cloud I
understand that there's a book store
with a successful cloud
but there's also private clouds right
kübra is a kind of pirate site OpenStack
is a club yeah and so many many of you
use things like vmware vsphere maybe
work and the enterprise you go to it you
say once a new virtual machine you
decide the operating system you have to
do everything yourself but it provides a
layer of abstraction for you across a
bunch of service a cluster there are
higher level things like Cloud Foundry
and keeping at ease that work just at
the application level there's a lot of
options here and these are all really
how you can create your own private
cloud but none of these run on arm on
the Raspberry Pi other than keeping at
ease and that's what we're gonna focus
on today mm-hmm and when you think about
the cloud you have to ask yourself how
cloudy do you want to go do you want
something that is entirely managed by
you on-premises everything from the
network all the way up to the
applications that is the the KITT car we
all have that parent that's trying to
rebuild a car in the garage that really
has nothing to do with uber which is the
other side here software is a service
where I want to go from point A to point
B and I don't really care if I built the
car from scratch right arguably this is
the KITT car version of the private
cloud that you've done here yeah so we
are right over here on the left and site
I would say and so we're managing the
application the data the runtime and
virtualization servers storage the whole
works when you do this you're in charge
of everything now as you move across to
infrastructure as a service you've got
something more like VMware vSphere you
move further platform as a service is
what Cuba Nettie's is everything is
handled by someone else and you just
deciding applications to run and how
your data is defined software as a
service is more similar to serverless
if anybody's used lambda or open fires
you create a JavaScript file or dotnet
file throw it over a wall and forget
about it and that's all we have to do
right yeah and I like to use all kinds
of analogies around cars whether it be
build your car lease your car rent your
car
uber or whether it be getting your own
house and building your own house and
building it from scratch and having to
paint it or platform as a service or
software as a service like your hotel
like I hope
that we're staying in that I completely
thrashed because platform-as-a-service
right I'm gonna come back and they will
have reset that the room I don't know
it's magical cover Nettie's somehow will
reset the hotel that's right I feel good
say people are feeling awkward cuz they
think I really did thrash the hotel I
totally did cuz I'm a rockstar so this
is a way better way to visualize the
cloud that's one of your first clouds
isn't it yeah yeah this is one of my
first clouds we have just these copper
standoffs Cruz I always get asked about
this you can buy them an eBay and
they're a great way of building cluster
very cheaply in this stock up like that
hmm and on the left there is just me
saying get nodes with cube control and
you can see I've got Hansel boss and
Hansel workers one through five and that
is Hansel boss and workers once you find
that we'll talk about a little bit yeah
that's right so I was going to talk a
bit about my first cluster because so
many of you how many people already
built one right so pretty good for fire
in the right place because we're going
to tell you how to do this from from the
beginning to the end so I first thought
well you know I want to build a cluster
I didn't really know why I just thought
it was really cool and at the same time
I was at pie Wars and I met publisher
from Linux user magazine and he said
have you thought about writing for our
magazines lovely to write for the
magazine and I said well you know this
might my writing wouldn't you up to
scratch there's no way I could do that
and I said well what about this blog
I've written and yeah that'll be great
and so ended up getting this blog
published how to build a Raspberry Pi
cluster but things work much harder
you're in a much better position than
you are than I was and this was only
2016 I had to build a docker from source
which men spending like all night run
your batch job wait till the morning if
you miss something or you missed a patch
you've got to do it again it was a real
pain which is funny because it harkens
back to the time when you had time
sharing machines that yes I was a
refrigerator and you would wait all
night for other exactly and you could
kill the SD cards because you're writing
to them so much they've only got a very
limited life cycle and so that was
another real pain these days you can
install docker and kubernetes we've
apt-get a single command and you've got
it so you're in a much better
position and actually just to show how
quickly this is changing doc has its own
Cuba Nettie's called sworn and I was
actually using the previous version and
they sunsetted that and built a brand
new one and what are we like two years
on yeah and you've taken from building
darker from source and now you can go to
Alex's blog and basically with a gist
following instructions build your own
with off-the-shelf parts in a day yeah
so thank you for doing that work for us
thanks so I thought that this was
amazing I built one he and I did a
podcast and once we did this podcast the
word starts to get out right we're not
certainly not the first people to to do
this kind of stuff I think raspberry
PI's should be used and abused but once
we started talking about it publicly and
saying how exciting and how fun it is
and what a great learning tool people
started tweeting pictures of their
clouds their own private clouds yeah and
I would you please encourage you to
check out that podcast so these are some
of the community clouds and what's even
greater is that not only are people
building them but they're submitting
talks to conferences so hopefully you'll
give a talk about something cool that
you made on your cloud yeah yeah so we
have John Calloway there and you see
he's got I think he's got a Windows
laptop some people are using Linux
laptops and Macs and so we're bringing
the whole developer community around
Raspberry Pi and that's a really great
rich experience because you're seeing
how I've seen how you've come at this
from a PowerShell perspective I've been
doing it through my Mac and there's all
of this melting of ideas together so
we've got a cluster here from Gregory
and then one that's a bit bigger there
from John they're both running open faz
on it because before open fires it was
like whoa I want to build a cluster
people would build it post a picture and
then it they just like turn it off and
gather dust they didn't really know what
to do with it and it's kind of cool how
people have latched on and found well
actually I can just run my functions on
it I can put web hooks coming in through
my firewall I can send messages to slap
I can start to work with events and this
is one that came in from Baptiste again
he's got a surface book a bit like yours
hmm yep I'm doing mine on a surface book
- he's got his Mac right here the only
thing we have in common is us PC which
sucks but what the great thing is that
when you're doing hello world of course
you don't want to go and just spend 300
bucks buy this and say well you know I
don't always do hello world but when I
do I do
docker eyes container eyes distributed
hello world and their cloud on arm and
net I want to do something useful with
it
yes yeah and open fast makes that's
possible so we're gonna talk about that
those layers and we're open fast sits on
the top and hope I turn mine on all the
time yours are on 24 hours a day hmm
yeah I just I just leave this running
sometimes I get so sick of how having so
many IP addresses used up on their
network I just turn everything off so
you never find anything so you just need
the raspberry PI's and a switch that's
it it doesn't have to be expensive but
just like we see here people make their
own sort of twists on it and so we've
got a hub I think at the top of that
cluster Scott's got his USB powered one
here which is really cool and so you've
got a lot of freedom you can actually do
something like this this is resin my
friends that resin put this together
that was 288 it's called the Beast it's
a third version of it but actually I
think they ended up with 360 yeah and it
takes five kilowatts of energy to run
sounds like a lot right but imagine that
an Intel service in your xeon processors
it would be many times more now out of
different ways to do it
maker community has made their own cases
by cutting them out of out of acrylic
people have made them with Lego I use
standoffs and I've got a little power
thing at the bottom we'll talk about the
parts that we each recommend but the
great thing is that there's no one way
you literally use standoffs
and whatever USB power supplies you have
lying around yeah you can be creative
and build something classy like this one
that Alex Miller did exactly and I what
I really love about this is the
Raspberry Pi community is full of makers
people that are really comfortable just
making something brand-new I use pieces
of copper to stand them off because I
just I don't have those skills I can do
the software and I love it when you see
something like this come together and it
you know it's so neat so people love
building their own cloud hope you will
love building yours too I'm just going
to try and help you along the way here
mm-hmm
so we're not people with big egos but
it's possible that
this massive uptick in the discussion of
the dotnet framework grasp Raspberry Pi
and docker was entirely because Alex and
I were tweeting about this I'm just
saying it could also be the holiday
slump and that people came out of
Christmas but we have decided that
that's just our excitement about
Raspberry Pi that has caused us to
literally move google trends you can
make your own conclusions I don't think
you would probably go that far but okay
it was exciting to see that there's
people chattering about this yeah that's
of discussion I mean when you look at it
the three topics that we picked for this
talk net docker and was the Raspberry Pi
just together some much more than as
some of the parts I mean how how much
interest is behind this it's incredible
and it really is a testament to open
source as someone who's coming from the
dotnet world and saying I'm running
dotnet core which is open source and
running it on arm and open at ease and
there wasn't anything tricky or unusual
that I had to necessarily do to I enter
that world and a couple of maybe even a
couple of years ago your only option for
Linux and dotnet was probably mono right
and if you've used mono there's you can
only get so far and it was kind of slow
on the Raspberry Pi but my core is much
quicker and so you if you love dotnet
and that's what you do at work and what
you do at home you can now start doing
in your cluster and in your own time and
you say opens up more doors for you
right and with open fares which is
nondenominational
on this raspberry pi cluster I've got go
I've got Python I've got node and I've
got that not net all sitting together
and they are all friends yeah exactly so
we are talking about dotnet we're
talking about clusters also talking
about keeping eTI's keeping at ease is
what's called an Orchestrator and if
you've not heard orchestration and
keeping it ease we're gonna explain a
little bit about that but first of all
like who would actually need one why
would you need an Orchestrator right
because i've been doing a lot of docker
and Dockers great it's a formalized
containerized official way to run stuff
and I really like docker because I've
been able to take applications that I
wrote a year or a year and a half ago
and write rehydrate them yeah almost
like dehydrating food and then just
bringing them back you just add water
one a great example if I may was are we
doing fun do fancy-pants so true story
I would did a talk and with Glenn
Condren a year ago with a beta version
of asp.net and we called it fancy pants
and we just watch to see if people
actually watch our training video that
they would pull down they would pull
down fancy pants and go and do that so
this is old this is old software now it
is a couple years old and I can say
docker I can't I can't type because
everyone's looking so everyone turn away
and I think we put it on on a tee and it
was Glenn see fancy pants and I can just
go and say run that and it comes down
and it's run and then I can bring it up
in my browser and I think to myself well
I don't need any orchestrators because I
just brought back a really old
application like that
I didn't say hey here's a here's a
virtual machine go and use this I didn't
say here's a 32 gig virtual machine on a
stick right to run my hello world app I
just sit in one line so I know I can
reliably run that on your laptop yeah my
laptop what do I need an Orchestrator
for right so Scott's right he was able
to package up an application and was
that on Linux that was a yeah Linux
Albert Scott used Linux and as you can
see from this diagram docket once you've
built your code you can ship it to your
server run it wherever you want Windows
or Linux works exactly the same you'll
run it on the cloud and your physical
server like this one or on a VM but
there's a bit more to it when you start
to run it in production so a little bit
more about docker and the pros and cons
so we were talking about virtual
machines just there when you have a when
you ship your application the old way of
doing things was you would have your
application maybe it was 100 Meg yep
you've got your libraries which is
dotnet and then you always have to ship
the whole OS with it well you had to
build out a virtual machine with Windows
2012 with Linux every single time with
docker what you do is you have one
operating system one place to do your
Windows updates or your apt-get upgrades
and you just ship your app and
libraries and you can actually have
unlike with the VM if you want two
pieces of software there dotnet two and
dot you know if you really have to
donate to you and net four point seven
together would be really hard
they might interfere each other but with
docker you can put whatever you want you
could have one two three four five if
you liked right and that is all that you
run that's all that you ship so we're no
longer talking about managing the whole
operating system there can be much Lima
right and what's so powerful about that
if you think about it from a historical
context perspective is that even as
recent as ten years ago I would go and
work with large banks that would tell me
that they were remoting into production
because well we've got web one web to
web eight web six is acting weird we
think there might be a dll with the
wrong version on it that snuck into
production like some of you are nodding
because you know you're doing this at
work right alright if you're SS aging
into production because you're not
really sure the configuration is right
those are classic problems so that we
try to solve those we over solve them by
saying well we'll run everything in a
virtual machine yeah which just made our
problems x n so can you fetch that DLL
from production because I need to run it
through reflector to see if my changes
there right okay that's no longer the
case
you can look at the image what you have
when you're def machine is the same as
production hmm additionally it's worth
pointing out that the docker is code
where the the deployment can break like
the code didn't compile right but I've
worked at companies where the deployment
was a Word document
yeah Word documents don't tend to break
the build docker allows us to automate a
lot of that yes so what I was talking
about with the different versions of.net
for instance is that you've got like a
sandbox right and it's isolated so you
can have whatever you want in there and
it won't affect any of your applications
we're talking about how we can actually
densely pack up locations Scott was
telling me when you used to work in the
industry if a server CPU got to 40% and
held there that ring the guy up and
they'd bring another server on maybe you
got it yes people would say this
machine's running too hot you know CPUs
at 50% we don't have enough Headroom
because it might we might become popular
tomorrow right but docker
with docker we've taken several
approaches like we've got our AWS
account we've got this huge bill coming
effort
every month we want to Bentley packing
as much as we can and with docker you
can just keep packing it until until you
feel comfortable that you've kind of hit
your limit right it's immutable that
docket image will not be different it
cannot change so if you restart the
application you're exactly where you
were and we're talking about a next-gen
workflow it's no longer here's the
checklist for production this is how you
deploy the application this is how you
build it you have code the docker file
is like code and it says look do this do
that do the other and everything will
just work okay and there's some best
practices around that but really it's
great to be able to do that that was one
one of the things I really loved about
docker when I started working with it
now all of this and everything that
we've just described is the layer that
is docker that sits on top of virtual
machines and on top of the last 20 years
of computers but you haven't said why I
need an Orchestrator because at this
point I'm still thinking docker is the
amazing that's really what I'll just use
right he's docker for everything I'll
docker all the things he might say well
what happens when your docker container
stops I'll say hey no problem I'll just
add - - restart always and I'll just
well true keep the docker container
running at all times problem solved yeah
that should work no cloud I got a handle
docker is all I need right yeah I think
that would work you think that that is
gonna fall down in any way hey unless
the server crashes yeah that is that is
a problem I didn't think of well thank
you for telling me that what would you
do then yeah if the hardware fails if
the disk fails right just simply keeping
running using docker as a poor person
server - just yeah things running
services in the background all the time
oversimplifies what needs to be done
when one is actually orchestrating a
large system so when we come to
orchestration we start to solve some of
these problems and you can actually do
what's called a declarative deployment
that is you write a llaman file you say
look these are things I want and then
the orchestrator will say ok what's my
current state where do I need to get to
and it will start to make changes to get
you there right so we said we want one
replica of nginx it will go and pull the
image down on one of your notes it will
start it up if that node goes offline it
will say what did I want I wanted one
I've got zero and then it will bring
upon another night right you can do
configuration through Yammer whereas
your docker run is kind of hacky right
you've got these long command lines you
put them in shell scripts a programmable
API is fantastic so programmers love API
so I really love a PRF use them in open
fires to be able to build this huge
servlet system by using the Kuban eTI's
api and saying look we need more
instances of this micro service write
this function and the API will just go
okay not one I want 5 and the cluster
will do everything for me every point
here is important but the one that is
the most cloudy for me is that
programmable API that idea that the
cloud has an API that I can call this
little API here has a restful api this
little pile of raspberry pies where I
can talk to it with whatever tool makes
me happy he made the comment that he's
on a Mac and I'm on Windows he can use
curl I can use W get whatever we can
program this thing with PowerShell or
scripts or node or Python or whatever
right the other thing that's really
really cool about using kubernetes or an
Orchestrator is service discovery now
service discovery with your docker
container when you did docker run you
would have got an IP address for it but
it would have been really hard to find
that outlet end or whatever my kids I
could send it to Scott on whatsapp right
this is a production IP address however
we've keeping eTI's whatever name you
pick you actually get a name on the
network so we would get nginx
dot local or something like that and we
can access our code through the service
now they can do some really cool things
of that like you can do a/b testing so
you can have half of the clients go to
serve to nginx one and off go to nginx
one point to their showing different
sites okay you can't do that with docker
run you have to add a lot of extra
tooling in and that idea and there's
other talks that you can see that we'll
talk more about that where you can have
that that discover that service
discovery in such a way that you could a
be test by saying in production
everything product catalog
authentication authorization shopping
cart is all the same but you know every
fifth call I'd like to switch the
shopping cart out and all the codes
still accesses HTTP colon slash slash
shopping cart we can actually
dynamically change that that's just one
simplistic example if I'm thinking you
should do a demo after these last two
points let's do it brother
so high-availability I want to actually
show you how availability and the
elastic capacity is the sense that you
can just keep adding computers and cuba
net is very extensible right so if you
want to write your own kind of objects
you can so high availability that means
that if one of the service was to go
down
we'd be alright we'd recover very so
when the simplistic amp example I gave
Iran fancy-pants at the command line I
unplug my computer
fancy pants off climate share so let's
do a little bit of here's what we're
gonna do this is all the highest quality
production values and it's here at the
at the NBC so what we're gonna do is I'm
gonna know this is all about me we're
gonna switch this camera around thank
you sir I'm gonna fall off the stage
okay so here is the cluster notice that
the top one here does not have any
lights that's because that's the boss
that's Hansel boss 1 Hansel workers 1
through 5 are there so you see there
that Hansel worker 1 is doing something
what's it gonna pull the cable out yet I
want to pull a keep gonna pull the cable
out yeah so it's running an app that's
moving the lights I'm gonna pull the
cable out yeah okay so I pulled that
cable out so right now on the other side
it is no longer plugged in and the
cluster though when Alex set this up he
requested
that's one replica he requested one
replicas he said I want blinkin lights
on one of these things make sure it
happens now in production you skip a
heartbeat it's not a big deal you don't
necessarily die you maybe want to wait
four or five minutes before you fully
panic but for the demo here you turn the
timeouts down a little bit so yeah
earlier yeah and actually this doesn't
mean you're not meant to do right you're
not meant to get into the guts of
keeping it and start tweaking stuff we
actually oh there it is so the top 1
Hansel worker one is still running but
it's
off the network and it hasn't shut down
because it doesn't know what's going on
but kubernetes noticed that that app is
no longer running yeah and said Wow
no one's take paying attention no one's
taking care of blinking lights and they
moved it down to answer worker to
automatically so now our blinking lights
are distributed now I just plug-in it
again yeah and in a few moments what
we'll see is now that the over node is
back on we said how many we said the
orchestrator will have a desired state
and its continuing reconciling so it
will be like well there's two of those
now now that nodes back on we only said
we want one
so we'll kill it and we'll see that it's
only one of those animations is running
and that's what an Orchestrator will do
for you it will save your bacon in
production now is there anything in the
code did you put anything in the way you
wrote this flashing light thing to say
well yeah I mean it I actually wrote a
liveness check as well that checks every
five seconds hmm but it was really when
we we'd said look if the node is offline
for 30 seconds then we need to
reschedule the work right now in
production you would not have your
important application on one host like
it wouldn't make sense right down you've
got your 30 seconds or in production
five-minute delay okay so the other ones
stopped now yep what you do is have high
availability to say right I'll have five
of them right why not if you lose to
service you're still good you're still
serving Black Friday traffic yeah and
that's what you should do in production
- that makes sense
cool yeah great don't feel like you need
to apply it it's fine we don't want your
pity applause we got to earn it
great say so what happened what happened
was this is kind of what keeping X is
doing behind the back behind the scenes
is we had a Yammer file now this is for
nginx Oh a web server it's not for our
blinked and we said we want three
replicas so the deployment object starts
to exist behind a deployment is a pod
and if you kill that pod the deployment
again it says I want one I've got zero
it will recreate the pod and then behind
the pod is what you got from docker run
so you can see how far removed this is
from docker run so in development and
when you're learning this stuff that's
probably where you want to be but when
you start to move to production keeping
at ease and a scheduler is really where
you need to be so when I if we go back
just really briefly if we go back there
to here so this image : that's docker
yeah that's saying go and get it from
here so fancy-pants : latest right
linked whatever yeah and then you said
the deployment is a couple reserved from
the container there's the on certificate
of deployment containers show up on pods
so if I go out to the command line and
say get yeah cube control get deployment
you can see that I desire one yep I have
one and it's up to date and it's
available and it's an hour old we
started running as an hour ago so I mean
we could scale that we could always call
that two five and then you would see the
cluster would just do its thing
is that hard like I know that's not in
like this destroyed or anything but can
you just make it all blink because that
might make them happy no pressure is
this a tough crowd the the English are a
tough crowd
these little blinked lights are actually
sitting on top of the Raspberry Pi
headers there are only five pounds we
just ordered them and had them delivered
really quickly you just put them
directly on the headers there they're
individually addressable you can animate
and do colors and stuff like that so not
just for for demos but it can give you
all kinds of information so boom look
look look how's that
yeah okay so that that's why you need
kubernetes okay
it's an Orchestrator and actually has a
bunch of building blocks and there's a
lot of them but we want to try and give
you some other context so there's master
components and there's no two components
the master as we said is Hanzel boss one
at the top you can see it's not got any
lights on it because nothing runs on
that other than these components listed
down the side important things here or
there's a dashboard web interface and
that's great if you like to look at
things I really prefer using the command
line we're not as close where Scott and
I have a different preferences right and
I like to just see that I just pretty
colors I just stare at that and smile so
back to the slides and we have things in
here like SETI D or etcetera D once you
start dealing with a distributed system
and you're trying to unplug nodes and
have everything still work you need a
way of having state highly available
right and it's Saturday will basically
allow your state to be transferred
across all of your nodes and they're
kind of have a consensus about what is
right and they'll try their best to make
that happen for you we've got an API
server we talked about having api's
there's a DNS I talked about earlier and
that's all master stuff when you come to
the the node you have your regular
docker so your docker run but then
keeping at ease has something called a
qiblah that runs on there and it talks
to the daemon right so the qiblah is
responsible for interacting with the
cluster and then you have additional
stuff like the proxy that's to do with
the dns here's a quick question if I
were to SSH on my own into number three
yeah could i docker run stuff you can
docker run you can do docker PS and
you'll see all of the cuba Nettie's
stuff if I'm darker ran fancy-pants or
something would kubernetes know that it
existed or would it don't even know that
that happened he wouldn't look it
wouldn't track it right yeah so this is
about going up another level not
hardware not virtual machines not even
thinking about docker we're thinking
about these deployments it's a much
higher level
talking about API objects right the way
programmers like to think about systems
Dhaka is very much about your system
containers running things ad-hoc mm-hmm
cuban entities we're talking about
declarative programming okay so this is
a sign or a zine by julia evans i'd
recommend you check out her material
this is just showing you roughly how the
components fit together and you see that
at CD stores all the state api server
talks to that and everything else just
plugs in it took me a while to get my
head around what this was but right
let's see d is kind of like Redis it's
just a distributed key-value pair it's a
place to put all this stuff yep it's
worth pointing out also that I have
Hansel boss one but there's no Hansel
boss too well being a true distributed
system if I were going to go and put my
Raspberry Pi cluster into production I
would need a second yeah Hansel boss in
case the first one went down and they
have basically a completely redundant
system yeah and you probably have those
in different regions yeah but that's
enough about the public cloud let's go
back to the cluster what can you run on
here well you know I loved just running
an FTP server you know why not you know
you can run MPD which is where you can
have a music daemon running on it then
you can control it from your phone
there's a ton of stuff that's just quite
fun but it doesn't do much with
clustering so python MPI is a
programming interface that's really used
very much in the traditional world
education to split your program out and
have it run across multiple machines but
it's hard to use you've got to change
your code you've got to use Python right
I like to do stuff like we're doing here
running a blog or a website on there
having all the components spread out the
kind of things you do not want to really
do or you can't do is like you cannot
accelerate your gaming like you're not
going to play GTA on this you're really
not it's just not for that Bitcoin
mining again you may be able to control
a Bitcoin miner with it but just don't
go there just wasting your money it will
probably not even work obviously right
now Windows binaries don't work so well
and we're not going to get to Skynet we
could try so close yeah so place now
people say that these might be
underpowered they might be a joke these
are silly little toy computers for $35
right well Joe Armstrong worked on
Erlang said that the Cray was a hundred
and sixty myths that is a 5 ton
supercomputer the word cray means
supercomputer but it's worth pointing
out that the Raspberry Pi is almost
twenty times faster than that one of
them and raised weighs about 40 grams
this is six of them all working together
so that's what is that 12,000 almost
14,000 MIPS so for many many times more
than a pencil and only cost 300 bucks
and it turns out that Erlang itself was
made for a VAX so if your code is slow
when you run it on this it's probably
your fault it's kind of what I that's
what I took out of Joe's tweet so let's
let's go back to the talk we had talked
about clusters QP Nettie's and now open
fires now have some stickers come up and
get some at the end some badges now open
fires is a project though that I've been
building over the last 12 months in the
community it's an open source project
and it's about building service
functions and running them on wherever
you like your own hardware or the cloud
but what is service well you know I've
given this talk a lot of times and I
think it's important to go back to
basics we used to build monolithic
systems three tiers
we had the database they're very hard to
test they're really slow to deploy to
production we had like a 12-month cycle
they did far too many things we then
started to break them down into micro
services that had constrained
responsibilities okay they did fewer
things were easier to package and
actually that's where docker and Cuba
Nettie's came in we started to package
these up and ship them well as you can
see kubernetes is kind of hard to work
with there's a lot of stuff there so
functions are the next step in that
evolution and we're breaking them down
even more into small discreet reusable
pieces of code we can write once and
pretty much forget about the system as
we go back to that picture where we
talked about the uber and the stick
shift this is the uber of software you
write your program CS you're handling a
s
throw it across the wall and cluster
will do everything for you yep
to put it in another way
20 years ago when I was working on
shopping carts pre amazon.com and Black
Friday started to happen the shopping
cart that we needed to scale was part of
one giant monolithic app and we thought
we were clever by making a separate farm
that was shopping cart dot our company
and the way that we scaled out the
functionality the shopping cart was a
bunch of new hardware the way that you
do it in this world is you think about
add item to cart remove item to cart all
of those individual business problems
which one is slow and you'd scale up the
function yourself or maybe just let the
system scale it for you we're gonna see
how that works yeah I'm going to show
you a quick demo of service function and
we're going to switch over to open fast
a little bit more about about the
project so Chemex a community project
and really focus on developers first so
it's for you guys there's a UI built in
and a command-line interface a CLI it
has 9000 github starts in 12 months it
one info world's best cloud computing
software in the same category was Cuban
eighties and docker itself and it's got
a thriving community full of developers
over 70 external contributors on the
project and it's the easiest way to run
your own functions however you on them
ok so we're going into a demo and what I
want to show you is our UI or API
gateway down the left-hand side of the
screen we have all the functions that
are currently deployed and we can
actually deploy a new one from a store
and this is functions that have been
submitted by the community and one of my
friends Stephan has done this ssl
checker anybody use let's encrypt not
enough you should be using this and what
it does is it gives you a HTTPS
certificate for your website but it runs
out after can you check my boots
councilman hands on hey you wanna let's
encrypt and when we hit invoke so we're
putting the information at the top we
get a progress bar 200 status how long
it took know and we got a bit of
information down here so it's saying
it's got your goods until next June
next July okay mine is gonna run out in
three months now this is an example of a
service function and you can imagine how
you can put that together with something
like a slack notifier or maybe even an
automatic renewal so that you never have
to worry about that running out again I
want to make absolutely sure that people
understand the leap that Alex made from
kubernetes into open faz into services
it might not be a hundred percent clear
this UI is a kubernetes application yeah
right I could go and take fancy pants or
hello world or whatever and deploy that
as a coup neighs application and then
I'd be responsible for scaling and
thinking about it and dealing with it
but what he's done is made a system
where I could think of a function a
literally a method and call it do it in
any language and I'm another layer
higher I'm not even thinking about
kubernetes here and right the closest
thing the only thing that I have which
is an insight into what's underneath is
where it says replicas right there
otherwise he's hidden kubernetes from me
that's correct and we were actually
running this on on the cluster right in
front of us here and one of the
functions we have is called a node info
and when we invoke this it actually
gives you how many processes you've got
maybe that's a bit small it says four
and it's giving us a host name now if we
run this again because there's several
replicas I talked about this high
availability concept we should see 54
days actually just going to change every
time we run this how many we have on you
yeah
so that just changed to 92 j5k and
that's showing that each time we run it
it's actually going to another one of
those nodes it's automatically load
balance now speaking of load balancing
and performance testing is it is is this
valid perf testing is that that seemed
to go pretty that's pretty fast yeah
what do you think I invoked it 28 times
I don't think that's in the full you
think maybe we can scale it a little bit
better yeah you want to switch over to
your machine I know what you
so I'm just thinking about do you want
to talk a bit about the about the
cluster and how we put it together and
then yeah so let's talk a little bit
about now I know maybe try some
autoscanning listen yeah let's do that
let's talk a little bit about the
cluster really briefly and then we'll I
want to just walk over the cluster again
and then let's we can either deploy the
dotnet app or we can hit it with some
real traffic the patterns mark I'm gonna
go over your head sir one of the
interesting things that we're finding as
we talk to people who are doing these
clusters is the first impression is to
go and buy a bunch of raspberry pies
stack them up and then they put them on
the Wi-Fi both myself and Alex have
discovered through trial and error that
while that does work it can be really
problematic it doesn't make the cluster
very portable you want to go and make
all these with static IP addresses or
come up with a way for them to get
reliable IP addresses he prefers static
IPS I got a cool router uh-huh
everyone's like I don't care about this
talk with that router is the main thing
notice that the router IP is 170 dot one
that's the inside okay then this on top
here is this lovely USB powered 8 port
hub okay so we plug the router into the
hub with the white wire and then
individually plugged in all over the
side of the PI's and then I've got
static leases such that I've got 2.3.4
all the way down yeah and that makes it
very very simple you do not want to use
DHCP do not cut corners because you'll
boot your cluster up and they're all
trying to get back to that master dock 5
yeah it's not about 5 anymore it's
thought 11 and you have to run
everything in again
so do things right do you do that the
static IP addresses yep and we found
that when carrying this around to
conferences and stuff what's nice about
this particular thing is called an
amplify is it actually shows you the LAN
IP so all we had to do was plug this
into the hotel Wi-Fi or the conference
centre wife wired rather and the point
here none of the internal IP address has
changed
does that make sense all this needed was
to get to be outside now that's another
interesting point we can get to the
outside which means I can deploy my
docker containers to a registry and then
pull them back down sorry try that
that's a good net
yeah let's do that in the app so let me
go back over here anyone want to see
don't net cool looks like they don't
care they're just trying to figure out
what kubernetes is yeah so I'm out here
at the command line
you're gonna grab it again you don't
think make it make a little bigger and
then tomorrow I'm giving a talk at at
three o'clock and at that talk you can
discover what that green arrow is right
there that's my blood sugar in real time
cuz I'm diabetic and I don't want to die
in the middle of the talk cuz it's true
like so from in here
I've got dotnet paying the ammo this is
not keeping next to John with us in open
Fasciano
yeah so this open fast yeah Mel is
saying here's where the handler is
here's the docker image chancel Minh
slash dotnet ping that's right people
call it that uh and it's up at docker
right yeah it could have been in an
internal registry right that is one of
the flaws in the way I built this one of
the suggestions that Alex had made was
why don't you run a container registry
on the kubernetes cloud itself yeah you
could it could run its own app I would
then push to itself and then he would
talk back to itself and then inception
in the white told you two years ago I
had to build all of docker from source
yeah not even Cuban a docker itself you
actually still have to build the
registry from source and I did that a
couple of weeks ago and people are
asking me things like that and yeah well
it's not as easy as it sounds there are
still a few bits where it's gonna work
against you you have to run MongoDB
you're probably not going to find it and
you might have to go and find the docker
file and rewrite it for arm so I'm gonna
change this version 2.6 okay and then
where's my my code I think is in
function handler using notepad which is
one of the great IDs
is it England or Britain what are the
rules what am I supposed to say okay I
can give you pay maybe London is
London's probably safer okay
so notice that I'm saying system dot
environment dot machine name right is it
might be on a different yeah different
machines and I want to point out before
I do anything if I go over here to the
so we only vary a handle of that we
didn't write a whole application we
don't have to think about this B button
that we have new no NuGet packages it's
good handle you yeah could I have named
it anything it does have you called
handle this one handle yeah okay so
that's might do it and it's also worth
pointing out that I'm not saying hey
HTTP but right whatever console dot
write line console right that makes it
easy to test locally and then I can go
out to the cloud and you can what would
binary dates or as well so from within
here then I could build this yeah and
then make the docker build the thing
locally build the docker container push
the container but I've got a CLI as she
said open fast has this great us seal I
asked CLI and you can even do things
like we do this break the whole machine
okay so we can actually even use it to
list the functions that are in the
cluster right now without touching the
Kuban eTI's API if we do - verbose we
see we've got botnet ping 0.5 we're
about to do so there's one replica of a
0.5 and we're gonna go anymore and I
went and made a batch file to do that
yeah
it's using fast CLI which will
ultimately use docker which open to use
kubernetes stuff etc etc yeah but you've
hidden all that do I is this ok this - -
replace at the bottom there I don't I'm
not sure if that's right but however we
would just let's just do this and do it
one at a time how do I do this you're
selected then you hit enter there you go
and then everything goes to hell in that
is ok them all that's bad you've you've
ruined everything I don't know what's
happening it's just because you're not
in as administrator
ah it's definitely not that
is docker it only likes me to touch it
okay so what we're gonna do is make sure
I think we build it higher up one it is
trying to see if I can work around no I
want to actually set if I want to I want
to the technical problem we were having
Oh we're now pushing up the other image
and because we didn't actually manage to
build it we didn't give me a chance to
panic on stage though that's right yeah
so when I don't know what I'm doing
I go to my giant kubernetes open notes
page here and then I just look
frantically around for anything that
might have possibly told me that it was
the right thing and I got all kinds of
stuff your name is in here a lot by the
way lots of links to Alex's blog
different things like that it was the
right thing I wonder if you need to be
in as administrator do it for a normal
command from No let's find out I am a
normal command prompt
you mean like DOS yeah yeah let's feel
bad about that if that's the case and
let's make the font bigger I know we
have only seconds of time actually we
have lots more than seconds don't worry
we'll be fine
but I don't like to just yada yada yada
over stuff I want to see it actually
fail horribly there we go
yeah so here what we're doing is
something really interesting youyou
can't this is arm right so we're on a
Windows am I having a stroke I have like
eight minutes dude yeah
halite person bring it back down no did
he leave all right well even though the
lights are on I know I have like seven
minutes 55 yeah I reject you light guy I
wouldn't say yeah so what I want to
point out is that we have to we can't do
the build on arm because arm doesn't
have a dotnet SDK it would be too slow
remember how he mentioned that he was
building docker itself on Raspberry Pi
it's a huge hassle
Datuk core has a really interesting
thing where you can go and say dotnet
publish - are and put in a runtime ID so
I can say dotnet published - our Linux
arm so I'm building and omitting the
stuff that I need for arm on Windows
yeah but what we're doing is we're doing
the build in one docker file so for a
moment in time the docker lives out we
pull it out yeah put it in another
docker file which is our smaller runtime
version of the thing right one is x86
that's where we build then we copy out
the arm results and put them in an arm
specific one that I can't run locally
right and we're pushing that one to the
cloud if you look at where I've got the
cursor right now right up top this is
dotnet - SDK that is a Windows docker
image oh sorry a Linux docker image it
will not work on the PI that's why we're
using that here then on the laptop we're
saying publish and at the end of that
line Linux arm so it's going to build a
binary for the ARM processor but on our
regular PC right so for one it's
actually quicker but - like Scott said
you just can't do it on arm yet they've
got net core team just haven't quite
you'll be clear though that dotnet
publish is happening in not on that not
on the PC but inside the darker
container that happens to be running on
the PC exactly and then the magic piece
here is something called multi stage
builds you can read about this on on my
blog and Ibaka Doc's is we're then
saying now use the arm runtime image of
dotnet and just copy the binary across
that's it and then we've published that
to the cloud if you've ever done darker
before
you're familiar with the from syntax
here you've got from twice that second
from is that second stage that multi
stage yeah that's right and then a lot
of people were giving me a hard time
online recently about how I was staring
at something for hours and I didn't see
the forward slash that was the forward
slash that wasted an entire day in the
lower left-hand corner right there that
F watchdog that function watchdogs is
going to make sure the dotnet stays up
and yes that's right you're going yeah
so if we go back over here and just
remind ourselves of what we did we went
and we built this
yep see the multiple stages yeah copying
that information out did we deploy and
then dot fast push yep fast deploy okay
and it said accepted unfortunately we
were talking we should see that new
version when it happened which is
horrible what are we doing when I go
back over to the dashboard that you
despised and then I click on it and look
yeah 0.6 0.6 so now remember that I'm
choosing to look at kubernetes don't
have to yeah the right thing for me to
do is to go back over to the UI for open
faz and look at dotnet ping or 0.6 hit
invoke hello in London so why don't we
end on Auto scale I think we should
scale now all right and you can you give
me a favor and show you graph honor oh
yeah so graph honor is this lovely
little not little this amazing dashboard
that I'm running locally now this is a
little bit of Inception here
I said docker run blah blah blah gruff
ah no it's like graph or with an F and
I'm running it locally and then I've
loaded in data sources core fauna is
going to aggregate from jason api's that
are inside of the the kubernetes cluster
that you can then provide arbitrary
values to so he's I mean it's unzoom
yeah there you go how's that so what
alex and open fast has done is included
a JSON file that is in the griffon a
format that says here's some of the
really interesting perf counter stuff
you might want so Open Graph fauna is a
docker based perfmon for stuff like this
so what we've got is the replicas Fionan
if you request from my laptop into the
cluster I look so you can see that the
rests are going up I'm generating some
hashes using hashing function I'm just
pressing up and enter it's kind of slow
they notice right there that there's the
dotnet one that I just put there there's
node info and then there's the SHA son
that he's calling right so what are
these metrics that built-in fee you
don't have to do anything if you wanted
to get metrics and you thought and that
core app you'd have to do that yourself
with Ivan fascist all built in for you
yeah so what we've put here is Apache
benchmark and we put it into a bun too
so what we're gonna do is we're gonna
call sha some yeah a lot and we're gonna
just beat on that machine with the
benchmarking application if we go back
over here we change that to refresh a
little more often
that's max but what we can see and this
is the important one to total requests
is going up pretty quick
912 bit of a skip there because we've a
distributed system you don't want to
fill your cluster with traffic that it's
just about instrumentation right you
want that to be our application what
just happened on replica scaling maybe
you can hover over that he's hit it so
hard and this is where things really get
powerful he's hit shots I'm so hard that
it said you know I don't feel like I'm
effectively serving this traffic we only
had one replica but we've got five
raspberry pies it went and made five
replicas of sha some automatically
that's made a feature called do it now
sha some what do you think that language
is written would you think the languages
is it net or no to Python or go it's a
it's a built in bus function
he's calling bash and now he's put it in
the cloud service now ordinarily
serverless means give us a function put
it in the cloud hand us your credit card
and then move the slider bar and the
slider bar goes as far as your credit
card will allow it to but the exciting
part about owning your own little
cluster is that you don't have to outlay
anything we can go and do all kinds of
stuff so look at 7,000 we go up to 10
replicas and now I've stopped that load
test it's actually going to go back to 1
again because you shouldn't pay for what
you know
using right you talk about how we have
ten replicas but we have five yes the
ten replicas will be spread
however cuba Nettie's sees fair across
those devices yeah so you can have a
device and there's multiprocessor and
you can have us yes there's four cause
in the RPI right so we could probably
run four processes quite happily yeah so
we've got twenty different processes and
processors running come back down now
and now it looks like it saw that
there's not much traffic zero or one
again I went back to desired state which
would be one yeah all right that's
pretty hot too in it that's a that's the
bit scope cluster yeah so what's next
how far do we take this well we talked a
little bit about networking about how to
build this kind of stuff I talked about
the challenges of networking how far
could you go so the University of New
Mexico is building out this cluster
believe it would see for three hundred
of three thousand nodes they're trying
to get to they're not going to run their
actual scientific experiments on it but
they are using it as a cheaper way of
figuring out how to build systems this
is bit from bit scope and on the
left-hand side you've got the thirteen
node that they sent me to play with and
this is just I mean just look at the
difference between what we've put
together
why is everywhere it's industrial-grade
IOT so please send us free raspberry
pies yeah so we are we are way out of
time at this point but we hope that
you've learned how and why you should
build your raspberry pi cluster we
should probably throw this into the
audience yeah randomly hope you can
learn some kubernetes try some net core
and it's great that you can do it
unarmed and if above all try out open
fence what's the large size large
t-shirt okay
[Laughter]</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>