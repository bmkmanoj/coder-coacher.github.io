<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ops and Operability - Dan North | Coder Coacher - Coaching Coders</title><meta content="Ops and Operability - Dan North - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ops and Operability - Dan North</b></h2><h5 class="post__date">2017-02-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MmL8H0oGGe8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome so yeah ops and offer ability so
I want to talk about what what I believe
might have happened I'm not sure this
did happen but I believe it might have
happened so it's early 1800s for 1814
Ada Lovelace fathers Percy Bysshe
Shelley who's a a drug-addled poet she
invents programming and so Jane Austen
living in the in the West country in
England she thinks that's not going to
end well
programmers now so she invents
operations and the way she did it is she
she had a series of coded books that she
wrote in the early 19th century with
titles like ops and operability but the
editors didn't understand this so they
changed them into the words we know now
so this is this is my theory is that
Jane Austen actually invented DevOps
operations about 200 years ago so before
we go there though just think about this
imagine a company that treated his
customers like this so thinking about a
product company and it does this it says
there's no consistency in its products
you get one product you figure out how
that product works and you're feeling
quite good about that and then and then
you get another product and it works
completely differently like there's no
reason it just happens to yeah so within
a product I figured out how this thing
works
oh but now this other aspect of the same
product works completely differently
who's had that frustrating experience
when you only opened two different apps
on your phone and they work completely
differently and I do similar things you
thinking why would someone bother doing
that this is not fair when something
breaks I don't mind things breaking
honestly I'm gonna carry things breaking
I'm a software guy I know that things
break mm-hmm
but I want to know right so there's no
clues when something breaks you just
voyage silently fails yeah you don't
even know that something has broken so
it might have been broken for a while
right that thing where you know you go
to bed and your alarm worked when you
went to sleep and you sleep straight
through because the alarm didn't go off
and you didn't know the alarm was broken
until it didn't work you
don't know that things are about to
break there's no clues there's no kind
of warning lights there's nothing like
that okay
they blame the customer when it doesn't
work it's your fault okay you're using
our product our product is must be fine
because we wrote it you must be an idiot
okay and so they have phrases like
provided without warranty they're
provided without warranty is it sir this
is our product but there's no warranty
so what does that what does that mean
that phrase provided with that warranty
I don't know when something breaks I
don't know what happened these are sorts
of questions I ask I go what happened
and and I don't get any answers how can
I fix it okay something's gone wrong I
figured out something's going wrong how
can I fix it what do I need to do can I
fix it is it even possible to it for me
to fix it and I'm thinking okay we're
now feeling a bit helpless and I'm
thinking wow how long is it going to be
broken for right what's what what's
going on there and then and then I
started to get across you know you go
through your seven stages of grieving
right I've done denial it can't possibly
be broken and then I know I'm getting on
to bargaining now I would come on right
who can isolate this - I'm cross I'm
cross and I want someone tonight
and then and then again you know you're
just yelling into the void and nothing's
happening right and so you're just
thinking am I just stuck with this yeah
and we're just stuck this does anyone
care right so this is a company that
treats their customers how long is this
company going to stay in business well
that's not a very successful way to
build a company to build a customer base
to build loyalty this is how developers
treat operations people all of those
things I just said are exactly how
developers treat operations people they
get inconsistent things they don't know
when they break when they break they
don't know how to fix them when they
figure out how to fix thing ie over here
it has no bearing on thing B over there
again it's a dev treat salts and there's
a reason for that
Eric Evans and his wonderful
domain-driven design book he talks about
upstream downstream dependencies you
know and he says the upstream dependency
has that has the handle they flush and
the downstream dependency gets whatever
comes down the pipe okay and there's an
upstream downstream dependency between
Devon ops so
most kind of DevOps initiatives they
start with devs pushing on up the DevOps
as a movement came about as a kind of as
a natural consequence of agile as a
movement so we had in the 90s we had
very big very heavy projects that would
release every 18 months two years
whatever very very long lead times four
releases and if a release took weeks and
weeks and weeks and it was painful and
eye watering and all that stuff by the
time the next one comes around you've
forgotten that pain that transaction
cost of like several weeks every couple
of years that's that's kind of
acceptable right it's a bit crappy but
it's not the biggest problem you've got
what the agile movement did is it
brought that release time down and down
and down
so you started releasing once a quarter
right and that was considered you know
state of the art we're gonna release
every season whether we need a release
or not yeah and then it went down to
every month you know and then every week
but even if you're releasing every
quarter having very very high
transaction cost in a release is bad and
so that starts that exposes the next
constraint if you like then it's
constraint down the pipe is operations
it's how do we get things into
production so DevOps starts with
developers going but we've done this
work let's get it into production now so
they're pushing on ops and Ops alike no
one told them they never got the memo
yeah so they're getting a little bit
kind of freaked out and so then you talk
to the developers and they're saying
you're saying why is anything in
production going on because Ops resists
write ops keeps pushing back they keep
resisting and then you go and talk to
offs and you hear a very different thing
they say yes we are resisting we're
resisting efforts to compromise
governance right assurance audit
compliance control processes all those
things that keep the lights on all those
things that keep us of course we're
resisting because you guys haven't
thought through this stuff you've just
built some software thrown at us and you
expect all this to go away in this brave
new world then the problem is this ops
is still on the hook for a whole bunch
of things right they're still on the
hook for runtime operations so they are
they've got the support writer okay
they're on the hook for SLA is once it's
in production I don't have SLA I might
have some early live support a warranty
period or something right
but after that your SLS your
availability SLA is your downtime SLA is
your response time SLA is nothing to do
with me on you operations diagnosis
understanding when something goes wrong
right what went wrong how do we go and
fix it yeah once I figured out what's
wrong how do I recover it how do I make
it work again getting stuff working
again is often the easy bit okay
what's happened is while it was broken
that there was a period of time where
everything got a little bit out of whack
you know I had data loss so you know
catastrophic failures on a database
they're easy I can see when a database
fails what I can't see is when a
database is silently corrupting data but
it looks like it's still limping along
yeah I was working at AAA with a large
Bank a few years ago
it will remain unnamed and they had
accidentally been miscalculating how
much of the money was theirs and how
much of the money was their clients for
some years which is really really dodgy
it turns out that it was in the clients
favor so luckily they'd only lost
several million dollars right rather
than being massively exposed to all
kinds of horrible fines right they
didn't know because it was a really
subtle data corruption issue it wasn't
negligence it wasn't you know then being
naughty it was them absolutely not
knowing restoration is a huge deal and
getting data back on track as a huge
deal and then business continuity day to
day operation is making sure things
making sure the lights stay on the ops
guys are still on the hook for all of
these things
okay so then early 1800s 19th century so
jane austen's you know very aware of
these these pressing issues in her daily
operations role and so she writes the
first of her of her famous books pride
and packaging part of packaging opens
with one of the most famous sentences in
English literature it is a truth
universally acknowledged that a
developer in position of a build must be
in want of a server okay so we're trying
to get things into production this is
Lizzie Bennett
that's Darcy in the background there who
was a rails developer
and then he became a react developer and
now he's all about the Elm okay so he's
totally hipster he's got a build he
wants to push it into production all
he's got to do is get past Lizzie okay
so you know we've got a developer all
I'm thinking about is deploying my stuff
like I've got a very tunnel view of the
world so and this is this is the first
kind of I think sort of a tough lesson
if you liked for delivery people for
developers automating deployment is one
thing automating is actually pretty easy
I was working with a lovely chap was at
the Ordnance Survey then - Keith he's
moved on now but he he tells a story I
did some work with him and he'd spent he
got really into his DevOps and he spent
some time automating a load of stuff and
I went I went in there to help out and
I've co-authored the build production
line paper size on the production line
guide and then I've got this build
pipeline you've got to show you this
thing so he's got all these DevOps he's
done right he's done all this automation
and it was a thing of beauty you know I
spend a lot of time on it I said that's
fantastic I said so what impact has that
had of quinhagak I was like what's the
business impact of that work he said
what do you mean I said well let's map
out the value stream from the features
ready to go to the feature is live okay
someone's using it let's map out that
process and from feature done to feature
live was hmm weeks right really quite a
long time and we looked at the amount of
time that was and we said okay so what
impact is all that automation had the
impact of all that automation brought
that down by 45 minutes okay 45 minutes
on some weeks of work yeah and but about
this why I like Keith he wasn't he
wasn't part of he wasn't like oh we're
doomed he said that's brilliant
he goes right now I know what I need to
do next and the next time I saw him
which is only a few weeks later he had
like I know it was less than half the
time because once you can visualize what
you can see what's there you can start
to see what the impact is so automating
deployment is one thing understanding
the release process understanding the
past of production is something quite
again and that's what things like value
stream mapping give you allow you to
turn the lights on and see what's going
on in your world but what I want to talk
about now is this
having something worth deploying that's
something else again yeah so it doesn't
matter if you understand the price it
doesn't matter if you've got this thing
slickly if what you're deploying if you
don't have something Vitti's deployable
none of this matters and what I mean by
that I have table stakes for deployment
right there's a minimum bunch of stuff
you need to have in place before I will
consider deploying your thing if any of
you are in Goa coach talked earlier
talking about serverless and lambdas and
all those kind of things a lot of what
I'm going to talk about are things that
you get for free when you start using
other people's infrastructure this is in
organizations where we don't have that
so I want to start there's a couple of
patterns I want to talk about today and
the first one is called phone home so
this is a deployment and operational
pattern if you like and it's very simple
and very powerful what it says is this
it says any component should have a
heartbeat that's the whole pattern okay
if you put anything in a production
environment or really in any environment
it should have a heartbeat what I mean
by a heartbeat is it should send out a
message on a regular basis saying okay
because once I can tell you're alive I
can start to do all sorts of other
really cool things you can think of
monitoring I think of it as a four or
five stage process of evolution if you
like so monitoring starts with
instrumentation so instrumentation says
can the thing I've got tell you about
itself
okay instrumentation is having the
capability to tell you about itself what
its body's doing what's being called how
long is it taking all those kind of
things can I produce metrics the next
part is telemetry so there's no point
you measuring stuff unless you tell
someone what the numbers are okay so
telemetry which means measuring at a
distance is can I get those numbers to
someone who cares on the back of
telemetry I can now build monitoring so
monitoring is the receiving end of that
is that I can now hear what's going on
after monitoring which is a active thing
I have to keep on looking at the
monitoring
I think alerting which is passive is
fantastic it tells me so alerting says
Oi this this thing is above us
shoulde okay and that's I see that as
your four stages of monitoring is you
get instrumentation telemetry monitoring
alerting and now Netflix being Netflix
they've then taken that to the next
level which is stage 5 of 4 which is
prediction okay so they have machine
learning that says we know when we're
likely to receive a burst and we can
preemptively spin up enough servers to
be able to take that extra capacity so
when you start getting into machine
learning AI based on historical trends
in your data that's pretty cool but just
getting those first three is massive
okay instrumentation telemetry
monitoring and that will get you a
really long way so fine home then every
component should heartbeat you've got
lots of options for heart beating my
favorite honestly is still the simplest
right send out a packet UDP super easy
UDP little packet just send it broadcast
it okay
multicast just send it out to anyone
who's listening hmm you could write to
the service registry I could write to a
console or a CD or something I could
just keep on sending messages the
problem is writing to a service registry
if it's a service you have to connect to
is it has to be available and so what
you don't want is your little service
running and hanging because it's trying
to tell people it's a life that's a
little bit ironic and it can send a
message again as long as you have
asynchronous messaging infrastructure
they can send a message okay any of
those things of viable options the
reason I like EDP a single UDP packet
can carry about 1500 bytes 1500 bytes is
a heck of a lot of space gives you a lot
of options so mmm surprising amount of
information so here's an example of a
phone home packet okay this is from a
real app names have been changed this is
from a real app and show you some of the
things so the first thing it has is this
is it has a name okay this component is
called product search and it's part of
an app called online shop so I can see
immediately what it is and why it exists
and I can do this requires and here's
some other components it requires okay
so now what happens it is as soon as I
get that one packet tells me I can now
if I'm now listening
for all these packets I can build
dynamically a network dependency model
of every single component just in that
tiny tiny bit of information so that
means now if one of these things becomes
unavailable I can tell from its
dependencies everyone else that I need
to update I'd say hey you guys you're
about to fail because one of your
dependencies just went offline that's a
super useful bit of information where is
it running address right hoppy interval
so these are there's loads of ways of
doing this this is one of my favorites
the interval 500 mil is I should expect
to get one of these every half a second
what does it mean if I'm getting instead
of every two a second what does it mean
if I'm getting for a second what does
that tell me i I've got a rogue instance
right I've got another instance sending
these things out yeah because they're
coming out every half a second am ia
interval how long does it need to be
missing in action before I care maybe
I'm on a flaky network segment and so it
says you know what don't worry if you
miss one or two if you don't hear from
me for five seconds assume I've died and
again you can imagine a monitoring
dashboard we built a monitoring
dashboard off for this emotion dashboard
it sees as soon as it sees this new
thing pop up up it comes on the
monitoring dashboard I can see that the
product search ie product search node
has just just emerged
we don't have versions and stuff on here
that the Coco is looking that early but
that would be trivial to add so I can
see it it's right it's online if it goes
away again I could color it amber I
could say this thing was here and I
don't know it's currently unknown status
right and again there's a bunch of quite
awesome Amazon tools that do this free
but this is pretty easy stuff to roll
yourself honestly and then after five
seconds I can start telling people stuff
is going on
so what else here's some here's some
static information so this is get the
get revision deployed from me and when
it was deployed hmm and then here's some
dynamic information so I can see that
memory is eight I don't know what 80s
I know a 18 or 80 K I don't know right
what I do know is that someone does yeah
so it may be there's 80% of memory is
utilized right it may be a team X I
don't know what I do know is that there
is
a protocol there that the monitoring
system is receiving that and this packet
had one of a time series of packets so I
can be watching that number trending so
I can have thresholds around that say 80
it might have been 35 on the last upbeat
and it's now 80 and I've got a threshold
of 50 right so that's gonna trigger
something I can see my CPU load IO load
disk and so on this is a fun thing we
run it this from Google so Google any
any service you have running anywhere as
a web interface you essentially have two
well-known URLs on it one of it is all
of that static information so this is a
little summary of the static information
slash config is all of the static
information like white status is a
little summary of the dynamic
information slash data's is everything
you need to know so now these URLs
coupled with that address tells me
everything I need to know about there
and the whole thing is now navigable
right one UDP packet yeah anyone not
doing this on their own systems should
be taken out and shot
I know maybe that's a little harsh right
should we take it out give it a stern
talking-to and then shot so so these are
the sorts of things you should be
thinking about when you deploy any
component into an into into a any
deployment environment make it phone
home the power-to-weight of phoning home
is under liz is off the charts so now
let's take a look that's that's getting
things into production let's take a
something about support now so hmm
in her follow-up book Jane Austen write
a wonderful book called support and
support ability which again got sadly
renamed by her publishers but this is
the original here you have two sisters
and then a Marianne Dashwood who are
both operations support engineers and
this is then write clearly pissed off
okay
this is this is our support team meet
the ops team that's what they look like
every day that's their going to work ops
phases okay and so they say things like
this they say you build it you run it
yep that's what they want to say and
they say they have no understanding of
monitoring okay this is why they have
such sad faces
yeah and I say basically developers
should be on the support router right
that's what they really want to happen
I want developers to be able words
that's not always possible where it is
possible you should carry the pager okay
so the point here is this as developers
okay who we got in the room who's
developers who cuts code in this room
hey most of you any operations people in
the room excellent
go hug those people at the back there
let's guys need love okay you build it
you run it so empathy empathy is always
an option putting yourself as developers
in the heads of the operations guys and
girls is always an option okay what does
that mean anytime anything happens in
production okay and there's three magic
questions there's only three things
there's three and only three things that
matter when your operations engineer
when you're on support and something
happens in production the first thing is
is what happened okay first what
happened how if I need an answer to what
happened I need to know who it matters
to because I want to get to them before
the failure gets to them yeah I want to
be able to figure out who my
stakeholders are and the third thing is
how do we fix it okay mm-hmm and in fact
all three of these are really summed up
in one person the real question is this
how could we reduce the impact of this
and this is something again that started
in the agile world and then found its
way into the DevOps and continuous
delivery world is this obsession with
impact and I think this isn't talked
about nearly enough in in in in software
circles if you like pre-2000 let's say
up to up to the end of the 90s and in
fact if you look at any traditional
project management or software delivery
model we obsess about likelihood so I
want to minimize the likelihood of a bad
thing happening so I minimize likelihood
I front load all the risk in terms of
planning I front load all the risk in
terms of analysis I front load all the
risk in terms of design excuse me so
that by the time I get to programming
it's just a typing exercise and by
time I get to testing a bunch of highly
trained monkeys can do most of it
obviously I don't think that right but
the model is set up to imply that we
front-load all the high-risk works so
that the lower risk work happens later
and that is a rista belief that is a
that is a throwback to our model of
software development as civil
engineering right if you're building a
hospital
you do want to front-load all the risk
if you're building a bridge you do want
to front-load all the risk because by
the time you've got most of the bridge
in place realizing it's in the wrong
place is really expensive software
doesn't work like that
okay we have this wonderful is a
gorgeous book called the leprechauns of
software engineering by guy called
Laurent boss of it where he climbs into
a bunch of these like received wisdoms
about software and one of them is the
the exponential cost of change right so
I introduced a change in software in a
software system and as I get towards a
release it exponentially gets more
expensive that is hokum there is no data
I will believe it but there is no data
so what the what the agile guy said is
not explicitly what they did is they
flip the axis they said rather than
worrying about likelihood will obsess
about impact so if I have a defect
typically what happens that defect gets
all the way into production someone
loses an order that's bad right that
cost us money whereas if I write tests
along with my code then the impact of a
defect is I test files right if I'm
building something and James is building
something and they kind of both work but
we've put them together and they don't
work right if I have continuous
integration what happens is I break the
build very low impact I buy pizza for
the team or whatever it is you do when
you break the build wear a silly hat
that's why I wear a silly hat I break a
lot of builds right let's say so so we
massively minimize the impact and
likewise in operations we've mostly
obsessed about in likelihood and now
obsessing about impact I think it was
John old sport ed C he said the problem
with having 10,000 hours mean time
between failure with hard drives is when
you have 10,000 hard drives now that
doesn't make the likelihood one because
stats doesn't work like that but it does
mean you have a much much y
variant right it's very likely that some
part of your estate is currently out so
now you start designing and architecting
differently you architect for resilience
you architect with the assumption that
some unexpected unpredicted part of your
estate load balancers database servers
web servers mill where is currently
unavailable and you don't know which
part it is and so now you change your
obsession you start worrying about MTTR
mean time to recovery becomes much much
more important than mean time between
failure if you can make mean time to
recovery perceived mean times recovery
zero it doesn't matter how often things
fail right and this is the Netflix model
with the chaos monkey chaos monkey is a
thing that's running in production all
the time switching things off it goes
around switching off servers all the
time like the virtual servers and and
the idea is that no one at home is
allowed for notice so what does that
mean that means it has to be at least
two or three versions of orange is the
new black streaming into my device so
that if I lose one of them I don't
notice hmm so there's a couple of other
bits of infrastructure they have don't
really talk about that much there's a
thing called chaos gorilla cows gorillas
great fun couch gorillas and it doesn't
run automatically it's run manually and
it's run at a weekend cows gorilla takes
out an entire service ok
cows gorilla kills all go database
servers kills all of your streaming
infrastructure whatever it is and no one
at home - now - notice what does that
mean that means you need two entire sets
of infrastructure running streaming
stuff to my device ok it gets better
they have a thing called chaos Kong
chaos Kong they run that once a quarter
they take out an entire data center and
we're gonna kill us West one ok rule no
one's allowed to notice so that means
not only have I got resilience locally
and resilience across think I've got
resilience across data centers coming
into my device so that I don't notice
they've designed that in so perceived
downtime even if they have a
catastrophic failure is no one notices
mmm I can't help asking myself the
question but your streaming video
like I would love to see that amount of
care and attention applied to things
like finance systems health care systems
safety critical systems that would be
cool for these guys are at least paving
the way so this is my my login question
hmm
I always ask this login question so
what's the difference between logging a
warning and logging an error and how do
you decide whether to log our operations
guys you're excluded from this
developers if you're going to log
something at a warning level or an error
level how do you make that decision
am I happy to be woken up with the
warning
imagine being paged at 4 a.m. for your
error message is how you make that
decision because you won't be he will be
and he's got kids and his kids are
crying and they just went to sleep at 3
a.m. okay and so this is what's
happening right we have we developers
have a duty of care to think about the
impact of those error messages okay so
hmm
then here's another pattern I'd like to
share with you this may end up being
quite a short talk he's usually quite a
long talk for this thing so I think he
barreling through it today so we might
have time for a bunch of questions at
the end so um
captain's log then is a pattern so it
starts with assault it starts with I'm
pairing with a guy another developer as
few years ago now and he taught me a lot
of stuff and one of the things he taught
me was he came and sat next to me I said
ah what you working on so come and show
you I'll show you what I'm doing so no
no don't tell me let me work it out I
said what do you mean he said so it's
like he's tried to run it into didn't
even compile so now I'm still coding it
he said okay so but I can see from the
you know the compile errors what's wrong
with it so we've got it compiling and
then run it and he said okay so I
started explaining to him what it's
doing he said let me figure it out so he
runs it and and of course then then he
couldn't figure out what was going on
and I I learned something really
important that day I learnt that
someone who isn't me should be able to
figure out what my things doing if I'm
not there and that should be true all
the way through development and that got
me thinking quite strongly about log
driven development a lot log driven
development but at any point you should
in any failure in a system even if it's
a thing you're still writing should be
self describing I should tell you what's
going on so here's what I think a log a
good log message should contain okay so
the first thing a good log message to
contain is this it should contain two
kinds of timestamp okay it needs to
contain a timestamp for human beings
okay so I need to be able to look at it
and see what was going on I also want a
timestamp for machines I want a machine
readable timestamp so that I can grep so
that I can sort and both of those
timestamps are important I think you
don't have those things it's not a log
message it should have a unique
correlation ID so there's a there's a
Google publish to pay for about a
systematical daffa and data is a
spanning protocol so what that means is
you can track all of the behavior all of
the interactions of a of a distributed
system from edge to edge in one of these
things called a span and what happens is
the first time something hits the edge
of your system it's given a unique idea
you it and that lives with it all the
way through now that can fork and every
time a fork happens you get these sub
UIDs and when they come back together
again it can make sense of them they
have very highly accurate GPS clocks in
all of their nodes so they can get
pretty high precision and what that
means is they can figure out what went
wrong okay
they use this on a sampling basis
because it's expensive to do that for
every single call but so it's a some
percentage of calls they'll sample them
and then they capture all this stuff and
against that's your instrumentation
telemetry it gets sent somewhere and
then they have a system that can make
sense of this Twitter open source to
that our system called Zipkin a few
years ago and Zipkin speaks dapper
so again it's something that takes
samples of flows through your system and
it allows you to understand exactly
what's going on in there so on a unique
correlation ID I don't want to have to
guess where messages came from I should
be able to figure out the source of
everything that goes on in my system and
trace it back right to the very edge to
some external user initiated or system
initiated inbound event that caused a
whole flurry of activity it's also super
useful for finding things like emergent
behavior like cascading failures where
you get sort of feedback in the system
that starts to cause out-of-control
behavior and and multiplication of
messages so one unique correlation ID
the next thing is this is I want to
understand and this is this is a nod to
Ted code that guy invented the
relational database the cause the whole
cause and nothing about the cause I want
to know what went wrong I want in that
log message to know everything that went
wrong I don't want to be looking around
trying to piece things together at 4:00
in the morning when the page has gone
off on my kid was went to sleep an hour
ago okay
that is that is the mindset you need to
be in is I'm not at my best
I'm bleary-eyed I'm a little bit
unfocused this just happened and I'm not
you and I don't have access to you and I
won't have access to you for another
eight hours because I'm in a different
time zone okay so I need to know what
went wrong
I need to know all of what went wrong
and don't and no noise yeah so you think
should I love the Flavia dev things
should succeed
silently and fail noisily right when
they fail I want to know everything I
need to know but no extraneous stuff and
finally the log message should give me
the answer to my three questions okay or
at least give me clues to those three
questions what went wrong who's impacted
how do I fix it if I can understand
those three things I can recover very
very quickly and I guess the takeaway
from this is this is that a log any log
any monitoring system is an append-only
read-only user interface okay we should
apply
same design aesthetics to a log file to
log messages to monitoring as we do to
any other user interface design okay it
should be consistent it should be it
should have affordances it should be
easy to understand what's going on why I
should be drawn to the important stuff
though I shouldn't be distracted whether
by the other noisy stuff and it should
be I thought if I look in one place and
I see a message I should be able to look
in a different place and see a similar
message
so then ops and operability this brings
us kind of full circle ops and
operability is really use and usability
and it's this thing as developers when
we're building systems to run in an
operating environment in a production
environment we need to think about that
operating environment as a user
experience where the users are
operations people and support people
okay and just as much care should go
into what if supportability
what it means to use that system as we
were put into any other aspect of design
in our system and then we end up with
happy ops which is fine because look
they're smiling now why are they smiling
I say things like this they say
developers study how we work right they
bother coming down to the machine room
yeah when we were working
whereas working on the on the the team
was just humble in the mid-2000s where
we were building out the deployment the
automated deployment scripts discussing
what what language what technology we're
going to use the automated deployment
scripts Ruby Python then we said why
don't we go and ask the ops guy fill the
ops guy and one last film he said fill
if we're gonna write these automated
deployment scripts and then we're gonna
leave and you're going to end up with
them so what do you want us to write
them in and he said bash and went oh
right it's like I don't mind programming
in bash I've programmed in all kinds of
shells but so we did we wrote the whole
of this deployment is called Conan the
deployer that I was quite pleased with
there at the whole of this deployment
suite in bash
to be fair I still tell this story and
he hit me up on Twitter reason and he
said by the way if you ask me again I'd
say pythons like yes hmm but so we did
we went and studied how Phil works and
what Phil would do is he'd come in on
this weekend because that's when you had
to do releases you did releases a
weekend when when there were fewer
customers online and what happened
always gave him an automated deployment
suite and that meant that the eight
hours of deployment was now a 25-minute
fully automated process with like a sub
second cut over on on Apache and that
meant that he could do that same release
on a Monday morning and so that meant we
gave him his weekends back okay and we
only knew this because we went to hang
out with Phil we spent time with him
then about release engineering James
Lewis is talking about sre earlier on
site reliability engineering okay
there's there's there's two models I
think there's two models of successful
models of having decent engineered
decent release engineering one is you
make the whole thing completely
self-serve yeah and the other is that
you raise the skill and ability within
the team that the team is fully
autonomous and it kind of is up to you
where on that scale you want to be but I
think unless you go after one of those
two you're always going to be in a
situation where again the the need to
release leaves the team which means the
teams now are hanging on a ticket not
being processed or whatever and then
they wait and it comes back yes anything
that means that either they have
autonomy because the whole process is
self-serve or they have autonomy because
they have the skills and capabilities
and the authority within the team I
think those are the only ways really you
can have sustainable release engineering
they look beyond their own apps okay so
we're now we're not looking at like you
know all these teams are autonomous
which is fab right up until they have 17
different database technologies across
17 different teams and each team is like
oh god Cassandra I got ready so got you
know Mungo I've got whatever else and
then which is great if you all that team
if you're the downstream operations guys
that's now 17 different technologies you
have to install manage patch secure
upgrade okay
learn right and that's just databases
that's just stores what about all the
other kind of technology
so as a development team we understand
what the broader implications are of
technology choices we make
they learn about security how many
people in this room understand the
security implications of the software
they're building one security at the
back I have build security systems I
know what I'm talking about I'm giving a
talk about security ok yeah you get a
pass
most of us build desperately non secure
systems yeah I'm a bit of a security
nerd and I'm rubbish at security and I
just enough about security to know that
I'm rubbish at it so I try to hang
around security people and then I check
my phone and afterwards I let security
their devs thinking like ops yeah which
is kind of cool maybe there should be a
word for that ok so that's basically all
I had to say so which I think means of
coming in record time which is really
unusual for me so that means you've got
plenty of time for questions and hanging
out or if you want to get up coffee you
get a coffee so thank you
logs are a user interface but there are
multiple different users for logs so
there are the ops people who go well
what's happening then what's going on
you have back Tracie's for developers
you have application support people who
want to go what's going on here I want
audit trails non-repudiation all that
kind of stuff so actually I think you
may need more than one lock well its own
is this so I see logging is a great
observation logging is a specific case
of monitoring that's why I think it is
so and with any kind of monitoring it's
about who's the audience so I might want
as you say non-repudiation and audit as
a type of traceability I might want
developer stack traces or back-tracing
as a kind of traceability I might want
recovery as a kind of traceability so so
but again all of this is still UX is
still usability so everything in that
log and everything in the in your you're
logging world if you like isn't arms
going to dump this out into the log it
needs to be and if you're going to have
multiple audiences served from the same
log file or from the same source the
same monitoring system then
tagging is really vital so you can say
tag this message this is going to be
useful for this this and this audiences
and so I can look through for the kind
of audience that stuff is useful to me
so yeah thanks for that any other
questions thoughts ah right next to you
that's handy are there any particular
schemas kind of industry standards that
you recommend using uh I don't know it's
good question I'm sure there are
as with any standards I well not
anything so certainly an awful lot of
standards I find that they are a lowest
common denominator so that particular
one started as I'm alive right just
literally I'm alive and then we evolved
it into those things so that to me
that's sort of pretty good table stakes
right
what are you who do you belong to you
what are your dependencies some static
information some dynamic information and
then how do I find out more so for
instance there's no reason not to use an
atom feed for that you know so I could
have refs in there and the refs
would be to various different other
resources that would that will give you
your kind of your your discoverability
so I would lean on standards whether
they're honestly though the ones I've
built is we just kind of figured out as
we went but so things like using gaffers
fans probably is would be a good thing
to do now
any other questions thoughts
observations Oh little cluster of people
over there that we're listening and care
thank you it's more specific question
around I might need to leave I'm only
three ask a friend then we're going yes
yes logging you have middleware they
could use request and response yeah
is that sufficient or would you actually
do login pretty much everywhere nice
right I can't answer this no it's not
not even place yeah so what that does is
it again it tells you request response
what it doesn't do is things like it
doesn't tell you why and because HTTP
once the conversations finished is
effectively stateless it means that if
there's a whole bunch of these things
that are related
I can't correlate them so I need some
other thing as well so either it needs
to be something that's carried in each
request or I prefer it to be so there's
a lovely pattern from refs called
verifying operations so for instance
what we used to do is we'd have a bunch
of places Tildy we'd have seance I'm
applying for a loan online I would have
some session state in that session state
I would have a a loan object that I'm
gradually populating as I go from screen
to screen through my wizard and
eventually there's a submit button and
the submit button there's always a
validation and then it sends off my loan
and that's how we used to sort of build
those systems wray of flying an
operation says take the operation and
turn that into a thing so ray if I come
from res latin raspberries thing if I so
mmm so if I'm applying for an
application that's the verb so flip that
into a noun and it's an app
vacation so I have a thing that's a loan
application that represents these
screens I'm going through and the loan
application has all the same fields as
the loan object if you like but each of
those it also has a bunch of metadata in
them and this thing can be as messy as
you like so this thing is gonna be a
validation around it but the loan form I
need to know about you I need to know
about the amount you want I need to know
about your credit history right there's
three things I need to know and so as
you're going through these these it's
not really wizard screens anymore such a
big forming you to fill in each time you
change anything I update the the loan
application data structure with the new
value and when it was set when it bunch
of metadata about it so I can see
exactly as I go through essentially what
I've done is I've serialized that
session state so what that means I'm
doing a gem ramble now what that means
is at any point if you go away I can see
exactly how far you've got in that thing
and when you come back I can reconnect
you to it but it also means across many
many people I can see when people drop
off my form I can see when they get
bored and go away so if you think in
terms of reifying operations and you
capture every single interaction that
goes to building up a query as well as
the query it set and and then and then
that flips into the query itself that's
a really powerful pattern for um for
being able to understand what the
actions were leading up to something
praying longer answer you're expecting
you know if you put if you have to load
something they just just log so again I
think I think of logging is a specific
case of monitoring so what I will do is
I will inject a monitoring object into
things yeah
so monitoring is just another service so
as my application is running it's
sending information out to a monitor and
that monitor can be doing whatever it
needs to be doing so that makes it very
explicit the things I care about because
those things I care about are are being
monitored a kind of logical conclusion
of that
you get what's called event sourcing
systems so event sourcing systems
everything that's interesting is is
turned into an event so I have these
event objects event data structures if
you like flying around the place saying
someone is logging in someone has logged
in or someone attempts it is tempting to
log in someone just fail to log in so
all these events happen and I can keep
an event stream of all the things that
happened and I can replay that stream
and I can see exactly what I can I can
recreate the world at any point in time
so that for that that that needs to be a
fairly fundamental architectural
decision you make to set out with an
event sourcing system so that
essentially your logging is almost for
free because your logging is that that
event that the transaction log over all
those events so yeah that's that's a
much richer way of doing that kind of
monitoring anymore for anymore and in
the middle oh hang on there's a
microphone hurtling towards you as we
speak
ignoring the events or something that
you just said okay no no we were never
here there was no I know the answer to
that one already but if you're just
doing regular normal firebase logging do
you tend to test that like the unit
tests or whatever or is it enough just
to kind of sprinkle it where you think
you need it and that's good enough
that's a really good question I don't
think I'm spelling here we come here
completely honest like I'm throwing at
something but no I don't think I unit
test logging what I do is destruction
test logging I stress test logging so I
I will I will cause things to break to
see whether someone else can figure out
what happened like I learnt that lesson
quite deeply pairing with this guy oh
just one of these like you know life
moments where you go wait a minute I see
what you're doing here you know he said
right don't tell me what's going on I'm
gonna see if I can figure it out from
the information that's there and so we I
could write tests for those tests carry
my confirmation bias here's what I think
you should be able to see there whereas
if instead I say hey James come over
here I'm just gonna pull
the plug out on this thing you tell me
what you think is going on there and if
he sits there scratching his head I've
got logging wrong and I think that's a
much more robust form of verification of
that there's a verification validation
thing there's like does it do what you
meant it to do and does it do what it
should be doing are often two very
different questions and we're really
really good at testing what it does it
do what I meant it to do and what we
tend not to do is square the circle and
say is this actually useful and
unfortunately it's like the you know
there is no backup strategy there's only
recovery strategy right you don't test
your backups you test your recovery yeah
and if you if your recovery works your
backups are fine yeah and it's the same
sort of thing is like you don't test
logging you test diagnosis you test
recovery and if those things are working
you've probably got logging about right
they'll be interesting to think about
how you automation of that hmm anymore
for anymore well thank you very much
indeed and enjoy the rest of your NDC</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>