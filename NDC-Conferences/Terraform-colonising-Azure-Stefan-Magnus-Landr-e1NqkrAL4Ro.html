<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Terraform - colonising Azure! - Stefan Magnus Landrø | Coder Coacher - Coaching Coders</title><meta content="Terraform - colonising Azure! - Stefan Magnus Landrø - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Terraform - colonising Azure! - Stefan Magnus Landrø</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/e1NqkrAL4Ro" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay good afternoon everybody my name is
Steph amongst Landrum I'm going to talk
about Tyra form today and also about how
to colonize Azure using it so terraform
was it it what is it it's a command line
tool written and go so that basically
means it can run on pretty much any
platform that you can imagine so it runs
on OS X which I'm I'm going to use today
you can also run it on Windows Linux
pretty much any operating system it's a
tool that's being actively developed by
a company called Hoshi Corp which is
famous for other DevOps tools like
vagrant Packer console Nomad Nomad is a
it's a recent addition it's a container
scheduler so you can do docker
containers and stuff like that
Packer is used for building OS images
console can be used for service
discovery kind of stuff vagrant I guess
you all know a grid so what can you do
with terraform you can basically
describe and define infrastructure as
code and that is cool stuff and you can
use HCL formatted text files to do that
and HDL will we'll see lots of examples
of the HCL syntax it's similar to Jatin
just way easier to read for a human and
you can use terraform to do stuff like
provision servers networks load
balancers whatever stuff that you find
with all the different cloud providers
and the cool thing about terraform is
you can actually combine and use
different cloud providers in one big
infrastructure and we're going to do
that today because this is going to be a
massive live demo really and I'll be
launching a couple Linux virtual
machines at digitalocean which is a
cloud provider in well they're worldwide
that I'm going to launch them in
Amsterdam then I'll make sense
some DNS with Amazon and then create a
digital ocean similar set up over at
Azure in Ireland so I'll be launching
Linux machines and starting Apache which
is a popular web server okay so what is
that reformed and how to use it so a
provider is that the provider concept is
probably the most important concepts in
anti-reform and the provider lets you
talk to different clouds so you can use
a provide one provider to talk to AWS
and another one to talk to you let's say
is Earth and there's lots of different
cloud providers that you can use web
terraform pretty much all the major ones
and the provider shields you from the
underlying details of the API so you
don't really have to know the internals
of let's say the REST API of as are
being able to use terraform so let's
have a look at some code so this is how
you configure the provider that lets you
talk to digital ocean now I'm using
IntelliJ which has nice HCl support and
this is this is basically it so this
piece of code will let me talk to you
digital ocean I can use a code
completion functionality in the editor I
could have used my secret key in here
but I'm not going to do that today
because I don't want you folks to you
hacked my account right so I'm I'm
keeping my secrets secret from you and
using a hang on a an environment
variable instead and the way I'm going
to apply it now this configuration to
the two digital ocean so let's get into
the command line so the way you use
terraform is you
you run a
you'd start out by running a dry run
sort of which is called a plan entire
form so let's see if everything is
correctly set up yes I'm all hooked up
with where the digital ocean now but I
haven't defined any resources yet and
there's it's all up to date but there is
nothing to do right I have I haven't
configured anything yet
except from the provider so let's have a
look at I'll just
perform a quick code update here and
let's look at some at the second most
important concept entire form which is
called resources the resources are
actual things that you can provision
within a cloud context so that could be
things like a virtual machine IP address
pretty much anything
right and the name of the resource is a
combination of the provider name which
is used as a resource no graphics and a
unique ID is being you have to have a
unique ID based on the resource name and
a ID you specify yourself and that's
that's not going to be the unique ID
that you typically find within the
context of a particular cloud provider
but locally in your terraform
configuration file so let's have a look
at that this looks like this in code so
here I'm going to upload my SSH key I
guess you all do you all know SSH keys
you come mostly from a Microsoft
background that maybe not what you use
all the time but SSH keys are basically
public private key that you can keep in
in a file which I'm going to do here and
I'm you typically share your public key
with whoever you want so I'm going to
upload that to my my side' provider and
I'm keeping my private key private
because it's well it's a private key so
keep it private so let's try and
generate this resource with digitalocean
so as we can see here by the way this is
the prefix of the Rhys
there's pipe it's it reuses the name of
the provider okay and the combination of
this and that has to be unique within my
terraform configuration setup and so
this this keyboard here file will
actually load my public key from from
the directory where it is silas city
okay so let's run a plan against and see
if terraform wants to do stuff and it's
well it wanted to do stuff but my SSH
key is missing so I'm just quickly going
to generate an SSH key I'm not using a
passphrase and so I now have a couple
well I have a public key sitting here in
this file and the private key sitting in
this file okay so nothing spectacular
about that but then I should be able to
do a new plan and terraform will tell me
that it wants to generate or provision a
SSH key resource where digitalocean
named SSH okay that so that that's the
idea of the of my resource
okay so let's actually provision it and
upload my key should be quick so that
was it so that just uploaded by H key to
digital ocean nothing spectacular nice
and fast I'll quickly kick off a
terraform apply in the background
because this is a live demo and things
take time to provision something okay so
dependencies in terraform you can define
the tendencies between resources and
Terra firme and a resource can therefore
depend on another resource and that will
also determine the order of creation so
it's a resource the
turns on another resource that well one
of them will be created before the other
one now I already have my my SSH key in
place so I can actually depend on that
right here when I generate a droplet
resource here and their droplet is
basically a virtual machine okay that's
a virtual machine they call them
droplets I don't know why that's virtual
machine and I'm going to use the ascent
OS image which is a Linux distro you'd I
support all kinds of distros or an even
Microsoft stuff so they have a use huge
selection and you can even use your own
images and generate them using let's say
Packer or whatever and I'm going to
launch my my server in Amsterdam and
it's going to be a pretty small VM and
that's about it so that should be the
see what happen in Terra firme so
terraform just applied the change and I
have a server running in Amsterdam so
where is it I don't know where it is
right because I don't know its IP
address so well how do we sort of where
the IP address is or what it what it is
so that's where the Terra firme show
command come into comes into play so
whenever you perform a a apply the the
tool will save its current state in the
cloud in a state file that you can keep
locally or you can keep it in the cloud
all right so we're where the
configuration file tells you or where
you in your configuration file you
describe this state you want and in this
state file you have the actual state in
the cloud all right so
it's two different things and you can
keep the state let's say locally or
within s3 or console and there is
support for stuff like locking so that's
kind of closer I can apply changes to to
my infrastructure at the same time as
someone else is applying and well this
this will all work out nicely you won't
get conflicting changes so that's kind
of nice so let's find that IP address so
here it is
so the terraform show command gives me
the contents of my state file in a
readable format so this is the IP
address and I can actually log in to
that now using SSH so the IP is probably
changed from last time I did this so
this is it I'm connected to my web
server in Amsterdam it's a Linux machine
up and running nothing spectacular you
can see they put the name of the the
instance in the prompt so that's kind of
nice so let's just kick off one more
transformation or apply hang on what
does that for yes
so kick that off in the background apply
okay so that was there from show syntax
terraform is I provide you with a rich
expression language you can do stuff
like variables you can get into spring
interpolation you can do they provide
you with lots of the basic functions for
doing math for doing base64 kind of
stuff hashing security things like that
you can do join operations across lists
you can do lowercase uppercase etc basic
function functions like that
and there's also support for a special
keyword called count
lets you define the number of instances
of a particular resource which is kind
of nice because then you can easily
scale up and down your infrastructure
we'll see an example in just a few secs
and stuff like environments if you want
to have let's say a production
environment and a testing environment
etc you can use the well the
functionality basics basically built
into native syntax and terraform I'm not
going to demo that today but you can
easily do that and terraform also
supports stuff like modules so you can
define rima modules that will define
infrastructure that you can reuse across
well let's have you really you can use
it for pretty much anything so they're
pieces of code that are reusable just
like any other we see reusable kind of
software and that also supports
worsening which is kind of nice
that's all get based so it's really cool
let's see so let's look at some code
here's my code I just defined a couple
of variables so I traded one variable
for holding the number of web servers
that I want to create and a variable for
holding the name of the data center I'm
going to use in case it fails I can
easily switch to another one okay so
that's kind of nice and here I'm gone at
this time I'm going to use the account
keyword for defining a variable number
of servers and this so in this
particular instance I'm going to define
to write because the value of of this
variable is two right now okay and I'm
going to use string interpolation for
using forgiving for generating my name
so I'm going to call one of my servers
web zero and the other one web one
so that's about it let's see what
happened so the existing web server just
got renamed from web to web zero so that
would be an incremental change right
into my infrastructure and after that a
new resource gets created and that's
about it
okay so I now have two web servers
sitting in Amsterdam instead of one and
I just renamed one of them let's see
what the this interface is telling us
yeah so two two resources one got four
in seven minutes ago and one three
minutes ago and we can actually see the
IP address is circu so let's kick
there's some more transformations T or
applies click that off in the background
provisioners a provisioner lets you
provision on top of your resource after
its created or right after creation and
terraform supports it has native support
for chef which is similar to puppet and
ansible and tools like that but you can
also use the remote xx provisioner to
run a let's say a bash script on the
remote machines right after creation or
you can have terraform run or execute a
script that you you run on your local
machine so you could kick off let's say
ansible ok so let's have a look at some
code so here it is I'm going to install
Apache
using the remote xx provisioner some
because this is all on centralized I'm
going to use
I have to use the UM to install Apache
which is this this software package HTTP
be and I'm going to give it SSL support
and I'm going to enable the service so
it will restart automatically on reboot
and I'll start it out and to provision
I'll be using SSH login is root or well
terraform will login is root and it will
be using my private key to login as root
ok so let's see what happens in
terraform well guess what nothing
happened and that's because so why that
that's because the resources already
existed and there's no support right now
and terraform for applying provisioners
after mass so you have to provision as
part of or the provisioner will only run
while you create the resource ok right
after so this was too late so so that's
that's where this tool comes or this
command comes in handy so every time you
have to recreate a resource from scratch
you can actually you have to taint it so
it will be deleted and then recreated
from scratch and the provisioner will
run so let's run that command paint will
take my two servers and then i'll kick
off the terraform apply command
so what happens now first thing that
happens is that the terraform will
destroy my existing instances okay so
this is pretty quick if you compare this
to observe this is digitalocean is way
faster okay you can do it yourself it
takes 10 seconds to delete an instance
it takes
should take around 40 seconds to launch
new instances so it's much much faster
and much more demo friendly so that's
why I am launching or starting out with
a my set up over at the digital ocean I
wonder why xur is so slow this is okay
so here you can see the my instances got
created one of them in 30 seconds and
now terraform is trying to connect to my
server using SSH let's see how that goes
so there it got actually got connected
to one of my instances and then it's
applying my provision provisioner on on
that instance and these things happen in
parallel right so I'm having one server
being provisioned and the second one in
parallel and they're both downloading
stuff from the internet and installing
it and bringing up everything so this
this is it hopefully should be pretty
close to finished let's see
he's taking some time why that I don't
know so so one of the instances is
probably finished already and the second
one is being provisioned that's up there
is so both up and running so I can run
the form show command it will give me
the two IP addresses I'll just click on
one of these it should show me this is
the Welcome page of Apache so Apache is
running in Amsterdam okay yes so this is
all cool right but you might think well
private keys keep them keeping them on
disk on my machine hmm maybe not that
secure so this is where secure security
matters right cloud and security it
really it's important to keep these
things secure with great power comes
great potential for damage right so keep
your stuff secure and I'm going to demo
using my yubikey for provisioning are
you all familiar with you because it
lets you basically it's a it's a GPG
smart card that you can use as an SSH
key so the private material is inside
this thing this hardware device I'm a
public key as well wherever I want to
keep it so let's have a look at that now
I'll have to take my resources again
because this time I'm reprovision in
with my GPG key so this that Mike the
code looks a bit different this time
I'll just kicked off at the apply
okay so my SSH key is kept in GPG I'm
going to export that nothing's crazy
about that so this is my GPG public key
which is a match of the private key
which is inside this thing so I'll just
keep my my my yubikey ready because the
terminal will ask for it and just a few
sec okay let's look at some code so this
used to this piece of this code lock
used to include the name of my private
key right or the name of my private key
file and now I'm instead I'm going to
use the SSH agent so that's why it says
it's the sage agent true instead so in a
sec the thingy should pop up on my
screen asking for me to insert my
yubikey so instances are being created
well I first got destroyed right as
before and before that actually my my
new SSH key was uploaded okay so it gets
replaced with a new one the and the
existing machines got wrote down you
once get created so they're up and
running in 40 seconds again and now
charm is trying to connect to my
instances and in a sec it should prompt
me give me a book come on there is I'll
insert my yubikey I'll unlock it
what's going on oh come on
the wrists will ask me for my pin code
and this is a variety only device okay
so you can't extract the private key
material from my yubikey that's a right
only device so you better keep it backup
of this so now I'm provisioning my
servers using my yubikey and this is way
more secure than keeping your private
keys on file right which is cool and I
really I highly recommend it the device
it can be used well this there there are
several companies selling devices like
this and they most of them support stuff
like this so GPG and you can also do
universal second factor okay which is
making be supported by browsers so you
can log into websites using it and stuff
like that it's really cool okay now I'm
pretty running running tear from show to
get all the details of all my stuff is
kind of cumbersome so or it's a as a
massive amount of output right so I want
to instead I want to have it presented
to me in a way that I can that is more
well easily available so then I'm going
to define outputs so an output or the
output keywords that you define values
that will be output when when terraform
applies and you can easily clarity the
output and we'll do that so let's have a
look at the code so i've defined an
output so this will you use this join
method which is part of the expression
language and it will actually join the
two IP addresses in a
part of this list and the spring
comma-separated so let's do a tour from
reply which will refresh stuff in the
background and so here it is here's the
output so I have the wealth guess what I
still have enough actually running this
time probably on a different IP address
I don't know could be and I can also
query that using Terra from output and
either as Jason like this which is nice
because then you can feed it into other
tools or just like this it's handy okay
now I'm going to throw in some Amazon
stuff we'll kick that off
hmm so the unique thing about
terraformers you can combine resources
found with different cloud providers and
one big infrastructure okay that's
pretty unique you can't do that the
stuff that the the other guy was just
presenting yeah before I came in here so
that's kind of cool and it's unique you
can't do it with negative tools from
desert and attempted the weather
negative tools that you find in in
Amazon
you can't do this stuff like heat that
is a similar tool that you use with
OpenStack
so this is very cool it is pretty cool
and I use this this particular feature
every day where I worked because we
combine different clouds in one big
infrastructure so here I'm guess what
configuring the AWS provider okay it's
going to run in well I'm going to talk
to you you central it turns out BNF is
worldwide so it doesn't really matter
thanks your propagate world worldwide
and this is the name or the the DNS zone
ID I looked it up manually in Amazon
because it just takes two what too long
to propagate the name server changes
with your register so when you buy
domain name it takes like a day to just
get it up and run so as I did that a
couple days ago just looked it up this
idea manually have you launched lots of
new domain names every single day day
you can you can use this resource
instead it depends on your business what
you're into right so I'm just creating a
DNS record I'm going to
check it up with my domain name called
land Rafael it's going to be a type a
domain name record
so that's ipv4 ipv4 addresses TTL 60
seconds I'm putting in the two IP
addresses of my two instances so that
should be all up and running so that was
it Amazon did that for me so I should be
able to use the main names now which is
cool let's see oh there it is up and
running not I don't have to use the main
net or well IP addresses anymore that's
nice okay apply that now this and that
comes what do you guys have all been
waiting for
which is I guess is right my turns out
as there is really slow to launch stuff
right and I'm not very happy with it to
tell you the truth but well so you can
do well you can do multi provider and
you can do multi Zdenek data center and
you can do multi technology and you can
combine all kinds of stuff in one big
terraform configuration and now I'm
going to use DNS weighted record sets in
order to direct half of the traffic to
digital ocean and have the other half to
Azure okay one half goes there and the
other half goes there and I use health
checks in order to to survive a data
center or cloud provider outage so in
case let's say digitalocean goes down I
will still be able to handle customer
traffic
okay cool stuff think about it and it's
quite easy and I could have used so this
this health check thingy or that feature
is you find out only with Amazon right
now I think and so that's a unique
feature of their cloud you don't find
that with Google or with the native DNS
provider in digital ocean or in Azure
so that's kind of cool because then you
can you can you can pick and choose
stuff from the best stuffs that you can
find with the best cloud provider and
plug it into your infrastructure and
you'll be get super happy because you
yeah you get the best of all clouds okay
so here I'm going to start using Azure
I'm still keeping my my secret secret
we're going to use the public
environment in as earth so not the
German one I'm going to use the data
centers in Ireland and generating a new
resource group and then I'm creating a
virtual network in that resource group
so I'm depending on it here right then
I'm going to define a subnet which is
part of this virtual network
I'm going to depend on a security group
which is defined here and this security
group will allow inbound traffic on port
22 in order to let me provision stuff
and it will allow inbound traffic on
port 80 to serve web content and HTTPS
and denied everything else how are we
doing in the clouds let's check it out
so as I mentioned it takes time to
launch virtual machines where the azure
takes like 4 minutes maybe as opposed to
40 seconds LED the digital ocean so here
I'm provisioning a couple IP addresses
some provisioning actually two IP
addresses and then attaching these IP
addresses to two brand-new network
interfaces that's happening right here
so where is the yeah the IP e that's
that's here actually that's where I
attach the IP addresses to my network
interface ok I'm in addition I'm
attaching my security group to this
network interface as well and then I'm
going to put all of that inside a
availability set because I don't want to
go down all the time right right and I'm
going to use a managed availability set
so I want azor to handle all of that for
me ok I could have done this myself
using let's say terraform it's just
easier to do it with with a managed
availability set let's see what's
happened what's happening in the
background self rush machine is still
being created
so this is my virtual machine and it's a
standard a - I don't know really a
country memory of what that means but
it's it's a nice little box and this
this is this is important this stuff so
this is the essence of DevOps I think
you should never keep backups of your
machines you should instead delete them
and make new ones okay
so you don't get slakey servers just
kill machines and bring up new ones
instead of you know taking great care of
them never take backups of virtual
machines take backups of your
infrastructure code I'm going to launch
a sent to s image so the same stuff that
I'm using in Amsterdam and here's my
storage disk and here is the name of my
my computer and I'm going to be the
admin because I want to be the admin and
here is my console login password and
here I'm reusing my yubikey down here so
this is a linux specific functionality
there is a similar code block for
Windows okay so this is taking time nice
so what at least one of the servers is
one of them is ready that's good but the
other one is taking Wow six minutes
never did that before okay and I'm going
to run the my provisioner just as before
now the syntax is a little bit different
because turns out the templates that are
provided by Microsoft or by this company
what they call open logic you have to
use sudo to install stuff
but I'm pretty basic aliy installing the
same piece of code on the other boxes
I'm installing Apache again with SSL
support I'm starting up and I'm going to
connect it or actually terraform is
going to connect it using SSH as my user
on these two public IP addresses using
the SSH agent and now comes the magic so
here's where I do a I define a domain
name for my Azure stuff and down here I
put in the health check down here it is
hang on where is it yeah here it is so
AWS will ping my servers to see if
they're online and that's about it
because this last lock is the equivalent
for digitalocean is this up and running
yes so I should not be able to well I
now have a new domain name which is
which is called WWN rafael which is
either directing traffic to editor or or
digitalocean
and I don't really care as a customer if
it's if this guy's humming it original
or is this this guy is humming in okay
so how does this work so the health
check is actually asking for this
resource on my web server to see if the
data center is up so right now if I log
in to route 53 at Amazon let's eat
should be all green yes they're both
green as you can see digitalocean has
been online for quite a while and azor
just got online so now it's healthy
now let's say digitalocean goes down I
would be interesting to see what happens
but where you can do it are you guys
familiar with this command dig yeah
raise your hands yes one two not that
many it's a utility to look up the main
aims so it basically lets you query the
IP addresses of your domain name and as
we can see I defined a domain name
called land row dot well ww-why Oh which
points at a cname record either this guy
that's half of the time this when I do a
dig half of the time I should get the
the cname alias and the other half of
the time I should get as ur it tends to
be I somehow I don't know why but tends
to Amazon tends to give me digitalocean
IPS all the time I don't know why so
this is but this could depend on where
you are if you're in let's say northern
or in Ireland you'd probably get the IP
addresses of of Azure but this can this
can basically should wait the traffic
should be going half of it should be
going to Azure and half of it to
digitalocean but it's for some reason
tend to get digitalocean mostly maybe
they're just whoa there it changed
actually see T so the the that's kind of
nice so this just got
switched over to observe and my IP
address is completely changed so if I
hit if the main name again there should
be Oh guess what they look the same
because it's well it's running a desert
it's it's the same rent so that's how
you so half of the traffic is going to
one datacenter and the other has to the
other now let's take down let's take
down digitalocean let's take that
digitalocean
so I can log into digit my digitalocean
servers by let's do that so here's my
digitalocean IP addresses I'll take that
and log into it and shut down my Apache
web servers I'll just do this manually
so you can see it so system control
that's how you shut down Apache and then
I'm going to do the exact same thing
with the other IP address which was this
one I guess 158 like what am I doing
here
for me yeah this guy
so I'm just going to stop patchy
like this so now I'm at the two digital
ocean servers have been brought down and
my health checks should start failing
right so let's just quickly refresh I'm
still hoping text so this depends on on
your it will take like maybe you have
half a minute or something like that
depending on the frequency of your
health checks so this is probably going
down pretty soon and we can have a look
at so this should be as where is it
alarms health checkers so as you can see
here to the right there my checks are
starting to fail because the connection
is refused and this should pretty soon
be brought or it will pretty soon be
taken out of DNS so unhealthy
digitalocean is unhealthy and if I do
like be sorry I do a dig I should always
get a I should always get the IP
addresses of my Azure account controller
servers consistently like all the time
so not just half of traffic all of the
traffic should get deep directed to user
now okay let's see I guess yeah that was
the end of the code we can have a look
at this
so it's a terraform setup can get pretty
large right it can contain lots of
resources and that's where this command
comes in handy because it will generate
a nice little well it's not that little
it's just nice their form
graph it's quite just so just this tiny
little setup will get quite massive so
but this will actually tell you the
order of creation of stuff so my SSH key
will get uploaded first because my
droplets dependent on it and then my
droplets also depend on my variable etc
etc etc and now the cool thing I'm not
going to demonstrate that but you'll be
if you use modules and terraform you
will you'll get several of these graphs
in the same picture basically sitting
next to each other and this is this is
actually the name of my my truth module
which is called route and here's my
other stuff so it's similar just way
more complex right it's not generating
more customer value it's just giving you
lots of extra work to set up so how
about that Microsoft yes picked it down
so summary terraform is really great for
defining infrastructure as code and
evolving infrastructure right I've been
doing that throughout this presentation
and I wouldn't do it if I didn't know it
would work right so this is this is good
stuff and you can
perform incremental changes easily and
you can version control them just like I
did by using it or you can use any any
version control system and the cool
thing is you can again what is unique
about this is you can combine stuff from
different clouds easily easily you can't
do that with the resource templates from
Messer or cloud formation templates if
you're into if you want to look at the
code you can find it on my github
account it's all in there you can follow
me on on Twitter if you're keen to do
that and if you're into this kind of
stuff come see me afterwards my company
is hiring and well I'll take some
questions yes yes so the question was
what if someone for some reason changes
something in the portal so first of all
you should never do that because it's
not version controlled it's not version
control right that's terrible
that is terrible this is what DevOps is
all about version controlling stuff
writing code automating things
it kept gives you a higher level of
security a higher level of well uptime
I'd say you don't get flaky servers okay
so don't do it so prevent people from
doing it using your policy files or
whatever depending on which cloud you're
using okay just don't do it so if you do
it you can do it still okay so there's
actually functionality entire form for
importing resources and resource
definitions
it'sit's a feature that got added maybe
half a year ago so you can actually
download the existing configuration so
from the cloud and save it locally and
actually as part of now if you do what
you're from if you really do what you're
doing you know you shouldn't be doing
that but hang on I'll show you something
here terraform there is this refresh
command which actually will look at the
current state in the cloud and download
it and sync it with your state okay so
this refresh will actually pull it down
now you can either run that manually
after you know clicking around if your
spend your time clicking around you can
do it like this and actually refreshing
will occur when you apply to
automatically so if you have if you
perform an apply it will actually
perform a refresh first as you can see
the current state is actually being
refreshed when I perform in the plant so
that's implicit yes more questions yes
can you define resources that you that
don't exist already yes you can because
Terra firme is open source so you can
use it to define whatever you want and
people do that okay people do that this
is all open source it's written and go
it's easy to let's say if you have some
strange box doing I don't know whatever
could be a webcam with a specific
protocol of some kind I don't know you
can implement the provider to talk to
that thing okay or you could even
provision you can use terraform to
provision stuff inside your database
let's say a database table
if you want to do so pretty much you can
use it to provision resources in general
it's not only a cloud thing and by the
way I didn't show that yet but you can
so terraform comes with lots of stuff
and if the open source community he's
surrounding it is it's pretty amazing so
these are all look for hang on that with
provisioners providers so this is if you
see in the left here this is all the
stuff all the clouds that you can talk
to you can do stuff like let's say if
you use graph on you can have terraform
talk to your graph on the installation
and configure it so that could be you
know defining let's say dashboards or
things like that I have looked into
Griffin in particular but you can do
that oh there's being an HTTP provider I
guess you can do HTTP call somewhere so
that's what that would be provider to do
you know make things glue together real
nicely yeah there's lots of stuff that
you can do right and it's easy to add
more stuff okay more questions yes how
do you handle roll outs if changes are
destructed yes so if you incremental
rollouts so life cycle things is that
what you're saying saying yeah yeah so
let's say you you have a the classic
example would be you have a security
group in Amazon or a real office scaling
group or stuff like that auto scaling
group and you want to just get rid of it
and bring up a new one that replaces the
existing one so you'd then bring up the
new resource or the new auto scaling
group then you want before getting rid
of the the old one and that's being
handled our there is a function
in terraform for doing that kind of
stuff that's called life cycles yes yes
can you use it to to migrate between
providers yes it's easy so I pretty much
did that right because I had my existing
set up at digitalocean and I spent a
couple afternoons just setting up my my
other account and I kids easily well
just delete my old my old servers at
digitalocean just using this is that
what you were saying okay so how similar
our cloud providers really yes so I get
I get your idea you basically you have a
workload that you want to run I don't
really care where that's it and you
pretty much want to run it with the
cheapest provider because you want to
save money okay and so you let's say you
have a virtual machine image and you
just want to run it somewhere and you
don't really care you just wanted to
have it up and running okay
now it turns out cloud api's and cloud
functionality they're really similar but
not identical okay first things like SLA
stats very just other concepts that are
just different between them they're
similar so it's quite easy to move from
one to another one it would take you a
few days let's say but you can't do it
in like five minutes we can't do it in
five minutes we can do it in a couple
days
which is still much better than you know
a couple months or weeks or years or
what we used to do I haven't seen any
questions from bacteria well okay
any more questions yes yes
no so so the question is is this is
terraform using what kind of API has
this how does it work
so I haven't looked at the code really
but normally what you do when you
implement the provider you use a API
binding so that would be an SDK that
knows the API of this Azure and this
particular Azure provider there's
actually two supported by terraform the
legacy one ASM I've never used that
don't know much about it but this is the
new one which I've been demonstrating is
using the yeah why Maya the arm API okay
so it's just doing HTTP stuff in the
background okay more questions one more
one yep last one yes how do you expand
it if you're more than one guy so so I
work where I work we're well at least
three or four guys and it turns out we
there is locking functionality in
terraform right as I mentioned you can
you can keep your your state locked and
there's also enterprise features that
you can you can buy from them in their
enterprise offering this is all free by
the way right until now this is all been
free there's an enterprise offering
which allows you to do more scroll
aberration kind of stuff okay but
locking you can get that for free too
basically the locking functionality that
comes with a tool uses a anatomic
resource in
in the clouds let's say or you could
implement that yourself it's not hard to
implement okay that's the very last
question
wow that's a long a question that's all
that he was asking you how do you do
this in real world basically and what
are good practices that would be you
know an hour taught I guess but we can
come see me afterwards
and we'll talk more okay thanks guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>