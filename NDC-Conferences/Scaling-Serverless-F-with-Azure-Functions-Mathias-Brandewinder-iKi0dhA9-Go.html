<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Scaling Serverless F# with Azure Functions - Mathias Brandewinder | Coder Coacher - Coaching Coders</title><meta content="Scaling Serverless F# with Azure Functions - Mathias Brandewinder - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Scaling Serverless F# with Azure Functions - Mathias Brandewinder</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iKi0dhA9-Go" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so good morning everyone like I will be
talking today about scaling serverless
F sharp with other functions so this in
retrospect might not have been the best
title the best title is probably the
subtitle so the theme of the talk will
be what happens when you grow up um what
happens if you grow functions that you
want to stay stained scene in the
process so I'm going to be speaking a
bit about two small functions and then
bigger things you might find and like
how is it that you can have a scene
workflow so that you don't get crazy
when things start to get bigger so
briefly hello everyone my name is
Mattias vandevander you can find me on
Twitter you can find me on the Internet
I usually look like the little guy on
the right and maybe a couple of things
like one thing is that usually the two
topics I talk about one of them would be
F sharp and functional programming and
the other side would be machine learning
everything related to forecasting that's
the type of thing which normally excites
me you probably picked for my accent
that I'm French actually I live in the
u.s. in a San Francisco since a while
but since America started to be great
again I have been advertising my French
site maybe a bit more and so this is a
this is probably what you need to know
about me so now one question you might
ask here is like I mentioned that the
two things I care about is a F sharp and
machine learning and the question will
be like why the hell is he talking about
other functions and does this have how
are the two things connected and the
answer would be like there is really no
direct connection the way when there is
that most of us have a maybe a dirty
habit on the weekends some people like
to call tough words some people like to
reenact worse things like that's my
dirty hobby in the weekend I really like
to write BOTS on Twitter BOTS and so on
the weekend I started to do BOTS and
this is how I came into Azure functions
and service so this is completely
disconnected for the machine learning
side and so as a result I started to
write my BOTS and I started using this
since October and this was fine and I
wrote more and more and more agile
functions and the reason I wrote more of
it is because I found it very enjoyable
I reload it but as the group also found
that there was a lot of friction
it was a it started lucky with most
technologies it started very nasty you
do the demo and then it start to get
bigger and it doesn't quite work the way
it was advertised and so what I'm going
to try to do today is like to show you
essentially answer the question is it
possible to have functions which are
bigger and how do you make that so that
you don't get crazy in the process or is
it even possible so this is what I'm
going to try to do and we can share with
you some of the things I've tried the
some of the problems I encountered and
how I try to address them in that frame
the battle-plan is going to be simple
I'm going to start with the part where
functions shine that we functions in the
small so for small scripts like you
start with this and everything is
beautiful and then I'm going to start
talking about places where it's not that
great and how you can start to build
back up to something which is nice so
we're going to first move from the
bottle to a current line because current
line is awesome then we're going to see
that if you do the current line like
lots of things are great but some of
these things are not quite great and so
we're going to see how to unbreak that
thing I'm going to talk a bit about free
compiled functions which is another way
to move into something which works
better and then I'm going to talk at the
end on what do you do when you have not
one functions but say 10 20 and how do
you how do you know that this thing
works I don't I don't have a perfect
solution to that but I have hints or
bits which might help so let's start
with the functions in the small and to
give you a sense before why I got
excited about it I thought I should
start by showing you functions in the
base scenario and why it's awesome or
what's beautiful about it and what got
me excited so this is a very buzz water
heavy topic that definition is not up on
the website anymore but a couple month
ago if you went to the other function
website you would find something which
was this definition it's a server less
even driven blah blah blah either app
blah blah service platform blood Nano
service blah blah scale based on demand
blah blah blah so this is like in two
sentences you probably have the highest
possible density of buzzwords and if you
read this is like it's very unclear what
does this mean what is a nano service
what is this what is that
and so the if you take away the
buzzwords and you go to the numbers
world
version other functions are pretty
simple it's really a couple of things
like the first thing is like a function
is two parts one part is code so this is
going to be a script a stateless script
and what the function does is like when
it is triggered it runs the code and
then it goes to sleep and so that's the
first half and the second half is like
what is triggering the function and so
that would be an event and so really the
way it works is that you defined on one
side the event the trigger and whenever
the trigger happens it will fire your
code and then it forgets and so on and
so forth so that's pretty simple on the
other side the the resolution of a
function app so a function app is a
group of function so you can have like
not only one function alone but a couple
of functions which are together in an
app it is server less so I put it in a
quotation marks because the key of
course like server less is not server
less and somewhere somebody's running a
server the so the the reason this might
be a sensible way to call it is because
it's server less in the sense that you
don't care the server is there for you
you don't have to deal with provisioning
you don't have to deal with the
maintenance apart the server is there
but you don't have to worry about it so
that's how I read server less the second
side of several s is I can not only do
you have a server but that server that
service is going to handle also for you
things like scaling like if you have if
you have a trigger like maybe you have
many many triggers happening and so if
you did it yourself on your own server
you would have to deal with scaling up
or scaling down that's actually coming
out of the box for you so that's another
thing you don't need to deal with and
that's pretty convenient another thing
which is useful to know but server this
is a pricing model so if you have your
own server in your basement like in your
farm whatever like you're paying for the
server 24/7 if you buy a VM if it runs
if it doesn't run it doesn't really
matter you're going to pay for the whole
time the thing is up so in lots of cases
this is great because things are running
all the time but there are lots of cases
where your code is going to run only
occasionally and if it does like it's
kind of a sadist to have to pay like if
your code is running say every week you
do at any batch process it's a bit silly
to pay for a machine which is going to
be running very little and you pay for
the whole month so in the azure function
model you pay only for what you use what
this means is that you pay only where
your code is running and you pay based
on how long it runs and how much memory
you're consuming which is pretty nice
and it's also if you have been doing
things like as a web jobs before it's
kind of a repackaged version of other
web jobs it's just much nicer to use but
it's based on the same ideas so now that
they talked a bit about what the
function is is like let's actually write
a function and so I thought I thought
the best way to do that would be to show
you the experience like so I'm going to
do that and the example I'm going to
take is a very important example so we
are in Norway and always one of the
countries where you learn very quickly
that to be F is not a cheap thing to buy
and so coming from the US I'm a bit
concerned maybe that the how much would
I pay for my beer and so I would like to
be updated on a regular basis on the
exchange rate between the Crone and the
US dollar so then we try to build as I'm
going to build a function which every
five second is going to send me a peg on
slack because of course I meant slack
all the time and that way I will know
when is a good time to pay beers for
everybody and when I should just shut up
and wait for somebody else to pay for
the beers so the first thing if you want
to build that is like you would it's an
Asscher function so you would need to be
an edger so we need a subscription you
would go to the bottle and you would you
would hit plus and you would start to
create an app give it a name you have a
subscription all of these things you say
wait run so that's a pretty standard one
thing to note maybe is every function is
going to come also with a storage
account that's by default the reason
it's there is because also out of the
box you get things like logs like a
monitoring and so that has to go
somewhere and so the the storage account
will be there for you created as you
create a function app so now I do that
I hit create and at that point is I will
have something in the bottle which slips
along these lines so I would have like a
function which is running and now I can
spoil a function app which is ready to
run and now I can start writing some
code and so this is what we will look
under the
so what we do is along visions so let me
go and before going to the bottle I'm
actually going to go to Revere's code
and so the way I write typically a shop
code as I like extra products because
it's a very script friendly language so
when I write F sharp good I go to ABS
code and I start to hack our hack a bit
of code to see like what is it the
country to do and in essence like I make
what I'm trying to build here has two
parts one part is like I need to grab
some exchange rate from the internet and
so and the second part is that we need
to push the stack so the first part
about the exchange rate I dug a bit I'm
a cheap person so what are the free
service and I found out that Yahoo first
like Yahoo is still alive
that's the check and the second part is
a Yahoo as a service which is free and
you can ask things like what is the
exchange rate now between two between
two currencies I'm going to just run the
script so I would do something like this
let's take that we own a system but net
then I'm going to hack attack the pigs
I'm going to put a QR l that's a URL to
the service on Yahoo and if I take that
URL I create a web client and now is
there because I'm not very subtle and
I'm a hack mode I'm not going to do
anything at all I'm going to say take
this take that URL grab this down as a
string and show me the results and so
the result is going to be something
which is not particularly sexy but what
it is is like it's a big fat XML
document where I see what I'm getting is
the GBP actually GBP so I made a mistake
here but a GBP two dollars and you have
the current rate at what time it was
done and so on and so forth so that's
kind of done is like if I call that URL
and we get the latest exchange rate the
second part of the problem is I need to
to post to stack that's also not very
difficult the way we do it is a grab
that HTTP will grab my dependencies here
again I'm going to prove it all schools
I'm going to create an HTTP client and
here I pre provisions so I have my own
slack because I'd like to talk to myself
and also because I like to experiment
with the bots so I have this a provision
like a web hook so now the only thing I
need to do here is I simply take this so
take the
URL to my to my work and I will I'm a
hipster for San Francisco so I'm going
to do like a good old-fashioned
hand-carved message here which is going
to be text hello in DC so let's create
the JSON message by hand and I'm going
to post it and if I do that what I
should see now in my sectional is
something which is saying hello in DC so
my script works everything is fine and
now my problem at that point is how do I
this is nice but this is running on my
local machine I would like to make it
run in the cloud somewhere so that it's
actually an application so let's do that
so if I want to do that I could I'm
going to take it I have two parts in my
code one of them is like grabbing the
rate the other one is posting to stack
so I'm going to start with the second
part which is posting to stack I
mentioned that we have triggers or we
have things which are going to trigger
the so essentially I'm going to separate
this into two separate functions to do
these two pieces of functionality and
then I'm going to hook them together so
let's go to the bottle and in the bottle
here are already created like something
which is called function demos which is
where I write my function demos and I'm
going to add a function right now and
I'm going to call this so here you can
pick many things you can pick the
language you want to write your code in
so if you like that go ahead knock
yourself out if you want JavaScript of
course you can do this PHP like I'm sure
some people want to write PHP so this is
not what I want I'm going to pick C shop
is there but I want a shop so I'm going
to pick up shop and out of the box you
have a bunch of our triggers or
scenarios which are supported so I'm
going to pick one so you have triggers
which a timer HTTP all of these the one
I'm going to pick right now is a queue
trigger so if I pick a queue trigger
this is something which is going to be
triggered when a message comes in the
queue I'm going to give it a name so
let's call it like a NDC 2017 and if I
tell it like I want to trigger on a cue
I probably need to have a cue so I'm
going to give it a name and DC demo and
destroy Jam connection or is it not
happy of course this is the moment where
everything worked
before and now it's not working why is
it not showing me so this is like one of
the okay that's fine that's fine so this
is actually good so this is a that's
where your heads up on the pieces I
don't quite like is like I'm online and
things are like I don't want to work
that way I'm at the mercy of the
Internet and so that's one of the parts
which I don't really like about this but
let's forget the pot so now is like I
create my function so what I said is
like a function is triggered by a cube
it's I give it a give the cue name and
that's what I had to do and now is like
immediately what I get here is something
which looks like this so I get a
function which is called run which is
expecting two things that can input
message which is going to be what is it
that I'm putting from the queue and a
trace writer which is which is allowing
me to load and so what I can do
immediately I can do things like this I
can go here and I can say let's test if
this function works so I'm going to do
something like does this work I'm going
to send it to the queue as we're going
to go to the queue and now is that you
can see that the log is actually being
triggered and if I look here on the logs
it's telling me hey Q trigger has been
processed and it took the message that
this work and it's showing me like
waited pull from the queue so this is
very nice like I get like immediately
code the coding with reruns I can test
it and this is a this is making me happy
the this is also not completely magic
like you can actually look behind the
scenes and so what happened here is like
it created a folder that folder is
called NDC 2017 which is the name I give
to the function under the name a give to
the function two things came out of this
one of them is rendered fsx this is the
file I'm looking at right now which is a
straight standard F sub script and the
second part is a trigger
and so the trigger here I defined it
through the pothole this was nice but in
the end what it is it's a JSON file and
the JSON file contains the description
of what the function is about so here I
have bindings and the binding I have is
a cue trigger which is what I defined it
it expects a parameter which is going to
be an input message this is how it
connect
to this file here input message is a the
parameter is defined in a JSON file and
and here so it's in because it's coming
in the function and triggering it and
here is the name of the queue I wanted
to use and so the good news is that if I
want to work with this I can walk
through the UI or I can edit the JSON
file directly that would be completely
equivalent so so this is a this is in a
sense a function D so let me go back to
this voice again so we saw that there
was a log so the log is actually coming
from what I did here let's say I'm going
to break that code for a second I'm
going to do something the crew bar which
is not valid except code and I'm going
to save it and if I save this what I'm
going to see is that it's going my code
changed so what I see now is like
detected aha the code changed try to
recompile it and it's telling me that
the computation failed and it's even
telling me normally where it broke
that's it like 2.5 fubar blah blah that
doesn't exist so you get also so the the
default if I take my hack mode on it's
kind of nice I can write code save it if
it works I'm happy if it doesn't work I
get a decent error message and I can
keep I can keep going that way so this
is not logging is nice but this is not
really what I want what I want is I want
to take the code I had before and that
code was grab this and post this to
slack so let's do this and for the sake
of time I'm going to I'm going to take
the code I had right before here and so
if I want to make this work is like it's
really not going to be very difficult
like the two things I need is I'm going
to take that pot I'm going to copy paste
it because this is how we all write code
it's a true and tested design patterns
so let's do that
and the second part is like I don't want
to log I want to actually write to stack
so let's do that as well so I'm going to
go back to my code here and I'm going to
take all of this
and I'm going to also paste this into
here in that a bit and so I don't really
like the thing which is next years I
just took scrap which worked I copy
pasted it under D I would be happy if I
saved it and it compiled and so if if
the gods are with me it's going to tell
me that completion succeeded and so now
if I did something if I go back to test
and this that this still works actually
this is not going to take this because
right now the message I'm sending is
actually only absolute hot coding like
hello in DC so like I still need to
change something so first like let's
test this and if I do this I should see
again a message coming to my slack and
that's that message should still be
hello in DC and here we go so now is
like I connected that script but it's
running in the cloud I'm happy
everything's moving on so the last
change I need to do here I need to say I
don't want to write the hello in DC I
really want to put in the message I got
from the queue so I'm going to say let's
message or let content equals I'm going
to do it again like a bit old school
stick this gets to that and here instead
of hello in DC I'm simply going to
southern the content of the input
message and now I should be able to do
content here and so if if everything is
going fine
if I save it will build and if it build
at that point what I should get is
something which are you going to come
from the queues I mean this is still
work now let's test this and now I'm
hoping to see that they still work
popping up in my sectional Innes again
and sure enough it works so success I am
massively happy now I have my script
which is running in the cloud server
less and buzzword compliant this is
awesome
so the the second part of the problem is
that care now the second part we want is
we have a another piece of the script
and that script is supposed to call
Yahoo draw the string or grab an XML
file and I would ideally want to extract
the rate and all of this so this is not
very complicated I'm not going to do it
entirely by hand I wrote that piece
before and I will just show it to you
and show you a couple of the other
features you have because usually when I
write this life is like something goes
wrong in the middle of it so I figured
you look like I think I look like a
trustworthy person so like I hope that
you will trust me that I wrote it by
hand and that it would work but let's
groups let's go here and so the function
I wrote is the one which is here which
is NGC retrieve wait and so that
function I went a bit further than the
script I showed you before but in a
sense or a couple of things like that
function at that point I want something
which things the internet every five
seconds and that's something so you have
a trigger for that and that trigger is
called the timer and so if I look at the
way this function is structured
I would go to function to JSON because
this is where I see how my function
works or like how it's triggered and all
this and here I see two pieces one piece
is a binding here which is a timer
trigger and so time a trigger is going
to be based on time and here you have
something which looks like a corner
specification or cron job or however you
call this and this is saying like every
10 seconds I'm going to call the
internet I'm actually going to call it
every 5 seconds because why not and I
give it a name so that's the timer this
is fine and I have another piece here so
I am not restricted to just one binding
you can add as many as you want every
function needs a trigger because
something did you call the function but
besides that you can also call other
things you can maybe wants to read
something from a file or you might want
to write something to another resource
and so this is where you have the
direction things can be in or out and
here I have another binding which is an
out binding which is going to a queue
that queue I will call the content of
this thing a message and it will go to
the NDC queue which is the one I created
before so my hope here so it's a string
based and so here this is saying I will
find a queue called NDC queue and every
5 seconds I will do something and I will
probably write something to that queue
and so the hope
the other one will pick up from the same
queue and then right to set cool so
that's the that's the binding spot the
other thing so now let's look a bit at
the code here yes this is what I'm
hoping if it's not the two will not be
connected so we will see in a second
yeah that's right it's like there are
two parts so that's a good comment here
there are two parts here like one of
them is like how did I call the queue
and the other one is like where is that
you living like the queue is not
completely magic acted in the storage
account so I defined also in which
storage accounts should you be finding
this queue actually let me make that
work immediately just to make sure that
Scott's comment is not going to bite me
a bit later I'm going to check and this
is not the right storage account so I'm
going to put this on the right storage
account and I'm going to save this this
is the point thank you Scott you
received me from a shooting myself in
the foot and you CQC we are now doing
like a pair programming saving myself
from a from disaster so that's done and
now like yeah thank you so that's it so
now this is one of the issues as well so
this is string based or is like nothing
would prevent me from writing queues and
they might not talk to each other so
that's one place which is a problem I'm
going to hint at later like if you start
to have like many many many cubes with
many names at some point you make you
strike a bit over what is talking to it
so anyway so this one is ready to go the
now I'm going to go back to the retrieve
rate function which was here and so what
I still have is I still have a function
which is run which is now taking a timer
and I also have a parameter message
that's from the binding so this is the
message which is supposed to go out to
the queue and it's a by ref message and
we'll show you how to use that and what
the function does is like pretty much
what I did before I'm grabbing the URL
from Yahoo and then I'm creating I'm
doing a couple of things here and at the
end what I'm going to say is like the
message shove into it the string push
that into the queue and this is all I
have to do so the the couple of extra
things I did here is because I'm using
f-sharp is like I could pass the XML
file by hand this is not going to be
very fun so maybe I want to use
something like an external library like
a type
writer and the good news is that you
don't have to write all the code by hand
is like people who did functions and it
completely crazy they know that you
might want to use Averys and so the way
you do that is here besides the function
JSON file I have a project file called
project JSON and in project JSON I don't
think I need to explain much what this
does this is saying that this function
is expecting the Ted 4.6 and it takes a
dependency and X sub data which is the
name of the nougat package and this is
the version I'm going to be using and if
I do this I see if this it's going to
trigger nougat restore blah blah blah
and at that point I should be able to
use that library so the good news here
is that you can use whatever you want if
it's a new get you're happy if it's not
a nougat you can also do that and we're
not going to talk about it right now but
you can also upload the DLL you can do
whatever you want so you can consume
anything you want so now is like I have
this every available so I should be able
to use it here which is what I'm doing
so here I'm saying open up shop data LX
using a shop data it's here and I'm fine
and the the other part is that normally
when you use a tie provider usually
you're going to provide a sample to work
from it for instance what I might want
to do is like I might want to give it a
sample of XML which is representative of
the message I'm going to be consuming
and so this is what I did here I created
a sample file this is exactly how the
message is supposed to look like
now the typewriter will use this to
create to extract out the data from what
I'm getting from Yahoo so that's not
particularly interesting the reason I
want to show this is because now what I
did is I created a file I can create
many FS x files I could add files to
this folder and I'm able to consume them
directly from the script like this and
so here like this is exactly what I
would do locally on my machine I'm going
to say like hey in the source directory
which is where my file is right now
you're going to file call aside you you
are going to find a file called samples
of XML so it's pretty freeform like the
experience I get here is like extremely
close to what I have if I'm working on
my local machine and so now if I do this
so the hope if I didn't break anything
is like I'm going to run this by hand so
I think she's really think so let's run
this and if I run this I see that my
function started and what I'm getting
here is like a rate it's telling me that
right now maybe here is something times
0.1 1/7
so I got my rate straight from the from
Yahoo and if I run it again with a bit
of chance the rate will be different and
you will see that I'm not full of it and
yes the rate change so I'm actually
doing life calls right now from the
internet and getting the rates so this
is great and if everything actually
works fine the sort she let me put it
completely on right now my function is
disabled but I can go to manage and I
can put it back on so you have this
ability to like you can take offline
online your function at any time so now
I'm going to put it back on and able it
and so if I go here the cron job says
this should run every five seconds what
I should see first is like my log should
start to become much more active and I'm
hoping to see that equally made every
five seconds and if everything is going
fine
I should also start to see a bunch of so
these are the triples already made so
this is proving the point right now here
on track what I'm seeing here is like
two messages came in to my section
always so these were the two I created
by hand so what this is saying is like
now like the first function and you see
that this is the most an exciting slack
but you could probably get but now I
this is working right because now I'm
seeing a message pop up every five
seconds and slack the only reason this
is happening is because the the first
function we wrote is writing to stack
and the only way it could work is if the
first function is actually activated
every 5 so again pulling things and
sending it to the other one so we have
like now a fully connected application
which is completely polluting my slack
so what I'm going to do now is I'm going
to turn it off that's I'm going to go
back to manage and I'm going to say
disable this because this is annoying
good so let me recap a bit and let's see
what we did so yes I talked about like
so I talked about that part I talked
about treating if you showed you how if
you save it and break it yeah you can
look at the logs as well and I'm going
to look at that I did that I showed you
how yeah so recap is like the piece I
really like about this so first it works
so I'm I'm happy because oftentimes you
do a live demo depending on the internet
like many things can go wrong so nothing
went wrong so I'm this is a success so
the the recap here I hope this gave you
a bit of a sense
first of how a function might work and
what might be nice about it so a
function app was one or more functions
we did an app with two functions talking
to each other
we had code which was a script we just
dropped the script pretty much the way I
would write it locally we defined the
event and it worked
script in whatever you want for obvious
reasons being an f-sharp phonetic I
would write my scripts in F sharp but
like if you want to do the same thing in
verse you can do that the binding the
event is going to be defined in the JSON
file that you can do it to the Patil but
you can edit equally well the JSON file
which we did actually you can use nougat
to grab your dependencies and you can
use external storage and all this stuff
so why did I find this nice like for me
this was nice for two reasons so one of
the things I really enjoy about
scripting and scripting in a shop is
that I can start fleshing out very
rapidly how my domain and how my code
should be looking like and nothing beats
a script hacker bit see if it works
changes see if it works ship it the
problem is like shipping a script in
production is not very easy functions
gives me exactly that they give me the
ability to take that script and pretty
much wrap it in the end production and I
have an app which is running the other
piece which is nice is I care if you
write an application is like you think
maybe I want to queue maybe I want
storage I want all of these things and
it's not that difficult to provision the
queue but it's a bit of a hassle like I
need to I need to make sure the queue is
there and it will be install it all
these things like with the function the
only thing I need to do is I need to say
in the binding I'm going to be using a
queue this you should be called through
and it will create it for me and I can
just start using it so this is awesome
because I can write tiny bits of code
and I can just catch out my architecture
in a way which is as flexible as I can
sketch out my code in the script so this
is a this is what's for me very
liberating because I I could stop I
could stop flashing like entire
application just like that like this is
that so this is really nice the the
other thing which is nice is like I
didn't have to worry about the queues
and all that stuff I didn't have to
worry about the plumbing so all I'm
doing now is I'm focusing on delivering
value and writing code like all the
Annoying details about the server are
good so that's great if I want to cue a
habit if I want to deploy a habit so all
of that is taken care of
so as a result is
started to use functions a bit a bit
more a bit more a bit more and I started
to have a lot of functions the other
benefit is money
so like I'm doing I'm doing BOTS and
bots are great but like they're my
Twitter bots are not very active
typically on the successful month I'm
getting 20 tweets I used to run them on
a VM like that VM used to cost me like
twelve dollars a month it's not usually
expensive but it's close to $1 tweet
it's not cheap either so I like people
using my bots but it still may be a bit
more expensive that I'm willing to spend
for people so here what I'm getting with
the Nasher function is that by default
you get like 1 million requests per
month for free so for BOTS is like a
sincere Mayor Bill went from 12 bucks to
zero and this is going Assoc you going
to pay of the order of rec cents per
million execution so this is this is
also a very positive aspect of functions
so so far you might say like this is
great like functions look like the way
to go is like what is it that could not
be great about it like why is it that
your give you this talks like right now
you could just go rewrite your whole
applications in functions it's going to
be cheap it's going to be great and it's
not all great because so all I did right
now is like I like to hack it's fun but
really what I did is like a what I'm
doing is I'm writing on a server a
server I'm hacking like life codes
shipping it a quiz zero verification
that this is not awesome
like making life changes on the server
is still not an awesome habit and if you
keep going that way like many many
things will start to go wrong and I
probably don't need to spell it out
because it's kind of obvious but like
first is like the proper environment is
not great like it's good for an online
environment but we are in 2017 like you
have editors you have things like that
you're expecting things maybe like
intellisense and I don't get that online
so that's a bit frustrating the second
one is like okay I can change my code
see that it's broken but I don't really
have a good way like right now my
testing strategy is like write code
ships if it's crashing change it it
works but it would be nice to be able to
know that my code is broken before ship
is in production so I don't get that
with the environment either source
control where is
like teamwork is like what will happen
if I have 20 people starting to work on
this online editor like how am I going
to share code maybe but between multiple
functions so many many things are not
going to go well and if you keep going
that way and grow bigger functions
things yeah things are going to turn out
a bit ugly so this is a kind of the
point ahead I got into the point where
the where I had more functions I had
bigger functions and the things were
starting to become painful so so what I
want now is I want something else and
what I would really wanted at first I
don't want to work on the online editor
and I want with something which is local
and where I get like nice tools I would
like to be able to do some things like
testing that my code works locally
before shipping it so this is where I'm
going to go to part two how do you get
to something which is a bit same so
fortunately again the people the other
functions team are not crazy and they
they know that this is a problem and so
what they have been working on it's
something called the it was the agile
function CLI command line interactive
now known as the core tools and so this
is what I'm going to use next the its
installed the NPM you run NPM install
something something something and it
says in your machine and still better so
what I say might change in two weeks or
three weeks but it's going to be mostly
correct so another point here is that
why do I want to use the command line
I'm also going to use vs code and I'm
not going to use Visual Studio so you
might ask is like why is it that you
don't want to use Visual Studio
there is tooling for Visual Studio it is
pretty nice the reason I didn't want to
use it is visual studio in my experience
there's a lot of magic for you
and magic is great but I tend to think
of Visual Studio as how oh man it's like
it starts like a white wizard it does a
lot of good magic for you and like when
the wizard returns a big dog is actually
you have orcs everywhere in your server
and all of this so it's like what I
wanted like I want to use code because
in code there will be no magic involved
we know exactly what happens so we will
leave sorry man asalaam on the side but
if you like Visual Studio this works
very well there it's just not what I
want to do so let's do that and let's
start working from the command line
interactive and so now I'm going to go
to vs code
because this is what I say that we do
and I'm going to go to the terminal
because like a real developers like like
the terminal and I'm going to create a
function so the first thing I need to do
is I'm going to say like let's create
something like NGC demo let's do CB and
this demo and now is like I can start
using the command line and so you have
this instruction called funk and so I'm
going I have to show this because this
is one of the touches which is a detail
but I really like it like you start with
a magnificent ASCII art in color which
is say you have function is there and
func gives you like a bunch of a bunch
of comments which allow you to work with
functions locally so the first thing I'm
going to do is like I want to create a
function to do that
thank you I'm going to call it I'm going
to use f shop as a language I'm going to
I'm going to use as a trigger HTTP and
I'm going to name it I'm going to limit
HTTP because why not and so if I didn't
mess up is what I should see happen
right now is a pop up up up up things
happen and if I look now at the folder I
just created which has NGC demo I see
that first I have a bit of a host stuff
which happened and here in the folder
HTTP this created for me like the exact
scaffold I had on the Patil
except that is local so now is like I
can see that I have a function JSON the
function JSON file is telling me hey the
trigger is going to be HTTP or this
project agent tell me hey this is taking
dependency on this library and I have a
rounded Epis 6 file which is a giving
you like a scaffold for a basic HTTP
trigger and so what this does is like
take the message blah blah blah take it
look for something called name and
return hello
the names or nothing super exciting but
you can start from there so what can I
do with this well I can do something
like a func I can run it and if I run it
I'm going to call HTTP I'm going to pass
it arguments and the argument I'm going
to pass it is going to be empty for now
because I'm lazy and so if I do this now
locally what will happen is I keep you
tell me hey if you want to run this
locally I need something like a server
so this is where you notice that server
this and now it's doing this you can see
it's something to do a couple of things
like blah blah blah and and it didn't
found the function HTTP and that's
because
just because wet action this is odd try
again
so it isn't expected because it looks
like something is a finding something
but what did you say yeah so I'm killing
it right now but I cannot understanding
why it's because I do have a function I
distinctly have a function called HTTP
see this is a I was happy everything
worked so far but like I'm a bit
surprised at this result working so
let's try again
HTTP this is the definition of insanity
they are doing twice or three times the
same thing and hoping a different result
so this is working so far it's not fun
okay so okay so that's fine because not
being a bit of a cautious person like at
first technology but not entirely so
what I did is like normally I have like
this thing already pre written on the
side so I'm going to go to this other
folder so this one also has like the
same type of setup and I've run from 1
Hz please this is also normally you stop
the server I want to stop the server so
this is where you can see normally what
is happening on the server which is kind
of useful normally what I should see is
going to tell me like hello I'm having
hope hope here we go so let's say like
here you trust me because I'm a nice
person so I will ask you to ignore what
happened like normally when I create
this I should have gotten that
experience from the first one I don't
know what happened if I fix it we're
going to waste some time so let's ignore
that part for let's let's say it didn't
happen and this is what you should have
seen so what happened here is like I
created a scaffold for an HTTP request
DHCP request I'm trying to run my
function locally it creates a fake
server runs it and like I can start to
test locally my function so now if I
start to change the code here like for
instance if I did something so let's go
back to
yay so now I mean this guy and if I go
to the code here and I do something I do
something like instead of having say
hello in lower case I'm going to do
hello in upper case and I save it but I
should be able to do is I should be able
to do and to run this immediately and it
will do this job and I should be able to
iteratively see if yes or no like my
code is working into what I would see so
now I'm sensing like via the devil of
the feeling demo is started ok so this
works so I was expecting now everything
to crash because as usual I go so like
proving the point I change the code I
just run it and I see that method is
working so this is giving me a nice
experience now I'm on the vs code I can
iterate on my code I can run everything
locally I don't need an internet
connection and I mean I mean a full
development environment where I'm a
happy camper so this is why I like the
command line interactive now so I'm
going to go back for a second to the
scaffold I created and besides the fact
that it didn't work there is a bit of a
problem here
so if I go back to NGC demo and I go to
this file here I say that everything
worked and it's almost right the thing
which is good is like it works because
like I get I can work in my environment
and I can run my function the thing
which is not quite working is that if I
start going down a bit in my script
I'm going to see things that hey what is
the trace writer I don't know what the
type is hey what is the log I don't know
what it is I don't know where this is
coming from and so on one side is like I
got code which is going to run the same
way so there is a bit of a paradox here
because I got code which is the same as
the code which would run if I push it to
the azure portal it's working because
the command line interactive is
completely able to run that code so
which is saying like one side tells me
it's working the other side is like vs
code tells me it's not working I don't
know what all these things are so that's
weird right I have on one side I have
working code and the other one the
editor tells me I have broken code and
so this is where so functions are
framework e in that like when you give
it the code it's actually going to do
also a lot of magic in the background
like it's going to load those
dependencies for you and so that's
happening when you run it in the pothole
that's happening when you run it in the
comment line but now vs code or Visual
Studio doesn't know about any of these
dependencies I'm taking because this is
just code it doesn't know that it's a
function so how can I solve this it's
actually the good news is like if it's
running locally I know that these
dependencies have to be somewhere on my
machine right otherwise it could not
even run so I did a bit of a spell ology
or like Sherlock Sherlock Holmes work
and if you do a bit of digging you're
going to find something like this so
here I'm in a user like me materials I
go to updater and if you go to roaming
you're going to see a folder called NPM
so I mentioned in the beginning that
locally to install the NPM so if I go to
NPM and I start digging I'm going to see
something called other functions command
and all of this so this is a good hint
that this is probably where I want to
look and if I look at modules I'm going
to see Azra function corporals and if I
keep digging further and further in the
rabbit hole and we could look at
binarism here I will see all the magic
dependencies that the local thing is
using so the way I can solve this if you
want to write scripts in a way which is
convenient locally that the only thing
you need to do is Excel vs code tell
your environment that for all the
dependencies you should look into this
folder that's not very hard so this is
what I did here so this is on the other
one so this one is the one I run and
this one is entirely unbroken like this
is done in a bit of a hacky or dirty way
but the way I went about it was saying
like that simple if you're running in
the interactive mode then I knew I'm not
running into I'm not running into the
portal here I'm interactive if that is
the case you will look for all the
dependencies in this folder so that you
could do this nicer but essentially say
like all the dependencies are here load
them up and you're going to be fine
otherwise you know you're running not
interactive so you're probably running
into the pothole in that case they can
do it the way you would do it in the
patil and everything else is going to be
exactly the same as before so it's a bit
of a it's not a particularly small trick
but like this is it took me a bit of
time to find it and so this is the way
you can get full scripting experience
with intellisense
on your local machine
and start working with this and so now
this is nice because I pretty much
solved most of the problems I have
because at that point what I can do is I
don't need the portal to run things I
can start running things locally like
I'm going to create quickly a fake
logger so here I'm a equal to the output
so you know but I want to take first I'm
going to take all that script and when
you send it to the scripting environment
so this is done and I can say like
create a logger it's fine I'm going to
create a fake request and I'm going to
say like a quit that request send a
message and send and configure that
request create the log and now look at
the function I have in my script run I
can now run entirely locally I don't
need an infrastructure I'd say send the
request with the log grab-grab the
result wait for this and show me what
you got
and so let's do that and this doesn't
work because I probably didn't run it
right so I'm going to do it a bit better
I'm simply going to increment all of
this and run completing my script I'm
also going to flush my session and we
took on this so what I'm expecting here
like the run function is will be cool
locally it doesn't know anything about
functions or anything they say straight
code and I can run it and I can run it
but it fails so what is happening so
this is the moment where I would say it
works on my machine but obviously it
doesn't work on my machine
why did I break
enjoy your life good
okay so I'm not quite sure what I did
wrong before
so all this for this the but the the
result here is like essentially I
resolved like all the problems I was
after because now I have could I can
work with it with intellisense with all
the classic methods I want for the block
mode and I can run my function
completely locally without any
dependencies and so now I'm in a
workflow which is actually acceptable I
can start to write code and be happy
again
good so this was a bit rougher than what
I expected but please for that
so so the recap here is like the not all
hope is lost like you can actually if
you like scraps if you want to stick to
something which is close to the
out-of-the-box experience with the
functions you can do that
you can you can I like scripts because
they are lightweight they're flexible I
can still use that for development and
it's also what I did is extremely
similar to the original the only thing I
did was pointing to the right way the
right place for the dependencies the
drawbacks is like if interactive is a
bit hacky where this is relaying is like
I knew that in the scripting environment
I'm scripting and I know that outside of
that environment it's compiled so it's
not quite elegant and the other thing
which is not great is really like
scripts are great up to a limit like
it's difficult to write integration
tests on scripts it's difficult to a
difficult to share code all this thing
so but these are normal problems with
scripts so the question here is that if
you want to use scripts this is a way to
do it but you might not want to use
scripts because it will only bring you
that far so can we do something
different and so the or F scripts or the
problem maybe we can avoid scripts and
so the question is can we do this and
the answer is like yes we can and I had
to bring up the poster because this is a
memory of a better times me and so so
the idea here is if you take a bit of a
step back and you you look at what the
function does like in the end the
function doesn't care at all about your
code all it is at the end it boils down
to the bindings and the bindings are
saying like somewhere the risk code I
will give you these arguments I will run
your code and I will do something
it it doesn't it could be a script it
could be in whatever language you want
and so the idea of pre-compiled
functions is like instead of running a
script you could actually call a tiara
so I'm going to show you like how this
looks that first I'm going to clean it
up to close all of this
so this is where not see this and I'm
going to show you on something which is
a bit bigger so if I go to the
pre-compiled folder the first thing I
did here so I created two folders it's a
bit so the one thing I did here that I
created an old school library project
and so that library project is using
standard things that it's using packets
to manage dependencies and I have an FS
file which means that it's a compiled at
subscript a compiled sorry according to
a CSS file like this is regular code
I have only thing I did was I created a
namespace and here I created the module
and otherwise like everything else is
the code I had before like name run blah
blah blah so no changing the code all I
did was take the script and transform it
into a class and so now what I would
like to do is I would like to say I can
build that thing and we get to gll with
all the dependencies in a folder and if
I do this like what I would like I would
like the function to say instead of
calling run on an FS X file I would like
to say look at that DLL which is going
to be located in a specific place and
called that particular method in it and
as it turns out so this is not very
difficult so now on the function side
what I would have in the portal is
something which looks like this I have
my HTTP function like before and now you
might notice something which is I this
is restrict down to the various possible
function you could think of it like what
I have is like I don't have any physics
file I don't have anything I just have
binding and I have like a project Jason
for the dependencies I could actually
look it as well but and the bindings are
simply doing this I'm saying like the
code you're going to run is not a script
it's not this it's not that it is a DLL
that DLL you will found in this folder
so in that case I put it somewhere it's
ugly but like that should be a folder on
your function so you will find something
called pre compile the DLL and the entry
point is going to be
something which is Korff that's a
namespace who is my class or my module
and run is the function in question so
now is that if I'm lucky I would prove
even that it works so let's go to C CD
pre-compiled CD function and now it
should be able to do func run and I call
this again HTTP again going to pass it
like in my arguments and I should
probably have done something also so
yeah and if this works out is like a
what this should show you is like what I
did here is like I completely removed
the dependency in the script I'm back in
territory of all dll's
and I think it worked yes something came
back to me so now what I did is like I
called the code which I have in my DL so
this is good news on the F sharp side I
can do that you can also totally do that
on the C shopsite like just do your good
old project compile your dll and then
like move it to the function and you're
done this is also good news because if
you have this this is a regular project
so I can build it I can add unit tests I
can integration tests like all the
tooling you're used to works and this is
to the latest I heard like this is kind
of the direction the functions team is
advocating for development down the line
is like you should probably have a
project with all your code and just like
standard DLL and use pre compose
function for this good so go back here
so the benefit here haha the benefits
here are your back in a familiar
territory for tooling you know like if
this is a standard C sub project after
project you know what to do you have
full control on the dependencies because
now is like a you know dependent
dependent on a project JSON you can
actually explicitly say I want this DLL
the DLL so you're completely in control
there are also some performance benefits
if it's pre-compile is going to run a
tiny bit better than if you work from
the scripts the drawbacks is like the
setup is a bit more painful like I lost
the beauty of script so I can just hack
right to script in Chabot and the
deployment is taking more complicated
because now we need to compile I need to
move it to the right folder and the
function and to deploy that so you lose
the lightness of the scripts but you
gain a lot of on the tooling side so
pick your poison or choose like if
you're more of a hacker
enterprise developer like you can pick
which direction you want to go so so
these are like the two ways you can go
from a not very good formula say an okay
ish development experience on the portal
to something which is going to work
locally with the decent methods so now I
want to touch on a different question so
part of the reason I moved into these
questions was because I started writing
functions and I mentioned in the
beginning that I was doing about so the
bottom question is that usually
important but it's about which takes
input and Twitter and if you send it to
tweet it's going to take this as f shop
code it's going to run it to the
compiler and it's going to send you back
a tweet with the result of the
evaluation so entirely pointless very
fun project and this was this was great
so so this is how I started diving into
functions the reason this worked really
well is like I mentioned the fact that
it was cheaper than what I had before
the second reason is like it was a
perfect mapping for functions like I'm
doing three things I have one function
which is checking mentions that's a
timer which is going to look every two
minutes check on Twitter if somebody
talked about me if I have something take
this and it will queue and process this
using the compiler that's a second
function and then from that function if
it succeeded didn't succeed compose a
message and send back a twitch to the
person who called you in the first place
so that was my bot and I wrote this that
way and this was fine the the thing is
it started small and then it like I
started using other functionality like
one of the foxes I added was if you send
me a tweet because I'm a marketing
because that bot is a marketing genius
it wants to follow you so that you're
happy and so that it creates the
impression that this is an important bot
and so I start to add one function to
function three functions and functions
like if you don't pay attention very
quickly you have like maybe 20 functions
and so that project things start to be a
bit complicated because so let's see
what happens like on one side the thing
which is nice is like every function is
entirely self described it in it is it
it is in its own folder and so that's
cool the problem is you have a bit of a
strangely typed problem here which is a
which is the polymer hits in the
beginning with the cubes that care all
I'm saying is I'm saying I have a queue
called foo
bar and if I do a typo I might have
something which comprise every function
is working but none of the things are
working together and so how do you keep
track of this and if you start to have
something Biggers like is it possible to
get an overview of what this whole
application is doing together and so
this is where the point of declarative
infrastructure is coming in that the
good news is every function is isolated
but it's entirely declared it entirely
defines what it is expected to run
against like if I look at the function
jason at the function g in here I'm
seeing I don't even know what the code
is in the end I don't really care but if
I look at that I see that this thing is
going to be called IQ and that you
should be called friends and so if I
look at 20 functions and I see this one
it's like I'd better have somewhere a
function which is calling a Q called
friends and sending a message to it
otherwise I know things are disconnected
right like why would I have a Q and
nobody talking to that kid and so the
idea followed was a forget for a minute
about the the code if I have many
functions each of them in the folder
it's very easy to pass this can this and
start to produce a graph of what the
function is doing which i think is one
of the interesting aspect of functions
like the whole environment or the whole
architecture is very explicit and it's
entirely defined with the code itself
and so I'm going to show you like what I
built with this I wanted to make it into
a function but I didn't have time to do
it yet like I want to give you a
function to graph functions but the so
I'm going to demo this right now so this
is pulled from a github like the FS I
bought code so what I have is I have
four functions check mentions and check
mentions has a function JSON and you can
see that for instance this guy is is
using a timer it's using a blob it's
actually writing to a blob it's reading
to a blob it's talking to accuse talking
to another queue so I have this for this
function I have this across like four
different functions and what I would
want to they can you tell me something
interesting about the application
altogether and so I'm not going to dive
exactly in the code I wrote but the code
here is I will describe which is Paul
all these files and so if I run it if I
run that code let's do that so all I
will do here is like use a user script
look at the directory where have FSI bot
where I just cloned my application and
then it's like pass this and create a
document which is going to represent the
function and so if I do that this should
be now I should have now FSI but graph
somewhere here and this is not working
right because I'm not in the right
folder sorry about that
so if you run this again and I wish what
I should see pop is I should see it
created for me graph file so that file
is completely ugly but the reason like a
let me explain a bit what this does this
fight is looking at I've spotted like
four different functions I have nodes so
I'm grabbing out of these files that all
the triggers all the nodes all the
dependencies and putting them into a
file which is saying this goes to this
this goes to this and the reason I care
about it is because now I can use a tool
like graph this which is like a graph
visualization tool and I can run
something like that I can say take now
the file you just innovated by looking
at the code of the application and I can
go here and I can say run this so it's
going to do something and now what you
see like it took this only created a PNG
file and that PNG file so I'm going to
zoom in in a second but like what I
created here is like a diagram for my
whole application and think about this
like this is awesome I get an
application I just run a couple lines of
code and I can see exactly what it does
and how it does it here I have a timer
so let me zoom in what this is telling
me like this application has a timer
that timer is going to cool something
cool check mentions check mentions is
going to take a dependency and link to
Twitter and it's going to do four things
it's going to read unright to a blob and
it's going to send a message to that
queue and a message to that queue that
queue is actually going to trigger
another function which is going to be
follow the user and this is done so it's
a simple tool and what this gives you is
like a very quick gem gnosis and like is
my application broker like if I had a
mistyped
queue somewhere I would see a queue and
it goes nowhere so I get a full
visualization of the application in one
place
so so I like that good
so yeah demoed this so as a conclusion
is like first there are a couple of
topics I didn't touch on one of them was
integration test I couldn't quite get it
to run yet part of it is because the
command-line tools so it should be
working the latest version of the
command line tools but if you're in a
place where you can figure everything
from current line it should not be
difficult to a run like all the
functions together an integration test
so I didn't talk about this for that
reason one question which is on my mind
is like now I have function an
individual function I have function app
and I have per to see many function apps
together I don't know quite yet what's
the right division between these so
that's something I am looking at now I
don't have good advice on this and yeah
I'm going to pass it up so current
verdict and functions from from my side
what I hope I managed to convey in this
talk is like one is like functions are
extremely helpful in many scenarios
which are typical small script scenarios
things like I have a batch job I'm
running once a week if it's not too CPU
intensive if it's too big is like you
should relook at functions because it's
going to be dirt-cheap super easy to
deploy and it just works so that's great
so it's awesome for all the small
scenarios the piece where I still have
doubts is like at what point is it's too
big for its own good so I'm currently at
things with maybe ten functions I know a
person who wrote something with over 100
functions I'm not sure I would advise
that this is a place where I'm still
wondering about workflow and patterns I
showed you like the best I got so far um
one of the things which is found is like
functions make lots of things very easy
but some of these things which were very
easy before are completely open for
discussion like in a way like I spelled
like one hour telling you this is bad
because I cannot write tests normally
that the poly which has been solved like
20 years ago so this type of small
problems pop back up and it's kind of
interesting to see what workflow and
patterns emerge so I try to share what
I've found so far I found this like
amazingly fun to code with so this is
completely no technical it's purely
qualitative but I encourage you to look
at it because it's a there is something
nice about hacking a bit of code running
it's in what happens like it brings back
a it makes like a maybe it makes coding
a great again and the so advices like I
don't know how much you should use
it but I really really advise you to
take a look and it works particularly
beautifully with the shop and so this is
what I had so big thanks this is where
you can find me like most of the code I
showed is on github what is not there
yet we'll be there soon and this is what
I had so thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>