<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The Async Arrow - Troy Kershaw | Coder Coacher - Coaching Coders</title><meta content="The Async Arrow - Troy Kershaw - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The Async Arrow - Troy Kershaw</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GzKC4juJB48" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right well
everyone thanks for coming I have to be
perfectly honest with you
that preparing for this talk I was a
nervous wreck it was I mean coming here
in DC London it's a big deal and I
thought how am I going to do this a lot
of people were very considerate and
consoling a friend's family letting me
know you know it's going to be all right
you'll be fine just you just have to
break the ice
to tell a joke I'm not very funny and I
don't like a laugh so that's not going
to work so the the next best solution
was tell them a story engage with your
audience talk to them you know have some
sort of bond by you know relating
something I thought I could just work
tell the story so here we go
it's a story of The Very Hungry
Caterpillar now once upon a time there
was a creepy-looking son look at that
thing just gazing down those creepy eyes
gazing down on to a caterpillar that
happened to be incredibly hungry not
only hungry but quite an intelligent
caterpillar because it knew how to solve
this hunger problem we were going to
need food so that's what happened lots
of food was eaten those apples and pears
and this is good this went over five
days a lot of eating happened what
happened now on the last day of all this
eating's that you can see down here in
the same sitting one after the other ice
cream than a pickle now I've done this
let me tell you I'm not surprised what
happens next because it does definitely
100% result in a tummy ache now again
intelligent caterpillar knew what was
going on knew how to resolve this
problem went on a Dilys
felt a lot better now we don't have a
little caterpillar anymore and we don't
have a hungry caterpillar anymore we
have as the book tells us a big fat
caterpillar now the caterpillar through
some crazy means that I don't think
anyone understands turns into a cocoon
does anyone know how I gotta pull it
turns into a cocoon know anyone I did a
bit of research and what I came up with
was sorcery
it's just they end up in a cocoon and
that is fair enough now at the end of
the cocoon part the wood I don't
understand
emerges this lovely butterfly not only
is it beautiful but it also has
upside-down wings yeah the wrong way
around and that that is the key now the
part I want to focus on really is the
bit I don't understand the sorcery bit
which is somehow we have a caterpillar
and it's some form of function that
turns it into a cocoon of butterfly and
I have no idea why and we don't need to
know why right it's just it's just what
happens mother nature gives us now
Mother Nature has given us a function
called make butterfly and this this is
it so we have make butterfly takes a
caterpillar we get a cocoon butterfly
back and that really is what is key is
that we don't know we don't care we just
do it now it's not quite that simple
because I have seen out in the wild
ugly butterflies look at this thing it's
all gone you know sticky outfits white
wings where is the colour here it's
quite depressing for this poor butterfly
but there is we've seen that we've seen
the story that you can make a beautiful
butterfly so let's revisit what happened
and see if it's possible if we can work
out what the trick is so what happened
is there's a caterpillar so I kind of
fell there was food and so we feed a
caterpillar this happens and then
somehow it ends up in a cocoon now this
may look like my wife's handbag but I
assure you 100% that this is a
top-of-the-line cocoon so what happens
is the caterpillar goes inside I don't
know how we have a sorcery and there's
some wriggling around like this and lots
of crazy stuff goes on no one really
knows and it's really hard to do this
standing up and then out comes a
beautiful butterfly with the upside-down
wings right there we go that is how you
make a beautiful butterfly
what is the secret someone tell me why
did we not end up with one of those
boring white butterflies what I think it
is the food it's this particular
combination of food maybe not entirely I
think maybe this what happened here
somewhere is what caused the upside-down
wings but I can't can't be sure on that
but feeding our caterpillar results in a
beautiful butterfly now we have a great
responsibility here today now that we
know this secret we know how to make
them it's up to us to rid the world of
the ugly white butterfly
I take out a web ad explaining to people
I'm doing this for free I'm really quite
nice I have a web ad I say we're going
to we've got the solution to this we're
going to feed your caterpillar and then
I create a function and the function is
to create beautiful butterflies it takes
in food and then what it does with that
food is this vast amount of food as we
filter it out we get the right kind of
food out the stuff that we care about we
feed our caterpillar so a wrong button
feed Oh caterpillar then we make the
butterfly and what we end up with is a
function down the bottom here the the
definition is beaut butterfly takes a
food returns a cocoon of butterfly now
this is all good and I'm going okay for
a while but I start to get complaints
people are saying my butterfly is coming
out or weird is not working it's not
beautiful and so I need to get to the
bottom of this what can I do well the
first thing we thought was what makes a
beautiful butterflies our food so let's
look at logging the food so I throw this
in the middle here like alright whatever
food comes in log it first then I can
see like if someone complains did they
put the right food in did they give it
everything it needs am i doing something
wrong the complaint still come in so I
go what else could it be
maybe my butterfly is not in its cocoon
for long enough so let's log that log
our time in cocoon we are that's good we
can take care of that now that may be
perhaps sometimes you just end up with a
bad butterfly so let's if we get a bad
butterfly let's retry the process all
right
so we have our beautiful butterfly
function now but what's wrong with it
what have we done to it because we
wanted to log everything we filled it
full of this retry style log food load
timing cocoon we've made it incredibly
ugly incredibly hard to understand and
this is just the beginning right I think
the butterfly building business is you
know quite complicated and so we're only
going to add more and more things to it
more logging more error detection more
failure caching whatever it takes that's
what we're going to put in to have a
successful business but really the
problem is is that our food is up there
we do all this rubbish and then this is
here so really our core business stuff
is now intermixed with all of this other
application agnostic stuff that really
doesn't matter so what can we do to fix
that well one idea is we could pull that
out and have a different function and
then these other things we just call
that right I think that's a pretty good
refactor to begin with so let's look at
that here we are
I'll let butterfly service now it's what
we pretty much started with let's food
you take the food in filtered feed our
caterpillar make the butterfly and then
we have our beautiful butterfly here
pretty much the same as before but now
instead we just call this and so we've
got our logic there it's all pretty nice
and good except what we haven't done you
haven't reduced the complexity at all
we've got our our domain logic is all
out our business logic is all sorted but
what we haven't done is is reduce that
complexity is there any more thing is
there anything else we can do can we
refactor this further
yeah it is yes because otherwise it
would be a really short talk if we look
at the butterfly service there it's type
is food a function food that returns
cocoon of butterfly if we look at the
retry function it also takes a food and
returns essentially what comes out of
here long time.we cocoon which also
takes food and returns the butterfly
service that puts it in so really they
also return a food of cocoon butterfly
so we've got these three things of the
same types surely we can just compose
them all together so that's what we're
going to do the retry load time in
cocoon we're going to take care of we're
going to refactor to this so everything
up here is stayed the same our food to
log food has said stayed the same
pretty much but what we've done is we
pulled the log time in cocoon out and we
just end the retry and we're just
passing butterfly service as a function
into load time in cocoon and then into
retry now what we're not doing here is
we're not doing function composition
we're not saying all right take the
output of one function and that now goes
into the input of the next because it
wouldn't work we they don't line up like
that what we're doing is we're actually
passing the
tire function around so butterfly
service we just send that to a long time
you cocoon because it after something of
butterfly cocoon and the same with retry
at once sorry it once a food - butterfly
- sorry food - the cocoon of butterfly
and so we just pass that in and we
sorted it looks good it's a bit cleaner
the issue I have though is that we have
these ugly braces around and our log
food up here is in the wrong place what
if we could take it from here and move
it down to here then we end up just
being able to compose everything that
we're looking for everything that we're
doing that is application agnostic we're
just composing onto the butterfly
service however we have a bit of an
issue here a log food takes a food and
loves it that's all it really does right
it turns food so what we would need is
for it to also meet the function type of
food people couldn't butterfly so we
could change it around to do that but I
don't really want to I don't really want
to do that so what what if we could
somehow with another function make our
food log food function return this type
so what we're going to do is we're going
to build it I'm going to start here with
a blank slate and we know what we need
to get out it's here right at the bottom
we need a function that takes a food
returns a cocoon of butterfly what we
have is the beautiful butterfly service
we know we've got this it takes a hour
service here s also takes a food you can
butterfly so all we need to do is if we
want to our food here we just take a
food we log it and then we don't care
about the result all we need to do
who is somehow join these up to do this
now we have no control just as we had no
control over the mother native function
to build a butterfly we can't change
this this is written we have no way of
modifying this so how do we get access
to this food so it turns out that the
functions that are going to now use this
are going to call it they don't care
all they want is this they don't know
they don't need to know that they're not
actually getting this so all we need to
do is create a new function that returns
that takes the food in returns the logs
and then returns the original service
and so that's what we've got here we
just basically we have a new function
that starts over here with this food it
does its thing and then adjust our
passes that food in here and returns it
and we're sorted now what's fancy about
this is what I'm going to name it I
think this is I'm going to call it
before we've got this function here that
takes a food returns tuna butterfly and
what we've done is we've applied a
function to the input we're doing
something before we call the function
and when we use it it looks like this so
we had our our our food there like this
and we're changing it now to this we're
saying okay we've got our butterfly
service we've got we're not going to
change that that's already written what
we want to do though is before we run
we've got this fancy new function log
the food then we can continue with the
load time and the retry that we looked
at before now the trick here
is that we don't apply we don't put the
input into the function is that we're
passing the whole function now if we
apply an input we don't get the signs we
apply the input we then have no way of
calling before that's done
we've lost access to that so the reason
this works is because food to cocoon of
butterfly is what's called an arrow now
there's nothing that's all it is it's
just an arrow is a function that returns
this this time all it is is a pattern
alright so they are and the trick is
with the pattern is that that's all it
is it's not going to solve problems that
you can't solve now you still it's not
going to give you anything magical like
that but what it will give you is a new
way of approaching that problem solving
and a way of reducing the complexity and
removing what all the application
agnostic stuff in there all right so
what we're going to do now is we're
going to talk about what makes them
useful but first we'll we'll look at the
pattern so we've discussed how this this
works and it's an arrow and it takes the
food of Cocoon butterfly
now we can generalize this by taking by
what is is we take a to any function
that takes an a and returns a monad of B
now if you're not familiar with the
concept of a monad you really don't need
to you if someone tells you something is
a monad then that's all you need to know
or really it just needs to be anything
that resembles that the pattern of the
monad now some examples are a of the
option arrow here and we've taken a
return and option of B which is is the
similar if your're coming from C sharp
or some other language it could be
nullable of B that's going to work if
you're looking at error handling you
could have the result arrow now the most
important one in my opinion or at least
the most fun one is the async arrow
which funnily enough is what the talks
are now I'm going to just step in and
we're going to talk about the butterfly
service just a little more but and then
we're going to move on to async so what
I'm going to do is we thought it was
sorcery before turning a butterfly into
a caterpillar sorry the other way around
but I'm going to now turn it back so we
have this thing here and this is the
trick with using arrows is that what you
want to do is always never apply the
caterpillar so what did our caterpillar
to cocoon butterfly take or what was it
the made our server successful it was
the feeding right so what you don't want
to do and what I'm going to do here is
hopefully make it all awkward while I
stroke my caress my caterpillar and feed
it watermelon
see this this is everyone feel a bit
awkward now does this feel a bit wrong
the reason it feels wrong is because it
is wrong this is not what you want to do
you don't want to give your caterpillar
watermelon before it's it's time and
that is the trick the trick is with
arrows to keep that pattern is to never
apply the function right wait until
right at the end and then do it so
you're keeping it as a function the
whole way and that's how we get to this
beautiful composition here that we came
up with before now
you're probably sick of the whole
butterfly analogy by now is that is that
agree agreement there I think it is all
these love more butterflies okay I have
a feeling that someone's just trying to
make me feel better
all right so let's get rid of them what
if we took food and we renamed it why
don't we just rename all of these things
and get rid of the butterfly
let's take food away and call it events
let's rename two events
we're filtering food here let's rename
this to filtering the events we already
know food and events are the same thing
feed caterpillar maybe we could call
this update States that's what we're
doing right we're we're changing the
state of our caterpillar by giving up
food and then making the butterfly while
that's the end bit that's where we
commit what we're doing all right if we
go down to the bottom bit we've sorted
this one out and really now what our
butterfly service does is it takes
events in filters the ones that want
updates some state and commits it what
can we do with our hour a beautiful
butterfly thing down here well we could
change log food to log events we already
have made that transition with food log
timing cocoon what is that
what are we measuring when we love our
timing cocoon perhaps the latency so we
log the latency now it turns out that
retrying making butterflies and retrying
all of this event stuff it's the same so
we leave that where it is and what we
end up with is up the top I'm going to
name this our butterfly service really
is something that processes events and
what we've got down here runs our
service so what I'm going to do is let's
clean this up a little bit and we're
going to do all of that renaming and
this is what we've got
so we process events and then we weed
all of those things
what would same thing that we did with
the butterfly and then we run our
service now I work for a company called
jet comm in the US and we wearing
ecommerce and we have hundreds of things
in fact we have over ten hundred of them
which is another story but we could call
this this essentially is a service or
some people call the micro services but
really what we've got here and what we
aim for where when I'm dealing with this
sort of thing this processing of events
is to minimize it and write our service
as a function that's what we've got
we've got a scene other processes events
we've written out that's our that's our
business logic there what we do with an
event and how we handle it but down here
is where actually it does the servicing
bits and it's just a function now I'm
from Australia originally I've been
living in the u.s. to the last two years
and I tell you there's a few things I
really missed and it's great being here
because a lot of our culture is very
similar Australia too - with the Brits
now Cadbury is is really important
Cadbury if you're American and you
haven't had Cadbury chocolate here it's
so much better
it's really good but another thing I
miss
was Qi they don't have Qi they don't
they don't know who Stephen Fry is in
America and I miss that now I was I got
here I arrived here and some have to put
Qi on and I do and you wouldn't believe
it did you call it a coincidence but I
think it's fade one of the questions he
asked are what are the three things that
you need to write services as functions
I kid you not this happened and I didn't
know any of this I was I'm glad i tuned
in because now I can put it in my talk
and finally fill out that extra bit that
gap and it turns out that there are
there are three things and you know they
have all their banter and they get it
wrong but what it came down to was this
the three things that you need to write
your service as a function r1 futures
you need to make her to work well you
need to return data from the future
now depending on what language you come
from
you've probably got this handle which is
a big thumbs up in a tick we don't have
to worry about if you if you're in F
sharp you've got a sink you can use all
of the async operations in fearing C
sharp and there's lots of other
languages that I'm not familiar with but
I'm told they deal with asynchronous
operations as well so for the most part
I think it's a tick the only thing you
have to worry about here is you have to
remember is to use it so the first thing
is return data from the future now the
great thing about async is that allows
you to do a lot of concurrent stuff
right and so that's what we get to next
the second thing is you have to use
arrows that's what they came up with
them Qi fits so perfectly have to use
arrows and look at this one here
concurrent arrows right
so that's number two now we've spoken
about arrows you know a little bit about
them we're not going to just get rid of
we're not going to just move on from
arrows yet remember an arrow is just a
function that returns an async did the
third thing and we've spoken about these
a little bit what we're going to we're
going to give it a name and we're going
to delve into them a little more
the third thing are filters and as we
can see here from what I believe is
called Instagram
I've never installed it but you can
change your photos right you can apply
different things you can change what it
looks like without touching the original
and that is what a filter does and
that's what we're going to talk about so
let's go back a little bit let's go back
to our process events thing here this is
our our little micro service and let's
talk about what we've got here so this
process events takes events returns
let's call it you know our commits state
and async result
taeksoo takes events async result that's
an arrow we're good we're using async
tick that's the first number thing it's
an arrow because it's that async
function and so we're good here so here
we are we are doing what Stephen Fry
once we have our process events and it's
an async arrow now our run service what
are we doing here so we're using our
arrow and we're running before log
events so we're just changing things a
little bit we're doing something we're
doing our side effects here we're
logging our latency we're doing our
retry these down here are our filters so
we've got this separation here of our
arrow we've created this and then on top
of our arrow we've got all of our
filters now a key thing to remember
about filters
for them to really work is you have to
be able to compose them and we're going
to look at some examples now and so the
composition really here is we get the
arrow we pass that function into the
next thing and we pass that function
into the next filter and into the next
one and so on and so forth - absolutely
no limits until you are completely done
with what you want to do now sort of
fine and dandy if you are interested in
writing your services as functions which
is you know certainly something to think
about but it demonstrates the points but
you can you can use it for other things
so let's not limit ourselves to that
alright so what we're going to do now is
we're going to move away from our
micro-service path and we're going to
look at something that is possibly a
little more common something that makes
a request to HTTP request
so we have our make requesting here and
what we're going to do is we're going to
build a value called an arrow so make
requests so arrow actually ends up being
hey it takes a request returns an async
response I'm sure we've all seen this
whenever we call a some API some service
we call something we've got a request
and then we're promised this future
value which is our async response now I
don't know about you but in in these
responses it's always full of stuff I
don't understand like to hundreds and do
we actually don't really know what to do
with those things
so what I'm going to do is just get rid
of it what I want to do is turn this
asyncresponse return value to a string
just give me the content that's really
what I called you for you may not want
to do this but it simplifies what we're
trying to do here
so what we want to do is call our result
a response sorry to string we're going
to call we've got a function that grabs
that response and turns into a string
but we haven't got a response yet
because all we've got here is this
function so what can we do we need to
fill in this little bit we need to
create this filter that can do that for
us so I'll make request that's where all
of our logic is that does whatever it
needs to do we don't care about that
just like the mother nature function to
create a butterfly we know nothing of it
we don't need to and that's that's the
that's what's fun here so we want to
turn this response into a string so what
we're looking at is just changing the
the output there so we're going to look
at a function that can do that for us
okay so we start with our output I
always like to start with a what do I
need to get out of this and basically we
decided at the beginning we want to have
returned a function takes our request
returns an async of string and so that's
it here now what our input well we know
that - it's a request to a sink response
so it's that function and if we look at
it we put those things side-by-side it's
pretty clear what we need well we need a
function here that turns that response
into the string now this is on the
output and this is why using a think is
so great because we don't actually need
to run the async we can use bind or map
or something that can get inside that
that async and turn that response into a
string and so because of that we have a
function that I'm going to call map out
because what it does is it Maps the
output so we haven't run anything but we
can actually queue up this function - to
do
about change that change that response
so if we now use math out here all of a
sudden our arrow has that async string
all right
now another thing that I like to do is
application agnostic is add some form of
all token we're making this request and
we need to say hey I'm allowed to so if
we want to add our auth token to think
what what modification are we doing here
we we still want to return our request
async string so what function do we need
well it turns out that we've sort of
looked at this but we're going to change
it slightly because what we need to do
is modify our input value which is the
request so let's try and build this
function up as well so we know we want
exactly the same thing out we're not
going to change that but we have our
arrow that's our input we know this and
the diff what we're doing here is we
want to grab our request and modify it
add our token and then return that
request this is familiar I hope because
it looks the same as our before function
with the difference that it's actually
returning a request this time so we do
the same thing we can compose these
things together that's really nice and
what we end up doing is returning a
function that takes our request as a
adds that bearer token now with that new
request it pushes it into this function
so we haven't had to adjust what our
input value is we haven't had needed
access we just returned a new function
that shows those types that matches
those types so I'm going to call this
map in because it's mapping the input
and we throw that in there and while we
do get a essentially where we're
modifying the request we're making some
changes there but the
is still the same they still line up so
we have that map in satisfies that now
one of my favorite things I can do with
arrows is because we don't apply that
function we can do whatever we like with
the input and output and it's actually
possible to do things with the input and
the output at exactly the same time so
let's look at log input output so
basically what I want to do here is
right at the end I want to go all right
I'm I want to make record that this was
but you know before I call our make
requests we've got the we want to say
hey this is our input and this is our
was our output so how do we do that we
we know what our output is what we want
is still the request to a sink of string
we know what our input is it's still
exactly the same a request of a sink
string that's our make request there
that what we're doing here is again it's
pretty similar the way we create these
filters is very similar to they're all
very similar our approach
just as some slide to our variation so
it's similar again to our before
function where we take our request and
we log it the difference is our function
we want to take the string as well so we
want access to the request and access to
the string and again that's possible we
just have that take that function in and
it's no problems and the reason is again
we have that monad style pattern where
we can pull that string out write a map
or a bind that that will love that
string or apply that function so I'm
going to call this function after and so
if we we now look at what we've
accomplished we've got we've applied
after we've made some change to our
request and string but our calling types
they don't care sorry our calling
functions it's all
the same as long as it matches that type
they don't need to know what's going on
behind the scenes and I think this to me
is what I love most about using this
pattern is that I've got I can access
the input I can access the output I can
do things with it I can change the input
I can change the output I can and I can
access them with after that exactly the
same time so let's do a little bit of
revision and the reason we're going to
do a little bit of revision is because
it's time for the quiz portion of the of
the talk so Stephen Fry in Qi told us
sir inform me of the three things that
we need for to make arrows really work
and in this case is talking about
services as functions but it's really
applicable across everything can anyone
tell me what they are
okay this isn't the quiz bins but you
warm up your voice boxes for the next
bit so I'll tell you this bit return a
value from the future for async use
arrows use that pattern and use filters
so as a refresher our future is out
async our arrows are the asynchronous
functions that we're passing around and
our filters are the things that are a
plate application agnostic and can be
composed together so I'm going to give
you a few functions and this is where
you're going to then tell me what they
are are they a future an arrow or a
filter all right
so let's start out with something we've
seen before this is the how to make a
butterfly function which for everyone
who was upset and wanted more butterfly
references here they are
so make butterfly function takes a
caterpillar return to cocoon of
butterfly what is it
future arrow or filter arrow why is it
an arrow
let's first let's see yes it's an arrow
high-five
so it's an arrow you got it right but
why is it an arrow what's the
explanation it's because we match that
that definition that pattern where we
take a an input and we return a
something of output and that's what this
does it's done that's simple that's
simple
now here's another plug for my company
because then they say how did you talk
about chairs and I go I tell them all
about dead get Jeff calm return to a
sink of string what's this is it a
future an arrow or a filter it's a
future yeah it's a future it just
returns a sink that's it well again I'm
jumping ahead of it is it a future yes
yes it is Thank You doc brown there all
right so it's a future because it all it
does is return that a sink what if we
turned it to this get calm this is an
arrow yeah it is
high-five it is an arrow now it's the
same thing as before because if you're
new to F sharp this this might be maybe
less clear but what this is doing is
it's taking unit which is sort of our
nothing value and returns an async of
string so it still meets the are the the
something to a sink of something patent
and so it is indeed a narrow now you
might think is there any value to this
as an error and the answer is there's
tremendous value because this unit here
is a bit annoying it there's not really
anything great that we can do with it
normally we just pay parts in a unit and
we get this acing string back but with
arrows and filters we can change that we
can do whatever we want with it we've
got the power to modify that input and
make it more flexible and and do what we
want okay so the next one logs
success it takes something that is an a
to a sink of B and returns an A to a
sink of B future arrow or filter and he
saw filter yes it is a filter and the
reason it's a filter and this is sort of
the pattern to look for here is that it
takes what is essentially an arrow and
it returns an arrow so when you see that
pattern you can go oh hey I can apply
this to a narrower or you may look at
something and go oh I'm doing some
logging of success can I turn this into
a filter and and use this pattern and
compose everything together so it is
indeed a a filter now here's one for you
jump function takes a person and a
trampoline and returns an async of
accident is this a future an arrow or a
filter none it's a very wonderful
observation now I'm going to actually
call it a arrow and arrow
and the reason I am is because if we
were to partially apply this jump person
what we would end up with is a
trampoline or something to a sink of
something traveling to a think of of
accident and so I'm going to sort of say
it's an arrow because it leads into the
next thing of is this really useful
you're going to come across this all the
time where you go oh I've got these
three things that I want how do I make
it into like it's not an arrow because I
have to partially apply everything it's
annoying so there's some there's two
ways that I approach this one is this
way which may you know let's just get
this out of a way out of the way because
this is an arrow yeah and the reason
it's what we've done here is essentially
we've combined those two values so it's
a single input to our async of accident
so if you've got just a few things and
you want to pass it around and modify
that input then you know so one or two
maybe three you might want to consider
this just that turn that into into a
tuple and pass that around and that
becomes your arrow and that's a really
good option and I use this all the time
I have filters that work on on couples
so you can access the first and second
and map first map second and it's a and
it's it's lovely and it works really
well
however you may we've already seen an
example of the other option is that if
you especially if you've got more than
one value that you you want to pass
around this your input just put it in a
type we were using the request type in
the last example put it in a type it may
you know it may sort of change the way
that you approach code a little bit and
the way that you pass your data but you
get the huge benefits of arrows all
right now the next one this is the last
one so you're all relieved and you're
doing well you've passed
full marks allows you get this one I
guess filter bad words takes words of
string and a sink of string and then
returns a string of a sing string what's
this one it's a filter now I'm going to
call this a trick question
and the reason is that it's similar it
looks like a filter doesn't it and this
is this is one thing to look at but
because what we've got here going on
here is carrying we actually will really
struggle to compose it so remember I
throw this into to remember the two
things to make that make filters great
is that it's you're passing in that
function but also you need to compose
them so that you you can just write that
long list of stuff so you could easily
refactor this one too to be a filter all
right so I'm often asked by people about
debugging these things look crazy
there's all this composition can you
deal with them now in my experience once
I start to deal with async anyway I find
it incredibly it's nice to get the
complexity especially when you're
dealing with concurrency the complexity
of debugging increases so throwing a
breakpoint in in in visual studio or
your editor of choice and waiting for it
to hit and then making some sense of
what's going on while there's thirty
other things happening at the same time
is incredibly hard so what I tend to do
when I'm dealing with async is I have to
do a lot of logging or I have to I have
to write trace logs and and really look
at what's uh what's going on with the
the output of that stuff so my answer is
pacing is already really hard so we're
not making it any harder not on that
aspect what we do have though are
filters and in my opinion the filters
and being able to add filters at any
point
of the flow is incredibly useful for
debugging after every change you make
every filter you apply log the input in
the output log what's changed while
you're figuring out what's going on you
have easy control on what happens
without having to have to part your code
and the core part of your code and
potentially introducing bugs there as
you as you're adjusting things or you
end up in a state of so many log
statements that you can never return so
we lose that from when we start using
arrows and we we start to apply filters
and debugging actually has a lot of
power down all right so if you're
interested in learning a little more by
all means come and talk to me there's a
few things that I use this as
inspiration for this so you might be
interested to check it out one is by
someone from Twitter and it's called
your servers to function now in this
they talked about futures services and
filters and it's pretty much what we've
spoken about but we've renamed services
as arrows so it's the same thing and in
this they talk about a project that they
use a Twitter called of finagle and this
essentially allows you to to do that to
write those services as functions so
that's a that's interesting another few
things is how we get the where the arrow
concept comes from and and where I've
read is essentially this John Hughes has
has two great papers generalizing monas
the arrows and then programming with
arrows is really good but let's not
forget the greatest inspiration for this
talk which is the Very Hungry
Caterpillar
so this
is an arrow it's simply just the
function takes an hour value returns an
async of of something and just remember
that what makes this great is that you
keep it together don't feed the
caterpillar watermelon at until right at
the end then apply that function that
way if you pass it around you can apply
all these filters so and then the three
things that you need to remember to be
successful here is futures use the
future and async
use the arrows there's asynchronous
functions and then apply filters thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>