<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Real-time Twitter analysis with Reactive Extensions - Niall Connaughton | Coder Coacher - Coaching Coders</title><meta content="Real-time Twitter analysis with Reactive Extensions - Niall Connaughton - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Real-time Twitter analysis with Reactive Extensions - Niall Connaughton</b></h2><h5 class="post__date">2016-10-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Igr2FUrFcZg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in our recent federal election here in
Australia we had over 120 million views
of odds votes on polling day alone on
Twitter and that's actually pretty
impressive when you consider that six
per person in the country and at the
same time we had over 29,000 mentions of
democracy sausage during the day and
quite possibly a lot of them to do with
Bill demonstrating how not to eat one so
really is it all just noise on social
media or is there actually some kind of
valuable useful information we can dig
out it there and assuming there is what
kind of tools and techniques can we use
as developers to do that to to extract
something valuable out of that well I
think Twitter is actually a really
interesting social network for me
because it's a really it's a genuinely
real time and live network where people
are discussing the issues of the moment
and it's it's it's really in the moment
it's got a real pulse of what's going on
and that's actually something we saw
with turkey recently with the coup where
Twitter was leading all the news
networks by half an hour an hour and
that's a lot of time when someone's
taking over your country and it's
streaming API from a developer point of
view is actually really cool and it's
really good match for our X so why get a
room full of people together and talk
about politics at a developer conference
I think you'd have to say 2016's quite a
big year for politics and there's a lot
going on as I mentioned we've just had
our federal election and after a week of
that the result was so close but that's
the only guy in the whole country who
knew who'd won and meanwhile the UK's
voted to break up with the EU and the US
has got this show kicking off so there's
a lot going on this year it's a bit of
an unusual year but really for this talk
it boils down to a really good example
for our X to some really great data to
work with to show off what you can do
with our X so what data do we actually
have to play with we've got recorded
tweet streams taken during episodes of
the abcs Q&amp;amp;A show as well as the recent
democratic national convention speech is
just a couple of weeks ago in the US and
these tweed streams are being replayed
in real time so all the code that we see
thinks this this stuff is happening
right now and it gives us something more
interesting to look at than just looking
at whatever is going on Twitter right
now so we're going to see some
techniques to work with this data but
these techniques are not just useful for
politics or Twitter you can use them to
work on any real time data that you've
got flowing through your systems so for
anyone who's not already familiar with
RX it's a functional style of framework
where you you build up transformations
on your data with chained operators and
it's really grateful working with
real-time data and that's something I've
really enjoyed using it with its it's
originally from net and Microsoft but
today we're going to look at our xjs and
that's one of the most probably the most
active community for RX at the moment
and it's all there all also available
for java a whole lot of other platforms
as well as i said if you haven't used RX
it does have a bit of a steep learning
curve and if you have used it you've
probably gone through that or are going
through that but if you're a functional
programmer or if you've used link a lot
with c sharp there's a lot in common
there even if you've just done a lot of
acing programming with java script front
or back end there will be some angle of
familiarity for you to come at it with
and that's really valuable but certainly
I found starting with it I loved link
but it still took an extra big leap to
get my head into RX and it's something
that takes quite a long time to really
sort of change your way of thinking so
all the code we're going to see today is
up on github so you can download the
code and the sample data is with it so
you can actually replay everything we're
seeing and you're going do your own work
on it there's a link to that at the end
of the talk and we should have some time
at the end for questions as well just
quickly on QA for anyone who doesn't
know it it's a panel show on Australia's
a nation
broadcaster the ABC where you get where
we get politicians often senior
ministers or even prime ministers on to
answer questions from the audience and
they broadcast so that life but what
they've really done well is get a big
Twitter engagement with the show so
there's a lot of people sitting at home
tweeting often in rage or total
agreement but there's a lot of
engagement with the audience and what's
going on and that plays out and they put
the Twitter information on the screen
and broadcast that out so there's real
two-way engagement there and that makes
it interesting to look at with our X in
particular we've got a couple of
episodes to look at which are when just
before our election we had Malcolm
Turnbull and Bill Shorten come on to
sort of make that case for why they
should be Prime Minister and they faced
questions from the audience and they
were there as a solo guest so it's
interesting to compare and contrast how
those two episodes played out especially
now we know who won so what are we going
to see as we go along we're going to
have a look at measurements of how
active the conversation is over time and
then we're going to look at getting a
feel for what people are actually
talking about at any given moment and
from there we're going to start building
on top of this and see so we know how
active the stream is we'd like to know
when it Peaks what are the moments when
for some reason it jumps from that point
we want to know why did it jump what
what were the major topics that really
drove that spike in traffic so let's get
started with the first piece that we're
going to look at here which is getting a
basic feeling for level of activity in
the stream so if we start with a stream
of tweets that we're taking either from
the Twitter API or in this particular
case from a replay of the Twitter stream
and these tweets are arriving randomly
over time what we'd like to know is how
active is that stream at any given
moment so how many tweets per minute are
we seeing arrive to us on that street so
really what we'd like to be able to do
is generate something like this in real
time in front of our eyes as it plays
out so if you were actually running this
on an episode
QA you could see this happening in front
of your eyes so how are we going to go
about doing this now if you haven't seen
a marble diagram for this is a really
basic version of one and it's used to
represent a series of events arriving
over time and therefore you can build on
that to show how you're transforming the
data from one type of stream to another
type of stream and when the events
happen so this represents our stream of
tweets and each one of these is a tweet
happening at some point in time and it's
coming to us and we want to take that
tweet stream and extract some kind of
concept of how many tweets per minute
we're seeing so really to be able to
achieve that we kind of want to look at
windows of time of one minute in length
and then take each take a list all the
tweets that arrive during that one
minute windowing and count them up and
so what we're really doing here is is
taking this stream of tweets and
transforming it into a stream of tweets
per minute values so what we've got at
the bottom here is a stream that's going
to push us one value every minute
telling us how many tweets per minute
we're seeing right at that moment in
time so how can we use our X to do this
so we're going to start with our source
stream and in our X terminology this is
an observable so if you're doing it in
c-sharp done that you're going to see
the word observable everywhere if you're
doing a JavaScript you might not see it
at all and that's not really a bad thing
because I think it's actually easier to
talk about as a stream that is to talk
about it as an observable but that's our
source stream and we want to take these
one minute windows of time out of that
sauce stream and RX has our xjs has this
operator window with time so we just say
to our excess I want one minute windows
on this stream and then from each of
those windows we're just going to
extract the count of tweets we see and
that's that's all there is to taking a
stream of tweets and generating a stream
of tweets per minute values
you can we'll get to that amount so this
approach is is quite simple and really
the codes quite clean but it's not
perfect in terms of the data it gives us
there's a few shortcomings so we're only
getting one point of data per minute
here and if you're looking at a cure yo
Q&amp;amp;A episode that's 60 is a it's a one
hour show you only got 60 points of data
it's not really a lot of data and if you
if you sort of we're looking for spikes
in that data you're going to have you
know maybe a minutes delay before you
notice that the spikes happened so you
might go from 500 tweets a minute to 800
tweets per minute in consecutive values
and we know that that hasn't happen
instantaneously but we don't have any
data points in the middle so we don't
get to see that ramp up so really it's a
very coarse level of detail and if you
plot that out on a graph like we want to
going to get a very sort of rough edge
graph so really this this one minute we
know is actually kind of working against
us here because it's reducing the number
of data points for getting so why don't
we just shorten the windows down to five
seconds or something then we're going to
get a lot more data points and so
obviously we're not what not gonna have
to wait very long before we see any
spikes come in but we're actually
getting more data but not actually
better data in fact we're getting worse
data if you're taking only five seconds
of time and trying to expand that out to
a tweets per minute value it's kind of
like trying to take your pulse if you
only count to two heartbeats and work
out what your heartbeat per minute rate
is you don't actually get a very good
quality number there and if you do that
consecutively you're just going to get a
heartbeat rate that's going like this
and doesn't mend your heart beats
actually going like this it's just your
measurements not very appropriate your
sampling theory it's not very
appropriate so we've got lots of data
but it's not very good quality so that's
not a good solution either so really we
want to keep our windows at one minute
long we just want more of them so how
can we do that what if we had one minute
windows but we started a new window
every 30 seconds
so now what we're going to have is
rolling windows or overlapping windows
let's take a bit of a closer look at
what that really is going to look like
so each window is still a full minute
long but the next window starts before
the previous one finishes and so you're
actually getting these some of these
suites are shared by both windows and
that's that's sort of common to every
window as it comes in and so what we're
getting is instead of a point of data
every one minute we get a point of data
every 30 seconds so we're getting these
new points of data in the middle of all
those measurements we previously had so
we've increased our resolution on our
stream here but we haven't sacrificed
our data quality by shortening the
window so this is the code we had
previously how do we take this and turn
it into overlapping windows where we're
starting a window every 30 seconds well
like that so our X does it has a lot of
these kind of high-level concepts and
makes your life easy to do these kind of
things so now we've got one minute
windows starting every 30 seconds
overlapping streams or rolling windows
so let's look at all this code just
together in one point just to make it
clear is really not a lot to it we take
our source stream that could be either
coming from Twitter API or wherever
you're getting your tweets from you
window them up enter one minute windows
sliding every 30 seconds and you extract
the count from each window the last
thing you have to do is actually
subscribe to it and do something with
the values as they come in so every time
there's a new tweets per minute value
that comes out of our stream it gets
pushed to us and subscribe and we go do
something useful with it like putting on
the graph so these overlapping or
rolling windows are really powerful and
it's it's not necessary to keep it at
every 30 seconds we can ramp it up and
do every five seconds and that's what
I've actually done for the graph we're
about to see and it's it's a technique
used to sort of smooth out moving data
and reduce noise out of a signal and
sort of make it less variable less
volatile
and it sort of i think in finance
circles and statistics and someone is
known as a moving average where you're
sampling a signal over time and each
successive example has a lot in common
with the previous sample so let's have a
look at what we can actually generate
that out of that in in real time so this
is a little dash board i mopped up
that's using this replayed stream of
tweets so we've got to to these two
episodes of QA and every every tweed
that was sent with the corn the hashtag
during those episodes to replay as if
they're happening in real time but
thankfully because we re playing them it
doesn't have to be in real time in fact
it can be at five hundred times real
time which means we don't have to sit
here for an hour and watches play out
which is always a benefit when you're
talking about politics so this is when
Malcolm Turnbull came on to QA and the
first thing you can see right here at
the beginning is a really quick ramp up
and that's we're just when the ABC
starts broadcasting live so I think
that's that's interesting of itself
because you can see just how quickly
people engage with it the it's not a
gradual thing that when the when the
show starts there on Twitter and I think
that shows that power of Twitter and
reacting to real-time events and really
showing what's going on but from that
point on it sort of settles between five
and six hundred tweets per minute but
you can see it's it's in no way constant
or normal all the time it doesn't sit
there at a regular rate there's lots of
little small pigs and quite a few larger
peaks and troughs through there as well
so that's not random noise that's people
reacting to a topic that they're seeing
being discussed and engaging because
they have something to say about it
maybe it's really important to them or
maybe Malkin terminals just said
something incredibly stupid so this is
how it played out for Malcolm Turnbull
and that's sort of picking up towards
800 tweets per minute that we saw so if
we have a look at Bill shorten's episode
by comparison
you can see that hey there's a bit of a
slower ramp up in the beginning but he
never gets me at 800 tweets per minute
now there's any number of reasons that
could be the case of it might have even
actually been a public holiday on the
day he was talking but for a person
who's running for prime minister in a
couple of weeks you want people
listening in you want them engaging and
they're engaging less with him than they
were worth with Malcolm Turnbull so if I
was Bill Shorten and I could see these
numbers in front of my face he actually
went first but if it was in the other
order you could see this you'd be like I
need to do something to improve this
conversation here because I'm not
getting through so that's just a sort of
little glimpse into even just a basic
tweet rate can be quite valuable to get
a feel for and when you compare it to
other things to get a feel for what's
going on
so we've seen a way of getting a gauge
on the level of activity that we're
seeing and there's all kinds of other
measurements you could do like how many
active users we've gotten that kind of
thing that are not too hard to do either
but we'll move on now and look at what
people are actually talking about and
this takes a bit more work to generate
so this takes a few steps to take our
stream of tweets and turn it into
something that's useful for working out
what people are talking about in a given
moment the first step we need to do is
take it take this stream of tweets and
extract all the words out of it so we
can actually have a stream of woods and
then once we've got that stream of words
we need to take these through all these
words and count up the number of times
we're seeing the same words so we can
work out which ones are the most
frequent that we're seeing so what we're
really trying to get a feel of is a is
well I must discuss topics and that's
kind of a Twitter trending topics kind
of thing sorry I think the slides have
got a bit of water so we're trying to
generate a histogram that looks like
this but in real time we don't want a
retrospective histogram at the end of an
episode we're going to know what's
what's happening right now because
that's going to change in a few minutes
and then we can sort of see the
difference between now and later and it
turns out if you want to know what are
the most common words that people are
tweeting about you don't need RX you
don't need any kind of software because
that's them right there and they're all
useless so we're going to filter them
all out so this is quite a bit of sort
of data cleaning and text manipulation
it goes into making something like this
work well and I've done a you know an
amount of it it's not perfect by any
means so how are we going to to take out
our stream of tweets and extract the
words out of it we want to take each
tweet as it arrives well these really
mess up so we'll take our stream of
tweets and turn it into stream of words
and we might be getting a stream of 700
tweets per minute and once we take out
the words that we might end up with
ten thousand words per minute so there's
going to be a really active stream but
Eric's will cope with that pretty much
fun so as each tweet comes in we want to
take all the all the words out of that
tweet and then filter out the useless
ones so we end up with just a stream of
useful words so how are we going to do
that with our X we take each each tweet
as it arrives and it's basically a
string split and you can do this you
know the better you do this the better
it works you can split on spaces and
then you'll get full stops messing uthi
and so on for this punctuation and
spaces and you know you can use a regex
to do it but ultimately it's a string
operation then we can use the filter
operator which is in RX and use some
kind of is valid method to say whether i
like this word or not if it's the word
that i'm going to dump it and so you can
have a big set of words that you're just
going to filter out and that's for this
source data here I've done a lot of that
in terms of where Malcolm Turnbull's on
QA there's no point in seeing how much
people in mentioning malcolm turnbull
because it's going to be very often so
you filter out his name and so on and
you can see other topics that are
interesting the other thing to note
there is that it's actually it's quite a
good approach to take this check and
pull it into a method because it can
keep your code smaller and simpler but
also by putting a name on it makes it
easier for the next available to come
along and see what you're actually doing
here and that's not just an RX concept
as a functional concept oral you have a
link concept or just a programming
concept but it makes a big difference
with RX so in two lines of code we've
managed to take our stream of tweets and
turn it into stream of words and it's
literally just these two operators were
chaining together and that's what we
need for our next step which is
generating that histogram or counting up
all these words so we've got a stream of
words we need to generate our histogram
a graphical representation of these word
counts and so what we're going to sort
of define our current period of time is
saved the most recent five minutes so we
want to know what people are talking
about now and will say that's in the
last five minutes so we're going to use
five minute windows instead of one
minute windows
on this stream of tweet words and then
from each of those windows we need to
somehow take all the words that are
coming in and build up a state of how
many times we've seen each of these
unique words so we need some kind of
data structure to hold that and we're
just going to use a hash map so the key
in the map will be each unique word and
the value will be how many times have
seen it so we want to have a stream
which pushes these hash map values just
at the end of each 5-minute window so
that we can then have account every five
minutes of what's what people are
currently talking about and just as we
do with tweets per minute we could take
these values every five minutes but it's
much better if we have rolling windows
over time because then we can see
transitions from one topic to the next
much more smoothly so how are we going
to do this in our X well the best
approach with RX when the problem looks
quite large is to break it down into
small piece because then you can change
something else on the end of it and make
it larger so we're going to start with
just one window and work out how to
count that window up and we need to
start with some kind of intermediate
state that we're going to consistently
mutate or update as something as a new
word comes in and we can update our
accounts so that intermediate state is a
hashmap and then as each word arrives on
the stream we're just updating our
account here you can see when we get
this second word with this word for the
second time we don't add it again to the
hashmap we just incremented our count
and so as each of the words arrive we
keep building up the state until we
finally get to the end of the window and
that intermediate state value becomes
the final value and the single result
that we want to come out of that window
so how can we do that with our X so
we're starting with our window of all
the words that we're seeing so this is
what to come out of our window with time
and we're going to take all of those
words and reduce them down to just one
single value so if you're a functional
programmer you're probably quite
familiar with this reduced concept and
it's available in RX and that's exactly
what it does it takes this stream and
reduces it down to a
single value so we're not going to get a
value out of this stream until it
finishes but because it's a five-minute
window it will finish in five minutes
but what we have to give to reduce just
as any other place you'd user reduce is
some way of taking each successive value
and the current intermediate state and
building up that new version of the
intermediate state so we just want to
take a hashmap and increment the number
of times we've seen the words come in so
that's pretty simple but you might be
looking at that and think well that's
not actually going to work because the
first time we see a word and come
through it's not going to be in the hash
map so you can't increment what's not
already there you're going to get an
error out of that so what we actually
need to do is check is it already in the
hash map and if it is then we can
increment it if it's not we added to the
hash map and just like we did before
that's going to be much better if we put
that in a method instead of putting that
in a big in line piece of code and then
even better because lambda arguments and
the function function arguments are
exactly the same we can collapse the
whole thing down and just reference that
method directly and now our code is much
more speaking about what it does not how
it's doing it and we're getting sort of
shorter and easier to read code so the
last thing we need to make this reduce
work is the hash map where where is it
coming from we're building up this hash
map but it's never been created but we
have to pass it in as the the initial
state to reduce so this is where we
start from and we're just using a
JavaScript object to act as a hashmap
here and that's what's going to get past
back to us each successive word and we
can keep updating that hash map and roll
forward so that's all there is to
reducing a window down to how many times
we've seen each word come in how do we
take that and apply it to the whole
stream of windows well this is very
similar to what we did with tweets per
minute we start with the code to handle
one window and we just use flat map
across the whole stream of windows and
that's it
so that's quite a bit to take in but
let's see what it actually produces so
again we'll have a look at Malcolm's a
QA appearance I'm obviously here is the
topics fly by quite you know they're too
fast to look at but that's because
they're being replayed like 300 times
speed but you can see topics coming in
like Medicare and the small business
cuts tax cuts that they were making the
gay marriage plebiscite got quite a lot
of views and as with Malcolm always on
QA he never escapes the NBN and that's
probably quite relevant to how many how
much we've been all complaining about
the Wi-Fi here but all the topics fly by
and you even get quite a bit of mention
of Tony Jones and if you don't watch Q
and a Tony Jones is the host and he's
his job there is to keep people in line
and keep the politicians actually
answering questions which they don't
always like to do so occasionally he
gets up there as well and you even get
people telling him he's waffling which I
quite like but also if i can find my
mouse when you look at how Bill Shorten
went it's a little bit of a different
picture there's still talk about the gay
marriage plebiscite and the small
business tax cuts but there's quite a
bit more talk about Tony Jones through
the episode he's got negative gearing
but Tony Jones gets right up there at
the top quite a bit that's probably not
awesome if you Bill Shorten and we'll
have a bit of a dig at that later as
well if you're if you're on Q&amp;amp;A to get
your message across about why you want
to be elected your message has got
nothing to do with Tony Jones so another
interesting angle that you can get out
of this is you can plot the frequency of
these words over time so this is a
screenshot you can generate this in real
time it didn't work so well for the demo
I sort of ran out of time but this is
taken from Hillary Clinton's speech
their democratic national convention
just recently and her speech is an hour
long and there's a whole lot of topics
that go through and
whole lot of response to those topics on
Twitter but the the success of those
responses is really very these as bees
points4 by far the biggest ones that got
picked up at a time the first point here
is when she says about Donald Trump
don't trust somebody who says I alone
can fix it we have to fix it we have to
all fix it together and she talks about
that for a bit and the audience really
picks up on this this word fixin and
that topic really gets across and people
are really engaging with it next thing
that really picks up is when she says I
believe in in science and she's talking
about climate change and trying to
differentiate herself from Donald Trump
who's being a bit of a climate that had
changed skeptic we could say and again
that's she's speaking to her to her
crowd right but again that's really
being picked up by by our audience the
last one during her speech is when she
has a real gig at poor old Donald and
says don't trust them we can't trust
somebody who can be baited with a tweet
to have control of nuclear weapons and
again you can really see at that point
his home but what I actually thought was
interesting he was this last one which
wasn't during her speech and it wasn't
something she said this is actually
after she finished President Obama made
one single tweet and he said she's
something along the lines of she's great
she's tested she's ready and she never
quits and that tweet just pumped out
there people people really jumped on
that and it's just one single tweet and
it's had pretty much as much as much
impact on Twitter as the other major
points from her talks from her whole
speech did so it's really interesting to
see the the value and you could imagine
what what this kind of information would
be worth to the Democratic Party
analyzing how well their message is
getting across especially to see that
that tweet had so much value and I'm
sure it wasn't him just sitting at home
guys really good speech I should just
tweet this you know but whatever they
planned it worked right so if you look
at Obama's speech himself there were a
lot of topics again that got picked up
but there's one one topic here that you
can compare you know he's got love and
hope and
and talking about how qualify she is and
they're all down the bottom but here's
one point here when he mentions Donald
Trump and everyone goes booing everyone
goes crazy and he's like don't boo vote
and that gets hugely picked up and you
know nothing gets picked up in America
like a foot down but that's you know
hugely successful and I think that's
interesting in a country like the US
which has voluntary voting where you're
campaigning is not just about bringing
in new new supporters it's convincing
your existing supporters to actually go
out and vote and you can see in the
beginning this vote word has almost no
traction but there's a very long
residual afterwards where people still
talking about voting and that's that's
what they want people to be talking
about they want people to actually go
and vote so again if you're running that
campaign you want to be looking at these
kind of things and seeing right we
really hit home here especially if you
write a whole speeching like okay I want
to know does this point that's really
important to get across so I'm sure they
are happy about that so there's some
quite interesting insights you can get
out of you know not a lot of code so
we've seen now how people are what
people are talking about let's have a
look at ways of identifying spikes and
traffic so we've seen before our tweets
per minute but what we actually want to
know now is when does that Windows our
conversation heat up or a more concrete
way of saying that is when does that
tweets per minute value jump
significantly so we want to be able to
to map out at the point in time at which
the conversation is really ramping up
and we want to be able to do that in
real time it's a lot easier to do this
in retrospect but to be able to do it in
real time when you haven't seen the data
that's coming that's a different problem
so this is our we generated our tweets
per minute and we're going to use that
as our starting point so previously we
had we started from the tweet stream now
we're going to use this as our starting
point and start from our tweets per
minute stream and as I said that's kind
of a familiar or
a common approach with our exes to build
more analysis or more manipulation on
top of more simple manipulation and
after after we finish here we're
actually going to build on top of this
again so if this is a stream of tweets
per minute values and they're all coming
in there's numbers every five seconds
lots of values and let's say it looks
roughly like that when you plot it up so
we can see there's a real spike here at
the right-hand side so when at what
point in time do we want our code to say
right this is a spike that's happening
right now is it is it this first point
here that seems like that ideal goal
we'd want to aim for because that's to
our eyes that's when it really picks up
but you remember this is in real time so
at this point of time we won't have any
of these following points of data and we
have no idea the next value might come
in and drop straight back down where it
came from and there's nothing special
about this point at all it could be you
know the tiniest little peek you know
someone someone coughed or spilled the
drink on TV or something you know really
not very important so if not this point
then is it the next point or the one
after what do we try and find the very
top of the peak but do we even know that
this is the top of the peak the next
point is downwards but maybe that's just
a temporary pause and it's just about to
take off again so this is very hard
problem to solve in real time when you
don't know the data that's just about to
come in and none of these points here is
is significantly higher and value from
the previous point so you can't look at
it and say well I've just gone up by a
huge amount from the previous point
therefore i'm in a spike right now but
the reason why all these points are so
close together a value is because of
that rolling windows is because the st.
the tweets they're sampling overlap very
closely with the tweets the previous
value with sampling so when you're
running a new window every five seconds
that previous values got 55 seconds i've
shared tweets to count up so those
values are going to be really close
together and that's what gives us a nice
smooth curve instead of a really ragged
edge one but it makes it very hard to
compare to
take a devalues and say that's a spike
because they're always going to be
really close together but if we rethink
what we're really trying to do here
we're trying to say when does our
current level of activity when is it
significantly higher than normal and
normal is whatever you want to define it
as and that depends on their data and
when what you're trying to what kind of
spikes are trying to detect and which
ones you're trying to not detect so in
this case basically we could say we want
to compare our current minute of tweets
per minute with the preceding minute
before that and now you can see this is
covering quite a different area of the
curve and it's going to be much more
obvious to our code to see these two
values and see how different they are in
detective spike but actually if we're
trying to measure normal there's no
reason why normal has to be one minute
in fact it's probably better off if
we're talking about a 60 minute show
something like two minutes seemed to
work a lot better from the data I had
and this comes down to sort of
understanding your data in your
situation and how quickly it's likely to
move and how long it will stay at a
normal read so a discussion topic and QA
might sit other on a certain topic for a
few minutes so a couple of minutes
window range for normal work quite well
and as we saw that that using those
rolling windows and a full minute window
was all about smoothing out curve out so
using a two-minute window smooths it out
even more and so this two-minute window
is is much slower to react to spikes
because it's sampling so much all the
data to measure that count and when you
put them together like that you can
really see the difference between these
two curves and that means our code can
see the difference as these values come
in and say right right now is a lot
higher than normal so that's the
approach will use let's let's have a
look at how we'll actually do it so if
we take our tweets per minute stream
that we had wrap that up into a function
that we can use and then specify to that
function how long we want those windows
to be so our current tweet rate will use
one minute windows and our normal rate
will use two minute windows
and we want to put these two streams
together and work out the difference as
the values come in as a percentage and
that once we do that we can actually see
that most of these values here on the
left are all very low values because
there's not a spike going on this is
building one stream from two other
streams and putting them together we can
see here on the right hand side this is
where the spikes actually happened this
percentage values suddenly jumped we
don't want a stream of spikes that's
telling us nothing's happening nothing's
happening nothing something that's not
useful so what we really want to do is
filter out all those low values and take
just the moments when there is actually
a spike and so we need some kind of
threshold that we can we can judge say
this is significant enough that I care
about it as a spike and again this comes
down to how sensitive you want to be how
many false negatives you can call false
positives you can cope with and how many
misses you spikes you can tolerate and
your data itself so for my daughter i
was using fifteen percent and that's
that seemed to work quite well a jump of
fifteen percent and the traffic is
actually pretty significant so there are
X had to do this we're going to start
with our current tweet rate and we're
getting that out of out of our rut
function normal tweet rate we use the
exact same function but we say we want
to minute windows but if you remember
that chart with the graph earlier we
want them to be back to back or side to
side windows not overlapping windows so
we need to delay this normal tweet rate
by a minute to put it behind this
current one and that's a nice operator
RX has got anything that comes out of
normal will get delayed we'll we'll see
it one minute later so again our X has
these operators that really help you
build these kind of high-level concepts
quite well so now we need to put these
two streams together and work out their
differences is has this with leaders
from method which is really quite handy
it's not actually in the.net version of
rx as far as I know but you can build it
with combined latest so what are what
with latest rom does is take every
you as every new value comes in on the
current tweets per minute it gives us
the latest from the normal stream and
then that's exactly what we want as
current tweets per minute changes we
want to know the latest normal rate and
we can work out if there's a big
difference there or not so we have to
give it a function that takes that
current rate and takes the value from
each of the two streams there and get
some kind of result so we're going to
wrap that up in a method called get
difference and that's going to return
our percentage and once again just as we
saw before same arguments to the lambda
and to the function so we can just
collapse that down and again we've got
some nice simple code here and then the
next thing we want to do is filter out
all those low values that aren't
actually spikes we care about so now
what we've ended up with is a stream
that's gone from these two streams would
put them together and this spike stream
might be quiet for minutes or even hours
on end just publishing nothing because
there's nothing going on as soon as
there's a spike that happens this stream
kicks into action and it starts pushing
events about these spikes and then it
goes quite again so let's see all that
code together in one place we start with
our current and normal streams for one
and two men windows we've delayed the
normal stream to put it side-by-side
with current and then we put them
together with with leaders from get
difference we used to work out how
different the two values are filter out
the low values and subscribe subscribe
and go and throw it on a graph or
something like that make something
useful out of it so again it's not a lot
of code we're just building on lower
level constructs to make high level
constructs so let's go and see how this
actually plays out in real time
so we just have a look at Malcolm's
episode here you can see right at the
start there's a whole lot of spikes
because as far as the streams aware this
level down here is what's normal and
suddenly the traffic's gone crazy so
although this is identified as a spike
but once we hit sort of a regular level
of tweet behavior then we're pretty much
only picking out the tops of the biggest
spikes here and this comes down to a bit
of the tuning and what threshold use for
your filtering and again it's we're not
picking up any of these small spikes
which I didn't care about I didn't want
to see sort of twenty or fifty spikes
unique sort of moments in time across an
episode I was trying to get sort of five
or ten so this code worked quite well
but it's not perfect and there's one
particular spike there near the
right-hand side that's got no red dots
on it and that's when everyone's
bitching about the env end and
unfortunately because the last few
minutes before that were quite high
normal was already quite high and that
didn't really look like ass plaque at
that time so if I made it a sensitive
enough to pick that up it picked all
these ones up as well this is kind of an
imperfect solution and it was one of
these problems that you're always
balancing how many smaller spikes you
want to pick up versus how many bigger
spikes you don't want to miss so let's
have a look at what we can do with that
we've seen now how we can measure when
the conversation spikes but what about I
when that spikes that just makes me want
to know why so we saw the tweets per
minute we're moving along and I wanted
to know to be able to see that the
spikes were happening at those moments
and now I can see the spikes I want to
know why they're spiking so really I
want to know what are the hot topics of
the episode what topics were were the
biggest issues for the audience and
that's really telling us why are these
spikes happening what are people talking
about in those moments so what we're
going to see out of this is coincidental
with the spikes is what people were
talking about and really what we're
generating in real time is play-by-play
highlights of QA so what I'm really
doing is doing you all a favor because
you don't actually have to watch the
show you can just put this on your
screen and see the important bits and
skip the rest and actually this turns
out to be the easiest thing of the
entire talk and some of you might
already see exactly how this is going to
work because we already know how to
generate a stream of spikes and we
already know how to generate a stream of
topics and all we're trying to say is
our hot topics is if we put both of
these in a method our hot topics are
what's currently being discussed when
the spikes happen so if we take the
spike as a trigger and take the latest
values from our top extreme we know what
what what topics are driving these
spikes so we don't hear about the topics
when it's not particularly hot traffic
but as soon as that level of tweets
really jumps we suddenly get a value of
what people are talking about and then
we've got a choice to make about how
many of those topics do we want to
actually call the important ones that
are driving this this spike so you could
say I just going to take the top though
the very most frequent topic right now
and call that the driver of this spike
you could take the top three you could
say I'm going to take anything with up
to fifty percent mentions of the number
of mentions at the top again this is all
down to your data and
and how you want it to work out so what
I ended up doing was taking something I
think it was anything up to seventy
percent of the most frequent mention got
included in the bag of topics that we're
saying was driving the spike but that's
that's all there is and for me this is
actually this is the thing I wanted to
know when I first started digging into
the data is why these spikes coming on
what's going on but it's actually the
easiest thing to do so let's have a look
at how this actually plays out so we'll
start from Malcolm I guess it's it's
only fair considering here is the prime
minister and this particular screen does
chug along a bit partly to do with the
fact that i'm replaying it at three
hundred times speed and I've got all
these overlapping windows but you can
see as these Peaks come in we're getting
this play-by-play summary of all of
those topics in real time and you can
imagine the value of this even just the
Tony Jones the host of QA if he had this
right in front of his face maybe he does
they do do quite a bit of work with
twitter at for QA but if he if he had
this in front of his face you could see
Holly car we've just gone crazy on the
plebiscite everyone's really plugged in
on this at home because he's only got an
audience of a few hundred people in
front of him to judge off but if he can
see that Twitter's going off on this
topic he can be like right this is
important let's dig into this topic a
bit more and convince conversely if he
can see nothing's going on it's actually
may be time to move the conversation on
to something else so if you actually
scroll down here and see what what the
biggest topics were sort of seeing the
gay marriage plebiscite gets quite a bit
and that's fair enough when you look at
where Malcolm Turnbull's taken that
Medicare was a big campaigning point for
labor and there was a whole lot of stuff
about privatization it was being put to
Malcolm Turnbull the company tax cuts
there was also some talk about suicide
and mental health and so on and this is
where you can actually see rather than
one or two topics really driving it
there's quite a few different words that
we're getting all similar levels of
mentions and then there's a really
interesting point in the episode when
there's a detainee on our Manus Island
tension Center who submits a question by
a video obviously relating to asylum
seekers and no surprise that really sets
Twitter off into a big discussion and
that's you can see that here sort of it
merges in with the mental health and it
becomes its own spike here and then we
see the NBN and finish off with a bit of
arts funding so that's Malcolm let's see
how uncle bill went so as we saw before
Bill shorten's level of traffic was
quite a bit lower than Malcolm's not
fantastic but who know there could be
any number of reasons for that but we
pretty much from the start getting into
Tony Jones and if anybody saw that
episode there was a lot more interaction
between Tony Jones and Bill Shorten than
there was with Malcolm Turnbull and tony
dize was keeping him on quite a short
leash and bill Bill Shorten was having a
few quips back and he scored a few
points as well but if you look at this a
play-by-play summary of the whole
episode it's all Tony so when you're
running for prime minister and you're
going on a show to try and convince
people that they should vote for you you
don't want them thinking others Tony
Jones guy that's not winning you any
points right so that's that's I'm sure
from Bill shorten's camp if they could
see this or did see this that's not what
they were hoping for out of this episode
so again I think that's a really
interesting insight that you get out of
playing with this data and you know
these are just a few examples of what
you can do any angle you want to dig
into if you've got the data for it you
can do it and RX really gives you a lot
of access to data and works really well
for this kind of thing
so just a quick recap we've had a quick
look at how to judge the level of
activity on a stream and then we looked
at what people actually talking about in
a moment and then we've looked at what
what when does when are the moments when
that that conversation really spikes and
be able to get our code to notify us in
those moments and then we've built on
top of all of that together to actually
work out why are people wires people
being driven to engage in the topic in
that moment what topic is is that that's
grabs their attention and so the
insights we've got other I think are
quite interesting we've seen quite a bit
of interplay between Bill Shorten and
Malcolm Turnbull and considering how
close the election was you know who
knows with some of this kind of analysis
running through the campaign who knows
how you might be able to steer things
better and in Australia I don't know how
sophisticated we are with that in the US
I have no doubt that there are very
expensive consultancies already doing
this and a lot more than this right now
and I think it was really interesting
actually to look at the Democratic
convention I would have had a lot more
of a look at that but the data was huge
we get sort of 700 tweets per minute for
Q&amp;amp;A but the Twitter API will cap you out
about three thousand tweets per minute
and then sample from then on and I was
just pegged at three thousand tweets a
minute for days with a convention and
that makes it very hard to look at
tweets per minute because it's a flat
line it doesn't tell you much and is the
same with the EU referendum as well as
that whole train wreck happened so
there's some really interesting data in
that as well and I ended up with way
more data than I could make something
and make a one-hour talk out of but what
I think school is we actually haven't
used that many operators to do this and
there's not that many different
approaches we've really leveraged time
windows and that's windows are really
useful for getting current pictures in
the moment and then seeing how that
changes over time and especially when
you overlap them to smooth out your
signal and really sort of increase your
data quality there we've seen how we can
reduce windows or streams down to get
rid of filter out values we don't want
or reduce the entire stream down to us
engl value that sort of summarizes it a
grits all that information into some
form that that you want to use and then
we've seen how with latest from can
combine these two combine these streams
to to sort of generate combined
intelligence from two different sources
of information but if you look at the
documentation for RX and you look at the
list of operators it looks a lot like
that I think there are literally
hundreds of them and maybe I know fifty
percent maybe it's huge there's there's
a lot more that you can do with it so
what else can it do really quickly apart
from political analysis of Twitter which
may not be what everyone here wants the
rush home and do we can still on social
media you can track anything that's life
so particularly things like sports you
know natural disasters as they happen
you can see that happening we'll just
news and again we saw that a lot with
Turkey and similarly financial markets
and discussions about stock
announcements and so on there are
definitely companies out there that are
doing Twitter analysis to see trends as
they happen you can even look at things
like if your company makes an
announcement what's the social media
reaction and not just look at that in a
historical point of view but look at
that as it's playing out if you've got a
one hour like maybe your Apple and
you're doing your big keynote you want
to be tracking it real time what are
people really reacting to right now do
they care about the ipad 17 or not you
know and that's the kind of thing you
can look at but apart from social media
you can do a lot with monitoring as well
especially performance monitoring and
you can get rates of traffic into your
site and you can look at when does that
peak and trough exactly the same way as
we've seen before and exactly the same
kind of thing with your response time
and from there you can generate alerts
and you probably don't want to generate
an alert and wake someone up when you
get one bad response time so how many
bad responses on how bad do they have to
be before you call it an alert and again
that's sort of a window and a threshold
and all those kind of things we've seen
and it's your judgment applied on top of
your understanding of your data
then you can also look at your site's
usage after your company makes
announcements so you can look at your
company makes an announcement you look
at Twitter or your company makes an
announcement you look at your traffic
but also you can even look into user
behavior so you can look into your high
valued customers and see what they're
doing on your site compared to your
normal customers so you can look at new
customers and compare them you can look
for lost business as it's happening so
any sessions that are timing out or
transactions that don't go all the way
to actually pushing the pay button so if
you see a sudden drop in the number of
people actually committing your
transactions maybe you've got a flaky
network card or your credit card
providers not working properly or you
know something like that and again
that's something you can see in real
time and generate alert set off you
could even use it for things like fraud
detection if you're a measurement of
fraud detection is people adding a whole
lot of new credit cards that they've
just stolen to your site so they can see
if they work that's again something you
can look at a rate over time you could
say so many any users who have a very
different rate of traffic on our site
compared to normal users that kind of
thing so what we've seen here is that RX
combined with interesting data gives you
real-time insights that can be really
valuable even even if the data is dry
even drier than politics adding that
that perspective of time and aggregation
can make it interesting and draw out
some interesting patterns there that you
just weren't seen before and real-time
data is everywhere it's not just on
Twitter and it's not just about politics
there's very little data out there
that's actually genuinely static and not
changing it is genuinely static you'd
hard-coded in your code so looking at
patterns of how that data changes can
really you know reveal interesting
information so I hope I've inspired some
of you to go and look at your own
systems and your own data and see what
you might be able to get out of it with
RX so I do have some time for questions
at the end here otherwise thanks very
much for coming
good sure so if anyone who didn't hear
the question it's the question is our
exes is functional lives and you know
functional program is meant to be much
more about immutable data but I had this
epic hack in there where every time I
saw a new word I mutated a dictionary
and return that out so could we do
something with group by so i looked at
group by because i thought that's going
to be a much nicer solution i feel i'll
be able to sleep a bit easier at night
with it and i think it would work but
part of the problem i had was with these
tweet streams there's so many unique
unique words i was literally when you
group by you end up with a new stream
per unit key so i was going to have a
you know as many streams as that were
unique words in those five minute
windows and i wasn't just running a
five-minute window and then another one
i was running five minute windows
overlapped every five seconds and then i
was running those at five hundred times
speed so it really made this thing come
to a big standstill but i think if i was
doing something for a production system
i'd very much go down that path first
and see if i cannot make it work or kind
of make it work well then sometimes you
do i found have to step back to
something that's half nice half hack to
make something that actually performs
well but it's a valid point it's not the
most beautiful approach to solve that
problem yep it's gonna ask the mystery
method ways to do
analysis without Arcturus mm-hmm six
years ago hmm yeah they didn't even
happen streaming API yes I beat the rest
endpoint oh really yeah it's actually
this the Twitter so the question was how
do you get a handle on the tweet stream
from Twitter and I've only used the API
recently so it sounds like previously it
didn't support streaming but right now
it does so I netcode with our x2 to pull
the data in and save it to files and I
used a dotnet library from you get i
think was called tweet envy and that
just publishes you an event every time a
tweak comes through and then you can
convert that event to an observable and
then do all kinds of stuff with it from
that really easily and that is a it's a
push api from twitter as far as i know
but it was all wrapped up in this
package so is literally don't you know
include the nuget package put your
credentials in and now you've got an
event and you go i want to listen to
tweets with a hash corner hashtag and
you just get an event when they come in
so it is yeah it can be especially with
big stuff like the u.s. democratic
convention so they as i said before when
you hit about three thousand tweets per
minute they'll cap you so if you want to
to get every single tweet and that's
really important to you and you're going
to hit that kind of traffic level that's
when you need to start paying and it's
you know that's very custom and you have
to go to Twitter organ up and get that
kind of data but for a talk I don't have
the kind of money to do that but um it's
it's yeah it also Twitter's very
unforgiving with your connection and
your program if you start falling behind
they just cut you off because they can't
afford to sit there and buffer everybody
who's falling a bit behind it but for
all the tweets that they haven't
received yet because we're just going to
end up with them all backing up on their
own plate so you and if you make your
code simply see the disconnect and
reconnect straightaway they'll get angry
about that too so you do have to be a
bit careful about it and I definitely
saw times when doing the EU referendum
when there because I was running this on
AWS and the little cheap instance I had
been struggling a bit so your bandwidth
matters in your your processor speed
matters with
yep
yeah so the question is for anyone
missed it there there is some hard coded
thresholds and so on in there and that's
easy enough to do when you've already
seen the data or you've seen similar
data and that again that's a really
valid point and it comes down to trying
to have some understanding of what
you're seeing and it's interesting that
with the EU referendum itself it was so
unique that they couldn't even predict
the outcome before because none of their
polling data was valid because they
hadn't done an EU referendum before so
to some extent I think event as unique
is that you're really going to struggle
to know so I reached for these sort of
hard coded limits to make something
useful out of it I'm sure that there
would be more complex techniques you
could use to sow some Wild Things a roll
engage an idea of how much what a
regular amount of traffic spike is
seeing is and so on so it really comes
down to your use case about how
sophisticated you want to make it and
obviously the more sophisticated is
probably the more complicated it is cool
and yeah
whatever text and it will send that back
in a real-time basis do you think that's
realistic so questions about using
sentiment analysis in real time streams
I honestly don't know the performance
characteristics of those I haven't used
sentiment analysis yeah I think it'd be
really interesting and I know some
people in the UK who using sentiment
analysis on financial streams to pick
out trends and workout whether they
should buy or sell stocks really quickly
and they seem to be doing okay because
I've gone back to their day jobs I think
I think would be really interesting I'm
always skeptical about sentiment
analysis but I'm not a machine learning
guy so you know quite possibly they've
come up with ways to do it so it is
actually interesting because it forces
you to be brief and so I actually think
in some ways send em analysis might be
more successful there even just people
using hashtag fail or if you look for
profanity in a stream right this is
pretty good negative sentiment right
whereas if you're analyzing a Facebook
post this big is that negative or
positive probably that's negative that's
positive yeah so I think that's a really
interesting space and you know I would
love to be working on that kind of
problem I think there would be an
interesting problem itself any else cool
okay well thanks very much for coming
you want the code on github that's the
link there otherwise grab me on Twitter
or check out my blog but yeah thanks for
coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>