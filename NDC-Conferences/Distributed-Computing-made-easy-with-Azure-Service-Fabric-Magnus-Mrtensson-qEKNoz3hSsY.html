<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Distributed Computing made easy with Azure Service Fabric - Magnus Mårtensson | Coder Coacher - Coaching Coders</title><meta content="Distributed Computing made easy with Azure Service Fabric - Magnus Mårtensson - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Distributed Computing made easy with Azure Service Fabric - Magnus Mårtensson</b></h2><h5 class="post__date">2016-10-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qEKNoz3hSsY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I got a full room here yeah welcome to
this session on the azure service fabric
now the cloud asst you know helped us
with a lot of stuff the thing we want to
do is this the stuff on the left right
the worthen the thing on the left i
would say and then we wind up with all
of these other things that we also
really want our application to be able
to do to have these these capacities but
we want to be happy blue lipstick guy
right we don't want to be sad goatee
gentleman right so that's what we want
to solve all of us and we all want to
solve the same problem i think the mic
sound is a little loud and echoey thank
you so this and lots and lots of more
stuff are things that are production
concerns things that we need to do
things that we need to set up things
that we need to worry about and have
sleepless nights about and so on and in
this session I'm going to cover
hopefully real quick what a micro
service is and then we're going to talk
as much as possible about the azure
service fabric and some some people have
called the azure service fabric pass v2
and some people have called other things
pass v2 and I don't mind you know which
it doesn't matter much to me but I want
to ask you guys first you they awesome
huge audience in this room by the way
Wow and have you guys got anything first
of all I would assume you guys have a
sure subscriptions yes i have an azure
subscription yes and I have something in
a sure in production yeah well it's
about half the room and also then
service fabric have you had a look at it
anyone I've looked at service fabric
well there are several interesting in
play it'll be interesting to see what
you actually learn from this session
this is some in order you know in the
interest of setting expectations this is
kind of this is going to be an overview
it's going to be kind of introductory
and if you guys want to have a chat
about specific things or or or
specifically you know experiences how
have what type of experience do I have
using it
we can continue our talk after the
session outside as well anyway I'm
Magnus Martin's and I guess and assuming
that you know this because you've
probably read the schedule the speaker
bio I run my own company in Sweden
called lofty soft and I'm down here for
the first time on the southern
hemisphere so yay it's awesome to be in
Sydney I manager and vp since many years
and I man also also a regional director
up in Sweden which means that I'm a very
close buddy with Microsoft since many
year and I've been hanging around their
space so just I just want to point out
that this is the official microsoft
slide showing how many customers are
looking at the service fabric and my
company logo is right there so you know
I just wanted to mention that before we
go any further I also want to say that
I'm a big community guy I love community
stuff and I hope you all have you heard
about this event that we run each year
there's going to be another one in the
spring of 2017 it's the global as your
boot camp anyone can host a community
event on the specific day that we will
announce to be announced and then on the
same day all of these locations together
run as your events and we usually do
some kind of a global lab together to
sort of connects us all so it would
start over here in the Sydney time frame
in the morning and Sydney locations and
and there abouts would do their thing
for the day and roughly when they start
to close out I guess the India locations
are starting up and then Europe and so
forth so from one end to the other over
here in Honolulu we run the event in
about 30 hours continuously running
across the world it's pretty awesome I
just had to point that out because I'm a
community gay let's talk about
microservices it's kind of its kind of
the new black right the new black of
software architecture I would say
currently it's one of the big trends so
being relatively quickly let's just
decompose this thing because that's kind
of what it is about isn't it decomposing
decomposing stuff we used to have a
monolithic application package that we
take all the things that we need to do
package it to get
and deploying on a single machine and if
we need to scale that out we put a load
balancer in front of it and and we
deploy the same package to multiple
machines if I need to go and make a
small change to a small thing and inside
of this package I have to make the
change and build a whole new package and
deploy that to all of the machines so
it's a monolithic application there's
nothing really bad about it it works
fine but the trend of course with
microservices is to decompose that thing
into itty-bitty pieces or they don't
have to be specifically small but make
decomposed to monolith into small chunks
and then create a cluster of machines
and deploy actually multiple instances
of your microservices on to that cluster
and that's what Microsoft had done with
the service fabric so very very quickly
the basic some of the basic facts about
a micro service logic and state that is
independently version 2 deployed in
scale is a micro service it has a unique
name so you can address it you can talk
to it you can look it up and and and
talk to this thing not all microservices
of course are responsive to outside
connections but you know they have an
address any way to have a unique name
and it can interact with other
microservices so I'll give some examples
of that later also of course it has
these kept these some capacities it's
it's consistent in the presence of
failures there's you know it runs
somewhere in an environment where it can
fail over and then start over and do
things like that so that means that we
host this micro service thing inside of
a container of some kind and typically a
small engineering team builds one thing
so let's do an example of that the azure
a sequel database service that many of
us obviously probably runs right that
runs as its built as a micro service
thing where you can imagine that there's
for instance a little team that builds
the and takes care of the provisioning
of new databases that's a micro service
setting up a database now they can make
changes to the database setup the how to
create and provision a database they can
make changes through that process and
deploy that
part of the sequel database service
independently with all the other parts
and Microsoft has a lot of these
instances your instances of databases
running in the azure cloud right and
each instance is an instance of a micro
service each each one of your databases
right so that's another microservice
maybe the engine of the service of the
database service so you can see how you
know we can do you can decompose the
whole big thing into into smaller pieces
and it's important to note that you know
anything that runs inside of this
container anything that runs inside of
this cluster of machines is a micro
service it doesn't matter what it is as
long as there are something that runs
that's the micro service now Microsoft
has built the Microsoft Azure service
fabric it's a funny name I'll tell you
about that later but it's called the
Microsoft Azure service fabric and it
really is a distributed services systems
platform that makes it easy to build
scalable reliable low latency and easily
managed applications for the cloud this
means that you can focus on your
business needs and let service fabric
take care of ensuring your application
is always available in scale so it
sounds really good done it sounds pretty
let's have that if we position the
service fabric is positioned as a
platform service and it's very close to
a cloud service how many has used an
azure cloud service how many Houston
Azure hosted service after you remember
that that that was the first name of the
of the cloud service that when it came
out it was called a hosted service so
you guys have been around for a while in
the azure cloud so it also shares a lot
of things with the containers world
containers and it's also about
clustering so they have some
commonalities here without but but I
would position and usually you position
containers and vm scale sets and such
things in the in the is bucket but scale
sets is the thing that actually makes I
ask more pass so it's it's you know it's
sort of this this this line here is
starting to blur but the service
fabric is very close to a cloud services
thing so that's why some people have
called it pass v2 because that services
would have been passed v1 alright cool
so that's that's where we're at with
this if you have any questions or
thoughts or your personal attacks you
stop me and let's go through that
straightaway right so Microsoft believes
that pass provides the best foundation
for creating running and managing custom
applications set microsoft back in 2010
and it's kind of interesting because
those of us who know we remember that
back in 2010 Microsoft didn't actually
have an I ass offering right so they
would think that pass was the best way
to do it when they write that makes
sense so let's update this by getting a
quote from this gentleman anyone who
this is resilient a for the day sir
thank you the azure CTO markers in which
said in January infrastructure services
is like compute storage and networking
that find the first generation of cloud
computing adoption many organizations
are increasingly turning to platform
services pass to create and deploy
applications more quickly and here's the
killer quote I call this the shift from
infrastructure to innovation and it's
underway today so that's what we're
seeing we don't care about
infrastructure we don't care about vmc
then we care about applications and may
be in the form of micro services that's
what we're looking at that's what the
lay of the land is now Microsoft has run
a version of the service fabric for a
good long time and it's funny that you
know I'm actually had to update that to
over six years now probably and it would
coincide very well with that quote from
2010 right so Microsoft themselves had
this challenge with what they call
internal customers right to solve this
same problem over and over again each
one of these needed to attack and solve
the same problem so they started
building something which is now has been
has been rebate to a public product
which is the service fabric so they have
you know things like a sequel database
the example that I started out with
right in probably this this number is
probably low now this slide is like a
like a year old or something you know
being Cortana allegedly run
on something like at least 5000
instances over three data centers at the
same time in a big cluster and you know
you have a service bus i asked Clemens
bastards if I could put that up there
and he says yes that's mostly accurate
service fabric sorry the service bus
runs on something very similar to the
service fabric but it's not exactly the
same thing but that uses the same
concept the same technique so this is
something that Microsoft has done for
years and you know things like the
document DB is born born and bred in the
cloud it started out in the cloud and
it's never been anything else but a
micro services construction running in
the cloud so this is big this is huge
when we're talking about Microsoft and
meander and micro services and there are
two flavors there is a stateless and a
stateful version and you know some
microservices you know sort of a if
you're if you're if you have if you hang
around microservices some people
sometimes might argue that a micro
service is stateless so what is a state
full microservice doesn't make any sense
it's wrong you know but there is a
really good case to be made for a
stateful microservice and i'll talk more
about that now a stateless micro service
is very close to a cloud service right
it has a state but that's persisted on
some sort of external storage as like it
such as an azure database or a sure
storage or similar so the process the
micro service instance itself doesn't
really have any state and it can be lots
of instances and this is very very
similar to a cloud service instance of
web or a worker role in a cloud service
it's extremely similar to that because
we've been taught if you probably know
that a cloud service instance should not
have state itself you have local disk
but it's not the same thing it's not
persist it's not durable a state full
microservice though is something that
had that offers reliability of state
through through replication and local
persistence and i'll show you this and
it means that the cool thing about
this is that this will reduce latency in
your application and the complexity and
number of components in a traditional
three-tier architecture will go down so
let's quickly look at a traditional
three-tier architecture many of us have
seen this many of us build this and I
build them as well there's absolutely
nothing wrong with this picture is
beautiful and then you have your storage
and if you need to store lots of data
for lots of different instances you
might want to scale your your data tier
and that's a challenge then you might
want to defer some work from the front
end to the back end you might start
using something like a queue this in
this case it's an azure storage queue
and to get you know lower latency with
this storage tier you might introduce
some caching at some level inside of
your application right and also it's
quite common that that work starts to
become sort of workflowy right you you
do one thing and it said another message
to another queue and and some other
thread picks that up and does the next
step and so forth and you get your
internal workflows going inside of your
application and as you can see with this
picture which is you know this is a
brilliant picture I built systems like
this i'm sure you all have right what
you can say about it is that it has a
lot of moving parts each one of these
things can you know fail individually
they need to be maintained individually
you need to know how their the whole
thing hangs together and so on and so
forth so it is it has the disadvantage
of of complexity still it's a solid
architecture as a stateful microservice
architecture it could look something
like this instead now the state that
used to be in the database has jumped
into this compute middle tier here and
the instances of this state is a first
class citizen and that means that if you
need to perform some calculation based
on some data here the reads the the
latency to access this data is extremely
quick because it's in the process it's
right there in memory or under the local
disk so it's going to be really fast and
again first-class citizen the so you can
scale out
this state without having the normal
complexity sometimes of that scaling out
your data theor thing and with built-in
transactions which I will show you later
so this is this is this architecture
could solve the same problem and as you
can see it has very many fewer moving
parts so it would reduce complexity in
this scenario cool but of course you
would use data stores for analytics and
disaster recovery and all those kinds of
things as well so they do go away but
but you know and hopefully you can do
your working stuff with with data that
is in memory any thoughts or questions
that about accurate you think those of
you who know yep thanks cool so this is
a bit of an older picture but I keep it
around because I like the fact that you
know if you want to build something like
the service fabric or a cadet for that
matter right the other similar thing
that has been presented here at the
conference all you need to do is build
that and then you're done right so
Microsoft built that for us and let's
focus on the lower part of the screen
first where it says that you can deploy
this thing to Azure and apparently on
windows server or Linux well not yet not
really Linux is there rolling it out but
you can totally deploy to windows server
and the nasher is going to work great
again remember it's called the Microsoft
Azure service fabric right for some
funny reason because you can actually
also deploy this to a private cloud
private environment on your own data
center or on a complete competing cloud
it doesn't really matter because the
service fabric is not the Microsoft
Azure service fabric when you look at
the namespaces it is the system fabric
so the Asscher service fabric doesn't
care about Asher really doesn't it cares
that it has some VMS that it can deploy
to and another interesting interesting
thing about that is that the service
fabric itself doesn't have an SLA and be
like no SLA what are you talking about
well the service fabric is assist a
distributed systems platform it's not an
azure service you can provision a
service fabric
and cluster in Azure but what is that
well that is a set of VMs that gets
provisioned on your on your subscription
and that set of VMs is a cluster which
runs the azure service fabric but the
service fabric itself is not a natural
service it's a little bit you know wonky
but you get what I mean so the SLA for
the service fabric is the SLA of the VMS
okay make sense it's good to know the
difference so if we abstract this thing
out a little bit you get input like big
boxes you get something that looks like
this and we're going to spend the rest
of our time digging into as much at this
as we possibly have time for but it will
be you know we have to we have to move
quickly and we won't be able to cover
everything in detail so I want to start
at the bottom and explain to you why
service fabric work why clustering and
micro services is something that is
pretty cool and gives you some
capacities that you would want for your
application remember the happy blue
lipstick guy that built the features and
all the other stuff that we needed all
that other stuff is what something like
service fabric fundamentally is is
supposed to be able to give you as a
developer that you just want to run your
thing and you want all those nice
features so here's how and why that
works in a data center you have lots of
machines physical probably virtual right
if you draw a circle you get a cluster
and again like something like being
Cortana runs in like five thousand
instances right of a cluster so plus
there's scales to a lot so here's a
little cluster it's a small one and
let's deploy a service fabric sorry
let's deploy a micro service instance
okay so what's this well it's the red
microservice here and it has a primary
and then for high availability and
failover it has replicas secondaries
active active secondaries and that are
in sync the data inside of one of these
instances is in sync in all these
instances okay so let's deploy a few
more of these guys onto the cluster
so we have a bunch of micro services and
when you deploy the cluster the service
fabric will look at the nodes and see
how much load they have and they will
spread out automatically your
deployments on this cluster on the nodes
you don't actually know where they will
end up service fabric will take care of
that and okay so now we have a problem
there was a node failure right this
machine is gone it blew up for some
reason we don't know why it's gone so
now we have some issues what's the
number one issue we have in the current
scenario what's the biggest problem yeah
it's the second biggest problem because
there's a little bit of a sneaky one
here the first biggest problem is that
the cluster is actually broken so it
puts itself back together again and
realizes oh crap this machine is gone
now the second biggest problem is
correct the green primary is also gone
so at this instance in time and you know
I'm saying this over sentences this is
microseconds in this instance in time
the green micro service is not
responsive there is no primary that can
receive traffic from the outside so
immediately the cluster will see this
and it will say okay so then we promote
this secondary to primary and now the
service is responsive again now we're
actually back in a working state
entirely but we are missing it we're
missing some secondaries because when
you deploy you define this is how many
secondaries I will have for this micro
service and you find this and then the
service fabric will ensure that you have
that but we don't right now so it will
copy some more instances of secondaries
and make new copies and fire them up to
get back in balance now if this is
running in your data center and a
physical machine may be physically
actually breaks it might take a while
before you replace the parts and fire up
a new instance of a server if you run in
the cloud you might quickly get a new
instance you just say like a new
instance please and you'll get that
because there are thousands or hundreds
of thousands or however many virtual
machines potentially available in a data
center and then of course when a new
node
up a new instance shows up in the
cluster the cluster monitor will see hey
there's a whole machine there which is
you know underutilized this thing is not
doesn't have anything on in so let's go
and balance some stuff out and move some
stuff around to make sure that we
haven't even spread on the cluster that
is how this works okay so regardless if
it's a sure service fabric or some other
similar technique it's going to work
pretty much the same this is why this
works with this you will get things such
as failover automatically you don't have
to do anything and just by using this
technique this this platform you get
this for free so again let's recap a
little bit I guess but let's say we have
one instance here and if there's a read
request that comes into it remember the
architecture and odds are hopefully that
that the data that one needs to be read
is in that node it's right there this
local state so the read request is
immediately given a quick response right
out of memory no latency jumping to an
external store or anything like that but
just read it and respond no cash even
involved it's right there now writes on
the other hand an incoming write request
would go and be replicated underneath
the covers to all the secondaries and
then in when enough secondaries
acknowledge the right and go back and
say yep got it got it got it the right
is acknowledged out this is exactly how
the one instance of your sequel database
works how many instances how many
secondaries do you have on your sequel
database yes somebody said two that's
correct we all know that we see what we
see as one database is one database with
two secondaries so every right we make
is replicated and when we have a right
quorum in response and everything's
alright that's why you don't lose data
inside of your database it was really
really bad service if oh sorry we lost
some of your data you know that that
can't be right so this is the
replication ensures the high
availability and then the consistency of
your of your or your data so and for
those of you who were
servants saw that this last guy there
was late and he can come back and say
acknowledged at a later time that's fine
okay so let's see if this primary fails
like we had in our example right the
primary fails just to recap then you'll
have a promotion of a secondary to
become the new primary and then if a
secondary fails well then I fails too
bad so now we're still this service is
still responsive it still works there's
nothing wrong with it except that it's
not in the desired state so let's see
that the old primary he comes back he
didn't actually die he just had a hiccup
he comes back and now you have this
split brain scenario he comes back and
says hey I'm the primary awesome let's
do this thing and the actual primary
will say nope sorry you're not the
primary anymore you are demoted to
secondary and oh by the way catch up to
what we've been doing since you would
since you've been gone okay and then of
course the thing I showed you also
earlier you can go in and bake and
create and build a new secondary and
slide that into place so that's how that
works and sort of you know but wait
there's more right this is the stuff you
get kind of for free for using something
like the service fabric distributed
systems platform thingy pretty cool yes
nodding heads awesome good good so
that's that's the lower end of things
and I won't spend any more time there
I've sort of explained why this works so
let's go up instead and talk about how
you actually interact with this how you
how would you build an application that
interacts with with the service fabric
and that's stateful storage thingy how
do you do that well you could run any
arbitrary eggsy as an instance of a
micro service you could run an asp net
application if it's you know
self-contained something like you know
yeah well anyway you know they let's get
this is going to run with it with
the.net core and stuff like that so
anything that is self-contained and can
run on the machine is your your service
fabric instance or sort of micro service
instance but if you wanted to interact
with the API that stay
full storage thing of course then
there's an API there's the reliable
services API and the reliable actors API
so looking at these two guys the
reliable services API allows you to
build stateless services using existing
technologies such as asp net or state
full services using reliable collections
we'll talk about what that is and then
you can marry and manage the concurrency
and granularity of states using also
built in transactions I'll show you and
communicate of course with anything else
on the outside this is a process that
runs you can do whatever you like with
it okay so reliable collections is very
interesting very very interesting going
back to the history of collections we
started out some time ago with having a
single machine single-threaded
collections and then the evolution of
that was to make the collections
multi-threaded and still work so that's
what we've had reliable collections
though is a multi machine collection
which is replicated with high
availability gives you persistence it's
durable it's asking it's asynchronous at
this point you have to do this
asynchronously because we are again
doing it is right where we are M
replicating your rights to other
machines that hence it must be an
asynchronous it but in nature the
interaction you do with this and
transactional so that's what you get
with these reliable collections and
we're going to look at that real quick
soon so let's go first to just to show
you if you do a file new and showing you
the different pieces that are in there
it's going to be cloud the resolution
always gets you right and let's just do
that and say ok just to show you the
dialogue that comes up this is these are
your options that is it big enough yes
so you get all these options of things
you can build here right you have a
spinet core their guest executable and
then you have your stateful and
stateless services and the actor thingy
so these are your options or templates
that you can can do okay
wanted to like it's there's nothing
there's no magic there or anything
that's going to give you a little
project ah right I actually
coincidentally close to one I wanted to
have open it was that one so and in
Azure then I I did a couple of
screenshots because you know Wi-Fi and
internet connectivity is sometimes flaky
but I think it might work here now and
when I go and create i just want to show
you this first because that's that's not
something i'm going to show you in the
portal when i go and create a a cluster
in the portal I say I want a new service
fabric cluster and I go and configure
that and set that up however there you
know I want it and of course at the
during the creation process I can
extract a template an arm template for
Asha resource management which will
provision this whole thing there's a lot
of machines in there a lot of moving
parts and there's networking and stuff
that's being set up for me automatically
and the image that we are imaging up
that we are newing up when we create our
instances of machines in our cluster
have the service fabric on them so
that's what we get so let's go to the
portal and I created actually last night
I started up an NBC Sydney service
fabric cluster instance which runs in a
show right now and hopefully I'll see
the internet and things and I'm happy
that I have the backup of my my
screenshots so there we go here's my
little cluster I created that one just
for you guys oh and that's rate with
five instances i believe i pick the
smallest possible machines i didn't
configure security or anything and just
this is just the throwaway kind of thing
to to show you guys so it has five
healthy nodes you have different upgrade
domains and fault domains and such and
such you know all the good stuff that we
already know about azure and and that's
all configured and set up for me and I
also have one application that i
deployed it's basically a final newish
kind of application but i just deployed
one and to show you guys and
I can go actually inside a visual studio
and do this here's my stateful
application let's zoom in on that here's
my stateful application type this is
like a cloud service package similar to
it's just the thing that configures and
defines what your your application is
and then down below we have the actual
project which has a program class where
let's sit right this is a this is a
console application gentleman right and
ladies of you yes this is a console
application that's what it that is and
inside of this I have something called a
stateful services demo if I jump to that
it is a inherits from stateful service
so now we're talking to the SDK and then
stateful the reliable services SDK of
the service fabric is what we're talking
to now right so this is a state full
service and let's actually remove before
I do let's just I'll just show you that
yes I can interact with my Asher
Explorer cloud Explorer I can interact
with my local cluster with my cluster in
the cloud and it's all good right so I'm
going to f5 soon and we're going to
deploy to our local cluster actually
let's f5 now while I'm talking because
it takes a minute or a little a little
while to deploy so i can run local
development on my local machine of
course I mean this after all this is
visual studio this is Microsoft you
would expect that but in cutting them
and unlike cloud services when you do
local development and that was a another
implementation a version of the stuff
that runs in the cloud the service
fabric scenario here is that I have a
local cluster that I can fire up on my
local machine for director Dave purposes
and that is not another version it is
the same code which then runs on my
machine that you would run that will run
in an azure or anywhere you want to run
your cluster it's the same code and
that's pretty cool so this it takes when
your f5 this thing unfortunately it's I
think it's kind of slow but but it works
anyway and you can debug and you can
attach to a process a micro service
running in the
cloud as well if you want to do that and
all these things that we would expect
Microsoft to deliver when they build
something you know tooling for visual
studio elements there so let's quickly
look at our little method here called
run a sink is where that's where the
action happens inside of this thing you
can see here that I'm starting to
interact now with the Institute small
little bigger no little bigger yeah see
see if we can do it this way yeah cool
so you can see here that I have my state
manager inside of my stateful service my
state manager and from that guy I can
request instances of these reliable
collections and I reliable Qi reliable
dictionary I can request these instances
these highly available scaled out
instances that I pull out of my my state
manager right so then we have your
classic wild true loop while I'm while
I'm not canceling this house about I
make a transaction so I go and say I
want to do a transaction inside of my
state here and I want to interact with
my cue my dictionary my other dictionary
and so on and so forth and do things
with these guys inside of the scope of
one transaction and then at the end of
that transaction I can commit or abort
whatever changes I made to my state you
know unlike if you would use that if you
would build the same solution with an
azure sequel database and an azure
storage q those two would never share a
transaction those are different services
in the azure platform they would never
have the same transaction so you can see
how this simplifies things and also
makes it quicker because there's no
latency for jumping to a different
service so if you can solve whatever
business problem you need and have your
data here then you probably should but
you should also back that data up on a
database sure cool so that
so that's how that works any thoughts on
that questions yep yeah yes yeah yeah
yeah so this is anas is the pen to a
dependency on the platform this now you
are depending on the service fabric
because you're building a service fabric
service there's no you know there's no
requirement to do this you can run your
ape your Web API that's what the
question is can I run my own you know
can I build stuff without this of course
you can deploy any arbitrary eggsy your
your asp net core application and just
use to apply the service fabric platform
for orchestration and for failover and
for high availability and that sort of
thing you can do that you don't have to
interact with the sdk you can choose to
interact with the sdk if you want to
have this that the the queues and the
dictionaries and that you can use inside
of one transaction the data that you
have highly available on there and so on
and so forth this is choice you make a
trade off if you want to tie yourself
closer to the service fabric thing you
do that but service fabric again you can
I mean this this is available for you to
just use there's no charge to use it and
you not constrained to where to deploy
this so you know you choose pick your
poison basically right so this is very
similar to the olden days when we and of
course cloud services just to me very
very clear cloud services not going away
anytime soon it's it's it has its place
and a lot of deployments are running
cloud services but it's similar to
exactly that scenario where you would
choose to make a dependency on cloud
services but this is much more open than
that because you can deploy this
anywhere right so it's not it doesn't
constrain you as hard as cloud services
did okay cool great question awesome
right so
here's the my backup slides backup
slides i showed you log into local
development oh I did actually push f5 so
let's let's go back to our local
environment here there is a little
service fabric cluster manager down
there in my system tray which I can
click on and when I do which already
have done I get this you see here local
host says local host I get the service
fabric Explorer where I can see that I'm
not currently running one application on
my cluster and my cluster my cluster has
some system services there this these
are instances of micro services running
inside of the cluster that actually
managed the cluster so they run their
own system services as instances inside
of the cluster as well so you have your
naming service your fault analysis
failover manager cluster manager
services all these things run in the
service fabric and your application will
also run in the service fabric so here's
my little demo thingy it's there it's
available it works and when you dig into
this guy you can see that it is running
on the primary node 2 so if I it has the
primary on this node there's my instance
I can dig down to that I can get all the
way down to here's the code that
actually runs here's the package the
version of my code that runs on this
thing for for this version of this thing
okay and again like I said before this
thing has an address you can address
this it's in this case fabric colon
slash service for a stateful application
type it would be more complicated if you
have that in the cloud and speaking of
having that in the cloud this service
fabric Explorer again it's running on my
local box and here's the other one
running against my cluster in Azure is
the exact same thing okay so no magic no
strange thing the exact same code the
exact same thing okay so local
development and reliable services API
already showed you this so let's talk
about actors there's also a virtual
actor programming model that you can use
if you have applications with multiple
little units of state and compute and
you can use the actor model it gives you
a state management it gives you turn
based concurrency there's a single
threaded execution thing that it runs
under and this model just really on the
surface now guys because we don't you
know we can spend too much time here if
you have an eye actor called in this
case hello world you define that and
then you implement that actor interface
you derived from the actor base class
and you create your implementation and
then you register your actor
implementation in your so in your
application type register that I'll show
you that and then you can create
instances of this actor implementation
okay that's that's literally how that
works so let's go i have another a small
counter demo which has again a similar
to before it has a mane well this is too
big a little bit smaller little bit
smaller area and it has a mane and where
I register my actor inside of that and
my actor implementation if we jump to
that is like I just showed you on the
slide derived from actor implement some
kind of an actor interface and then I
can do things when it's activated I can
create messages in my event source for
instance say that this thing is now
activated I can I can set a counter
that's the one method that i have on my
interface i can update a counter with
this and i have my state manager in here
where I can interact with state inside
of my actor and I can have persistence
models for this and I can choose to
persist this and as in a document
database or somewhere behind the scenes
so that's how that works and I it's it's
a very small demo but it gets the job
done and I did do one thing that could
you just couldn't help myself and
because i want to point out that here's
the actor
my actor interface which I have and it
derives from I actor but it's also an
actor event publisher so when my when I
do the set count async call inside of
that implementation I actually have also
an actor event which will fire and say
count updated so i can connect i can be
connected to this thing and have
something else somewhere else a client
somewhere being updated when something
happens on the on the actor on the
server so i can have events firing yes
that's i would say i think that
synchronous i don't know i think it is
it sets up connection for you so you can
you can from from a client application
you can connect this thing and get a
proxy instance of that and and subscribe
to that event on your and a client
application and it would fire up in the
cloud somewhere and and inform your
client about this change sure so we have
that now okay so actors it's really
really rushing through that really
quickly i have like one more thing that
I want to talk to you guys about
actually this is going really fast so so
where we have we have plenty of time for
QA and thoughts at the end here that's
good I have an anti-pattern then I
really like it's the almost flying in
the clouds anti-pattern that I invented
it's when you build something and you
don't go like you don't go all the way
you you um you want to build a new
application you want to move forward and
and jump into this cloudy thing but you
kind of keep one foot on the ground
right just to be safe and there is this
world that you come into and in this
valid objection right do I have to buy
into all of this or how much and at what
pace and what is the what is the stance
that I should have here and I would
venture to say that if you're going to
build something new today it's very very
likely that you could benefit from a
micro services
it's kind of all the rage right now but
obviously you should also look at this
the functions stuff right lamb whether
it be lambdas or as your functions and
server less it's also pretty cool
because then you wouldn't have to have a
cluster if you know that's what you need
but the the risk we have here is that we
are almost flying in the clouds so we
deploy our things sometimes that's the
right thing to do I don't want to I
don't want to tie myself to the azure
service fabric your your question and/or
your thought their previously is the
perfect example of this there's no right
or wrong there's a choice and you can
choose to stay away from maybe tying
yourself to the SDK of the service
fabric you can choose to do that at what
cost is the question right if you can
make your application architecture very
much more simple by possibly even being
able to remove a few databases or some
caches from your solution it's going to
be cheaper there's going to be less
pieces that could fail and and you might
get the same job done quicker so what is
the trade of cost well what are you
willing to do or not do to get the job
done and again there is no one answer
here each application would have its own
scenario and and its own you know
benefits or anything but you have to
think about that how how much pain are
you willing to put yourself through in
order to almost fly in the clouds you
know you want to want to be that guy who
falls down what's up to you it's up to
you looks really good when he starts off
right and then after a while you don't
know what happens and that when it comes
to servers I think many of you have seen
this or a quote or this statement that
when you have servers you don't want to
treat your service like pets because you
know if one of these guys dies you know
if we kill one of these and which one
which one should we go with which is
ugly do the Pug let me kill that one
yeah you kill that guy that's really sad
I mean will be will be heartbroken
because we won't kill that guy because
we'll miss him you know it's we take
care of him and we pet him and we give
him food and we nurture him and that's
so nice right so we don't want it
really have this set up anymore what we
want to do is that we want to have a
pack of wolves you thought that was
going to be cows right I think cows are
stupid so I went with packs instead ok
so we want to pack of wolves we want to
we want a cluster of identical machines
and when you kill one of these there's a
new ones going to step in and take over
no problem it's going to be identical
and kind of work so no maintenance of
OSS and no other you know no such thing
at all we deploy the service fabric in
this case and an hour microservices
inside of that and if we want to upgrade
or change a machine no problem right
they are all identical in this scenario
they are not our pets anymore that's
what we want to have and that's the big
trend that we're seeing and has been
seeing for a while but I know of course
many of you guys in here know intimately
about this and you're here to listen to
specifically what the service fabric is
about but I also in I work as a
consultant myself and I see a lot of
companies that haven't got a clue about
this at all haven't looked at this at
all anything so but it is it's a while
some people consider that not to be a
very new trend it's extremely new to
some other people I'll tell you that
much if you want a party in the cloud
there are party clusters that you can go
to I just want to point that out and KMS
/ try my price service fabric you can go
there they fire up clusters that they
keep around for a while and you can just
create a little application and deploy
that to these party clusters just to try
it out and see if it's fun and so
Microsoft run these these little
clusters for you and there's actually a
very good point to be made here service
fabric when I provision service fabric
in my subscription I get a set of VMs
right and these are now my VMS that I
need to keep running and potentially
upgrade and such and such and I really
want to have hey I wrote this micro
service how about you microsoft run that
for me right a bully hosted version of
this of course there's a fully hosted
version of service fabric coming but i
know for a fact right now that a lot of
people are also running service fabric
or starting to run service
break outside of azure and so there's a
focus on that currently but there will
come of course in a future a version
where you just show up with your micro
service and there you go and and you
don't have all of these instances of
machines inside of your own subscription
so there is you know it's that I ass is
that pass well let's think about that
for a while currently it's kind of I a
see in some respects because you have
your own vm still but they are wolves
not pets so you know QA folks before I
wrap up any additional thoughts or
questions yes sir oh you have the
microphone cool so can you also cover up
what how do you hydrate and dehydrate
the collections oh yeah yes hydrate and
back up the collections that that states
the storage yeah so there is there is a
backup and restore function in there for
that so that you can do backups on that
states but you would also probably have
another process that ships that data off
to some more other durable storage like
in you know Asher storage table or blobs
or or a sequel database ok so the
Christmas is it more out of the box is
something available out of the box for
me to hydrate or villa how to hydrate it
myself well it's something I think at
the EU you would have to interact with
the cluster with your service to say I
want to back up now on a restore from
this restore point and so on and so
forth so you can backup and restore the
state it's possible to do but you you
have to do it okay turn right thanks
question in the back
with the stateful services how does that
typically look for an application
upgrade so with the stateful services
how does that look for an upgrade it's
great question you mean like with with
when when you change the structure of
your data and exactly yeah well that
problem hasn't been solved yet right and
it hasn't been solved for any other
scenario either if you have a date
breaking database change and if you roll
that forward if you're all that back
what's going to happen I'll say one
thing now of course this is not an easy
thing to solve breaking changes in your
data structure is is always challenging
and it still is in this scenario here
you probably need to do a multiple
upgrade one that goes to like a version
1.5 and then change the data and then go
to version 2 and it sucks but it's still
still true and and while I'm saying that
there is one other thing which is
important here in this deployment
process when you deploy an upgrade to a
service we haven't really talked about
upgrades and deployments in this in this
presentation we have a few minutes I can
briefly touch upon that now because of
this context of the question and there
are some Nevers and stuff that you can
set some tolerances that you can set
when you deploy an upgrade and such
things such as response its
responsiveness and things like that and
and and if you set that up right and
deploy a new version of a micro service
to upgrade to a rolling upgrade and and
take over your old instances with a new
version of this that's automatic of
course and when that rolls out if the
service fabric discovers that all of a
sudden maybe you made a mistake or no
not you somebody else made a mistake and
now you're deploying this thing and and
service fabric notices that hey this
thing is not responding the way it
should anymore this is not right in odds
are actually quite good that it will
stop it will inform you about this
optionally even roll that back without
you doing it doing anything at all so in
this there's this whole thing with the
upgrades and we didn't have time to
cover that but yes that's in there as
well long story a long answer and
partially not what you asked but i canna
mention that gets complicated with data
as well
yeah and it always always was and and
the person who solves that will be
infinitely famous because no one solved
it yet still true that it's not solved
great question yes we question up front
awesome questions um just wanted to ask
about the load balancer and how it
worked lol so let's say we've got a
fabric that you have some microservices
but one access through consumers outside
the fabric so we've gotten a fabric
running and our enterprise on premise
for example or fabric running another
and we have a third-party consumer now
that's going to consume through the
fabric we found a limitation and I just
wanted to confirm with this limitation
or not that if we are going through the
load balancer from the outside into the
fabric then we have to have the micro
service instance that we're trying to
access deployed on every node otherwise
the load balancer doesn't know where
it's actually deployed okay I haven't
heard about that sounds weird I don't
know that's a very specific scenario
that I haven't come across that issue
but and again the problem here is that I
don't work for Microsoft's I couldn't I
couldn't give you an hour Microsoft
official answer on that and
unfortunately I haven't heard that
problem and but have you seen public
api's deployed through the fabric oh
yeah oh yeah very much so and people
deploying API applications have a lowly
oh sorry multiple of them yes yes I've
seen and accessed from the outside yes
so there's something wrong with what
you're saying and there must be
something something screwed up so now I
don't know how strange well maybe we can
talk about that more later after outside
so we have about we have a few more
minutes yes no yes um just you talked
about the upgrades in your experience as
a kiss Holton has that worked well they
upgrading the applications using the
upgrade mechanism yes yeah that was only
thinking there's more to say there I've
so far what I've seen it's that it's
worked well yes yes
I haven't done a lot of this
configuration stuff that I talked about
the my scenarios have been fairly simple
at this point and it's still because of
early days and such right people are
getting warmed up and and learning how
to do this thing and in that context I
haven't done really complicated
scenarios yet with data changing and
that sort of thing I haven't done that
much and it's the challenge of newer
technologies this is a ga product since
almost six months now AGA that bill did
the spring but again how many companies
that how many how many of my customers
are actually using this in production
well not many and not yet so there is
that lack of actual projects
unfortunately little bit yeah lots of
questions awesome how large can we have
those reliable collections how large
yeah so they're the size of that is
there's there's this whole thing that
you need to go into when you start
calculating how much size does whatever
you do take up on the cluster you you
provision when you provision the cluster
you choose the size of your machines you
can actually have multiple sizes of
machines but typically you will have a
well if you have a normal cluster it'll
have one size of machine and you decide
how big that machine is and that will
give you a certain amount of disk a
certain amount of memory encirclement of
everything right and then you have that
as your resource and then you need to
start to calculate how many instances of
my of which microservices will I run how
many replicas will those have because if
you have a primary with a with a
gigabyte of data and your secondary
would also have a gigabyte of data on a
different note so how long until you
saturate your your cluster and have to
actually make it bigger to accommodate
the size of your data and so on and so
forth so there's this whole calculation
thing that needs to be happening there
and you probably not just have one
microservice you might have multiple and
these might have multiple instances of
each and so on and so forth so you have
to start doing some maths there but its
a math problem and it's not extremely
difficult its additions and such
subtraction so you know it's not
horrible maybe a bit of multiplication
as well does that answer your question
it's constrained by the size of your
machines I have a question if we have
the setup staging and brought in biomass
do we have to do our self or do we get
something out of the box I'm sorry
requesting I mean different vironment
staging prod oh yeah oh that is a great
that is a great question I like that
question so if i run one cluster it's
perfectly viable to deploy my potential
that we imagine this right you can
deploy your development environment and
your production environment instances of
your micro services to the same cluster
it's absolutely possible to do you just
give them different versions and and you
know deploy them as different
deployments they can run side by side a
little bit odd but it's possible
especially when you start out a couple
of customers that might have done that
they start out really small so they just
don't want to have a lot of you know
they haven't filled up a cluster yet so
the step into this is going to be
slightly expensive for everyone so this
is not for everyone i mean if you have
just one instance or two instances of
servers that you need to run this is too
big this is at least maybe five machines
right so this is the maybe probably
something along the lines of at least 10
cores to get this thing running properly
and it is a big step in and when you
start out you're not going to have
filled that up and you know you have one
little micro service in a whole cluster
that's going to cost you more than then
it's worth in the beginning and down the
line that's going to reverse again and
it's going to pay off so initially
obviously deploy the both of them to the
same environment why not but then you
can also maybe not do load testing on
that same cluster the cool part is
though yet you would have your template
and you can just deploy any cluster do
load testing on something there and then
delete it again because it's a sure and
that works and then maybe in a future
when you if if or when you're big enough
you might have one cluster for
development and another cluster for
production that's answer
Jim good right we're about to run out of
time I'm going to wrap up real quick and
you can go find that online yes
microservices trend it is pretty awesome
we're going towards it and there's no
denying it we're right there and I would
say that service fabric is pretty
amazing sure I mean anything has it's up
to the ups and downs I'm talk to you
outside if you want to have them no
kidding and pass v2 call it what you
like I don't care what we need to call
it is its service fabric pass v2 is it
scales vm scale sets that's passed v2 i
don't care really don't but it is
there's a lot of interesting stuff
happening in compute and i hope this has
been interesting for you i hope you've
you've had you know some new information
coming your way here I appreciate you
taking the time to be with me today and
you should now go about your rest of
your conference and enjoy it thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>