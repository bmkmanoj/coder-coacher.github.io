<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Faster Websites with WebPageTest - Nik Molnar | Coder Coacher - Coaching Coders</title><meta content="Faster Websites with WebPageTest - Nik Molnar - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Faster Websites with WebPageTest - Nik Molnar</b></h2><h5 class="post__date">2016-08-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eyYtQLv8lss" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright wait oh hey we're live we're hot
we can get started good afternoon
everybody guys having a good conference
so far day one okay when I oh I heard
something I heard something I don't know
if Australians interact or not so I'll
have to try this so anyway my name is
Nick molinar I am a web developer I work
for Microsoft and today we're going to
talk about one of my favorite
performance testing tools called web
page test so a little bit of background
about me about six years ago now I spent
an open source project with my buddy
Anthony called glimpse can I get a show
of hands how many people have seen or
heard of glimpse before okay a couple of
you great there if you want to see what
we're doing new with blimps Anthony the
guy started the project with is giving a
session about it in the next time slot
in room three so be sure to check that
out but for those of you unfamiliar
glimpse is a Diagnostics tool for
asp.net web sites and it does a whole
bunch of different things but one of the
primary use cases why developers like
glimpse and use glimpse is to help them
with their web application performance
and so what that really means is for the
last six years I've been kind of
enthralled into the world of web
performance and I've studied it and I
put a lot of course material together
around it and I've done audits of
companies websites and help them and so
this is a tool that time and time again
has come to my aid and so I thought
maybe I should put together a session
around it oh so that's what we're gonna
do that was the coolest animation you're
going to see all day and then it's done
so what we'll cover it really quickly is
just what is web page test I'll go into
a little bit about its guts and how it
works and then we'll do like the basic
how to get up and running and dive into
some more advanced usage scenarios now
just kind of wet your appetite I'm
playing a video here for you from the
etsy offices in New York City and Etsy
is a website who is very performance
driven so these videos were created
using the web page test API we're going
to be looking at that a little bit later
but one of the things that really kind
of like tugged at my heartstrings as a
performance nerd
with this is I've worked for all of
these companies where you go into the
main lobby right and there's there's a
clock that says New York and one that
says London and one that's a singapore
and like I don't talk to any of those
places but I'm glad I know what time it
is there I think it'd be much more
valuable to me as a developer to replace
those clocks with the wall that looks
like this so I can see how my site is
performing in all of those locations or
how about instead of locations right
right now this is New York California
Germany Australia what if it said 2g 3G
cable you know Google Fiber right like
what does my site look like on these
different usage profiles and so that's
one of the things that I think is a
really cool about web page test is it
allows you to get really really rich
information about how your page is
loading and gives you the tools you need
to present that data back to potentially
non-technical stakeholders or managers
and so we'll figure out how to do this I
don't want to whet your appetite a
little bit for some of the things that
webpagetest can do so when we stop the
thing about web page test we have to
think about what role it plays in the in
the world of performance testing and
when we think about performance testing
there's basically two techniques that
are used the first is real user
monitoring which is also called rum the
initials are brum and then the second is
synthetic testing so web page test is
synthetic testing that's really all
we're going to talk about in this
session but I think it's really
important to know that if all you're
doing is synthetic testing you might
have a bit of a problem so what real
user monitoring does is it kind of just
admit the challenge that we have and the
challenge that we have is we users who
are all over the world using all
different devices all different
operating systems all different browsers
all different connection speeds and
there's no way that we can generate
enough performance tests to actually
test their usage profile right so like
what rum does is says well instead of
you the developer trying to test all of
those different configurations even if
you want use something like browser
stack you can test all those
configurations let's flip the whole
problem on its head and do something we
would never normally do let's up the end
user
do the testing for us and let them tell
us whether or not the site is fast or
not for them right so the guy on a camel
and Egypt using Windows Phone I think
maybe that's where Windows Phone gets
used I think maybe that guy will tell us
whether or not our site is fast so
that's great but the problem is then
you're waiting around for that guy and
so we can use synthetic testing tools to
to fudge some of the numbers right to
try to approximate now you're never
going to approximate right there are
problems on the internet that you're
never going to be able to approximate
like this one right here this is the
fiber optic cable running out on the
transatlantic line sharks attack it all
the time for some reason when the
transatlantic link goes down 99% of time
it's because of these real shark attacks
and so even if we're doing synthetic
testing there's no synthetic test in the
world that has a checkbox that says add
the shark attack option right like that
doesn't happen or pop some popcorn and
screw up people's Wi-Fi that's not an
option so you're never getting real
usage data unless you use rum but the
benefit of synthetic testing even though
it's not real is that because it uses
really highly instrumented computers or
highly instrumented browsers you get
much richer data the guy on the camel in
Egypt will tell me this is how fast the
page loaded webpagetest synthetic
testing tools will tell me well this is
how fast it loaded and here's why it
loaded this way and now you can go and
figure out how to make your page faster
because you know why it loaded the way
that it did so a quick history of web
page test WebP HS is an open-source tool
you can find it up on github it was
started in 2005 at AOL during the
heydays of dial-up modems when
performance was really a big concern
because bandwidth was so low it was open
source of 2008 under a BSD license the
lead developer was hired by google and
2010 and so now he kind of gets to work
quote unquote full-time on web page test
making it better he also works on the
chrome team and so he kind of has this
yin yang thing where he sees all the
performance tests that people are doing
on web page test figures out where
there's general slow spots in chrome and
they go as a fixed chrome to make it
faster so he's got tons of input coming
in so he moved this source to github
in 2011 and so the link to the source
code is provided at the end of this
session I have links and documentation
for all of this for you guys at the an
estate after worry about jotting down
any notes now I like webpagetest a lot
and I'll say a lot of good things about
it but I want to be real honest with you
guys and they're there are some flaws
its biggest flaws is ugly is ugly ass in
and so you look at it and it's just like
check boxes everywhere and settings that
don't necessarily make sense and once
you kind of like get past its ugly
interior and see its heart that's trying
to help you then it could be okay but
I'm gonna try to walk you through some
of that so let me go ahead and show you
what webpagetest looks like now I needed
to come up with some kind of a demo
application to show off webpagetest so I
have a site that we're going to test now
I'm an American I'm American through and
through I live in the great state of
Texas which probably doesn't mean a
whole lot to you Australians but
basically that means I like meat and I
like baseball I'm in Australia did I
have any other fellow baseball fans in
the room the one American guy in the
back is pitying me I know for a fact
that he doesn't care about baseball okay
well that's a bit of a problem because I
really wanted to do a demo site about
baseball so I was kind of thinking to
myself what could I do to get a room
full of fellow nerds interested about
baseball Australian nerds at that and
like it shouldn't be pandering to your
geeky sentiment but if there was just
something I could do to get you to like
baseball a little bit more what could it
possibly be um we don't we don't have to
do this I tell a joke you laughing but
it works a lot better when we do so you
know that's that's up to you so if
destroying the Death Star I got you more
excited about baseball give me a shout
oh right that was still half hearted I
know you guys are just humoring me
because I I scolded you so how about
this let's compromise I built a demo
site about the mascot of minor league
baseball these are the clowns that root
for the team's there's a hundred and
sixty of them throughout the United
States these are all small tiny towns
that you don't want to go to
somebody invites you to one of these
places say no there's a most of the
flyovers anyway this is a real thing
every year all of these mascots get
together and they have the mascot mania
contest which is the Olympic Games of
mass coterie where they have a
competition like a t-shirt gun
sharpshooting and pie throwing contests
and so this year these are the finalists
my favorite of all the mascots his name
is Bala ponyo he's a half jalapeno half
baseball bat and he roots for a team
that plays about an hour south of where
I live he's featured here on this site
but this site is basically just a
standard kind of catalog that's driven
by sequel server running on asp.net MVC
none of the back end really matters to
you we're going to be agnostic there but
just so you know all this is kind of
data-driven now I have this site hosted
up at mascots that as your website's net
that's the production version in Oslo at
NDC I actually did a one-hour
presentation where I took this website
and I did a bunch of performance
optimizations to make it much faster and
the faster version is currently in
staging and so that's that mascots
staging dead as your websites dotnet and
so what I want to do today is I want to
use web page test to test the new
version and make sure it's actually
faster before we we push it to
production and replace the old old
version so this is going to be the demo
site that we use now we were talking
about web page test and this is that
that ugly interface essentially you come
in here you take some URL that you want
to take test like let's say we're going
to test the homepage here we paste it in
we hit start test and that's it now I
mentioned that web page test is a open
source tool so you could download the
source code and you can run it on your
own infrastructure if you would like to
but there's a hosted service at
webpagetest org which is what I'll use
today because it's a hosted service
you'll see that I have I have to wait in
line luckily for me right now this test
I was waiting at the front of the queue
but if you guys I'll pull out your
laptop and start hammering the service
this presentation I go a little slower
because I'll have to wait in line behind
your test that's one of the trade-offs
of Jews of using the free service but of
course it's it's free and easier to get
up and running then running your own
infrastructure
so that that's the interface will dive
into that a little bit more in a second
so let's talk about how webpagetest
actually works so first of all there's
that interface that I just showed you
that's the first player in the game the
next thing is our website that's my
mascot website here now in between those
two is a bunch of different agents is
what webpagetest calls them these are
boxes of all different operating systems
so Windows Android iOS and then all the
different various browsers not all of
them but most of the browsers that you
would potentially want to be running on
those platforms and so when I just went
and paste that URL and hit start testing
the web page test it fired off a that
test into a queue on one of these agents
so I was using a chrome agent and then
that agent when it's ready to process
the work goes to my website my website
responds collects a bunch of data
because these browsers have been
instrumented as such a way they send all
that data back and we get a report to
render on the screen so that's basically
how it works now these agents are
sprinkled all over the world actually I
took the time to painstakingly make this
map as accurate as possible so there are
two locations here in Australia and in
fact you'll notice the little airplane
there that's because Pat meaning the the
main maintainer of the project he was on
a virgin america flight from New York
City to San Francisco once so while he
was on that flight he tweeted out hey
there's a virgin america agent right now
so for those four hours you could test
how users on that flight we're loading
your page and see the performance there
which I thought was pretty funny so all
that to say that setting up an agent is
not a ton of work and there's a bunch of
companies out there who are running
agent that's why there's such a good
worldwide spread of these things and
basically in exchange they get their
name plastered on the website so they
get some advertising out of it so
there's a large partner network this is
the the some pictures of the location of
agents I like to use the most office
almost often this is in Dulles Virginia
a guy running a data center and so what
you'll see here is
he has 3d printed that's the little
white holders for all of these android
motorola devices and so if you wanted to
run a test on android you could do that
you can see he has some iphones and
ipads and various orientations whether
it be landscape or portrait and then a
whole bunch of machines and all these
machines are just sitting there waiting
to take and run at your request and tell
you how fast your site is all right so
let's take a look at the very basic
usage how do we get up and running and
make a first test because anybody can
throw a URL at this thing to find out if
it's faster now but we should think
about performance in a systematic way
and so there's four basic criteria you
want to think about when you're doing a
test we're putting together a test plan
and that's your url your location your
browser and your test count now if i go
back to web page test i'm going to go
back to the homepage here close down
some tabs you'll notice that i have
three of the four that i'm talking about
right there on the homepage URL number
one location i didn't mention before
here's all the different locations this
is where that map comes from here's the
map i can go and select any one of these
locations that I'd like to I'll stick
with the default and browser and then I
had a fourth option which was test runs
which is in advanced settings I really
think that this should be moved up into
basic settings but will cover a little
bit more about why and what it means so
anyway we need to choose a value for
each of these things before we can run a
test and we could just pick them
willy-nilly but there's a better way so
first of all when we go to think about
what URL we want to test your website
probably has more than one URL maybe you
have thousands or millions of URLs and
so you you're probably not going to test
all of them and you probably not going
to test one of them willy-nilly and so
that comes down to using some analytics
so in this case this is a website that I
run called get glympse com and so here's
the analytics are the most popular pages
straight out of my Google Analytics
report and so you can see the homepage
is number one number two is docks number
three is extensions oh and so maybe I
would just choose the top ten pages and
those are going to be my tests but the
reality is is because this site is also
an NBC site
some of those code paths or some of
those URLs are executing the same code
path on the back end right so number two
docks number for docs configuration
number five ducks tabs six seven eight
and eleven or all actually executing the
same code paths are the same template if
if your language is doing that and
really the second part of that slug
where it says like configuration or tabs
that's just a parameter passed in to
tell the system where you get the
content to render that documentation so
my point there is 2 4 5 6 7 8 and 11
that's all really one URL I don't need
to worry about testing those separately
because they're executing the same code
path and so I'll just I'll just pick one
of these so that's how we find a URL so
now I have you know homepage Doc's
extensions and boom I just lit up
basically the top most use portions of
my website you can see that's getting
down to like ninety percent of the usage
if we look at the page views oh well
over nine ninety percent now the next
thing that we want to consider is the
location latency is the biggest killer
of performance on the Internet so where
your user is relative to where your
servers is is a really big deal this is
why cdns are being shoved down our
throats from all of the major cloud
providers now for glimpse it's actually
the u.s. is by far the number one
country of access and the UK is number
two so if I'm running tests i'm going to
start thinking about those countries
perhaps perhaps we were trying really
hard to push this website on to another
country like maybe we really want it to
be big in germany and even though
there's not a lot of usage from germany
i might consider putting that mi test
profile because it meets the business
objectives right so think about where
you are and where you want to be next is
browser this is pretty easy right you're
going to do the same thing you're going
to look at your analytics you're going
to see what the most popular browsers
are I can just pick the top three here I
think that that would be a bit of a
mistake because the difference is
between chrome IE and firefox these days
is so minut as far as the way they
render things and whatnot what i want to
kind of do is I want to look for
different classes of browsers to see
what's kind of pop
they're so chrome IE firefox those are
all big desktop browsers okay I want to
definitely make sure I pick one of those
but what else I see in here is I see
like opera mini that's interesting
because it's rendering engine works
differently I see Android Browser that's
interesting because it's on old phones
and so now I kind of have a couple
classes of browsers I can cluster around
and pick a couple of those now the last
of the four basic inputs that I really
want to focus on is the test count and
let me let me give you take a moment to
tell you what that means now the example
that I just ran before when I when I
slammed a URL and I hit go on web page
test that was a test there's one test
but inside of web page test is the
concept of runs and so the runs are how
many times will it hit your URL now the
reason why web page test uses multiple
runs is it's because it's actually
making those connections across the
internet across the shark-infested
internet and so that means request
number one in request number six could
have completely different loading
profiles just based on a thunderstorm
happening over New York City or
something like that and so what we have
to do with synthetic testing tools to do
a lot of tests and then use the median
and that kind of gives us a margin of
error right we're finding a load that we
think will be a fairly consistent load
and so the service web page test org
will let you run up to nine tests at
once I recommend if you have the time to
basically just always do nine if you're
trying to be a little fast for some
reason like I'm going to be today use a
smaller number but try to use an odd
number because you're finding medians
it's just easier to think about medians
with an odd number if you run web page
test on your own infrastructure you can
crank that number all the way up to 50
so one test has up to nine runs but runs
have multiple views so the first view
web page test will load the browser in
question up completely clear its cash
and request your page so you're saying
what your page looks like on a first
view with an untimed cash after that if
you've enabled the option to have a
repeat view it will rearick West the
exact same URL now with the primed
so you can get an idea of how your users
are experiencing your site for the first
time and the last time so what I'm going
to do is I'm going to come back over to
my site my most popular page by far
according to my analytics is this page
the all mascots page let's list all of
the mascots across all of the league's
on one page so I'm going to copy that
URL we're going to paste it in of course
is it about baseball so only people in
America care so we're going to stick
with Dulles Virginia as a test location
a place in the United States no surprise
chrome the most popular browsers are
globally is the most popular browser on
my site so we're going to stick there
and then the number of tests to run I'm
going to change that to nine and I want
to do first view and repeat views so
I've just filled in the four basic
principles just using some simple Google
Analytics I'm going to hit start test
now we just covered i'm doing nine runs
two views this is 18 requests this is
going to take a little while and so
since i don't want you guys have to hit
sit there and wait i I like like Mario
Batali style on food network type like
pre-baked a turkey that we can all like
see right it would have to wait for that
so I'm going to just close this tab now
that's running the test now we're going
to come to my pre run tests now this
test was run against mascots to as your
website's the the slow production
version of the site and so let's kind of
look at what the results of a test look
like so the first thing you'll notice is
I have some rule-based metrics at the
top it kind of looks like my report card
in middle school I have a lot of F's I
have some work that I need to do to get
better I can click on any one of these
and it will tell me information about
why I received that grade and how to
improve that score the next thing I'll
point out is this center section here
where I have a bunch of quantitative
metrics information about those that
page load so when it was visually
complete when it started to render when
the Dom content loaded event fired etc
etc and then below that we see a
waterfall now if you've used any of your
dev tools and your browser you know what
a waterfall is this is really no
different but I think what webpagetest
does even better because these browsers
are specially instrumented to do it as
you can scroll all the way down to the
bottom of the network diagram and you
can
see the cpu utilization of that box
rendered over the top of the network
diagram so you can see my cpu between
one second and two and a half seconds
was completely spiked and i can scroll
up and kind of see what was happening on
the network when that came in and it
looks like i had a bunch of JPEGs that
came in big JPEGs that so i was probably
doing some jpeg decoding and that used
up a lot of CPU time I can also see the
bandwidth utilization so I can see what
was happening on the Nick I like this
connection view a lot if you're into
like HTTP to and or domain sharding what
these little purple zebra stripes are
showing you is each little alternation
between light and dark is another file
being downloaded and so I did this test
on Chrome which will open up six
connections to the same host that's why
we see one through six mascots that as
your website net those are my six TCP
connections and i'm downloading all of
those files so all of this back half
that's in purple here if I shard in my
domain and I had like images and I put
some of the images over there i was
using HTTP hp2 I might be able to
reshape that traffic and literally cut
off from like second 5.5 to 7.5 and just
like shift the whole thing down and over
and cut two seconds off of my loading
time and so this is a really powerful
kind of visualization there's other
things you can do like I told you this
performance review which tells you about
each one of your grades and why you've
got that grade and things you could do
better so let me sorry scroll to the top
here will say you know I got an F on
compressed transfer so if I click on it
it tells me that I have a lot of files
that I could be compressing and it tells
me which ones I should look into and
foremost web servers that's literally a
configuration bit that you can flip and
and that will happen automatically so
this was all the the results for my
unoptimized version of my page i ran the
exact same test against the staging the
optimized version and you can see hey
look my report card got will let better
it looks like you know Nick in high
school and I have all the same
information available to me but what I
really want to do is I'm trying to
compare did my performance get better
across the the differences that I
changed so if I come in here to test
history I can see a list of all
the test that I've run for up to a year
and I can select up to nine of them i'll
select two and when I hit the compare
button I get this screen that's
comparing those two different test runs
it's to do a little tightening up the
tabs so this is one of those amazing
powerful visualizations that web page
test gives you that no other tool does
like the one I showed you that etsy is
doing so on the top we see a filmstrip
view of the actual loading of the
unoptimized version of the site compared
to the staging version the optimized on
the bottom so you can see at half a
second and I'm already starting to get
something rendering on the optimized
version at two seconds and I'm complete
but on the unoptimized version i'm still
a white blank page just horrible and
then a whole second later it finishes
rendering now that's cool just the
visualization now you can show this to
any non-technical stakeholder and it
clearly makes sense we obviously made a
huge performance impact here we can also
see the network waterfall chart overlaid
on top of each other so here's the
optimized version I can slide the slider
and change the alpha transparency here's
the unoptimized version it's very clear
to see that all of these numbers got
pulled in closer to me I'm doing a
better response time for my server by my
assets are also shorter bars but what I
think it's really slick is you might
notice that there's a red bar right here
right on the edge of the screen so as I
scrub my film strip you see the red bar
moving on the network diagram that is
correlating what's happening on the
rendering thread to what's happening on
the net working thread so all of a
sudden when I started seeing something
show up I can see what started to
download our what finished downloading
so it looks like right here when I
finished downloading my CSS I finally
got something rendering and so you can
see which asset is really blocking your
rendering from happening and this is all
about the critical rendering path if
you've ever heard that term you can you
can see it very visual at the bottom
when you do a comparison of the page it
shows you all of the different metrics
that you might care about and it
generates this bar chart for you so you
can compare and contrast them and so you
can see like my speed index which is a
metric that I talk about in some some
other material that i can give you a
link to was vastly improved you can also
see my
last visual change vastly improved etc
etc my favorite feature though of this
comparison is once you've set up the
comparison you hit this create video
button and this is what etsy is
basically done and so the video looks
like this so now I can literally see
video playback of how these two things
rendered which is amazing and you can
access these and download them and do
whatever you want to with them now
there's other things that you might want
to consider when you're running a test
right i covered the big four maybe like
the fifth one thousand out of fifth one
is the connection speed and so
webpagetest will do trap a traffic
shaping for you so you can fake a slower
connection it it's it's still not sharks
and water real but you know you can
maybe get a little bit more interesting
so that's fine you can do that one of
the things that I think is really cool
you can do on the network is it's the
spot tab now spa stands for a single
point of failure oh and I imagine that
all of you in the room know what a spot
is right like typically we think of it
on the back end right like my database
is a single point of failure and if that
goes down or host right everything is
down but we have single points of
failure on the front end as well every
time you add another script or another
widget or another thing from another
host onto your page that's potentially a
point of failure what happens if that
provider goes down let me give you an
example so some of the mascots in the
minor league baseball system are like
21st century mascots like my bubala
ponyo bala peenya not only rude for the
san antonio missions on the field but he
roots for them on twitter and so his
twitter account is here and i render on
the page and i can show you all of his
very important interesting tweets like
the walk-off grand slam they had the
other night now that widget is their
rendered just because i went to the
twitter website and I grabbed some
javascript file that they gave me and I
slammed on the page it's a one-liner
super simple for me to do now that
widget is being served by Twitter at a
hostname of platform twitter com so
because I'm on this highly instrumented
browser when I'm trying to render that
page and web page test not only can i
shape the traffic and slow down the
connection speed but I can just make it
look like parts of the internet have
disappeared so when I put in this
platform twitter com URL in that box and
rerun the test which I've already rerun
the same time we can see on the top what
the page looks like when Twitter's up
which is a pretty good experience two
and a half seconds in the whole page is
rendered you can see on the bottom
though two and a half seconds in that
widget is blocking the rest of the page
from rendering so that big picture that
hero image of Baal upon you isn't
showing up and it's okay so how long a
two and a half seconds in no change five
seconds in no change ten seconds in no
change fifteen seconds in no change
twenty seconds in no change 22 and a
half 22 seconds in the browser says
screw it and gives up this is really
really hard to test I called Twitter and
said hey can you have a quick like 30
minute outage I want to see how my my
page responds when you're not up yeah
they they did not take too kindly to
that but this is the kind of thing that
you can do and really like be mindful of
what third-party scripts you're taking
on okay so that's the basics covered and
a little bonus basic in there let's
start talking about some advanced usage
there's for advanced scenarios that I
want to run through with you and so
those are custom metrics we saw some of
the metrics I talked about speed index
and load time and things like that what
if you have your own metric we'll look
into that scripting webpagetest so you
can do more than just loading a page
maybe you have some JavaScript
interactivity that you need just to mess
around with we're gonna talk a little
bit about security concerns particularly
if you're working at at an enterprise
and then we're going to look at
exercising the API so the first advanced
scenario is custom metrics so by default
web page test gathers a bunch of
information and shows it to you but it's
the way it's the information that they
think is important but you know your
application better than they do and so
there's some data in your app that you
might care about like maybe you want to
know how much of local storage you
used up for that test right and you want
that to be reported you want that to be
a metric maybe you want to know some
information about the cookie or the user
that you've set up or you're using
geolocation and you want to see you're
using the geolocation API to find out
where that user is any piece of
JavaScript that you can execute to find
out information about the context of the
browser what is the screen resolution
what is its width what is it color depth
all of those things that you can access
via JavaScript you can expose back to
web page test and say hey I want you to
hold on to this I want you to save this
custom metric and so all you have to do
is you write a little bit of JavaScript
let's ignore the first line right now
that's in square brackets and so what
this javascript is doing is it is it's
just vanilla j/s but you could be using
jQuery if jquery is available on your
page or whatever Dom library you want to
is it's iterating through all of the
child nodes of the body tag and it's
looking for one with a node type of
eight all right quiz time does anybody
know what Dom node type 8 is oh man I
guess I just have to keep the hundred
dollar prize ahead no type 8 is a
comment an HTML comment you can actually
access those on the dumb then we're
going to parse that comment with Jason
and that's going to give us a result and
will return that result let me let me
show you a little bit more about what's
happening here and why that this code
exists so on my site this is an MVC site
I basically start and stop a timer every
time the page is requested so you'll see
at the beginning of execution I start a
timer and I stick it into a temporary
place called action timer and at the end
of that execution I get the number of a
lapsed milliseconds and I stuff it into
action time then when i go to render out
the view I check to see if I have that
variable of action time and if I do i
render it out into this little piece of
Jason inside of an HTML comment so let
me let me show you what this looks like
i'm going to view source on this page
you see this comment right here that's
my special thing that I'm doing render
so I'm building a custom
trick that measures how long it takes
for my server side code to execute
injects it into the page in a clever
hidden way and then I use a web page
test custom metric right here to find
that JSON or they find that comment
parse the JSON out of it and return the
action execution time now the square
brackets at the top that's not standard
JavaScript that is the way that you name
a metric in web page test so i would
take this script right here copy it and
paste it into the custom metric tab and
when i run my test that script will will
run and execute so if i do that we will
see first and foremost there's my action
execution time when I ran it it took 90
milliseconds that's whatever that thing
means to me the other thing that's
interesting is if I go and I plot the
full results I ran it I ran the test
nine times and so I can come in here and
plot the full results and this will give
me a a scatter plot of all of the
metrics on the scroll down to the bottom
my custom metrics show up at the bottom
so here's my custom metrics my action
execution time and you can see here's
the nine different run so the first one
took 90 milliseconds the next one was 22
i had an outlier it was really fast of
eight and another outlier of 182 so the
median metric ended up being 90 and so
you can see kind of how much variability
that we had there and so that's a custom
metric you can do some really powerful
things with it I actually liked to you
saw a my and my comment maybe I had
another Jason token called DB and I add
up how much time i take querying the
database and i sticked at it as a custom
metric but imagination can run wild you
guys can do whatever you want to with
those so next let's go into some
automated scripting there every example
that I've shown you is just slam a URL
at loads the rural and it's done but
like I mentioned you might want to do
some page interactivity I have a very
simple scenario just to highlight the
concept of page interactivity on my
website and so that is here we can do a
search
so like if I do a search for mascots
with the name dog in their nail I got a
hot dog horse a slugger the sea dog a
crazy hot dog vendor and a Charlie T
River dog I don't get any like normal
dogs but I get dogs and so what I'm
going to do is I'm going to use this
kind of ugly scripting language that
they have to automate the page test let
me walk you through this line by line
now in the public service you can only
load I'm sorry you can only store and
present data back for one page load and
so I'm going to do a multiple page load
scenario here I'm going to just do this
same search that I just showed you and
so the first thing I'm going to do is
I'm going to say log data that's the
name of the command and like most
languages you would pass parameters to
the command inside of like parentheses
or something like that right not here
instead you say the name of the command
or the method log data and then you tab
and you pass in the first parameter and
so this is 0 false I do not want to log
data and then the next thing I'm going
to do is I'm going to navigate tab the
parameter is and i'm going to navigate
to the home page great now the home page
loads when it finishes loading i can do
the next thing i'm going to set the
value the first parameter is a Dom
element who has a name attribute set to
Q that's my search box that search box
that input box has a name of Q and then
the next parameter is what do I want to
type into that box in this case it's a
bo not dog i'm doing a search for Bo now
i'm going to say okay basically
everything is configured the way i want
it to and now i'm going to start saving
the data so log data one and then i'm
going to submit the form who has a name
attribute set to search so if i copied
this this script i can paste it into web
page test on the script panel and when
the test result runs first of all you'll
know that you are running a script
because this little yellow script label
will show up and it will show you the
script that ran so clearly here's the
script that I just walked you through
and in this example
I'm going to go ahead and seal the
filmstrip view I think this is the best
way to show this off the first thing I
want to point out is every other tests
that i ran the very first frame was
always a white blank page not in this
case because we had already loaded the
home page before we start started
recording and it's a little off the
screen at the bottom here because i have
my search for at the bottom but i've
typed in BO then i hit submit and so now
we can see rendering the search results
and here's the different search results
coming up for Bo including a mascot
whose name is ham bone and he's
literally a piece of ham okay pig based
jokes are the way to go in Australia all
right good to know that so that is
scripting you can do some really
powerful stuff with scripting including
like hit a button load an ajax right spa
type stuff you would do with scripting
alright next let's talk about security
now webpagetest is really cool well
sticker with you let's take a moment to
review how it works so we know that
there's web page test and we know that
there's our website and through an agent
webpagetest request something from our
website and our website returns a result
that's awesome if webpagetest can hit
our website but what if our website is
internal or like to to your company's
corporate environment or what if it's
just running on localhost and web page
test obviously can't hit localhost this
is a problem right so these scenarios we
have some kind of a firewall or
networking issue and so you might throw
in localhost or you'll throw in your
corporate environments URL and the
firewall just throws those requests out
on web page test never actually makes it
to your website so to get around this we
can use a tunneling service I
particularly like one called n drop but
there's others out there well this will
do is once we enable n groc we're going
to set up an an HTTP tunnel over port 80
to go around your firewall to your
website back through and groc into web
page test now the first question you
should be thinking is ok that's cool i
like the hacker mentality here getting
around the firewall but isn't this going
to be really slow you're introducing a
whole extra hop through this service
yeah it's slower it would be much better
if you could hit directly but does it
really matter that we're running our
test a little slower right if we thought
think about those two techniques we're
using rum to tell us is our page fast
yes or no we already know we have a slow
page that's now we're going to synthetic
testing to figure out how do we make the
page faster so yeah all of our results
will look like they're slower but who
cares we already validated that it's
slow now we're validating what the
problem is and so I think n rock is
still a very good solution and so you
can go to end rot calm and download it
it works on every operating system it's
go based it's super lightweight and
quick it's a little command line tool
and so I'm going to use it here on a
local website that I have running so I'm
running the mascots website off of my
localhost you can see this on port 5485
now you haven't seen this yellow bar at
the top of the site before I have this
little feature on the website let me
show you the code for this feature that
says if the request is coming from the
local loopback address then render out
this yellow Dib right the local dev site
let me go ahead and prove that this is
working I'm gonna say NDC save that
refresh and now it should say and you
see local dev site ok so I want to test
that change that NDC obviously this URL
is not going to work so I'm going to
open up like my console here and i'm
going to say n grok i want a tunnel HTTP
traffic to port 5485 all right that's
the port that I'm running off of i is
expressed on my local box now I'm going
to do something that's going to fail but
this is a very common failure so much
you guys to see it so I'm going to run
that I goes up to the end rock service
it creates a public URL that points to
my local host if any of you guys pulled
out your phone right now and you went to
this ugly URL you can pay them money to
get pretty urls but i don't really care
you get this ugly URL and you can drop
it into your device and my machine would
serve the request oh crap ok I knew this
isn't happening remember I told you
there's gonna be a problem this is a
problem that shows up all the time
that's because most of the
web servers that you might use on your
local machine like I is express or
Cassini are explicitly configured to
only serve traffic from localhost and I
US express says hey wait a minute this
end rock thing that ain't localhost I'm
not serving and so you could actually go
into your eye as config and make some
changes to fix this problem but then you
have to run is as an admin which means
you have to run visual studio as an
admin which i think is a real big pain
in the butt instead what I recommend and
the reason i want to show you this is
just run under rock the exact same way
but pass in this host header parameter
and set it equal to localhost and what
the anger out tunneling service will do
now is any request that comes through it
will rewrite the host header to be
localhost tricking I is and to thinking
that you're serving something local so
I've just rerun it again with that flag
passed in it gives me a new URL I can
copy it all sorry I hit I didn't need a
chance I only run this again I will get
another newer URL copy it paste it and
now through the internet I'm serving
that traffic so what does that mean now
I have a URL that I can pass over it's a
web page test I'm gonna try to make this
as fast as possible so we're going to do
one run first view only none of these
custom things I'm going to hit start
test hopefully there's not a long queue
right now good i'm at the front of the
queue webpagetest to end grok to my
website back to end rock back to web
page test gather up all the results send
it to me here in front of you man if the
timing for that work shot it would have
been a lot better oh just off and so you
can see here's the screenshot that web
page test gives me clearly i'm loading
my local NDC dev site so now i'm testing
against my local machine i haven't even
deployed it yet and so that is one of
those advanced scenarios that i wanted
to cover it with you around security all
right the last ones that will that will
cover is the API webpagetest has an API
that's freely available to you for you
to use on the public service I'm going
to show you a couple different
tools to interact with this API but
there's you could obviously be doing
this programmatically I'm just doing it
in a visual way so let's do some cleanup
here of some tabs so the service that
i'm using here is called her 'let all
this is is a simple little website that
lets me create an issue HTTP requests I
could be doing this in curl I could be
doing this and postman I could be doing
this in fiddler I just find this one to
be very easy so the first thing I want
to do is I want to say that I'm going to
do I can do either a post or a get to
the API endpoint of web page test if
you'll allow me to I'm gonna do some
copying and pasting from this little
tool that I made to help me run my
presentation so I got the API endpoint
this is where I submit test to the API
ATS webpagetest org slash run tests PHP
I'm gonna add some parameters the first
thing I'm going to do is I'm going to
say what format I want the results to be
returned in the default is XML did I
mention they started building this in
2005 so I basically always say f is
jason i'm going to add another one which
is k that's my API key you can't use
this API unless you get an API key but
if you head over to webpagetest org
slash get key PHP you give them your
email address and he'll give you a key
that's good for 200 requests a day which
is it going to do everything for you but
it's enough to test and make sure this
will work for you before setting
webpagetest up on your own
infrastructure and then lastly the last
parameter I care about and there's a lot
of them it's all documented is going to
be URL and this is the URL that I
actually want to hit in my tests and so
in this case I'm going to hit my
homepage I'm going to tell her lit that
I'm not a robot it believes me a good
thing I'm gonna launch that request I
see my Jason comes back what's really
interesting here is the Jason URL this
is the jason representation of my result
set so i'm gonna open that up in a
browser you'll notice here that i have a
status code of 100 that means the test
is pending it's still running you can
see that the tests are ten seconds ago
if i refresh 19 seconds ago
so I'm I'm not in the queue but it's
running so we're going to leave this tab
here we're going to come back to it for
a second because I have some other
things with the API i want to show you
i'm just showing you the raw API so you
get an understanding for the way that it
works what you're probably actually
going to do with the API is something
very useful so in this case i'm using
grunt and you could use gold or you
could use broccoli if you're crazy or
you could use whatever it is that you
want to use i'm using grunt and i'm
using a plug-in for grant called perf
budget which is basically a wrapper
around the web page test api that allows
you to make assertions about what you
want the performance of your page to be
so in this case i set the URL equal to
my home page I've I've put my API key in
an environment variable and I've said
that I want the speed index to be a
thousand milliseconds or lower I want
the number of bytes in the total number
of bytes for the page to be under a Meg
I want to render to something to the
screen under a thousand milliseconds is
it these are arbitrary numbers that i
picked about any metric or data point
that web page test gives you back you
can set up an assertion around now what
do you do with that grunt task so i'm
going to run it here and this is gonna
take a little while to cuz it's actually
going to hit the live site what you do
with that task is you run it in your CI
environment that way if you make a
performance regression webpagetest will
hit your page and tell you you got
slower or you didn't hit whatever your
assertions are and you can break the
build so you'll notice this will take a
little second to run and all either pass
or fail look at that I failed I actually
would have broke the build here by speed
index is seven milliseconds over and my
render that's the only one that broke it
is my speed index so I gotta get that a
little bit better so that's that example
will switch back over to the one in the
browser let's see the testicles in 19
seconds to go if i refresh great here's
all the data chrome just caught up and
rendered that in a nice way so you can
see here we have an array of runs these
are all the different runs that ran
obviously I only ran one and my test but
if you had multiples would be two three
four five and you can see what my view
is my first view and I repeat view and
you go through and find all of the
different data points time to first byte
bytes out
bites in etc etc and there's all the
information that you're seeing in the UI
you have programmatic access to so
that's kind of a cool use of the API I
wanted to show you one last thing I
wanted to show you something that
somebody built on the API and so if you
go over here to Andy Davies any Davies
is a is a performance engineer who lives
in the UK he has a thing called the web
page test bolt protester what we're
going to do with that is we'll just
follow the steps here I don't need the
code the first thing that he tells me to
do is open up this google spreadsheet
that's the interface that he used for
this bulk tester and i'm going to ask
for you can just follow the directions
here on the google spreadsheet it kind
of tells you exactly what you need to do
the first thing that tells me to do is
make a copy of the spreadsheet this is a
read-only version of its i'm gonna say
file make a copy let's call this NDC Sid
demo okay great so I can close down his
copy Google Docs is opening up my copy
and so there's a few more bits of
configuration I need to do basically you
follow the tabs that are along the
bottom there and reverse order which I
think they could fix but it's reverse
order so the first thing we're going to
do is go to settings and the big red
ones we need to we need to set up so
what is the URL where is our instance of
web page test running if you had your
own infrastructure you would put in your
own URL we're using the public instance
so I'm going to paste that in there what
is my API key I'm have that right here
so i'll paste it in there's other
parameters that i could set up but i
think that's enough to get the tests up
and running then they have this concept
of scenarios now this is this is really
cool you can define a named set of input
values into web page test and so by
default they let you set up the location
the number of runs whether or not to
capture video and whether or not you
should do a first view only or a first
and repeat view you can map additional
columns to any single check box in the
web page test you I so I'm going to go
ahead and I'll make a custom one let's
call this I'll just override this NDC
SID that's good what location which
agent do I want to use for my test
well if I go over to slash get locations
PHP off a web page test this is a really
ugly dashboard that shows all of the
different agents and how busy or free
they are let's see if we can find a free
one to make this go a little bit faster
here so my favorite dulles chrome that's
pretty busy right now what else has a
lot of agents available Oh 20s all these
are all like single instances that's not
great right now all right we're going to
stick with with oh you know why I look
this one has aired out okay let's just
stick with Dulles chrome so I copied the
name of that location I paste it in here
what location I want to use oh I did not
copy properly and then i can continue to
set up more parameters and then lastly i
go to my tests now i can put in as many
URLs as I want to hear this is this is
called the bulk tester this is a good
way to do execute lots of web page tests
runs at once what I'm going to do is I'm
going to copy the URLs for the league
that plays in each of the states that
I've lived in so I grew up in Florida so
the Florida State League is there I've
spent eight years in new york city and i
recently moved to texas so i have those
three leagues i'm going to paste those
three urls in and i'm going to change
the scenario to use this scenario that i
just created this NDC sydney scenario
and i hit the web page test drop-down
that shows up and run tests so yes i
will authorize this to run allow thank
you google for taking care of me
and so you see in the little status
submitting tests there's our status of
100 again what did 100 mean earlier
pending the test is running I see this
web page test ID in column C this is the
URL if I wanted to go and view the
results directly in the browser I could
go and do that now what's happening is
it just used the API to submit all those
tests with all those parameters that I
had set up and it since they're unposed
the API until I get all other results
back so if this thing runs fast enough
those 100 s should change to 200 by the
time I'm done talking now I show you
this because this is the number one tool
that I use when I have to do a
performance audit I have companies hire
me and come in and do performance audits
I typically do two different things I
look at the URLs I get the most
important ones we put together a profile
using the basic stuff that I said and I
slammed them all in here and I run them
i'll answer question in a second oh you
were talking I have five minutes left hi
good to see you too and so that gives me
a great way to really quickly see an
overview and the nice thing is because
this is all basically Excel data there
we go we're getting results back because
it's all excel data I can just highlight
a couple of columns like boom give me a
bar chart and I can compare and contrast
and make infographics really easily the
other thing that I find this really
interesting for is I've had a couple of
customers like I have a customer who is
a big e book seller and so they have a
lot of competition in the book selling
space and so we have defined the same
pages across all of their competitors so
what is an item details page look like
what does a search results page look
like what does a checkout page look like
and we got all of those URLs for all of
their competitors and did a competitive
analysis in about 15 seconds using this
tool to see what all the competitors
look like kind of figured out where the
baseline is and then we set a threshold
and said we're going to be twenty
percent better than that just from the
psychology of speed twenty percent is
where users will switch to your service
if all else everything else is equal
twenty percent faster they will they
will clearly notice and will choose you
and so boom here you can see so this one
is still at 100 sometimes things get
munge dup and you just go and you say
get results and it will push no this one
still must be running if I want to I can
go
that URL that page and we can say yeah
it is still running we've done one of
the three different runs but as soon as
this thing finishes and that's that
sheet will catch up to me so there you
go with the API i showed you really
quickly how to interact with it in a
very simple way I showed you a grunt
plugin so you can quickly tie it into
your CI server and I showed you a really
cool application of the API with the
bulk webpagetest tester so I have a
bunch of information available for you
here I have links to the documentation
on the scripting language I have links
to the API parameters I have information
about how to run custom metrics i also
have a plural site course which is about
two to three times longer than this
where I through all of the same stuff
and more but more slowly and one of the
key things that I do there that I didn't
cover here is how to be easily get
webpagetest up and running on Amazon Web
Services and the cool thing with Amazon
Web Services is you can hit one button
and have agents running in all of the
Geo locations that they support so if
you want that information go to bit ly /
faster with web page test or take a
picture of that QR code I have time for
questions now a couple of minutes and
then I'm running down to the second
floor to do and ask me anything with ssw
and he's right there saying hi and so if
you want to come and have a longer
conversation about your performance
situation I'm happy to chat there or you
can hit me up on Twitter and thank you
very much for coming you were awesome I
was great better give me green go
questions for a large corporation
working with an intranet and if you
don't want to do your by passing by the
tunnel and you want to set up your own
agent what's involved so what's the
question is what's involved setting up
your own infrastructure are you amenable
to using cloud or no yeah if you if
you're minimal using cloud then on AWS
they have am is already set up and so
you can just search the documentation to
find that ami and say I'm going to set
this
up you'll basically need to set up two
different kinds of servers one that runs
the web page test website or API and
then and so you probably want to make
that like a medium sized instance and
then you want to set up arms are a
micro-sized instance and then you want
to set up the other a mis the other
images and whatever locations you care
about that will actually run the agents
and so that that will get you desktop
browsers basically in 15 minutes it's
that's pretty simple webpage tests will
automatically spin up the agents when
you need to spin them up and it will
tear them down when they're not being
used to save on your bandwidth which is
or your your bill which is great if you
want to physically plug in devices like
this like I showed you in that picture
then you're going to need to have
physical access to the hardware that
gets a little bit more complicated the
agents run on windows so you have to
have a windows of server where I think
it might even run on Windows desktop to
be honest with you and the the the
website itself can run on linux or
windows it's PHP my sequel and I cover
all of that you can find all that
information on on the github page or in
my pro site course guys thank you so
much for coming out I appreciate it have
a good day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>